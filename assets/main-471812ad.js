var tx=Object.defineProperty;var nx=(s,e,t)=>e in s?tx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var lh=(s,e,t)=>(nx(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function t(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerPolicy&&(h.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?h.credentials="include":a.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(a){if(a.ep)return;a.ep=!0;const h=t(a);fetch(a.href,h)}})();function Je(){}function ix(s,e){for(const t in e)s[t]=e[t];return s}function rx(s){return!!s&&(typeof s=="object"||typeof s=="function")&&typeof s.then=="function"}function ev(s){return s()}function Vg(){return Object.create(null)}function Ji(s){s.forEach(ev)}function iu(s){return typeof s=="function"}function on(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}let gf;function ts(s,e){return s===e?!0:(gf||(gf=document.createElement("a")),gf.href=e,s===gf.href)}function sx(s){return Object.keys(s).length===0}function tv(s,...e){if(s==null){for(const r of e)r(void 0);return Je}const t=s.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Df(s){let e;return tv(s,t=>e=t)(),e}function Pt(s,e,t){s.$$.on_destroy.push(tv(e,t))}function Zi(s,e,t,r){if(s){const a=nv(s,e,t,r);return s[0](a)}}function nv(s,e,t,r){return s[1]&&r?ix(t.ctx.slice(),s[1](r(e))):t.ctx}function Hi(s,e,t,r){if(s[2]&&r){const a=s[2](r(t));if(e.dirty===void 0)return a;if(typeof a=="object"){const h=[],m=Math.max(e.dirty.length,a.length);for(let l=0;l<m;l+=1)h[l]=e.dirty[l]|a[l];return h}return e.dirty|a}return e.dirty}function Xi(s,e,t,r,a,h){if(a){const m=nv(e,t,r,h);s.p(m,a)}}function Wi(s){if(s.ctx.length>32){const e=[],t=s.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function ox(s){const e={};for(const t in s)e[t]=!0;return e}function Nf(s){return s??""}function Dn(s,e,t){return s.set(t),e}function pp(s){return s&&iu(s.destroy)?s.destroy:Je}const iv=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function G(s,e){s.appendChild(e)}function se(s,e,t){s.insertBefore(e,t||null)}function re(s){s.parentNode&&s.parentNode.removeChild(s)}function yr(s,e){for(let t=0;t<s.length;t+=1)s[t]&&s[t].d(e)}function le(s){return document.createElement(s)}function za(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function ze(s){return document.createTextNode(s)}function Oe(){return ze(" ")}function Gn(){return ze("")}function Mt(s,e,t,r){return s.addEventListener(e,t,r),()=>s.removeEventListener(e,t,r)}function Nh(s){return function(e){return e.preventDefault(),s.call(this,e)}}function np(s){return function(e){return e.stopPropagation(),s.call(this,e)}}function Ze(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function Gg(s){let e;return{p(...t){e=t,e.forEach(r=>s.push(r))},r(){e.forEach(t=>s.splice(s.indexOf(t),1))}}}function ax(s){return Array.from(s.childNodes)}function Ct(s,e){e=""+e,s.data!==e&&(s.data=e)}function vi(s,e){s.value=e??""}function Rn(s,e,t,r){t==null?s.style.removeProperty(e):s.style.setProperty(e,t,r?"important":"")}function Zr(s,e,t){for(let r=0;r<s.options.length;r+=1){const a=s.options[r];if(a.__value===e){a.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function Da(s){const e=s.querySelector(":checked");return e&&e.__value}function Er(s,e,t){s.classList.toggle(e,!!t)}function lx(s,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:r})}let Th;function Na(s){Th=s}function uc(){if(!Th)throw new Error("Function called outside component initialization");return Th}function cc(s){uc().$$.on_mount.push(s)}function bo(s){uc().$$.on_destroy.push(s)}function hc(){const s=uc();return(e,t,{cancelable:r=!1}={})=>{const a=s.$$.callbacks[e];if(a){const h=lx(e,t,{cancelable:r});return a.slice().forEach(m=>{m.call(s,h)}),!h.defaultPrevented}return!0}}function rv(s,e){return uc().$$.context.set(s,e),e}function sv(s){return uc().$$.context.get(s)}function ur(s,e){const t=s.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const Ku=[],Jn=[];let tc=[];const mp=[],ov=Promise.resolve();let gp=!1;function av(){gp||(gp=!0,ov.then(Vp))}function ux(){return av(),ov}function vo(s){tc.push(s)}function gr(s){mp.push(s)}const ip=new Set;let Vu=0;function Vp(){if(Vu!==0)return;const s=Th;do{try{for(;Vu<Ku.length;){const e=Ku[Vu];Vu++,Na(e),cx(e.$$)}}catch(e){throw Ku.length=0,Vu=0,e}for(Na(null),Ku.length=0,Vu=0;Jn.length;)Jn.pop()();for(let e=0;e<tc.length;e+=1){const t=tc[e];ip.has(t)||(ip.add(t),t())}tc.length=0}while(Ku.length);for(;mp.length;)mp.pop()();gp=!1,ip.clear(),Na(s)}function cx(s){if(s.fragment!==null){s.update(),Ji(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(vo)}}function hx(s){const e=[],t=[];tc.forEach(r=>s.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),tc=e}const Af=new Set;let tu;function Nn(){tu={r:0,c:[],p:tu}}function zn(){tu.r||Ji(tu.c),tu=tu.p}function he(s,e){s&&s.i&&(Af.delete(s),s.i(e))}function ke(s,e,t,r){if(s&&s.o){if(Af.has(s))return;Af.add(s),tu.c.push(()=>{Af.delete(s),r&&(t&&s.d(1),r())}),s.o(e)}else r&&r()}function Xr(s,e){const t=e.token={};function r(a,h,m,l){if(e.token!==t)return;e.resolved=l;let x=e.ctx;m!==void 0&&(x=x.slice(),x[m]=l);const S=a&&(e.current=a)(x);let T=!1;e.block&&(e.blocks?e.blocks.forEach((C,N)=>{N!==h&&C&&(Nn(),ke(C,1,1,()=>{e.blocks[N]===C&&(e.blocks[N]=null)}),zn())}):e.block.d(1),S.c(),he(S,1),S.m(e.mount(),e.anchor),T=!0),e.block=S,e.blocks&&(e.blocks[h]=S),T&&Vp()}if(rx(s)){const a=uc();if(s.then(h=>{Na(a),r(e.then,1,e.value,h),Na(null)},h=>{if(Na(a),r(e.catch,2,e.error,h),Na(null),!e.hasCatch)throw h}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,s),!0;e.resolved=s}}function Oa(s,e,t){const r=e.slice(),{resolved:a}=s;s.current===s.then&&(r[s.value]=a),s.current===s.catch&&(r[s.error]=a),s.block.p(r,t)}function qn(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function fx(s,e){ke(s,1,1,()=>{e.delete(s.key)})}function dx(s,e,t,r,a,h,m,l,x,S,T,C){let N=s.length,B=h.length,U=N;const ee={};for(;U--;)ee[s[U].key]=U;const ie=[],ae=new Map,J=new Map,Y=[];for(U=B;U--;){const ye=C(a,h,U),be=t(ye);let ve=m.get(be);ve?r&&Y.push(()=>ve.p(ye,e)):(ve=S(be,ye),ve.c()),ae.set(be,ie[U]=ve),be in ee&&J.set(be,Math.abs(U-ee[be]))}const ge=new Set,xe=new Set;function Ee(ye){he(ye,1),ye.m(l,T),m.set(ye.key,ye),T=ye.first,B--}for(;N&&B;){const ye=ie[B-1],be=s[N-1],ve=ye.key,Ce=be.key;ye===be?(T=ye.first,N--,B--):ae.has(Ce)?!m.has(ve)||ge.has(ve)?Ee(ye):xe.has(Ce)?N--:J.get(ve)>J.get(Ce)?(xe.add(ve),Ee(ye)):(ge.add(Ce),N--):(x(be,m),N--)}for(;N--;){const ye=s[N];ae.has(ye.key)||x(ye,m)}for(;B;)Ee(ie[B-1]);return Ji(Y),ie}function _r(s,e,t){const r=s.$$.props[e];r!==void 0&&(s.$$.bound[r]=t,t(s.$$.ctx[r]))}function ot(s){s&&s.c()}function rt(s,e,t){const{fragment:r,after_update:a}=s.$$;r&&r.m(e,t),vo(()=>{const h=s.$$.on_mount.map(ev).filter(iu);s.$$.on_destroy?s.$$.on_destroy.push(...h):Ji(h),s.$$.on_mount=[]}),a.forEach(vo)}function st(s,e){const t=s.$$;t.fragment!==null&&(hx(t.after_update),Ji(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function px(s,e){s.$$.dirty[0]===-1&&(Ku.push(s),av(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function hn(s,e,t,r,a,h,m=null,l=[-1]){const x=Th;Na(s);const S=s.$$={fragment:null,ctx:[],props:h,update:Je,not_equal:a,bound:Vg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:Vg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let T=!1;if(S.ctx=t?t(s,e.props||{},(C,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[C],S.ctx[C]=U)&&(!S.skip_bound&&S.bound[C]&&S.bound[C](U),T&&px(s,C)),N}):[],S.update(),T=!0,Ji(S.before_update),S.fragment=r?r(S.ctx):!1,e.target){if(e.hydrate){const C=ax(e.target);S.fragment&&S.fragment.l(C),C.forEach(re)}else S.fragment&&S.fragment.c();e.intro&&he(s.$$.fragment),rt(s,e.target,e.anchor),Vp()}Na(x)}class fn{constructor(){lh(this,"$$");lh(this,"$$set")}$destroy(){st(this,1),this.$destroy=Je}$on(e,t){if(!iu(t))return Je;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const a=r.indexOf(t);a!==-1&&r.splice(a,1)}}$set(e){this.$$set&&!sx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const mx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(mx);var gx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _x(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var lv={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(s,e){(function(t,r){s.exports=r()})(gx,function(){var t={},r={};function a(m,l,x){if(r[m]=x,m==="index"){var S="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",T={};return r.shared(T),r.index(t,T),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),t}}a("shared",["exports"],function(m){function l(o,i,u,g){return new(u||(u=Promise))(function(v,E){function A(F){try{P(g.next(F))}catch(j){E(j)}}function M(F){try{P(g.throw(F))}catch(j){E(j)}}function P(F){var j;F.done?v(F.value):(j=F.value,j instanceof u?j:new u(function(Z){Z(j)})).then(A,M)}P((g=g.apply(o,i||[])).next())})}function x(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}typeof SuppressedError=="function"&&SuppressedError;var S=T;function T(o,i){this.x=o,this.y=i}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,u=o.y-this.y;return i*i+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),u=Math.sin(o),g=u*this.x+i*this.y;return this.x=i*this.x-u*this.y,this.y=g,this},_rotateAround:function(o,i){var u=Math.cos(o),g=Math.sin(o),v=i.y+g*(this.x-i.x)+u*(this.y-i.y);return this.x=i.x+u*(this.x-i.x)-g*(this.y-i.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(o){return o instanceof T?o:Array.isArray(o)?new T(o[0],o[1]):o};var C=x(S),N=B;function B(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}B.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var A=0,M=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?A=u:M=u,u=.5*(M-A)+A;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var U=x(N);let ee,ie;function ae(){return ee==null&&(ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ee}function J(){if(ie==null&&(ie=!1,ae())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let g=0;g<5*5;g++){const v=4*g;i.fillStyle=`rgb(${v},${v+1},${v+2})`,i.fillRect(g%5,Math.floor(g/5),1,1)}const u=i.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&u[g]!==g){ie=!0;break}}}return ie||!1}function Y(o,i,u,g){const v=new U(o,i,u,g);return E=>v.solve(E)}const ge=Y(.25,.1,.25,1);function xe(o,i,u){return Math.min(u,Math.max(i,o))}function Ee(o,i,u){const g=u-i,v=((o-i)%g+g)%g+i;return v===i?u:v}function ye(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}let be=1;function ve(o,i,u){const g={};for(const v in o)g[v]=i.call(this,o[v],v,o);return g}function Ce(o,i,u){const g={};for(const v in o)i.call(this,o[v],v,o)&&(g[v]=o[v]);return g}function we(o){return Array.isArray(o)?o.map(we):typeof o=="object"&&o?ve(o,we):o}const _e={};function tt(o){_e[o]||(typeof console<"u"&&console.warn(o),_e[o]=!0)}function Ve(o,i,u){return(u.y-o.y)*(i.x-o.x)>(i.y-o.y)*(u.x-o.x)}function qe(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let dt=null;function mt(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ut(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(o,{timestamp:0});try{const A=E==null?void 0:E.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const M=A.startsWith("BGR"),P=new Uint8ClampedArray(g*v*4);if(yield E.copyTo(P,function(F,j,Z,W,te){const oe=4*Math.max(-j,0),de=(Math.max(0,Z)-Z)*W*4+oe,Le=4*W,De=Math.max(0,j),it=Math.max(0,Z);return{rect:{x:De,y:it,width:Math.min(F.width,j+W)-De,height:Math.min(F.height,Z+te)-it},layout:[{offset:de,stride:Le}]}}(o,i,u,g,v)),M)for(let F=0;F<P.length;F+=4){const j=P[F];P[F]=P[F+2],P[F+2]=j}return P}finally{E.close()}})}let bt,It;const pt="AbortError";function kt(){return new Error(pt)}const St={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function $t(o){return St.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const pn="global-dispatcher";class Pn extends Error{constructor(i,u,g,v){super(`AJAXError: ${u} (${i}): ${g}`),this.status=i,this.statusText=u,this.url=g,this.body=v}}const We=()=>qe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Kn=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const g=$t(o.url);if(g)return g(o,i);if(qe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:pn},i)}if(!(/^file:/.test(u=o.url)||/^file:/.test(We())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,v){return l(this,void 0,void 0,function*(){const E=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:We(),signal:v.signal});g.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");const A=yield fetch(E);if(!A.ok){const F=yield A.blob();throw new Pn(A.status,A.statusText,g.url,F)}let M;M=g.type==="arrayBuffer"||g.type==="image"?A.arrayBuffer():g.type==="json"?A.json():A.text();const P=yield M;if(v.signal.aborted)throw kt();return{data:P,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}})}(o,i);if(qe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:pn},i)}var u;return function(g,v){return new Promise((E,A)=>{var M;const P=new XMLHttpRequest;P.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(P.responseType="arraybuffer");for(const F in g.headers)P.setRequestHeader(F,g.headers[F]);g.type==="json"&&(P.responseType="text",!((M=g.headers)===null||M===void 0)&&M.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=g.credentials==="include",P.onerror=()=>{A(new Error(P.statusText))},P.onload=()=>{if(!v.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let F=P.response;if(g.type==="json")try{F=JSON.parse(P.response)}catch(j){return void A(j)}E({data:F,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const F=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});A(new Pn(P.status,P.statusText,g.url,F))}},v.signal.addEventListener("abort",()=>{P.abort(),A(kt())}),P.send(g.body)})}(o,i)};function dn(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const i=new URL(o),u=window.location;return i.protocol===u.protocol&&i.host===u.host}function Ot(o,i,u){u[o]&&u[o].indexOf(i)!==-1||(u[o]=u[o]||[],u[o].push(i))}function Ae(o,i,u){if(u&&u[o]){const g=u[o].indexOf(i);g!==-1&&u[o].splice(g,1)}}class ut{constructor(i,u={}){ye(this,u),this.type=i}}class Ye extends ut{constructor(i,u={}){super("error",ye({error:i},u))}}class Lt{on(i,u){return this._listeners=this._listeners||{},Ot(i,u,this._listeners),this}off(i,u){return Ae(i,u,this._listeners),Ae(i,u,this._oneTimeListeners),this}once(i,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ot(i,u,this._oneTimeListeners),this):new Promise(g=>this.once(i,g))}fire(i,u){typeof i=="string"&&(i=new ut(i,u||{}));const g=i.type;if(this.listens(g)){i.target=this;const v=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const M of v)M.call(this,i);const E=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const M of E)Ae(g,M,this._oneTimeListeners),M.call(this,i);const A=this._eventedParent;A&&(ye(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(i))}else i instanceof Ye&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,u){return this._eventedParent=i,this._eventedParentData=u,this}}var Ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const On=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(o,i){const u={};for(const g in o)g!=="ref"&&(u[g]=o[g]);return On.forEach(g=>{g in i&&(u[g]=i[g])}),u}function Se(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let u=0;u<o.length;u++)if(!Se(o[u],i[u]))return!1;return!0}if(typeof o=="object"&&o!==null&&i!==null){if(typeof i!="object"||Object.keys(o).length!==Object.keys(i).length)return!1;for(const u in o)if(!Se(o[u],i[u]))return!1;return!0}return o===i}function Bt(o,i){o.push(i)}function Mn(o,i,u){Bt(u,{command:"addSource",args:[o,i[o]]})}function Fn(o,i,u){Bt(i,{command:"removeSource",args:[o]}),u[o]=!0}function ei(o,i,u,g){Fn(o,u,g),Mn(o,i,u)}function Jt(o,i,u){let g;for(g in o[u])if(Object.prototype.hasOwnProperty.call(o[u],g)&&g!=="data"&&!Se(o[u][g],i[u][g]))return!1;for(g in i[u])if(Object.prototype.hasOwnProperty.call(i[u],g)&&g!=="data"&&!Se(o[u][g],i[u][g]))return!1;return!0}function Ri(o,i,u,g,v,E){o=o||{},i=i||{};for(const A in o)Object.prototype.hasOwnProperty.call(o,A)&&(Se(o[A],i[A])||u.push({command:E,args:[g,A,i[A],v]}));for(const A in i)Object.prototype.hasOwnProperty.call(i,A)&&!Object.prototype.hasOwnProperty.call(o,A)&&(Se(o[A],i[A])||u.push({command:E,args:[g,A,i[A],v]}))}function Qi(o){return o.id}function ns(o,i){return o[i.id]=i,o}class ht{constructor(i,u,g,v){this.message=(i?`${i}: `:"")+g,v&&(this.identifier=v),u!=null&&u.__line__&&(this.line=u.__line__)}}function vr(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}class xn extends Error{constructor(i,u){super(u),this.message=u,this.key=i}}class mn{constructor(i,u=[]){this.parent=i,this.bindings={};for(const[g,v]of u)this.bindings[g]=v}concat(i){return new mn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Rs={kind:"null"},Rt={kind:"number"},An={kind:"string"},At={kind:"boolean"},br={kind:"color"},Wr={kind:"object"},bn={kind:"value"},Pi={kind:"collator"},Ar={kind:"formatted"},er={kind:"padding"},Kr={kind:"resolvedImage"},Re={kind:"variableAnchorOffsetCollection"};function Q(o,i){return{kind:"array",itemType:o,N:i}}function $(o){if(o.kind==="array"){const i=$(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const ce=[Rs,Rt,An,At,br,Ar,Wr,Q(bn),er,Kr,Re];function ue(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!ue(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const u of ce)if(!ue(u,i))return null}}return`Expected ${$(o)} but found ${$(i)} instead.`}function fe(o,i){return i.some(u=>u.kind===o.kind)}function Ue(o,i){return i.some(u=>u==="null"?o===null:u==="array"?Array.isArray(o):u==="object"?o&&!Array.isArray(o)&&typeof o=="object":u===typeof o)}function Xe(o,i){return o.kind==="array"&&i.kind==="array"?o.itemType.kind===i.itemType.kind&&typeof o.N=="number":o.kind===i.kind}const Pe=.96422,nt=.82521,_t=4/29,lt=6/29,Nt=3*lt*lt,en=lt*lt*lt,ln=Math.PI/180,Zn=180/Math.PI;function Tn(o){return(o%=360)<0&&(o+=360),o}function Cn([o,i,u,g]){let v,E;const A=Ii((.2225045*(o=Un(o))+.7168786*(i=Un(i))+.0606169*(u=Un(u)))/1);o===i&&i===u?v=E=A:(v=Ii((.4360747*o+.3850649*i+.1430804*u)/Pe),E=Ii((.0139322*o+.0971045*i+.7141733*u)/nt));const M=116*A-16;return[M<0?0:M,500*(v-A),200*(A-E),g]}function Un(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Ii(o){return o>en?Math.pow(o,1/3):o/Nt+_t}function ci([o,i,u,g]){let v=(o+16)/116,E=isNaN(i)?v:v+i/500,A=isNaN(u)?v:v-u/200;return v=1*ri(v),E=Pe*ri(E),A=nt*ri(A),[En(3.1338561*E-1.6168667*v-.4906146*A),En(-.9787684*E+1.9161415*v+.033454*A),En(.0719453*E-.2289914*v+1.4052427*A),g]}function En(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function ri(o){return o>lt?o*o*o:Nt*(o-_t)}function fi(o){return parseInt(o.padEnd(2,o),16)/255}function Di(o,i){return $n(i?o/100:o,0,1)}function $n(o,i,u){return Math.min(Math.max(i,o),u)}function Tr(o){return!o.some(Number.isNaN)}const No={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ti{constructor(i,u,g,v=1,E=!0){this.r=i,this.g=u,this.b=g,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[i,u,g,v]))}static parse(i){if(i instanceof ti)return i;if(typeof i!="string")return;const u=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=No[g];if(v){const[A,M,P]=v;return[A/255,M/255,P/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const A=g.length<6?1:2;let M=1;return[fi(g.slice(M,M+=A)),fi(g.slice(M,M+=A)),fi(g.slice(M,M+=A)),fi(g.slice(M,M+A)||"ff")]}if(g.startsWith("rgb")){const A=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[M,P,F,j,Z,W,te,oe,de,Le,De,it]=A,Ge=[j||" ",te||" ",Le].join("");if(Ge==="  "||Ge==="  /"||Ge===",,"||Ge===",,,"){const et=[F,W,de].join(""),ft=et==="%%%"?100:et===""?255:0;if(ft){const Et=[$n(+P/ft,0,1),$n(+Z/ft,0,1),$n(+oe/ft,0,1),De?Di(+De,it):1];if(Tr(Et))return Et}}return}}const E=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,M,P,F,j,Z,W,te,oe]=E,de=[P||" ",j||" ",W].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const Le=[+M,$n(+F,0,100),$n(+Z,0,100),te?Di(+te,oe):1];if(Tr(Le))return function([De,it,Ge,et]){function ft(Et){const Wt=(Et+De/30)%12,_n=it*Math.min(Ge,1-Ge);return Ge-_n*Math.max(-1,Math.min(Wt-3,9-Wt,1))}return De=Tn(De),it/=100,Ge/=100,[ft(0),ft(8),ft(4),et]}(Le)}}}(i);return u?new ti(...u,!1):void 0}get rgb(){const{r:i,g:u,b:g,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[i/E,u/E,g/E,v])}get hcl(){return this.overwriteGetter("hcl",function(i){const[u,g,v,E]=Cn(i),A=Math.sqrt(g*g+v*v);return[Math.round(1e4*A)?Tn(Math.atan2(v,g)*Zn):NaN,A,u,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Cn(this.rgb))}overwriteGetter(i,u){return Object.defineProperty(this,i,{value:u}),u}toString(){const[i,u,g,v]=this.rgb;return`rgba(${[i,u,g].map(E=>Math.round(255*E)).join(",")},${v})`}}ti.black=new ti(0,0,0,1),ti.white=new ti(1,1,1,1),ti.transparent=new ti(0,0,0,0),ti.red=new ti(1,0,0,1);class xo{constructor(i,u,g){this.sensitivity=i?u?"variant":"case":u?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,u){return this.collator.compare(i,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(i,u,g,v,E){this.text=i,this.image=u,this.scale=g,this.fontStack=v,this.textColor=E}}class Cr{constructor(i){this.sections=i}static fromString(i){return new Cr([new aa(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Cr?i:Cr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Fr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Fr)return i;if(typeof i=="number")return new Fr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const u of i)if(typeof u!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Fr(i)}}toString(){return JSON.stringify(this.values)}}const yc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ni{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Ni)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let u=0;u<i.length;u+=2){const g=i[u],v=i[u+1];if(typeof g!="string"||!yc.has(g)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Ni(i)}}toString(){return JSON.stringify(this.values)}}class or{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new or({name:i,available:!1}):null}}function no(o,i,u,g){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof u=="number"&&u>=0&&u<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[o,i,u,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[o,i,u,g]:[o,i,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function is(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof ti||o instanceof xo||o instanceof Cr||o instanceof Fr||o instanceof Ni||o instanceof or)return!0;if(Array.isArray(o)){for(const i of o)if(!is(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!is(o[i]))return!1;return!0}return!1}function zi(o){if(o===null)return Rs;if(typeof o=="string")return An;if(typeof o=="boolean")return At;if(typeof o=="number")return Rt;if(o instanceof ti)return br;if(o instanceof xo)return Pi;if(o instanceof Cr)return Ar;if(o instanceof Fr)return er;if(o instanceof Ni)return Re;if(o instanceof or)return Kr;if(Array.isArray(o)){const i=o.length;let u;for(const g of o){const v=zi(g);if(u){if(u===v)continue;u=bn;break}u=v}return Q(u||bn,i)}return Wr}function la(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof ti||o instanceof Cr||o instanceof Fr||o instanceof Ni||o instanceof or?o.toString():JSON.stringify(o)}class ys{constructor(i,u){this.type=i,this.value=u}static parse(i,u){if(i.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!is(i[1]))return u.error("invalid value");const g=i[1];let v=zi(g);const E=u.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new ys(v,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ui{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ua={string:An,number:Rt,boolean:At,object:Wr};class rs{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");let g,v=1;const E=i[0];if(E==="array"){let M,P;if(i.length>2){const F=i[1];if(typeof F!="string"||!(F in ua)||F==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=ua[F],v++}else M=bn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return u.error('The length argument to "array" must be a positive integer literal',2);P=i[2],v++}g=Q(M,P)}else{if(!ua[E])throw new Error(`Types doesn't contain name = ${E}`);g=ua[E]}const A=[];for(;v<i.length;v++){const M=u.parse(i[v],v,bn);if(!M)return null;A.push(M)}return new rs(g,A)}evaluate(i){for(let u=0;u<this.args.length;u++){const g=this.args[u].evaluate(i);if(!ue(this.type,zi(g)))return g;if(u===this.args.length-1)throw new Ui(`Expected value to be of type ${$(this.type)}, but found ${$(zi(g))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const zo={"to-boolean":At,"to-color":br,"to-number":Rt,"to-string":An};class tr{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[0];if(!zo[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&i.length!==2)return u.error("Expected one argument.");const v=zo[g],E=[];for(let A=1;A<i.length;A++){const M=u.parse(i[A],A,bn);if(!M)return null;E.push(M)}return new tr(v,E)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let u,g;for(const v of this.args){if(u=v.evaluate(i),g=null,u instanceof ti)return u;if(typeof u=="string"){const E=i.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(g=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:no(u[0],u[1],u[2],u[3]),!g))return new ti(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Ui(g||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const g of this.args){u=g.evaluate(i);const v=Fr.parse(u);if(v)return v}throw new Ui(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const g of this.args){u=g.evaluate(i);const v=Ni.parse(u);if(v)return v}throw new Ui(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const g of this.args){if(u=g.evaluate(i),u===null)return 0;const v=Number(u);if(!isNaN(v))return v}throw new Ui(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Cr.fromString(la(this.args[0].evaluate(i)));case"resolvedImage":return or.fromString(la(this.args[0].evaluate(i)));default:return la(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const io=["Unknown","Point","LineString","Polygon"];class ca{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let u=this._parseColorCache[i];return u||(u=this._parseColorCache[i]=ti.parse(i)),u}}class ss{constructor(i,u,g=[],v,E=new mn,A=[]){this.registry=i,this.path=g,this.key=g.map(M=>`[${M}]`).join(""),this.scope=E,this.errors=A,this.expectedType=v,this._isConstant=u}parse(i,u,g,v,E={}){return u?this.concat(u,g,v)._parse(i,E):this._parse(i,E)}_parse(i,u){function g(v,E,A){return A==="assert"?new rs(E,[v]):A==="coerce"?new tr(E,[v]):v}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=i[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let A=E.parse(i,this);if(!A)return null;if(this.expectedType){const M=this.expectedType,P=A.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||P.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(M.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(M,P))return null}else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"assert")}if(!(A instanceof ys)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const M=new ca;try{A=new ys(A.type,A.evaluate(M))}catch(P){return this.error(P.message),null}}return A}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,u,g){const v=typeof i=="number"?this.path.concat(i):this.path,E=g?this.scope.concat(g):this.scope;return new ss(this.registry,this._isConstant,v,u||null,E,this.errors)}error(i,...u){const g=`${this.key}${u.map(v=>`[${v}]`).join("")}`;this.errors.push(new xn(g,i))}checkSubtype(i,u){const g=ue(i,u);return g&&this.error(g),g}}class ro{constructor(i,u){this.type=u.type,this.bindings=[].concat(i),this.result=u}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const u of this.bindings)i(u[1]);i(this.result)}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const g=[];for(let E=1;E<i.length-1;E+=2){const A=i[E];if(typeof A!="string")return u.error(`Expected string, but found ${typeof A} instead.`,E);if(/[^a-zA-Z0-9_]/.test(A))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const M=u.parse(i[E+1],E+1);if(!M)return null;g.push([A,M])}const v=u.parse(i[i.length-1],i.length-1,u.expectedType,g);return v?new ro(g,v):null}outputDefined(){return this.result.outputDefined()}}class ni{constructor(i,u){this.type=u.type,this.name=i,this.boundExpression=u}static parse(i,u){if(i.length!==2||typeof i[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const g=i[1];return u.scope.has(g)?new ni(g,u.scope.get(g)):u.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class El{constructor(i,u,g){this.type=i,this.index=u,this.input=g}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,Rt),v=u.parse(i[2],2,Q(u.expectedType||bn));return g&&v?new El(v.type.itemType,g,v):null}evaluate(i){const u=this.index.evaluate(i),g=this.input.evaluate(i);if(u<0)throw new Ui(`Array index out of bounds: ${u} < 0.`);if(u>=g.length)throw new Ui(`Array index out of bounds: ${u} > ${g.length-1}.`);if(u!==Math.floor(u))throw new Ui(`Array index must be an integer, but found ${u} instead.`);return g[u]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Al{constructor(i,u){this.type=At,this.needle=i,this.haystack=u}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,bn),v=u.parse(i[2],2,bn);return g&&v?fe(g.type,[At,An,Rt,Rs,bn])?new Al(g,v):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(g.type)} instead`):null}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!g)return!1;if(!Ue(u,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${$(zi(u))} instead.`);if(!Ue(g,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${$(zi(g))} instead.`);return g.indexOf(u)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class wo{constructor(i,u,g){this.type=Rt,this.needle=i,this.haystack=u,this.fromIndex=g}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,bn),v=u.parse(i[2],2,bn);if(!g||!v)return null;if(!fe(g.type,[At,An,Rt,Rs,bn]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,Rt);return E?new wo(g,v,E):null}return new wo(g,v)}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!Ue(u,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${$(zi(u))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(i)),Ue(g,["string"])){const E=g.indexOf(u,v);return E===-1?-1:[...g.slice(0,E)].length}if(Ue(g,["array"]))return g.indexOf(u,v);throw new Ui(`Expected second argument to be of type array or string, but found ${$(zi(g))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class ko{constructor(i,u,g,v,E,A){this.inputType=i,this.type=u,this.input=g,this.cases=v,this.outputs=E,this.otherwise=A}static parse(i,u){if(i.length<5)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return u.error("Expected an even number of arguments.");let g,v;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);const E={},A=[];for(let F=2;F<i.length-1;F+=2){let j=i[F];const Z=i[F+1];Array.isArray(j)||(j=[j]);const W=u.concat(F);if(j.length===0)return W.error("Expected at least one branch label.");for(const oe of j){if(typeof oe!="number"&&typeof oe!="string")return W.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof oe=="number"&&Math.floor(oe)!==oe)return W.error("Numeric branch labels must be integer values.");if(g){if(W.checkSubtype(g,zi(oe)))return null}else g=zi(oe);if(E[String(oe)]!==void 0)return W.error("Branch labels must be unique.");E[String(oe)]=A.length}const te=u.parse(Z,F,v);if(!te)return null;v=v||te.type,A.push(te)}const M=u.parse(i[1],1,bn);if(!M)return null;const P=u.parse(i[i.length-1],i.length-1,v);return P?M.type.kind!=="value"&&u.concat(1).checkSubtype(g,M.type)?null:new ko(g,v,M,E,A,P):null}evaluate(i){const u=this.input.evaluate(i);return(zi(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(i,u,g){this.type=i,this.branches=u,this.otherwise=g}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return u.error("Expected an odd number of arguments.");let g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v=[];for(let A=1;A<i.length-1;A+=2){const M=u.parse(i[A],A,At);if(!M)return null;const P=u.parse(i[A+1],A+1,g);if(!P)return null;v.push([M,P]),g=g||P.type}const E=u.parse(i[i.length-1],i.length-1,g);if(!E)return null;if(!g)throw new Error("Can't infer output type");return new ha(g,v,E)}evaluate(i){for(const[u,g]of this.branches)if(u.evaluate(i))return g.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[u,g]of this.branches)i(u),i(g);i(this.otherwise)}outputDefined(){return this.branches.every(([i,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(i,u,g,v){this.type=i,this.input=u,this.beginIndex=g,this.endIndex=v}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,bn),v=u.parse(i[2],2,Rt);if(!g||!v)return null;if(!fe(g.type,[Q(bn),An,bn]))return u.error(`Expected first argument to be of type array or string, but found ${$(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,Rt);return E?new fa(g.type,g,v,E):null}return new fa(g.type,g,v)}evaluate(i){const u=this.input.evaluate(i),g=this.beginIndex.evaluate(i);let v;if(this.endIndex&&(v=this.endIndex.evaluate(i)),Ue(u,["string"]))return[...u].slice(g,v).join("");if(Ue(u,["array"]))return u.slice(g,v);throw new Ui(`Expected first argument to be of type array or string, but found ${$(zi(u))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function da(o,i){const u=o.length-1;let g,v,E=0,A=u,M=0;for(;E<=A;)if(M=Math.floor((E+A)/2),g=o[M],v=o[M+1],g<=i){if(M===u||i<v)return M;E=M+1}else{if(!(g>i))throw new Ui("Input is not a number.");A=M-1}return 0}class Fo{constructor(i,u,g){this.type=i,this.input=u,this.labels=[],this.outputs=[];for(const[v,E]of g)this.labels.push(v),this.outputs.push(E)}static parse(i,u){if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");const g=u.parse(i[1],1,Rt);if(!g)return null;const v=[];let E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(let A=1;A<i.length;A+=2){const M=A===1?-1/0:i[A],P=i[A+1],F=A,j=A+1;if(typeof M!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=M)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const Z=u.parse(P,j,E);if(!Z)return null;E=E||Z.type,v.push([M,Z])}return new Fo(E,g,v)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;return v>=u[E-1]?g[E-1].evaluate(i):g[da(u,v)].evaluate(i)}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Ba(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Si=so;function so(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}so.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var A=0,M=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?A=u:M=u,u=.5*(M-A)+A;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var vc=Ba(Si);function Vs(o,i,u){return o+u*(i-o)}function xr(o,i,u){return o.map((g,v)=>Vs(g,i[v],u))}const wi={number:Vs,color:function(o,i,u,g="rgb"){switch(g){case"rgb":{const[v,E,A,M]=xr(o.rgb,i.rgb,u);return new ti(v,E,A,M,!1)}case"hcl":{const[v,E,A,M]=o.hcl,[P,F,j,Z]=i.hcl;let W,te;if(isNaN(v)||isNaN(P))isNaN(v)?isNaN(P)?W=NaN:(W=P,A!==1&&A!==0||(te=F)):(W=v,j!==1&&j!==0||(te=E));else{let it=P-v;P>v&&it>180?it-=360:P<v&&v-P>180&&(it+=360),W=v+u*it}const[oe,de,Le,De]=function([it,Ge,et,ft]){return it=isNaN(it)?0:it*ln,ci([et,Math.cos(it)*Ge,Math.sin(it)*Ge,ft])}([W,te??Vs(E,F,u),Vs(A,j,u),Vs(M,Z,u)]);return new ti(oe,de,Le,De,!1)}case"lab":{const[v,E,A,M]=ci(xr(o.lab,i.lab,u));return new ti(v,E,A,M,!1)}}},array:xr,padding:function(o,i,u){return new Fr(xr(o.values,i.values,u))},variableAnchorOffsetCollection:function(o,i,u){const g=o.values,v=i.values;if(g.length!==v.length)throw new Ui(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${i.toString()}`);const E=[];for(let A=0;A<g.length;A+=2){if(g[A]!==v[A])throw new Ui(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${g[A]}, to[${A}]: ${v[A]}`);E.push(g[A]);const[M,P]=g[A+1],[F,j]=v[A+1];E.push([Vs(M,F,u),Vs(P,j,u)])}return new Ni(E)}};class hr{constructor(i,u,g,v,E){this.type=i,this.operator=u,this.interpolation=g,this.input=v,this.labels=[],this.outputs=[];for(const[A,M]of E)this.labels.push(A),this.outputs.push(M)}static interpolationFactor(i,u,g,v){let E=0;if(i.name==="exponential")E=Ua(u,i.base,g,v);else if(i.name==="linear")E=Ua(u,1,g,v);else if(i.name==="cubic-bezier"){const A=i.controlPoints;E=new vc(A[0],A[1],A[2],A[3]).solve(Ua(u,1,g,v))}return E}static parse(i,u){let[g,v,E,...A]=i;if(!Array.isArray(v)||v.length===0)return u.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const F=v[1];if(typeof F!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:F}}else{if(v[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const F=v.slice(1);if(F.length!==4||F.some(j=>typeof j!="number"||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:F}}}if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,Rt),!E)return null;const M=[];let P=null;g==="interpolate-hcl"||g==="interpolate-lab"?P=br:u.expectedType&&u.expectedType.kind!=="value"&&(P=u.expectedType);for(let F=0;F<A.length;F+=2){const j=A[F],Z=A[F+1],W=F+3,te=F+4;if(typeof j!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(M.length&&M[M.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const oe=u.parse(Z,te,P);if(!oe)return null;P=P||oe.type,M.push([j,oe])}return Xe(P,Rt)||Xe(P,br)||Xe(P,er)||Xe(P,Re)||Xe(P,Q(Rt))?new hr(P,g,v,E,M):u.error(`Type ${$(P)} is not interpolatable.`)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;if(v>=u[E-1])return g[E-1].evaluate(i);const A=da(u,v),M=hr.interpolationFactor(this.interpolation,v,u[A],u[A+1]),P=g[A].evaluate(i),F=g[A+1].evaluate(i);switch(this.operator){case"interpolate":return wi[this.type.kind](P,F,M);case"interpolate-hcl":return wi.color(P,F,M,"hcl");case"interpolate-lab":return wi.color(P,F,M,"lab")}}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Ua(o,i,u,g){const v=g-u,E=o-u;return v===0?0:i===1?E/v:(Math.pow(i,E)-1)/(Math.pow(i,v)-1)}class ja{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expectected at least one argument.");let g=null;const v=u.expectedType;v&&v.kind!=="value"&&(g=v);const E=[];for(const M of i.slice(1)){const P=u.parse(M,1+E.length,g,void 0,{typeAnnotation:"omit"});if(!P)return null;g=g||P.type,E.push(P)}if(!g)throw new Error("No output type");const A=v&&E.some(M=>ue(v,M.type));return new ja(A?bn:g,E)}evaluate(i){let u,g=null,v=0;for(const E of this.args)if(v++,g=E.evaluate(i),g&&g instanceof or&&!g.available&&(u||(u=g.name),g=null,v===this.args.length&&(g=u)),g!==null)break;return g}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function pa(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function ma(o,i,u,g){return g.compare(i,u)===0}function Oo(o,i,u){const g=o!=="=="&&o!=="!=";return class uv{constructor(E,A,M){this.type=At,this.lhs=E,this.rhs=A,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}static parse(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");const M=E[0];let P=A.parse(E[1],1,bn);if(!P)return null;if(!pa(M,P.type))return A.concat(1).error(`"${M}" comparisons are not supported for type '${$(P.type)}'.`);let F=A.parse(E[2],2,bn);if(!F)return null;if(!pa(M,F.type))return A.concat(2).error(`"${M}" comparisons are not supported for type '${$(F.type)}'.`);if(P.type.kind!==F.type.kind&&P.type.kind!=="value"&&F.type.kind!=="value")return A.error(`Cannot compare types '${$(P.type)}' and '${$(F.type)}'.`);g&&(P.type.kind==="value"&&F.type.kind!=="value"?P=new rs(F.type,[P]):P.type.kind!=="value"&&F.type.kind==="value"&&(F=new rs(P.type,[F])));let j=null;if(E.length===4){if(P.type.kind!=="string"&&F.type.kind!=="string"&&P.type.kind!=="value"&&F.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(j=A.parse(E[3],3,Pi),!j)return null}return new uv(P,F,j)}evaluate(E){const A=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(g&&this.hasUntypedArgument){const P=zi(A),F=zi(M);if(P.kind!==F.kind||P.kind!=="string"&&P.kind!=="number")throw new Ui(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${P.kind}, ${F.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const P=zi(A),F=zi(M);if(P.kind!=="string"||F.kind!=="string")return i(E,A,M)}return this.collator?u(E,A,M,this.collator.evaluate(E)):i(E,A,M)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const lu=Oo("==",function(o,i,u){return i===u},ma),si=Oo("!=",function(o,i,u){return i!==u},function(o,i,u,g){return!ma(0,i,u,g)}),vs=Oo("<",function(o,i,u){return i<u},function(o,i,u,g){return g.compare(i,u)<0}),Tl=Oo(">",function(o,i,u){return i>u},function(o,i,u,g){return g.compare(i,u)>0}),uu=Oo("<=",function(o,i,u){return i<=u},function(o,i,u,g){return g.compare(i,u)<=0}),Bo=Oo(">=",function(o,i,u){return i>=u},function(o,i,u,g){return g.compare(i,u)>=0});class Uo{constructor(i,u,g){this.type=Pi,this.locale=g,this.caseSensitive=i,this.diacriticSensitive=u}static parse(i,u){if(i.length!==2)return u.error("Expected one argument.");const g=i[1];if(typeof g!="object"||Array.isArray(g))return u.error("Collator options argument must be an object.");const v=u.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,At);if(!v)return null;const E=u.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,At);if(!E)return null;let A=null;return g.locale&&(A=u.parse(g.locale,1,An),!A)?null:new Uo(v,E,A)}evaluate(i){return new xo(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class fr{constructor(i,u,g,v,E){this.type=An,this.number=i,this.locale=u,this.currency=g,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(i,u){if(i.length!==3)return u.error("Expected two arguments.");const g=u.parse(i[1],1,Rt);if(!g)return null;const v=i[2];if(typeof v!="object"||Array.isArray(v))return u.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=u.parse(v.locale,1,An),!E))return null;let A=null;if(v.currency&&(A=u.parse(v.currency,1,An),!A))return null;let M=null;if(v["min-fraction-digits"]&&(M=u.parse(v["min-fraction-digits"],1,Rt),!M))return null;let P=null;return v["max-fraction-digits"]&&(P=u.parse(v["max-fraction-digits"],1,Rt),!P)?null:new fr(g,E,A,M,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class ga{constructor(i){this.type=Ar,this.sections=i}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[1];if(!Array.isArray(g)&&typeof g=="object")return u.error("First argument must be an image or text section.");const v=[];let E=!1;for(let A=1;A<=i.length-1;++A){const M=i[A];if(E&&typeof M=="object"&&!Array.isArray(M)){E=!1;let P=null;if(M["font-scale"]&&(P=u.parse(M["font-scale"],1,Rt),!P))return null;let F=null;if(M["text-font"]&&(F=u.parse(M["text-font"],1,Q(An)),!F))return null;let j=null;if(M["text-color"]&&(j=u.parse(M["text-color"],1,br),!j))return null;const Z=v[v.length-1];Z.scale=P,Z.font=F,Z.textColor=j}else{const P=u.parse(i[A],1,bn);if(!P)return null;const F=P.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:P,scale:null,font:null,textColor:null})}}return new ga(v)}evaluate(i){return new Cr(this.sections.map(u=>{const g=u.content.evaluate(i);return zi(g)===Kr?new aa("",g,null,null,null):new aa(la(g),null,u.scale?u.scale.evaluate(i):null,u.font?u.font.evaluate(i).join(","):null,u.textColor?u.textColor.evaluate(i):null)}))}eachChild(i){for(const u of this.sections)i(u.content),u.scale&&i(u.scale),u.font&&i(u.font),u.textColor&&i(u.textColor)}outputDefined(){return!1}}class _a{constructor(i){this.type=Kr,this.input=i}static parse(i,u){if(i.length!==2)return u.error("Expected two arguments.");const g=u.parse(i[1],1,An);return g?new _a(g):u.error("No image name provided.")}evaluate(i){const u=this.input.evaluate(i),g=or.fromString(u);return g&&i.availableImages&&(g.available=i.availableImages.indexOf(u)>-1),g}eachChild(i){i(this.input)}outputDefined(){return!1}}class qa{constructor(i){this.type=Rt,this.input=i}static parse(i,u){if(i.length!==2)return u.error(`Expected 1 argument, but found ${i.length-1} instead.`);const g=u.parse(i[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${$(g.type)} instead.`):new qa(g):null}evaluate(i){const u=this.input.evaluate(i);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new Ui(`Expected value to be of type string or array, but found ${$(zi(u))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const bs=8192;function bc(o,i){const u=(180+o[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,v=Math.pow(2,i.z);return[Math.round(u*v*bs),Math.round(g*v*bs)]}function Va(o,i){const u=Math.pow(2,i.z);return[(v=(o[0]/bs+i.x)/u,360*v-180),(g=(o[1]/bs+i.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,v}function Lr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function xs(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function oi(o,i,u){const g=o[0]-i[0],v=o[1]-i[1],E=o[0]-u[0],A=o[1]-u[1];return g*A-E*v==0&&g*E<=0&&v*A<=0}function Mr(o,i,u,g){return(v=[g[0]-u[0],g[1]-u[1]])[0]*(E=[i[0]-o[0],i[1]-o[1]])[1]-v[1]*E[0]!=0&&!(!cu(o,i,u,g)||!cu(u,g,o,i));var v,E}function jo(o,i,u){for(const g of u)for(let v=0;v<g.length-1;++v)if(Mr(o,i,g[v],g[v+1]))return!0;return!1}function qo(o,i,u=!1){let g=!1;for(const M of i)for(let P=0;P<M.length-1;P++){if(oi(o,M[P],M[P+1]))return u;(E=M[P])[1]>(v=o)[1]!=(A=M[P+1])[1]>v[1]&&v[0]<(A[0]-E[0])*(v[1]-E[1])/(A[1]-E[1])+E[0]&&(g=!g)}var v,E,A;return g}function Vo(o,i){for(const u of i)if(qo(o,u))return!0;return!1}function Cl(o,i){for(const u of o)if(!qo(u,i))return!1;for(let u=0;u<o.length-1;++u)if(jo(o[u],o[u+1],i))return!1;return!0}function Go(o,i){for(const u of i)if(Cl(o,u))return!0;return!1}function cu(o,i,u,g){const v=g[0]-u[0],E=g[1]-u[1],A=(o[0]-u[0])*E-v*(o[1]-u[1]),M=(i[0]-u[0])*E-v*(i[1]-u[1]);return A>0&&M<0||A<0&&M>0}function os(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=[];for(let A=0;A<o[v].length;A++){const M=bc(o[v][A],u);Lr(i,M),E.push(M)}g.push(E)}return g}function Ll(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=os(o[v],i,u);g.push(E)}return g}function hu(o,i,u,g){if(o[0]<u[0]||o[0]>u[2]){const v=.5*g;let E=o[0]-u[0]>v?-g:u[0]-o[0]>v?g:0;E===0&&(E=o[0]-u[2]>v?-g:u[2]-o[0]>v?g:0),o[0]+=E}Lr(i,o)}function fu(o,i,u,g){const v=Math.pow(2,g.z)*bs,E=[g.x*bs,g.y*bs],A=[];for(const M of o)for(const P of M){const F=[P.x+E[0],P.y+E[1]];hu(F,i,u,v),A.push(F)}return A}function du(o,i,u,g){const v=Math.pow(2,g.z)*bs,E=[g.x*bs,g.y*bs],A=[];for(const P of o){const F=[];for(const j of P){const Z=[j.x+E[0],j.y+E[1]];Lr(i,Z),F.push(Z)}A.push(F)}if(i[2]-i[0]<=v/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of A)for(const F of P)hu(F,i,u,v)}var M;return A}class Io{constructor(i,u){this.type=At,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(is(i[1])){const g=i[1];if(g.type==="FeatureCollection"){const v=[];for(const E of g.features){const{type:A,coordinates:M}=E.geometry;A==="Polygon"&&v.push(M),A==="MultiPolygon"&&v.push(...M)}if(v.length)return new Io(g,{type:"MultiPolygon",coordinates:v})}else if(g.type==="Feature"){const v=g.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Io(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new Io(g,g)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(g.type==="Polygon"){const M=os(g.coordinates,E,A),P=fu(u.geometry(),v,E,A);if(!xs(v,E))return!1;for(const F of P)if(!qo(F,M))return!1}if(g.type==="MultiPolygon"){const M=Ll(g.coordinates,E,A),P=fu(u.geometry(),v,E,A);if(!xs(v,E))return!1;for(const F of P)if(!Vo(F,M))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(g.type==="Polygon"){const M=os(g.coordinates,E,A),P=du(u.geometry(),v,E,A);if(!xs(v,E))return!1;for(const F of P)if(!Cl(F,M))return!1}if(g.type==="MultiPolygon"){const M=Ll(g.coordinates,E,A),P=du(u.geometry(),v,E,A);if(!xs(v,E))return!1;for(const F of P)if(!Go(F,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pu=class{constructor(o=[],i=(u,g)=>u<g?-1:u>g?1:0){if(this.data=o,this.length=this.data.length,this.compare=i,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:i,compare:u}=this,g=i[o];for(;o>0;){const v=o-1>>1,E=i[v];if(u(g,E)>=0)break;i[o]=E,o=v}i[o]=g}_down(o){const{data:i,compare:u}=this,g=this.length>>1,v=i[o];for(;o<g;){let E=1+(o<<1);const A=E+1;if(A<this.length&&u(i[A],i[E])<0&&(E=A),u(i[E],v)>=0)break;i[o]=i[E],o=E}i[o]=v}};function xc(o,i,u,g,v){mu(o,i,u,g||o.length-1,v||$r)}function mu(o,i,u,g,v){for(;g>u;){if(g-u>600){var E=g-u+1,A=i-u+1,M=Math.log(E),P=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*P*(E-P)/E)*(A-E/2<0?-1:1);mu(o,i,Math.max(u,Math.floor(i-A*P/E+F)),Math.min(g,Math.floor(i+(E-A)*P/E+F)),v)}var j=o[i],Z=u,W=g;for(ws(o,u,i),v(o[g],j)>0&&ws(o,u,g);Z<W;){for(ws(o,Z,W),Z++,W--;v(o[Z],j)<0;)Z++;for(;v(o[W],j)>0;)W--}v(o[u],j)===0?ws(o,u,W):ws(o,++W,g),W<=i&&(u=W+1),i<=W&&(g=W-1)}}function ws(o,i,u){var g=o[i];o[i]=o[u],o[u]=g}function $r(o,i){return o<i?-1:o>i?1:0}function Ga(o,i){if(o.length<=1)return[o];const u=[];let g,v;for(const E of o){const A=wc(E);A!==0&&(E.area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(g&&u.push(g),g=[E]):g.push(E))}if(g&&u.push(g),i>1)for(let E=0;E<u.length;E++)u[E].length<=i||(xc(u[E],i,1,u[E].length-1,gu),u[E]=u[E].slice(0,i));return u}function gu(o,i){return i.area-o.area}function wc(o){let i=0;for(let u,g,v=0,E=o.length,A=E-1;v<E;A=v++)u=o[v],g=o[A],i+=(g.x-u.x)*(u.y+g.y);return i}const Za=1/298.257223563,Ml=Za*(2-Za),Ha=Math.PI/180;class Xa{constructor(i){const u=6378.137*Ha*1e3,g=Math.cos(i*Ha),v=1/(1-Ml*(1-g*g)),E=Math.sqrt(v);this.kx=u*E*g,this.ky=u*E*v*(1-Ml)}distance(i,u){const g=this.wrap(i[0]-u[0])*this.kx,v=(i[1]-u[1])*this.ky;return Math.sqrt(g*g+v*v)}pointOnLine(i,u){let g,v,E,A,M=1/0;for(let P=0;P<i.length-1;P++){let F=i[P][0],j=i[P][1],Z=this.wrap(i[P+1][0]-F)*this.kx,W=(i[P+1][1]-j)*this.ky,te=0;Z===0&&W===0||(te=(this.wrap(u[0]-F)*this.kx*Z+(u[1]-j)*this.ky*W)/(Z*Z+W*W),te>1?(F=i[P+1][0],j=i[P+1][1]):te>0&&(F+=Z/this.kx*te,j+=W/this.ky*te)),Z=this.wrap(u[0]-F)*this.kx,W=(u[1]-j)*this.ky;const oe=Z*Z+W*W;oe<M&&(M=oe,g=F,v=j,E=P,A=te)}return{point:[g,v],index:E,t:Math.max(0,Math.min(1,A))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function as(o,i){return i[0]-o[0]}function ya(o){return o[1]-o[0]+1}function ji(o,i){return o[1]>=o[0]&&o[1]<i}function So(o,i){if(o[0]>o[1])return[null,null];const u=ya(o);if(i){if(u===2)return[o,null];const v=Math.floor(u/2);return[[o[0],o[0]+v],[o[0]+v,o[1]]]}if(u===1)return[o,null];const g=Math.floor(u/2)-1;return[[o[0],o[0]+g],[o[0]+g+1,o[1]]]}function Rl(o,i){if(!ji(i,o.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let g=i[0];g<=i[1];++g)Lr(u,o[g]);return u}function Wa(o){const i=[1/0,1/0,-1/0,-1/0];for(const u of o)for(const g of u)Lr(i,g);return i}function va(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function Ka(o,i,u){if(!va(o)||!va(i))return NaN;let g=0,v=0;return o[2]<i[0]&&(g=i[0]-o[2]),o[0]>i[2]&&(g=o[0]-i[2]),o[1]>i[3]&&(v=o[1]-i[3]),o[3]<i[1]&&(v=i[1]-o[3]),u.distance([0,0],[g,v])}function Gs(o,i,u){const g=u.pointOnLine(i,o);return u.distance(o,g.point)}function Pl(o,i,u,g,v){const E=Math.min(Gs(o,[u,g],v),Gs(i,[u,g],v)),A=Math.min(Gs(u,[o,i],v),Gs(g,[o,i],v));return Math.min(E,A)}function kc(o,i,u,g,v){if(!ji(i,o.length)||!ji(g,u.length))return 1/0;let E=1/0;for(let A=i[0];A<i[1];++A){const M=o[A],P=o[A+1];for(let F=g[0];F<g[1];++F){const j=u[F],Z=u[F+1];if(Mr(M,P,j,Z))return 0;E=Math.min(E,Pl(M,P,j,Z,v))}}return E}function Fi(o,i,u,g,v){if(!ji(i,o.length)||!ji(g,u.length))return NaN;let E=1/0;for(let A=i[0];A<=i[1];++A)for(let M=g[0];M<=g[1];++M)if(E=Math.min(E,v.distance(o[A],u[M])),E===0)return E;return E}function Ic(o,i,u){if(qo(o,i,!0))return 0;let g=1/0;for(const v of i){const E=v[0],A=v[v.length-1];if(E!==A&&(g=Math.min(g,Gs(o,[A,E],u)),g===0))return g;const M=u.pointOnLine(v,o);if(g=Math.min(g,u.distance(o,M.point)),g===0)return g}return g}function jn(o,i,u,g){if(!ji(i,o.length))return NaN;for(let E=i[0];E<=i[1];++E)if(qo(o[E],u,!0))return 0;let v=1/0;for(let E=i[0];E<i[1];++E){const A=o[E],M=o[E+1];for(const P of u)for(let F=0,j=P.length,Z=j-1;F<j;Z=F++){const W=P[Z],te=P[F];if(Mr(A,M,W,te))return 0;v=Math.min(v,Pl(A,M,W,te,g))}}return v}function $a(o,i){for(const u of o)for(const g of u)if(qo(g,i,!0))return!0;return!1}function mi(o,i,u,g=1/0){const v=Wa(o),E=Wa(i);if(g!==1/0&&Ka(v,E,u)>=g)return g;if(xs(v,E)){if($a(o,i))return 0}else if($a(i,o))return 0;let A=1/0;for(const M of o)for(let P=0,F=M.length,j=F-1;P<F;j=P++){const Z=M[j],W=M[P];for(const te of i)for(let oe=0,de=te.length,Le=de-1;oe<de;Le=oe++){const De=te[Le],it=te[oe];if(Mr(Z,W,De,it))return 0;A=Math.min(A,Pl(Z,W,De,it,u))}}return A}function hi(o,i,u,g,v,E){if(!E)return;const A=Ka(Rl(g,E),v,u);A<i&&o.push([A,E,[0,0]])}function oo(o,i,u,g,v,E,A){if(!E||!A)return;const M=Ka(Rl(g,E),Rl(v,A),u);M<i&&o.push([M,E,A])}function ba(o,i,u,g,v=1/0){let E=Math.min(g.distance(o[0],u[0][0]),v);if(E===0)return E;const A=new pu([[0,[0,o.length-1],[0,0]]],as),M=Wa(u);for(;A.length>0;){const P=A.pop();if(P[0]>=E)continue;const F=P[1],j=i?50:100;if(ya(F)<=j){if(!ji(F,o.length))return NaN;if(i){const Z=jn(o,F,u,g);if(isNaN(Z)||Z===0)return Z;E=Math.min(E,Z)}else for(let Z=F[0];Z<=F[1];++Z){const W=Ic(o[Z],u,g);if(E=Math.min(E,W),E===0)return 0}}else{const Z=So(F,i);hi(A,E,g,o,M,Z[0]),hi(A,E,g,o,M,Z[1])}}return E}function Zo(o,i,u,g,v,E=1/0){let A=Math.min(E,v.distance(o[0],u[0]));if(A===0)return A;const M=new pu([[0,[0,o.length-1],[0,u.length-1]]],as);for(;M.length>0;){const P=M.pop();if(P[0]>=A)continue;const F=P[1],j=P[2],Z=i?50:100,W=g?50:100;if(ya(F)<=Z&&ya(j)<=W){if(!ji(F,o.length)&&ji(j,u.length))return NaN;let te;if(i&&g)te=kc(o,F,u,j,v),A=Math.min(A,te);else if(i&&!g){const oe=o.slice(F[0],F[1]+1);for(let de=j[0];de<=j[1];++de)if(te=Gs(u[de],oe,v),A=Math.min(A,te),A===0)return A}else if(!i&&g){const oe=u.slice(j[0],j[1]+1);for(let de=F[0];de<=F[1];++de)if(te=Gs(o[de],oe,v),A=Math.min(A,te),A===0)return A}else te=Fi(o,F,u,j,v),A=Math.min(A,te)}else{const te=So(F,i),oe=So(j,g);oo(M,A,v,o,u,te[0],oe[0]),oo(M,A,v,o,u,te[0],oe[1]),oo(M,A,v,o,u,te[1],oe[0]),oo(M,A,v,o,u,te[1],oe[1])}}return A}function Dl(o){return o.type==="MultiPolygon"?o.coordinates.map(i=>({type:"Polygon",coordinates:i})):o.type==="MultiLineString"?o.coordinates.map(i=>({type:"LineString",coordinates:i})):o.type==="MultiPoint"?o.coordinates.map(i=>({type:"Point",coordinates:i})):[o]}class Eo{constructor(i,u){this.type=Rt,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(is(i[1])){const g=i[1];if(g.type==="FeatureCollection")return new Eo(g,g.features.map(v=>Dl(v.geometry)).flat());if(g.type==="Feature")return new Eo(g,Dl(g.geometry));if("type"in g&&"coordinates"in g)return new Eo(g,Dl(g))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=u.geometry(),E=v.flat().map(P=>Va([P.x,P.y],u.canonical));if(v.length===0)return NaN;const A=new Xa(E[0][1]);let M=1/0;for(const P of g){switch(P.type){case"Point":M=Math.min(M,Zo(E,!1,[P.coordinates],!1,A,M));break;case"LineString":M=Math.min(M,Zo(E,!1,P.coordinates,!0,A,M));break;case"Polygon":M=Math.min(M,ba(E,!1,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=u.geometry(),E=v.flat().map(P=>Va([P.x,P.y],u.canonical));if(v.length===0)return NaN;const A=new Xa(E[0][1]);let M=1/0;for(const P of g){switch(P.type){case"Point":M=Math.min(M,Zo(E,!0,[P.coordinates],!1,A,M));break;case"LineString":M=Math.min(M,Zo(E,!0,P.coordinates,!0,A,M));break;case"Polygon":M=Math.min(M,ba(E,!0,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="Polygon")return function(u,g){const v=u.geometry();if(v.length===0||v[0].length===0)return NaN;const E=Ga(v,0).map(P=>P.map(F=>F.map(j=>Va([j.x,j.y],u.canonical)))),A=new Xa(E[0][0][0][1]);let M=1/0;for(const P of g)for(const F of E){switch(P.type){case"Point":M=Math.min(M,ba([P.coordinates],!1,F,A,M));break;case"LineString":M=Math.min(M,ba(P.coordinates,!0,F,A,M));break;case"Polygon":M=Math.min(M,mi(F,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ho={"==":lu,"!=":si,">":Tl,"<":vs,">=":Bo,"<=":uu,array:rs,at:El,boolean:rs,case:ha,coalesce:ja,collator:Uo,format:ga,image:_a,in:Al,"index-of":wo,interpolate:hr,"interpolate-hcl":hr,"interpolate-lab":hr,length:qa,let:ro,literal:ys,match:ko,number:rs,"number-format":fr,object:rs,slice:fa,step:Fo,string:rs,"to-boolean":tr,"to-color":tr,"to-number":tr,"to-string":tr,var:ni,within:Io,distance:Eo};class ls{constructor(i,u,g,v){this.name=i,this.type=u,this._evaluate=g,this.args=v}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,u){const g=i[0],v=ls.definitions[g];if(!v)return u.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,A=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=A.filter(([F])=>!Array.isArray(F)||F.length===i.length-1);let P=null;for(const[F,j]of M){P=new ss(u.registry,Xo,u.path,null,u.scope);const Z=[];let W=!1;for(let te=1;te<i.length;te++){const oe=i[te],de=Array.isArray(F)?F[te-1]:F.type,Le=P.parse(oe,1+Z.length,de);if(!Le){W=!0;break}Z.push(Le)}if(!W)if(Array.isArray(F)&&F.length!==Z.length)P.error(`Expected ${F.length} arguments, but found ${Z.length} instead.`);else{for(let te=0;te<Z.length;te++){const oe=Array.isArray(F)?F[te]:F.type,de=Z[te];P.concat(te+1).checkSubtype(oe,de.type)}if(P.errors.length===0)return new ls(g,E,j,Z)}}if(M.length===1)u.errors.push(...P.errors);else{const F=(M.length?M:A).map(([Z])=>{return W=Z,Array.isArray(W)?`(${W.map($).join(", ")})`:`(${$(W.type)}...)`;var W}).join(" | "),j=[];for(let Z=1;Z<i.length;Z++){const W=u.parse(i[Z],1+j.length);if(!W)return null;j.push($(W.type))}u.error(`Expected arguments of type ${F}, but found (${j.join(", ")}) instead.`)}return null}static register(i,u){ls.definitions=u;for(const g in u)i[g]=ls}}function Nl(o,[i,u,g,v]){i=i.evaluate(o),u=u.evaluate(o),g=g.evaluate(o);const E=v?v.evaluate(o):1,A=no(i,u,g,E);if(A)throw new Ui(A);return new ti(i/255,u/255,g/255,E,!1)}function zl(o,i){return o in i}function Fl(o,i){const u=i[o];return u===void 0?null:u}function ao(o){return{type:o}}function Xo(o){if(o instanceof ni)return Xo(o.boundExpression);if(o instanceof ls&&o.name==="error"||o instanceof Uo||o instanceof Io||o instanceof Eo)return!1;const i=o instanceof tr||o instanceof rs;let u=!0;return o.eachChild(g=>{u=i?u&&Xo(g):u&&g instanceof ys}),!!u&&Wo(o)&&$o(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wo(o){if(o instanceof ls&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Io||o instanceof Eo)return!1;let i=!0;return o.eachChild(u=>{i&&!Wo(u)&&(i=!1)}),i}function Ko(o){if(o instanceof ls&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(u=>{i&&!Ko(u)&&(i=!1)}),i}function $o(o,i){if(o instanceof ls&&i.indexOf(o.name)>=0)return!1;let u=!0;return o.eachChild(g=>{u&&!$o(g,i)&&(u=!1)}),u}function Yo(o){return{result:"success",value:o}}function Jo(o){return{result:"error",value:o}}function Ao(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Ol(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Bl(o){return!!o.expression&&o.expression.interpolated}function Qn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Zs(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Sc(o){return o}function Ul(o,i){const u=i.type==="color",g=o.stops&&typeof o.stops[0][0]=="object",v=g||!(g||o.property!==void 0),E=o.type||(Bl(i)?"exponential":"interval");if(u||i.type==="padding"){const j=u?ti.parse:Fr.parse;(o=vr({},o)).stops&&(o.stops=o.stops.map(Z=>[Z[0],j(Z[1])])),o.default=j(o.default?o.default:i.default)}if(o.colorSpace&&(A=o.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var A;let M,P,F;if(E==="exponential")M=c;else if(E==="interval")M=I;else if(E==="categorical"){M=ks,P=Object.create(null);for(const j of o.stops)P[j[0]]=j[1];F=typeof o.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);M=d}if(g){const j={},Z=[];for(let oe=0;oe<o.stops.length;oe++){const de=o.stops[oe],Le=de[0].zoom;j[Le]===void 0&&(j[Le]={zoom:Le,type:o.type,property:o.property,default:o.default,stops:[]},Z.push(Le)),j[Le].stops.push([de[0].value,de[1]])}const W=[];for(const oe of Z)W.push([j[oe].zoom,Ul(j[oe],i)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:hr.interpolationFactor.bind(void 0,te),zoomStops:W.map(oe=>oe[0]),evaluate:({zoom:oe},de)=>c({stops:W,base:o.base},i,oe).evaluate(oe,de)}}if(v){const j=E==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:hr.interpolationFactor.bind(void 0,j),zoomStops:o.stops.map(Z=>Z[0]),evaluate:({zoom:Z})=>M(o,i,Z,P,F)}}return{kind:"source",evaluate(j,Z){const W=Z&&Z.properties?Z.properties[o.property]:void 0;return W===void 0?dr(o.default,i.default):M(o,i,W,P,F)}}}function dr(o,i,u){return o!==void 0?o:i!==void 0?i:u!==void 0?u:void 0}function ks(o,i,u,g,v){return dr(typeof u===v?g[u]:void 0,o.default,i.default)}function I(o,i,u){if(Qn(u)!=="number")return dr(o.default,i.default);const g=o.stops.length;if(g===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[g-1][0])return o.stops[g-1][1];const v=da(o.stops.map(E=>E[0]),u);return o.stops[v][1]}function c(o,i,u){const g=o.base!==void 0?o.base:1;if(Qn(u)!=="number")return dr(o.default,i.default);const v=o.stops.length;if(v===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[v-1][0])return o.stops[v-1][1];const E=da(o.stops.map(j=>j[0]),u),A=function(j,Z,W,te){const oe=te-W,de=j-W;return oe===0?0:Z===1?de/oe:(Math.pow(Z,de)-1)/(Math.pow(Z,oe)-1)}(u,g,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],P=o.stops[E+1][1],F=wi[i.type]||Sc;return typeof M.evaluate=="function"?{evaluate(...j){const Z=M.evaluate.apply(void 0,j),W=P.evaluate.apply(void 0,j);if(Z!==void 0&&W!==void 0)return F(Z,W,A,o.colorSpace)}}:F(M,P,A,o.colorSpace)}function d(o,i,u){switch(i.type){case"color":u=ti.parse(u);break;case"formatted":u=Cr.fromString(u.toString());break;case"resolvedImage":u=or.fromString(u.toString());break;case"padding":u=Fr.parse(u);break;default:Qn(u)===i.type||i.type==="enum"&&i.values[u]||(u=void 0)}return dr(u,o.default,i.default)}ls.register(Ho,{error:[{kind:"error"},[An],(o,[i])=>{throw new Ui(i.evaluate(o))}],typeof:[An,[bn],(o,[i])=>$(zi(i.evaluate(o)))],"to-rgba":[Q(Rt,4),[br],(o,[i])=>{const[u,g,v,E]=i.evaluate(o).rgb;return[255*u,255*g,255*v,E]}],rgb:[br,[Rt,Rt,Rt],Nl],rgba:[br,[Rt,Rt,Rt,Rt],Nl],has:{type:At,overloads:[[[An],(o,[i])=>zl(i.evaluate(o),o.properties())],[[An,Wr],(o,[i,u])=>zl(i.evaluate(o),u.evaluate(o))]]},get:{type:bn,overloads:[[[An],(o,[i])=>Fl(i.evaluate(o),o.properties())],[[An,Wr],(o,[i,u])=>Fl(i.evaluate(o),u.evaluate(o))]]},"feature-state":[bn,[An],(o,[i])=>Fl(i.evaluate(o),o.featureState||{})],properties:[Wr,[],o=>o.properties()],"geometry-type":[An,[],o=>o.geometryType()],id:[bn,[],o=>o.id()],zoom:[Rt,[],o=>o.globals.zoom],"heatmap-density":[Rt,[],o=>o.globals.heatmapDensity||0],"line-progress":[Rt,[],o=>o.globals.lineProgress||0],accumulated:[bn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Rt,ao(Rt),(o,i)=>{let u=0;for(const g of i)u+=g.evaluate(o);return u}],"*":[Rt,ao(Rt),(o,i)=>{let u=1;for(const g of i)u*=g.evaluate(o);return u}],"-":{type:Rt,overloads:[[[Rt,Rt],(o,[i,u])=>i.evaluate(o)-u.evaluate(o)],[[Rt],(o,[i])=>-i.evaluate(o)]]},"/":[Rt,[Rt,Rt],(o,[i,u])=>i.evaluate(o)/u.evaluate(o)],"%":[Rt,[Rt,Rt],(o,[i,u])=>i.evaluate(o)%u.evaluate(o)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(o,[i,u])=>Math.pow(i.evaluate(o),u.evaluate(o))],sqrt:[Rt,[Rt],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[Rt,[Rt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[Rt,[Rt],(o,[i])=>Math.log(i.evaluate(o))],log2:[Rt,[Rt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[Rt,[Rt],(o,[i])=>Math.sin(i.evaluate(o))],cos:[Rt,[Rt],(o,[i])=>Math.cos(i.evaluate(o))],tan:[Rt,[Rt],(o,[i])=>Math.tan(i.evaluate(o))],asin:[Rt,[Rt],(o,[i])=>Math.asin(i.evaluate(o))],acos:[Rt,[Rt],(o,[i])=>Math.acos(i.evaluate(o))],atan:[Rt,[Rt],(o,[i])=>Math.atan(i.evaluate(o))],min:[Rt,ao(Rt),(o,i)=>Math.min(...i.map(u=>u.evaluate(o)))],max:[Rt,ao(Rt),(o,i)=>Math.max(...i.map(u=>u.evaluate(o)))],abs:[Rt,[Rt],(o,[i])=>Math.abs(i.evaluate(o))],round:[Rt,[Rt],(o,[i])=>{const u=i.evaluate(o);return u<0?-Math.round(-u):Math.round(u)}],floor:[Rt,[Rt],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[Rt,[Rt],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[At,[An,bn],(o,[i,u])=>o.properties()[i.value]===u.value],"filter-id-==":[At,[bn],(o,[i])=>o.id()===i.value],"filter-type-==":[At,[An],(o,[i])=>o.geometryType()===i.value],"filter-<":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<v}],"filter-id-<":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<g}],"filter->":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>v}],"filter-id->":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>g}],"filter-<=":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<=v}],"filter-id-<=":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<=g}],"filter->=":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>=v}],"filter-id->=":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>=g}],"filter-has":[At,[bn],(o,[i])=>i.value in o.properties()],"filter-has-id":[At,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[At,[Q(An)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[At,[Q(bn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[At,[An,Q(bn)],(o,[i,u])=>u.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[At,[An,Q(bn)],(o,[i,u])=>function(g,v,E,A){for(;E<=A;){const M=E+A>>1;if(v[M]===g)return!0;v[M]>g?A=M-1:E=M+1}return!1}(o.properties()[i.value],u.value,0,u.value.length-1)],all:{type:At,overloads:[[[At,At],(o,[i,u])=>i.evaluate(o)&&u.evaluate(o)],[ao(At),(o,i)=>{for(const u of i)if(!u.evaluate(o))return!1;return!0}]]},any:{type:At,overloads:[[[At,At],(o,[i,u])=>i.evaluate(o)||u.evaluate(o)],[ao(At),(o,i)=>{for(const u of i)if(u.evaluate(o))return!0;return!1}]]},"!":[At,[At],(o,[i])=>!i.evaluate(o)],"is-supported-script":[At,[An],(o,[i])=>{const u=o.globals&&o.globals.isSupportedScript;return!u||u(i.evaluate(o))}],upcase:[An,[An],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[An,[An],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[An,ao(bn),(o,i)=>i.map(u=>la(u.evaluate(o))).join("")],"resolved-locale":[An,[Pi],(o,[i])=>i.evaluate(o).resolvedLocale()]});class p{constructor(i,u){var g;this.expression=i,this._warningHistory={},this._evaluator=new ca,this._defaultValue=u?(g=u).type==="color"&&Zs(g.default)?new ti(0,0,0,0):g.type==="color"?ti.parse(g.default)||null:g.type==="padding"?Fr.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?Ni.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._evaluator.globals=i,this._evaluator.feature=u,this._evaluator.featureState=g,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(i,u,g,v,E,A){this._evaluator.globals=i,this._evaluator.feature=u||null,this._evaluator.featureState=g||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ui(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function b(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ho}function L(o,i){const u=new ss(Ho,Xo,[],i?function(v){const E={color:br,string:An,number:Rt,enum:An,boolean:At,formatted:Ar,padding:er,resolvedImage:Kr,variableAnchorOffsetCollection:Re};return v.type==="array"?Q(E[v.value]||bn,v.length):E[v.type]}(i):void 0),g=u.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Yo(new p(g,i)):Jo(u.errors)}class O{constructor(i,u){this.kind=i,this._styleExpression=u,this.isStateDependent=i!=="constant"&&!Ko(u.expression)}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,A)}evaluate(i,u,g,v,E,A){return this._styleExpression.evaluate(i,u,g,v,E,A)}}class V{constructor(i,u,g,v){this.kind=i,this.zoomStops=g,this._styleExpression=u,this.isStateDependent=i!=="camera"&&!Ko(u.expression),this.interpolationType=v}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,A)}evaluate(i,u,g,v,E,A){return this._styleExpression.evaluate(i,u,g,v,E,A)}interpolationFactor(i,u,g){return this.interpolationType?hr.interpolationFactor(this.interpolationType,i,u,g):0}}function K(o,i){const u=L(o,i);if(u.result==="error")return u;const g=u.value.expression,v=Wo(g);if(!v&&!Ao(i))return Jo([new xn("","data expressions not supported")]);const E=$o(g,["zoom"]);if(!E&&!Ol(i))return Jo([new xn("","zoom expressions not supported")]);const A=Be(g);return A||E?A instanceof xn?Jo([A]):A instanceof hr&&!Bl(i)?Jo([new xn("",'"interpolate" expressions cannot be used with this property')]):Yo(A?new V(v?"camera":"composite",u.value,A.labels,A instanceof hr?A.interpolation:void 0):new O(v?"constant":"source",u.value)):Jo([new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pe{constructor(i,u){this._parameters=i,this._specification=u,vr(this,Ul(this._parameters,this._specification))}static deserialize(i){return new pe(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Be(o){let i=null;if(o instanceof ro)i=Be(o.result);else if(o instanceof ja){for(const u of o.args)if(i=Be(u),i)break}else(o instanceof Fo||o instanceof hr)&&o.input instanceof ls&&o.input.name==="zoom"&&(i=o);return i instanceof xn||o.eachChild(u=>{const g=Be(u);g instanceof xn?i=g:!i&&g?i=new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&g&&i!==g&&(i=new xn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function $e(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!$e(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const gt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ft(o){if(o==null)return{filter:()=>!0,needGeometry:!1};$e(o)||(o=vn(o));const i=L(o,gt);if(i.result==="error")throw new Error(i.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,g,v)=>i.value.evaluate(u,g,{},v),needGeometry:gn(o)}}function zt(o,i){return o<i?-1:o>i?1:0}function gn(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let i=1;i<o.length;i++)if(gn(o[i]))return!0;return!1}function vn(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?Ln(o[1],o[2],"=="):i==="!="?ui(Ln(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ln(o[1],o[2],i):i==="any"?(u=o.slice(1),["any"].concat(u.map(vn))):i==="all"?["all"].concat(o.slice(1).map(vn)):i==="none"?["all"].concat(o.slice(1).map(vn).map(ui)):i==="in"?ii(o[1],o.slice(2)):i==="!in"?ui(ii(o[1],o.slice(2))):i==="has"?gi(o[1]):i!=="!has"||ui(gi(o[1]));var u}function Ln(o,i,u){switch(o){case"$type":return[`filter-type-${u}`,i];case"$id":return[`filter-id-${u}`,i];default:return[`filter-${u}`,o,i]}}function ii(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(u=>typeof u!=typeof i[0])?["filter-in-large",o,["literal",i.sort(zt)]]:["filter-in-small",o,["literal",i]]}}function gi(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ui(o){return["!",o]}function nr(o){const i=typeof o;if(i==="number"||i==="boolean"||i==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let v="[";for(const E of o)v+=`${nr(E)},`;return`${v}]`}const u=Object.keys(o).sort();let g="{";for(let v=0;v<u.length;v++)g+=`${JSON.stringify(u[v])}:${nr(o[u[v]])},`;return`${g}}`}function us(o){let i="";for(const u of On)i+=`/${nr(o[u])}`;return i}function Ps(o){const i=o.value;return i?[new ht(o.key,i,"constants have been deprecated as of v8")]:[]}function di(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Rr(o){if(Array.isArray(o))return o.map(Rr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const u in o)i[u]=Rr(o[u]);return i}return di(o)}function pr(o){const i=o.key,u=o.value,g=o.valueSpec||{},v=o.objectElementValidators||{},E=o.style,A=o.styleSpec,M=o.validateSpec;let P=[];const F=Qn(u);if(F!=="object")return[new ht(i,u,`object expected, ${F} found`)];for(const j in u){const Z=j.split(".")[0],W=g[Z]||g["*"];let te;if(v[Z])te=v[Z];else if(g[Z])te=M;else if(v["*"])te=v["*"];else{if(!g["*"]){P.push(new ht(i,u[j],`unknown property "${j}"`));continue}te=M}P=P.concat(te({key:(i&&`${i}.`)+j,value:u[j],valueSpec:W,style:E,styleSpec:A,object:u,objectKey:j,validateSpec:M},u))}for(const j in g)v[j]||g[j].required&&g[j].default===void 0&&u[j]===void 0&&P.push(new ht(i,u,`missing required property "${j}"`));return P}function Ds(o){const i=o.value,u=o.valueSpec,g=o.style,v=o.styleSpec,E=o.key,A=o.arrayElementValidator||o.validateSpec;if(Qn(i)!=="array")return[new ht(E,i,`array expected, ${Qn(i)} found`)];if(u.length&&i.length!==u.length)return[new ht(E,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new ht(E,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let M={type:u.value,values:u.values};v.$version<7&&(M.function=u.function),Qn(u.value)==="object"&&(M=u.value);let P=[];for(let F=0;F<i.length;F++)P=P.concat(A({array:i,arrayIndex:F,value:i[F],valueSpec:M,validateSpec:o.validateSpec,style:g,styleSpec:v,key:`${E}[${F}]`}));return P}function Ya(o){const i=o.key,u=o.value,g=o.valueSpec;let v=Qn(u);return v==="number"&&u!=u&&(v="NaN"),v!=="number"?[new ht(i,u,`number expected, ${v} found`)]:"minimum"in g&&u<g.minimum?[new ht(i,u,`${u} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&u>g.maximum?[new ht(i,u,`${u} is greater than the maximum value ${g.maximum}`)]:[]}function xa(o){const i=o.valueSpec,u=di(o.value.type);let g,v,E,A={};const M=u!=="categorical"&&o.value.property===void 0,P=!M,F=Qn(o.value.stops)==="array"&&Qn(o.value.stops[0])==="array"&&Qn(o.value.stops[0][0])==="object",j=pr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(te){if(u==="identity")return[new ht(te.key,te.value,'identity function may not have a "stops" property')];let oe=[];const de=te.value;return oe=oe.concat(Ds({key:te.key,value:de,valueSpec:te.valueSpec,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:Z})),Qn(de)==="array"&&de.length===0&&oe.push(new ht(te.key,de,"array must have at least one stop")),oe},default:function(te){return te.validateSpec({key:te.key,value:te.value,valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec})}}});return u==="identity"&&M&&j.push(new ht(o.key,o.value,'missing required property "property"')),u==="identity"||o.value.stops||j.push(new ht(o.key,o.value,'missing required property "stops"')),u==="exponential"&&o.valueSpec.expression&&!Bl(o.valueSpec)&&j.push(new ht(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(P&&!Ao(o.valueSpec)?j.push(new ht(o.key,o.value,"property functions not supported")):M&&!Ol(o.valueSpec)&&j.push(new ht(o.key,o.value,"zoom functions not supported"))),u!=="categorical"&&!F||o.value.property!==void 0||j.push(new ht(o.key,o.value,'"property" property is required')),j;function Z(te){let oe=[];const de=te.value,Le=te.key;if(Qn(de)!=="array")return[new ht(Le,de,`array expected, ${Qn(de)} found`)];if(de.length!==2)return[new ht(Le,de,`array length 2 expected, length ${de.length} found`)];if(F){if(Qn(de[0])!=="object")return[new ht(Le,de,`object expected, ${Qn(de[0])} found`)];if(de[0].zoom===void 0)return[new ht(Le,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new ht(Le,de,"object stop key must have value")];if(E&&E>di(de[0].zoom))return[new ht(Le,de[0].zoom,"stop zoom values must appear in ascending order")];di(de[0].zoom)!==E&&(E=di(de[0].zoom),v=void 0,A={}),oe=oe.concat(pr({key:`${Le}[0]`,value:de[0],valueSpec:{zoom:{}},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:Ya,value:W}}))}else oe=oe.concat(W({key:`${Le}[0]`,value:de[0],valueSpec:{},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec},de));return b(Rr(de[1]))?oe.concat([new ht(`${Le}[1]`,de[1],"expressions are not allowed in function stops.")]):oe.concat(te.validateSpec({key:`${Le}[1]`,value:de[1],valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec}))}function W(te,oe){const de=Qn(te.value),Le=di(te.value),De=te.value!==null?te.value:oe;if(g){if(de!==g)return[new ht(te.key,De,`${de} stop domain type must match previous stop domain type ${g}`)]}else g=de;if(de!=="number"&&de!=="string"&&de!=="boolean")return[new ht(te.key,De,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&u!=="categorical"){let it=`number expected, ${de} found`;return Ao(i)&&u===void 0&&(it+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(te.key,De,it)]}return u!=="categorical"||de!=="number"||isFinite(Le)&&Math.floor(Le)===Le?u!=="categorical"&&de==="number"&&v!==void 0&&Le<v?[new ht(te.key,De,"stop domain values must appear in ascending order")]:(v=Le,u==="categorical"&&Le in A?[new ht(te.key,De,"stop domain values must be unique")]:(A[Le]=!0,[])):[new ht(te.key,De,`integer expected, found ${Le}`)]}}function lo(o){const i=(o.expressionContext==="property"?K:L)(Rr(o.value),o.valueSpec);if(i.result==="error")return i.value.map(g=>new ht(`${o.key}${g.key}`,o.value,g.message));const u=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!u.outputDefined())return[new ht(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Ko(u))return[new ht(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Ko(u))return[new ht(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!$o(u,["zoom","feature-state"]))return[new ht(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Wo(u))return[new ht(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Is(o){const i=o.key,u=o.value,g=o.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(di(u))===-1&&v.push(new ht(i,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(di(u))===-1&&v.push(new ht(i,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Ec(o){return $e(Rr(o.value))?lo(vr({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):_u(o)}function _u(o){const i=o.value,u=o.key;if(Qn(i)!=="array")return[new ht(u,i,`array expected, ${Qn(i)} found`)];const g=o.styleSpec;let v,E=[];if(i.length<1)return[new ht(u,i,"filter array must have at least 1 element")];switch(E=E.concat(Is({key:`${u}[0]`,value:i[0],valueSpec:g.filter_operator,style:o.style,styleSpec:o.styleSpec})),di(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&di(i[1])==="$type"&&E.push(new ht(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&E.push(new ht(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=Qn(i[1]),v!=="string"&&E.push(new ht(`${u}[1]`,i[1],`string expected, ${v} found`)));for(let A=2;A<i.length;A++)v=Qn(i[A]),di(i[1])==="$type"?E=E.concat(Is({key:`${u}[${A}]`,value:i[A],valueSpec:g.geometry_type,style:o.style,styleSpec:o.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new ht(`${u}[${A}]`,i[A],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let A=1;A<i.length;A++)E=E.concat(_u({key:`${u}[${A}]`,value:i[A],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":v=Qn(i[1]),i.length!==2?E.push(new ht(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new ht(`${u}[1]`,i[1],`string expected, ${v} found`))}return E}function Ac(o,i){const u=o.key,g=o.validateSpec,v=o.style,E=o.styleSpec,A=o.value,M=o.objectKey,P=E[`${i}_${o.layerType}`];if(!P)return[];const F=M.match(/^(.*)-transition$/);if(i==="paint"&&F&&P[F[1]]&&P[F[1]].transition)return g({key:u,value:A,valueSpec:E.transition,style:v,styleSpec:E});const j=o.valueSpec||P[M];if(!j)return[new ht(u,A,`unknown property "${M}"`)];let Z;if(Qn(A)==="string"&&Ao(j)&&!j.tokens&&(Z=/^{([^}]+)}$/.exec(A)))return[new ht(u,A,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Z[1])} }\`.`)];const W=[];return o.layerType==="symbol"&&(M==="text-field"&&v&&!v.glyphs&&W.push(new ht(u,A,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Zs(Rr(A))&&di(A.type)==="identity"&&W.push(new ht(u,A,'"text-font" does not support identity functions'))),W.concat(g({key:o.key,value:A,valueSpec:j,style:v,styleSpec:E,expressionContext:"property",propertyType:i,propertyKey:M}))}function yu(o){return Ac(o,"paint")}function Tc(o){return Ac(o,"layout")}function Cc(o){let i=[];const u=o.value,g=o.key,v=o.style,E=o.styleSpec;u.type||u.ref||i.push(new ht(g,u,'either "type" or "ref" is required'));let A=di(u.type);const M=di(u.ref);if(u.id){const P=di(u.id);for(let F=0;F<o.arrayIndex;F++){const j=v.layers[F];di(j.id)===P&&i.push(new ht(g,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let P;["type","source","source-layer","filter","layout"].forEach(F=>{F in u&&i.push(new ht(g,u[F],`"${F}" is prohibited for ref layers`))}),v.layers.forEach(F=>{di(F.id)===M&&(P=F)}),P?P.ref?i.push(new ht(g,u.ref,"ref cannot reference another ref layer")):A=di(P.type):i.push(new ht(g,u.ref,`ref layer "${M}" not found`))}else if(A!=="background")if(u.source){const P=v.sources&&v.sources[u.source],F=P&&di(P.type);P?F==="vector"&&A==="raster"?i.push(new ht(g,u.source,`layer "${u.id}" requires a raster source`)):F!=="raster-dem"&&A==="hillshade"?i.push(new ht(g,u.source,`layer "${u.id}" requires a raster-dem source`)):F==="raster"&&A!=="raster"?i.push(new ht(g,u.source,`layer "${u.id}" requires a vector source`)):F!=="vector"||u["source-layer"]?F==="raster-dem"&&A!=="hillshade"?i.push(new ht(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!u.paint||!u.paint["line-gradient"]||F==="geojson"&&P.lineMetrics||i.push(new ht(g,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ht(g,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new ht(g,u.source,`source "${u.source}" not found`))}else i.push(new ht(g,u,'missing required property "source"'));return i=i.concat(pr({key:g,value:u,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${g}.type`,value:u.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:u,objectKey:"type"}),filter:Ec,layout:P=>pr({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":F=>Tc(vr({layerType:A},F))}}),paint:P=>pr({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":F=>yu(vr({layerType:A},F))}})}})),i}function wa(o){const i=o.value,u=o.key,g=Qn(i);return g!=="string"?[new ht(u,i,`string expected, ${g} found`)]:[]}const vu={promoteId:function({key:o,value:i}){if(Qn(i)==="string")return wa({key:o,value:i});{const u=[];for(const g in i)u.push(...wa({key:`${o}.${g}`,value:i[g]}));return u}}};function jl(o){const i=o.value,u=o.key,g=o.styleSpec,v=o.style,E=o.validateSpec;if(!i.type)return[new ht(u,i,'"type" is required')];const A=di(i.type);let M;switch(A){case"vector":case"raster":return M=pr({key:u,value:i,valueSpec:g[`source_${A.replace("-","_")}`],style:o.style,styleSpec:g,objectElementValidators:vu,validateSpec:E}),M;case"raster-dem":return M=function(P){var F;const j=(F=P.sourceName)!==null&&F!==void 0?F:"",Z=P.value,W=P.styleSpec,te=W.source_raster_dem,oe=P.style;let de=[];const Le=Qn(Z);if(Z===void 0)return de;if(Le!=="object")return de.push(new ht("source_raster_dem",Z,`object expected, ${Le} found`)),de;const De=di(Z.encoding)==="custom",it=["redFactor","greenFactor","blueFactor","baseShift"],Ge=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const et in Z)!De&&it.includes(et)?de.push(new ht(et,Z[et],`In "${j}": "${et}" is only valid when "encoding" is set to "custom". ${Ge} encoding found`)):te[et]?de=de.concat(P.validateSpec({key:et,value:Z[et],valueSpec:te[et],validateSpec:P.validateSpec,style:oe,styleSpec:W})):de.push(new ht(et,Z[et],`unknown property "${et}"`));return de}({sourceName:u,value:i,style:o.style,styleSpec:g,validateSpec:E}),M;case"geojson":if(M=pr({key:u,value:i,valueSpec:g.source_geojson,style:v,styleSpec:g,validateSpec:E,objectElementValidators:vu}),i.cluster)for(const P in i.clusterProperties){const[F,j]=i.clusterProperties[P],Z=typeof F=="string"?[F,["accumulated"],["get",P]]:F;M.push(...lo({key:`${u}.${P}.map`,value:j,validateSpec:E,expressionContext:"cluster-map"})),M.push(...lo({key:`${u}.${P}.reduce`,value:Z,validateSpec:E,expressionContext:"cluster-reduce"}))}return M;case"video":return pr({key:u,value:i,valueSpec:g.source_video,style:v,validateSpec:E,styleSpec:g});case"image":return pr({key:u,value:i,valueSpec:g.source_image,style:v,validateSpec:E,styleSpec:g});case"canvas":return[new ht(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Is({key:`${u}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:E,styleSpec:g})}}function Lc(o){const i=o.value,u=o.styleSpec,g=u.light,v=o.style;let E=[];const A=Qn(i);if(i===void 0)return E;if(A!=="object")return E=E.concat([new ht("light",i,`object expected, ${A} found`)]),E;for(const M in i){const P=M.match(/^(.*)-transition$/);E=E.concat(P&&g[P[1]]&&g[P[1]].transition?o.validateSpec({key:M,value:i[M],valueSpec:u.transition,validateSpec:o.validateSpec,style:v,styleSpec:u}):g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ht(M,i[M],`unknown property "${M}"`)])}return E}function Mc(o){const i=o.value,u=o.styleSpec,g=u.sky,v=o.style,E=Qn(i);if(i===void 0)return[];if(E!=="object")return[new ht("sky",i,`object expected, ${E} found`)];let A=[];for(const M in i)A=A.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],style:v,styleSpec:u}):[new ht(M,i[M],`unknown property "${M}"`)]);return A}function Rc(o){const i=o.value,u=o.styleSpec,g=u.terrain,v=o.style;let E=[];const A=Qn(i);if(i===void 0)return E;if(A!=="object")return E=E.concat([new ht("terrain",i,`object expected, ${A} found`)]),E;for(const M in i)E=E.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ht(M,i[M],`unknown property "${M}"`)]);return E}function Pc(o){let i=[];const u=o.value,g=o.key;if(Array.isArray(u)){const v=[],E=[];for(const A in u)u[A].id&&v.includes(u[A].id)&&i.push(new ht(g,u,`all the sprites' ids must be unique, but ${u[A].id} is duplicated`)),v.push(u[A].id),u[A].url&&E.includes(u[A].url)&&i.push(new ht(g,u,`all the sprites' URLs must be unique, but ${u[A].url} is duplicated`)),E.push(u[A].url),i=i.concat(pr({key:`${g}[${A}]`,value:u[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return i}return wa({key:g,value:u})}const bu={"*":()=>[],array:Ds,boolean:function(o){const i=o.value,u=o.key,g=Qn(i);return g!=="boolean"?[new ht(u,i,`boolean expected, ${g} found`)]:[]},number:Ya,color:function(o){const i=o.key,u=o.value,g=Qn(u);return g!=="string"?[new ht(i,u,`color expected, ${g} found`)]:ti.parse(String(u))?[]:[new ht(i,u,`color expected, "${u}" found`)]},constants:Ps,enum:Is,filter:Ec,function:xa,layer:Cc,object:pr,source:jl,light:Lc,sky:Mc,terrain:Rc,projection:function(o){const i=o.value,u=o.styleSpec,g=u.projection,v=o.style,E=Qn(i);if(i===void 0)return[];if(E!=="object")return[new ht("projection",i,`object expected, ${E} found`)];let A=[];for(const M in i)A=A.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],style:v,styleSpec:u}):[new ht(M,i[M],`unknown property "${M}"`)]);return A},string:wa,formatted:function(o){return wa(o).length===0?[]:lo(o)},resolvedImage:function(o){return wa(o).length===0?[]:lo(o)},padding:function(o){const i=o.key,u=o.value;if(Qn(u)==="array"){if(u.length<1||u.length>4)return[new ht(i,u,`padding requires 1 to 4 values; ${u.length} values found`)];const g={type:"number"};let v=[];for(let E=0;E<u.length;E++)v=v.concat(o.validateSpec({key:`${i}[${E}]`,value:u[E],validateSpec:o.validateSpec,valueSpec:g}));return v}return Ya({key:i,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const i=o.key,u=o.value,g=Qn(u),v=o.styleSpec;if(g!=="array"||u.length<1||u.length%2!=0)return[new ht(i,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let A=0;A<u.length;A+=2)E=E.concat(Is({key:`${i}[${A}]`,value:u[A],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(Ds({key:`${i}[${A+1}]`,value:u[A+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:v}));return E},sprite:Pc};function Ja(o){const i=o.value,u=o.valueSpec,g=o.styleSpec;return o.validateSpec=Ja,u.expression&&Zs(di(i))?xa(o):u.expression&&b(Rr(i))?lo(o):u.type&&bu[u.type]?bu[u.type](o):pr(vr({},o,{valueSpec:u.type?g[u.type]:u}))}function Bh(o){const i=o.value,u=o.key,g=wa(o);return g.length||(i.indexOf("{fontstack}")===-1&&g.push(new ht(u,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&g.push(new ht(u,i,'"glyphs" url must include a "{range}" token'))),g}function Ns(o,i=Ke){let u=[];return u=u.concat(Ja({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,validateSpec:Ja,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),o.constants&&(u=u.concat(Ps({key:"constants",value:o.constants,style:o,styleSpec:i,validateSpec:Ja}))),Dc(u)}function uo(o){return function(i){return o({...i,validateSpec:Ja})}}function Dc(o){return[].concat(o).sort((i,u)=>i.line-u.line)}function Hs(o){return function(...i){return Dc(o.apply(this,i))}}Ns.source=Hs(uo(jl)),Ns.sprite=Hs(uo(Pc)),Ns.glyphs=Hs(uo(Bh)),Ns.light=Hs(uo(Lc)),Ns.sky=Hs(uo(Mc)),Ns.terrain=Hs(uo(Rc)),Ns.layer=Hs(uo(Cc)),Ns.filter=Hs(uo(Ec)),Ns.paintProperty=Hs(uo(yu)),Ns.layoutProperty=Hs(uo(Tc));const ka=Ns,od=ka.light,ad=ka.sky,Uh=ka.paintProperty,jh=ka.layoutProperty;function Nc(o,i){let u=!1;if(i&&i.length)for(const g of i)o.fire(new Ye(new Error(g.message))),u=!0;return u}class Qa{constructor(i,u,g){const v=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const A=new Int32Array(this.arrayBuffer);i=A[0],this.d=(u=A[1])+2*(g=A[2]);for(let P=0;P<this.d*this.d;P++){const F=A[3+P],j=A[3+P+1];v.push(F===j?null:A.subarray(F,j))}const M=A[3+v.length+1];this.keys=A.subarray(A[3+v.length],M),this.bboxes=A.subarray(M),this.insert=this._insertReadonly}else{this.d=u+2*g;for(let A=0;A<this.d*this.d;A++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=g,this.scale=u/i,this.uid=0;const E=g/u*i;this.min=-E,this.max=i+E}insert(i,u,g,v,E){this._forEachCell(u,g,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,u,g,v,E,A){this.cells[E].push(A)}query(i,u,g,v,E){const A=this.min,M=this.max;if(i<=A&&u<=A&&M<=g&&M<=v&&!E)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(i,u,g,v,this._queryCell,P,{},E),P}}_queryCell(i,u,g,v,E,A,M,P){const F=this.cells[E];if(F!==null){const j=this.keys,Z=this.bboxes;for(let W=0;W<F.length;W++){const te=F[W];if(M[te]===void 0){const oe=4*te;(P?P(Z[oe+0],Z[oe+1],Z[oe+2],Z[oe+3]):i<=Z[oe+2]&&u<=Z[oe+3]&&g>=Z[oe+0]&&v>=Z[oe+1])?(M[te]=!0,A.push(j[te])):M[te]=!1}}}}_forEachCell(i,u,g,v,E,A,M,P){const F=this._convertToCellCoord(i),j=this._convertToCellCoord(u),Z=this._convertToCellCoord(g),W=this._convertToCellCoord(v);for(let te=F;te<=Z;te++)for(let oe=j;oe<=W;oe++){const de=this.d*oe+te;if((!P||P(this._convertFromCellCoord(te),this._convertFromCellCoord(oe),this._convertFromCellCoord(te+1),this._convertFromCellCoord(oe+1)))&&E.call(this,i,u,g,v,de,A,M,P))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,u=3+this.cells.length+1+1;let g=0;for(let A=0;A<this.cells.length;A++)g+=this.cells[A].length;const v=new Int32Array(u+g+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=u;for(let A=0;A<i.length;A++){const M=i[A];v[3+A]=E,v.set(M,E),E+=M.length}return v[3+i.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+i.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(i,u){const g=i.toArrayBuffer();return u&&u.push(g),{buffer:g}}static deserialize(i){return new Qa(i.buffer)}}const zs={};function Qt(o,i,u={}){if(zs[o])throw new Error(`${o} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),zs[o]={klass:i,omit:u.omit||[],shallow:u.shallow||[]}}Qt("Object",Object),Qt("TransferableGridIndex",Qa),Qt("Color",ti),Qt("Error",Error),Qt("AJAXError",Pn),Qt("ResolvedImage",or),Qt("StylePropertyFunction",pe),Qt("StyleExpression",p,{omit:["_evaluator"]}),Qt("ZoomDependentExpression",V),Qt("ZoomConstantExpression",O),Qt("CompoundExpression",ls,{omit:["_evaluate"]});for(const o in Ho)Ho[o]._classRegistryKey||Qt(`Expression_${o}`,Ho[o]);function xu(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function zc(o){return o.$name||o.constructor._classRegistryKey}function qh(o){return!function(i){if(i===null||typeof i!="object")return!1;const u=zc(i);return!(!u||u==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||xu(o)||mt(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function el(o,i){if(qh(o))return(xu(o)||mt(o))&&i&&i.push(o),ArrayBuffer.isView(o)&&i&&i.push(o.buffer),o instanceof ImageData&&i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const E=[];for(const A of o)E.push(el(A,i));return E}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const u=zc(o);if(!u)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!zs[u])throw new Error(`${u} is not registered.`);const{klass:g}=zs[u],v=g.serialize?g.serialize(o,i):{};if(g.serialize){if(i&&v===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in o){if(!o.hasOwnProperty(E)||zs[u].omit.indexOf(E)>=0)continue;const A=o[E];v[E]=zs[u].shallow.indexOf(E)>=0?A:el(A,i)}o instanceof Error&&(v.message=o.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(v.$name=u),v}function tl(o){if(qh(o))return o;if(Array.isArray(o))return o.map(tl);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const i=zc(o)||"Object";if(!zs[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:u}=zs[i];if(!u)throw new Error(`can't deserialize unregistered class ${i}`);if(u.deserialize)return u.deserialize(o);const g=Object.create(u.prototype);for(const v of Object.keys(o)){if(v==="$name")continue;const E=o[v];g[v]=zs[i].shallow.indexOf(v)>=0?E:tl(E)}return g}class Fc{constructor(){this.first=!0}update(i,u){const g=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=u),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=g,!0))}}const Hn={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Oc(o){for(const i of o)if(Uc(i.charCodeAt(0)))return!0;return!1}function ld(o){for(const i of o)if(!nl(i.charCodeAt(0)))return!1;return!0}function Bc(o){const i=o.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(i.join("|"),"u")}const ud=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function nl(o){return!ud.test(String.fromCodePoint(o))}const Vh=Bc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Uc(o){return!(o!==746&&o!==747&&(o<4352||!(Hn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Hn["CJK Compatibility"](o)||Hn["CJK Strokes"](o)||!(!Hn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Hn["Enclosed CJK Letters and Months"](o)||Hn["Ideographic Description Characters"](o)||Hn.Kanbun(o)||Hn.Katakana(o)&&o!==12540||!(!Hn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Hn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Hn["Vertical Forms"](o)||Hn["Yijing Hexagram Symbols"](o)||/\p{sc=Cans}/u.test(String.fromCodePoint(o))||/\p{sc=Hang}/u.test(String.fromCodePoint(o))||Vh.test(String.fromCodePoint(o)))))}function Gh(o){return!(Uc(o)||function(i){return!!(Hn["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Hn["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Hn["Letterlike Symbols"](i)||Hn["Number Forms"](i)||Hn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Hn["Control Pictures"](i)&&i!==9251||Hn["Optical Character Recognition"](i)||Hn["Enclosed Alphanumerics"](i)||Hn["Geometric Shapes"](i)||Hn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Hn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Hn["CJK Symbols and Punctuation"](i)||Hn.Katakana(i)||Hn["Private Use Area"](i)||Hn["CJK Compatibility Forms"](i)||Hn["Small Form Variants"](i)||Hn["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}const cd=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function jc(o){return cd.test(String.fromCodePoint(o))}function hd(o,i){return!(!i&&jc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Hn.Khmer(o))}function fd(o){for(const i of o)if(jc(i.charCodeAt(0)))return!0;return!1}const Ss=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ei{constructor(i,u){this.zoom=i,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fc,this.transition={})}isSupportedScript(i){return function(u,g){for(const v of u)if(!hd(v.charCodeAt(0),g))return!1;return!0}(i,Ss.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,u=i-Math.floor(i),g=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*u}}}class il{constructor(i,u){this.property=i,this.value=u,this.expression=function(g,v){if(Zs(g))return new pe(g,v);if(b(g)){const E=K(g,v);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));return E.value}{let E=g;return v.type==="color"&&typeof g=="string"?E=ti.parse(g):v.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(g)&&(E=Ni.parse(g)):E=Fr.parse(g),{kind:"constant",evaluate:()=>E}}}(u===void 0?i.specification.default:u,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,u,g){return this.property.possiblyEvaluate(this,i,u,g)}}class wu{constructor(i){this.property=i,this.value=new il(i,void 0)}transitioned(i,u){return new Zh(this.property,this.value,u,ye({},i.transition,this.transition),i.now)}untransitioned(){return new Zh(this.property,this.value,null,{},0)}}class ku{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return we(this._values[i].value.value)}setValue(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new wu(this._values[i].property)),this._values[i].value=new il(this._values[i].property,u===null?void 0:we(u))}getTransition(i){return we(this._values[i].transition)}setTransition(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new wu(this._values[i].property)),this._values[i].transition=we(u)||void 0}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g);const v=this.getTransition(u);v!==void 0&&(i[`${u}-transition`]=v)}return i}transitioned(i,u){const g=new ql(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].transitioned(i,u._values[v]);return g}untransitioned(){const i=new ql(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].untransitioned();return i}}class Zh{constructor(i,u,g,v,E){this.property=i,this.value=u,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,i.specification.transition&&(v.delay||v.duration)&&(this.prior=g)}possiblyEvaluate(i,u,g){const v=i.now||0,E=this.value.possiblyEvaluate(i,u,g),A=this.prior;if(A){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return A.possiblyEvaluate(i,u,g);{const M=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(i,u,g),E,function(P){if(P<=0)return 0;if(P>=1)return 1;const F=P*P,j=F*P;return 4*(P<.5?j:3*(P-F)+j-.75)}(M))}}return E}}class ql{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,u,g){const v=new Gl(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Vl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return we(this._values[i].value)}setValue(i,u){this._values[i]=new il(this._values[i].property,u===null?void 0:we(u))}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g)}return i}possiblyEvaluate(i,u,g){const v=new Gl(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}}class co{constructor(i,u,g){this.property=i,this.value=u,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,u,g,v){return this.property.evaluate(this.value,this.parameters,i,u,g,v)}}class Gl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class nn{constructor(i){this.specification=i}possiblyEvaluate(i,u){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(u)}interpolate(i,u,g){const v=wi[this.specification.type];return v?v(i,u,g):i}}class yn{constructor(i,u){this.specification=i,this.overrides=u}possiblyEvaluate(i,u,g,v){return new co(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(u,null,{},g,v)}:i.expression,u)}interpolate(i,u,g){if(i.value.kind!=="constant"||u.value.kind!=="constant")return i;if(i.value.value===void 0||u.value.value===void 0)return new co(this,{kind:"constant",value:void 0},i.parameters);const v=wi[this.specification.type];if(v){const E=v(i.value.value,u.value.value,g);return new co(this,{kind:"constant",value:E},i.parameters)}return i}evaluate(i,u,g,v,E,A){return i.kind==="constant"?i.value:i.evaluate(u,g,v,E,A)}}class Iu extends yn{possiblyEvaluate(i,u,g,v){if(i.value===void 0)return new co(this,{kind:"constant",value:void 0},u);if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v),A=i.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,M=this._calculate(A,A,A,u);return new co(this,{kind:"constant",value:M},u)}if(i.expression.kind==="camera"){const E=this._calculate(i.expression.evaluate({zoom:u.zoom-1}),i.expression.evaluate({zoom:u.zoom}),i.expression.evaluate({zoom:u.zoom+1}),u);return new co(this,{kind:"constant",value:E},u)}return new co(this,i.expression,u)}evaluate(i,u,g,v,E,A){if(i.kind==="source"){const M=i.evaluate(u,g,v,E,A);return this._calculate(M,M,M,u)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(u.zoom)-1},g,v),i.evaluate({zoom:Math.floor(u.zoom)},g,v),i.evaluate({zoom:Math.floor(u.zoom)+1},g,v),u):i.value}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class Su{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){if(i.value!==void 0){if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v);return this._calculate(E,E,E,u)}return this._calculate(i.expression.evaluate(new Ei(Math.floor(u.zoom-1),u)),i.expression.evaluate(new Ei(Math.floor(u.zoom),u)),i.expression.evaluate(new Ei(Math.floor(u.zoom+1),u)),u)}}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class qc{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){return!!i.expression.evaluate(u,null,{},g,v)}interpolate(){return!1}}class k{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in i){const g=i[u];g.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new il(g,void 0),E=this.defaultTransitionablePropertyValues[u]=new wu(g);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate({})}}}Qt("DataDrivenProperty",yn),Qt("DataConstantProperty",nn),Qt("CrossFadedDataDrivenProperty",Iu),Qt("CrossFadedProperty",Su),Qt("ColorRampProperty",qc);const n="-transition";class f extends Lt{constructor(i,u){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),u.layout&&(this._unevaluatedLayout=new Vl(u.layout)),u.paint)){this._transitionablePaint=new ku(u.paint);for(const g in i.paint)this.setPaintProperty(g,i.paint[g],{validate:!1});for(const g in i.layout)this.setLayoutProperty(g,i.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gl(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,u,g={}){u!=null&&this._validate(jh,`layers.${this.id}.layout.${i}`,i,u,g)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,u):this.visibility=u)}getPaintProperty(i){return i.endsWith(n)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,u,g={}){if(u!=null&&this._validate(Uh,`layers.${this.id}.paint.${i}`,i,u,g))return!1;if(i.endsWith(n))return this._transitionablePaint.setTransition(i.slice(0,-11),u||void 0),!1;{const v=this._transitionablePaint._values[i],E=v.property.specification["property-type"]==="cross-faded-data-driven",A=v.value.isDataDriven(),M=v.value;this._transitionablePaint.setValue(i,u),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||A||E||this._handleOverridablePaintPropertyUpdate(i,M,P)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,u,g){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,u){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,u)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Ce(i,(u,g)=>!(u===void 0||g==="layout"&&!Object.keys(u).length||g==="paint"&&!Object.keys(u).length))}_validate(i,u,g,v,E={}){return(!E||E.validate!==!1)&&Nc(this,i.call(ka,{key:u,layerType:this.type,objectKey:g,value:v,styleSpec:Ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const u=this.paint.get(i);if(u instanceof co&&Ao(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const _={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class y{constructor(i,u){this._structArray=i,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class w{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,u){return i._trim(),u&&(i.isTransferred=!0,u.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const u=Object.create(this.prototype);return u.arrayBuffer=i.arrayBuffer,u.length=i.length,u.capacity=i.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function R(o,i=1){let u=0,g=0;return{members:o.map(v=>{const E=_[v.type].BYTES_PER_ELEMENT,A=u=D(u,Math.max(i,E)),M=v.components||1;return g=Math.max(g,E),u+=E*M,{name:v.name,type:v.type,components:M,offset:A}}),size:D(u,Math.max(g,i)),alignment:i}}function D(o,i){return Math.ceil(o/i)*i}class z extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.int16[v+0]=u,this.int16[v+1]=g,i}}z.prototype.bytesPerElement=4,Qt("StructArrayLayout2i4",z);class q extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.int16[E+0]=u,this.int16[E+1]=g,this.int16[E+2]=v,i}}q.prototype.bytesPerElement=6,Qt("StructArrayLayout3i6",q);class H extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const A=4*i;return this.int16[A+0]=u,this.int16[A+1]=g,this.int16[A+2]=v,this.int16[A+3]=E,i}}H.prototype.bytesPerElement=8,Qt("StructArrayLayout4i8",H);class X extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=6*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.int16[P+2]=v,this.int16[P+3]=E,this.int16[P+4]=A,this.int16[P+5]=M,i}}X.prototype.bytesPerElement=12,Qt("StructArrayLayout2i4i12",X);class ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=4*i,F=8*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.uint8[F+4]=v,this.uint8[F+5]=E,this.uint8[F+6]=A,this.uint8[F+7]=M,i}}ne.prototype.bytesPerElement=8,Qt("StructArrayLayout2i4ub8",ne);class me extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.float32[v+0]=u,this.float32[v+1]=g,i}}me.prototype.bytesPerElement=8,Qt("StructArrayLayout2f8",me);class Ie extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j){const Z=this.length;return this.resize(Z+1),this.emplace(Z,i,u,g,v,E,A,M,P,F,j)}emplace(i,u,g,v,E,A,M,P,F,j,Z){const W=10*i;return this.uint16[W+0]=u,this.uint16[W+1]=g,this.uint16[W+2]=v,this.uint16[W+3]=E,this.uint16[W+4]=A,this.uint16[W+5]=M,this.uint16[W+6]=P,this.uint16[W+7]=F,this.uint16[W+8]=j,this.uint16[W+9]=Z,i}}Ie.prototype.bytesPerElement=20,Qt("StructArrayLayout10ui20",Ie);class Me extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,Z,W){const te=this.length;return this.resize(te+1),this.emplace(te,i,u,g,v,E,A,M,P,F,j,Z,W)}emplace(i,u,g,v,E,A,M,P,F,j,Z,W,te){const oe=12*i;return this.int16[oe+0]=u,this.int16[oe+1]=g,this.int16[oe+2]=v,this.int16[oe+3]=E,this.uint16[oe+4]=A,this.uint16[oe+5]=M,this.uint16[oe+6]=P,this.uint16[oe+7]=F,this.int16[oe+8]=j,this.int16[oe+9]=Z,this.int16[oe+10]=W,this.int16[oe+11]=te,i}}Me.prototype.bytesPerElement=24,Qt("StructArrayLayout4i4ui4i24",Me);class Ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.float32[E+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}Ne.prototype.bytesPerElement=12,Qt("StructArrayLayout3f12",Ne);class Fe extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint32[1*i+0]=u,i}}Fe.prototype.bytesPerElement=4,Qt("StructArrayLayout1ul4",Fe);class je extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F){const j=this.length;return this.resize(j+1),this.emplace(j,i,u,g,v,E,A,M,P,F)}emplace(i,u,g,v,E,A,M,P,F,j){const Z=10*i,W=5*i;return this.int16[Z+0]=u,this.int16[Z+1]=g,this.int16[Z+2]=v,this.int16[Z+3]=E,this.int16[Z+4]=A,this.int16[Z+5]=M,this.uint32[W+3]=P,this.uint16[Z+8]=F,this.uint16[Z+9]=j,i}}je.prototype.bytesPerElement=20,Qt("StructArrayLayout6i1ul2ui20",je);class Te extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=6*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.int16[P+2]=v,this.int16[P+3]=E,this.int16[P+4]=A,this.int16[P+5]=M,i}}Te.prototype.bytesPerElement=12,Qt("StructArrayLayout2i2i2i12",Te);class He extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,g,v,E)}emplace(i,u,g,v,E,A){const M=4*i,P=8*i;return this.float32[M+0]=u,this.float32[M+1]=g,this.float32[M+2]=v,this.int16[P+6]=E,this.int16[P+7]=A,i}}He.prototype.bytesPerElement=16,Qt("StructArrayLayout2f1f2i16",He);class Qe extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=16*i,F=4*i,j=8*i;return this.uint8[P+0]=u,this.uint8[P+1]=g,this.float32[F+1]=v,this.float32[F+2]=E,this.int16[j+6]=A,this.int16[j+7]=M,i}}Qe.prototype.bytesPerElement=16,Qt("StructArrayLayout2ub2f2i16",Qe);class at extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[E+0]=u,this.uint16[E+1]=g,this.uint16[E+2]=v,i}}at.prototype.bytesPerElement=6,Qt("StructArrayLayout3ui6",at);class wt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,Z,W,te,oe,de,Le,De){const it=this.length;return this.resize(it+1),this.emplace(it,i,u,g,v,E,A,M,P,F,j,Z,W,te,oe,de,Le,De)}emplace(i,u,g,v,E,A,M,P,F,j,Z,W,te,oe,de,Le,De,it){const Ge=24*i,et=12*i,ft=48*i;return this.int16[Ge+0]=u,this.int16[Ge+1]=g,this.uint16[Ge+2]=v,this.uint16[Ge+3]=E,this.uint32[et+2]=A,this.uint32[et+3]=M,this.uint32[et+4]=P,this.uint16[Ge+10]=F,this.uint16[Ge+11]=j,this.uint16[Ge+12]=Z,this.float32[et+7]=W,this.float32[et+8]=te,this.uint8[ft+36]=oe,this.uint8[ft+37]=de,this.uint8[ft+38]=Le,this.uint32[et+10]=De,this.int16[Ge+22]=it,i}}wt.prototype.bytesPerElement=48,Qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",wt);class Dt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,Z,W,te,oe,de,Le,De,it,Ge,et,ft,Et,Wt,_n,Ht,Gt,an,tn){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,i,u,g,v,E,A,M,P,F,j,Z,W,te,oe,de,Le,De,it,Ge,et,ft,Et,Wt,_n,Ht,Gt,an,tn)}emplace(i,u,g,v,E,A,M,P,F,j,Z,W,te,oe,de,Le,De,it,Ge,et,ft,Et,Wt,_n,Ht,Gt,an,tn,Yt){const vt=32*i,cn=16*i;return this.int16[vt+0]=u,this.int16[vt+1]=g,this.int16[vt+2]=v,this.int16[vt+3]=E,this.int16[vt+4]=A,this.int16[vt+5]=M,this.int16[vt+6]=P,this.int16[vt+7]=F,this.uint16[vt+8]=j,this.uint16[vt+9]=Z,this.uint16[vt+10]=W,this.uint16[vt+11]=te,this.uint16[vt+12]=oe,this.uint16[vt+13]=de,this.uint16[vt+14]=Le,this.uint16[vt+15]=De,this.uint16[vt+16]=it,this.uint16[vt+17]=Ge,this.uint16[vt+18]=et,this.uint16[vt+19]=ft,this.uint16[vt+20]=Et,this.uint16[vt+21]=Wt,this.uint16[vt+22]=_n,this.uint32[cn+12]=Ht,this.float32[cn+13]=Gt,this.float32[cn+14]=an,this.uint16[vt+30]=tn,this.uint16[vt+31]=Yt,i}}Dt.prototype.bytesPerElement=64,Qt("StructArrayLayout8i15ui1ul2f2ui64",Dt);class Zt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.float32[1*i+0]=u,i}}Zt.prototype.bytesPerElement=4,Qt("StructArrayLayout1f4",Zt);class Kt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[6*i+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}Kt.prototype.bytesPerElement=12,Qt("StructArrayLayout1ui2f12",Kt);class qt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=4*i;return this.uint32[2*i+0]=u,this.uint16[E+2]=g,this.uint16[E+3]=v,i}}qt.prototype.bytesPerElement=8,Qt("StructArrayLayout1ul2ui8",qt);class jt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.uint16[v+0]=u,this.uint16[v+1]=g,i}}jt.prototype.bytesPerElement=4,Qt("StructArrayLayout2ui4",jt);class rn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint16[1*i+0]=u,i}}rn.prototype.bytesPerElement=2,Qt("StructArrayLayout1ui2",rn);class Sn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const A=4*i;return this.float32[A+0]=u,this.float32[A+1]=g,this.float32[A+2]=v,this.float32[A+3]=E,i}}Sn.prototype.bytesPerElement=16,Qt("StructArrayLayout4f16",Sn);class Vt extends y{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}Vt.prototype.size=20;class Xt extends je{get(i){return new Vt(this,i)}}Qt("CollisionBoxArray",Xt);class wn extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}wn.prototype.size=48;class Ai extends wt{get(i){return new wn(this,i)}}Qt("PlacedSymbolArray",Ai);class Bn extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Bn.prototype.size=64;class Vn extends Dt{get(i){return new Bn(this,i)}}Qt("SymbolInstanceArray",Vn);class Ti extends Zt{getoffsetX(i){return this.float32[1*i+0]}}Qt("GlyphOffsetArray",Ti);class Or extends q{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Qt("SymbolLineVertexArray",Or);class Xs extends y{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Xs.prototype.size=12;class Ci extends Kt{get(i){return new Xs(this,i)}}Qt("TextAnchorOffsetArray",Ci);class cs extends y{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}cs.prototype.size=8;class Yr extends qt{get(i){return new cs(this,i)}}Qt("FeatureIndexArray",Yr);class Br extends z{}class Jr extends z{}class ho extends z{}class rl extends X{}class Eu extends ne{}class sl extends me{}class Fs extends Ie{}class Au extends Me{}class Vc extends Ne{}class Os extends Fe{}class Bs extends Te{}class Qo extends Qe{}class Ws extends at{}class Pr extends jt{}const Ur=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:Es}=Ur;class Xn{constructor(i=[]){this.segments=i}prepareSegment(i,u,g,v){let E=this.segments[this.segments.length-1];return i>Xn.MAX_VERTEX_ARRAY_LENGTH&&tt(`Max vertices per segment is ${Xn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!E||E.vertexLength+i>Xn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v)&&(E={vertexOffset:u.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0},v!==void 0&&(E.sortKey=v),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const i of this.segments)for(const u in i.vaos)i.vaos[u].destroy()}static simpleSegment(i,u,g,v){return new Xn([{vertexOffset:i,primitiveOffset:u,vertexLength:g,primitiveLength:v,vaos:{},sortKey:0}])}}function Ia(o,i){return 256*(o=xe(Math.floor(o),0,255))+xe(Math.floor(i),0,255)}Xn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt("SegmentVector",Xn);const ol=R([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var al={exports:{}},Hh={exports:{}};Hh.exports=function(o,i){var u,g,v,E,A,M,P,F;for(g=o.length-(u=3&o.length),v=i,A=3432918353,M=461845907,F=0;F<g;)P=255&o.charCodeAt(F)|(255&o.charCodeAt(++F))<<8|(255&o.charCodeAt(++F))<<16|(255&o.charCodeAt(++F))<<24,++F,v=27492+(65535&(E=5*(65535&(v=(v^=P=(65535&(P=(P=(65535&P)*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(P=0,u){case 3:P^=(255&o.charCodeAt(F+2))<<16;case 2:P^=(255&o.charCodeAt(F+1))<<8;case 1:v^=P=(65535&(P=(P=(65535&(P^=255&o.charCodeAt(F)))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var dd=Hh.exports,Xh={exports:{}};Xh.exports=function(o,i){for(var u,g=o.length,v=i^g,E=0;g>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(u>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),g-=4,++E;switch(g){case 3:v^=(255&o.charCodeAt(E+2))<<16;case 2:v^=(255&o.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var ea=dd,Wh=Xh.exports;al.exports=ea,al.exports.murmur3=ea,al.exports.murmur2=Wh;var Tu=x(al.exports);class Zl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,u,g,v){this.ids.push(Cu(i)),this.positions.push(u,g,v)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Cu(i);let g=0,v=this.ids.length-1;for(;g<v;){const A=g+v>>1;this.ids[A]>=u?v=A:g=A+1}const E=[];for(;this.ids[g]===u;)E.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return E}static serialize(i,u){const g=new Float64Array(i.ids),v=new Uint32Array(i.positions);return Lu(g,v,0,g.length-1),u&&u.push(g.buffer,v.buffer),{ids:g,positions:v}}static deserialize(i){const u=new Zl;return u.ids=i.ids,u.positions=i.positions,u.indexed=!0,u}}function Cu(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Tu(String(o))}function Lu(o,i,u,g){for(;u<g;){const v=o[u+g>>1];let E=u-1,A=g+1;for(;;){do E++;while(o[E]<v);do A--;while(o[A]>v);if(E>=A)break;ll(o,E,A),ll(i,3*E,3*A),ll(i,3*E+1,3*A+1),ll(i,3*E+2,3*A+2)}A-u<g-A?(Lu(o,i,u,A),u=A+1):(Lu(o,i,A+1,g),g=A)}}function ll(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}Qt("FeaturePositionMap",Zl);class Hl{constructor(i,u){this.gl=i.gl,this.location=u}}class Kh extends Hl{constructor(i,u){super(i,u),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class om extends Hl{constructor(i,u){super(i,u),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class am extends Hl{constructor(i,u){super(i,u),this.current=ti.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const u1=new Float32Array(16);function pd(o){return[Ia(255*o.r,255*o.g),Ia(255*o.b,255*o.a)]}class Gc{constructor(i,u,g){this.value=i,this.uniformNames=u.map(v=>`u_${v}`),this.type=g}setUniform(i,u,g){i.set(g.constantOr(this.value))}getBinding(i,u,g){return this.type==="color"?new am(i,u):new Kh(i,u)}}class Mu{constructor(i,u){this.uniformNames=u.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=i.tlbr}setUniform(i,u,g,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&i.set(E)}getBinding(i,u,g){return g.substr(0,9)==="u_pattern"?new om(i,u):new Kh(i,u)}}class Sa{constructor(i,u,g,v){this.expression=i,this.type=g,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,u,g,v,E){const A=this.paintVertexArray.length,M=this.expression.evaluate(new Ei(0),u,{},v,[],E);this.paintVertexArray.resize(i),this._setPaintValue(A,i,M)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:0},g,v);this._setPaintValue(i,u,E)}_setPaintValue(i,u,g){if(this.type==="color"){const v=pd(g);for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=i;v<u;v++)this.paintVertexArray.emplace(v,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class To{constructor(i,u,g,v,E,A){this.expression=i,this.uniformNames=u.map(M=>`u_${M}_t`),this.type=g,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(M=>({name:`a_${M}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new A}populatePaintArray(i,u,g,v,E){const A=this.expression.evaluate(new Ei(this.zoom),u,{},v,[],E),M=this.expression.evaluate(new Ei(this.zoom+1),u,{},v,[],E),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,A,M)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:this.zoom},g,v),A=this.expression.evaluate({zoom:this.zoom+1},g,v);this._setPaintValue(i,u,E,A)}_setPaintValue(i,u,g,v){if(this.type==="color"){const E=pd(g),A=pd(v);for(let M=i;M<u;M++)this.paintVertexArray.emplace(M,E[0],E[1],A[0],A[1])}else{for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,g,v);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(v))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,u){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=xe(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(v)}getBinding(i,u,g){return new Kh(i,u)}}class ul{constructor(i,u,g,v,E,A){this.expression=i,this.type=u,this.useIntegerZoom=g,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(i,u,g){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(v,i,u.patterns&&u.patterns[this.layerId],g)}updatePaintArray(i,u,g,v,E){this._setPaintValues(i,u,g.patterns&&g.patterns[this.layerId],E)}_setPaintValues(i,u,g,v){if(!v||!g)return;const{min:E,mid:A,max:M}=g,P=v[E],F=v[A],j=v[M];if(P&&F&&j)for(let Z=i;Z<u;Z++)this.zoomInPaintVertexArray.emplace(Z,F.tl[0],F.tl[1],F.br[0],F.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],F.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(Z,F.tl[0],F.tl[1],F.br[0],F.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],F.pixelRatio,j.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,ol.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,ol.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lm{constructor(i,u,g){this.binders={},this._buffers=[];const v=[];for(const E in i.paint._values){if(!g(E))continue;const A=i.paint.get(E);if(!(A instanceof co&&Ao(A.property.specification)))continue;const M=c1(E,i.type),P=A.value,F=A.property.specification.type,j=A.property.useIntegerZoom,Z=A.property.specification["property-type"],W=Z==="cross-faded"||Z==="cross-faded-data-driven";if(P.kind==="constant")this.binders[E]=W?new Mu(P.value,M):new Gc(P.value,M,F),v.push(`/u_${E}`);else if(P.kind==="source"||W){const te=um(E,F,"source");this.binders[E]=W?new ul(P,F,j,u,te,i.id):new Sa(P,M,F,te),v.push(`/a_${E}`)}else{const te=um(E,F,"composite");this.binders[E]=new To(P,M,F,j,u,te),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(i){const u=this.binders[i];return u instanceof Sa||u instanceof To?u.maxValue:0}populatePaintArrays(i,u,g,v,E){for(const A in this.binders){const M=this.binders[A];(M instanceof Sa||M instanceof To||M instanceof ul)&&M.populatePaintArray(i,u,g,v,E)}}setConstantPatternPositions(i,u){for(const g in this.binders){const v=this.binders[g];v instanceof Mu&&v.setConstantPatternPositions(i,u)}}updatePaintArrays(i,u,g,v,E){let A=!1;for(const M in i){const P=u.getPositions(M);for(const F of P){const j=g.feature(F.index);for(const Z in this.binders){const W=this.binders[Z];if((W instanceof Sa||W instanceof To||W instanceof ul)&&W.expression.isStateDependent===!0){const te=v.paint.get(Z);W.expression=te.value,W.updatePaintArray(F.start,F.end,j,i[M],E),A=!0}}}}return A}defines(){const i=[];for(const u in this.binders){const g=this.binders[u];(g instanceof Gc||g instanceof Mu)&&i.push(...g.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return i}getBinderAttributes(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Sa||g instanceof To)for(let v=0;v<g.paintVertexAttributes.length;v++)i.push(g.paintVertexAttributes[v].name);else if(g instanceof ul)for(let v=0;v<ol.members.length;v++)i.push(ol.members[v].name)}return i}getBinderUniforms(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Gc||g instanceof Mu||g instanceof To)for(const v of g.uniformNames)i.push(v)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,u){const g=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof Gc||E instanceof Mu||E instanceof To){for(const A of E.uniformNames)if(u[A]){const M=E.getBinding(i,u[A],A);g.push({name:A,property:v,binding:M})}}}return g}setUniforms(i,u,g,v){for(const{name:E,property:A,binding:M}of u)this.binders[A].setUniform(M,v,g.get(A),E)}updatePaintBuffers(i){this._buffers=[];for(const u in this.binders){const g=this.binders[u];if(i&&g instanceof ul){const v=i.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(g instanceof Sa||g instanceof To)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(i){for(const u in this.binders){const g=this.binders[u];(g instanceof Sa||g instanceof To||g instanceof ul)&&g.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const u=this.binders[i];(u instanceof Sa||u instanceof To||u instanceof ul)&&u.destroy()}}}class Xl{constructor(i,u,g=()=>!0){this.programConfigurations={};for(const v of i)this.programConfigurations[v.id]=new lm(v,u,g);this.needsUpload=!1,this._featureMap=new Zl,this._bufferOffset=0}populatePaintArrays(i,u,g,v,E,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,u,v,E,A);u.id!==void 0&&this._featureMap.add(u.id,g,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,u,g,v){for(const E of g)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,u,E,v)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function c1(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function um(o,i,u){const g={color:{source:me,composite:Sn},number:{source:Zt,composite:me}},v=function(E){return{"line-pattern":{source:Fs,composite:Fs},"fill-pattern":{source:Fs,composite:Fs},"fill-extrusion-pattern":{source:Fs,composite:Fs}}[E]}(o);return v&&v[u]||g[i][u]}Qt("ConstantBinder",Gc),Qt("CrossFadedConstantBinder",Mu),Qt("SourceExpressionBinder",Sa),Qt("CrossFadedCompositeBinder",ul),Qt("CompositeExpressionBinder",To),Qt("ProgramConfiguration",lm,{omit:["_buffers"]}),Qt("ProgramConfigurationSet",Xl);const ar=8192,md=Math.pow(2,14)-1,cm=-md-1;function Wl(o){const i=ar/o.extent,u=o.loadGeometry();for(let g=0;g<u.length;g++){const v=u[g];for(let E=0;E<v.length;E++){const A=v[E],M=Math.round(A.x*i),P=Math.round(A.y*i);A.x=xe(M,cm,md),A.y=xe(P,cm,md),(M<A.x||M>A.x+1||P<A.y||P>A.y+1)&&tt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Kl(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Wl(o):[]}}function $h(o,i,u,g,v){o.emplaceBack(2*i+(g+1)/2,2*u+(v+1)/2)}class gd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Jr,this.indexArray=new Ws,this.segments=new Xn,this.programConfigurations=new Xl(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){const v=this.layers[0],E=[];let A=null,M=!1;v.type==="circle"&&(A=v.layout.get("circle-sort-key"),M=!A.isConstant());for(const{feature:P,id:F,index:j,sourceLayerIndex:Z}of i){const W=this.layers[0]._featureFilter.needGeometry,te=Kl(P,W);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),te,g))continue;const oe=M?A.evaluate(te,{},g):void 0,de={id:F,properties:P.properties,type:P.type,sourceLayerIndex:Z,index:j,geometry:W?te.geometry:Wl(P),patterns:{},sortKey:oe};E.push(de)}M&&E.sort((P,F)=>P.sortKey-F.sortKey);for(const P of E){const{geometry:F,index:j,sourceLayerIndex:Z}=P,W=i[j].feature;this.addFeature(P,F,j,g),u.featureIndex.insert(W,F,j,Z,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Es),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,u,g,v){for(const E of u)for(const A of E){const M=A.x,P=A.y;if(M<0||M>=ar||P<0||P>=ar)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),j=F.vertexLength;$h(this.layoutVertexArray,M,P,-1,-1),$h(this.layoutVertexArray,M,P,1,-1),$h(this.layoutVertexArray,M,P,1,1),$h(this.layoutVertexArray,M,P,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,{},v)}}function hm(o,i){for(let u=0;u<o.length;u++)if(Ru(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(Ru(o,i[u]))return!0;return!!_d(o,i)}function h1(o,i,u){return!!Ru(o,i)||!!yd(i,o,u)}function fm(o,i){if(o.length===1)return pm(i,o[0]);for(let u=0;u<i.length;u++){const g=i[u];for(let v=0;v<g.length;v++)if(Ru(o,g[v]))return!0}for(let u=0;u<o.length;u++)if(pm(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(_d(o,i[u]))return!0;return!1}function f1(o,i,u){if(o.length>1){if(_d(o,i))return!0;for(let g=0;g<i.length;g++)if(yd(i[g],o,u))return!0}for(let g=0;g<o.length;g++)if(yd(o[g],i,u))return!0;return!1}function _d(o,i){if(o.length===0||i.length===0)return!1;for(let u=0;u<o.length-1;u++){const g=o[u],v=o[u+1];for(let E=0;E<i.length-1;E++)if(d1(g,v,i[E],i[E+1]))return!0}return!1}function d1(o,i,u,g){return Ve(o,u,g)!==Ve(i,u,g)&&Ve(o,i,u)!==Ve(o,i,g)}function yd(o,i,u){const g=u*u;if(i.length===1)return o.distSqr(i[0])<g;for(let v=1;v<i.length;v++)if(dm(o,i[v-1],i[v])<g)return!0;return!1}function dm(o,i,u){const g=i.distSqr(u);if(g===0)return o.distSqr(i);const v=((o.x-i.x)*(u.x-i.x)+(o.y-i.y)*(u.y-i.y))/g;return o.distSqr(v<0?i:v>1?u:u.sub(i)._mult(v)._add(i))}function pm(o,i){let u,g,v,E=!1;for(let A=0;A<o.length;A++){u=o[A];for(let M=0,P=u.length-1;M<u.length;P=M++)g=u[M],v=u[P],g.y>i.y!=v.y>i.y&&i.x<(v.x-g.x)*(i.y-g.y)/(v.y-g.y)+g.x&&(E=!E)}return E}function Ru(o,i){let u=!1;for(let g=0,v=o.length-1;g<o.length;v=g++){const E=o[g],A=o[v];E.y>i.y!=A.y>i.y&&i.x<(A.x-E.x)*(i.y-E.y)/(A.y-E.y)+E.x&&(u=!u)}return u}function p1(o,i,u){const g=u[0],v=u[2];if(o.x<g.x&&i.x<g.x||o.x>v.x&&i.x>v.x||o.y<g.y&&i.y<g.y||o.y>v.y&&i.y>v.y)return!1;const E=Ve(o,i,u[0]);return E!==Ve(o,i,u[1])||E!==Ve(o,i,u[2])||E!==Ve(o,i,u[3])}function Zc(o,i,u){const g=i.paint.get(o).value;return g.kind==="constant"?g.value:u.programConfigurations.get(i.id).getMaxValue(o)}function Yh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Jh(o,i,u,g,v){if(!i[0]&&!i[1])return o;const E=C.convert(i)._mult(v);u==="viewport"&&E._rotate(-g);const A=[];for(let M=0;M<o.length;M++)A.push(o[M].sub(E));return A}let mm,gm;Qt("CircleBucket",gd,{omit:["layers"]});var m1={get paint(){return gm=gm||new k({"circle-radius":new yn(Ke.paint_circle["circle-radius"]),"circle-color":new yn(Ke.paint_circle["circle-color"]),"circle-blur":new yn(Ke.paint_circle["circle-blur"]),"circle-opacity":new yn(Ke.paint_circle["circle-opacity"]),"circle-translate":new nn(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new nn(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nn(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nn(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(Ke.paint_circle["circle-stroke-opacity"])})},get layout(){return mm=mm||new k({"circle-sort-key":new yn(Ke.layout_circle["circle-sort-key"])})}},hs=1e-6,Pu=typeof Float32Array<"u"?Float32Array:Array;function vd(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function _m(o,i,u){var g=i[0],v=i[1],E=i[2],A=i[3],M=i[4],P=i[5],F=i[6],j=i[7],Z=i[8],W=i[9],te=i[10],oe=i[11],de=i[12],Le=i[13],De=i[14],it=i[15],Ge=u[0],et=u[1],ft=u[2],Et=u[3];return o[0]=Ge*g+et*M+ft*Z+Et*de,o[1]=Ge*v+et*P+ft*W+Et*Le,o[2]=Ge*E+et*F+ft*te+Et*De,o[3]=Ge*A+et*j+ft*oe+Et*it,o[4]=(Ge=u[4])*g+(et=u[5])*M+(ft=u[6])*Z+(Et=u[7])*de,o[5]=Ge*v+et*P+ft*W+Et*Le,o[6]=Ge*E+et*F+ft*te+Et*De,o[7]=Ge*A+et*j+ft*oe+Et*it,o[8]=(Ge=u[8])*g+(et=u[9])*M+(ft=u[10])*Z+(Et=u[11])*de,o[9]=Ge*v+et*P+ft*W+Et*Le,o[10]=Ge*E+et*F+ft*te+Et*De,o[11]=Ge*A+et*j+ft*oe+Et*it,o[12]=(Ge=u[12])*g+(et=u[13])*M+(ft=u[14])*Z+(Et=u[15])*de,o[13]=Ge*v+et*P+ft*W+Et*Le,o[14]=Ge*E+et*F+ft*te+Et*De,o[15]=Ge*A+et*j+ft*oe+Et*it,o}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var Hc,g1=_m;function Qh(o,i,u){var g=i[0],v=i[1],E=i[2],A=i[3];return o[0]=u[0]*g+u[4]*v+u[8]*E+u[12]*A,o[1]=u[1]*g+u[5]*v+u[9]*E+u[13]*A,o[2]=u[2]*g+u[6]*v+u[10]*E+u[14]*A,o[3]=u[3]*g+u[7]*v+u[11]*E+u[15]*A,o}Hc=new Pu(4),Pu!=Float32Array&&(Hc[0]=0,Hc[1]=0,Hc[2]=0,Hc[3]=0);class _1 extends f{constructor(i){super(i,m1)}createBucket(i){return new gd(i)}queryRadius(i){const u=i;return Zc("circle-radius",this,u)+Zc("circle-stroke-width",this,u)+Yh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M,P){const F=Jh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,M),j=this.paint.get("circle-radius").evaluate(u,g)+this.paint.get("circle-stroke-width").evaluate(u,g),Z=this.paint.get("circle-pitch-alignment")==="map",W=Z?F:function(oe,de){return oe.map(Le=>ym(Le,de))}(F,P),te=Z?j*M:j;for(const oe of v)for(const de of oe){const Le=Z?de:ym(de,P);let De=te;const it=Qh([],[de.x,de.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?De*=it[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(De*=A.cameraToCenterDistance/it[3]),h1(W,Le,De))return!0}return!1}}function ym(o,i){const u=Qh([],[o.x,o.y,0,1],i);return new C(u[0]/u[3],u[1]/u[3])}class vm extends gd{}let bm;Qt("HeatmapBucket",vm,{omit:["layers"]});var y1={get paint(){return bm=bm||new k({"heatmap-radius":new yn(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nn(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qc(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nn(Ke.paint_heatmap["heatmap-opacity"])})}};function bd(o,{width:i,height:u},g,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==i*u*g)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${i*u*g}`)}else v=new Uint8Array(i*u*g);return o.width=i,o.height=u,o.data=v,o}function xm(o,{width:i,height:u},g){if(i===o.width&&u===o.height)return;const v=bd({},{width:i,height:u},g);xd(o,v,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,u)},g),o.width=i,o.height=u,o.data=v.data}function xd(o,i,u,g,v,E){if(v.width===0||v.height===0)return i;if(v.width>o.width||v.height>o.height||u.x>o.width-v.width||u.y>o.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>i.width||v.height>i.height||g.x>i.width-v.width||g.y>i.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const A=o.data,M=i.data;if(A===M)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<v.height;P++){const F=((u.y+P)*o.width+u.x)*E,j=((g.y+P)*i.width+g.x)*E;for(let Z=0;Z<v.width*E;Z++)M[j+Z]=A[F+Z]}return i}class Xc{constructor(i,u){bd(this,i,1,u)}resize(i){xm(this,i,1)}clone(){return new Xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){xd(i,u,g,v,E,1)}}class Ks{constructor(i,u){bd(this,i,4,u)}resize(i){xm(this,i,4)}replace(i,u){u?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){xd(i,u,g,v,E,4)}}function wm(o){const i={},u=o.resolution||256,g=o.clips?o.clips.length:1,v=o.image||new Ks({width:u,height:g});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const E=(A,M,P)=>{i[o.evaluationKey]=P;const F=o.expression.evaluate(i);v.data[A+M+0]=Math.floor(255*F.r/F.a),v.data[A+M+1]=Math.floor(255*F.g/F.a),v.data[A+M+2]=Math.floor(255*F.b/F.a),v.data[A+M+3]=Math.floor(255*F.a)};if(o.clips)for(let A=0,M=0;A<g;++A,M+=4*u)for(let P=0,F=0;P<u;P++,F+=4){const j=P/(u-1),{start:Z,end:W}=o.clips[A];E(M,F,Z*(1-j)+W*j)}else for(let A=0,M=0;A<u;A++,M+=4)E(0,M,A/(u-1));return v}Qt("AlphaImage",Xc),Qt("RGBAImage",Ks);const wd="big-fb";class v1 extends f{createBucket(i){return new vm(i)}constructor(i){super(i,y1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(wd)&&this.heatmapFbos.delete(wd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let km;var b1={get paint(){return km=km||new k({"hillshade-illumination-direction":new nn(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nn(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nn(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nn(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nn(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nn(Ke.paint_hillshade["hillshade-accent-color"])})}};class x1 extends f{constructor(i){super(i,b1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const w1=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:k1}=w1;function Im(o,i,u=2){const g=i&&i.length,v=g?i[0]*u:o.length;let E=Sm(o,0,v,u,!0);const A=[];if(!E||E.next===E.prev)return A;let M,P,F;if(g&&(E=function(j,Z,W,te){const oe=[];for(let de=0,Le=Z.length;de<Le;de++){const De=Sm(j,Z[de]*te,de<Le-1?Z[de+1]*te:j.length,te,!1);De===De.next&&(De.steiner=!0),oe.push(M1(De))}oe.sort(T1);for(let de=0;de<oe.length;de++)W=C1(oe[de],W);return W}(o,i,E,u)),o.length>80*u){M=1/0,P=1/0;let j=-1/0,Z=-1/0;for(let W=u;W<v;W+=u){const te=o[W],oe=o[W+1];te<M&&(M=te),oe<P&&(P=oe),te>j&&(j=te),oe>Z&&(Z=oe)}F=Math.max(j-M,Z-P),F=F!==0?32767/F:0}return Wc(E,A,u,M,P,F,0),A}function Sm(o,i,u,g,v){let E;if(v===function(A,M,P,F){let j=0;for(let Z=M,W=P-F;Z<P;Z+=F)j+=(A[W]-A[Z])*(A[Z+1]+A[W+1]),W=Z;return j}(o,i,u,g)>0)for(let A=i;A<u;A+=g)E=Tm(A/g|0,o[A],o[A+1],E);else for(let A=u-g;A>=i;A-=g)E=Tm(A/g|0,o[A],o[A+1],E);return E&&ef(E,E.next)&&($c(E),E=E.next),E}function $l(o,i){if(!o)return o;i||(i=o);let u,g=o;do if(u=!1,g.steiner||!ef(g,g.next)&&ir(g.prev,g,g.next)!==0)g=g.next;else{if($c(g),g=i=g.prev,g===g.next)break;u=!0}while(u||g!==i);return i}function Wc(o,i,u,g,v,E,A){if(!o)return;!A&&E&&function(P,F,j,Z){let W=P;do W.z===0&&(W.z=kd(W.x,W.y,F,j,Z)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==P);W.prevZ.nextZ=null,W.prevZ=null,function(te){let oe,de=1;do{let Le,De=te;te=null;let it=null;for(oe=0;De;){oe++;let Ge=De,et=0;for(let Et=0;Et<de&&(et++,Ge=Ge.nextZ,Ge);Et++);let ft=de;for(;et>0||ft>0&&Ge;)et!==0&&(ft===0||!Ge||De.z<=Ge.z)?(Le=De,De=De.nextZ,et--):(Le=Ge,Ge=Ge.nextZ,ft--),it?it.nextZ=Le:te=Le,Le.prevZ=it,it=Le;De=Ge}it.nextZ=null,de*=2}while(oe>1)}(W)}(o,g,v,E);let M=o;for(;o.prev!==o.next;){const P=o.prev,F=o.next;if(E?S1(o,g,v,E):I1(o))i.push(P.i,o.i,F.i),$c(o),o=F.next,M=F.next;else if((o=F)===M){A?A===1?Wc(o=E1($l(o),i),i,u,g,v,E,2):A===2&&A1(o,i,u,g,v,E):Wc($l(o),i,u,g,v,E,1);break}}}function I1(o){const i=o.prev,u=o,g=o.next;if(ir(i,u,g)>=0)return!1;const v=i.x,E=u.x,A=g.x,M=i.y,P=u.y,F=g.y,j=v<E?v<A?v:A:E<A?E:A,Z=M<P?M<F?M:F:P<F?P:F,W=v>E?v>A?v:A:E>A?E:A,te=M>P?M>F?M:F:P>F?P:F;let oe=g.next;for(;oe!==i;){if(oe.x>=j&&oe.x<=W&&oe.y>=Z&&oe.y<=te&&Du(v,M,E,P,A,F,oe.x,oe.y)&&ir(oe.prev,oe,oe.next)>=0)return!1;oe=oe.next}return!0}function S1(o,i,u,g){const v=o.prev,E=o,A=o.next;if(ir(v,E,A)>=0)return!1;const M=v.x,P=E.x,F=A.x,j=v.y,Z=E.y,W=A.y,te=M<P?M<F?M:F:P<F?P:F,oe=j<Z?j<W?j:W:Z<W?Z:W,de=M>P?M>F?M:F:P>F?P:F,Le=j>Z?j>W?j:W:Z>W?Z:W,De=kd(te,oe,i,u,g),it=kd(de,Le,i,u,g);let Ge=o.prevZ,et=o.nextZ;for(;Ge&&Ge.z>=De&&et&&et.z<=it;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=oe&&Ge.y<=Le&&Ge!==v&&Ge!==A&&Du(M,j,P,Z,F,W,Ge.x,Ge.y)&&ir(Ge.prev,Ge,Ge.next)>=0||(Ge=Ge.prevZ,et.x>=te&&et.x<=de&&et.y>=oe&&et.y<=Le&&et!==v&&et!==A&&Du(M,j,P,Z,F,W,et.x,et.y)&&ir(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;Ge&&Ge.z>=De;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=oe&&Ge.y<=Le&&Ge!==v&&Ge!==A&&Du(M,j,P,Z,F,W,Ge.x,Ge.y)&&ir(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.prevZ}for(;et&&et.z<=it;){if(et.x>=te&&et.x<=de&&et.y>=oe&&et.y<=Le&&et!==v&&et!==A&&Du(M,j,P,Z,F,W,et.x,et.y)&&ir(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function E1(o,i){let u=o;do{const g=u.prev,v=u.next.next;!ef(g,v)&&Em(g,u,u.next,v)&&Kc(g,v)&&Kc(v,g)&&(i.push(g.i,u.i,v.i),$c(u),$c(u.next),u=o=v),u=u.next}while(u!==o);return $l(u)}function A1(o,i,u,g,v,E){let A=o;do{let M=A.next.next;for(;M!==A.prev;){if(A.i!==M.i&&R1(A,M)){let P=Am(A,M);return A=$l(A,A.next),P=$l(P,P.next),Wc(A,i,u,g,v,E,0),void Wc(P,i,u,g,v,E,0)}M=M.next}A=A.next}while(A!==o)}function T1(o,i){return o.x-i.x}function C1(o,i){const u=function(v,E){let A=E;const M=v.x,P=v.y;let F,j=-1/0;do{if(P<=A.y&&P>=A.next.y&&A.next.y!==A.y){const de=A.x+(P-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(de<=M&&de>j&&(j=de,F=A.x<A.next.x?A:A.next,de===M))return F}A=A.next}while(A!==E);if(!F)return null;const Z=F,W=F.x,te=F.y;let oe=1/0;A=F;do{if(M>=A.x&&A.x>=W&&M!==A.x&&Du(P<te?M:j,P,W,te,P<te?j:M,P,A.x,A.y)){const de=Math.abs(P-A.y)/(M-A.x);Kc(A,v)&&(de<oe||de===oe&&(A.x>F.x||A.x===F.x&&L1(F,A)))&&(F=A,oe=de)}A=A.next}while(A!==Z);return F}(o,i);if(!u)return i;const g=Am(u,o);return $l(g,g.next),$l(u,u.next)}function L1(o,i){return ir(o.prev,o,i.prev)<0&&ir(i.next,o,o.next)<0}function kd(o,i,u,g,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*v|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-g)*v|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function M1(o){let i=o,u=o;do(i.x<u.x||i.x===u.x&&i.y<u.y)&&(u=i),i=i.next;while(i!==o);return u}function Du(o,i,u,g,v,E,A,M){return(v-A)*(i-M)>=(o-A)*(E-M)&&(o-A)*(g-M)>=(u-A)*(i-M)&&(u-A)*(E-M)>=(v-A)*(g-M)}function R1(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(u,g){let v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==g.i&&v.next.i!==g.i&&Em(v,v.next,u,g))return!0;v=v.next}while(v!==u);return!1}(o,i)&&(Kc(o,i)&&Kc(i,o)&&function(u,g){let v=u,E=!1;const A=(u.x+g.x)/2,M=(u.y+g.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&A<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==u);return E}(o,i)&&(ir(o.prev,o,i.prev)||ir(o,i.prev,i))||ef(o,i)&&ir(o.prev,o,o.next)>0&&ir(i.prev,i,i.next)>0)}function ir(o,i,u){return(i.y-o.y)*(u.x-i.x)-(i.x-o.x)*(u.y-i.y)}function ef(o,i){return o.x===i.x&&o.y===i.y}function Em(o,i,u,g){const v=nf(ir(o,i,u)),E=nf(ir(o,i,g)),A=nf(ir(u,g,o)),M=nf(ir(u,g,i));return v!==E&&A!==M||!(v!==0||!tf(o,u,i))||!(E!==0||!tf(o,g,i))||!(A!==0||!tf(u,o,g))||!(M!==0||!tf(u,i,g))}function tf(o,i,u){return i.x<=Math.max(o.x,u.x)&&i.x>=Math.min(o.x,u.x)&&i.y<=Math.max(o.y,u.y)&&i.y>=Math.min(o.y,u.y)}function nf(o){return o>0?1:o<0?-1:0}function Kc(o,i){return ir(o.prev,o,o.next)<0?ir(o,i,o.next)>=0&&ir(o,o.prev,i)>=0:ir(o,i,o.prev)<0||ir(o,o.next,i)<0}function Am(o,i){const u=Id(o.i,o.x,o.y),g=Id(i.i,i.x,i.y),v=o.next,E=i.prev;return o.next=i,i.prev=o,u.next=v,v.prev=u,g.next=u,u.prev=g,E.next=g,g.prev=E,g}function Tm(o,i,u,g){const v=Id(o,i,u);return g?(v.next=g.next,v.prev=g,g.next.prev=v,g.next=v):(v.prev=v,v.next=v),v}function $c(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Id(o,i,u){return{i:o,x:i,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Sd(o,i,u){const g=u.patternDependencies;let v=!1;for(const E of i){const A=E.paint.get(`${o}-pattern`);A.isConstant()||(v=!0);const M=A.constantOr(null);M&&(v=!0,g[M.to]=!0,g[M.from]=!0)}return v}function Ed(o,i,u,g,v){const E=v.patternDependencies;for(const A of i){const M=A.paint.get(`${o}-pattern`).value;if(M.kind!=="constant"){let P=M.evaluate({zoom:g-1},u,{},v.availableImages),F=M.evaluate({zoom:g},u,{},v.availableImages),j=M.evaluate({zoom:g+1},u,{},v.availableImages);P=P&&P.name?P.name:P,F=F&&F.name?F.name:F,j=j&&j.name?j.name:j,E[P]=!0,E[F]=!0,E[j]=!0,u.patterns[A.id]={min:P,mid:F,max:j}}}return u}class Ad{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ho,this.indexArray=new Ws,this.indexArray2=new Pr,this.programConfigurations=new Xl(i.layers,i.zoom),this.segments=new Xn,this.segments2=new Xn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Sd("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),A=[];for(const{feature:M,id:P,index:F,sourceLayerIndex:j}of i){const Z=this.layers[0]._featureFilter.needGeometry,W=Kl(M,Z);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),W,g))continue;const te=E?v.evaluate(W,{},g,u.availableImages):void 0,oe={id:P,properties:M.properties,type:M.type,sourceLayerIndex:j,index:F,geometry:Z?W.geometry:Wl(M),patterns:{},sortKey:te};A.push(oe)}E&&A.sort((M,P)=>M.sortKey-P.sortKey);for(const M of A){const{geometry:P,index:F,sourceLayerIndex:j}=M;if(this.hasPattern){const Z=Ed("fill",this.layers,M,this.zoom,u);this.patternFeatures.push(Z)}else this.addFeature(M,P,F,g,{});u.featureIndex.insert(i[F].feature,P,F,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,k1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,u,g,v,E){for(const A of Ga(u,500)){let M=0;for(const te of A)M+=te.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),F=P.vertexLength,j=[],Z=[];for(const te of A){if(te.length===0)continue;te!==A[0]&&Z.push(j.length/2);const oe=this.segments2.prepareSegment(te.length,this.layoutVertexArray,this.indexArray2),de=oe.vertexLength;this.layoutVertexArray.emplaceBack(te[0].x,te[0].y),this.indexArray2.emplaceBack(de+te.length-1,de),j.push(te[0].x),j.push(te[0].y);for(let Le=1;Le<te.length;Le++)this.layoutVertexArray.emplaceBack(te[Le].x,te[Le].y),this.indexArray2.emplaceBack(de+Le-1,de+Le),j.push(te[Le].x),j.push(te[Le].y);oe.vertexLength+=te.length,oe.primitiveLength+=te.length}const W=Im(j,Z);for(let te=0;te<W.length;te+=3)this.indexArray.emplaceBack(F+W[te],F+W[te+1],F+W[te+2]);P.vertexLength+=M,P.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}let Cm,Lm;Qt("FillBucket",Ad,{omit:["layers","patternFeatures"]});var P1={get paint(){return Lm=Lm||new k({"fill-antialias":new nn(Ke.paint_fill["fill-antialias"]),"fill-opacity":new yn(Ke.paint_fill["fill-opacity"]),"fill-color":new yn(Ke.paint_fill["fill-color"]),"fill-outline-color":new yn(Ke.paint_fill["fill-outline-color"]),"fill-translate":new nn(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new nn(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Iu(Ke.paint_fill["fill-pattern"])})},get layout(){return Cm=Cm||new k({"fill-sort-key":new yn(Ke.layout_fill["fill-sort-key"])})}};class D1 extends f{constructor(i){super(i,P1)}recalculate(i,u){super.recalculate(i,u);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Ad(i)}queryRadius(){return Yh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M){return fm(Jh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,M),v)}isTileClipped(){return!0}}const N1=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),z1=R([{name:"a_centroid",components:2,type:"Int16"}],4),{members:F1}=N1;var cl={},O1=S,Mm=Nu;function Nu(o,i,u,g,v){this.properties={},this.extent=u,this.type=0,this._pbf=o,this._geometry=-1,this._keys=g,this._values=v,o.readFields(B1,this,i)}function B1(o,i,u){o==1?i.id=u.readVarint():o==2?function(g,v){for(var E=g.readVarint()+g.pos;g.pos<E;){var A=v._keys[g.readVarint()],M=v._values[g.readVarint()];v.properties[A]=M}}(u,i):o==3?i.type=u.readVarint():o==4&&(i._geometry=u.pos)}function U1(o){for(var i,u,g=0,v=0,E=o.length,A=E-1;v<E;A=v++)g+=((u=o[A]).x-(i=o[v]).x)*(i.y+u.y);return g}Nu.types=["Unknown","Point","LineString","Polygon"],Nu.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,u=o.readVarint()+o.pos,g=1,v=0,E=0,A=0,M=[];o.pos<u;){if(v<=0){var P=o.readVarint();g=7&P,v=P>>3}if(v--,g===1||g===2)E+=o.readSVarint(),A+=o.readSVarint(),g===1&&(i&&M.push(i),i=[]),i.push(new O1(E,A));else{if(g!==7)throw new Error("unknown command "+g);i&&i.push(i[0].clone())}}return i&&M.push(i),M},Nu.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,u=1,g=0,v=0,E=0,A=1/0,M=-1/0,P=1/0,F=-1/0;o.pos<i;){if(g<=0){var j=o.readVarint();u=7&j,g=j>>3}if(g--,u===1||u===2)(v+=o.readSVarint())<A&&(A=v),v>M&&(M=v),(E+=o.readSVarint())<P&&(P=E),E>F&&(F=E);else if(u!==7)throw new Error("unknown command "+u)}return[A,P,M,F]},Nu.prototype.toGeoJSON=function(o,i,u){var g,v,E=this.extent*Math.pow(2,u),A=this.extent*o,M=this.extent*i,P=this.loadGeometry(),F=Nu.types[this.type];function j(te){for(var oe=0;oe<te.length;oe++){var de=te[oe];te[oe]=[360*(de.x+A)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var Z=[];for(g=0;g<P.length;g++)Z[g]=P[g][0];j(P=Z);break;case 2:for(g=0;g<P.length;g++)j(P[g]);break;case 3:for(P=function(te){var oe=te.length;if(oe<=1)return[te];for(var de,Le,De=[],it=0;it<oe;it++){var Ge=U1(te[it]);Ge!==0&&(Le===void 0&&(Le=Ge<0),Le===Ge<0?(de&&De.push(de),de=[te[it]]):de.push(te[it]))}return de&&De.push(de),De}(P),g=0;g<P.length;g++)for(v=0;v<P[g].length;v++)j(P[g][v])}P.length===1?P=P[0]:F="Multi"+F;var W={type:"Feature",geometry:{type:F,coordinates:P},properties:this.properties};return"id"in this&&(W.id=this.id),W};var j1=Mm,Rm=Pm;function Pm(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(q1,this,i),this.length=this._features.length}function q1(o,i,u){o===15?i.version=u.readVarint():o===1?i.name=u.readString():o===5?i.extent=u.readVarint():o===2?i._features.push(u.pos):o===3?i._keys.push(u.readString()):o===4&&i._values.push(function(g){for(var v=null,E=g.readVarint()+g.pos;g.pos<E;){var A=g.readVarint()>>3;v=A===1?g.readString():A===2?g.readFloat():A===3?g.readDouble():A===4?g.readVarint64():A===5?g.readVarint():A===6?g.readSVarint():A===7?g.readBoolean():null}return v}(u))}Pm.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new j1(this._pbf,i,this.extent,this._keys,this._values)};var V1=Rm;function G1(o,i,u){if(o===3){var g=new V1(u,u.readVarint()+u.pos);g.length&&(i[g.name]=g)}}cl.VectorTile=function(o,i){this.layers=o.readFields(G1,{},i)},cl.VectorTileFeature=Mm,cl.VectorTileLayer=Rm;const Z1=cl.VectorTileFeature.types,Td=Math.pow(2,13);function Yc(o,i,u,g,v,E,A,M){o.emplaceBack(i,u,2*Math.floor(g*Td)+A,v*Td*2,E*Td*2,Math.round(M))}class Cd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new rl,this.centroidVertexArray=new Br,this.indexArray=new Ws,this.programConfigurations=new Xl(i.layers,i.zoom),this.segments=new Xn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.features=[],this.hasPattern=Sd("fill-extrusion",this.layers,u);for(const{feature:v,id:E,index:A,sourceLayerIndex:M}of i){const P=this.layers[0]._featureFilter.needGeometry,F=Kl(v,P);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),F,g))continue;const j={id:E,sourceLayerIndex:M,index:A,geometry:P?F.geometry:Wl(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Ed("fill-extrusion",this.layers,j,this.zoom,u)):this.addFeature(j,j.geometry,A,g,{}),u.featureIndex.insert(v,j.geometry,A,M,this.index,!0)}}addFeatures(i,u,g){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,u,g)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,F1),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,z1.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,u,g,v,E){for(const A of Ga(u,500)){const M={x:0,y:0,vertexCount:0};let P=0;for(const oe of A)P+=oe.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const oe of A){if(oe.length===0||X1(oe))continue;let de=0;for(let Le=0;Le<oe.length;Le++){const De=oe[Le];if(Le>=1){const it=oe[Le-1];if(!H1(De,it)){F.vertexLength+4>Xn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ge=De.sub(it)._perp()._unit(),et=it.dist(De);de+et>32768&&(de=0),Yc(this.layoutVertexArray,De.x,De.y,Ge.x,Ge.y,0,0,de),Yc(this.layoutVertexArray,De.x,De.y,Ge.x,Ge.y,0,1,de),M.x+=2*De.x,M.y+=2*De.y,M.vertexCount+=2,de+=et,Yc(this.layoutVertexArray,it.x,it.y,Ge.x,Ge.y,0,0,de),Yc(this.layoutVertexArray,it.x,it.y,Ge.x,Ge.y,0,1,de),M.x+=2*it.x,M.y+=2*it.y,M.vertexCount+=2;const ft=F.vertexLength;this.indexArray.emplaceBack(ft,ft+2,ft+1),this.indexArray.emplaceBack(ft+1,ft+2,ft+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+P>Xn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),Z1[i.type]!=="Polygon")continue;const j=[],Z=[],W=F.vertexLength;for(const oe of A)if(oe.length!==0){oe!==A[0]&&Z.push(j.length/2);for(let de=0;de<oe.length;de++){const Le=oe[de];Yc(this.layoutVertexArray,Le.x,Le.y,0,0,1,1,0),M.x+=Le.x,M.y+=Le.y,M.vertexCount+=1,j.push(Le.x),j.push(Le.y)}}const te=Im(j,Z);for(let oe=0;oe<te.length;oe+=3)this.indexArray.emplaceBack(W+te[oe],W+te[oe+2],W+te[oe+1]);F.primitiveLength+=te.length/3,F.vertexLength+=P;for(let oe=0;oe<M.vertexCount;oe++){const de=Math.floor(M.x/M.vertexCount),Le=Math.floor(M.y/M.vertexCount);this.centroidVertexArray.emplaceBack(de,Le)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}function H1(o,i){return o.x===i.x&&(o.x<0||o.x>ar)||o.y===i.y&&(o.y<0||o.y>ar)}function X1(o){return o.every(i=>i.x<0)||o.every(i=>i.x>ar)||o.every(i=>i.y<0)||o.every(i=>i.y>ar)}let Dm;Qt("FillExtrusionBucket",Cd,{omit:["layers","features"]});var W1={get paint(){return Dm=Dm||new k({"fill-extrusion-opacity":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Iu(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class K1 extends f{constructor(i){super(i,W1)}createBucket(i){return new Cd(i)}queryRadius(){return Yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,u,g,v,E,A,M,P){const F=Jh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,M),j=this.paint.get("fill-extrusion-height").evaluate(u,g),Z=this.paint.get("fill-extrusion-base").evaluate(u,g),W=function(oe,de,Le,De){const it=[];for(const Ge of oe){const et=[Ge.x,Ge.y,0,1];Qh(et,et,de),it.push(new C(et[0]/et[3],et[1]/et[3]))}return it}(F,P),te=function(oe,de,Le,De){const it=[],Ge=[],et=De[8]*de,ft=De[9]*de,Et=De[10]*de,Wt=De[11]*de,_n=De[8]*Le,Ht=De[9]*Le,Gt=De[10]*Le,an=De[11]*Le;for(const tn of oe){const Yt=[],vt=[];for(const cn of tn){const sn=cn.x,kn=cn.y,xi=De[0]*sn+De[4]*kn+De[12],yi=De[1]*sn+De[5]*kn+De[13],wr=De[2]*sn+De[6]*kn+De[14],fo=De[3]*sn+De[7]*kn+De[15],qr=wr+Et,kr=fo+Wt,fs=xi+_n,ds=yi+Ht,ps=wr+Gt,Ki=fo+an,Ir=new C((xi+et)/kr,(yi+ft)/kr);Ir.z=qr/kr,Yt.push(Ir);const Qr=new C(fs/Ki,ds/Ki);Qr.z=ps/Ki,vt.push(Qr)}it.push(Yt),Ge.push(vt)}return[it,Ge]}(v,Z,j,P);return function(oe,de,Le){let De=1/0;fm(Le,de)&&(De=Nm(Le,de[0]));for(let it=0;it<de.length;it++){const Ge=de[it],et=oe[it];for(let ft=0;ft<Ge.length-1;ft++){const Et=Ge[ft],Wt=[Et,Ge[ft+1],et[ft+1],et[ft],Et];hm(Le,Wt)&&(De=Math.min(De,Nm(Le,Wt)))}}return De!==1/0&&De}(te[0],te[1],W)}}function Jc(o,i){return o.x*i.x+o.y*i.y}function Nm(o,i){if(o.length===1){let u=0;const g=i[u++];let v;for(;!v||g.equals(v);)if(v=i[u++],!v)return 1/0;for(;u<i.length;u++){const E=i[u],A=o[0],M=v.sub(g),P=E.sub(g),F=A.sub(g),j=Jc(M,M),Z=Jc(M,P),W=Jc(P,P),te=Jc(F,M),oe=Jc(F,P),de=j*W-Z*Z,Le=(W*te-Z*oe)/de,De=(j*oe-Z*te)/de,it=g.z*(1-Le-De)+v.z*Le+E.z*De;if(isFinite(it))return it}return 1/0}{let u=1/0;for(const g of i)u=Math.min(u,g.z);return u}}const $1=R([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Y1}=$1,J1=R([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Q1}=J1,eb=cl.VectorTileFeature.types,tb=Math.cos(Math.PI/180*37.5),zm=Math.pow(2,14)/.5;class Ld{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Eu,this.layoutVertexArray2=new sl,this.indexArray=new Ws,this.programConfigurations=new Xl(i.layers,i.zoom),this.segments=new Xn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Sd("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),A=[];for(const{feature:M,id:P,index:F,sourceLayerIndex:j}of i){const Z=this.layers[0]._featureFilter.needGeometry,W=Kl(M,Z);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),W,g))continue;const te=E?v.evaluate(W,{},g):void 0,oe={id:P,properties:M.properties,type:M.type,sourceLayerIndex:j,index:F,geometry:Z?W.geometry:Wl(M),patterns:{},sortKey:te};A.push(oe)}E&&A.sort((M,P)=>M.sortKey-P.sortKey);for(const M of A){const{geometry:P,index:F,sourceLayerIndex:j}=M;if(this.hasPattern){const Z=Ed("line",this.layers,M,this.zoom,u);this.patternFeatures.push(Z)}else this.addFeature(M,P,F,g,{});u.featureIndex.insert(i[F].feature,P,F,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Q1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Y1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,u,g,v,E){const A=this.layers[0].layout,M=A.get("line-join").evaluate(i,{}),P=A.get("line-cap"),F=A.get("line-miter-limit"),j=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const Z of u)this.addLine(Z,i,M,P,F,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}addLine(i,u,g,v,E,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let De=0;De<i.length-1;De++)this.totalDistance+=i[De].dist(i[De+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=eb[u.type]==="Polygon";let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let F=0;for(;F<P-1&&i[F].equals(i[F+1]);)F++;if(P<(M?3:2))return;g==="bevel"&&(E=1.05);const j=this.overscaling<=16?15*ar/(512*this.overscaling):0,Z=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let W,te,oe,de,Le;this.e1=this.e2=-1,M&&(W=i[P-2],Le=i[F].sub(W)._unit()._perp());for(let De=F;De<P;De++){if(oe=De===P-1?M?i[F+1]:void 0:i[De+1],oe&&i[De].equals(oe))continue;Le&&(de=Le),W&&(te=W),W=i[De],Le=oe?oe.sub(W)._unit()._perp():de,de=de||Le;let it=de.add(Le);it.x===0&&it.y===0||it._unit();const Ge=de.x*Le.x+de.y*Le.y,et=it.x*Le.x+it.y*Le.y,ft=et!==0?1/et:1/0,Et=2*Math.sqrt(2-2*et),Wt=et<tb&&te&&oe,_n=de.x*Le.y-de.y*Le.x>0;if(Wt&&De>F){const an=W.dist(te);if(an>2*j){const tn=W.sub(W.sub(te)._mult(j/an)._round());this.updateDistance(te,tn),this.addCurrentVertex(tn,de,0,0,Z),te=tn}}const Ht=te&&oe;let Gt=Ht?g:M?"butt":v;if(Ht&&Gt==="round"&&(ft<A?Gt="miter":ft<=2&&(Gt="fakeround")),Gt==="miter"&&ft>E&&(Gt="bevel"),Gt==="bevel"&&(ft>2&&(Gt="flipbevel"),ft<E&&(Gt="miter")),te&&this.updateDistance(te,W),Gt==="miter")it._mult(ft),this.addCurrentVertex(W,it,0,0,Z);else if(Gt==="flipbevel"){if(ft>100)it=Le.mult(-1);else{const an=ft*de.add(Le).mag()/de.sub(Le).mag();it._perp()._mult(an*(_n?-1:1))}this.addCurrentVertex(W,it,0,0,Z),this.addCurrentVertex(W,it.mult(-1),0,0,Z)}else if(Gt==="bevel"||Gt==="fakeround"){const an=-Math.sqrt(ft*ft-1),tn=_n?an:0,Yt=_n?0:an;if(te&&this.addCurrentVertex(W,de,tn,Yt,Z),Gt==="fakeround"){const vt=Math.round(180*Et/Math.PI/20);for(let cn=1;cn<vt;cn++){let sn=cn/vt;if(sn!==.5){const xi=sn-.5;sn+=sn*xi*(sn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*xi*xi+(.848013+Ge*(.215638*Ge-1.06021)))}const kn=Le.sub(de)._mult(sn)._add(de)._unit()._mult(_n?-1:1);this.addHalfVertex(W,kn.x,kn.y,!1,_n,0,Z)}}oe&&this.addCurrentVertex(W,Le,-tn,-Yt,Z)}else if(Gt==="butt")this.addCurrentVertex(W,it,0,0,Z);else if(Gt==="square"){const an=te?1:-1;this.addCurrentVertex(W,it,an,an,Z)}else Gt==="round"&&(te&&(this.addCurrentVertex(W,de,0,0,Z),this.addCurrentVertex(W,de,1,1,Z,!0)),oe&&(this.addCurrentVertex(W,Le,-1,-1,Z,!0),this.addCurrentVertex(W,Le,0,0,Z)));if(Wt&&De<P-1){const an=W.dist(oe);if(an>2*j){const tn=W.add(oe.sub(W)._mult(j/an)._round());this.updateDistance(W,tn),this.addCurrentVertex(tn,Le,0,0,Z),W=tn}}}}addCurrentVertex(i,u,g,v,E,A=!1){const M=u.y*v-u.x,P=-u.y-u.x*v;this.addHalfVertex(i,u.x+u.y*g,u.y-u.x*g,A,!1,g,E),this.addHalfVertex(i,M,P,A,!0,-v,E),this.distance>zm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,u,g,v,E,A))}addHalfVertex({x:i,y:u},g,v,E,A,M,P){const F=.5*(this.lineClips?this.scaledDistance*(zm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(E?1:0),(u<<1)+(A?1:0),Math.round(63*g)+128,Math.round(63*v)+128,1+(M===0?0:M<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),P.primitiveLength++),A?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,u){this.distance+=i.dist(u),this.updateScaledDistance()}}let Fm,Om;Qt("LineBucket",Ld,{omit:["layers","patternFeatures"]});var Bm={get paint(){return Om=Om||new k({"line-opacity":new yn(Ke.paint_line["line-opacity"]),"line-color":new yn(Ke.paint_line["line-color"]),"line-translate":new nn(Ke.paint_line["line-translate"]),"line-translate-anchor":new nn(Ke.paint_line["line-translate-anchor"]),"line-width":new yn(Ke.paint_line["line-width"]),"line-gap-width":new yn(Ke.paint_line["line-gap-width"]),"line-offset":new yn(Ke.paint_line["line-offset"]),"line-blur":new yn(Ke.paint_line["line-blur"]),"line-dasharray":new Su(Ke.paint_line["line-dasharray"]),"line-pattern":new Iu(Ke.paint_line["line-pattern"]),"line-gradient":new qc(Ke.paint_line["line-gradient"])})},get layout(){return Fm=Fm||new k({"line-cap":new nn(Ke.layout_line["line-cap"]),"line-join":new yn(Ke.layout_line["line-join"]),"line-miter-limit":new nn(Ke.layout_line["line-miter-limit"]),"line-round-limit":new nn(Ke.layout_line["line-round-limit"]),"line-sort-key":new yn(Ke.layout_line["line-sort-key"])})}};class nb extends yn{possiblyEvaluate(i,u){return u=new Ei(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(i,u)}evaluate(i,u,g,v){return u=ye({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(i,u,g,v)}}let rf;class ib extends f{constructor(i){super(i,Bm),this.gradientVersion=0,rf||(rf=new nb(Bm.paint.properties["line-width"].specification),rf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Fo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,u){super.recalculate(i,u),this.paint._values["line-floorwidth"]=rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Ld(i)}queryRadius(i){const u=i,g=Um(Zc("line-width",this,u),Zc("line-gap-width",this,u)),v=Zc("line-offset",this,u);return g/2+Math.abs(v)+Yh(this.paint.get("line-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M){const P=Jh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,M),F=M/2*Um(this.paint.get("line-width").evaluate(u,g),this.paint.get("line-gap-width").evaluate(u,g)),j=this.paint.get("line-offset").evaluate(u,g);return j&&(v=function(Z,W){const te=[];for(let oe=0;oe<Z.length;oe++){const de=Z[oe],Le=[];for(let De=0;De<de.length;De++){const it=de[De-1],Ge=de[De],et=de[De+1],ft=De===0?new C(0,0):Ge.sub(it)._unit()._perp(),Et=De===de.length-1?new C(0,0):et.sub(Ge)._unit()._perp(),Wt=ft._add(Et)._unit(),_n=Wt.x*Et.x+Wt.y*Et.y;_n!==0&&Wt._mult(1/_n),Le.push(Wt._mult(W)._add(Ge))}te.push(Le)}return te}(v,j*M)),function(Z,W,te){for(let oe=0;oe<W.length;oe++){const de=W[oe];if(Z.length>=3){for(let Le=0;Le<de.length;Le++)if(Ru(Z,de[Le]))return!0}if(f1(Z,de,te))return!0}return!1}(P,v,F)}isTileClipped(){return!0}}function Um(o,i){return i>0?i+2*o:o}const rb=R([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sb=R([{name:"a_projected_pos",components:3,type:"Float32"}],4);R([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ob=R([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);R([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jm=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ab=R([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function lb(o,i,u){return o.sections.forEach(g=>{g.text=function(v,E,A){const M=E.layout.get("text-transform").evaluate(A,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),Ss.applyArabicShaping&&(v=Ss.applyArabicShaping(v)),v}(g.text,i,u)}),o}R([{name:"triangle",components:3,type:"Uint16"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),R([{type:"Float32",name:"offsetX"}]),R([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),R([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var mr=24,qm=_i,Vm=function(o,i,u,g,v){var E,A,M=8*v-g-1,P=(1<<M)-1,F=P>>1,j=-7,Z=u?v-1:0,W=u?-1:1,te=o[i+Z];for(Z+=W,E=te&(1<<-j)-1,te>>=-j,j+=M;j>0;E=256*E+o[i+Z],Z+=W,j-=8);for(A=E&(1<<-j)-1,E>>=-j,j+=g;j>0;A=256*A+o[i+Z],Z+=W,j-=8);if(E===0)E=1-F;else{if(E===P)return A?NaN:1/0*(te?-1:1);A+=Math.pow(2,g),E-=F}return(te?-1:1)*A*Math.pow(2,E-g)},Gm=function(o,i,u,g,v,E){var A,M,P,F=8*E-v-1,j=(1<<F)-1,Z=j>>1,W=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=g?0:E-1,oe=g?1:-1,de=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,A=j):(A=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-A))<1&&(A--,P*=2),(i+=A+Z>=1?W/P:W*Math.pow(2,1-Z))*P>=2&&(A++,P/=2),A+Z>=j?(M=0,A=j):A+Z>=1?(M=(i*P-1)*Math.pow(2,v),A+=Z):(M=i*Math.pow(2,Z-1)*Math.pow(2,v),A=0));v>=8;o[u+te]=255&M,te+=oe,M/=256,v-=8);for(A=A<<v|M,F+=v;F>0;o[u+te]=255&A,te+=oe,A/=256,F-=8);o[u+te-oe]|=128*de};function _i(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}_i.Varint=0,_i.Fixed64=1,_i.Bytes=2,_i.Fixed32=5;var Md=4294967296,Zm=1/Md,Hm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ea(o){return o.type===_i.Bytes?o.readVarint()+o.pos:o.pos+1}function zu(o,i,u){return u?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function Xm(o,i,u){var g=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));u.realloc(g);for(var v=u.pos-1;v>=o;v--)u.buf[v+g]=u.buf[v]}function ub(o,i){for(var u=0;u<o.length;u++)i.writeVarint(o[u])}function cb(o,i){for(var u=0;u<o.length;u++)i.writeSVarint(o[u])}function hb(o,i){for(var u=0;u<o.length;u++)i.writeFloat(o[u])}function fb(o,i){for(var u=0;u<o.length;u++)i.writeDouble(o[u])}function db(o,i){for(var u=0;u<o.length;u++)i.writeBoolean(o[u])}function pb(o,i){for(var u=0;u<o.length;u++)i.writeFixed32(o[u])}function mb(o,i){for(var u=0;u<o.length;u++)i.writeSFixed32(o[u])}function gb(o,i){for(var u=0;u<o.length;u++)i.writeFixed64(o[u])}function _b(o,i){for(var u=0;u<o.length;u++)i.writeSFixed64(o[u])}function sf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function Fu(o,i,u){o[u]=i,o[u+1]=i>>>8,o[u+2]=i>>>16,o[u+3]=i>>>24}function Wm(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}_i.prototype={destroy:function(){this.buf=null},readFields:function(o,i,u){for(u=u||this.length;this.pos<u;){var g=this.readVarint(),v=g>>3,E=this.pos;this.type=7&g,o(v,i,this),this.pos===E&&this.skip(g)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=sf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Wm(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=sf(this.buf,this.pos)+sf(this.buf,this.pos+4)*Md;return this.pos+=8,o},readSFixed64:function(){var o=sf(this.buf,this.pos)+Wm(this.buf,this.pos+4)*Md;return this.pos+=8,o},readFloat:function(){var o=Vm(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Vm(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,u,g=this.buf;return i=127&(u=g[this.pos++]),u<128?i:(i|=(127&(u=g[this.pos++]))<<7,u<128?i:(i|=(127&(u=g[this.pos++]))<<14,u<128?i:(i|=(127&(u=g[this.pos++]))<<21,u<128?i:function(v,E,A){var M,P,F=A.buf;if(M=(112&(P=F[A.pos++]))>>4,P<128||(M|=(127&(P=F[A.pos++]))<<3,P<128)||(M|=(127&(P=F[A.pos++]))<<10,P<128)||(M|=(127&(P=F[A.pos++]))<<17,P<128)||(M|=(127&(P=F[A.pos++]))<<24,P<128)||(M|=(1&(P=F[A.pos++]))<<31,P<128))return zu(v,M,E);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(u=g[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&Hm?function(u,g,v){return Hm.decode(u.subarray(g,v))}(this.buf,i,o):function(u,g,v){for(var E="",A=g;A<v;){var M,P,F,j=u[A],Z=null,W=j>239?4:j>223?3:j>191?2:1;if(A+W>v)break;W===1?j<128&&(Z=j):W===2?(192&(M=u[A+1]))==128&&(Z=(31&j)<<6|63&M)<=127&&(Z=null):W===3?(P=u[A+2],(192&(M=u[A+1]))==128&&(192&P)==128&&((Z=(15&j)<<12|(63&M)<<6|63&P)<=2047||Z>=55296&&Z<=57343)&&(Z=null)):W===4&&(P=u[A+2],F=u[A+3],(192&(M=u[A+1]))==128&&(192&P)==128&&(192&F)==128&&((Z=(15&j)<<18|(63&M)<<12|(63&P)<<6|63&F)<=65535||Z>=1114112)&&(Z=null)),Z===null?(Z=65533,W=1):Z>65535&&(Z-=65536,E+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),E+=String.fromCharCode(Z),A+=W}return E}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==_i.Bytes)return o.push(this.readVarint(i));var u=Ea(this);for(o=o||[];this.pos<u;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==_i.Bytes)return o.push(this.readSVarint());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==_i.Bytes)return o.push(this.readBoolean());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==_i.Bytes)return o.push(this.readFloat());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==_i.Bytes)return o.push(this.readDouble());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==_i.Bytes)return o.push(this.readFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==_i.Bytes)return o.push(this.readSFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==_i.Bytes)return o.push(this.readFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==_i.Bytes)return o.push(this.readSFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===_i.Varint)for(;this.buf[this.pos++]>127;);else if(i===_i.Bytes)this.pos=this.readVarint()+this.pos;else if(i===_i.Fixed32)this.pos+=4;else{if(i!==_i.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var u=new Uint8Array(i);u.set(this.buf),this.buf=u,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Fu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Fu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Fu(this.buf,-1&o,this.pos),Fu(this.buf,Math.floor(o*Zm),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Fu(this.buf,-1&o,this.pos),Fu(this.buf,Math.floor(o*Zm),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,u){var g,v;if(i>=0?(g=i%4294967296|0,v=i/4294967296|0):(v=~(-i/4294967296),4294967295^(g=~(-i%4294967296))?g=g+1|0:(g=0,v=v+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(E,A,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(g,0,u),function(E,A){var M=(7&E)<<4;A.buf[A.pos++]|=M|((E>>>=3)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E)))))}(v,u)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(g,v,E){for(var A,M,P=0;P<v.length;P++){if((A=v.charCodeAt(P))>55295&&A<57344){if(!M){A>56319||P+1===v.length?(g[E++]=239,g[E++]=191,g[E++]=189):M=A;continue}if(A<56320){g[E++]=239,g[E++]=191,g[E++]=189,M=A;continue}A=M-55296<<10|A-56320|65536,M=null}else M&&(g[E++]=239,g[E++]=191,g[E++]=189,M=null);A<128?g[E++]=A:(A<2048?g[E++]=A>>6|192:(A<65536?g[E++]=A>>12|224:(g[E++]=A>>18|240,g[E++]=A>>12&63|128),g[E++]=A>>6&63|128),g[E++]=63&A|128)}return E}(this.buf,o,this.pos);var u=this.pos-i;u>=128&&Xm(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u},writeFloat:function(o){this.realloc(4),Gm(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Gm(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var u=0;u<i;u++)this.buf[this.pos++]=o[u]},writeRawMessage:function(o,i){this.pos++;var u=this.pos;o(i,this);var g=this.pos-u;g>=128&&Xm(u,g,this),this.pos=u-1,this.writeVarint(g),this.pos+=g},writeMessage:function(o,i,u){this.writeTag(o,_i.Bytes),this.writeRawMessage(i,u)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,ub,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,cb,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,db,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,hb,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,fb,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,pb,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,mb,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,gb,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,_b,i)},writeBytesField:function(o,i){this.writeTag(o,_i.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,_i.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,_i.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,_i.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,_i.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,_i.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,_i.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,_i.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,_i.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,_i.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var Rd=x(qm);const Pd=3;function yb(o,i,u){o===1&&u.readMessage(vb,i)}function vb(o,i,u){if(o===3){const{id:g,bitmap:v,width:E,height:A,left:M,top:P,advance:F}=u.readMessage(bb,{});i.push({id:g,bitmap:new Xc({width:E+2*Pd,height:A+2*Pd},v),metrics:{width:E,height:A,left:M,top:P,advance:F}})}}function bb(o,i,u){o===1?i.id=u.readVarint():o===2?i.bitmap=u.readBytes():o===3?i.width=u.readVarint():o===4?i.height=u.readVarint():o===5?i.left=u.readSVarint():o===6?i.top=u.readSVarint():o===7&&(i.advance=u.readVarint())}const Km=Pd;function $m(o){let i=0,u=0;for(const A of o)i+=A.w*A.h,u=Math.max(u,A.w);o.sort((A,M)=>M.h-A.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),u),h:1/0}];let v=0,E=0;for(const A of o)for(let M=g.length-1;M>=0;M--){const P=g[M];if(!(A.w>P.w||A.h>P.h)){if(A.x=P.x,A.y=P.y,E=Math.max(E,A.y+A.h),v=Math.max(v,A.x+A.w),A.w===P.w&&A.h===P.h){const F=g.pop();M<g.length&&(g[M]=F)}else A.h===P.h?(P.x+=A.w,P.w-=A.w):A.w===P.w?(P.y+=A.h,P.h-=A.h):(g.push({x:P.x+A.w,y:P.y,w:P.w-A.w,h:A.h}),P.y+=A.h,P.h-=A.h);break}}return{w:v,h:E,fill:i/(v*E)||0}}const As=1;class Dd{constructor(i,{pixelRatio:u,version:g,stretchX:v,stretchY:E,content:A,textFitWidth:M,textFitHeight:P}){this.paddedRect=i,this.pixelRatio=u,this.stretchX=v,this.stretchY=E,this.content=A,this.version=g,this.textFitWidth=M,this.textFitHeight=P}get tl(){return[this.paddedRect.x+As,this.paddedRect.y+As]}get br(){return[this.paddedRect.x+this.paddedRect.w-As,this.paddedRect.y+this.paddedRect.h-As]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*As)/this.pixelRatio,(this.paddedRect.h-2*As)/this.pixelRatio]}}class Ym{constructor(i,u){const g={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(i,g,E),this.addImages(u,v,E);const{w:A,h:M}=$m(E),P=new Ks({width:A||1,height:M||1});for(const F in i){const j=i[F],Z=g[F].paddedRect;Ks.copy(j.data,P,{x:0,y:0},{x:Z.x+As,y:Z.y+As},j.data)}for(const F in u){const j=u[F],Z=v[F].paddedRect,W=Z.x+As,te=Z.y+As,oe=j.data.width,de=j.data.height;Ks.copy(j.data,P,{x:0,y:0},{x:W,y:te},j.data),Ks.copy(j.data,P,{x:0,y:de-1},{x:W,y:te-1},{width:oe,height:1}),Ks.copy(j.data,P,{x:0,y:0},{x:W,y:te+de},{width:oe,height:1}),Ks.copy(j.data,P,{x:oe-1,y:0},{x:W-1,y:te},{width:1,height:de}),Ks.copy(j.data,P,{x:0,y:0},{x:W+oe,y:te},{width:1,height:de})}this.image=P,this.iconPositions=g,this.patternPositions=v}addImages(i,u,g){for(const v in i){const E=i[v],A={x:0,y:0,w:E.data.width+2*As,h:E.data.height+2*As};g.push(A),u[v]=new Dd(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(i,u){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in i.updatedImages)this.patchUpdatedImage(this.iconPositions[g],i.getImage(g),u),this.patchUpdatedImage(this.patternPositions[g],i.getImage(g),u)}patchUpdatedImage(i,u,g){if(!i||!u||i.version===u.version)return;i.version=u.version;const[v,E]=i.tl;g.update(u.data,void 0,{x:v,y:E})}}var hl;Qt("ImagePosition",Dd),Qt("ImageAtlas",Ym),m.ah=void 0,(hl=m.ah||(m.ah={}))[hl.none=0]="none",hl[hl.horizontal=1]="horizontal",hl[hl.vertical=2]="vertical",hl[hl.horizontalOnly=3]="horizontalOnly";const eh=-17;class th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,u){const g=new th;return g.scale=i||1,g.fontStack=u,g}static forImage(i){const u=new th;return u.imageName=i,u}}class Ou{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,u){const g=new Ou;for(let v=0;v<i.sections.length;v++){const E=i.sections[v];E.image?g.addImageSection(E):g.addTextSection(E,u)}return g}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let u="";for(let g=0;g<i.length;g++){const v=i.charCodeAt(g+1)||null,E=i.charCodeAt(g-1)||null;u+=v&&Gh(v)&&!Qc[i[g+1]]||E&&Gh(E)&&!Qc[i[g-1]]||!Qc[i[g]]?i[g]:Qc[i[g]]}return u}(this.text)}trim(){let i=0;for(let g=0;g<this.text.length&&af[this.text.charCodeAt(g)];g++)i++;let u=this.text.length;for(let g=this.text.length-1;g>=0&&g>=i&&af[this.text.charCodeAt(g)];g--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)}substring(i,u){const g=new Ou;return g.text=this.text.substring(i,u),g.sectionIndex=this.sectionIndex.slice(i,u),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,u)=>Math.max(i,this.sections[u].scale),0)}addTextSection(i,u){this.text+=i.text,this.sections.push(th.forText(i.scale,i.fontStack||u));const g=this.sections.length-1;for(let v=0;v<i.text.length;++v)this.sectionIndex.push(g)}addImageSection(i){const u=i.image?i.image.name:"";if(u.length===0)return void tt("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(th.forImage(u)),this.sectionIndex.push(this.sections.length-1)):tt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function of(o,i,u,g,v,E,A,M,P,F,j,Z,W,te,oe){const de=Ou.fromFeature(o,v);let Le;Z===m.ah.vertical&&de.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:it}=Ss;if(De&&de.sections.length===1){Le=[];const ft=De(de.toString(),Nd(de,F,E,i,g,te));for(const Et of ft){const Wt=new Ou;Wt.text=Et,Wt.sections=de.sections;for(let _n=0;_n<Et.length;_n++)Wt.sectionIndex.push(0);Le.push(Wt)}}else if(it){Le=[];const ft=it(de.text,de.sectionIndex,Nd(de,F,E,i,g,te));for(const Et of ft){const Wt=new Ou;Wt.text=Et[0],Wt.sectionIndex=Et[1],Wt.sections=de.sections,Le.push(Wt)}}else Le=function(ft,Et){const Wt=[],_n=ft.text;let Ht=0;for(const Gt of Et)Wt.push(ft.substring(Ht,Gt)),Ht=Gt;return Ht<_n.length&&Wt.push(ft.substring(Ht,_n.length)),Wt}(de,Nd(de,F,E,i,g,te));const Ge=[],et={positionedLines:Ge,text:de.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:Z,iconsInText:!1,verticalizable:!1};return function(ft,Et,Wt,_n,Ht,Gt,an,tn,Yt,vt,cn,sn){let kn=0,xi=eh,yi=0,wr=0;const fo=tn==="right"?1:tn==="left"?0:.5;let qr=0;for(const Ki of Ht){Ki.trim();const Ir=Ki.getMaxScale(),Qr=(Ir-1)*mr,Vr={positionedGlyphs:[],lineOffset:0};ft.positionedLines[qr]=Vr;const ms=Vr.positionedGlyphs;let Gr=0;if(!Ki.length()){xi+=Gt,++qr;continue}for(let Ts=0;Ts<Ki.length();Ts++){const ai=Ki.getSection(Ts),ki=Ki.getSectionIndex(Ts),Li=Ki.getCharCode(Ts);let Us=0,qi=null,qu=null,na=null,ia=mr;const po=!(Yt===m.ah.horizontal||!cn&&!Uc(Li)||cn&&(af[Li]||(kr=Li,/\p{sc=Arab}/u.test(String.fromCodePoint(kr)))));if(ai.imageName){const Js=_n[ai.imageName];if(!Js)continue;na=ai.imageName,ft.iconsInText=ft.iconsInText||!0,qu=Js.paddedRect;const Dr=Js.displaySize;ai.scale=ai.scale*mr/sn,qi={width:Dr[0],height:Dr[1],left:As,top:-Km,advance:po?Dr[1]:Dr[0]},Us=Qr+(mr-Dr[1]*ai.scale),ia=qi.advance;const Aa=po?Dr[0]*ai.scale-mr*Ir:Dr[1]*ai.scale-mr*Ir;Aa>0&&Aa>Gr&&(Gr=Aa)}else{const Js=Wt[ai.fontStack],Dr=Js&&Js[Li];if(Dr&&Dr.rect)qu=Dr.rect,qi=Dr.metrics;else{const Aa=Et[ai.fontStack],ah=Aa&&Aa[Li];if(!ah)continue;qi=ah.metrics}Us=(Ir-ai.scale)*mr}po?(ft.verticalizable=!0,ms.push({glyph:Li,imageName:na,x:kn,y:xi+Us,vertical:po,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:ki,metrics:qi,rect:qu}),kn+=ia*ai.scale+vt):(ms.push({glyph:Li,imageName:na,x:kn,y:xi+Us,vertical:po,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:ki,metrics:qi,rect:qu}),kn+=qi.advance*ai.scale+vt)}ms.length!==0&&(yi=Math.max(kn-vt,yi),Ib(ms,0,ms.length-1,fo,Gr)),kn=0;const Ys=Gt*Ir+Gr;Vr.lineOffset=Math.max(Gr,Qr),xi+=Ys,wr=Math.max(Ys,wr),++qr}var kr;const fs=xi-eh,{horizontalAlign:ds,verticalAlign:ps}=zd(an);(function(Ki,Ir,Qr,Vr,ms,Gr,Ys,Ts,ai){const ki=(Ir-Qr)*ms;let Li=0;Li=Gr!==Ys?-Ts*Vr-eh:(-Vr*ai+.5)*Ys;for(const Us of Ki)for(const qi of Us.positionedGlyphs)qi.x+=ki,qi.y+=Li})(ft.positionedLines,fo,ds,ps,yi,wr,Gt,fs,Ht.length),ft.top+=-ps*fs,ft.bottom=ft.top+fs,ft.left+=-ds*yi,ft.right=ft.left+yi}(et,i,u,g,Le,A,M,P,Z,F,W,oe),!function(ft){for(const Et of ft)if(Et.positionedGlyphs.length!==0)return!1;return!0}(Ge)&&et}const af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},wb={40:!0};function Jm(o,i,u,g,v,E){if(i.imageName){const A=g[i.imageName];return A?A.displaySize[0]*i.scale*mr/E+v:0}{const A=u[i.fontStack],M=A&&A[o];return M?M.metrics.advance*i.scale+v:0}}function Qm(o,i,u,g){const v=Math.pow(o-i,2);return g?o<i?v/2:2*v:v+Math.abs(u)*u}function kb(o,i,u){let g=0;return o===10&&(g-=1e4),u&&(g+=150),o!==40&&o!==65288||(g+=50),i!==41&&i!==65289||(g+=50),g}function eg(o,i,u,g,v,E){let A=null,M=Qm(i,u,v,E);for(const P of g){const F=Qm(i-P.x,u,v,E)+P.badness;F<=M&&(A=P,M=F)}return{index:o,x:i,priorBreak:A,badness:M}}function tg(o){return o?tg(o.priorBreak).concat(o.index):[]}function Nd(o,i,u,g,v,E){if(!o)return[];const A=[],M=function(Z,W,te,oe,de,Le){let De=0;for(let it=0;it<Z.length();it++){const Ge=Z.getSection(it);De+=Jm(Z.getCharCode(it),Ge,oe,de,W,Le)}return De/Math.max(1,Math.ceil(De/te))}(o,i,u,g,v,E),P=o.text.indexOf("")>=0;let F=0;for(let Z=0;Z<o.length();Z++){const W=o.getSection(Z),te=o.getCharCode(Z);if(af[te]||(F+=Jm(te,W,g,v,i,E)),Z<o.length()-1){const oe=!((j=te)<11904)&&(!!Hn["CJK Compatibility Forms"](j)||!!Hn["CJK Compatibility"](j)||!!Hn["CJK Strokes"](j)||!!Hn["CJK Symbols and Punctuation"](j)||!!Hn["Enclosed CJK Letters and Months"](j)||!!Hn["Halfwidth and Fullwidth Forms"](j)||!!Hn["Ideographic Description Characters"](j)||!!Hn["Vertical Forms"](j)||Vh.test(String.fromCodePoint(j)));(xb[te]||oe||W.imageName||Z!==o.length()-2&&wb[o.getCharCode(Z+1)])&&A.push(eg(Z+1,F,M,A,kb(te,o.getCharCode(Z+1),oe&&P),!1))}}var j;return tg(eg(o.length(),F,M,A,0,!0))}function zd(o){let i=.5,u=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:i,verticalAlign:u}}function Ib(o,i,u,g,v){if(!g&&!v)return;const E=o[u],A=(o[u].x+E.metrics.advance*E.scale)*g;for(let M=i;M<=u;M++)o[M].x-=A,o[M].y+=v}function Sb(o,i,u){const{horizontalAlign:g,verticalAlign:v}=zd(u),E=i[0]-o.displaySize[0]*g,A=i[1]-o.displaySize[1]*v;return{image:o,top:A,bottom:A+o.displaySize[1],left:E,right:E+o.displaySize[0]}}function ng(o){var i,u;let g=o.left,v=o.top,E=o.right-g,A=o.bottom-v;const M=(i=o.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",P=(u=o.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",F=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(P==="proportional"){if(M==="stretchOnly"&&E/A<F||M==="proportional"){const j=Math.ceil(A*F);g*=j/E,E=j}}else if(M==="proportional"&&P==="stretchOnly"&&F!==0&&E/A>F){const j=Math.ceil(E/F);v*=j/A,A=j}return{x1:g,y1:v,x2:g+E,y2:v+A}}function ig(o,i,u,g,v,E){const A=o.image;let M;if(A.content){const Le=A.content,De=A.pixelRatio||1;M=[Le[0]/De,Le[1]/De,A.displaySize[0]-Le[2]/De,A.displaySize[1]-Le[3]/De]}const P=i.left*E,F=i.right*E;let j,Z,W,te;u==="width"||u==="both"?(te=v[0]+P-g[3],Z=v[0]+F+g[1]):(te=v[0]+(P+F-A.displaySize[0])/2,Z=te+A.displaySize[0]);const oe=i.top*E,de=i.bottom*E;return u==="height"||u==="both"?(j=v[1]+oe-g[0],W=v[1]+de+g[2]):(j=v[1]+(oe+de-A.displaySize[1])/2,W=j+A.displaySize[1]),{image:A,top:j,right:Z,bottom:W,left:te,collisionPadding:M}}const nh=255,ta=128,fl=nh*ta;function rg(o,i){const{expression:u}=i;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ei(o+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:v}=u;let E=0;for(;E<g.length&&g[E]<=o;)E++;E=Math.max(0,E-1);let A=E;for(;A<g.length&&g[A]<o+1;)A++;A=Math.min(g.length-1,A);const M=g[E],P=g[A];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:P,minSize:u.evaluate(new Ei(M)),maxSize:u.evaluate(new Ei(P)),interpolationType:v}}}function Fd(o,i,u){let g="never";const v=o.get(i);return v?g=v:o.get(u)&&(g="always"),g}const Eb=cl.VectorTileFeature.types,Ab=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lf(o,i,u,g,v,E,A,M,P,F,j,Z,W){const te=M?Math.min(fl,Math.round(M[0])):0,oe=M?Math.min(fl,Math.round(M[1])):0;o.emplaceBack(i,u,Math.round(32*g),Math.round(32*v),E,A,(te<<1)+(P?1:0),oe,16*F,16*j,256*Z,256*W)}function Od(o,i,u){o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u)}function Tb(o){for(const i of o.sections)if(fd(i.text))return!0;return!1}class Bd{constructor(i){this.layoutVertexArray=new Au,this.indexArray=new Ws,this.programConfigurations=i,this.segments=new Xn,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new Os,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ai}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,u,g,v){this.isEmpty()||(g&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rb.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,sb.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Ab,!0),this.opacityVertexBuffer.itemSize=1),(g||v)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qt("SymbolBuffers",Bd);class Ud{constructor(i,u,g){this.layoutVertexArray=new i,this.layoutAttributes=u,this.indexArray=new g,this.segments=new Xn,this.collisionVertexArray=new Qo}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,ob.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Qt("CollisionBuffers",Ud);class Bu{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(A=>A.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vd([]),this.placementViewportMatrix=vd([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rg(this.zoom,u["text-size"]),this.iconSizeData=rg(this.zoom,u["icon-size"]);const g=this.layers[0].layout,v=g.get("symbol-sort-key"),E=g.get("symbol-z-order");this.canOverlap=Fd(g,"text-overlap","text-allow-overlap")!=="never"||Fd(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(A=>m.ah[A])),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.sourceID=i.sourceID}createArrays(){this.text=new Bd(new Xl(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Bd(new Xl(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Ti,this.lineVertexArray=new Or,this.symbolInstances=new Vn,this.textAnchorOffsets=new Ci}calculateGlyphDependencies(i,u,g,v,E){for(let A=0;A<i.length;A++)if(u[i.charCodeAt(A)]=!0,(g||v)&&E){const M=Qc[i.charAt(A)];M&&(u[M.charCodeAt(0)]=!0)}}populate(i,u,g){const v=this.layers[0],E=v.layout,A=E.get("text-font"),M=E.get("text-field"),P=E.get("icon-image"),F=(M.value.kind!=="constant"||M.value.value instanceof Cr&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),j=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Z=E.get("symbol-sort-key");if(this.features=[],!F&&!j)return;const W=u.iconDependencies,te=u.glyphDependencies,oe=u.availableImages,de=new Ei(this.zoom);for(const{feature:Le,id:De,index:it,sourceLayerIndex:Ge}of i){const et=v._featureFilter.needGeometry,ft=Kl(Le,et);if(!v._featureFilter.filter(de,ft,g))continue;let Et,Wt;if(et||(ft.geometry=Wl(Le)),F){const Ht=v.getValueAndResolveTokens("text-field",ft,g,oe),Gt=Cr.factory(Ht),an=this.hasRTLText=this.hasRTLText||Tb(Gt);(!an||Ss.getRTLTextPluginStatus()==="unavailable"||an&&Ss.isParsed())&&(Et=lb(Gt,v,ft))}if(j){const Ht=v.getValueAndResolveTokens("icon-image",ft,g,oe);Wt=Ht instanceof or?Ht:or.fromString(Ht)}if(!Et&&!Wt)continue;const _n=this.sortFeaturesByKey?Z.evaluate(ft,{},g):void 0;if(this.features.push({id:De,text:Et,icon:Wt,index:it,sourceLayerIndex:Ge,geometry:ft.geometry,properties:Le.properties,type:Eb[Le.type],sortKey:_n}),Wt&&(W[Wt.name]=!0),Et){const Ht=A.evaluate(ft,{},g).join(","),Gt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const an of Et.sections)if(an.image)W[an.image.name]=!0;else{const tn=Oc(Et.toString()),Yt=an.fontStack||Ht,vt=te[Yt]=te[Yt]||{};this.calculateGlyphDependencies(an.text,vt,Gt,this.allowVerticalPlacement,tn)}}}E.get("symbol-placement")==="line"&&(this.features=function(Le){const De={},it={},Ge=[];let et=0;function ft(Ht){Ge.push(Le[Ht]),et++}function Et(Ht,Gt,an){const tn=it[Ht];return delete it[Ht],it[Gt]=tn,Ge[tn].geometry[0].pop(),Ge[tn].geometry[0]=Ge[tn].geometry[0].concat(an[0]),tn}function Wt(Ht,Gt,an){const tn=De[Gt];return delete De[Gt],De[Ht]=tn,Ge[tn].geometry[0].shift(),Ge[tn].geometry[0]=an[0].concat(Ge[tn].geometry[0]),tn}function _n(Ht,Gt,an){const tn=an?Gt[0][Gt[0].length-1]:Gt[0][0];return`${Ht}:${tn.x}:${tn.y}`}for(let Ht=0;Ht<Le.length;Ht++){const Gt=Le[Ht],an=Gt.geometry,tn=Gt.text?Gt.text.toString():null;if(!tn){ft(Ht);continue}const Yt=_n(tn,an),vt=_n(tn,an,!0);if(Yt in it&&vt in De&&it[Yt]!==De[vt]){const cn=Wt(Yt,vt,an),sn=Et(Yt,vt,Ge[cn].geometry);delete De[Yt],delete it[vt],it[_n(tn,Ge[sn].geometry,!0)]=sn,Ge[cn].geometry=null}else Yt in it?Et(Yt,vt,an):vt in De?Wt(Yt,vt,an):(ft(Ht),De[Yt]=et-1,it[vt]=et-1)}return Ge.filter(Ht=>Ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Le,De)=>Le.sortKey-De.sortKey)}update(i,u,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,u,this.layers,g),this.icon.programConfigurations.updatePaintArrays(i,u,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,u){const g=this.lineVertexArray.length;if(i.segment!==void 0){let v=i.dist(u[i.segment+1]),E=i.dist(u[i.segment]);const A={};for(let M=i.segment+1;M<u.length;M++)A[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:v},M<u.length-1&&(v+=u[M+1].dist(u[M]));for(let M=i.segment||0;M>=0;M--)A[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:E},M>0&&(E+=u[M-1].dist(u[M]));for(let M=0;M<u.length;M++){const P=A[M];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(i,u,g,v,E,A,M,P,F,j,Z,W){const te=i.indexArray,oe=i.layoutVertexArray,de=i.segments.prepareSegment(4*u.length,oe,te,this.canOverlap?A.sortKey:void 0),Le=this.glyphOffsetArray.length,De=de.vertexLength,it=this.allowVerticalPlacement&&M===m.ah.vertical?Math.PI/2:0,Ge=A.text&&A.text.sections;for(let et=0;et<u.length;et++){const{tl:ft,tr:Et,bl:Wt,br:_n,tex:Ht,pixelOffsetTL:Gt,pixelOffsetBR:an,minFontScaleX:tn,minFontScaleY:Yt,glyphOffset:vt,isSDF:cn,sectionIndex:sn}=u[et],kn=de.vertexLength,xi=vt[1];lf(oe,P.x,P.y,ft.x,xi+ft.y,Ht.x,Ht.y,g,cn,Gt.x,Gt.y,tn,Yt),lf(oe,P.x,P.y,Et.x,xi+Et.y,Ht.x+Ht.w,Ht.y,g,cn,an.x,Gt.y,tn,Yt),lf(oe,P.x,P.y,Wt.x,xi+Wt.y,Ht.x,Ht.y+Ht.h,g,cn,Gt.x,an.y,tn,Yt),lf(oe,P.x,P.y,_n.x,xi+_n.y,Ht.x+Ht.w,Ht.y+Ht.h,g,cn,an.x,an.y,tn,Yt),Od(i.dynamicLayoutVertexArray,P,it),te.emplaceBack(kn,kn+1,kn+2),te.emplaceBack(kn+1,kn+2,kn+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(vt[0]),et!==u.length-1&&sn===u[et+1].sectionIndex||i.programConfigurations.populatePaintArrays(oe.length,A,A.index,{},W,Ge&&Ge[sn])}i.placedSymbolArray.emplaceBack(P.x,P.y,Le,this.glyphOffsetArray.length-Le,De,F,j,P.segment,g?g[0]:0,g?g[1]:0,v[0],v[1],M,0,!1,0,Z)}_addCollisionDebugVertex(i,u,g,v,E,A){return u.emplaceBack(0,0),i.emplaceBack(g.x,g.y,v,E,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(i,u,g,v,E,A,M){const P=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=P.vertexLength,j=E.layoutVertexArray,Z=E.collisionVertexArray,W=M.anchorX,te=M.anchorY;this._addCollisionDebugVertex(j,Z,A,W,te,new C(i,u)),this._addCollisionDebugVertex(j,Z,A,W,te,new C(g,u)),this._addCollisionDebugVertex(j,Z,A,W,te,new C(g,v)),this._addCollisionDebugVertex(j,Z,A,W,te,new C(i,v)),P.vertexLength+=4;const oe=E.indexArray;oe.emplaceBack(F,F+1),oe.emplaceBack(F+1,F+2),oe.emplaceBack(F+2,F+3),oe.emplaceBack(F+3,F),P.primitiveLength+=4}addDebugCollisionBoxes(i,u,g,v){for(let E=i;E<u;E++){const A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ud(Bs,jm.members,Pr),this.iconCollisionBox=new Ud(Bs,jm.members,Pr);for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(i,u,g,v,E,A,M,P,F){const j={};for(let Z=u;Z<g;Z++){const W=i.get(Z);j.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.textFeatureIndex=W.featureIndex;break}for(let Z=v;Z<E;Z++){const W=i.get(Z);j.verticalTextBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.verticalTextFeatureIndex=W.featureIndex;break}for(let Z=A;Z<M;Z++){const W=i.get(Z);j.iconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.iconFeatureIndex=W.featureIndex;break}for(let Z=P;Z<F;Z++){const W=i.get(Z);j.verticalIconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.verticalIconFeatureIndex=W.featureIndex;break}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const g=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,u){const g=i.placedSymbolArray.get(u),v=g.vertexStartIndex+4*g.numGlyphs;for(let E=g.vertexStartIndex;E<v;E+=4)i.indexArray.emplaceBack(E,E+1,E+2),i.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(i),g=Math.cos(i),v=[],E=[],A=[];for(let M=0;M<this.symbolInstances.length;++M){A.push(M);const P=this.symbolInstances.get(M);v.push(0|Math.round(u*P.anchorX+g*P.anchorY)),E.push(P.featureIndex)}return A.sort((M,P)=>v[M]-v[P]||E[P]-E[M]),A}addToSortKeyRanges(i,u){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===u?g.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const g=this.symbolInstances.get(u);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((v,E,A)=>{v>=0&&A.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let sg,og;Qt("SymbolBucket",Bu,{omit:["layers","collisionBoxArray","features","compareText"]}),Bu.MAX_GLYPHS=65535,Bu.addDynamicAttributes=Od;var jd={get paint(){return og=og||new k({"icon-opacity":new yn(Ke.paint_symbol["icon-opacity"]),"icon-color":new yn(Ke.paint_symbol["icon-color"]),"icon-halo-color":new yn(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new nn(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new nn(Ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new yn(Ke.paint_symbol["text-opacity"]),"text-color":new yn(Ke.paint_symbol["text-color"],{runtimeType:br,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new yn(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new yn(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(Ke.paint_symbol["text-halo-blur"]),"text-translate":new nn(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new nn(Ke.paint_symbol["text-translate-anchor"])})},get layout(){return sg=sg||new k({"symbol-placement":new nn(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new nn(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nn(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nn(Ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nn(Ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nn(Ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nn(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new nn(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nn(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(Ke.layout_symbol["icon-size"]),"icon-text-fit":new nn(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nn(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(Ke.layout_symbol["icon-image"]),"icon-rotate":new yn(Ke.layout_symbol["icon-rotate"]),"icon-padding":new yn(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new nn(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(Ke.layout_symbol["icon-offset"]),"icon-anchor":new yn(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nn(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nn(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nn(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new yn(Ke.layout_symbol["text-field"]),"text-font":new yn(Ke.layout_symbol["text-font"]),"text-size":new yn(Ke.layout_symbol["text-size"]),"text-max-width":new yn(Ke.layout_symbol["text-max-width"]),"text-line-height":new nn(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new yn(Ke.layout_symbol["text-justify"]),"text-radial-offset":new yn(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nn(Ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new yn(Ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new yn(Ke.layout_symbol["text-anchor"]),"text-max-angle":new nn(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new nn(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new yn(Ke.layout_symbol["text-rotate"]),"text-padding":new nn(Ke.layout_symbol["text-padding"]),"text-keep-upright":new nn(Ke.layout_symbol["text-keep-upright"]),"text-transform":new yn(Ke.layout_symbol["text-transform"]),"text-offset":new yn(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new nn(Ke.layout_symbol["text-allow-overlap"]),"text-overlap":new nn(Ke.layout_symbol["text-overlap"]),"text-ignore-placement":new nn(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new nn(Ke.layout_symbol["text-optional"])})}};class ag{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Rs,this.defaultValue=i}evaluate(i){if(i.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(i.formattedSection))return u.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt("FormatSectionOverride",ag,{omit:["defaultValue"]});class uf extends f{constructor(i){super(i,jd)}recalculate(i,u){if(super.recalculate(i,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const v=[];for(const E of g)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,u,g,v){const E=this.layout.get(i).evaluate(u,{},g,v),A=this._unevaluatedLayout._values[i];return A.isDataDriven()||b(A.value)||!E?E:function(M,P){return P.replace(/{([^{}]+)}/g,(F,j)=>M&&j in M?String(M[j]):"")}(u.properties,E)}createBucket(i){return new Bu(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of jd.paint.overridableProperties){if(!uf.hasPaintOverride(this.layout,i))continue;const u=this.paint.get(i),g=new ag(u),v=new p(g,u.property.specification);let E=null;E=u.value.kind==="constant"||u.value.kind==="source"?new O("source",v):new V("composite",v,u.value.zoomStops),this.paint._values[i]=new co(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(i,u,g){return!(!this.layout||u.isDataDriven()||g.isDataDriven())&&uf.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,u){const g=i.get("text-field"),v=jd.paint.properties[u];let E=!1;const A=M=>{for(const P of M)if(v.overrides&&v.overrides.hasOverride(P))return void(E=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Cr)A(g.value.value.sections);else if(g.value.kind==="source"){const M=F=>{E||(F instanceof ys&&zi(F.value)===Ar?A(F.value.sections):F instanceof ga?A(F.sections):F.eachChild(M))},P=g.value;P._styleExpression&&M(P._styleExpression.expression)}return E}}let lg;var Cb={get paint(){return lg=lg||new k({"background-color":new nn(Ke.paint_background["background-color"]),"background-pattern":new Su(Ke.paint_background["background-pattern"]),"background-opacity":new nn(Ke.paint_background["background-opacity"])})}};class Lb extends f{constructor(i){super(i,Cb)}}let ug;var Mb={get paint(){return ug=ug||new k({"raster-opacity":new nn(Ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new nn(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nn(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nn(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new nn(Ke.paint_raster["raster-saturation"]),"raster-contrast":new nn(Ke.paint_raster["raster-contrast"]),"raster-resampling":new nn(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new nn(Ke.paint_raster["raster-fade-duration"])})}};class Rb extends f{constructor(i){super(i,Mb)}}class Pb extends f{constructor(i){super(i,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Db{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const qd=63710088e-1;class dl{constructor(i,u){if(isNaN(i)||isNaN(u))throw new Error(`Invalid LngLat object: (${i}, ${u})`);if(this.lng=+i,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dl(Ee(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const u=Math.PI/180,g=this.lat*u,v=i.lat*u,E=Math.sin(g)*Math.sin(v)+Math.cos(g)*Math.cos(v)*Math.cos((i.lng-this.lng)*u);return qd*Math.acos(Math.min(E,1))}static convert(i){if(i instanceof dl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new dl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new dl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const cg=2*Math.PI*qd;function hg(o){return cg*Math.cos(o*Math.PI/180)}function fg(o){return(180+o)/360}function dg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function pg(o,i){return o/hg(i)}function Vd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class ih{constructor(i,u,g=0){this.x=+i,this.y=+u,this.z=+g}static fromLngLat(i,u=0){const g=dl.convert(i);return new ih(fg(g.lng),dg(g.lat),pg(u,g.lat))}toLngLat(){return new dl(360*this.x-180,Vd(this.y))}toAltitude(){return this.z*hg(Vd(this.y))}meterInMercatorCoordinateUnits(){return 1/cg*(i=Vd(this.y),1/Math.cos(i*Math.PI/180));var i}}function mg(o,i,u){var g=2*Math.PI*6378137/256/Math.pow(2,u);return[o*g-2*Math.PI*6378137/2,i*g-2*Math.PI*6378137/2]}class Gd{constructor(i,u,g){if(!function(v,E,A){return!(v<0||v>25||A<0||A>=Math.pow(2,v)||E<0||E>=Math.pow(2,v))}(i,u,g))throw new Error(`x=${u}, y=${g}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=u,this.y=g,this.key=rh(0,i,i,u,g)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,u,g){const v=(A=this.y,M=this.z,P=mg(256*(E=this.x),256*(A=Math.pow(2,M)-A-1),M),F=mg(256*(E+1),256*(A+1),M),P[0]+","+P[1]+","+F[0]+","+F[1]);var E,A,M,P,F;const j=function(Z,W,te){let oe,de="";for(let Le=Z;Le>0;Le--)oe=1<<Le-1,de+=(W&oe?1:0)+(te&oe?2:0);return de}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,v)}isChildOf(i){const u=this.z-i.z;return u>0&&i.x===this.x>>u&&i.y===this.y>>u}getTilePoint(i){const u=Math.pow(2,this.z);return new C((i.x*u-this.x)*ar,(i.y*u-this.y)*ar)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gg{constructor(i,u){this.wrap=i,this.canonical=u,this.key=rh(i,u.z,u.z,u.x,u.y)}}class $s{constructor(i,u,g,v,E){if(i<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${g}`);this.overscaledZ=i,this.wrap=u,this.canonical=new Gd(g,+v,+E),this.key=rh(u,i,g,v,E)}clone(){return new $s(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-i;return i>this.canonical.z?new $s(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $s(i,this.wrap,i,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(i,u){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-i;return i>this.canonical.z?rh(this.wrap*+u,i,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+u,i,i,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const u=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>u&&i.canonical.y===this.canonical.y>>u}children(i){if(this.overscaledZ>=i)return[new $s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,g=2*this.canonical.x,v=2*this.canonical.y;return[new $s(u,this.wrap,u,g,v),new $s(u,this.wrap,u,g+1,v),new $s(u,this.wrap,u,g,v+1),new $s(u,this.wrap,u,g+1,v+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new $s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new $s(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new ih(i.x-this.wrap,i.y))}}function rh(o,i,u,g,v){(o*=2)<0&&(o=-1*o-1);const E=1<<u;return(E*E*o+E*v+g).toString(36)+u.toString(36)+i.toString(36)}Qt("CanonicalTileID",Gd),Qt("OverscaledTileID",$s,{omit:["posMatrix"]});class _g{constructor(i,u,g,v=1,E=1,A=1,M=0){if(this.uid=i,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void tt(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const P=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=A,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<P;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(P,F)]=this.data[this._idx(P-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,P)]=this.data[this._idx(F,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<P;F++)for(let j=0;j<P;j++){const Z=this.get(F,j);Z>this.max&&(this.max=Z),Z<this.min&&(this.min=Z)}}get(i,u){const g=new Uint8Array(this.data.buffer),v=4*this._idx(i,u);return this.unpack(g[v],g[v+1],g[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,u){if(i<-1||i>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(i+1)}unpack(i,u,g){return i*this.redFactor+u*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Ks({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,u,g){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let v=u*this.dim,E=u*this.dim+this.dim,A=g*this.dim,M=g*this.dim+this.dim;switch(u){case-1:v=E-1;break;case 1:E=v+1}switch(g){case-1:A=M-1;break;case 1:M=A+1}const P=-u*this.dim,F=-g*this.dim;for(let j=A;j<M;j++)for(let Z=v;Z<E;Z++)this.data[this._idx(Z,j)]=i.data[this._idx(Z+P,j+F)]}}Qt("DEMData",_g);class yg{constructor(i){this._stringToNumber={},this._numberToString=[];for(let u=0;u<i.length;u++){const g=i[u];this._stringToNumber[g]=u,this._numberToString[u]=g}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class vg{constructor(i,u,g,v,E){this.type="Feature",this._vectorTileFeature=i,i._z=u,i._x=g,i._y=v,this.properties=i.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(i[u]=this[u]);return i}}class bg{constructor(i,u){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Qa(ar,16,0),this.grid3D=new Qa(ar,16,0),this.featureIndexArray=new Yr,this.promoteId=u}insert(i,u,g,v,E,A){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,v,E);const P=A?this.grid3D:this.grid;for(let F=0;F<u.length;F++){const j=u[F],Z=[1/0,1/0,-1/0,-1/0];for(let W=0;W<j.length;W++){const te=j[W];Z[0]=Math.min(Z[0],te.x),Z[1]=Math.min(Z[1],te.y),Z[2]=Math.max(Z[2],te.x),Z[3]=Math.max(Z[3],te.y)}Z[0]<ar&&Z[1]<ar&&Z[2]>=0&&Z[3]>=0&&P.insert(M,Z[0],Z[1],Z[2],Z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new cl.VectorTile(new Rd(this.rawTileData)).layers,this.sourceLayerCoder=new yg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,u,g,v){this.loadVTLayers();const E=i.params||{},A=ar/i.tileSize/i.scale,M=Ft(E.filter),P=i.queryGeometry,F=i.queryPadding*A,j=wg(P),Z=this.grid.query(j.minX-F,j.minY-F,j.maxX+F,j.maxY+F),W=wg(i.cameraQueryGeometry),te=this.grid3D.query(W.minX-F,W.minY-F,W.maxX+F,W.maxY+F,(Le,De,it,Ge)=>function(et,ft,Et,Wt,_n){for(const Gt of et)if(ft<=Gt.x&&Et<=Gt.y&&Wt>=Gt.x&&_n>=Gt.y)return!0;const Ht=[new C(ft,Et),new C(ft,_n),new C(Wt,_n),new C(Wt,Et)];if(et.length>2){for(const Gt of Ht)if(Ru(et,Gt))return!0}for(let Gt=0;Gt<et.length-1;Gt++)if(p1(et[Gt],et[Gt+1],Ht))return!0;return!1}(i.cameraQueryGeometry,Le-F,De-F,it+F,Ge+F));for(const Le of te)Z.push(Le);Z.sort(Nb);const oe={};let de;for(let Le=0;Le<Z.length;Le++){const De=Z[Le];if(De===de)continue;de=De;const it=this.featureIndexArray.get(De);let Ge=null;this.loadMatchingFeature(oe,it.bucketIndex,it.sourceLayerIndex,it.featureIndex,M,E.layers,E.availableImages,u,g,v,(et,ft,Et)=>(Ge||(Ge=Wl(et)),ft.queryIntersectsFeature(P,et,Et,Ge,this.z,i.transform,A,i.pixelPosMatrix)))}return oe}loadMatchingFeature(i,u,g,v,E,A,M,P,F,j,Z){const W=this.bucketLayerIDs[u];if(A&&!function(Le,De){for(let it=0;it<Le.length;it++)if(De.indexOf(Le[it])>=0)return!0;return!1}(A,W))return;const te=this.sourceLayerCoder.decode(g),oe=this.vtLayers[te].feature(v);if(E.needGeometry){const Le=Kl(oe,!0);if(!E.filter(new Ei(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!E.filter(new Ei(this.tileID.overscaledZ),oe))return;const de=this.getId(oe,te);for(let Le=0;Le<W.length;Le++){const De=W[Le];if(A&&A.indexOf(De)<0)continue;const it=P[De];if(!it)continue;let Ge={};de&&j&&(Ge=j.getState(it.sourceLayer||"_geojsonTileLayer",de));const et=ye({},F[De]);et.paint=xg(et.paint,it.paint,oe,Ge,M),et.layout=xg(et.layout,it.layout,oe,Ge,M);const ft=!Z||Z(oe,it,Ge);if(!ft)continue;const Et=new vg(oe,this.z,this.x,this.y,de);Et.layer=et;let Wt=i[De];Wt===void 0&&(Wt=i[De]=[]),Wt.push({featureIndex:v,feature:Et,intersectionZ:ft})}}lookupSymbolFeatures(i,u,g,v,E,A,M,P){const F={};this.loadVTLayers();const j=Ft(E);for(const Z of i)this.loadMatchingFeature(F,g,v,Z,j,A,M,P,u);return F}hasLayer(i){for(const u of this.bucketLayerIDs)for(const g of u)if(i===g)return!0;return!1}getId(i,u){let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof g=="boolean"&&(g=Number(g))),g}}function xg(o,i,u,g,v){return ve(o,(E,A)=>{const M=i instanceof Gl?i.get(A):null;return M&&M.evaluate?M.evaluate(u,g,v):M})}function wg(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return{minX:i,minY:u,maxX:g,maxY:v}}function Nb(o,i){return i-o}function kg(o,i,u,g,v){const E=[];for(let A=0;A<o.length;A++){const M=o[A];let P;for(let F=0;F<M.length-1;F++){let j=M[F],Z=M[F+1];j.x<i&&Z.x<i||(j.x<i?j=new C(i,j.y+(i-j.x)/(Z.x-j.x)*(Z.y-j.y))._round():Z.x<i&&(Z=new C(i,j.y+(i-j.x)/(Z.x-j.x)*(Z.y-j.y))._round()),j.y<u&&Z.y<u||(j.y<u?j=new C(j.x+(u-j.y)/(Z.y-j.y)*(Z.x-j.x),u)._round():Z.y<u&&(Z=new C(j.x+(u-j.y)/(Z.y-j.y)*(Z.x-j.x),u)._round()),j.x>=g&&Z.x>=g||(j.x>=g?j=new C(g,j.y+(g-j.x)/(Z.x-j.x)*(Z.y-j.y))._round():Z.x>=g&&(Z=new C(g,j.y+(g-j.x)/(Z.x-j.x)*(Z.y-j.y))._round()),j.y>=v&&Z.y>=v||(j.y>=v?j=new C(j.x+(v-j.y)/(Z.y-j.y)*(Z.x-j.x),v)._round():Z.y>=v&&(Z=new C(j.x+(v-j.y)/(Z.y-j.y)*(Z.x-j.x),v)._round()),P&&j.equals(P[P.length-1])||(P=[j],E.push(P)),P.push(Z)))))}}return E}Qt("FeatureIndex",bg,{omit:["rawTileData","sourceLayerCoder"]});class pl extends C{constructor(i,u,g,v){super(i,u),this.angle=g,v!==void 0&&(this.segment=v)}clone(){return new pl(this.x,this.y,this.angle,this.segment)}}function Ig(o,i,u,g,v){if(i.segment===void 0||u===0)return!0;let E=i,A=i.segment+1,M=0;for(;M>-u/2;){if(A--,A<0)return!1;M-=o[A].dist(E),E=o[A]}M+=o[A].dist(o[A+1]),A++;const P=[];let F=0;for(;M<u/2;){const j=o[A],Z=o[A+1];if(!Z)return!1;let W=o[A-1].angleTo(j)-j.angleTo(Z);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:W}),F+=W;M-P[0].distance>g;)F-=P.shift().angleDelta;if(F>v)return!1;A++,M+=j.dist(Z)}return!0}function Sg(o){let i=0;for(let u=0;u<o.length-1;u++)i+=o[u].dist(o[u+1]);return i}function Eg(o,i,u){return o?.6*i*u:0}function Ag(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function zb(o,i,u,g,v,E){const A=Eg(u,v,E),M=Ag(u,g)*E;let P=0;const F=Sg(o)/2;for(let j=0;j<o.length-1;j++){const Z=o[j],W=o[j+1],te=Z.dist(W);if(P+te>F){const oe=(F-P)/te,de=wi.number(Z.x,W.x,oe),Le=wi.number(Z.y,W.y,oe),De=new pl(de,Le,W.angleTo(Z),j);return De._round(),!A||Ig(o,De,M,A,i)?De:void 0}P+=te}}function Fb(o,i,u,g,v,E,A,M,P){const F=Eg(g,E,A),j=Ag(g,v),Z=j*A,W=o[0].x===0||o[0].x===P||o[0].y===0||o[0].y===P;return i-Z<i/4&&(i=Z+i/4),Tg(o,W?i/2*M%i:(j/2+2*E)*A*M%i,i,F,u,Z,W,!1,P)}function Tg(o,i,u,g,v,E,A,M,P){const F=E/2,j=Sg(o);let Z=0,W=i-u,te=[];for(let oe=0;oe<o.length-1;oe++){const de=o[oe],Le=o[oe+1],De=de.dist(Le),it=Le.angleTo(de);for(;W+u<Z+De;){W+=u;const Ge=(W-Z)/De,et=wi.number(de.x,Le.x,Ge),ft=wi.number(de.y,Le.y,Ge);if(et>=0&&et<P&&ft>=0&&ft<P&&W-F>=0&&W+F<=j){const Et=new pl(et,ft,it,oe);Et._round(),g&&!Ig(o,Et,E,g,v)||te.push(Et)}}Z+=De}return M||te.length||A||(te=Tg(o,Z/2,u,g,v,E,A,!0,P)),te}Qt("Anchor",pl);const Uu=As;function Cg(o,i,u,g){const v=[],E=o.image,A=E.pixelRatio,M=E.paddedRect.w-2*Uu,P=E.paddedRect.h-2*Uu;let F={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const j=E.stretchX||[[0,M]],Z=E.stretchY||[[0,P]],W=(vt,cn)=>vt+cn[1]-cn[0],te=j.reduce(W,0),oe=Z.reduce(W,0),de=M-te,Le=P-oe;let De=0,it=te,Ge=0,et=oe,ft=0,Et=de,Wt=0,_n=Le;if(E.content&&g){const vt=E.content,cn=vt[2]-vt[0],sn=vt[3]-vt[1];(E.textFitWidth||E.textFitHeight)&&(F=ng(o)),De=cf(j,0,vt[0]),Ge=cf(Z,0,vt[1]),it=cf(j,vt[0],vt[2]),et=cf(Z,vt[1],vt[3]),ft=vt[0]-De,Wt=vt[1]-Ge,Et=cn-it,_n=sn-et}const Ht=F.x1,Gt=F.y1,an=F.x2-Ht,tn=F.y2-Gt,Yt=(vt,cn,sn,kn)=>{const xi=hf(vt.stretch-De,it,an,Ht),yi=ff(vt.fixed-ft,Et,vt.stretch,te),wr=hf(cn.stretch-Ge,et,tn,Gt),fo=ff(cn.fixed-Wt,_n,cn.stretch,oe),qr=hf(sn.stretch-De,it,an,Ht),kr=ff(sn.fixed-ft,Et,sn.stretch,te),fs=hf(kn.stretch-Ge,et,tn,Gt),ds=ff(kn.fixed-Wt,_n,kn.stretch,oe),ps=new C(xi,wr),Ki=new C(qr,wr),Ir=new C(qr,fs),Qr=new C(xi,fs),Vr=new C(yi/A,fo/A),ms=new C(kr/A,ds/A),Gr=i*Math.PI/180;if(Gr){const ai=Math.sin(Gr),ki=Math.cos(Gr),Li=[ki,-ai,ai,ki];ps._matMult(Li),Ki._matMult(Li),Qr._matMult(Li),Ir._matMult(Li)}const Ys=vt.stretch+vt.fixed,Ts=cn.stretch+cn.fixed;return{tl:ps,tr:Ki,bl:Qr,br:Ir,tex:{x:E.paddedRect.x+Uu+Ys,y:E.paddedRect.y+Uu+Ts,w:sn.stretch+sn.fixed-Ys,h:kn.stretch+kn.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:ms,minFontScaleX:Et/A/an,minFontScaleY:_n/A/tn,isSDF:u}};if(g&&(E.stretchX||E.stretchY)){const vt=Lg(j,de,te),cn=Lg(Z,Le,oe);for(let sn=0;sn<vt.length-1;sn++){const kn=vt[sn],xi=vt[sn+1];for(let yi=0;yi<cn.length-1;yi++)v.push(Yt(kn,cn[yi],xi,cn[yi+1]))}}else v.push(Yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return v}function cf(o,i,u){let g=0;for(const v of o)g+=Math.max(i,Math.min(u,v[1]))-Math.max(i,Math.min(u,v[0]));return g}function Lg(o,i,u){const g=[{fixed:-Uu,stretch:0}];for(const[v,E]of o){const A=g[g.length-1];g.push({fixed:v-A.stretch,stretch:A.stretch}),g.push({fixed:v-A.stretch,stretch:A.stretch+(E-v)})}return g.push({fixed:i+Uu,stretch:u}),g}function hf(o,i,u,g){return o/i*u+g}function ff(o,i,u,g){return o-i*u/g}class df{constructor(i,u,g,v,E,A,M,P,F,j){var Z;if(this.boxStartIndex=i.length,F){let W=A.top,te=A.bottom;const oe=A.collisionPadding;oe&&(W-=oe[1],te+=oe[3]);let de=te-W;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{const W=!((Z=A.image)===null||Z===void 0)&&Z.content&&(A.image.textFitWidth||A.image.textFitHeight)?ng(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};W.y1=W.y1*M-P[0],W.y2=W.y2*M+P[2],W.x1=W.x1*M-P[3],W.x2=W.x2*M+P[1];const te=A.collisionPadding;if(te&&(W.x1-=te[0]*M,W.y1-=te[1]*M,W.x2+=te[2]*M,W.y2+=te[3]*M),j){const oe=new C(W.x1,W.y1),de=new C(W.x2,W.y1),Le=new C(W.x1,W.y2),De=new C(W.x2,W.y2),it=j*Math.PI/180;oe._rotate(it),de._rotate(it),Le._rotate(it),De._rotate(it),W.x1=Math.min(oe.x,de.x,Le.x,De.x),W.x2=Math.max(oe.x,de.x,Le.x,De.x),W.y1=Math.min(oe.y,de.y,Le.y,De.y),W.y2=Math.max(oe.y,de.y,Le.y,De.y)}i.emplaceBack(u.x,u.y,W.x1,W.y1,W.x2,W.y2,g,v,E)}this.boxEndIndex=i.length}}class Ob{constructor(i=[],u=(g,v)=>g<v?-1:g>v?1:0){if(this.data=i,this.length=this.data.length,this.compare=u,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:u,compare:g}=this,v=u[i];for(;i>0;){const E=i-1>>1,A=u[E];if(g(v,A)>=0)break;u[i]=A,i=E}u[i]=v}_down(i){const{data:u,compare:g}=this,v=this.length>>1,E=u[i];for(;i<v;){let A=1+(i<<1);const M=A+1;if(M<this.length&&g(u[M],u[A])<0&&(A=M),g(u[A],E)>=0)break;u[i]=u[A],i=A}u[i]=E}}function Bb(o,i=1,u=!1){let g=1/0,v=1/0,E=-1/0,A=-1/0;const M=o[0];for(let te=0;te<M.length;te++){const oe=M[te];(!te||oe.x<g)&&(g=oe.x),(!te||oe.y<v)&&(v=oe.y),(!te||oe.x>E)&&(E=oe.x),(!te||oe.y>A)&&(A=oe.y)}const P=Math.min(E-g,A-v);let F=P/2;const j=new Ob([],Ub);if(P===0)return new C(g,v);for(let te=g;te<E;te+=P)for(let oe=v;oe<A;oe+=P)j.push(new ju(te+F,oe+F,F,o));let Z=function(te){let oe=0,de=0,Le=0;const De=te[0];for(let it=0,Ge=De.length,et=Ge-1;it<Ge;et=it++){const ft=De[it],Et=De[et],Wt=ft.x*Et.y-Et.x*ft.y;de+=(ft.x+Et.x)*Wt,Le+=(ft.y+Et.y)*Wt,oe+=3*Wt}return new ju(de/oe,Le/oe,0,te)}(o),W=j.length;for(;j.length;){const te=j.pop();(te.d>Z.d||!Z.d)&&(Z=te,u&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,W)),te.max-Z.d<=i||(F=te.h/2,j.push(new ju(te.p.x-F,te.p.y-F,F,o)),j.push(new ju(te.p.x+F,te.p.y-F,F,o)),j.push(new ju(te.p.x-F,te.p.y+F,F,o)),j.push(new ju(te.p.x+F,te.p.y+F,F,o)),W+=4)}return u&&(console.log(`num probes: ${W}`),console.log(`best distance: ${Z.d}`)),Z.p}function Ub(o,i){return i.max-o.max}function ju(o,i,u,g){this.p=new C(o,i),this.h=u,this.d=function(v,E){let A=!1,M=1/0;for(let P=0;P<E.length;P++){const F=E[P];for(let j=0,Z=F.length,W=Z-1;j<Z;W=j++){const te=F[j],oe=F[W];te.y>v.y!=oe.y>v.y&&v.x<(oe.x-te.x)*(v.y-te.y)/(oe.y-te.y)+te.x&&(A=!A),M=Math.min(M,dm(v,te,oe))}}return(A?1:-1)*Math.sqrt(M)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var jr;m.aq=void 0,(jr=m.aq||(m.aq={}))[jr.center=1]="center",jr[jr.left=2]="left",jr[jr.right=3]="right",jr[jr.top=4]="top",jr[jr.bottom=5]="bottom",jr[jr["top-left"]=6]="top-left",jr[jr["top-right"]=7]="top-right",jr[jr["bottom-left"]=8]="bottom-left",jr[jr["bottom-right"]=9]="bottom-right";const ml=7,Zd=Number.POSITIVE_INFINITY;function Mg(o,i){return i[1]!==Zd?function(u,g,v){let E=0,A=0;switch(g=Math.abs(g),v=Math.abs(v),u){case"top-right":case"top-left":case"top":A=v-ml;break;case"bottom-right":case"bottom-left":case"bottom":A=-v+ml}switch(u){case"top-right":case"bottom-right":case"right":E=-g;break;case"top-left":case"bottom-left":case"left":E=g}return[E,A]}(o,i[0],i[1]):function(u,g){let v=0,E=0;g<0&&(g=0);const A=g/Math.SQRT2;switch(u){case"top-right":case"top-left":E=A-ml;break;case"bottom-right":case"bottom-left":E=-A+ml;break;case"bottom":E=-g+ml;break;case"top":E=g-ml}switch(u){case"top-right":case"bottom-right":v=-A;break;case"top-left":case"bottom-left":v=A;break;case"left":v=g;break;case"right":v=-g}return[v,E]}(o,i[0])}function Rg(o,i,u){var g;const v=o.layout,E=(g=v.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(i,{},u);if(E){const M=E.values,P=[];for(let F=0;F<M.length;F+=2){const j=P[F]=M[F],Z=M[F+1].map(W=>W*mr);j.startsWith("top")?Z[1]-=ml:j.startsWith("bottom")&&(Z[1]+=ml),P[F+1]=Z}return new Ni(P)}const A=v.get("text-variable-anchor");if(A){let M;M=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(i,{},u)*mr,Zd]:v.get("text-offset").evaluate(i,{},u).map(F=>F*mr);const P=[];for(const F of A)P.push(F,Mg(F,M));return new Ni(P)}return null}function Hd(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jb(o,i,u,g,v,E,A,M,P,F,j){let Z=E.textMaxSize.evaluate(i,{});Z===void 0&&(Z=A);const W=o.layers[0].layout,te=W.get("icon-offset").evaluate(i,{},j),oe=Dg(u.horizontal),de=A/24,Le=o.tilePixelRatio*de,De=o.tilePixelRatio*Z/24,it=o.tilePixelRatio*M,Ge=o.tilePixelRatio*W.get("symbol-spacing"),et=W.get("text-padding")*o.tilePixelRatio,ft=function(vt,cn,sn,kn=1){const xi=vt.get("icon-padding").evaluate(cn,{},sn),yi=xi&&xi.values;return[yi[0]*kn,yi[1]*kn,yi[2]*kn,yi[3]*kn]}(W,i,j,o.tilePixelRatio),Et=W.get("text-max-angle")/180*Math.PI,Wt=W.get("text-rotation-alignment")!=="viewport"&&W.get("symbol-placement")!=="point",_n=W.get("icon-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",Ht=W.get("symbol-placement"),Gt=Ge/2,an=W.get("icon-text-fit");let tn;g&&an!=="none"&&(o.allowVerticalPlacement&&u.vertical&&(tn=ig(g,u.vertical,an,W.get("icon-text-fit-padding"),te,de)),oe&&(g=ig(g,oe,an,W.get("icon-text-fit-padding"),te,de)));const Yt=(vt,cn)=>{cn.x<0||cn.x>=ar||cn.y<0||cn.y>=ar||function(sn,kn,xi,yi,wr,fo,qr,kr,fs,ds,ps,Ki,Ir,Qr,Vr,ms,Gr,Ys,Ts,ai,ki,Li,Us,qi,qu){const na=sn.addToLineVertexArray(kn,xi);let ia,po,Js,Dr,Aa=0,ah=0,Og=0,Bg=0,ep=-1,tp=-1;const Ta={};let Ug=Tu("");if(sn.allowVerticalPlacement&&yi.vertical){const es=kr.layout.get("text-rotate").evaluate(ki,{},qi)+90;Js=new df(fs,kn,ds,ps,Ki,yi.vertical,Ir,Qr,Vr,es),qr&&(Dr=new df(fs,kn,ds,ps,Ki,qr,Gr,Ys,Vr,es))}if(wr){const es=kr.layout.get("icon-rotate").evaluate(ki,{}),Qs=kr.layout.get("icon-text-fit")!=="none",Yl=Cg(wr,es,Us,Qs),Lo=qr?Cg(qr,es,Us,Qs):void 0;po=new df(fs,kn,ds,ps,Ki,wr,Gr,Ys,!1,es),Aa=4*Yl.length;const Jl=sn.iconSizeData;let ra=null;Jl.kind==="source"?(ra=[ta*kr.layout.get("icon-size").evaluate(ki,{})],ra[0]>fl&&tt(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)):Jl.kind==="composite"&&(ra=[ta*Li.compositeIconSizes[0].evaluate(ki,{},qi),ta*Li.compositeIconSizes[1].evaluate(ki,{},qi)],(ra[0]>fl||ra[1]>fl)&&tt(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)),sn.addSymbols(sn.icon,Yl,ra,ai,Ts,ki,m.ah.none,kn,na.lineStartIndex,na.lineLength,-1,qi),ep=sn.icon.placedSymbolArray.length-1,Lo&&(ah=4*Lo.length,sn.addSymbols(sn.icon,Lo,ra,ai,Ts,ki,m.ah.vertical,kn,na.lineStartIndex,na.lineLength,-1,qi),tp=sn.icon.placedSymbolArray.length-1)}const jg=Object.keys(yi.horizontal);for(const es of jg){const Qs=yi.horizontal[es];if(!ia){Ug=Tu(Qs.text);const Lo=kr.layout.get("text-rotate").evaluate(ki,{},qi);ia=new df(fs,kn,ds,ps,Ki,Qs,Ir,Qr,Vr,Lo)}const Yl=Qs.positionedLines.length===1;if(Og+=Pg(sn,kn,Qs,fo,kr,Vr,ki,ms,na,yi.vertical?m.ah.horizontal:m.ah.horizontalOnly,Yl?jg:[es],Ta,ep,Li,qi),Yl)break}yi.vertical&&(Bg+=Pg(sn,kn,yi.vertical,fo,kr,Vr,ki,ms,na,m.ah.vertical,["vertical"],Ta,tp,Li,qi));const Gb=ia?ia.boxStartIndex:sn.collisionBoxArray.length,Zb=ia?ia.boxEndIndex:sn.collisionBoxArray.length,Hb=Js?Js.boxStartIndex:sn.collisionBoxArray.length,Xb=Js?Js.boxEndIndex:sn.collisionBoxArray.length,Wb=po?po.boxStartIndex:sn.collisionBoxArray.length,Kb=po?po.boxEndIndex:sn.collisionBoxArray.length,$b=Dr?Dr.boxStartIndex:sn.collisionBoxArray.length,Yb=Dr?Dr.boxEndIndex:sn.collisionBoxArray.length;let Co=-1;const mf=(es,Qs)=>es&&es.circleDiameter?Math.max(es.circleDiameter,Qs):Qs;Co=mf(ia,Co),Co=mf(Js,Co),Co=mf(po,Co),Co=mf(Dr,Co);const qg=Co>-1?1:0;qg&&(Co*=qu/mr),sn.glyphOffsetArray.length>=Bu.MAX_GLYPHS&&tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ki.sortKey!==void 0&&sn.addToSortKeyRanges(sn.symbolInstances.length,ki.sortKey);const Jb=Rg(kr,ki,qi),[Qb,ex]=function(es,Qs){const Yl=es.length,Lo=Qs==null?void 0:Qs.values;if((Lo==null?void 0:Lo.length)>0)for(let Jl=0;Jl<Lo.length;Jl+=2){const ra=Lo[Jl+1];es.emplaceBack(m.aq[Lo[Jl]],ra[0],ra[1])}return[Yl,es.length]}(sn.textAnchorOffsets,Jb);sn.symbolInstances.emplaceBack(kn.x,kn.y,Ta.right>=0?Ta.right:-1,Ta.center>=0?Ta.center:-1,Ta.left>=0?Ta.left:-1,Ta.vertical||-1,ep,tp,Ug,Gb,Zb,Hb,Xb,Wb,Kb,$b,Yb,ds,Og,Bg,Aa,ah,qg,0,Ir,Co,Qb,ex)}(o,cn,vt,u,g,v,tn,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,Le,[et,et,et,et],Wt,P,it,ft,_n,te,i,E,F,j,A)};if(Ht==="line")for(const vt of kg(i.geometry,0,0,ar,ar)){const cn=Fb(vt,Ge,Et,u.vertical||oe,g,24,De,o.overscaling,ar);for(const sn of cn)oe&&qb(o,oe.text,Gt,sn)||Yt(vt,sn)}else if(Ht==="line-center"){for(const vt of i.geometry)if(vt.length>1){const cn=zb(vt,Et,u.vertical||oe,g,24,De);cn&&Yt(vt,cn)}}else if(i.type==="Polygon")for(const vt of Ga(i.geometry,0)){const cn=Bb(vt,16);Yt(vt[0],new pl(cn.x,cn.y,0))}else if(i.type==="LineString")for(const vt of i.geometry)Yt(vt,new pl(vt[0].x,vt[0].y,0));else if(i.type==="Point")for(const vt of i.geometry)for(const cn of vt)Yt([cn],new pl(cn.x,cn.y,0))}function Pg(o,i,u,g,v,E,A,M,P,F,j,Z,W,te,oe){const de=function(it,Ge,et,ft,Et,Wt,_n,Ht){const Gt=ft.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,an=[];for(const tn of Ge.positionedLines)for(const Yt of tn.positionedGlyphs){if(!Yt.rect)continue;const vt=Yt.rect||{};let cn=Km+1,sn=!0,kn=1,xi=0;const yi=(Et||Ht)&&Yt.vertical,wr=Yt.metrics.advance*Yt.scale/2;if(Ht&&Ge.verticalizable&&(xi=tn.lineOffset/2-(Yt.imageName?-(mr-Yt.metrics.width*Yt.scale)/2:(Yt.scale-1)*mr)),Yt.imageName){const ai=_n[Yt.imageName];sn=ai.sdf,kn=ai.pixelRatio,cn=As/kn}const fo=Et?[Yt.x+wr,Yt.y]:[0,0];let qr=Et?[0,0]:[Yt.x+wr+et[0],Yt.y+et[1]-xi],kr=[0,0];yi&&(kr=qr,qr=[0,0]);const fs=Yt.metrics.isDoubleResolution?2:1,ds=(Yt.metrics.left-cn)*Yt.scale-wr+qr[0],ps=(-Yt.metrics.top-cn)*Yt.scale+qr[1],Ki=ds+vt.w/fs*Yt.scale/kn,Ir=ps+vt.h/fs*Yt.scale/kn,Qr=new C(ds,ps),Vr=new C(Ki,ps),ms=new C(ds,Ir),Gr=new C(Ki,Ir);if(yi){const ai=new C(-wr,wr-eh),ki=-Math.PI/2,Li=mr/2-wr,Us=new C(5-eh-Li,-(Yt.imageName?Li:0)),qi=new C(...kr);Qr._rotateAround(ki,ai)._add(Us)._add(qi),Vr._rotateAround(ki,ai)._add(Us)._add(qi),ms._rotateAround(ki,ai)._add(Us)._add(qi),Gr._rotateAround(ki,ai)._add(Us)._add(qi)}if(Gt){const ai=Math.sin(Gt),ki=Math.cos(Gt),Li=[ki,-ai,ai,ki];Qr._matMult(Li),Vr._matMult(Li),ms._matMult(Li),Gr._matMult(Li)}const Ys=new C(0,0),Ts=new C(0,0);an.push({tl:Qr,tr:Vr,bl:ms,br:Gr,tex:vt,writingMode:Ge.writingMode,glyphOffset:fo,sectionIndex:Yt.sectionIndex,isSDF:sn,pixelOffsetTL:Ys,pixelOffsetBR:Ts,minFontScaleX:0,minFontScaleY:0})}return an}(0,u,M,v,E,A,g,o.allowVerticalPlacement),Le=o.textSizeData;let De=null;Le.kind==="source"?(De=[ta*v.layout.get("text-size").evaluate(A,{})],De[0]>fl&&tt(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)):Le.kind==="composite"&&(De=[ta*te.compositeTextSizes[0].evaluate(A,{},oe),ta*te.compositeTextSizes[1].evaluate(A,{},oe)],(De[0]>fl||De[1]>fl)&&tt(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)),o.addSymbols(o.text,de,De,M,E,A,F,i,P.lineStartIndex,P.lineLength,W,oe);for(const it of j)Z[it]=o.text.placedSymbolArray.length-1;return 4*de.length}function Dg(o){for(const i in o)return o[i];return null}function qb(o,i,u,g){const v=o.compareText;if(i in v){const E=v[i];for(let A=E.length-1;A>=0;A--)if(g.dist(E[A])<u)return!0}else v[i]=[];return v[i].push(g),!1}const Ng=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Xd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,g]=new Uint8Array(i,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=g>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=Ng[15&g];if(!E)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(i,2,1),[M]=new Uint32Array(i,4,1);return new Xd(M,A,E,i)}constructor(i,u=64,g=Float64Array,v){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=g,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const E=Ng.indexOf(this.ArrayType),A=2*i*this.ArrayType.BYTES_PER_ELEMENT,M=i*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-M%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${g}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+P,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+A+M+P),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+P,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=i)}add(i,u){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=i,this.coords[this._pos++]=u,g}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Wd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,u,g,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:A,nodeSize:M}=this,P=[0,E.length-1,0],F=[];for(;P.length;){const j=P.pop()||0,Z=P.pop()||0,W=P.pop()||0;if(Z-W<=M){for(let Le=W;Le<=Z;Le++){const De=A[2*Le],it=A[2*Le+1];De>=i&&De<=g&&it>=u&&it<=v&&F.push(E[Le])}continue}const te=W+Z>>1,oe=A[2*te],de=A[2*te+1];oe>=i&&oe<=g&&de>=u&&de<=v&&F.push(E[te]),(j===0?i<=oe:u<=de)&&(P.push(W),P.push(te-1),P.push(1-j)),(j===0?g>=oe:v>=de)&&(P.push(te+1),P.push(Z),P.push(1-j))}return F}within(i,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:A}=this,M=[0,v.length-1,0],P=[],F=g*g;for(;M.length;){const j=M.pop()||0,Z=M.pop()||0,W=M.pop()||0;if(Z-W<=A){for(let Le=W;Le<=Z;Le++)Fg(E[2*Le],E[2*Le+1],i,u)<=F&&P.push(v[Le]);continue}const te=W+Z>>1,oe=E[2*te],de=E[2*te+1];Fg(oe,de,i,u)<=F&&P.push(v[te]),(j===0?i-g<=oe:u-g<=de)&&(M.push(W),M.push(te-1),M.push(1-j)),(j===0?i+g>=oe:u+g>=de)&&(M.push(te+1),M.push(Z),M.push(1-j))}return P}}function Wd(o,i,u,g,v,E){if(v-g<=u)return;const A=g+v>>1;zg(o,i,A,g,v,E),Wd(o,i,u,g,A-1,1-E),Wd(o,i,u,A+1,v,1-E)}function zg(o,i,u,g,v,E){for(;v>g;){if(v-g>600){const F=v-g+1,j=u-g+1,Z=Math.log(F),W=.5*Math.exp(2*Z/3),te=.5*Math.sqrt(Z*W*(F-W)/F)*(j-F/2<0?-1:1);zg(o,i,u,Math.max(g,Math.floor(u-j*W/F+te)),Math.min(v,Math.floor(u+(F-j)*W/F+te)),E)}const A=i[2*u+E];let M=g,P=v;for(sh(o,i,g,u),i[2*v+E]>A&&sh(o,i,g,v);M<P;){for(sh(o,i,M,P),M++,P--;i[2*M+E]<A;)M++;for(;i[2*P+E]>A;)P--}i[2*g+E]===A?sh(o,i,g,P):(P++,sh(o,i,P,v)),P<=u&&(g=P+1),u<=P&&(v=P-1)}}function sh(o,i,u,g){Kd(o,u,g),Kd(i,2*u,2*g),Kd(i,2*u+1,2*g+1)}function Kd(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}function Fg(o,i,u,g){const v=o-u,E=i-g;return v*v+E*E}var $d;m.bg=void 0,($d=m.bg||(m.bg={})).create="create",$d.load="load",$d.fullLoad="fullLoad";let pf=null,oh=[];const Yd=1e3/60,Jd="loadTime",Qd="fullLoadTime",Vb={mark(o){performance.mark(o)},frame(o){const i=o;pf!=null&&oh.push(i-pf),pf=i},clearMetrics(){pf=null,oh=[],performance.clearMeasures(Jd),performance.clearMeasures(Qd);for(const o in m.bg)performance.clearMarks(m.bg[o])},getPerformanceMetrics(){performance.measure(Jd,m.bg.create,m.bg.load),performance.measure(Qd,m.bg.create,m.bg.fullLoad);const o=performance.getEntriesByName(Jd)[0].duration,i=performance.getEntriesByName(Qd)[0].duration,u=oh.length,g=1/(oh.reduce((E,A)=>E+A,0)/u/1e3),v=oh.filter(E=>E>Yd).reduce((E,A)=>E+(A-Yd)/Yd,0);return{loadTime:o,fullLoadTime:i,fps:g,percentDroppedFrames:v/(u+v)*100,totalFrames:u}}};m.$=class extends H{},m.A=Pu,m.B=ad,m.C=function(o){if(dt==null){const i=o.navigator?o.navigator.userAgent:null;dt=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return dt},m.D=nn,m.E=Lt,m.F=class{constructor(o,i){this.target=o,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Db(()=>this.process()),this.subscription=function(u,g,v,E){return u.addEventListener(g,v,!1),{unsubscribe:()=>{u.removeEventListener(g,v,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=qe(self)?o:window}registerMessageHandler(o,i){this.messageHandlers[o]=i}sendAsync(o,i){return new Promise((u,g)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:u,reject:g},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const M={id:v,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const E=[],A=Object.assign(Object.assign({},o),{id:v,sourceMapId:this.mapId,origin:location.origin,data:el(o.data,E)});this.target.postMessage(A,{transfer:E})})}receive(o){const i=o.data,u=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[u];const g=this.abortControllers[u];return delete this.abortControllers[u],void(g&&g.abort())}if(qe(self)||i.mustQueue)return this.tasks[u]=i,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,i)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){return l(this,void 0,void 0,function*(){if(i.type==="<response>"){const v=this.resolveRejects[o];return delete this.resolveRejects[o],v?void(i.error?v.reject(tl(i.error)):v.resolve(tl(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=tl(i.data),g=new AbortController;this.abortControllers[o]=g;try{const v=yield this.messageHandlers[i.type](i.sourceMapId,u,g);this.completeTask(o,null,v)}catch(v){this.completeTask(o,v)}})}completeTask(o,i,u){const g=[];delete this.abortControllers[o];const v={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?el(i):null,data:el(u,g)};this.target.postMessage(v,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.G=pn,m.H=function(){var o=new Pu(16);return Pu!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},m.I=Dd,m.J=function(o,i,u){var g,v,E,A,M,P,F,j,Z,W,te,oe,de=u[0],Le=u[1],De=u[2];return i===o?(o[12]=i[0]*de+i[4]*Le+i[8]*De+i[12],o[13]=i[1]*de+i[5]*Le+i[9]*De+i[13],o[14]=i[2]*de+i[6]*Le+i[10]*De+i[14],o[15]=i[3]*de+i[7]*Le+i[11]*De+i[15]):(v=i[1],E=i[2],A=i[3],M=i[4],P=i[5],F=i[6],j=i[7],Z=i[8],W=i[9],te=i[10],oe=i[11],o[0]=g=i[0],o[1]=v,o[2]=E,o[3]=A,o[4]=M,o[5]=P,o[6]=F,o[7]=j,o[8]=Z,o[9]=W,o[10]=te,o[11]=oe,o[12]=g*de+M*Le+Z*De+i[12],o[13]=v*de+P*Le+W*De+i[13],o[14]=E*de+F*Le+te*De+i[14],o[15]=A*de+j*Le+oe*De+i[15]),o},m.K=function(o,i,u){var g=u[0],v=u[1],E=u[2];return o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o[3]=i[3]*g,o[4]=i[4]*v,o[5]=i[5]*v,o[6]=i[6]*v,o[7]=i[7]*v,o[8]=i[8]*E,o[9]=i[9]*E,o[10]=i[10]*E,o[11]=i[11]*E,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.L=_m,m.M=function(o,i){const u={};for(let g=0;g<i.length;g++){const v=i[g];v in o&&(u[v]=o[v])}return u},m.N=dl,m.O=fg,m.P=C,m.Q=dg,m.R=Ks,m.S=$s,m.T=ku,m.U=ae,m.V=J,m.W=Ut,m.X=ar,m.Y=R,m.Z=ih,m._=l,m.a=St,m.a$=function(o,i){var u=o[0],g=o[1],v=o[2],E=o[3],A=o[4],M=o[5],P=o[6],F=o[7],j=o[8],Z=o[9],W=o[10],te=o[11],oe=o[12],de=o[13],Le=o[14],De=o[15],it=i[0],Ge=i[1],et=i[2],ft=i[3],Et=i[4],Wt=i[5],_n=i[6],Ht=i[7],Gt=i[8],an=i[9],tn=i[10],Yt=i[11],vt=i[12],cn=i[13],sn=i[14],kn=i[15];return Math.abs(u-it)<=hs*Math.max(1,Math.abs(u),Math.abs(it))&&Math.abs(g-Ge)<=hs*Math.max(1,Math.abs(g),Math.abs(Ge))&&Math.abs(v-et)<=hs*Math.max(1,Math.abs(v),Math.abs(et))&&Math.abs(E-ft)<=hs*Math.max(1,Math.abs(E),Math.abs(ft))&&Math.abs(A-Et)<=hs*Math.max(1,Math.abs(A),Math.abs(Et))&&Math.abs(M-Wt)<=hs*Math.max(1,Math.abs(M),Math.abs(Wt))&&Math.abs(P-_n)<=hs*Math.max(1,Math.abs(P),Math.abs(_n))&&Math.abs(F-Ht)<=hs*Math.max(1,Math.abs(F),Math.abs(Ht))&&Math.abs(j-Gt)<=hs*Math.max(1,Math.abs(j),Math.abs(Gt))&&Math.abs(Z-an)<=hs*Math.max(1,Math.abs(Z),Math.abs(an))&&Math.abs(W-tn)<=hs*Math.max(1,Math.abs(W),Math.abs(tn))&&Math.abs(te-Yt)<=hs*Math.max(1,Math.abs(te),Math.abs(Yt))&&Math.abs(oe-vt)<=hs*Math.max(1,Math.abs(oe),Math.abs(vt))&&Math.abs(de-cn)<=hs*Math.max(1,Math.abs(de),Math.abs(cn))&&Math.abs(Le-sn)<=hs*Math.max(1,Math.abs(Le),Math.abs(sn))&&Math.abs(De-kn)<=hs*Math.max(1,Math.abs(De),Math.abs(kn))},m.a0=Xn,m.a1=Gd,m.a2=ht,m.a3=o=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(u=>{i.onloadstart=()=>{u(i)};for(const g of o){const v=window.document.createElement("source");dn(g)||(i.crossOrigin="Anonymous"),v.src=g,i.appendChild(v)}})},m.a4=function(){return be++},m.a5=Xt,m.a6=Bu,m.a7=Ft,m.a8=Kl,m.a9=vg,m.aA=function(o){if(o.type==="custom")return new Pb(o);switch(o.type){case"background":return new Lb(o);case"circle":return new _1(o);case"fill":return new D1(o);case"fill-extrusion":return new K1(o);case"heatmap":return new v1(o);case"hillshade":return new x1(o);case"line":return new ib(o);case"raster":return new Rb(o);case"symbol":return new uf(o)}},m.aB=we,m.aC=function(o,i){if(!o)return[{command:"setStyle",args:[i]}];let u=[];try{if(!Se(o.version,i.version))return[{command:"setStyle",args:[i]}];Se(o.center,i.center)||u.push({command:"setCenter",args:[i.center]}),Se(o.zoom,i.zoom)||u.push({command:"setZoom",args:[i.zoom]}),Se(o.bearing,i.bearing)||u.push({command:"setBearing",args:[i.bearing]}),Se(o.pitch,i.pitch)||u.push({command:"setPitch",args:[i.pitch]}),Se(o.sprite,i.sprite)||u.push({command:"setSprite",args:[i.sprite]}),Se(o.glyphs,i.glyphs)||u.push({command:"setGlyphs",args:[i.glyphs]}),Se(o.transition,i.transition)||u.push({command:"setTransition",args:[i.transition]}),Se(o.light,i.light)||u.push({command:"setLight",args:[i.light]}),Se(o.terrain,i.terrain)||u.push({command:"setTerrain",args:[i.terrain]}),Se(o.sky,i.sky)||u.push({command:"setSky",args:[i.sky]}),Se(o.projection,i.projection)||u.push({command:"setProjection",args:[i.projection]});const g={},v=[];(function(A,M,P,F){let j;for(j in M=M||{},A=A||{})Object.prototype.hasOwnProperty.call(A,j)&&(Object.prototype.hasOwnProperty.call(M,j)||Fn(j,P,F));for(j in M)Object.prototype.hasOwnProperty.call(M,j)&&(Object.prototype.hasOwnProperty.call(A,j)?Se(A[j],M[j])||(A[j].type==="geojson"&&M[j].type==="geojson"&&Jt(A,M,j)?Bt(P,{command:"setGeoJSONSourceData",args:[j,M[j].data]}):ei(j,M,P,F)):Mn(j,M,P))})(o.sources,i.sources,v,g);const E=[];o.layers&&o.layers.forEach(A=>{"source"in A&&g[A.source]?u.push({command:"removeLayer",args:[A.id]}):E.push(A)}),u=u.concat(v),function(A,M,P){M=M||[];const F=(A=A||[]).map(Qi),j=M.map(Qi),Z=A.reduce(ns,{}),W=M.reduce(ns,{}),te=F.slice(),oe=Object.create(null);let de,Le,De,it,Ge;for(let et=0,ft=0;et<F.length;et++)de=F[et],Object.prototype.hasOwnProperty.call(W,de)?ft++:(Bt(P,{command:"removeLayer",args:[de]}),te.splice(te.indexOf(de,ft),1));for(let et=0,ft=0;et<j.length;et++)de=j[j.length-1-et],te[te.length-1-et]!==de&&(Object.prototype.hasOwnProperty.call(Z,de)?(Bt(P,{command:"removeLayer",args:[de]}),te.splice(te.lastIndexOf(de,te.length-ft),1)):ft++,it=te[te.length-et],Bt(P,{command:"addLayer",args:[W[de],it]}),te.splice(te.length-et,0,de),oe[de]=!0);for(let et=0;et<j.length;et++)if(de=j[et],Le=Z[de],De=W[de],!oe[de]&&!Se(Le,De))if(Se(Le.source,De.source)&&Se(Le["source-layer"],De["source-layer"])&&Se(Le.type,De.type)){for(Ge in Ri(Le.layout,De.layout,P,de,null,"setLayoutProperty"),Ri(Le.paint,De.paint,P,de,null,"setPaintProperty"),Se(Le.filter,De.filter)||Bt(P,{command:"setFilter",args:[de,De.filter]}),Se(Le.minzoom,De.minzoom)&&Se(Le.maxzoom,De.maxzoom)||Bt(P,{command:"setLayerZoomRange",args:[de,De.minzoom,De.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?Ri(Le[Ge],De[Ge],P,de,Ge.slice(6),"setPaintProperty"):Se(Le[Ge],De[Ge])||Bt(P,{command:"setLayerProperty",args:[de,Ge,De[Ge]]}));for(Ge in De)Object.prototype.hasOwnProperty.call(De,Ge)&&!Object.prototype.hasOwnProperty.call(Le,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?Ri(Le[Ge],De[Ge],P,de,Ge.slice(6),"setPaintProperty"):Se(Le[Ge],De[Ge])||Bt(P,{command:"setLayerProperty",args:[de,Ge,De[Ge]]}))}else Bt(P,{command:"removeLayer",args:[de]}),it=te[te.lastIndexOf(de)+1],Bt(P,{command:"addLayer",args:[De,it]})}(E,i.layers,u)}catch(g){console.warn("Unable to compute style diff:",g),u=[{command:"setStyle",args:[i]}]}return u},m.aD=function(o){const i=[],u=o.id;return u===void 0&&i.push({message:`layers.${u}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${u}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),i},m.aE=function o(i,u){if(Array.isArray(i)){if(!Array.isArray(u)||i.length!==u.length)return!1;for(let g=0;g<i.length;g++)if(!o(i[g],u[g]))return!1;return!0}if(typeof i=="object"&&i!==null&&u!==null){if(typeof u!="object"||Object.keys(i).length!==Object.keys(u).length)return!1;for(const g in i)if(!o(i[g],u[g]))return!1;return!0}return i===u},m.aF=ve,m.aG=Ce,m.aH=class extends Hl{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},m.aI=Kh,m.aJ=class extends Hl{constructor(o,i){super(o,i),this.current=u1}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},m.aK=om,m.aL=am,m.aM=ti,m.aN=class extends Hl{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},m.aO=class extends Hl{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},m.aP=function(o,i,u,g,v,E,A){var M=1/(i-u),P=1/(g-v),F=1/(E-A);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*P,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*F,o[11]=0,o[12]=(i+u)*M,o[13]=(v+g)*P,o[14]=(A+E)*F,o[15]=1,o},m.aQ=g1,m.aR=class extends He{},m.aS=ab,m.aT=class extends at{},m.aU=wd,m.aV=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},m.aW=wm,m.aX=Br,m.aY=Ws,m.aZ=class extends rn{},m.a_=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},m.aa=function(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,g,v,E)=>{const A=v||E;return i[g]=!A||A.toLowerCase(),""}),i["max-age"]){const u=parseInt(i["max-age"],10);isNaN(u)?delete i["max-age"]:i["max-age"]=u}return i},m.ab=function(o,i){const u=[];for(const g in o)g in i||u.push(g);return u},m.ac=xe,m.ad=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[0],A=i[1],M=i[2],P=i[3],F=i[4],j=i[5],Z=i[6],W=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=E*v+F*g,o[1]=A*v+j*g,o[2]=M*v+Z*g,o[3]=P*v+W*g,o[4]=F*v-E*g,o[5]=j*v-A*g,o[6]=Z*v-M*g,o[7]=W*v-P*g,o},m.ae=function(o){var i=new Pu(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},m.af=Qh,m.ag=function(o,i){let u=0,g=0;if(o.kind==="constant")g=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:A}=o,M=v?xe(hr.interpolationFactor(v,i,E,A),0,1):0;o.kind==="camera"?g=wi.number(o.minSize,o.maxSize,M):u=M}return{uSizeT:u,uSize:g}},m.ai=function(o,{uSize:i,uSizeT:u},{lowerSize:g,upperSize:v}){return o.kind==="source"?g/ta:o.kind==="composite"?wi.number(g/ta,v/ta,u):i},m.aj=Od,m.ak=function(o,i,u,g){const v=i.y-o.y,E=i.x-o.x,A=g.y-u.y,M=g.x-u.x,P=A*E-M*v;if(P===0)return null;const F=(M*(o.y-u.y)-A*(o.x-u.x))/P;return new C(o.x+F*E,o.y+F*v)},m.al=kg,m.am=hm,m.an=vd,m.ao=function(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return[i,u,g,v]},m.ap=mr,m.ar=Fd,m.as=function(o,i){var u=i[0],g=i[1],v=i[2],E=i[3],A=i[4],M=i[5],P=i[6],F=i[7],j=i[8],Z=i[9],W=i[10],te=i[11],oe=i[12],de=i[13],Le=i[14],De=i[15],it=u*M-g*A,Ge=u*P-v*A,et=u*F-E*A,ft=g*P-v*M,Et=g*F-E*M,Wt=v*F-E*P,_n=j*de-Z*oe,Ht=j*Le-W*oe,Gt=j*De-te*oe,an=Z*Le-W*de,tn=Z*De-te*de,Yt=W*De-te*Le,vt=it*Yt-Ge*tn+et*an+ft*Gt-Et*Ht+Wt*_n;return vt?(o[0]=(M*Yt-P*tn+F*an)*(vt=1/vt),o[1]=(v*tn-g*Yt-E*an)*vt,o[2]=(de*Wt-Le*Et+De*ft)*vt,o[3]=(W*Et-Z*Wt-te*ft)*vt,o[4]=(P*Gt-A*Yt-F*Ht)*vt,o[5]=(u*Yt-v*Gt+E*Ht)*vt,o[6]=(Le*et-oe*Wt-De*Ge)*vt,o[7]=(j*Wt-W*et+te*Ge)*vt,o[8]=(A*tn-M*Gt+F*_n)*vt,o[9]=(g*Gt-u*tn-E*_n)*vt,o[10]=(oe*Et-de*et+De*it)*vt,o[11]=(Z*et-j*Et-te*it)*vt,o[12]=(M*Ht-A*an-P*_n)*vt,o[13]=(u*an-g*Ht+v*_n)*vt,o[14]=(de*Ge-oe*ft-Le*it)*vt,o[15]=(j*ft-Z*Ge+W*it)*vt,o):null},m.at=Hd,m.au=zd,m.av=Xd,m.aw=function(){const o={},i=Ke.$version;for(const u in Ke.$root){const g=Ke.$root[u];if(g.required){let v=null;v=u==="version"?i:g.type==="array"?[]:{},v!=null&&(o[u]=v)}}return o},m.ax=Fc,m.ay=We,m.az=function(o){o=o.slice();const i=Object.create(null);for(let u=0;u<o.length;u++)i[o[u].id]=o[u];for(let u=0;u<o.length;u++)"ref"in o[u]&&(o[u]=xt(o[u],i[o[u].ref]));return o},m.b=mt,m.b0=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.b1=function(o,i,u){return o[0]=i[0]*u[0],o[1]=i[1]*u[1],o[2]=i[2]*u[2],o[3]=i[3]*u[3],o},m.b2=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},m.b3=Ee,m.b4=gg,m.b5=pg,m.b6=function(o,i,u,g,v){var E,A=1/Math.tan(i/2);return o[0]=A/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=A,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,v!=null&&v!==1/0?(o[10]=(v+g)*(E=1/(g-v)),o[14]=2*v*g*E):(o[10]=-1,o[14]=-2*g),o},m.b7=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[4],A=i[5],M=i[6],P=i[7],F=i[8],j=i[9],Z=i[10],W=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=E*v+F*g,o[5]=A*v+j*g,o[6]=M*v+Z*g,o[7]=P*v+W*g,o[8]=F*v-E*g,o[9]=j*v-A*g,o[10]=Z*v-M*g,o[11]=W*v-P*g,o},m.b8=Y,m.b9=ge,m.bA=qm,m.bB=function(o){return o.message===pt},m.bC=L,m.bD=Ss,m.ba=function(o){return o*Math.PI/180},m.bb=function(o,i){const{x:u,y:g}=ih.fromLngLat(i);return!(o<0||o>25||g<0||g>=1||u<0||u>=1)},m.bc=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},m.bd=class extends q{},m.be=qd,m.bf=Vb,m.bh=Pn,m.bi=function(o,i){St.REGISTERED_PROTOCOLS[o]=i},m.bj=function(o){delete St.REGISTERED_PROTOCOLS[o]},m.bk=function(o,i){const u={};for(let v=0;v<o.length;v++){const E=i&&i[o[v].id]||us(o[v]);i&&(i[o[v].id]=E);let A=u[E];A||(A=u[E]=[]),A.push(o[v])}const g=[];for(const v in u)g.push(u[v]);return g},m.bl=Qt,m.bm=yg,m.bn=bg,m.bo=Ym,m.bp=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ar/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const i=o.bucket.layers[0],u=i.layout,g=i._unevaluatedLayout._values,v={layoutIconSize:g["icon-size"].possiblyEvaluate(new Ei(o.bucket.zoom+1),o.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new Ei(o.bucket.zoom+1),o.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new Ei(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=o.bucket.textSizeData;v.compositeTextSizes=[g["text-size"].possiblyEvaluate(new Ei(F),o.canonical),g["text-size"].possiblyEvaluate(new Ei(j),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=o.bucket.iconSizeData;v.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new Ei(F),o.canonical),g["icon-size"].possiblyEvaluate(new Ei(j),o.canonical)]}const E=u.get("text-line-height")*mr,A=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",M=u.get("text-keep-upright"),P=u.get("text-size");for(const F of o.bucket.features){const j=u.get("text-font").evaluate(F,{},o.canonical).join(","),Z=P.evaluate(F,{},o.canonical),W=v.layoutTextSize.evaluate(F,{},o.canonical),te=v.layoutIconSize.evaluate(F,{},o.canonical),oe={horizontal:{},vertical:void 0},de=F.text;let Le,De=[0,0];if(de){const et=de.toString(),ft=u.get("text-letter-spacing").evaluate(F,{},o.canonical)*mr,Et=ld(et)?ft:0,Wt=u.get("text-anchor").evaluate(F,{},o.canonical),_n=Rg(i,F,o.canonical);if(!_n){const tn=u.get("text-radial-offset").evaluate(F,{},o.canonical);De=tn?Mg(Wt,[tn*mr,Zd]):u.get("text-offset").evaluate(F,{},o.canonical).map(Yt=>Yt*mr)}let Ht=A?"center":u.get("text-justify").evaluate(F,{},o.canonical);const Gt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(F,{},o.canonical)*mr:1/0,an=()=>{o.bucket.allowVerticalPlacement&&Oc(et)&&(oe.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,Wt,"left",Et,De,m.ah.vertical,!0,W,Z))};if(!A&&_n){const tn=new Set;if(Ht==="auto")for(let vt=0;vt<_n.values.length;vt+=2)tn.add(Hd(_n.values[vt]));else tn.add(Ht);let Yt=!1;for(const vt of tn)if(!oe.horizontal[vt])if(Yt)oe.horizontal[vt]=oe.horizontal[0];else{const cn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,"center",vt,Et,De,m.ah.horizontal,!1,W,Z);cn&&(oe.horizontal[vt]=cn,Yt=cn.positionedLines.length===1)}an()}else{Ht==="auto"&&(Ht=Hd(Wt));const tn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,Wt,Ht,Et,De,m.ah.horizontal,!1,W,Z);tn&&(oe.horizontal[Ht]=tn),an(),Oc(et)&&A&&M&&(oe.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,Wt,Ht,Et,De,m.ah.vertical,!1,W,Z))}}let it=!1;if(F.icon&&F.icon.name){const et=o.imageMap[F.icon.name];et&&(Le=Sb(o.imagePositions[F.icon.name],u.get("icon-offset").evaluate(F,{},o.canonical),u.get("icon-anchor").evaluate(F,{},o.canonical)),it=!!et.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=it:o.bucket.sdfIcons!==it&&tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==o.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const Ge=Dg(oe.horizontal)||oe.vertical;o.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||Le)&&jb(o.bucket,F,oe,Le,o.imageMap,v,W,te,De,it,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},m.bq=Ld,m.br=Ad,m.bs=Cd,m.bt=cl,m.bu=Rd,m.bv=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},m.bw=function(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(J())try{return yield Ut(o,i,u,g,v)}catch{}return function(E,A,M,P,F){const j=E.width,Z=E.height;bt&&It||(bt=new OffscreenCanvas(j,Z),It=bt.getContext("2d",{willReadFrequently:!0})),bt.width=j,bt.height=Z,It.drawImage(E,0,0,j,Z);const W=It.getImageData(A,M,P,F);return It.clearRect(0,0,j,Z),W.data}(o,i,u,g,v)})},m.bx=_g,m.by=x,m.bz=S,m.c=kt,m.d=o=>l(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(i)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=ye,m.f=o=>new Promise((i,u)=>{const g=new Image;g.onload=()=>{i(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=ct})},g.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(o)],{type:"image/png"});g.src=o.byteLength?URL.createObjectURL(v):ct}),m.g=$t,m.h=(o,i)=>Kn(ye(o,{type:"json"}),i),m.i=qe,m.j=Ye,m.k=ut,m.l=(o,i)=>Kn(ye(o,{type:"arrayBuffer"}),i),m.m=Kn,m.n=function(o){return new Rd(o).readFields(yb,[])},m.o=Xc,m.p=$m,m.q=k,m.r=od,m.s=dn,m.t=Nc,m.u=ka,m.v=Ke,m.w=tt,m.x=function([o,i,u]){return i+=90,i*=Math.PI/180,u*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(u),y:o*Math.sin(i)*Math.sin(u),z:o*Math.cos(u)}},m.y=wi,m.z=Ei}),a("worker",["./shared"],function(m){class l{constructor(Q){this.keyCache={},Q&&this.replace(Q)}replace(Q){this._layerConfigs={},this._layers={},this.update(Q,[])}update(Q,$){for(const ue of Q){this._layerConfigs[ue.id]=ue;const fe=this._layers[ue.id]=m.aA(ue);fe._featureFilter=m.a7(fe.filter),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of $)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const ce=m.bk(Object.values(this._layerConfigs),this.keyCache);for(const ue of ce){const fe=ue.map(lt=>this._layers[lt.id]),Ue=fe[0];if(Ue.visibility==="none")continue;const Xe=Ue.source||"";let Pe=this.familiesBySource[Xe];Pe||(Pe=this.familiesBySource[Xe]={});const nt=Ue.sourceLayer||"_geojsonTileLayer";let _t=Pe[nt];_t||(_t=Pe[nt]=[]),_t.push(fe)}}}class x{constructor(Q){const $={},ce=[];for(const Xe in Q){const Pe=Q[Xe],nt=$[Xe]={};for(const _t in Pe){const lt=Pe[+_t];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Nt={x:0,y:0,w:lt.bitmap.width+2,h:lt.bitmap.height+2};ce.push(Nt),nt[_t]={rect:Nt,metrics:lt.metrics}}}const{w:ue,h:fe}=m.p(ce),Ue=new m.o({width:ue||1,height:fe||1});for(const Xe in Q){const Pe=Q[Xe];for(const nt in Pe){const _t=Pe[+nt];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;const lt=$[Xe][nt].rect;m.o.copy(_t.bitmap,Ue,{x:0,y:0},{x:lt.x+1,y:lt.y+1},_t.bitmap)}}this.image=Ue,this.positions=$}}m.bl("GlyphAtlas",x);class S{constructor(Q){this.tileID=new m.S(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[]}parse(Q,$,ce,ue){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=Q,this.collisionBoxArray=new m.a5;const fe=new m.bm(Object.keys(Q.layers).sort()),Ue=new m.bn(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const Xe={},Pe={featureIndex:Ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce},nt=$.familiesBySource[this.source];for(const En in nt){const ri=Q.layers[En];if(!ri)continue;ri.version===1&&m.w(`Vector tile source "${this.source}" layer "${En}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fi=fe.encode(En),Di=[];for(let $n=0;$n<ri.length;$n++){const Tr=ri.feature($n),No=Ue.getId(Tr,En);Di.push({feature:Tr,id:No,index:$n,sourceLayerIndex:fi})}for(const $n of nt[En]){const Tr=$n[0];Tr.source!==this.source&&m.w(`layer.source = ${Tr.source} does not equal this.source = ${this.source}`),Tr.minzoom&&this.zoom<Math.floor(Tr.minzoom)||Tr.maxzoom&&this.zoom>=Tr.maxzoom||Tr.visibility!=="none"&&(T($n,this.zoom,ce),(Xe[Tr.id]=Tr.createBucket({index:Ue.bucketLayerIDs.length,layers:$n,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fi,sourceID:this.source})).populate(Di,Pe,this.tileID.canonical),Ue.bucketLayerIDs.push($n.map(No=>No.id)))}}const _t=m.aF(Pe.glyphDependencies,En=>Object.keys(En).map(Number));this.inFlightDependencies.forEach(En=>En==null?void 0:En.abort()),this.inFlightDependencies=[];let lt=Promise.resolve({});if(Object.keys(_t).length){const En=new AbortController;this.inFlightDependencies.push(En),lt=ue.sendAsync({type:"GG",data:{stacks:_t,source:this.source,tileID:this.tileID,type:"glyphs"}},En)}const Nt=Object.keys(Pe.iconDependencies);let en=Promise.resolve({});if(Nt.length){const En=new AbortController;this.inFlightDependencies.push(En),en=ue.sendAsync({type:"GI",data:{icons:Nt,source:this.source,tileID:this.tileID,type:"icons"}},En)}const ln=Object.keys(Pe.patternDependencies);let Zn=Promise.resolve({});if(ln.length){const En=new AbortController;this.inFlightDependencies.push(En),Zn=ue.sendAsync({type:"GI",data:{icons:ln,source:this.source,tileID:this.tileID,type:"patterns"}},En)}const[Tn,Cn,Un]=yield Promise.all([lt,en,Zn]),Ii=new x(Tn),ci=new m.bo(Cn,Un);for(const En in Xe){const ri=Xe[En];ri instanceof m.a6?(T(ri.layers,this.zoom,ce),m.bp({bucket:ri,glyphMap:Tn,glyphPositions:Ii.positions,imageMap:Cn,imagePositions:ci.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ri.hasPattern&&(ri instanceof m.bq||ri instanceof m.br||ri instanceof m.bs)&&(T(ri.layers,this.zoom,ce),ri.addFeatures(Pe,this.tileID.canonical,ci.patternPositions))}return this.status="done",{buckets:Object.values(Xe).filter(En=>!En.isEmpty()),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ii.image,imageAtlas:ci,glyphMap:this.returnDependencies?Tn:null,iconMap:this.returnDependencies?Cn:null,glyphPositions:this.returnDependencies?Ii.positions:null}})}}function T(Re,Q,$){const ce=new m.z(Q);for(const ue of Re)ue.recalculate(ce,$)}class C{constructor(Q,$,ce){this.actor=Q,this.layerIndex=$,this.availableImages=ce,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Q,$){return m._(this,void 0,void 0,function*(){const ce=yield m.l(Q.request,$);try{return{vectorTile:new m.bt.VectorTile(new m.bu(ce.data)),rawData:ce.data,cacheControl:ce.cacheControl,expires:ce.expires}}catch(ue){const fe=new Uint8Array(ce.data);let Ue=`Unable to parse the tile at ${Q.request.url}, `;throw Ue+=fe[0]===31&&fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(Ue)}})}loadTile(Q){return m._(this,void 0,void 0,function*(){const $=Q.uid,ce=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new m.bv(Q.request),ue=new S(Q);this.loading[$]=ue;const fe=new AbortController;ue.abort=fe;try{const Ue=yield this.loadVectorTile(Q,fe);if(delete this.loading[$],!Ue)return null;const Xe=Ue.rawData,Pe={};Ue.expires&&(Pe.expires=Ue.expires),Ue.cacheControl&&(Pe.cacheControl=Ue.cacheControl);const nt={};if(ce){const lt=ce.finish();lt&&(nt.resourceTiming=JSON.parse(JSON.stringify(lt)))}ue.vectorTile=Ue.vectorTile;const _t=ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[$]=ue,this.fetching[$]={rawTileData:Xe,cacheControl:Pe,resourceTiming:nt};try{const lt=yield _t;return m.e({rawTileData:Xe.slice(0)},lt,Pe,nt)}finally{delete this.fetching[$]}}catch(Ue){throw delete this.loading[$],ue.status="done",this.loaded[$]=ue,Ue}})}reloadTile(Q){return m._(this,void 0,void 0,function*(){const $=Q.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ce=this.loaded[$];if(ce.showCollisionBoxes=Q.showCollisionBoxes,ce.status==="parsing"){const ue=yield ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor);let fe;if(this.fetching[$]){const{rawTileData:Ue,cacheControl:Xe,resourceTiming:Pe}=this.fetching[$];delete this.fetching[$],fe=m.e({rawTileData:Ue.slice(0)},ue,Xe,Pe)}else fe=ue;return fe}if(ce.status==="done"&&ce.vectorTile)return ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Q){return m._(this,void 0,void 0,function*(){const $=this.loading,ce=Q.uid;$&&$[ce]&&$[ce].abort&&($[ce].abort.abort(),delete $[ce])})}removeTile(Q){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Q.uid]&&delete this.loaded[Q.uid]})}}class N{constructor(){this.loaded={}}loadTile(Q){return m._(this,void 0,void 0,function*(){const{uid:$,encoding:ce,rawImageData:ue,redFactor:fe,greenFactor:Ue,blueFactor:Xe,baseShift:Pe}=Q,nt=ue.width+2,_t=ue.height+2,lt=m.b(ue)?new m.R({width:nt,height:_t},yield m.bw(ue,-1,-1,nt,_t)):ue,Nt=new m.bx($,lt,ce,fe,Ue,Xe,Pe);return this.loaded=this.loaded||{},this.loaded[$]=Nt,Nt})}removeTile(Q){const $=this.loaded,ce=Q.uid;$&&$[ce]&&delete $[ce]}}function B(Re,Q){if(Re.length!==0){U(Re[0],Q);for(var $=1;$<Re.length;$++)U(Re[$],!Q)}}function U(Re,Q){for(var $=0,ce=0,ue=0,fe=Re.length,Ue=fe-1;ue<fe;Ue=ue++){var Xe=(Re[ue][0]-Re[Ue][0])*(Re[Ue][1]+Re[ue][1]),Pe=$+Xe;ce+=Math.abs($)>=Math.abs(Xe)?$-Pe+Xe:Xe-Pe+$,$=Pe}$+ce>=0!=!!Q&&Re.reverse()}var ee=m.by(function Re(Q,$){var ce,ue=Q&&Q.type;if(ue==="FeatureCollection")for(ce=0;ce<Q.features.length;ce++)Re(Q.features[ce],$);else if(ue==="GeometryCollection")for(ce=0;ce<Q.geometries.length;ce++)Re(Q.geometries[ce],$);else if(ue==="Feature")Re(Q.geometry,$);else if(ue==="Polygon")B(Q.coordinates,$);else if(ue==="MultiPolygon")for(ce=0;ce<Q.coordinates.length;ce++)B(Q.coordinates[ce],$);return Q});const ie=m.bt.VectorTileFeature.prototype.toGeoJSON;var ae={exports:{}},J=m.bz,Y=m.bt.VectorTileFeature,ge=xe;function xe(Re,Q){this.options=Q||{},this.features=Re,this.length=Re.length}function Ee(Re,Q){this.id=typeof Re.id=="number"?Re.id:void 0,this.type=Re.type,this.rawGeometry=Re.type===1?[Re.geometry]:Re.geometry,this.properties=Re.tags,this.extent=Q||4096}xe.prototype.feature=function(Re){return new Ee(this.features[Re],this.options.extent)},Ee.prototype.loadGeometry=function(){var Re=this.rawGeometry;this.geometry=[];for(var Q=0;Q<Re.length;Q++){for(var $=Re[Q],ce=[],ue=0;ue<$.length;ue++)ce.push(new J($[ue][0],$[ue][1]));this.geometry.push(ce)}return this.geometry},Ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Re=this.geometry,Q=1/0,$=-1/0,ce=1/0,ue=-1/0,fe=0;fe<Re.length;fe++)for(var Ue=Re[fe],Xe=0;Xe<Ue.length;Xe++){var Pe=Ue[Xe];Q=Math.min(Q,Pe.x),$=Math.max($,Pe.x),ce=Math.min(ce,Pe.y),ue=Math.max(ue,Pe.y)}return[Q,ce,$,ue]},Ee.prototype.toGeoJSON=Y.prototype.toGeoJSON;var ye=m.bA,be=ge;function ve(Re){var Q=new ye;return function($,ce){for(var ue in $.layers)ce.writeMessage(3,Ce,$.layers[ue])}(Re,Q),Q.finish()}function Ce(Re,Q){var $;Q.writeVarintField(15,Re.version||1),Q.writeStringField(1,Re.name||""),Q.writeVarintField(5,Re.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<Re.length;$++)ce.feature=Re.feature($),Q.writeMessage(2,we,ce);var ue=ce.keys;for($=0;$<ue.length;$++)Q.writeStringField(3,ue[$]);var fe=ce.values;for($=0;$<fe.length;$++)Q.writeMessage(4,dt,fe[$])}function we(Re,Q){var $=Re.feature;$.id!==void 0&&Q.writeVarintField(1,$.id),Q.writeMessage(2,_e,Re),Q.writeVarintField(3,$.type),Q.writeMessage(4,qe,$)}function _e(Re,Q){var $=Re.feature,ce=Re.keys,ue=Re.values,fe=Re.keycache,Ue=Re.valuecache;for(var Xe in $.properties){var Pe=$.properties[Xe],nt=fe[Xe];if(Pe!==null){nt===void 0&&(ce.push(Xe),fe[Xe]=nt=ce.length-1),Q.writeVarint(nt);var _t=typeof Pe;_t!=="string"&&_t!=="boolean"&&_t!=="number"&&(Pe=JSON.stringify(Pe));var lt=_t+":"+Pe,Nt=Ue[lt];Nt===void 0&&(ue.push(Pe),Ue[lt]=Nt=ue.length-1),Q.writeVarint(Nt)}}}function tt(Re,Q){return(Q<<3)+(7&Re)}function Ve(Re){return Re<<1^Re>>31}function qe(Re,Q){for(var $=Re.loadGeometry(),ce=Re.type,ue=0,fe=0,Ue=$.length,Xe=0;Xe<Ue;Xe++){var Pe=$[Xe],nt=1;ce===1&&(nt=Pe.length),Q.writeVarint(tt(1,nt));for(var _t=ce===3?Pe.length-1:Pe.length,lt=0;lt<_t;lt++){lt===1&&ce!==1&&Q.writeVarint(tt(2,_t-1));var Nt=Pe[lt].x-ue,en=Pe[lt].y-fe;Q.writeVarint(Ve(Nt)),Q.writeVarint(Ve(en)),ue+=Nt,fe+=en}ce===3&&Q.writeVarint(tt(7,1))}}function dt(Re,Q){var $=typeof Re;$==="string"?Q.writeStringField(1,Re):$==="boolean"?Q.writeBooleanField(7,Re):$==="number"&&(Re%1!=0?Q.writeDoubleField(3,Re):Re<0?Q.writeSVarintField(6,Re):Q.writeVarintField(5,Re))}ae.exports=ve,ae.exports.fromVectorTileJs=ve,ae.exports.fromGeojsonVt=function(Re,Q){Q=Q||{};var $={};for(var ce in Re)$[ce]=new be(Re[ce].features,Q),$[ce].name=ce,$[ce].version=Q.version,$[ce].extent=Q.extent;return ve({layers:$})},ae.exports.GeoJSONWrapper=be;var mt=m.by(ae.exports);const ct={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},Ut=Math.fround||(bt=new Float32Array(1),Re=>(bt[0]=+Re,bt[0]));var bt;const It=3,pt=5,kt=6;class St{constructor(Q){this.options=Object.assign(Object.create(ct),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:$,minZoom:ce,maxZoom:ue}=this.options;$&&console.time("total time");const fe=`prepare ${Q.length} points`;$&&console.time(fe),this.points=Q;const Ue=[];for(let Pe=0;Pe<Q.length;Pe++){const nt=Q[Pe];if(!nt.geometry)continue;const[_t,lt]=nt.geometry.coordinates,Nt=Ut(Pn(_t)),en=Ut(We(lt));Ue.push(Nt,en,1/0,Pe,-1,1),this.options.reduce&&Ue.push(0)}let Xe=this.trees[ue+1]=this._createTree(Ue);$&&console.timeEnd(fe);for(let Pe=ue;Pe>=ce;Pe--){const nt=+Date.now();Xe=this.trees[Pe]=this._createTree(this._cluster(Xe,Pe)),$&&console.log("z%d: %d clusters in %dms",Pe,Xe.numItems,+Date.now()-nt)}return $&&console.timeEnd("total time"),this}getClusters(Q,$){let ce=((Q[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,Q[1]));let fe=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)ce=-180,fe=180;else if(ce>fe){const lt=this.getClusters([ce,ue,180,Ue],$),Nt=this.getClusters([-180,ue,fe,Ue],$);return lt.concat(Nt)}const Xe=this.trees[this._limitZoom($)],Pe=Xe.range(Pn(ce),We(Ue),Pn(fe),We(ue)),nt=Xe.data,_t=[];for(const lt of Pe){const Nt=this.stride*lt;_t.push(nt[Nt+pt]>1?$t(nt,Nt,this.clusterProps):this.points[nt[Nt+It]])}return _t}getChildren(Q){const $=this._getOriginId(Q),ce=this._getOriginZoom(Q),ue="No cluster with the specified id.",fe=this.trees[ce];if(!fe)throw new Error(ue);const Ue=fe.data;if($*this.stride>=Ue.length)throw new Error(ue);const Xe=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Pe=fe.within(Ue[$*this.stride],Ue[$*this.stride+1],Xe),nt=[];for(const _t of Pe){const lt=_t*this.stride;Ue[lt+4]===Q&&nt.push(Ue[lt+pt]>1?$t(Ue,lt,this.clusterProps):this.points[Ue[lt+It]])}if(nt.length===0)throw new Error(ue);return nt}getLeaves(Q,$,ce){const ue=[];return this._appendLeaves(ue,Q,$=$||10,ce=ce||0,0),ue}getTile(Q,$,ce){const ue=this.trees[this._limitZoom(Q)],fe=Math.pow(2,Q),{extent:Ue,radius:Xe}=this.options,Pe=Xe/Ue,nt=(ce-Pe)/fe,_t=(ce+1+Pe)/fe,lt={features:[]};return this._addTileFeatures(ue.range(($-Pe)/fe,nt,($+1+Pe)/fe,_t),ue.data,$,ce,fe,lt),$===0&&this._addTileFeatures(ue.range(1-Pe/fe,nt,1,_t),ue.data,fe,ce,fe,lt),$===fe-1&&this._addTileFeatures(ue.range(0,nt,Pe/fe,_t),ue.data,-1,ce,fe,lt),lt.features.length?lt:null}getClusterExpansionZoom(Q){let $=this._getOriginZoom(Q)-1;for(;$<=this.options.maxZoom;){const ce=this.getChildren(Q);if($++,ce.length!==1)break;Q=ce[0].properties.cluster_id}return $}_appendLeaves(Q,$,ce,ue,fe){const Ue=this.getChildren($);for(const Xe of Ue){const Pe=Xe.properties;if(Pe&&Pe.cluster?fe+Pe.point_count<=ue?fe+=Pe.point_count:fe=this._appendLeaves(Q,Pe.cluster_id,ce,ue,fe):fe<ue?fe++:Q.push(Xe),Q.length===ce)break}return fe}_createTree(Q){const $=new m.av(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Q.length;ce+=this.stride)$.add(Q[ce],Q[ce+1]);return $.finish(),$.data=Q,$}_addTileFeatures(Q,$,ce,ue,fe,Ue){for(const Xe of Q){const Pe=Xe*this.stride,nt=$[Pe+pt]>1;let _t,lt,Nt;if(nt)_t=pn($,Pe,this.clusterProps),lt=$[Pe],Nt=$[Pe+1];else{const Zn=this.points[$[Pe+It]];_t=Zn.properties;const[Tn,Cn]=Zn.geometry.coordinates;lt=Pn(Tn),Nt=We(Cn)}const en={type:1,geometry:[[Math.round(this.options.extent*(lt*fe-ce)),Math.round(this.options.extent*(Nt*fe-ue))]],tags:_t};let ln;ln=nt||this.options.generateId?$[Pe+It]:this.points[$[Pe+It]].id,ln!==void 0&&(en.id=ln),Ue.features.push(en)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,$){const{radius:ce,extent:ue,reduce:fe,minPoints:Ue}=this.options,Xe=ce/(ue*Math.pow(2,$)),Pe=Q.data,nt=[],_t=this.stride;for(let lt=0;lt<Pe.length;lt+=_t){if(Pe[lt+2]<=$)continue;Pe[lt+2]=$;const Nt=Pe[lt],en=Pe[lt+1],ln=Q.within(Pe[lt],Pe[lt+1],Xe),Zn=Pe[lt+pt];let Tn=Zn;for(const Cn of ln){const Un=Cn*_t;Pe[Un+2]>$&&(Tn+=Pe[Un+pt])}if(Tn>Zn&&Tn>=Ue){let Cn,Un=Nt*Zn,Ii=en*Zn,ci=-1;const En=((lt/_t|0)<<5)+($+1)+this.points.length;for(const ri of ln){const fi=ri*_t;if(Pe[fi+2]<=$)continue;Pe[fi+2]=$;const Di=Pe[fi+pt];Un+=Pe[fi]*Di,Ii+=Pe[fi+1]*Di,Pe[fi+4]=En,fe&&(Cn||(Cn=this._map(Pe,lt,!0),ci=this.clusterProps.length,this.clusterProps.push(Cn)),fe(Cn,this._map(Pe,fi)))}Pe[lt+4]=En,nt.push(Un/Tn,Ii/Tn,1/0,En,-1,Tn),fe&&nt.push(ci)}else{for(let Cn=0;Cn<_t;Cn++)nt.push(Pe[lt+Cn]);if(Tn>1)for(const Cn of ln){const Un=Cn*_t;if(!(Pe[Un+2]<=$)){Pe[Un+2]=$;for(let Ii=0;Ii<_t;Ii++)nt.push(Pe[Un+Ii])}}}}return nt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,$,ce){if(Q[$+pt]>1){const Ue=this.clusterProps[Q[$+kt]];return ce?Object.assign({},Ue):Ue}const ue=this.points[Q[$+It]].properties,fe=this.options.map(ue);return ce&&fe===ue?Object.assign({},fe):fe}}function $t(Re,Q,$){return{type:"Feature",id:Re[Q+It],properties:pn(Re,Q,$),geometry:{type:"Point",coordinates:[(ce=Re[Q],360*(ce-.5)),Kn(Re[Q+1])]}};var ce}function pn(Re,Q,$){const ce=Re[Q+pt],ue=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,fe=Re[Q+kt],Ue=fe===-1?{}:Object.assign({},$[fe]);return Object.assign(Ue,{cluster:!0,cluster_id:Re[Q+It],point_count:ce,point_count_abbreviated:ue})}function Pn(Re){return Re/360+.5}function We(Re){const Q=Math.sin(Re*Math.PI/180),$=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return $<0?0:$>1?1:$}function Kn(Re){const Q=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function dn(Re,Q,$,ce){let ue=ce;const fe=Q+($-Q>>1);let Ue,Xe=$-Q;const Pe=Re[Q],nt=Re[Q+1],_t=Re[$],lt=Re[$+1];for(let Nt=Q+3;Nt<$;Nt+=3){const en=Ot(Re[Nt],Re[Nt+1],Pe,nt,_t,lt);if(en>ue)Ue=Nt,ue=en;else if(en===ue){const ln=Math.abs(Nt-fe);ln<Xe&&(Ue=Nt,Xe=ln)}}ue>ce&&(Ue-Q>3&&dn(Re,Q,Ue,ce),Re[Ue+2]=ue,$-Ue>3&&dn(Re,Ue,$,ce))}function Ot(Re,Q,$,ce,ue,fe){let Ue=ue-$,Xe=fe-ce;if(Ue!==0||Xe!==0){const Pe=((Re-$)*Ue+(Q-ce)*Xe)/(Ue*Ue+Xe*Xe);Pe>1?($=ue,ce=fe):Pe>0&&($+=Ue*Pe,ce+=Xe*Pe)}return Ue=Re-$,Xe=Q-ce,Ue*Ue+Xe*Xe}function Ae(Re,Q,$,ce){const ue={id:Re??null,type:Q,geometry:$,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")ut(ue,$);else if(Q==="Polygon")ut(ue,$[0]);else if(Q==="MultiLineString")for(const fe of $)ut(ue,fe);else if(Q==="MultiPolygon")for(const fe of $)ut(ue,fe[0]);return ue}function ut(Re,Q){for(let $=0;$<Q.length;$+=3)Re.minX=Math.min(Re.minX,Q[$]),Re.minY=Math.min(Re.minY,Q[$+1]),Re.maxX=Math.max(Re.maxX,Q[$]),Re.maxY=Math.max(Re.maxY,Q[$+1])}function Ye(Re,Q,$,ce){if(!Q.geometry)return;const ue=Q.geometry.coordinates;if(ue&&ue.length===0)return;const fe=Q.geometry.type,Ue=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let Xe=[],Pe=Q.id;if($.promoteId?Pe=Q.properties[$.promoteId]:$.generateId&&(Pe=ce||0),fe==="Point")Lt(ue,Xe);else if(fe==="MultiPoint")for(const nt of ue)Lt(nt,Xe);else if(fe==="LineString")Ke(ue,Xe,Ue,!1);else if(fe==="MultiLineString"){if($.lineMetrics){for(const nt of ue)Xe=[],Ke(nt,Xe,Ue,!1),Re.push(Ae(Pe,"LineString",Xe,Q.properties));return}On(ue,Xe,Ue,!1)}else if(fe==="Polygon")On(ue,Xe,Ue,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const nt of Q.geometry.geometries)Ye(Re,{id:Pe,geometry:nt,properties:Q.properties},$,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of ue){const _t=[];On(nt,_t,Ue,!0),Xe.push(_t)}}Re.push(Ae(Pe,fe,Xe,Q.properties))}function Lt(Re,Q){Q.push(xt(Re[0]),Se(Re[1]),0)}function Ke(Re,Q,$,ce){let ue,fe,Ue=0;for(let Pe=0;Pe<Re.length;Pe++){const nt=xt(Re[Pe][0]),_t=Se(Re[Pe][1]);Q.push(nt,_t,0),Pe>0&&(Ue+=ce?(ue*_t-nt*fe)/2:Math.sqrt(Math.pow(nt-ue,2)+Math.pow(_t-fe,2))),ue=nt,fe=_t}const Xe=Q.length-3;Q[2]=1,dn(Q,0,Xe,$),Q[Xe+2]=1,Q.size=Math.abs(Ue),Q.start=0,Q.end=Q.size}function On(Re,Q,$,ce){for(let ue=0;ue<Re.length;ue++){const fe=[];Ke(Re[ue],fe,$,ce),Q.push(fe)}}function xt(Re){return Re/360+.5}function Se(Re){const Q=Math.sin(Re*Math.PI/180),$=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return $<0?0:$>1?1:$}function Bt(Re,Q,$,ce,ue,fe,Ue,Xe){if(ce/=Q,fe>=($/=Q)&&Ue<ce)return Re;if(Ue<$||fe>=ce)return null;const Pe=[];for(const nt of Re){const _t=nt.geometry;let lt=nt.type;const Nt=ue===0?nt.minX:nt.minY,en=ue===0?nt.maxX:nt.maxY;if(Nt>=$&&en<ce){Pe.push(nt);continue}if(en<$||Nt>=ce)continue;let ln=[];if(lt==="Point"||lt==="MultiPoint")Mn(_t,ln,$,ce,ue);else if(lt==="LineString")Fn(_t,ln,$,ce,ue,!1,Xe.lineMetrics);else if(lt==="MultiLineString")Jt(_t,ln,$,ce,ue,!1);else if(lt==="Polygon")Jt(_t,ln,$,ce,ue,!0);else if(lt==="MultiPolygon")for(const Zn of _t){const Tn=[];Jt(Zn,Tn,$,ce,ue,!0),Tn.length&&ln.push(Tn)}if(ln.length){if(Xe.lineMetrics&&lt==="LineString"){for(const Zn of ln)Pe.push(Ae(nt.id,lt,Zn,nt.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(ln.length===1?(lt="LineString",ln=ln[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=ln.length===3?"Point":"MultiPoint"),Pe.push(Ae(nt.id,lt,ln,nt.tags))}}return Pe.length?Pe:null}function Mn(Re,Q,$,ce,ue){for(let fe=0;fe<Re.length;fe+=3){const Ue=Re[fe+ue];Ue>=$&&Ue<=ce&&Ri(Q,Re[fe],Re[fe+1],Re[fe+2])}}function Fn(Re,Q,$,ce,ue,fe,Ue){let Xe=ei(Re);const Pe=ue===0?Qi:ns;let nt,_t,lt=Re.start;for(let Tn=0;Tn<Re.length-3;Tn+=3){const Cn=Re[Tn],Un=Re[Tn+1],Ii=Re[Tn+2],ci=Re[Tn+3],En=Re[Tn+4],ri=ue===0?Cn:Un,fi=ue===0?ci:En;let Di=!1;Ue&&(nt=Math.sqrt(Math.pow(Cn-ci,2)+Math.pow(Un-En,2))),ri<$?fi>$&&(_t=Pe(Xe,Cn,Un,ci,En,$),Ue&&(Xe.start=lt+nt*_t)):ri>ce?fi<ce&&(_t=Pe(Xe,Cn,Un,ci,En,ce),Ue&&(Xe.start=lt+nt*_t)):Ri(Xe,Cn,Un,Ii),fi<$&&ri>=$&&(_t=Pe(Xe,Cn,Un,ci,En,$),Di=!0),fi>ce&&ri<=ce&&(_t=Pe(Xe,Cn,Un,ci,En,ce),Di=!0),!fe&&Di&&(Ue&&(Xe.end=lt+nt*_t),Q.push(Xe),Xe=ei(Re)),Ue&&(lt+=nt)}let Nt=Re.length-3;const en=Re[Nt],ln=Re[Nt+1],Zn=ue===0?en:ln;Zn>=$&&Zn<=ce&&Ri(Xe,en,ln,Re[Nt+2]),Nt=Xe.length-3,fe&&Nt>=3&&(Xe[Nt]!==Xe[0]||Xe[Nt+1]!==Xe[1])&&Ri(Xe,Xe[0],Xe[1],Xe[2]),Xe.length&&Q.push(Xe)}function ei(Re){const Q=[];return Q.size=Re.size,Q.start=Re.start,Q.end=Re.end,Q}function Jt(Re,Q,$,ce,ue,fe){for(const Ue of Re)Fn(Ue,Q,$,ce,ue,fe,!1)}function Ri(Re,Q,$,ce){Re.push(Q,$,ce)}function Qi(Re,Q,$,ce,ue,fe){const Ue=(fe-Q)/(ce-Q);return Ri(Re,fe,$+(ue-$)*Ue,1),Ue}function ns(Re,Q,$,ce,ue,fe){const Ue=(fe-$)/(ue-$);return Ri(Re,Q+(ce-Q)*Ue,fe,1),Ue}function ht(Re,Q){const $=[];for(let ce=0;ce<Re.length;ce++){const ue=Re[ce],fe=ue.type;let Ue;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Ue=vr(ue.geometry,Q);else if(fe==="MultiLineString"||fe==="Polygon"){Ue=[];for(const Xe of ue.geometry)Ue.push(vr(Xe,Q))}else if(fe==="MultiPolygon"){Ue=[];for(const Xe of ue.geometry){const Pe=[];for(const nt of Xe)Pe.push(vr(nt,Q));Ue.push(Pe)}}$.push(Ae(ue.id,fe,Ue,ue.tags))}return $}function vr(Re,Q){const $=[];$.size=Re.size,Re.start!==void 0&&($.start=Re.start,$.end=Re.end);for(let ce=0;ce<Re.length;ce+=3)$.push(Re[ce]+Q,Re[ce+1],Re[ce+2]);return $}function xn(Re,Q){if(Re.transformed)return Re;const $=1<<Re.z,ce=Re.x,ue=Re.y;for(const fe of Re.features){const Ue=fe.geometry,Xe=fe.type;if(fe.geometry=[],Xe===1)for(let Pe=0;Pe<Ue.length;Pe+=2)fe.geometry.push(mn(Ue[Pe],Ue[Pe+1],Q,$,ce,ue));else for(let Pe=0;Pe<Ue.length;Pe++){const nt=[];for(let _t=0;_t<Ue[Pe].length;_t+=2)nt.push(mn(Ue[Pe][_t],Ue[Pe][_t+1],Q,$,ce,ue));fe.geometry.push(nt)}}return Re.transformed=!0,Re}function mn(Re,Q,$,ce,ue,fe){return[Math.round($*(Re*ce-ue)),Math.round($*(Q*ce-fe))]}function Rs(Re,Q,$,ce,ue){const fe=Q===ue.maxZoom?0:ue.tolerance/((1<<Q)*ue.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:$,y:ce,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Xe of Re)Rt(Ue,Xe,fe,ue);return Ue}function Rt(Re,Q,$,ce){const ue=Q.geometry,fe=Q.type,Ue=[];if(Re.minX=Math.min(Re.minX,Q.minX),Re.minY=Math.min(Re.minY,Q.minY),Re.maxX=Math.max(Re.maxX,Q.maxX),Re.maxY=Math.max(Re.maxY,Q.maxY),fe==="Point"||fe==="MultiPoint")for(let Xe=0;Xe<ue.length;Xe+=3)Ue.push(ue[Xe],ue[Xe+1]),Re.numPoints++,Re.numSimplified++;else if(fe==="LineString")An(Ue,ue,Re,$,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Xe=0;Xe<ue.length;Xe++)An(Ue,ue[Xe],Re,$,fe==="Polygon",Xe===0);else if(fe==="MultiPolygon")for(let Xe=0;Xe<ue.length;Xe++){const Pe=ue[Xe];for(let nt=0;nt<Pe.length;nt++)An(Ue,Pe[nt],Re,$,!0,nt===0)}if(Ue.length){let Xe=Q.tags||null;if(fe==="LineString"&&ce.lineMetrics){Xe={};for(const nt in Q.tags)Xe[nt]=Q.tags[nt];Xe.mapbox_clip_start=ue.start/ue.size,Xe.mapbox_clip_end=ue.end/ue.size}const Pe={geometry:Ue,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Xe};Q.id!==null&&(Pe.id=Q.id),Re.features.push(Pe)}}function An(Re,Q,$,ce,ue,fe){const Ue=ce*ce;if(ce>0&&Q.size<(ue?Ue:ce))return void($.numPoints+=Q.length/3);const Xe=[];for(let Pe=0;Pe<Q.length;Pe+=3)(ce===0||Q[Pe+2]>Ue)&&($.numSimplified++,Xe.push(Q[Pe],Q[Pe+1])),$.numPoints++;ue&&function(Pe,nt){let _t=0;for(let lt=0,Nt=Pe.length,en=Nt-2;lt<Nt;en=lt,lt+=2)_t+=(Pe[lt]-Pe[en])*(Pe[lt+1]+Pe[en+1]);if(_t>0===nt)for(let lt=0,Nt=Pe.length;lt<Nt/2;lt+=2){const en=Pe[lt],ln=Pe[lt+1];Pe[lt]=Pe[Nt-2-lt],Pe[lt+1]=Pe[Nt-1-lt],Pe[Nt-2-lt]=en,Pe[Nt-1-lt]=ln}}(Xe,fe),Re.push(Xe)}const At={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class br{constructor(Q,$){const ce=($=this.options=function(fe,Ue){for(const Xe in Ue)fe[Xe]=Ue[Xe];return fe}(Object.create(At),$)).debug;if(ce&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=function(fe,Ue){const Xe=[];if(fe.type==="FeatureCollection")for(let Pe=0;Pe<fe.features.length;Pe++)Ye(Xe,fe.features[Pe],Ue,Pe);else Ye(Xe,fe.type==="Feature"?fe:{geometry:fe},Ue);return Xe}(Q,$);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(fe,Ue){const Xe=Ue.buffer/Ue.extent;let Pe=fe;const nt=Bt(fe,1,-1-Xe,Xe,0,-1,2,Ue),_t=Bt(fe,1,1-Xe,2+Xe,0,-1,2,Ue);return(nt||_t)&&(Pe=Bt(fe,1,-Xe,1+Xe,0,-1,2,Ue)||[],nt&&(Pe=ht(nt,1).concat(Pe)),_t&&(Pe=Pe.concat(ht(_t,-1)))),Pe}(ue,$),ue.length&&this.splitTile(ue,0,0,0),ce&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,$,ce,ue,fe,Ue,Xe){const Pe=[Q,$,ce,ue],nt=this.options,_t=nt.debug;for(;Pe.length;){ue=Pe.pop(),ce=Pe.pop(),$=Pe.pop(),Q=Pe.pop();const lt=1<<$,Nt=Wr($,ce,ue);let en=this.tiles[Nt];if(!en&&(_t>1&&console.time("creation"),en=this.tiles[Nt]=Rs(Q,$,ce,ue,nt),this.tileCoords.push({z:$,x:ce,y:ue}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,ce,ue,en.numFeatures,en.numPoints,en.numSimplified),console.timeEnd("creation"));const Di=`z${$}`;this.stats[Di]=(this.stats[Di]||0)+1,this.total++}if(en.source=Q,fe==null){if($===nt.indexMaxZoom||en.numPoints<=nt.indexMaxPoints)continue}else{if($===nt.maxZoom||$===fe)continue;if(fe!=null){const Di=fe-$;if(ce!==Ue>>Di||ue!==Xe>>Di)continue}}if(en.source=null,Q.length===0)continue;_t>1&&console.time("clipping");const ln=.5*nt.buffer/nt.extent,Zn=.5-ln,Tn=.5+ln,Cn=1+ln;let Un=null,Ii=null,ci=null,En=null,ri=Bt(Q,lt,ce-ln,ce+Tn,0,en.minX,en.maxX,nt),fi=Bt(Q,lt,ce+Zn,ce+Cn,0,en.minX,en.maxX,nt);Q=null,ri&&(Un=Bt(ri,lt,ue-ln,ue+Tn,1,en.minY,en.maxY,nt),Ii=Bt(ri,lt,ue+Zn,ue+Cn,1,en.minY,en.maxY,nt),ri=null),fi&&(ci=Bt(fi,lt,ue-ln,ue+Tn,1,en.minY,en.maxY,nt),En=Bt(fi,lt,ue+Zn,ue+Cn,1,en.minY,en.maxY,nt),fi=null),_t>1&&console.timeEnd("clipping"),Pe.push(Un||[],$+1,2*ce,2*ue),Pe.push(Ii||[],$+1,2*ce,2*ue+1),Pe.push(ci||[],$+1,2*ce+1,2*ue),Pe.push(En||[],$+1,2*ce+1,2*ue+1)}}getTile(Q,$,ce){Q=+Q,$=+$,ce=+ce;const ue=this.options,{extent:fe,debug:Ue}=ue;if(Q<0||Q>24)return null;const Xe=1<<Q,Pe=Wr(Q,$=$+Xe&Xe-1,ce);if(this.tiles[Pe])return xn(this.tiles[Pe],fe);Ue>1&&console.log("drilling down to z%d-%d-%d",Q,$,ce);let nt,_t=Q,lt=$,Nt=ce;for(;!nt&&_t>0;)_t--,lt>>=1,Nt>>=1,nt=this.tiles[Wr(_t,lt,Nt)];return nt&&nt.source?(Ue>1&&(console.log("found parent tile z%d-%d-%d",_t,lt,Nt),console.time("drilling down")),this.splitTile(nt.source,_t,lt,Nt,Q,$,ce),Ue>1&&console.timeEnd("drilling down"),this.tiles[Pe]?xn(this.tiles[Pe],fe):null):null}}function Wr(Re,Q,$){return 32*((1<<Re)*$+Q)+Re}function bn(Re,Q){return Q?Re.properties[Q]:Re.id}function Pi(Re,Q){if(Re==null)return!0;if(Re.type==="Feature")return bn(Re,Q)!=null;if(Re.type==="FeatureCollection"){const $=new Set;for(const ce of Re.features){const ue=bn(ce,Q);if(ue==null||$.has(ue))return!1;$.add(ue)}return!0}return!1}function Ar(Re,Q){const $=new Map;if(Re!=null)if(Re.type==="Feature")$.set(bn(Re,Q),Re);else for(const ce of Re.features)$.set(bn(ce,Q),ce);return $}class er extends C{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Q,$){return m._(this,void 0,void 0,function*(){const ce=Q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ue)return null;const fe=new class{constructor(Xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.X,this.length=Xe.length,this._features=Xe}feature(Xe){return new class{constructor(Pe){this._feature=Pe,this.extent=m.X,this.type=Pe.type,this.properties=Pe.tags,"id"in Pe&&!isNaN(Pe.id)&&(this.id=parseInt(Pe.id,10))}loadGeometry(){if(this._feature.type===1){const Pe=[];for(const nt of this._feature.geometry)Pe.push([new m.P(nt[0],nt[1])]);return Pe}{const Pe=[];for(const nt of this._feature.geometry){const _t=[];for(const lt of nt)_t.push(new m.P(lt[0],lt[1]));Pe.push(_t)}return Pe}}toGeoJSON(Pe,nt,_t){return ie.call(this,Pe,nt,_t)}}(this._features[Xe])}}(ue.features);let Ue=mt(fe);return Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),{vectorTile:fe,rawData:Ue.buffer}})}loadData(Q){return m._(this,void 0,void 0,function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const ce=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new m.bv(Q.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Q,this._pendingRequest),this._geoJSONIndex=Q.cluster?new St(function({superclusterOptions:Ue,clusterProperties:Xe}){if(!Xe||!Ue)return Ue;const Pe={},nt={},_t={accumulated:null,zoom:0},lt={properties:null},Nt=Object.keys(Xe);for(const en of Nt){const[ln,Zn]=Xe[en],Tn=m.bC(Zn),Cn=m.bC(typeof ln=="string"?[ln,["accumulated"],["get",en]]:ln);Pe[en]=Tn.value,nt[en]=Cn.value}return Ue.map=en=>{lt.properties=en;const ln={};for(const Zn of Nt)ln[Zn]=Pe[Zn].evaluate(_t,lt);return ln},Ue.reduce=(en,ln)=>{lt.properties=ln;for(const Zn of Nt)_t.accumulated=en[Zn],en[Zn]=nt[Zn].evaluate(_t,lt)},Ue}(Q)).load((yield this._pendingData).features):(ue=yield this._pendingData,new br(ue,Q.geojsonVtOptions)),this.loaded={};const fe={};if(ce){const Ue=ce.finish();Ue&&(fe.resourceTiming={},fe.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Ue)))}return fe}catch(fe){if(delete this._pendingRequest,m.bB(fe))return{abandoned:!0};throw fe}var ue})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Q){const $=this.loaded;return $&&$[Q.uid]?super.reloadTile(Q):this.loadTile(Q)}loadAndProcessGeoJSON(Q,$){return m._(this,void 0,void 0,function*(){let ce=yield this.loadGeoJSON(Q,$);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(ee(ce,!0),Q.filter){const ue=m.bC(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(Ue=>ue.value.evaluate({zoom:0},Ue))}}return ce})}loadGeoJSON(Q,$){return m._(this,void 0,void 0,function*(){const{promoteId:ce}=Q;if(Q.request){const ue=yield m.h(Q.request,$);return this._dataUpdateable=Pi(ue.data,ce)?Ar(ue.data,ce):void 0,ue.data}if(typeof Q.data=="string")try{const ue=JSON.parse(Q.data);return this._dataUpdateable=Pi(ue,ce)?Ar(ue,ce):void 0,ue}catch{throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`)}if(!Q.dataDiff)throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Q.source}`);return function(ue,fe,Ue){var Xe,Pe,nt,_t;if(fe.removeAll&&ue.clear(),fe.remove)for(const lt of fe.remove)ue.delete(lt);if(fe.add)for(const lt of fe.add){const Nt=bn(lt,Ue);Nt!=null&&ue.set(Nt,lt)}if(fe.update)for(const lt of fe.update){let Nt=ue.get(lt.id);if(Nt==null)continue;const en=!lt.removeAllProperties&&(((Xe=lt.removeProperties)===null||Xe===void 0?void 0:Xe.length)>0||((Pe=lt.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0);if((lt.newGeometry||lt.removeAllProperties||en)&&(Nt=Object.assign({},Nt),ue.set(lt.id,Nt),en&&(Nt.properties=Object.assign({},Nt.properties))),lt.newGeometry&&(Nt.geometry=lt.newGeometry),lt.removeAllProperties)Nt.properties={};else if(((nt=lt.removeProperties)===null||nt===void 0?void 0:nt.length)>0)for(const ln of lt.removeProperties)Object.prototype.hasOwnProperty.call(Nt.properties,ln)&&delete Nt.properties[ln];if(((_t=lt.addOrUpdateProperties)===null||_t===void 0?void 0:_t.length)>0)for(const{key:ln,value:Zn}of lt.addOrUpdateProperties)Nt.properties[ln]=Zn}}(this._dataUpdateable,Q.dataDiff,ce),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Q){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Q){return this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId)}getClusterChildren(Q){return this._geoJSONIndex.getChildren(Q.clusterId)}getClusterLeaves(Q){return this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset)}}class Kr{constructor(Q){this.self=Q,this.actor=new m.F(Q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=($,ce)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=ce},this.self.addProtocol=m.bi,this.self.removeProtocol=m.bj,this.self.registerRTLTextPlugin=$=>{if(m.bD.isParsed())throw new Error("RTL text plugin already registered.");m.bD.setMethods($)},this.actor.registerMessageHandler("LDT",($,ce)=>this._getDEMWorkerSource($,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RDT",($,ce)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource($,ce.source).removeTile(ce)})),this.actor.registerMessageHandler("GCEZ",($,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource($,ce.type,ce.source).getClusterExpansionZoom(ce)})),this.actor.registerMessageHandler("GCC",($,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource($,ce.type,ce.source).getClusterChildren(ce)})),this.actor.registerMessageHandler("GCL",($,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource($,ce.type,ce.source).getClusterLeaves(ce)})),this.actor.registerMessageHandler("LD",($,ce)=>this._getWorkerSource($,ce.type,ce.source).loadData(ce)),this.actor.registerMessageHandler("GD",($,ce)=>this._getWorkerSource($,ce.type,ce.source).getData()),this.actor.registerMessageHandler("LT",($,ce)=>this._getWorkerSource($,ce.type,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RT",($,ce)=>this._getWorkerSource($,ce.type,ce.source).reloadTile(ce)),this.actor.registerMessageHandler("AT",($,ce)=>this._getWorkerSource($,ce.type,ce.source).abortTile(ce)),this.actor.registerMessageHandler("RMT",($,ce)=>this._getWorkerSource($,ce.type,ce.source).removeTile(ce)),this.actor.registerMessageHandler("RS",($,ce)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[$]||!this.workerSources[$][ce.type]||!this.workerSources[$][ce.type][ce.source])return;const ue=this.workerSources[$][ce.type][ce.source];delete this.workerSources[$][ce.type][ce.source],ue.removeSource!==void 0&&ue.removeSource(ce)})),this.actor.registerMessageHandler("RM",$=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$]})),this.actor.registerMessageHandler("SR",($,ce)=>m._(this,void 0,void 0,function*(){this.referrer=ce})),this.actor.registerMessageHandler("SRPS",($,ce)=>this._syncRTLPluginState($,ce)),this.actor.registerMessageHandler("IS",($,ce)=>m._(this,void 0,void 0,function*(){this.self.importScripts(ce)})),this.actor.registerMessageHandler("SI",($,ce)=>this._setImages($,ce)),this.actor.registerMessageHandler("UL",($,ce)=>m._(this,void 0,void 0,function*(){this._getLayerIndex($).update(ce.layers,ce.removedIds)})),this.actor.registerMessageHandler("SL",($,ce)=>m._(this,void 0,void 0,function*(){this._getLayerIndex($).replace(ce)}))}_setImages(Q,$){return m._(this,void 0,void 0,function*(){this.availableImages[Q]=$;for(const ce in this.workerSources[Q]){const ue=this.workerSources[Q][ce];for(const fe in ue)ue[fe].availableImages=$}})}_syncRTLPluginState(Q,$){return m._(this,void 0,void 0,function*(){if(m.bD.isParsed())return m.bD.getState();if($.pluginStatus!=="loading")return m.bD.setState($),$;const ce=$.pluginURL;if(this.self.importScripts(ce),m.bD.isParsed()){const ue={pluginStatus:"loaded",pluginURL:ce};return m.bD.setState(ue),ue}throw m.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ce}`)})}_getAvailableImages(Q){let $=this.availableImages[Q];return $||($=[]),$}_getLayerIndex(Q){let $=this.layerIndexes[Q];return $||($=this.layerIndexes[Q]=new l),$}_getWorkerSource(Q,$,ce){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][$]||(this.workerSources[Q][$]={}),!this.workerSources[Q][$][ce]){const ue={sendAsync:(fe,Ue)=>(fe.targetMapId=Q,this.actor.sendAsync(fe,Ue))};switch($){case"vector":this.workerSources[Q][$][ce]=new C(ue,this._getLayerIndex(Q),this._getAvailableImages(Q));break;case"geojson":this.workerSources[Q][$][ce]=new er(ue,this._getLayerIndex(Q),this._getAvailableImages(Q));break;default:this.workerSources[Q][$][ce]=new this.externalWorkerSourceTypes[$](ue,this._getLayerIndex(Q),this._getAvailableImages(Q))}}return this.workerSources[Q][$][ce]}_getDEMWorkerSource(Q,$){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][$]||(this.demWorkerSources[Q][$]=new N),this.demWorkerSources[Q][$]}}return m.i(self)&&(self.worker=new Kr(self)),Kr}),a("index",["exports","./shared"],function(m,l){var x="4.7.0";let S,T;const C={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:k=>new Promise((n,f)=>{const _=requestAnimationFrame(n);k.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),f(l.c())})}),getImageData(k,n=0){return this.getImageCanvasContext(k).getImageData(-n,-n,k.width+2*n,k.height+2*n)},getImageCanvasContext(k){const n=window.document.createElement("canvas"),f=n.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return n.width=k.width,n.height=k.height,f.drawImage(k,0,0,k.width,k.height),f},resolveURL:k=>(S||(S=document.createElement("a")),S.href=k,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class N{static testProp(n){if(!N.docStyle)return n[0];for(let f=0;f<n.length;f++)if(n[f]in N.docStyle)return n[f];return n[0]}static create(n,f,_){const y=window.document.createElement(n);return f!==void 0&&(y.className=f),_&&_.appendChild(y),y}static createNS(n,f){return window.document.createElementNS(n,f)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(n,f){n.style[N.transformProp]=f}static addEventListener(n,f,_,y={}){n.addEventListener(f,_,"passive"in y?y:y.capture)}static removeEventListener(n,f,_,y={}){n.removeEventListener(f,_,"passive"in y?y:y.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(n){const f=n.getBoundingClientRect();return{x:f.width/n.offsetWidth||1,y:f.height/n.offsetHeight||1,boundingClientRect:f}}static getPoint(n,f,_){const y=f.boundingClientRect;return new l.P((_.clientX-y.left)/f.x-n.clientLeft,(_.clientY-y.top)/f.y-n.clientTop)}static mousePos(n,f){const _=N.getScale(n);return N.getPoint(n,_,f)}static touchPos(n,f){const _=[],y=N.getScale(n);for(let w=0;w<f.length;w++)_.push(N.getPoint(n,y,f[w]));return _}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(k){!ie&&ee&&(ae?J(k):U=k)}};let U,ee,ie=!1,ae=!1;function J(k){const n=k.createTexture();k.bindTexture(k.TEXTURE_2D,n);try{if(k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,ee),k.isContextLost())return;B.supported=!0}catch{}k.deleteTexture(n),ie=!0}var Y;typeof document<"u"&&(ee=document.createElement("img"),ee.onload=()=>{U&&J(U),U=null,ae=!0},ee.onerror=()=>{ie=!0,U=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(k){let n,f,_,y;k.resetRequestQueue=()=>{n=[],f=0,_=0,y={}},k.addThrottleControl=z=>{const q=_++;return y[q]=z,q},k.removeThrottleControl=z=>{delete y[z],R()},k.getImage=(z,q,H=!0)=>new Promise((X,ne)=>{B.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),l.e(z,{type:"image"}),n.push({abortController:q,requestParameters:z,supportImageRefresh:H,state:"queued",onError:me=>{ne(me)},onSuccess:me=>{X(me)}}),R()});const w=z=>l._(this,void 0,void 0,function*(){z.state="running";const{requestParameters:q,supportImageRefresh:H,onError:X,onSuccess:ne,abortController:me}=z,Ie=H===!1&&!l.i(self)&&!l.g(q.url)&&(!q.headers||Object.keys(q.headers).reduce((Fe,je)=>Fe&&je==="accept",!0));f++;const Me=Ie?D(q,me):l.m(q,me);try{const Fe=yield Me;delete z.abortController,z.state="completed",Fe.data instanceof HTMLImageElement||l.b(Fe.data)?ne(Fe):Fe.data&&ne({data:yield(Ne=Fe.data,typeof createImageBitmap=="function"?l.d(Ne):l.f(Ne)),cacheControl:Fe.cacheControl,expires:Fe.expires})}catch(Fe){delete z.abortController,X(Fe)}finally{f--,R()}var Ne}),R=()=>{const z=(()=>{for(const q of Object.keys(y))if(y[q]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let q=f;q<z&&n.length>0;q++){const H=n.shift();H.abortController.signal.aborted?q--:w(H)}},D=(z,q)=>new Promise((H,X)=>{const ne=new Image,me=z.url,Ie=z.credentials;Ie&&Ie==="include"?ne.crossOrigin="use-credentials":(Ie&&Ie==="same-origin"||!l.s(me))&&(ne.crossOrigin="anonymous"),q.signal.addEventListener("abort",()=>{ne.src="",X(l.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,H({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,q.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=me})}(Y||(Y={})),Y.resetRequestQueue();class ge{constructor(n){this._transformRequestFn=n}transformRequest(n,f){return this._transformRequestFn&&this._transformRequestFn(n,f)||{url:n}}setTransformRequest(n){this._transformRequestFn=n}}function xe(k){var n=new l.A(3);return n[0]=k[0],n[1]=k[1],n[2]=k[2],n}var Ee,ye=function(k,n,f){return k[0]=n[0]-f[0],k[1]=n[1]-f[1],k[2]=n[2]-f[2],k};Ee=new l.A(3),l.A!=Float32Array&&(Ee[0]=0,Ee[1]=0,Ee[2]=0);var be=function(k){var n=k[0],f=k[1];return n*n+f*f};function ve(k){const n=[];if(typeof k=="string")n.push({id:"default",url:k});else if(k&&k.length>0){const f=[];for(const{id:_,url:y}of k){const w=`${_}${y}`;f.indexOf(w)===-1&&(f.push(w),n.push({id:_,url:y}))}}return n}function Ce(k,n,f){const _=k.split("?");return _[0]+=`${n}${f}`,_.join("?")}(function(){var k=new l.A(2);l.A!=Float32Array&&(k[0]=0,k[1]=0)})();class we{constructor(n,f,_,y){this.context=n,this.format=_,this.texture=n.gl.createTexture(),this.update(f,y)}update(n,f,_){const{width:y,height:w}=n,R=!(this.size&&this.size[0]===y&&this.size[1]===w||_),{context:D}=this,{gl:z}=D;if(this.useMipmap=!!(f&&f.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!f||f.premultiply!==!1)),R)this.size=[y,w],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||l.b(n)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,n):z.texImage2D(z.TEXTURE_2D,0,this.format,y,w,0,this.format,z.UNSIGNED_BYTE,n.data);else{const{x:q,y:H}=_||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||l.b(n)?z.texSubImage2D(z.TEXTURE_2D,0,q,H,z.RGBA,z.UNSIGNED_BYTE,n):z.texSubImage2D(z.TEXTURE_2D,0,q,H,y,w,z.RGBA,z.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(n,f,_){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),_!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=w.LINEAR),n!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,n),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,_||n),this.filter=n),f!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,f),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function _e(k){const{userImage:n}=k;return!!(n&&n.render&&n.render())&&(k.data.replace(new Uint8Array(n.data.buffer)),!0)}class tt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:f,promiseResolve:_}of this.requestors)_(this._getImagesForIds(f));this.requestors=[]}}getImage(n){const f=this.images[n];if(f&&!f.data&&f.spriteData){const _=f.spriteData;f.data=new l.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),f.spriteData=null}return f}addImage(n,f){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,f)&&(this.images[n]=f)}_validate(n,f){let _=!0;const y=f.data||f.spriteData;return this._validateStretch(f.stretchX,y&&y.width)||(this.fire(new l.j(new Error(`Image "${n}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,y&&y.height)||(this.fire(new l.j(new Error(`Image "${n}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new l.j(new Error(`Image "${n}" has invalid "content" value`))),_=!1),_}_validateStretch(n,f){if(!n)return!0;let _=0;for(const y of n){if(y[0]<_||y[1]<y[0]||f<y[1])return!1;_=y[1]}return!0}_validateContent(n,f){if(!n)return!0;if(n.length!==4)return!1;const _=f.spriteData,y=_&&_.width||f.data.width,w=_&&_.height||f.data.height;return!(n[0]<0||y<n[0]||n[1]<0||w<n[1]||n[2]<0||y<n[2]||n[3]<0||w<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,f,_=!0){const y=this.getImage(n);if(_&&(y.data.width!==f.data.width||y.data.height!==f.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=y.version+1,this.images[n]=f,this.updatedImages[n]=!0}removeImage(n){const f=this.images[n];delete this.images[n],delete this.patterns[n],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise((f,_)=>{let y=!0;if(!this.isLoaded())for(const w of n)this.images[w]||(y=!1);this.isLoaded()||y?f(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:f})})}_getImagesForIds(n){const f={};for(const _ of n){let y=this.getImage(_);y||(this.fire(new l.k("styleimagemissing",{id:_})),y=this.getImage(_)),y?f[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:l.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:n,height:f}=this.atlasImage;return{width:n,height:f}}getPattern(n){const f=this.patterns[n],_=this.getImage(n);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new l.I(y,_);this.patterns[n]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const f=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(n,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const w in this.patterns)n.push(this.patterns[w].bin);const{w:f,h:_}=l.p(n),y=this.atlasImage;y.resize({width:f||1,height:_||1});for(const w in this.patterns){const{bin:R}=this.patterns[w],D=R.x+1,z=R.y+1,q=this.getImage(w).data,H=q.width,X=q.height;l.R.copy(q,y,{x:0,y:0},{x:D,y:z},{width:H,height:X}),l.R.copy(q,y,{x:0,y:X-1},{x:D,y:z-1},{width:H,height:1}),l.R.copy(q,y,{x:0,y:0},{x:D,y:z+X},{width:H,height:1}),l.R.copy(q,y,{x:H-1,y:0},{x:D-1,y:z},{width:1,height:X}),l.R.copy(q,y,{x:0,y:0},{x:D+H,y:z},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const f of n){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.getImage(f);_||l.w(`Image with ID: "${f}" was not found`),_e(_)&&this.updateImage(f,_)}}}const Ve=1e20;function qe(k,n,f,_,y,w,R,D,z){for(let q=n;q<n+_;q++)dt(k,f*w+q,w,y,R,D,z);for(let q=f;q<f+y;q++)dt(k,q*w+n,1,_,R,D,z)}function dt(k,n,f,_,y,w,R){w[0]=0,R[0]=-Ve,R[1]=Ve,y[0]=k[n];for(let D=1,z=0,q=0;D<_;D++){y[D]=k[n+D*f];const H=D*D;do{const X=w[z];q=(y[D]-y[X]+H-X*X)/(D-X)/2}while(q<=R[z]&&--z>-1);z++,w[z]=D,R[z]=q,R[z+1]=Ve}for(let D=0,z=0;D<_;D++){for(;R[z+1]<D;)z++;const q=w[z],H=D-q;k[n+D*f]=y[q]+H*H}}class mt{constructor(n,f){this.requestManager=n,this.localIdeographFontFamily=f,this.entries={}}setURL(n){this.url=n}getGlyphs(n){return l._(this,void 0,void 0,function*(){const f=[];for(const w in n)for(const R of n[w])f.push(this._getAndCacheGlyphsPromise(w,R));const _=yield Promise.all(f),y={};for(const{stack:w,id:R,glyph:D}of _)y[w]||(y[w]={}),y[w][R]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return y})}_getAndCacheGlyphsPromise(n,f){return l._(this,void 0,void 0,function*(){let _=this.entries[n];_||(_=this.entries[n]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[f];if(y!==void 0)return{stack:n,id:f,glyph:y};if(y=this._tinySDF(_,n,f),y)return _.glyphs[f]=y,{stack:n,id:f,glyph:y};const w=Math.floor(f/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[w])return{stack:n,id:f,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[w]){const D=mt.loadGlyphRange(n,w,this.url,this.requestManager);_.requests[w]=D}const R=yield _.requests[w];for(const D in R)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=R[+D]);return _.ranges[w]=!0,{stack:n,id:f,glyph:R[f]||null}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(n))}_tinySDF(n,f,_){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(_))return;let w=n.tinySDF;if(!w){let D="400";/bold/i.test(f)?D="900":/medium/i.test(f)?D="500":/light/i.test(f)&&(D="200"),w=n.tinySDF=new mt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:D})}const R=w.draw(String.fromCharCode(_));return{id:_,bitmap:new l.o({width:R.width||60,height:R.height||60},R.data),metrics:{width:R.glyphWidth/2||24,height:R.glyphHeight/2||24,left:R.glyphLeft/2+.5||0,top:R.glyphTop/2-27.5||-8,advance:R.glyphAdvance/2||24,isDoubleResolution:!0}}}}mt.loadGlyphRange=function(k,n,f,_){return l._(this,void 0,void 0,function*(){const y=256*n,w=y+255,R=_.transformRequest(f.replace("{fontstack}",k).replace("{range}",`${y}-${w}`),"Glyphs"),D=yield l.l(R,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${n}, ${y}-${w}`);const z={};for(const q of l.n(D.data))z[q.id]=q;return z})},mt.TinySDF=class{constructor({fontSize:k=24,buffer:n=3,radius:f=8,cutoff:_=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:R="normal"}={}){this.buffer=n,this.cutoff=_,this.radius=f;const D=this.size=k+4*n,z=this._createCanvas(D),q=this.ctx=z.getContext("2d",{willReadFrequently:!0});q.font=`${R} ${w} ${k}px ${y}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(k){const n=document.createElement("canvas");return n.width=n.height=k,n}draw(k){const{width:n,actualBoundingBoxAscent:f,actualBoundingBoxDescent:_,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(k),R=Math.ceil(f),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),z=Math.min(this.size-this.buffer,R+Math.ceil(_)),q=D+2*this.buffer,H=z+2*this.buffer,X=Math.max(q*H,0),ne=new Uint8ClampedArray(X),me={data:ne,width:q,height:H,glyphWidth:D,glyphHeight:z,glyphTop:R,glyphLeft:0,glyphAdvance:n};if(D===0||z===0)return me;const{ctx:Ie,buffer:Me,gridInner:Ne,gridOuter:Fe}=this;Ie.clearRect(Me,Me,D,z),Ie.fillText(k,Me,Me+R);const je=Ie.getImageData(Me,Me,D,z);Fe.fill(Ve,0,X),Ne.fill(0,0,X);for(let Te=0;Te<z;Te++)for(let He=0;He<D;He++){const Qe=je.data[4*(Te*D+He)+3]/255;if(Qe===0)continue;const at=(Te+Me)*q+He+Me;if(Qe===1)Fe[at]=0,Ne[at]=Ve;else{const wt=.5-Qe;Fe[at]=wt>0?wt*wt:0,Ne[at]=wt<0?wt*wt:0}}qe(Fe,0,0,q,H,q,this.f,this.v,this.z),qe(Ne,Me,Me,D,z,q,this.f,this.v,this.z);for(let Te=0;Te<X;Te++){const He=Math.sqrt(Fe[Te])-Math.sqrt(Ne[Te]);ne[Te]=Math.round(255-255*(He/this.radius+this.cutoff))}return me}};class ct{constructor(){this.specification=l.v.light.position}possiblyEvaluate(n,f){return l.x(n.expression.evaluate(f))}interpolate(n,f,_){return{x:l.y.number(n.x,f.x,_),y:l.y.number(n.y,f.y,_),z:l.y.number(n.z,f.z,_)}}}let Ut;class bt extends l.E{constructor(n){super(),Ut=Ut||new l.q({anchor:new l.D(l.v.light.anchor),position:new ct,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Ut),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,f={}){if(!this._validate(l.r,n,f))for(const _ in n){const y=n[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,f,_){return(!_||_.validate!==!1)&&l.t(this,n.call(l.u,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const It=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class pt extends l.E{constructor(n){super(),this._transitionable=new l.T(It),this.setSky(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(n,f={}){if(!this._validate(l.B,n,f)){n||(n={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in n){const y=n[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,f,_={}){return(_==null?void 0:_.validate)!==!1&&l.t(this,n.call(l.u,l.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(n){return n<60?0:n<70?(n-60)/10:1}}class kt{constructor(n,f){this.width=n,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,f){const _=n.join(",")+String(f);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(n,f)),this.dashEntry[_]}getDashRanges(n,f,_){const y=[];let w=n.length%2==1?-n[n.length-1]*_:0,R=n[0]*_,D=!0;y.push({left:w,right:R,isDash:D,zeroLength:n[0]===0});let z=n[0];for(let q=1;q<n.length;q++){D=!D;const H=n[q];w=z*_,z+=H,R=z*_,y.push({left:w,right:R,isDash:D,zeroLength:H===0})}return y}addRoundDash(n,f,_){const y=f/2;for(let w=-_;w<=_;w++){const R=this.width*(this.nextRow+_+w);let D=0,z=n[D];for(let q=0;q<this.width;q++){q/z.right>1&&(z=n[++D]);const H=Math.abs(q-z.left),X=Math.abs(q-z.right),ne=Math.min(H,X);let me;const Ie=w/_*(y+1);if(z.isDash){const Me=y-Math.abs(Ie);me=Math.sqrt(ne*ne+Me*Me)}else me=y-Math.sqrt(ne*ne+Ie*Ie);this.data[R+q]=Math.max(0,Math.min(255,me+128))}}}addRegularDash(n){for(let D=n.length-1;D>=0;--D){const z=n[D],q=n[D+1];z.zeroLength?n.splice(D,1):q&&q.isDash===z.isDash&&(q.left=z.left,n.splice(D,1))}const f=n[0],_=n[n.length-1];f.isDash===_.isDash&&(f.left=_.left-this.width,_.right=f.right+this.width);const y=this.width*this.nextRow;let w=0,R=n[w];for(let D=0;D<this.width;D++){D/R.right>1&&(R=n[++w]);const z=Math.abs(D-R.left),q=Math.abs(D-R.right),H=Math.min(z,q);this.data[y+D]=Math.max(0,Math.min(255,(R.isDash?H:-H)+128))}}addDash(n,f){const _=f?7:0,y=2*_+1;if(this.nextRow+y>this.height)return l.w("LineAtlas out of space"),null;let w=0;for(let D=0;D<n.length;D++)w+=n[D];if(w!==0){const D=this.width/w,z=this.getDashRanges(n,this.width,D);f?this.addRoundDash(z,D,_):this.addRegularDash(z)}const R={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:w};return this.nextRow+=y,this.dirty=!0,R}bind(n){const f=n.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const St="maplibre_preloaded_worker_pool";class $t{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<$t.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[St]}numActive(){return Object.keys(this.active).length}}const pn=Math.floor(C.hardwareConcurrency/2);let Pn,We;function Kn(){return Pn||(Pn=new $t),Pn}$t.workerCount=l.C(globalThis)?Math.max(Math.min(pn,3),1):1;class dn{constructor(n,f){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=f;const _=this.workerPool.acquire(f);for(let y=0;y<_.length;y++){const w=new l.F(_[y],f);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,f){const _=[];for(const y of this.actors)_.push(y.sendAsync({type:n,data:f}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,f){for(const _ of this.actors)_.registerMessageHandler(n,f)}}function Ot(){return We||(We=new dn(Kn(),l.G),We.registerMessageHandler("GR",(k,n,f)=>l.m(n,f))),We}function Ae(k,n){const f=l.H();return l.J(f,f,[1,1,0]),l.K(f,f,[.5*k.width,.5*k.height,1]),l.L(f,f,k.calculatePosMatrix(n.toUnwrapped()))}function ut(k,n,f,_,y,w){const R=function(X,ne,me){if(X)for(const Ie of X){const Me=ne[Ie];if(Me&&Me.source===me&&Me.type==="fill-extrusion")return!0}else for(const Ie in ne){const Me=ne[Ie];if(Me.source===me&&Me.type==="fill-extrusion")return!0}return!1}(y&&y.layers,n,k.id),D=w.maxPitchScaleFactor(),z=k.tilesIn(_,D,R);z.sort(Ye);const q=[];for(const X of z)q.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(n,f,k._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,y,w,D,Ae(k.transform,X.tileID))});const H=function(X){const ne={},me={};for(const Ie of X){const Me=Ie.queryResults,Ne=Ie.wrappedTileID,Fe=me[Ne]=me[Ne]||{};for(const je in Me){const Te=Me[je],He=Fe[je]=Fe[je]||{},Qe=ne[je]=ne[je]||[];for(const at of Te)He[at.featureIndex]||(He[at.featureIndex]=!0,Qe.push(at))}}return ne}(q);for(const X in H)H[X].forEach(ne=>{const me=ne.feature,Ie=k.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Ie});return H}function Ye(k,n){const f=k.tileID,_=n.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function Lt(k,n,f){return l._(this,void 0,void 0,function*(){let _=k;if(k.url?_=(yield l.h(n.transformRequest(k.url,"Source"),f)).data:yield C.frameAsync(f),!_)return null;const y=l.M(l.e(_,k),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(y.vectorLayerIds=_.vector_layers.map(w=>w.id)),y})}class Ke{constructor(n,f){n&&(f?this.setSouthWest(n).setNorthEast(f):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof l.N?new l.N(n.lng,n.lat):l.N.convert(n),this}setSouthWest(n){return this._sw=n instanceof l.N?new l.N(n.lng,n.lat):l.N.convert(n),this}extend(n){const f=this._sw,_=this._ne;let y,w;if(n instanceof l.N)y=n,w=n;else{if(!(n instanceof Ke))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Ke.convert(n)):this.extend(l.N.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(l.N.convert(n)):this;if(y=n._sw,w=n._ne,!y||!w)return this}return f||_?(f.lng=Math.min(y.lng,f.lng),f.lat=Math.min(y.lat,f.lat),_.lng=Math.max(w.lng,_.lng),_.lat=Math.max(w.lat,_.lat)):(this._sw=new l.N(y.lng,y.lat),this._ne=new l.N(w.lng,w.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:f,lat:_}=l.N.convert(n);let y=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&y}static convert(n){return n instanceof Ke?n:n&&new Ke(n)}static fromLngLat(n,f=0){const _=360*f/40075017,y=_/Math.cos(Math.PI/180*n.lat);return new Ke(new l.N(n.lng-y,n.lat-_),new l.N(n.lng+y,n.lat+_))}adjustAntiMeridian(){const n=new l.N(this._sw.lng,this._sw.lat),f=new l.N(this._ne.lng,this._ne.lat);return new Ke(n,n.lng>f.lng?new l.N(f.lng+360,f.lat):f)}}class On{constructor(n,f,_){this.bounds=Ke.convert(this.validateBounds(n)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const f=Math.pow(2,n.z),_=Math.floor(l.O(this.bounds.getWest())*f),y=Math.floor(l.Q(this.bounds.getNorth())*f),w=Math.ceil(l.O(this.bounds.getEast())*f),R=Math.ceil(l.Q(this.bounds.getSouth())*f);return n.x>=_&&n.x<w&&n.y>=y&&n.y<R}}class xt extends l.E{constructor(n,f,_,y){if(super(),this.id=n,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(f,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(l.e(this,n),n.bounds&&(this.tileBounds=new On(n.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new l.j(n))}})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(n){return l._(this,void 0,void 0,function*(){const f=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,"Tile"),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise((w,R)=>{n.reloadPromise={resolve:w,reject:R}})}else n.actor=this.dispatcher.getActor(),y="LT";n.abortController=new AbortController;try{const w=yield n.actor.sendAsync({type:y,data:_},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,w)}catch(w){if(delete n.abortController,n.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(n,null)}})}_afterTileLoadWorkerResponse(n,f){if(f&&f.resourceTiming&&(n.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&n.setExpiryData(f),n.loadVectorData(f,this.map.painter),n.reloadPromise){const _=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(_.resolve).catch(_.reject)}}abortTile(n){return l._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"AT",data:{uid:n.uid,type:this.type,source:this.id}}))})}unloadTile(n){return l._(this,void 0,void 0,function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Se extends l.E{constructor(n,f,_,y){super(),this.id=n,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},f),l.e(this,l.M(f,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(l.e(this,n),n.bounds&&(this.tileBounds=new On(n.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new l.j(n))}})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}serialize(){return l.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return l._(this,void 0,void 0,function*(){const f=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const _=yield Y.getImage(this.map._requestManager.transformRequest(f,"Tile"),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&n.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const y=this.map.painter.context,w=y.gl,R=_.data;n.texture=this.map.painter.getTileTexture(R.width),n.texture?n.texture.update(R,{useMipmap:!0}):(n.texture=new we(y,R,w.RGBA,{useMipmap:!0}),n.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),n.state="loaded"}}catch(_){if(delete n.abortController,n.aborted)n.state="unloaded";else if(_)throw n.state="errored",_}})}abortTile(n){return l._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)})}unloadTile(n){return l._(this,void 0,void 0,function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)})}hasTransition(){return!1}}class Bt extends Se{constructor(n,f,_,y){super(n,f,_,y),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(n){return l._(this,void 0,void 0,function*(){const f=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(f,"Tile");n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const y=yield Y.getImage(_,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&n.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const R=l.b(w)&&l.U()?w:yield this.readImageNow(w),D={type:this.type,uid:n.uid,source:this.id,rawImageData:R,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const z=yield n.actor.sendAsync({type:"LDT",data:D});n.dem=z,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(y){if(delete n.abortController,n.aborted)n.state="unloaded";else if(y)throw n.state="errored",y}})}readImageNow(n){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const f=n.width+2,_=n.height+2;try{return new l.R({width:f,height:_},yield l.W(n,-1,-1,f,_))}catch{}}return C.getImageData(n,1)})}_getNeighboringTiles(n){const f=n.canonical,_=Math.pow(2,f.z),y=(f.x-1+_)%_,w=f.x===0?n.wrap-1:n.wrap,R=(f.x+1+_)%_,D=f.x+1===_?n.wrap+1:n.wrap,z={};return z[new l.S(n.overscaledZ,w,f.z,y,f.y).key]={backfilled:!1},z[new l.S(n.overscaledZ,D,f.z,R,f.y).key]={backfilled:!1},f.y>0&&(z[new l.S(n.overscaledZ,w,f.z,y,f.y-1).key]={backfilled:!1},z[new l.S(n.overscaledZ,n.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},z[new l.S(n.overscaledZ,D,f.z,R,f.y-1).key]={backfilled:!1}),f.y+1<_&&(z[new l.S(n.overscaledZ,w,f.z,y,f.y+1).key]={backfilled:!1},z[new l.S(n.overscaledZ,n.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},z[new l.S(n.overscaledZ,D,f.z,R,f.y+1).key]={backfilled:!1}),z}unloadTile(n){return l._(this,void 0,void 0,function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"RDT",data:{type:this.type,uid:n.uid,source:this.id}}))})}}class Mn extends l.E{constructor(n,f,_,y){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(y),this._data=f.data,this._options=l.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const w=l.X/this.tileSize;f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*w,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*w,extent:l.X,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:l.X,radius:(f.clusterRadius||50)*w,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData(),this}updateData(n){return this._updateWorkerData(n),this}getData(){return l._(this,void 0,void 0,function*(){const n=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:n})})}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=n.clusterRadius),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=n.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,f,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:n,limit:f,offset:_}})}_updateWorkerData(n){return l._(this,void 0,void 0,function*(){const f=l.e({type:this.type},this.workerOptions);n?f.dataDiff=n:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(C.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let y=null;_.resourceTiming&&_.resourceTiming[this.id]&&(y=_.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(w,{resourceTiming:y}),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(n){return l._(this,void 0,void 0,function*(){const f=n.actor?"RT":"LT";n.actor=this.actor;const _={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.abortController=new AbortController;const y=yield this.actor.sendAsync({type:f,data:_},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(y,this.map.painter,f==="RT")})}abortTile(n){return l._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0})}unloadTile(n){return l._(this,void 0,void 0,function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Fn=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ei extends l.E{constructor(n,f,_,y){super(),this.id=n,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=f}load(n){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield Y.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,n&&(this.coordinates=n),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new l.j(f))}})}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const f=n.map(l.Z.fromLngLat);this.tileID=function(y){let w=1/0,R=1/0,D=-1/0,z=-1/0;for(const ne of y)w=Math.min(w,ne.x),R=Math.min(R,ne.y),D=Math.max(D,ne.x),z=Math.max(z,ne.y);const q=Math.max(D-w,z-R),H=Math.max(0,Math.floor(-Math.log(q)/Math.LN2)),X=Math.pow(2,H);return new l.a1(H,Math.floor((w+D)/2*X),Math.floor((R+z)/2*X))}(f),this.minzoom=this.maxzoom=this.tileID.z;const _=f.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,l.X,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,l.X),this._boundsArray.emplaceBack(_[2].x,_[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,f=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Fn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(n,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Jt extends ei{constructor(n,f,_,y){super(n,f,_,y),this.roundZoom=!0,this.type="video",this.options=f}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const f of n.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield l.a3(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new l.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const f=this.video.seekable;n<f.start(0)||n>f.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,f=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Fn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new we(n,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ri extends ei{constructor(n,f,_,y){super(n,f,_,y),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(R=>typeof R!="number"))||this.fire(new l.j(new l.a2(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${n}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${n}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,_=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Fn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(f,this.canvas,_.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const R=this.tiles[w];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,y=!0)}y&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const Qi={},ns=k=>{switch(k){case"geojson":return Mn;case"image":return ei;case"raster":return Se;case"raster-dem":return Bt;case"vector":return xt;case"video":return Jt;case"canvas":return Ri}return Qi[k]},ht="RTLPluginLoaded";class vr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ot()}_syncState(n){return this.status=n,this.dispatcher.broadcast("SRPS",{pluginStatus:n,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return l._(this,arguments,void 0,function*(f,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=C.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(ht))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let xn=null;function mn(){return xn||(xn=new vr),xn}class Rs{constructor(n,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=l.a4(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const f=n+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,f,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(y,w){const R={};if(!w)return R;for(const D of y){const z=D.layerIds.map(q=>w.getLayer(q)).filter(Boolean);if(z.length!==0){D.layers=z,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(q=>z.filter(H=>H.id===q)[0]));for(const q of z)R[q.id]=D}}return R}(n.buckets,f.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6){if(this.hasSymbolBuckets=!0,!_)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6&&w.hasRTLText){this.hasRTLText=!0,mn().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(y).queryRadius(w))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(n)}const f=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(n,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(n,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,f,_,y,w,R,D,z,q,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:R,tileSize:this.tileSize,pixelPosMatrix:H,transform:z,params:D,queryPadding:this.queryPadding*q},n,f,_):{}}querySourceFeatures(n,f){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const y=_.loadVTLayers(),w=f&&f.sourceLayer?f.sourceLayer:"",R=y._geojsonTileLayer||y[w];if(!R)return;const D=l.a7(f&&f.filter),{z,x:q,y:H}=this.tileID.canonical,X={z,x:q,y:H};for(let ne=0;ne<R.length;ne++){const me=R.feature(ne);if(D.needGeometry){const Ne=l.a8(me,!0);if(!D.filter(new l.z(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!D.filter(new l.z(this.tileID.overscaledZ),me))continue;const Ie=_.getId(me,w),Me=new l.a9(me,z,q,H,Ie);Me.tile=X,n.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const f=this.expirationTime;if(n.cacheControl){const _=l.aa(n.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const _=Date.now();let y=!1;if(this.expirationTime>_)y=!1;else if(f)if(this.expirationTime<f)y=!0;else{const w=this.expirationTime-f;w?this.expirationTime=_+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!f.style.hasLayer(y))continue;const w=this.buckets[y],R=w.layers[0].sourceLayer||"_geojsonTileLayer",D=_[R],z=n[R];if(!D||!z||Object.keys(z).length===0)continue;w.update(z,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const q=f&&f.style&&f.style.getLayer(y);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<C.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=C.now()+n}setDependencies(n,f){const _={};for(const y of f)_[y]=!0;this.dependencies[n]=_}hasDependency(n,f){for(const _ of n){const y=this.dependencies[_];if(y){for(const w of f)if(y[w])return!0}}return!1}}class Rt{constructor(n,f){this.max=n,this.onRemove=f,this.reset()}reset(){for(const n in this.data)for(const f of this.data[n])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(n,f,_){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:f,timeout:void 0};if(_!==void 0&&(w.timeout=setTimeout(()=>{this.remove(n,w)},_)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const f=this.data[n].shift();return f.timeout&&clearTimeout(f.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),f.value}getByKey(n){const f=this.data[n];return f?f[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,f){if(!this.has(n))return this;const _=n.wrapped().key,y=f===void 0?0:this.data[_].indexOf(f),w=this.data[_][y];return this.data[_].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(w.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(n){const f=[];for(const _ in this.data)for(const y of this.data[_])n(y.value)||f.push(y);for(const _ of f)this.remove(_.value.tileID,_)}}class An{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,f,_){const y=String(f);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},l.e(this.stateChanges[n][y],_),this.deletedStates[n]===null){this.deletedStates[n]={};for(const w in this.state[n])w!==y&&(this.deletedStates[n][w]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const w in this.state[n][y])_[w]||(this.deletedStates[n][y][w]=null)}else for(const w in _)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][w]===null&&delete this.deletedStates[n][y][w]}removeFeatureState(n,f,_){if(this.deletedStates[n]===null)return;const y=String(f);if(this.deletedStates[n]=this.deletedStates[n]||{},_&&f!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][_]=null);else if(f!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(_ in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][_]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,f){const _=String(f),y=l.e({},(this.state[n]||{})[_],(this.stateChanges[n]||{})[_]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const w=this.deletedStates[n][f];if(w===null)return{};for(const R in w)delete y[R]}return y}initializeTileState(n,f){n.setFeatureState(this.state,f)}coalesceChanges(n,f){const _={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const R in this.stateChanges[y])this.state[y][R]||(this.state[y][R]={}),l.e(this.state[y][R],this.stateChanges[y][R]),w[R]=this.state[y][R];_[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const R in this.state[y])w[R]={},this.state[y][R]={};else for(const R in this.deletedStates[y]){if(this.deletedStates[y][R]===null)this.state[y][R]={};else for(const D of Object.keys(this.deletedStates[y][R]))delete this.state[y][R][D];w[R]=this.state[y][R]}_[y]=_[y]||{},l.e(_[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const y in n)n[y].setFeatureState(_,f)}}class At extends l.E{constructor(n,f,_){super(),this.id=n,this.dispatcher=_,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,w,R,D)=>{const z=new(ns(w.type))(y,w,R,D);if(z.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${z.id}`);return z})(n,f,_,this),this._tiles={},this._cache=new Rt(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new An,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const f=this._tiles[n];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,f,_){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,f,_)}catch(y){n.state="errored",y.status!==404?this._source.fire(new l.j(y,{tile:n})):this.update(this.transform,this.terrain)}})}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new l.k("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const _=this._tiles[f];_.upload(n),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(br).map(n=>n.key)}getRenderableIds(n){const f=[];for(const _ in this._tiles)this._isIdRenderable(_,n)&&f.push(this._tiles[_]);return n?f.sort((_,y)=>{const w=_.tileID,R=y.tileID,D=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),z=new l.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-R.overscaledZ||z.y-D.y||z.x-D.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(br).map(_=>_.key)}hasRenderableParent(n){const f=this.findLoadedParent(n,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(n,f){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(f||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(n,f){return l._(this,void 0,void 0,function*(){const _=this._tiles[n];_&&(_.state!=="loading"&&(_.state=f),yield this._loadTile(_,n,f))})}_tileLoaded(n,f,_){n.timeAdded=C.now(),_==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(f,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const f=this.getRenderableIds();for(let y=0;y<f.length;y++){const w=f[y];if(n.neighboringTiles&&n.neighboringTiles[w]){const R=this.getTileByID(w);_(n,R),_(R,n)}}function _(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let R=w.tileID.canonical.x-y.tileID.canonical.x;const D=w.tileID.canonical.y-y.tileID.canonical.y,z=Math.pow(2,y.tileID.canonical.z),q=w.tileID.key;R===0&&D===0||Math.abs(D)>1||(Math.abs(R)>1&&(Math.abs(R+z)===1?R+=z:Math.abs(R-z)===1&&(R-=z)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,R,D),y.neighboringTiles&&y.neighboringTiles[q]&&(y.neighboringTiles[q].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,f,_,y){for(const w in this._tiles){let R=this._tiles[w];if(y[w]||!R.hasData()||R.tileID.overscaledZ<=f||R.tileID.overscaledZ>_)continue;let D=R.tileID;for(;R&&R.tileID.overscaledZ>f+1;){const q=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[q.key],R&&R.hasData()&&(D=q)}let z=D;for(;z.overscaledZ>f;)if(z=z.scaledTo(z.overscaledZ-1),n[z.key]){y[D.key]=D;break}}}findLoadedParent(n,f){if(n.key in this._loadedParentTiles){const _=this._loadedParentTiles[n.key];return _&&_.tileID.overscaledZ>=f?_:null}for(let _=n.overscaledZ-1;_>=f;_--){const y=n.scaledTo(_),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(n){return this._getLoadedTile(n)}_getLoadedTile(n){const f=this._tiles[n.key];return f&&f.hasData()?f:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const f=Math.ceil(n.width/this._source.tileSize)+1,_=Math.ceil(n.height/this._source.tileSize)+1,y=Math.floor(f*_*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(n){const f=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,f){const _={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+f),_[w.tileID.key]=w}this._tiles=_;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(n,f,_,y,w,R){const D={},z={},q=Object.keys(n),H=C.now();for(const X of q){const ne=n[X],me=this._tiles[X];if(!me||me.fadeEndTime!==0&&me.fadeEndTime<=H)continue;const Ie=this.findLoadedParent(ne,f),Me=this.findLoadedSibling(ne),Ne=Ie||Me||null;Ne&&(this._addTile(Ne.tileID),D[Ne.tileID.key]=Ne.tileID),z[X]=ne}this._retainLoadedChildren(z,y,_,n);for(const X in D)n[X]||(this._coveredTiles[X]=!0,n[X]=D[X]);if(R){const X={},ne={};for(const me of w)this._tiles[me.key].hasData()?X[me.key]=me:ne[me.key]=me;for(const me in ne){const Ie=ne[me].children(this._source.maxzoom);this._tiles[Ie[0].key]&&this._tiles[Ie[1].key]&&this._tiles[Ie[2].key]&&this._tiles[Ie[3].key]&&(X[Ie[0].key]=n[Ie[0].key]=Ie[0],X[Ie[1].key]=n[Ie[1].key]=Ie[1],X[Ie[2].key]=n[Ie[2].key]=Ie[2],X[Ie[3].key]=n[Ie[3].key]=Ie[3],delete ne[me])}for(const me in ne){const Ie=ne[me],Me=this.findLoadedParent(Ie,this._source.minzoom),Ne=this.findLoadedSibling(Ie),Fe=Me||Ne||null;if(Fe){X[Fe.tileID.key]=n[Fe.tileID.key]=Fe.tileID;for(const je in X)X[je].isChildOf(Fe.tileID)&&delete X[je]}}for(const me in this._tiles)X[me]||(this._coveredTiles[me]=!0)}}update(n,f){if(!this._sourceLoaded||this._paused)return;let _;this.transform=n,this.terrain=f,this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new l.S(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y)):(_=n.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(_=_.filter(H=>this._source.hasTile(H)))):_=[];const y=n.coveringZoomLevel(this._source),w=Math.max(y-At.maxOverzooming,this._source.minzoom),R=Math.max(y+At.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const H={};for(const X of _)if(X.canonical.z>this._source.minzoom){const ne=X.scaledTo(X.canonical.z-1);H[ne.key]=ne;const me=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));H[me.key]=me}_=_.concat(Object.values(H))}const D=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const z=this._updateRetainedTiles(_,y);Wr(this._source.type)&&this._updateCoveredAndRetainedTiles(z,w,R,y,_,f);for(const H in z)this._tiles[H].clearFadeHold();const q=l.ab(this._tiles,z);for(const H of q){const X=this._tiles[H];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(H)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,f){var _;const y={},w={},R=Math.max(f-At.maxOverzooming,this._source.minzoom),D=Math.max(f+At.maxUnderzooming,this._source.minzoom),z={};for(const q of n){const H=this._addTile(q);y[q.key]=q,H.hasData()||f<this._source.maxzoom&&(z[q.key]=q)}this._retainLoadedChildren(z,f,D,y);for(const q of n){let H=this._tiles[q.key];if(H.hasData())continue;if(f+1>this._source.maxzoom){const ne=q.children(this._source.maxzoom)[0],me=this.getTile(ne);if(me&&me.hasData()){y[ne.key]=ne;continue}}else{const ne=q.children(this._source.maxzoom);if(y[ne[0].key]&&y[ne[1].key]&&y[ne[2].key]&&y[ne[3].key])continue}let X=H.wasRequested();for(let ne=q.overscaledZ-1;ne>=R;--ne){const me=q.scaledTo(ne);if(w[me.key])break;if(w[me.key]=!0,H=this.getTile(me),!H&&X&&(H=this._addTile(me)),H){const Ie=H.hasData();if((Ie||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||X)&&(y[me.key]=me),X=H.wasRequested(),Ie)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const f=[];let _,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){_=this._loadedParentTiles[y.key];break}f.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(_=this._getLoadedTile(w),_)break;y=w}for(const w of f)this._loadedParentTiles[w]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const n in this._tiles){const f=this._tiles[n].tileID,_=this._getLoadedTile(f);this._loadedSiblingTiles[f.key]=_}}_addTile(n){let f=this._tiles[n.key];if(f)return f;f=this._cache.getAndRemove(n),f&&(this._setTileReloadTimer(n.key,f),f.tileID=n,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,f)));const _=f;return f||(f=new Rs(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(f,n.key,f.state)),f.uses++,this._tiles[n.key]=f,_||this._source.fire(new l.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(n,f){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const _=f.getExpiryTimeout();_&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},_))}_removeTile(n){const f=this._tiles[n];f&&(f.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(n){const f=n.sourceDataType;n.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,f,_){const y=[],w=this.transform;if(!w)return y;const R=_?w.getCameraQueryGeometry(n):n,D=n.map(Ie=>w.pointCoordinate(Ie,this.terrain)),z=R.map(Ie=>w.pointCoordinate(Ie,this.terrain)),q=this.getIds();let H=1/0,X=1/0,ne=-1/0,me=-1/0;for(const Ie of z)H=Math.min(H,Ie.x),X=Math.min(X,Ie.y),ne=Math.max(ne,Ie.x),me=Math.max(me,Ie.y);for(let Ie=0;Ie<q.length;Ie++){const Me=this._tiles[q[Ie]];if(Me.holdingForFade())continue;const Ne=Me.tileID,Fe=Math.pow(2,w.zoom-Me.tileID.overscaledZ),je=f*Me.queryPadding*l.X/Me.tileSize/Fe,Te=[Ne.getTilePoint(new l.Z(H,X)),Ne.getTilePoint(new l.Z(ne,me))];if(Te[0].x-je<l.X&&Te[0].y-je<l.X&&Te[1].x+je>=0&&Te[1].y+je>=0){const He=D.map(at=>Ne.getTilePoint(at)),Qe=z.map(at=>Ne.getTilePoint(at));y.push({tile:Me,tileID:Ne,queryGeometry:He,cameraQueryGeometry:Qe,scale:Fe})}}return y}getVisibleCoordinates(n){const f=this.getRenderableIds(n).map(_=>this._tiles[_].tileID);for(const _ of f)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(Wr(this._source.type)){const n=C.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=n)return!0}return!1}setFeatureState(n,f,_){this._state.updateState(n=n||"_geojsonTileLayer",f,_)}removeFeatureState(n,f,_){this._state.removeFeatureState(n=n||"_geojsonTileLayer",f,_)}getFeatureState(n,f){return this._state.getState(n=n||"_geojsonTileLayer",f)}setDependencies(n,f,_){const y=this._tiles[n];y&&y.setDependencies(f,_)}reloadTilesForDependencies(n,f){for(const _ in this._tiles)this._tiles[_].hasDependency(n,f)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(n,f))}}function br(k,n){const f=Math.abs(2*k.wrap)-+(k.wrap<0),_=Math.abs(2*n.wrap)-+(n.wrap<0);return k.overscaledZ-n.overscaledZ||_-f||n.canonical.y-k.canonical.y||n.canonical.x-k.canonical.x}function Wr(k){return k==="raster"||k==="image"||k==="video"}At.maxOverzooming=10,At.maxUnderzooming=3;class bn{constructor(n,f){this.reset(n,f)}reset(n,f){this.points=n||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=l.ac(n,0,1);let f=1,_=this._distances[f];const y=n*this.paddedLength+this.padding;for(;_<y&&f<this._distances.length;)_=this._distances[++f];const w=f-1,R=this._distances[w],D=_-R,z=D>0?(y-R)/D:0;return this.points[w].mult(1-z).add(this.points[f].mult(z))}}function Pi(k,n){let f=!0;return k==="always"||k!=="never"&&n!=="never"||(f=!1),f}class Ar{constructor(n,f,_){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(n/_),this.yCellCount=Math.ceil(f/_);for(let R=0;R<this.xCellCount*this.yCellCount;R++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=f,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,f,_,y,w){this._forEachCell(f,_,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(n,f,_,y){this._forEachCell(f-y,_-y,f+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(f),this.circles.push(_),this.circles.push(y)}_insertBoxCell(n,f,_,y,w,R){this.boxCells[w].push(R)}_insertCircleCell(n,f,_,y,w,R){this.circleCells[w].push(R)}_query(n,f,_,y,w,R,D){if(_<0||n>this.width||y<0||f>this.height)return[];const z=[];if(n<=0&&f<=0&&this.width<=_&&this.height<=y){if(w)return[{key:null,x1:n,y1:f,x2:_,y2:y}];for(let q=0;q<this.boxKeys.length;q++)z.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const H=this.circles[3*q],X=this.circles[3*q+1],ne=this.circles[3*q+2];z.push({key:this.circleKeys[q],x1:H-ne,y1:X-ne,x2:H+ne,y2:X+ne})}}else this._forEachCell(n,f,_,y,this._queryCell,z,{hitTest:w,overlapMode:R,seenUids:{box:{},circle:{}}},D);return z}query(n,f,_,y){return this._query(n,f,_,y,!1,null)}hitTest(n,f,_,y,w,R){return this._query(n,f,_,y,!0,w,R).length>0}hitTestCircle(n,f,_,y,w){const R=n-_,D=n+_,z=f-_,q=f+_;if(D<0||R>this.width||q<0||z>this.height)return!1;const H=[];return this._forEachCell(R,z,D,q,this._queryCellCircle,H,{hitTest:!0,overlapMode:y,circle:{x:n,y:f,radius:_},seenUids:{box:{},circle:{}}},w),H.length>0}_queryCell(n,f,_,y,w,R,D,z){const{seenUids:q,hitTest:H,overlapMode:X}=D,ne=this.boxCells[w];if(ne!==null){const Ie=this.bboxes;for(const Me of ne)if(!q.box[Me]){q.box[Me]=!0;const Ne=4*Me,Fe=this.boxKeys[Me];if(n<=Ie[Ne+2]&&f<=Ie[Ne+3]&&_>=Ie[Ne+0]&&y>=Ie[Ne+1]&&(!z||z(Fe))&&(!H||!Pi(X,Fe.overlapMode))&&(R.push({key:Fe,x1:Ie[Ne],y1:Ie[Ne+1],x2:Ie[Ne+2],y2:Ie[Ne+3]}),H))return!0}}const me=this.circleCells[w];if(me!==null){const Ie=this.circles;for(const Me of me)if(!q.circle[Me]){q.circle[Me]=!0;const Ne=3*Me,Fe=this.circleKeys[Me];if(this._circleAndRectCollide(Ie[Ne],Ie[Ne+1],Ie[Ne+2],n,f,_,y)&&(!z||z(Fe))&&(!H||!Pi(X,Fe.overlapMode))){const je=Ie[Ne],Te=Ie[Ne+1],He=Ie[Ne+2];if(R.push({key:Fe,x1:je-He,y1:Te-He,x2:je+He,y2:Te+He}),H)return!0}}}return!1}_queryCellCircle(n,f,_,y,w,R,D,z){const{circle:q,seenUids:H,overlapMode:X}=D,ne=this.boxCells[w];if(ne!==null){const Ie=this.bboxes;for(const Me of ne)if(!H.box[Me]){H.box[Me]=!0;const Ne=4*Me,Fe=this.boxKeys[Me];if(this._circleAndRectCollide(q.x,q.y,q.radius,Ie[Ne+0],Ie[Ne+1],Ie[Ne+2],Ie[Ne+3])&&(!z||z(Fe))&&!Pi(X,Fe.overlapMode))return R.push(!0),!0}}const me=this.circleCells[w];if(me!==null){const Ie=this.circles;for(const Me of me)if(!H.circle[Me]){H.circle[Me]=!0;const Ne=3*Me,Fe=this.circleKeys[Me];if(this._circlesCollide(Ie[Ne],Ie[Ne+1],Ie[Ne+2],q.x,q.y,q.radius)&&(!z||z(Fe))&&!Pi(X,Fe.overlapMode))return R.push(!0),!0}}}_forEachCell(n,f,_,y,w,R,D,z){const q=this._convertToXCellCoord(n),H=this._convertToYCellCoord(f),X=this._convertToXCellCoord(_),ne=this._convertToYCellCoord(y);for(let me=q;me<=X;me++)for(let Ie=H;Ie<=ne;Ie++)if(w.call(this,n,f,_,y,this.xCellCount*Ie+me,R,D,z))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,f,_,y,w,R){const D=y-n,z=w-f,q=_+R;return q*q>D*D+z*z}_circleAndRectCollide(n,f,_,y,w,R,D){const z=(R-y)/2,q=Math.abs(n-(y+z));if(q>z+_)return!1;const H=(D-w)/2,X=Math.abs(f-(w+H));if(X>H+_)return!1;if(q<=z||X<=H)return!0;const ne=q-z,me=X-H;return ne*ne+me*me<=_*_}}function er(k,n,f,_,y){const w=l.H();return n?(l.K(w,w,[1/y,1/y,1]),f||l.ad(w,w,_.angle)):l.L(w,_.labelPlaneMatrix,k),w}function Kr(k,n,f,_,y){if(n){const w=l.ae(k);return l.K(w,w,[y,y,1]),f||l.ad(w,w,-_.angle),w}return _.glCoordMatrix}function Re(k,n,f,_){let y;_?(y=[k,n,_(k,n),1],l.af(y,y,f)):(y=[k,n,0,1],Zn(y,y,f));const w=y[3];return{point:new l.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function Q(k,n){return .5+k/n*.5}function $(k,n){return k.x>=-n[0]&&k.x<=n[0]&&k.y>=-n[1]&&k.y<=n[1]}function ce(k,n,f,_,y,w,R,D,z,q,H,X,ne,me,Ie){const Me=_?k.textSizeData:k.iconSizeData,Ne=l.ag(Me,f.transform.zoom),Fe=[256/f.width*2+1,256/f.height*2+1],je=_?k.text.dynamicLayoutVertexArray:k.icon.dynamicLayoutVertexArray;je.clear();const Te=k.lineVertexArray,He=_?k.text.placedSymbolArray:k.icon.placedSymbolArray,Qe=f.transform.width/f.transform.height;let at=!1;for(let wt=0;wt<He.length;wt++){const Dt=He.get(wt);if(Dt.hidden||Dt.writingMode===l.ah.vertical&&!at){ln(Dt.numGlyphs,je);continue}at=!1;const Zt=Re(Dt.anchorX,Dt.anchorY,n,Ie);if(!$(Zt.point,Fe)){ln(Dt.numGlyphs,je);continue}const Kt=Q(f.transform.cameraToCenterDistance,Zt.signedDistanceFromCamera),qt=l.ai(Me,Ne,Dt),jt=R?qt/Kt:qt*Kt,rn={getElevation:Ie,labelPlaneMatrix:y,lineVertexArray:Te,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:q,tileAnchorPoint:new l.P(Dt.anchorX,Dt.anchorY),unwrappedTileID:H,width:X,height:ne,translation:me},Sn=Ue(rn,Dt,jt,!1,D,n,w,k.glyphOffsetArray,je,Qe,z);at=Sn.useVertical,(Sn.notEnoughRoom||at||Sn.needsFlipping&&Ue(rn,Dt,jt,!0,D,n,w,k.glyphOffsetArray,je,Qe,z).notEnoughRoom)&&ln(Dt.numGlyphs,je)}_?k.text.dynamicLayoutVertexBuffer.updateData(je):k.icon.dynamicLayoutVertexBuffer.updateData(je)}function ue(k,n,f,_,y,w,R,D){const z=w.glyphStartIndex+w.numGlyphs,q=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,X=n.getoffsetX(w.glyphStartIndex),ne=n.getoffsetX(z-1),me=Nt(k*X,f,_,y,w.segment,q,H,D,R);if(!me)return null;const Ie=Nt(k*ne,f,_,y,w.segment,q,H,D,R);return Ie?D.projectionCache.anyProjectionOccluded?null:{first:me,last:Ie}:null}function fe(k,n,f,_){return k===l.ah.horizontal&&Math.abs(f.y-n.y)>Math.abs(f.x-n.x)*_?{useVertical:!0}:(k===l.ah.vertical?n.y<f.y:n.x>f.x)?{needsFlipping:!0}:null}function Ue(k,n,f,_,y,w,R,D,z,q,H){const X=f/24,ne=n.lineOffsetX*X,me=n.lineOffsetY*X;let Ie;if(n.numGlyphs>1){const Me=n.glyphStartIndex+n.numGlyphs,Ne=n.lineStartIndex,Fe=n.lineStartIndex+n.lineLength,je=ue(X,D,ne,me,_,n,H,k);if(!je)return{notEnoughRoom:!0};const Te=Re(je.first.point.x,je.first.point.y,R,k.getElevation).point,He=Re(je.last.point.x,je.last.point.y,R,k.getElevation).point;if(y&&!_){const Qe=fe(n.writingMode,Te,He,q);if(Qe)return Qe}Ie=[je.first];for(let Qe=n.glyphStartIndex+1;Qe<Me-1;Qe++)Ie.push(Nt(X*D.getoffsetX(Qe),ne,me,_,n.segment,Ne,Fe,k,H));Ie.push(je.last)}else{if(y&&!_){const Ne=Re(k.tileAnchorPoint.x,k.tileAnchorPoint.y,w,k.getElevation).point,Fe=n.lineStartIndex+n.segment+1,je=new l.P(k.lineVertexArray.getx(Fe),k.lineVertexArray.gety(Fe)),Te=Re(je.x,je.y,w,k.getElevation),He=Te.signedDistanceFromCamera>0?Te.point:function(at,wt,Dt,Zt,Kt,qt){return Xe(at,wt,Dt,1,Kt,qt)}(k.tileAnchorPoint,je,Ne,0,w,k),Qe=fe(n.writingMode,Ne,He,q);if(Qe)return Qe}const Me=Nt(X*D.getoffsetX(n.glyphStartIndex),ne,me,_,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,k,H);if(!Me||k.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Ie=[Me]}for(const Me of Ie)l.aj(z,Me.point,Me.angle);return{}}function Xe(k,n,f,_,y,w){const R=k.add(k.sub(n)._unit()),D=y!==void 0?Re(R.x,R.y,y,w.getElevation).point:nt(R.x,R.y,w).point,z=f.sub(D);return f.add(z._mult(_/z.mag()))}function Pe(k,n,f){const _=n.projectionCache;if(_.projections[k])return _.projections[k];const y=new l.P(n.lineVertexArray.getx(k),n.lineVertexArray.gety(k)),w=nt(y.x,y.y,n);if(w.signedDistanceFromCamera>0)return _.projections[k]=w.point,_.anyProjectionOccluded=_.anyProjectionOccluded||w.isOccluded,w.point;const R=k-f.direction;return function(D,z,q,H,X){return Xe(D,z,q,H,void 0,X)}(f.distanceFromAnchor===0?n.tileAnchorPoint:new l.P(n.lineVertexArray.getx(R),n.lineVertexArray.gety(R)),y,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,n)}function nt(k,n,f){const _=k+f.translation[0],y=n+f.translation[1];let w;return!f.pitchWithMap&&f.projection.useSpecialProjectionForSymbols?(w=f.projection.projectTileCoordinates(_,y,f.unwrappedTileID,f.getElevation),w.point.x=(.5*w.point.x+.5)*f.width,w.point.y=(.5*-w.point.y+.5)*f.height):(w=Re(_,y,f.labelPlaneMatrix,f.getElevation),w.isOccluded=!1),w}function _t(k,n,f){return k._unit()._perp()._mult(n*f)}function lt(k,n,f,_,y,w,R,D,z){if(D.projectionCache.offsets[k])return D.projectionCache.offsets[k];const q=f.add(n);if(k+z.direction<_||k+z.direction>=y)return D.projectionCache.offsets[k]=q,q;const H=Pe(k+z.direction,D,z),X=_t(H.sub(f),R,z.direction),ne=f.add(X),me=H.add(X);return D.projectionCache.offsets[k]=l.ak(w,q,ne,me)||q,D.projectionCache.offsets[k]}function Nt(k,n,f,_,y,w,R,D,z){const q=_?k-n:k+n;let H=q>0?1:-1,X=0;_&&(H*=-1,X=Math.PI),H<0&&(X+=Math.PI);let ne,me=H>0?w+y:w+y+1;D.projectionCache.cachedAnchorPoint?ne=D.projectionCache.cachedAnchorPoint:(ne=nt(D.tileAnchorPoint.x,D.tileAnchorPoint.y,D).point,D.projectionCache.cachedAnchorPoint=ne);let Ie,Me,Ne=ne,Fe=ne,je=0,Te=0;const He=Math.abs(q),Qe=[];let at;for(;je+Te<=He;){if(me+=H,me<w||me>=R)return null;je+=Te,Fe=Ne,Me=Ie;const Zt={absOffsetX:He,direction:H,distanceFromAnchor:je,previousVertex:Fe};if(Ne=Pe(me,D,Zt),f===0)Qe.push(Fe),at=Ne.sub(Fe);else{let Kt;const qt=Ne.sub(Fe);Kt=qt.mag()===0?_t(Pe(me+H,D,Zt).sub(Ne),f,H):_t(qt,f,H),Me||(Me=Fe.add(Kt)),Ie=lt(me,Kt,Ne,w,R,Me,f,D,Zt),Qe.push(Me),at=Ie.sub(Me)}Te=at.mag()}const wt=at._mult((He-je)/Te)._add(Me||Fe),Dt=X+Math.atan2(Ne.y-Fe.y,Ne.x-Fe.x);return Qe.push(wt),{point:wt,angle:z?Dt:0,path:Qe}}const en=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ln(k,n){for(let f=0;f<k;f++){const _=n.length;n.resize(_+4),n.float32.set(en,3*_)}}function Zn(k,n,f){const _=n[0],y=n[1];return k[0]=f[0]*_+f[4]*y+f[12],k[1]=f[1]*_+f[5]*y+f[13],k[3]=f[3]*_+f[7]*y+f[15],k}const Tn=100;class Cn{constructor(n,f,_=new Ar(n.width+200,n.height+200,25),y=new Ar(n.width+200,n.height+200,25)){this.transform=n,this.mapProjection=f,this.grid=_,this.ignoredGrid=y,this.pitchFactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Tn,this.screenBottomBoundary=n.height+Tn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,f,_,y,w,R,D,z,q,H,X){const ne=n.anchorPointX+z[0],me=n.anchorPointY+z[1],Ie=this.projectAndGetPerspectiveRatio(y,ne,me,w,H),Me=_*Ie.perspectiveRatio;let Ne;if(R||D)Ne=this._projectCollisionBox(n,Me,y,w,R,D,z,Ie,H,X);else{const Qe=Ie.point.x+(X?X.x*Me:0),at=Ie.point.y+(X?X.y*Me:0);Ne={allPointsOccluded:!1,box:[Qe+n.x1*Me,at+n.y1*Me,Qe+n.x2*Me,at+n.y2*Me]}}const[Fe,je,Te,He]=Ne.box;return this.mapProjection.useSpecialProjectionForSymbols&&(R?Ne.allPointsOccluded:this.mapProjection.isOccluded(ne,me,w))||Ie.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Fe,je,Te,He)||f!=="always"&&this.grid.hitTest(Fe,je,Te,He,f,q)?{box:[Fe,je,Te,He],placeable:!1,offscreen:!1}:{box:[Fe,je,Te,He],placeable:!0,offscreen:this.isOffscreen(Fe,je,Te,He)}}placeCollisionCircles(n,f,_,y,w,R,D,z,q,H,X,ne,me,Ie,Me,Ne){const Fe=[],je=new l.P(f.anchorX,f.anchorY),Te=this.getPerspectiveRatio(R,je.x,je.y,D,Ne),He=(X?w/Te:w*Te)/l.ap,Qe={getElevation:Ne,labelPlaneMatrix:z,lineVertexArray:_,pitchWithMap:X,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:je,unwrappedTileID:D,width:this.transform.width,height:this.transform.height,translation:Me},at=ue(He,y,f.lineOffsetX*He,f.lineOffsetY*He,!1,f,!1,Qe);let wt=!1,Dt=!1,Zt=!0;if(at){const Kt=.5*me*Te+Ie,qt=new l.P(-100,-100),jt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),rn=new bn,Sn=at.first,Vt=at.last;let Xt=[];for(let Bn=Sn.path.length-1;Bn>=1;Bn--)Xt.push(Sn.path[Bn]);for(let Bn=1;Bn<Vt.path.length;Bn++)Xt.push(Vt.path[Bn]);const wn=2.5*Kt;if(q){const Bn=this.projectPathToScreenSpace(Xt,Qe,q);Xt=Bn.some(Vn=>Vn.signedDistanceFromCamera<=0)?[]:Bn.map(Vn=>Vn.point)}let Ai=[];if(Xt.length>0){const Bn=Xt[0].clone(),Vn=Xt[0].clone();for(let Ti=1;Ti<Xt.length;Ti++)Bn.x=Math.min(Bn.x,Xt[Ti].x),Bn.y=Math.min(Bn.y,Xt[Ti].y),Vn.x=Math.max(Vn.x,Xt[Ti].x),Vn.y=Math.max(Vn.y,Xt[Ti].y);Ai=Bn.x>=qt.x&&Vn.x<=jt.x&&Bn.y>=qt.y&&Vn.y<=jt.y?[Xt]:Vn.x<qt.x||Bn.x>jt.x||Vn.y<qt.y||Bn.y>jt.y?[]:l.al([Xt],qt.x,qt.y,jt.x,jt.y)}for(const Bn of Ai){rn.reset(Bn,.25*Kt);let Vn=0;Vn=rn.length<=.5*Kt?1:Math.ceil(rn.paddedLength/wn)+1;for(let Ti=0;Ti<Vn;Ti++){const Or=Ti/Math.max(Vn-1,1),Xs=rn.lerp(Or),Ci=Xs.x+Tn,cs=Xs.y+Tn;Fe.push(Ci,cs,Kt,0);const Yr=Ci-Kt,Br=cs-Kt,Jr=Ci+Kt,ho=cs+Kt;if(Zt=Zt&&this.isOffscreen(Yr,Br,Jr,ho),Dt=Dt||this.isInsideGrid(Yr,Br,Jr,ho),n!=="always"&&this.grid.hitTestCircle(Ci,cs,Kt,n,ne)&&(wt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:wt}}}}return{circles:!H&&wt||!Dt||Te<this.perspectiveRatioCutoff?[]:Fe,offscreen:Zt,collisionDetected:wt}}projectPathToScreenSpace(n,f,_){return n.map(y=>Re(y.x,y.y,_,f.getElevation))}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,y=1/0,w=-1/0,R=-1/0;for(const H of n){const X=new l.P(H.x+Tn,H.y+Tn);_=Math.min(_,X.x),y=Math.min(y,X.y),w=Math.max(w,X.x),R=Math.max(R,X.y),f.push(X)}const D=this.grid.query(_,y,w,R).concat(this.ignoredGrid.query(_,y,w,R)),z={},q={};for(const H of D){const X=H.key;if(z[X.bucketInstanceId]===void 0&&(z[X.bucketInstanceId]={}),z[X.bucketInstanceId][X.featureIndex])continue;const ne=[new l.P(H.x1,H.y1),new l.P(H.x2,H.y1),new l.P(H.x2,H.y2),new l.P(H.x1,H.y2)];l.am(f,ne)&&(z[X.bucketInstanceId][X.featureIndex]=!0,q[X.bucketInstanceId]===void 0&&(q[X.bucketInstanceId]=[]),q[X.bucketInstanceId].push(X.featureIndex))}return q}insertCollisionBox(n,f,_,y,w,R){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:R,overlapMode:f},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,f,_,y,w,R){const D=_?this.ignoredGrid:this.grid,z={bucketInstanceId:y,featureIndex:w,collisionGroupID:R,overlapMode:f};for(let q=0;q<n.length;q+=4)D.insertCircle(z,n[q],n[q+1],n[q+2])}projectAndGetPerspectiveRatio(n,f,_,y,w){let R;w?(R=[f,_,w(f,_),1],l.af(R,R,n)):(R=[f,_,0,1],Zn(R,R,n));const D=R[3];return{point:new l.P((R[0]/D+1)/2*this.transform.width+Tn,(-R[1]/D+1)/2*this.transform.height+Tn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D*.5,isOccluded:!1,signedDistanceFromCamera:D}}getPerspectiveRatio(n,f,_,y,w){const R=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(f,_,y,w):Re(f,_,n,w);return .5+this.transform.cameraToCenterDistance/R.signedDistanceFromCamera*.5}isOffscreen(n,f,_,y){return _<Tn||n>=this.screenRightBoundary||y<Tn||f>this.screenBottomBoundary}isInsideGrid(n,f,_,y){return _>=0&&n<this.gridRightBoundary&&y>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const n=l.an([]);return l.J(n,n,[-100,-100,0]),n}_projectCollisionBox(n,f,_,y,w,R,D,z,q,H){let X=new l.P(1,0),ne=new l.P(0,1);const me=new l.P(n.anchorPointX+D[0],n.anchorPointY+D[1]);if(R&&!w){const Zt=this.projectAndGetPerspectiveRatio(_,me.x+1,me.y,y,q).point.sub(z.point).unit(),Kt=Math.atan(Zt.y/Zt.x)+(Zt.x<0?Math.PI:0),qt=Math.sin(Kt),jt=Math.cos(Kt);X=new l.P(jt,qt),ne=new l.P(-qt,jt)}else if(!R&&w){const Zt=-this.transform.angle,Kt=Math.sin(Zt),qt=Math.cos(Zt);X=new l.P(qt,Kt),ne=new l.P(-Kt,qt)}let Ie=z.point,Me=f;if(w){Ie=me;const Zt=this.transform.zoom-Math.floor(this.transform.zoom);Me=Math.pow(2,-Zt),Me*=this.mapProjection.getPitchedTextCorrection(this.transform,me,y),H||(Me*=l.ac(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}H&&(Ie=Ie.add(X.mult(H.x*Me)).add(ne.mult(H.y*Me)));const Ne=n.x1*Me,Fe=n.x2*Me,je=(Ne+Fe)/2,Te=n.y1*Me,He=n.y2*Me,Qe=(Te+He)/2,at=[{offsetX:Ne,offsetY:Te},{offsetX:je,offsetY:Te},{offsetX:Fe,offsetY:Te},{offsetX:Fe,offsetY:Qe},{offsetX:Fe,offsetY:He},{offsetX:je,offsetY:He},{offsetX:Ne,offsetY:He},{offsetX:Ne,offsetY:Qe}];let wt=[];for(const{offsetX:Zt,offsetY:Kt}of at)wt.push(new l.P(Ie.x+X.x*Zt+ne.x*Kt,Ie.y+X.y*Zt+ne.y*Kt));let Dt=!1;if(w){const Zt=wt.map(Kt=>this.projectAndGetPerspectiveRatio(_,Kt.x,Kt.y,y,q));Dt=Zt.some(Kt=>!Kt.isOccluded),wt=Zt.map(Kt=>Kt.point)}else Dt=!0;return{box:l.ao(wt),allPointsOccluded:!Dt}}}function Un(k,n,f){return n*(l.X/(k.tileSize*Math.pow(2,f-k.tileID.overscaledZ)))}class Ii{constructor(n,f,_,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?f:-f))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class ci{constructor(n,f,_,y,w){this.text=new Ii(n?n.text:null,f,_,w),this.icon=new Ii(n?n.icon:null,f,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class En{constructor(n,f,_){this.text=n,this.icon=f,this.skipFade=_}}class ri{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class fi{constructor(n,f,_,y,w){this.bucketInstanceId=n,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=w}}class Di{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const f=++this.maxGroupID;this.collisionGroups[n]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[n]}}function $n(k,n,f,_,y){const{horizontalAlign:w,verticalAlign:R}=l.au(k);return new l.P(-(w-.5)*n+_[0]*y,-(R-.5)*f+_[1]*y)}class Tr{constructor(n,f,_,y,w,R){this.transform=n.clone(),this.terrain=_,this.collisionIndex=new Cn(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Di(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=R,R&&(R.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(n){const f=this.terrain;return f?(_,y)=>f.getElevation(n,_,y):null}getBucketParts(n,f,_,y){const w=_.getBucket(f),R=_.latestFeatureIndex;if(!w||!R||f.id!==w.layerIds[0])return;const D=_.collisionBoxArray,z=w.layers[0].layout,q=w.layers[0].paint,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/l.X,ne=_.tileID.toUnwrapped(),me=this.transform.calculatePosMatrix(ne),Ie=z.get("text-pitch-alignment")==="map",Me=z.get("text-rotation-alignment")==="map",Ne=Un(_,1,this.transform.zoom),Fe=this.collisionIndex.mapProjection.translatePosition(this.transform,_,q.get("text-translate"),q.get("text-translate-anchor")),je=this.collisionIndex.mapProjection.translatePosition(this.transform,_,q.get("icon-translate"),q.get("icon-translate-anchor")),Te=er(me,Ie,Me,this.transform,Ne);let He=null;if(Ie){const at=Kr(me,Ie,Me,this.transform,Ne);He=l.L([],this.transform.labelPlaneMatrix,at)}this.retainedQueryData[w.bucketInstanceId]=new fi(w.bucketInstanceId,R,w.sourceLayerIndex,w.index,_.tileID);const Qe={bucket:w,layout:z,translationText:Fe,translationIcon:je,posMatrix:me,unwrappedTileID:ne,textLabelPlaneMatrix:Te,labelToScreenMatrix:He,scale:H,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:l.ag(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const at of w.sortKeyRanges){const{sortKey:wt,symbolInstanceStart:Dt,symbolInstanceEnd:Zt}=at;n.push({sortKey:wt,symbolInstanceStart:Dt,symbolInstanceEnd:Zt,parameters:Qe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Qe})}attemptAnchorPlacement(n,f,_,y,w,R,D,z,q,H,X,ne,me,Ie,Me,Ne,Fe,je,Te){const He=l.aq[n.textAnchor],Qe=[n.textOffset0,n.textOffset1],at=$n(He,_,y,Qe,w),wt=this.collisionIndex.placeCollisionBox(f,ne,z,q,H,D,R,Ne,X.predicate,Te,at);if((!je||this.collisionIndex.placeCollisionBox(je,ne,z,q,H,D,R,Fe,X.predicate,Te,at).placeable)&&wt.placeable){let Dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(Dt=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:Qe,width:_,height:y,anchor:He,textBoxScale:w,prevAnchor:Dt},this.markUsedJustification(Ie,He,me,Me),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Me,me),this.placedOrientations[me.crossTileID]=Me),{shift:at,placedGlyphBoxes:wt}}}placeLayerBucketPart(n,f,_){const{bucket:y,layout:w,translationText:R,translationIcon:D,posMatrix:z,unwrappedTileID:q,textLabelPlaneMatrix:H,labelToScreenMatrix:X,textPixelRatio:ne,holdingForFade:me,collisionBoxArray:Ie,partiallyEvaluatedTextSize:Me,collisionGroup:Ne}=n.parameters,Fe=w.get("text-optional"),je=w.get("icon-optional"),Te=l.ar(w,"text-overlap","text-allow-overlap"),He=Te==="always",Qe=l.ar(w,"icon-overlap","icon-allow-overlap"),at=Qe==="always",wt=w.get("text-rotation-alignment")==="map",Dt=w.get("text-pitch-alignment")==="map",Zt=w.get("icon-text-fit")!=="none",Kt=w.get("symbol-z-order")==="viewport-y",qt=He&&(at||!y.hasIconData()||je),jt=at&&(He||!y.hasTextData()||Fe);!y.collisionArrays&&Ie&&y.deserializeCollisionBoxes(Ie);const rn=this._getTerrainElevationFunc(this.retainedQueryData[y.bucketInstanceId].tileID),Sn=(Vt,Xt,wn)=>{var Ai,Bn;if(f[Vt.crossTileID])return;if(me)return void(this.placements[Vt.crossTileID]=new En(!1,!1,!1));let Vn=!1,Ti=!1,Or=!0,Xs=null,Ci={box:null,placeable:!1,offscreen:null},cs={box:null,placeable:!1,offscreen:null},Yr=null,Br=null,Jr=null,ho=0,rl=0,Eu=0;Xt.textFeatureIndex?ho=Xt.textFeatureIndex:Vt.useRuntimeCollisionCircles&&(ho=Vt.featureIndex),Xt.verticalTextFeatureIndex&&(rl=Xt.verticalTextFeatureIndex);const sl=Xt.textBox;if(sl){const Os=Pr=>{let Ur=l.ah.horizontal;if(y.allowVerticalPlacement&&!Pr&&this.prevPlacement){const Es=this.prevPlacement.placedOrientations[Vt.crossTileID];Es&&(this.placedOrientations[Vt.crossTileID]=Es,Ur=Es,this.markUsedOrientation(y,Ur,Vt))}return Ur},Bs=(Pr,Ur)=>{if(y.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Es of y.writingModes)if(Es===l.ah.vertical?(Ci=Ur(),cs=Ci):Ci=Pr(),Ci&&Ci.placeable)break}else Ci=Pr()},Qo=Vt.textAnchorOffsetStartIndex,Ws=Vt.textAnchorOffsetEndIndex;if(Ws===Qo){const Pr=(Ur,Es)=>{const Xn=this.collisionIndex.placeCollisionBox(Ur,Te,ne,z,q,Dt,wt,R,Ne.predicate,rn);return Xn&&Xn.placeable&&(this.markUsedOrientation(y,Es,Vt),this.placedOrientations[Vt.crossTileID]=Es),Xn};Bs(()=>Pr(sl,l.ah.horizontal),()=>{const Ur=Xt.verticalTextBox;return y.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&Ur?Pr(Ur,l.ah.vertical):{box:null,offscreen:null}}),Os(Ci&&Ci.placeable)}else{let Pr=l.aq[(Bn=(Ai=this.prevPlacement)===null||Ai===void 0?void 0:Ai.variableOffsets[Vt.crossTileID])===null||Bn===void 0?void 0:Bn.anchor];const Ur=(Xn,Ia,ol)=>{const al=Xn.x2-Xn.x1,Hh=Xn.y2-Xn.y1,dd=Vt.textBoxScale,Xh=Zt&&Qe==="never"?Ia:null;let ea=null,Wh=Te==="never"?1:2,Tu="never";Pr&&Wh++;for(let Zl=0;Zl<Wh;Zl++){for(let Cu=Qo;Cu<Ws;Cu++){const Lu=y.textAnchorOffsets.get(Cu);if(Pr&&Lu.textAnchor!==Pr)continue;const ll=this.attemptAnchorPlacement(Lu,Xn,al,Hh,dd,wt,Dt,ne,z,q,Ne,Tu,Vt,y,ol,R,D,Xh,rn);if(ll&&(ea=ll.placedGlyphBoxes,ea&&ea.placeable))return Vn=!0,Xs=ll.shift,ea}Pr?Pr=null:Tu=Te}return _&&!ea&&(ea={box:this.collisionIndex.placeCollisionBox(sl,"always",ne,z,q,Dt,wt,R,Ne.predicate,rn,new l.P(0,0)).box,offscreen:!1,placeable:!1}),ea};Bs(()=>Ur(sl,Xt.iconBox,l.ah.horizontal),()=>{const Xn=Xt.verticalTextBox;return y.allowVerticalPlacement&&(!Ci||!Ci.placeable)&&Vt.numVerticalGlyphVertices>0&&Xn?Ur(Xn,Xt.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ci&&(Vn=Ci.placeable,Or=Ci.offscreen);const Es=Os(Ci&&Ci.placeable);if(!Vn&&this.prevPlacement){const Xn=this.prevPlacement.variableOffsets[Vt.crossTileID];Xn&&(this.variableOffsets[Vt.crossTileID]=Xn,this.markUsedJustification(y,Xn.anchor,Vt,Es))}}}if(Yr=Ci,Vn=Yr&&Yr.placeable,Or=Yr&&Yr.offscreen,Vt.useRuntimeCollisionCircles){const Os=y.text.placedSymbolArray.get(Vt.centerJustifiedTextSymbolIndex),Bs=l.ai(y.textSizeData,Me,Os),Qo=w.get("text-padding");Br=this.collisionIndex.placeCollisionCircles(Te,Os,y.lineVertexArray,y.glyphOffsetArray,Bs,z,q,H,X,_,Dt,Ne.predicate,Vt.collisionCircleDiameter,Qo,R,rn),Br.circles.length&&Br.collisionDetected&&!_&&l.w("Collisions detected, but collision boxes are not shown"),Vn=He||Br.circles.length>0&&!Br.collisionDetected,Or=Or&&Br.offscreen}if(Xt.iconFeatureIndex&&(Eu=Xt.iconFeatureIndex),Xt.iconBox){const Os=Bs=>this.collisionIndex.placeCollisionBox(Bs,Qe,ne,z,q,Dt,wt,D,Ne.predicate,rn,Zt&&Xs?Xs:void 0);cs&&cs.placeable&&Xt.verticalIconBox?(Jr=Os(Xt.verticalIconBox),Ti=Jr.placeable):(Jr=Os(Xt.iconBox),Ti=Jr.placeable),Or=Or&&Jr.offscreen}const Fs=Fe||Vt.numHorizontalGlyphVertices===0&&Vt.numVerticalGlyphVertices===0,Au=je||Vt.numIconVertices===0;Fs||Au?Au?Fs||(Ti=Ti&&Vn):Vn=Ti&&Vn:Ti=Vn=Ti&&Vn;const Vc=Ti&&Jr.placeable;if(Vn&&Yr.placeable&&this.collisionIndex.insertCollisionBox(Yr.box,Te,w.get("text-ignore-placement"),y.bucketInstanceId,cs&&cs.placeable&&rl?rl:ho,Ne.ID),Vc&&this.collisionIndex.insertCollisionBox(Jr.box,Qe,w.get("icon-ignore-placement"),y.bucketInstanceId,Eu,Ne.ID),Br&&Vn&&this.collisionIndex.insertCollisionCircles(Br.circles,Te,w.get("text-ignore-placement"),y.bucketInstanceId,ho,Ne.ID),_&&this.storeCollisionData(y.bucketInstanceId,wn,Xt,Yr,Jr,Br),Vt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Vt.crossTileID]=new En(Vn||qt,Ti||jt,Or||y.justReloaded),f[Vt.crossTileID]=!0};if(Kt){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Vt=y.getSortedSymbolIndexes(this.transform.angle);for(let Xt=Vt.length-1;Xt>=0;--Xt){const wn=Vt[Xt];Sn(y.symbolInstances.get(wn),y.collisionArrays[wn],wn)}}else for(let Vt=n.symbolInstanceStart;Vt<n.symbolInstanceEnd;Vt++)Sn(y.symbolInstances.get(Vt),y.collisionArrays[Vt],Vt);if(_&&y.bucketInstanceId in this.collisionCircleArrays){const Vt=this.collisionCircleArrays[y.bucketInstanceId];l.as(Vt.invProjMatrix,z),Vt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}storeCollisionData(n,f,_,y,w,R){if(_.textBox||_.iconBox){let D,z;this.collisionBoxArrays.has(n)?D=this.collisionBoxArrays.get(n):(D=new Map,this.collisionBoxArrays.set(n,D)),D.has(f)?z=D.get(f):(z={text:null,icon:null},D.set(f,z)),_.textBox&&(z.text=y.box),_.iconBox&&(z.icon=w.box)}if(R){let D=this.collisionCircleArrays[n];D===void 0&&(D=this.collisionCircleArrays[n]=new ri);for(let z=0;z<R.circles.length;z+=4)D.circles.push(R.circles[z+0]),D.circles.push(R.circles[z+1]),D.circles.push(R.circles[z+2]),D.circles.push(R.collisionDetected?1:0)}}markUsedJustification(n,f,_,y){let w;w=y===l.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.at(f)];const R=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const D of R)D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=w>=0&&D!==w?0:_.crossTileID)}markUsedOrientation(n,f,_){const y=f===l.ah.horizontal||f===l.ah.horizontalOnly?f:0,w=f===l.ah.vertical?f:0,R=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const D of R)n.text.placedSymbolArray.get(D).placedOrientation=y;_.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const y=f?f.symbolFadeChange(n):1,w=f?f.opacities:{},R=f?f.variableOffsets:{},D=f?f.placedOrientations:{};for(const z in this.placements){const q=this.placements[z],H=w[z];H?(this.opacities[z]=new ci(H,y,q.text,q.icon),_=_||q.text!==H.text.placed||q.icon!==H.icon.placed):(this.opacities[z]=new ci(null,y,q.text,q.icon,q.skipFade),_=_||q.text||q.icon)}for(const z in w){const q=w[z];if(!this.opacities[z]){const H=new ci(q,y,!1,!1);H.isHidden()||(this.opacities[z]=H,_=_||q.text.placed||q.icon.placed)}}for(const z in R)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=R[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:n)}updateLayerOpacities(n,f){const _={};for(const y of f){const w=y.getBucket(n);w&&y.latestFeatureIndex&&n.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,_,y.collisionBoxArray)}}updateBucketOpacities(n,f,_,y){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const w=n.layers[0],R=w.layout,D=new ci(null,0,!1,!1,!0),z=R.get("text-allow-overlap"),q=R.get("icon-allow-overlap"),H=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=R.get("text-rotation-alignment")==="map",ne=R.get("text-pitch-alignment")==="map",me=R.get("icon-text-fit")!=="none",Ie=new ci(null,0,z&&(q||!n.hasIconData()||R.get("icon-optional")),q&&(z||!n.hasTextData()||R.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const Me=(Fe,je,Te)=>{for(let He=0;He<je/4;He++)Fe.opacityVertexArray.emplaceBack(Te);Fe.hasVisibleVertices=Fe.hasVisibleVertices||Te!==no},Ne=this.collisionBoxArrays.get(n.bucketInstanceId);for(let Fe=0;Fe<n.symbolInstances.length;Fe++){const je=n.symbolInstances.get(Fe),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:He,crossTileID:Qe}=je;let at=this.opacities[Qe];_[Qe]?at=D:at||(at=Ie,this.opacities[Qe]=at),_[Qe]=!0;const wt=je.numIconVertices>0,Dt=this.placedOrientations[je.crossTileID],Zt=Dt===l.ah.vertical,Kt=Dt===l.ah.horizontal||Dt===l.ah.horizontalOnly;if(Te>0||He>0){const jt=or(at.text);Me(n.text,Te,Zt?no:jt),Me(n.text,He,Kt?no:jt);const rn=at.text.isHidden();[je.rightJustifiedTextSymbolIndex,je.centerJustifiedTextSymbolIndex,je.leftJustifiedTextSymbolIndex].forEach(Xt=>{Xt>=0&&(n.text.placedSymbolArray.get(Xt).hidden=rn||Zt?1:0)}),je.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(je.verticalPlacedTextSymbolIndex).hidden=rn||Kt?1:0);const Sn=this.variableOffsets[je.crossTileID];Sn&&this.markUsedJustification(n,Sn.anchor,je,Dt);const Vt=this.placedOrientations[je.crossTileID];Vt&&(this.markUsedJustification(n,"left",je,Vt),this.markUsedOrientation(n,Vt,je))}if(wt){const jt=or(at.icon),rn=!(me&&je.verticalPlacedIconSymbolIndex&&Zt);je.placedIconSymbolIndex>=0&&(Me(n.icon,je.numIconVertices,rn?jt:no),n.icon.placedSymbolArray.get(je.placedIconSymbolIndex).hidden=at.icon.isHidden()),je.verticalPlacedIconSymbolIndex>=0&&(Me(n.icon,je.numVerticalIconVertices,rn?no:jt),n.icon.placedSymbolArray.get(je.verticalPlacedIconSymbolIndex).hidden=at.icon.isHidden())}const qt=Ne&&Ne.has(Fe)?Ne.get(Fe):{text:null,icon:null};if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const jt=n.collisionArrays[Fe];if(jt){let rn=new l.P(0,0);if(jt.textBox||jt.verticalTextBox){let Sn=!0;if(H){const Vt=this.variableOffsets[Qe];Vt?(rn=$n(Vt.anchor,Vt.width,Vt.height,Vt.textOffset,Vt.textBoxScale),X&&rn._rotate(ne?this.transform.angle:-this.transform.angle)):Sn=!1}if(jt.textBox||jt.verticalTextBox){let Vt;jt.textBox&&(Vt=Zt),jt.verticalTextBox&&(Vt=Kt),No(n.textCollisionBox.collisionVertexArray,at.text.placed,!Sn||Vt,qt.text,rn.x,rn.y)}}if(jt.iconBox||jt.verticalIconBox){const Sn=!!(!Kt&&jt.verticalIconBox);let Vt;jt.iconBox&&(Vt=Sn),jt.verticalIconBox&&(Vt=!Sn),No(n.iconCollisionBox.collisionVertexArray,at.icon.placed,Vt,qt.icon,me?rn.x:0,me?rn.y:0)}}}}if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);if(n.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Fe.invProjMatrix,n.placementViewportMatrix=Fe.viewportMatrix,n.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>n}setStale(){this.stale=!0}}function No(k,n,f,_,y,w){_&&_.length!==0||(_=[0,0,0,0]);const R=_[0]-Tn,D=_[1]-Tn,z=_[2]-Tn,q=_[3]-Tn;k.emplaceBack(n?1:0,f?1:0,y||0,w||0,R,D),k.emplaceBack(n?1:0,f?1:0,y||0,w||0,z,D),k.emplaceBack(n?1:0,f?1:0,y||0,w||0,z,q),k.emplaceBack(n?1:0,f?1:0,y||0,w||0,R,q)}const ti=Math.pow(2,25),xo=Math.pow(2,24),aa=Math.pow(2,17),Cr=Math.pow(2,16),Fr=Math.pow(2,9),yc=Math.pow(2,8),Ni=Math.pow(2,1);function or(k){if(k.opacity===0&&!k.placed)return 0;if(k.opacity===1&&k.placed)return 4294967295;const n=k.placed?1:0,f=Math.floor(127*k.opacity);return f*ti+n*xo+f*aa+n*Cr+f*Fr+n*yc+f*Ni+n}const no=0;function is(){return{isOccluded:(k,n,f)=>!1,getPitchedTextCorrection:(k,n,f)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(k,n,f,_){throw new Error("Not implemented.")},translatePosition:(k,n,f,_)=>function(y,w,R,D,z=!1){if(!R[0]&&!R[1])return[0,0];const q=z?D==="map"?y.angle:0:D==="viewport"?-y.angle:0;if(q){const H=Math.sin(q),X=Math.cos(q);R=[R[0]*X-R[1]*H,R[0]*H+R[1]*X]}return[z?R[0]:Un(w,R[0],y.zoom),z?R[1]:Un(w,R[1],y.zoom)]}(k,n,f,_),getCircleRadiusCorrection:k=>1}}class zi{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,f,_,y,w){const R=this._bucketParts;for(;this._currentTileIndex<n.length;)if(f.getBucketParts(R,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((D,z)=>D.sortKey-z.sortKey));this._currentPartIndex<R.length;)if(f.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,w())return!0;return!1}}class la{constructor(n,f,_,y,w,R,D,z){this.placement=new Tr(n,is(),f,R,D,z),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(n,f,_){const y=C.now(),w=()=>!this._forceFullPlacement&&C.now()-y>2;for(;this._currentPlacementIndex>=0;){const R=f[n[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=D)&&(!R.maxzoom||R.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new zi(R)),this._inProgressLayer.continuePlacement(_[R.source],this.placement,this._showCollisionBoxes,R,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const ys=512/l.X/2;class Ui{constructor(n,f,_){this.tileID=n,this.bucketInstanceId=_,this._symbolsByKey={};const y=new Map;for(let w=0;w<f.length;w++){const R=f.get(w),D=R.key,z=y.get(D);z?z.push(R):y.set(D,[R])}for(const[w,R]of y){const D={positions:R.map(z=>({x:Math.floor(z.anchorX*ys),y:Math.floor(z.anchorY*ys)})),crossTileIDs:R.map(z=>z.crossTileID)};if(D.positions.length>128){const z=new l.av(D.positions.length,16,Uint16Array);for(const{x:q,y:H}of D.positions)z.add(q,H);z.finish(),delete D.positions,D.index=z}this._symbolsByKey[w]=D}}getScaledCoordinates(n,f){const{x:_,y,z:w}=this.tileID.canonical,{x:R,y:D,z}=f.canonical,q=ys/Math.pow(2,z-w),H=(D*l.X+n.anchorY)*q,X=y*l.X*ys;return{x:Math.floor((R*l.X+n.anchorX)*q-_*l.X*ys),y:Math.floor(H-X)}}findMatches(n,f,_){const y=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let w=0;w<n.length;w++){const R=n.get(w);if(R.crossTileID)continue;const D=this._symbolsByKey[R.key];if(!D)continue;const z=this.getScaledCoordinates(R,f);if(D.index){const q=D.index.range(z.x-y,z.y-y,z.x+y,z.y+y).sort();for(const H of q){const X=D.crossTileIDs[H];if(!_[X]){_[X]=!0,R.crossTileID=X;break}}}else if(D.positions)for(let q=0;q<D.positions.length;q++){const H=D.positions[q],X=D.crossTileIDs[q];if(Math.abs(H.x-z.x)<=y&&Math.abs(H.y-z.y)<=y&&!_[X]){_[X]=!0,R.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:n})=>n)}}class ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const f=Math.round((n-this.lng)/360);if(f!==0)for(const _ in this.indexes){const y=this.indexes[_],w={};for(const R in y){const D=y[R];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+f),w[D.tileID.key]=D}this.indexes[_]=w}this.lng=n}addBucket(n,f,_){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let w=0;w<f.symbolInstances.length;w++)f.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const w in this.indexes){const R=this.indexes[w];if(Number(w)>n.overscaledZ)for(const D in R){const z=R[D];z.tileID.isChildOf(n)&&z.findMatches(f.symbolInstances,n,y)}else{const D=R[n.scaledTo(Number(w)).key];D&&D.findMatches(f.symbolInstances,n,y)}}for(let w=0;w<f.symbolInstances.length;w++){const R=f.symbolInstances.get(w);R.crossTileID||(R.crossTileID=_.generate(),y[R.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ui(n,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(n,f){for(const _ of f.getCrossTileIDsLists())for(const y of _)delete this.usedCrossTileIDs[n][y]}removeStaleBuckets(n){let f=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const w in y)n[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[w]),delete y[w],f=!0)}return f}}class zo{constructor(){this.layerIndexes={},this.crossTileIDs=new ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,f,_){let y=this.layerIndexes[n.id];y===void 0&&(y=this.layerIndexes[n.id]=new rs);let w=!1;const R={};y.handleWrapJump(_);for(const D of f){const z=D.getBucket(n);z&&n.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(D.tileID,z,this.crossTileIDs)&&(w=!0),R[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(R)&&(w=!0),w}pruneUnusedLayers(n){const f={};n.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const tr=(k,n)=>l.t(k,n&&n.filter(f=>f.identifier!=="source.canvas")),io=l.aw();class ca extends l.E{constructor(n,f={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const y=this.sourceCaches[_].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[_].reload()}},this.map=n,this.dispatcher=new dn(Kn(),n._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,y)=>this.getGlyphs(_,y)),this.dispatcher.registerMessageHandler("GI",(_,y)=>this.getImages(_,y)),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new mt(n._requestManager,f.localIdeographFontFamily),this.lineAtlas=new kt(256,512),this.crossTileSymbolIndex=new zo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),mn().on(ht,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.sourceCaches[_.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const R in this._layers){const D=this._layers[R];D.source===w.id&&this._validateLayer(D)}})}loadURL(n,f={},_){this.fire(new l.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const y=this.map._requestManager.transformRequest(n,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;l.h(y,this._loadStyleRequest).then(R=>{this._loadStyleRequest=null,this._load(R.data,f,_)}).catch(R=>{this._loadStyleRequest=null,R&&!w.signal.aborted&&this.fire(new l.j(R))})}loadJSON(n,f={},_){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(n,f,_)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(io,{validate:!1})}_load(n,f,_){var y;const w=f.transformStyle?f.transformStyle(_,n):n;if(!f.validate||!tr(this,l.u(w))){this._loaded=!0,this.stylesheet=w;for(const R in w.sources)this.addSource(R,w.sources[R],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new bt(this.stylesheet.light),this.sky=new pt(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const n=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",n),this._order=n.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of n){const _=l.aA(f);_.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=_}}_loadSprite(n,f=!1,_=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,R,D,z){return l._(this,void 0,void 0,function*(){const q=ve(w),H=D>1?"@2x":"",X={},ne={};for(const{id:me,url:Ie}of q){const Me=R.transformRequest(Ce(Ie,H,".json"),"SpriteJSON");X[me]=l.h(Me,z);const Ne=R.transformRequest(Ce(Ie,H,".png"),"SpriteImage");ne[me]=Y.getImage(Ne,z)}return yield Promise.all([...Object.values(X),...Object.values(ne)]),function(me,Ie){return l._(this,void 0,void 0,function*(){const Me={};for(const Ne in me){Me[Ne]={};const Fe=C.getImageCanvasContext((yield Ie[Ne]).data),je=(yield me[Ne]).data;for(const Te in je){const{width:He,height:Qe,x:at,y:wt,sdf:Dt,pixelRatio:Zt,stretchX:Kt,stretchY:qt,content:jt,textFitWidth:rn,textFitHeight:Sn}=je[Te];Me[Ne][Te]={data:null,pixelRatio:Zt,sdf:Dt,stretchX:Kt,stretchY:qt,content:jt,textFitWidth:rn,textFitHeight:Sn,spriteData:{width:He,height:Qe,x:at,y:wt,context:Fe}}}}return Me})}(X,ne)})}(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const R in w){this._spritesImagesIds[R]=[];const D=this._spritesImagesIds[R]?this._spritesImagesIds[R].filter(z=>!(z in w)):[];for(const z of D)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in w[R]){const q=R==="default"?z:`${R}:${z}`;this._spritesImagesIds[R].push(q),q in this.imageManager.images?this.imageManager.updateImage(q,w[R][z],!1):this.imageManager.addImage(q,w[R][z]),f&&(this._changedImages[q]=!0)}}}).catch(w=>{this._spriteRequest=null,y=w,this.fire(new l.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),_&&_(y)})}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(n){const f=this.sourceCaches[n.source];if(!f)return;const _=n.sourceLayer;if(!_)return;const y=f.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(_)===-1)&&this.fire(new l.j(new Error(`Source layer "${_}" does not exist on source "${y.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n,f=!1){const _=this._serializedAllLayers();if(!n||n.length===0)return Object.values(f?l.aB(_):_);const y=[];for(const w of n)if(_[w]){const R=f?l.aB(_[w]):_[w];y.push(R)}return y}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const f=Object.keys(this._layers);for(const _ of f){const y=this._layers[_];y.type!=="custom"&&(n[_]=y.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const n in this.sourceCaches)if(this.sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const f=this._changed;if(f){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const R in this._updatedSources){const D=this._updatedSources[R];if(D==="reload")this._reloadSource(R);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(R)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(n);this.light.updateTransitions(n),this.sky.updateTransitions(n),this._resetUpdates()}const _={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];_[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(n,this._availableImages),!w.isHidden(n.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in _){const w=this.sourceCaches[y];!!_[y]!=!!w.used&&w.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(n),this.sky.recalculate(n),this.z=n.zoom,f&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(n,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,f={}){var _;this._checkLoaded();const y=this.serialize();if(n=f.transformStyle?f.transformStyle(y,n):n,((_=f.validate)===null||_===void 0||_)&&tr(this,l.u(n)))return!1;(n=l.aB(n)).layers=l.az(n.layers);const w=l.aC(y,n),R=this._getOperationsToPerform(w);if(R.unimplemented.length>0)throw new Error(`Unimplemented: ${R.unimplemented.join(", ")}.`);if(R.operations.length===0)return!1;for(const D of R.operations)D();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const f=[],_=[];for(const y of n)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":f.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":f.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,y.args));break;case"setSky":f.push(()=>this.setSky.apply(this,y.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setTransition":f.push(()=>{});break;default:_.push(y.command)}return{operations:f,unimplemented:_}}addImage(n,f){if(this.getImage(n))return this.fire(new l.j(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,f),this._afterImageUpdated(n)}updateImage(n,f){this.imageManager.updateImage(n,f)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new l.j(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,f,_={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(l.u.source,`sources.${n}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const y=this.sourceCaches[n]=new At(n,f,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:n})),y.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new l.j(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));const f=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],f.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,f){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const _=this.sourceCaches[n].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(f),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,f,_={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new l.j(new Error(`Layer "${y}" already exists on this map.`)));let w;if(n.type==="custom"){if(tr(this,l.aD(n)))return;w=l.aA(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(y,n.source),n=l.aB(n),n=l.e(n,{source:y})),this._validate(l.u.layer,`layers.${y}`,n,{arrayIndex:-1},_))return;w=l.aA(n),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const R=f?this._order.indexOf(f):this._order.length;if(f&&R===-1)this.fire(new l.j(new Error(`Cannot add layer "${y}" before non-existing layer "${f}".`)));else{if(this._order.splice(R,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const D=this._removedLayers[y];delete this._removedLayers[y],D.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(n,f){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new l.j(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===f)return;const _=this._order.indexOf(n);this._order.splice(_,1);const y=f?this._order.indexOf(f):this._order.length;f&&y===-1?this.fire(new l.j(new Error(`Cannot move layer "${n}" before non-existing layer "${f}".`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const f=this._layers[n];if(!f)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${n}".`)));f.setEventedParent(null);const _=this._order.indexOf(n);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=f,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],f.onRemove&&f.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,f,_){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===f&&y.maxzoom===_||(f!=null&&(y.minzoom=f),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,f,_={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!l.aE(y.filter,f))return f==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(l.u.filter,`layers.${y.id}.filter`,f,null,_)||(y.filter=l.aB(f),this._updateLayer(y)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return l.aB(this.getLayer(n).filter)}setLayoutProperty(n,f,_,y={}){this._checkLoaded();const w=this.getLayer(n);w?l.aE(w.getLayoutProperty(f),_)||(w.setLayoutProperty(f,_,y),this._updateLayer(w)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,f){const _=this.getLayer(n);if(_)return _.getLayoutProperty(f);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,f,_,y={}){this._checkLoaded();const w=this.getLayer(n);w?l.aE(w.getPaintProperty(f),_)||(w.setPaintProperty(f,_,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[n]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,f){return this.getLayer(n).getPaintProperty(f)}setFeatureState(n,f){this._checkLoaded();const _=n.source,y=n.sourceLayer,w=this.sourceCaches[_];if(w===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const R=w.getSource().type;R==="geojson"&&y?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||y?(n.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,n.id,f)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,f){this._checkLoaded();const _=n.source,y=this.sourceCaches[_];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const w=y.getSource().type,R=w==="vector"?n.sourceLayer:void 0;w!=="vector"||R?f&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(R,n.id,f):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const f=n.source,_=n.sourceLayer,y=this.sourceCaches[f];if(y!==void 0)return y.getSource().type!=="vector"||_?(n.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(_,n.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=l.aF(this.sourceCaches,w=>w.serialize()),f=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,y=this.stylesheet;return l.aG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:n,layers:f,terrain:_},w=>w!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const f=R=>this._layers[R].type==="fill-extrusion",_={},y=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(f(D)){_[D]=R;for(const z of n){const q=z[D];if(q)for(const H of q)y.push(H)}}}y.sort((R,D)=>D.intersectionZ-R.intersectionZ);const w=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(f(D))for(let z=y.length-1;z>=0;z--){const q=y[z].feature;if(_[q.layer.id]<R)break;w.push(q),y.pop()}else for(const z of n){const q=z[D];if(q)for(const H of q)w.push(H.feature)}}return w}queryRenderedFeatures(n,f,_){f&&f.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",f.filter,null,f);const y={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const D of f.layers){const z=this._layers[D];if(!z)return this.fire(new l.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const w=[];f.availableImages=this._availableImages;const R=this._serializedAllLayers();for(const D in this.sourceCaches)f.layers&&!y[D]||w.push(ut(this.sourceCaches[D],this._layers,R,n,f,_));return this.placement&&w.push(function(D,z,q,H,X,ne,me){const Ie={},Me=ne.queryRenderedSymbols(H),Ne=[];for(const Fe of Object.keys(Me).map(Number))Ne.push(me[Fe]);Ne.sort(Ye);for(const Fe of Ne){const je=Fe.featureIndex.lookupSymbolFeatures(Me[Fe.bucketInstanceId],z,Fe.bucketIndex,Fe.sourceLayerIndex,X.filter,X.layers,X.availableImages,D);for(const Te in je){const He=Ie[Te]=Ie[Te]||[],Qe=je[Te];Qe.sort((at,wt)=>{const Dt=Fe.featureSortOrder;if(Dt){const Zt=Dt.indexOf(at.featureIndex);return Dt.indexOf(wt.featureIndex)-Zt}return wt.featureIndex-at.featureIndex});for(const at of Qe)He.push(at)}}for(const Fe in Ie)Ie[Fe].forEach(je=>{const Te=je.feature,He=q[D[Fe].source].getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=He});return Ie}(this._layers,R,this.sourceCaches,n,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(n,f){f&&f.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",f.filter,null,f);const _=this.sourceCaches[n];return _?function(y,w){const R=y.getRenderableIds().map(q=>y.getTileByID(q)),D=[],z={};for(let q=0;q<R.length;q++){const H=R[q],X=H.tileID.canonical.key;z[X]||(z[X]=!0,H.querySourceFeatures(D,w))}return D}(_,f):[]}getLight(){return this.light.getLight()}setLight(n,f={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const R in n)if(!l.aE(n[R],_[R])){y=!0;break}if(!y)return;const w={now:C.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,f),this.light.updateTransitions(w)}getSky(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.sky}setSky(n,f={}){const _=this.getSky();let y=!1;if(!n&&!_)return;if(n&&!_)y=!0;else if(!n&&_)y=!0;else for(const R in n)if(!l.aE(n[R],_[R])){y=!0;break}if(!y)return;const w={now:C.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=n,this.sky.setSky(n,f),this.sky.updateTransitions(w)}_validate(n,f,_,y,w={}){return(!w||w.validate!==!1)&&tr(this,n.call(l.u,l.e({key:f,style:this.serialize(),value:_,styleSpec:l.v},y)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),mn().off(ht,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const _=this.sourceCaches[f];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const f in this.sourceCaches)this.sourceCaches[f].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,f,_,y,w=!1){let R=!1,D=!1;const z={};for(const q of this._order){const H=this._layers[q];if(H.type!=="symbol")continue;if(!z[H.source]){const ne=this.sourceCaches[H.source];z[H.source]=ne.getRenderableIds(!0).map(me=>ne.getTileByID(me)).sort((me,Ie)=>Ie.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(Ie.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(H,z[H.source],n.center.lng);R=R||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(C.now(),n.zoom))&&(this.pauseablePlacement=new la(n,this.map.terrain,this._order,w,f,_,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(C.now()),D=!0),R&&this.pauseablePlacement.placement.setStale()),D||R)for(const q of this._order){const H=this._layers[q];H.type==="symbol"&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(C.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,f){return l._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,f.icons),_})}getGlyphs(n,f){return l._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(f.stacks),y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,f={}){this._checkLoaded(),n&&this._validate(l.u.glyphs,"glyphs",n,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,f,_={},y){this._checkLoaded();const w=[{id:n,url:f}],R=[...ve(this.stylesheet.sprite),...w];this._validate(l.u.sprite,"sprite",R,null,_)||(this.stylesheet.sprite=R,this._loadSprite(w,!0,y))}removeSprite(n){this._checkLoaded();const f=ve(this.stylesheet.sprite);if(f.find(_=>_.id===n)){if(this._spritesImagesIds[n])for(const _ of this._spritesImagesIds[n])this.imageManager.removeImage(_),this._changedImages[_]=!0;f.splice(f.findIndex(_=>_.id===n),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return ve(this.stylesheet.sprite)}setSprite(n,f={},_){this._checkLoaded(),n&&this._validate(l.u.sprite,"sprite",n,null,f)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,_):(this._unloadSprite(),_&&_(null)))}}var ss=l.Y([{name:"a_pos",type:"Int16",components:2}]);const ro={prelude:ni(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ni(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ni(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ni(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ni(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ni("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ni(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ni(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ni(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ni(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ni(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ni(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ni(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ni(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ni(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ni(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ni(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ni("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ni("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ni("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ni("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ni(k,n){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=n.match(/attribute ([\w]+) ([\w]+)/g),y=k.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=w?w.concat(y):y,D={};return{fragmentSource:k=k.replace(f,(z,q,H,X,ne)=>(D[ne]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${H} ${X} ${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = u_${ne};
#endif
`)),vertexSource:n=n.replace(f,(z,q,H,X,ne)=>{const me=X==="float"?"vec2":"vec4",Ie=ne.match(/color/)?"color":me;return D[ne]?q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${me} a_${ne};
varying ${H} ${X} ${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${Ie}(a_${ne}, u_${ne}_t);
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${me} a_${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = a_${ne};
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = unpack_mix_${Ie}(a_${ne}, u_${ne}_t);
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`}),staticAttributes:_,staticUniforms:R}}class El{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,f,_,y,w,R,D,z,q){this.context=n;let H=this.boundPaintVertexBuffers.length!==y.length;for(let X=0;!H&&X<y.length;X++)this.boundPaintVertexBuffers[X]!==y[X]&&(H=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==R||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==q?this.freshBind(f,_,y,w,R,D,z,q):(n.bindVertexArray.set(this.vao),D&&D.bind(),w&&w.dynamicDraw&&w.bind(),z&&z.bind(),q&&q.bind())}freshBind(n,f,_,y,w,R,D,z){const q=n.numAttributes,H=this.context,X=H.gl;this.vao&&this.destroy(),this.vao=H.createVertexArray(),H.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=z,f.enableAttributes(X,n);for(const ne of _)ne.enableAttributes(X,n);R&&R.enableAttributes(X,n),D&&D.enableAttributes(X,n),z&&z.enableAttributes(X,n),f.bind(),f.setVertexAttribPointers(X,n,w);for(const ne of _)ne.bind(),ne.setVertexAttribPointers(X,n,w);R&&(R.bind(),R.setVertexAttribPointers(X,n,w)),y&&y.bind(),D&&(D.bind(),D.setVertexAttribPointers(X,n,w)),z&&(z.bind(),z.setVertexAttribPointers(X,n,w)),H.currentNumAttributes=q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Al=(k,n,f,_,y)=>({u_matrix:k,u_texture:0,u_ele_delta:n,u_fog_matrix:f,u_fog_color:_?_.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:_?_.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?_.calculateFogBlendOpacity(y):0,u_horizon_color:_?_.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:_?_.properties.get("horizon-fog-blend"):1});function wo(k){const n=[];for(let f=0;f<k.length;f++){if(k[f]===null)continue;const _=k[f].split(" ");n.push(_.pop())}return n}class ko{constructor(n,f,_,y,w,R){const D=n.gl;this.program=D.createProgram();const z=wo(f.staticAttributes),q=_?_.getBinderAttributes():[],H=z.concat(q),X=ro.prelude.staticUniforms?wo(ro.prelude.staticUniforms):[],ne=f.staticUniforms?wo(f.staticUniforms):[],me=_?_.getBinderUniforms():[],Ie=X.concat(ne).concat(me),Me=[];for(const at of Ie)Me.indexOf(at)<0&&Me.push(at);const Ne=_?_.defines():[];w&&Ne.push("#define OVERDRAW_INSPECTOR;"),R&&Ne.push("#define TERRAIN3D;");const Fe=Ne.concat(ro.prelude.fragmentSource,f.fragmentSource).join(`
`),je=Ne.concat(ro.prelude.vertexSource,f.vertexSource).join(`
`),Te=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Te,Fe),D.compileShader(Te),!D.getShaderParameter(Te,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Te)}`);D.attachShader(this.program,Te);const He=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(He,je),D.compileShader(He),!D.getShaderParameter(He,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(He)}`);D.attachShader(this.program,He),this.attributes={};const Qe={};this.numAttributes=H.length;for(let at=0;at<this.numAttributes;at++)H[at]&&(D.bindAttribLocation(this.program,at,H[at]),this.attributes[H[at]]=at);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(He),D.deleteShader(Te);for(let at=0;at<Me.length;at++){const wt=Me[at];if(wt&&!Qe[wt]){const Dt=D.getUniformLocation(this.program,wt);Dt&&(Qe[wt]=Dt)}}this.fixedUniforms=y(n,Qe),this.terrainUniforms=((at,wt)=>({u_depth:new l.aH(at,wt.u_depth),u_terrain:new l.aH(at,wt.u_terrain),u_terrain_dim:new l.aI(at,wt.u_terrain_dim),u_terrain_matrix:new l.aJ(at,wt.u_terrain_matrix),u_terrain_unpack:new l.aK(at,wt.u_terrain_unpack),u_terrain_exaggeration:new l.aI(at,wt.u_terrain_exaggeration)}))(n,Qe),this.binderUniforms=_?_.getUniforms(n,Qe):[]}draw(n,f,_,y,w,R,D,z,q,H,X,ne,me,Ie,Me,Ne,Fe,je){const Te=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(_),n.setStencilMode(y),n.setColorMode(w),n.setCullFace(R),z){n.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,z.depthTexture),n.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,z.texture);for(const Qe in this.terrainUniforms)this.terrainUniforms[Qe].set(z[Qe])}for(const Qe in this.fixedUniforms)this.fixedUniforms[Qe].set(D[Qe]);Me&&Me.setUniforms(n,this.binderUniforms,me,{zoom:Ie});let He=0;switch(f){case Te.LINES:He=2;break;case Te.TRIANGLES:He=3;break;case Te.LINE_STRIP:He=1}for(const Qe of ne.get()){const at=Qe.vaos||(Qe.vaos={});(at[q]||(at[q]=new El)).bind(n,this,H,Me?Me.getPaintVertexBuffers():[],X,Qe.vertexOffset,Ne,Fe,je),Te.drawElements(f,Qe.primitiveLength*He,Te.UNSIGNED_SHORT,Qe.primitiveOffset*He*2)}}}function ha(k,n,f){const _=1/Un(f,1,n.transform.tileZoom),y=Math.pow(2,f.tileID.overscaledZ),w=f.tileSize*Math.pow(2,n.transform.tileZoom)/y,R=w*(f.tileID.canonical.x+f.tileID.wrap*y),D=w*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[_,k.fromScale,k.toScale],u_fade:k.t,u_pixel_coord_upper:[R>>16,D>>16],u_pixel_coord_lower:[65535&R,65535&D]}}const fa=(k,n,f,_)=>{const y=n.style.light,w=y.properties.get("position"),R=[w.x,w.y,w.z],D=function(){var q=new l.A(9);return l.A!=Float32Array&&(q[1]=0,q[2]=0,q[3]=0,q[5]=0,q[6]=0,q[7]=0),q[0]=1,q[4]=1,q[8]=1,q}();y.properties.get("anchor")==="viewport"&&function(q,H){var X=Math.sin(H),ne=Math.cos(H);q[0]=ne,q[1]=X,q[2]=0,q[3]=-X,q[4]=ne,q[5]=0,q[6]=0,q[7]=0,q[8]=1}(D,-n.transform.angle),function(q,H,X){var ne=H[0],me=H[1],Ie=H[2];q[0]=ne*X[0]+me*X[3]+Ie*X[6],q[1]=ne*X[1]+me*X[4]+Ie*X[7],q[2]=ne*X[2]+me*X[5]+Ie*X[8]}(R,R,D);const z=y.properties.get("color");return{u_matrix:k,u_lightpos:R,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+f,u_opacity:_}},da=(k,n,f,_,y,w,R)=>l.e(fa(k,n,f,_),ha(w,n,R),{u_height_factor:-Math.pow(2,y.overscaledZ)/R.tileSize/8}),Fo=k=>({u_matrix:k}),Ba=(k,n,f,_)=>l.e(Fo(k),ha(f,n,_)),Si=(k,n)=>({u_matrix:k,u_world:n}),so=(k,n,f,_,y)=>l.e(Ba(k,n,f,_),{u_world:y}),vc=(k,n,f,_)=>{const y=k.transform;let w,R;if(_.paint.get("circle-pitch-alignment")==="map"){const D=Un(f,1,y.zoom);w=!0,R=[D,D]}else w=!1,R=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:k.translatePosMatrix(n.posMatrix,f,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:k.pixelRatio,u_extrude_scale:R}},Vs=(k,n,f)=>({u_matrix:k,u_inv_matrix:n,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),xr=(k,n,f=1)=>({u_matrix:k,u_color:n,u_overlay:0,u_overlay_scale:f}),wi=k=>({u_matrix:k}),hr=(k,n,f,_)=>({u_matrix:k,u_extrude_scale:Un(n,1,f),u_intensity:_}),Ua=(k,n,f,_)=>{const y=l.H();l.aP(y,0,k.width,k.height,0,0,1);const w=k.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:f,u_color_ramp:_,u_opacity:n.paint.get("heatmap-opacity")}};function ja(k,n){const f=Math.pow(2,n.canonical.z),_=n.canonical.y;return[new l.Z(0,_/f).toLngLat().lat,new l.Z(0,(_+1)/f).toLngLat().lat]}const pa=(k,n,f,_)=>{const y=k.transform;return{u_matrix:vs(k,n,f,_),u_ratio:1/Un(n,1,y.zoom),u_device_pixel_ratio:k.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ma=(k,n,f,_,y)=>l.e(pa(k,n,f,y),{u_image:0,u_image_height:_}),Oo=(k,n,f,_,y)=>{const w=k.transform,R=si(n,w);return{u_matrix:vs(k,n,f,y),u_texsize:n.imageAtlasTexture.size,u_ratio:1/Un(n,1,w.zoom),u_device_pixel_ratio:k.pixelRatio,u_image:0,u_scale:[R,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},lu=(k,n,f,_,y,w)=>{const R=k.lineAtlas,D=si(n,k.transform),z=f.layout.get("line-cap")==="round",q=R.getDash(_.from,z),H=R.getDash(_.to,z),X=q.width*y.fromScale,ne=H.width*y.toScale;return l.e(pa(k,n,f,w),{u_patternscale_a:[D/X,-q.height/2],u_patternscale_b:[D/ne,-H.height/2],u_sdfgamma:R.width/(256*Math.min(X,ne)*k.pixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:H.y,u_mix:y.t})};function si(k,n){return 1/Un(k,1,n.tileZoom)}function vs(k,n,f,_){return k.translatePosMatrix(_?_.posMatrix:n.tileID.posMatrix,n,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Tl=(k,n,f,_,y)=>{return{u_matrix:k,u_tl_parent:n,u_scale_parent:f,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(R=y.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:uu(y.paint.get("raster-hue-rotate"))};var w,R};function uu(k){k*=Math.PI/180;const n=Math.sin(k),f=Math.cos(k);return[(2*f+1)/3,(-Math.sqrt(3)*n-f+1)/3,(Math.sqrt(3)*n-f+1)/3]}const Bo=(k,n,f,_,y,w,R,D,z,q,H,X,ne,me)=>{const Ie=R.transform;return{u_is_size_zoom_constant:+(k==="constant"||k==="source"),u_is_size_feature_constant:+(k==="constant"||k==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Ie.cameraToCenterDistance,u_pitch:Ie.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:Ie.width/Ie.height,u_fade_change:R.options.fadeDuration?R.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:z,u_coord_matrix:q,u_is_text:+X,u_pitch_with_map:+_,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:me}},Uo=(k,n,f,_,y,w,R,D,z,q,H,X,ne,me,Ie)=>{const Me=R.transform;return l.e(Bo(k,n,f,_,y,w,R,D,z,q,H,X,ne,Ie),{u_gamma_scale:_?Math.cos(Me._pitch)*Me.cameraToCenterDistance:1,u_device_pixel_ratio:R.pixelRatio,u_is_halo:+me})},fr=(k,n,f,_,y,w,R,D,z,q,H,X,ne,me)=>l.e(Uo(k,n,f,_,y,w,R,D,z,q,H,!0,X,!0,me),{u_texsize_icon:ne,u_texture_icon:1}),ga=(k,n,f)=>({u_matrix:k,u_opacity:n,u_color:f}),_a=(k,n,f,_,y,w)=>l.e(function(R,D,z,q){const H=z.imageManager.getPattern(R.from.toString()),X=z.imageManager.getPattern(R.to.toString()),{width:ne,height:me}=z.imageManager.getPixelSize(),Ie=Math.pow(2,q.tileID.overscaledZ),Me=q.tileSize*Math.pow(2,z.transform.tileZoom)/Ie,Ne=Me*(q.tileID.canonical.x+q.tileID.wrap*Ie),Fe=Me*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[ne,me],u_mix:D.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Un(q,1,z.transform.tileZoom),u_pixel_coord_upper:[Ne>>16,Fe>>16],u_pixel_coord_lower:[65535&Ne,65535&Fe]}}(_,w,f,y),{u_matrix:k,u_opacity:n}),qa={fillExtrusion:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_lightpos:new l.aN(k,n.u_lightpos),u_lightintensity:new l.aI(k,n.u_lightintensity),u_lightcolor:new l.aN(k,n.u_lightcolor),u_vertical_gradient:new l.aI(k,n.u_vertical_gradient),u_opacity:new l.aI(k,n.u_opacity)}),fillExtrusionPattern:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_lightpos:new l.aN(k,n.u_lightpos),u_lightintensity:new l.aI(k,n.u_lightintensity),u_lightcolor:new l.aN(k,n.u_lightcolor),u_vertical_gradient:new l.aI(k,n.u_vertical_gradient),u_height_factor:new l.aI(k,n.u_height_factor),u_image:new l.aH(k,n.u_image),u_texsize:new l.aO(k,n.u_texsize),u_pixel_coord_upper:new l.aO(k,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,n.u_pixel_coord_lower),u_scale:new l.aN(k,n.u_scale),u_fade:new l.aI(k,n.u_fade),u_opacity:new l.aI(k,n.u_opacity)}),fill:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix)}),fillPattern:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_image:new l.aH(k,n.u_image),u_texsize:new l.aO(k,n.u_texsize),u_pixel_coord_upper:new l.aO(k,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,n.u_pixel_coord_lower),u_scale:new l.aN(k,n.u_scale),u_fade:new l.aI(k,n.u_fade)}),fillOutline:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_world:new l.aO(k,n.u_world)}),fillOutlinePattern:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_world:new l.aO(k,n.u_world),u_image:new l.aH(k,n.u_image),u_texsize:new l.aO(k,n.u_texsize),u_pixel_coord_upper:new l.aO(k,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,n.u_pixel_coord_lower),u_scale:new l.aN(k,n.u_scale),u_fade:new l.aI(k,n.u_fade)}),circle:(k,n)=>({u_camera_to_center_distance:new l.aI(k,n.u_camera_to_center_distance),u_scale_with_map:new l.aH(k,n.u_scale_with_map),u_pitch_with_map:new l.aH(k,n.u_pitch_with_map),u_extrude_scale:new l.aO(k,n.u_extrude_scale),u_device_pixel_ratio:new l.aI(k,n.u_device_pixel_ratio),u_matrix:new l.aJ(k,n.u_matrix)}),collisionBox:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_pixel_extrude_scale:new l.aO(k,n.u_pixel_extrude_scale)}),collisionCircle:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_inv_matrix:new l.aJ(k,n.u_inv_matrix),u_camera_to_center_distance:new l.aI(k,n.u_camera_to_center_distance),u_viewport_size:new l.aO(k,n.u_viewport_size)}),debug:(k,n)=>({u_color:new l.aL(k,n.u_color),u_matrix:new l.aJ(k,n.u_matrix),u_overlay:new l.aH(k,n.u_overlay),u_overlay_scale:new l.aI(k,n.u_overlay_scale)}),clippingMask:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix)}),heatmap:(k,n)=>({u_extrude_scale:new l.aI(k,n.u_extrude_scale),u_intensity:new l.aI(k,n.u_intensity),u_matrix:new l.aJ(k,n.u_matrix)}),heatmapTexture:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_world:new l.aO(k,n.u_world),u_image:new l.aH(k,n.u_image),u_color_ramp:new l.aH(k,n.u_color_ramp),u_opacity:new l.aI(k,n.u_opacity)}),hillshade:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_image:new l.aH(k,n.u_image),u_latrange:new l.aO(k,n.u_latrange),u_light:new l.aO(k,n.u_light),u_shadow:new l.aL(k,n.u_shadow),u_highlight:new l.aL(k,n.u_highlight),u_accent:new l.aL(k,n.u_accent)}),hillshadePrepare:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_image:new l.aH(k,n.u_image),u_dimension:new l.aO(k,n.u_dimension),u_zoom:new l.aI(k,n.u_zoom),u_unpack:new l.aK(k,n.u_unpack)}),line:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_ratio:new l.aI(k,n.u_ratio),u_device_pixel_ratio:new l.aI(k,n.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,n.u_units_to_pixels)}),lineGradient:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_ratio:new l.aI(k,n.u_ratio),u_device_pixel_ratio:new l.aI(k,n.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,n.u_units_to_pixels),u_image:new l.aH(k,n.u_image),u_image_height:new l.aI(k,n.u_image_height)}),linePattern:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_texsize:new l.aO(k,n.u_texsize),u_ratio:new l.aI(k,n.u_ratio),u_device_pixel_ratio:new l.aI(k,n.u_device_pixel_ratio),u_image:new l.aH(k,n.u_image),u_units_to_pixels:new l.aO(k,n.u_units_to_pixels),u_scale:new l.aN(k,n.u_scale),u_fade:new l.aI(k,n.u_fade)}),lineSDF:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_ratio:new l.aI(k,n.u_ratio),u_device_pixel_ratio:new l.aI(k,n.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,n.u_units_to_pixels),u_patternscale_a:new l.aO(k,n.u_patternscale_a),u_patternscale_b:new l.aO(k,n.u_patternscale_b),u_sdfgamma:new l.aI(k,n.u_sdfgamma),u_image:new l.aH(k,n.u_image),u_tex_y_a:new l.aI(k,n.u_tex_y_a),u_tex_y_b:new l.aI(k,n.u_tex_y_b),u_mix:new l.aI(k,n.u_mix)}),raster:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_tl_parent:new l.aO(k,n.u_tl_parent),u_scale_parent:new l.aI(k,n.u_scale_parent),u_buffer_scale:new l.aI(k,n.u_buffer_scale),u_fade_t:new l.aI(k,n.u_fade_t),u_opacity:new l.aI(k,n.u_opacity),u_image0:new l.aH(k,n.u_image0),u_image1:new l.aH(k,n.u_image1),u_brightness_low:new l.aI(k,n.u_brightness_low),u_brightness_high:new l.aI(k,n.u_brightness_high),u_saturation_factor:new l.aI(k,n.u_saturation_factor),u_contrast_factor:new l.aI(k,n.u_contrast_factor),u_spin_weights:new l.aN(k,n.u_spin_weights)}),symbolIcon:(k,n)=>({u_is_size_zoom_constant:new l.aH(k,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,n.u_is_size_feature_constant),u_size_t:new l.aI(k,n.u_size_t),u_size:new l.aI(k,n.u_size),u_camera_to_center_distance:new l.aI(k,n.u_camera_to_center_distance),u_pitch:new l.aI(k,n.u_pitch),u_rotate_symbol:new l.aH(k,n.u_rotate_symbol),u_aspect_ratio:new l.aI(k,n.u_aspect_ratio),u_fade_change:new l.aI(k,n.u_fade_change),u_matrix:new l.aJ(k,n.u_matrix),u_label_plane_matrix:new l.aJ(k,n.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,n.u_coord_matrix),u_is_text:new l.aH(k,n.u_is_text),u_pitch_with_map:new l.aH(k,n.u_pitch_with_map),u_is_along_line:new l.aH(k,n.u_is_along_line),u_is_variable_anchor:new l.aH(k,n.u_is_variable_anchor),u_texsize:new l.aO(k,n.u_texsize),u_texture:new l.aH(k,n.u_texture),u_translation:new l.aO(k,n.u_translation),u_pitched_scale:new l.aI(k,n.u_pitched_scale)}),symbolSDF:(k,n)=>({u_is_size_zoom_constant:new l.aH(k,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,n.u_is_size_feature_constant),u_size_t:new l.aI(k,n.u_size_t),u_size:new l.aI(k,n.u_size),u_camera_to_center_distance:new l.aI(k,n.u_camera_to_center_distance),u_pitch:new l.aI(k,n.u_pitch),u_rotate_symbol:new l.aH(k,n.u_rotate_symbol),u_aspect_ratio:new l.aI(k,n.u_aspect_ratio),u_fade_change:new l.aI(k,n.u_fade_change),u_matrix:new l.aJ(k,n.u_matrix),u_label_plane_matrix:new l.aJ(k,n.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,n.u_coord_matrix),u_is_text:new l.aH(k,n.u_is_text),u_pitch_with_map:new l.aH(k,n.u_pitch_with_map),u_is_along_line:new l.aH(k,n.u_is_along_line),u_is_variable_anchor:new l.aH(k,n.u_is_variable_anchor),u_texsize:new l.aO(k,n.u_texsize),u_texture:new l.aH(k,n.u_texture),u_gamma_scale:new l.aI(k,n.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,n.u_device_pixel_ratio),u_is_halo:new l.aH(k,n.u_is_halo),u_translation:new l.aO(k,n.u_translation),u_pitched_scale:new l.aI(k,n.u_pitched_scale)}),symbolTextAndIcon:(k,n)=>({u_is_size_zoom_constant:new l.aH(k,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,n.u_is_size_feature_constant),u_size_t:new l.aI(k,n.u_size_t),u_size:new l.aI(k,n.u_size),u_camera_to_center_distance:new l.aI(k,n.u_camera_to_center_distance),u_pitch:new l.aI(k,n.u_pitch),u_rotate_symbol:new l.aH(k,n.u_rotate_symbol),u_aspect_ratio:new l.aI(k,n.u_aspect_ratio),u_fade_change:new l.aI(k,n.u_fade_change),u_matrix:new l.aJ(k,n.u_matrix),u_label_plane_matrix:new l.aJ(k,n.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,n.u_coord_matrix),u_is_text:new l.aH(k,n.u_is_text),u_pitch_with_map:new l.aH(k,n.u_pitch_with_map),u_is_along_line:new l.aH(k,n.u_is_along_line),u_is_variable_anchor:new l.aH(k,n.u_is_variable_anchor),u_texsize:new l.aO(k,n.u_texsize),u_texsize_icon:new l.aO(k,n.u_texsize_icon),u_texture:new l.aH(k,n.u_texture),u_texture_icon:new l.aH(k,n.u_texture_icon),u_gamma_scale:new l.aI(k,n.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,n.u_device_pixel_ratio),u_is_halo:new l.aH(k,n.u_is_halo),u_translation:new l.aO(k,n.u_translation),u_pitched_scale:new l.aI(k,n.u_pitched_scale)}),background:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_opacity:new l.aI(k,n.u_opacity),u_color:new l.aL(k,n.u_color)}),backgroundPattern:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_opacity:new l.aI(k,n.u_opacity),u_image:new l.aH(k,n.u_image),u_pattern_tl_a:new l.aO(k,n.u_pattern_tl_a),u_pattern_br_a:new l.aO(k,n.u_pattern_br_a),u_pattern_tl_b:new l.aO(k,n.u_pattern_tl_b),u_pattern_br_b:new l.aO(k,n.u_pattern_br_b),u_texsize:new l.aO(k,n.u_texsize),u_mix:new l.aI(k,n.u_mix),u_pattern_size_a:new l.aO(k,n.u_pattern_size_a),u_pattern_size_b:new l.aO(k,n.u_pattern_size_b),u_scale_a:new l.aI(k,n.u_scale_a),u_scale_b:new l.aI(k,n.u_scale_b),u_pixel_coord_upper:new l.aO(k,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,n.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(k,n.u_tile_units_to_pixels)}),terrain:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_texture:new l.aH(k,n.u_texture),u_ele_delta:new l.aI(k,n.u_ele_delta),u_fog_matrix:new l.aJ(k,n.u_fog_matrix),u_fog_color:new l.aL(k,n.u_fog_color),u_fog_ground_blend:new l.aI(k,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(k,n.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(k,n.u_horizon_color),u_horizon_fog_blend:new l.aI(k,n.u_horizon_fog_blend)}),terrainDepth:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_ele_delta:new l.aI(k,n.u_ele_delta)}),terrainCoords:(k,n)=>({u_matrix:new l.aJ(k,n.u_matrix),u_texture:new l.aH(k,n.u_texture),u_terrain_coords_id:new l.aI(k,n.u_terrain_coords_id),u_ele_delta:new l.aI(k,n.u_ele_delta)}),sky:(k,n)=>({u_sky_color:new l.aL(k,n.u_sky_color),u_horizon_color:new l.aL(k,n.u_horizon_color),u_horizon:new l.aI(k,n.u_horizon),u_sky_horizon_blend:new l.aI(k,n.u_sky_horizon_blend)})};class bs{constructor(n,f,_){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Va{constructor(n,f,_,y){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=y,this.context=n;const w=n.gl;this.buffer=w.createBuffer(),n.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,f){for(let _=0;_<this.attributes.length;_++){const y=f.attributes[this.attributes[_].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,f,_){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],R=f.attributes[w.name];R!==void 0&&n.vertexAttribPointer(R,w.components,n[bc[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr=new WeakMap;function xs(k){var n;if(Lr.has(k))return Lr.get(k);{const f=(n=k.getParameter(k.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return Lr.set(k,f),f}}class oi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mr extends oi{getDefault(){return l.aM.transparent}set(n){const f=this.current;(n.r!==f.r||n.g!==f.g||n.b!==f.b||n.a!==f.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class jo extends oi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class qo extends oi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Vo extends oi{getDefault(){return[!0,!0,!0,!0]}set(n){const f=this.current;(n[0]!==f[0]||n[1]!==f[1]||n[2]!==f[2]||n[3]!==f[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Cl extends oi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Go extends oi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class cu extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const f=this.current;(n.func!==f.func||n.ref!==f.ref||n.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class os extends oi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const f=this.current;(n[0]!==f[0]||n[1]!==f[1]||n[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Ll extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;n?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=n,this.dirty=!1}}class hu extends oi{getDefault(){return[0,1]}set(n){const f=this.current;(n[0]!==f[0]||n[1]!==f[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class fu extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;n?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=n,this.dirty=!1}}class du extends oi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Io extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;n?f.enable(f.BLEND):f.disable(f.BLEND),this.current=n,this.dirty=!1}}class pu extends oi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const f=this.current;(n[0]!==f[0]||n[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class xc extends oi{getDefault(){return l.aM.transparent}set(n){const f=this.current;(n.r!==f.r||n.g!==f.g||n.b!==f.b||n.a!==f.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class mu extends oi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class ws extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;n?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=n,this.dirty=!1}}class $r extends oi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Ga extends oi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class gu extends oi{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class wc extends oi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Za extends oi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const f=this.current;(n[0]!==f[0]||n[1]!==f[1]||n[2]!==f[2]||n[3]!==f[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ml extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Ha extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Xa extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class as extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ya extends oi{getDefault(){return null}set(n){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ji extends oi{getDefault(){return null}set(n){var f;if(n===this.current&&!this.dirty)return;const _=this.gl;xs(_)?_.bindVertexArray(n):(f=_.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class So extends oi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Rl extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Wa extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class va extends oi{constructor(n,f){super(n),this.context=n,this.parent=f}getDefault(){return null}}class Ka extends va{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Gs extends va{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Pl extends va{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class kc{constructor(n,f,_,y,w){this.context=n,this.width=f,this.height=_;const R=n.gl,D=this.framebuffer=R.createFramebuffer();if(this.colorAttachment=new Ka(n,D),y)this.depthAttachment=w?new Pl(n,D):new Gs(n,D);else if(w)throw new Error("Stencil cannot be set without depth");if(R.checkFramebufferStatus(R.FRAMEBUFFER)!==R.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const n=this.context.gl,f=this.colorAttachment.get();if(f&&n.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&n.deleteRenderbuffer(_)}n.deleteFramebuffer(this.framebuffer)}}class Fi{constructor(n,f,_){this.blendFunction=n,this.blendColor=f,this.mask=_}}Fi.Replace=[1,0],Fi.disabled=new Fi(Fi.Replace,l.aM.transparent,[!1,!1,!1,!1]),Fi.unblended=new Fi(Fi.Replace,l.aM.transparent,[!0,!0,!0,!0]),Fi.alphaBlended=new Fi([1,771],l.aM.transparent,[!0,!0,!0,!0]);class Ic{constructor(n){var f,_;if(this.gl=n,this.clearColor=new Mr(this),this.clearDepth=new jo(this),this.clearStencil=new qo(this),this.colorMask=new Vo(this),this.depthMask=new Cl(this),this.stencilMask=new Go(this),this.stencilFunc=new cu(this),this.stencilOp=new os(this),this.stencilTest=new Ll(this),this.depthRange=new hu(this),this.depthTest=new fu(this),this.depthFunc=new du(this),this.blend=new Io(this),this.blendFunc=new pu(this),this.blendColor=new xc(this),this.blendEquation=new mu(this),this.cullFace=new ws(this),this.cullFaceSide=new $r(this),this.frontFace=new Ga(this),this.program=new gu(this),this.activeTexture=new wc(this),this.viewport=new Za(this),this.bindFramebuffer=new Ml(this),this.bindRenderbuffer=new Ha(this),this.bindTexture=new Xa(this),this.bindVertexBuffer=new as(this),this.bindElementBuffer=new ya(this),this.bindVertexArray=new ji(this),this.pixelStoreUnpack=new So(this),this.pixelStoreUnpackPremultiplyAlpha=new Rl(this),this.pixelStoreUnpackFlipY=new Wa(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),xs(n)){this.HALF_FLOAT=n.HALF_FLOAT;const y=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=n.RGBA16F)!==null&&f!==void 0?f:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(_=n.RGB16F)!==null&&_!==void 0?_:y==null?void 0:y.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const y=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,f){return new bs(this,n,f)}createVertexBuffer(n,f,_){return new Va(this,n,f,_)}createRenderbuffer(n,f,_){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,n,f,_),this.bindRenderbuffer.set(null),w}createFramebuffer(n,f,_,y){return new kc(this,n,f,_,y)}clear({color:n,depth:f,stencil:_}){const y=this.gl;let w=0;n&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){l.aE(n.blendFunction,Fi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return xs(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var f;return xs(this.gl)?this.gl.deleteVertexArray(n):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}class jn{constructor(n,f,_){this.func=n,this.mask=f,this.range=_}}jn.ReadOnly=!1,jn.ReadWrite=!0,jn.disabled=new jn(519,jn.ReadOnly,[0,1]);const $a=7680;class mi{constructor(n,f,_,y,w,R){this.test=n,this.ref=f,this.mask=_,this.fail=y,this.depthFail=w,this.pass=R}}mi.disabled=new mi({func:519,mask:0},0,0,$a,$a,$a);class hi{constructor(n,f,_){this.enable=n,this.mode=f,this.frontFace=_}}let oo;function ba(k,n,f,_,y){const w=k.context,R=w.gl,D=k.useProgram("collisionBox"),z=[];let q=0,H=0;for(let Fe=0;Fe<_.length;Fe++){const je=_[Fe],Te=n.getTile(je).getBucket(f);if(!Te)continue;const He=y?Te.textCollisionBox:Te.iconCollisionBox,Qe=Te.collisionCircleArray;if(Qe.length>0){const at=l.H();l.aQ(at,Te.placementInvProjMatrix,k.transform.glCoordMatrix),l.aQ(at,at,Te.placementViewportMatrix),z.push({circleArray:Qe,circleOffset:H,transform:je.posMatrix,invTransform:at,coord:je}),q+=Qe.length/4,H=q}He&&D.draw(w,R.LINES,jn.disabled,mi.disabled,k.colorModeForRenderPass(),hi.disabled,{u_matrix:je.posMatrix,u_pixel_extrude_scale:[1/(X=k.transform).width,1/X.height]},k.style.map.terrain&&k.style.map.terrain.getTerrainData(je),f.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,k.transform.zoom,null,null,He.collisionVertexBuffer)}var X;if(!y||!z.length)return;const ne=k.useProgram("collisionCircle"),me=new l.aR;me.resize(4*q),me._trim();let Ie=0;for(const Fe of z)for(let je=0;je<Fe.circleArray.length/4;je++){const Te=4*je,He=Fe.circleArray[Te+0],Qe=Fe.circleArray[Te+1],at=Fe.circleArray[Te+2],wt=Fe.circleArray[Te+3];me.emplace(Ie++,He,Qe,at,wt,0),me.emplace(Ie++,He,Qe,at,wt,1),me.emplace(Ie++,He,Qe,at,wt,2),me.emplace(Ie++,He,Qe,at,wt,3)}(!oo||oo.length<2*q)&&(oo=function(Fe){const je=2*Fe,Te=new l.aT;Te.resize(je),Te._trim();for(let He=0;He<je;He++){const Qe=6*He;Te.uint16[Qe+0]=4*He+0,Te.uint16[Qe+1]=4*He+1,Te.uint16[Qe+2]=4*He+2,Te.uint16[Qe+3]=4*He+2,Te.uint16[Qe+4]=4*He+3,Te.uint16[Qe+5]=4*He+0}return Te}(q));const Me=w.createIndexBuffer(oo,!0),Ne=w.createVertexBuffer(me,l.aS.members,!0);for(const Fe of z){const je=Vs(Fe.transform,Fe.invTransform,k.transform);ne.draw(w,R.TRIANGLES,jn.disabled,mi.disabled,k.colorModeForRenderPass(),hi.disabled,je,k.style.map.terrain&&k.style.map.terrain.getTerrainData(Fe.coord),f.id,Ne,Me,l.a0.simpleSegment(0,2*Fe.circleOffset,Fe.circleArray.length,Fe.circleArray.length/2),null,k.transform.zoom,null,null,null)}Ne.destroy(),Me.destroy()}hi.disabled=new hi(!1,1029,2305),hi.backCCW=new hi(!0,1029,2305);const Zo=l.an(new Float32Array(16));function Dl(k,n,f,_,y,w){const{horizontalAlign:R,verticalAlign:D}=l.au(k);return new l.P((-(R-.5)*n/y+_[0])*w,(-(D-.5)*f/y+_[1])*w)}function Eo(k,n,f,_,y,w){const R=n.tileAnchorPoint.add(new l.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let D=_.mult(w);f||(D=D.rotate(-y));const z=R.add(D);return Re(z.x,z.y,n.labelPlaneMatrix,n.getElevation).point}if(f){const D=nt(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(k),z=Math.atan(D.y/D.x)+(D.x<0?Math.PI:0);return k.add(_.rotate(z))}return k.add(_)}function Ho(k,n,f,_,y,w,R,D,z,q,H,X,ne,me){const Ie=k.text.placedSymbolArray,Me=k.text.dynamicLayoutVertexArray,Ne=k.icon.dynamicLayoutVertexArray,Fe={};Me.clear();for(let je=0;je<Ie.length;je++){const Te=Ie.get(je),He=Te.hidden||!Te.crossTileID||k.allowVerticalPlacement&&!Te.placedOrientation?null:_[Te.crossTileID];if(He){const Qe=new l.P(Te.anchorX,Te.anchorY),at={getElevation:me,width:y.width,height:y.height,labelPlaneMatrix:w,lineVertexArray:null,pitchWithMap:f,projection:H,projectionCache:null,tileAnchorPoint:Qe,translation:X,unwrappedTileID:ne},wt=f?Re(Qe.x,Qe.y,R,me):nt(Qe.x,Qe.y,at),Dt=Q(y.cameraToCenterDistance,wt.signedDistanceFromCamera);let Zt=l.ai(k.textSizeData,z,Te)*Dt/l.ap;f&&(Zt*=k.tilePixelRatio/D);const{width:Kt,height:qt,anchor:jt,textOffset:rn,textBoxScale:Sn}=He,Vt=Dl(jt,Kt,qt,rn,Sn,Zt),Xt=H.getPitchedTextCorrection(y,Qe.add(new l.P(X[0],X[1])),ne),wn=Eo(wt.point,at,n,Vt,y.angle,Xt),Ai=k.allowVerticalPlacement&&Te.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Bn=0;Bn<Te.numGlyphs;Bn++)l.aj(Me,wn,Ai);q&&Te.associatedIconIndex>=0&&(Fe[Te.associatedIconIndex]={shiftedAnchor:wn,angle:Ai})}else ln(Te.numGlyphs,Me)}if(q){Ne.clear();const je=k.icon.placedSymbolArray;for(let Te=0;Te<je.length;Te++){const He=je.get(Te);if(He.hidden)ln(He.numGlyphs,Ne);else{const Qe=Fe[Te];if(Qe)for(let at=0;at<He.numGlyphs;at++)l.aj(Ne,Qe.shiftedAnchor,Qe.angle);else ln(He.numGlyphs,Ne)}}k.icon.dynamicLayoutVertexBuffer.updateData(Ne)}k.text.dynamicLayoutVertexBuffer.updateData(Me)}function ls(k,n,f){return f.iconsInText&&n?"symbolTextAndIcon":k?"symbolSDF":"symbolIcon"}function Nl(k,n,f,_,y,w,R,D,z,q,H,X){const ne=k.context,me=ne.gl,Ie=k.transform,Me=is(),Ne=D==="map",Fe=z==="map",je=D!=="viewport"&&f.layout.get("symbol-placement")!=="point",Te=Ne&&!Fe&&!je,He=!Fe&&je,Qe=!f.layout.get("symbol-sort-key").isConstant();let at=!1;const wt=k.depthModeForSublayer(0,jn.ReadOnly),Dt=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Zt=[],Kt=Me.getCircleRadiusCorrection(Ie);for(const qt of _){const jt=n.getTile(qt),rn=jt.getBucket(f);if(!rn)continue;const Sn=y?rn.text:rn.icon;if(!Sn||!Sn.segments.get().length||!Sn.hasVisibleVertices)continue;const Vt=Sn.programConfigurations.get(f.id),Xt=y||rn.sdfIcons,wn=y?rn.textSizeData:rn.iconSizeData,Ai=Fe||Ie.pitch!==0,Bn=k.useProgram(ls(Xt,y,rn),Vt),Vn=l.ag(wn,Ie.zoom),Ti=k.style.map.terrain&&k.style.map.terrain.getTerrainData(qt);let Or,Xs,Ci,cs,Yr=[0,0],Br=null;if(y)Xs=jt.glyphAtlasTexture,Ci=me.LINEAR,Or=jt.glyphAtlasTexture.size,rn.iconsInText&&(Yr=jt.imageAtlasTexture.size,Br=jt.imageAtlasTexture,cs=Ai||k.options.rotating||k.options.zooming||wn.kind==="composite"||wn.kind==="camera"?me.LINEAR:me.NEAREST);else{const Xn=f.layout.get("icon-size").constantOr(0)!==1||rn.iconsNeedLinear;Xs=jt.imageAtlasTexture,Ci=Xt||k.options.rotating||k.options.zooming||Xn||Ai?me.LINEAR:me.NEAREST,Or=jt.imageAtlasTexture.size}const Jr=Un(jt,1,k.transform.zoom),ho=He?qt.posMatrix:Zo,rl=er(ho,Fe,Ne,k.transform,Jr),Eu=Kr(ho,Fe,Ne,k.transform,Jr),sl=Kr(qt.posMatrix,Fe,Ne,k.transform,Jr),Fs=Me.translatePosition(k.transform,jt,w,R),Au=Dt&&rn.hasTextData(),Vc=f.layout.get("icon-text-fit")!=="none"&&Au&&rn.hasIconData();if(je){const Xn=k.style.map.terrain?(ol,al)=>k.style.map.terrain.getElevation(qt,ol,al):null,Ia=f.layout.get("text-rotation-alignment")==="map";ce(rn,qt.posMatrix,k,y,rl,sl,Fe,q,Ia,Me,qt.toUnwrapped(),Ie.width,Ie.height,Fs,Xn)}const Os=qt.posMatrix,Bs=y&&Dt||Vc,Qo=je||Bs?Zo:rl,Ws=Eu,Pr=Xt&&f.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ur;Ur=Xt?rn.iconsInText?fr(wn.kind,Vn,Te,Fe,je,Bs,k,Os,Qo,Ws,Fs,Or,Yr,Kt):Uo(wn.kind,Vn,Te,Fe,je,Bs,k,Os,Qo,Ws,Fs,y,Or,!0,Kt):Bo(wn.kind,Vn,Te,Fe,je,Bs,k,Os,Qo,Ws,Fs,y,Or,Kt);const Es={program:Bn,buffers:Sn,uniformValues:Ur,atlasTexture:Xs,atlasTextureIcon:Br,atlasInterpolation:Ci,atlasInterpolationIcon:cs,isSDF:Xt,hasHalo:Pr};if(Qe&&rn.canOverlap){at=!0;const Xn=Sn.segments.get();for(const Ia of Xn)Zt.push({segments:new l.a0([Ia]),sortKey:Ia.sortKey,state:Es,terrainData:Ti})}else Zt.push({segments:Sn.segments,sortKey:0,state:Es,terrainData:Ti})}at&&Zt.sort((qt,jt)=>qt.sortKey-jt.sortKey);for(const qt of Zt){const jt=qt.state;if(ne.activeTexture.set(me.TEXTURE0),jt.atlasTexture.bind(jt.atlasInterpolation,me.CLAMP_TO_EDGE),jt.atlasTextureIcon&&(ne.activeTexture.set(me.TEXTURE1),jt.atlasTextureIcon&&jt.atlasTextureIcon.bind(jt.atlasInterpolationIcon,me.CLAMP_TO_EDGE)),jt.isSDF){const rn=jt.uniformValues;jt.hasHalo&&(rn.u_is_halo=1,zl(jt.buffers,qt.segments,f,k,jt.program,wt,H,X,rn,qt.terrainData)),rn.u_is_halo=0}zl(jt.buffers,qt.segments,f,k,jt.program,wt,H,X,jt.uniformValues,qt.terrainData)}}function zl(k,n,f,_,y,w,R,D,z,q){const H=_.context;y.draw(H,H.gl.TRIANGLES,w,R,D,hi.disabled,z,q,f.id,k.layoutVertexBuffer,k.indexBuffer,n,f.paint,_.transform.zoom,k.programConfigurations.get(f.id),k.dynamicLayoutVertexBuffer,k.opacityVertexBuffer)}function Fl(k,n,f,_){const y=k.context,w=y.gl,R=mi.disabled,D=new Fi([w.ONE,w.ONE],l.aM.transparent,[!0,!0,!0,!0]),z=n.getBucket(f);if(!z)return;const q=_.key;let H=f.heatmapFbos.get(q);H||(H=Xo(y,n.tileSize,n.tileSize),f.heatmapFbos.set(q,H)),y.bindFramebuffer.set(H.framebuffer),y.viewport.set([0,0,n.tileSize,n.tileSize]),y.clear({color:l.aM.transparent});const X=z.programConfigurations.get(f.id),ne=k.useProgram("heatmap",X),me=k.style.map.terrain.getTerrainData(_);ne.draw(y,w.TRIANGLES,jn.disabled,R,D,hi.disabled,hr(_.posMatrix,n,k.transform.zoom,f.paint.get("heatmap-intensity")),me,f.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,f.paint,k.transform.zoom,X)}function ao(k,n,f){const _=k.context,y=_.gl;_.setColorMode(k.colorModeForRenderPass());const w=Wo(_,n),R=f.key,D=n.heatmapFbos.get(R);D&&(_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,D.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1),w.bind(y.LINEAR,y.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(_,y.TRIANGLES,jn.disabled,mi.disabled,k.colorModeForRenderPass(),hi.disabled,Ua(k,n,0,1),null,n.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments,n.paint,k.transform.zoom),D.destroy(),n.heatmapFbos.delete(R))}function Xo(k,n,f){var _,y;const w=k.gl,R=w.createTexture();w.bindTexture(w.TEXTURE_2D,R),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const D=(_=k.HALF_FLOAT)!==null&&_!==void 0?_:w.UNSIGNED_BYTE,z=(y=k.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,z,n,f,0,w.RGBA,D,null);const q=k.createFramebuffer(n,f,!1,!1);return q.colorAttachment.set(R),q}function Wo(k,n){return n.colorRampTexture||(n.colorRampTexture=new we(k,n.colorRamp,k.gl.RGBA)),n.colorRampTexture}function Ko(k,n,f,_,y){if(!f||!_||!_.imageAtlas)return;const w=_.imageAtlas.patternPositions;let R=w[f.to.toString()],D=w[f.from.toString()];if(!R&&D&&(R=D),!D&&R&&(D=R),!R||!D){const z=y.getPaintProperty(n);R=w[z],D=w[z]}R&&D&&k.setConstantPatternPositions(R,D)}function $o(k,n,f,_,y,w,R){const D=k.context.gl,z="fill-pattern",q=f.paint.get(z),H=q&&q.constantOr(1),X=f.getCrossfadeParameters();let ne,me,Ie,Me,Ne;R?(me=H&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=D.LINES):(me=H?"fillPattern":"fill",ne=D.TRIANGLES);const Fe=q.constantOr(null);for(const je of _){const Te=n.getTile(je);if(H&&!Te.patternsLoaded())continue;const He=Te.getBucket(f);if(!He)continue;const Qe=He.programConfigurations.get(f.id),at=k.useProgram(me,Qe),wt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(je);H&&(k.context.activeTexture.set(D.TEXTURE0),Te.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Qe.updatePaintBuffers(X)),Ko(Qe,z,Fe,Te,f);const Dt=wt?je:null,Zt=k.translatePosMatrix(Dt?Dt.posMatrix:je.posMatrix,Te,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){Me=He.indexBuffer2,Ne=He.segments2;const Kt=[D.drawingBufferWidth,D.drawingBufferHeight];Ie=me==="fillOutlinePattern"&&H?so(Zt,k,X,Te,Kt):Si(Zt,Kt)}else Me=He.indexBuffer,Ne=He.segments,Ie=H?Ba(Zt,k,X,Te):Fo(Zt);at.draw(k.context,ne,y,k.stencilModeForClipping(je),w,hi.disabled,Ie,wt,f.id,He.layoutVertexBuffer,Me,Ne,f.paint,k.transform.zoom,Qe)}}function Yo(k,n,f,_,y,w,R){const D=k.context,z=D.gl,q="fill-extrusion-pattern",H=f.paint.get(q),X=H.constantOr(1),ne=f.getCrossfadeParameters(),me=f.paint.get("fill-extrusion-opacity"),Ie=H.constantOr(null);for(const Me of _){const Ne=n.getTile(Me),Fe=Ne.getBucket(f);if(!Fe)continue;const je=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Me),Te=Fe.programConfigurations.get(f.id),He=k.useProgram(X?"fillExtrusionPattern":"fillExtrusion",Te);X&&(k.context.activeTexture.set(z.TEXTURE0),Ne.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Te.updatePaintBuffers(ne)),Ko(Te,q,Ie,Ne,f);const Qe=k.translatePosMatrix(Me.posMatrix,Ne,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),at=f.paint.get("fill-extrusion-vertical-gradient"),wt=X?da(Qe,k,at,me,Me,ne,Ne):fa(Qe,k,at,me);He.draw(D,D.gl.TRIANGLES,y,w,R,hi.backCCW,wt,je,f.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,f.paint,k.transform.zoom,Te,k.style.map.terrain&&Fe.centroidVertexBuffer)}}function Jo(k,n,f,_,y,w,R){const D=k.context,z=D.gl,q=f.fbo;if(!q)return;const H=k.useProgram("hillshade"),X=k.style.map.terrain&&k.style.map.terrain.getTerrainData(n);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,q.colorAttachment.get()),H.draw(D,z.TRIANGLES,y,w,R,hi.disabled,((ne,me,Ie,Me)=>{const Ne=Ie.paint.get("hillshade-shadow-color"),Fe=Ie.paint.get("hillshade-highlight-color"),je=Ie.paint.get("hillshade-accent-color");let Te=Ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=ne.transform.angle);const He=!ne.options.moving;return{u_matrix:Me?Me.posMatrix:ne.transform.calculatePosMatrix(me.tileID.toUnwrapped(),He),u_image:0,u_latrange:ja(0,me.tileID),u_light:[Ie.paint.get("hillshade-exaggeration"),Te],u_shadow:Ne,u_highlight:Fe,u_accent:je}})(k,f,_,X?n:null),X,_.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}function Ao(k,n,f,_,y,w){const R=k.context,D=R.gl,z=n.dem;if(z&&z.data){const q=z.dim,H=z.stride,X=z.getPixels();if(R.activeTexture.set(D.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||k.getTileTexture(H),n.demTexture){const me=n.demTexture;me.update(X,{premultiply:!1}),me.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else n.demTexture=new we(R,X,D.RGBA,{premultiply:!1}),n.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);R.activeTexture.set(D.TEXTURE0);let ne=n.fbo;if(!ne){const me=new we(R,{width:q,height:q,data:null},D.RGBA);me.bind(D.LINEAR,D.CLAMP_TO_EDGE),ne=n.fbo=R.createFramebuffer(q,q,!0,!1),ne.colorAttachment.set(me.texture)}R.bindFramebuffer.set(ne.framebuffer),R.viewport.set([0,0,q,q]),k.useProgram("hillshadePrepare").draw(R,D.TRIANGLES,_,y,w,hi.disabled,((me,Ie)=>{const Me=Ie.stride,Ne=l.H();return l.aP(Ne,0,l.X,-l.X,0,0,1),l.J(Ne,Ne,[0,-l.X,0]),{u_matrix:Ne,u_image:1,u_dimension:[Me,Me],u_zoom:me.overscaledZ,u_unpack:Ie.getUnpackVector()}})(n.tileID,z),null,f.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function Ol(k,n,f,_,y,w){const R=_.paint.get("raster-fade-duration");if(!w&&R>0){const D=C.now(),z=(D-k.timeAdded)/R,q=n?(D-n.timeAdded)/R:-1,H=f.getSource(),X=y.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ne=!n||Math.abs(n.tileID.overscaledZ-X)>Math.abs(k.tileID.overscaledZ-X),me=ne&&k.refreshedUponExpiration?1:l.ac(ne?z:1-q,0,1);return k.refreshedUponExpiration&&z>=1&&(k.refreshedUponExpiration=!1),n?{opacity:1,mix:1-me}:{opacity:me,mix:0}}return{opacity:1,mix:0}}const Bl=new l.aM(1,0,0,1),Qn=new l.aM(0,1,0,1),Zs=new l.aM(0,0,1,1),Sc=new l.aM(1,0,1,1),Ul=new l.aM(0,1,1,1);function dr(k,n,f,_){I(k,0,n+f/2,k.transform.width,f,_)}function ks(k,n,f,_){I(k,n-f/2,0,f,k.transform.height,_)}function I(k,n,f,_,y,w){const R=k.context,D=R.gl;D.enable(D.SCISSOR_TEST),D.scissor(n*k.pixelRatio,f*k.pixelRatio,_*k.pixelRatio,y*k.pixelRatio),R.clear({color:w}),D.disable(D.SCISSOR_TEST)}function c(k,n,f){const _=k.context,y=_.gl,w=f.posMatrix,R=k.useProgram("debug"),D=jn.disabled,z=mi.disabled,q=k.colorModeForRenderPass(),H="$debug",X=k.style.map.terrain&&k.style.map.terrain.getTerrainData(f);_.activeTexture.set(y.TEXTURE0);const ne=n.getTileByID(f.key).latestRawTileData,me=Math.floor((ne&&ne.byteLength||0)/1024),Ie=n.getTile(f).tileSize,Me=512/Math.min(Ie,512)*(f.overscaledZ/k.transform.zoom)*.5;let Ne=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ne+=` => ${f.overscaledZ}`),function(Fe,je){Fe.initDebugOverlayCanvas();const Te=Fe.debugOverlayCanvas,He=Fe.context.gl,Qe=Fe.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,Te.width,Te.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(je,5,5),Qe.strokeText(je,5,5),Fe.debugOverlayTexture.update(Te),Fe.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(k,`${Ne} ${me}kB`),R.draw(_,y.TRIANGLES,D,z,Fi.alphaBlended,hi.disabled,xr(w,l.aM.transparent,Me),null,H,k.debugBuffer,k.quadTriangleIndexBuffer,k.debugSegments),R.draw(_,y.LINE_STRIP,D,z,q,hi.disabled,xr(w,l.aM.red),X,H,k.debugBuffer,k.tileBorderIndexBuffer,k.debugSegments)}function d(k,n,f){const _=k.context,y=_.gl,w=k.colorModeForRenderPass(),R=new jn(y.LEQUAL,jn.ReadWrite,k.depthRangeFor3D),D=k.useProgram("terrain"),z=n.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,k.width,k.height]);for(const q of f){const H=k.renderToTexture.getTexture(q),X=n.getTerrainData(q.tileID);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,H.texture);const ne=k.transform.calculatePosMatrix(q.tileID.toUnwrapped()),me=n.getMeshFrameDelta(k.transform.zoom),Ie=k.transform.calculateFogMatrix(q.tileID.toUnwrapped()),Me=Al(ne,me,Ie,k.style.sky,k.transform.pitch);D.draw(_,y.TRIANGLES,R,mi.disabled,w,hi.backCCW,Me,X,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}class p{constructor(n,f,_){this.vertexBuffer=n,this.indexBuffer=f,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class b{constructor(n,f){this.context=new Ic(n),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=At.maxUnderzooming+At.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zo}resize(n,f,_){if(this.width=Math.floor(n*_),this.height=Math.floor(f*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const n=this.context,f=new l.aX;f.emplaceBack(0,0),f.emplaceBack(l.X,0),f.emplaceBack(0,l.X),f.emplaceBack(l.X,l.X),this.tileExtentBuffer=n.createVertexBuffer(f,ss.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const _=new l.aX;_.emplaceBack(0,0),_.emplaceBack(l.X,0),_.emplaceBack(0,l.X),_.emplaceBack(l.X,l.X),this.debugBuffer=n.createVertexBuffer(_,ss.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const y=new l.$;y.emplaceBack(0,0,0,0),y.emplaceBack(l.X,0,l.X,0),y.emplaceBack(0,l.X,0,l.X),y.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=n.createVertexBuffer(y,Fn.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const w=new l.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(w,ss.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const R=new l.aZ;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(R);const D=new l.aY;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(D);const z=this.context.gl;this.stencilClearMode=new mi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const n=this.context,f=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=l.H();l.aP(_,0,this.width,this.height,0,0,1),l.K(_,_,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,f.TRIANGLES,jn.disabled,this.stencilClearMode,Fi.disabled,hi.disabled,wi(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,f){if(this.currentStencilSource===n.source||!n.isTileClipped()||!f||!f.length)return;this.currentStencilSource=n.source;const _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(Fi.disabled),_.setDepthMode(jn.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of f){const D=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R);w.draw(_,y.TRIANGLES,jn.disabled,new mi({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),Fi.disabled,hi.disabled,wi(R.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,f=this.context.gl;return new mi({func:f.NOTEQUAL,mask:255},n,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(n){const f=this.context.gl;return new mi({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(n){const f=this.context.gl,_=n.sort((R,D)=>D.overscaledZ-R.overscaledZ),y=_[_.length-1].overscaledZ,w=_[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const R={};for(let D=0;D<w;D++)R[D+y]=new mi({func:f.GEQUAL,mask:255},D+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=w,[R,_]}return[{[y]:mi.disabled},_]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Fi([n.CONSTANT_COLOR,n.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fi.unblended:Fi.alphaBlended}depthModeForSublayer(n,f,_){if(!this.opaquePassEnabledForLayer())return jn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new jn(_||this.context.gl.LEQUAL,f,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,f){this.style=n,this.options=f,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(C.now()),this.imageManager.beginFrame();const _=this.style._order,y=this.style.sourceCaches,w={},R={},D={};for(const z in y){const q=y[z];q.used&&q.prepare(this.context),w[z]=q.getVisibleCoordinates(),R[z]=w[z].slice().reverse(),D[z]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of _){const q=this.style._layers[z];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const H=R[q.source];(q.type==="custom"||H.length)&&this.renderLayer(this,y[q.source],q,H)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,q){const H=z.context,X=H.gl,ne=((Fe,je,Te)=>({u_sky_color:Fe.properties.get("sky-color"),u_horizon_color:Fe.properties.get("horizon-color"),u_horizon:(je.height/2+je.getHorizon())*Te,u_sky_horizon_blend:Fe.properties.get("sky-horizon-blend")*je.height/2*Te}))(q,z.style.map.transform,z.pixelRatio),me=new jn(X.LEQUAL,jn.ReadWrite,[0,1]),Ie=mi.disabled,Me=z.colorModeForRenderPass(),Ne=z.useProgram("sky");if(!q.mesh){const Fe=new l.aX;Fe.emplaceBack(-1,-1),Fe.emplaceBack(1,-1),Fe.emplaceBack(1,1),Fe.emplaceBack(-1,1);const je=new l.aY;je.emplaceBack(0,1,2),je.emplaceBack(0,2,3),q.mesh=new p(H.createVertexBuffer(Fe,ss.members),H.createIndexBuffer(je),l.a0.simpleSegment(0,0,Fe.length,je.length))}Ne.draw(H,X.TRIANGLES,me,Ie,Me,hi.disabled,ne,void 0,"sky",q.mesh.vertexBuffer,q.mesh.indexBuffer,q.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],q=y[z.source],H=w[z.source];this._renderTileClippingMasks(z,H),this.renderLayer(this,q,z,H)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],q=y[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z))continue;const H=(z.type==="symbol"?D:R)[z.source];this._renderTileClippingMasks(z,w[z.source]),this.renderLayer(this,q,z,H)}if(this.options.showTileBoundaries){const z=function(q,H){let X=null;const ne=Object.values(q._layers).flatMap(Ne=>Ne.source&&!Ne.isHidden(H)?[q.sourceCaches[Ne.source]]:[]),me=ne.filter(Ne=>Ne.getSource().type==="vector"),Ie=ne.filter(Ne=>Ne.getSource().type!=="vector"),Me=Ne=>{(!X||X.getSource().maxzoom<Ne.getSource().maxzoom)&&(X=Ne)};return me.forEach(Ne=>Me(Ne)),X||Ie.forEach(Ne=>Me(Ne)),X}(this.style,this.transform.zoom);z&&function(q,H,X){for(let ne=0;ne<X.length;ne++)c(q,H,X[ne])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const q=z.transform.padding;dr(z,z.transform.height-(q.top||0),3,Bl),dr(z,q.bottom||0,3,Qn),ks(z,q.left||0,3,Zs),ks(z,z.transform.width-(q.right||0),3,Sc);const H=z.transform.centerPoint;(function(X,ne,me,Ie){I(X,ne-1,me-10,2,20,Ie),I(X,ne-10,me-1,20,2,Ie)})(z,H.x,z.transform.height-H.y,Ul)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=n?!l.a_(f,_):!l.a$(f,_)),y||(y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),y&&(l.b0(f,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,R){const D=w.context,z=D.gl,q=Fi.unblended,H=new jn(z.LEQUAL,jn.ReadWrite,[0,1]),X=R.getTerrainMesh(),ne=R.sourceCache.getRenderableTiles(),me=w.useProgram("terrainDepth");D.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1});for(const Ie of ne){const Me=R.getTerrainData(Ie.tileID),Ne={u_matrix:w.transform.calculatePosMatrix(Ie.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(w.transform.zoom)};me.draw(D,z.TRIANGLES,H,mi.disabled,q,hi.backCCW,Ne,Me,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,R){const D=w.context,z=D.gl,q=Fi.unblended,H=new jn(z.LEQUAL,jn.ReadWrite,[0,1]),X=R.getTerrainMesh(),ne=R.getCoordsTexture(),me=R.sourceCache.getRenderableTiles(),Ie=w.useProgram("terrainCoords");D.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1}),R.coordsIndex=[];for(const Me of me){const Ne=R.getTerrainData(Me.tileID);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ne.texture);const Fe={u_matrix:w.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(w.transform.zoom)};Ie.draw(D,z.TRIANGLES,H,mi.disabled,q,hi.backCCW,Fe,Ne,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),R.coordsIndex.push(Me.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(n,f,_,y){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(y||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(w,R,D,z,q){if(w.renderPass!=="translucent")return;const H=mi.disabled,X=w.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,me,Ie,Me,Ne,Fe,je,Te,He){const Qe=me.transform,at=is(),wt=Ne==="map",Dt=Fe==="map";for(const Zt of ne){const Kt=Me.getTile(Zt),qt=Kt.getBucket(Ie);if(!qt||!qt.text||!qt.text.segments.get().length)continue;const jt=l.ag(qt.textSizeData,Qe.zoom),rn=Un(Kt,1,me.transform.zoom),Sn=er(Zt.posMatrix,Dt,wt,me.transform,rn),Vt=Ie.layout.get("icon-text-fit")!=="none"&&qt.hasIconData();if(jt){const Xt=Math.pow(2,Qe.zoom-Kt.tileID.overscaledZ),wn=me.style.map.terrain?(Bn,Vn)=>me.style.map.terrain.getElevation(Zt,Bn,Vn):null,Ai=at.translatePosition(Qe,Kt,je,Te);Ho(qt,wt,Dt,He,Qe,Sn,Zt.posMatrix,Xt,jt,Vt,at,Ai,Zt.toUnwrapped(),wn)}}}(z,w,D,R,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),q),D.paint.get("icon-opacity").constantOr(1)!==0&&Nl(w,R,D,z,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),H,X),D.paint.get("text-opacity").constantOr(1)!==0&&Nl(w,R,D,z,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),H,X),R.map.showCollisionBoxes&&(ba(w,R,D,z,!0),ba(w,R,D,z,!1))})(n,f,_,y,this.style.placement.variableOffsets);break;case"circle":(function(w,R,D,z){if(w.renderPass!=="translucent")return;const q=D.paint.get("circle-opacity"),H=D.paint.get("circle-stroke-width"),X=D.paint.get("circle-stroke-opacity"),ne=!D.layout.get("circle-sort-key").isConstant();if(q.constantOr(1)===0&&(H.constantOr(1)===0||X.constantOr(1)===0))return;const me=w.context,Ie=me.gl,Me=w.depthModeForSublayer(0,jn.ReadOnly),Ne=mi.disabled,Fe=w.colorModeForRenderPass(),je=[];for(let Te=0;Te<z.length;Te++){const He=z[Te],Qe=R.getTile(He),at=Qe.getBucket(D);if(!at)continue;const wt=at.programConfigurations.get(D.id),Dt=w.useProgram("circle",wt),Zt=at.layoutVertexBuffer,Kt=at.indexBuffer,qt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(He),jt={programConfiguration:wt,program:Dt,layoutVertexBuffer:Zt,indexBuffer:Kt,uniformValues:vc(w,He,Qe,D),terrainData:qt};if(ne){const rn=at.segments.get();for(const Sn of rn)je.push({segments:new l.a0([Sn]),sortKey:Sn.sortKey,state:jt})}else je.push({segments:at.segments,sortKey:0,state:jt})}ne&&je.sort((Te,He)=>Te.sortKey-He.sortKey);for(const Te of je){const{programConfiguration:He,program:Qe,layoutVertexBuffer:at,indexBuffer:wt,uniformValues:Dt,terrainData:Zt}=Te.state;Qe.draw(me,Ie.TRIANGLES,Me,Ne,Fe,hi.disabled,Dt,Zt,D.id,at,wt,Te.segments,D.paint,w.transform.zoom,He)}})(n,f,_,y);break;case"heatmap":(function(w,R,D,z){if(D.paint.get("heatmap-opacity")===0)return;const q=w.context;if(w.style.map.terrain){for(const H of z){const X=R.getTile(H);R.hasRenderableParent(H)||(w.renderPass==="offscreen"?Fl(w,X,D,H):w.renderPass==="translucent"&&ao(w,D,H))}q.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(H,X,ne,me){const Ie=H.context,Me=Ie.gl,Ne=mi.disabled,Fe=new Fi([Me.ONE,Me.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(je,Te,He){const Qe=je.gl;je.activeTexture.set(Qe.TEXTURE1),je.viewport.set([0,0,Te.width/4,Te.height/4]);let at=He.heatmapFbos.get(l.aU);at?(Qe.bindTexture(Qe.TEXTURE_2D,at.colorAttachment.get()),je.bindFramebuffer.set(at.framebuffer)):(at=Xo(je,Te.width/4,Te.height/4),He.heatmapFbos.set(l.aU,at))})(Ie,H,ne),Ie.clear({color:l.aM.transparent});for(let je=0;je<me.length;je++){const Te=me[je];if(X.hasRenderableParent(Te))continue;const He=X.getTile(Te),Qe=He.getBucket(ne);if(!Qe)continue;const at=Qe.programConfigurations.get(ne.id),wt=H.useProgram("heatmap",at),{zoom:Dt}=H.transform;wt.draw(Ie,Me.TRIANGLES,jn.disabled,Ne,Fe,hi.disabled,hr(Te.posMatrix,He,Dt,ne.paint.get("heatmap-intensity")),null,ne.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,ne.paint,H.transform.zoom,at)}Ie.viewport.set([0,0,H.width,H.height])}(w,R,D,z):w.renderPass==="translucent"&&function(H,X){const ne=H.context,me=ne.gl;ne.setColorMode(H.colorModeForRenderPass());const Ie=X.heatmapFbos.get(l.aU);Ie&&(ne.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Ie.colorAttachment.get()),ne.activeTexture.set(me.TEXTURE1),Wo(ne,X).bind(me.LINEAR,me.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(ne,me.TRIANGLES,jn.disabled,mi.disabled,H.colorModeForRenderPass(),hi.disabled,Ua(H,X,0,1),null,X.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,X.paint,H.transform.zoom))}(w,D)})(n,f,_,y);break;case"line":(function(w,R,D,z){if(w.renderPass!=="translucent")return;const q=D.paint.get("line-opacity"),H=D.paint.get("line-width");if(q.constantOr(1)===0||H.constantOr(1)===0)return;const X=w.depthModeForSublayer(0,jn.ReadOnly),ne=w.colorModeForRenderPass(),me=D.paint.get("line-dasharray"),Ie=D.paint.get("line-pattern"),Me=Ie.constantOr(1),Ne=D.paint.get("line-gradient"),Fe=D.getCrossfadeParameters(),je=Me?"linePattern":me?"lineSDF":Ne?"lineGradient":"line",Te=w.context,He=Te.gl;let Qe=!0;for(const at of z){const wt=R.getTile(at);if(Me&&!wt.patternsLoaded())continue;const Dt=wt.getBucket(D);if(!Dt)continue;const Zt=Dt.programConfigurations.get(D.id),Kt=w.context.program.get(),qt=w.useProgram(je,Zt),jt=Qe||qt.program!==Kt,rn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(at),Sn=Ie.constantOr(null);if(Sn&&wt.imageAtlas){const wn=wt.imageAtlas,Ai=wn.patternPositions[Sn.to.toString()],Bn=wn.patternPositions[Sn.from.toString()];Ai&&Bn&&Zt.setConstantPatternPositions(Ai,Bn)}const Vt=rn?at:null,Xt=Me?Oo(w,wt,D,Fe,Vt):me?lu(w,wt,D,me,Fe,Vt):Ne?ma(w,wt,D,Dt.lineClipsArray.length,Vt):pa(w,wt,D,Vt);if(Me)Te.activeTexture.set(He.TEXTURE0),wt.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Fe);else if(me&&(jt||w.lineAtlas.dirty))Te.activeTexture.set(He.TEXTURE0),w.lineAtlas.bind(Te);else if(Ne){const wn=Dt.gradients[D.id];let Ai=wn.texture;if(D.gradientVersion!==wn.version){let Bn=256;if(D.stepInterpolant){const Vn=R.getSource().maxzoom,Ti=at.canonical.z===Vn?Math.ceil(1<<w.transform.maxZoom-at.canonical.z):1;Bn=l.ac(l.aV(Dt.maxLineLength/l.X*1024*Ti),256,Te.maxTextureSize)}wn.gradient=l.aW({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Bn,image:wn.gradient||void 0,clips:Dt.lineClipsArray}),wn.texture?wn.texture.update(wn.gradient):wn.texture=new we(Te,wn.gradient,He.RGBA),wn.version=D.gradientVersion,Ai=wn.texture}Te.activeTexture.set(He.TEXTURE0),Ai.bind(D.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}qt.draw(Te,He.TRIANGLES,X,w.stencilModeForClipping(at),ne,hi.disabled,Xt,rn,D.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,D.paint,w.transform.zoom,Zt,Dt.layoutVertexBuffer2),Qe=!1}})(n,f,_,y);break;case"fill":(function(w,R,D,z){const q=D.paint.get("fill-color"),H=D.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const X=w.colorModeForRenderPass(),ne=D.paint.get("fill-pattern"),me=w.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&q.constantOr(l.aM.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===me){const Ie=w.depthModeForSublayer(1,w.renderPass==="opaque"?jn.ReadWrite:jn.ReadOnly);$o(w,R,D,z,Ie,X,!1)}if(w.renderPass==="translucent"&&D.paint.get("fill-antialias")){const Ie=w.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,jn.ReadOnly);$o(w,R,D,z,Ie,X,!0)}})(n,f,_,y);break;case"fill-extrusion":(function(w,R,D,z){const q=D.paint.get("fill-extrusion-opacity");if(q!==0&&w.renderPass==="translucent"){const H=new jn(w.context.gl.LEQUAL,jn.ReadWrite,w.depthRangeFor3D);if(q!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Yo(w,R,D,z,H,mi.disabled,Fi.disabled),Yo(w,R,D,z,H,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const X=w.colorModeForRenderPass();Yo(w,R,D,z,H,mi.disabled,X)}}})(n,f,_,y);break;case"hillshade":(function(w,R,D,z){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const q=w.context,H=w.depthModeForSublayer(0,jn.ReadOnly),X=w.colorModeForRenderPass(),[ne,me]=w.renderPass==="translucent"?w.stencilConfigForOverlap(z):[{},z];for(const Ie of me){const Me=R.getTile(Ie);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&w.renderPass==="offscreen"?Ao(w,Me,D,H,mi.disabled,X):w.renderPass==="translucent"&&Jo(w,Ie,Me,D,H,ne[Ie.overscaledZ],X)}q.viewport.set([0,0,w.width,w.height])})(n,f,_,y);break;case"raster":(function(w,R,D,z){if(w.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!z.length)return;const q=w.context,H=q.gl,X=R.getSource(),ne=w.useProgram("raster"),me=w.colorModeForRenderPass(),[Ie,Me]=X instanceof ei?[{},z]:w.stencilConfigForOverlap(z),Ne=Me[Me.length-1].overscaledZ,Fe=!w.options.moving;for(const je of Me){const Te=w.depthModeForSublayer(je.overscaledZ-Ne,D.paint.get("raster-opacity")===1?jn.ReadWrite:jn.ReadOnly,H.LESS),He=R.getTile(je);He.registerFadeDuration(D.paint.get("raster-fade-duration"));const Qe=R.findLoadedParent(je,0),at=R.findLoadedSibling(je),wt=Ol(He,Qe||at||null,R,D,w.transform,w.style.map.terrain);let Dt,Zt;const Kt=D.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;q.activeTexture.set(H.TEXTURE0),He.texture.bind(Kt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(H.TEXTURE1),Qe?(Qe.texture.bind(Kt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Dt=Math.pow(2,Qe.tileID.overscaledZ-He.tileID.overscaledZ),Zt=[He.tileID.canonical.x*Dt%1,He.tileID.canonical.y*Dt%1]):He.texture.bind(Kt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),He.texture.useMipmap&&q.extTextureFilterAnisotropic&&w.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const qt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(je),jt=qt?je:null,rn=jt?jt.posMatrix:w.transform.calculatePosMatrix(je.toUnwrapped(),Fe),Sn=Tl(rn,Zt||[0,0],Dt||1,wt,D);X instanceof ei?ne.draw(q,H.TRIANGLES,Te,mi.disabled,me,hi.disabled,Sn,qt,D.id,X.boundsBuffer,w.quadTriangleIndexBuffer,X.boundsSegments):ne.draw(q,H.TRIANGLES,Te,Ie[je.overscaledZ],me,hi.disabled,Sn,qt,D.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(n,f,_,y);break;case"background":(function(w,R,D,z){const q=D.paint.get("background-color"),H=D.paint.get("background-opacity");if(H===0)return;const X=w.context,ne=X.gl,me=w.transform,Ie=me.tileSize,Me=D.paint.get("background-pattern");if(w.isPatternMissing(Me))return;const Ne=!Me&&q.a===1&&H===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Ne)return;const Fe=mi.disabled,je=w.depthModeForSublayer(0,Ne==="opaque"?jn.ReadWrite:jn.ReadOnly),Te=w.colorModeForRenderPass(),He=w.useProgram(Me?"backgroundPattern":"background"),Qe=z||me.coveringTiles({tileSize:Ie,terrain:w.style.map.terrain});Me&&(X.activeTexture.set(ne.TEXTURE0),w.imageManager.bind(w.context));const at=D.getCrossfadeParameters();for(const wt of Qe){const Dt=z?wt.posMatrix:w.transform.calculatePosMatrix(wt.toUnwrapped()),Zt=Me?_a(Dt,H,w,Me,{tileID:wt,tileSize:Ie},at):ga(Dt,H,q),Kt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(wt);He.draw(X,ne.TRIANGLES,je,Fe,Te,hi.disabled,Zt,Kt,D.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(n,0,_,y);break;case"custom":(function(w,R,D){const z=w.context,q=D.implementation;if(w.renderPass==="offscreen"){const H=q.prerender;H&&(w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),H.call(q,z.gl,w.transform.customLayerMatrix()),z.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),z.setStencilMode(mi.disabled);const H=q.renderingMode==="3d"?new jn(w.context.gl.LEQUAL,jn.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,jn.ReadOnly);z.setDepthMode(H),q.render(z.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),z.setDirty(),w.setBaseState(),z.bindFramebuffer.set(null)}})(n,0,_)}}translatePosMatrix(n,f,_,y,w){if(!_[0]&&!_[1])return n;const R=w?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(R){const q=Math.sin(R),H=Math.cos(R);_=[_[0]*H-_[1]*q,_[0]*q+_[1]*H]}const D=[w?_[0]:Un(f,_[0],this.transform.zoom),w?_[1]:Un(f,_[1],this.transform.zoom),0],z=new Float32Array(16);return l.J(z,n,D),z}saveTileTexture(n){const f=this._tileTextures[n.size[0]];f?f.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const f=this._tileTextures[n];return f&&f.length>0?f.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const f=this.imageManager.getPattern(n.from.toString()),_=this.imageManager.getPattern(n.to.toString());return!f||!_}useProgram(n,f){this.cache=this.cache||{};const _=n+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new ko(this.context,ro[n],f,qa[n],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:f}=this.context.gl;return this.width!==n||this.height!==f}}class L{constructor(n,f){this.points=n,this.planes=f}static fromInvProjectionMatrix(n,f,_){const y=Math.pow(2,_),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const z=1/(D=l.af([],D,n))[3]/f*y;return l.b1(D,D,[z,z,1/D[3],z])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const z=function(ne,me){var Ie=me[0],Me=me[1],Ne=me[2],Fe=Ie*Ie+Me*Me+Ne*Ne;return Fe>0&&(Fe=1/Math.sqrt(Fe)),ne[0]=me[0]*Fe,ne[1]=me[1]*Fe,ne[2]=me[2]*Fe,ne}([],function(ne,me,Ie){var Me=me[0],Ne=me[1],Fe=me[2],je=Ie[0],Te=Ie[1],He=Ie[2];return ne[0]=Ne*He-Fe*Te,ne[1]=Fe*je-Me*He,ne[2]=Me*Te-Ne*je,ne}([],ye([],w[D[0]],w[D[1]]),ye([],w[D[2]],w[D[1]]))),q=-((H=z)[0]*(X=w[D[1]])[0]+H[1]*X[1]+H[2]*X[2]);var H,X;return z.concat(q)});return new L(w,R)}}class O{constructor(n,f){this.min=n,this.max=f,this.center=function(_,y,w){return _[0]=.5*y[0],_[1]=.5*y[1],_[2]=.5*y[2],_}([],function(_,y,w){return _[0]=y[0]+w[0],_[1]=y[1]+w[1],_[2]=y[2]+w[2],_}([],this.min,this.max))}quadrant(n){const f=[n%2==0,n<2],_=xe(this.min),y=xe(this.max);for(let w=0;w<f.length;w++)_[w]=f[w]?this.min[w]:this.center[w],y[w]=f[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new O(_,y)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersects(n){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let y=0;y<n.planes.length;y++){const w=n.planes[y];let R=0;for(let D=0;D<f.length;D++)l.b2(w,f[D])>=0&&R++;if(R===0)return 0;R!==f.length&&(_=!1)}if(_)return 2;for(let y=0;y<3;y++){let w=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let D=0;D<n.points.length;D++){const z=n.points[D][y]-this.min[y];w=Math.min(w,z),R=Math.max(R,z)}if(R<0||w>this.max[y]-this.min[y])return 0}return 1}}class V{constructor(n=0,f=0,_=0,y=0){if(isNaN(n)||n<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=f,this.left=_,this.right=y}interpolate(n,f,_){return f.top!=null&&n.top!=null&&(this.top=l.y.number(n.top,f.top,_)),f.bottom!=null&&n.bottom!=null&&(this.bottom=l.y.number(n.bottom,f.bottom,_)),f.left!=null&&n.left!=null&&(this.left=l.y.number(n.left,f.left,_)),f.right!=null&&n.right!=null&&(this.right=l.y.number(n.right,f.right,_)),this}getCenter(n,f){const _=l.ac((this.left+n-this.right)/2,0,n),y=l.ac((this.top+f-this.bottom)/2,0,f);return new l.P(_,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new V(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const K=85.051129;class pe{constructor(n,f,_,y,w){this.tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=n||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new V,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const n=new pe(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.apply(this),n}apply(n){this.tileSize=n.tileSize,this.latRange=n.latRange,this.lngRange=n.lngRange,this.width=n.width,this.height=n.height,this._center=n._center,this._elevation=n._elevation,this.minElevationForCurrentTile=n.minElevationForCurrentTile,this.zoom=n.zoom,this.angle=n.angle,this._fov=n._fov,this._pitch=n._pitch,this._unmodified=n._unmodified,this._edgeInsets=n._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(n){const f=-l.b3(n,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var _=new l.A(4);return l.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,y,w){var R=y[0],D=y[1],z=y[2],q=y[3],H=Math.sin(w),X=Math.cos(w);_[0]=R*X+z*H,_[1]=D*X+q*H,_[2]=R*-H+z*X,_[3]=D*-H+q*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const f=l.ac(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(n){const f=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,f,_){this._unmodified=!1,this._edgeInsets.interpolate(n,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const f=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(n){const f=[new l.b4(0,n)];if(this._renderWorldCopies){const _=this.pointCoordinate(new l.P(0,0)),y=this.pointCoordinate(new l.P(this.width,0)),w=this.pointCoordinate(new l.P(this.width,this.height)),R=this.pointCoordinate(new l.P(0,this.height)),D=Math.floor(Math.min(_.x,y.x,w.x,R.x)),z=Math.floor(Math.max(_.x,y.x,w.x,R.x)),q=1;for(let H=D-q;H<=z+q;H++)H!==0&&f.push(new l.b4(H,n))}return f}coveringTiles(n){var f,_;let y=this.coveringZoomLevel(n);const w=y;if(n.minzoom!==void 0&&y<n.minzoom)return[];n.maxzoom!==void 0&&y>n.maxzoom&&(y=n.maxzoom);const R=this.pointCoordinate(this.getCameraPoint()),D=l.Z.fromLngLat(this.center),z=Math.pow(2,y),q=[z*R.x,z*R.y,0],H=[z*D.x,z*D.y,0],X=L.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,y);let ne=n.minzoom||0;!n.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=y);const me=n.terrain?2/Math.min(this.tileSize,n.tileSize)*this.tileSize:3,Ie=Te=>({aabb:new O([Te*z,0,0],[(Te+1)*z,z,0]),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),Me=[],Ne=[],Fe=y,je=n.reparseOverscaled?w:y;if(this._renderWorldCopies)for(let Te=1;Te<=3;Te++)Me.push(Ie(-Te)),Me.push(Ie(Te));for(Me.push(Ie(0));Me.length>0;){const Te=Me.pop(),He=Te.x,Qe=Te.y;let at=Te.fullyVisible;if(!at){const qt=Te.aabb.intersects(X);if(qt===0)continue;at=qt===2}const wt=n.terrain?q:H,Dt=Te.aabb.distanceX(wt),Zt=Te.aabb.distanceY(wt),Kt=Math.max(Math.abs(Dt),Math.abs(Zt));if(Te.zoom===Fe||Kt>me+(1<<Fe-Te.zoom)-2&&Te.zoom>=ne){const qt=Fe-Te.zoom,jt=q[0]-.5-(He<<qt),rn=q[1]-.5-(Qe<<qt);Ne.push({tileID:new l.S(Te.zoom===Fe?je:Te.zoom,Te.wrap,Te.zoom,He,Qe),distanceSq:be([H[0]-.5-He,H[1]-.5-Qe]),tileDistanceToCamera:Math.sqrt(jt*jt+rn*rn)})}else for(let qt=0;qt<4;qt++){const jt=(He<<1)+qt%2,rn=(Qe<<1)+(qt>>1),Sn=Te.zoom+1;let Vt=Te.aabb.quadrant(qt);if(n.terrain){const Xt=new l.S(Sn,Te.wrap,Sn,jt,rn),wn=n.terrain.getMinMaxElevation(Xt),Ai=(f=wn.minElevation)!==null&&f!==void 0?f:this.elevation,Bn=(_=wn.maxElevation)!==null&&_!==void 0?_:this.elevation;Vt=new O([Vt.min[0],Vt.min[1],Ai],[Vt.max[0],Vt.max[1],Bn])}Me.push({aabb:Vt,zoom:Sn,x:jt,y:rn,wrap:Te.wrap,fullyVisible:at})}}return Ne.sort((Te,He)=>Te.distanceSq-He.distanceSq).map(Te=>Te.tileID)}resize(n,f){this.width=n,this.height=f,this.pixelsToGLUnits=[2/n,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const f=l.ac(n.lat,-85.051129,K);return new l.P(l.O(n.lng)*this.worldSize,l.Q(f)*this.worldSize)}unproject(n){return new l.Z(n.x/this.worldSize,n.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(n){const f=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,y=this.pointLocation(this.centerPoint,n),w=n.getElevationForLngLatZoom(y,this.tileZoom);if(!(this.elevation-w))return;const R=_+f-w,D=Math.cos(this._pitch)*this.cameraToCenterDistance/R/l.b5(1,y.lat),z=this.scaleZoom(D/this.tileSize);this._elevation=w,this._center=y,this.zoom=z}setLocationAtPoint(n,f){const _=this.pointCoordinate(f),y=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(n),R=new l.Z(w.x-(_.x-y.x),w.y-(_.y-y.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(n,f){return f?this.coordinatePoint(this.locationCoordinate(n),f.getElevationForLngLatZoom(n,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(n))}pointLocation(n,f){return this.coordinateLocation(this.pointCoordinate(n,f))}locationCoordinate(n){return l.Z.fromLngLat(n)}coordinateLocation(n){return n&&n.toLngLat()}pointCoordinate(n,f){if(f){const ne=f.pointCoordinate(n);if(ne!=null)return ne}const _=[n.x,n.y,0,1],y=[n.x,n.y,1,1];l.af(_,_,this.pixelMatrixInverse),l.af(y,y,this.pixelMatrixInverse);const w=_[3],R=y[3],D=_[1]/w,z=y[1]/R,q=_[2]/w,H=y[2]/R,X=q===H?0:(0-q)/(H-q);return new l.Z(l.y.number(_[0]/w,y[0]/R,X)/this.worldSize,l.y.number(D,z,X)/this.worldSize)}coordinatePoint(n,f=0,_=this.pixelMatrix){const y=[n.x*this.worldSize,n.y*this.worldSize,f,1];return l.af(y,y,_),new l.P(y[0]/y[3],y[1]/y[3])}getBounds(){const n=Math.max(0,this.height/2-this.getHorizon());return new Ke().extend(this.pointLocation(new l.P(0,n))).extend(this.pointLocation(new l.P(this.width,n))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ke([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,K])}calculateTileMatrix(n){const f=n.canonical,_=this.worldSize/this.zoomScale(f.z),y=f.x+Math.pow(2,f.z)*n.wrap,w=l.an(new Float64Array(16));return l.J(w,w,[y*_,f.y*_,0]),l.K(w,w,[_/l.X,_/l.X,1]),w}calculatePosMatrix(n,f=!1){const _=n.key,y=f?this._alignedPosMatrixCache:this._posMatrixCache;if(y[_])return y[_];const w=this.calculateTileMatrix(n);return l.L(w,f?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,w),y[_]=new Float32Array(w),y[_]}calculateFogMatrix(n){const f=n.key,_=this._fogMatrixCache;if(_[f])return _[f];const y=this.calculateTileMatrix(n);return l.L(y,this.fogMatrix,y),_[f]=new Float32Array(y),_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(n,f){f=l.ac(+f,this.minZoom,this.maxZoom);const _={center:new l.N(n.lng,n.lat),zoom:f};let y=this.lngRange;if(!this._renderWorldCopies&&y===null){const Te=179.9999999999;y=[-Te,Te]}const w=this.tileSize*this.zoomScale(_.zoom);let R=0,D=w,z=0,q=w,H=0,X=0;const{x:ne,y:me}=this.size;if(this.latRange){const Te=this.latRange;R=l.Q(Te[1])*w,D=l.Q(Te[0])*w,D-R<me&&(H=me/(D-R))}y&&(z=l.b3(l.O(y[0])*w,0,w),q=l.b3(l.O(y[1])*w,0,w),q<z&&(q+=w),q-z<ne&&(X=ne/(q-z)));const{x:Ie,y:Me}=this.project.call({worldSize:w},n);let Ne,Fe;const je=Math.max(X||0,H||0);if(je){const Te=new l.P(X?(q+z)/2:Ie,H?(D+R)/2:Me);return _.center=this.unproject.call({worldSize:w},Te).wrap(),_.zoom+=this.scaleZoom(je),_}if(this.latRange){const Te=me/2;Me-Te<R&&(Fe=R+Te),Me+Te>D&&(Fe=D-Te)}if(y){const Te=(z+q)/2;let He=Ie;this._renderWorldCopies&&(He=l.b3(Ie,Te-w/2,Te+w/2));const Qe=ne/2;He-Qe<z&&(Ne=z+Qe),He+Qe>q&&(Ne=q-Qe)}if(Ne!==void 0||Fe!==void 0){const Te=new l.P(Ne??Ie,Fe??Me);_.center=this.unproject.call({worldSize:w},Te).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:f,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=_,this._unmodified=n,this._constraining=!1}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,f=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let y=l.an(new Float64Array(16));l.K(y,y,[this.width/2,-this.height/2,1]),l.J(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=l.an(new Float64Array(16)),l.K(y,y,[1,-1,1]),l.J(y,y,[-1,-1,0]),l.K(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),R=Math.min(this.elevation,this.minElevationForCurrentTile),D=w-R*this._pixelPerMeter/Math.cos(this._pitch),z=R<0?D:w,q=Math.PI/2+this._pitch,H=this._fov*(.5+n.y/this.height),X=Math.sin(H)*z/Math.sin(l.ac(Math.PI-q-H,.01,Math.PI-.01)),ne=this.getHorizon(),me=2*Math.atan(ne/this.cameraToCenterDistance)*(.5+n.y/(2*ne)),Ie=Math.sin(me)*z/Math.sin(l.ac(Math.PI-q-me,.01,Math.PI-.01)),Me=Math.min(X,Ie);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+z),this.nearZ=this.height/50,y=new Float64Array(16),l.b6(y,this._fov,this.width/this.height,this.nearZ,this.farZ),y[8]=2*-n.x/this.width,y[9]=2*n.y/this.height,this.projectionMatrix=l.ae(y),l.K(y,y,[1,-1,1]),l.J(y,y,[0,0,-this.cameraToCenterDistance]),l.b7(y,y,this._pitch),l.ad(y,y,this.angle),l.J(y,y,[-f,-_,0]),this.mercatorMatrix=l.K([],y,[this.worldSize,this.worldSize,this.worldSize]),l.K(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,y),l.J(y,y,[0,0,-this.elevation]),this.modelViewProjectionMatrix=y,this.invModelViewProjectionMatrix=l.as([],y),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,w,this.farZ),this.fogMatrix[8]=2*-n.x/this.width,this.fogMatrix[9]=2*n.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-f,-_,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,y);const Ne=this.width%2/2,Fe=this.height%2/2,je=Math.cos(this.angle),Te=Math.sin(this.angle),He=f-Math.round(f)+je*Ne+Te*Fe,Qe=_-Math.round(_)+je*Fe+Te*Ne,at=new Float64Array(y);if(l.J(at,at,[He>.5?He-1:He,Qe>.5?Qe-1:Qe,0]),this.alignedModelViewProjectionMatrix=at,y=l.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const n=this.pointCoordinate(new l.P(0,0)),f=[n.x*this.worldSize,n.y*this.worldSize,0,1];return l.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,n))}getCameraQueryGeometry(n){const f=this.getCameraPoint();if(n.length===1)return[n[0],f];{let _=f.x,y=f.y,w=f.x,R=f.y;for(const D of n)_=Math.min(_,D.x),y=Math.min(y,D.y),w=Math.max(w,D.x),R=Math.max(R,D.y);return[new l.P(_,y),new l.P(w,y),new l.P(w,R),new l.P(_,R),new l.P(_,y)]}}lngLatToCameraDepth(n,f){const _=this.locationCoordinate(n),y=[_.x*this.worldSize,_.y*this.worldSize,f,1];return l.af(y,y,this.modelViewProjectionMatrix),y[2]/y[3]}}function Be(k,n){let f,_=!1,y=null,w=null;const R=()=>{y=null,_&&(k.apply(w,f),y=setTimeout(R,n),_=!1)};return(...D)=>(_=!0,w=this,f=D,y||R(),y)}class $e{constructor(n){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let _;return f.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(_=y)}),(_&&_[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const _=f.join("/");let y=_;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${_}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let R=window.location.href.replace(/(#.+)?$/,w);R=R.replace("&&","&"),window.history.replaceState(window.history.state,null,R)},this._updateHash=Be(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(n){const f=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),R=Math.round(f.lng*w)/w,D=Math.round(f.lat*w)/w,z=this._map.getBearing(),q=this._map.getPitch();let H="";if(H+=n?`/${R}/${D}/${_}`:`${_}/${D}/${R}`,(z||q)&&(H+="/"+Math.round(10*z)/10),q&&(H+=`/${Math.round(q)}`),this._hashName){const X=this._hashName;let ne=!1;const me=window.location.hash.slice(1).split("&").map(Ie=>{const Me=Ie.split("=")[0];return Me===X?(ne=!0,`${Me}=${H}`):Ie}).filter(Ie=>Ie);return ne||me.push(`${X}=${H}`),`#${me.join("&")}`}return`#${H}`}}const gt={linearity:.3,easing:l.b8(0,0,.3,1)},Ft=l.e({deceleration:2500,maxSpeed:1400},gt),zt=l.e({deceleration:20,maxSpeed:1400},gt),gn=l.e({deceleration:1e3,maxSpeed:360},gt),vn=l.e({deceleration:1e3,maxSpeed:90},gt);class Ln{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:C.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,f=C.now();for(;n.length>0&&f-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)f.zoom+=w.zoomDelta||0,f.bearing+=w.bearingDelta||0,f.pitch+=w.pitchDelta||0,w.panDelta&&f.pan._add(w.panDelta),w.around&&(f.around=w.around),w.pinchAround&&(f.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(f.pan.mag()){const w=gi(f.pan.mag(),_,l.e({},Ft,n||{}));y.offset=f.pan.mult(w.amount/f.pan.mag()),y.center=this._map.transform.center,ii(y,w)}if(f.zoom){const w=gi(f.zoom,_,zt);y.zoom=this._map.transform.zoom+w.amount,ii(y,w)}if(f.bearing){const w=gi(f.bearing,_,gn);y.bearing=this._map.transform.bearing+l.ac(w.amount,-179,179),ii(y,w)}if(f.pitch){const w=gi(f.pitch,_,vn);y.pitch=this._map.transform.pitch+w.amount,ii(y,w)}if(y.zoom||y.bearing){const w=f.pinchAround===void 0?f.around:f.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),l.e(y,{noMoveStart:!0})}}function ii(k,n){(!k.duration||k.duration<n.duration)&&(k.duration=n.duration,k.easing=n.easing)}function gi(k,n,f){const{maxSpeed:_,linearity:y,deceleration:w}=f,R=l.ac(k*y/(n/1e3),-_,_),D=Math.abs(R)/(w*y);return{easing:f.easing,duration:1e3*D,amount:R*(D/2)}}class ui extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,f,_,y={}){const w=N.mousePos(f.getCanvas(),_),R=f.unproject(w);super(n,l.e({point:w,lngLat:R,originalEvent:_},y)),this._defaultPrevented=!1,this.target=f}}class nr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,f,_){const y=n==="touchend"?_.changedTouches:_.touches,w=N.touchPos(f.getCanvasContainer(),y),R=w.map(z=>f.unproject(z)),D=w.reduce((z,q,H,X)=>z.add(q.div(X.length)),new l.P(0,0));super(n,{points:w,point:D,lngLats:R,lngLat:f.unproject(D),originalEvent:_}),this._defaultPrevented=!1}}class us extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,f,_){super(n,{originalEvent:_}),this._defaultPrevented=!1}}class Ps{constructor(n,f){this._map=n,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new us(n.type,this._map,n))}mousedown(n,f){return this._mousedownPos=f,this._firePreventable(new ui(n.type,this._map,n))}mouseup(n){this._map.fire(new ui(n.type,this._map,n))}click(n,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ui(n.type,this._map,n))}dblclick(n){return this._firePreventable(new ui(n.type,this._map,n))}mouseover(n){this._map.fire(new ui(n.type,this._map,n))}mouseout(n){this._map.fire(new ui(n.type,this._map,n))}touchstart(n){return this._firePreventable(new nr(n.type,this._map,n))}touchmove(n){this._map.fire(new nr(n.type,this._map,n))}touchend(n){this._map.fire(new nr(n.type,this._map,n))}touchcancel(n){this._map.fire(new nr(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class di{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new ui(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ui("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new ui(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rr{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.pointLocation(l.P.convert(n),this._map.terrain)}}class pr{constructor(n,f){this._map=n,this._tr=new Rr(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,f){this.isEnabled()&&n.shiftKey&&n.button===0&&(N.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(n,f){if(!this._active)return;const _=f;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=_,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(y.x,_.x),R=Math.max(y.x,_.x),D=Math.min(y.y,_.y),z=Math.max(y.y,_.y);N.setTransform(this._box,`translate(${w}px,${D}px)`),this._box.style.width=R-w+"px",this._box.style.height=z-D+"px"}mouseupWindow(n,f){if(!this._active||n.button!==0)return;const _=this._startPos,y=f;if(this.reset(),N.suppressClick(),_.x!==y.x||_.y!==y.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:n})),{cameraAnimation:w=>w.fitScreenCoordinates(_,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,f){return this._map.fire(new l.k(n,{originalEvent:f}))}}function Ds(k,n){if(k.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${k.length}, points ${n.length}`);const f={};for(let _=0;_<k.length;_++)f[k[_].identifier]=n[_];return f}class Ya{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const w=new l.P(0,0);for(const R of y)w._add(R);return w.div(y.length)}(f),this.touches=Ds(_,f)))}touchmove(n,f,_){if(this.aborted||!this.centroid)return;const y=Ds(_,f);for(const w in this.touches){const R=y[w];(!R||R.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(n,f,_){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class xa{constructor(n){this.singleTap=new Ya(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,f,_){this.singleTap.touchstart(n,f,_)}touchmove(n,f,_){this.singleTap.touchmove(n,f,_)}touchend(n,f,_){const y=this.singleTap.touchend(n,f,_);if(y){const w=n.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(y)<30;if(w&&R||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class lo{constructor(n){this._tr=new Rr(n),this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,f,_){this._zoomIn.touchstart(n,f,_),this._zoomOut.touchstart(n,f,_)}touchmove(n,f,_){this._zoomIn.touchmove(n,f,_),this._zoomOut.touchmove(n,f,_)}touchend(n,f,_){const y=this._zoomIn.touchend(n,f,_),w=this._zoomOut.touchend(n,f,_),R=this._tr;return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:R.zoom+1,around:R.unproject(y)},{originalEvent:n})}):w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:R.zoom-1,around:R.unproject(w)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Is{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const f=this._moveFunction(...n);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(n,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,f){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const y=f.length?f[0]:f;return!this._moved&&y.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(_,y))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&N.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ec={0:1,2:2};class _u{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const f=N.mouseButton(n);this._eventButton=f}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!function(f,_){const y=Ec[_];return f.buttons===void 0||(f.buttons&y)!==y}(n,this._eventButton)}isValidEndEvent(n){return N.mouseButton(n)===this._eventButton}}class Ac{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}const yu=k=>{k.mousedown=k.dragStart,k.mousemoveWindow=k.dragMove,k.mouseup=k.dragEnd,k.contextmenu=n=>{n.preventDefault()}},Tc=({enable:k,clickTolerance:n,bearingDegreesPerPixelMoved:f=.8})=>{const _=new _u({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new Is({clickTolerance:n,move:(y,w)=>({bearingDelta:(w.x-y.x)*f}),moveStateManager:_,enable:k,assignEvents:yu})},Cc=({enable:k,clickTolerance:n,pitchDegreesPerPixelMoved:f=-.5})=>{const _=new _u({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new Is({clickTolerance:n,move:(y,w)=>({pitchDelta:(w.y-y.y)*f}),moveStateManager:_,enable:k,assignEvents:yu})};class wa{constructor(n,f){this._clickTolerance=n.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(n){return n<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(n,f,_){return this._calculateTransform(n,f,_)}touchmove(n,f,_){if(this._active){if(!this._shouldBePrevented(_.length))return n.preventDefault(),this._calculateTransform(n,f,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",n)}}touchend(n,f,_){this._calculateTransform(n,f,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,f,_){_.length>0&&(this._active=!0);const y=Ds(_,f),w=new l.P(0,0),R=new l.P(0,0);let D=0;for(const q in y){const H=y[q],X=this._touches[q];X&&(w._add(H),R._add(H.sub(X)),D++,y[q]=H)}if(this._touches=y,this._shouldBePrevented(D)||!R.mag())return;const z=R.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(D),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(n,f,_){if(!this._firstTwoTouches)return;n.preventDefault();const[y,w]=this._firstTwoTouches,R=jl(_,f,y),D=jl(_,f,w);if(!R||!D)return;const z=this._aroundCenter?null:R.add(D).div(2);return this._move([R,D],z,n)}touchend(n,f,_){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,R=jl(_,f,y),D=jl(_,f,w);R&&D||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function jl(k,n,f){for(let _=0;_<k.length;_++)if(k[_].identifier===f)return n[_]}function Lc(k,n){return Math.log(k/n)/Math.LN2}class Mc extends vu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,f){const _=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Lc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lc(this._distance,_),pinchAround:f}}}function Rc(k,n){return 180*k.angleWith(n)/Math.PI}class Pc extends vu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,f,_){const y=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rc(this._vector,y),pinchAround:f}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const f=25/(Math.PI*this._minDiameter)*360,_=Rc(n,this._startVector);return Math.abs(_)<f}}function bu(k){return Math.abs(k.y)>Math.abs(k.x)}class Ja extends vu{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,f,_){super.touchstart(n,f,_),this._currentTouchCount=_.length}_start(n){this._lastPoints=n,bu(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,f,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=n[0].sub(this._lastPoints[0]),w=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,_.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(n,f,_){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,w=f.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const R=n.y>0==f.y>0;return bu(n)&&bu(f)&&R}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class Ns{constructor(n){this._tr=new Rr(n);const f=Bh;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let f=0,_=0,y=0,w=0,R=0;switch(n.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:n.shiftKey?_=-1:(n.preventDefault(),w=-1);break;case 39:n.shiftKey?_=1:(n.preventDefault(),w=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),R=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:D=>{const z=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:f?Math.round(z.zoom)+f*(n.shiftKey?2:1):z.zoom,bearing:z.bearing+_*this._bearingStep,pitch:z.pitch+y*this._pitchStep,offset:[-w*this._panStep,-R*this._panStep],center:z.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(k){return k*(2-k)}const Dc=4.000244140625;class Hs{constructor(n,f){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=n,this._tr=new Rr(n),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(n){return!!this._map.cooperativeGestures.isEnabled()&&!(n.ctrlKey||this._map.cooperativeGestures.isBypassed(n))}wheel(n){if(!this.isEnabled())return;if(this._shouldBePrevented(n))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",n);let f=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const _=C.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%Dc==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),n.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=n,this._delta-=f,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=N.mousePos(this._map.getCanvas(),n),_=this._tr;this._around=f.y>_.transform.height/2-_.transform.getHorizon()?l.N.convert(this._aroundCenter?_.center:_.unproject(f)):l.N.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Dc?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&q!==0&&(q=1/q);const H=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(H*q))),this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:n.zoom,_=this._startZoom,y=this._easing;let w,R=!1;const D=C.now()-this._lastWheelEventTime;if(this._type==="wheel"&&_&&y&&D){const z=Math.min(D/200,1),q=y(z);w=l.y.number(_,f,q),z<1?this._frameId||(this._frameId=!0):R=!0}else w=f,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:w-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let f=l.b9;if(this._prevEase){const _=this._prevEase,y=(C.now()-_.start)/_.duration,w=_.easing(y+.01)-_.easing(y),R=.27/Math.sqrt(w*w+1e-4)*.01,D=Math.sqrt(.0729-R*R);f=l.b8(R,D,.25,1)}return this._prevEase={start:C.now(),duration:n,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ka{constructor(n,f){this._clickZoom=n,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class od{constructor(n){this._tr=new Rr(n),this.reset()}reset(){this._active=!1}dblclick(n,f){return n.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,f,_){if(!this._swipePoint)if(this._tapTime){const y=f[0],w=n.timeStamp-this._tapTime<500,R=this._tapPoint.dist(y)<30;w&&R?_.length>0&&(this._swipePoint=y,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(n,f,_)}touchmove(n,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=f[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(n,f,_)}touchend(n,f,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const y=this._tap.touchend(n,f,_);y&&(this._tapTime=n.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(n,f,_){this._el=n,this._mousePan=f,this._touchPan=_}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jh{constructor(n,f,_){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nc{constructor(n,f,_,y){this._el=n,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Qa{constructor(n,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",n);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=f,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=_,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(n){return n[this._bypassKey]}notifyGestureBlocked(n,f){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:n,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const zs=k=>k.zoom||k.drag||k.pitch||k.rotate;class Qt extends l.k{}function xu(k){return k.panDelta&&k.panDelta.mag()||k.zoomDelta||k.bearingDelta||k.pitchDelta}class zc{constructor(n,f){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const R=y.type==="renderFrame"?void 0:y,D={needsRenderFrame:!1},z={},q={},H=y.touches,X=H?this._getMapTouches(H):void 0,ne=X?N.touchPos(this._map.getCanvas(),X):N.mousePos(this._map.getCanvas(),y);for(const{handlerName:Me,handler:Ne,allowed:Fe}of this._handlers){if(!Ne.isEnabled())continue;let je;this._blockedByActive(q,Fe,Me)?Ne.reset():Ne[w||y.type]&&(je=Ne[w||y.type](y,ne,X),this.mergeHandlerResult(D,z,je,Me,R),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Ne.isActive())&&(q[Me]=Ne)}const me={};for(const Me in this._previousActiveHandlers)q[Me]||(me[Me]=R);this._previousActiveHandlers=q,(Object.keys(me).length||xu(D))&&(this._changes.push([D,z,me]),this._triggerRenderFrame()),(Object.keys(q).length||xu(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ie}=D;Ie&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ie(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ln(n),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,R]of this._listeners)N.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[n,f,_]of this._listeners)N.removeEventListener(n,f,n===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(n){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new Ps(f,n));const y=f.boxZoom=new pr(f,n);this._add("boxZoom",y),n.interactive&&n.boxZoom&&y.enable();const w=f.cooperativeGestures=new Qa(f,n.cooperativeGestures);this._add("cooperativeGestures",w),n.cooperativeGestures&&w.enable();const R=new lo(f),D=new od(f);f.doubleClickZoom=new ka(D,R),this._add("tapZoom",R),this._add("clickZoom",D),n.interactive&&n.doubleClickZoom&&f.doubleClickZoom.enable();const z=new ad;this._add("tapDragZoom",z);const q=f.touchPitch=new Ja(f);this._add("touchPitch",q),n.interactive&&n.touchPitch&&f.touchPitch.enable(n.touchPitch);const H=Tc(n),X=Cc(n);f.dragRotate=new jh(n,H,X),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]),n.interactive&&n.dragRotate&&f.dragRotate.enable();const ne=(({enable:je,clickTolerance:Te})=>{const He=new _u({checkCorrectEvent:Qe=>N.mouseButton(Qe)===0&&!Qe.ctrlKey});return new Is({clickTolerance:Te,move:(Qe,at)=>({around:at,panDelta:at.sub(Qe)}),activateOnStart:!0,moveStateManager:He,enable:je,assignEvents:yu})})(n),me=new wa(n,f);f.dragPan=new Uh(_,ne,me),this._add("mousePan",ne),this._add("touchPan",me,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&f.dragPan.enable(n.dragPan);const Ie=new Pc,Me=new Mc;f.touchZoomRotate=new Nc(_,Me,Ie,z),this._add("touchRotate",Ie,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&f.touchZoomRotate.enable(n.touchZoomRotate);const Ne=f.scrollZoom=new Hs(f,()=>this._triggerRenderFrame());this._add("scrollZoom",Ne,["mousePan"]),n.interactive&&n.scrollZoom&&f.scrollZoom.enable(n.scrollZoom);const Fe=f.keyboard=new Ns(f);this._add("keyboard",Fe),n.interactive&&n.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new di(f))}_add(n,f,_){this._handlers.push({handlerName:n,handler:f,allowed:_}),this._handlersById[n]=f}stop(n){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zs(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,f,_){for(const y in n)if(y!==_&&(!f||f.indexOf(y)<0))return!0;return!1}_getMapTouches(n){const f=[];for(const _ of n)this._el.contains(_.target)&&f.push(_);return f}mergeHandlerResult(n,f,_,y,w){if(!_)return;l.e(n,_);const R={handlerName:y,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(f.zoom=R),_.panDelta!==void 0&&(f.drag=R),_.pitchDelta!==void 0&&(f.pitch=R),_.bearingDelta!==void 0&&(f.rotate=R)}_applyChanges(){const n={},f={},_={};for(const[y,w,R]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new l.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),l.e(f,w),l.e(_,R);this._updateMapTransform(n,f,_),this._changes=[]}_updateMapTransform(n,f,_){const y=this._map,w=y._getTransformForUpdate(),R=y.terrain;if(!(xu(n)||R&&this._terrainMovement))return this._fireEvents(f,_,!0);let{panDelta:D,zoomDelta:z,bearingDelta:q,pitchDelta:H,around:X,pinchAround:ne}=n;ne!==void 0&&(X=ne),y._stop(!0),X=X||y.transform.centerPoint;const me=w.pointLocation(D?X.sub(D):X);q&&(w.bearing+=q),H&&(w.pitch+=H),z&&(w.zoom+=z),R?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(D)):w.setLocationAtPoint(me,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(me,X)):w.setLocationAtPoint(me,X),y._applyUpdatedTransform(w),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(f,_,!0)}_fireEvents(n,f,_){const y=zs(this._eventsInProgress),w=zs(n),R={};for(const X in n){const{originalEvent:ne}=n[X];this._eventsInProgress[X]||(R[`${X}start`]=ne),this._eventsInProgress[X]=n[X]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const X in R)this._fireEvent(X,R[X]);w&&this._fireEvent("move",w.originalEvent);for(const X in n){const{originalEvent:ne}=n[X];this._fireEvent(X,ne)}const D={};let z;for(const X in this._eventsInProgress){const{handlerName:ne,originalEvent:me}=this._eventsInProgress[X];this._handlersById[ne].isActive()||(delete this._eventsInProgress[X],z=f[ne]||me,D[`${X}end`]=z)}for(const X in D)this._fireEvent(X,D[X]);const q=zs(this._eventsInProgress),H=(y||w)&&!q;if(H&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();X.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(X)}if(_&&H){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!X||!X.essential&&C.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:z})),ne(this._map.getBearing())&&this._map.resetNorth()):(ne(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(n,f){this._map.fire(new l.k(n,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Qt("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class qh extends l.E{constructor(n,f){super(),this._renderFrameCallback=()=>{const _=Math.min((C.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(n,f){return this.jumpTo({center:n},f)}panBy(n,f,_){return n=l.P.convert(n).mult(-1),this.panTo(this.transform.center,l.e({offset:n},f),_)}panTo(n,f,_){return this.easeTo(l.e({center:n},f),_)}getZoom(){return this.transform.zoom}setZoom(n,f){return this.jumpTo({zoom:n},f),this}zoomTo(n,f,_){return this.easeTo(l.e({zoom:n},f),_)}zoomIn(n,f){return this.zoomTo(this.getZoom()+1,n,f),this}zoomOut(n,f){return this.zoomTo(this.getZoom()-1,n,f),this}getBearing(){return this.transform.bearing}setBearing(n,f){return this.jumpTo({bearing:n},f),this}getPadding(){return this.transform.padding}setPadding(n,f){return this.jumpTo({padding:n},f),this}rotateTo(n,f,_){return this.easeTo(l.e({bearing:n},f),_)}resetNorth(n,f){return this.rotateTo(0,l.e({duration:1e3},n),f),this}resetNorthPitch(n,f){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},n),f),this}snapToNorth(n,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,f):this}getPitch(){return this.transform.pitch}setPitch(n,f){return this.jumpTo({pitch:n},f),this}cameraForBounds(n,f){n=Ke.convert(n).adjustAntiMeridian();const _=f&&f.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),_,f)}_cameraForBoxAndBearing(n,f,_,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=l.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const qt=y.padding;y.padding={top:qt,bottom:qt,right:qt,left:qt}}y.padding=l.e(w,y.padding);const R=this.transform,D=R.padding,z=new Ke(n,f),q=R.project(z.getNorthWest()),H=R.project(z.getNorthEast()),X=R.project(z.getSouthEast()),ne=R.project(z.getSouthWest()),me=l.ba(-_),Ie=q.rotate(me),Me=H.rotate(me),Ne=X.rotate(me),Fe=ne.rotate(me),je=new l.P(Math.max(Ie.x,Me.x,Fe.x,Ne.x),Math.max(Ie.y,Me.y,Fe.y,Ne.y)),Te=new l.P(Math.min(Ie.x,Me.x,Fe.x,Ne.x),Math.min(Ie.y,Me.y,Fe.y,Ne.y)),He=je.sub(Te),Qe=(R.width-(D.left+D.right+y.padding.left+y.padding.right))/He.x,at=(R.height-(D.top+D.bottom+y.padding.top+y.padding.bottom))/He.y;if(at<0||Qe<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const wt=Math.min(R.scaleZoom(R.scale*Math.min(Qe,at)),y.maxZoom),Dt=l.P.convert(y.offset),Zt=new l.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(l.ba(_)),Kt=Dt.add(Zt).mult(R.scale/R.zoomScale(wt));return{center:R.unproject(q.add(X).div(2).sub(Kt)),zoom:wt,bearing:_}}fitBounds(n,f,_){return this._fitInternal(this.cameraForBounds(n,f),f,_)}fitScreenCoordinates(n,f,_,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(n)),this.transform.pointLocation(l.P.convert(f)),_,y),y,w)}_fitInternal(n,f,_){return n?(delete(f=l.e(n,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(n,f){this.stop();const _=this._getTransformForUpdate();let y=!1,w=!1,R=!1;return"zoom"in n&&_.zoom!==+n.zoom&&(y=!0,_.zoom=+n.zoom),n.center!==void 0&&(_.center=l.N.convert(n.center)),"bearing"in n&&_.bearing!==+n.bearing&&(w=!0,_.bearing=+n.bearing),"pitch"in n&&_.pitch!==+n.pitch&&(R=!0,_.pitch=+n.pitch),n.padding==null||_.isPaddingEqual(n.padding)||(_.padding=n.padding),this._applyUpdatedTransform(_),this.fire(new l.k("movestart",f)).fire(new l.k("move",f)),y&&this.fire(new l.k("zoomstart",f)).fire(new l.k("zoom",f)).fire(new l.k("zoomend",f)),w&&this.fire(new l.k("rotatestart",f)).fire(new l.k("rotate",f)).fire(new l.k("rotateend",f)),R&&this.fire(new l.k("pitchstart",f)).fire(new l.k("pitch",f)).fire(new l.k("pitchend",f)),this.fire(new l.k("moveend",f))}calculateCameraOptionsFromTo(n,f,_,y=0){const w=l.Z.fromLngLat(n,f),R=l.Z.fromLngLat(_,y),D=R.x-w.x,z=R.y-w.y,q=R.z-w.z,H=Math.hypot(D,z,q);if(H===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(D,z),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/H/this.transform.tileSize),me=180*Math.atan2(D,-z)/Math.PI;let Ie=180*Math.acos(X/H)/Math.PI;return Ie=q<0?90-Ie:90+Ie,{center:R.toLngLat(),zoom:ne,pitch:Ie,bearing:me}}easeTo(n,f){var _;this._stop(!1,n.easeId),((n=l.e({offset:[0,0],duration:500,easing:l.b9},n)).animate===!1||!n.essential&&C.prefersReducedMotion)&&(n.duration=0);const y=this._getTransformForUpdate(),w=y.zoom,R=y.bearing,D=y.pitch,z=y.padding,q="bearing"in n?this._normalizeBearing(n.bearing,R):R,H="pitch"in n?+n.pitch:D,X="padding"in n?n.padding:y.padding,ne=l.P.convert(n.offset);let me=y.centerPoint.add(ne);const Ie=y.pointLocation(me),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(n.center||Ie),(_=n.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const Fe=y.project(Ie),je=y.project(Me).sub(Fe),Te=y.zoomScale(Ne-w);let He,Qe;n.around&&(He=l.N.convert(n.around),Qe=y.locationPoint(He));const at={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ne!==w,this._rotating=this._rotating||R!==q,this._pitching=this._pitching||H!==D,this._padding=!y.isPaddingEqual(X),this._easeId=n.easeId,this._prepareEase(f,n.noMoveStart,at),this.terrain&&this._prepareElevation(Me),this._ease(wt=>{if(this._zooming&&(y.zoom=l.y.number(w,Ne,wt)),this._rotating&&(y.bearing=l.y.number(R,q,wt)),this._pitching&&(y.pitch=l.y.number(D,H,wt)),this._padding&&(y.interpolatePadding(z,X,wt),me=y.centerPoint.add(ne)),this.terrain&&!n.freezeElevation&&this._updateElevation(wt),He)y.setLocationAtPoint(He,Qe);else{const Dt=y.zoomScale(y.zoom-w),Zt=Ne>w?Math.min(2,Te):Math.max(.5,Te),Kt=Math.pow(Zt,1-wt),qt=y.unproject(Fe.add(je.mult(wt*Kt)).mult(Dt));y.setLocationAtPoint(y.renderWorldCopies?qt.wrap():qt,me)}this._applyUpdatedTransform(y),this._fireMoveEvents(f)},wt=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(f,wt)},n),this}_prepareEase(n,f,_={}){this._moving=!0,f||_.moving||this.fire(new l.k("movestart",n)),this._zooming&&!_.zooming&&this.fire(new l.k("zoomstart",n)),this._rotating&&!_.rotating&&this.fire(new l.k("rotatestart",n)),this._pitching&&!_.pitching&&this.fire(new l.k("pitchstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&f!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(_-(f-(_*n+this._elevationStart))/(1-n)),this._elevationTarget=f}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,n)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(n){const f=n.getCameraPosition(),_=this.terrain.getElevationForLngLatZoom(f.lngLat,n.zoom);if(f.altitude<_){const y=this.calculateCameraOptionsFromTo(f.lngLat,_,n.center,n.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(n){const f=[];if(this.terrain&&f.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&f.push(y=>this.transformCameraUpdate(y)),!f.length)return;const _=n.clone();for(const y of f){const w=_.clone(),{center:R,zoom:D,pitch:z,bearing:q,elevation:H}=y(w);R&&(w.center=R),D!==void 0&&(w.zoom=D),z!==void 0&&(w.pitch=z),q!==void 0&&(w.bearing=q),H!==void 0&&(w.elevation=H),_.apply(w)}this.transform.apply(_)}_fireMoveEvents(n){this.fire(new l.k("move",n)),this._zooming&&this.fire(new l.k("zoom",n)),this._rotating&&this.fire(new l.k("rotate",n)),this._pitching&&this.fire(new l.k("pitch",n))}_afterEase(n,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const _=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new l.k("zoomend",n)),y&&this.fire(new l.k("rotateend",n)),w&&this.fire(new l.k("pitchend",n)),this.fire(new l.k("moveend",n))}flyTo(n,f){var _;if(!n.essential&&C.prefersReducedMotion){const Xt=l.M(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xt,f)}this.stop(),n=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},n);const y=this._getTransformForUpdate(),w=y.zoom,R=y.bearing,D=y.pitch,z=y.padding,q="bearing"in n?this._normalizeBearing(n.bearing,R):R,H="pitch"in n?+n.pitch:D,X="padding"in n?n.padding:y.padding,ne=l.P.convert(n.offset);let me=y.centerPoint.add(ne);const Ie=y.pointLocation(me),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(n.center||Ie),(_=n.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const Fe=y.zoomScale(Ne-w),je=y.project(Ie),Te=y.project(Me).sub(je);let He=n.curve;const Qe=Math.max(y.width,y.height),at=Qe/Fe,wt=Te.mag();if("minZoom"in n){const Xt=l.ac(Math.min(n.minZoom,w,Ne),y.minZoom,y.maxZoom),wn=Qe/y.zoomScale(Xt-w);He=Math.sqrt(wn/wt*2)}const Dt=He*He;function Zt(Xt){const wn=(at*at-Qe*Qe+(Xt?-1:1)*Dt*Dt*wt*wt)/(2*(Xt?at:Qe)*Dt*wt);return Math.log(Math.sqrt(wn*wn+1)-wn)}function Kt(Xt){return(Math.exp(Xt)-Math.exp(-Xt))/2}function qt(Xt){return(Math.exp(Xt)+Math.exp(-Xt))/2}const jt=Zt(!1);let rn=function(Xt){return qt(jt)/qt(jt+He*Xt)},Sn=function(Xt){return Qe*((qt(jt)*(Kt(wn=jt+He*Xt)/qt(wn))-Kt(jt))/Dt)/wt;var wn},Vt=(Zt(!0)-jt)/He;if(Math.abs(wt)<1e-6||!isFinite(Vt)){if(Math.abs(Qe-at)<1e-6)return this.easeTo(n,f);const Xt=at<Qe?-1:1;Vt=Math.abs(Math.log(at/Qe))/He,Sn=()=>0,rn=wn=>Math.exp(Xt*He*wn)}return n.duration="duration"in n?+n.duration:1e3*Vt/("screenSpeed"in n?+n.screenSpeed/He:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=R!==q,this._pitching=H!==D,this._padding=!y.isPaddingEqual(X),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Me),this._ease(Xt=>{const wn=Xt*Vt,Ai=1/rn(wn);y.zoom=Xt===1?Ne:w+y.scaleZoom(Ai),this._rotating&&(y.bearing=l.y.number(R,q,Xt)),this._pitching&&(y.pitch=l.y.number(D,H,Xt)),this._padding&&(y.interpolatePadding(z,X,Xt),me=y.centerPoint.add(ne)),this.terrain&&!n.freezeElevation&&this._updateElevation(Xt);const Bn=Xt===1?Me:y.unproject(je.add(Te.mult(Sn(wn))).mult(Ai));y.setLocationAtPoint(y.renderWorldCopies?Bn.wrap():Bn,me),this._applyUpdatedTransform(y),this._fireMoveEvents(f)},()=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,f){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,f)}return n||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(n,f,_){_.animate===!1||_.duration===0?(n(1),f()):(this._easeStart=C.now(),this._easeOptions=_,this._onEaseFrame=n,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,f){n=l.b3(n,-180,180);const _=Math.abs(n-f);return Math.abs(n-360-f)<_&&(n-=360),Math.abs(n+360-f)<_&&(n+=360),n}_normalizeCenter(n,f){if(!f.renderWorldCopies||f.lngRange)return;const _=n.lng-f.center.lng;n.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(n),this.transform.tileZoom)-this.transform.elevation:null}}const el={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class tl{constructor(n=el){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,f){const _=this._map._getUIString(`AttributionControl.${f}`);n.title=_,n.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const f=this._map.style.sourceCaches;for(const y in f){const w=f[y];if(w.used||w.usedForTerrain){const R=w.getSource();R.attribution&&n.indexOf(R.attribution)<0&&n.push(R.attribution)}}n=n.filter(y=>String(y).trim()),n.sort((y,w)=>y.length-w.length),n=n.filter((y,w)=>{for(let R=w+1;R<n.length;R++)if(n[R].indexOf(y)>=0)return!1;return!0});const _=n.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,n.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fc{constructor(n={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const _=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const f=N.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Hn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const f=++this._id;return this._queue.push({callback:n,id:f,cancelled:!1}),f}remove(n){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const y of _)if(y.id===n)return void(y.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Oc=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ld extends l.E{constructor(n){super(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,n.usedForTerrain=!0,n.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,f){this.sourceCache.update(n,f),this._renderableTilesKeys=[];const _={};for(const y of n.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))_[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),l.aP(y.posMatrix,0,l.X,0,l.X,0,1),this._tiles[y.key]=new Rs(y,this.tileSize));for(const y in this._tiles)_[y]||delete this._tiles[y]}freeRtt(n){for(const f in this._tiles){const _=this._tiles[f];(!n||_.tileID.equals(n)||_.tileID.isChildOf(n)||n.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n){const f={};for(const _ of this._renderableTilesKeys){const y=this._tiles[_].tileID;if(y.canonical.equals(n.canonical)){const w=n.clone();w.posMatrix=new Float64Array(16),l.aP(w.posMatrix,0,l.X,0,l.X,0,1),f[_]=w}else if(y.canonical.isChildOf(n.canonical)){const w=n.clone();w.posMatrix=new Float64Array(16);const R=y.canonical.z-n.canonical.z,D=y.canonical.x-(y.canonical.x>>R<<R),z=y.canonical.y-(y.canonical.y>>R<<R),q=l.X>>R;l.aP(w.posMatrix,0,q,0,q,0,1),l.J(w.posMatrix,w.posMatrix,[-D*q,-z*q,0]),f[_]=w}else if(n.canonical.isChildOf(y.canonical)){const w=n.clone();w.posMatrix=new Float64Array(16);const R=n.canonical.z-y.canonical.z,D=n.canonical.x-(n.canonical.x>>R<<R),z=n.canonical.y-(n.canonical.y>>R<<R),q=l.X>>R;l.aP(w.posMatrix,0,l.X,0,l.X,0,1),l.J(w.posMatrix,w.posMatrix,[D*q,z*q,0]),l.K(w.posMatrix,w.posMatrix,[1/2**R,1/2**R,0]),f[_]=w}}return f}getSourceTile(n,f){const _=this.sourceCache._source;let y=n.overscaledZ-this.deltaZoom;if(y>_.maxzoom&&(y=_.maxzoom),y<_.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!w||!w.dem)&&f)for(;y>=_.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(n.scaledTo(y--).key);return w}tilesAfterTime(n=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=n)}}class Bc{constructor(n,f,_){this.painter=n,this.sourceCache=new ld(f),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,f,_,y=l.X){var w;if(!(f>=0&&f<y&&_>=0&&_<y))return 0;const R=this.getTerrainData(n),D=(w=R.tile)===null||w===void 0?void 0:w.dem;if(!D)return 0;const z=function(Ie,Me,Ne){var Fe=Me[0],je=Me[1];return Ie[0]=Ne[0]*Fe+Ne[4]*je+Ne[12],Ie[1]=Ne[1]*Fe+Ne[5]*je+Ne[13],Ie}([],[f/y*l.X,_/y*l.X],R.u_terrain_matrix),q=[z[0]*D.dim,z[1]*D.dim],H=Math.floor(q[0]),X=Math.floor(q[1]),ne=q[0]-H,me=q[1]-X;return D.get(H,X)*(1-ne)*(1-me)+D.get(H+1,X)*ne*(1-me)+D.get(H,X+1)*(1-ne)*me+D.get(H+1,X+1)*ne*me}getElevationForLngLatZoom(n,f){if(!l.bb(f,n.wrap()))return 0;const{tileID:_,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(n,f);return this.getElevation(_,y%l.X,w%l.X,l.X)}getElevation(n,f,_,y=l.X){return this.getDEMElevation(n,f,_,y)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const y=this.painter.context,w=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(y,new l.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const f=this.sourceCache.getSourceTile(n,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const y=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new we(y,f.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),f.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const _=f&&f+f.tileID.key+n.key;if(_&&!this._demMatrixCache[_]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=n.canonical.z-f.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=y?w=n.canonical.z-y:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const R=n.canonical.x-(n.canonical.x>>w<<w),D=n.canonical.y-(n.canonical.y>>w<<w),z=l.bc(new Float64Array(16),[1/(l.X<<w),1/(l.X<<w),0]);l.J(z,z,[R*l.X,D*l.X,0]),this._demMatrixCache[n.key]={matrix:z,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(n){const f=this.painter,_=f.width/devicePixelRatio,y=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(f.context,{width:_,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(f.context,{width:_,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(_,y,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,_,y))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,R=0;w<this._coordsTextureSize;w++)for(let D=0;D<this._coordsTextureSize;D++,R+=4)f[R+0]=255&D,f[R+1]=255&w,f[R+2]=D>>8<<4|w>>8,f[R+3]=0;const _=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),y=new we(n,_,n.gl.RGBA,{premultiply:!1});return y.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),_=this.painter.context,y=_.gl,w=Math.round(n.x*this.painter.pixelRatio/devicePixelRatio),R=Math.round(n.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,D-R-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null);const z=f[0]+(f[2]>>4<<8),q=f[1]+((15&f[2])<<8),H=this.coordsIndex[255-f[3]],X=H&&this.sourceCache.getTileByID(H);if(!X)return null;const ne=this._coordsTextureSize,me=(1<<X.tileID.canonical.z)*ne;return new l.Z((X.tileID.canonical.x*ne+z)/me+X.tileID.wrap,(X.tileID.canonical.y*ne+q)/me,this.getElevation(X.tileID,z,q,ne))}depthAtPoint(n){const f=new Uint8Array(4),_=this.painter.context,y=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const n=this.painter.context,f=new l.bd,_=new l.aY,y=this.meshSize,w=l.X/y,R=y*y;for(let X=0;X<=y;X++)for(let ne=0;ne<=y;ne++)f.emplaceBack(ne*w,X*w,0);for(let X=0;X<R;X+=y+1)for(let ne=0;ne<y;ne++)_.emplaceBack(ne+X,y+ne+X+1,y+ne+X+2),_.emplaceBack(ne+X,y+ne+X+2,ne+X+1);const D=f.length,z=D+2*(y+1);for(const X of[0,1])for(let ne=0;ne<=y;ne++)for(const me of[0,1])f.emplaceBack(ne*w,X*l.X,me);for(let X=0;X<2*y;X+=2)_.emplaceBack(z+X,z+X+1,z+X+3),_.emplaceBack(z+X,z+X+3,z+X+2),_.emplaceBack(D+X,D+X+3,D+X+1),_.emplaceBack(D+X,D+X+2,D+X+3);const q=f.length,H=q+2*(y+1);for(const X of[0,1])for(let ne=0;ne<=y;ne++)for(const me of[0,1])f.emplaceBack(X*l.X,ne*w,me);for(let X=0;X<2*y;X+=2)_.emplaceBack(q+X,q+X+1,q+X+3),_.emplaceBack(q+X,q+X+3,q+X+2),_.emplaceBack(H+X,H+X+3,H+X+1),_.emplaceBack(H+X,H+X+2,H+X+3);return this._mesh=new p(n.createVertexBuffer(f,Oc.members),n.createIndexBuffer(_),l.a0.simpleSegment(0,0,f.length,_.length)),this._mesh}getMeshFrameDelta(n){return 2*Math.PI*l.be/Math.pow(2,n)/5}getMinTileElevationForLngLatZoom(n,f){var _;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(n,f);return(_=this.getMinMaxElevation(y).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(n){const f=this.getTerrainData(n).tile,_={minElevation:null,maxElevation:null};return f&&f.dem&&(_.minElevation=f.dem.min*this.exaggeration,_.maxElevation=f.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(n,f){const _=l.Z.fromLngLat(n.wrap()),y=(1<<f)*l.X,w=_.x*y,R=_.y*y,D=Math.floor(w/l.X),z=Math.floor(R/l.X);return{tileID:new l.S(f,0,f,D,z),mercatorX:w,mercatorY:R}}}class ud{constructor(n,f,_){this._context=n,this._size=f,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new we(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(_.texture),{id:n,fbo:f,texture:_,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>n.id!==f),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(n=>!n.inUse)===!1}}const nl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Vh{constructor(n,f){this.painter=n,this.terrain=f,this.pool=new ud(n.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter(_=>!n._layers[_].isHidden(f)),this._coordsDescendingInv={};for(const _ in n.sourceCaches){this._coordsDescendingInv[_]={};const y=n.sourceCaches[_].getVisibleCoordinates();for(const w of y){const R=this.terrain.sourceCache.getTerrainCoords(w);for(const D in R)this._coordsDescendingInv[_][D]||(this._coordsDescendingInv[_][D]=[]),this._coordsDescendingInv[_][D].push(R[D])}}this._coordsDescendingInvStr={};for(const _ of n._order){const y=n._layers[_],w=y.source;if(nl[y.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const R in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][R]=this._coordsDescendingInv[w][R].map(D=>D.key).sort().join()}}for(const _ of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[y][_.tileID.key];w&&w!==_.rttCoords[y]&&(_.rtt=[])}}renderLayer(n){if(n.isHidden(this.painter.transform.zoom))return!1;const f=n.type,_=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(nl[f]&&(this._prevType&&nl[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(n.id),!y))return!0;if(nl[this._prevType]||nl[f]&&y){this._prevType=f;const w=this._stacks.length-1,R=this._stacks[w]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[w]){const q=this.pool.getObjectForId(D.rtt[w].id);if(q.stamp===D.rtt[w].stamp){this.pool.useObject(q);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),D.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:l.aM.transparent,stencil:0}),_.currentStencilSource=void 0;for(let q=0;q<R.length;q++){const H=_.style._layers[R[q]],X=H.source?this._coordsDescendingInv[H.source][D.tileID.key]:[D.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(H,X),_.renderLayer(_,_.style.sourceCaches[H.source],H,X),H.source&&(D.rttCoords[H.source]=this._coordsDescendingInvStr[H.source][D.tileID.key])}}return d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),nl[f]}return!1}}const Uc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=x,cd={hash:!1,interactive:!0,bearingSnap:7,attributionControl:el,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},jc=k=>{k.touchstart=k.dragStart,k.touchmoveWindow=k.dragMove,k.touchend=k.dragEnd},hd={showCompass:!0,showZoom:!0,visualizePitch:!1};class fd{constructor(n,f,_=!1){this.mousedown=R=>{this.startMouse(l.e({},R,{ctrlKey:!0,preventDefault:()=>R.preventDefault()}),N.mousePos(this.element,R)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=R=>{this.moveMouse(R,N.mousePos(this.element,R))},this.mouseup=R=>{this.mouseRotate.dragEnd(R),this.mousePitch&&this.mousePitch.dragEnd(R),this.offTemp()},this.touchstart=R=>{R.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,R.targetTouches)[0],this.startTouch(R,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=R=>{R.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,R.targetTouches)[0],this.moveTouch(R,this._lastPos))},this.touchend=R=>{R.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=n.dragRotate._mouseRotate.getClickTolerance(),w=n.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=Tc({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:R,clickTolerance:D,bearingDegreesPerPixelMoved:z=.8})=>{const q=new Ac;return new Is({clickTolerance:D,move:(H,X)=>({bearingDelta:(X.x-H.x)*z}),moveStateManager:q,enable:R,assignEvents:jc})})({clickTolerance:y,enable:!0}),this.map=n,_&&(this.mousePitch=Cc({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:R,clickTolerance:D,pitchDegreesPerPixelMoved:z=-.5})=>{const q=new Ac;return new Is({clickTolerance:D,move:(H,X)=>({pitchDelta:(X.y-H.y)*z}),moveStateManager:q,enable:R,assignEvents:jc})})({clickTolerance:w,enable:!0})),N.addEventListener(f,"mousedown",this.mousedown),N.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(f,"touchcancel",this.reset)}startMouse(n,f){this.mouseRotate.dragStart(n,f),this.mousePitch&&this.mousePitch.dragStart(n,f),N.disableDrag()}startTouch(n,f){this.touchRotate.dragStart(n,f),this.touchPitch&&this.touchPitch.dragStart(n,f),N.disableDrag()}moveMouse(n,f){const _=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(n,f)||{};if(y&&_.setBearing(_.getBearing()+y),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(n,f)||{};w&&_.setPitch(_.getPitch()+w)}}moveTouch(n,f){const _=this.map,{bearingDelta:y}=this.touchRotate.dragMove(n,f)||{};if(y&&_.setBearing(_.getBearing()+y),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(n,f)||{};w&&_.setPitch(_.getPitch()+w)}}off(){const n=this.element;N.removeEventListener(n,"mousedown",this.mousedown),N.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let Ss;function Ei(k,n,f){const _=new l.N(k.lng,k.lat);if(k=new l.N(k.lng,k.lat),n){const y=new l.N(k.lng-360,k.lat),w=new l.N(k.lng+360,k.lat),R=f.locationPoint(k).distSqr(n);f.locationPoint(y).distSqr(n)<R?k=y:f.locationPoint(w).distSqr(n)<R&&(k=w)}for(;Math.abs(k.lng-f.center.lng)>180;){const y=f.locationPoint(k);if(y.x>=0&&y.y>=0&&y.x<=f.width&&y.y<=f.height)break;k.lng>f.center.lng?k.lng-=360:k.lng+=360}return k.lng!==_.lng&&f.locationPoint(k).y>f.height/2-f.getHorizon()?k:_}const il={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wu(k,n,f){const _=k.classList;for(const y in il)_.remove(`maplibregl-${f}-anchor-${y}`);_.add(`maplibregl-${f}-anchor-${n}`)}class ku extends l.E{constructor(n){if(super(),this._onKeyPress=f=>{const _=f.code,y=f.charCode||f.keyCode;_!=="Space"&&_!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=f=>{const _=f.originalEvent.target,y=this._element;this._popup&&(_===y||y.contains(_))&&this.togglePopup()},this._update=f=>{var _;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ei(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let R="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?R="rotateX(0deg)":this._pitchAlignment==="map"&&(R=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${il[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${R} ${w}`),C.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._subpixelPositioning=n&&n.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(n==null?void 0:n.opacity,n==null?void 0:n.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=l.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const f=N.createNS("http://www.w3.org/2000/svg","svg"),_=41,y=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${y}px`),f.setAttributeNS(null,"viewBox",`0 0 ${y} ${_}`);const w=N.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const R=N.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const D=N.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Fe of z){const je=N.createNS("http://www.w3.org/2000/svg","ellipse");je.setAttributeNS(null,"opacity","0.04"),je.setAttributeNS(null,"cx","10.5"),je.setAttributeNS(null,"cy","5.80029008"),je.setAttributeNS(null,"rx",Fe.rx),je.setAttributeNS(null,"ry",Fe.ry),D.appendChild(je)}const q=N.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const H=N.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(H);const X=N.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const ne=N.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(ne);const me=N.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");const Ie=N.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=N.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const Ne=N.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),Ie.appendChild(Me),Ie.appendChild(Ne),R.appendChild(D),R.appendChild(q),R.appendChild(X),R.appendChild(me),R.appendChild(Ie),f.appendChild(R),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(f),this._offset=l.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),wu(this._element,this._anchor,"marker"),n&&n.className)for(const f of n.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(n){return this.remove(),this._map=n,this._element.setAttribute("aria-label",n._getUIString("Marker.Title")),n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=l.N.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(n){return this._subpixelPositioning=n,this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var f,_;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),R=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,R)-w<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/y.transform._pixelPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*D,q=y.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),H=y.transform.lngLatToCameraDepth(this._lngLat,R+z)-q>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=l.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,f){return n===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const Zh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ql=0,Vl=!1;const co={maxWidth:100,unit:"metric"};function Gl(k,n,f){const _=f&&f.maxWidth||100,y=k._container.clientHeight/2,w=k.unproject([0,y]),R=k.unproject([_,y]),D=w.distanceTo(R);if(f&&f.unit==="imperial"){const z=3.2808*D;z>5280?nn(n,_,z/5280,k._getUIString("ScaleControl.Miles")):nn(n,_,z,k._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?nn(n,_,D/1852,k._getUIString("ScaleControl.NauticalMiles")):D>=1e3?nn(n,_,D/1e3,k._getUIString("ScaleControl.Kilometers")):nn(n,_,D,k._getUIString("ScaleControl.Meters"))}function nn(k,n,f,_){const y=function(w){const R=Math.pow(10,`${Math.floor(w)}`.length-1);let D=w/R;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(z){const q=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*q)/q}(D),R*D}(f);k.style.width=n*(y/f)+"px",k.innerHTML=`${y}&nbsp;${_}`}const yn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Iu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Su(k){if(k){if(typeof k=="number"){const n=Math.round(Math.abs(k)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,k),"top-left":new l.P(n,n),"top-right":new l.P(-n,n),bottom:new l.P(0,-k),"bottom-left":new l.P(n,-n),"bottom-right":new l.P(-n,-n),left:new l.P(k,0),right:new l.P(-k,0)}}if(k instanceof l.P||Array.isArray(k)){const n=l.P.convert(k);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:l.P.convert(k.center||[0,0]),top:l.P.convert(k.top||[0,0]),"top-left":l.P.convert(k["top-left"]||[0,0]),"top-right":l.P.convert(k["top-right"]||[0,0]),bottom:l.P.convert(k.bottom||[0,0]),"bottom-left":l.P.convert(k["bottom-left"]||[0,0]),"bottom-right":l.P.convert(k["bottom-right"]||[0,0]),left:l.P.convert(k.left||[0,0]),right:l.P.convert(k.right||[0,0])}}return Su(new l.P(0,0))}const qc=x;m.AJAXError=l.bh,m.Evented=l.E,m.LngLat=l.N,m.MercatorCoordinate=l.Z,m.Point=l.P,m.addProtocol=l.bi,m.config=l.a,m.removeProtocol=l.bj,m.AttributionControl=tl,m.BoxZoomHandler=pr,m.CanvasSource=Ri,m.CooperativeGesturesHandler=Qa,m.DoubleClickZoomHandler=ka,m.DragPanHandler=Uh,m.DragRotateHandler=jh,m.EdgeInsets=V,m.FullscreenControl=class extends l.E{constructor(k={}){super(),this._onFullscreenChange=()=>{var n;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=f==null?void 0:f.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,k&&k.container&&(k.container instanceof HTMLElement?this._container=k.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(k){return this._map=k,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const k=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",k).setAttribute("aria-hidden","true"),k.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const k=this._getTitle();this._fullscreenButton.setAttribute("aria-label",k),this._fullscreenButton.title=k}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=Mn,m.GeolocateControl=class extends l.E{constructor(k){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",n)),this._finish()}},this._updateCamera=n=>{const f=new l.N(n.coords.longitude,n.coords.latitude),_=n.coords.accuracy,y=this._map.getBearing(),w=l.e({bearing:y},this.options.fitBoundsOptions),R=Ke.fromLngLat(f,_);this._map.fitBounds(R,w,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const f=new l.N(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(this.options.trackUserLocation)if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&Vl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=n=>{if(this._map){if(n===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ku({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ku({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Zh,k)}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(n=!1){if(Ss!==void 0&&!n)return Ss;if(window.navigator.permissions===void 0)return Ss=!!window.navigator.geolocation,Ss;try{Ss=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ss=!!window.navigator.geolocation}return Ss})}().then(n=>this._finishSetupUI(n)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ql=0,Vl=!1}_isOutOfMapMaxBounds(k){const n=this._map.getMaxBounds(),f=k.coords;return n&&(f.longitude<n.getWest()||f.longitude>n.getEast()||f.latitude<n.getSouth()||f.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const k=this._map.getBounds(),n=k.getSouthEast(),f=k.getNorthEast(),_=n.distanceTo(f),y=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ql--,Vl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let k;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ql++,ql>1?(k={maximumAge:6e5,timeout:0},Vl=!0):(k=this.options.positionOptions,Vl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,k)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=$e,m.ImageSource=ei,m.KeyboardHandler=Ns,m.LngLatBounds=Ke,m.LogoControl=Fc,m.Map=class extends qh{constructor(k){l.bf.mark(l.bg.create);const n=Object.assign(Object.assign({},cd),k);if(n.minZoom!=null&&n.maxZoom!=null&&n.minZoom>n.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(n.minPitch!=null&&n.maxPitch!=null&&n.minPitch>n.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(n.minPitch!=null&&n.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(n.maxPitch!=null&&n.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pe(n.minZoom,n.maxZoom,n.minPitch,n.maxPitch,n.renderWorldCopies),{bearingSnap:n.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Hn,this._controls=[],this._mapId=l.a4(),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=n.interactive,this._maxTileCacheSize=n.maxTileCacheSize,this._maxTileCacheZoomLevels=n.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=n.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=n.preserveDrawingBuffer===!0,this._antialias=n.antialias===!0,this._trackResize=n.trackResize===!0,this._bearingSnap=n.bearingSnap,this._refreshExpiredTiles=n.refreshExpiredTiles===!0,this._fadeDuration=n.fadeDuration,this._crossSourceCollisions=n.crossSourceCollisions===!0,this._collectResourceTiming=n.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Uc),n.locale),this._clickTolerance=n.clickTolerance,this._overridePixelRatio=n.pixelRatio,this._maxCanvasSize=n.maxCanvasSize,this.transformCameraUpdate=n.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=n.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Y.addThrottleControl(()=>this.isMoving()),this._requestManager=new ge(n.transformRequest),typeof n.container=="string"){if(this._container=document.getElementById(n.container),!this._container)throw new Error(`Container '${n.container}' not found.`)}else{if(!(n.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=n.container}if(n.maxBounds&&this.setMaxBounds(n.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const _=Be(y=>{this._trackResize&&!this._removed&&(this.resize(y),this.redraw())},50);this._resizeObserver=new ResizeObserver(y=>{f?_(y):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,n),this._hash=n.hash&&new $e(typeof n.hash=="string"&&n.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}),n.bounds&&(this.resize(),this.fitBounds(n.bounds,l.e({},n.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=n.localIdeographFontFamily,this._validateStyle=n.validateStyle,n.style&&this.setStyle(n.style,{localIdeographFontFamily:n.localIdeographFontFamily}),n.attributionControl&&this.addControl(new tl(typeof n.attributionControl=="boolean"?void 0:n.attributionControl)),n.maplibreLogo&&this.addControl(new Fc,n.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new l.k(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new l.k(`${f.dataType}dataloading`,f))}),this.on("dataabort",f=>{this.fire(new l.k("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(k,n){if(n===void 0&&(n=k.getDefaultPosition?k.getDefaultPosition():"top-right"),!k||!k.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=k.onAdd(this);this._controls.push(k);const _=this._controlPositions[n];return n.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(k){if(!k||!k.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(k);return n>-1&&this._controls.splice(n,1),k.onRemove(this),this}hasControl(k){return this._controls.indexOf(k)>-1}calculateCameraOptionsFromTo(k,n,f,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(k,n,f,_)}resize(k){var n;const f=this._containerDimensions(),_=f[0],y=f[1],w=this._getClampedPixelRatio(_,y);if(this._resizeCanvas(_,y,w),this.painter.resize(_,y,w),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const z=this._getClampedPixelRatio(_,y);this._resizeCanvas(_,y,z),this.painter.resize(_,y,z)}this.transform.resize(_,y),(n=this._requestedCameraState)===null||n===void 0||n.resize(_,y);const R=!this._moving;return R&&(this.stop(),this.fire(new l.k("movestart",k)).fire(new l.k("move",k))),this.fire(new l.k("resize",k)),R&&this.fire(new l.k("moveend",k)),this}_getClampedPixelRatio(k,n){const{0:f,1:_}=this._maxCanvasSize,y=this.getPixelRatio(),w=k*y,R=n*y;return Math.min(w>f?f/w:1,R>_?_/R:1)*y}getPixelRatio(){var k;return(k=this._overridePixelRatio)!==null&&k!==void 0?k:devicePixelRatio}setPixelRatio(k){this._overridePixelRatio=k,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(k){return this.transform.setMaxBounds(Ke.convert(k)),this._update()}setMinZoom(k){if((k=k??-2)>=-2&&k<=this.transform.maxZoom)return this.transform.minZoom=k,this._update(),this.getZoom()<k&&this.setZoom(k),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(k){if((k=k??22)>=this.transform.minZoom)return this.transform.maxZoom=k,this._update(),this.getZoom()>k&&this.setZoom(k),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(k){if((k=k??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(k>=0&&k<=this.transform.maxPitch)return this.transform.minPitch=k,this._update(),this.getPitch()<k&&this.setPitch(k),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(k){if((k=k??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(k>=this.transform.minPitch)return this.transform.maxPitch=k,this._update(),this.getPitch()>k&&this.setPitch(k),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(k){return this.transform.renderWorldCopies=k,this._update()}project(k){return this.transform.locationPoint(l.N.convert(k),this.style&&this.terrain)}unproject(k){return this.transform.pointLocation(l.P.convert(k),this.terrain)}isMoving(){var k;return this._moving||((k=this.handlers)===null||k===void 0?void 0:k.isMoving())}isZooming(){var k;return this._zooming||((k=this.handlers)===null||k===void 0?void 0:k.isZooming())}isRotating(){var k;return this._rotating||((k=this.handlers)===null||k===void 0?void 0:k.isRotating())}_createDelegatedListener(k,n,f){if(k==="mouseenter"||k==="mouseover"){let _=!1;return{layers:n,listener:f,delegates:{mousemove:w=>{const R=n.filter(z=>this.getLayer(z)),D=R.length!==0?this.queryRenderedFeatures(w.point,{layers:R}):[];D.length?_||(_=!0,f.call(this,new ui(k,this,w.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(k==="mouseleave"||k==="mouseout"){let _=!1;return{layers:n,listener:f,delegates:{mousemove:R=>{const D=n.filter(z=>this.getLayer(z));(D.length!==0?this.queryRenderedFeatures(R.point,{layers:D}):[]).length?_=!0:_&&(_=!1,f.call(this,new ui(k,this,R.originalEvent)))},mouseout:R=>{_&&(_=!1,f.call(this,new ui(k,this,R.originalEvent)))}}}}{const _=y=>{const w=n.filter(D=>this.getLayer(D)),R=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];R.length&&(y.features=R,f.call(this,y),delete y.features)};return{layers:n,listener:f,delegates:{[k]:_}}}}_saveDelegatedListener(k,n){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[k]=this._delegatedListeners[k]||[],this._delegatedListeners[k].push(n)}_removeDelegatedListener(k,n,f){if(!this._delegatedListeners||!this._delegatedListeners[k])return;const _=this._delegatedListeners[k];for(let y=0;y<_.length;y++){const w=_[y];if(w.listener===f&&w.layers.length===n.length&&w.layers.every(R=>n.includes(R))){for(const R in w.delegates)this.off(R,w.delegates[R]);return void _.splice(y,1)}}}on(k,n,f){if(f===void 0)return super.on(k,n);const _=this._createDelegatedListener(k,typeof n=="string"?[n]:n,f);this._saveDelegatedListener(k,_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(k,n,f){if(f===void 0)return super.once(k,n);const _=typeof n=="string"?[n]:n,y=this._createDelegatedListener(k,_,f);for(const w in y.delegates){const R=y.delegates[w];y.delegates[w]=(...D)=>{this._removeDelegatedListener(k,_,f),R(...D)}}this._saveDelegatedListener(k,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(k,n,f){return f===void 0?super.off(k,n):(this._removeDelegatedListener(k,typeof n=="string"?[n]:n,f),this)}queryRenderedFeatures(k,n){if(!this.style)return[];let f;const _=k instanceof l.P||Array.isArray(k),y=_?k:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(_?{}:k)||{},y instanceof l.P||typeof y[0]=="number")f=[l.P.convert(y)];else{const w=l.P.convert(y[0]),R=l.P.convert(y[1]);f=[w,new l.P(R.x,w.y),R,new l.P(w.x,R.y),w]}return this.style.queryRenderedFeatures(f,n,this.transform)}querySourceFeatures(k,n){return this.style.querySourceFeatures(k,n)}setStyle(k,n){return(n=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&k?(this._diffStyle(k,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(k,n))}setTransformRequest(k){return this._requestManager.setTransformRequest(k),this}_getUIString(k){const n=this._locale[k];if(n==null)throw new Error(`Missing UI string '${k}'`);return n}_updateStyle(k,n){if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(k,n));const f=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!k)),k?(this.style=new ca(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof k=="string"?this.style.loadURL(k,n,f):this.style.loadJSON(k,n,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(k,n){if(typeof k=="string"){const f=this._requestManager.transformRequest(k,"Style");l.h(f,new AbortController).then(_=>{this._updateDiff(_.data,n)}).catch(_=>{_&&this.fire(new l.j(_))})}else typeof k=="object"&&this._updateDiff(k,n)}_updateDiff(k,n){try{this.style.setState(k,n)&&this._update(!0)}catch(f){l.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(k,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(k,n){return this._lazyInitEmptyStyle(),this.style.addSource(k,n),this._update(!0)}isSourceLoaded(k){const n=this.style&&this.style.sourceCaches[k];if(n!==void 0)return n.loaded();this.fire(new l.j(new Error(`There is no source with ID '${k}'`)))}setTerrain(k){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),k){const n=this.style.sourceCaches[k.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${k.source}`);this.terrain===null&&n.reload();for(const f in this.style._layers){const _=this.style._layers[f];_.type==="hillshade"&&_.source===k.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bc(this.painter,n,k),this.painter.renderToTexture=new Vh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==k.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:k})),this}getTerrain(){var k,n;return(n=(k=this.terrain)===null||k===void 0?void 0:k.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const k=this.style&&this.style.sourceCaches;for(const n in k){const f=k[n]._tiles;for(const _ in f){const y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(k){return this.style.removeSource(k),this._update(!0)}getSource(k){return this.style.getSource(k)}addImage(k,n,f={}){const{pixelRatio:_=1,sdf:y=!1,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q}=f;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||l.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:X,data:ne}=n,me=n;return this.style.addImage(k,{data:new l.R({width:H,height:X},new Uint8Array(ne)),pixelRatio:_,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q,sdf:y,version:0,userImage:me}),me.onAdd&&me.onAdd(this,k),this}}{const{width:H,height:X,data:ne}=C.getImageData(n);this.style.addImage(k,{data:new l.R({width:H,height:X},ne),pixelRatio:_,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q,sdf:y,version:0})}}updateImage(k,n){const f=this.style.getImage(k);if(!f)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof HTMLImageElement||l.b(n)?C.getImageData(n):n,{width:y,height:w,data:R}=_;if(y===void 0||w===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==f.data.width||w!==f.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(n instanceof HTMLImageElement||l.b(n));return f.data.replace(R,D),this.style.updateImage(k,f),this}getImage(k){return this.style.getImage(k)}hasImage(k){return k?!!this.style.getImage(k):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(k){this.style.removeImage(k)}loadImage(k){return Y.getImage(this._requestManager.transformRequest(k,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(k,n){return this._lazyInitEmptyStyle(),this.style.addLayer(k,n),this._update(!0)}moveLayer(k,n){return this.style.moveLayer(k,n),this._update(!0)}removeLayer(k){return this.style.removeLayer(k),this._update(!0)}getLayer(k){return this.style.getLayer(k)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(k,n,f){return this.style.setLayerZoomRange(k,n,f),this._update(!0)}setFilter(k,n,f={}){return this.style.setFilter(k,n,f),this._update(!0)}getFilter(k){return this.style.getFilter(k)}setPaintProperty(k,n,f,_={}){return this.style.setPaintProperty(k,n,f,_),this._update(!0)}getPaintProperty(k,n){return this.style.getPaintProperty(k,n)}setLayoutProperty(k,n,f,_={}){return this.style.setLayoutProperty(k,n,f,_),this._update(!0)}getLayoutProperty(k,n){return this.style.getLayoutProperty(k,n)}setGlyphs(k,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(k,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(k,n,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(k,n,f,_=>{_||this._update(!0)}),this}removeSprite(k){return this._lazyInitEmptyStyle(),this.style.removeSprite(k),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(k,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(k,n,f=>{f||this._update(!0)}),this}setLight(k,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(k,n),this._update(!0)}getLight(){return this.style.getLight()}setSky(k){return this._lazyInitEmptyStyle(),this.style.setSky(k),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(k,n){return this.style.setFeatureState(k,n),this._update()}removeFeatureState(k,n){return this.style.removeFeatureState(k,n),this._update()}getFeatureState(k){return this.style.getFeatureState(k)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let k=0,n=0;return this._container&&(k=this._container.clientWidth||400,n=this._container.clientHeight||300),[k,n]}_setupContainer(){const k=this._container;k.classList.add("maplibregl-map");const n=this._canvasContainer=N.create("div","maplibregl-canvas-container",k);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),_=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],_);const y=this._controlContainer=N.create("div","maplibregl-control-container",k),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(R=>{w[R]=N.create("div",`maplibregl-ctrl-${R} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(k,n,f){this._canvas.width=Math.floor(f*k),this._canvas.height=Math.floor(f*n),this._canvas.style.width=`${k}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const k={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let n=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{n={requestedAttributes:k},_&&(n.statusMessage=_.statusMessage,n.type=_.type)},{once:!0});const f=this._canvas.getContext("webgl2",k)||this._canvas.getContext("webgl",k);if(!f){const _="Failed to initialize WebGL";throw n?(n.message=_,new Error(JSON.stringify(n))):new Error(_)}this.painter=new b(f,this.transform),B.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(k){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||k,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(k){return this._update(),this._renderTaskQueue.add(k)}_cancelRenderFrame(k){this._renderTaskQueue.remove(k)}_render(k){const n=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(k),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,w=C.now();this.style.zoomHistory.update(y,w);const R=new l.z(y,{now:w,fadeDuration:n,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=R.crossFadingFactor();D===1&&D===this._crossFadingFactor||(f=!0,this._crossFadingFactor=D),this.style.update(R)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,n,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:n,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var k;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Y.removeThrottleControl(this._imageQueueHandle),(k=this._resizeObserver)===null||k===void 0||k.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n!=null&&n.loseContext&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(k=>{l.bf.frame(k),this._frameRequest=null,this._render(k)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(k){this._showTileBoundaries!==k&&(this._showTileBoundaries=k,this._update())}get showPadding(){return!!this._showPadding}set showPadding(k){this._showPadding!==k&&(this._showPadding=k,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(k){this._showCollisionBoxes!==k&&(this._showCollisionBoxes=k,k?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(k){this._showOverdrawInspector!==k&&(this._showOverdrawInspector=k,this._update())}get repaint(){return!!this._repaint}set repaint(k){this._repaint!==k&&(this._repaint=k,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(k){this._vertices=k,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=ui,m.MapTouchEvent=nr,m.MapWheelEvent=us,m.Marker=ku,m.NavigationControl=class{constructor(k){this._updateZoomButtons=()=>{const n=this._map.getZoom(),f=n===this._map.getMaxZoom(),_=n===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=n},this._setButtonTitle=(n,f)=>{const _=this._map._getUIString(`NavigationControl.${f}`);n.title=_,n.setAttribute("aria-label",_)},this.options=l.e({},hd,k),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(k){return this._map=k,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(k,n){const f=N.create("button",k,this._container);return f.type="button",f.addEventListener("click",n),f}},m.Popup=class extends l.E{constructor(k){super(),this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ei(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!n)return;const _=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationPoint(this._lngLat));let y=this.options.anchor;const w=Su(this.options.offset);if(!y){const D=this._container.offsetWidth,z=this._container.offsetHeight;let q;q=_.y+w.bottom.y<z?["top"]:_.y>this._map.transform.height-z?["bottom"]:[],_.x<D/2?q.push("left"):_.x>this._map.transform.width-D/2&&q.push("right"),y=q.length===0?"bottom":q.join("-")}let R=_.add(w[y]);this.options.subpixelPositioning||(R=R.round()),N.setTransform(this._container,`${il[y]} translate(${R.x}px,${R.y}px)`),wu(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(yn),k)}addTo(k){return this._map&&this.remove(),this._map=k,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(k){return this._lngLat=l.N.convert(k),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(k){return this.setDOMContent(document.createTextNode(k))}setHTML(k){const n=document.createDocumentFragment(),f=document.createElement("body");let _;for(f.innerHTML=k;_=f.firstChild,_;)n.appendChild(_);return this.setDOMContent(n)}getMaxWidth(){var k;return(k=this._container)===null||k===void 0?void 0:k.style.maxWidth}setMaxWidth(k){return this.options.maxWidth=k,this._update(),this}setDOMContent(k){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(k),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(k){return this._container&&this._container.classList.add(k),this}removeClassName(k){return this._container&&this._container.classList.remove(k),this}setOffset(k){return this.options.offset=k,this._update(),this}toggleClassName(k){if(this._container)return this._container.classList.toggle(k)}setSubpixelPositioning(k){this.options.subpixelPositioning=k}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const k=this._container.querySelector(Iu);k&&k.focus()}},m.RasterDEMTileSource=Bt,m.RasterTileSource=Se,m.ScaleControl=class{constructor(k){this._onMove=()=>{Gl(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,Gl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},co),k)}getDefaultPosition(){return"bottom-left"}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",k.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Hs,m.Style=ca,m.TerrainControl=class{constructor(k){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=k}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Ja,m.TwoFingersTouchRotateHandler=Pc,m.TwoFingersTouchZoomHandler=Mc,m.TwoFingersTouchZoomRotateHandler=Nc,m.VectorTileSource=xt,m.VideoSource=Jt,m.addSourceType=(k,n)=>l._(void 0,void 0,void 0,function*(){if(ns(k))throw new Error(`A source type called "${k}" already exists.`);((f,_)=>{Qi[f]=_})(k,n)}),m.clearPrewarmedResources=function(){const k=Pn;k&&(k.isPreloaded()&&k.numActive()===1?(k.release(St),Pn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return mn().getRTLTextPluginStatus()},m.getVersion=function(){return qc},m.getWorkerCount=function(){return $t.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(k){return Ot().broadcast("IS",k)},m.prewarm=function(){Kn().acquire(St)},m.setMaxParallelImageRequests=function(k){l.a.MAX_PARALLEL_IMAGE_REQUESTS=k},m.setRTLTextPlugin=function(k,n){return mn().setRTLTextPlugin(k,n)},m.setWorkerCount=function(k){$t.workerCount=k},m.setWorkerUrl=function(k){l.a.WORKER_URL=k}});var h=t;return h})})(lv);var yx=lv.exports;const Ls=_x(yx);var vx=Object.defineProperty,bx=(s,e,t)=>e in s?vx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Zg=(s,e,t)=>bx(s,typeof e!="symbol"?e+"":e,t);function Ch(){}function cv(s){return s()}function Hg(){return Object.create(null)}function nd(s){s.forEach(cv)}function hv(s){return typeof s=="function"}function xx(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function wx(s){return Object.keys(s).length===0}function kx(s,e){s.appendChild(e)}function Ix(s,e,t){s.insertBefore(e,t||null)}function fv(s){s.parentNode&&s.parentNode.removeChild(s)}function Xg(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function gl(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function Sx(s){return Array.from(s.childNodes)}function _f(s,e,t){s.classList.toggle(e,!!t)}let Gp;function wh(s){Gp=s}const $u=[],Wg=[];let nc=[];const Kg=[],Ex=Promise.resolve();let _p=!1;function Ax(){_p||(_p=!0,Ex.then(dv))}function yp(s){nc.push(s)}const rp=new Set;let Gu=0;function dv(){if(Gu!==0)return;const s=Gp;do{try{for(;Gu<$u.length;){const e=$u[Gu];Gu++,wh(e),Tx(e.$$)}}catch(e){throw $u.length=0,Gu=0,e}for(wh(null),$u.length=0,Gu=0;Wg.length;)Wg.pop()();for(let e=0;e<nc.length;e+=1){const t=nc[e];rp.has(t)||(rp.add(t),t())}nc.length=0}while($u.length);for(;Kg.length;)Kg.pop()();_p=!1,rp.clear(),wh(s)}function Tx(s){if(s.fragment!==null){s.update(),nd(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(yp)}}function Cx(s){const e=[],t=[];nc.forEach(r=>s.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),nc=e}const Lx=new Set;function Mx(s,e){s&&s.i&&(Lx.delete(s),s.i(e))}function Rx(s,e,t){const{fragment:r,after_update:a}=s.$$;r&&r.m(e,t),yp(()=>{const h=s.$$.on_mount.map(cv).filter(hv);s.$$.on_destroy?s.$$.on_destroy.push(...h):nd(h),s.$$.on_mount=[]}),a.forEach(yp)}function Px(s,e){const t=s.$$;t.fragment!==null&&(Cx(t.after_update),nd(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Dx(s,e){s.$$.dirty[0]===-1&&($u.push(s),Ax(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function Nx(s,e,t,r,a,h,m=null,l=[-1]){const x=Gp;wh(s);const S=s.$$={fragment:null,ctx:[],props:h,update:Ch,not_equal:a,bound:Hg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:Hg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let T=!1;if(S.ctx=t?t(s,e.props||{},(C,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[C],S.ctx[C]=U)&&(!S.skip_bound&&S.bound[C]&&S.bound[C](U),T&&Dx(s,C)),N}):[],S.update(),T=!0,nd(S.before_update),S.fragment=r?r(S.ctx):!1,e.target){if(e.hydrate){const C=Sx(e.target);S.fragment&&S.fragment.l(C),C.forEach(fv)}else S.fragment&&S.fragment.c();e.intro&&Mx(s.$$.fragment),Rx(s,e.target,e.anchor),dv()}wh(x)}class zx{constructor(){Zg(this,"$$"),Zg(this,"$$set")}$destroy(){Px(this,1),this.$destroy=Ch}$on(e,t){if(!hv(t))return Ch;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const a=r.indexOf(t);a!==-1&&r.splice(a,1)}}$set(e){this.$$set&&!wx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Fx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Fx);function Ox(s){let e,t,r;return{c(){e=Xg("svg"),t=Xg("path"),gl(t,"stroke-width","4"),gl(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),gl(t,"class","svelte-gzo3ar"),gl(e,"width",r=s[0]==="list"?20:void 0),gl(e,"viewBox","0 0 70 85"),gl(e,"fill","none"),gl(e,"class","svelte-gzo3ar"),_f(e,"in-map",s[0]!=="list"),_f(e,"list-icon",s[0]==="list")},m(a,h){Ix(a,e,h),kx(e,t)},p(a,[h]){h&1&&r!==(r=a[0]==="list"?20:void 0)&&gl(e,"width",r),h&1&&_f(e,"in-map",a[0]!=="list"),h&1&&_f(e,"list-icon",a[0]==="list")},i:Ch,o:Ch,d(a){a&&fv(e)}}}function Bx(s,e,t){let{displayIn:r}=e;return s.$$set=a=>{"displayIn"in a&&t(0,r=a.displayIn)},[r]}class Ux extends zx{constructor(e){super(),Nx(this,e,Bx,Ox,xx,{displayIn:0})}}const jx=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],qx={decimalLatitude:40.123,decimalLongitude:-74.123},Vx=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Gx=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Zx(){const s=[];return jx.forEach(e=>{e.decimalLatitude?s.push(e):s.push({...e,...qx})}),[...s,...Vx,...Gx]}const Hx=Zx();Hx.map(s=>s.verbatimCoordinates);var js=63710088e-1,pv={centimeters:js*100,centimetres:js*100,degrees:360/(2*Math.PI),feet:js*3.28084,inches:js*39.37,kilometers:js/1e3,kilometres:js/1e3,meters:js,metres:js,miles:js/1609.344,millimeters:js*1e3,millimetres:js*1e3,nauticalmiles:js/1852,radians:1,yards:js*1.0936};function zh(s,e,t={}){const r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=s,r}function Xx(s,e,t={}){if(!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!$g(s[0])||!$g(s[1]))throw new Error("coordinates must contain numbers");return zh({type:"Point",coordinates:s},e,t)}function Zp(s,e,t={}){for(const r of s){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<r[r.length-1].length;a++)if(r[r.length-1][a]!==r[0][a])throw new Error("First and last Position are not equivalent.")}return zh({type:"Polygon",coordinates:s},e,t)}function ru(s,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=s,t}function mv(s,e,t={}){return zh({type:"MultiPolygon",coordinates:s},e,t)}function Wx(s,e="kilometers"){const t=pv[e];if(!t)throw new Error(e+" units is invalid");return s*t}function Kx(s,e="kilometers"){const t=pv[e];if(!t)throw new Error(e+" units is invalid");return s/t}function $g(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function $x(s,e){var t={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},r,a,h,m;return m={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function l(S){return function(T){return x([S,T])}}function x(S){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(h=S[0]&2?a.return:S[0]?a.throw||((h=a.return)&&h.call(a),0):a.next)&&!(h=h.call(a,S[1])).done)return h;switch(a=0,h&&(S=[S[0]&2,h.value]),S[0]){case 0:case 1:h=S;break;case 4:return t.label++,{value:S[1],done:!1};case 5:t.label++,a=S[1],S=[0];continue;case 7:S=t.ops.pop(),t.trys.pop();continue;default:if(h=t.trys,!(h=h.length>0&&h[h.length-1])&&(S[0]===6||S[0]===2)){t=0;continue}if(S[0]===3&&(!h||S[1]>h[0]&&S[1]<h[3])){t.label=S[1];break}if(S[0]===6&&t.label<h[1]){t.label=h[1],h=S;break}if(h&&t.label<h[2]){t.label=h[2],t.ops.push(S);break}h[2]&&t.ops.pop(),t.trys.pop();continue}S=e.call(s,t)}catch(T){S=[6,T],a=0}finally{r=h=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}}var kl=function(){function s(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return s}();function Yx(s,e){return s>e?1:s<e?-1:0}function vl(s,e,t){for(var r=new kl(null,null),a=r,h=r;;){var m=t(s,e.key);if(m<0){if(e.left===null)break;if(t(s,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}h.left=e,h=e,e=e.left}else if(m>0){if(e.right===null)break;if(t(s,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}a.right=e,a=e,e=e.right}else break}return a.right=e.left,h.left=e.right,e.left=r.right,e.right=r.left,e}function sp(s,e,t,r){var a=new kl(s,e);if(t===null)return a.left=a.right=null,a;t=vl(s,t,r);var h=r(s,t.key);return h<0?(a.left=t.left,a.right=t,t.left=null):h>=0&&(a.right=t.right,a.left=t,t.right=null),a}function Yg(s,e,t){var r=null,a=null;if(e){e=vl(s,e,t);var h=t(e.key,s);h===0?(r=e.left,a=e.right):h<0?(a=e.right,e.right=null,r=e):(r=e.left,e.left=null,a=e)}return{left:r,right:a}}function Jx(s,e,t){return e===null?s:(s===null||(e=vl(s.key,e,t),e.left=s),e)}function vp(s,e,t,r,a){if(s){r(""+e+(t?" ":" ")+a(s)+`
`);var h=e+(t?"    ":"   ");s.left&&vp(s.left,h,!1,r,a),s.right&&vp(s.right,h,!0,r,a)}}var Hp=function(){function s(e){e===void 0&&(e=Yx),this._root=null,this._size=0,this._comparator=e}return s.prototype.insert=function(e,t){return this._size++,this._root=sp(e,t,this._root,this._comparator)},s.prototype.add=function(e,t){var r=new kl(e,t);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var a=this._comparator,h=vl(e,this._root,a),m=a(e,h.key);return m===0?this._root=h:(m<0?(r.left=h.left,r.right=h,h.left=null):m>0&&(r.right=h.right,r.left=h,h.right=null),this._size++,this._root=r),this._root},s.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},s.prototype._remove=function(e,t,r){var a;if(t===null)return null;t=vl(e,t,r);var h=r(e,t.key);return h===0?(t.left===null?a=t.right:(a=vl(e,t.left,r),a.right=t.right),this._size--,a):t},s.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=vl(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},s.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var a=r(e,t.key);if(a===0)return t;a<0?t=t.left:t=t.right}return null},s.prototype.find=function(e){return this._root&&(this._root=vl(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},s.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var a=r(e,t.key);if(a===0)return!0;a<0?t=t.left:t=t.right}return!1},s.prototype.forEach=function(e,t){for(var r=this._root,a=[],h=!1;!h;)r!==null?(a.push(r),r=r.left):a.length!==0?(r=a.pop(),e.call(t,r),r=r.right):h=!0;return this},s.prototype.range=function(e,t,r,a){for(var h=[],m=this._comparator,l=this._root,x;h.length!==0||l;)if(l)h.push(l),l=l.left;else{if(l=h.pop(),x=m(l.key,t),x>0)break;if(m(l.key,e)>=0&&r.call(a,l))return this;l=l.right}return this},s.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},s.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},s.prototype.min=function(){return this._root?this.minNode(this._root).key:null},s.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},s.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},s.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},s.prototype.at=function(e){for(var t=this._root,r=!1,a=0,h=[];!r;)if(t)h.push(t),t=t.left;else if(h.length>0){if(t=h.pop(),a===e)return t;a++,t=t.right}else r=!0;return null},s.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var a=this._comparator;t;){var h=a(e.key,t.key);if(h===0)break;h<0?(r=t,t=t.left):t=t.right}return r},s.prototype.prev=function(e){var t=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var a=this._comparator;t;){var h=a(e.key,t.key);if(h===0)break;h<0?t=t.left:(r=t,t=t.right)}return r},s.prototype.clear=function(){return this._root=null,this._size=0,this},s.prototype.toList=function(){return ew(this._root)},s.prototype.load=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var a=e.length,h=this._comparator;if(r&&wp(e,t,0,a-1,h),this._root===null)this._root=bp(e,t,0,a),this._size=a;else{var m=tw(this.toList(),Qx(e,t),h);a=this._size+a,this._root=xp({head:m},0,a)}return this},s.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(s.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),s.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var t=[];return vp(this._root,"",!0,function(r){return t.push(r)},e),t.join("")},s.prototype.update=function(e,t,r){var a=this._comparator,h=Yg(e,this._root,a),m=h.left,l=h.right;a(e,t)<0?l=sp(t,r,l,a):m=sp(t,r,m,a),this._root=Jx(m,l,a)},s.prototype.split=function(e){return Yg(e,this._root,this._comparator)},s.prototype[Symbol.iterator]=function(){var e,t,r;return $x(this,function(a){switch(a.label){case 0:e=this._root,t=[],r=!1,a.label=1;case 1:return r?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return a.sent(),e=e.right,[3,5];case 4:r=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},s}();function bp(s,e,t,r){var a=r-t;if(a>0){var h=t+Math.floor(a/2),m=s[h],l=e[h],x=new kl(m,l);return x.left=bp(s,e,t,h),x.right=bp(s,e,h+1,r),x}return null}function Qx(s,e){for(var t=new kl(null,null),r=t,a=0;a<s.length;a++)r=r.next=new kl(s[a],e[a]);return r.next=null,t.next}function ew(s){for(var e=s,t=[],r=!1,a=new kl(null,null),h=a;!r;)e?(t.push(e),e=e.left):t.length>0?(e=h=h.next=t.pop(),e=e.right):r=!0;return h.next=null,a.next}function xp(s,e,t){var r=t-e;if(r>0){var a=e+Math.floor(r/2),h=xp(s,e,a),m=s.head;return m.left=h,s.head=s.head.next,m.right=xp(s,a+1,t),m}return null}function tw(s,e,t){for(var r=new kl(null,null),a=r,h=s,m=e;h!==null&&m!==null;)t(h.key,m.key)<0?(a.next=h,h=h.next):(a.next=m,m=m.next),a=a.next;return h!==null?a.next=h:m!==null&&(a.next=m),r.next}function wp(s,e,t,r,a){if(!(t>=r)){for(var h=s[t+r>>1],m=t-1,l=r+1;;){do m++;while(a(s[m],h)<0);do l--;while(a(s[l],h)>0);if(m>=l)break;var x=s[m];s[m]=s[l],s[l]=x,x=e[m],e[m]=e[l],e[l]=x}wp(s,e,t,l,a),wp(s,e,l+1,r,a)}}const Fa=11102230246251565e-32,gs=134217729,nw=(3+8*Fa)*Fa;function op(s,e,t,r,a){let h,m,l,x,S=e[0],T=r[0],C=0,N=0;T>S==T>-S?(h=S,S=e[++C]):(h=T,T=r[++N]);let B=0;if(C<s&&N<t)for(T>S==T>-S?(m=S+h,l=h-(m-S),S=e[++C]):(m=T+h,l=h-(m-T),T=r[++N]),h=m,l!==0&&(a[B++]=l);C<s&&N<t;)T>S==T>-S?(m=h+S,x=m-h,l=h-(m-x)+(S-x),S=e[++C]):(m=h+T,x=m-h,l=h-(m-x)+(T-x),T=r[++N]),h=m,l!==0&&(a[B++]=l);for(;C<s;)m=h+S,x=m-h,l=h-(m-x)+(S-x),S=e[++C],h=m,l!==0&&(a[B++]=l);for(;N<t;)m=h+T,x=m-h,l=h-(m-x)+(T-x),T=r[++N],h=m,l!==0&&(a[B++]=l);return(h!==0||B===0)&&(a[B++]=h),B}function iw(s,e){let t=e[0];for(let r=1;r<s;r++)t+=e[r];return t}function Fh(s){return new Float64Array(s)}const rw=(3+16*Fa)*Fa,sw=(2+12*Fa)*Fa,ow=(9+64*Fa)*Fa*Fa,Zu=Fh(4),Jg=Fh(8),Qg=Fh(12),e_=Fh(16),Cs=Fh(4);function aw(s,e,t,r,a,h,m){let l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge,xe,Ee,ye,be;const ve=s-a,Ce=t-a,we=e-h,_e=r-h;ge=ve*_e,N=gs*ve,B=N-(N-ve),U=ve-B,N=gs*_e,ee=N-(N-_e),ie=_e-ee,xe=U*ie-(ge-B*ee-U*ee-B*ie),Ee=we*Ce,N=gs*we,B=N-(N-we),U=we-B,N=gs*Ce,ee=N-(N-Ce),ie=Ce-ee,ye=U*ie-(Ee-B*ee-U*ee-B*ie),ae=xe-ye,C=xe-ae,Zu[0]=xe-(ae+C)+(C-ye),J=ge+ae,C=J-ge,Y=ge-(J-C)+(ae-C),ae=Y-Ee,C=Y-ae,Zu[1]=Y-(ae+C)+(C-Ee),be=J+ae,C=be-J,Zu[2]=J-(be-C)+(ae-C),Zu[3]=be;let tt=iw(4,Zu),Ve=sw*m;if(tt>=Ve||-tt>=Ve||(C=s-ve,l=s-(ve+C)+(C-a),C=t-Ce,S=t-(Ce+C)+(C-a),C=e-we,x=e-(we+C)+(C-h),C=r-_e,T=r-(_e+C)+(C-h),l===0&&x===0&&S===0&&T===0)||(Ve=ow*m+nw*Math.abs(tt),tt+=ve*T+_e*l-(we*S+Ce*x),tt>=Ve||-tt>=Ve))return tt;ge=l*_e,N=gs*l,B=N-(N-l),U=l-B,N=gs*_e,ee=N-(N-_e),ie=_e-ee,xe=U*ie-(ge-B*ee-U*ee-B*ie),Ee=x*Ce,N=gs*x,B=N-(N-x),U=x-B,N=gs*Ce,ee=N-(N-Ce),ie=Ce-ee,ye=U*ie-(Ee-B*ee-U*ee-B*ie),ae=xe-ye,C=xe-ae,Cs[0]=xe-(ae+C)+(C-ye),J=ge+ae,C=J-ge,Y=ge-(J-C)+(ae-C),ae=Y-Ee,C=Y-ae,Cs[1]=Y-(ae+C)+(C-Ee),be=J+ae,C=be-J,Cs[2]=J-(be-C)+(ae-C),Cs[3]=be;const qe=op(4,Zu,4,Cs,Jg);ge=ve*T,N=gs*ve,B=N-(N-ve),U=ve-B,N=gs*T,ee=N-(N-T),ie=T-ee,xe=U*ie-(ge-B*ee-U*ee-B*ie),Ee=we*S,N=gs*we,B=N-(N-we),U=we-B,N=gs*S,ee=N-(N-S),ie=S-ee,ye=U*ie-(Ee-B*ee-U*ee-B*ie),ae=xe-ye,C=xe-ae,Cs[0]=xe-(ae+C)+(C-ye),J=ge+ae,C=J-ge,Y=ge-(J-C)+(ae-C),ae=Y-Ee,C=Y-ae,Cs[1]=Y-(ae+C)+(C-Ee),be=J+ae,C=be-J,Cs[2]=J-(be-C)+(ae-C),Cs[3]=be;const dt=op(qe,Jg,4,Cs,Qg);ge=l*T,N=gs*l,B=N-(N-l),U=l-B,N=gs*T,ee=N-(N-T),ie=T-ee,xe=U*ie-(ge-B*ee-U*ee-B*ie),Ee=x*S,N=gs*x,B=N-(N-x),U=x-B,N=gs*S,ee=N-(N-S),ie=S-ee,ye=U*ie-(Ee-B*ee-U*ee-B*ie),ae=xe-ye,C=xe-ae,Cs[0]=xe-(ae+C)+(C-ye),J=ge+ae,C=J-ge,Y=ge-(J-C)+(ae-C),ae=Y-Ee,C=Y-ae,Cs[1]=Y-(ae+C)+(C-Ee),be=J+ae,C=be-J,Cs[2]=J-(be-C)+(ae-C),Cs[3]=be;const mt=op(dt,Qg,4,Cs,e_);return e_[mt-1]}function lw(s,e,t,r,a,h){const m=(e-h)*(t-a),l=(s-a)*(r-h),x=m-l,S=Math.abs(m+l);return Math.abs(x)>=rw*S?x:-aw(s,e,t,r,a,h,S)}const uh=(s,e)=>s.ll.x<=e.x&&e.x<=s.ur.x&&s.ll.y<=e.y&&e.y<=s.ur.y,kp=(s,e)=>{if(e.ur.x<s.ll.x||s.ur.x<e.ll.x||e.ur.y<s.ll.y||s.ur.y<e.ll.y)return null;const t=s.ll.x<e.ll.x?e.ll.x:s.ll.x,r=s.ur.x<e.ur.x?s.ur.x:e.ur.x,a=s.ll.y<e.ll.y?e.ll.y:s.ll.y,h=s.ur.y<e.ur.y?s.ur.y:e.ur.y;return{ll:{x:t,y:a},ur:{x:r,y:h}}};let bl=Number.EPSILON;bl===void 0&&(bl=Math.pow(2,-52));const uw=bl*bl,t_=(s,e)=>{if(-bl<s&&s<bl&&-bl<e&&e<bl)return 0;const t=s-e;return t*t<uw*s*e?0:s<e?-1:1};class cw{constructor(){this.reset()}reset(){this.xRounder=new n_,this.yRounder=new n_}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class n_{constructor(){this.tree=new Hp,this.round(0)}round(e){const t=this.tree.add(e),r=this.tree.prev(t);if(r!==null&&t_(t.key,r.key)===0)return this.tree.remove(e),r.key;const a=this.tree.next(t);return a!==null&&t_(t.key,a.key)===0?(this.tree.remove(e),a.key):e}}const Lh=new cw,Tf=(s,e)=>s.x*e.y-s.y*e.x,gv=(s,e)=>s.x*e.x+s.y*e.y,i_=(s,e,t)=>{const r=lw(s.x,s.y,e.x,e.y,t.x,t.y);return r>0?-1:r<0?1:0},zf=s=>Math.sqrt(gv(s,s)),hw=(s,e,t)=>{const r={x:e.x-s.x,y:e.y-s.y},a={x:t.x-s.x,y:t.y-s.y};return Tf(a,r)/zf(a)/zf(r)},fw=(s,e,t)=>{const r={x:e.x-s.x,y:e.y-s.y},a={x:t.x-s.x,y:t.y-s.y};return gv(a,r)/zf(a)/zf(r)},r_=(s,e,t)=>e.y===0?null:{x:s.x+e.x/e.y*(t-s.y),y:t},s_=(s,e,t)=>e.x===0?null:{x:t,y:s.y+e.y/e.x*(t-s.x)},dw=(s,e,t,r)=>{if(e.x===0)return s_(t,r,s.x);if(r.x===0)return s_(s,e,t.x);if(e.y===0)return r_(t,r,s.y);if(r.y===0)return r_(s,e,t.y);const a=Tf(e,r);if(a==0)return null;const h={x:t.x-s.x,y:t.y-s.y},m=Tf(h,e)/a,l=Tf(h,r)/a,x=s.x+l*e.x,S=t.x+m*r.x,T=s.y+l*e.y,C=t.y+m*r.y,N=(x+S)/2,B=(T+C)/2;return{x:N,y:B}};class yo{static compare(e,t){const r=yo.comparePoints(e.point,t.point);return r!==0?r:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:wl.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let r=0,a=t.length;r<a;r++){const h=t[r];this.point.events.push(h),h.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const r=this.point.events[t];if(r.segment.consumedBy===void 0)for(let a=t+1;a<e;a++){const h=this.point.events[a];h.consumedBy===void 0&&r.otherSE.point.events===h.otherSE.point.events&&r.segment.consume(h.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,r=this.point.events.length;t<r;t++){const a=this.point.events[t];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&e.push(a)}return e}getLeftmostComparator(e){const t=new Map,r=a=>{const h=a.otherSE;t.set(a,{sine:hw(this.point,e.point,h.point),cosine:fw(this.point,e.point,h.point)})};return(a,h)=>{t.has(a)||r(a),t.has(h)||r(h);const{sine:m,cosine:l}=t.get(a),{sine:x,cosine:S}=t.get(h);return m>=0&&x>=0?l<S?1:l>S?-1:0:m<0&&x<0?l<S?-1:l>S?1:0:x<m?-1:x>m?1:0}}}let pw=0;class wl{static compare(e,t){const r=e.leftSE.point.x,a=t.leftSE.point.x,h=e.rightSE.point.x,m=t.rightSE.point.x;if(m<r)return 1;if(h<a)return-1;const l=e.leftSE.point.y,x=t.leftSE.point.y,S=e.rightSE.point.y,T=t.rightSE.point.y;if(r<a){if(x<l&&x<S)return 1;if(x>l&&x>S)return-1;const C=e.comparePoint(t.leftSE.point);if(C<0)return 1;if(C>0)return-1;const N=t.comparePoint(e.rightSE.point);return N!==0?N:-1}if(r>a){if(l<x&&l<T)return-1;if(l>x&&l>T)return 1;const C=t.comparePoint(e.leftSE.point);if(C!==0)return C;const N=e.comparePoint(t.rightSE.point);return N<0?1:N>0?-1:1}if(l<x)return-1;if(l>x)return 1;if(h<m){const C=t.comparePoint(e.rightSE.point);if(C!==0)return C}if(h>m){const C=e.comparePoint(t.rightSE.point);if(C<0)return 1;if(C>0)return-1}if(h!==m){const C=S-l,N=h-r,B=T-x,U=m-a;if(C>N&&B<U)return 1;if(C<N&&B>U)return-1}return h>m?1:h<m||S<T?-1:S>T?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,r,a){this.id=++pw,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=a}static fromRing(e,t,r){let a,h,m;const l=yo.comparePoints(e,t);if(l<0)a=e,h=t,m=1;else if(l>0)a=t,h=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const x=new yo(a,!0),S=new yo(h,!1);return new wl(x,S,[r],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,r=this.rightSE.point,a=this.vector();if(t.x===r.x)return e.x===t.x?0:e.x<t.x?1:-1;const h=(e.y-t.y)/a.y,m=t.x+h*a.x;if(e.x===m)return 0;const l=(e.x-t.x)/a.x,x=t.y+l*a.y;return e.y===x?0:e.y<x?-1:1}getIntersection(e){const t=this.bbox(),r=e.bbox(),a=kp(t,r);if(a===null)return null;const h=this.leftSE.point,m=this.rightSE.point,l=e.leftSE.point,x=e.rightSE.point,S=uh(t,l)&&this.comparePoint(l)===0,T=uh(r,h)&&e.comparePoint(h)===0,C=uh(t,x)&&this.comparePoint(x)===0,N=uh(r,m)&&e.comparePoint(m)===0;if(T&&S)return N&&!C?m:!N&&C?x:null;if(T)return C&&h.x===x.x&&h.y===x.y?null:h;if(S)return N&&m.x===l.x&&m.y===l.y?null:l;if(N&&C)return null;if(N)return m;if(C)return x;const B=dw(h,this.vector(),l,e.vector());return B===null||!uh(a,B)?null:Lh.round(B.x,B.y)}split(e){const t=[],r=e.events!==void 0,a=new yo(e,!0),h=new yo(e,!1),m=this.rightSE;this.replaceRightSE(h),t.push(h),t.push(a);const l=new wl(a,m,this.rings.slice(),this.windings.slice());return yo.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),yo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(a.checkForConsuming(),h.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,r=this.windings.length;t<r;t++)this.windings[t]*=-1}consume(e){let t=this,r=e;for(;t.consumedBy;)t=t.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const a=wl.compare(t,r);if(a!==0){if(a>0){const h=t;t=r,r=h}if(t.prev===r){const h=t;t=r,r=h}for(let h=0,m=r.rings.length;h<m;h++){const l=r.rings[h],x=r.windings[h],S=t.rings.indexOf(l);S===-1?(t.rings.push(l),t.windings.push(x)):t.windings[S]+=x}r.rings=null,r.windings=null,r.consumedBy=t,r.leftSE.consumedBy=t.leftSE,r.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,r=this._afterState.windings,a=this._afterState.multiPolys;for(let l=0,x=this.rings.length;l<x;l++){const S=this.rings[l],T=this.windings[l],C=t.indexOf(S);C===-1?(t.push(S),r.push(T)):r[C]+=T}const h=[],m=[];for(let l=0,x=t.length;l<x;l++){if(r[l]===0)continue;const S=t[l],T=S.poly;if(m.indexOf(T)===-1)if(S.isExterior)h.push(T);else{m.indexOf(T)===-1&&m.push(T);const C=h.indexOf(S.poly);C!==-1&&h.splice(C,1)}}for(let l=0,x=h.length;l<x;l++){const S=h[l].multiPoly;a.indexOf(S)===-1&&a.push(S)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Po.type){case"union":{const r=e.length===0,a=t.length===0;this._isInResult=r!==a;break}case"intersection":{let r,a;e.length<t.length?(r=e.length,a=t.length):(r=t.length,a=e.length),this._isInResult=a===Po.numMultiPolys&&r<a;break}case"xor":{const r=Math.abs(e.length-t.length);this._isInResult=r%2===1;break}case"difference":{const r=a=>a.length===1&&a[0].isSubject;this._isInResult=r(e)!==r(t);break}default:throw new Error(`Unrecognized operation type found ${Po.type}`)}return this._isInResult}}class o_{constructor(e,t,r){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=Lh.round(e[0][0],e[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let h=a;for(let m=1,l=e.length;m<l;m++){if(typeof e[m][0]!="number"||typeof e[m][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let x=Lh.round(e[m][0],e[m][1]);x.x===h.x&&x.y===h.y||(this.segments.push(wl.fromRing(h,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),h=x)}(a.x!==h.x||a.y!==h.y)&&this.segments.push(wl.fromRing(h,a,this))}getSweepEvents(){const e=[];for(let t=0,r=this.segments.length;t<r;t++){const a=this.segments[t];e.push(a.leftSE),e.push(a.rightSE)}return e}}class mw{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new o_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,a=e.length;r<a;r++){const h=new o_(e[r],this,!1);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.interiorRings.push(h)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,r=this.interiorRings.length;t<r;t++){const a=this.interiorRings[t].getSweepEvents();for(let h=0,m=a.length;h<m;h++)e.push(a[h])}return e}}class a_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let r=0,a=e.length;r<a;r++){const h=new mw(e[r],this);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.polys.push(h)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,r=this.polys.length;t<r;t++){const a=this.polys[t].getSweepEvents();for(let h=0,m=a.length;h<m;h++)e.push(a[h])}return e}}class Ff{static factory(e){const t=[];for(let r=0,a=e.length;r<a;r++){const h=e[r];if(!h.isInResult()||h.ringOut)continue;let m=null,l=h.leftSE,x=h.rightSE;const S=[l],T=l.point,C=[];for(;m=l,l=x,S.push(l),l.point!==T;)for(;;){const N=l.getAvailableLinkedEvents();if(N.length===0){const ee=S[0].point,ie=S[S.length-1].point;throw new Error(`Unable to complete output ring starting at [${ee.x}, ${ee.y}]. Last matching segment found ends at [${ie.x}, ${ie.y}].`)}if(N.length===1){x=N[0].otherSE;break}let B=null;for(let ee=0,ie=C.length;ee<ie;ee++)if(C[ee].point===l.point){B=ee;break}if(B!==null){const ee=C.splice(B)[0],ie=S.splice(ee.index);ie.unshift(ie[0].otherSE),t.push(new Ff(ie.reverse()));continue}C.push({index:S.length,point:l.point});const U=l.getLeftmostComparator(m);x=N.sort(U)[0].otherSE;break}t.push(new Ff(S))}return t}constructor(e){this.events=e;for(let t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let S=1,T=this.events.length-1;S<T;S++){const C=this.events[S].point,N=this.events[S+1].point;i_(C,e,N)!==0&&(t.push(C),e=C)}if(t.length===1)return null;const r=t[0],a=t[1];i_(r,e,a)===0&&t.shift(),t.push(t[0]);const h=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:t.length-1,l=this.isExteriorRing()?t.length:-1,x=[];for(let S=m;S!=l;S+=h)x.push([t[S].x,t[S].y]);return x}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let a=1,h=this.events.length;a<h;a++){const m=this.events[a];yo.compare(e,m)>0&&(e=m)}let t=e.segment.prevInResult(),r=t?t.prevInResult():null;for(;;){if(!t)return null;if(!r)return t.ringOut;if(r.ringOut!==t.ringOut)return r.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=r.prevInResult(),r=t?t.prevInResult():null}}}class l_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,r=this.interiorRings.length;t<r;t++){const a=this.interiorRings[t].getGeom();a!==null&&e.push(a)}return e}}let gw=class{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,r=this.polys.length;t<r;t++){const a=this.polys[t].getGeom();a!==null&&e.push(a)}return e}_composePolys(e){const t=[];for(let r=0,a=e.length;r<a;r++){const h=e[r];if(!h.poly)if(h.isExteriorRing())t.push(new l_(h));else{const m=h.enclosingRing();m.poly||t.push(new l_(m)),m.poly.addInterior(h)}}return t}};class _w{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wl.compare;this.queue=e,this.tree=new Hp(t),this.segments=[]}process(e){const t=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),r;const a=e.isLeft?this.tree.add(t):this.tree.find(t);if(!a)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let h=a,m=a,l,x;for(;l===void 0;)h=this.tree.prev(h),h===null?l=null:h.key.consumedBy===void 0&&(l=h.key);for(;x===void 0;)m=this.tree.next(m),m===null?x=null:m.key.consumedBy===void 0&&(x=m.key);if(e.isLeft){let S=null;if(l){const C=l.getIntersection(t);if(C!==null&&(t.isAnEndpoint(C)||(S=C),!l.isAnEndpoint(C))){const N=this._splitSafely(l,C);for(let B=0,U=N.length;B<U;B++)r.push(N[B])}}let T=null;if(x){const C=x.getIntersection(t);if(C!==null&&(t.isAnEndpoint(C)||(T=C),!x.isAnEndpoint(C))){const N=this._splitSafely(x,C);for(let B=0,U=N.length;B<U;B++)r.push(N[B])}}if(S!==null||T!==null){let C=null;S===null?C=T:T===null?C=S:C=yo.comparePoints(S,T)<=0?S:T,this.queue.remove(t.rightSE),r.push(t.rightSE);const N=t.split(C);for(let B=0,U=N.length;B<U;B++)r.push(N[B])}r.length>0?(this.tree.remove(t),r.push(e)):(this.segments.push(t),t.prev=l)}else{if(l&&x){const S=l.getIntersection(x);if(S!==null){if(!l.isAnEndpoint(S)){const T=this._splitSafely(l,S);for(let C=0,N=T.length;C<N;C++)r.push(T[C])}if(!x.isAnEndpoint(S)){const T=this._splitSafely(x,S);for(let C=0,N=T.length;C<N;C++)r.push(T[C])}}}this.tree.remove(t)}return r}_splitSafely(e,t){this.tree.remove(e);const r=e.rightSE;this.queue.remove(r);const a=e.split(t);return a.push(r),e.consumedBy===void 0&&this.tree.add(e),a}}const u_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,yw=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class vw{run(e,t,r){Po.type=e,Lh.reset();const a=[new a_(t,!0)];for(let T=0,C=r.length;T<C;T++)a.push(new a_(r[T],!1));if(Po.numMultiPolys=a.length,Po.type==="difference"){const T=a[0];let C=1;for(;C<a.length;)kp(a[C].bbox,T.bbox)!==null?C++:a.splice(C,1)}if(Po.type==="intersection")for(let T=0,C=a.length;T<C;T++){const N=a[T];for(let B=T+1,U=a.length;B<U;B++)if(kp(N.bbox,a[B].bbox)===null)return[]}const h=new Hp(yo.compare);for(let T=0,C=a.length;T<C;T++){const N=a[T].getSweepEvents();for(let B=0,U=N.length;B<U;B++)if(h.insert(N[B]),h.size>u_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const m=new _w(h);let l=h.size,x=h.pop();for(;x;){const T=x.key;if(h.size===l){const N=T.segment;throw new Error(`Unable to pop() ${T.isLeft?"left":"right"} SweepEvent [${T.point.x}, ${T.point.y}] from segment #${N.id} [${N.leftSE.point.x}, ${N.leftSE.point.y}] -> [${N.rightSE.point.x}, ${N.rightSE.point.y}] from queue.`)}if(h.size>u_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(m.segments.length>yw)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const C=m.process(T);for(let N=0,B=C.length;N<B;N++){const U=C[N];U.consumedBy===void 0&&h.insert(U)}l=h.size,x=h.pop()}Lh.reset();const S=Ff.factory(m.segments);return new gw(S).getGeom()}}const Po=new vw,bw=function(s){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return Po.run("union",s,t)},xw=function(s){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return Po.run("intersection",s,t)},ww=function(s){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return Po.run("xor",s,t)},kw=function(s){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return Po.run("difference",s,t)};var _v={union:bw,intersection:xw,xor:ww,difference:kw};function yv(s,e,t){if(s!==null)for(var r,a,h,m,l,x,S,T=0,C=0,N,B=s.type,U=B==="FeatureCollection",ee=B==="Feature",ie=U?s.features.length:1,ae=0;ae<ie;ae++){S=U?s.features[ae].geometry:ee?s.geometry:s,N=S?S.type==="GeometryCollection":!1,l=N?S.geometries.length:1;for(var J=0;J<l;J++){var Y=0,ge=0;if(m=N?S.geometries[J]:S,m!==null){x=m.coordinates;var xe=m.type;switch(T=0,xe){case null:break;case"Point":if(e(x,C,ae,Y,ge)===!1)return!1;C++,Y++;break;case"LineString":case"MultiPoint":for(r=0;r<x.length;r++){if(e(x[r],C,ae,Y,ge)===!1)return!1;C++,xe==="MultiPoint"&&Y++}xe==="LineString"&&Y++;break;case"Polygon":case"MultiLineString":for(r=0;r<x.length;r++){for(a=0;a<x[r].length-T;a++){if(e(x[r][a],C,ae,Y,ge)===!1)return!1;C++}xe==="MultiLineString"&&Y++,xe==="Polygon"&&ge++}xe==="Polygon"&&Y++;break;case"MultiPolygon":for(r=0;r<x.length;r++){for(ge=0,a=0;a<x[r].length;a++){for(h=0;h<x[r][a].length-T;h++){if(e(x[r][a][h],C,ae,Y,ge)===!1)return!1;C++}ge++}Y++}break;case"GeometryCollection":for(r=0;r<m.geometries.length;r++)if(yv(m.geometries[r],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function c_(s,e){if(s.type==="Feature")e(s,0);else if(s.type==="FeatureCollection")for(var t=0;t<s.features.length&&e(s.features[t],t)!==!1;t++);}function id(s,e){var t,r,a,h,m,l,x,S,T,C,N=0,B=s.type==="FeatureCollection",U=s.type==="Feature",ee=B?s.features.length:1;for(t=0;t<ee;t++){for(l=B?s.features[t].geometry:U?s.geometry:s,S=B?s.features[t].properties:U?s.properties:{},T=B?s.features[t].bbox:U?s.bbox:void 0,C=B?s.features[t].id:U?s.id:void 0,x=l?l.type==="GeometryCollection":!1,m=x?l.geometries.length:1,a=0;a<m;a++){if(h=x?l.geometries[a]:l,h===null){if(e(null,N,S,T,C)===!1)return!1;continue}switch(h.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(h,N,S,T,C)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<h.geometries.length;r++)if(e(h.geometries[r],N,S,T,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}N++}}function Iw(s,e={}){const t=[];if(id(s,a=>{t.push(a.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const r=_v.union(t[0],...t.slice(1));return r.length===0?null:r.length===1?Zp(r[0],e.properties):mv(r,e.properties)}var Sw=Iw;function Ew(s,e={}){if(s.bbox!=null&&e.recompute!==!0)return s.bbox;const t=[1/0,1/0,-1/0,-1/0];return yv(s,r=>{t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}function Aw(s,e={}){const t=Ew(s),r=(t[0]+t[2])/2,a=(t[1]+t[3])/2;return Xx([r,a],e.properties,e)}var Tw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cw(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var vv={exports:{}};(function(s,e){(function(t,r){s.exports=r()})(Tw,function(){function t(I,c){if(!(I instanceof c))throw new TypeError("Cannot call a class as a function")}function r(I,c){for(var d=0;d<c.length;d++){var p=c[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(I,p.key,p)}}function a(I,c,d){return c&&r(I.prototype,c),d&&r(I,d),I}function h(I,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(c&&c.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),c&&l(I,c)}function m(I){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},m(I)}function l(I,c){return l=Object.setPrototypeOf||function(d,p){return d.__proto__=p,d},l(I,c)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(I,c,d){return S=x()?Reflect.construct:function(p,b,L){var O=[null];O.push.apply(O,b);var V=new(Function.bind.apply(p,O));return L&&l(V,L.prototype),V},S.apply(null,arguments)}function T(I){var c=typeof Map=="function"?new Map:void 0;return T=function(d){if(d===null||(p=d,Function.toString.call(p).indexOf("[native code]")===-1))return d;var p;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(d))return c.get(d);c.set(d,b)}function b(){return S(d,arguments,m(this).constructor)}return b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),l(b,d)},T(I)}function C(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function N(I,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return C(I)}function B(I){var c=x();return function(){var d,p=m(I);if(c){var b=m(this).constructor;d=Reflect.construct(p,arguments,b)}else d=p.apply(this,arguments);return N(this,d)}}function U(I,c,d){return U=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,b,L){var O=function(K,pe){for(;!Object.prototype.hasOwnProperty.call(K,pe)&&(K=m(K))!==null;);return K}(p,b);if(O){var V=Object.getOwnPropertyDescriptor(O,b);return V.get?V.get.call(L):V.value}},U(I,c,d||I)}function ee(I){return function(c){if(Array.isArray(c))return ae(c)}(I)||function(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(I)||ie(I)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ie(I,c){if(I){if(typeof I=="string")return ae(I,c);var d=Object.prototype.toString.call(I).slice(8,-1);return d==="Object"&&I.constructor&&(d=I.constructor.name),d==="Map"||d==="Set"?Array.from(I):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?ae(I,c):void 0}}function ae(I,c){(c==null||c>I.length)&&(c=I.length);for(var d=0,p=new Array(c);d<c;d++)p[d]=I[d];return p}function J(I,c){var d=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!d){if(Array.isArray(I)||(d=ie(I))||c){d&&(I=d);var p=0,b=function(){};return{s:b,n:function(){return p>=I.length?{done:!0}:{done:!1,value:I[p++]}},e:function(K){throw K},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var L,O=!0,V=!1;return{s:function(){d=d.call(I)},n:function(){var K=d.next();return O=K.done,K},e:function(K){V=!0,L=K},f:function(){try{O||d.return==null||d.return()}finally{if(V)throw L}}}}var Y=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(c){this._quadrantSegments=c,this._quadrantSegments===0&&(this._joinStyle=I.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=I.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),c<=0&&(this._quadrantSegments=1),this._joinStyle!==I.JOIN_ROUND&&(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(c){this._joinStyle=c}},{key:"setSimplifyFactor",value:function(c){this._simplifyFactor=c<0?0:c}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(c){this._endCapStyle=c}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(c){this._mitreLimit=c}},{key:"setSingleSided",value:function(c){this._isSingleSided=c}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=I.CAP_ROUND,this._joinStyle=I.JOIN_ROUND,this._mitreLimit=I.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=I.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var c=arguments[0];this.setQuadrantSegments(c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.setQuadrantSegments(d),this.setEndCapStyle(p)}else if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3];this.setQuadrantSegments(b),this.setEndCapStyle(L),this.setJoinStyle(O),this.setMitreLimit(V)}}}},{key:"bufferDistanceError",value:function(c){var d=Math.PI/2/c;return 1-Math.cos(d/2)}}]),I}();Y.CAP_ROUND=1,Y.CAP_FLAT=2,Y.CAP_SQUARE=3,Y.JOIN_ROUND=1,Y.JOIN_MITRE=2,Y.JOIN_BEVEL=3,Y.DEFAULT_QUADRANT_SEGMENTS=8,Y.DEFAULT_MITRE_LIMIT=5,Y.DEFAULT_SIMPLIFY_FACTOR=.01;var ge=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this,p)).name=Object.keys({Exception:d})[0],b}return a(d,[{key:"toString",value:function(){return this.message}}]),d}(T(Error)),xe=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this,p)).name=Object.keys({IllegalArgumentException:d})[0],b}return d}(ge),Ee=function(){function I(){t(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}();function ye(){}function be(){}function ve(){}var Ce,we,_e,tt,Ve,qe,dt,mt,ct=function(){function I(){t(this,I)}return a(I,null,[{key:"equalsWithTolerance",value:function(c,d,p){return Math.abs(c-d)<=p}}]),I}(),Ut=function(){function I(c,d){t(this,I),this.low=d||0,this.high=c||0}return a(I,null,[{key:"toBinaryString",value:function(c){var d,p="";for(d=2147483648;d>0;d>>>=1)p+=(c.high&d)===d?"1":"0";for(d=2147483648;d>0;d>>>=1)p+=(c.low&d)===d?"1":"0";return p}}]),I}();function bt(){}function It(){}bt.NaN=NaN,bt.isNaN=function(I){return Number.isNaN(I)},bt.isInfinite=function(I){return!Number.isFinite(I)},bt.MAX_VALUE=Number.MAX_VALUE,bt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,bt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(qe=2146435072,dt=new Float64Array(1),mt=new Int32Array(dt.buffer),bt.doubleToLongBits=function(I){dt[0]=I;var c=0|mt[0],d=0|mt[1];return(d&qe)===qe&&1048575&d&&c!==0&&(c=0,d=2146959360),new Ut(d,c)},bt.longBitsToDouble=function(I){return mt[0]=I.low,mt[1]=I.high,dt[0]}):(Ce=1023,we=Math.log2,_e=Math.floor,tt=Math.pow,Ve=function(){for(var I=53;I>0;I--){var c=tt(2,I)-1;if(_e(we(c))+1===I)return c}return 0}(),bt.doubleToLongBits=function(I){var c,d,p,b,L,O,V,K,pe;if(I<0||1/I===Number.NEGATIVE_INFINITY?(O=1<<31,I=-I):O=0,I===0)return new Ut(K=O,pe=0);if(I===1/0)return new Ut(K=2146435072|O,pe=0);if(I!=I)return new Ut(K=2146959360,pe=0);if(b=0,pe=0,(c=_e(I))>1)if(c<=Ve)(b=_e(we(c)))<=20?(pe=0,K=c<<20-b&1048575):(pe=c%(d=tt(2,p=b-20))<<32-p,K=c/d&1048575);else for(p=c,pe=0;(p=_e(d=p/2))!==0;)b++,pe>>>=1,pe|=(1&K)<<31,K>>>=1,d!==p&&(K|=524288);if(V=b+Ce,L=c===0,c=I-c,b<52&&c!==0)for(p=0;;){if((d=2*c)>=1?(c=d-1,L?(V--,L=!1):(p<<=1,p|=1,b++)):(c=d,L?--V==0&&(b++,L=!1):(p<<=1,b++)),b===20)K|=p,p=0;else if(b===52){pe|=p;break}if(d===1){b<20?K|=p<<20-b:b<52&&(pe|=p<<52-b);break}}return K|=V<<20,new Ut(K|=O,pe)},bt.longBitsToDouble=function(I){var c,d,p,b,L=I.high,O=I.low,V=L&1<<31?-1:1;for(p=((2146435072&L)>>20)-Ce,b=0,d=1<<19,c=1;c<=20;c++)L&d&&(b+=tt(2,-c)),d>>>=1;for(d=1<<31,c=21;c<=52;c++)O&d&&(b+=tt(2,-c)),d>>>=1;if(p===-1023){if(b===0)return 0*V;p=-1022}else{if(p===1024)return b===0?V/0:NaN;b+=1}return V*b*tt(2,p)});var pt=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this,p)).name=Object.keys({RuntimeException:d})[0],b}return d}(ge),kt=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){if(arguments.length===0)pt.constructor_.call(this);else if(arguments.length===1){var p=arguments[0];pt.constructor_.call(this,p)}}}]),d}(pt),St=function(){function I(){t(this,I)}return a(I,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)I.shouldNeverReachHere(null);else if(arguments.length===1){var c=arguments[0];throw new kt("Should never reach here"+(c!==null?": "+c:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var c=arguments[0];I.isTrue(c,null)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(!d)throw p===null?new kt:new kt(p)}}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];I.equals(c,d,null)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];if(!b.equals(p))throw new kt("Expected "+p+" but encountered "+b+(L!==null?": "+L:""))}}}]),I}(),$t=new ArrayBuffer(8),pn=new Float64Array($t),Pn=new Int32Array($t),We=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(){return bt.NaN}},{key:"setOrdinate",value:function(c,d){switch(c){case I.X:this.x=d;break;case I.Y:this.y=d;break;case I.Z:this.setZ(d);break;default:throw new xe("Invalid ordinate index: "+c)}}},{key:"equals2D",value:function(){if(arguments.length===1){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(arguments.length===2){var d=arguments[0],p=arguments[1];return!!ct.equalsWithTolerance(this.x,d.x,p)&&!!ct.equalsWithTolerance(this.y,d.y,p)}}},{key:"setM",value:function(c){throw new xe("Invalid ordinate index: "+I.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(c){switch(c){case I.X:return this.x;case I.Y:return this.y;case I.Z:return this.getZ()}throw new xe("Invalid ordinate index: "+c)}},{key:"equals3D",value:function(c){return this.x===c.x&&this.y===c.y&&(this.getZ()===c.getZ()||bt.isNaN(this.getZ())&&bt.isNaN(c.getZ()))}},{key:"equals",value:function(c){return c instanceof I&&this.equals2D(c)}},{key:"equalInZ",value:function(c,d){return ct.equalsWithTolerance(this.getZ(),c.getZ(),d)}},{key:"setX",value:function(c){this.x=c}},{key:"compareTo",value:function(c){var d=c;return this.x<d.x?-1:this.x>d.x?1:this.y<d.y?-1:this.y>d.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(c){this.z=c}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return St.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw c}}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(c){var d=this.x-c.x,p=this.y-c.y,b=this.getZ()-c.getZ();return Math.sqrt(d*d+p*p+b*b)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(c){this.y=c}},{key:"distance",value:function(c){var d=this.x-c.x,p=this.y-c.y;return Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*c+I.hashCode(this.x))+I.hashCode(this.y)}},{key:"setCoordinate",value:function(c){this.x=c.x,this.y=c.y,this.z=c.getZ()}},{key:"interfaces_",get:function(){return[ye,be,ve]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)I.constructor_.call(this,0,0);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.x,c.y,c.getZ())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];I.constructor_.call(this,d,p,I.NULL_ORDINATE)}else if(arguments.length===3){var b=arguments[0],L=arguments[1],O=arguments[2];this.x=b,this.y=L,this.z=O}}},{key:"hashCode",value:function(c){return pn[0]=c,Pn[0]^Pn[1]}}]),I}(),Kn=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compare",value:function(c,d){var p=I.compare(c.x,d.x);if(p!==0)return p;var b=I.compare(c.y,d.y);return b!==0?b:this._dimensionsToTest<=2?0:I.compare(c.getZ(),d.getZ())}},{key:"interfaces_",get:function(){return[It]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)I.constructor_.call(this,2);else if(arguments.length===1){var c=arguments[0];if(c!==2&&c!==3)throw new xe("only 2 or 3 dimensions may be specified");this._dimensionsToTest=c}}},{key:"compare",value:function(c,d){return c<d?-1:c>d?1:bt.isNaN(c)?bt.isNaN(d)?0:-1:bt.isNaN(d)?1:0}}]),I}();We.DimensionalComparator=Kn,We.NULL_ORDINATE=bt.NaN,We.X=0,We.Y=1,We.Z=2,We.M=3;var dn=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()}},{key:"intersection",value:function(c){if(this.isNull()||c.isNull()||!this.intersects(c))return new I;var d=this._minx>c._minx?this._minx:c._minx,p=this._miny>c._miny?this._miny:c._miny;return new I(d,this._maxx<c._maxx?this._maxx:c._maxx,p,this._maxy<c._maxy?this._maxy:c._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];return this.covers(c.x,c.y)}if(arguments[0]instanceof I){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return!this.isNull()&&p>=this._minx&&p<=this._maxx&&b>=this._miny&&b<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return!this.isNull()&&!c.isNull()&&!(c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny)}if(arguments[0]instanceof We){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(arguments.length===2){if(arguments[0]instanceof We&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1];if(this.isNull())return!1;var L=p.x<b.x?p.x:b.x;if(L>this._maxx)return!1;var O=p.x>b.x?p.x:b.x;if(O<this._minx)return!1;var V=p.y<b.y?p.y:b.y;if(V>this._maxy)return!1;var K=p.y>b.y?p.y:b.y;return!(K<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var pe=arguments[0],Be=arguments[1];return!this.isNull()&&!(pe>this._maxx||pe<this._minx||Be>this._maxy||Be<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return Math.sqrt(c*c+d*d)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.expandToInclude(c.x,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.isNull()?(this._minx=p,this._maxx=p,this._miny=b,this._maxy=b):(p<this._minx&&(this._minx=p),p>this._maxx&&(this._maxx=p),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c<d?c:d}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(c){var d=c;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0}},{key:"translate",value:function(c,d){if(this.isNull())return null;this.init(this.getMinX()+c,this.getMaxX()+c,this.getMinY()+d,this.getMaxY()+d)}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(c){return!(!this.isNull()&&!c.isNull())||c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c>d?c:d}},{key:"expandBy",value:function(){if(arguments.length===1){var c=arguments[0];this.expandBy(c,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=p,this._maxy+=p,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.covers(c)}if(arguments[0]instanceof We){var d=arguments[0];return this.covers(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.covers(p,b)}}},{key:"centre",value:function(){return this.isNull()?null:new We((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];L<O?(this._minx=L,this._maxx=O):(this._minx=O,this._maxx=L),V<K?(this._miny=V,this._maxy=K):(this._miny=K,this._maxy=V)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(c){if(this.intersects(c))return 0;var d=0;this._maxx<c._minx?d=c._minx-this._maxx:this._minx>c._maxx&&(d=this._minx-c._maxx);var p=0;return this._maxy<c._miny?p=c._miny-this._maxy:this._miny>c._maxy&&(p=this._miny-c._maxy),d===0?p:p===0?d:Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*(c=37*(c=37*c+We.hashCode(this._minx))+We.hashCode(this._maxx))+We.hashCode(this._miny))+We.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[ye,ve]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];this.init(L,O,V,K)}}},{key:"intersects",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2];return p.x>=(c.x<d.x?c.x:d.x)&&p.x<=(c.x>d.x?c.x:d.x)&&p.y>=(c.y<d.y?c.y:d.y)&&p.y<=(c.y>d.y?c.y:d.y)}if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3],K=Math.min(O.x,V.x),pe=Math.max(O.x,V.x),Be=Math.min(b.x,L.x),$e=Math.max(b.x,L.x);return!(Be>pe)&&!($e<K)&&(K=Math.min(O.y,V.y),pe=Math.max(O.y,V.y),Be=Math.min(b.y,L.y),$e=Math.max(b.y,L.y),!(Be>pe)&&!($e<K))}}}]),I}(),Ot=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(c){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(c){return this===c||this.equalsExact(c,0)}},{key:"geometryChanged",value:function(){this.apply(I.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(c){return c!==null&&this.norm().equalsExact(c.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var c;if(arguments.length===1){var d=arguments[0];return c=d,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(d)}if(arguments.length===2){var p=arguments[0],b=arguments[1];return c=p,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(p,b)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(c){if(c.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION)throw new xe("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(c,d,p){return p===0?c.equals(d):c.distance(d)<=p}},{key:"norm",value:function(){var c=this.copy();return c.normalize(),c}},{key:"reverse",value:function(){var c=this.reverseInternal();return this.envelope!=null&&(c.envelope=this.envelope.copy()),c.setSRID(this.getSRID()),c}},{key:"copy",value:function(){var c=this.copyInternal();return c.envelope=this._envelope==null?null:this._envelope.copy(),c._SRID=this._SRID,c._userData=this._userData,c}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new dn(this._envelope)}},{key:"setSRID",value:function(c){this._SRID=c}},{key:"setUserData",value:function(c){this._userData=c}},{key:"compare",value:function(c,d){for(var p=c.iterator(),b=d.iterator();p.hasNext()&&b.hasNext();){var L=p.next(),O=b.next(),V=L.compareTo(O);if(V!==0)return V}return p.hasNext()?1:b.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(c){return this.getClass()===c.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===I.TYPECODE_MULTIPOINT||this.getTypeCode()===I.TYPECODE_MULTILINESTRING||this.getTypeCode()===I.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[be,ye,ve]}},{key:"getClass",value:function(){return I}}],[{key:"hasNonEmptyElements",value:function(c){for(var d=0;d<c.length;d++)if(!c[d].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(c){for(var d=0;d<c.length;d++)if(c[d]===null)return!0;return!1}}]),I}();Ot.constructor_=function(I){I&&(this._envelope=null,this._userData=null,this._factory=I,this._SRID=I.getSRID())},Ot.TYPECODE_POINT=0,Ot.TYPECODE_MULTIPOINT=1,Ot.TYPECODE_LINESTRING=2,Ot.TYPECODE_LINEARRING=3,Ot.TYPECODE_MULTILINESTRING=4,Ot.TYPECODE_POLYGON=5,Ot.TYPECODE_MULTIPOLYGON=6,Ot.TYPECODE_GEOMETRYCOLLECTION=7,Ot.TYPENAME_POINT="Point",Ot.TYPENAME_MULTIPOINT="MultiPoint",Ot.TYPENAME_LINESTRING="LineString",Ot.TYPENAME_LINEARRING="LinearRing",Ot.TYPENAME_MULTILINESTRING="MultiLineString",Ot.TYPENAME_POLYGON="Polygon",Ot.TYPENAME_MULTIPOLYGON="MultiPolygon",Ot.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Ot.geometryChangedFilter={get interfaces_(){return[Ee]},filter:function(I){I.geometryChangedAction()}};var Ae=function(){function I(){t(this,I)}return a(I,null,[{key:"toLocationSymbol",value:function(c){switch(c){case I.EXTERIOR:return"e";case I.BOUNDARY:return"b";case I.INTERIOR:return"i";case I.NONE:return"-"}throw new xe("Unknown location value: "+c)}}]),I}();Ae.INTERIOR=0,Ae.BOUNDARY=1,Ae.EXTERIOR=2,Ae.NONE=-1;var ut=function(){function I(){t(this,I)}return a(I,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),I}(),Ye=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this,p)).name=Object.keys({NoSuchElementException:d})[0],b}return d}(ge),Lt=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this,p)).name=Object.keys({UnsupportedOperationException:d})[0],b}return d}(ge),Ke=function(I){h(d,I);var c=B(d);function d(){return t(this,d),c.apply(this,arguments)}return a(d,[{key:"contains",value:function(){}}]),d}(ut),On=function(I,c){h(p,I);var d=B(p);function p(b){var L;return t(this,p),(L=d.call(this)).map=new Map,b instanceof ut&&L.addAll(b),L}return a(p,[{key:"contains",value:function(b){var L=b.hashCode?b.hashCode():b;return!!this.map.has(L)}},{key:"add",value:function(b){var L=b.hashCode?b.hashCode():b;return!this.map.has(L)&&!!this.map.set(L,b)}},{key:"addAll",value:function(b){var L,O=J(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;this.add(V)}}catch(K){O.e(K)}finally{O.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new xt(this.map)}},{key:c,value:function(){return this.map}}]),p}(Ke,Symbol.iterator),xt=function(){function I(c){t(this,I),this.iterator=c.values();var d=this.iterator.next(),p=d.done,b=d.value;this.done=p,this.value=b}return a(I,[{key:"next",value:function(){if(this.done)throw new Ye;var c=this.value,d=this.iterator.next(),p=d.done,b=d.value;return this.done=p,this.value=b,c}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Lt}}]),I}(),Se=function(){function I(){t(this,I)}return a(I,null,[{key:"opposite",value:function(c){return c===I.LEFT?I.RIGHT:c===I.RIGHT?I.LEFT:c}}]),I}();Se.ON=0,Se.LEFT=1,Se.RIGHT=2;var Bt=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this,p)).name=Object.keys({EmptyStackException:d})[0],b}return d}(ge),Mn=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this,p)).name=Object.keys({IndexOutOfBoundsException:d})[0],b}return d}(ge),Fn=function(I){h(d,I);var c=B(d);function d(){return t(this,d),c.apply(this,arguments)}return a(d,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),d}(ut),ei=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),(p=c.call(this)).array=[],p}return a(d,[{key:"add",value:function(p){return this.array.push(p),!0}},{key:"get",value:function(p){if(p<0||p>=this.size())throw new Mn;return this.array[p]}},{key:"push",value:function(p){return this.array.push(p),p}},{key:"pop",value:function(){if(this.array.length===0)throw new Bt;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Bt;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(p){return this.array.indexOf(p)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),d}(Fn);function Jt(I,c){return I.interfaces_&&I.interfaces_.indexOf(c)>-1}var Ri=function(){function I(c){t(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),Qi=function(){function I(c){t(this,I),this.value=c}return a(I,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(c){return this.value<c?-1:this.value>c?1:0}}],[{key:"compare",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"isNan",value:function(c){return Number.isNaN(c)}},{key:"valueOf",value:function(c){return new I(c)}}]),I}(),ns=function(){function I(){t(this,I)}return a(I,null,[{key:"isWhitespace",value:function(c){return c<=32&&c>=0||c===127}},{key:"toUpperCase",value:function(c){return c.toUpperCase()}}]),I}(),ht=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"le",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<=c._lo}},{key:"extractSignificantDigits",value:function(c,d){var p=this.abs(),b=I.magnitude(p._hi),L=I.TEN.pow(b);(p=p.divide(L)).gt(I.TEN)?(p=p.divide(I.TEN),b+=1):p.lt(I.ONE)&&(p=p.multiply(I.TEN),b-=1);for(var O=b+1,V=new Ri,K=I.MAX_PRINT_DIGITS-1,pe=0;pe<=K;pe++){c&&pe===O&&V.append(".");var Be=Math.trunc(p._hi);if(Be<0)break;var $e=!1,gt=0;Be>9?($e=!0,gt="9"):gt="0"+Be,V.append(gt),p=p.subtract(I.valueOf(Be)).multiply(I.TEN),$e&&p.selfAdd(I.TEN);var Ft=!0,zt=I.magnitude(p._hi);if(zt<0&&Math.abs(zt)>=K-pe&&(Ft=!1),!Ft)break}return d[0]=b,V.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.add(c.negate())}if(typeof arguments[0]=="number"){var d=arguments[0];return this.add(-d)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof I){var c=arguments[0];return this._hi===c._hi&&this._lo===c._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.isNaN()?this:this.selfAdd(-c._hi,-c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(c){return this.le(c)?this:c}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfDivide(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfDivide(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],L=null,O=null,V=null,K=null,pe=null,Be=null,$e=null,gt=null;return pe=this._hi/p,gt=(L=(Be=I.SPLIT*pe)-(L=Be-pe))*(V=(gt=I.SPLIT*p)-(V=gt-p))-($e=pe*p)+L*(K=p-V)+(O=pe-L)*V+O*K,gt=pe+(Be=(this._hi-$e-gt+this._lo-pe*b)/p),this._hi=gt,this._lo=pe-gt+Be,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=null,p=null,b=null,L=null,O=null,V=null,K=null,pe=null;p=(O=this._hi/c._hi)-(d=(V=I.SPLIT*O)-(d=V-O)),pe=d*(b=(pe=I.SPLIT*c._hi)-(b=pe-c._hi))-(K=O*c._hi)+d*(L=c._hi-b)+p*b+p*L;var Be=pe=O+(V=(this._hi-K-pe+this._lo-O*c._lo)/c._hi),$e=O-pe+V;return new I(Be,$e)}if(typeof arguments[0]=="number"){var gt=arguments[0];return bt.isNaN(gt)?I.createNaN():I.copy(this).selfDivide(gt,0)}}},{key:"ge",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>=c._lo}},{key:"pow",value:function(c){if(c===0)return I.valueOf(1);var d=new I(this),p=I.valueOf(1),b=Math.abs(c);if(b>1)for(;b>0;)b%2==1&&p.selfMultiply(d),(b/=2)>0&&(d=d.sqr());else p=d;return c<0?p.reciprocal():p}},{key:"ceil",value:function(){if(this.isNaN())return I.NaN;var c=Math.ceil(this._hi),d=0;return c===this._hi&&(d=Math.ceil(this._lo)),new I(c,d)}},{key:"compareTo",value:function(c){var d=c;return this._hi<d._hi?-1:this._hi>d._hi?1:this._lo<d._lo?-1:this._lo>d._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.init(c),this}if(typeof arguments[0]=="number"){var d=arguments[0];return this.init(d),this}}},{key:"max",value:function(c){return this.ge(c)?this:c}},{key:"sqrt",value:function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var c=1/Math.sqrt(this._hi),d=this._hi*c,p=I.valueOf(d),b=this.subtract(p.sqr())._hi*(.5*c);return p.add(b)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfAdd(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0],p=null,b=null,L=null,O=null,V=null,K=null;return O=(L=this._hi+d)-(V=L-this._hi),b=(K=(O=d-V+(this._hi-O))+this._lo)+(L-(p=L+K)),this._hi=p+b,this._lo=b+(p-this._hi),this}}else if(arguments.length===2){var pe=arguments[0],Be=arguments[1],$e=null,gt=null,Ft=null,zt=null,gn=null,vn=null,Ln=null;zt=this._hi+pe,gt=this._lo+Be,gn=zt-(vn=zt-this._hi),Ft=gt-(Ln=gt-this._lo);var ii=($e=zt+(vn=(gn=pe-vn+(this._hi-gn))+gt))+(vn=(Ft=Be-Ln+(this._lo-Ft))+(vn+(zt-$e))),gi=vn+($e-ii);return this._hi=ii,this._lo=gi,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfMultiply(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfMultiply(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],L=null,O=null,V=null,K=null,pe=null,Be=null;L=(pe=I.SPLIT*this._hi)-this._hi,Be=I.SPLIT*p,L=pe-L,O=this._hi-L,V=Be-p;var $e=(pe=this._hi*p)+(Be=L*(V=Be-V)-pe+L*(K=p-V)+O*V+O*K+(this._hi*b+this._lo*p)),gt=Be+(L=pe-$e);return this._hi=$e,this._lo=gt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return I.NaN;var c=Math.floor(this._hi),d=0;return c===this._hi&&(d=Math.floor(this._lo)),new I(c,d)}},{key:"negate",value:function(){return this.isNaN()?this:new I(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return null;throw c}}},{key:"multiply",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return c.isNaN()?I.createNaN():I.copy(this).selfMultiply(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return bt.isNaN(d)?I.createNaN():I.copy(this).selfMultiply(d,0)}}},{key:"isNaN",value:function(){return bt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var c=I.magnitude(this._hi);return c>=-3&&c<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!0,d),b=d[0]+1,L=p;if(p.charAt(0)===".")L="0"+p;else if(b<0)L="0."+I.stringOfChar("0",-b)+p;else if(p.indexOf(".")===-1){var O=b-p.length;L=p+I.stringOfChar("0",O)+".0"}return this.isNegative()?"-"+L:L}},{key:"reciprocal",value:function(){var c,d,p,b,L=null,O=null,V=null,K=null;c=(p=1/this._hi)-(L=(V=I.SPLIT*p)-(L=V-p)),O=(K=I.SPLIT*this._hi)-this._hi;var pe=p+(V=(1-(b=p*this._hi)-(K=L*(O=K-O)-b+L*(d=this._hi-O)+c*O+c*d)-p*this._lo)/this._hi);return new I(pe,p-pe+V)}},{key:"toSciNotation",value:function(){if(this.isZero())return I.SCI_NOT_ZERO;var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!1,d),b=I.SCI_NOT_EXPONENT_CHAR+d[0];if(p.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+p);var L="";p.length>1&&(L=p.substring(1));var O=p.charAt(0)+"."+L;return this.isNegative()?"-"+O+b:O+b}},{key:"abs",value:function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<c._lo}},{key:"add",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return I.copy(this).selfAdd(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return I.copy(this).selfAdd(d)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this._hi=c,this._lo=0}else if(arguments[0]instanceof I){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this._hi=p,this._lo=b}}},{key:"gt",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>c._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[ve,ye,be]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this.init(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}else if(typeof arguments[0]=="string"){var p=arguments[0];I.constructor_.call(this,I.parse(p))}}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.init(b,L)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];return I.determinant(I.valueOf(c),I.valueOf(d),I.valueOf(p),I.valueOf(b))}if(arguments[3]instanceof I&&arguments[2]instanceof I&&arguments[0]instanceof I&&arguments[1]instanceof I){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3],pe=L.multiply(K).selfSubtract(O.multiply(V));return pe}}},{key:"sqr",value:function(c){return I.valueOf(c).selfMultiply(c)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var c=arguments[0];return I.parse(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return new I(d)}}},{key:"sqrt",value:function(c){return I.valueOf(c).sqrt()}},{key:"parse",value:function(c){for(var d=0,p=c.length;ns.isWhitespace(c.charAt(d));)d++;var b=!1;if(d<p){var L=c.charAt(d);L!=="-"&&L!=="+"||(d++,L==="-"&&(b=!0))}for(var O=new I,V=0,K=0,pe=0,Be=!1;!(d>=p);){var $e=c.charAt(d);if(d++,ns.isDigit($e)){var gt=$e-"0";O.selfMultiply(I.TEN),O.selfAdd(gt),V++}else{if($e!=="."){if($e==="e"||$e==="E"){var Ft=c.substring(d);try{pe=Qi.parseInt(Ft)}catch(ii){throw ii instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Ft+" in string "+c):ii}break}throw new NumberFormatException("Unexpected character '"+$e+"' at position "+d+" in string "+c)}K=V,Be=!0}}var zt=O;Be||(K=V);var gn=V-K-pe;if(gn===0)zt=O;else if(gn>0){var vn=I.TEN.pow(gn);zt=O.divide(vn)}else if(gn<0){var Ln=I.TEN.pow(-gn);zt=O.multiply(Ln)}return b?zt.negate():zt}},{key:"createNaN",value:function(){return new I(bt.NaN,bt.NaN)}},{key:"copy",value:function(c){return new I(c)}},{key:"magnitude",value:function(c){var d=Math.abs(c),p=Math.log(d)/Math.log(10),b=Math.trunc(Math.floor(p));return 10*Math.pow(10,b)<=d&&(b+=1),b}},{key:"stringOfChar",value:function(c,d){for(var p=new Ri,b=0;b<d;b++)p.append(c);return p.toString()}}]),I}();ht.PI=new ht(3.141592653589793,12246467991473532e-32),ht.TWO_PI=new ht(6.283185307179586,24492935982947064e-32),ht.PI_2=new ht(1.5707963267948966,6123233995736766e-32),ht.E=new ht(2.718281828459045,14456468917292502e-32),ht.NaN=new ht(bt.NaN,bt.NaN),ht.EPS=123259516440783e-46,ht.SPLIT=134217729,ht.MAX_PRINT_DIGITS=32,ht.TEN=ht.valueOf(10),ht.ONE=ht.valueOf(1),ht.SCI_NOT_EXPONENT_CHAR="E",ht.SCI_NOT_ZERO="0.0E0";var vr=function(){function I(){t(this,I)}return a(I,null,[{key:"orientationIndex",value:function(c,d,p){var b=I.orientationIndexFilter(c,d,p);if(b<=1)return b;var L=ht.valueOf(d.x).selfAdd(-c.x),O=ht.valueOf(d.y).selfAdd(-c.y),V=ht.valueOf(p.x).selfAdd(-d.x),K=ht.valueOf(p.y).selfAdd(-d.y);return L.selfMultiply(K).selfSubtract(O.selfMultiply(V)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof ht&&arguments[2]instanceof ht&&arguments[0]instanceof ht&&arguments[1]instanceof ht){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3],L=c.multiply(b).selfSubtract(d.multiply(p));return L.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var O=arguments[0],V=arguments[1],K=arguments[2],pe=arguments[3],Be=ht.valueOf(O),$e=ht.valueOf(V),gt=ht.valueOf(K),Ft=ht.valueOf(pe),zt=Be.multiply(Ft).selfSubtract($e.multiply(gt));return zt.signum()}}},{key:"intersection",value:function(c,d,p,b){var L=new ht(c.y).selfSubtract(d.y),O=new ht(d.x).selfSubtract(c.x),V=new ht(c.x).selfMultiply(d.y).selfSubtract(new ht(d.x).selfMultiply(c.y)),K=new ht(p.y).selfSubtract(b.y),pe=new ht(b.x).selfSubtract(p.x),Be=new ht(p.x).selfMultiply(b.y).selfSubtract(new ht(b.x).selfMultiply(p.y)),$e=O.multiply(Be).selfSubtract(pe.multiply(V)),gt=K.multiply(V).selfSubtract(L.multiply(Be)),Ft=L.multiply(pe).selfSubtract(K.multiply(O)),zt=$e.selfDivide(Ft).doubleValue(),gn=gt.selfDivide(Ft).doubleValue();return bt.isNaN(zt)||bt.isInfinite(zt)||bt.isNaN(gn)||bt.isInfinite(gn)?null:new We(zt,gn)}},{key:"orientationIndexFilter",value:function(c,d,p){var b=null,L=(c.x-p.x)*(d.y-p.y),O=(c.y-p.y)*(d.x-p.x),V=L-O;if(L>0){if(O<=0)return I.signum(V);b=L+O}else{if(!(L<0)||O>=0)return I.signum(V);b=-L-O}var K=I.DP_SAFE_EPSILON*b;return V>=K||-V>=K?I.signum(V):2}},{key:"signum",value:function(c){return c>0?1:c<0?-1:0}}]),I}();vr.DP_SAFE_EPSILON=1e-15;var xn=function(){function I(){t(this,I)}return a(I,[{key:"getM",value:function(c){if(this.hasM()){var d=this.getDimension()-this.getMeasures();return this.getOrdinate(c,d)}return bt.NaN}},{key:"setOrdinate",value:function(c,d,p){}},{key:"getZ",value:function(c){return this.hasZ()?this.getOrdinate(c,2):bt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(c,d){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(c){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(c){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(c){}},{key:"copy",value:function(){}},{key:"getY",value:function(c){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[be]}}]),I}();xn.X=0,xn.Y=1,xn.Z=2,xn.M=3;var mn=function(){function I(){t(this,I)}return a(I,null,[{key:"index",value:function(c,d,p){return vr.orientationIndex(c,d,p)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var c=arguments[0],d=c.length-1;if(d<3)throw new xe("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=c[0],b=0,L=1;L<=d;L++){var O=c[L];O.y>p.y&&(p=O,b=L)}var V=b;do(V-=1)<0&&(V=d);while(c[V].equals2D(p)&&V!==b);var K=b;do K=(K+1)%d;while(c[K].equals2D(p)&&K!==b);var pe=c[V],Be=c[K];if(pe.equals2D(p)||Be.equals2D(p)||pe.equals2D(Be))return!1;var $e=I.index(pe,p,Be),gt=null;return gt=$e===0?pe.x>Be.x:$e>0,gt}if(Jt(arguments[0],xn)){var Ft=arguments[0],zt=Ft.size()-1;if(zt<3)throw new xe("Ring has fewer than 4 points, so orientation cannot be determined");for(var gn=Ft.getCoordinate(0),vn=0,Ln=1;Ln<=zt;Ln++){var ii=Ft.getCoordinate(Ln);ii.y>gn.y&&(gn=ii,vn=Ln)}var gi=null,ui=vn;do(ui-=1)<0&&(ui=zt),gi=Ft.getCoordinate(ui);while(gi.equals2D(gn)&&ui!==vn);var nr=null,us=vn;do us=(us+1)%zt,nr=Ft.getCoordinate(us);while(nr.equals2D(gn)&&us!==vn);if(gi.equals2D(gn)||nr.equals2D(gn)||gi.equals2D(nr))return!1;var Ps=I.index(gi,gn,nr);return Ps===0?gi.x>nr.x:Ps>0}}}]),I}();mn.CLOCKWISE=-1,mn.RIGHT=mn.CLOCKWISE,mn.COUNTERCLOCKWISE=1,mn.LEFT=mn.COUNTERCLOCKWISE,mn.COLLINEAR=0,mn.STRAIGHT=mn.COLLINEAR;var Rs=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(c,d){var p=this.getRightmostSideOfSegment(c,d);return p<0&&(p=this.getRightmostSideOfSegment(c,d-1)),p<0&&(this._minCoord=null,this.checkForRightmostCoordinate(c)),p}},{key:"findRightmostEdgeAtVertex",value:function(){var c=this._minDe.getEdge().getCoordinates();St.isTrue(this._minIndex>0&&this._minIndex<c.length,"rightmost point expected to be interior vertex of edge");var d=c[this._minIndex-1],p=c[this._minIndex+1],b=mn.index(this._minCoord,p,d),L=!1;(d.y<this._minCoord.y&&p.y<this._minCoord.y&&b===mn.COUNTERCLOCKWISE||d.y>this._minCoord.y&&p.y>this._minCoord.y&&b===mn.CLOCKWISE)&&(L=!0),L&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(c,d){var p=c.getEdge().getCoordinates();if(d<0||d+1>=p.length||p[d].y===p[d+1].y)return-1;var b=Se.LEFT;return p[d].y<p[d+1].y&&(b=Se.RIGHT),b}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(c){for(var d=c.getEdge().getCoordinates(),p=0;p<d.length-1;p++)(this._minCoord===null||d[p].x>this._minCoord.x)&&(this._minDe=c,this._minIndex=p,this._minCoord=d[p])}},{key:"findRightmostEdgeAtNode",value:function(){var c=this._minDe.getNode().getEdges();this._minDe=c.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();p.isForward()&&this.checkForRightmostCoordinate(p)}St.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Se.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),I}(),Rt=function(I){h(d,I);var c=B(d);function d(p,b){var L;return t(this,d),(L=c.call(this,b?p+" [ "+b+" ]":p)).pt=b?new We(b):void 0,L.name=Object.keys({TopologyException:d})[0],L}return a(d,[{key:"getCoordinate",value:function(){return this.pt}}]),d}(pt),An=function(){function I(){t(this,I),this.array=[]}return a(I,[{key:"addLast",value:function(c){this.array.push(c)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),I}(),At=function(I,c){h(p,I);var d=B(p);function p(b){var L;return t(this,p),(L=d.call(this)).array=[],b instanceof ut&&L.addAll(b),L}return a(p,[{key:"interfaces_",get:function(){return[Fn,ut]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(b){return arguments.length===1?this.array.push(b):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(b){var L,O=J(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;this.array.push(V)}}catch(K){O.e(K)}finally{O.f()}}},{key:"set",value:function(b,L){var O=this.array[b];return this.array[b]=L,O}},{key:"iterator",value:function(){return new br(this)}},{key:"get",value:function(b){if(b<0||b>=this.size())throw new Mn;return this.array[b]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(b){b?this.array.sort(function(L,O){return b.compare(L,O)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(b){for(var L=0,O=this.array.length;L<O;L++)if(this.array[L]===b)return!!this.array.splice(L,1);return!1}},{key:c,value:function(){return this.array.values()}}]),p}(Fn,Symbol.iterator),br=function(){function I(c){t(this,I),this.arrayList=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Ye;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(c){return this.arrayList.set(this.position-1,c)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),I}(),Wr=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"clearVisitedEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();)c.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(c){for(var d=null,p=c.getEdges().iterator();p.hasNext();){var b=p.next();if(b.isVisited()||b.getSym().isVisited()){d=b;break}}if(d===null)throw new Rt("unable to find edge to compute depths at "+c.getCoordinate());c.getEdges().computeDepths(d);for(var L=c.getEdges().iterator();L.hasNext();){var O=L.next();O.setVisited(!0),this.copySymDepths(O)}}},{key:"computeDepth",value:function(c){this.clearVisitedEdges();var d=this._finder.getEdge();d.getNode(),d.getLabel(),d.setEdgeDepths(Se.RIGHT,c),this.copySymDepths(d),this.computeDepths(d)}},{key:"create",value:function(c){this.addReachable(c),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();){var d=c.next();d.getDepth(Se.RIGHT)>=1&&d.getDepth(Se.LEFT)<=0&&!d.isInteriorAreaEdge()&&d.setInResult(!0)}}},{key:"computeDepths",value:function(c){var d=new On,p=new An,b=c.getNode();for(p.addLast(b),d.add(b),c.setVisited(!0);!p.isEmpty();){var L=p.removeFirst();d.add(L),this.computeNodeDepth(L);for(var O=L.getEdges().iterator();O.hasNext();){var V=O.next().getSym();if(!V.isVisited()){var K=V.getNode();d.contains(K)||(p.addLast(K),d.add(K))}}}}},{key:"compareTo",value:function(c){var d=c;return this._rightMostCoord.x<d._rightMostCoord.x?-1:this._rightMostCoord.x>d._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var c=new dn,d=this._dirEdgeList.iterator();d.hasNext();)for(var p=d.next().getEdge().getCoordinates(),b=0;b<p.length-1;b++)c.expandToInclude(p[b]);this._env=c}return this._env}},{key:"addReachable",value:function(c){var d=new ei;for(d.add(c);!d.empty();){var p=d.pop();this.add(p,d)}}},{key:"copySymDepths",value:function(c){var d=c.getSym();d.setDepth(Se.LEFT,c.getDepth(Se.RIGHT)),d.setDepth(Se.RIGHT,c.getDepth(Se.LEFT))}},{key:"add",value:function(c,d){c.setVisited(!0),this._nodes.add(c);for(var p=c.getEdges().iterator();p.hasNext();){var b=p.next();this._dirEdgeList.add(b);var L=b.getSym().getNode();L.isVisited()||d.push(L)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[ye]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new At,this._nodes=new At,this._rightMostCoord=null,this._env=null,this._finder=new Rs}}]),I}(),bn=function(){function I(){t(this,I)}return a(I,null,[{key:"intersection",value:function(c,d,p,b){var L=c.x<d.x?c.x:d.x,O=c.y<d.y?c.y:d.y,V=c.x>d.x?c.x:d.x,K=c.y>d.y?c.y:d.y,pe=p.x<b.x?p.x:b.x,Be=p.y<b.y?p.y:b.y,$e=p.x>b.x?p.x:b.x,gt=p.y>b.y?p.y:b.y,Ft=((L>pe?L:pe)+(V<$e?V:$e))/2,zt=((O>Be?O:Be)+(K<gt?K:gt))/2,gn=c.x-Ft,vn=c.y-zt,Ln=d.x-Ft,ii=d.y-zt,gi=p.x-Ft,ui=p.y-zt,nr=b.x-Ft,us=b.y-zt,Ps=vn-ii,di=Ln-gn,Rr=gn*ii-Ln*vn,pr=ui-us,Ds=nr-gi,Ya=gi*us-nr*ui,xa=Ps*Ds-pr*di,lo=(di*Ya-Ds*Rr)/xa,Is=(pr*Rr-Ps*Ya)/xa;return bt.isNaN(lo)||bt.isInfinite(lo)||bt.isNaN(Is)||bt.isInfinite(Is)?null:new We(lo+Ft,Is+zt)}}]),I}(),Pi=function(){function I(){t(this,I)}return a(I,null,[{key:"arraycopy",value:function(c,d,p,b,L){for(var O=0,V=d;V<d+L;V++)p[b+O]=c[V],O++}},{key:"getProperty",value:function(c){return{"line.separator":`
`}[c]}}]),I}(),Ar=function(){function I(){t(this,I)}return a(I,null,[{key:"log10",value:function(c){var d=Math.log(c);return bt.isInfinite(d)||bt.isNaN(d)?d:d/I.LOG_10}},{key:"min",value:function(c,d,p,b){var L=c;return d<L&&(L=d),p<L&&(L=p),b<L&&(L=b),L}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2];return c<d?d:c>p?p:c}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],L=arguments[1],O=arguments[2];return b<L?L:b>O?O:b}}},{key:"wrap",value:function(c,d){return c<0?d- -c%d:c%d}},{key:"max",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2],b=c;return d>b&&(b=d),p>b&&(b=p),b}if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3],pe=L;return O>pe&&(pe=O),V>pe&&(pe=V),K>pe&&(pe=K),pe}}},{key:"average",value:function(c,d){return(c+d)/2}}]),I}();Ar.LOG_10=Math.log(10);var er=function(){function I(){t(this,I)}return a(I,null,[{key:"segmentToSegment",value:function(c,d,p,b){if(c.equals(d))return I.pointToSegment(c,p,b);if(p.equals(b))return I.pointToSegment(b,c,d);var L=!1;if(dn.intersects(c,d,p,b)){var O=(d.x-c.x)*(b.y-p.y)-(d.y-c.y)*(b.x-p.x);if(O===0)L=!0;else{var V=(c.y-p.y)*(b.x-p.x)-(c.x-p.x)*(b.y-p.y),K=((c.y-p.y)*(d.x-c.x)-(c.x-p.x)*(d.y-c.y))/O,pe=V/O;(pe<0||pe>1||K<0||K>1)&&(L=!0)}}else L=!0;return L?Ar.min(I.pointToSegment(c,p,b),I.pointToSegment(d,p,b),I.pointToSegment(p,c,d),I.pointToSegment(b,c,d)):0}},{key:"pointToSegment",value:function(c,d,p){if(d.x===p.x&&d.y===p.y)return c.distance(d);var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),L=((c.x-d.x)*(p.x-d.x)+(c.y-d.y)*(p.y-d.y))/b;if(L<=0)return c.distance(d);if(L>=1)return c.distance(p);var O=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(O)*Math.sqrt(b)}},{key:"pointToLinePerpendicular",value:function(c,d,p){var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),L=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(L)*Math.sqrt(b)}},{key:"pointToSegmentString",value:function(c,d){if(d.length===0)throw new xe("Line array must contain at least one vertex");for(var p=c.distance(d[0]),b=0;b<d.length-1;b++){var L=I.pointToSegment(c,d[b],d[b+1]);L<p&&(p=L)}return p}}]),I}(),Kr=function(){function I(){t(this,I)}return a(I,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||Jt(arguments[0],xn);else if(arguments.length!==2&&arguments.length===3){var c=arguments[0],d=arguments[1];return this.create(c,d)}}}]),I}(),Re=function(){function I(){t(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),Q=function(){function I(){t(this,I)}return a(I,null,[{key:"ofLine",value:function(c){var d=c.size();if(d<=1)return 0;var p=0,b=new We;c.getCoordinate(0,b);for(var L=b.x,O=b.y,V=1;V<d;V++){c.getCoordinate(V,b);var K=b.x,pe=b.y,Be=K-L,$e=pe-O;p+=Math.sqrt(Be*Be+$e*$e),L=K,O=pe}return p}}]),I}(),$=function I(){t(this,I)},ce=function(){function I(){t(this,I)}return a(I,null,[{key:"copyCoord",value:function(c,d,p,b){for(var L=Math.min(c.getDimension(),p.getDimension()),O=0;O<L;O++)p.setOrdinate(b,O,c.getOrdinate(d,O))}},{key:"isRing",value:function(c){var d=c.size();return d===0||!(d<=3)&&c.getOrdinate(0,xn.X)===c.getOrdinate(d-1,xn.X)&&c.getOrdinate(0,xn.Y)===c.getOrdinate(d-1,xn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(Jt(arguments[0],xn)&&Number.isInteger(arguments[1])){var c=arguments[0],d=arguments[1];I.scroll(c,d,I.isRing(c))}else if(Jt(arguments[0],xn)&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1],L=I.indexOf(b,p);if(L<=0)return null;I.scroll(p,L)}}else if(arguments.length===3){var O=arguments[0],V=arguments[1],K=arguments[2],pe=V;if(pe<=0)return null;for(var Be=O.copy(),$e=K?O.size()-1:O.size(),gt=0;gt<$e;gt++)for(var Ft=0;Ft<O.getDimension();Ft++)O.setOrdinate(gt,Ft,Be.getOrdinate((V+gt)%$e,Ft));if(K)for(var zt=0;zt<O.getDimension();zt++)O.setOrdinate($e,zt,O.getOrdinate(0,zt))}}},{key:"isEqual",value:function(c,d){var p=c.size();if(p!==d.size())return!1;for(var b=Math.min(c.getDimension(),d.getDimension()),L=0;L<p;L++)for(var O=0;O<b;O++){var V=c.getOrdinate(L,O),K=d.getOrdinate(L,O);if(c.getOrdinate(L,O)!==d.getOrdinate(L,O)&&(!bt.isNaN(V)||!bt.isNaN(K)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var c=arguments[0];return I.minCoordinateIndex(c,0,c.size()-1)}if(arguments.length===3){for(var d=arguments[0],p=arguments[1],b=arguments[2],L=-1,O=null,V=p;V<=b;V++){var K=d.getCoordinate(V);(O===null||O.compareTo(K)>0)&&(O=K,L=V)}return L}}},{key:"extend",value:function(c,d,p){var b=c.create(p,d.getDimension()),L=d.size();if(I.copy(d,0,b,0,L),L>0)for(var O=L;O<p;O++)I.copy(d,L-1,b,O,1);return b}},{key:"reverse",value:function(c){for(var d=c.size()-1,p=Math.trunc(d/2),b=0;b<=p;b++)I.swap(c,b,d-b)}},{key:"swap",value:function(c,d,p){if(d===p)return null;for(var b=0;b<c.getDimension();b++){var L=c.getOrdinate(d,b);c.setOrdinate(d,b,c.getOrdinate(p,b)),c.setOrdinate(p,b,L)}}},{key:"copy",value:function(c,d,p,b,L){for(var O=0;O<L;O++)I.copyCoord(c,d+O,p,b+O)}},{key:"ensureValidRing",value:function(c,d){var p=d.size();return p===0?d:p<=3?I.createClosedRing(c,d,4):d.getOrdinate(0,xn.X)===d.getOrdinate(p-1,xn.X)&&d.getOrdinate(0,xn.Y)===d.getOrdinate(p-1,xn.Y)?d:I.createClosedRing(c,d,p+1)}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.size();p++)if(c.x===d.getOrdinate(p,xn.X)&&c.y===d.getOrdinate(p,xn.Y))return p;return-1}},{key:"createClosedRing",value:function(c,d,p){var b=c.create(p,d.getDimension()),L=d.size();I.copy(d,0,b,0,L);for(var O=L;O<p;O++)I.copy(d,0,b,O,1);return b}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.size();p++){var b=c.getCoordinate(p);(d===null||d.compareTo(b)>0)&&(d=b)}return d}}]),I}(),ue=function(){function I(){t(this,I)}return a(I,null,[{key:"toDimensionSymbol",value:function(c){switch(c){case I.FALSE:return I.SYM_FALSE;case I.TRUE:return I.SYM_TRUE;case I.DONTCARE:return I.SYM_DONTCARE;case I.P:return I.SYM_P;case I.L:return I.SYM_L;case I.A:return I.SYM_A}throw new xe("Unknown dimension value: "+c)}},{key:"toDimensionValue",value:function(c){switch(ns.toUpperCase(c)){case I.SYM_FALSE:return I.FALSE;case I.SYM_TRUE:return I.TRUE;case I.SYM_DONTCARE:return I.DONTCARE;case I.SYM_P:return I.P;case I.SYM_L:return I.L;case I.SYM_A:return I.A}throw new xe("Unknown dimension symbol: "+c)}}]),I}();ue.P=0,ue.L=1,ue.A=2,ue.FALSE=-1,ue.TRUE=-2,ue.DONTCARE=-3,ue.SYM_FALSE="F",ue.SYM_TRUE="T",ue.SYM_DONTCARE="*",ue.SYM_P="0",ue.SYM_L="1",ue.SYM_A="2";var fe=function(){function I(){t(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),Ue=function(){function I(){t(this,I)}return a(I,[{key:"filter",value:function(c,d){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),I}(),Xe=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new dn:this._points.expandEnvelope(new dn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p;if(this._points.size()!==L._points.size())return!1;for(var O=0;O<this._points.size();O++)if(!this.equal(this._points.getCoordinate(O),L._points.getCoordinate(O),b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<Math.trunc(this._points.size()/2);p++){var b=this._points.size()-1-p;if(!this._points.getCoordinate(p).equals(this._points.getCoordinate(b))){if(this._points.getCoordinate(p).compareTo(this._points.getCoordinate(b))>0){var L=this._points.copy();ce.reverse(L),this._points=L}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ue.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var p=this._points.copy();return ce.reverse(p),this.getFactory().createLineString(p)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Q.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var p=arguments[0],b=p,L=0,O=0;L<this._points.size()&&O<b._points.size();){var V=this._points.getCoordinate(L).compareTo(b._points.getCoordinate(O));if(V!==0)return V;L++,O++}return L<this._points.size()?1:O<b._points.size()?-1:0}if(arguments.length===2){var K=arguments[0],pe=arguments[1],Be=K;return pe.compare(this._points,Be._points)}}},{key:"apply",value:function(){if(Jt(arguments[0],Re))for(var p=arguments[0],b=0;b<this._points.size();b++)p.filter(this._points.getCoordinate(b));else if(Jt(arguments[0],Ue)){var L=arguments[0];if(this._points.size()===0)return null;for(var O=0;O<this._points.size()&&(L.filter(this._points,O),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var V=arguments[0];V.filter(this)}else if(Jt(arguments[0],Ee)){var K=arguments[0];K.filter(this)}}},{key:"getBoundary",value:function(){throw new Lt}},{key:"isEquivalentClass",value:function(p){return p instanceof d}},{key:"getCoordinateN",value:function(p){return this._points.getCoordinate(p)}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(p){if(p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),p.size()===1)throw new xe("Invalid number of points in LineString (found "+p.size()+" - must be 0 or >= 2)");this._points=p}},{key:"isCoordinate",value:function(p){for(var b=0;b<this._points.size();b++)if(this._points.getCoordinate(b).equals(p))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(p){return this.getFactory().createPoint(this._points.getCoordinate(p))}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];Ot.constructor_.call(this,b),this.init(p)}}}]),d}(Ot),Pe=function I(){t(this,I)},nt=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new dn;var p=new dn;return p.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),p}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new d(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&(!(!this.isEmpty()||!p.isEmpty())||this.isEmpty()===p.isEmpty()&&this.equal(p.getCoordinate(),this.getCoordinate(),b))}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return ue.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=p;return this.getCoordinate().compareTo(b.getCoordinate())}if(arguments.length===2){var L=arguments[0],O=arguments[1],V=L;return O.compare(this._coordinates,V._coordinates)}}},{key:"apply",value:function(){if(Jt(arguments[0],Re)){var p=arguments[0];if(this.isEmpty())return null;p.filter(this.getCoordinate())}else if(Jt(arguments[0],Ue)){var b=arguments[0];if(this.isEmpty())return null;b.filter(this._coordinates,0),b.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var L=arguments[0];L.filter(this)}else if(Jt(arguments[0],Ee)){var O=arguments[0];O.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(p){p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),St.isTrue(p.size()<=1),this._coordinates=p}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){this._coordinates=null;var p=arguments[0],b=arguments[1];Ot.constructor_.call(this,b),this.init(p)}}]),d}(Ot),_t=function(){function I(){t(this,I)}return a(I,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];return Math.abs(I.ofRingSigned(c))}if(Jt(arguments[0],xn)){var d=arguments[0];return Math.abs(I.ofRingSigned(d))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];if(c.length<3)return 0;for(var d=0,p=c[0].x,b=1;b<c.length-1;b++){var L=c[b].x-p,O=c[b+1].y,V=c[b-1].y;d+=L*(V-O)}return d/2}if(Jt(arguments[0],xn)){var K=arguments[0],pe=K.size();if(pe<3)return 0;var Be=new We,$e=new We,gt=new We;K.getCoordinate(0,$e),K.getCoordinate(1,gt);var Ft=$e.x;gt.x-=Ft;for(var zt=0,gn=1;gn<pe-1;gn++)Be.y=$e.y,$e.x=gt.x,$e.y=gt.y,K.getCoordinate(gn+1,gt),gt.x-=Ft,zt+=$e.x*(Be.y-gt.y);return zt/2}}}]),I}(),lt=function(){function I(){t(this,I)}return a(I,null,[{key:"sort",value:function(){var c=arguments,d=arguments[0];if(arguments.length===1)d.sort(function(Ft,zt){return Ft.compareTo(zt)});else if(arguments.length===2)d.sort(function(Ft,zt){return c[1].compare(Ft,zt)});else if(arguments.length===3){var p=d.slice(arguments[1],arguments[2]);p.sort();var b=d.slice(0,arguments[1]).concat(p,d.slice(arguments[2],d.length));d.splice(0,d.length);var L,O=J(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;d.push(V)}}catch(Ft){O.e(Ft)}finally{O.f()}}else if(arguments.length===4){var K=d.slice(arguments[1],arguments[2]);K.sort(function(Ft,zt){return c[3].compare(Ft,zt)});var pe=d.slice(0,arguments[1]).concat(K,d.slice(arguments[2],d.length));d.splice(0,d.length);var Be,$e=J(pe);try{for($e.s();!(Be=$e.n()).done;){var gt=Be.value;d.push(gt)}}catch(Ft){$e.e(Ft)}finally{$e.f()}}}},{key:"asList",value:function(c){var d,p=new At,b=J(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p.add(L)}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"copyOf",value:function(c,d){return c.slice(0,d)}}]),I}(),Nt=function I(){t(this,I)},en=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var p=new Array(this.getNumPoints()).fill(null),b=-1,L=this._shell.getCoordinates(),O=0;O<L.length;O++)p[++b]=L[O];for(var V=0;V<this._holes.length;V++)for(var K=this._holes[V].getCoordinates(),pe=0;pe<K.length;pe++)p[++b]=K[pe];return p}},{key:"getArea",value:function(){var p=0;p+=_t.ofRing(this._shell.getCoordinateSequence());for(var b=0;b<this._holes.length;b++)p-=_t.ofRing(this._holes[b].getCoordinateSequence());return p}},{key:"copyInternal",value:function(){for(var p=this._shell.copy(),b=new Array(this._holes.length).fill(null),L=0;L<this._holes.length;L++)b[L]=this._holes[L].copy();return new d(p,b,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var p=this._shell.getCoordinateSequence(),b=this.getEnvelopeInternal(),L=0;L<5;L++){var O=p.getX(L);if(O!==b.getMinX()&&O!==b.getMaxX())return!1;var V=p.getY(L);if(V!==b.getMinY()&&V!==b.getMaxY())return!1}for(var K=p.getX(0),pe=p.getY(0),Be=1;Be<=4;Be++){var $e=p.getX(Be),gt=p.getY(Be);if($e!==K==(gt!==pe))return!1;K=$e,pe=gt}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p,O=this._shell,V=L._shell;if(!O.equalsExact(V,b)||this._holes.length!==L._holes.length)return!1;for(var K=0;K<this._holes.length;K++)if(!this._holes[K].equalsExact(L._holes[K],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var p=0;p<this._holes.length;p++)this._holes[p]=this.normalized(this._holes[p],!1);lt.sort(this._holes)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];if(b.isEmpty())return null;var O=b.getCoordinateSequence(),V=ce.minCoordinateIndex(O,0,O.size()-2);ce.scroll(O,V,!0),mn.isCCW(O)===L&&ce.reverse(O)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var p=this.getExteriorRing().reverse(),b=new Array(this.getNumInteriorRing()).fill(null),L=0;L<b.length;L++)b[L]=this.getInteriorRingN(L).reverse();return this.getFactory().createPolygon(p,b)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var p=0;p+=this._shell.getLength();for(var b=0;b<this._holes.length;b++)p+=this._holes[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=this._shell.getNumPoints(),b=0;b<this._holes.length;b++)p+=this._holes[b].getNumPoints();return p}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(p,b){var L=p.copy();return this.normalize(L,b),L}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=this._shell,L=p._shell;return b.compareToSameClass(L)}if(arguments.length===2){var O=arguments[0],V=arguments[1],K=O,pe=this._shell,Be=K._shell,$e=pe.compareToSameClass(Be,V);if($e!==0)return $e;for(var gt=this.getNumInteriorRing(),Ft=K.getNumInteriorRing(),zt=0;zt<gt&&zt<Ft;){var gn=this.getInteriorRingN(zt),vn=K.getInteriorRingN(zt),Ln=gn.compareToSameClass(vn,V);if(Ln!==0)return Ln;zt++}return zt<gt?1:zt<Ft?-1:0}}},{key:"apply",value:function(){if(Jt(arguments[0],Re)){var p=arguments[0];this._shell.apply(p);for(var b=0;b<this._holes.length;b++)this._holes[b].apply(p)}else if(Jt(arguments[0],Ue)){var L=arguments[0];if(this._shell.apply(L),!L.isDone())for(var O=0;O<this._holes.length&&(this._holes[O].apply(L),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var V=arguments[0];V.filter(this)}else if(Jt(arguments[0],Ee)){var K=arguments[0];K.filter(this),this._shell.apply(K);for(var pe=0;pe<this._holes.length;pe++)this._holes[pe].apply(K)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var p=new Array(this._holes.length+1).fill(null);p[0]=this._shell;for(var b=0;b<this._holes.length;b++)p[b+1]=this._holes[b];return p.length<=1?this.getFactory().createLinearRing(p[0].getCoordinateSequence()):this.getFactory().createMultiLineString(p)}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(p){return this._holes[p]}},{key:"interfaces_",get:function(){return[Nt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var p=arguments[0],b=arguments[1],L=arguments[2];if(Ot.constructor_.call(this,L),p===null&&(p=this.getFactory().createLinearRing()),b===null&&(b=[]),Ot.hasNullElements(b))throw new xe("holes must not contain null elements");if(p.isEmpty()&&Ot.hasNonEmptyElements(b))throw new xe("shell is empty but holes are not");this._shell=p,this._holes=b}}]),d}(Ot),ln=function(I){h(d,I);var c=B(d);function d(){return t(this,d),c.apply(this,arguments)}return d}(Ke),Zn=function(I){h(d,I);var c=B(d);function d(p){var b;return t(this,d),(b=c.call(this)).array=[],p instanceof ut&&b.addAll(p),b}return a(d,[{key:"contains",value:function(p){var b,L=J(this.array);try{for(L.s();!(b=L.n()).done;)if(b.value.compareTo(p)===0)return!0}catch(O){L.e(O)}finally{L.f()}return!1}},{key:"add",value:function(p){if(this.contains(p))return!1;for(var b=0,L=this.array.length;b<L;b++)if(this.array[b].compareTo(p)===1)return!!this.array.splice(b,0,p);return this.array.push(p),!0}},{key:"addAll",value:function(p){var b,L=J(p);try{for(L.s();!(b=L.n()).done;){var O=b.value;this.add(O)}}catch(V){L.e(V)}finally{L.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Tn(this.array)}}]),d}(ln),Tn=function(){function I(c){t(this,I),this.array=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.array.length)throw new Ye;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Lt}}]),I}(),Cn=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){for(var p=new dn,b=0;b<this._geometries.length;b++)p.expandToInclude(this._geometries[b].getEnvelopeInternal());return p}},{key:"getGeometryN",value:function(p){return this._geometries[p]}},{key:"getCoordinates",value:function(){for(var p=new Array(this.getNumPoints()).fill(null),b=-1,L=0;L<this._geometries.length;L++)for(var O=this._geometries[L].getCoordinates(),V=0;V<O.length;V++)p[++b]=O[V];return p}},{key:"getArea",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getArea();return p}},{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p;if(this._geometries.length!==L._geometries.length)return!1;for(var O=0;O<this._geometries.length;O++)if(!this._geometries[O].equalsExact(L._geometries[O],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<this._geometries.length;p++)this._geometries[p].normalize();lt.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var p=ue.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getBoundaryDimension());return p}},{key:"reverseInternal",value:function(){for(var p=this._geometries.length,b=new At(p),L=0;L<p;L++)b.add(this._geometries[L].reverse());return this.getFactory().buildGeometry(b)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var p=ue.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getDimension());return p}},{key:"getLength",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getNumPoints();return p}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=new Zn(lt.asList(this._geometries)),L=new Zn(lt.asList(p._geometries));return this.compare(b,L)}if(arguments.length===2){for(var O=arguments[0],V=arguments[1],K=O,pe=this.getNumGeometries(),Be=K.getNumGeometries(),$e=0;$e<pe&&$e<Be;){var gt=this.getGeometryN($e),Ft=K.getGeometryN($e),zt=gt.compareToSameClass(Ft,V);if(zt!==0)return zt;$e++}return $e<pe?1:$e<Be?-1:0}}},{key:"apply",value:function(){if(Jt(arguments[0],Re))for(var p=arguments[0],b=0;b<this._geometries.length;b++)this._geometries[b].apply(p);else if(Jt(arguments[0],Ue)){var L=arguments[0];if(this._geometries.length===0)return null;for(var O=0;O<this._geometries.length&&(this._geometries[O].apply(L),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var V=arguments[0];V.filter(this);for(var K=0;K<this._geometries.length;K++)this._geometries[K].apply(V)}else if(Jt(arguments[0],Ee)){var pe=arguments[0];pe.filter(this);for(var Be=0;Be<this._geometries.length;Be++)this._geometries[Be].apply(pe)}}},{key:"getBoundary",value:function(){return Ot.checkNotGeometryCollection(this),St.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];if(Ot.constructor_.call(this,b),p===null&&(p=[]),Ot.hasNullElements(p))throw new xe("geometries must not contain null elements");this._geometries=p}}}]),d}(Ot),Un=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var p=arguments[0];return this._geometries[p].getCoordinate()}return U(m(d.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return ue.FALSE}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Cn.constructor_.call(this,p,b)}}]),d}(Cn),Ii=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return ue.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||U(m(d.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var p=this._points.copy();return ce.reverse(p),this.getFactory().createLinearRing(p)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!U(m(d.prototype),"isClosed",this).call(this))throw new xe("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<d.MINIMUM_VALID_SIZE)throw new xe("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Xe.constructor_.call(this,p,b),this.validateConstruction()}}]),d}(Xe);Ii.MINIMUM_VALID_SIZE=4;var ci=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;default:throw new xe("Invalid ordinate index: "+p)}}},{key:"getZ",value:function(){return We.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y}throw new xe("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new xe("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)We.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p.x,p.y)}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b.x,b.y)}}else if(arguments.length===2){var L=arguments[0],O=arguments[1];We.constructor_.call(this,L,O,We.NULL_ORDINATE)}}}]),d}(We);ci.X=0,ci.Y=1,ci.Z=-1,ci.M=-1;var En=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;case d.M:this._m=b;break;default:throw new xe("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getZ",value:function(){return We.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y;case d.M:return this._m}throw new xe("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new xe("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)We.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p.x,p.y),this._m=p._m}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b.x,b.y),this._m=this.getM()}}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];We.constructor_.call(this,L,O,We.NULL_ORDINATE),this._m=V}}}]),d}(We);En.X=0,En.Y=1,En.Z=-1,En.M=2;var ri=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case We.X:this.x=b;break;case We.Y:this.y=b;break;case We.Z:this.z=b;break;case We.M:this._m=b;break;default:throw new xe("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getOrdinate",value:function(p){switch(p){case We.X:return this.x;case We.Y:return this.y;case We.Z:return this.getZ();case We.M:return this.getM()}throw new xe("Invalid ordinate index: "+p)}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)We.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p),this._m=p._m}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b),this._m=this.getM()}}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];We.constructor_.call(this,L,O,V),this._m=K}}}]),d}(We),fi=function(){function I(){t(this,I)}return a(I,null,[{key:"measures",value:function(c){return c instanceof ci?0:c instanceof En||c instanceof ri?1:0}},{key:"dimension",value:function(c){return c instanceof ci?2:c instanceof En?3:c instanceof ri?4:3}},{key:"create",value:function(){if(arguments.length===1){var c=arguments[0];return I.create(c,0)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return d===2?new ci:d===3&&p===0?new We:d===3&&p===1?new En:d===4&&p===1?new ri:new We}}}]),I}(),Di=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getCoordinate",value:function(p){return this.get(p)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&Jt(arguments[0],ut)){for(var p=arguments[0],b=arguments[1],L=!1,O=p.iterator();O.hasNext();)this.add(O.next(),b),L=!0;return L}return U(m(d.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var p=U(m(d.prototype),"clone",this).call(this),b=0;b<this.size();b++)p.add(b,this.get(b).clone());return p}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(d.coordArrayType);if(arguments.length===1){var p=arguments[0];if(p)return this.toArray(d.coordArrayType);for(var b=this.size(),L=new Array(b).fill(null),O=0;O<b;O++)L[O]=this.get(b-O-1);return L}}},{key:"add",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"add",this).call(this,p)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var b=arguments[0],L=arguments[1];return this.add(b,L,!0),!0}if(arguments[0]instanceof We&&typeof arguments[1]=="boolean"){var O=arguments[0],V=arguments[1];if(!V&&this.size()>=1){var K=this.get(this.size()-1);if(K.equals2D(O))return null}U(m(d.prototype),"add",this).call(this,O)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var pe=arguments[0],Be=arguments[1];return this.add(pe,Be),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var $e=arguments[0],gt=arguments[1],Ft=arguments[2];if(Ft)for(var zt=0;zt<$e.length;zt++)this.add($e[zt],gt);else for(var gn=$e.length-1;gn>=0;gn--)this.add($e[gn],gt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof We){var vn=arguments[0],Ln=arguments[1],ii=arguments[2];if(!ii){var gi=this.size();if(gi>0){if(vn>0){var ui=this.get(vn-1);if(ui.equals2D(Ln))return null}if(vn<gi){var nr=this.get(vn);if(nr.equals2D(Ln))return null}}}U(m(d.prototype),"add",this).call(this,vn,Ln)}}else if(arguments.length===4){var us=arguments[0],Ps=arguments[1],di=arguments[2],Rr=arguments[3],pr=1;di>Rr&&(pr=-1);for(var Ds=di;Ds!==Rr;Ds+=pr)this.add(us[Ds],Ps);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var p=this.get(0).copy();this.add(p,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.ensureCapacity(p.length),this.add(p,!0)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.ensureCapacity(b.length),this.add(b,L)}}}}]),d}(At);Di.coordArrayType=new Array(0).fill(null);var $n=function(){function I(){t(this,I)}return a(I,null,[{key:"isRing",value:function(c){return!(c.length<4)&&!!c[0].equals2D(c[c.length-1])}},{key:"ptNotInList",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p];if(I.indexOf(b,d)<0)return b}return null}},{key:"scroll",value:function(c,d){var p=I.indexOf(d,c);if(p<0)return null;var b=new Array(c.length).fill(null);Pi.arraycopy(c,p,b,0,c.length-p),Pi.arraycopy(c,0,b,c.length-p,p),Pi.arraycopy(b,0,c,0,c.length)}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];if(c===d)return!0;if(c===null||d===null||c.length!==d.length)return!1;for(var p=0;p<c.length;p++)if(!c[p].equals(d[p]))return!1;return!0}if(arguments.length===3){var b=arguments[0],L=arguments[1],O=arguments[2];if(b===L)return!0;if(b===null||L===null||b.length!==L.length)return!1;for(var V=0;V<b.length;V++)if(O.compare(b[V],L[V])!==0)return!1;return!0}}},{key:"intersection",value:function(c,d){for(var p=new Di,b=0;b<c.length;b++)d.intersects(c[b])&&p.add(c[b],!0);return p.toCoordinateArray()}},{key:"measures",value:function(c){if(c===null||c.length===0)return 0;var d,p=0,b=J(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p=Math.max(p,fi.measures(L))}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"hasRepeatedPoints",value:function(c){for(var d=1;d<c.length;d++)if(c[d-1].equals(c[d]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(c){return I.hasRepeatedPoints(c)?new Di(c,!1).toCoordinateArray():c}},{key:"reverse",value:function(c){for(var d=c.length-1,p=Math.trunc(d/2),b=0;b<=p;b++){var L=c[b];c[b]=c[d-b],c[d-b]=L}}},{key:"removeNull",value:function(c){for(var d=0,p=0;p<c.length;p++)c[p]!==null&&d++;var b=new Array(d).fill(null);if(d===0)return b;for(var L=0,O=0;O<c.length;O++)c[O]!==null&&(b[L++]=c[O]);return b}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Array(c.length).fill(null),p=0;p<c.length;p++)d[p]=c[p].copy();return d}if(arguments.length===5)for(var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3],K=arguments[4],pe=0;pe<K;pe++)O[V+pe]=b[L+pe].copy()}},{key:"isEqualReversed",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p],L=d[c.length-p-1];if(b.compareTo(L)!==0)return!1}return!0}},{key:"envelope",value:function(c){for(var d=new dn,p=0;p<c.length;p++)d.expandToInclude(c[p]);return d}},{key:"toCoordinateArray",value:function(c){return c.toArray(I.coordArrayType)}},{key:"dimension",value:function(c){if(c===null||c.length===0)return 3;var d,p=0,b=J(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p=Math.max(p,fi.dimension(L))}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"atLeastNCoordinatesOrNothing",value:function(c,d){return d.length>=c?d:[]}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.length;p++)if(c.equals(d[p]))return p;return-1}},{key:"increasingDirection",value:function(c){for(var d=0;d<Math.trunc(c.length/2);d++){var p=c.length-1-d,b=c[d].compareTo(c[p]);if(b!==0)return b}return 1}},{key:"compare",value:function(c,d){for(var p=0;p<c.length&&p<d.length;){var b=c[p].compareTo(d[p]);if(b!==0)return b;p++}return p<d.length?-1:p<c.length?1:0}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.length;p++)(d===null||d.compareTo(c[p])>0)&&(d=c[p]);return d}},{key:"extract",value:function(c,d,p){d=Ar.clamp(d,0,c.length);var b=(p=Ar.clamp(p,-1,c.length))-d+1;p<0&&(b=0),d>=c.length&&(b=0),p<d&&(b=0);var L=new Array(b).fill(null);if(b===0)return L;for(var O=0,V=d;V<=p;V++)L[O++]=c[V];return L}}]),I}(),Tr=function(){function I(){t(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;return $n.compare(p,b)}},{key:"interfaces_",get:function(){return[It]}}]),I}(),No=function(){function I(){t(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;var L=$n.compare(p,b);return $n.isEqualReversed(p,b)?0:L}},{key:"OLDcompare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;for(var L=$n.increasingDirection(p),O=$n.increasingDirection(b),V=L>0?0:p.length-1,K=O>0?0:p.length-1,pe=0;pe<p.length;pe++){var Be=p[V].compareTo(b[K]);if(Be!==0)return Be;V+=L,K+=O}return 0}},{key:"interfaces_",get:function(){return[It]}}]),I}();$n.ForwardComparator=Tr,$n.BidirectionalComparator=No,$n.coordArrayType=new Array(0).fill(null);var ti=function(){function I(c){t(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),xo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(c){return this.hasM()?this._coordinates[c].getM():bt.NaN}},{key:"setOrdinate",value:function(c,d,p){switch(d){case xn.X:this._coordinates[c].x=p;break;case xn.Y:this._coordinates[c].y=p;break;default:this._coordinates[c].setOrdinate(d,p)}}},{key:"getZ",value:function(c){return this.hasZ()?this._coordinates[c].getZ():bt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(c,d){switch(d){case xn.X:return this._coordinates[c].x;case xn.Y:return this._coordinates[c].y;default:return this._coordinates[c].getOrdinate(d)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var c=arguments[0];return this._coordinates[c]}if(arguments.length===2){var d=arguments[0],p=arguments[1];p.setCoordinate(this._coordinates[d])}}},{key:"getCoordinateCopy",value:function(c){var d=this.createCoordinate();return d.setCoordinate(this._coordinates[c]),d}},{key:"createCoordinate",value:function(){return fi.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(c){return this._coordinates[c].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(c){for(var d=0;d<this._coordinates.length;d++)c.expandToInclude(this._coordinates[d]);return c}},{key:"copy",value:function(){for(var c=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++){var p=this.createCoordinate();p.setCoordinate(this._coordinates[d]),c[d]=p}return new I(c,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var c=new ti(17*this._coordinates.length);c.append("("),c.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)c.append(", "),c.append(this._coordinates[d]);return c.append(")"),c.toString()}return"()"}},{key:"getY",value:function(c){return this._coordinates[c].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[xn,ve]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];I.constructor_.call(this,c,$n.dimension(c),$n.measures(c))}else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=new Array(d).fill(null);for(var p=0;p<d;p++)this._coordinates[p]=new We}else if(Jt(arguments[0],xn)){var b=arguments[0];if(b===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=b.getDimension(),this._measures=b.getMeasures(),this._coordinates=new Array(b.size()).fill(null);for(var L=0;L<this._coordinates.length;L++)this._coordinates[L]=b.getCoordinateCopy(L)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var O=arguments[0],V=arguments[1];I.constructor_.call(this,O,V,$n.measures(O))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var K=arguments[0],pe=arguments[1];this._coordinates=new Array(K).fill(null),this._dimension=pe;for(var Be=0;Be<K;Be++)this._coordinates[Be]=fi.create(pe)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var $e=arguments[0],gt=arguments[1],Ft=arguments[2];this._dimension=gt,this._measures=Ft,this._coordinates=$e===null?new Array(0).fill(null):$e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var zt=arguments[0],gn=arguments[1],vn=arguments[2];this._coordinates=new Array(zt).fill(null),this._dimension=gn,this._measures=vn;for(var Ln=0;Ln<zt;Ln++)this._coordinates[Ln]=this.createCoordinate()}}}}]),I}(),aa=function(){function I(){t(this,I)}return a(I,[{key:"readResolve",value:function(){return I.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new xo(c)}if(Jt(arguments[0],xn)){var d=arguments[0];return new xo(d)}}else{if(arguments.length===2){var p=arguments[0],b=arguments[1];return b>3&&(b=3),b<2&&(b=2),new xo(p,b)}if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2],K=O-V;return V>1&&(V=1),K>3&&(K=3),K<2&&(K=2),new xo(L,K+V,V)}}}},{key:"interfaces_",get:function(){return[Kr,ve]}}],[{key:"instance",value:function(){return I.instanceObject}}]),I}();aa.instanceObject=new aa;var Cr=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var p=new At,b=0;b<this._geometries.length;b++)for(var L=this._geometries[b].getBoundary(),O=0;O<L.getNumGeometries();O++)p.add(L.getGeometryN(O));var V=new Array(p.size()).fill(null);return this.getFactory().createMultiLineString(p.toArray(V))}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Nt]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Cn.constructor_.call(this,p,b)}}]),d}(Cn),Fr=function(){function I(){t(this,I)}return a(I,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),I}(),yc=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),(p=c.call(this)).map=new Map,p}return a(d,[{key:"get",value:function(p){return this.map.get(p)||null}},{key:"put",value:function(p,b){return this.map.set(p,b),b}},{key:"values",value:function(){for(var p=new At,b=this.map.values(),L=b.next();!L.done;)p.add(L.value),L=b.next();return p}},{key:"entrySet",value:function(){var p=new On;return this.map.entries().forEach(function(b){return p.add(b)}),p}},{key:"size",value:function(){return this.map.size()}}]),d}(Fr),Ni=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this._modelType===d._modelType&&this._scale===d._scale}},{key:"compareTo",value:function(c){var d=c,p=this.getMaximumSignificantDigits(),b=d.getMaximumSignificantDigits();return Qi.compare(p,b)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===I.FLOATING||this._modelType===I.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var c="UNKNOWN";return this._modelType===I.FLOATING?c="Floating":this._modelType===I.FLOATING_SINGLE?c="Floating-Single":this._modelType===I.FIXED&&(c="Fixed (Scale="+this.getScale()+")"),c}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var c=arguments[0];return bt.isNaN(c)||this._modelType===I.FLOATING_SINGLE?c:this._modelType===I.FIXED?Math.round(c*this._scale)/this._scale:c}if(arguments[0]instanceof We){var d=arguments[0];if(this._modelType===I.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}}},{key:"getMaximumSignificantDigits",value:function(){var c=16;return this._modelType===I.FLOATING?c=16:this._modelType===I.FLOATING_SINGLE?c=6:this._modelType===I.FIXED&&(c=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),c}},{key:"setScale",value:function(c){this._scale=Math.abs(c)}},{key:"interfaces_",get:function(){return[ve,ye]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=I.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof or){var c=arguments[0];this._modelType=c,c===I.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var d=arguments[0];this._modelType=I.FIXED,this.setScale(d)}else if(arguments[0]instanceof I){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}}},{key:"mostPrecise",value:function(c,d){return c.compareTo(d)>=0?c:d}}]),I}(),or=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"readResolve",value:function(){return I.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[ve]}}],[{key:"constructor_",value:function(){this._name=null;var c=arguments[0];this._name=c,I.nameToTypeMap.put(c,this)}}]),I}();or.nameToTypeMap=new yc,Ni.Type=or,Ni.FIXED=new or("FIXED"),Ni.FLOATING=new or("FLOATING"),Ni.FLOATING_SINGLE=new or("FLOATING SINGLE"),Ni.maximumPreciseValue=9007199254740992;var no=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ue.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Lt}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Cn.constructor_.call(this,p,b)}}]),d}(Cn),is=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"createEmpty",value:function(c){switch(c){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new xe("Invalid dimension: "+c)}}},{key:"toGeometry",value:function(c){return c.isNull()?this.createPoint():c.getMinX()===c.getMaxX()&&c.getMinY()===c.getMaxY()?this.createPoint(new We(c.getMinX(),c.getMinY())):c.getMinX()===c.getMaxX()||c.getMinY()===c.getMaxY()?this.createLineString([new We(c.getMinX(),c.getMinY()),new We(c.getMaxX(),c.getMaxY())]):this.createPolygon(this.createLinearRing([new We(c.getMinX(),c.getMinY()),new We(c.getMinX(),c.getMaxY()),new We(c.getMaxX(),c.getMaxY()),new We(c.getMaxX(),c.getMinY()),new We(c.getMinX(),c.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLineString(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(Jt(arguments[0],xn)){var d=arguments[0];return new Xe(d,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new no(null,this);if(arguments.length===1){var c=arguments[0];return new no(c,this)}}},{key:"buildGeometry",value:function(c){for(var d=null,p=!1,b=!1,L=c.iterator();L.hasNext();){var O=L.next(),V=O.getTypeCode();d===null&&(d=V),V!==d&&(p=!0),O instanceof Cn&&(b=!0)}if(d===null)return this.createGeometryCollection();if(p||b)return this.createGeometryCollection(I.toGeometryArray(c));var K=c.iterator().next();if(c.size()>1){if(K instanceof en)return this.createMultiPolygon(I.toPolygonArray(c));if(K instanceof Xe)return this.createMultiLineString(I.toLineStringArray(c));if(K instanceof nt)return this.createMultiPoint(I.toPointArray(c));St.shouldNeverReachHere("Unhandled geometry type: "+K.getGeometryType())}return K}},{key:"createMultiPointFromCoords",value:function(c){return this.createMultiPoint(c!==null?this.getCoordinateSequenceFactory().create(c):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];return this.createPoint(c!==null?this.getCoordinateSequenceFactory().create([c]):null)}if(Jt(arguments[0],xn)){var d=arguments[0];return new nt(d,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(Jt(arguments[0],xn)){var c=arguments[0];return this.createPolygon(this.createLinearRing(c))}if(arguments[0]instanceof Array){var d=arguments[0];return this.createPolygon(this.createLinearRing(d))}if(arguments[0]instanceof Ii){var p=arguments[0];return this.createPolygon(p,null)}}else if(arguments.length===2){var b=arguments[0],L=arguments[1];return new en(b,L,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new Cn(null,this);if(arguments.length===1){var c=arguments[0];return new Cn(c,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLinearRing(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(Jt(arguments[0],xn)){var d=arguments[0];return new Ii(d,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new Cr(null,this);if(arguments.length===1){var c=arguments[0];return new Cr(c,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Un(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new Un(c,this)}if(Jt(arguments[0],xn)){var d=arguments[0];if(d===null)return this.createMultiPoint(new Array(0).fill(null));for(var p=new Array(d.size()).fill(null),b=0;b<d.size();b++){var L=this.getCoordinateSequenceFactory().create(1,d.getDimension(),d.getMeasures());ce.copy(d,b,L,0,1),p[b]=this.createPoint(L)}return this.createMultiPoint(p)}}}},{key:"interfaces_",get:function(){return[ve]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)I.constructor_.call(this,new Ni,0);else if(arguments.length===1){if(Jt(arguments[0],Kr)){var c=arguments[0];I.constructor_.call(this,new Ni,0,c)}else if(arguments[0]instanceof Ni){var d=arguments[0];I.constructor_.call(this,d,0,I.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];I.constructor_.call(this,p,b,I.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._precisionModel=L,this._coordinateSequenceFactory=V,this._SRID=O}}},{key:"toMultiPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toGeometryArray",value:function(c){if(c===null)return null;var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return aa.instance()}},{key:"toMultiLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toMultiPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLinearRingArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"createPointFromInternalCoord",value:function(c,d){return d.getPrecisionModel().makePrecise(c),d.getFactory().createPoint(c)}}]),I}(),zi="XY",la="XYZ",ys="XYM",Ui="XYZM",ua={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},rs="EMPTY",zo=1,tr=2,io=3,ca=4,ss=5,ro=6;for(var ni in ua)ua[ni].toUpperCase();var El=function(){function I(c){t(this,I),this.wkt=c,this.index_=-1}return a(I,[{key:"isAlpha_",value:function(c){return c>="a"&&c<="z"||c>="A"&&c<="Z"}},{key:"isNumeric_",value:function(c,d){return c>="0"&&c<="9"||c=="."&&!(d!==void 0&&d)}},{key:"isWhiteSpace_",value:function(c){return c==" "||c=="	"||c=="\r"||c==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var c,d=this.nextChar_(),p=this.index_,b=d;if(d=="(")c=tr;else if(d==",")c=ss;else if(d==")")c=io;else if(this.isNumeric_(d)||d=="-")c=ca,b=this.readNumber_();else if(this.isAlpha_(d))c=zo,b=this.readText_();else{if(this.isWhiteSpace_(d))return this.nextToken();if(d!=="")throw new Error("Unexpected character: "+d);c=ro}return{position:p,value:b,type:c}}},{key:"readNumber_",value:function(){var c,d=this.index_,p=!1,b=!1;do c=="."?p=!0:c!="e"&&c!="E"||(b=!0),c=this.nextChar_();while(this.isNumeric_(c,p)||!b&&(c=="e"||c=="E")||b&&(c=="-"||c=="+"));return parseFloat(this.wkt.substring(d,this.index_--))}},{key:"readText_",value:function(){var c,d=this.index_;do c=this.nextChar_();while(this.isAlpha_(c));return this.wkt.substring(d,this.index_--).toUpperCase()}}]),I}(),Al=function(){function I(c,d){t(this,I),this.lexer_=c,this.token_,this.layout_=zi,this.factory=d}return a(I,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(c){return this.token_.type==c}},{key:"match",value:function(c){var d=this.isTokenType(c);return d&&this.consume_(),d}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var c=zi,d=this.token_;if(this.isTokenType(zo)){var p=d.value;p==="Z"?c=la:p==="M"?c=ys:p==="ZM"&&(c=Ui),c!==zi&&this.consume_()}return c}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(tr)){var c=[];do c.push(this.parseGeometry_());while(this.match(ss));if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(tr)){var c=this.parsePoint_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(tr)){var c=this.parsePointList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(tr)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var c;if(this.match(tr)){if(c=this.token_.type==tr?this.parsePointTextList_():this.parsePointList_(),this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(tr)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(tr)){var c=this.parsePolygonTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var c=[],d=this.layout_.length,p=0;p<d;++p){var b=this.token_;if(!this.match(ca))break;c.push(b.value)}if(c.length==d)return c;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var c=[this.parsePoint_()];this.match(ss);)c.push(this.parsePoint_());return c}},{key:"parsePointTextList_",value:function(){for(var c=[this.parsePointText_()];this.match(ss);)c.push(this.parsePointText_());return c}},{key:"parseLineStringTextList_",value:function(){for(var c=[this.parseLineStringText_()];this.match(ss);)c.push(this.parseLineStringText_());return c}},{key:"parsePolygonTextList_",value:function(){for(var c=[this.parsePolygonText_()];this.match(ss);)c.push(this.parsePolygonText_());return c}},{key:"isEmptyGeometry_",value:function(){var c=this.isTokenType(zo)&&this.token_.value==rs;return c&&this.consume_(),c}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var c=this.factory,d=function(vn){return S(We,ee(vn))},p=function(vn){var Ln=vn.map(function(ii){return c.createLinearRing(ii.map(d))});return Ln.length>1?c.createPolygon(Ln[0],Ln.slice(1)):c.createPolygon(Ln[0])},b=this.token_;if(this.match(zo)){var L=b.value;if(this.layout_=this.parseGeometryLayout_(),L=="GEOMETRYCOLLECTION"){var O=this.parseGeometryCollectionText_();return c.createGeometryCollection(O)}switch(L){case"POINT":var V=this.parsePointText_();return V?c.createPoint(S(We,ee(V))):c.createPoint();case"LINESTRING":var K=this.parseLineStringText_().map(d);return c.createLineString(K);case"LINEARRING":var pe=this.parseLineStringText_().map(d);return c.createLinearRing(pe);case"POLYGON":var Be=this.parsePolygonText_();return Be&&Be.length!==0?p(Be):c.createPolygon();case"MULTIPOINT":var $e=this.parseMultiPointText_();if(!$e||$e.length===0)return c.createMultiPoint();var gt=$e.map(d).map(function(vn){return c.createPoint(vn)});return c.createMultiPoint(gt);case"MULTILINESTRING":var Ft=this.parseMultiLineStringText_().map(function(vn){return c.createLineString(vn.map(d))});return c.createMultiLineString(Ft);case"MULTIPOLYGON":var zt=this.parseMultiPolygonText_();if(!zt||zt.length===0)return c.createMultiPolygon();var gn=zt.map(p);return c.createMultiPolygon(gn);default:throw new Error("Invalid geometry type: "+L)}}throw new Error(this.formatErrorMessage_())}}]),I}();function wo(I){if(I.isEmpty())return"";var c=I.getCoordinate(),d=[c.x,c.y];return c.z===void 0||Number.isNaN(c.z)||d.push(c.z),c.m===void 0||Number.isNaN(c.m)||d.push(c.m),d.join(" ")}function ko(I){for(var c=I.getCoordinates().map(function(L){var O=[L.x,L.y];return L.z===void 0||Number.isNaN(L.z)||O.push(L.z),L.m===void 0||Number.isNaN(L.m)||O.push(L.m),O}),d=[],p=0,b=c.length;p<b;++p)d.push(c[p].join(" "));return d.join(", ")}function ha(I){var c=[];c.push("("+ko(I.getExteriorRing())+")");for(var d=0,p=I.getNumInteriorRing();d<p;++d)c.push("("+ko(I.getInteriorRingN(d))+")");return c.join(", ")}var fa={Point:wo,LineString:ko,LinearRing:ko,Polygon:ha,MultiPoint:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+wo(I.getGeometryN(d))+")");return c.join(", ")},MultiLineString:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+ko(I.getGeometryN(d))+")");return c.join(", ")},MultiPolygon:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+ha(I.getGeometryN(d))+")");return c.join(", ")},GeometryCollection:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push(da(I.getGeometryN(d)));return c.join(", ")}};function da(I){var c=I.getGeometryType(),d=fa[c];c=c.toUpperCase();var p=function(b){var L="";if(b.isEmpty())return L;var O=b.getCoordinate();return O.z===void 0||Number.isNaN(O.z)||(L+="Z"),O.m===void 0||Number.isNaN(O.m)||(L+="M"),L}(I);return p.length>0&&(c+=" "+p),I.isEmpty()?c+" "+rs:c+" ("+d(I)+")"}var Fo=function(){function I(c){t(this,I),this.geometryFactory=c||new is,this.precisionModel=this.geometryFactory.getPrecisionModel()}return a(I,[{key:"read",value:function(c){var d=new El(c);return new Al(d,this.geometryFactory).parse()}},{key:"write",value:function(c){return da(c)}}]),I}(),Ba=function(){function I(c){t(this,I),this.parser=new Fo(c)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}],[{key:"toLineString",value:function(c,d){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+c.x+" "+c.y+", "+d.x+" "+d.y+" )"}}]),I}(),Si=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getIndexAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intLineIndex[c][d]}},{key:"getTopologySummary",value:function(){var c=new ti;return this.isEndPoint()&&c.append(" endpoint"),this._isProper&&c.append(" proper"),this.isCollinear()&&c.append(" collinear"),c.toString()}},{key:"computeIntersection",value:function(c,d,p,b){this._inputLines[0][0]=c,this._inputLines[0][1]=d,this._inputLines[1][0]=p,this._inputLines[1][1]=b,this._result=this.computeIntersect(c,d,p,b)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var c=arguments[0],d=this.getEdgeDistance(c,0),p=this.getEdgeDistance(c,1);d>p?(this._intLineIndex[c][0]=0,this._intLineIndex[c][1]=1):(this._intLineIndex[c][0]=1,this._intLineIndex[c][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var c=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[c][0])&&!this._intPt[d].equals2D(this._inputLines[c][1]))return!0;return!1}}},{key:"getIntersection",value:function(c){return this._intPt[c]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==I.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(c,d){return I.computeEdgeDistance(this._intPt[d],this._inputLines[c][0],this._inputLines[c][1])}},{key:"isCollinear",value:function(){return this._result===I.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Ba.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Ba.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(c,d){return this._inputLines[c][d]}},{key:"isIntersection",value:function(c){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(c))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[c][d]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new We,this._intPt[1]=new We,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(c,d,p){var b=Math.abs(p.x-d.x),L=Math.abs(p.y-d.y),O=-1;if(c.equals(d))O=0;else if(c.equals(p))O=b>L?b:L;else{var V=Math.abs(c.x-d.x),K=Math.abs(c.y-d.y);(O=b>L?V:K)!==0||c.equals(d)||(O=Math.max(V,K))}return St.isTrue(!(O===0&&!c.equals(d)),"Bad distance calculation"),O}},{key:"nonRobustComputeEdgeDistance",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y,O=Math.sqrt(b*b+L*L);return St.isTrue(!(O===0&&!c.equals(d)),"Invalid distance calculation"),O}}]),I}();Si.DONT_INTERSECT=0,Si.DO_INTERSECT=1,Si.COLLINEAR=2,Si.NO_INTERSECTION=0,Si.POINT_INTERSECTION=1,Si.COLLINEAR_INTERSECTION=2;var so=function(I){h(d,I);var c=B(d);function d(){return t(this,d),c.call(this)}return a(d,[{key:"isInSegmentEnvelopes",value:function(p){var b=new dn(this._inputLines[0][0],this._inputLines[0][1]),L=new dn(this._inputLines[1][0],this._inputLines[1][1]);return b.contains(p)&&L.contains(p)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return U(m(d.prototype),"computeIntersection",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=arguments[2];if(this._isProper=!1,dn.intersects(b,L,p)&&mn.index(b,L,p)===0&&mn.index(L,b,p)===0)return this._isProper=!0,(p.equals(b)||p.equals(L))&&(this._isProper=!1),this._result=Si.POINT_INTERSECTION,null;this._result=Si.NO_INTERSECTION}},{key:"intersection",value:function(p,b,L,O){var V=this.intersectionSafe(p,b,L,O);return this.isInSegmentEnvelopes(V)||(V=new We(d.nearestEndpoint(p,b,L,O))),this._precisionModel!==null&&this._precisionModel.makePrecise(V),V}},{key:"checkDD",value:function(p,b,L,O,V){var K=vr.intersection(p,b,L,O),pe=this.isInSegmentEnvelopes(K);Pi.out.println("DD in env = "+pe+"  --------------------- "+K),V.distance(K)>1e-4&&Pi.out.println("Distance = "+V.distance(K))}},{key:"intersectionSafe",value:function(p,b,L,O){var V=bn.intersection(p,b,L,O);return V===null&&(V=d.nearestEndpoint(p,b,L,O)),V}},{key:"computeCollinearIntersection",value:function(p,b,L,O){var V=dn.intersects(p,b,L),K=dn.intersects(p,b,O),pe=dn.intersects(L,O,p),Be=dn.intersects(L,O,b);return V&&K?(this._intPt[0]=L,this._intPt[1]=O,Si.COLLINEAR_INTERSECTION):pe&&Be?(this._intPt[0]=p,this._intPt[1]=b,Si.COLLINEAR_INTERSECTION):V&&pe?(this._intPt[0]=L,this._intPt[1]=p,!L.equals(p)||K||Be?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):V&&Be?(this._intPt[0]=L,this._intPt[1]=b,!L.equals(b)||K||pe?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):K&&pe?(this._intPt[0]=O,this._intPt[1]=p,!O.equals(p)||V||Be?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):K&&Be?(this._intPt[0]=O,this._intPt[1]=b,!O.equals(b)||V||pe?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):Si.NO_INTERSECTION}},{key:"computeIntersect",value:function(p,b,L,O){if(this._isProper=!1,!dn.intersects(p,b,L,O))return Si.NO_INTERSECTION;var V=mn.index(p,b,L),K=mn.index(p,b,O);if(V>0&&K>0||V<0&&K<0)return Si.NO_INTERSECTION;var pe=mn.index(L,O,p),Be=mn.index(L,O,b);return pe>0&&Be>0||pe<0&&Be<0?Si.NO_INTERSECTION:V===0&&K===0&&pe===0&&Be===0?this.computeCollinearIntersection(p,b,L,O):(V===0||K===0||pe===0||Be===0?(this._isProper=!1,p.equals2D(L)||p.equals2D(O)?this._intPt[0]=p:b.equals2D(L)||b.equals2D(O)?this._intPt[0]=b:V===0?this._intPt[0]=new We(L):K===0?this._intPt[0]=new We(O):pe===0?this._intPt[0]=new We(p):Be===0&&(this._intPt[0]=new We(b))):(this._isProper=!0,this._intPt[0]=this.intersection(p,b,L,O)),Si.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(p,b,L,O){var V=p,K=er.pointToSegment(p,L,O),pe=er.pointToSegment(b,L,O);return pe<K&&(K=pe,V=b),(pe=er.pointToSegment(L,p,b))<K&&(K=pe,V=L),(pe=er.pointToSegment(O,p,b))<K&&(K=pe,V=O),V}}]),d}(Si),vc=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"countSegment",value:function(c,d){if(c.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(c.y===this._p.y&&d.y===this._p.y){var p=c.x,b=d.x;return p>b&&(p=d.x,b=c.x),this._p.x>=p&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(c.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&c.y<=this._p.y){var L=mn.index(c,d,this._p);if(L===mn.COLLINEAR)return this._isPointOnSegment=!0,null;d.y<c.y&&(L=-L),L===mn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Ae.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Ae.BOUNDARY:this._crossingCount%2==1?Ae.INTERIOR:Ae.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var c=arguments[0];this._p=c}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof We&&Jt(arguments[1],xn)){for(var c=arguments[0],d=arguments[1],p=new I(c),b=new We,L=new We,O=1;O<d.size();O++)if(d.getCoordinate(O,b),d.getCoordinate(O-1,L),p.countSegment(b,L),p.isOnSegment())return p.getLocation();return p.getLocation()}if(arguments[0]instanceof We&&arguments[1]instanceof Array){for(var V=arguments[0],K=arguments[1],pe=new I(V),Be=1;Be<K.length;Be++){var $e=K[Be],gt=K[Be-1];if(pe.countSegment($e,gt),pe.isOnSegment())return pe.getLocation()}return pe.getLocation()}}}]),I}(),Vs=function(){function I(){t(this,I)}return a(I,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof We&&Jt(arguments[1],xn)){for(var c=arguments[0],d=arguments[1],p=new so,b=new We,L=new We,O=d.size(),V=1;V<O;V++)if(d.getCoordinate(V-1,b),d.getCoordinate(V,L),p.computeIntersection(c,b,L),p.hasIntersection())return!0;return!1}if(arguments[0]instanceof We&&arguments[1]instanceof Array){for(var K=arguments[0],pe=arguments[1],Be=new so,$e=1;$e<pe.length;$e++){var gt=pe[$e-1],Ft=pe[$e];if(Be.computeIntersection(K,gt,Ft),Be.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(c,d){return vc.locatePointInRing(c,d)}},{key:"isInRing",value:function(c,d){return I.locateInRing(c,d)!==Ae.EXTERIOR}}]),I}(),xr=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setAllLocations",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]=c}},{key:"isNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]!==Ae.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]===Ae.NONE&&(this.location[d]=c)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(c){if(c.location.length>this.location.length){var d=new Array(3).fill(null);d[Se.ON]=this.location[Se.ON],d[Se.LEFT]=Ae.NONE,d[Se.RIGHT]=Ae.NONE,this.location=d}for(var p=0;p<this.location.length;p++)this.location[p]===Ae.NONE&&p<c.location.length&&(this.location[p]=c.location[p])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var c=this.location[Se.LEFT];this.location[Se.LEFT]=this.location[Se.RIGHT],this.location[Se.RIGHT]=c}},{key:"toString",value:function(){var c=new Ri;return this.location.length>1&&c.append(Ae.toLocationSymbol(this.location[Se.LEFT])),c.append(Ae.toLocationSymbol(this.location[Se.ON])),this.location.length>1&&c.append(Ae.toLocationSymbol(this.location[Se.RIGHT])),c.toString()}},{key:"setLocations",value:function(c,d,p){this.location[Se.ON]=c,this.location[Se.LEFT]=d,this.location[Se.RIGHT]=p}},{key:"get",value:function(c){return c<this.location.length?this.location[c]:Ae.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]===Ae.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var c=arguments[0];this.setLocation(Se.ON,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.location[d]=p}}},{key:"init",value:function(c){this.location=new Array(c).fill(null),this.setAllLocations(Ae.NONE)}},{key:"isEqualOnSide",value:function(c,d){return this.location[d]===c.location[d]}},{key:"allPositionsEqual",value:function(c){for(var d=0;d<this.location.length;d++)if(this.location[d]!==c)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];this.init(c.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[Se.ON]=d}else if(arguments[0]instanceof I){var p=arguments[0];if(this.init(p.location.length),p!==null)for(var b=0;b<this.location.length;b++)this.location[b]=p.location[b]}}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this.init(3),this.location[Se.ON]=L,this.location[Se.LEFT]=O,this.location[Se.RIGHT]=V}}}]),I}(),wi=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getGeometryCount",value:function(){var c=0;return this.elt[0].isNull()||c++,this.elt[1].isNull()||c++,c}},{key:"setAllLocations",value:function(c,d){this.elt[c].setAllLocations(d)}},{key:"isNull",value:function(c){return this.elt[c].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var c=arguments[0];this.setAllLocationsIfNull(0,c),this.setAllLocationsIfNull(1,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.elt[d].setAllLocationsIfNull(p)}}},{key:"isLine",value:function(c){return this.elt[c].isLine()}},{key:"merge",value:function(c){for(var d=0;d<2;d++)this.elt[d]===null&&c.elt[d]!==null?this.elt[d]=new xr(c.elt[d]):this.elt[d].merge(c.elt[d])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var c=arguments[0];return this.elt[c].get(Se.ON)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return this.elt[d].get(p)}}},{key:"toString",value:function(){var c=new Ri;return this.elt[0]!==null&&(c.append("A:"),c.append(this.elt[0].toString())),this.elt[1]!==null&&(c.append(" B:"),c.append(this.elt[1].toString())),c.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var c=arguments[0];return this.elt[c].isArea()}}},{key:"isAnyNull",value:function(c){return this.elt[c].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.elt[c].setLocation(Se.ON,d)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];this.elt[p].setLocation(b,L)}}},{key:"isEqualOnSide",value:function(c,d){return this.elt[0].isEqualOnSide(c.elt[0],d)&&this.elt[1].isEqualOnSide(c.elt[1],d)}},{key:"allPositionsEqual",value:function(c,d){return this.elt[c].allPositionsEqual(d)}},{key:"toLine",value:function(c){this.elt[c].isArea()&&(this.elt[c]=new xr(this.elt[c].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var c=arguments[0];this.elt[0]=new xr(c),this.elt[1]=new xr(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.elt[0]=new xr(d.elt[0]),this.elt[1]=new xr(d.elt[1])}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.elt[0]=new xr(Ae.NONE),this.elt[1]=new xr(Ae.NONE),this.elt[p].setLocation(b)}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this.elt[0]=new xr(L,O,V),this.elt[1]=new xr(L,O,V)}else if(arguments.length===4){var K=arguments[0],pe=arguments[1],Be=arguments[2],$e=arguments[3];this.elt[0]=new xr(Ae.NONE,Ae.NONE,Ae.NONE),this.elt[1]=new xr(Ae.NONE,Ae.NONE,Ae.NONE),this.elt[K].setLocations(pe,Be,$e)}}},{key:"toLineLabel",value:function(c){for(var d=new I(Ae.NONE),p=0;p<2;p++)d.setLocation(p,c.getLocation(p));return d}}]),I}(),hr=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var c=new Array(this._pts.size()).fill(null),d=0;d<this._pts.size();d++)c[d]=this._pts.get(d);this._ring=this._geometryFactory.createLinearRing(c),this._isHole=mn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(c){this._startDe=c;var d=c,p=!0;do{if(d===null)throw new Rt("Found null DirectedEdge");if(d.getEdgeRing()===this)throw new Rt("Directed Edge visited twice during ring-building at "+d.getCoordinate());this._edges.add(d);var b=d.getLabel();St.isTrue(b.isArea()),this.mergeLabel(b),this.addPoints(d.getEdge(),d.isForward(),p),p=!1,this.setEdgeRing(d,this),d=this.getNext(d)}while(d!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(c){return this._pts.get(c)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var c=this._startDe;do{var d=c.getNode().getEdges().getOutgoingDegree(this);d>this._maxNodeDegree&&(this._maxNodeDegree=d),c=this.getNext(c)}while(c!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(c,d,p){var b=c.getCoordinates();if(d){var L=1;p&&(L=0);for(var O=L;O<b.length;O++)this._pts.add(b[O])}else{var V=b.length-2;p&&(V=b.length-1);for(var K=V;K>=0;K--)this._pts.add(b[K])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var c=this._startDe;do c.getEdge().setInResult(!0),c=c.getNext();while(c!==this._startDe)}},{key:"containsPoint",value:function(c){var d=this.getLinearRing();if(!d.getEnvelopeInternal().contains(c)||!Vs.isInRing(c,d.getCoordinates()))return!1;for(var p=this._holes.iterator();p.hasNext();)if(p.next().containsPoint(c))return!1;return!0}},{key:"addHole",value:function(c){this._holes.add(c)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var c=arguments[0];this.mergeLabel(c,0),this.mergeLabel(c,1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1],b=d.getLocation(p,Se.RIGHT);if(b===Ae.NONE)return null;if(this._label.getLocation(p)===Ae.NONE)return this._label.setLocation(p,b),null}}},{key:"setShell",value:function(c){this._shell=c,c!==null&&c.addHole(this)}},{key:"toPolygon",value:function(c){for(var d=new Array(this._holes.size()).fill(null),p=0;p<this._holes.size();p++)d[p]=this._holes.get(p).getLinearRing();return c.createPolygon(this.getLinearRing(),d)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new At,this._pts=new At,this._label=new wi(Ae.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new At,this._geometryFactory=null,arguments.length!==0&&arguments.length===2){var c=arguments[0],d=arguments[1];this._geometryFactory=d,this.computePoints(c),this.computeRing()}}}]),I}(),Ua=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"setEdgeRing",value:function(p,b){p.setMinEdgeRing(b)}},{key:"getNext",value:function(p){return p.getNextMin()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];hr.constructor_.call(this,p,b)}}]),d}(hr),ja=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"buildMinimalRings",value:function(){var p=new At,b=this._startDe;do{if(b.getMinEdgeRing()===null){var L=new Ua(b,this._geometryFactory);p.add(L)}b=b.getNext()}while(b!==this._startDe);return p}},{key:"setEdgeRing",value:function(p,b){p.setEdgeRing(b)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var p=this._startDe;do p.getNode().getEdges().linkMinimalDirectedEdges(this),p=p.getNext();while(p!==this._startDe)}},{key:"getNext",value:function(p){return p.getNext()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];hr.constructor_.call(this,p,b)}}]),d}(hr),pa=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setVisited",value:function(c){this._isVisited=c}},{key:"setInResult",value:function(c){this._isInResult=c}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(c){this._label=c}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(c){this._isCovered=c,this._isCoveredSet=!0}},{key:"updateIM",value:function(c){St.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(c)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._label=c}}}]),I}(),ma=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"isIncidentEdgeInResult",value:function(){for(var p=this.getEdges().getEdges().iterator();p.hasNext();)if(p.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(p){p.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(p){}},{key:"computeMergedLocation",value:function(p,b){var L=Ae.NONE;if(L=this._label.getLocation(b),!p.isNull(b)){var O=p.getLocation(b);L!==Ae.BOUNDARY&&(L=O)}return L}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return U(m(d.prototype),"setLabel",this).apply(this,arguments);var p=arguments[0],b=arguments[1];this._label===null?this._label=new wi(p,b):this._label.setLocation(p,b)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof d){var p=arguments[0];this.mergeLabel(p._label)}else if(arguments[0]instanceof wi)for(var b=arguments[0],L=0;L<2;L++){var O=this.computeMergedLocation(b,L),V=this._label.getLocation(L);V===Ae.NONE&&this._label.setLocation(L,O)}}},{key:"add",value:function(p){this._edges.insert(p),p.setNode(this)}},{key:"setLabelBoundary",value:function(p){if(this._label===null)return null;var b=Ae.NONE;this._label!==null&&(b=this._label.getLocation(p));var L=null;switch(b){case Ae.BOUNDARY:L=Ae.INTERIOR;break;case Ae.INTERIOR:default:L=Ae.BOUNDARY}this._label.setLocation(p,L)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var p=arguments[0],b=arguments[1];this._coord=p,this._edges=b,this._label=new wi(0,Ae.NONE)}}]),d}(pa),Oo=function(I){h(d,I);var c=B(d);function d(){return t(this,d),c.apply(this,arguments)}return d}(Fr);function lu(I){return I==null?0:I.color}function si(I){return I==null?null:I.parent}function vs(I,c){I!==null&&(I.color=c)}function Tl(I){return I==null?null:I.left}function uu(I){return I==null?null:I.right}var Bo=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),(p=c.call(this)).root_=null,p.size_=0,p}return a(d,[{key:"get",value:function(p){for(var b=this.root_;b!==null;){var L=p.compareTo(b.key);if(L<0)b=b.left;else{if(!(L>0))return b.value;b=b.right}}return null}},{key:"put",value:function(p,b){if(this.root_===null)return this.root_={key:p,value:b,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var L,O,V=this.root_;do if(L=V,(O=p.compareTo(V.key))<0)V=V.left;else{if(!(O>0)){var K=V.value;return V.value=b,K}V=V.right}while(V!==null);var pe={key:p,left:null,right:null,value:b,parent:L,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return O<0?L.left=pe:L.right=pe,this.fixAfterInsertion(pe),this.size_++,null}},{key:"fixAfterInsertion",value:function(p){var b;for(p.color=1;p!=null&&p!==this.root_&&p.parent.color===1;)si(p)===Tl(si(si(p)))?lu(b=uu(si(si(p))))===1?(vs(si(p),0),vs(b,0),vs(si(si(p)),1),p=si(si(p))):(p===uu(si(p))&&(p=si(p),this.rotateLeft(p)),vs(si(p),0),vs(si(si(p)),1),this.rotateRight(si(si(p)))):lu(b=Tl(si(si(p))))===1?(vs(si(p),0),vs(b,0),vs(si(si(p)),1),p=si(si(p))):(p===Tl(si(p))&&(p=si(p),this.rotateRight(p)),vs(si(p),0),vs(si(si(p)),1),this.rotateLeft(si(si(p))));this.root_.color=0}},{key:"values",value:function(){var p=new At,b=this.getFirstEntry();if(b!==null)for(p.add(b.value);(b=d.successor(b))!==null;)p.add(b.value);return p}},{key:"entrySet",value:function(){var p=new On,b=this.getFirstEntry();if(b!==null)for(p.add(b);(b=d.successor(b))!==null;)p.add(b);return p}},{key:"rotateLeft",value:function(p){if(p!=null){var b=p.right;p.right=b.left,b.left!=null&&(b.left.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.left===p?p.parent.left=b:p.parent.right=b,b.left=p,p.parent=b}}},{key:"rotateRight",value:function(p){if(p!=null){var b=p.left;p.left=b.right,b.right!=null&&(b.right.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.right===p?p.parent.right=b:p.parent.left=b,b.right=p,p.parent=b}}},{key:"getFirstEntry",value:function(){var p=this.root_;if(p!=null)for(;p.left!=null;)p=p.left;return p}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(p){for(var b=this.root_;b!==null;){var L=p.compareTo(b.key);if(L<0)b=b.left;else{if(!(L>0))return!0;b=b.right}}return!1}}],[{key:"successor",value:function(p){var b;if(p===null)return null;if(p.right!==null){for(b=p.right;b.left!==null;)b=b.left;return b}b=p.parent;for(var L=p;b!==null&&L===b.right;)L=b,b=b.parent;return b}}]),d}(Oo),Uo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"find",value:function(c){return this.nodeMap.get(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof We){var c=arguments[0],d=this.nodeMap.get(c);return d===null&&(d=this.nodeFact.createNode(c),this.nodeMap.put(c,d)),d}if(arguments[0]instanceof ma){var p=arguments[0],b=this.nodeMap.get(p.getCoordinate());return b===null?(this.nodeMap.put(p.getCoordinate(),p),p):(b.mergeLabel(p),b)}}},{key:"print",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(c){for(var d=new At,p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().getLocation(c)===Ae.BOUNDARY&&d.add(b)}return d}},{key:"add",value:function(c){var d=c.getCoordinate();this.addNode(d).add(c)}}],[{key:"constructor_",value:function(){this.nodeMap=new Bo,this.nodeFact=null;var c=arguments[0];this.nodeFact=c}}]),I}(),fr=function(){function I(){t(this,I)}return a(I,null,[{key:"isNorthern",value:function(c){return c===I.NE||c===I.NW}},{key:"isOpposite",value:function(c,d){return c!==d&&(c-d+4)%4===2}},{key:"commonHalfPlane",value:function(c,d){if(c===d)return c;if((c-d+4)%4===2)return-1;var p=c<d?c:d;return p===0&&(c>d?c:d)===3?3:p}},{key:"isInHalfPlane",value:function(c,d){return d===I.SE?c===I.SE||c===I.SW:c===d||c===d+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new xe("Cannot compute the quadrant for point ( "+c+", "+d+" )");return c>=0?d>=0?I.NE:I.SE:d>=0?I.NW:I.SW}if(arguments[0]instanceof We&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1];if(b.x===p.x&&b.y===p.y)throw new xe("Cannot compute the quadrant for two identical points "+p);return b.x>=p.x?b.y>=p.y?I.NE:I.SE:b.y>=p.y?I.NW:I.SW}}}]),I}();fr.NE=0,fr.NW=1,fr.SW=2,fr.SE=3;var ga=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareDirection",value:function(c){return this._dx===c._dx&&this._dy===c._dy?0:this._quadrant>c._quadrant?1:this._quadrant<c._quadrant?-1:mn.index(c._p0,c._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(c){this._node=c}},{key:"print",value:function(c){var d=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),b=p.lastIndexOf("."),L=p.substring(b+1);c.print("  "+L+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)}},{key:"compareTo",value:function(c){var d=c;return this.compareDirection(d)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var c=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),p=d.lastIndexOf(".");return"  "+d.substring(p+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+c+"   "+this._label}},{key:"computeLabel",value:function(c){}},{key:"init",value:function(c,d){this._p0=c,this._p1=d,this._dx=d.x-c.x,this._dy=d.y-c.y,this._quadrant=fr.quadrant(this._dx,this._dy),St.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[ye]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var c=arguments[0];this._edge=c}else if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2];I.constructor_.call(this,d,p,b,null)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];I.constructor_.call(this,L),this.init(O,V),this._label=K}}}]),I}(),_a=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(p){return this._depth[p]}},{key:"setVisited",value:function(p){this._isVisited=p}},{key:"computeDirectedLabel",value:function(){this._label=new wi(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(p,b){if(this._depth[p]!==-999&&this._depth[p]!==b)throw new Rt("assigned depths do not match",this.getCoordinate());this._depth[p]=b}},{key:"isInteriorAreaEdge",value:function(){for(var p=!0,b=0;b<2;b++)this._label.isArea(b)&&this._label.getLocation(b,Se.LEFT)===Ae.INTERIOR&&this._label.getLocation(b,Se.RIGHT)===Ae.INTERIOR||(p=!1);return p}},{key:"setNextMin",value:function(p){this._nextMin=p}},{key:"print",value:function(p){U(m(d.prototype),"print",this).call(this,p),p.print(" "+this._depth[Se.LEFT]+"/"+this._depth[Se.RIGHT]),p.print(" ("+this.getDepthDelta()+")"),this._isInResult&&p.print(" inResult")}},{key:"setMinEdgeRing",value:function(p){this._minEdgeRing=p}},{key:"isLineEdge",value:function(){var p=this._label.isLine(0)||this._label.isLine(1),b=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ae.EXTERIOR),L=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ae.EXTERIOR);return p&&b&&L}},{key:"setEdgeRing",value:function(p){this._edgeRing=p}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var p=this._edge.getDepthDelta();return this._isForward||(p=-p),p}},{key:"setInResult",value:function(p){this._isInResult=p}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(p){this.print(p),p.print(" "),this._isForward?this._edge.print(p):this._edge.printReverse(p)}},{key:"setSym",value:function(p){this._sym=p}},{key:"setVisitedEdge",value:function(p){this.setVisited(p),this._sym.setVisited(p)}},{key:"setEdgeDepths",value:function(p,b){var L=this.getEdge().getDepthDelta();this._isForward||(L=-L);var O=1;p===Se.LEFT&&(O=-1);var V=Se.opposite(p),K=b+L*O;this.setDepth(p,b),this.setDepth(V,K)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(p){this._next=p}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var p=arguments[0],b=arguments[1];if(ga.constructor_.call(this,p),this._isForward=b,b)this.init(p.getCoordinate(0),p.getCoordinate(1));else{var L=p.getNumPoints()-1;this.init(p.getCoordinate(L),p.getCoordinate(L-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(p,b){return p===Ae.EXTERIOR&&b===Ae.INTERIOR?1:p===Ae.INTERIOR&&b===Ae.EXTERIOR?-1:0}}]),d}(ga),qa=function(){function I(){t(this,I)}return a(I,[{key:"createNode",value:function(c){return new ma(c,null)}}]),I}(),bs=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"printEdges",value:function(c){c.println("Edges:");for(var d=0;d<this._edges.size();d++){c.println("edge "+d+":");var p=this._edges.get(d);p.print(c),p.eiList.print(c)}}},{key:"find",value:function(c){return this._nodes.find(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof ma){var c=arguments[0];return this._nodes.addNode(c)}if(arguments[0]instanceof We){var d=arguments[0];return this._nodes.addNode(d)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(c){Pi.out.println(c)}},{key:"isBoundaryNode",value:function(c,d){var p=this._nodes.find(d);if(p===null)return!1;var b=p.getLabel();return b!==null&&b.getLocation(c)===Ae.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(c,d,p,b){return!!c.equals(p)&&mn.index(c,d,b)===mn.COLLINEAR&&fr.quadrant(c,d)===fr.quadrant(p,b)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(c){Pi.out.print(c)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),L=b.getCoordinates();if(this.matchInSameDirection(c,d,L[0],L[1])||this.matchInSameDirection(c,d,L[L.length-1],L[L.length-2]))return b}return null}},{key:"insertEdge",value:function(c){this._edges.add(c)}},{key:"findEdgeEnd",value:function(c){for(var d=this.getEdgeEnds().iterator();d.hasNext();){var p=d.next();if(p.getEdge()===c)return p}return null}},{key:"addEdges",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();this._edges.add(p);var b=new _a(p,!0),L=new _a(p,!1);b.setSym(L),L.setSym(b),this.add(b),this.add(L)}}},{key:"add",value:function(c){this._nodes.add(c),this._edgeEndList.add(c)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),L=b.getCoordinates();if(c.equals(L[0])&&d.equals(L[1]))return b}return null}}],[{key:"constructor_",value:function(){if(this._edges=new At,this._nodes=null,this._edgeEndList=new At,arguments.length===0)this._nodes=new Uo(new qa);else if(arguments.length===1){var c=arguments[0];this._nodes=new Uo(c)}}},{key:"linkResultDirectedEdges",value:function(c){for(var d=c.iterator();d.hasNext();)d.next().getEdges().linkResultDirectedEdges()}}]),I}(),bc=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"sortShellsAndHoles",value:function(c,d,p){for(var b=c.iterator();b.hasNext();){var L=b.next();L.isHole()?p.add(L):d.add(L)}}},{key:"computePolygons",value:function(c){for(var d=new At,p=c.iterator();p.hasNext();){var b=p.next().toPolygon(this._geometryFactory);d.add(b)}return d}},{key:"placeFreeHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();if(b.getShell()===null){var L=I.findEdgeRingContaining(b,c);if(L===null)throw new Rt("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(L)}}}},{key:"buildMinimalEdgeRings",value:function(c,d,p){for(var b=new At,L=c.iterator();L.hasNext();){var O=L.next();if(O.getMaxNodeDegree()>2){O.linkDirectedEdgesForMinimalEdgeRings();var V=O.buildMinimalRings(),K=this.findShell(V);K!==null?(this.placePolygonHoles(K,V),d.add(K)):p.addAll(V)}else b.add(O)}return b}},{key:"buildMaximalEdgeRings",value:function(c){for(var d=new At,p=c.iterator();p.hasNext();){var b=p.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var L=new ja(b,this._geometryFactory);d.add(L),L.setInResult()}}return d}},{key:"placePolygonHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();b.isHole()&&b.setShell(c)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(c){for(var d=0,p=null,b=c.iterator();b.hasNext();){var L=b.next();L.isHole()||(p=L,d++)}return St.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),p}},{key:"add",value:function(){if(arguments.length===1){var c=arguments[0];this.add(c.getEdgeEnds(),c.getNodes())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];bs.linkResultDirectedEdges(p);var b=this.buildMaximalEdgeRings(d),L=new At,O=this.buildMinimalEdgeRings(b,this._shellList,L);this.sortShellsAndHoles(O,this._shellList,L),this.placeFreeHoles(this._shellList,L)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new At;var c=arguments[0];this._geometryFactory=c}},{key:"findEdgeRingContaining",value:function(c,d){for(var p=c.getLinearRing(),b=p.getEnvelopeInternal(),L=p.getCoordinateN(0),O=null,V=null,K=d.iterator();K.hasNext();){var pe=K.next(),Be=pe.getLinearRing(),$e=Be.getEnvelopeInternal();if(!$e.equals(b)&&$e.contains(b)){L=$n.ptNotInList(p.getCoordinates(),Be.getCoordinates());var gt=!1;Vs.isInRing(L,Be.getCoordinates())&&(gt=!0),gt&&(O===null||V.contains($e))&&(V=(O=pe).getLinearRing().getEnvelopeInternal())}}return O}}]),I}(),Va=function(){function I(){t(this,I)}return a(I,[{key:"getBounds",value:function(){}}]),I}(),Lr=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Va,ve]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var c=arguments[0],d=arguments[1];this._bounds=c,this._item=d}}]),I}(),xs=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"poll",value:function(){if(this.isEmpty())return null;var c=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),c}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(c){for(var d=null,p=this._items.get(c);2*c<=this._size&&((d=2*c)!==this._size&&this._items.get(d+1).compareTo(this._items.get(d))<0&&d++,this._items.get(d).compareTo(p)<0);c=d)this._items.set(c,this._items.get(d));this._items.set(c,p)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(c){this._items.add(null),this._size+=1;var d=this._size;for(this._items.set(0,c);c.compareTo(this._items.get(Math.trunc(d/2)))<0;d/=2)this._items.set(d,this._items.get(Math.trunc(d/2)));this._items.set(d,c)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new At,this._items.add(null)}}]),I}(),oi=function(){function I(){t(this,I)}return a(I,[{key:"insert",value:function(c,d){}},{key:"remove",value:function(c,d){}},{key:"query",value:function(){}}]),I}(),Mr=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(c){St.isTrue(this._bounds===null),this._childBoundables.add(c)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Va,ve]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new At,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._level=c}}}]),I}(),jo={reverseOrder:function(){return{compare:function(I,c){return c.compareTo(I)}}},min:function(I){return jo.sort(I),I.get(0)},sort:function(I,c){var d=I.toArray();c?lt.sort(d,c):lt.sort(d);for(var p=I.iterator(),b=0,L=d.length;b<L;b++)p.next(),p.set(d[b])},singletonList:function(I){var c=new At;return c.add(I),c}},qo=function(){function I(){t(this,I)}return a(I,null,[{key:"maxDistance",value:function(c,d,p,b,L,O,V,K){var pe=I.distance(c,d,L,O);return pe=Math.max(pe,I.distance(c,d,V,K)),pe=Math.max(pe,I.distance(p,b,L,O)),pe=Math.max(pe,I.distance(p,b,V,K))}},{key:"distance",value:function(c,d,p,b){var L=p-c,O=b-d;return Math.sqrt(L*L+O*O)}},{key:"maximumDistance",value:function(c,d){var p=Math.min(c.getMinX(),d.getMinX()),b=Math.min(c.getMinY(),d.getMinY()),L=Math.max(c.getMaxX(),d.getMaxX()),O=Math.max(c.getMaxY(),d.getMaxY());return I.distance(p,b,L,O)}},{key:"minMaxDistance",value:function(c,d){var p=c.getMinX(),b=c.getMinY(),L=c.getMaxX(),O=c.getMaxY(),V=d.getMinX(),K=d.getMinY(),pe=d.getMaxX(),Be=d.getMaxY(),$e=I.maxDistance(p,b,p,O,V,K,V,Be);return $e=Math.min($e,I.maxDistance(p,b,p,O,V,K,pe,K)),$e=Math.min($e,I.maxDistance(p,b,p,O,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(p,b,p,O,pe,Be,pe,K)),$e=Math.min($e,I.maxDistance(p,b,L,b,V,K,V,Be)),$e=Math.min($e,I.maxDistance(p,b,L,b,V,K,pe,K)),$e=Math.min($e,I.maxDistance(p,b,L,b,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(p,b,L,b,pe,Be,pe,K)),$e=Math.min($e,I.maxDistance(L,O,p,O,V,K,V,Be)),$e=Math.min($e,I.maxDistance(L,O,p,O,V,K,pe,K)),$e=Math.min($e,I.maxDistance(L,O,p,O,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(L,O,p,O,pe,Be,pe,K)),$e=Math.min($e,I.maxDistance(L,O,L,b,V,K,V,Be)),$e=Math.min($e,I.maxDistance(L,O,L,b,V,K,pe,K)),$e=Math.min($e,I.maxDistance(L,O,L,b,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(L,O,L,b,pe,Be,pe,K))}}]),I}(),Vo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"maximumDistance",value:function(){return qo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(c,d){var p=I.isComposite(this._boundable1),b=I.isComposite(this._boundable2);if(p&&b)return I.area(this._boundable1)>I.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,c,d),null):(this.expand(this._boundable2,this._boundable1,!0,c,d),null);if(p)return this.expand(this._boundable1,this._boundable2,!1,c,d),null;if(b)return this.expand(this._boundable2,this._boundable1,!0,c,d),null;throw new xe("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(I.isComposite(this._boundable1)||I.isComposite(this._boundable2))}},{key:"compareTo",value:function(c){var d=c;return this._distance<d._distance?-1:this._distance>d._distance?1:0}},{key:"expand",value:function(c,d,p,b,L){for(var O=c.getChildBoundables().iterator();O.hasNext();){var V=O.next(),K=null;(K=p?new I(d,V,this._itemDistance):new I(V,d,this._itemDistance)).getDistance()<L&&b.add(K)}}},{key:"getBoundable",value:function(c){return c===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[ye]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var c=arguments[0],d=arguments[1],p=arguments[2];this._boundable1=c,this._boundable2=d,this._itemDistance=p,this._distance=this.distance()}},{key:"area",value:function(c){return c.getBounds().getArea()}},{key:"isComposite",value:function(c){return c instanceof Mr}}]),I}(),Cl=function(){function I(){t(this,I)}return a(I,[{key:"visitItem",value:function(c){}}]),I}(),Go=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"queryInternal",value:function(){if(Jt(arguments[2],Cl)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var c=arguments[0],d=arguments[1],p=arguments[2],b=d.getChildBoundables(),L=0;L<b.size();L++){var O=b.get(L);this.getIntersectsOp().intersects(O.getBounds(),c)&&(O instanceof Mr?this.queryInternal(c,O,p):O instanceof Lr?p.visitItem(O.getItem()):St.shouldNeverReachHere())}else if(Jt(arguments[2],Fn)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var V=arguments[0],K=arguments[1],pe=arguments[2],Be=K.getChildBoundables(),$e=0;$e<Be.size();$e++){var gt=Be.get($e);this.getIntersectsOp().intersects(gt.getBounds(),V)&&(gt instanceof Mr?this.queryInternal(V,gt,pe):gt instanceof Lr?pe.add(gt.getItem()):St.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(c){return c.get(c.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();b instanceof Mr?d+=this.size(b):b instanceof Lr&&(d+=1)}return d}}},{key:"removeItem",value:function(c,d){for(var p=null,b=c.getChildBoundables().iterator();b.hasNext();){var L=b.next();L instanceof Lr&&L.getItem()===d&&(p=L)}return p!==null&&(c.getChildBoundables().remove(p),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var c=this.itemsTree(this._root);return c===null?new At:c}if(arguments.length===1){for(var d=arguments[0],p=new At,b=d.getChildBoundables().iterator();b.hasNext();){var L=b.next();if(L instanceof Mr){var O=this.itemsTree(L);O!==null&&p.add(O)}else L instanceof Lr?p.add(L.getItem()):St.shouldNeverReachHere()}return p.size()<=0?null:p}}},{key:"insert",value:function(c,d){St.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Lr(c,d))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var c=arguments[0],d=new At;return this.boundablesAtLevel(c,this._root,d),d}if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];if(St.isTrue(p>-2),b.getLevel()===p)return L.add(b),null;for(var O=b.getChildBoundables().iterator();O.hasNext();){var V=O.next();V instanceof Mr?this.boundablesAtLevel(p,V,L):(St.isTrue(V instanceof Lr),p===-1&&L.add(V))}return null}}},{key:"query",value:function(){if(arguments.length===1){var c=arguments[0];this.build();var d=new At;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,d),d}if(arguments.length===2){var p=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.queryInternal(p,this._root,b)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.remove(c,this._root,d)}if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2],O=this.removeItem(b,L);if(O)return!0;for(var V=null,K=b.getChildBoundables().iterator();K.hasNext();){var pe=K.next();if(this.getIntersectsOp().intersects(pe.getBounds(),p)&&pe instanceof Mr&&(O=this.remove(p,pe,L))){V=pe;break}}return V!==null&&V.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(V),O}}},{key:"createHigherLevels",value:function(c,d){St.isTrue(!c.isEmpty());var p=this.createParentBoundables(c,d+1);return p.size()===1?p.get(0):this.createHigherLevels(p,d+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();if(b instanceof Mr){var L=this.depth(b);L>d&&(d=L)}}return d+1}}},{key:"createParentBoundables",value:function(c,d){St.isTrue(!c.isEmpty());var p=new At;p.add(this.createNode(d));var b=new At(c);jo.sort(b,this.getComparator());for(var L=b.iterator();L.hasNext();){var O=L.next();this.lastNode(p).getChildBoundables().size()===this.getNodeCapacity()&&p.add(this.createNode(d)),this.lastNode(p).addChildBoundable(O)}return p}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[ve]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new At,this._nodeCapacity=null,arguments.length===0)I.constructor_.call(this,I.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var c=arguments[0];St.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}}},{key:"compareDoubles",value:function(c,d){return c>d?1:c<d?-1:0}}]),I}();Go.IntersectsOp=function(){},Go.DEFAULT_NODE_CAPACITY=10;var cu=function(){function I(){t(this,I)}return a(I,[{key:"distance",value:function(c,d){}}]),I}(),os=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"createParentBoundablesFromVerticalSlices",value:function(p,b){St.isTrue(p.length>0);for(var L=new At,O=0;O<p.length;O++)L.addAll(this.createParentBoundablesFromVerticalSlice(p[O],b));return L}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.nearestNeighbourK(p,bt.POSITIVE_INFINITY,b)}if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2],K=O,pe=new xs;pe.add(L);for(var Be=new xs;!pe.isEmpty()&&K>=0;){var $e=pe.poll(),gt=$e.getDistance();if(gt>=K)break;if($e.isLeaves())if(Be.size()<V)Be.add($e);else{var Ft=Be.peek();Ft.getDistance()>gt&&(Be.poll(),Be.add($e));var zt=Be.peek();K=zt.getDistance()}else $e.expandToQueue(pe,K)}return d.getItems(Be)}}},{key:"createNode",value:function(p){return new Ll(p)}},{key:"size",value:function(){return arguments.length===0?U(m(d.prototype),"size",this).call(this):U(m(d.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn))return U(m(d.prototype),"insert",this).apply(this,arguments);var p=arguments[0],b=arguments[1];if(p.isNull())return null;U(m(d.prototype),"insert",this).call(this,p,b)}},{key:"getIntersectsOp",value:function(){return d.intersectsOp}},{key:"verticalSlices",value:function(p,b){for(var L=Math.trunc(Math.ceil(p.size()/b)),O=new Array(b).fill(null),V=p.iterator(),K=0;K<b;K++){O[K]=new At;for(var pe=0;V.hasNext()&&pe<L;){var Be=V.next();O[K].add(Be),pe++}}return O}},{key:"query",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"query",this).call(this,p)}if(arguments.length===2){var b=arguments[0],L=arguments[1];U(m(d.prototype),"query",this).call(this,b,L)}}},{key:"getComparator",value:function(){return d.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(p,b){return U(m(d.prototype),"createParentBoundables",this).call(this,p,b)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn){var p=arguments[0],b=arguments[1];return U(m(d.prototype),"remove",this).call(this,p,b)}return U(m(d.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?U(m(d.prototype),"depth",this).call(this):U(m(d.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(p,b){St.isTrue(!p.isEmpty());var L=Math.trunc(Math.ceil(p.size()/this.getNodeCapacity())),O=new At(p);jo.sort(O,d.xComparator);var V=this.verticalSlices(O,Math.trunc(Math.ceil(Math.sqrt(L))));return this.createParentBoundablesFromVerticalSlices(V,b)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(Jt(arguments[0],cu)){var p=arguments[0];if(this.isEmpty())return null;var b=new Vo(this.getRoot(),this.getRoot(),p);return this.nearestNeighbour(b)}if(arguments[0]instanceof Vo){var L=arguments[0],O=bt.POSITIVE_INFINITY,V=null,K=new xs;for(K.add(L);!K.isEmpty()&&O>0;){var pe=K.poll(),Be=pe.getDistance();if(Be>=O)break;pe.isLeaves()?(O=Be,V=pe):pe.expandToQueue(K,O)}return V===null?null:[V.getBoundable(0).getItem(),V.getBoundable(1).getItem()]}}else{if(arguments.length===2){var $e=arguments[0],gt=arguments[1];if(this.isEmpty()||$e.isEmpty())return null;var Ft=new Vo(this.getRoot(),$e.getRoot(),gt);return this.nearestNeighbour(Ft)}if(arguments.length===3){var zt=arguments[0],gn=arguments[1],vn=arguments[2],Ln=new Lr(zt,gn),ii=new Vo(this.getRoot(),Ln,vn);return this.nearestNeighbour(ii)[0]}if(arguments.length===4){var gi=arguments[0],ui=arguments[1],nr=arguments[2],us=arguments[3],Ps=new Lr(gi,ui),di=new Vo(this.getRoot(),Ps,nr);return this.nearestNeighbourK(di,us)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1],L=bt.POSITIVE_INFINITY,O=new xs;for(O.add(p);!O.isEmpty();){var V=O.poll(),K=V.getDistance();if(K>b)return!1;if(V.maximumDistance()<=b)return!0;if(V.isLeaves()){if((L=K)<=b)return!0}else V.expandToQueue(O,L)}return!1}if(arguments.length===3){var pe=arguments[0],Be=arguments[1],$e=arguments[2],gt=new Vo(this.getRoot(),pe.getRoot(),Be);return this.isWithinDistance(gt,$e)}}},{key:"interfaces_",get:function(){return[oi,ve]}}],[{key:"constructor_",value:function(){if(arguments.length===0)d.constructor_.call(this,d.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var p=arguments[0];Go.constructor_.call(this,p)}}},{key:"centreX",value:function(p){return d.avg(p.getMinX(),p.getMaxX())}},{key:"avg",value:function(p,b){return(p+b)/2}},{key:"getItems",value:function(p){for(var b=new Array(p.size()).fill(null),L=0;!p.isEmpty();){var O=p.poll();b[L]=O.getBoundable(0).getItem(),L++}return b}},{key:"centreY",value:function(p){return d.avg(p.getMinY(),p.getMaxY())}}]),d}(Go),Ll=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeBounds",value:function(){for(var p=null,b=this.getChildBoundables().iterator();b.hasNext();){var L=b.next();p===null?p=new dn(L.getBounds()):p.expandToInclude(L.getBounds())}return p}}],[{key:"constructor_",value:function(){var p=arguments[0];Mr.constructor_.call(this,p)}}]),d}(Mr);os.STRtreeNode=Ll,os.xComparator=new(function(){function I(){t(this,I)}return a(I,[{key:"interfaces_",get:function(){return[It]}},{key:"compare",value:function(c,d){return Go.compareDoubles(os.centreX(c.getBounds()),os.centreX(d.getBounds()))}}]),I}()),os.yComparator=new(function(){function I(){t(this,I)}return a(I,[{key:"interfaces_",get:function(){return[It]}},{key:"compare",value:function(c,d){return Go.compareDoubles(os.centreY(c.getBounds()),os.centreY(d.getBounds()))}}]),I}()),os.intersectsOp=new(function(){function I(){t(this,I)}return a(I,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(c,d){return c.intersects(d)}}]),I}()),os.DEFAULT_NODE_CAPACITY=10;var hu=function(){function I(){t(this,I)}return a(I,null,[{key:"relativeSign",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"compare",value:function(c,d,p){if(d.equals2D(p))return 0;var b=I.relativeSign(d.x,p.x),L=I.relativeSign(d.y,p.y);switch(c){case 0:return I.compareValue(b,L);case 1:return I.compareValue(L,b);case 2:return I.compareValue(L,-b);case 3:return I.compareValue(-b,L);case 4:return I.compareValue(-b,-L);case 5:return I.compareValue(-L,-b);case 6:return I.compareValue(-L,b);case 7:return I.compareValue(b,-L)}return St.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(c,d){return c<0?-1:c>0?1:d<0?-1:d>0?1:0}}]),I}(),fu=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(c){var d=c;return this.segmentIndex<d.segmentIndex?-1:this.segmentIndex>d.segmentIndex?1:this.coord.equals2D(d.coord)?0:this._isInterior?d._isInterior?hu.compare(this._segmentOctant,this.coord,d.coord):1:-1}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===c}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[ye]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._segString=c,this.coord=new We(d),this.segmentIndex=p,this._segmentOctant=b,this._isInterior=!d.equals2D(c.getCoordinate(p))}}]),I}(),du=function(){function I(){t(this,I)}return a(I,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),I}(),Io=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSplitCoordinates",value:function(){var c=new Di;this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next();this.addEdgeCoordinates(p,b,c),p=b}return c.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var c=new At;this.findCollapsesFromInsertedNodes(c),this.findCollapsesFromExistingVertices(c);for(var d=c.iterator();d.hasNext();){var p=d.next().intValue();this.add(this._edge.getCoordinate(p),p)}}},{key:"createSplitEdgePts",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2;if(p===2)return[new We(c.coord),new We(d.coord)];var b=this._edge.getCoordinate(d.segmentIndex),L=d.isInterior()||!d.coord.equals2D(b);L||p--;var O=new Array(p).fill(null),V=0;O[V++]=new We(c.coord);for(var K=c.segmentIndex+1;K<=d.segmentIndex;K++)O[V++]=this._edge.getCoordinate(K);return L&&(O[V]=new We(d.coord)),O}},{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"findCollapsesFromExistingVertices",value:function(c){for(var d=0;d<this._edge.size()-2;d++){var p=this._edge.getCoordinate(d);this._edge.getCoordinate(d+1);var b=this._edge.getCoordinate(d+2);p.equals2D(b)&&c.add(Qi.valueOf(d+1))}}},{key:"addEdgeCoordinates",value:function(c,d,p){var b=this.createSplitEdgePts(c,d);p.add(b,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints(),this.addCollapsedNodes();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),L=this.createSplitEdge(p,b);c.add(L),p=b}}},{key:"findCollapseIndex",value:function(c,d,p){if(!c.coord.equals2D(d.coord))return!1;var b=d.segmentIndex-c.segmentIndex;return d.isInterior()||b--,b===1&&(p[0]=c.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(c){for(var d=new Array(1).fill(null),p=this.iterator(),b=p.next();p.hasNext();){var L=p.next();this.findCollapseIndex(b,L,d)&&c.add(Qi.valueOf(d[0])),b=L}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var c=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(c),c)}},{key:"createSplitEdge",value:function(c,d){var p=this.createSplitEdgePts(c,d);return new ws(p,this._edge.getData())}},{key:"add",value:function(c,d){var p=new fu(this._edge,c,d,this._edge.getSegmentOctant(d)),b=this._nodeMap.get(p);return b!==null?(St.isTrue(b.coord.equals2D(c),"Found equal nodes with different coordinates"),b):(this._nodeMap.put(p,p),p)}},{key:"checkSplitEdgesCorrectness",value:function(c){var d=this._edge.getCoordinates(),p=c.get(0).getCoordinate(0);if(!p.equals2D(d[0]))throw new pt("bad split edge start point at "+p);var b=c.get(c.size()-1).getCoordinates(),L=b[b.length-1];if(!L.equals2D(d[d.length-1]))throw new pt("bad split edge end point at "+L)}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this._edge=null;var c=arguments[0];this._edge=c}}]),I}(),pu=function(){function I(){t(this,I)}return a(I,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new xe("Cannot compute the octant for point ( "+c+", "+d+" )");var p=Math.abs(c),b=Math.abs(d);return c>=0?d>=0?p>=b?0:1:p>=b?7:6:d>=0?p>=b?3:2:p>=b?4:5}if(arguments[0]instanceof We&&arguments[1]instanceof We){var L=arguments[0],O=arguments[1],V=O.x-L.x,K=O.y-L.y;if(V===0&&K===0)throw new xe("Cannot compute the octant for two identical points "+L);return I.octant(V,K)}}}]),I}(),xc=function(){function I(){t(this,I)}return a(I,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(c){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(c){}},{key:"getData",value:function(){}}]),I}(),mu=function(){function I(){t(this,I)}return a(I,[{key:"addIntersection",value:function(c,d){}},{key:"interfaces_",get:function(){return[xc]}}]),I}(),ws=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(c){return this._pts[c]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(c){return c===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(c),this.getCoordinate(c+1))}},{key:"setData",value:function(c){this._data=c}},{key:"safeOctant",value:function(c,d){return c.equals2D(d)?0:pu.octant(c,d)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.addIntersectionNode(c,d)}else if(arguments.length===4){var p=arguments[0],b=arguments[1],L=arguments[3],O=new We(p.getIntersection(L));this.addIntersection(O,b)}}},{key:"toString",value:function(){return Ba.toLineString(new xo(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(c,d){var p=d,b=p+1;if(b<this._pts.length){var L=this._pts[b];c.equals2D(L)&&(p=b)}return this._nodeList.add(c,p)}},{key:"addIntersections",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++)this.addIntersection(c,d,p,b)}},{key:"interfaces_",get:function(){return[mu]}}],[{key:"constructor_",value:function(){this._nodeList=new Io(this),this._pts=null,this._data=null;var c=arguments[0],d=arguments[1];this._pts=c,this._data=d}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var c=arguments[0],d=new At;return I.getNodedSubstrings(c,d),d}if(arguments.length===2)for(var p=arguments[0],b=arguments[1],L=p.iterator();L.hasNext();){var O=L.next();O.getNodeList().addSplitEdges(b)}}}]),I}(),$r=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=mn.index(this.p0,this.p1,c.p0),p=mn.index(this.p0,this.p1,c.p1);return d>=0&&p>=0||d<=0&&p<=0?Math.max(d,p):0}if(arguments[0]instanceof We){var b=arguments[0];return mn.index(this.p0,this.p1,b)}}},{key:"toGeometry",value:function(c){return c.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)}},{key:"intersection",value:function(c){var d=new so;return d.computeIntersection(this.p0,this.p1,c.p0,c.p1),d.hasIntersection()?d.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof We){var c=arguments[0];if(c.equals(this.p0)||c.equals(this.p1))return new We(c);var d=this.projectionFactor(c),p=new We;return p.x=this.p0.x+d*(this.p1.x-this.p0.x),p.y=this.p0.y+d*(this.p1.y-this.p0.y),p}if(arguments[0]instanceof I){var b=arguments[0],L=this.projectionFactor(b.p0),O=this.projectionFactor(b.p1);if(L>=1&&O>=1||L<=0&&O<=0)return null;var V=this.project(b.p0);L<0&&(V=this.p0),L>1&&(V=this.p1);var K=this.project(b.p1);return O<0&&(K=this.p0),O>1&&(K=this.p1),new I(V,K)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(c){return c===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(c){return er.pointToLinePerpendicular(c,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return I.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(c){if(c.equals(this.p0))return 0;if(c.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,b=d*d+p*p;return b<=0?bt.NaN:((c.x-this.p0.x)*d+(c.y-this.p0.y)*p)/b}},{key:"closestPoints",value:function(c){var d=this.intersection(c);if(d!==null)return[d,d];var p=new Array(2).fill(null),b=bt.MAX_VALUE,L=null,O=this.closestPoint(c.p0);b=O.distance(c.p0),p[0]=O,p[1]=c.p0;var V=this.closestPoint(c.p1);(L=V.distance(c.p1))<b&&(b=L,p[0]=V,p[1]=c.p1);var K=c.closestPoint(this.p0);(L=K.distance(this.p0))<b&&(b=L,p[0]=this.p0,p[1]=K);var pe=c.closestPoint(this.p1);return(L=pe.distance(this.p1))<b&&(b=L,p[0]=this.p1,p[1]=pe),p}},{key:"closestPoint",value:function(c){var d=this.projectionFactor(c);return d>0&&d<1?this.project(c):this.p0.distance(c)<this.p1.distance(c)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(c){var d=c,p=this.p0.compareTo(d.p0);return p!==0?p:this.p1.compareTo(d.p1)}},{key:"reverse",value:function(){var c=this.p0;this.p0=this.p1,this.p1=c}},{key:"equalsTopo",value:function(c){return this.p0.equals(c.p0)&&this.p1.equals(c.p1)||this.p0.equals(c.p1)&&this.p1.equals(c.p0)}},{key:"lineIntersection",value:function(c){return bn.intersection(this.p0,this.p1,c.p0,c.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(c,d){var p=this.p0.x+c*(this.p1.x-this.p0.x),b=this.p0.y+c*(this.p1.y-this.p0.y),L=this.p1.x-this.p0.x,O=this.p1.y-this.p0.y,V=Math.sqrt(L*L+O*O),K=0,pe=0;if(d!==0){if(V<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");K=d*L/V,pe=d*O/V}return new We(p-pe,b+K)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var c=arguments[0];this.setCoordinates(c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=p.x,this.p1.y=p.y}}},{key:"segmentFraction",value:function(c){var d=this.projectionFactor(c);return d<0?d=0:(d>1||bt.isNaN(d))&&(d=1),d}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(c){var d=this.p1.getY()-this.p0.getY(),p=this.p0.getX()-this.p1.getX(),b=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),L=d*d+p*p,O=d*d-p*p,V=c.getX(),K=c.getY();return new We((-O*V-2*d*p*K-2*d*b)/L,(O*K-2*d*p*V-2*p*b)/L)}},{key:"distance",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return er.segmentToSegment(this.p0,this.p1,c.p0,c.p1)}if(arguments[0]instanceof We){var d=arguments[0];return er.pointToSegment(d,this.p0,this.p1)}}},{key:"pointAlong",value:function(c){var d=new We;return d.x=this.p0.x+c*(this.p1.x-this.p0.x),d.y=this.p0.y+c*(this.p1.y-this.p0.y),d}},{key:"hashCode",value:function(){var c=bt.doubleToLongBits(this.p0.x);c^=31*bt.doubleToLongBits(this.p0.y);var d=Math.trunc(c)^Math.trunc(c>>32),p=bt.doubleToLongBits(this.p1.x);return p^=31*bt.doubleToLongBits(this.p1.y),d^(Math.trunc(p)^Math.trunc(p>>32))}},{key:"interfaces_",get:function(){return[ye,ve]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)I.constructor_.call(this,new We,new We);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0=d,this.p1=p}else if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3];I.constructor_.call(this,new We(b,L),new We(O,V))}}},{key:"midPoint",value:function(c,d){return new We((c.x+d.x)/2,(c.y+d.y)/2)}}]),I}(),Ga=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"overlap",value:function(){if(arguments.length!==2&&arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];c.getLineSegment(d,this._overlapSeg1),p.getLineSegment(b,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new $r,this._overlapSeg2=new $r}}]),I}(),gu=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLineSegment",value:function(c,d){d.p0=this._pts[c],d.p1=this._pts[c+1]}},{key:"computeSelect",value:function(c,d,p,b){var L=this._pts[d],O=this._pts[p];if(p-d==1)return b.select(this,d),null;if(!c.intersects(L,O))return null;var V=Math.trunc((d+p)/2);d<V&&this.computeSelect(c,d,V,b),V<p&&this.computeSelect(c,V,p,b)}},{key:"getCoordinates",value:function(){for(var c=new Array(this._end-this._start+1).fill(null),d=0,p=this._start;p<=this._end;p++)c[d++]=this._pts[p];return c}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.computeOverlaps(this._start,this._end,c,c._start,c._end,d)}else if(arguments.length===6){var p=arguments[0],b=arguments[1],L=arguments[2],O=arguments[3],V=arguments[4],K=arguments[5];if(b-p==1&&V-O==1)return K.overlap(this,p,L,O),null;if(!this.overlaps(p,b,L,O,V))return null;var pe=Math.trunc((p+b)/2),Be=Math.trunc((O+V)/2);p<pe&&(O<Be&&this.computeOverlaps(p,pe,L,O,Be,K),Be<V&&this.computeOverlaps(p,pe,L,Be,V,K)),pe<b&&(O<Be&&this.computeOverlaps(pe,b,L,O,Be,K),Be<V&&this.computeOverlaps(pe,b,L,Be,V,K))}}},{key:"setId",value:function(c){this._id=c}},{key:"select",value:function(c,d){this.computeSelect(c,this._start,this._end,d)}},{key:"getEnvelope",value:function(){if(this._env===null){var c=this._pts[this._start],d=this._pts[this._end];this._env=new dn(c,d)}return this._env}},{key:"overlaps",value:function(c,d,p,b,L){return dn.intersects(this._pts[c],this._pts[d],p._pts[b],p._pts[L])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._pts=c,this._start=d,this._end=p,this._context=b}}]),I}(),wc=function(){function I(){t(this,I)}return a(I,null,[{key:"findChainEnd",value:function(c,d){for(var p=d;p<c.length-1&&c[p].equals2D(c[p+1]);)p++;if(p>=c.length-1)return c.length-1;for(var b=fr.quadrant(c[p],c[p+1]),L=d+1;L<c.length&&!(!c[L-1].equals2D(c[L])&&fr.quadrant(c[L-1],c[L])!==b);)L++;return L-1}},{key:"getChains",value:function(){if(arguments.length===1){var c=arguments[0];return I.getChains(c,null)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=new At,L=0;do{var O=I.findChainEnd(d,L),V=new gu(d,L,O,p);b.add(V),L=O}while(L<d.length-1);return b}}}]),I}(),Za=function(){function I(){t(this,I)}return a(I,[{key:"computeNodes",value:function(c){}},{key:"getNodedSubstrings",value:function(){}}]),I}(),Ml=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setSegmentIntersector",value:function(c){this._segInt=c}},{key:"interfaces_",get:function(){return[Za]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this.setSegmentIntersector(c)}}}]),I}(),Ha=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return ws.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(p){for(var b=wc.getChains(p.getCoordinates(),p).iterator();b.hasNext();){var L=b.next();L.setId(this._idCounter++),this._index.insert(L.getEnvelope(),L),this._monoChains.add(L)}}},{key:"computeNodes",value:function(p){this._nodedSegStrings=p;for(var b=p.iterator();b.hasNext();)this.add(b.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var p=new Xa(this._segInt),b=this._monoChains.iterator();b.hasNext();)for(var L=b.next(),O=this._index.query(L.getEnvelope()).iterator();O.hasNext();){var V=O.next();if(V.getId()>L.getId()&&(L.computeOverlaps(V,p),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new At,this._index=new os,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0&&arguments.length===1){var p=arguments[0];Ml.constructor_.call(this,p)}}}]),d}(Ml),Xa=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"overlap",value:function(){if(arguments.length!==4)return U(m(d.prototype),"overlap",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=arguments[2],O=arguments[3],V=p.getContext(),K=L.getContext();this._si.processIntersections(V,b,K,O)}}],[{key:"constructor_",value:function(){this._si=null;var p=arguments[0];this._si=p}}]),d}(Ga);Ha.SegmentOverlapAction=Xa;var as=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isDeletable",value:function(c,d,p,b){var L=this._inputLine[c],O=this._inputLine[d],V=this._inputLine[p];return!!this.isConcave(L,O,V)&&!!this.isShallow(L,O,V,b)&&this.isShallowSampled(L,O,c,p,b)}},{key:"deleteShallowConcavities",value:function(){for(var c=1,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d),b=!1;p<this._inputLine.length;){var L=!1;this.isDeletable(c,d,p,this._distanceTol)&&(this._isDeleted[d]=I.DELETE,L=!0,b=!0),c=L?p:d,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d)}return b}},{key:"isShallowConcavity",value:function(c,d,p,b){return mn.index(c,d,p)===this._angleOrientation&&er.pointToSegment(d,c,p)<b}},{key:"isShallowSampled",value:function(c,d,p,b,L){var O=Math.trunc((b-p)/I.NUM_PTS_TO_CHECK);O<=0&&(O=1);for(var V=p;V<b;V+=O)if(!this.isShallow(c,d,this._inputLine[V],L))return!1;return!0}},{key:"isConcave",value:function(c,d,p){var b=mn.index(c,d,p)===this._angleOrientation;return b}},{key:"simplify",value:function(c){this._distanceTol=Math.abs(c),c<0&&(this._angleOrientation=mn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do d=this.deleteShallowConcavities();while(d);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(c){for(var d=c+1;d<this._inputLine.length&&this._isDeleted[d]===I.DELETE;)d++;return d}},{key:"isShallow",value:function(c,d,p,b){return er.pointToSegment(d,c,p)<b}},{key:"collapseLine",value:function(){for(var c=new Di,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==I.DELETE&&c.add(this._inputLine[d]);return c.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=mn.COUNTERCLOCKWISE;var c=arguments[0];this._inputLine=c}},{key:"simplify",value:function(c,d){return new I(c).simplify(d)}}]),I}();as.INIT=0,as.DELETE=1,as.KEEP=1,as.NUM_PTS_TO_CHECK=10;var ya=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._ptList.toArray(I.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"addPt",value:function(c){var d=new We(c);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(c,d){if(d)for(var p=0;p<c.length;p++)this.addPt(c[p]);else for(var b=c.length-1;b>=0;b--)this.addPt(c[b])}},{key:"isRedundant",value:function(c){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return c.distance(d)<this._minimimVertexDistance}},{key:"toString",value:function(){return new is().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var c=new We(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(c.equals(d))return null;this._ptList.add(c)}},{key:"setMinimumVertexDistance",value:function(c){this._minimimVertexDistance=c}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new At}}]),I}();ya.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var ji=function(){function I(){t(this,I)}return a(I,null,[{key:"toDegrees",value:function(c){return 180*c/Math.PI}},{key:"normalize",value:function(c){for(;c>Math.PI;)c-=I.PI_TIMES_2;for(;c<=-Math.PI;)c+=I.PI_TIMES_2;return c}},{key:"angle",value:function(){if(arguments.length===1){var c=arguments[0];return Math.atan2(c.y,c.x)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=p.x-d.x,L=p.y-d.y;return Math.atan2(L,b)}}},{key:"isAcute",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y;return b*(p.x-d.x)+L*(p.y-d.y)>0}},{key:"isObtuse",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y;return b*(p.x-d.x)+L*(p.y-d.y)<0}},{key:"interiorAngle",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p);return Math.abs(L-b)}},{key:"normalizePositive",value:function(c){if(c<0){for(;c<0;)c+=I.PI_TIMES_2;c>=I.PI_TIMES_2&&(c=0)}else{for(;c>=I.PI_TIMES_2;)c-=I.PI_TIMES_2;c<0&&(c=0)}return c}},{key:"angleBetween",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p);return I.diff(b,L)}},{key:"diff",value:function(c,d){var p=null;return(p=c<d?d-c:c-d)>Math.PI&&(p=2*Math.PI-p),p}},{key:"toRadians",value:function(c){return c*Math.PI/180}},{key:"getTurn",value:function(c,d){var p=Math.sin(d-c);return p>0?I.COUNTERCLOCKWISE:p<0?I.CLOCKWISE:I.NONE}},{key:"angleBetweenOriented",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p)-b;return L<=-Math.PI?L+I.PI_TIMES_2:L>Math.PI?L-I.PI_TIMES_2:L}}]),I}();ji.PI_TIMES_2=2*Math.PI,ji.PI_OVER_2=Math.PI/2,ji.PI_OVER_4=Math.PI/4,ji.COUNTERCLOCKWISE=mn.COUNTERCLOCKWISE,ji.CLOCKWISE=mn.CLOCKWISE,ji.NONE=mn.COLLINEAR;var So=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addNextSegment",value:function(c,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=c,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var p=mn.index(this._s0,this._s1,this._s2),b=p===mn.CLOCKWISE&&this._side===Se.LEFT||p===mn.COUNTERCLOCKWISE&&this._side===Se.RIGHT;p===0?this.addCollinear(d):b?this.addOutsideTurn(p,d):this.addInsideTurn(p,d)}},{key:"addLineEndCap",value:function(c,d){var p=new $r(c,d),b=new $r;this.computeOffsetSegment(p,Se.LEFT,this._distance,b);var L=new $r;this.computeOffsetSegment(p,Se.RIGHT,this._distance,L);var O=d.x-c.x,V=d.y-c.y,K=Math.atan2(V,O);switch(this._bufParams.getEndCapStyle()){case Y.CAP_ROUND:this._segList.addPt(b.p1),this.addDirectedFillet(d,K+Math.PI/2,K-Math.PI/2,mn.CLOCKWISE,this._distance),this._segList.addPt(L.p1);break;case Y.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(L.p1);break;case Y.CAP_SQUARE:var pe=new We;pe.x=Math.abs(this._distance)*Math.cos(K),pe.y=Math.abs(this._distance)*Math.sin(K);var Be=new We(b.p1.x+pe.x,b.p1.y+pe.y),$e=new We(L.p1.x+pe.x,L.p1.y+pe.y);this._segList.addPt(Be),this._segList.addPt($e)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(c,d,p,b){var L=bn.intersection(d.p0,d.p1,p.p0,p.p1);if(L!==null&&(b<=0?1:L.distance(c)/Math.abs(b))<=this._bufParams.getMitreLimit())return this._segList.addPt(L),null;this.addLimitedMitreJoin(d,p,b,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(c,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*I.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Y.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Y.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,c,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(c){this._segList.addPt(new We(c.x+this._distance,c.y+this._distance)),this._segList.addPt(new We(c.x+this._distance,c.y-this._distance)),this._segList.addPt(new We(c.x-this._distance,c.y-this._distance)),this._segList.addPt(new We(c.x-this._distance,c.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(c,d){this._segList.addPts(c,d)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(c,d,p,b,L){var O=d.x-c.x,V=d.y-c.y,K=Math.atan2(V,O),pe=p.x-c.x,Be=p.y-c.y,$e=Math.atan2(Be,pe);b===mn.CLOCKWISE?K<=$e&&(K+=2*Math.PI):K>=$e&&(K-=2*Math.PI),this._segList.addPt(d),this.addDirectedFillet(c,K,$e,b,L),this._segList.addPt(p)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(c,d,p){this._s1=c,this._s2=d,this._side=p,this._seg1.setCoordinates(c,d),this.computeOffsetSegment(this._seg1,p,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(c,d,p,b){var L=this._seg0.p1,O=ji.angle(L,this._seg0.p0),V=ji.angleBetweenOriented(this._seg0.p0,L,this._seg1.p1)/2,K=ji.normalize(O+V),pe=ji.normalize(K+Math.PI),Be=b*p,$e=p-Be*Math.abs(Math.sin(V)),gt=L.x+Be*Math.cos(pe),Ft=L.y+Be*Math.sin(pe),zt=new We(gt,Ft),gn=new $r(L,zt),vn=gn.pointAlongOffset(1,$e),Ln=gn.pointAlongOffset(1,-$e);this._side===Se.LEFT?(this._segList.addPt(vn),this._segList.addPt(Ln)):(this._segList.addPt(Ln),this._segList.addPt(vn))}},{key:"addDirectedFillet",value:function(c,d,p,b,L){var O=b===mn.CLOCKWISE?-1:1,V=Math.abs(d-p),K=Math.trunc(V/this._filletAngleQuantum+.5);if(K<1)return null;for(var pe=V/K,Be=new We,$e=0;$e<K;$e++){var gt=d+O*$e*pe;Be.x=c.x+L*Math.cos(gt),Be.y=c.y+L*Math.sin(gt),this._segList.addPt(Be)}}},{key:"computeOffsetSegment",value:function(c,d,p,b){var L=d===Se.LEFT?1:-1,O=c.p1.x-c.p0.x,V=c.p1.y-c.p0.y,K=Math.sqrt(O*O+V*V),pe=L*p*O/K,Be=L*p*V/K;b.p0.x=c.p0.x-Be,b.p0.y=c.p0.y+pe,b.p1.x=c.p1.x-Be,b.p1.y=c.p1.y+pe}},{key:"addInsideTurn",value:function(c,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*I.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var p=new We((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p);var b=new We((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(c){var d=new We(c.x+this._distance,c.y);this._segList.addPt(d),this.addDirectedFillet(c,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(c,d){this._segList.addPt(c.p1),this._segList.addPt(d.p0)}},{key:"init",value:function(c){this._distance=c,this._maxCurveSegmentError=c*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ya,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(c*I.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(c){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Y.JOIN_BEVEL||this._bufParams.getJoinStyle()===Y.JOIN_MITRE?(c&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,mn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new $r,this._seg1=new $r,this._offset0=new $r,this._offset1=new $r,this._side=0,this._hasNarrowConcaveAngle=!1;var c=arguments[0],d=arguments[1],p=arguments[2];this._precisionModel=c,this._bufParams=d,this._li=new so,this._filletAngleQuantum=Math.PI/2/d.getQuadrantSegments(),d.getQuadrantSegments()>=8&&d.getJoinStyle()===Y.JOIN_ROUND&&(this._closingSegLengthFactor=I.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)}}]),I}();So.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,So.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,So.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,So.MAX_CLOSING_SEG_LEN_FACTOR=80;var Rl=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getOffsetCurve",value:function(c,d){if(this._distance=d,d===0)return null;var p=d<0,b=Math.abs(d),L=this.getSegGen(b);c.length<=1?this.computePointCurve(c[0],L):this.computeOffsetCurve(c,p,L);var O=L.getCoordinates();return p&&$n.reverse(O),O}},{key:"computeSingleSidedBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){p.addSegments(c,!0);var L=as.simplify(c,-b),O=L.length-1;p.initSideSegments(L[O],L[O-1],Se.LEFT),p.addFirstSegment();for(var V=O-2;V>=0;V--)p.addNextSegment(L[V],!0)}else{p.addSegments(c,!1);var K=as.simplify(c,b),pe=K.length-1;p.initSideSegments(K[0],K[1],Se.LEFT),p.addFirstSegment();for(var Be=2;Be<=pe;Be++)p.addNextSegment(K[Be],!0)}p.addLastSegment(),p.closeRing()}},{key:"computeRingBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);d===Se.RIGHT&&(b=-b);var L=as.simplify(c,b),O=L.length-1;p.initSideSegments(L[O-1],L[0],d);for(var V=1;V<=O;V++){var K=V!==1;p.addNextSegment(L[V],K)}p.closeRing()}},{key:"computeLineBufferCurve",value:function(c,d){var p=this.simplifyTolerance(this._distance),b=as.simplify(c,p),L=b.length-1;d.initSideSegments(b[0],b[1],Se.LEFT);for(var O=2;O<=L;O++)d.addNextSegment(b[O],!0);d.addLastSegment(),d.addLineEndCap(b[L-1],b[L]);var V=as.simplify(c,-p),K=V.length-1;d.initSideSegments(V[K],V[K-1],Se.LEFT);for(var pe=K-2;pe>=0;pe--)d.addNextSegment(V[pe],!0);d.addLastSegment(),d.addLineEndCap(V[1],V[0]),d.closeRing()}},{key:"computePointCurve",value:function(c,d){switch(this._bufParams.getEndCapStyle()){case Y.CAP_ROUND:d.createCircle(c);break;case Y.CAP_SQUARE:d.createSquare(c)}}},{key:"getLineCurve",value:function(c,d){if(this._distance=d,this.isLineOffsetEmpty(d))return null;var p=Math.abs(d),b=this.getSegGen(p);if(c.length<=1)this.computePointCurve(c[0],b);else if(this._bufParams.isSingleSided()){var L=d<0;this.computeSingleSidedBufferCurve(c,L,b)}else this.computeLineBufferCurve(c,b);return b.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(c){return c*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(c,d,p){if(this._distance=p,c.length<=2)return this.getLineCurve(c,p);if(p===0)return I.copyCoordinates(c);var b=this.getSegGen(p);return this.computeRingBufferCurve(c,d,b),b.getCoordinates()}},{key:"computeOffsetCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){var L=as.simplify(c,-b),O=L.length-1;p.initSideSegments(L[O],L[O-1],Se.LEFT),p.addFirstSegment();for(var V=O-2;V>=0;V--)p.addNextSegment(L[V],!0)}else{var K=as.simplify(c,b),pe=K.length-1;p.initSideSegments(K[0],K[1],Se.LEFT),p.addFirstSegment();for(var Be=2;Be<=pe;Be++)p.addNextSegment(K[Be],!0)}p.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(c){return c===0||c<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(c){return new So(this._precisionModel,this._bufParams,c)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var c=arguments[0],d=arguments[1];this._precisionModel=c,this._bufParams=d}},{key:"copyCoordinates",value:function(c){for(var d=new Array(c.length).fill(null),p=0;p<d.length;p++)d[p]=new We(c[p]);return d}}]),I}(),Wa=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new At,p=this._subgraphs.iterator();p.hasNext();){var b=p.next(),L=b.getEnvelope();c.y<L.getMinY()||c.y>L.getMaxY()||this.findStabbedSegments(c,b.getDirectedEdges(),d)}return d}if(arguments.length===3){if(Jt(arguments[2],Fn)&&arguments[0]instanceof We&&arguments[1]instanceof _a)for(var O=arguments[0],V=arguments[1],K=arguments[2],pe=V.getEdge().getCoordinates(),Be=0;Be<pe.length-1;Be++){this._seg.p0=pe[Be],this._seg.p1=pe[Be+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var $e=Math.max(this._seg.p0.x,this._seg.p1.x);if(!($e<O.x)&&!(this._seg.isHorizontal()||O.y<this._seg.p0.y||O.y>this._seg.p1.y||mn.index(this._seg.p0,this._seg.p1,O)===mn.RIGHT)){var gt=V.getDepth(Se.LEFT);this._seg.p0.equals(pe[Be])||(gt=V.getDepth(Se.RIGHT));var Ft=new va(this._seg,gt);K.add(Ft)}}else if(Jt(arguments[2],Fn)&&arguments[0]instanceof We&&Jt(arguments[1],Fn))for(var zt=arguments[0],gn=arguments[1],vn=arguments[2],Ln=gn.iterator();Ln.hasNext();){var ii=Ln.next();ii.isForward()&&this.findStabbedSegments(zt,ii,vn)}}}},{key:"getDepth",value:function(c){var d=this.findStabbedSegments(c);return d.size()===0?0:jo.min(d)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new $r;var c=arguments[0];this._subgraphs=c}}]),I}(),va=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;if(this._upwardSeg.minX()>=d._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=d._upwardSeg.minX())return-1;var p=this._upwardSeg.orientationIndex(d._upwardSeg);return p!==0||(p=-1*d._upwardSeg.orientationIndex(this._upwardSeg))!==0?p:this._upwardSeg.compareTo(d._upwardSeg)}},{key:"compareX",value:function(c,d){var p=c.p0.compareTo(d.p0);return p!==0?p:c.p1.compareTo(d.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[ye]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var c=arguments[0],d=arguments[1];this._upwardSeg=new $r(c),this._leftDepth=d}}]),I}();Wa.DepthSegment=va;var Ka=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){ge.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),d}(ge),Gs=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getY",value:function(){var c=this.y/this.w;if(bt.isNaN(c)||bt.isInfinite(c))throw new Ka;return c}},{key:"getX",value:function(){var c=this.x/this.w;if(bt.isNaN(c)||bt.isInfinite(c))throw new Ka;return c}},{key:"getCoordinate",value:function(){var c=new We;return c.x=this.getX(),c.y=this.getY(),c}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var d=arguments[0],p=arguments[1];this.x=d,this.y=p,this.w=1}else if(arguments[0]instanceof I&&arguments[1]instanceof I){var b=arguments[0],L=arguments[1];this.x=b.y*L.w-L.y*b.w,this.y=L.x*b.w-b.x*L.w,this.w=b.x*L.y-L.x*b.y}else if(arguments[0]instanceof We&&arguments[1]instanceof We){var O=arguments[0],V=arguments[1];this.x=O.y-V.y,this.y=V.x-O.x,this.w=O.x*V.y-V.x*O.y}}else if(arguments.length===3){var K=arguments[0],pe=arguments[1],Be=arguments[2];this.x=K,this.y=pe,this.w=Be}else if(arguments.length===4){var $e=arguments[0],gt=arguments[1],Ft=arguments[2],zt=arguments[3],gn=$e.y-gt.y,vn=gt.x-$e.x,Ln=$e.x*gt.y-gt.x*$e.y,ii=Ft.y-zt.y,gi=zt.x-Ft.x,ui=Ft.x*zt.y-zt.x*Ft.y;this.x=vn*ui-gi*Ln,this.y=ii*Ln-gn*ui,this.w=gn*gi-ii*vn}}}]),I}(),Pl=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"area",value:function(){return I.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return I.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(c){if(c===null)throw new xe("Supplied point is null.");return I.interpolateZ(c,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return I.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return I.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return I.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return I.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return I.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return I.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.p0=c,this.p1=d,this.p2=p}},{key:"area",value:function(c,d,p){return Math.abs(((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2)}},{key:"signedArea",value:function(c,d,p){return((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2}},{key:"det",value:function(c,d,p,b){return c*b-d*p}},{key:"interpolateZ",value:function(c,d,p,b){var L=d.x,O=d.y,V=p.x-L,K=b.x-L,pe=p.y-O,Be=b.y-O,$e=V*Be-K*pe,gt=c.x-L,Ft=c.y-O,zt=(Be*gt-K*Ft)/$e,gn=(-pe*gt+V*Ft)/$e;return d.getZ()+zt*(p.getZ()-d.getZ())+gn*(b.getZ()-d.getZ())}},{key:"longestSideLength",value:function(c,d,p){var b=c.distance(d),L=d.distance(p),O=p.distance(c),V=b;return L>V&&(V=L),O>V&&(V=O),V}},{key:"circumcentreDD",value:function(c,d,p){var b=ht.valueOf(c.x).subtract(p.x),L=ht.valueOf(c.y).subtract(p.y),O=ht.valueOf(d.x).subtract(p.x),V=ht.valueOf(d.y).subtract(p.y),K=ht.determinant(b,L,O,V).multiply(2),pe=b.sqr().add(L.sqr()),Be=O.sqr().add(V.sqr()),$e=ht.determinant(L,pe,V,Be),gt=ht.determinant(b,pe,O,Be),Ft=ht.valueOf(p.x).subtract($e.divide(K)).doubleValue(),zt=ht.valueOf(p.y).add(gt.divide(K)).doubleValue();return new We(Ft,zt)}},{key:"isAcute",value:function(c,d,p){return!!ji.isAcute(c,d,p)&&!!ji.isAcute(d,p,c)&&!!ji.isAcute(p,c,d)}},{key:"circumcentre",value:function(c,d,p){var b=p.x,L=p.y,O=c.x-b,V=c.y-L,K=d.x-b,pe=d.y-L,Be=2*I.det(O,V,K,pe),$e=I.det(V,O*O+V*V,pe,K*K+pe*pe),gt=I.det(O,O*O+V*V,K,K*K+pe*pe);return new We(b-$e/Be,L+gt/Be)}},{key:"perpendicularBisector",value:function(c,d){var p=d.x-c.x,b=d.y-c.y,L=new Gs(c.x+p/2,c.y+b/2,1),O=new Gs(c.x-b+p/2,c.y+p+b/2,1);return new Gs(L,O)}},{key:"angleBisector",value:function(c,d,p){var b=d.distance(c),L=b/(b+d.distance(p)),O=p.x-c.x,V=p.y-c.y;return new We(c.x+L*O,c.y+L*V)}},{key:"area3D",value:function(c,d,p){var b=d.x-c.x,L=d.y-c.y,O=d.getZ()-c.getZ(),V=p.x-c.x,K=p.y-c.y,pe=p.getZ()-c.getZ(),Be=L*pe-O*K,$e=O*V-b*pe,gt=b*K-L*V,Ft=Be*Be+$e*$e+gt*gt,zt=Math.sqrt(Ft)/2;return zt}},{key:"centroid",value:function(c,d,p){var b=(c.x+d.x+p.x)/3,L=(c.y+d.y+p.y)/3;return new We(b,L)}},{key:"inCentre",value:function(c,d,p){var b=d.distance(p),L=c.distance(p),O=c.distance(d),V=b+L+O,K=(b*c.x+L*d.x+O*p.x)/V,pe=(b*c.y+L*d.y+O*p.y)/V;return new We(K,pe)}}]),I}(),kc=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addRingSide",value:function(c,d,p,b,L){if(d===0&&c.length<Ii.MINIMUM_VALID_SIZE)return null;var O=b,V=L;c.length>=Ii.MINIMUM_VALID_SIZE&&mn.isCCW(c)&&(O=L,V=b,p=Se.opposite(p));var K=this._curveBuilder.getRingCurve(c,p,d);this.addCurve(K,O,V)}},{key:"addRingBothSides",value:function(c,d){this.addRingSide(c,d,Se.LEFT,Ae.EXTERIOR,Ae.INTERIOR),this.addRingSide(c,d,Se.RIGHT,Ae.INTERIOR,Ae.EXTERIOR)}},{key:"addPoint",value:function(c){if(this._distance<=0)return null;var d=c.getCoordinates(),p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Ae.EXTERIOR,Ae.INTERIOR)}},{key:"addPolygon",value:function(c){var d=this._distance,p=Se.LEFT;this._distance<0&&(d=-this._distance,p=Se.RIGHT);var b=c.getExteriorRing(),L=$n.removeRepeatedPoints(b.getCoordinates());if(this._distance<0&&this.isErodedCompletely(b,this._distance)||this._distance<=0&&L.length<3)return null;this.addRingSide(L,d,p,Ae.EXTERIOR,Ae.INTERIOR);for(var O=0;O<c.getNumInteriorRing();O++){var V=c.getInteriorRingN(O),K=$n.removeRepeatedPoints(V.getCoordinates());this._distance>0&&this.isErodedCompletely(V,-this._distance)||this.addRingSide(K,d,Se.opposite(p),Ae.INTERIOR,Ae.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(c,d){var p=new Pl(c[0],c[1],c[2]),b=p.inCentre();return er.pointToSegment(b,p.p0,p.p1)<Math.abs(d)}},{key:"addLineString",value:function(c){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var d=$n.removeRepeatedPoints(c.getCoordinates());if($n.isRing(d)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(d,this._distance);else{var p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Ae.EXTERIOR,Ae.INTERIOR)}}},{key:"addCurve",value:function(c,d,p){if(c===null||c.length<2)return null;var b=new ws(c,new wi(0,Ae.BOUNDARY,d,p));this._curveList.add(b)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(c){if(c.isEmpty())return null;if(c instanceof en)this.addPolygon(c);else if(c instanceof Xe)this.addLineString(c);else if(c instanceof nt)this.addPoint(c);else if(c instanceof Un)this.addCollection(c);else if(c instanceof no)this.addCollection(c);else if(c instanceof Cr)this.addCollection(c);else{if(!(c instanceof Cn))throw new Lt(c.getGeometryType());this.addCollection(c)}}},{key:"isErodedCompletely",value:function(c,d){var p=c.getCoordinates();if(p.length<4)return d<0;if(p.length===4)return this.isTriangleErodedCompletely(p,d);var b=c.getEnvelopeInternal(),L=Math.min(b.getHeight(),b.getWidth());return d<0&&2*Math.abs(d)>L}},{key:"addCollection",value:function(c){for(var d=0;d<c.getNumGeometries();d++){var p=c.getGeometryN(d);this.add(p)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new At;var c=arguments[0],d=arguments[1],p=arguments[2];this._inputGeom=c,this._distance=d,this._curveBuilder=p}}]),I}(),Fi=function(){function I(){t(this,I)}return a(I,[{key:"locate",value:function(c){}}]),I}(),Ic=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,I.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ye;var c=this._parent.getGeometryN(this._index++);return c instanceof Cn?(this._subcollectionIterator=new I(c),this._subcollectionIterator.next()):c}},{key:"remove",value:function(){throw new Lt(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[du]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var c=arguments[0];this._parent=c,this._atStart=!0,this._index=0,this._max=c.getNumGeometries()}},{key:"isAtomic",value:function(c){return!(c instanceof Cn)}}]),I}(),jn=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"locate",value:function(c){return I.locate(c,this._geom)}},{key:"interfaces_",get:function(){return[Fi]}}],[{key:"constructor_",value:function(){this._geom=null;var c=arguments[0];this._geom=c}},{key:"locatePointInPolygon",value:function(c,d){if(d.isEmpty())return Ae.EXTERIOR;var p=d.getExteriorRing(),b=I.locatePointInRing(c,p);if(b!==Ae.INTERIOR)return b;for(var L=0;L<d.getNumInteriorRing();L++){var O=d.getInteriorRingN(L),V=I.locatePointInRing(c,O);if(V===Ae.BOUNDARY)return Ae.BOUNDARY;if(V===Ae.INTERIOR)return Ae.EXTERIOR}return Ae.INTERIOR}},{key:"locatePointInRing",value:function(c,d){return d.getEnvelopeInternal().intersects(c)?Vs.locateInRing(c,d.getCoordinates()):Ae.EXTERIOR}},{key:"containsPointInPolygon",value:function(c,d){return Ae.EXTERIOR!==I.locatePointInPolygon(c,d)}},{key:"locateInGeometry",value:function(c,d){if(d instanceof en)return I.locatePointInPolygon(c,d);if(d instanceof Cn)for(var p=new Ic(d);p.hasNext();){var b=p.next();if(b!==d){var L=I.locateInGeometry(c,b);if(L!==Ae.EXTERIOR)return L}}return Ae.EXTERIOR}},{key:"isContained",value:function(c,d){return Ae.EXTERIOR!==I.locate(c,d)}},{key:"locate",value:function(c,d){return d.isEmpty()?Ae.EXTERIOR:d.getEnvelopeInternal().intersects(c)?I.locateInGeometry(c,d):Ae.EXTERIOR}}]),I}(),$a=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getNextCW",value:function(c){this.getEdges();var d=this._edgeList.indexOf(c),p=d-1;return d===0&&(p=this._edgeList.size()-1),this._edgeList.get(p)}},{key:"propagateSideLabels",value:function(c){for(var d=Ae.NONE,p=this.iterator();p.hasNext();){var b=p.next().getLabel();b.isArea(c)&&b.getLocation(c,Se.LEFT)!==Ae.NONE&&(d=b.getLocation(c,Se.LEFT))}if(d===Ae.NONE)return null;for(var L=d,O=this.iterator();O.hasNext();){var V=O.next(),K=V.getLabel();if(K.getLocation(c,Se.ON)===Ae.NONE&&K.setLocation(c,Se.ON,L),K.isArea(c)){var pe=K.getLocation(c,Se.LEFT),Be=K.getLocation(c,Se.RIGHT);if(Be!==Ae.NONE){if(Be!==L)throw new Rt("side location conflict",V.getCoordinate());pe===Ae.NONE&&St.shouldNeverReachHere("found single null side (at "+V.getCoordinate()+")"),L=pe}else St.isTrue(K.getLocation(c,Se.LEFT)===Ae.NONE,"found single null side"),K.setLocation(c,Se.RIGHT,L),K.setLocation(c,Se.LEFT,L)}}}},{key:"getCoordinate",value:function(){var c=this.iterator();return c.hasNext()?c.next().getCoordinate():null}},{key:"print",value:function(c){Pi.out.println("EdgeEndStar:   "+this.getCoordinate());for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"isAreaLabelsConsistent",value:function(c){return this.computeEdgeEndLabels(c.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(c){var d=this.getEdges();if(d.size()<=0)return!0;var p=d.size()-1,b=d.get(p).getLabel().getLocation(c,Se.LEFT);St.isTrue(b!==Ae.NONE,"Found unlabelled area edge");for(var L=b,O=this.iterator();O.hasNext();){var V=O.next().getLabel();St.isTrue(V.isArea(c),"Found non-area edge");var K=V.getLocation(c,Se.LEFT),pe=V.getLocation(c,Se.RIGHT);if(K===pe||pe!==L)return!1;L=K}return!0}},{key:"findIndex",value:function(c){this.iterator();for(var d=0;d<this._edgeList.size();d++)if(this._edgeList.get(d)===c)return d;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new At(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(c,d,p){return this._ptInAreaLocation[c]===Ae.NONE&&(this._ptInAreaLocation[c]=jn.locate(d,p[c].getGeometry())),this._ptInAreaLocation[c]}},{key:"toString",value:function(){var c=new Ri;c.append("EdgeEndStar:   "+this.getCoordinate()),c.append(`
`);for(var d=this.iterator();d.hasNext();){var p=d.next();c.append(p),c.append(`
`)}return c.toString()}},{key:"computeEdgeEndLabels",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().computeLabel(c)}},{key:"computeLabelling",value:function(c){this.computeEdgeEndLabels(c[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var d=[!1,!1],p=this.iterator();p.hasNext();)for(var b=p.next().getLabel(),L=0;L<2;L++)b.isLine(L)&&b.getLocation(L)===Ae.BOUNDARY&&(d[L]=!0);for(var O=this.iterator();O.hasNext();)for(var V=O.next(),K=V.getLabel(),pe=0;pe<2;pe++)if(K.isAnyNull(pe)){var Be=Ae.NONE;if(d[pe])Be=Ae.EXTERIOR;else{var $e=V.getCoordinate();Be=this.getLocation(pe,$e,c)}K.setAllLocationsIfNull(pe,Be)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(c,d){this._edgeMap.put(c,d),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Bo,this._edgeList=null,this._ptInAreaLocation=[Ae.NONE,Ae.NONE]}}]),I}(),mi=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var p=null,b=null,L=this._SCANNING_FOR_INCOMING,O=0;O<this._resultAreaEdgeList.size();O++){var V=this._resultAreaEdgeList.get(O),K=V.getSym();if(V.getLabel().isArea())switch(p===null&&V.isInResult()&&(p=V),L){case this._SCANNING_FOR_INCOMING:if(!K.isInResult())continue;b=K,L=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!V.isInResult())continue;b.setNext(V),L=this._SCANNING_FOR_INCOMING}}if(L===this._LINKING_TO_OUTGOING){if(p===null)throw new Rt("no outgoing dirEdge found",this.getCoordinate());St.isTrue(p.isInResult(),"unable to link last incoming dirEdge"),b.setNext(p)}}},{key:"insert",value:function(p){var b=p;this.insertEdgeEnd(b,b)}},{key:"getRightmostEdge",value:function(){var p=this.getEdges(),b=p.size();if(b<1)return null;var L=p.get(0);if(b===1)return L;var O=p.get(b-1),V=L.getQuadrant(),K=O.getQuadrant();return fr.isNorthern(V)&&fr.isNorthern(K)?L:fr.isNorthern(V)||fr.isNorthern(K)?L.getDy()!==0?L:O.getDy()!==0?O:(St.shouldNeverReachHere("found two horizontal edges incident on node"),null):O}},{key:"print",value:function(p){Pi.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var b=this.iterator();b.hasNext();){var L=b.next();p.print("out "),L.print(p),p.println(),p.print("in "),L.getSym().print(p),p.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new At;for(var p=this.iterator();p.hasNext();){var b=p.next();(b.isInResult()||b.getSym().isInResult())&&this._resultAreaEdgeList.add(b)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(p){for(var b=this.iterator();b.hasNext();){var L=b.next().getLabel();L.setAllLocationsIfNull(0,p.getLocation(0)),L.setAllLocationsIfNull(1,p.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var p=null,b=null,L=this._edgeList.size()-1;L>=0;L--){var O=this._edgeList.get(L),V=O.getSym();b===null&&(b=V),p!==null&&V.setNext(p),p=O}b.setNext(p)}},{key:"computeDepths",value:function(){if(arguments.length===1){var p=arguments[0],b=this.findIndex(p),L=p.getDepth(Se.LEFT),O=p.getDepth(Se.RIGHT),V=this.computeDepths(b+1,this._edgeList.size(),L),K=this.computeDepths(0,b,V);if(K!==O)throw new Rt("depth mismatch at "+p.getCoordinate())}else if(arguments.length===3){for(var pe=arguments[0],Be=arguments[1],$e=arguments[2],gt=$e,Ft=pe;Ft<Be;Ft++){var zt=this._edgeList.get(Ft);zt.setEdgeDepths(Se.RIGHT,gt),gt=zt.getDepth(Se.LEFT)}return gt}}},{key:"mergeSymLabels",value:function(){for(var p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().merge(b.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(p){for(var b=null,L=null,O=this._SCANNING_FOR_INCOMING,V=this._resultAreaEdgeList.size()-1;V>=0;V--){var K=this._resultAreaEdgeList.get(V),pe=K.getSym();switch(b===null&&K.getEdgeRing()===p&&(b=K),O){case this._SCANNING_FOR_INCOMING:if(pe.getEdgeRing()!==p)continue;L=pe,O=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(K.getEdgeRing()!==p)continue;L.setNextMin(K),O=this._SCANNING_FOR_INCOMING}}O===this._LINKING_TO_OUTGOING&&(St.isTrue(b!==null,"found null for first outgoing dirEdge"),St.isTrue(b.getEdgeRing()===p,"unable to link last incoming dirEdge"),L.setNextMin(b))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var p=0,b=this.iterator();b.hasNext();){var L=b.next();L.isInResult()&&p++}return p}if(arguments.length===1){for(var O=arguments[0],V=0,K=this.iterator();K.hasNext();){var pe=K.next();pe.getEdgeRing()===O&&V++}return V}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var p=Ae.NONE,b=this.iterator();b.hasNext();){var L=b.next(),O=L.getSym();if(!L.isLineEdge()){if(L.isInResult()){p=Ae.INTERIOR;break}if(O.isInResult()){p=Ae.EXTERIOR;break}}}if(p===Ae.NONE)return null;for(var V=p,K=this.iterator();K.hasNext();){var pe=K.next(),Be=pe.getSym();pe.isLineEdge()?pe.getEdge().setCovered(V===Ae.INTERIOR):(pe.isInResult()&&(V=Ae.EXTERIOR),Be.isInResult()&&(V=Ae.INTERIOR))}}},{key:"computeLabelling",value:function(p){U(m(d.prototype),"computeLabelling",this).call(this,p),this._label=new wi(Ae.NONE);for(var b=this.iterator();b.hasNext();)for(var L=b.next().getEdge().getLabel(),O=0;O<2;O++){var V=L.getLocation(O);V!==Ae.INTERIOR&&V!==Ae.BOUNDARY||this._label.setLocation(O,Ae.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),d}($a),hi=function(I){h(d,I);var c=B(d);function d(){return t(this,d),c.call(this)}return a(d,[{key:"createNode",value:function(p){return new ma(p,new mi)}}]),d}(qa),oo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;return I.compareOriented(this._pts,this._orientation,d._pts,d._orientation)}},{key:"interfaces_",get:function(){return[ye]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var c=arguments[0];this._pts=c,this._orientation=I.orientation(c)}},{key:"orientation",value:function(c){return $n.increasingDirection(c)===1}},{key:"compareOriented",value:function(c,d,p,b){for(var L=d?1:-1,O=b?1:-1,V=d?c.length:-1,K=b?p.length:-1,pe=d?0:c.length-1,Be=b?0:p.length-1;;){var $e=c[pe].compareTo(p[Be]);if($e!==0)return $e;var gt=(pe+=L)===V,Ft=(Be+=O)===K;if(gt&&!Ft)return-1;if(!gt&&Ft)return 1;if(gt&&Ft)return 0}}}]),I}(),ba=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.print("MULTILINESTRING ( ");for(var d=0;d<this._edges.size();d++){var p=this._edges.get(d);d>0&&c.print(","),c.print("(");for(var b=p.getCoordinates(),L=0;L<b.length;L++)L>0&&c.print(","),c.print(b[L].x+" "+b[L].y);c.println(")")}c.print(")  ")}},{key:"addAll",value:function(c){for(var d=c.iterator();d.hasNext();)this.add(d.next())}},{key:"findEdgeIndex",value:function(c){for(var d=0;d<this._edges.size();d++)if(this._edges.get(d).equals(c))return d;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(c){return this._edges.get(c)}},{key:"findEqualEdge",value:function(c){var d=new oo(c.getCoordinates());return this._ocaMap.get(d)}},{key:"add",value:function(c){this._edges.add(c);var d=new oo(c.getCoordinates());this._ocaMap.put(d,c)}}],[{key:"constructor_",value:function(){this._edges=new At,this._ocaMap=new Bo}}]),I}(),Zo=function(){function I(){t(this,I)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){}},{key:"isDone",value:function(){}}]),I}(),Dl=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isTrivialIntersection",value:function(c,d,p,b){if(c===p&&this._li.getIntersectionNum()===1){if(I.isAdjacentSegments(d,b))return!0;if(c.isClosed()){var L=c.size()-1;if(d===0&&b===L||b===0&&d===L)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;this.numTests++;var L=c.getCoordinates()[d],O=c.getCoordinates()[d+1],V=p.getCoordinates()[b],K=p.getCoordinates()[b+1];this._li.computeIntersection(L,O,V,K),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(c,d,p,b)||(this._hasIntersection=!0,c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var c=arguments[0];this._li=c}},{key:"isAdjacentSegments",value:function(c,d){return Math.abs(c-d)===1}}]),I}(),Eo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex),c.println(" dist = "+this.dist)}},{key:"compareTo",value:function(c){var d=c;return this.compare(d.segmentIndex,d.dist)}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===c}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(c,d){return this.segmentIndex<c?-1:this.segmentIndex>c?1:this.dist<d?-1:this.dist>d?1:0}},{key:"interfaces_",get:function(){return[ye]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.coord=new We(c),this.segmentIndex=d,this.dist=p}}]),I}(),Ho=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),L=this.createSplitEdge(p,b);c.add(L),p=b}}},{key:"addEndpoints",value:function(){var c=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[c],c,0)}},{key:"createSplitEdge",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2,b=this.edge.pts[d.segmentIndex],L=d.dist>0||!d.coord.equals2D(b);L||p--;var O=new Array(p).fill(null),V=0;O[V++]=new We(c.coord);for(var K=c.segmentIndex+1;K<=d.segmentIndex;K++)O[V++]=this.edge.pts[K];return L&&(O[V]=d.coord),new Xo(O,new wi(this.edge._label))}},{key:"add",value:function(c,d,p){var b=new Eo(c,d,p),L=this._nodeMap.get(b);return L!==null?L:(this._nodeMap.put(b,b),b)}},{key:"isIntersection",value:function(c){for(var d=this.iterator();d.hasNext();)if(d.next().coord.equals(c))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this.edge=null;var c=arguments[0];this.edge=c}}]),I}(),ls=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])||I.isTrue(this._matrix[Ae.INTERIOR][Ae.BOUNDARY])||I.isTrue(this._matrix[Ae.BOUNDARY][Ae.INTERIOR])||I.isTrue(this._matrix[Ae.BOUNDARY][Ae.BOUNDARY]))&&this._matrix[Ae.EXTERIOR][Ae.INTERIOR]===ue.FALSE&&this._matrix[Ae.EXTERIOR][Ae.BOUNDARY]===ue.FALSE}},{key:"isCoveredBy",value:function(){return(I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])||I.isTrue(this._matrix[Ae.INTERIOR][Ae.BOUNDARY])||I.isTrue(this._matrix[Ae.BOUNDARY][Ae.INTERIOR])||I.isTrue(this._matrix[Ae.BOUNDARY][Ae.BOUNDARY]))&&this._matrix[Ae.INTERIOR][Ae.EXTERIOR]===ue.FALSE&&this._matrix[Ae.BOUNDARY][Ae.EXTERIOR]===ue.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this._matrix[p][b]=ue.toDimensionValue(c.charAt(d))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._matrix[L][O]=V}}},{key:"isContains",value:function(){return I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])&&this._matrix[Ae.EXTERIOR][Ae.INTERIOR]===ue.FALSE&&this._matrix[Ae.EXTERIOR][Ae.BOUNDARY]===ue.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this.setAtLeast(p,b,ue.toDimensionValue(c.charAt(d)))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._matrix[L][O]<V&&(this._matrix[L][O]=V)}}},{key:"setAtLeastIfValid",value:function(c,d,p){c>=0&&d>=0&&this.setAtLeast(c,d,p)}},{key:"isWithin",value:function(){return I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])&&this._matrix[Ae.INTERIOR][Ae.EXTERIOR]===ue.FALSE&&this._matrix[Ae.BOUNDARY][Ae.EXTERIOR]===ue.FALSE}},{key:"isTouches",value:function(c,d){return c>d?this.isTouches(d,c):(c===ue.A&&d===ue.A||c===ue.L&&d===ue.L||c===ue.L&&d===ue.A||c===ue.P&&d===ue.A||c===ue.P&&d===ue.L)&&this._matrix[Ae.INTERIOR][Ae.INTERIOR]===ue.FALSE&&(I.isTrue(this._matrix[Ae.INTERIOR][Ae.BOUNDARY])||I.isTrue(this._matrix[Ae.BOUNDARY][Ae.INTERIOR])||I.isTrue(this._matrix[Ae.BOUNDARY][Ae.BOUNDARY]))}},{key:"isOverlaps",value:function(c,d){return c===ue.P&&d===ue.P||c===ue.A&&d===ue.A?I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])&&I.isTrue(this._matrix[Ae.INTERIOR][Ae.EXTERIOR])&&I.isTrue(this._matrix[Ae.EXTERIOR][Ae.INTERIOR]):c===ue.L&&d===ue.L&&this._matrix[Ae.INTERIOR][Ae.INTERIOR]===1&&I.isTrue(this._matrix[Ae.INTERIOR][Ae.EXTERIOR])&&I.isTrue(this._matrix[Ae.EXTERIOR][Ae.INTERIOR])}},{key:"isEquals",value:function(c,d){return c===d&&I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])&&this._matrix[Ae.INTERIOR][Ae.EXTERIOR]===ue.FALSE&&this._matrix[Ae.BOUNDARY][Ae.EXTERIOR]===ue.FALSE&&this._matrix[Ae.EXTERIOR][Ae.INTERIOR]===ue.FALSE&&this._matrix[Ae.EXTERIOR][Ae.BOUNDARY]===ue.FALSE}},{key:"toString",value:function(){for(var c=new ti("123456789"),d=0;d<3;d++)for(var p=0;p<3;p++)c.setCharAt(3*d+p,ue.toDimensionSymbol(this._matrix[d][p]));return c.toString()}},{key:"setAll",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this._matrix[d][p]=c}},{key:"get",value:function(c,d){return this._matrix[c][d]}},{key:"transpose",value:function(){var c=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=c,c=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=c,c=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=c,this}},{key:"matches",value:function(c){if(c.length!==9)throw new xe("Should be length 9: "+c);for(var d=0;d<3;d++)for(var p=0;p<3;p++)if(!I.matches(this._matrix[d][p],c.charAt(3*d+p)))return!1;return!0}},{key:"add",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this.setAtLeast(d,p,c.get(d,p))}},{key:"isDisjoint",value:function(){return this._matrix[Ae.INTERIOR][Ae.INTERIOR]===ue.FALSE&&this._matrix[Ae.INTERIOR][Ae.BOUNDARY]===ue.FALSE&&this._matrix[Ae.BOUNDARY][Ae.INTERIOR]===ue.FALSE&&this._matrix[Ae.BOUNDARY][Ae.BOUNDARY]===ue.FALSE}},{key:"isCrosses",value:function(c,d){return c===ue.P&&d===ue.L||c===ue.P&&d===ue.A||c===ue.L&&d===ue.A?I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])&&I.isTrue(this._matrix[Ae.INTERIOR][Ae.EXTERIOR]):c===ue.L&&d===ue.P||c===ue.A&&d===ue.P||c===ue.A&&d===ue.L?I.isTrue(this._matrix[Ae.INTERIOR][Ae.INTERIOR])&&I.isTrue(this._matrix[Ae.EXTERIOR][Ae.INTERIOR]):c===ue.L&&d===ue.L&&this._matrix[Ae.INTERIOR][Ae.INTERIOR]===0}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(ue.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var c=arguments[0];I.constructor_.call(this),this.set(c)}else if(arguments[0]instanceof I){var d=arguments[0];I.constructor_.call(this),this._matrix[Ae.INTERIOR][Ae.INTERIOR]=d._matrix[Ae.INTERIOR][Ae.INTERIOR],this._matrix[Ae.INTERIOR][Ae.BOUNDARY]=d._matrix[Ae.INTERIOR][Ae.BOUNDARY],this._matrix[Ae.INTERIOR][Ae.EXTERIOR]=d._matrix[Ae.INTERIOR][Ae.EXTERIOR],this._matrix[Ae.BOUNDARY][Ae.INTERIOR]=d._matrix[Ae.BOUNDARY][Ae.INTERIOR],this._matrix[Ae.BOUNDARY][Ae.BOUNDARY]=d._matrix[Ae.BOUNDARY][Ae.BOUNDARY],this._matrix[Ae.BOUNDARY][Ae.EXTERIOR]=d._matrix[Ae.BOUNDARY][Ae.EXTERIOR],this._matrix[Ae.EXTERIOR][Ae.INTERIOR]=d._matrix[Ae.EXTERIOR][Ae.INTERIOR],this._matrix[Ae.EXTERIOR][Ae.BOUNDARY]=d._matrix[Ae.EXTERIOR][Ae.BOUNDARY],this._matrix[Ae.EXTERIOR][Ae.EXTERIOR]=d._matrix[Ae.EXTERIOR][Ae.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var c=arguments[0],d=arguments[1];return d===ue.SYM_DONTCARE||d===ue.SYM_TRUE&&(c>=0||c===ue.TRUE)||d===ue.SYM_FALSE&&c===ue.FALSE||d===ue.SYM_P&&c===ue.P||d===ue.SYM_L&&c===ue.L||d===ue.SYM_A&&c===ue.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var p=arguments[0],b=arguments[1],L=new I(p);return L.matches(b)}}},{key:"isTrue",value:function(c){return c>=0||c===ue.TRUE}}]),I}(),Nl=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(c){return c===null||c.length===0?null:(this.ensureCapacity(this._size+c.length),Pi.arraycopy(c,0,this._data,this._size,c.length),void(this._size+=c.length))}},{key:"ensureCapacity",value:function(c){if(c<=this._data.length)return null;var d=Math.max(c,2*this._data.length);this._data=lt.copyOf(this._data,d)}},{key:"toArray",value:function(){var c=new Array(this._size).fill(null);return Pi.arraycopy(this._data,0,c,0,this._size),c}},{key:"add",value:function(c){this.ensureCapacity(this._size+1),this._data[this._size]=c,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)I.constructor_.call(this,10);else if(arguments.length===1){var c=arguments[0];this._data=new Array(c).fill(null)}}}]),I}(),zl=function(){function I(){t(this,I)}return a(I,[{key:"getChainStartIndices",value:function(c){var d=0,p=new Nl(Math.trunc(c.length/2));p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return p.toArray()}},{key:"findChainEnd",value:function(c,d){for(var p=fr.quadrant(c[d],c[d+1]),b=d+1;b<c.length&&fr.quadrant(c[b-1],c[b])===p;)b++;return b-1}},{key:"OLDgetChainStartIndices",value:function(c){var d=0,p=new At;p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return I.toIntArray(p)}}],[{key:"toIntArray",value:function(c){for(var d=new Array(c.size()).fill(null),p=0;p<d.length;p++)d[p]=c.get(p).intValue();return d}}]),I}(),Fl=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d>p?d:p}},{key:"getMinX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d<p?d:p}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this.computeIntersectsForChain(this.startIndex[c],this.startIndex[c+1],d,d.startIndex[p],d.startIndex[p+1],b)}else if(arguments.length===6){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3],pe=arguments[4],Be=arguments[5];if(O-L==1&&pe-K==1)return Be.addIntersections(this.e,L,V.e,K),null;if(!this.overlaps(L,O,V,K,pe))return null;var $e=Math.trunc((L+O)/2),gt=Math.trunc((K+pe)/2);L<$e&&(K<gt&&this.computeIntersectsForChain(L,$e,V,K,gt,Be),gt<pe&&this.computeIntersectsForChain(L,$e,V,gt,pe,Be)),$e<O&&(K<gt&&this.computeIntersectsForChain($e,O,V,K,gt,Be),gt<pe&&this.computeIntersectsForChain($e,O,V,gt,pe,Be))}}},{key:"overlaps",value:function(c,d,p,b,L){return dn.intersects(this.pts[c],this.pts[d],p.pts[b],p.pts[L])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(c,d){for(var p=0;p<this.startIndex.length-1;p++)for(var b=0;b<c.startIndex.length-1;b++)this.computeIntersectsForChain(p,c,b,d)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var c=arguments[0];this.e=c,this.pts=c.getCoordinates();var d=new zl;this.startIndex=d.getChainStartIndices(this.pts)}}]),I}(),ao=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getDepth",value:function(c,d){return this._depth[c][d]}},{key:"setDepth",value:function(c,d,p){this._depth[c][d]=p}},{key:"isNull",value:function(){if(arguments.length===0){for(var c=0;c<2;c++)for(var d=0;d<3;d++)if(this._depth[c][d]!==I.NULL_VALUE)return!1;return!0}if(arguments.length===1){var p=arguments[0];return this._depth[p][1]===I.NULL_VALUE}if(arguments.length===2){var b=arguments[0],L=arguments[1];return this._depth[b][L]===I.NULL_VALUE}}},{key:"normalize",value:function(){for(var c=0;c<2;c++)if(!this.isNull(c)){var d=this._depth[c][1];this._depth[c][2]<d&&(d=this._depth[c][2]),d<0&&(d=0);for(var p=1;p<3;p++){var b=0;this._depth[c][p]>d&&(b=1),this._depth[c][p]=b}}}},{key:"getDelta",value:function(c){return this._depth[c][Se.RIGHT]-this._depth[c][Se.LEFT]}},{key:"getLocation",value:function(c,d){return this._depth[c][d]<=0?Ae.EXTERIOR:Ae.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<2;d++)for(var p=1;p<3;p++){var b=c.getLocation(d,p);b!==Ae.EXTERIOR&&b!==Ae.INTERIOR||(this.isNull(d,p)?this._depth[d][p]=I.depthAtLocation(b):this._depth[d][p]+=I.depthAtLocation(b))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];V===Ae.INTERIOR&&this._depth[L][O]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var c=0;c<2;c++)for(var d=0;d<3;d++)this._depth[c][d]=I.NULL_VALUE}},{key:"depthAtLocation",value:function(c){return c===Ae.EXTERIOR?0:c===Ae.INTERIOR?1:I.NULL_VALUE}}]),I}();ao.NULL_VALUE=-1;var Xo=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var p=new Array(2).fill(null);return p[0]=this.pts[0],p[1]=this.pts[1],new d(p,wi.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(p){this._isIsolated=p}},{key:"setName",value:function(p){this._name=p}},{key:"equals",value:function(p){if(!(p instanceof d))return!1;var b=p;if(this.pts.length!==b.pts.length)return!1;for(var L=!0,O=!0,V=this.pts.length,K=0;K<this.pts.length;K++)if(this.pts[K].equals2D(b.pts[K])||(L=!1),this.pts[K].equals2D(b.pts[--V])||(O=!1),!L&&!O)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var p=arguments[0];return this.pts[p]}}},{key:"print",value:function(p){p.print("edge "+this._name+": "),p.print("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.print(","),p.print(this.pts[b].x+" "+this.pts[b].y);p.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(p){d.updateIM(this._label,p)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(p){p.print("edge "+this._name+": ");for(var b=this.pts.length-1;b>=0;b--)p.print(this.pts[b]+" ");p.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Fl(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new dn;for(var p=0;p<this.pts.length;p++)this._env.expandToInclude(this.pts[p])}return this._env}},{key:"addIntersection",value:function(p,b,L,O){var V=new We(p.getIntersection(O)),K=b,pe=p.getEdgeDistance(L,O),Be=K+1;if(Be<this.pts.length){var $e=this.pts[Be];V.equals2D($e)&&(K=Be,pe=0)}this.eiList.add(V,K,pe)}},{key:"toString",value:function(){var p=new ti;p.append("edge "+this._name+": "),p.append("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.append(","),p.append(this.pts[b].x+" "+this.pts[b].y);return p.append(")  "+this._label+" "+this._depthDelta),p.toString()}},{key:"isPointwiseEqual",value:function(p){if(this.pts.length!==p.pts.length)return!1;for(var b=0;b<this.pts.length;b++)if(!this.pts[b].equals2D(p.pts[b]))return!1;return!0}},{key:"setDepthDelta",value:function(p){this._depthDelta=p}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(p,b,L){for(var O=0;O<p.getIntersectionNum();O++)this.addIntersection(p,b,L,O)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Ho(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ao,this._depthDelta=0,arguments.length===1){var p=arguments[0];d.constructor_.call(this,p,null)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.pts=b,this._label=L}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof ls&&arguments[0]instanceof wi))return U(m(d),"updateIM",this).apply(this,arguments);var p=arguments[0],b=arguments[1];b.setAtLeastIfValid(p.getLocation(0,Se.ON),p.getLocation(1,Se.ON),1),p.isArea()&&(b.setAtLeastIfValid(p.getLocation(0,Se.LEFT),p.getLocation(1,Se.LEFT),2),b.setAtLeastIfValid(p.getLocation(0,Se.RIGHT),p.getLocation(1,Se.RIGHT),2))}}]),d}(pa),Wo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setWorkingPrecisionModel",value:function(c){this._workingPrecisionModel=c}},{key:"insertUniqueEdge",value:function(c){var d=this._edgeList.findEqualEdge(c);if(d!==null){var p=d.getLabel(),b=c.getLabel();d.isPointwiseEqual(c)||(b=new wi(c.getLabel())).flip(),p.merge(b);var L=I.depthDelta(b),O=d.getDepthDelta()+L;d.setDepthDelta(O)}else this._edgeList.add(c),c.setDepthDelta(I.depthDelta(c.getLabel()))}},{key:"buildSubgraphs",value:function(c,d){for(var p=new At,b=c.iterator();b.hasNext();){var L=b.next(),O=L.getRightmostCoordinate(),V=new Wa(p).getDepth(O);L.computeDepth(V),L.findResultEdges(),p.add(L),d.add(L.getDirectedEdges(),L.getNodes())}}},{key:"createSubgraphs",value:function(c){for(var d=new At,p=c.getNodes().iterator();p.hasNext();){var b=p.next();if(!b.isVisited()){var L=new Wr;L.create(b),d.add(L)}}return jo.sort(d,jo.reverseOrder()),d}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(c){if(this._workingNoder!==null)return this._workingNoder;var d=new Ha,p=new so;return p.setPrecisionModel(c),d.setSegmentIntersector(new Dl(p)),d}},{key:"buffer",value:function(c,d){var p=this._workingPrecisionModel;p===null&&(p=c.getPrecisionModel()),this._geomFact=c.getFactory();var b=new Rl(p,this._bufParams),L=new kc(c,d,b).getCurves();if(L.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(L,p),this._graph=new bs(new hi),this._graph.addEdges(this._edgeList.getEdges());var O=this.createSubgraphs(this._graph),V=new bc(this._geomFact);this.buildSubgraphs(O,V);var K=V.getPolygons();return K.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(K)}},{key:"computeNodedEdges",value:function(c,d){var p=this.getNoder(d);p.computeNodes(c);for(var b=p.getNodedSubstrings().iterator();b.hasNext();){var L=b.next(),O=L.getCoordinates();if(O.length!==2||!O[0].equals2D(O[1])){var V=L.getData(),K=new Xo(L.getCoordinates(),new wi(V));this.insertUniqueEdge(K)}}}},{key:"setNoder",value:function(c){this._workingNoder=c}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ba;var c=arguments[0];this._bufParams=c}},{key:"depthDelta",value:function(c){var d=c.getLocation(0,Se.LEFT),p=c.getLocation(0,Se.RIGHT);return d===Ae.INTERIOR&&p===Ae.EXTERIOR?1:d===Ae.EXTERIOR&&p===Ae.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(c){for(var d=new is,p=new At;c.hasNext();){var b=c.next(),L=d.createLineString(b.getCoordinates());p.add(L)}return d.buildGeometry(p)}}]),I}(),Ko=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"rescale",value:function(){if(Jt(arguments[0],ut))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.rescale(p.getCoordinates())}else if(arguments[0]instanceof Array){for(var b=arguments[0],L=0;L<b.length;L++)b[L].x=b[L].x/this._scaleFactor+this._offsetX,b[L].y=b[L].y/this._scaleFactor+this._offsetY;b.length===2&&b[0].equals2D(b[1])&&Pi.out.println(b)}}},{key:"scale",value:function(){if(Jt(arguments[0],ut)){for(var c=arguments[0],d=new At(c.size()),p=c.iterator();p.hasNext();){var b=p.next();d.add(new ws(this.scale(b.getCoordinates()),b.getData()))}return d}if(arguments[0]instanceof Array){for(var L=arguments[0],O=new Array(L.length).fill(null),V=0;V<L.length;V++)O[V]=new We(Math.round((L[V].x-this._offsetX)*this._scaleFactor),Math.round((L[V].y-this._offsetY)*this._scaleFactor),L[V].getZ());var K=$n.removeRepeatedPoints(O);return K}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var c=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(c),c}},{key:"computeNodes",value:function(c){var d=c;this._isScaled&&(d=this.scale(c)),this._noder.computeNodes(d)}},{key:"interfaces_",get:function(){return[Za]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var c=arguments[0],d=arguments[1];I.constructor_.call(this,c,d,0,0)}else if(arguments.length===4){var p=arguments[0],b=arguments[1];this._noder=p,this._scaleFactor=b,this._isScaled=!this.isIntegerPrecision()}}}]),I}(),$o=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next(),p=d.getCoordinates();this.checkEndPtVertexIntersections(p[0],this._segStrings),this.checkEndPtVertexIntersections(p[p.length-1],this._segStrings)}else if(arguments.length===2){for(var b=arguments[0],L=arguments[1],O=L.iterator();O.hasNext();)for(var V=O.next(),K=V.getCoordinates(),pe=1;pe<K.length-1;pe++)if(K[pe].equals(b))throw new pt("found endpt/interior pt intersection at index "+pe+" :pt "+b)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();)for(var d=c.next(),p=this._segStrings.iterator();p.hasNext();){var b=p.next();this.checkInteriorIntersections(d,b)}else if(arguments.length===2)for(var L=arguments[0],O=arguments[1],V=L.getCoordinates(),K=O.getCoordinates(),pe=0;pe<V.length-1;pe++)for(var Be=0;Be<K.length-1;Be++)this.checkInteriorIntersections(L,pe,O,Be);else if(arguments.length===4){var $e=arguments[0],gt=arguments[1],Ft=arguments[2],zt=arguments[3];if($e===Ft&&gt===zt)return null;var gn=$e.getCoordinates()[gt],vn=$e.getCoordinates()[gt+1],Ln=Ft.getCoordinates()[zt],ii=Ft.getCoordinates()[zt+1];if(this._li.computeIntersection(gn,vn,Ln,ii),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,gn,vn)||this.hasInteriorIntersection(this._li,Ln,ii)))throw new pt("found non-noded intersection at "+gn+"-"+vn+" and "+Ln+"-"+ii)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next();this.checkCollapses(d)}else if(arguments.length===1)for(var p=arguments[0],b=p.getCoordinates(),L=0;L<b.length-2;L++)this.checkCollapse(b[L],b[L+1],b[L+2])}},{key:"hasInteriorIntersection",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++){var L=c.getIntersection(b);if(!L.equals(d)&&!L.equals(p))return!0}return!1}},{key:"checkCollapse",value:function(c,d,p){if(c.equals(p))throw new pt("found non-noded collapse at "+I.fact.createLineString([c,d,p]))}}],[{key:"constructor_",value:function(){this._li=new so,this._segStrings=null;var c=arguments[0];this._segStrings=c}}]),I}();$o.fact=new is;var Yo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"intersectsScaled",value:function(c,d){var p=Math.min(c.x,d.x),b=Math.max(c.x,d.x),L=Math.min(c.y,d.y),O=Math.max(c.y,d.y),V=this._maxx<p||this._minx>b||this._maxy<L||this._miny>O;if(V)return!1;var K=this.intersectsToleranceSquare(c,d);return St.isTrue(!(V&&K),"Found bad envelope test"),K}},{key:"initCorners",value:function(c){var d=.5;this._minx=c.x-d,this._maxx=c.x+d,this._miny=c.y-d,this._maxy=c.y+d,this._corner[0]=new We(this._maxx,this._maxy),this._corner[1]=new We(this._minx,this._maxy),this._corner[2]=new We(this._minx,this._miny),this._corner[3]=new We(this._maxx,this._miny)}},{key:"intersects",value:function(c,d){return this._scaleFactor===1?this.intersectsScaled(c,d):(this.copyScaled(c,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(c){return Math.round(c*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(c,d){d.x=this.scale(c.x),d.y=this.scale(c.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var c=I.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new dn(this._originalPt.x-c,this._originalPt.x+c,this._originalPt.y-c,this._originalPt.y+c)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(c,d){return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(c,d){var p=!1,b=!1;return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!p||!b)||!!c.equals(this._pt)||!!d.equals(this._pt))))}},{key:"addSnappedNode",value:function(c,d){var p=c.getCoordinate(d),b=c.getCoordinate(d+1);return!!this.intersects(p,b)&&(c.addIntersection(this.getCoordinate(),d),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var c=arguments[0],d=arguments[1],p=arguments[2];if(this._originalPt=c,this._pt=c,this._scaleFactor=d,this._li=p,d<=0)throw new xe("Scale factor must be non-zero");d!==1&&(this._pt=new We(this.scale(c.x),this.scale(c.y)),this._p0Scaled=new We,this._p1Scaled=new We),this.initCorners(this._pt)}}]),I}();Yo.SAFE_ENV_EXPANSION_FACTOR=.75;var Jo=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"select",value:function(){if(arguments.length!==1&&arguments.length===2){var c=arguments[0],d=arguments[1];c.getLineSegment(d,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new $r}}]),I}(),Ao=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"snap",value:function(){if(arguments.length===1){var c=arguments[0];return this.snap(c,null,-1)}if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2],L=d.getSafeEnvelope(),O=new Ol(d,p,b);return this._index.query(L,new(function(){function V(){t(this,V)}return a(V,[{key:"interfaces_",get:function(){return[Cl]}},{key:"visitItem",value:function(K){K.select(L,O)}}]),V}())),O.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var c=arguments[0];this._index=c}}]),I}(),Ol=function(I){h(d,I);var c=B(d);function d(){var p;return t(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof gu))return U(m(d.prototype),"select",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=p.getContext();if(this._parentEdge===L&&(b===this._hotPixelVertexIndex||b+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(L,b)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var p=arguments[0],b=arguments[1],L=arguments[2];this._hotPixel=p,this._parentEdge=b,this._hotPixelVertexIndex=L}}]),d}(Jo);Ao.HotPixelSnapAction=Ol;var Bl=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;var L=c.getCoordinates()[d],O=c.getCoordinates()[d+1],V=p.getCoordinates()[b],K=p.getCoordinates()[b+1];if(this._li.computeIntersection(L,O,V,K),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var pe=0;pe<this._li.getIntersectionNum();pe++)this._interiorIntersections.add(this._li.getIntersection(pe));c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var c=arguments[0];this._li=c,this._interiorIntersections=new At}}]),I}(),Qn=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkCorrectness",value:function(c){var d=ws.getNodedSubstrings(c),p=new $o(d);try{p.checkValid()}catch(b){if(!(b instanceof ge))throw b;b.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return ws.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(c,d){var p=this.findInteriorIntersections(c,d);this.computeIntersectionSnaps(p),this.computeVertexSnaps(c)}},{key:"findInteriorIntersections",value:function(c,d){var p=new Bl(d);return this._noder.setSegmentIntersector(p),this._noder.computeNodes(c),p.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(Jt(arguments[0],ut))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.computeVertexSnaps(p)}else if(arguments[0]instanceof ws)for(var b=arguments[0],L=b.getCoordinates(),O=0;O<L.length;O++){var V=new Yo(L[O],this._scaleFactor,this._li),K=this._pointSnapper.snap(V,b,O);K&&b.addIntersection(L[O],O)}}},{key:"computeNodes",value:function(c){this._nodedSegStrings=c,this._noder=new Ha,this._pointSnapper=new Ao(this._noder.getIndex()),this.snapRound(c,this._li)}},{key:"computeIntersectionSnaps",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next(),b=new Yo(p,this._scaleFactor,this._li);this._pointSnapper.snap(b)}}},{key:"interfaces_",get:function(){return[Za]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var c=arguments[0];this._pm=c,this._li=new so,this._li.setPrecisionModel(c),this._scaleFactor=c.getScale()}}]),I}(),Zs=function(){function I(){t(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"bufferFixedPrecision",value:function(c){var d=new Ko(new Qn(new Ni(1)),c.getScale()),p=new Wo(this._bufParams);p.setWorkingPrecisionModel(c),p.setNoder(d),this._resultGeometry=p.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var c=I.MAX_PRECISION_DIGITS;c>=0;c--){try{this.bufferReducedPrecision(c)}catch(L){if(!(L instanceof Rt))throw L;this._saveException=L}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var d=arguments[0],p=I.precisionScaleFactor(this._argGeom,this._distance,d),b=new Ni(p);this.bufferFixedPrecision(b)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var c=this._argGeom.getFactory().getPrecisionModel();c.getType()===Ni.FIXED?this.bufferFixedPrecision(c):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(c){this._bufParams.setQuadrantSegments(c)}},{key:"bufferOriginalPrecision",value:function(){try{var c=new Wo(this._bufParams);this._resultGeometry=c.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof pt))throw d;this._saveException=d}}},{key:"getResultGeometry",value:function(c){return this._distance=c,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(c){this._bufParams.setEndCapStyle(c)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Y,this._resultGeometry=null,this._saveException=null,arguments.length===1){var c=arguments[0];this._argGeom=c}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this._argGeom=d,this._bufParams=p}}},{key:"bufferOp",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1],p=new I(c),b=p.getResultGeometry(d);return b}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ot&&typeof arguments[1]=="number"){var L=arguments[0],O=arguments[1],V=arguments[2],K=new I(L);K.setQuadrantSegments(V);var pe=K.getResultGeometry(O);return pe}if(arguments[2]instanceof Y&&arguments[0]instanceof Ot&&typeof arguments[1]=="number"){var Be=arguments[0],$e=arguments[1],gt=arguments[2],Ft=new I(Be,gt),zt=Ft.getResultGeometry($e);return zt}}else if(arguments.length===4){var gn=arguments[0],vn=arguments[1],Ln=arguments[2],ii=arguments[3],gi=new I(gn);gi.setQuadrantSegments(Ln),gi.setEndCapStyle(ii);var ui=gi.getResultGeometry(vn);return ui}}},{key:"precisionScaleFactor",value:function(c,d,p){var b=c.getEnvelopeInternal(),L=Ar.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(d>0?d:0),O=p-Math.trunc(Math.log(L)/Math.log(10)+1);return Math.pow(10,O)}}]),I}();Zs.CAP_ROUND=Y.CAP_ROUND,Zs.CAP_BUTT=Y.CAP_FLAT,Zs.CAP_FLAT=Y.CAP_FLAT,Zs.CAP_SQUARE=Y.CAP_SQUARE,Zs.MAX_PRECISION_DIGITS=12;var Sc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ul=function(){function I(c){t(this,I),this.geometryFactory=c||new is}return a(I,[{key:"read",value:function(c){var d,p=(d=typeof c=="string"?JSON.parse(c):c).type;if(!dr[p])throw new Error("Unknown GeoJSON type: "+d.type);return Sc.indexOf(p)!==-1?dr[p].call(this,d.coordinates):p==="GeometryCollection"?dr[p].call(this,d.geometries):dr[p].call(this,d)}},{key:"write",value:function(c){var d=c.getGeometryType();if(!ks[d])throw new Error("Geometry is not supported");return ks[d].call(this,c)}}]),I}(),dr={Feature:function(I){var c={};for(var d in I)c[d]=I[d];if(I.geometry){var p=I.geometry.type;if(!dr[p])throw new Error("Unknown GeoJSON type: "+I.type);c.geometry=this.read(I.geometry)}return I.bbox&&(c.bbox=dr.bbox.call(this,I.bbox)),c},FeatureCollection:function(I){var c={};if(I.features){c.features=[];for(var d=0;d<I.features.length;++d)c.features.push(this.read(I.features[d]))}return I.bbox&&(c.bbox=this.parse.bbox.call(this,I.bbox)),c},coordinates:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(S(We,ee(p)))}return c},bbox:function(I){return this.geometryFactory.createLinearRing([new We(I[0],I[1]),new We(I[2],I[1]),new We(I[2],I[3]),new We(I[0],I[3]),new We(I[0],I[1])])},Point:function(I){var c=S(We,ee(I));return this.geometryFactory.createPoint(c)},MultiPoint:function(I){for(var c=[],d=0;d<I.length;++d)c.push(dr.Point.call(this,I[d]));return this.geometryFactory.createMultiPoint(c)},LineString:function(I){var c=dr.coordinates.call(this,I);return this.geometryFactory.createLineString(c)},MultiLineString:function(I){for(var c=[],d=0;d<I.length;++d)c.push(dr.LineString.call(this,I[d]));return this.geometryFactory.createMultiLineString(c)},Polygon:function(I){for(var c=dr.coordinates.call(this,I[0]),d=this.geometryFactory.createLinearRing(c),p=[],b=1;b<I.length;++b){var L=I[b],O=dr.coordinates.call(this,L),V=this.geometryFactory.createLinearRing(O);p.push(V)}return this.geometryFactory.createPolygon(d,p)},MultiPolygon:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(dr.Polygon.call(this,p))}return this.geometryFactory.createMultiPolygon(c)},GeometryCollection:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(this.read(p))}return this.geometryFactory.createGeometryCollection(c)}},ks={coordinate:function(I){var c=[I.x,I.y];return I.z&&c.push(I.z),I.m&&c.push(I.m),c},Point:function(I){return{type:"Point",coordinates:ks.coordinate.call(this,I.getCoordinate())}},MultiPoint:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ks.Point.call(this,p);c.push(b.coordinates)}return{type:"MultiPoint",coordinates:c}},LineString:function(I){for(var c=[],d=I.getCoordinates(),p=0;p<d.length;++p){var b=d[p];c.push(ks.coordinate.call(this,b))}return{type:"LineString",coordinates:c}},MultiLineString:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ks.LineString.call(this,p);c.push(b.coordinates)}return{type:"MultiLineString",coordinates:c}},Polygon:function(I){var c=[],d=ks.LineString.call(this,I._shell);c.push(d.coordinates);for(var p=0;p<I._holes.length;++p){var b=I._holes[p],L=ks.LineString.call(this,b);c.push(L.coordinates)}return{type:"Polygon",coordinates:c}},MultiPolygon:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ks.Polygon.call(this,p);c.push(b.coordinates)}return{type:"MultiPolygon",coordinates:c}},GeometryCollection:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=p.getGeometryType();c.push(ks[b].call(this,p))}return{type:"GeometryCollection",geometries:c}}};return{BufferOp:Zs,GeoJSONReader:function(){function I(c){t(this,I),this.parser=new Ul(c||new is)}return a(I,[{key:"read",value:function(c){return this.parser.read(c)}}]),I}(),GeoJSONWriter:function(){function I(){t(this,I),this.parser=new Ul(this.geometryFactory)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}]),I}()}})})(vv);var Lw=vv.exports;const Mw=Cw(Lw);function Sl(){return new Of}function Of(){this.reset()}Of.prototype={constructor:Of,reset:function(){this.s=this.t=0},add:function(s){h_(yf,s,this.t),h_(this,yf.s,this.s),this.s?this.t+=yf.t:this.s=yf.t},valueOf:function(){return this.s}};var yf=new Of;function h_(s,e,t){var r=s.s=e+t,a=r-e,h=r-a;s.t=e-h+(t-a)}var Bi=1e-6,pi=Math.PI,sa=pi/2,f_=pi/4,oa=pi*2,_l=180/pi,mo=pi/180,Hr=Math.abs,Rw=Math.atan,sc=Math.atan2,rr=Math.cos,sr=Math.sin,fc=Math.sqrt;function bv(s){return s>1?0:s<-1?pi:Math.acos(s)}function su(s){return s>1?sa:s<-1?-sa:Math.asin(s)}function mh(){}function Bf(s,e){s&&p_.hasOwnProperty(s.type)&&p_[s.type](s,e)}var d_={Feature:function(s,e){Bf(s.geometry,e)},FeatureCollection:function(s,e){for(var t=s.features,r=-1,a=t.length;++r<a;)Bf(t[r].geometry,e)}},p_={Sphere:function(s,e){e.sphere()},Point:function(s,e){s=s.coordinates,e.point(s[0],s[1],s[2])},MultiPoint:function(s,e){for(var t=s.coordinates,r=-1,a=t.length;++r<a;)s=t[r],e.point(s[0],s[1],s[2])},LineString:function(s,e){Ip(s.coordinates,e,0)},MultiLineString:function(s,e){for(var t=s.coordinates,r=-1,a=t.length;++r<a;)Ip(t[r],e,0)},Polygon:function(s,e){m_(s.coordinates,e)},MultiPolygon:function(s,e){for(var t=s.coordinates,r=-1,a=t.length;++r<a;)m_(t[r],e)},GeometryCollection:function(s,e){for(var t=s.geometries,r=-1,a=t.length;++r<a;)Bf(t[r],e)}};function Ip(s,e,t){var r=-1,a=s.length-t,h;for(e.lineStart();++r<a;)h=s[r],e.point(h[0],h[1],h[2]);e.lineEnd()}function m_(s,e){var t=-1,r=s.length;for(e.polygonStart();++t<r;)Ip(s[t],e,1);e.polygonEnd()}function Pw(s,e){s&&d_.hasOwnProperty(s.type)?d_[s.type](s,e):Bf(s,e)}Sl();Sl();function Sp(s){return[sc(s[1],s[0]),su(s[2])]}function oc(s){var e=s[0],t=s[1],r=rr(t);return[r*rr(e),r*sr(e),sr(t)]}function vf(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Uf(s,e){return[s[1]*e[2]-s[2]*e[1],s[2]*e[0]-s[0]*e[2],s[0]*e[1]-s[1]*e[0]]}function ap(s,e){s[0]+=e[0],s[1]+=e[1],s[2]+=e[2]}function bf(s,e){return[s[0]*e,s[1]*e,s[2]*e]}function Ep(s){var e=fc(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);s[0]/=e,s[1]/=e,s[2]/=e}Sl();function xv(s,e){function t(r,a){return r=s(r,a),e(r[0],r[1])}return s.invert&&e.invert&&(t.invert=function(r,a){return r=e.invert(r,a),r&&s.invert(r[0],r[1])}),t}function Ap(s,e){return[s>pi?s-oa:s<-pi?s+oa:s,e]}Ap.invert=Ap;function Dw(s,e,t){return(s%=oa)?e||t?xv(__(s),y_(e,t)):__(s):e||t?y_(e,t):Ap}function g_(s){return function(e,t){return e+=s,[e>pi?e-oa:e<-pi?e+oa:e,t]}}function __(s){var e=g_(s);return e.invert=g_(-s),e}function y_(s,e){var t=rr(s),r=sr(s),a=rr(e),h=sr(e);function m(l,x){var S=rr(x),T=rr(l)*S,C=sr(l)*S,N=sr(x),B=N*t+T*r;return[sc(C*a-B*h,T*t-N*r),su(B*a+C*h)]}return m.invert=function(l,x){var S=rr(x),T=rr(l)*S,C=sr(l)*S,N=sr(x),B=N*a-C*h;return[sc(C*a+N*h,T*t+B*r),su(B*t-T*r)]},m}function Nw(s,e,t,r,a,h){if(t){var m=rr(e),l=sr(e),x=r*t;a==null?(a=e+r*oa,h=e-x/2):(a=v_(m,a),h=v_(m,h),(r>0?a<h:a>h)&&(a+=r*oa));for(var S,T=a;r>0?T>h:T<h;T-=x)S=Sp([m,-l*rr(T),-l*sr(T)]),s.point(S[0],S[1])}}function v_(s,e){e=oc(e),e[0]-=s,Ep(e);var t=bv(-e[1]);return((-e[2]<0?-t:t)+oa-Bi)%oa}function wv(){var s=[],e;return{point:function(t,r){e.push([t,r])},lineStart:function(){s.push(e=[])},lineEnd:mh,rejoin:function(){s.length>1&&s.push(s.pop().concat(s.shift()))},result:function(){var t=s;return s=[],e=null,t}}}function zw(s,e,t,r,a,h){var m=s[0],l=s[1],x=e[0],S=e[1],T=0,C=1,N=x-m,B=S-l,U;if(U=t-m,!(!N&&U>0)){if(U/=N,N<0){if(U<T)return;U<C&&(C=U)}else if(N>0){if(U>C)return;U>T&&(T=U)}if(U=a-m,!(!N&&U<0)){if(U/=N,N<0){if(U>C)return;U>T&&(T=U)}else if(N>0){if(U<T)return;U<C&&(C=U)}if(U=r-l,!(!B&&U>0)){if(U/=B,B<0){if(U<T)return;U<C&&(C=U)}else if(B>0){if(U>C)return;U>T&&(T=U)}if(U=h-l,!(!B&&U<0)){if(U/=B,B<0){if(U>C)return;U>T&&(T=U)}else if(B>0){if(U<T)return;U<C&&(C=U)}return T>0&&(s[0]=m+T*N,s[1]=l+T*B),C<1&&(e[0]=m+C*N,e[1]=l+C*B),!0}}}}}function Cf(s,e){return Hr(s[0]-e[0])<Bi&&Hr(s[1]-e[1])<Bi}function xf(s,e,t,r){this.x=s,this.z=e,this.o=t,this.e=r,this.v=!1,this.n=this.p=null}function kv(s,e,t,r,a){var h=[],m=[],l,x;if(s.forEach(function(U){if(!((ee=U.length-1)<=0)){var ee,ie=U[0],ae=U[ee],J;if(Cf(ie,ae)){for(a.lineStart(),l=0;l<ee;++l)a.point((ie=U[l])[0],ie[1]);a.lineEnd();return}h.push(J=new xf(ie,U,null,!0)),m.push(J.o=new xf(ie,null,J,!1)),h.push(J=new xf(ae,U,null,!1)),m.push(J.o=new xf(ae,null,J,!0))}}),!!h.length){for(m.sort(e),b_(h),b_(m),l=0,x=m.length;l<x;++l)m[l].e=t=!t;for(var S=h[0],T,C;;){for(var N=S,B=!0;N.v;)if((N=N.n)===S)return;T=N.z,a.lineStart();do{if(N.v=N.o.v=!0,N.e){if(B)for(l=0,x=T.length;l<x;++l)a.point((C=T[l])[0],C[1]);else r(N.x,N.n.x,1,a);N=N.n}else{if(B)for(T=N.p.z,l=T.length-1;l>=0;--l)a.point((C=T[l])[0],C[1]);else r(N.x,N.p.x,-1,a);N=N.p}N=N.o,T=N.z,B=!B}while(!N.v);a.lineEnd()}}}function b_(s){if(e=s.length){for(var e,t=0,r=s[0],a;++t<e;)r.n=a=s[t],a.p=r,r=a;r.n=a=s[0],a.p=r}}function Iv(s,e){return s<e?-1:s>e?1:s>=e?0:NaN}function Fw(s){return s.length===1&&(s=Ow(s)),{left:function(e,t,r,a){for(r==null&&(r=0),a==null&&(a=e.length);r<a;){var h=r+a>>>1;s(e[h],t)<0?r=h+1:a=h}return r},right:function(e,t,r,a){for(r==null&&(r=0),a==null&&(a=e.length);r<a;){var h=r+a>>>1;s(e[h],t)>0?a=h:r=h+1}return r}}}function Ow(s){return function(e,t){return Iv(s(e),t)}}Fw(Iv);function Sv(s){for(var e=s.length,t,r=-1,a=0,h,m;++r<e;)a+=s[r].length;for(h=new Array(a);--e>=0;)for(m=s[e],t=m.length;--t>=0;)h[--a]=m[t];return h}var gh=1e9,wf=-gh;function Bw(s,e,t,r){function a(S,T){return s<=S&&S<=t&&e<=T&&T<=r}function h(S,T,C,N){var B=0,U=0;if(S==null||(B=m(S,C))!==(U=m(T,C))||x(S,T)<0^C>0)do N.point(B===0||B===3?s:t,B>1?r:e);while((B=(B+C+4)%4)!==U);else N.point(T[0],T[1])}function m(S,T){return Hr(S[0]-s)<Bi?T>0?0:3:Hr(S[0]-t)<Bi?T>0?2:1:Hr(S[1]-e)<Bi?T>0?1:0:T>0?3:2}function l(S,T){return x(S.x,T.x)}function x(S,T){var C=m(S,1),N=m(T,1);return C!==N?C-N:C===0?T[1]-S[1]:C===1?S[0]-T[0]:C===2?S[1]-T[1]:T[0]-S[0]}return function(S){var T=S,C=wv(),N,B,U,ee,ie,ae,J,Y,ge,xe,Ee,ye={point:be,lineStart:_e,lineEnd:tt,polygonStart:Ce,polygonEnd:we};function be(qe,dt){a(qe,dt)&&T.point(qe,dt)}function ve(){for(var qe=0,dt=0,mt=B.length;dt<mt;++dt)for(var ct=B[dt],Ut=1,bt=ct.length,It=ct[0],pt,kt,St=It[0],$t=It[1];Ut<bt;++Ut)pt=St,kt=$t,It=ct[Ut],St=It[0],$t=It[1],kt<=r?$t>r&&(St-pt)*(r-kt)>($t-kt)*(s-pt)&&++qe:$t<=r&&(St-pt)*(r-kt)<($t-kt)*(s-pt)&&--qe;return qe}function Ce(){T=C,N=[],B=[],Ee=!0}function we(){var qe=ve(),dt=Ee&&qe,mt=(N=Sv(N)).length;(dt||mt)&&(S.polygonStart(),dt&&(S.lineStart(),h(null,null,1,S),S.lineEnd()),mt&&kv(N,l,qe,h,S),S.polygonEnd()),T=S,N=B=U=null}function _e(){ye.point=Ve,B&&B.push(U=[]),xe=!0,ge=!1,J=Y=NaN}function tt(){N&&(Ve(ee,ie),ae&&ge&&C.rejoin(),N.push(C.result())),ye.point=be,ge&&T.lineEnd()}function Ve(qe,dt){var mt=a(qe,dt);if(B&&U.push([qe,dt]),xe)ee=qe,ie=dt,ae=mt,xe=!1,mt&&(T.lineStart(),T.point(qe,dt));else if(mt&&ge)T.point(qe,dt);else{var ct=[J=Math.max(wf,Math.min(gh,J)),Y=Math.max(wf,Math.min(gh,Y))],Ut=[qe=Math.max(wf,Math.min(gh,qe)),dt=Math.max(wf,Math.min(gh,dt))];zw(ct,Ut,s,e,t,r)?(ge||(T.lineStart(),T.point(ct[0],ct[1])),T.point(Ut[0],Ut[1]),mt||T.lineEnd(),Ee=!1):mt&&(T.lineStart(),T.point(qe,dt),Ee=!1)}J=qe,Y=dt,ge=mt}return ye}}var lp=Sl();function Uw(s,e){var t=e[0],r=e[1],a=[sr(t),-rr(t),0],h=0,m=0;lp.reset();for(var l=0,x=s.length;l<x;++l)if(T=(S=s[l]).length)for(var S,T,C=S[T-1],N=C[0],B=C[1]/2+f_,U=sr(B),ee=rr(B),ie=0;ie<T;++ie,N=J,U=ge,ee=xe,C=ae){var ae=S[ie],J=ae[0],Y=ae[1]/2+f_,ge=sr(Y),xe=rr(Y),Ee=J-N,ye=Ee>=0?1:-1,be=ye*Ee,ve=be>pi,Ce=U*ge;if(lp.add(sc(Ce*ye*sr(be),ee*xe+Ce*rr(be))),h+=ve?Ee+ye*oa:Ee,ve^N>=t^J>=t){var we=Uf(oc(C),oc(ae));Ep(we);var _e=Uf(a,we);Ep(_e);var tt=(ve^Ee>=0?-1:1)*su(_e[2]);(r>tt||r===tt&&(we[0]||we[1]))&&(m+=ve^Ee>=0?1:-1)}}return(h<-Bi||h<Bi&&lp<-Bi)^m&1}Sl();function x_(s){return s}Sl();Sl();var ac=1/0,jf=ac,Mh=-ac,qf=Mh,w_={point:jw,lineStart:mh,lineEnd:mh,polygonStart:mh,polygonEnd:mh,result:function(){var s=[[ac,jf],[Mh,qf]];return Mh=qf=-(jf=ac=1/0),s}};function jw(s,e){s<ac&&(ac=s),s>Mh&&(Mh=s),e<jf&&(jf=e),e>qf&&(qf=e)}Sl();function Ev(s,e,t,r){return function(a,h){var m=e(h),l=a.invert(r[0],r[1]),x=wv(),S=e(x),T=!1,C,N,B,U={point:ee,lineStart:ae,lineEnd:J,polygonStart:function(){U.point=Y,U.lineStart=ge,U.lineEnd=xe,N=[],C=[]},polygonEnd:function(){U.point=ee,U.lineStart=ae,U.lineEnd=J,N=Sv(N);var Ee=Uw(C,l);N.length?(T||(h.polygonStart(),T=!0),kv(N,Vw,Ee,t,h)):Ee&&(T||(h.polygonStart(),T=!0),h.lineStart(),t(null,null,1,h),h.lineEnd()),T&&(h.polygonEnd(),T=!1),N=C=null},sphere:function(){h.polygonStart(),h.lineStart(),t(null,null,1,h),h.lineEnd(),h.polygonEnd()}};function ee(Ee,ye){var be=a(Ee,ye);s(Ee=be[0],ye=be[1])&&h.point(Ee,ye)}function ie(Ee,ye){var be=a(Ee,ye);m.point(be[0],be[1])}function ae(){U.point=ie,m.lineStart()}function J(){U.point=ee,m.lineEnd()}function Y(Ee,ye){B.push([Ee,ye]);var be=a(Ee,ye);S.point(be[0],be[1])}function ge(){S.lineStart(),B=[]}function xe(){Y(B[0][0],B[0][1]),S.lineEnd();var Ee=S.clean(),ye=x.result(),be,ve=ye.length,Ce,we,_e;if(B.pop(),C.push(B),B=null,!!ve){if(Ee&1){if(we=ye[0],(Ce=we.length-1)>0){for(T||(h.polygonStart(),T=!0),h.lineStart(),be=0;be<Ce;++be)h.point((_e=we[be])[0],_e[1]);h.lineEnd()}return}ve>1&&Ee&2&&ye.push(ye.pop().concat(ye.shift())),N.push(ye.filter(qw))}}return U}}function qw(s){return s.length>1}function Vw(s,e){return((s=s.x)[0]<0?s[1]-sa-Bi:sa-s[1])-((e=e.x)[0]<0?e[1]-sa-Bi:sa-e[1])}const k_=Ev(function(){return!0},Gw,Hw,[-pi,-sa]);function Gw(s){var e=NaN,t=NaN,r=NaN,a;return{lineStart:function(){s.lineStart(),a=1},point:function(h,m){var l=h>0?pi:-pi,x=Hr(h-e);Hr(x-pi)<Bi?(s.point(e,t=(t+m)/2>0?sa:-sa),s.point(r,t),s.lineEnd(),s.lineStart(),s.point(l,t),s.point(h,t),a=0):r!==l&&x>=pi&&(Hr(e-r)<Bi&&(e-=r*Bi),Hr(h-l)<Bi&&(h-=l*Bi),t=Zw(e,t,h,m),s.point(r,t),s.lineEnd(),s.lineStart(),s.point(l,t),a=0),s.point(e=h,t=m),r=l},lineEnd:function(){s.lineEnd(),e=t=NaN},clean:function(){return 2-a}}}function Zw(s,e,t,r){var a,h,m=sr(s-t);return Hr(m)>Bi?Rw((sr(e)*(h=rr(r))*sr(t)-sr(r)*(a=rr(e))*sr(s))/(a*h*m)):(e+r)/2}function Hw(s,e,t,r){var a;if(s==null)a=t*sa,r.point(-pi,a),r.point(0,a),r.point(pi,a),r.point(pi,0),r.point(pi,-a),r.point(0,-a),r.point(-pi,-a),r.point(-pi,0),r.point(-pi,a);else if(Hr(s[0]-e[0])>Bi){var h=s[0]<e[0]?pi:-pi;a=t*h/2,r.point(-h,a),r.point(0,a),r.point(h,a)}else r.point(e[0],e[1])}function Xw(s,e){var t=rr(s),r=t>0,a=Hr(t)>Bi;function h(T,C,N,B){Nw(B,s,e,N,T,C)}function m(T,C){return rr(T)*rr(C)>t}function l(T){var C,N,B,U,ee;return{lineStart:function(){U=B=!1,ee=1},point:function(ie,ae){var J=[ie,ae],Y,ge=m(ie,ae),xe=r?ge?0:S(ie,ae):ge?S(ie+(ie<0?pi:-pi),ae):0;if(!C&&(U=B=ge)&&T.lineStart(),ge!==B&&(Y=x(C,J),(!Y||Cf(C,Y)||Cf(J,Y))&&(J[0]+=Bi,J[1]+=Bi,ge=m(J[0],J[1]))),ge!==B)ee=0,ge?(T.lineStart(),Y=x(J,C),T.point(Y[0],Y[1])):(Y=x(C,J),T.point(Y[0],Y[1]),T.lineEnd()),C=Y;else if(a&&C&&r^ge){var Ee;!(xe&N)&&(Ee=x(J,C,!0))&&(ee=0,r?(T.lineStart(),T.point(Ee[0][0],Ee[0][1]),T.point(Ee[1][0],Ee[1][1]),T.lineEnd()):(T.point(Ee[1][0],Ee[1][1]),T.lineEnd(),T.lineStart(),T.point(Ee[0][0],Ee[0][1])))}ge&&(!C||!Cf(C,J))&&T.point(J[0],J[1]),C=J,B=ge,N=xe},lineEnd:function(){B&&T.lineEnd(),C=null},clean:function(){return ee|(U&&B)<<1}}}function x(T,C,N){var B=oc(T),U=oc(C),ee=[1,0,0],ie=Uf(B,U),ae=vf(ie,ie),J=ie[0],Y=ae-J*J;if(!Y)return!N&&T;var ge=t*ae/Y,xe=-t*J/Y,Ee=Uf(ee,ie),ye=bf(ee,ge),be=bf(ie,xe);ap(ye,be);var ve=Ee,Ce=vf(ye,ve),we=vf(ve,ve),_e=Ce*Ce-we*(vf(ye,ye)-1);if(!(_e<0)){var tt=fc(_e),Ve=bf(ve,(-Ce-tt)/we);if(ap(Ve,ye),Ve=Sp(Ve),!N)return Ve;var qe=T[0],dt=C[0],mt=T[1],ct=C[1],Ut;dt<qe&&(Ut=qe,qe=dt,dt=Ut);var bt=dt-qe,It=Hr(bt-pi)<Bi,pt=It||bt<Bi;if(!It&&ct<mt&&(Ut=mt,mt=ct,ct=Ut),pt?It?mt+ct>0^Ve[1]<(Hr(Ve[0]-qe)<Bi?mt:ct):mt<=Ve[1]&&Ve[1]<=ct:bt>pi^(qe<=Ve[0]&&Ve[0]<=dt)){var kt=bf(ve,(-Ce+tt)/we);return ap(kt,ye),[Ve,Sp(kt)]}}}function S(T,C){var N=r?s:pi-s,B=0;return T<-N?B|=1:T>N&&(B|=2),C<-N?B|=4:C>N&&(B|=8),B}return Ev(m,l,h,r?[0,-s]:[-pi,s-pi])}function Av(s){return function(e){var t=new Tp;for(var r in s)t[r]=s[r];return t.stream=e,t}}function Tp(){}Tp.prototype={constructor:Tp,point:function(s,e){this.stream.point(s,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Tv(s,e,t){var r=e[1][0]-e[0][0],a=e[1][1]-e[0][1],h=s.clipExtent&&s.clipExtent();s.scale(150).translate([0,0]),h!=null&&s.clipExtent(null),Pw(t,s.stream(w_));var m=w_.result(),l=Math.min(r/(m[1][0]-m[0][0]),a/(m[1][1]-m[0][1])),x=+e[0][0]+(r-l*(m[1][0]+m[0][0]))/2,S=+e[0][1]+(a-l*(m[1][1]+m[0][1]))/2;return h!=null&&s.clipExtent(h),s.scale(l*150).translate([x,S])}function Ww(s,e,t){return Tv(s,[[0,0],e],t)}var I_=16,Kw=rr(30*mo);function S_(s,e){return+e?Yw(s,e):$w(s)}function $w(s){return Av({point:function(e,t){e=s(e,t),this.stream.point(e[0],e[1])}})}function Yw(s,e){function t(r,a,h,m,l,x,S,T,C,N,B,U,ee,ie){var ae=S-r,J=T-a,Y=ae*ae+J*J;if(Y>4*e&&ee--){var ge=m+N,xe=l+B,Ee=x+U,ye=fc(ge*ge+xe*xe+Ee*Ee),be=su(Ee/=ye),ve=Hr(Hr(Ee)-1)<Bi||Hr(h-C)<Bi?(h+C)/2:sc(xe,ge),Ce=s(ve,be),we=Ce[0],_e=Ce[1],tt=we-r,Ve=_e-a,qe=J*tt-ae*Ve;(qe*qe/Y>e||Hr((ae*tt+J*Ve)/Y-.5)>.3||m*N+l*B+x*U<Kw)&&(t(r,a,h,m,l,x,we,_e,ve,ge/=ye,xe/=ye,Ee,ee,ie),ie.point(we,_e),t(we,_e,ve,ge,xe,Ee,S,T,C,N,B,U,ee,ie))}}return function(r){var a,h,m,l,x,S,T,C,N,B,U,ee,ie={point:ae,lineStart:J,lineEnd:ge,polygonStart:function(){r.polygonStart(),ie.lineStart=xe},polygonEnd:function(){r.polygonEnd(),ie.lineStart=J}};function ae(be,ve){be=s(be,ve),r.point(be[0],be[1])}function J(){C=NaN,ie.point=Y,r.lineStart()}function Y(be,ve){var Ce=oc([be,ve]),we=s(be,ve);t(C,N,T,B,U,ee,C=we[0],N=we[1],T=be,B=Ce[0],U=Ce[1],ee=Ce[2],I_,r),r.point(C,N)}function ge(){ie.point=ae,r.lineEnd()}function xe(){J(),ie.point=Ee,ie.lineEnd=ye}function Ee(be,ve){Y(a=be,ve),h=C,m=N,l=B,x=U,S=ee,ie.point=Y}function ye(){t(C,N,T,B,U,ee,h,m,a,l,x,S,I_,r),ie.lineEnd=ge,ge()}return ie}}var Jw=Av({point:function(s,e){this.stream.point(s*mo,e*mo)}});function Qw(s){return e2(function(){return s})()}function e2(s){var e,t=150,r=480,a=250,h,m,l=0,x=0,S=0,T=0,C=0,N,B,U=null,ee=k_,ie=null,ae,J,Y,ge=x_,xe=.5,Ee=S_(we,xe),ye,be;function ve(Ve){return Ve=B(Ve[0]*mo,Ve[1]*mo),[Ve[0]*t+h,m-Ve[1]*t]}function Ce(Ve){return Ve=B.invert((Ve[0]-h)/t,(m-Ve[1])/t),Ve&&[Ve[0]*_l,Ve[1]*_l]}function we(Ve,qe){return Ve=e(Ve,qe),[Ve[0]*t+h,m-Ve[1]*t]}ve.stream=function(Ve){return ye&&be===Ve?ye:ye=Jw(ee(N,Ee(ge(be=Ve))))},ve.clipAngle=function(Ve){return arguments.length?(ee=+Ve?Xw(U=Ve*mo,6*mo):(U=null,k_),tt()):U*_l},ve.clipExtent=function(Ve){return arguments.length?(ge=Ve==null?(ie=ae=J=Y=null,x_):Bw(ie=+Ve[0][0],ae=+Ve[0][1],J=+Ve[1][0],Y=+Ve[1][1]),tt()):ie==null?null:[[ie,ae],[J,Y]]},ve.scale=function(Ve){return arguments.length?(t=+Ve,_e()):t},ve.translate=function(Ve){return arguments.length?(r=+Ve[0],a=+Ve[1],_e()):[r,a]},ve.center=function(Ve){return arguments.length?(l=Ve[0]%360*mo,x=Ve[1]%360*mo,_e()):[l*_l,x*_l]},ve.rotate=function(Ve){return arguments.length?(S=Ve[0]%360*mo,T=Ve[1]%360*mo,C=Ve.length>2?Ve[2]%360*mo:0,_e()):[S*_l,T*_l,C*_l]},ve.precision=function(Ve){return arguments.length?(Ee=S_(we,xe=Ve*Ve),tt()):fc(xe)},ve.fitExtent=function(Ve,qe){return Tv(ve,Ve,qe)},ve.fitSize=function(Ve,qe){return Ww(ve,Ve,qe)};function _e(){B=xv(N=Dw(S,T,C),e);var Ve=e(l,x);return h=r-Ve[0]*t,m=a+Ve[1]*t,tt()}function tt(){return ye=be=null,ve}return function(){return e=s.apply(this,arguments),ve.invert=e.invert&&Ce,_e()}}function Cv(s){return function(e,t){var r=rr(e),a=rr(t),h=s(r*a);return[h*a*sr(e),h*sr(t)]}}function Lv(s){return function(e,t){var r=fc(e*e+t*t),a=s(r),h=sr(a),m=rr(a);return[sc(e*h,r*m),su(r&&t*h/r)]}}var t2=Cv(function(s){return fc(2/(1+s))});t2.invert=Lv(function(s){return 2*su(s/2)});var Mv=Cv(function(s){return(s=bv(s))&&s/sr(s)});Mv.invert=Lv(function(s){return s});function n2(){return Qw(Mv).scale(79.4188).clipAngle(180-.001)}function E_(s,e){return[s,e]}E_.invert=E_;var{BufferOp:i2,GeoJSONReader:r2,GeoJSONWriter:s2}=Mw;function o2(s,e,t){t=t||{};var r=t.units||"kilometers",a=t.steps||8;if(!s)throw new Error("geojson is required");if(typeof t!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var h=[];switch(s.type){case"GeometryCollection":return id(s,function(m){var l=Lf(m,e,r,a);l&&h.push(l)}),ru(h);case"FeatureCollection":return c_(s,function(m){var l=Lf(m,e,r,a);l&&c_(l,function(x){x&&h.push(x)})}),ru(h)}return Lf(s,e,r,a)}function Lf(s,e,t,r){var a=s.properties||{},h=s.type==="Feature"?s.geometry:s;if(h.type==="GeometryCollection"){var m=[];return id(s,function(ee){var ie=Lf(ee,e,t,r);ie&&m.push(ie)}),ru(m)}var l=a2(h),x={type:h.type,coordinates:Pv(h.coordinates,l)},S=new r2,T=S.read(x),C=Wx(Kx(e,t),"meters"),N=i2.bufferOp(T,C,r),B=new s2;if(N=B.write(N),!Rv(N.coordinates)){var U={type:N.type,coordinates:Dv(N.coordinates,l)};return zh(U,a)}}function Rv(s){return Array.isArray(s[0])?Rv(s[0]):isNaN(s[0])}function Pv(s,e){return typeof s[0]!="object"?e(s):s.map(function(t){return Pv(t,e)})}function Dv(s,e){return typeof s[0]!="object"?e.invert(s):s.map(function(t){return Dv(t,e)})}function a2(s){var e=Aw(s).geometry.coordinates,t=[-e[0],-e[1]];return n2().rotate(t).scale(js)}var l2=o2;function u2(s){const e=[];if(id(s,a=>{e.push(a.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=s.features[0].properties||{},r=_v.difference(e[0],...e.slice(1));return r.length===0?null:r.length===1?Zp(r[0],t):mv(r,t)}var c2=u2;function A_(s){let e;for(const t of s)e&&t[0]-e[0]>=180?t[0]-=360:e&&t[0]-e[0]<-180&&(t[0]+=360),e=t}function T_(s,e){const t=c2(ru([Zp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),s]));if(!t)return;t.properties={isMask:"y"};const r=l2(s,0);if(r){if(r.geometry.type==="Polygon")for(const a of r.geometry.coordinates)A_(a);else for(const a of r.geometry.coordinates)for(const h of a)A_(h);e(ru([r,t]))}}const C_=ru([]);function h2(s,e,t=!0,r=!0,a={},h={},m={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let l;const x=[];let S,T,C;function N(){!s.getSource("full-geom")&&(m!=null&&m.fill||m!=null&&m.line)&&s.addSource("full-geom",{type:"geojson",data:C_}),!s.getLayer("full-geom-fill")&&m!=null&&m.fill&&s.addLayer({...m==null?void 0:m.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),!s.getLayer("full-geom-line")&&m!=null&&m.line&&s.addLayer({...m==null?void 0:m.line,id:"full-geom-line",type:"line",source:"full-geom"}),C&&ee(C)}s.loaded()?N():s.once("load",()=>{N()}),s.on("styledata",()=>{N()});const B=ie=>{l==null||l({type:"mapClick",coordinates:[ie.lngLat.lng,ie.lngLat.lat]})};function U(ie=!1){if(!e)throw new Error;const ae=document.createElement("div");return ie&&ae.classList.add("marker-interactive"),new Ux({props:{displayIn:"maplibre"},target:ae}),new e.Marker({element:ae,offset:[1,-13]})}function ee(ie){var ae;C=ie,(ae=s.getSource("full-geom"))==null||ae.setData(ie)}return{setEventHandler(ie){ie?(l=ie,s.on("click",B)):(l=void 0,s.off("click",B))},flyTo(ie,ae){s.flyTo({center:ie,zoom:ae,...a})},fitBounds(ie,ae,J){s.fitBounds([[ie[0],ie[1]],[ie[2],ie[3]]],{padding:ae,maxZoom:J,...h})},indicateReverse(ie){s.getCanvasContainer().style.cursor=ie?"crosshair":""},setReverseMarker(ie){!e||!t||(T?ie?T.setLngLat(ie):(T.remove(),T=void 0):ie&&(T=(typeof t=="object"?new e.Marker(t):U()).setLngLat(ie).addTo(s),T.getElement().classList.add("marker-reverse")))},setMarkers(ie,ae){if(t){for(const J of x)J.remove();if(x.length=0,ee(C_),!!e){if(ae){let J=!1;if(ae.geometry.type==="GeometryCollection"){const Y=ae.geometry.geometries.filter(ge=>ge.type==="Polygon"||ge.type==="MultiPolygon");e:if(Y.length>0){const ge=Sw(ru(Y.map(xe=>zh(xe))));if(!ge)break e;T_({...ae,geometry:ge.geometry},ee),J=!0}else{const ge=ae.geometry.geometries.filter(xe=>xe.type==="LineString"||xe.type==="MultiLineString");ge.length>0&&(ee({...ae,geometry:{type:"GeometryCollection",geometries:ge}}),J=!0)}}if(!J){if(ae.geometry.type==="Polygon"||ae.geometry.type==="MultiPolygon")T_(ae,ee);else if(ae.geometry.type==="LineString"||ae.geometry.type==="MultiLineString"){ee(ae);return}}t&&x.push((typeof t=="object"?new e.Marker(t):U()).setLngLat(ae.center).addTo(s))}if(r)for(const J of ie??[]){if(J===ae)continue;const Y=(typeof r=="object"?new e.Marker(r):U(!0)).setLngLat(J.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(J.place_type[0]==="reverse"?J.place_name:J.place_name.replace(/,.*/,""))).addTo(s),ge=Y.getElement();ge.addEventListener("click",xe=>{xe.stopPropagation(),l==null||l({type:"markerClick",id:J.id})}),ge.addEventListener("mouseenter",()=>{l==null||l({type:"markerMouseEnter",id:J.id}),Y.togglePopup()}),ge.addEventListener("mouseleave",()=>{l==null||l({type:"markerMouseLeave",id:J.id}),Y.togglePopup()}),x.push(Y)}}}},setSelectedMarker(ie){S&&S.getElement().classList.toggle("marker-selected",!1),S=ie>-1?x[ie]:void 0,S==null||S.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const ie=s.getCenter();return[s.getZoom(),ie.lng,ie.lat]}}}function f2(s){let e,t;return{c(){e=za("svg"),t=za("path"),Ze(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ze(e,"viewBox","0 0 14 14"),Ze(e,"width","13"),Ze(e,"height","13"),Ze(e,"class","svelte-en2qvf")},m(r,a){se(r,e,a),G(e,t)},p:Je,i:Je,o:Je,d(r){r&&re(e)}}}class Nv extends fn{constructor(e){super(),hn(this,e,null,f2,on,{})}}function d2(s){let e,t;return{c(){e=za("svg"),t=za("path"),Ze(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ze(e,"viewBox","0 0 30 30"),Ze(e,"fill","none"),Ze(e,"xmlns","http://www.w3.org/2000/svg"),Ze(e,"class","svelte-d2loi5")},m(r,a){se(r,e,a),G(e,t)},p:Je,i:Je,o:Je,d(r){r&&re(e)}}}class zv extends fn{constructor(e){super(),hn(this,e,null,d2,on,{})}}function p2(s){let e,t;return{c(){e=le("img"),ts(e.src,t=s[3]+"area.svg")||Ze(e,"src",t),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){se(r,e,a)},p(r,a){a&8&&!ts(e.src,t=r[3]+"area.svg")&&Ze(e,"src",t),a&64&&Ze(e,"alt",r[6])},d(r){r&&re(e)}}}function m2(s){let e,t;return{c(){e=le("img"),ts(e.src,t=s[3]+"reverse.svg")||Ze(e,"src",t),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){se(r,e,a)},p(r,a){a&8&&!ts(e.src,t=r[3]+"reverse.svg")&&Ze(e,"src",t),a&64&&Ze(e,"alt",r[6])},d(r){r&&re(e)}}}function g2(s){let e,t;return{c(){e=le("img"),ts(e.src,t=s[3]+"poi.svg")||Ze(e,"src",t),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){se(r,e,a)},p(r,a){a&8&&!ts(e.src,t=r[3]+"poi.svg")&&Ze(e,"src",t),a&64&&Ze(e,"alt",r[6])},d(r){r&&re(e)}}}function _2(s){let e,t;return{c(){e=le("img"),ts(e.src,t=s[3]+"postal_code.svg")||Ze(e,"src",t),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){se(r,e,a)},p(r,a){a&8&&!ts(e.src,t=r[3]+"postal_code.svg")&&Ze(e,"src",t),a&64&&Ze(e,"alt",r[6])},d(r){r&&re(e)}}}function y2(s){let e,t;return{c(){e=le("img"),ts(e.src,t=s[3]+"street.svg")||Ze(e,"src",t),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){se(r,e,a)},p(r,a){a&8&&!ts(e.src,t=r[3]+"street.svg")&&Ze(e,"src",t),a&64&&Ze(e,"alt",r[6])},d(r){r&&re(e)}}}function v2(s){let e,t;return{c(){e=le("img"),ts(e.src,t=s[3]+"road.svg")||Ze(e,"src",t),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){se(r,e,a)},p(r,a){a&8&&!ts(e.src,t=r[3]+"road.svg")&&Ze(e,"src",t),a&64&&Ze(e,"alt",r[6])},d(r){r&&re(e)}}}function b2(s){let e,t;return{c(){e=le("img"),ts(e.src,t=s[3]+"housenumber.svg")||Ze(e,"src",t),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){se(r,e,a)},p(r,a){a&8&&!ts(e.src,t=r[3]+"housenumber.svg")&&Ze(e,"src",t),a&64&&Ze(e,"alt",r[6])},d(r){r&&re(e)}}}function x2(s){let e,t,r,a;return{c(){e=le("img"),ts(e.src,t=s[5])||Ze(e,"src",t),Ze(e,"alt",s[4]),Ze(e,"class","svelte-ltkwvy")},m(h,m){se(h,e,m),r||(a=Mt(e,"error",s[14]),r=!0)},p(h,m){m&32&&!ts(e.src,t=h[5])&&Ze(e,"src",t),m&16&&Ze(e,"alt",h[4])},d(h){h&&re(e),r=!1,a()}}}function L_(s){let e,t;return{c(){e=le("span"),t=ze(s[6]),Ze(e,"class","secondary svelte-ltkwvy")},m(r,a){se(r,e,a),G(e,t)},p(r,a){a&64&&Ct(t,r[6])},d(r){r&&re(e)}}}function w2(s){var ye,be;let e,t,r,a,h,m,l,x,S=(s[7]?s[0].place_name:s[0].place_name.replace(/,.*/,""))+"",T,C,N=s[2]==="always"||s[2]&&!s[0].address&&((ye=s[0].properties)==null?void 0:ye.kind)!=="road"&&((be=s[0].properties)==null?void 0:be.kind)!=="road_relation"&&!s[0].id.startsWith("address.")&&!s[0].id.startsWith("postal_code.")&&(!s[0].id.startsWith("poi.")||!s[5])&&!s[7],B,U,ee=(s[7]?"":s[0].place_name.replace(/[^,]*,?\s*/,""))+"",ie,ae,J;function Y(ve,Ce){var we,_e;return Ce&1&&(t=null),Ce&1&&(r=null),Ce&1&&(a=null),ve[5]?x2:ve[0].address?b2:((we=ve[0].properties)==null?void 0:we.kind)==="road"||((_e=ve[0].properties)==null?void 0:_e.kind)==="road_relation"?v2:(t==null&&(t=!!ve[0].id.startsWith("address.")),t?y2:(r==null&&(r=!!ve[0].id.startsWith("postal_code.")),r?_2:(a==null&&(a=!!ve[0].id.startsWith("poi.")),a?g2:ve[7]?m2:p2)))}let ge=Y(s,-1),xe=ge(s),Ee=N&&L_(s);return{c(){e=le("li"),xe.c(),h=Oe(),m=le("span"),l=le("span"),x=le("span"),T=ze(S),C=Oe(),Ee&&Ee.c(),B=Oe(),U=le("span"),ie=ze(ee),Ze(x,"class","primary svelte-ltkwvy"),Ze(l,"class","svelte-ltkwvy"),Ze(U,"class","line2 svelte-ltkwvy"),Ze(m,"class","texts svelte-ltkwvy"),Ze(e,"tabindex","0"),Ze(e,"data-selected",s[1]),Ze(e,"class","svelte-ltkwvy"),Er(e,"selected",s[1])},m(ve,Ce){se(ve,e,Ce),xe.m(e,null),G(e,h),G(e,m),G(m,l),G(l,x),G(x,T),G(l,C),Ee&&Ee.m(l,null),G(m,B),G(m,U),G(U,ie),ae||(J=[Mt(e,"mouseenter",s[12]),Mt(e,"focus",s[13])],ae=!0)},p(ve,[Ce]){var we,_e;ge===(ge=Y(ve,Ce))&&xe?xe.p(ve,Ce):(xe.d(1),xe=ge(ve),xe&&(xe.c(),xe.m(e,h))),Ce&1&&S!==(S=(ve[7]?ve[0].place_name:ve[0].place_name.replace(/,.*/,""))+"")&&Ct(T,S),Ce&37&&(N=ve[2]==="always"||ve[2]&&!ve[0].address&&((we=ve[0].properties)==null?void 0:we.kind)!=="road"&&((_e=ve[0].properties)==null?void 0:_e.kind)!=="road_relation"&&!ve[0].id.startsWith("address.")&&!ve[0].id.startsWith("postal_code.")&&(!ve[0].id.startsWith("poi.")||!ve[5])&&!ve[7]),N?Ee?Ee.p(ve,Ce):(Ee=L_(ve),Ee.c(),Ee.m(l,null)):Ee&&(Ee.d(1),Ee=null),Ce&1&&ee!==(ee=(ve[7]?"":ve[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ct(ie,ee),Ce&2&&Ze(e,"data-selected",ve[1]),Ce&2&&Er(e,"selected",ve[1])},i:Je,o:Je,d(ve){ve&&re(e),xe.d(),Ee&&Ee.d(),ae=!1,Ji(J)}}}function k2(s,e,t){var Y;let r,a,{feature:h}=e,{selected:m=!1}=e,{showPlaceType:l}=e,{missingIconsCache:x}=e,{iconsBaseUrl:S}=e;const T=(Y=h.properties)==null?void 0:Y.categories;let C,N,B=0,U=h.place_type[0]==="reverse";function ee(){N&&x.add(N),t(10,B++,B)}function ie(ge){ur.call(this,s,ge)}function ae(ge){ur.call(this,s,ge)}const J=()=>ee();return s.$$set=ge=>{"feature"in ge&&t(0,h=ge.feature),"selected"in ge&&t(1,m=ge.selected),"showPlaceType"in ge&&t(2,l=ge.showPlaceType),"missingIconsCache"in ge&&t(9,x=ge.missingIconsCache),"iconsBaseUrl"in ge&&t(3,S=ge.iconsBaseUrl)},s.$$.update=()=>{var ge,xe,Ee,ye;if(s.$$.dirty&3640)do t(11,r--,r),t(4,C=T==null?void 0:T[r]),t(5,N=C?S+C.replace(/ /g,"_")+".svg":void 0);while(r>-1&&(!N||x.has(N)));s.$$.dirty&1&&t(6,a=h.id.startsWith("poi.")?(xe=(ge=h.properties)==null?void 0:ge.categories)==null?void 0:xe.join(", "):((ye=(Ee=h.properties)==null?void 0:Ee.place_type_name)==null?void 0:ye[0])??h.place_type[0])},t(11,r=(T==null?void 0:T.length)??0),[h,m,l,S,C,N,a,U,ee,x,B,r,ie,ae,J]}class I2 extends fn{constructor(e){super(),hn(this,e,k2,w2,on,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function S2(s){let e;return{c(){e=le("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ze(e,"class","svelte-7cmwmc")},m(t,r){se(t,e,r)},p:Je,i:Je,o:Je,d(t){t&&re(e)}}}class E2 extends fn{constructor(e){super(),hn(this,e,null,S2,on,{})}}function A2(s){let e,t;return{c(){e=za("svg"),t=za("path"),Ze(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ze(e,"viewBox","0 0 60.006 21.412"),Ze(e,"width","14"),Ze(e,"height","20"),Ze(e,"class","svelte-en2qvf")},m(r,a){se(r,e,a),G(e,t)},p:Je,i:Je,o:Je,d(r){r&&re(e)}}}class T2 extends fn{constructor(e){super(),hn(this,e,null,A2,on,{})}}function C2(s){let e,t,r;return{c(){e=za("svg"),t=za("circle"),r=za("path"),Ze(t,"cx","4.789"),Ze(t,"cy","4.787"),Ze(t,"r","3.85"),Ze(t,"class","svelte-1aq105l"),Ze(r,"d","M12.063 12.063 7.635 7.635"),Ze(r,"class","svelte-1aq105l"),Ze(e,"xmlns","http://www.w3.org/2000/svg"),Ze(e,"width","13"),Ze(e,"height","13"),Ze(e,"viewBox","0 0 13 13"),Ze(e,"class","svelte-1aq105l")},m(a,h){se(a,e,h),G(e,t),G(e,r)},p:Je,i:Je,o:Je,d(a){a&&re(e)}}}class L2 extends fn{constructor(e){super(),hn(this,e,null,C2,on,{})}}function M2(s,e,t){const r=e[1],a=e[0],h=r-a;return s===r&&t?s:((s-a)%h+h)%h+a}function M_(s){const e=[...s];return e[2]<e[0]&&(e[2]+=360),e}let ch;async function R2(s,e,t){const r=s==null?void 0:s.getCenterAndZoom();for(const a of e??[])if(!(r&&(a.minZoom!=null&&a.minZoom>r[0]||a.maxZoom!=null&&a.maxZoom<r[0]))){if(a.type==="fixed")return a.coordinates.join(",");e:if(a.type==="client-geolocation"){if(ch&&a.cachedLocationExpiry&&ch.time+a.cachedLocationExpiry>Date.now()){if(!ch.coords)break e;return ch.coords}let h;try{return h=await new Promise((m,l)=>{t.signal.addEventListener("abort",()=>{l(Error("aborted"))}),navigator.geolocation.getCurrentPosition(x=>{m([x.coords.longitude,x.coords.latitude].map(S=>S.toFixed(6)).join(","))},x=>{l(x)},a)}),h}catch{}finally{a.cachedLocationExpiry&&(ch={time:Date.now(),coords:h})}if(t.signal.aborted)return}if(a.type==="server-geolocation")return"ip";if(r&&a.type==="map-center")return r[1].toFixed(6)+","+r[2].toFixed(6)}}const P2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,R_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,P_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,D_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,N_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,z_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function D2(s){if(!["DMS","DM","DD"].includes(s))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(B=>Number(B.trim())),t=Number(e[0]),r=Number(e[1]),a=Math.abs(t),h=Math.abs(r),m=t>0?"N":"S",l=r>0?"E":"W";let x;s=="DD"&&(x=`${a} ${m}, ${h} ${l}`);const S=Math.floor(a),T=Math.floor(h),C=(a-S)*60,N=(h-T)*60;if(s=="DM"){let B=F_(C,3).toFixed(3).padStart(6,"0"),U=F_(N,3).toFixed(3).padStart(6,"0");B.endsWith(".000")&&U.endsWith(".000")&&(B=B.replace(/\.000$/,""),U=U.replace(/\.000$/,"")),x=`${S} ${B}' ${m}, ${T} ${U}' ${l}`}if(s=="DMS"){const B=Math.floor(C),U=Math.floor(N);let ee=((C-B)*60).toFixed(1).padStart(4,"0"),ie=((N-U)*60).toFixed(1).padStart(4,"0");const ae=B.toString().padStart(2,"0"),J=U.toString().padStart(2,"0");ee.endsWith(".0")&&ie.endsWith(".0")&&(ee=ee.replace(/\.0$/,""),ie=ie.replace(/\.0$/,"")),x=`${S} ${ae}' ${ee}" ${m}, ${T} ${J}' ${ie}" ${l}`}return x}else throw new Error("no decimal coordinates to convert")}function F_(s,e){const t=Math.pow(10,e);return Math.round((s+Number.EPSILON)*t)/t}function Xp(s,e){e||(e=5),s=s.replace(/\s+/g," ").trim();let t=null,r=null,a="",h="",m=null,l=[],x=!1;if(P2.test(s))throw new Error("invalid coordinate value");if(R_.test(s))if(l=R_.exec(s),x=hh(l),x)t=Math.abs(l[1])+l[2]/60,Number(l[1])<0&&(t*=-1),r=Math.abs(l[3])+l[4]/60,Number(l[3])<0&&(r*=-1),m="DM";else throw new Error("invalid coordinate format");else if(P_.test(s))if(l=P_.exec(s),x=hh(l),x){if(t=l[2],r=l[6],t.includes(",")&&(t=t.replace(",",".")),r.includes(",")&&(r=r.replace(",",".")),m="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");l[1]?(a=l[1],h=l[5]):l[4]&&(a=l[4],h=l[8])}else throw new Error("invalid decimal coordinate format");else if(D_.test(s))if(l=D_.exec(s),x=hh(l),x)t=Math.abs(parseInt(l[2])),l[4]&&(t+=l[4]/60,m="DM"),l[6]&&(t+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(t=-1*t),r=Math.abs(parseInt(l[9])),l[11]&&(r+=l[11]/60),l[13]&&(r+=l[13].replace(",",".")/3600),parseInt(l[9])<0&&(r=-1*r),l[1]?(a=l[1],h=l[8]):l[7]&&(a=l[7],h=l[14]);else throw new Error("invalid DMS coordinates format");else if(N_.test(s))if(l=N_.exec(s),x=hh(l),x)t=Math.abs(parseInt(l[2])),l[4]&&(t+=l[4]/60,m="DM"),l[6]&&(t+=l[6]/3600,m="DMS"),parseInt(l[2])<0&&(t=-1*t),r=Math.abs(parseInt(l[10])),l[12]&&(r+=l[12]/60),l[14]&&(r+=l[14]/3600),parseInt(l[10])<0&&(r=-1*r),l[1]?(a=l[1],h=l[9]):l[8]&&(a=l[8],h=l[16]);else throw new Error("invalid DMS coordinates format");else if(z_.test(s)){if(l=z_.exec(s),x=hh(l),l.filter(S=>S).length<=5)throw new Error("invalid coordinates format");if(x)t=Math.abs(parseInt(l[2])),l[4]&&(t+=l[4].replace(",",".")/60,m="DM"),l[6]&&(t+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(t=-1*t),r=Math.abs(parseInt(l[10])),l[12]&&(r+=l[12].replace(",",".")/60),l[14]&&(r+=l[14].replace(",",".")/3600),parseInt(l[10])<0&&(r=-1*r),l[1]?(a=l[1],h=l[9]):l[8]&&(a=l[8],h=l[16]);else throw new Error("invalid coordinates format")}if(x){if(Math.abs(r)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(a&&!h||!a&&h)throw new Error("invalid coordinates value");if(a&&a==h)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),r.toString().includes(",")&&(r=r.replace(",","."));let S=/S|SOUTH/i;S.test(a)&&t>0&&(t=-1*t),S=/W|WEST/i,S.test(h)&&r>0&&(r=-1*r);const T=l[0].trim();let C,N;const B=/[,/;\u0020]/g,U=T.match(B);if(U==null){const ae=Math.floor(s.length/2);C=T.substring(0,ae).trim(),N=T.substring(ae).trim()}else{let ae;U.length%2==1?ae=Math.floor(U.length/2):ae=U.length/2-1;let J=0;if(ae==0)J=T.indexOf(U[0]),C=T.substring(0,J).trim(),N=T.substring(J+1).trim();else{let Y=0,ge=0;for(;Y<=ae;)J=T.indexOf(U[Y],ge),ge=J+1,Y++;C=T.substring(0,J).trim(),N=T.substring(J+1).trim()}}const ee=C.split(".");if(ee.length==2&&ee[1]==0&&ee[1].length!=2)throw new Error("invalid coordinates format");const ie=N.split(".");if(ie.length==2&&ie[1]==0&&ie[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(C)||/^\d+$/.test(N))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),r=Number(Number(r).toFixed(e)),Object.freeze({verbatimCoordinates:T,verbatimLatitude:C,verbatimLongitude:N,decimalLatitude:t,decimalLongitude:r,decimalCoordinates:`${t},${r}`,originalFormat:m,closeEnough:N2,toCoordinateFormat:D2})}else throw new Error("coordinates pattern match failed")}function hh(s){if(!isNaN(s[0]))return!1;const e=[...s];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,r=/[eastsouthnorthwest]+/i,a=e.length/2;for(let h=0;h<a;h++){const m=e[h],l=e[h+a],x=t.test(m)&&t.test(l),S=r.test(m)&&r.test(l),T=m==l;if(!(m==null&&l==null)){if(m==null||l==null)return!1;if(x||S||T)continue;return!1}}return!0}function O_(s,e){const t=Math.abs(s-e);return Number(t.toFixed(6))<=1e-5}function N2(s){if(!s)throw new Error("coords must be provided");if(s.includes(",")){const e=s.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return O_(this.decimalLatitude,Number(e[0]))&&O_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const z2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Xp.to=z2;const F2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],O2={decimalLatitude:40.123,decimalLongitude:-74.123},B2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],U2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function j2(){const s=[];return F2.forEach(e=>{e.decimalLatitude?s.push(e):s.push({...e,...O2})}),[...s,...B2,...U2]}const q2=j2();Xp.formats=q2.map(s=>s.verbatimCoordinates);const V2=Xp;function B_(s,e,t){const r=s.slice();return r[81]=e[t],r[83]=t,r}function U_(s){let e,t;return e=new E2({}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function j_(s){let e,t,r,a,h;return t=new T2({}),{c(){e=le("button"),ot(t.$$.fragment),Ze(e,"type","button"),Ze(e,"title",s[9]),Ze(e,"class","svelte-zh3kmv"),Er(e,"active",s[0])},m(m,l){se(m,e,l),rt(t,e,null),r=!0,a||(h=Mt(e,"click",s[67]),a=!0)},p(m,l){(!r||l[0]&512)&&Ze(e,"title",m[9]),(!r||l[0]&1)&&Er(e,"active",m[0])},i(m){r||(he(t.$$.fragment,m),r=!0)},o(m){ke(t.$$.fragment,m),r=!1},d(m){m&&re(e),st(t),a=!1,h()}}}function G2(s){let e,t=[],r=new Map,a,h,m,l=qn(s[14]);const x=S=>S[81].id+(S[81].address?","+S[81].address:"");for(let S=0;S<l.length;S+=1){let T=B_(s,l,S),C=x(T);r.set(C,t[S]=q_(C,T))}return{c(){e=le("ul");for(let S=0;S<t.length;S+=1)t[S].c();Ze(e,"class","svelte-zh3kmv")},m(S,T){se(S,e,T);for(let C=0;C<t.length;C+=1)t[C]&&t[C].m(e,null);a=!0,h||(m=[Mt(e,"mouseleave",s[71]),Mt(e,"blur",s[72])],h=!0)},p(S,T){T[0]&17880064&&(l=qn(S[14]),Nn(),t=dx(t,T,x,1,S,l,r,e,fx,q_,null,B_),zn())},i(S){if(!a){for(let T=0;T<l.length;T+=1)he(t[T]);a=!0}},o(S){for(let T=0;T<t.length;T+=1)ke(t[T]);a=!1},d(S){S&&re(e);for(let T=0;T<t.length;T+=1)t[T].d();h=!1,Ji(m)}}}function Z2(s){let e,t,r,a,h,m;return t=new zv({}),{c(){e=le("div"),ot(t.$$.fragment),r=Oe(),a=le("div"),h=ze(s[7]),Ze(a,"class","svelte-zh3kmv"),Ze(e,"class","no-results svelte-zh3kmv")},m(l,x){se(l,e,x),rt(t,e,null),G(e,r),G(e,a),G(a,h),m=!0},p(l,x){(!m||x[0]&128)&&Ct(h,l[7])},i(l){m||(he(t.$$.fragment,l),m=!0)},o(l){ke(t.$$.fragment,l),m=!1},d(l){l&&re(e),st(t)}}}function H2(s){let e="",t;return{c(){t=ze(e)},m(r,a){se(r,t,a)},p:Je,i:Je,o:Je,d(r){r&&re(t)}}}function X2(s){let e,t,r,a,h,m,l,x,S,T,C;return t=new zv({}),x=new Nv({}),{c(){e=le("div"),ot(t.$$.fragment),r=Oe(),a=le("div"),h=ze(s[6]),m=Oe(),l=le("button"),ot(x.$$.fragment),Ze(a,"class","svelte-zh3kmv"),Ze(l,"class","svelte-zh3kmv"),Ze(e,"class","error svelte-zh3kmv")},m(N,B){se(N,e,B),rt(t,e,null),G(e,r),G(e,a),G(a,h),G(e,m),G(e,l),rt(x,l,null),S=!0,T||(C=Mt(l,"click",s[68]),T=!0)},p(N,B){(!S||B[0]&64)&&Ct(h,N[6])},i(N){S||(he(t.$$.fragment,N),he(x.$$.fragment,N),S=!0)},o(N){ke(t.$$.fragment,N),ke(x.$$.fragment,N),S=!1},d(N){N&&re(e),st(t),st(x),T=!1,C()}}}function q_(s,e){let t,r,a;function h(){return e[69](e[83])}function m(){return e[70](e[81])}return r=new I2({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),r.$on("mouseenter",h),r.$on("focus",m),{key:s,first:null,c(){t=Gn(),ot(r.$$.fragment),this.first=t},m(l,x){se(l,t,x),rt(r,l,x),a=!0},p(l,x){e=l;const S={};x[0]&16384&&(S.feature=e[81]),x[0]&1024&&(S.showPlaceType=e[10]),x[0]&49152&&(S.selected=e[15]===e[83]),x[0]&4096&&(S.iconsBaseUrl=e[12]),r.$set(S)},i(l){a||(he(r.$$.fragment,l),a=!0)},o(l){ke(r.$$.fragment,l),a=!1},d(l){l&&re(t),st(r,l)}}}function W2(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge,xe,Ee=!1;h=new L2({}),C=new Nv({});let ye=s[19]&&U_(),be=s[5]===!0&&j_(s);const ve=s[59].default,Ce=Zi(ve,s,s[58],null),we=[X2,H2,Z2,G2],_e=[];function tt(Ve,qe){var dt,mt;return Ve[18]?0:Ve[16]?((dt=Ve[14])==null?void 0:dt.length)===0?2:Ve[16]&&((mt=Ve[14])!=null&&mt.length)?3:-1:1}return~(ie=tt(s))&&(ae=_e[ie]=we[ie](s)),{c(){e=Oe(),t=le("form"),r=le("div"),a=le("button"),ot(h.$$.fragment),m=Oe(),l=le("input"),x=Oe(),S=le("div"),T=le("button"),ot(C.$$.fragment),N=Oe(),ye&&ye.c(),B=Oe(),be&&be.c(),U=Oe(),Ce&&Ce.c(),ee=Oe(),ae&&ae.c(),Ze(a,"class","search-button svelte-zh3kmv"),Ze(a,"type","button"),Ze(l,"placeholder",s[8]),Ze(l,"aria-label",s[8]),Ze(l,"class","svelte-zh3kmv"),Ze(T,"type","button"),Ze(T,"title",s[3]),Ze(T,"class","svelte-zh3kmv"),Ze(S,"class","clear-button-container svelte-zh3kmv"),Er(S,"displayable",s[1]!==""),Ze(r,"class","input-group svelte-zh3kmv"),Ze(t,"tabindex","0"),Ze(t,"class",J=Nf(s[2])+" svelte-zh3kmv"),Er(t,"can-collapse",s[4]&&s[1]==="")},m(Ve,qe){se(Ve,e,qe),se(Ve,t,qe),G(t,r),G(r,a),rt(h,a,null),G(r,m),G(r,l),s[61](l),vi(l,s[1]),G(r,x),G(r,S),G(S,T),rt(C,T,null),G(S,N),ye&&ye.m(S,null),G(r,B),be&&be.m(r,null),G(r,U),Ce&&Ce.m(r,null),G(t,ee),~ie&&_e[ie].m(t,null),Y=!0,ge||(xe=[Mt(a,"click",s[60]),Mt(l,"input",s[62]),Mt(l,"focus",s[63]),Mt(l,"blur",s[64]),Mt(l,"keydown",s[22]),Mt(l,"input",s[65]),Mt(T,"click",s[66]),Mt(t,"submit",Nh(s[21]))],ge=!0)},p(Ve,qe){(!Y||qe[0]&256)&&Ze(l,"placeholder",Ve[8]),(!Y||qe[0]&256)&&Ze(l,"aria-label",Ve[8]),qe[0]&2&&l.value!==Ve[1]&&vi(l,Ve[1]),(!Y||qe[0]&8)&&Ze(T,"title",Ve[3]),Ve[19]?ye?qe[0]&524288&&he(ye,1):(ye=U_(),ye.c(),he(ye,1),ye.m(S,null)):ye&&(Nn(),ke(ye,1,1,()=>{ye=null}),zn()),(!Y||qe[0]&2)&&Er(S,"displayable",Ve[1]!==""),Ve[5]===!0?be?(be.p(Ve,qe),qe[0]&32&&he(be,1)):(be=j_(Ve),be.c(),he(be,1),be.m(r,U)):be&&(Nn(),ke(be,1,1,()=>{be=null}),zn()),Ce&&Ce.p&&(!Y||qe[1]&134217728)&&Xi(Ce,ve,Ve,Ve[58],Y?Hi(ve,Ve[58],qe,null):Wi(Ve[58]),null);let dt=ie;ie=tt(Ve),ie===dt?~ie&&_e[ie].p(Ve,qe):(ae&&(Nn(),ke(_e[dt],1,1,()=>{_e[dt]=null}),zn()),~ie?(ae=_e[ie],ae?ae.p(Ve,qe):(ae=_e[ie]=we[ie](Ve),ae.c()),he(ae,1),ae.m(t,null)):ae=null),(!Y||qe[0]&4&&J!==(J=Nf(Ve[2])+" svelte-zh3kmv"))&&Ze(t,"class",J),(!Y||qe[0]&22)&&Er(t,"can-collapse",Ve[4]&&Ve[1]==="")},i(Ve){Y||(he(Ee),he(h.$$.fragment,Ve),he(C.$$.fragment,Ve),he(ye),he(be),he(Ce,Ve),he(ae),Y=!0)},o(Ve){ke(Ee),ke(h.$$.fragment,Ve),ke(C.$$.fragment,Ve),ke(ye),ke(be),ke(Ce,Ve),ke(ae),Y=!1},d(Ve){Ve&&(re(e),re(t)),st(h),s[61](null),st(C),ye&&ye.d(),be&&be.d(),Ce&&Ce.d(Ve),~ie&&_e[ie].d(),ge=!1,Ji(xe)}}}function K2(s,e,t){let r,{$$slots:a={},$$scope:h}=e,{class:m=void 0}=e,{apiKey:l}=e,{bbox:x=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:T=!1}=e,{collapsed:C=!1}=e,{country:N=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:U=!1}=e,{errorMessage:ee="Something went wrong"}=e,{filter:ie=()=>!0}=e,{flyTo:ae=!0}=e,{fuzzyMatch:J=!0}=e,{language:Y=void 0}=e,{limit:ge=void 0}=e,{mapController:xe=void 0}=e,{minLength:Ee=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:be="Search"}=e,{proximity:ve=[{type:"server-geolocation"}]}=e,{reverseActive:Ce=U==="always"}=e,{reverseButtonTitle:we="toggle reverse geocoding"}=e,{searchValue:_e=""}=e,{showFullGeometry:tt=!0}=e,{showPlaceType:Ve="ifNeeded"}=e,{showResultsWhileTyping:qe=!0}=e,{selectFirst:dt=!0}=e,{flyToSelected:mt=!1}=e,{markerOnSelected:ct=!0}=e,{types:Ut=void 0}=e,{excludeTypes:bt=!1}=e,{zoom:It=16}=e,{maxZoom:pt=18}=e,{apiUrl:kt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:St={}}=e,{iconsBaseUrl:$t="https://cdn.maptiler.com/maptiler-geocoding-control/v1.3.3/icons/"}=e,{adjustUrlQuery:pn=()=>{}}=e;function Pn(){On.focus()}function We(){On.blur()}function Kn(fe,Ue=!0,Xe=!1){t(1,_e=fe),Ue?(t(15,xt=-1),ns()):(Rt(!Xe,Xe),setTimeout(()=>{On.focus(),On.select()}))}function dn(){t(14,ut=void 0),t(55,Lt=void 0),t(15,xt=-1)}function Ot(){t(54,Ye=[]),t(55,Lt=void 0)}let Ae=!1,ut,Ye,Lt,Ke="",On,xt=-1,Se,Bt=[],Mn,Fn,ei,Jt;const Ri=new Set,Qi=hc();bo(()=>{xe&&(xe.setEventHandler(void 0),xe.indicateReverse(!1),xe.setSelectedMarker(-1),xe.setMarkers(void 0,void 0))});function ns(fe){if(Fn&&(clearTimeout(Fn),Fn=void 0),xt>-1&&ut)t(55,Lt=ut[xt]),t(1,_e=Lt.place_type[0]==="reverse"?Lt.place_name:Lt.place_name.replace(/,.*/,"")),t(18,Se=void 0),t(54,Ye=void 0),t(15,xt=-1);else if(_e){const Ue=fe||!ht(_e);vr(_e,{exact:!0}).then(()=>{t(54,Ye=ut),t(55,Lt=void 0),Ue&&xn()}).catch(Xe=>t(18,Se=Xe))}}function ht(fe){try{return V2(fe,6)}catch{return!1}}async function vr(fe,{byId:Ue=!1,exact:Xe=!1}={}){t(18,Se=void 0),Mn==null||Mn.abort();const Pe=new AbortController;t(19,Mn=Pe);try{const nt=ht(fe),_t=new URLSearchParams;if(Y!==void 0&&_t.set("language",Array.isArray(Y)?Y.join(","):Y??""),Ut&&_t.set("types",Ut.join(",")),bt&&_t.set("excludeTypes",String(bt)),x&&_t.set("bbox",x.map(ln=>ln.toFixed(6)).join(",")),N&&_t.set("country",Array.isArray(N)?N.join(","):N),!Ue&&!nt){const ln=await R2(xe,ve,Pe);ln&&_t.set("proximity",ln),(Xe||!qe)&&_t.set("autocomplete","false"),_t.set("fuzzyMatch",String(J))}ge!==void 0&&(!nt||(Ut==null?void 0:Ut.length)===1)&&_t.set("limit",String(ge)),_t.set("key",l),pn(_t);const lt=kt+"/"+encodeURIComponent(nt?nt.decimalLongitude+","+nt.decimalLatitude:fe)+".json?"+_t.toString();if(lt===Ke){Ue?(t(14,ut=void 0),t(55,Lt=Bt[0])):t(14,ut=Bt);return}Ke=lt;const Nt=await fetch(lt,{signal:Pe.signal,...St});if(!Nt.ok)throw new Error(await Nt.text());const en=await Nt.json();Qi("response",{url:lt,featureCollection:en}),Ue?(t(14,ut=void 0),t(55,Lt=en.features[0]),Bt=[Lt]):(t(14,ut=en.features.filter(ie)),nt&&ut.unshift({type:"Feature",properties:{},id:"reverse_"+nt.decimalLongitude+"_"+nt.decimalLatitude,text:nt.decimalLatitude+", "+nt.decimalLongitude,place_name:nt.decimalLatitude+", "+nt.decimalLongitude,place_type:["reverse"],center:[nt.decimalLongitude,nt.decimalLatitude],bbox:[nt.decimalLongitude,nt.decimalLatitude,nt.decimalLongitude,nt.decimalLatitude],geometry:{type:"Point",coordinates:[nt.decimalLongitude,nt.decimalLatitude]}}),Bt=ut,nt&&On.focus())}catch(nt){if(nt&&typeof nt=="object"&&"name"in nt&&nt.name==="AbortError")return;throw nt}finally{Pe===Mn&&t(19,Mn=void 0)}}function xn(){var Xe;if(!(Ye!=null&&Ye.length)||!ae)return;const fe=[180,90,-180,-90],Ue=!Ye.some(Pe=>!Pe.matching_text);for(const Pe of Ye)if(Ue||!Pe.matching_text)for(const nt of[0,1,2,3])fe[nt]=Math[nt<2?"min":"max"](fe[nt],((Xe=Pe.bbox)==null?void 0:Xe[nt])??Pe.center[nt%2]);xe&&Ye.length>0&&(Lt&&fe[0]===fe[2]&&fe[1]===fe[3]?xe.flyTo(Lt.center,It):xe.fitBounds(M_(fe),50,pt))}function mn(fe){t(0,Ce=U==="always"),t(14,ut=void 0),t(55,Lt=void 0),t(15,xt=-1),Kn(fe[1].toFixed(6)+", "+M2(fe[0],[-180,180],!0).toFixed(6),!1,!0)}function Rs(fe){if(!ut)return;let Ue=fe.key==="ArrowDown"?1:fe.key==="ArrowUp"?-1:0;Ue&&(xt===(dt?0:-1)&&Ue===-1&&t(15,xt=ut.length),t(15,xt+=Ue),xt>=ut.length&&t(15,xt=-1),xt<0&&dt&&t(15,xt=0),fe.preventDefault())}function Rt(fe=!0,Ue=!1){if(t(18,Se=void 0),qe||Ue){if(Fn&&clearTimeout(Fn),_e.length<Ee)return;const Xe=_e;Fn=window.setTimeout(()=>{vr(Xe).catch(Pe=>t(18,Se=Pe))},fe?B:0)}else t(14,ut=void 0),t(18,Se=void 0)}function An(fe){t(55,Lt=fe),t(1,_e=fe.place_name),t(15,xt=-1)}const At=()=>On.focus();function br(fe){Jn[fe?"unshift":"push"](()=>{On=fe,t(17,On)})}function Wr(){_e=this.value,t(1,_e),t(13,Ae),t(27,T)}const bn=()=>t(13,Ae=!0),Pi=()=>t(13,Ae=!1),Ar=()=>Rt(),er=()=>{t(1,_e=""),On.focus()},Kr=()=>t(0,Ce=!Ce),Re=()=>t(18,Se=void 0),Q=fe=>t(15,xt=fe),$=fe=>An(fe),ce=()=>{dt||t(15,xt=-1)},ue=()=>{};return s.$$set=fe=>{"class"in fe&&t(2,m=fe.class),"apiKey"in fe&&t(25,l=fe.apiKey),"bbox"in fe&&t(26,x=fe.bbox),"clearButtonTitle"in fe&&t(3,S=fe.clearButtonTitle),"clearOnBlur"in fe&&t(27,T=fe.clearOnBlur),"collapsed"in fe&&t(4,C=fe.collapsed),"country"in fe&&t(28,N=fe.country),"debounceSearch"in fe&&t(29,B=fe.debounceSearch),"enableReverse"in fe&&t(5,U=fe.enableReverse),"errorMessage"in fe&&t(6,ee=fe.errorMessage),"filter"in fe&&t(30,ie=fe.filter),"flyTo"in fe&&t(31,ae=fe.flyTo),"fuzzyMatch"in fe&&t(32,J=fe.fuzzyMatch),"language"in fe&&t(33,Y=fe.language),"limit"in fe&&t(34,ge=fe.limit),"mapController"in fe&&t(35,xe=fe.mapController),"minLength"in fe&&t(36,Ee=fe.minLength),"noResultsMessage"in fe&&t(7,ye=fe.noResultsMessage),"placeholder"in fe&&t(8,be=fe.placeholder),"proximity"in fe&&t(37,ve=fe.proximity),"reverseActive"in fe&&t(0,Ce=fe.reverseActive),"reverseButtonTitle"in fe&&t(9,we=fe.reverseButtonTitle),"searchValue"in fe&&t(1,_e=fe.searchValue),"showFullGeometry"in fe&&t(38,tt=fe.showFullGeometry),"showPlaceType"in fe&&t(10,Ve=fe.showPlaceType),"showResultsWhileTyping"in fe&&t(39,qe=fe.showResultsWhileTyping),"selectFirst"in fe&&t(11,dt=fe.selectFirst),"flyToSelected"in fe&&t(40,mt=fe.flyToSelected),"markerOnSelected"in fe&&t(41,ct=fe.markerOnSelected),"types"in fe&&t(42,Ut=fe.types),"excludeTypes"in fe&&t(43,bt=fe.excludeTypes),"zoom"in fe&&t(44,It=fe.zoom),"maxZoom"in fe&&t(45,pt=fe.maxZoom),"apiUrl"in fe&&t(46,kt=fe.apiUrl),"fetchParameters"in fe&&t(47,St=fe.fetchParameters),"iconsBaseUrl"in fe&&t(12,$t=fe.iconsBaseUrl),"adjustUrlQuery"in fe&&t(48,pn=fe.adjustUrlQuery),"$$scope"in fe&&t(58,h=fe.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&32&&t(0,Ce=U==="always"),s.$$.dirty[0]&134225920&&setTimeout(()=>{t(16,ei=Ae),T&&!Ae&&t(1,_e="")}),s.$$.dirty[0]&16386|s.$$.dirty[1]&32&&_e.length<Ee&&(t(55,Lt=void 0),t(14,ut=void 0),t(18,Se=void 0),t(54,Ye=ut)),s.$$.dirty[1]&16777344&&tt&&Lt&&!Lt.address&&Lt.geometry.type==="Point"&&Lt.place_type[0]!=="reverse"&&vr(Lt.id,{byId:!0}).catch(fe=>t(18,Se=fe)),s.$$.dirty[1]&50356241&&(xe&&Lt&&Lt.id!==Jt&&ae&&(!Lt.bbox||Lt.bbox[0]===Lt.bbox[2]&&Lt.bbox[1]===Lt.bbox[3]?xe.flyTo(Lt.center,Lt.id.startsWith("poi.")||Lt.id.startsWith("address.")?pt:It):xe.fitBounds(M_(Lt.bbox),50,pt),t(14,ut=void 0),t(54,Ye=void 0),t(15,xt=-1)),t(56,Jt=Lt==null?void 0:Lt.id)),s.$$.dirty[0]&18432&&dt&&ut!=null&&ut.length&&t(15,xt=0),s.$$.dirty[0]&2050&&(dt||t(15,xt=-1)),s.$$.dirty[0]&16384|s.$$.dirty[1]&8388608&&Ye!==ut&&t(54,Ye=void 0),s.$$.dirty[0]&81921|s.$$.dirty[1]&8388624&&xe&&xe.setEventHandler(fe=>{switch(fe.type){case"mapClick":Ce&&mn(fe.coordinates);break;case"markerClick":{const Ue=ut==null?void 0:ut.find(Xe=>Xe.id===fe.id);Ue&&An(Ue)}break;case"markerMouseEnter":Ye&&t(15,xt=ei?(ut==null?void 0:ut.findIndex(Ue=>Ue.id===fe.id))??-1:-1);break;case"markerMouseLeave":Ye&&t(15,xt=-1);break}}),s.$$.dirty[0]&49152&&t(57,r=ut==null?void 0:ut[xt]),s.$$.dirty[1]&67133969&&xe&&r&&ae&&mt&&xe.flyTo(r.center,r.id.startsWith("poi.")||r.id.startsWith("address.")?pt:It),s.$$.dirty[1]&1040&&(ct||xe==null||xe.setMarkers(void 0,void 0)),s.$$.dirty[1]&75498512&&xe&&ct&&!Ye&&(xe.setMarkers(r?[r]:void 0,void 0),xe.setSelectedMarker(r?0:-1)),s.$$.dirty[1]&25165840&&xe&&xe.setMarkers(Ye,Lt),s.$$.dirty[0]&32768|s.$$.dirty[1]&8388624&&Ye&&xe&&xe.setSelectedMarker(xt),s.$$.dirty[0]&2|s.$$.dirty[1]&16&&xe){const fe=ht(_e);xe.setReverseMarker(fe?[fe.decimalLongitude,fe.decimalLatitude]:void 0)}s.$$.dirty[1]&67108864&&Qi("select",r),s.$$.dirty[1]&16777216&&Qi("pick",Lt),s.$$.dirty[0]&81920&&Qi("optionsVisibilityChange",ei&&!!ut),s.$$.dirty[0]&16384&&Qi("featuresListed",ut),s.$$.dirty[1]&8388608&&Qi("featuresMarked",Ye),s.$$.dirty[0]&1&&Qi("reverseToggle",Ce),s.$$.dirty[0]&2&&Qi("queryChange",_e),s.$$.dirty[0]&1|s.$$.dirty[1]&16&&xe&&xe.indicateReverse(Ce)},[Ce,_e,m,S,C,U,ee,ye,be,we,Ve,dt,$t,Ae,ut,xt,ei,On,Se,Mn,Ri,ns,Rs,Rt,An,l,x,T,N,B,ie,ae,J,Y,ge,xe,Ee,ve,tt,qe,mt,ct,Ut,bt,It,pt,kt,St,pn,Pn,We,Kn,dn,Ot,Ye,Lt,Jt,r,h,a,At,br,Wr,bn,Pi,Ar,er,Kr,Re,Q,$,ce,ue]}class $2 extends fn{constructor(e){super(),hn(this,e,K2,W2,on,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function V_(s){let e,t,r;return t=new $2({props:{mapController:s[1],apiKey:s[0]}}),{c(){e=le("div"),ot(t.$$.fragment),Ze(e,"class","svelte-ixhnie")},m(a,h){se(a,e,h),rt(t,e,null),r=!0},p(a,h){const m={};h&2&&(m.mapController=a[1]),h&1&&(m.apiKey=a[0]),t.$set(m)},i(a){r||(he(t.$$.fragment,a),r=!0)},o(a){ke(t.$$.fragment,a),r=!1},d(a){a&&re(e),st(t)}}}function Y2(s){let e,t,r=s[1]&&V_(s);return{c(){r&&r.c(),e=Gn()},m(a,h){r&&r.m(a,h),se(a,e,h),t=!0},p(a,[h]){a[1]?r?(r.p(a,h),h&2&&he(r,1)):(r=V_(a),r.c(),he(r,1),r.m(e.parentNode,e)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d(a)}}}function J2(s,e,t){let r,{apiKey:a}=e,{map:h}=e;return s.$$set=m=>{"apiKey"in m&&t(0,a=m.apiKey),"map"in m&&t(2,h=m.map)},s.$$.update=()=>{s.$$.dirty&4&&t(1,r=h?h2(h,Ls):null)},[a,r,h]}class Q2 extends fn{constructor(e){super(),hn(this,e,J2,Y2,on,{apiKey:0,map:2})}}const Hu=[];function up(s,e){return{subscribe:Yn(s,e).subscribe}}function Yn(s,e=Je){let t;const r=new Set;function a(l){if(on(s,l)&&(s=l,t)){const x=!Hu.length;for(const S of r)S[1](),Hu.push(S,s);if(x){for(let S=0;S<Hu.length;S+=2)Hu[S][0](Hu[S+1]);Hu.length=0}}}function h(l){a(l(s))}function m(l,x=Je){const S=[l,x];return r.add(S),r.size===1&&(t=e(a,h)||Je),l(s),()=>{r.delete(S),r.size===0&&t&&(t(),t=null)}}return{set:a,update:h,subscribe:m}}const ek=Symbol.for("svelte-maplibre");function tk(){return sv(ek)}function nk(s){return"layerType"in s&&s.layerType==="deckgl"}var Rh=ik;function ik(s){var e,t,r;if(s){if(Array.isArray(s)){for(e=[],t=s.length,r=0;r<t;r++){var a=s[r];a!=null&&e.push(a)}return e}if(typeof s=="object"){e={};var h=Object.keys(s);for(t=h.length,r=0;r<t;r++){var m=h[r],l=s[m];l!=null&&(e[m]=l)}return e}}}var Xu=Wp;function Wp(s,e){return s===e||s!==s&&e!==e?!0:typeof s!=typeof e||{}.toString.call(s)!={}.toString.call(e)||s!==Object(s)||!s?!1:Array.isArray(s)?G_(s,e):{}.toString.call(s)=="[object Set]"?G_(Array.from(s),Array.from(e)):{}.toString.call(s)=="[object Object]"?sk(s,e):rk(s,e)}function rk(s,e){return s.toString()===e.toString()}function G_(s,e){var t=s.length;if(t!=e.length)return!1;for(var r=0;r<t;r++)if(!Wp(s[r],e[r]))return!1;return!0}function sk(s,e){var t=Object.keys(s),r=t.length;if(r!=Object.keys(e).length)return!1;for(var a=0;a<r;a++){var h=t[a];if(!(e.hasOwnProperty(h)&&Wp(s[h],e[h])))return!1}return!0}const ok=s=>({features:s[0]&16,data:s[0]&16,map:s[0]&4,close:s[0]&1}),Z_=s=>{var e;return{features:s[4],data:(e=s[4])==null?void 0:e[0],map:s[2],close:s[31]}};function H_(s){let e,t,r=(s[4]||s[3]instanceof Ls.Marker)&&X_(s);return{c(){e=le("div"),r&&r.c()},m(a,h){se(a,e,h),r&&r.m(e,null),s[32](e),t=!0},p(a,h){a[4]||a[3]instanceof Ls.Marker?r?(r.p(a,h),h[0]&24&&he(r,1)):(r=X_(a),r.c(),he(r,1),r.m(e,null)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d(),s[32](null)}}}function X_(s){let e;const t=s[30].default,r=Zi(t,s,s[29],Z_);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h[0]&536870933)&&Xi(r,t,a,a[29],e?Hi(t,a[29],h,ok):Wi(a[29]),Z_)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function ak(s){let e,t,r=s[9].default&&H_(s);return{c(){r&&r.c(),e=Gn()},m(a,h){r&&r.m(a,h),se(a,e,h),t=!0},p(a,h){a[9].default?r?(r.p(a,h),h[0]&512&&he(r,1)):(r=H_(a),r.c(),he(r,1),r.m(e.parentNode,e)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d(a)}}}function lk(s,e,t){let r,a,h,m,l,x,{$$slots:S={},$$scope:T}=e;const C=ox(S);let{closeButton:N=void 0}=e,{closeOnClickOutside:B=!0}=e,{closeOnClickInside:U=!1}=e,{closeOnMove:ee=!1}=e,{openOn:ie="click"}=e,{openIfTopMost:ae=!0}=e,{focusAfterOpen:J=!0}=e,{anchor:Y=void 0}=e,{offset:ge=void 0}=e,{popupClass:xe=void 0}=e,{maxWidth:Ee=void 0}=e,{lngLat:ye=void 0}=e,{html:be=void 0}=e,{open:ve=!1}=e;const Ce=hc(),{map:we,popupTarget:_e,layerEvent:tt,layer:Ve,eventTopMost:qe}=tk();Pt(s,we,Ye=>t(2,h=Ye)),Pt(s,_e,Ye=>t(3,l=Ye)),Pt(s,tt,Ye=>t(28,m=Ye)),Pt(s,Ve,Ye=>t(35,x=Ye));const dt=["click","dblclick","contextmenu"];let mt,ct=!1,Ut;function bt(){if(!mt)return;let Ye=mt.getElement();!Ye||Ye===Ut||(Ut=Ye,ie==="hover"&&(Ut.style.pointerEvents="none"),Ut.addEventListener("mouseenter",()=>{t(24,ct=!0)},{passive:!0}),Ut.addEventListener("mouseleave",()=>{t(24,ct=!1)},{passive:!0}),Ut.addEventListener("click",()=>{U&&t(0,ve=!1)},{passive:!0}))}cc(()=>{if(h)return h.on("click",dn),h.on("contextmenu",dn),typeof l=="string"&&(h.on("click",l,St),h.on("dblclick",l,St),h.on("contextmenu",l,St),h.on("mousemove",l,Kn),h.on("mouseleave",l,We),h.on("touchstart",l,pn),h.on("touchend",l,Pn)),()=>{h!=null&&h.loaded()&&(mt==null||mt.remove(),h.off("click",dn),h.off("contextmenu",dn),l instanceof Ls.Marker?l.getPopup()===mt&&l.setPopup(void 0):typeof l=="string"&&(h.off("click",l,St),h.off("dblclick",l,St),h.off("contextmenu",l,St),h.off("mousemove",l,Kn),h.off("mouseleave",l,We),h.off("touchstart",l,pn),h.off("touchend",l,Pn)))}});function It(Ye){return ae?!("marker"in Ye)&&!nk(Ye)&&qe(Ye)!==x:!1}let pt=null,kt="normal";function St(Ye){Ye.type===ie&&(It(Ye)||("layerType"in Ye?Ye.layerType==="deckgl"?(t(10,ye=Ye.coordinate),t(4,pt=Ye.object?[Ye.object]:null)):(t(10,ye=Ye.lngLat),t(4,pt=Ye.features??[])):(t(10,ye=Ye.lngLat),t(4,pt=Ye.features??[])),setTimeout(()=>t(0,ve=!0))))}let $t=null;function pn(Ye){$t=Ye.point}function Pn(Ye){if(!$t||ie!=="hover")return;let Lt=$t.dist(Ye.point);$t=null,Lt<3&&(t(10,ye=Ye.lngLat),t(4,pt=Ye.features??[]),mt.isOpen()?t(25,kt="justOpened"):(t(25,kt="opening"),t(0,ve=!0)))}function We(Ye){ie!=="hover"||$t||kt!=="normal"||(t(0,ve=!1),t(4,pt=null))}function Kn(Ye){if(!(ie!=="hover"||$t||kt!=="normal")){if(It(Ye)){t(0,ve=!1),t(4,pt=null);return}t(0,ve=!0),t(4,pt=Ye.features??[]),t(10,ye=Ye.lngLat)}}function dn(Ye){if(kt==="justOpened"){t(25,kt="normal");return}if(!B)return;let Lt=[Ut,l instanceof Ls.Marker?l==null?void 0:l.getElement():null];ve&&mt.isOpen()&&!Lt.some(Ke=>Ke==null?void 0:Ke.contains(Ye.originalEvent.target))&&(Ye.type==="contextmenu"&&ie==="contextmenu"||Ye.type!=="contextmenu")&&t(0,ve=!1)}bo(()=>{h&&(mt!=null&&mt.isOpen())&&mt.remove()});let Ot;const Ae=()=>t(0,ve=!1);function ut(Ye){Jn[Ye?"unshift":"push"](()=>{Ot=Ye,t(1,Ot)})}return s.$$set=Ye=>{"closeButton"in Ye&&t(11,N=Ye.closeButton),"closeOnClickOutside"in Ye&&t(12,B=Ye.closeOnClickOutside),"closeOnClickInside"in Ye&&t(13,U=Ye.closeOnClickInside),"closeOnMove"in Ye&&t(14,ee=Ye.closeOnMove),"openOn"in Ye&&t(15,ie=Ye.openOn),"openIfTopMost"in Ye&&t(16,ae=Ye.openIfTopMost),"focusAfterOpen"in Ye&&t(17,J=Ye.focusAfterOpen),"anchor"in Ye&&t(18,Y=Ye.anchor),"offset"in Ye&&t(19,ge=Ye.offset),"popupClass"in Ye&&t(20,xe=Ye.popupClass),"maxWidth"in Ye&&t(21,Ee=Ye.maxWidth),"lngLat"in Ye&&t(10,ye=Ye.lngLat),"html"in Ye&&t(22,be=Ye.html),"open"in Ye&&t(0,ve=Ye.open),"$$scope"in Ye&&t(29,T=Ye.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&14336&&t(27,r=N??(!B&&!U)),s.$$.dirty[0]&146685952&&(mt||(t(23,mt=new Ls.Popup({closeButton:r,closeOnClick:!1,closeOnMove:ee,focusAfterOpen:J,maxWidth:Ee,className:xe,anchor:Y,offset:ge})),Ut=mt.getElement(),mt.on("open",()=>{t(0,ve=!0),bt(),Ce("open",mt)}),mt.on("close",()=>{t(0,ve=!1),Ce("close",mt)}),mt.on("hover",()=>{Ce("hover",mt)}))),s.$$.dirty[0]&8421384&&mt&&l instanceof Ls.Marker&&(ie==="click"?l.setPopup(mt):l.getPopup()===mt&&l.setPopup(void 0)),s.$$.dirty[0]&268468224&&dt.includes(ie)&&(m==null?void 0:m.type)===ie&&(St(m),Dn(tt,m=null,m)),s.$$.dirty[0]&268468224&&t(26,a=ie==="hover"&&((m==null?void 0:m.type)==="mousemove"||(m==null?void 0:m.type)==="mouseenter")),s.$$.dirty[0]&352354304&&ie==="hover"&&tt&&(a&&m&&(m.layerType==="deckgl"?(t(10,ye=m.coordinate),t(4,pt=m.object?[m.object]:null)):(t(10,ye=m.lngLat),t(4,pt=m.features??[]))),t(0,ve=(a||ct)??!1)),s.$$.dirty[0]&12582914&&(Ot?mt.setDOMContent(Ot):be&&mt.setHTML(be)),s.$$.dirty[0]&8389632&&ye&&mt.setLngLat(ye),s.$$.dirty[0]&41943045&&h){let Ye=mt.isOpen();ve&&!Ye?(mt.addTo(h),kt==="opening"&&t(25,kt="justOpened")):!ve&&Ye&&mt.remove()}},[ve,Ot,h,l,pt,we,_e,tt,Ve,C,ye,N,B,U,ee,ie,ae,J,Y,ge,xe,Ee,be,mt,ct,kt,a,r,m,T,S,Ae,ut]}class uk extends fn{constructor(e){super(),hn(this,e,lk,ak,on,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var ic=Math.pow,_s=(s,e,t)=>new Promise((r,a)=>{var h=x=>{try{l(t.next(x))}catch(S){a(S)}},m=x=>{try{l(t.throw(x))}catch(S){a(S)}},l=x=>x.done?r(x.value):Promise.resolve(x.value).then(h,m);l((t=t.apply(s,e)).next())}),to=Uint8Array,Ju=Uint16Array,ck=Int32Array,Fv=new to([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ov=new to([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hk=new to([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bv=function(s,e){for(var t=new Ju(31),r=0;r<31;++r)t[r]=e+=1<<s[r-1];for(var a=new ck(t[30]),r=1;r<30;++r)for(var h=t[r];h<t[r+1];++h)a[h]=h-t[r]<<5|r;return{b:t,r:a}},Uv=Bv(Fv,2),jv=Uv.b,fk=Uv.r;jv[28]=258,fk[258]=28;var dk=Bv(Ov,0),pk=dk.b,Cp=new Ju(32768);for(bi=0;bi<32768;++bi)Ca=(bi&43690)>>1|(bi&21845)<<1,Ca=(Ca&52428)>>2|(Ca&13107)<<2,Ca=(Ca&61680)>>4|(Ca&3855)<<4,Cp[bi]=((Ca&65280)>>8|(Ca&255)<<8)>>1;var Ca,bi,kh=function(s,e,t){for(var r=s.length,a=0,h=new Ju(e);a<r;++a)s[a]&&++h[s[a]-1];var m=new Ju(e);for(a=1;a<e;++a)m[a]=m[a-1]+h[a-1]<<1;var l;if(t){l=new Ju(1<<e);var x=15-e;for(a=0;a<r;++a)if(s[a])for(var S=a<<4|s[a],T=e-s[a],C=m[s[a]-1]++<<T,N=C|(1<<T)-1;C<=N;++C)l[Cp[C]>>x]=S}else for(l=new Ju(r),a=0;a<r;++a)s[a]&&(l[a]=Cp[m[s[a]-1]++]>>15-s[a]);return l},Oh=new to(288);for(bi=0;bi<144;++bi)Oh[bi]=8;var bi;for(bi=144;bi<256;++bi)Oh[bi]=9;var bi;for(bi=256;bi<280;++bi)Oh[bi]=7;var bi;for(bi=280;bi<288;++bi)Oh[bi]=8;var bi,qv=new to(32);for(bi=0;bi<32;++bi)qv[bi]=5;var bi,mk=kh(Oh,9,1),gk=kh(qv,5,1),cp=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Mo=function(s,e,t){var r=e/8|0;return(s[r]|s[r+1]<<8)>>(e&7)&t},hp=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},_k=function(s){return(s+7)/8|0},yk=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var r=new to(t-e);return r.set(s.subarray(e,t)),r},vk=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],eo=function(s,e,t){var r=new Error(e||vk[s]);if(r.code=s,Error.captureStackTrace&&Error.captureStackTrace(r,eo),!t)throw r;return r},Kp=function(s,e,t,r){var a=s.length,h=r?r.length:0;if(!a||e.f&&!e.l)return t||new to(0);var m=!t||e.i!=2,l=e.i;t||(t=new to(a*3));var x=function(dn){var Ot=t.length;if(dn>Ot){var Ae=new to(Math.max(Ot*2,dn));Ae.set(t),t=Ae}},S=e.f||0,T=e.p||0,C=e.b||0,N=e.l,B=e.d,U=e.m,ee=e.n,ie=a*8;do{if(!N){S=Mo(s,T,1);var ae=Mo(s,T+1,3);if(T+=3,ae)if(ae==1)N=mk,B=gk,U=9,ee=5;else if(ae==2){var xe=Mo(s,T,31)+257,Ee=Mo(s,T+10,15)+4,ye=xe+Mo(s,T+5,31)+1;T+=14;for(var be=new to(ye),ve=new to(19),Ce=0;Ce<Ee;++Ce)ve[hk[Ce]]=Mo(s,T+Ce*3,7);T+=Ee*3;for(var we=cp(ve),_e=(1<<we)-1,tt=kh(ve,we,1),Ce=0;Ce<ye;){var Ve=tt[Mo(s,T,_e)];T+=Ve&15;var J=Ve>>4;if(J<16)be[Ce++]=J;else{var qe=0,dt=0;for(J==16?(dt=3+Mo(s,T,3),T+=2,qe=be[Ce-1]):J==17?(dt=3+Mo(s,T,7),T+=3):J==18&&(dt=11+Mo(s,T,127),T+=7);dt--;)be[Ce++]=qe}}var mt=be.subarray(0,xe),ct=be.subarray(xe);U=cp(mt),ee=cp(ct),N=kh(mt,U,1),B=kh(ct,ee,1)}else eo(1);else{var J=_k(T)+4,Y=s[J-4]|s[J-3]<<8,ge=J+Y;if(ge>a){l&&eo(0);break}m&&x(C+Y),t.set(s.subarray(J,ge),C),e.b=C+=Y,e.p=T=ge*8,e.f=S;continue}if(T>ie){l&&eo(0);break}}m&&x(C+131072);for(var Ut=(1<<U)-1,bt=(1<<ee)-1,It=T;;It=T){var qe=N[hp(s,T)&Ut],pt=qe>>4;if(T+=qe&15,T>ie){l&&eo(0);break}if(qe||eo(2),pt<256)t[C++]=pt;else if(pt==256){It=T,N=null;break}else{var kt=pt-254;if(pt>264){var Ce=pt-257,St=Fv[Ce];kt=Mo(s,T,(1<<St)-1)+jv[Ce],T+=St}var $t=B[hp(s,T)&bt],pn=$t>>4;$t||eo(3),T+=$t&15;var ct=pk[pn];if(pn>3){var St=Ov[pn];ct+=hp(s,T)&(1<<St)-1,T+=St}if(T>ie){l&&eo(0);break}m&&x(C+131072);var Pn=C+kt;if(C<ct){var We=h-ct,Kn=Math.min(ct,Pn);for(We+C<0&&eo(3);C<Kn;++C)t[C]=r[We+C]}for(;C<Pn;C+=4)t[C]=t[C-ct],t[C+1]=t[C+1-ct],t[C+2]=t[C+2-ct],t[C+3]=t[C+3-ct];C=Pn}}e.l=N,e.p=It,e.b=C,e.f=S,N&&(S=1,e.m=U,e.d=B,e.n=ee)}while(!S);return C==t.length?t:yk(t,0,C)},bk=new to(0),xk=function(s){(s[0]!=31||s[1]!=139||s[2]!=8)&&eo(6,"invalid gzip data");var e=s[3],t=10;e&4&&(t+=(s[10]|s[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!s[t++]);return t+(e&2)},wk=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},kk=function(s,e){return((s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31)&&eo(6,"invalid zlib data"),(s[1]>>5&1)==+!e&&eo(6,"invalid zlib data: "+(s[1]&32?"need":"unexpected")+" dictionary"),(s[1]>>3&4)+2};function Ik(s,e){return Kp(s,{i:2},e&&e.out,e&&e.dictionary)}function Sk(s,e){var t=xk(s);return t+8>s.length&&eo(6,"invalid gzip data"),Kp(s.subarray(t,-8),{i:2},e&&e.out||new to(wk(s)),e&&e.dictionary)}function Ek(s,e){return Kp(s.subarray(kk(s,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Lp(s,e){return s[0]==31&&s[1]==139&&s[2]==8?Sk(s,e):(s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?Ik(s,e):Ek(s,e)}var Ak=typeof TextDecoder<"u"&&new TextDecoder,Tk=0;try{Ak.decode(bk,{stream:!0}),Tk=1}catch{}var Vv=(s,e)=>s*ic(2,e),fh=(s,e)=>Math.floor(s/ic(2,e)),Vf=(s,e)=>Vv(s.getUint16(e+1,!0),8)+s.getUint8(e),Gv=(s,e)=>Vv(s.getUint32(e+2,!0),16)+s.getUint16(e,!0),Ck=(s,e,t,r,a)=>{if(s!==r.getUint8(a))return s-r.getUint8(a);const h=Vf(r,a+1);if(e!==h)return e-h;const m=Vf(r,a+4);return t!==m?t-m:0},Lk=(s,e,t,r)=>{const a=Zv(s,e|128,t,r);return a?{z:e,x:t,y:r,offset:a[0],length:a[1],isDir:!0}:null},W_=(s,e,t,r)=>{const a=Zv(s,e,t,r);return a?{z:e,x:t,y:r,offset:a[0],length:a[1],isDir:!1}:null},Zv=(s,e,t,r)=>{let a=0,h=s.byteLength/17-1;for(;a<=h;){const m=h+a>>1,l=Ck(e,t,r,s,m*17);if(l>0)a=m+1;else if(l<0)h=m-1;else return[Gv(s,m*17+7),s.getUint32(m*17+13,!0)]}return null},Mk=(s,e)=>s.isDir&&!e.isDir?1:!s.isDir&&e.isDir?-1:s.z!==e.z?s.z-e.z:s.x!==e.x?s.x-e.x:s.y-e.y,Hv=(s,e)=>{const t=s.getUint8(e*17);return{z:t&127,x:Vf(s,e*17+1),y:Vf(s,e*17+4),offset:Gv(s,e*17+7),length:s.getUint32(e*17+13,!0),isDir:t>>7===1}},K_=s=>{const e=[],t=new DataView(s);for(let r=0;r<t.byteLength/17;r++)e.push(Hv(t,r));return Rk(e)},Rk=s=>{s.sort(Mk);const e=new ArrayBuffer(17*s.length),t=new Uint8Array(e);for(let r=0;r<s.length;r++){const a=s[r];let h=a.z;a.isDir&&(h=h|128),t[r*17]=h,t[r*17+1]=a.x&255,t[r*17+2]=a.x>>8&255,t[r*17+3]=a.x>>16&255,t[r*17+4]=a.y&255,t[r*17+5]=a.y>>8&255,t[r*17+6]=a.y>>16&255,t[r*17+7]=a.offset&255,t[r*17+8]=fh(a.offset,8)&255,t[r*17+9]=fh(a.offset,16)&255,t[r*17+10]=fh(a.offset,24)&255,t[r*17+11]=fh(a.offset,32)&255,t[r*17+12]=fh(a.offset,48)&255,t[r*17+13]=a.length&255,t[r*17+14]=a.length>>8&255,t[r*17+15]=a.length>>16&255,t[r*17+16]=a.length>>24&255}return e},Pk=(s,e)=>{if(s.byteLength<17)return null;const t=s.byteLength/17,r=Hv(s,t-1);if(r.isDir){const a=r.z,h=e.z-a,m=Math.trunc(e.x/(1<<h)),l=Math.trunc(e.y/(1<<h));return{z:a,x:m,y:l}}return null};function Dk(s){return _s(this,null,function*(){const e=yield s.getBytes(0,512e3),t=new DataView(e.data),r=t.getUint32(4,!0),a=t.getUint16(8,!0),h=new TextDecoder("utf-8"),m=JSON.parse(h.decode(new DataView(e.data,10,r)));let l=0;m.compression==="gzip"&&(l=2);let x=0;"minzoom"in m&&(x=+m.minzoom);let S=0;"maxzoom"in m&&(S=+m.maxzoom);let T=0,C=0,N=0,B=-180,U=-85,ee=180,ie=85;if(m.bounds){const J=m.bounds.split(",");B=+J[0],U=+J[1],ee=+J[2],ie=+J[3]}if(m.center){const J=m.center.split(",");T=+J[0],C=+J[1],N=+J[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:a*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:x,maxZoom:S,minLon:B,minLat:U,maxLon:ee,maxLat:ie,centerZoom:N,centerLon:T,centerLat:C,etag:e.etag}})}function Nk(s,e,t,r,a,h,m){return _s(this,null,function*(){let l=yield t.getArrayBuffer(e,s.rootDirectoryOffset,s.rootDirectoryLength,s);s.specVersion===1&&(l=K_(l));const x=W_(new DataView(l),r,a,h);if(x){let C=(yield e.getBytes(x.offset,x.length,m)).data;const N=new DataView(C);return N.getUint8(0)===31&&N.getUint8(1)===139&&(C=Lp(new Uint8Array(C))),{data:C}}const S=Pk(new DataView(l),{z:r,x:a,y:h});if(S){const T=Lk(new DataView(l),S.z,S.x,S.y);if(T){let C=yield t.getArrayBuffer(e,T.offset,T.length,s);s.specVersion===1&&(C=K_(C));const N=W_(new DataView(C),r,a,h);if(N){let U=(yield e.getBytes(N.offset,N.length,m)).data;const ee=new DataView(U);return ee.getUint8(0)===31&&ee.getUint8(1)===139&&(U=Lp(new Uint8Array(U))),{data:U}}}}})}var Xv={getHeader:Dk,getZxy:Nk},zk=s=>(e,t)=>{if(t instanceof AbortController)return s(e,t);const r=new AbortController;return s(e,r).then(a=>t(void 0,a.data,a.cacheControl||"",a.expires||""),a=>t(a)).catch(a=>t(a)),{cancel:()=>r.abort()}},Fk=class{constructor(){this.tilev4=(s,e)=>_s(this,null,function*(){if(s.type==="json"){const C=s.url.substr(10);let N=this.tiles.get(C);N||(N=new $_(C),this.tiles.set(C,N));const B=yield N.getHeader();return{data:{tiles:[`${s.url}/{z}/{x}/{y}`],minzoom:B.minZoom,maxzoom:B.maxZoom,bounds:[B.minLon,B.minLat,B.maxLon,B.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=s.url.match(t);if(!r)throw new Error("Invalid PMTiles protocol URL");const a=r[1];let h=this.tiles.get(a);h||(h=new $_(a),this.tiles.set(a,h));const m=r[2],l=r[3],x=r[4],S=yield h.getHeader(),T=yield h==null?void 0:h.getZxy(+m,+l,+x,e.signal);return T?{data:new Uint8Array(T.data),cacheControl:T.cacheControl,expires:T.expires}:S.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=zk(this.tilev4),this.tiles=new Map}add(s){this.tiles.set(s.source.getKey(),s)}get(s){return this.tiles.get(s)}};function Wu(s,e){return(e>>>0)*4294967296+(s>>>0)}function Ok(s,e){const t=e.buf;let r=t[e.pos++],a=(r&112)>>4;if(r<128||(r=t[e.pos++],a|=(r&127)<<3,r<128)||(r=t[e.pos++],a|=(r&127)<<10,r<128)||(r=t[e.pos++],a|=(r&127)<<17,r<128)||(r=t[e.pos++],a|=(r&127)<<24,r<128)||(r=t[e.pos++],a|=(r&1)<<31,r<128))return Wu(s,a);throw new Error("Expected varint not more than 10 bytes")}function dh(s){const e=s.buf;let t=e[s.pos++],r=t&127;return t<128||(t=e[s.pos++],r|=(t&127)<<7,t<128)||(t=e[s.pos++],r|=(t&127)<<14,t<128)||(t=e[s.pos++],r|=(t&127)<<21,t<128)?r:(t=e[s.pos],r|=(t&15)<<28,Ok(r,s))}function Bk(s,e,t,r){if(r===0){t===1&&(e[0]=s-1-e[0],e[1]=s-1-e[1]);const a=e[0];e[0]=e[1],e[1]=a}}var Uk=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function jk(s,e,t){if(s>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>ic(2,s)-1||t>ic(2,s)-1)throw Error("tile x/y outside zoom level bounds");const r=Uk[s],a=ic(2,s);let h=0,m=0,l=0;const x=[e,t];let S=a/2;for(;S>0;)h=(x[0]&S)>0?1:0,m=(x[1]&S)>0?1:0,l+=S*S*(3*h^m),Bk(S,x,h,m),S=S/2;return r+l}function Wv(s,e){return _s(this,null,function*(){if(e===1||e===0)return s;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Lp(new Uint8Array(s));const t=new Response(s).body;if(!t)throw Error("Failed to read response stream");const r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw Error("Compression method not supported")})}var qk=127;function Vk(s,e){let t=0,r=s.length-1;for(;t<=r;){const a=r+t>>1,h=e-s[a].tileId;if(h>0)t=a+1;else if(h<0)r=a-1;else return s[a]}return r>=0&&(s[r].runLength===0||e-s[r].tileId<s[r].runLength)?s[r]:null}var Gk=class{constructor(s,e=new Headers){this.url=s,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(s){this.customHeaders=s}getBytes(s,e,t,r){return _s(this,null,function*(){let a,h;t?h=t:(a=new AbortController,h=a.signal);const m=new Headers(this.customHeaders);m.set("range",`bytes=${s}-${s+e-1}`);let l;this.mustReload&&(l="reload");let x=yield fetch(this.url,{signal:h,cache:l,headers:m});if(s===0&&x.status===416){const N=x.headers.get("Content-Range");if(!N||!N.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const B=+N.substr(8);x=yield fetch(this.url,{signal:h,cache:"reload",headers:{range:`bytes=0-${B-1}`}})}let S=x.headers.get("Etag");if(S!=null&&S.startsWith("W/")&&(S=null),x.status===416||r&&S&&S!==r)throw this.mustReload=!0,new Mp(`Server returned non-matching ETag ${r} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(x.status>=300)throw Error(`Bad response code: ${x.status}`);const T=x.headers.get("Content-Length");if(x.status===200&&(!T||+T>e))throw a&&a.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield x.arrayBuffer(),etag:S||void 0,cacheControl:x.headers.get("Cache-Control")||void 0,expires:x.headers.get("Expires")||void 0}})}};function Ro(s,e){const t=s.getUint32(e+4,!0),r=s.getUint32(e+0,!0);return t*ic(2,32)+r}function Zk(s,e){const t=new DataView(s),r=t.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Ro(t,8),rootDirectoryLength:Ro(t,16),jsonMetadataOffset:Ro(t,24),jsonMetadataLength:Ro(t,32),leafDirectoryOffset:Ro(t,40),leafDirectoryLength:Ro(t,48),tileDataOffset:Ro(t,56),tileDataLength:Ro(t,64),numAddressedTiles:Ro(t,72),numTileEntries:Ro(t,80),numTileContents:Ro(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Kv(s){const e={buf:new Uint8Array(s),pos:0},t=dh(e),r=[];let a=0;for(let h=0;h<t;h++){const m=dh(e);r.push({tileId:a+m,offset:0,length:0,runLength:1}),a+=m}for(let h=0;h<t;h++)r[h].runLength=dh(e);for(let h=0;h<t;h++)r[h].length=dh(e);for(let h=0;h<t;h++){const m=dh(e);m===0&&h>0?r[h].offset=r[h-1].offset+r[h-1].length:r[h].offset=m-1}return r}function Hk(s){const e=new DataView(s);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Mp=class extends Error{};function Xk(s,e){return _s(this,null,function*(){const t=yield s.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Hk(t.data)<3)return[yield Xv.getHeader(s)];const a=t.data.slice(0,qk),h=Zk(a,t.etag),m=t.data.slice(h.rootDirectoryOffset,h.rootDirectoryOffset+h.rootDirectoryLength),l=`${s.getKey()}|${h.etag||""}|${h.rootDirectoryOffset}|${h.rootDirectoryLength}`,x=Kv(yield e(m,h.internalCompression));return[h,[l,x.length,x]]})}function Wk(s,e,t,r,a){return _s(this,null,function*(){const h=yield s.getBytes(t,r,void 0,a.etag),m=yield e(h.data,a.internalCompression),l=Kv(m);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var Kk=class{constructor(s=100,e=!0,t=Wv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=s,this.counter=1,this.decompress=t}getHeader(s){return _s(this,null,function*(){const e=s.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const r=new Promise((a,h)=>{Xk(s,this.decompress).then(m=>{m[1]&&this.cache.set(m[1][0],{lastUsed:this.counter++,data:Promise.resolve(m[1][2])}),a(m[0]),this.prune()}).catch(m=>{h(m)})});return this.cache.set(e,{lastUsed:this.counter++,data:r}),r})}getDirectory(s,e,t,r){return _s(this,null,function*(){const a=`${s.getKey()}|${r.etag||""}|${e}|${t}`,h=this.cache.get(a);if(h)return h.lastUsed=this.counter++,yield h.data;const m=new Promise((l,x)=>{Wk(s,this.decompress,e,t,r).then(S=>{l(S),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}getArrayBuffer(s,e,t,r){return _s(this,null,function*(){const a=`${s.getKey()}|${r.etag||""}|${e}|${t}`,h=this.cache.get(a);if(h)return h.lastUsed=this.counter++,yield h.data;const m=new Promise((l,x)=>{s.getBytes(e,t,void 0,r.etag).then(S=>{l(S.data),this.cache.has(a),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}prune(){if(this.cache.size>=this.maxCacheEntries){let s=1/0,e;this.cache.forEach((t,r)=>{t.lastUsed<s&&(s=t.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(s){return _s(this,null,function*(){const e=s.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(s.getKey());const t=new Promise((r,a)=>{this.getHeader(s).then(h=>{r(),this.invalidations.delete(e)}).catch(h=>{a(h)})});this.invalidations.set(e,t)})}},$_=class{constructor(s,e,t){typeof s=="string"?this.source=new Gk(s):this.source=s,t?this.decompress=t:this.decompress=Wv,e?this.cache=e:this.cache=new Kk}getHeader(){return _s(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(s,e,t,r){return _s(this,null,function*(){const a=jk(s,e,t),h=yield this.cache.getHeader(this.source);if(h.specVersion<3)return Xv.getZxy(h,this.source,this.cache,s,e,t,r);if(s<h.minZoom||s>h.maxZoom)return;let m=h.rootDirectoryOffset,l=h.rootDirectoryLength;for(let x=0;x<=3;x++){const S=yield this.cache.getDirectory(this.source,m,l,h),T=Vk(S,a);if(T){if(T.runLength>0){const C=yield this.source.getBytes(h.tileDataOffset+T.offset,T.length,r,h.etag);return{data:yield this.decompress(C.data,h.tileCompression),cacheControl:C.cacheControl,expires:C.expires}}m=h.leafDirectoryOffset+T.offset,l=T.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(s,e,t,r){return _s(this,null,function*(){try{return yield this.getZxyAttempt(s,e,t,r)}catch(a){if(a instanceof Mp)return this.cache.invalidate(this.source),yield this.getZxyAttempt(s,e,t,r);throw a}})}getMetadataAttempt(){return _s(this,null,function*(){const s=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(s.jsonMetadataOffset,s.jsonMetadataLength,void 0,s.etag),t=yield this.decompress(e.data,s.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(t))})}getMetadata(){return _s(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(s){if(s instanceof Mp)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw s}})}};const $k=s=>({props:s&8}),Y_=s=>({props:Qk(s[3])});function Yk(s){let e;const t=s[1].default,r=Zi(t,s,s[2],Y_);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&12)&&Xi(r,t,a,a[2],e?Hi(t,a[2],h,$k):Wi(a[2]),Y_)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function Jk(s){let e,t;return e=new uk({props:{openOn:s[0],$$slots:{default:[Yk,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,[a]){const h={};a&1&&(h.openOn=r[0]),a&12&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function Qk(s){return s?s[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function eI(s,e,t){let{$$slots:r={},$$scope:a}=e,{openOn:h="hover"}=e;return s.$$set=m=>{"openOn"in m&&t(0,h=m.openOn),"$$scope"in m&&t(2,a=m.$$scope)},[h,r,a]}class Ms extends fn{constructor(e){super(),hn(this,e,eI,Jk,on,{openOn:0})}}function rd(s,e,t){let r=["match",s];for(let[a,h]of Object.entries(e))r.push(a),r.push(h);return r.push(t),r}function Gf(s,e,t){let r=["step",s];for(let a=1;a<e.length;a++)r.push(t[a-1]),r.push(e[a]);return r.push(t[t.length-1]),r}function Mf(){return{type:"FeatureCollection",features:[]}}let tI=Date.now();function dc(s){return`${s}-${tI++}`}const $p=Symbol.for("svelte-maplibre");function pc(){return sv($p)}function nI(s){let e=new WeakMap;return t=>{var m;let r=e.get(t.originalEvent);if(r!==void 0)return r;let h=(m=t.target.queryRenderedFeatures(t.point).find(l=>{var x;return(x=s.get(l.layer.id))==null?void 0:x.interactive}))==null?void 0:m.layer.id;return e.set(t.originalEvent,h),h}}function iI(){let s=new Map;return rv($p,{map:Yn(null),source:up(null),layer:up(null),popupTarget:up(null),cluster:Yn(),loadedImages:Yn(new Set),minzoom:Yn(0),maxzoom:Yn(24),layerEvent:Yn(null),layerInfo:s,eventTopMost:nI(s),markerClickManager:new oI})}function J_(s){return{subscribe:s.subscribe}}function Yp({key:s,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:r=!1}){let a=pc(),h=Yn(null),m=J_(h),l={...a,[s]:J_(h)};if(e&&(l.popupTarget=m),r){let x=Yn(null);l.layerEvent=x,a.layerEvent=x}return t&&(l.cluster=Yn()),rv($p,l),{...a,self:h}}function $v(){return Yp({key:"source",setCluster:!0})}function rI(s=!0){return Yp({key:"layer",setPopupTarget:s,setMouseEvent:s})}function sI(){return Yp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class oI{constructor(){lh(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Q_(s){let e;return t=>{if(t)for(let r in t){let a=e==null?void 0:e[r],h=t[r];a!==h&&s(r,h,a)}else if(e)for(let r in e)s(r,void 0,e[r]);e=t}}function aI(s,...e){let t=[s];for(let r of e)if(r)Array.isArray(r)&&r[0]===s?t.push(...r.slice(1)):t.push(r);else continue;if(t.length!==1)return t.length===2?t[1]:t}function lI(s){return s===!0?["has","point_count"]:s===!1?["!",["has","point_count"]]:void 0}function zr(s,e){return["case",["boolean",["feature-state","hover"],!1],e,s]}function ey(s){let e=s[0],t,r,a=ty(s);return{c(){a.c(),t=Gn()},m(h,m){a.m(h,m),se(h,t,m),r=!0},p(h,m){m[0]&1&&on(e,e=h[0])?(Nn(),ke(a,1,1,Je),zn(),a=ty(h),a.c(),he(a,1),a.m(t.parentNode,t)):a.p(h,m)},i(h){r||(he(a),r=!0)},o(h){ke(a),r=!1},d(h){h&&re(t),a.d(h)}}}function ty(s){let e;const t=s[36].default,r=Zi(t,s,s[35],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h[1]&16)&&Xi(r,t,a,a[35],e?Hi(t,a[35],h,null):Wi(a[35]),null)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function uI(s){let e,t,r=s[0]&&ey(s);return{c(){r&&r.c(),e=Gn()},m(a,h){r&&r.m(a,h),se(a,e,h),t=!0},p(a,h){a[0]?r?(r.p(a,h),h[0]&1&&he(r,1)):(r=ey(a),r.c(),he(r,1),r.m(e.parentNode,e)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d(a)}}}function cI(s,e,t){let r,a,h,m,l,x,S,T,C,N,B,U,{$$slots:ee={},$$scope:ie}=e,{id:ae=dc("layer")}=e,{source:J=void 0}=e,{sourceLayer:Y=void 0}=e,{beforeId:ge=void 0}=e,{beforeLayerType:xe=void 0}=e,{type:Ee}=e,{paint:ye=void 0}=e,{layout:be=void 0}=e,{filter:ve=void 0}=e,{applyToClusters:Ce=void 0}=e,{minzoom:we=void 0}=e,{maxzoom:_e=void 0}=e,{manageHoverState:tt=!1}=e,{hovered:Ve=null}=e,{interactive:qe=!0}=e,{hoverCursor:dt=void 0}=e,{eventsIfTopMost:mt=!1}=e;const ct=hc(),{map:Ut,source:bt,self:It,minzoom:pt,maxzoom:kt,eventTopMost:St,layerInfo:$t}=rI();Pt(s,Ut,ut=>t(31,C=ut)),Pt(s,bt,ut=>t(32,N=ut)),Pt(s,It,ut=>t(0,T=ut)),Pt(s,pt,ut=>t(34,U=ut)),Pt(s,kt,ut=>t(33,B=ut)),bo(()=>{T&&C&&($t.delete(T),C==null||C.removeLayer(T))});let pn;function Pn(ut){var On,xt;if(!qe||!T||!C||mt&&St(ut)!==T)return;let Ye=ut.features??[],Lt=(xt=(On=Ye[0])==null?void 0:On.properties)==null?void 0:xt.cluster_id,Ke={event:ut,map:C,clusterId:Lt,layer:T,source:l,features:Ye};ct(ut.type,Ke)}function We(ut){var On,xt;if(!qe||!T||!C||mt&&St(ut)!==T)return;dt&&(C.getCanvas().style.cursor=dt);let Ye=ut.features??[];t(6,Ve=Ye[0]??null);let Lt=(xt=(On=Ye[0])==null?void 0:On.properties)==null?void 0:xt.cluster_id;ct("mouseenter",{event:ut,map:C,clusterId:Lt,layer:T,source:l,features:Ye})}function Kn(ut){var On,xt,Se;if(!qe||!C)return;if(mt&&St(ut)!==T){t(6,Ve=null),tt&&pn!==void 0&&(C==null||C.setFeatureState({source:l,sourceLayer:Y,id:pn},{hover:!1}),pn=void 0);return}C.getCanvas().style.cursor=dt;let Ye=ut.features??[],Lt=(xt=(On=Ye[0])==null?void 0:On.properties)==null?void 0:xt.cluster_id,Ke=(Se=Ye[0])==null?void 0:Se.id;Ke!==pn&&(tt&&(pn!==void 0&&(C==null||C.setFeatureState({source:l,id:pn,sourceLayer:Y},{hover:!1})),C==null||C.setFeatureState({source:l,id:Ke,sourceLayer:Y},{hover:!0})),pn=Ke,t(6,Ve=Ye[0]??null)),ct("mousemove",{event:ut,map:C,clusterId:Lt,layer:T,source:l,features:Ye})}function dn(ut){if(!(!qe||!T||!C)){if(dt&&(C.getCanvas().style.cursor=""),t(6,Ve=null),tt&&pn!==void 0){const Ye={source:l,id:pn,sourceLayer:Y};C==null||C.setFeatureState(Ye,{hover:!1}),pn=void 0}ct("mouseleave",{map:C,layer:T,source:l})}}let Ot=!0;function Ae(ut){C&&(C.off("click",ut,Pn),C.off("dblclick",ut,Pn),C.off("contextmenu",ut,Pn),C.off("mouseenter",ut,We),C.off("mousemove",ut,Kn),C.off("mouseleave",ut,dn))}return bo(()=>{C&&T&&Ae(T)}),s.$$set=ut=>{"id"in ut&&t(7,ae=ut.id),"source"in ut&&t(8,J=ut.source),"sourceLayer"in ut&&t(9,Y=ut.sourceLayer),"beforeId"in ut&&t(10,ge=ut.beforeId),"beforeLayerType"in ut&&t(11,xe=ut.beforeLayerType),"type"in ut&&t(12,Ee=ut.type),"paint"in ut&&t(13,ye=ut.paint),"layout"in ut&&t(14,be=ut.layout),"filter"in ut&&t(15,ve=ut.filter),"applyToClusters"in ut&&t(16,Ce=ut.applyToClusters),"minzoom"in ut&&t(17,we=ut.minzoom),"maxzoom"in ut&&t(18,_e=ut.maxzoom),"manageHoverState"in ut&&t(19,tt=ut.manageHoverState),"hovered"in ut&&t(6,Ve=ut.hovered),"interactive"in ut&&t(20,qe=ut.interactive),"hoverCursor"in ut&&t(21,dt=ut.hoverCursor),"eventsIfTopMost"in ut&&t(22,mt=ut.eventsIfTopMost),"$$scope"in ut&&t(35,ie=ut.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&65536&&t(30,r=lI(Ce)),s.$$.dirty[0]&1073774592&&t(24,a=aI("all",r,ve)),s.$$.dirty[0]&131072|s.$$.dirty[1]&8&&t(26,h=we??U),s.$$.dirty[0]&262144|s.$$.dirty[1]&4&&t(25,m=_e??B),s.$$.dirty[0]&256|s.$$.dirty[1]&2&&t(29,l=J||N),s.$$.dirty[0]&654343809|s.$$.dirty[1]&1&&C&&T!==ae&&l){T&&(Ae(T),$t.delete(T));let ut=ge;if(!ge&&xe){let Ye=C.getStyle().layers,Lt=typeof xe=="function"?xe:On=>On.type===xe,Ke=Ye==null?void 0:Ye.find(Lt);Ke&&(ut=Ke.id)}Dn(It,T=ae,T),C.addLayer(Rh({id:T,type:Ee,source:l,"source-layer":Y,filter:a,paint:ye,layout:be,minzoom:h,maxzoom:m}),ut),t(23,Ot=!0),C.on("click",T,Pn),C.on("dblclick",T,Pn),C.on("contextmenu",T,Pn),C.on("mouseenter",T,We),C.on("mousemove",T,Kn),C.on("mouseleave",T,dn)}s.$$.dirty[0]&1048577&&T&&$t.set(T,{interactive:qe}),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&t(28,x=T?Q_((ut,Ye)=>C==null?void 0:C.setPaintProperty(T,ut,Ye)):void 0),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&t(27,S=T?Q_((ut,Ye)=>C==null?void 0:C.setLayoutProperty(T,ut,Ye)):void 0),s.$$.dirty[0]&268443648&&(x==null||x(ye)),s.$$.dirty[0]&134234112&&(S==null||S(be)),s.$$.dirty[0]&100663297|s.$$.dirty[1]&1&&T&&(C==null||C.setLayerZoomRange(T,h,m)),s.$$.dirty[0]&25165825|s.$$.dirty[1]&1&&T&&(Ot?t(23,Ot=!1):C==null||C.setFilter(T,a))},[T,Ut,bt,It,pt,kt,Ve,ae,J,Y,ge,xe,Ee,ye,be,ve,Ce,we,_e,tt,qe,dt,mt,Ot,a,m,h,S,x,l,r,C,N,B,U,ie,ee]}class Jp extends fn{constructor(e){super(),hn(this,e,cI,uI,on,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function hI(s){let e;const t=s[16].default,r=Zi(t,s,s[24],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&16777216)&&Xi(r,t,a,a[24],e?Hi(t,a[24],h,null):Wi(a[24]),null)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function fI(s){let e,t,r;function a(m){s[17](m)}let h={id:s[1],type:"circle",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[hI]},$$scope:{ctx:s}};return s[0]!==void 0&&(h.hovered=s[0]),e=new Jp({props:h}),Jn.push(()=>_r(e,"hovered",a)),e.$on("click",s[18]),e.$on("dblclick",s[19]),e.$on("contextmenu",s[20]),e.$on("mouseenter",s[21]),e.$on("mousemove",s[22]),e.$on("mouseleave",s[23]),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),r=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.applyToClusters=m[9]),l&1024&&(x.minzoom=m[10]),l&2048&&(x.maxzoom=m[11]),l&4096&&(x.hoverCursor=m[12]),l&8192&&(x.manageHoverState=m[13]),l&16384&&(x.eventsIfTopMost=m[14]),l&32768&&(x.interactive=m[15]),l&16777216&&(x.$$scope={dirty:l,ctx:m}),!t&&l&1&&(t=!0,x.hovered=m[0],gr(()=>t=!1)),e.$set(x)},i(m){r||(he(e.$$.fragment,m),r=!0)},o(m){ke(e.$$.fragment,m),r=!1},d(m){st(e,m)}}}function dI(s,e,t){let{$$slots:r={},$$scope:a}=e,{id:h=dc("circle")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{applyToClusters:B=void 0}=e,{minzoom:U=void 0}=e,{maxzoom:ee=void 0}=e,{hoverCursor:ie=void 0}=e,{manageHoverState:ae=!1}=e,{hovered:J=null}=e,{eventsIfTopMost:Y=!1}=e,{interactive:ge=!0}=e;function xe(_e){J=_e,t(0,J)}function Ee(_e){ur.call(this,s,_e)}function ye(_e){ur.call(this,s,_e)}function be(_e){ur.call(this,s,_e)}function ve(_e){ur.call(this,s,_e)}function Ce(_e){ur.call(this,s,_e)}function we(_e){ur.call(this,s,_e)}return s.$$set=_e=>{"id"in _e&&t(1,h=_e.id),"source"in _e&&t(2,m=_e.source),"sourceLayer"in _e&&t(3,l=_e.sourceLayer),"beforeId"in _e&&t(4,x=_e.beforeId),"beforeLayerType"in _e&&t(5,S=_e.beforeLayerType),"paint"in _e&&t(6,T=_e.paint),"layout"in _e&&t(7,C=_e.layout),"filter"in _e&&t(8,N=_e.filter),"applyToClusters"in _e&&t(9,B=_e.applyToClusters),"minzoom"in _e&&t(10,U=_e.minzoom),"maxzoom"in _e&&t(11,ee=_e.maxzoom),"hoverCursor"in _e&&t(12,ie=_e.hoverCursor),"manageHoverState"in _e&&t(13,ae=_e.manageHoverState),"hovered"in _e&&t(0,J=_e.hovered),"eventsIfTopMost"in _e&&t(14,Y=_e.eventsIfTopMost),"interactive"in _e&&t(15,ge=_e.interactive),"$$scope"in _e&&t(24,a=_e.$$scope)},[J,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,Y,ge,r,xe,Ee,ye,be,ve,Ce,we,a]}class Qp extends fn{constructor(e){super(),hn(this,e,dI,fI,on,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function pI(s){let e;const t=s[15].default,r=Zi(t,s,s[23],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&8388608)&&Xi(r,t,a,a[23],e?Hi(t,a[23],h,null):Wi(a[23]),null)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function mI(s){let e,t,r;function a(m){s[16](m)}let h={id:s[1],type:"fill",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[pI]},$$scope:{ctx:s}};return s[0]!==void 0&&(h.hovered=s[0]),e=new Jp({props:h}),Jn.push(()=>_r(e,"hovered",a)),e.$on("click",s[17]),e.$on("dblclick",s[18]),e.$on("contextmenu",s[19]),e.$on("mouseenter",s[20]),e.$on("mousemove",s[21]),e.$on("mouseleave",s[22]),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),r=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!t&&l&1&&(t=!0,x.hovered=m[0],gr(()=>t=!1)),e.$set(x)},i(m){r||(he(e.$$.fragment,m),r=!0)},o(m){ke(e.$$.fragment,m),r=!1},d(m){st(e,m)}}}function gI(s,e,t){let{$$slots:r={},$$scope:a}=e,{id:h=dc("fill")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:ae=null}=e,{eventsIfTopMost:J=!1}=e,{interactive:Y=!0}=e;function ge(we){ae=we,t(0,ae)}function xe(we){ur.call(this,s,we)}function Ee(we){ur.call(this,s,we)}function ye(we){ur.call(this,s,we)}function be(we){ur.call(this,s,we)}function ve(we){ur.call(this,s,we)}function Ce(we){ur.call(this,s,we)}return s.$$set=we=>{"id"in we&&t(1,h=we.id),"source"in we&&t(2,m=we.source),"sourceLayer"in we&&t(3,l=we.sourceLayer),"beforeId"in we&&t(4,x=we.beforeId),"beforeLayerType"in we&&t(5,S=we.beforeLayerType),"paint"in we&&t(6,T=we.paint),"layout"in we&&t(7,C=we.layout),"filter"in we&&t(8,N=we.filter),"minzoom"in we&&t(9,B=we.minzoom),"maxzoom"in we&&t(10,U=we.maxzoom),"hoverCursor"in we&&t(11,ee=we.hoverCursor),"manageHoverState"in we&&t(12,ie=we.manageHoverState),"hovered"in we&&t(0,ae=we.hovered),"eventsIfTopMost"in we&&t(13,J=we.eventsIfTopMost),"interactive"in we&&t(14,Y=we.interactive),"$$scope"in we&&t(23,a=we.$$scope)},[ae,h,m,l,x,S,T,C,N,B,U,ee,ie,J,Y,r,ge,xe,Ee,ye,be,ve,Ce,a]}class mc extends fn{constructor(e){super(),hn(this,e,gI,mI,on,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function _I(s,e,t){let r;const{map:a}=pc();Pt(s,a,x=>t(4,r=x));let{position:h="top-left"}=e,{container:m=void 0}=e,l=null;return bo(()=>{r!=null&&r.loaded()&&l&&r.removeControl(l)}),s.$$set=x=>{"position"in x&&t(1,h=x.position),"container"in x&&t(2,m=x.container)},s.$$.update=()=>{if(s.$$.dirty&30&&r&&!l){let x;typeof m=="string"?x=document.querySelector(m)??void 0:x=m,t(3,l=new Ls.FullscreenControl({container:x})),r.addControl(l,h)}},[a,h,m,l,r]}class yI extends fn{constructor(e){super(),hn(this,e,_I,null,on,{position:1,container:2})}}function Yv(s,e,t,r,a){let h=!1;s.getSource(e)&&(h=!0,s.removeSource(e));const m=()=>{r(e)&&(s.addSource(e,t),a())};if(h){const l=()=>{e&&(s.getSource(e)?setTimeout(l,1):m())};l()}else m()}function Jv(s,e,t){ux().then(()=>{let r=Df(s);if(!r)return;r.getSource(e)===t&&r.removeSource(e)})}function ny(s){let e=s[0],t,r,a=iy(s);return{c(){a.c(),t=Gn()},m(h,m){a.m(h,m),se(h,t,m),r=!0},p(h,m){m&1&&on(e,e=h[0])?(Nn(),ke(a,1,1,Je),zn(),a=iy(h),a.c(),he(a,1),a.m(t.parentNode,t)):a.p(h,m)},i(h){r||(he(a),r=!0)},o(h){ke(a),r=!1},d(h){h&&re(t),a.d(h)}}}function iy(s){let e;const t=s[19].default,r=Zi(t,s,s[18],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&262144)&&Xi(r,t,a,a[18],e?Hi(t,a[18],h,null):Wi(a[18]),null)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function vI(s){let e,t,r=s[0]&&ny(s);return{c(){r&&r.c(),e=Gn()},m(a,h){r&&r.m(a,h),se(a,e,h),t=!0},p(a,[h]){a[0]?r?(r.p(a,h),h&1&&he(r,1)):(r=ny(a),r.c(),he(r,1),r.m(e.parentNode,e)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d(a)}}}function bI(s,e,t){let r,a,h,{$$slots:m={},$$scope:l}=e,{id:x=dc("geojson")}=e,{data:S}=e,{generateId:T=!1}=e,{promoteId:C=void 0}=e,{filter:N=void 0}=e,{lineMetrics:B=void 0}=e,{cluster:U=void 0}=e,{maxzoom:ee=void 0}=e,{attribution:ie=void 0}=e,{buffer:ae=void 0}=e,{tolerance:J=void 0}=e;const{map:Y,cluster:ge,self:xe}=$v();Pt(s,Y,be=>t(17,a=be)),Pt(s,ge,be=>t(20,h=be)),Pt(s,xe,be=>t(0,r=be));let Ee,ye=!0;return bo(()=>{r&&Ee&&a&&(Jv(Y,r,Ee),Dn(xe,r=null,r),t(15,Ee=void 0))}),s.$$set=be=>{"id"in be&&t(4,x=be.id),"data"in be&&t(5,S=be.data),"generateId"in be&&t(6,T=be.generateId),"promoteId"in be&&t(7,C=be.promoteId),"filter"in be&&t(8,N=be.filter),"lineMetrics"in be&&t(9,B=be.lineMetrics),"cluster"in be&&t(10,U=be.cluster),"maxzoom"in be&&t(11,ee=be.maxzoom),"attribution"in be&&t(12,ie=be.attribution),"buffer"in be&&t(13,ae=be.buffer),"tolerance"in be&&t(14,J=be.tolerance),"$$scope"in be&&t(18,l=be.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&Dn(ge,h=U,h),s.$$.dirty&196593&&a&&r!==x&&(Dn(xe,r=x,r),Yv(a,r,Rh({type:"geojson",data:S,filter:N,lineMetrics:B,generateId:T,promoteId:C,cluster:!!U,clusterMinPoints:U==null?void 0:U.minPoints,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius,clusterProperties:U==null?void 0:U.properties,maxzoom:ee,attribution:ie,buffer:ae,tolerance:J}),be=>a&&be===r,()=>{r&&(t(15,Ee=a==null?void 0:a.getSource(r)),t(16,ye=!0))})),s.$$.dirty&131088&&(a==null||a.on("style.load",()=>{t(15,Ee=a==null?void 0:a.getSource(x))})),s.$$.dirty&98336&&Ee&&(ye?t(16,ye=!1):Ee.setData(S)),s.$$.dirty&33792&&(Ee==null||Ee.setClusterOptions(Rh({cluster:!!U,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius})))},[r,Y,ge,xe,x,S,T,C,N,B,U,ee,ie,ae,J,Ee,ye,a,l,m]}class $i extends fn{constructor(e){super(),hn(this,e,bI,vI,on,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function xI(s,e,t){let r;const{map:a}=pc();Pt(s,a,N=>t(8,r=N));let{position:h="top-left"}=e,{positionOptions:m=void 0}=e,{fitBoundsOptions:l=void 0}=e,{trackUserLocation:x=!1}=e,{showAccuracyCircle:S=!0}=e,{showUserLocation:T=!0}=e,{control:C=null}=e;return bo(()=>{r!=null&&r.loaded()&&C&&r.removeControl(C)}),s.$$set=N=>{"position"in N&&t(2,h=N.position),"positionOptions"in N&&t(3,m=N.positionOptions),"fitBoundsOptions"in N&&t(4,l=N.fitBoundsOptions),"trackUserLocation"in N&&t(5,x=N.trackUserLocation),"showAccuracyCircle"in N&&t(6,S=N.showAccuracyCircle),"showUserLocation"in N&&t(7,T=N.showUserLocation),"control"in N&&t(1,C=N.control)},s.$$.update=()=>{s.$$.dirty&510&&r&&!C&&(t(1,C=new Ls.GeolocateControl({positionOptions:m,fitBoundsOptions:l,trackUserLocation:x,showAccuracyCircle:S,showUserLocation:T})),r.addControl(C,h))},[a,C,h,m,l,x,S,T,r]}class wI extends fn{constructor(e){super(),hn(this,e,xI,null,on,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function kI(s){let e;const t=s[15].default,r=Zi(t,s,s[23],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&8388608)&&Xi(r,t,a,a[23],e?Hi(t,a[23],h,null):Wi(a[23]),null)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function II(s){let e,t,r;function a(m){s[16](m)}let h={id:s[1],type:"line",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[kI]},$$scope:{ctx:s}};return s[0]!==void 0&&(h.hovered=s[0]),e=new Jp({props:h}),Jn.push(()=>_r(e,"hovered",a)),e.$on("click",s[17]),e.$on("dblclick",s[18]),e.$on("contextmenu",s[19]),e.$on("mouseenter",s[20]),e.$on("mousemove",s[21]),e.$on("mouseleave",s[22]),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),r=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!t&&l&1&&(t=!0,x.hovered=m[0],gr(()=>t=!1)),e.$set(x)},i(m){r||(he(e.$$.fragment,m),r=!0)},o(m){ke(e.$$.fragment,m),r=!1},d(m){st(e,m)}}}function SI(s,e,t){let{$$slots:r={},$$scope:a}=e,{id:h=dc("line")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:ae=null}=e,{eventsIfTopMost:J=!1}=e,{interactive:Y=!0}=e;function ge(we){ae=we,t(0,ae)}function xe(we){ur.call(this,s,we)}function Ee(we){ur.call(this,s,we)}function ye(we){ur.call(this,s,we)}function be(we){ur.call(this,s,we)}function ve(we){ur.call(this,s,we)}function Ce(we){ur.call(this,s,we)}return s.$$set=we=>{"id"in we&&t(1,h=we.id),"source"in we&&t(2,m=we.source),"sourceLayer"in we&&t(3,l=we.sourceLayer),"beforeId"in we&&t(4,x=we.beforeId),"beforeLayerType"in we&&t(5,S=we.beforeLayerType),"paint"in we&&t(6,T=we.paint),"layout"in we&&t(7,C=we.layout),"filter"in we&&t(8,N=we.filter),"minzoom"in we&&t(9,B=we.minzoom),"maxzoom"in we&&t(10,U=we.maxzoom),"hoverCursor"in we&&t(11,ee=we.hoverCursor),"manageHoverState"in we&&t(12,ie=we.manageHoverState),"hovered"in we&&t(0,ae=we.hovered),"eventsIfTopMost"in we&&t(13,J=we.eventsIfTopMost),"interactive"in we&&t(14,Y=we.interactive),"$$scope"in we&&t(23,a=we.$$scope)},[ae,h,m,l,x,S,T,C,N,B,U,ee,ie,J,Y,r,ge,xe,Ee,ye,be,ve,Ce,a]}class cr extends fn{constructor(e){super(),hn(this,e,SI,II,on,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function EI(s,e,t){let r;const a=hc();let{layer:h=void 0}=e;const{map:m}=pc();Pt(s,m,T=>t(2,r=T));function l(T){a(T.type,{...T,map:m})}const x=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],S=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return bo(()=>{if(r)if(h)for(const T of x)r.off(T,h,l);else for(const T of S)r.off(T,l)}),s.$$set=T=>{"layer"in T&&t(1,h=T.layer)},s.$$.update=()=>{if(s.$$.dirty&6&&r)if(h)for(const T of x)r.on(T,h,l);else for(const T of S)r.on(T,l)},[m,h,r]}class Qv extends fn{constructor(e){super(),hn(this,e,EI,null,on,{layer:1})}}function AI(s){let e=s.getCenter(),t=Math.round(s.getZoom()*100)/100,r=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),h=Math.round(e.lat*a)/a,m=Math.round(e.lng*a)/a,l=`${t}/${h}/${m}`,x=s.getBearing(),S=s.getPitch();return(x||S)&&(l+=`/${Math.round(x*10)/10}`),S&&(l+=`/${Math.round(S)}`),`#${l}`}function TI(s){return s.replace("#","").split("/").map(parseFloat)}function CI(s,e,t){let r;const{map:a}=pc();Pt(s,a,T=>t(6,r=T));let{position:h="top-left"}=e,{showCompass:m=!0}=e,{showZoom:l=!0}=e,{visualizePitch:x=!1}=e,S=null;return bo(()=>{r!=null&&r.loaded()&&S&&r.removeControl(S)}),s.$$set=T=>{"position"in T&&t(1,h=T.position),"showCompass"in T&&t(2,m=T.showCompass),"showZoom"in T&&t(3,l=T.showZoom),"visualizePitch"in T&&t(4,x=T.visualizePitch)},s.$$.update=()=>{s.$$.dirty&126&&r&&!S&&(t(5,S=new Ls.NavigationControl({showCompass:m,showZoom:l,visualizePitch:x})),r.addControl(S,h))},[a,h,m,l,x,S,r]}class LI extends fn{constructor(e){super(),hn(this,e,CI,null,on,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function MI(s,e,t){let r;const{map:a}=pc();Pt(s,a,S=>t(5,r=S));let{position:h="bottom-left"}=e,{maxWidth:m=void 0}=e,{unit:l="metric"}=e,x=null;return bo(()=>{r!=null&&r.loaded()&&x&&r.removeControl(x)}),s.$$set=S=>{"position"in S&&t(1,h=S.position),"maxWidth"in S&&t(2,m=S.maxWidth),"unit"in S&&t(3,l=S.unit)},s.$$.update=()=>{s.$$.dirty&62&&r&&!x&&(t(4,x=new Ls.ScaleControl({maxWidth:m,unit:l})),r.addControl(x,h))},[a,h,m,l,x,r]}class RI extends fn{constructor(e){super(),hn(this,e,MI,null,on,{position:1,maxWidth:2,unit:3})}}const{window:PI}=iv,DI=s=>({map:s[0]&16,loadedImages:s[0]&32,allImagesLoaded:s[0]&64}),ry=s=>({map:s[4],loadedImages:s[5],allImagesLoaded:s[6]});function sy(s){let e,t,r=s[3]&&oy(s);const a=s[46].default,h=Zi(a,s,s[45],ry);return{c(){r&&r.c(),e=Oe(),h&&h.c()},m(m,l){r&&r.m(m,l),se(m,e,l),h&&h.m(m,l),t=!0},p(m,l){m[3]?r?(r.p(m,l),l[0]&8&&he(r,1)):(r=oy(m),r.c(),he(r,1),r.m(e.parentNode,e)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn()),h&&h.p&&(!t||l[0]&112|l[1]&16384)&&Xi(h,a,m,m[45],t?Hi(a,m[45],l,DI):Wi(m[45]),ry)},i(m){t||(he(r),he(h,m),t=!0)},o(m){ke(r),ke(h,m),t=!1},d(m){m&&re(e),r&&r.d(m),h&&h.d(m)}}}function oy(s){let e,t,r,a,h,m,l,x;return e=new LI({props:{position:s[7]}}),r=new wI({props:{position:s[7],fitBoundsOptions:{maxZoom:12}}}),h=new yI({props:{position:s[7]}}),l=new RI({props:{position:s[7]}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment),m=Oe(),ot(l.$$.fragment)},m(S,T){rt(e,S,T),se(S,t,T),rt(r,S,T),se(S,a,T),rt(h,S,T),se(S,m,T),rt(l,S,T),x=!0},p(S,T){const C={};T[0]&128&&(C.position=S[7]),e.$set(C);const N={};T[0]&128&&(N.position=S[7]),r.$set(N);const B={};T[0]&128&&(B.position=S[7]),h.$set(B);const U={};T[0]&128&&(U.position=S[7]),l.$set(U)},i(S){x||(he(e.$$.fragment,S),he(r.$$.fragment,S),he(h.$$.fragment,S),he(l.$$.fragment,S),x=!0)},o(S){ke(e.$$.fragment,S),ke(r.$$.fragment,S),ke(h.$$.fragment,S),ke(l.$$.fragment,S),x=!1},d(S){S&&(re(t),re(a),re(m)),st(e,S),st(r,S),st(h,S),st(l,S)}}}function NI(s){let e,t,r,a,h,m=s[4]&&s[0]&&sy(s);return{c(){e=le("div"),m&&m.c(),Ze(e,"class",t=Nf(s[2])+" svelte-p00lfq"),Ze(e,"data-testid","map-container"),Er(e,"expand-map",!s[2])},m(l,x){se(l,e,x),m&&m.m(e,null),s[47](e),r=!0,a||(h=[Mt(PI,"hashchange",s[11]),pp(s[10].call(null,e))],a=!0)},p(l,x){l[4]&&l[0]?m?(m.p(l,x),x[0]&17&&he(m,1)):(m=sy(l),m.c(),he(m,1),m.m(e,null)):m&&(Nn(),ke(m,1,1,()=>{m=null}),zn()),(!r||x[0]&4&&t!==(t=Nf(l[2])+" svelte-p00lfq"))&&Ze(e,"class",t),(!r||x[0]&4)&&Er(e,"expand-map",!l[2])},i(l){r||(he(m),r=!0)},o(l){ke(m),r=!1},d(l){l&&re(e),m&&m.d(),s[47](null),a=!1,Ji(h)}}}function zI(s,e,t){let r,a,h,m,{$$slots:l={},$$scope:x}=e,{map:S=null}=e,{mapContainer:T=void 0}=e,{class:C=void 0}=e,{style:N}=e,{diffStyleUpdates:B=!1}=e,{center:U=void 0}=e,{zoom:ee=void 0}=e,{pitch:ie=0}=e,{bearing:ae=0}=e,{bounds:J=void 0}=e,{hash:Y=!1}=e,{updateHash:ge=Se=>{window.history.replaceState(window.history.state,"",Se)}}=e,{loaded:xe=!1}=e,{minZoom:Ee=0}=e,{maxZoom:ye=22}=e,{minPitch:be=0}=e,{maxPitch:ve=60}=e,{renderWorldCopies:Ce=void 0}=e,{dragPan:we=void 0}=e,{dragRotate:_e=void 0}=e,{pitchWithRotate:tt=void 0}=e,{antialias:Ve=void 0}=e,{zoomOnDoubleClick:qe=!0}=e,{locale:dt=void 0}=e,{interactive:mt=!0}=e,{attributionControl:ct=!0}=e,{cooperativeGestures:Ut=!1}=e,{preserveDrawingBuffer:bt=!1}=e,{maxBounds:It=void 0}=e,{images:pt=[]}=e,{standardControls:kt=!1}=e,{filterLayers:St=void 0}=e,{transformRequest:$t=void 0}=e;const pn=hc(),{map:Pn,loadedImages:We}=iI();Pt(s,Pn,Se=>t(4,h=Se)),Pt(s,We,Se=>t(5,m=Se));let Kn=new Set;async function dn(Se,Bt=!1){if(h&&!(!h.loaded()&&!Bt))if("url"in Se){Kn.add(Se.id);try{let Mn=await h.loadImage(Se.url);h==null||h.addImage(Se.id,Mn.data,Se.options),m.add(Se.id),We.set(m)}catch(Mn){pn("error",Mn)}finally{Kn.delete(Se.id)}}else h.addImage(Se.id,Se.data,Se.options),m.add(Se.id),We.set(m)}let Ot,Ae,ut,Ye;function Lt(Se){return On(),Dn(Pn,h=new Ls.Map(Rh({container:Se,style:N,locale:dt,center:U,zoom:ee,pitch:ie,bearing:ae,minZoom:Ee,maxZoom:ye,minPitch:be,maxPitch:ve,renderWorldCopies:Ce,dragPan:we,dragRotate:_e,pitchWithRotate:tt,antialias:Ve,interactive:mt,preserveDrawingBuffer:bt,maxBounds:It,bounds:J,attributionControl:ct,transformRequest:$t,cooperativeGestures:Ut})),h),h.on("load",Bt=>{Bt.target.getContainer().setAttribute("data-testid","map"),Bt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,xe=!0),pn("load",h)}),h.on("error",Bt=>pn("error",{...Bt,map:h})),h.on("movestart",Bt=>pn("movestart",{...Bt,map:h})),h.on("moveend",Bt=>{if(t(12,U=Bt.target.getCenter()),t(13,ee=Bt.target.getZoom()),t(14,ie=Bt.target.getPitch()),t(15,ae=Bt.target.getBearing()),t(16,J=Bt.target.getBounds()),pn("moveend",{...Bt,map:h}),Y){let Mn=new URL(window.location.href.replace(/(#.+)?$/,AI(h)));ge(Mn)}}),h.on("click",Bt=>pn("click",{...Bt,map:h})),h.on("dblclick",Bt=>pn("dblclick",{...Bt,map:h})),h.on("contextmenu",Bt=>pn("contextmenu",{...Bt,map:h})),h.on("zoomstart",Bt=>pn("zoomstart",{...Bt,map:h})),h.on("zoom",Bt=>{pn("zoom",{...Bt,map:h})}),h.on("zoomend",Bt=>{pn("zoomend",{...Bt,map:h})}),h.on("style.load",()=>{if(h){const Bt=h.getStyle();if(t(42,Ot=Bt.layers.map(Mn=>Mn.id)),t(43,Ae=Object.keys(Bt.sources)),Ye)for(const[Mn,Fn]of Object.entries(Ye))h.addSource(Mn,Fn);if(ut)for(const Mn of ut)h.addLayer(Mn);for(const Mn of pt)dn(Mn,!0)}}),h.on("styledata",Bt=>{if(h&&St){const Mn=h.getStyle().layers;if(Mn)for(let Fn of Mn)St(Fn)||h.setLayoutProperty(Fn.id,"visibility","none")}pn("styledata",{...Bt,map:h})}),{destroy(){t(0,xe=!1),h==null||h.remove(),Dn(Pn,h=null,h)}}}let Ke=N;function On(){if(Y){let Se=TI(window.location.hash);Se.length>=3&&(t(13,ee=Se[0]),t(12,U=[Se[2],Se[1]])),Se.length==5&&(t(15,ae=Se[3]),t(14,ie=Se[4]))}}function xt(Se){Jn[Se?"unshift":"push"](()=>{T=Se,t(1,T)})}return s.$$set=Se=>{"map"in Se&&t(17,S=Se.map),"mapContainer"in Se&&t(1,T=Se.mapContainer),"class"in Se&&t(2,C=Se.class),"style"in Se&&t(18,N=Se.style),"diffStyleUpdates"in Se&&t(19,B=Se.diffStyleUpdates),"center"in Se&&t(12,U=Se.center),"zoom"in Se&&t(13,ee=Se.zoom),"pitch"in Se&&t(14,ie=Se.pitch),"bearing"in Se&&t(15,ae=Se.bearing),"bounds"in Se&&t(16,J=Se.bounds),"hash"in Se&&t(20,Y=Se.hash),"updateHash"in Se&&t(21,ge=Se.updateHash),"loaded"in Se&&t(0,xe=Se.loaded),"minZoom"in Se&&t(22,Ee=Se.minZoom),"maxZoom"in Se&&t(23,ye=Se.maxZoom),"minPitch"in Se&&t(24,be=Se.minPitch),"maxPitch"in Se&&t(25,ve=Se.maxPitch),"renderWorldCopies"in Se&&t(26,Ce=Se.renderWorldCopies),"dragPan"in Se&&t(27,we=Se.dragPan),"dragRotate"in Se&&t(28,_e=Se.dragRotate),"pitchWithRotate"in Se&&t(29,tt=Se.pitchWithRotate),"antialias"in Se&&t(30,Ve=Se.antialias),"zoomOnDoubleClick"in Se&&t(31,qe=Se.zoomOnDoubleClick),"locale"in Se&&t(32,dt=Se.locale),"interactive"in Se&&t(33,mt=Se.interactive),"attributionControl"in Se&&t(34,ct=Se.attributionControl),"cooperativeGestures"in Se&&t(35,Ut=Se.cooperativeGestures),"preserveDrawingBuffer"in Se&&t(36,bt=Se.preserveDrawingBuffer),"maxBounds"in Se&&t(37,It=Se.maxBounds),"images"in Se&&t(38,pt=Se.images),"standardControls"in Se&&t(3,kt=Se.standardControls),"filterLayers"in Se&&t(39,St=Se.filterLayers),"transformRequest"in Se&&t(40,$t=Se.transformRequest),"$$scope"in Se&&t(45,x=Se.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&8&&t(7,r=typeof kt=="boolean"?void 0:kt),s.$$.dirty[0]&16&&t(17,S=h),s.$$.dirty[0]&786448|s.$$.dirty[1]&14336&&h&&!Xu(N,Ke)){const Se=h.getStyle();if(Ot&&(ut=Se.layers.filter(Bt=>!Ot.includes(Bt.id))),Ae){const Bt=Object.keys(Se.sources).filter(Mn=>!Ae.includes(Mn));Ye={};for(const Mn of Bt)Ye[Mn]=Se.sources[Mn]}t(44,Ke=N),h.setStyle(N,{diff:B}),Dn(We,m=new Set,m),t(41,Kn=new Set)}if(s.$$.dirty[0]&49|s.$$.dirty[1]&1152&&xe&&h!=null&&h.loaded())for(let Se of pt)!m.has(Se.id)&&!Kn.has(Se.id)&&!h.hasImage(Se.id)&&dn(Se);if(s.$$.dirty[0]&32|s.$$.dirty[1]&128&&t(6,a=pt.every(Se=>m.has(Se.id))),s.$$.dirty[0]&61456&&h){let Se={};U!=null&&!Xu(U,h==null?void 0:h.getCenter())&&(Se.center=U),ee!=null&&!Xu(ee,h==null?void 0:h.getZoom())&&(Se.zoom=ee),ae!=null&&!Xu(ae,h==null?void 0:h.getBearing())&&(Se.bearing=ae),ie!=null&&!Xu(ie,h==null?void 0:h.getPitch())&&(Se.pitch=ie),Object.keys(Se).length&&h.easeTo(Se)}s.$$.dirty[0]&65552&&J&&!Xu(J,h==null?void 0:h.getBounds())&&(h==null||h.fitBounds(J)),s.$$.dirty[0]&16|s.$$.dirty[1]&1&&(qe?h==null||h.doubleClickZoom.enable():h==null||h.doubleClickZoom.disable())},[xe,T,C,kt,h,m,a,r,Pn,We,Lt,On,U,ee,ie,ae,J,S,N,B,Y,ge,Ee,ye,be,ve,Ce,we,_e,tt,Ve,qe,dt,mt,ct,Ut,bt,It,pt,St,$t,Kn,Ot,Ae,Ke,x,l,xt]}class FI extends fn{constructor(e){super(),hn(this,e,zI,NI,on,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const OI=s=>({marker:s&8}),ay=s=>({marker:s[3]});function BI(s){let e,t,r,a,h,m,l;const x=s[19].default,S=Zi(x,s,s[18],ay);return{c(){e=le("div"),S&&S.c(),Ze(e,"tabindex",t=s[1]?0:void 0),Ze(e,"role",r=s[1]?"button":void 0),Rn(e,"z-index",s[2])},m(T,C){se(T,e,C),S&&S.m(e,null),h=!0,m||(l=[pp(s[7].call(null,e)),pp(a=UI.call(null,e,s[0])),Mt(e,"click",np(s[20])),Mt(e,"dblclick",np(s[21])),Mt(e,"contextmenu",np(Nh(s[22]))),Mt(e,"mouseenter",s[23]),Mt(e,"mouseleave",s[24]),Mt(e,"mousemove",s[25]),Mt(e,"keydown",s[8])],m=!0)},p(T,[C]){S&&S.p&&(!h||C&262152)&&Xi(S,x,T,T[18],h?Hi(x,T[18],C,OI):Wi(T[18]),ay),(!h||C&2&&t!==(t=T[1]?0:void 0))&&Ze(e,"tabindex",t),(!h||C&2&&r!==(r=T[1]?"button":void 0))&&Ze(e,"role",r),a&&iu(a.update)&&C&1&&a.update.call(null,T[0]),C&4&&Rn(e,"z-index",T[2])},i(T){h||(he(S,T),h=!0)},o(T){ke(S,T),h=!1},d(T){T&&re(e),S&&S.d(T),m=!1,Ji(l)}}}function UI(s,e){const t=s.className;function r(a){a?s.className=`${t} ${a}`:s.className=t}return r(e),{update:r}}function jI(s,e,t){let r,a,h,{$$slots:m={},$$scope:l}=e,{marker:x=void 0}=e,{lngLat:S}=e,{class:T=void 0}=e,{interactive:C=!0}=e,{asButton:N=!1}=e,{draggable:B=!1}=e,{feature:U=null}=e,{offset:ee=void 0}=e,{zIndex:ie=void 0}=e,{rotation:ae=0}=e,{opacity:J=1}=e;const Y=hc(),{map:ge,layerEvent:xe,self:Ee,markerClickManager:ye}=sI();Pt(s,ge,ct=>t(27,h=ct)),Pt(s,xe,ct=>t(26,r=ct)),Pt(s,Ee,ct=>t(3,a=ct));function be(ct){Dn(Ee,a=new Ls.Marker({element:ct,rotation:ae,draggable:B,offset:ee,opacity:J.toString()}).setLngLat(S).addTo(h),a),t(11,x=a);const Ut=()=>we("dragstart"),bt=()=>{ve(),we("drag")},It=()=>{ve(),we("dragend")};return B&&(a.on("dragstart",Ut),a.on("drag",bt),a.on("dragend",It)),{destroy(){B&&(a==null||a.off("dragstart",Ut),a==null||a.off("drag",bt),a==null||a.off("dragend",It)),t(11,x=void 0),a==null||a.remove()}}}function ve(){let ct=a==null?void 0:a.getLngLat();ct&&(Array.isArray(S)?t(10,S=[ct.lng,ct.lat]):S&&"lon"in S?t(10,S={lon:ct.lng,lat:ct.lat}):t(10,S=ct))}function Ce(ct){ct.key===" "&&(ct.preventDefault(),ct.stopPropagation(),we("click"))}function we(ct){if(!C)return;let Ut=a==null?void 0:a.getLngLat();if(!Ut)return;const bt=[Ut.lng,Ut.lat];let It={map:h,marker:a,lngLat:bt,features:[{type:"Feature",properties:(U==null?void 0:U.properties)??{},geometry:{type:"Point",coordinates:bt}}]};(ct==="click"||ct==="contextmenu")&&ye.handleClick(It),Dn(xe,r={...It,layerType:"marker",type:ct},r),Y(ct,It)}const _e=()=>we("click"),tt=()=>we("dblclick"),Ve=()=>{we("contextmenu")},qe=()=>{we("mouseenter")},dt=()=>{we("mouseleave")},mt=()=>we("mousemove");return s.$$set=ct=>{"marker"in ct&&t(11,x=ct.marker),"lngLat"in ct&&t(10,S=ct.lngLat),"class"in ct&&t(0,T=ct.class),"interactive"in ct&&t(12,C=ct.interactive),"asButton"in ct&&t(1,N=ct.asButton),"draggable"in ct&&t(13,B=ct.draggable),"feature"in ct&&t(14,U=ct.feature),"offset"in ct&&t(15,ee=ct.offset),"zIndex"in ct&&t(2,ie=ct.zIndex),"rotation"in ct&&t(16,ae=ct.rotation),"opacity"in ct&&t(17,J=ct.opacity),"$$scope"in ct&&t(18,l=ct.$$scope)},s.$$.update=()=>{s.$$.dirty&1032&&(a==null||a.setLngLat(S)),s.$$.dirty&32776&&(a==null||a.setOffset(ee??[0,0])),s.$$.dirty&65544&&(a==null||a.setRotation(ae)),s.$$.dirty&131080&&(a==null||a.setOpacity(J.toString()))},[T,N,ie,a,ge,xe,Ee,be,Ce,we,S,x,C,B,U,ee,ae,J,l,m,_e,tt,Ve,qe,dt,mt]}class Zf extends fn{constructor(e){super(),hn(this,e,jI,BI,on,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function ly(s){let e=s[0],t,r,a=uy(s);return{c(){a.c(),t=Gn()},m(h,m){a.m(h,m),se(h,t,m),r=!0},p(h,m){m&1&&on(e,e=h[0])?(Nn(),ke(a,1,1,Je),zn(),a=uy(h),a.c(),he(a,1),a.m(t.parentNode,t)):a.p(h,m)},i(h){r||(he(a),r=!0)},o(h){ke(a),r=!1},d(h){h&&re(t),a.d(h)}}}function uy(s){let e;const t=s[15].default,r=Zi(t,s,s[14],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&16384)&&Xi(r,t,a,a[14],e?Hi(t,a[14],h,null):Wi(a[14]),null)},i(a){e||(he(r,a),e=!0)},o(a){ke(r,a),e=!1},d(a){r&&r.d(a)}}}function qI(s){let e,t,r=s[0]&&ly(s);return{c(){r&&r.c(),e=Gn()},m(a,h){r&&r.m(a,h),se(a,e,h),t=!0},p(a,[h]){a[0]?r?(r.p(a,h),h&1&&he(r,1)):(r=ly(a),r.c(),he(r,1),r.m(e.parentNode,e)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d(a)}}}function VI(s,e,t){let r,a,{$$slots:h={},$$scope:m}=e,{id:l=dc("vector")}=e,{url:x=null}=e,{tiles:S=null}=e,{promoteId:T=null}=e,{bounds:C=null}=e,{scheme:N=null}=e,{attribution:B=null}=e,{minzoom:U=null}=e,{maxzoom:ee=null}=e,{volatile:ie=null}=e;if(x&&x.includes("pmtiles://")&&!Ls.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let ge=new Fk;Ls.addProtocol("pmtiles",ge.tile)}const{map:ae,self:J}=$v();Pt(s,ae,ge=>t(13,a=ge)),Pt(s,J,ge=>t(0,r=ge));let Y;return bo(()=>{r&&a&&(Jv(ae,r,Y),Dn(J,r=null,r),Y=void 0)}),s.$$set=ge=>{"id"in ge&&t(3,l=ge.id),"url"in ge&&t(4,x=ge.url),"tiles"in ge&&t(5,S=ge.tiles),"promoteId"in ge&&t(6,T=ge.promoteId),"bounds"in ge&&t(7,C=ge.bounds),"scheme"in ge&&t(8,N=ge.scheme),"attribution"in ge&&t(9,B=ge.attribution),"minzoom"in ge&&t(10,U=ge.minzoom),"maxzoom"in ge&&t(11,ee=ge.maxzoom),"volatile"in ge&&t(12,ie=ge.volatile),"$$scope"in ge&&t(14,m=ge.$$scope)},s.$$.update=()=>{s.$$.dirty&16377&&a&&r!==l&&(Dn(J,r=l,r),Yv(a,r,Rh({type:"vector",url:x,tiles:S,promoteId:T,bounds:C,scheme:N,attribution:B,minzoom:U,maxzoom:ee,volatile:ie}),ge=>a&&ge===r,()=>{r&&(Y=a==null?void 0:a.getSource(r))})),s.$$.dirty&8200&&(a==null||a.on("style.load",()=>{Y=a==null?void 0:a.getSource(l)}))},[r,ae,J,l,x,S,T,C,N,B,U,ee,ie,a,m,h]}class em extends fn{constructor(e){super(),hn(this,e,VI,qI,on,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const GI=s=>({}),cy=s=>({}),ZI=s=>({}),hy=s=>({}),HI=s=>({}),fy=s=>({}),XI=s=>({}),dy=s=>({});function WI(s){let e,t,r,a,h,m,l,x,S;const T=s[1].top,C=Zi(T,s,s[0],dy),N=s[1].left,B=Zi(N,s,s[0],fy),U=s[1].main,ee=Zi(U,s,s[0],hy),ie=s[1].right,ae=Zi(ie,s,s[0],cy);return{c(){e=le("div"),C&&C.c(),t=Oe(),r=le("div"),a=le("div"),B&&B.c(),h=Oe(),m=le("div"),ee&&ee.c(),l=Oe(),x=le("div"),ae&&ae.c(),Ze(e,"class","top svelte-11kzs8g"),Ze(a,"class","left svelte-11kzs8g"),Ze(m,"class","main svelte-11kzs8g"),Ze(x,"class","right svelte-11kzs8g"),Ze(r,"class","main-row svelte-11kzs8g")},m(J,Y){se(J,e,Y),C&&C.m(e,null),se(J,t,Y),se(J,r,Y),G(r,a),B&&B.m(a,null),G(r,h),G(r,m),ee&&ee.m(m,null),G(r,l),G(r,x),ae&&ae.m(x,null),S=!0},p(J,[Y]){C&&C.p&&(!S||Y&1)&&Xi(C,T,J,J[0],S?Hi(T,J[0],Y,XI):Wi(J[0]),dy),B&&B.p&&(!S||Y&1)&&Xi(B,N,J,J[0],S?Hi(N,J[0],Y,HI):Wi(J[0]),fy),ee&&ee.p&&(!S||Y&1)&&Xi(ee,U,J,J[0],S?Hi(U,J[0],Y,ZI):Wi(J[0]),hy),ae&&ae.p&&(!S||Y&1)&&Xi(ae,ie,J,J[0],S?Hi(ie,J[0],Y,GI):Wi(J[0]),cy)},i(J){S||(he(C,J),he(B,J),he(ee,J),he(ae,J),S=!0)},o(J){ke(C,J),ke(B,J),ke(ee,J),ke(ae,J),S=!1},d(J){J&&(re(e),re(t),re(r)),C&&C.d(J),B&&B.d(J),ee&&ee.d(J),ae&&ae.d(J)}}}function KI(s,e,t){let{$$slots:r={},$$scope:a}=e;return s.$$set=h=>{"$$scope"in h&&t(0,a=h.$$scope)},[a,r]}class $I extends fn{constructor(e){super(),hn(this,e,KI,WI,on,{})}}const YI=s=>({}),py=s=>({}),JI=s=>({}),my=s=>({}),QI=s=>({}),gy=s=>({});function eS(s){let e,t,r,a,h,m;const l=s[4].left,x=Zi(l,s,s[3],gy),S=s[4].map,T=Zi(S,s,s[3],my),C=s[4].right,N=Zi(C,s,s[3],py);return{c(){e=le("div"),x&&x.c(),t=Oe(),r=le("div"),T&&T.c(),a=Oe(),h=le("div"),N&&N.c()},m(B,U){se(B,e,U),x&&x.m(e,null),s[5](e),se(B,t,U),se(B,r,U),T&&T.m(r,null),s[6](r),se(B,a,U),se(B,h,U),N&&N.m(h,null),s[7](h),m=!0},p(B,[U]){x&&x.p&&(!m||U&8)&&Xi(x,l,B,B[3],m?Hi(l,B[3],U,QI):Wi(B[3]),gy),T&&T.p&&(!m||U&8)&&Xi(T,S,B,B[3],m?Hi(S,B[3],U,JI):Wi(B[3]),my),N&&N.p&&(!m||U&8)&&Xi(N,C,B,B[3],m?Hi(C,B[3],U,YI):Wi(B[3]),py)},i(B){m||(he(x,B),he(T,B),he(N,B),m=!0)},o(B){ke(x,B),ke(T,B),ke(N,B),m=!1},d(B){B&&(re(e),re(t),re(r),re(a),re(h)),x&&x.d(B),s[5](null),T&&T.d(B),s[6](null),N&&N.d(B),s[7](null)}}}function tS(s,e,t){let r,a,h;Pt(s,Rp,C=>t(0,r=C)),Pt(s,Dp,C=>t(1,a=C)),Pt(s,Pp,C=>t(2,h=C));let{$$slots:m={},$$scope:l}=e;function x(C){Jn[C?"unshift":"push"](()=>{r=C,Rp.set(r)})}function S(C){Jn[C?"unshift":"push"](()=>{a=C,Dp.set(a)})}function T(C){Jn[C?"unshift":"push"](()=>{h=C,Pp.set(h)})}return s.$$set=C=>{"$$scope"in C&&t(3,l=C.$$scope)},[r,a,h,l,m,x,S,T]}class gc extends fn{constructor(e){super(),hn(this,e,tS,eS,on,{})}}let Rp=Yn(null),Pp=Yn(null),Dp=Yn(null);function _y(s){let e,t;return{c(){e=le("div"),t=ze(s[0]),Ze(e,"class","svelte-1uuov7f")},m(r,a){se(r,e,a),G(e,t)},p(r,a){a&1&&Ct(t,r[0])},d(r){r&&re(e)}}}function nS(s){let e,t=s[0]&&_y(s);return{c(){t&&t.c(),e=Gn()},m(r,a){t&&t.m(r,a),se(r,e,a)},p(r,[a]){r[0]?t?t.p(r,a):(t=_y(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Je,o:Je,d(r){r&&re(e),t&&t.d(r)}}}function iS(s,e,t){let{loading:r}=e;return s.$$set=a=>{"loading"in a&&t(0,r=a.loading)},[r]}class rS extends fn{constructor(e){super(),hn(this,e,iS,nS,on,{loading:0})}}const sS=s=>({dialog:s&1}),yy=s=>({dialog:s[0]});function oS(s){let e,t,r,a,h;const m=s[4].default,l=Zi(m,s,s[3],yy);return{c(){e=le("dialog"),t=le("article"),l&&l.c(),e.open=!0},m(x,S){se(x,e,S),G(e,t),l&&l.m(t,null),s[6](e),r=!0,a||(h=[Mt(window,"click",s[1]),Mt(window,"keydown",s[2]),Mt(e,"close",s[5])],a=!0)},p(x,[S]){l&&l.p&&(!r||S&9)&&Xi(l,m,x,x[3],r?Hi(m,x[3],S,sS):Wi(x[3]),yy)},i(x){r||(he(l,x),r=!0)},o(x){ke(l,x),r=!1},d(x){x&&re(e),l&&l.d(x),s[6](null),a=!1,Ji(h)}}}function aS(s,e,t){let{$$slots:r={},$$scope:a}=e,h;function m(T){h.open&&T.target==h&&h.close()}function l(T){(T.key=="Escape"||T.key=="Enter")&&(T.stopPropagation(),h.close())}function x(T){ur.call(this,s,T)}function S(T){Jn[T?"unshift":"push"](()=>{h=T,t(0,h)})}return s.$$set=T=>{"$$scope"in T&&t(3,a=T.$$scope)},[h,m,l,a,r,x,S]}class e1 extends fn{constructor(e){super(),hn(this,e,aS,oS,on,{})}}function vy(s,e,t){const r=s.slice();return r[1]=e[t][0],r[2]=e[t][1],r}function by(s){let e,t,r=s[1]+"",a,h,m,l=s[2]+"",x,S;return{c(){e=le("tr"),t=le("td"),a=ze(r),h=Oe(),m=le("td"),x=ze(l),S=Oe()},m(T,C){se(T,e,C),G(e,t),G(t,a),G(e,h),G(e,m),G(m,x),G(e,S)},p(T,C){C&1&&r!==(r=T[1]+"")&&Ct(a,r),C&1&&l!==(l=T[2]+"")&&Ct(x,l)},d(T){T&&re(e)}}}function lS(s){let e,t,r=qn(Object.entries(s[0])),a=[];for(let h=0;h<r.length;h+=1)a[h]=by(vy(s,r,h));return{c(){e=le("table"),t=le("tbody");for(let h=0;h<a.length;h+=1)a[h].c();Ze(e,"class","svelte-lh2o9l")},m(h,m){se(h,e,m),G(e,t);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(t,null)},p(h,[m]){if(m&1){r=qn(Object.entries(h[0]));let l;for(l=0;l<r.length;l+=1){const x=vy(h,r,l);a[l]?a[l].p(x,m):(a[l]=by(x),a[l].c(),a[l].m(t,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=r.length}},i:Je,o:Je,d(h){h&&re(e),yr(a,h)}}}function uS(s,e,t){let{properties:r}=e;return s.$$set=a=>{"properties"in a&&t(0,r=a.properties)},[r]}class cS extends fn{constructor(e){super(),hn(this,e,uS,lS,on,{properties:0})}}function xy(s,e,t){const r=s.slice();return r[3]=e[t],r}function wy(s,e,t){const r=s.slice();return r[6]=e[t],r}function ky(s){let e,t;return{c(){e=le("span"),t=ze(`
    `),Rn(e,"background",s[6]),Rn(e,"width","100%"),Rn(e,"border","1px solid black")},m(r,a){se(r,e,a),G(e,t)},p(r,a){a&1&&Rn(e,"background",r[6])},d(r){r&&re(e)}}}function hS(s){let e,t=s[3]+"",r;return{c(){e=le("span"),r=ze(t)},m(a,h){se(a,e,h),G(e,r)},p(a,h){h&2&&t!==(t=a[3]+"")&&Ct(r,t)},d(a){a&&re(e)}}}function fS(s){let e,t=s[3].toFixed(s[2])+"",r;return{c(){e=le("span"),r=ze(t)},m(a,h){se(a,e,h),G(e,r)},p(a,h){h&6&&t!==(t=a[3].toFixed(a[2])+"")&&Ct(r,t)},d(a){a&&re(e)}}}function Iy(s){let e;function t(h,m){return h[2]>0?fS:hS}let r=t(s),a=r(s);return{c(){a.c(),e=Gn()},m(h,m){a.m(h,m),se(h,e,m)},p(h,m){r===(r=t(h))&&a?a.p(h,m):(a.d(1),a=r(h),a&&(a.c(),a.m(e.parentNode,e)))},d(h){h&&re(e),a.d(h)}}}function dS(s){let e,t,r,a=qn(s[0]),h=[];for(let x=0;x<a.length;x+=1)h[x]=ky(wy(s,a,x));let m=qn(s[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=Iy(xy(s,m,x));return{c(){e=le("div");for(let x=0;x<h.length;x+=1)h[x].c();t=Oe(),r=le("div");for(let x=0;x<l.length;x+=1)l[x].c();Rn(e,"display","flex"),Rn(r,"display","flex"),Rn(r,"justify-content","space-between")},m(x,S){se(x,e,S);for(let T=0;T<h.length;T+=1)h[T]&&h[T].m(e,null);se(x,t,S),se(x,r,S);for(let T=0;T<l.length;T+=1)l[T]&&l[T].m(r,null)},p(x,[S]){if(S&1){a=qn(x[0]);let T;for(T=0;T<a.length;T+=1){const C=wy(x,a,T);h[T]?h[T].p(C,S):(h[T]=ky(C),h[T].c(),h[T].m(e,null))}for(;T<h.length;T+=1)h[T].d(1);h.length=a.length}if(S&6){m=qn(x[1]);let T;for(T=0;T<m.length;T+=1){const C=xy(x,m,T);l[T]?l[T].p(C,S):(l[T]=Iy(C),l[T].c(),l[T].m(r,null))}for(;T<l.length;T+=1)l[T].d(1);l.length=m.length}},i:Je,o:Je,d(x){x&&(re(e),re(t),re(r)),yr(h,x),yr(l,x)}}}function pS(s,e,t){let{colorScale:r}=e,{limits:a}=e,{decimalPlaces:h=0}=e;return s.$$set=m=>{"colorScale"in m&&t(0,r=m.colorScale),"limits"in m&&t(1,a=m.limits),"decimalPlaces"in m&&t(2,h=m.decimalPlaces)},[r,a,h]}class tm extends fn{constructor(e){super(),hn(this,e,pS,dS,on,{colorScale:0,limits:1,decimalPlaces:2})}}function Il(s){if(s==null||s==null)throw new Error("Oops, notNull given something null");return s}let yt;const La=new Array(128).fill(void 0);La.push(void 0,null,!0,!1);function In(s){return La[s]}let Ih=La.length;function mS(s){s<132||(La[s]=Ih,Ih=s)}function Vi(s){const e=In(s);return mS(s),e}const t1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&t1.decode();let _h=null;function rc(){return(_h===null||_h.byteLength===0)&&(_h=new Uint8Array(yt.memory.buffer)),_h}function Gi(s,e){return s=s>>>0,t1.decode(rc().subarray(s,s+e))}function Mi(s){Ih===La.length&&La.push(La.length+1);const e=Ih;return Ih=La[e],La[e]=s,e}let Do=0;const Rf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},gS=typeof Rf.encodeInto=="function"?function(s,e){return Rf.encodeInto(s,e)}:function(s,e){const t=Rf.encode(s);return e.set(t),{read:s.length,written:t.length}};function nu(s,e,t){if(t===void 0){const l=Rf.encode(s),x=e(l.length,1)>>>0;return rc().subarray(x,x+l.length).set(l),Do=l.length,x}let r=s.length,a=e(r,1)>>>0;const h=rc();let m=0;for(;m<r;m++){const l=s.charCodeAt(m);if(l>127)break;h[a+m]=l}if(m!==r){m!==0&&(s=s.slice(m)),a=t(a,r,r=m+s.length*3,1)>>>0;const l=rc().subarray(a+m,a+r),x=gS(s,l);m+=x.written,a=t(a,r,m,1)>>>0}return Do=m,a}function eu(s){return s==null}let Ql=null;function Tt(){return(Ql===null||Ql.buffer.detached===!0||Ql.buffer.detached===void 0&&Ql.buffer!==yt.memory.buffer)&&(Ql=new DataView(yt.memory.buffer)),Ql}function Np(s){const e=typeof s;if(e=="number"||e=="boolean"||s==null)return`${s}`;if(e=="string")return`"${s}"`;if(e=="symbol"){const a=s.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=s.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(s)){const a=s.length;let h="[";a>0&&(h+=Np(s[0]));for(let m=1;m<a;m++)h+=", "+Np(s[m]);return h+="]",h}const t=/\[object ([^\]]+)\]/.exec(toString.call(s));let r;if(t.length>1)r=t[1];else return toString.call(s);if(r=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:r}function _S(s,e){const t=e(s.length*1,1)>>>0;return rc().set(s,t/1),Do=s.length,t}let yh=null;function yS(){return(yh===null||yh.byteLength===0)&&(yh=new Float64Array(yt.memory.buffer)),yh}function vS(s,e){return s=s>>>0,yS().subarray(s/8,s/8+e)}function bS(s,e){return s=s>>>0,rc().subarray(s/1,s/1+e)}function yl(s,e){try{return s.apply(this,e)}catch(t){yt.__wbindgen_exn_store(Mi(t))}}const Sy=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>yt.__wbg_mapmodel_free(s>>>0,1));class xS{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Sy.unregister(this),e}free(){const e=this.__destroy_into_raw();yt.__wbg_mapmodel_free(e,0)}constructor(e){try{const h=yt.__wbindgen_add_to_stack_pointer(-16),m=_S(e,yt.__wbindgen_malloc),l=Do;yt.mapmodel_new(h,m,l);var t=Tt().getInt32(h+4*0,!0),r=Tt().getInt32(h+4*1,!0),a=Tt().getInt32(h+4*2,!0);if(a)throw Vi(r);return this.__wbg_ptr=t>>>0,Sy.register(this,this.__wbg_ptr,this),this}finally{yt.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_renderDebug(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}getInvertedBoundary(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_getInvertedBoundary(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}getBounds(){try{const a=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_getBounds(a,this.__wbg_ptr);var e=Tt().getInt32(a+4*0,!0),t=Tt().getInt32(a+4*1,!0),r=vS(e,t).slice();return yt.__wbindgen_free(e,t*8,8),r}finally{yt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const a=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_toRouteSnapper(a,this.__wbg_ptr);var e=Tt().getInt32(a+4*0,!0),t=Tt().getInt32(a+4*1,!0),r=bS(e,t).slice();return yt.__wbindgen_free(e,t*1,1),r}finally{yt.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,t){try{const m=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_setRoute(m,this.__wbg_ptr,!eu(e),eu(e)?0:e,Mi(t));var r=Tt().getInt32(m+4*0,!0),a=Tt().getInt32(m+4*1,!0),h=Tt().getInt32(m+4*2,!0);if(h)throw Vi(a);return r>>>0}finally{yt.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const a=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_deleteRoute(a,this.__wbg_ptr,e);var t=Tt().getInt32(a+4*0,!0),r=Tt().getInt32(a+4*1,!0);if(r)throw Vi(t)}finally{yt.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){yt.mapmodel_clearAllRoutes(this.__wbg_ptr)}renderRoutes(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_renderRoutes(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}evaluateRoute(e){let t,r;try{const T=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_evaluateRoute(T,this.__wbg_ptr,Mi(e));var a=Tt().getInt32(T+4*0,!0),h=Tt().getInt32(T+4*1,!0),m=Tt().getInt32(T+4*2,!0),l=Tt().getInt32(T+4*3,!0),x=a,S=h;if(l)throw x=0,S=0,Vi(m);return t=x,r=S,Gi(x,S)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(t,r,1)}}debugReachablePath(e,t){let r,a;try{const C=yt.__wbindgen_add_to_stack_pointer(-16),N=nu(e,yt.__wbindgen_malloc,yt.__wbindgen_realloc),B=Do;yt.mapmodel_debugReachablePath(C,this.__wbg_ptr,N,B,t);var h=Tt().getInt32(C+4*0,!0),m=Tt().getInt32(C+4*1,!0),l=Tt().getInt32(C+4*2,!0),x=Tt().getInt32(C+4*3,!0),S=h,T=m;if(x)throw S=0,T=0,Vi(l);return r=S,a=T,Gi(S,T)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(r,a,1)}}debugUnreachablePath(e,t){let r,a;try{const C=yt.__wbindgen_add_to_stack_pointer(-16),N=nu(e,yt.__wbindgen_malloc,yt.__wbindgen_realloc),B=Do;yt.mapmodel_debugUnreachablePath(C,this.__wbg_ptr,N,B,t);var h=Tt().getInt32(C+4*0,!0),m=Tt().getInt32(C+4*1,!0),l=Tt().getInt32(C+4*2,!0),x=Tt().getInt32(C+4*3,!0),S=h,T=m;if(x)throw S=0,T=0,Vi(l);return r=S,a=T,Gi(S,T)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(r,a,1)}}evaluateOD(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_evaluateOD(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}recalculateStats(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_recalculateStats(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_toSavefile(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const a=yt.__wbindgen_add_to_stack_pointer(-16),h=nu(e,yt.__wbindgen_malloc,yt.__wbindgen_realloc),m=Do;yt.mapmodel_loadSavefile(a,this.__wbg_ptr,h,m);var t=Tt().getInt32(a+4*0,!0),r=Tt().getInt32(a+4*1,!0);if(r)throw Vi(t)}finally{yt.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_meshDensity(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}classifyExistingNetwork(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_classifyExistingNetwork(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}importExistingRoutes(){return yt.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return yt.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_getSchools(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}getGPHospitals(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_getGPHospitals(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}getTownCentres(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_getTownCentres(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}getDataZones(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_getDataZones(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}renderReachableNetwork(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_renderReachableNetwork(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}renderLevelOfService(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_renderLevelOfService(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}renderCoreNetwork(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_renderCoreNetwork(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}renderPrecalculatedFlows(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_renderPrecalculatedFlows(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}getMajorJunctions(){let e,t;try{const S=yt.__wbindgen_add_to_stack_pointer(-16);yt.mapmodel_getMajorJunctions(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,t=x,Gi(l,x)}finally{yt.__wbindgen_add_to_stack_pointer(16),yt.__wbindgen_free(e,t,1)}}}async function wS(s,e){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,e)}catch(r){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await s.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(s,e);return t instanceof WebAssembly.Instance?{instance:t,module:s}:t}}function kS(){const s={};return s.wbg={},s.wbg.__wbindgen_object_drop_ref=function(e){Vi(e)},s.wbg.__wbindgen_string_new=function(e,t){const r=Gi(e,t);return Mi(r)},s.wbg.__wbindgen_string_get=function(e,t){const r=In(t),a=typeof r=="string"?r:void 0;var h=eu(a)?0:nu(a,yt.__wbindgen_malloc,yt.__wbindgen_realloc),m=Do;Tt().setInt32(e+4*1,m,!0),Tt().setInt32(e+4*0,h,!0)},s.wbg.__wbindgen_number_get=function(e,t){const r=In(t),a=typeof r=="number"?r:void 0;Tt().setFloat64(e+8*1,eu(a)?0:a,!0),Tt().setInt32(e+4*0,!eu(a),!0)},s.wbg.__wbindgen_error_new=function(e,t){const r=new Error(Gi(e,t));return Mi(r)},s.wbg.__wbindgen_boolean_get=function(e){const t=In(e);return typeof t=="boolean"?t?1:0:2},s.wbg.__wbindgen_is_bigint=function(e){return typeof In(e)=="bigint"},s.wbg.__wbindgen_is_object=function(e){const t=In(e);return typeof t=="object"&&t!==null},s.wbg.__wbindgen_in=function(e,t){return In(e)in In(t)},s.wbg.__wbindgen_bigint_from_i64=function(e){return Mi(e)},s.wbg.__wbindgen_jsval_eq=function(e,t){return In(e)===In(t)},s.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Mi(t)},s.wbg.__wbindgen_is_string=function(e){return typeof In(e)=="string"},s.wbg.__wbindgen_is_undefined=function(e){return In(e)===void 0},s.wbg.__wbindgen_jsval_loose_eq=function(e,t){return In(e)==In(t)},s.wbg.__wbindgen_as_number=function(e){return+In(e)},s.wbg.__wbg_String_b9412f8799faab3e=function(e,t){const r=String(In(t)),a=nu(r,yt.__wbindgen_malloc,yt.__wbindgen_realloc),h=Do;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},s.wbg.__wbindgen_object_clone_ref=function(e){const t=In(e);return Mi(t)},s.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,t){const r=In(e)[In(t)];return Mi(r)},s.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(In(e))},s.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(In(e))},s.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(In(e))},s.wbg.__wbg_log_b103404cc5920657=function(e){console.log(In(e))},s.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(In(e))},s.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Mi(e)},s.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=In(t).stack,a=nu(r,yt.__wbindgen_malloc,yt.__wbindgen_realloc),h=Do;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},s.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,a;try{r=e,a=t,console.error(Gi(e,t))}finally{yt.__wbindgen_free(r,a,1)}},s.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const t=In(e).performance;return Mi(t)},s.wbg.__wbg_now_abd80e969af37148=function(e){return In(e).now()},s.wbg.__wbg_get_3baa728f9d58d3f6=function(e,t){const r=In(e)[t>>>0];return Mi(r)},s.wbg.__wbg_length_ae22078168b726f5=function(e){return In(e).length},s.wbg.__wbindgen_is_function=function(e){return typeof In(e)=="function"},s.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,t){const r=new Function(Gi(e,t));return Mi(r)},s.wbg.__wbg_next_de3e9db4440638b2=function(e){const t=In(e).next;return Mi(t)},s.wbg.__wbg_next_f9cb570345655b9a=function(){return yl(function(e){const t=In(e).next();return Mi(t)},arguments)},s.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return In(e).done},s.wbg.__wbg_value_6d39332ab4788d86=function(e){const t=In(e).value;return Mi(t)},s.wbg.__wbg_iterator_888179a48810a9fe=function(){return Mi(Symbol.iterator)},s.wbg.__wbg_get_224d16597dbbfd96=function(){return yl(function(e,t){const r=Reflect.get(In(e),In(t));return Mi(r)},arguments)},s.wbg.__wbg_call_1084a111329e68ce=function(){return yl(function(e,t){const r=In(e).call(In(t));return Mi(r)},arguments)},s.wbg.__wbg_self_3093d5d1f7bcb682=function(){return yl(function(){const e=self.self;return Mi(e)},arguments)},s.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return yl(function(){const e=window.window;return Mi(e)},arguments)},s.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return yl(function(){const e=globalThis.globalThis;return Mi(e)},arguments)},s.wbg.__wbg_global_e5a3fe56f8be9485=function(){return yl(function(){const e=global.global;return Mi(e)},arguments)},s.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(In(e))},s.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let t;try{t=In(e)instanceof ArrayBuffer}catch{t=!1}return t},s.wbg.__wbg_call_89af060b4e1523f2=function(){return yl(function(e,t,r){const a=In(e).call(In(t),In(r));return Mi(a)},arguments)},s.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let t;try{t=In(e)instanceof Map}catch{t=!1}return t},s.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(In(e))},s.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const t=Object.entries(In(e));return Mi(t)},s.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const t=In(e).buffer;return Mi(t)},s.wbg.__wbg_new_ea1883e1e5e86686=function(e){const t=new Uint8Array(In(e));return Mi(t)},s.wbg.__wbg_set_d1e79e2388520f18=function(e,t,r){In(e).set(In(t),r>>>0)},s.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return In(e).length},s.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let t;try{t=In(e)instanceof Uint8Array}catch{t=!1}return t},s.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const r=In(t),a=typeof r=="bigint"?r:void 0;Tt().setBigInt64(e+8*1,eu(a)?BigInt(0):a,!0),Tt().setInt32(e+4*0,!eu(a),!0)},s.wbg.__wbindgen_debug_string=function(e,t){const r=Np(In(t)),a=nu(r,yt.__wbindgen_malloc,yt.__wbindgen_realloc),h=Do;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},s.wbg.__wbindgen_throw=function(e,t){throw new Error(Gi(e,t))},s.wbg.__wbindgen_memory=function(){const e=yt.memory;return Mi(e)},s}function IS(s,e){return yt=s.exports,n1.__wbindgen_wasm_module=e,Ql=null,yh=null,_h=null,yt}async function n1(s){if(yt!==void 0)return yt;typeof s<"u"&&Object.getPrototypeOf(s)===Object.prototype?{module_or_path:s}=s:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof s>"u"&&(s=new URL("backend_bg.wasm",self.location));const e=kS();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:t,module:r}=await wS(await s,e);return IS(t,r)}class SS{constructor(){lh(this,"inner");this.inner=null}async loadFile(e){await n1(),this.inner=new xS(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,t){return this.checkReady(),this.inner.setRoute(e??void 0,t)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,t))}debugUnreachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,t))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let i1="MZEJTanw3WpxRvt7qDfo",Hf=Yn(""),Oi=Yn({kind:"main"}),Ma=Yn("Primary"),ES=Yn(null),Ph=Yn(0),Yi=Yn(null),Qu=Yn(null),Sh=Yn(null),zp=Yn("infra_type"),nm=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],ou=Object.fromEntries(nm.map(([s,e,t])=>[s,[e,t]]));async function Dh(){let s=Df(Yi),e=Df(Hf);if(!s||!e)return;let t=await s.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,t)}let Fp=Yn(!0);function sd(s){return Df(Fp)?`https://assets.od2net.org/tmp_npt_editor/${s}`:s}let Ey=Yn(null);function AS(s){let e,t,r,a,h,m,l,x;return{c(){e=le("div"),t=le("h2"),t.textContent="Debug network mode",r=Oe(),a=le("button"),a.textContent="Back",h=Oe(),m=le("p"),m.textContent="Hover to see a segment's properties, and click to open OSM",Ze(e,"slot","left")},m(S,T){se(S,e,T),G(e,t),G(e,r),G(e,a),G(e,h),G(e,m),l||(x=Mt(a,"click",s[3]),l=!0)},p:Je,d(S){S&&re(e),l=!1,x()}}}function TS(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function CS(s){let e,t;return e=new $i({props:{data:s[4],generateId:!0,$$slots:{default:[RS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.data=r[4]),a&64&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function LS(s){let e,t;return e=new cS({props:{properties:s[5]}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&32&&(h.properties=r[5]),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function MS(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[LS,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&96&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function RS(s){let e,t;return e=new cr({props:{id:"network",paint:{"line-width":zr(5,7),"line-color":"black"},manageHoverState:!0,hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[MS]},$$scope:{ctx:s}}}),e.$on("click",s[2]),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&64&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function PS(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function DS(s){let e,t,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:PS,then:CS,catch:TS,value:4,blocks:[,,,]};return Xr(t=Il(s[0]).renderDebug(),a),{c(){e=le("div"),a.block.c(),Ze(e,"slot","map")},m(h,m){se(h,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,r=!0},p(h,m){s=h,a.ctx=s,m&1&&t!==(t=Il(s[0]).renderDebug())&&Xr(t,a)||Oa(a,s,m)},i(h){r||(he(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];ke(l)}r=!1},d(h){h&&re(e),a.block.d(),a.token=null,a=null}}}function NS(s){let e,t;return e=new gc({props:{$$slots:{map:[DS],left:[AS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,[a]){const h={};a&67&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function zS(s,e,t){let r,a;return Pt(s,Yi,l=>t(0,r=l)),Pt(s,Oi,l=>t(1,a=l)),[r,a,l=>window.open(Il(l.detail.features[0].properties).way,"_blank"),()=>Dn(Oi,a={kind:"main"},a)]}class FS extends fn{constructor(e){super(),hn(this,e,zS,NS,on,{})}}function OS(s){let e,t,r,a,h,m;return{c(){e=le("div"),t=le("h2"),t.textContent="Debug mesh density mode",r=Oe(),a=le("button"),a.textContent="Back",Ze(e,"slot","left")},m(l,x){se(l,e,x),G(e,t),G(e,r),G(e,a),h||(m=Mt(a,"click",s[2]),h=!0)},p:Je,d(l){l&&re(e),h=!1,m()}}}function BS(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function US(s){let e,t;return e=new $i({props:{data:s[3],generateId:!0,$$slots:{default:[jS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.data=r[3]),a&16&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function jS(s){let e,t,r,a;return e=new cr({props:{paint:{"line-color":"black"}}}),r=new mc({props:{paint:{"fill-color":"grey","fill-opacity":zr(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p:Je,i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function qS(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function VS(s){let e,t,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:qS,then:US,catch:BS,value:3,blocks:[,,,]};return Xr(t=Il(s[0]).meshDensity(),a),{c(){e=le("div"),a.block.c(),Ze(e,"slot","map")},m(h,m){se(h,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,r=!0},p(h,m){s=h,a.ctx=s,m&1&&t!==(t=Il(s[0]).meshDensity())&&Xr(t,a)||Oa(a,s,m)},i(h){r||(he(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];ke(l)}r=!1},d(h){h&&re(e),a.block.d(),a.token=null,a=null}}}function GS(s){let e,t;return e=new gc({props:{$$slots:{map:[VS],left:[OS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,[a]){const h={};a&19&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function ZS(s,e,t){let r,a;return Pt(s,Yi,m=>t(0,r=m)),Pt(s,Oi,m=>t(1,a=m)),[r,a,()=>Dn(Oi,a={kind:"main"},a)]}class HS extends fn{constructor(e){super(),hn(this,e,ZS,GS,on,{})}}let r1=Yn(new Map),Op=Yn(!0),Xf=Yn(!1),Wf=Yn(!1),Kf=Yn(!1),$f=Yn(!1),Yf=Yn(!1),ec=Yn(!1),Bp=Yn(!0),Ay=Yn(!1);function XS(s){let e,t,r,a;const h=s[1].default,m=Zi(h,s,s[0],null);return{c(){e=le("a"),m&&m.c(),Ze(e,"href","#")},m(l,x){se(l,e,x),m&&m.m(e,null),t=!0,r||(a=Mt(e,"click",Nh(s[2])),r=!0)},p(l,[x]){m&&m.p&&(!t||x&1)&&Xi(m,h,l,l[0],t?Hi(h,l[0],x,null):Wi(l[0]),null)},i(l){t||(he(m,l),t=!0)},o(l){ke(m,l),t=!1},d(l){l&&re(e),m&&m.d(l),r=!1,a()}}}function WS(s,e,t){let{$$slots:r={},$$scope:a}=e;function h(m){ur.call(this,s,m)}return s.$$set=m=>{"$$scope"in m&&t(0,a=m.$$scope)},[a,r,h]}class KS extends fn{constructor(e){super(),hn(this,e,WS,XS,on,{})}}let Nr={Primary:"#c00000",Secondary:"#e97132",LocalAccess:"#ffc000",LongDistance:"#4ea72e"},im={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},au=rd(["get","infra_type"],Object.fromEntries(nm.map(s=>[s[0],s[2]])),"red"),Up=rd(["get","tier"],Nr,"cyan"),jp=rd(["get","los"],im,"black");function Ty(s){let e,t,r,a,h=`2px solid ${Nr.Primary}`;return{c(){e=le("details"),t=le("summary"),t.textContent="Primary Route Reference Layers",r=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){se(m,e,l),G(e,t),G(e,r),G(e,a),s[8](a)},p:Je,d(m){m&&re(e),s[8](null)}}}function Cy(s){let e,t,r,a,h=`2px solid ${Nr.Secondary}`;return{c(){e=le("details"),t=le("summary"),t.textContent="Secondary Route Reference Layers",r=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){se(m,e,l),G(e,t),G(e,r),G(e,a),s[9](a)},p:Je,d(m){m&&re(e),s[9](null)}}}function Ly(s){let e,t,r,a,h=`2px solid ${Nr.LocalAccess}`;return{c(){e=le("details"),t=le("summary"),t.textContent="Local Access Route Reference Layers",r=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){se(m,e,l),G(e,t),G(e,r),G(e,a),s[10](a)},p:Je,d(m){m&&re(e),s[10](null)}}}function My(s){let e,t,r,a,h=`2px solid ${Nr.LongDistance}`;return{c(){e=le("details"),t=le("summary"),t.textContent="Long Disance Route Reference Layers",r=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){se(m,e,l),G(e,t),G(e,r),G(e,a),s[11](a)},p:Je,d(m){m&&re(e),s[11](null)}}}function $S(s){let e,t,r,a,h,m,l,x,S,T=s[5]=="Primary"&&Ty(s),C=s[5]=="Secondary"&&Cy(s),N=s[5]=="LocalAccess"&&Ly(s),B=s[5]=="LongDistance"&&My(s);return{c(){e=le("details"),t=le("summary"),t.textContent="Basic Reference Layers",r=Oe(),a=le("div"),h=Oe(),T&&T.c(),m=Oe(),C&&C.c(),l=Oe(),N&&N.c(),x=Oe(),B&&B.c(),S=Gn(),e.open=!0,Rn(e,"border","2px solid black")},m(U,ee){se(U,e,ee),G(e,t),G(e,r),G(e,a),s[7](a),se(U,h,ee),T&&T.m(U,ee),se(U,m,ee),C&&C.m(U,ee),se(U,l,ee),N&&N.m(U,ee),se(U,x,ee),B&&B.m(U,ee),se(U,S,ee)},p(U,[ee]){U[5]=="Primary"?T?T.p(U,ee):(T=Ty(U),T.c(),T.m(m.parentNode,m)):T&&(T.d(1),T=null),U[5]=="Secondary"?C?C.p(U,ee):(C=Cy(U),C.c(),C.m(l.parentNode,l)):C&&(C.d(1),C=null),U[5]=="LocalAccess"?N?N.p(U,ee):(N=Ly(U),N.c(),N.m(x.parentNode,x)):N&&(N.d(1),N=null),U[5]=="LongDistance"?B?B.p(U,ee):(B=My(U),B.c(),B.m(S.parentNode,S)):B&&(B.d(1),B=null)},i:Je,o:Je,d(U){U&&(re(e),re(h),re(m),re(l),re(x),re(S)),s[7](null),T&&T.d(U),C&&C.d(U),N&&N.d(U),B&&B.d(U)}}}function ph(s,e,t){if(s){s.innerHTML="";for(let r of t){let a=e.get(r);a&&s.appendChild(a)}}}function YS(s,e,t){let r,a;Pt(s,r1,ee=>t(6,r=ee)),Pt(s,Ma,ee=>t(5,a=ee));let h=null,m=null,l=null,x=null,S=null;function T(ee){Jn[ee?"unshift":"push"](()=>{h=ee,t(0,h)})}function C(ee){Jn[ee?"unshift":"push"](()=>{m=ee,t(1,m)})}function N(ee){Jn[ee?"unshift":"push"](()=>{l=ee,t(2,l)})}function B(ee){Jn[ee?"unshift":"push"](()=>{x=ee,t(3,x)})}function U(ee){Jn[ee?"unshift":"push"](()=>{S=ee,t(4,S)})}return s.$$.update=()=>{s.$$.dirty&65&&ph(h,r,["route network","simd","population density","core network","existing network","level of service","traffic volume","gradient","reachable network"]),s.$$.dirty&66&&ph(m,r,["high npt route coverage"]),s.$$.dirty&68&&ph(l,r,["town centres"]),s.$$.dirty&72&&ph(x,r,["schools","gp hospitals"]),s.$$.dirty&80&&ph(S,r,["urban areas"])},[h,m,l,x,S,a,r,T,C,N,B,U]}class JS extends fn{constructor(e){super(),hn(this,e,YS,$S,on,{})}}function QS(s){let e,t,r,a,h,m=Math.round(s[2]*100)+"",l,x,S,T,C,N,B;return{c(){e=le("p"),t=le("a"),r=ze(s[1]),a=ze(`
  :
  `),h=le("b"),l=ze(m),x=ze("%"),S=Oe(),T=le("progress"),Ze(t,"href","#"),T.value=C=s[2]*100,Ze(T,"max","100")},m(U,ee){se(U,e,ee),G(e,t),G(t,r),G(e,a),G(e,h),G(h,l),G(h,x),G(e,S),G(e,T),N||(B=Mt(t,"click",Nh(s[3])),N=!0)},p(U,[ee]){ee&2&&Ct(r,U[1]),ee&4&&m!==(m=Math.round(U[2]*100)+"")&&Ct(l,m),ee&4&&C!==(C=U[2]*100)&&(T.value=C)},i:Je,o:Je,d(U){U&&re(e),N=!1,B()}}}function eE(s,e,t){let{label:r}=e,{showLayer:a}=e,{pct:h}=e;const m=()=>t(0,a=!0);return s.$$set=l=>{"label"in l&&t(1,r=l.label),"showLayer"in l&&t(0,a=l.showLayer),"pct"in l&&t(2,h=l.pct)},[a,r,h,m]}class Ra extends fn{constructor(e){super(),hn(this,e,eE,QS,on,{label:1,showLayer:0,pct:2})}}function Ry(s,e,t){const r=s.slice();return r[22]=e[t][0],r[23]=e[t][1],r}function Py(s,e,t){const r=s.slice();return r[22]=e[t][0],r[23]=e[t][1],r}function Dy(s){let e,t,r,a=`2px solid ${Nr.Primary}`,h,m,l,x,S,T,C,N,B=s[0].average_weighted_directness.toFixed(1)+"",U,ee,ie,ae,J,Y,ge,xe,Ee,ye,be,ve,Ce,we,_e;function tt(pt){s[11](pt)}let Ve={label:"High cycling flow coverage",pct:lc(s[0].covered_flow_quintile_sums[0],s[0].total_flow_quintile_sums[0])};s[1]!==void 0&&(Ve.showLayer=s[1]),t=new Ra({props:Ve}),Jn.push(()=>_r(t,"showLayer",tt));let qe=(s[2]=="Secondary"||s[2]=="LocalAccess"||s[2]=="LongDistance")&&Ny(s),dt=(s[2]=="LocalAccess"||s[2]=="LongDistance")&&zy(s),mt=s[2]=="LongDistance"&&Fy(s),ct=qn(Object.entries(s[0].od_percents_infra_type).toSorted(Uy)),Ut=[];for(let pt=0;pt<ct.length;pt+=1)Ut[pt]=Oy(Py(s,ct,pt));let bt=qn(Object.entries(s[0].od_percents_los).toSorted(jy)),It=[];for(let pt=0;pt<bt.length;pt+=1)It[pt]=By(Ry(s,bt,pt));return{c(){e=le("div"),ot(t.$$.fragment),h=Oe(),qe&&qe.c(),m=Oe(),dt&&dt.c(),l=Oe(),mt&&mt.c(),x=Oe(),S=le("div"),T=le("p"),C=le("a"),C.textContent="Average weighted directness",N=ze(`
      : `),U=ze(B),ee=ze("x"),ie=Oe(),ae=le("details"),J=le("summary"),J.textContent="Percent of demand by infrastructure type",Y=Oe(),ge=le("ul");for(let pt=0;pt<Ut.length;pt+=1)Ut[pt].c();xe=Oe(),Ee=le("details"),ye=le("summary"),ye.textContent="Percent of demand by level of service:",be=Oe(),ve=le("ul");for(let pt=0;pt<It.length;pt+=1)It[pt].c();Rn(e,"border",a),Ze(C,"href","#"),Rn(S,"margin-top","4px"),Rn(S,"border","2px solid black")},m(pt,kt){se(pt,e,kt),rt(t,e,null),se(pt,h,kt),qe&&qe.m(pt,kt),se(pt,m,kt),dt&&dt.m(pt,kt),se(pt,l,kt),mt&&mt.m(pt,kt),se(pt,x,kt),se(pt,S,kt),G(S,T),G(T,C),G(T,N),G(T,U),G(T,ee),G(S,ie),G(S,ae),G(ae,J),G(ae,Y),G(ae,ge);for(let St=0;St<Ut.length;St+=1)Ut[St]&&Ut[St].m(ge,null);G(S,xe),G(S,Ee),G(Ee,ye),G(Ee,be),G(Ee,ve);for(let St=0;St<It.length;St+=1)It[St]&&It[St].m(ve,null);Ce=!0,we||(_e=Mt(C,"click",Nh(s[20])),we=!0)},p(pt,kt){const St={};if(kt&1&&(St.pct=lc(pt[0].covered_flow_quintile_sums[0],pt[0].total_flow_quintile_sums[0])),!r&&kt&2&&(r=!0,St.showLayer=pt[1],gr(()=>r=!1)),t.$set(St),pt[2]=="Secondary"||pt[2]=="LocalAccess"||pt[2]=="LongDistance"?qe?(qe.p(pt,kt),kt&4&&he(qe,1)):(qe=Ny(pt),qe.c(),he(qe,1),qe.m(m.parentNode,m)):qe&&(Nn(),ke(qe,1,1,()=>{qe=null}),zn()),pt[2]=="LocalAccess"||pt[2]=="LongDistance"?dt?(dt.p(pt,kt),kt&4&&he(dt,1)):(dt=zy(pt),dt.c(),he(dt,1),dt.m(l.parentNode,l)):dt&&(Nn(),ke(dt,1,1,()=>{dt=null}),zn()),pt[2]=="LongDistance"?mt?(mt.p(pt,kt),kt&4&&he(mt,1)):(mt=Fy(pt),mt.c(),he(mt,1),mt.m(x.parentNode,x)):mt&&(Nn(),ke(mt,1,1,()=>{mt=null}),zn()),(!Ce||kt&1)&&B!==(B=pt[0].average_weighted_directness.toFixed(1)+"")&&Ct(U,B),kt&1){ct=qn(Object.entries(pt[0].od_percents_infra_type).toSorted(Uy));let $t;for($t=0;$t<ct.length;$t+=1){const pn=Py(pt,ct,$t);Ut[$t]?Ut[$t].p(pn,kt):(Ut[$t]=Oy(pn),Ut[$t].c(),Ut[$t].m(ge,null))}for(;$t<Ut.length;$t+=1)Ut[$t].d(1);Ut.length=ct.length}if(kt&1){bt=qn(Object.entries(pt[0].od_percents_los).toSorted(jy));let $t;for($t=0;$t<bt.length;$t+=1){const pn=Ry(pt,bt,$t);It[$t]?It[$t].p(pn,kt):(It[$t]=By(pn),It[$t].c(),It[$t].m(ve,null))}for(;$t<It.length;$t+=1)It[$t].d(1);It.length=bt.length}},i(pt){Ce||(he(t.$$.fragment,pt),he(qe),he(dt),he(mt),Ce=!0)},o(pt){ke(t.$$.fragment,pt),ke(qe),ke(dt),ke(mt),Ce=!1},d(pt){pt&&(re(e),re(h),re(m),re(l),re(x),re(S)),st(t),qe&&qe.d(pt),dt&&dt.d(pt),mt&&mt.d(pt),yr(Ut,pt),yr(It,pt),we=!1,_e()}}}function Ny(s){let e,t,r,a,h,m,l=`2px solid ${Nr.Secondary}`,x;function S(B){s[12](B)}let T={label:"Medium cycling flow coverage",pct:lc(s[0].covered_flow_quintile_sums[1],s[0].total_flow_quintile_sums[1])};s[1]!==void 0&&(T.showLayer=s[1]),t=new Ra({props:T}),Jn.push(()=>_r(t,"showLayer",S));function C(B){s[13](B)}let N={label:"Town centres",pct:s[0].percent_reachable_town_centres};return s[3]!==void 0&&(N.showLayer=s[3]),h=new Ra({props:N}),Jn.push(()=>_r(h,"showLayer",C)),{c(){e=le("div"),ot(t.$$.fragment),a=Oe(),ot(h.$$.fragment),Rn(e,"margin-top","4px"),Rn(e,"border",l)},m(B,U){se(B,e,U),rt(t,e,null),G(e,a),rt(h,e,null),x=!0},p(B,U){const ee={};U&1&&(ee.pct=lc(B[0].covered_flow_quintile_sums[1],B[0].total_flow_quintile_sums[1])),!r&&U&2&&(r=!0,ee.showLayer=B[1],gr(()=>r=!1)),t.$set(ee);const ie={};U&1&&(ie.pct=B[0].percent_reachable_town_centres),!m&&U&8&&(m=!0,ie.showLayer=B[3],gr(()=>m=!1)),h.$set(ie)},i(B){x||(he(t.$$.fragment,B),he(h.$$.fragment,B),x=!0)},o(B){ke(t.$$.fragment,B),ke(h.$$.fragment,B),x=!1},d(B){B&&re(e),st(t),st(h)}}}function zy(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie=`2px solid ${Nr.LocalAccess}`,ae;function J(_e){s[14](_e)}let Y={label:"Low cycling flow coverage",pct:lc(s[0].covered_flow_quintile_sums[2],s[0].total_flow_quintile_sums[2])};s[1]!==void 0&&(Y.showLayer=s[1]),t=new Ra({props:Y}),Jn.push(()=>_r(t,"showLayer",J));function ge(_e){s[15](_e)}let xe={label:"Schools",pct:s[0].percent_reachable_schools};s[4]!==void 0&&(xe.showLayer=s[4]),h=new Ra({props:xe}),Jn.push(()=>_r(h,"showLayer",ge));function Ee(_e){s[16](_e)}let ye={label:"GPs and hospitals",pct:s[0].percent_reachable_gp_hospitals};s[5]!==void 0&&(ye.showLayer=s[5]),x=new Ra({props:ye}),Jn.push(()=>_r(x,"showLayer",Ee));function be(_e){s[17](_e)}let ve={label:"Deprived population coverage",pct:s[0].percent_reachable_imd_population};s[6]!==void 0&&(ve.showLayer=s[6]),C=new Ra({props:ve}),Jn.push(()=>_r(C,"showLayer",be));function Ce(_e){s[18](_e)}let we={label:"Population coverage",pct:s[0].percent_reachable_population};return s[7]!==void 0&&(we.showLayer=s[7]),U=new Ra({props:we}),Jn.push(()=>_r(U,"showLayer",Ce)),{c(){e=le("div"),ot(t.$$.fragment),a=Oe(),ot(h.$$.fragment),l=Oe(),ot(x.$$.fragment),T=Oe(),ot(C.$$.fragment),B=Oe(),ot(U.$$.fragment),Rn(e,"margin-top","4px"),Rn(e,"border",ie)},m(_e,tt){se(_e,e,tt),rt(t,e,null),G(e,a),rt(h,e,null),G(e,l),rt(x,e,null),G(e,T),rt(C,e,null),G(e,B),rt(U,e,null),ae=!0},p(_e,tt){const Ve={};tt&1&&(Ve.pct=lc(_e[0].covered_flow_quintile_sums[2],_e[0].total_flow_quintile_sums[2])),!r&&tt&2&&(r=!0,Ve.showLayer=_e[1],gr(()=>r=!1)),t.$set(Ve);const qe={};tt&1&&(qe.pct=_e[0].percent_reachable_schools),!m&&tt&16&&(m=!0,qe.showLayer=_e[4],gr(()=>m=!1)),h.$set(qe);const dt={};tt&1&&(dt.pct=_e[0].percent_reachable_gp_hospitals),!S&&tt&32&&(S=!0,dt.showLayer=_e[5],gr(()=>S=!1)),x.$set(dt);const mt={};tt&1&&(mt.pct=_e[0].percent_reachable_imd_population),!N&&tt&64&&(N=!0,mt.showLayer=_e[6],gr(()=>N=!1)),C.$set(mt);const ct={};tt&1&&(ct.pct=_e[0].percent_reachable_population),!ee&&tt&128&&(ee=!0,ct.showLayer=_e[7],gr(()=>ee=!1)),U.$set(ct)},i(_e){ae||(he(t.$$.fragment,_e),he(h.$$.fragment,_e),he(x.$$.fragment,_e),he(C.$$.fragment,_e),he(U.$$.fragment,_e),ae=!0)},o(_e){ke(t.$$.fragment,_e),ke(h.$$.fragment,_e),ke(x.$$.fragment,_e),ke(C.$$.fragment,_e),ke(U.$$.fragment,_e),ae=!1},d(_e){_e&&re(e),st(t),st(h),st(x),st(C),st(U)}}}function Fy(s){let e,t,r,a=`2px solid ${Nr.LongDistance}`,h;function m(x){s[19](x)}let l={label:"Reachable settlements (TODO)",pct:0};return s[8]!==void 0&&(l.showLayer=s[8]),t=new Ra({props:l}),Jn.push(()=>_r(t,"showLayer",m)),{c(){e=le("div"),ot(t.$$.fragment),Rn(e,"margin-top","4px"),Rn(e,"border",a)},m(x,S){se(x,e,S),rt(t,e,null),h=!0},p(x,S){const T={};!r&&S&256&&(r=!0,T.showLayer=x[8],gr(()=>r=!1)),t.$set(T)},i(x){h||(he(t.$$.fragment,x),h=!0)},o(x){ke(t.$$.fragment,x),h=!1},d(x){x&&re(e),st(t)}}}function Oy(s){let e,t=s[22]+"",r,a,h=Math.round(s[23]*100)+"",m,l;return{c(){e=le("li"),r=ze(t),a=ze(": "),m=ze(h),l=ze("%")},m(x,S){se(x,e,S),G(e,r),G(e,a),G(e,m),G(e,l)},p(x,S){S&1&&t!==(t=x[22]+"")&&Ct(r,t),S&1&&h!==(h=Math.round(x[23]*100)+"")&&Ct(m,h)},d(x){x&&re(e)}}}function By(s){let e,t=s[22]+"",r,a,h=Math.round(s[23]*100)+"",m,l;return{c(){e=le("li"),r=ze(t),a=ze(": "),m=ze(h),l=ze("%")},m(x,S){se(x,e,S),G(e,r),G(e,a),G(e,m),G(e,l)},p(x,S){S&1&&t!==(t=x[22]+"")&&Ct(r,t),S&1&&h!==(h=Math.round(x[23]*100)+"")&&Ct(m,h)},d(x){x&&re(e)}}}function tE(s){let e,t,r,a,h,m,l=s[0]&&Dy(s);return{c(){e=le("button"),e.textContent="Recalculate",t=Oe(),l&&l.c(),r=Gn()},m(x,S){se(x,e,S),se(x,t,S),l&&l.m(x,S),se(x,r,S),a=!0,h||(m=Mt(e,"click",s[10]),h=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&he(l,1)):(l=Dy(x),l.c(),he(l,1),l.m(r.parentNode,r)):l&&(Nn(),ke(l,1,1,()=>{l=null}),zn())},i(x){a||(he(l),a=!0)},o(x){ke(l),a=!1},d(x){x&&(re(e),re(t),re(r)),l&&l.d(x),h=!1,m()}}}function lc(s,e){return e==0?0:s/e}const Uy=(s,e)=>e[1]-s[1],jy=(s,e)=>e[1]-s[1];function nE(s,e,t){let r,a,h,m,l,x,S,T,C,N,B;Pt(s,Ey,ve=>t(0,r=ve)),Pt(s,Yi,ve=>t(21,a=ve)),Pt(s,ec,ve=>t(1,h=ve)),Pt(s,Ma,ve=>t(2,m=ve)),Pt(s,Kf,ve=>t(3,l=ve)),Pt(s,Xf,ve=>t(4,x=ve)),Pt(s,Wf,ve=>t(5,S=ve)),Pt(s,$f,ve=>t(6,T=ve)),Pt(s,Yf,ve=>t(7,C=ve)),Pt(s,Ay,ve=>t(8,N=ve)),Pt(s,Oi,ve=>t(9,B=ve));async function U(){Dn(Ey,r=await a.recalculateStats(),r)}cc(async()=>{r==null&&await U()});function ee(ve){h=ve,ec.set(h)}function ie(ve){h=ve,ec.set(h)}function ae(ve){l=ve,Kf.set(l)}function J(ve){h=ve,ec.set(h)}function Y(ve){x=ve,Xf.set(x)}function ge(ve){S=ve,Wf.set(S)}function xe(ve){T=ve,$f.set(T)}function Ee(ve){C=ve,Yf.set(C)}function ye(ve){N=ve,Ay.set(N)}return[r,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge,xe,Ee,ye,()=>Dn(Oi,B={kind:"evaluate-route",browse:Il(r).worst_directness_routes},B)]}class iE extends fn{constructor(e){super(),hn(this,e,nE,tE,on,{})}}function qy(s,e,t){const r=s.slice();return r[4]=e[t],r}function Vy(s){let e,t=s[4]+"",r;return{c(){e=le("option"),r=ze(t),e.__value=s[4],vi(e,e.__value)},m(a,h){se(a,e,h),G(e,r)},p:Je,d(a){a&&re(e)}}}function rE(s){let e,t,r,a,h,m=qn(s[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=Vy(qy(s,m,x));return{c(){e=le("label"),t=ze(`Area:
  `),r=le("select");for(let x=0;x<l.length;x+=1)l[x].c();s[0]===void 0&&vo(()=>s[3].call(r))},m(x,S){se(x,e,S),G(e,t),G(e,r);for(let T=0;T<l.length;T+=1)l[T]&&l[T].m(r,null);Zr(r,s[0],!0),a||(h=[Mt(r,"change",s[3]),Mt(r,"change",s[2])],a=!0)},p(x,[S]){if(S&2){m=qn(x[1]);let T;for(T=0;T<m.length;T+=1){const C=qy(x,m,T);l[T]?l[T].p(C,S):(l[T]=Vy(C),l[T].c(),l[T].m(r,null))}for(;T<l.length;T+=1)l[T].d(1);l.length=m.length}S&3&&Zr(r,x[0])},i:Je,o:Je,d(x){x&&re(e),yr(l,x),a=!1,Ji(h)}}}function sE(s,e,t){let{area:r}=e,a=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];a.sort();function h(){window.location.href=`index.html?boundary=${r}`}function m(){r=Da(this),t(0,r),t(1,a)}return s.$$set=l=>{"area"in l&&t(0,r=l.area)},[r,a,h,m]}class oE extends fn{constructor(e){super(),hn(this,e,sE,rE,on,{area:0})}}const{window:aE}=iv;function Gy(s,e,t){const r=s.slice();return r[22]=e[t],r}function Zy(s){let e,t,r=qn(s[0].features),a=[];for(let m=0;m<r.length;m+=1)a[m]=Hy(Gy(s,r,m));const h=m=>ke(a[m],1,1,()=>{a[m]=null});return{c(){e=le("ol");for(let m=0;m<a.length;m+=1)a[m].c()},m(m,l){se(m,e,l);for(let x=0;x<a.length;x+=1)a[x]&&a[x].m(e,null);t=!0},p(m,l){if(l&257){r=qn(m[0].features);let x;for(x=0;x<r.length;x+=1){const S=Gy(m,r,x);a[x]?(a[x].p(S,l),he(a[x],1)):(a[x]=Hy(S),a[x].c(),he(a[x],1),a[x].m(e,null))}for(Nn(),x=r.length;x<a.length;x+=1)h(x);zn()}},i(m){if(!t){for(let l=0;l<r.length;l+=1)he(a[l]);t=!0}},o(m){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)ke(a[l]);t=!1},d(m){m&&re(e),yr(a,m)}}}function lE(s){var l,x;let e=(((l=s[22].properties)==null?void 0:l.name)||`Untitled route ${s[22].id}`)+"",t,r,a=((x=s[22].properties)==null?void 0:x.infra_type)+"",h,m;return{c(){t=ze(e),r=ze(" ("),h=ze(a),m=ze(")")},m(S,T){se(S,t,T),se(S,r,T),se(S,h,T),se(S,m,T)},p(S,T){var C,N;T&1&&e!==(e=(((C=S[22].properties)==null?void 0:C.name)||`Untitled route ${S[22].id}`)+"")&&Ct(t,e),T&1&&a!==(a=((N=S[22].properties)==null?void 0:N.infra_type)+"")&&Ct(h,a)},d(S){S&&(re(t),re(r),re(h),re(m))}}}function Hy(s){let e,t,r,a;function h(){return s[18](s[22])}return t=new KS({props:{$$slots:{default:[lE]},$$scope:{ctx:s}}}),t.$on("click",h),{c(){e=le("li"),ot(t.$$.fragment),r=Oe()},m(m,l){se(m,e,l),rt(t,e,null),G(e,r),a=!0},p(m,l){s=m;const x={};l&33554433&&(x.$$scope={dirty:l,ctx:s}),t.$set(x)},i(m){a||(he(t.$$.fragment,m),a=!0)},o(m){ke(t.$$.fragment,m),a=!1},d(m){m&&re(e),st(t)}}}function uE(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge,xe,Ee,ye,be,ve,Ce,we,_e;t=new oE({props:{area:s[5]}});let tt=s[0]&&Zy(s);return ve=new JS({}),{c(){e=le("div"),ot(t.$$.fragment),r=Oe(),a=le("div"),h=le("button"),h.innerHTML=`Draw new <u>r</u>
        oute line`,m=Oe(),l=le("button"),l.textContent="Clear all",x=Oe(),S=le("label"),T=le("input"),C=ze(`
      Show current network`),N=Oe(),B=le("details"),U=le("summary"),U.textContent="Current network routes",ee=Oe(),ie=le("label"),ae=ze(`Show routes by:
        `),J=le("select"),Y=le("option"),Y.textContent="Infrastructure type",ge=le("option"),ge.textContent="Tier",xe=Oe(),tt&&tt.c(),Ee=Oe(),ye=le("hr"),be=Oe(),ot(ve.$$.fragment),Ze(l,"class","secondary"),Ze(T,"type","checkbox"),Y.__value="infra_type",vi(Y,Y.__value),ge.__value="tier",vi(ge,ge.__value),s[3]===void 0&&vo(()=>s[17].call(J)),Ze(e,"slot","left")},m(Ve,qe){se(Ve,e,qe),rt(t,e,null),G(e,r),G(e,a),G(a,h),G(a,m),G(a,l),G(e,x),G(e,S),G(S,T),T.checked=s[4],G(S,C),G(e,N),G(e,B),G(B,U),G(B,ee),G(B,ie),G(ie,ae),G(ie,J),G(J,Y),G(J,ge),Zr(J,s[3],!0),G(B,xe),tt&&tt.m(B,null),G(e,Ee),G(e,ye),G(e,be),rt(ve,e,null),Ce=!0,we||(_e=[Mt(h,"click",s[15]),Mt(l,"click",s[9]),Mt(T,"change",s[16]),Mt(J,"change",s[17])],we=!0)},p(Ve,qe){const dt={};qe&32&&(dt.area=Ve[5]),t.$set(dt),qe&16&&(T.checked=Ve[4]),qe&8&&Zr(J,Ve[3]),Ve[0]?tt?(tt.p(Ve,qe),qe&1&&he(tt,1)):(tt=Zy(Ve),tt.c(),he(tt,1),tt.m(B,null)):tt&&(Nn(),ke(tt,1,1,()=>{tt=null}),zn())},i(Ve){Ce||(he(t.$$.fragment,Ve),he(tt),he(ve.$$.fragment,Ve),Ce=!0)},o(Ve){ke(t.$$.fragment,Ve),ke(tt),ke(ve.$$.fragment,Ve),Ce=!1},d(Ve){Ve&&re(e),st(t),tt&&tt.d(),st(ve),we=!1,Ji(_e)}}}function Xy(s){let e,t;return e=new $i({props:{data:s[0],$$slots:{default:[fE]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.data=r[0]),a&33554460&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function cE(s){let e=(s[21].name||"Untitled")+"",t,r,a=ou[s[21].infra_type][0]+"",h,m,l=s[21].tier+"",x,S;return{c(){t=ze(e),r=ze(" ("),h=ze(a),m=ze(`,
            `),x=ze(l),S=ze(")")},m(T,C){se(T,t,C),se(T,r,C),se(T,h,C),se(T,m,C),se(T,x,C),se(T,S,C)},p(T,C){C&2097152&&e!==(e=(T[21].name||"Untitled")+"")&&Ct(t,e),C&2097152&&a!==(a=ou[T[21].infra_type][0]+"")&&Ct(h,a),C&2097152&&l!==(l=T[21].tier+"")&&Ct(x,l)},d(T){T&&(re(t),re(r),re(h),re(m),re(x),re(S))}}}function hE(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[cE,({props:r})=>({21:r}),({props:r})=>r?2097152:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&35651584&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function fE(s){let e,t;return e=new cr({props:{id:"routes",paint:{"line-width":["case",["==",["get","tier"],s[2]],zr(5,7),zr(3,5)],"line-color":s[3]=="infra_type"?au:Up},layout:{visibility:s[4]?"visible":"none"},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[hE]},$$scope:{ctx:s}}}),e.$on("click",s[7]),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&12&&(h.paint={"line-width":["case",["==",["get","tier"],r[2]],zr(5,7),zr(3,5)],"line-color":r[3]=="infra_type"?au:Up}),a&16&&(h.layout={visibility:r[4]?"visible":"none"}),a&33554432&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function dE(s){let e,t,r=s[0]&&Xy(s);return{c(){e=le("div"),r&&r.c(),Ze(e,"slot","map")},m(a,h){se(a,e,h),r&&r.m(e,null),t=!0},p(a,h){a[0]?r?(r.p(a,h),h&1&&he(r,1)):(r=Xy(a),r.c(),he(r,1),r.m(e,null)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d()}}}function pE(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae;return t=new iE({}),{c(){e=le("div"),ot(t.$$.fragment),r=Oe(),a=le("div"),h=le("button"),h.textContent="Evaluate a route",m=Oe(),l=le("div"),x=le("button"),x.textContent="Evaluate OD",S=Oe(),T=le("div"),C=le("button"),C.textContent="Debug network",N=Oe(),B=le("div"),U=le("button"),U.textContent="Debug mesh density",Ze(h,"class","secondary"),Ze(x,"class","secondary"),Ze(C,"class","secondary"),Ze(U,"class","secondary"),Ze(e,"slot","right")},m(J,Y){se(J,e,Y),rt(t,e,null),G(e,r),G(e,a),G(a,h),G(e,m),G(e,l),G(l,x),G(e,S),G(e,T),G(T,C),G(e,N),G(e,B),G(B,U),ee=!0,ie||(ae=[Mt(h,"click",s[11]),Mt(x,"click",s[12]),Mt(C,"click",s[13]),Mt(U,"click",s[14])],ie=!0)},p:Je,i(J){ee||(he(t.$$.fragment,J),ee=!0)},o(J){ke(t.$$.fragment,J),ee=!1},d(J){J&&re(e),st(t),ie=!1,Ji(ae)}}}function mE(s){let e,t,r,a;return e=new gc({props:{$$slots:{right:[pE],map:[dE],left:[uE]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(h,m){rt(e,h,m),t=!0,r||(a=Mt(aE,"keydown",s[6]),r=!0)},p(h,[m]){const l={};m&33554495&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){t||(he(e.$$.fragment,h),t=!0)},o(h){ke(e.$$.fragment,h),t=!1},d(h){st(e,h),r=!1,a()}}}function gE(s,e,t){let r,a,h,m,l,x,S;Pt(s,Yi,be=>t(19,r=be)),Pt(s,Oi,be=>t(1,a=be)),Pt(s,Ph,be=>t(10,h=be)),Pt(s,Ma,be=>t(2,m=be)),Pt(s,zp,be=>t(3,l=be)),Pt(s,Op,be=>t(4,x=be)),Pt(s,Hf,be=>t(5,S=be));let T=null;cc(C);async function C(){t(0,T=await r.renderRoutes())}function N(be){be.key=="r"&&(be.preventDefault(),Dn(Oi,a={kind:"edit-route",id:null},a))}function B(be){Dn(Oi,a={kind:"edit-route",id:be.detail.features[0].id},a)}function U(be){Dn(Oi,a={kind:"edit-route",id:be},a)}async function ee(){window.confirm("Clear everything? You can't undo this")&&(await(r==null?void 0:r.clearAllRoutes()),await Dh(),await C())}const ie=()=>Dn(Oi,a={kind:"evaluate-route",browse:[]},a),ae=()=>Dn(Oi,a={kind:"evaluate-od"},a),J=()=>Dn(Oi,a={kind:"debug-network"},a),Y=()=>Dn(Oi,a={kind:"debug-mesh-density"},a),ge=()=>Dn(Oi,a={kind:"edit-route",id:null},a);function xe(){x=this.checked,Op.set(x)}function Ee(){l=Da(this),zp.set(l)}const ye=be=>U(be.id);return s.$$.update=()=>{s.$$.dirty&1024&&h>0&&C()},[T,a,m,l,x,S,N,B,U,ee,h,ie,ae,J,Y,ge,xe,Ee,ye]}class _E extends fn{constructor(e){super(),hn(this,e,gE,mE,on,{})}}function Wy(s,e,t){const r=s.slice();return r[2]=e[t][0],r[3]=e[t][1],r}function yE(s,e,t){const r=s.slice();return r[1]=e[t][0],r[2]=e[t][1],r[3]=e[t][2],r}function vE(s){let e,t=qn(Object.entries(Nr)),r=[];for(let a=0;a<t.length;a+=1)r[a]=Ky(Wy(s,t,a));return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=Gn()},m(a,h){for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(a,h);se(a,e,h)},p(a,h){if(h&0){t=qn(Object.entries(Nr));let m;for(m=0;m<t.length;m+=1){const l=Wy(a,t,m);r[m]?r[m].p(l,h):(r[m]=Ky(l),r[m].c(),r[m].m(e.parentNode,e))}for(;m<r.length;m+=1)r[m].d(1);r.length=t.length}},d(a){a&&re(e),yr(r,a)}}}function bE(s){let e,t=qn(nm),r=[];for(let a=0;a<t.length;a+=1)r[a]=xE(yE(s,t,a));return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=Gn()},m(a,h){for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(a,h);se(a,e,h)},p:Je,d(a){a&&re(e),yr(r,a)}}}function Ky(s){let e,t,r;return{c(){e=le("span"),e.textContent=`${s[2]}`,t=Oe(),r=le("br"),Rn(e,"color",s[3])},m(a,h){se(a,e,h),se(a,t,h),se(a,r,h)},p:Je,d(a){a&&(re(e),re(t),re(r))}}}function xE(s){let e,t,r;return{c(){e=le("span"),e.textContent=`${s[2]}`,t=Oe(),r=le("br"),Rn(e,"color",s[3])},m(a,h){se(a,e,h),se(a,t,h),se(a,r,h)},p:Je,d(a){a&&(re(e),re(t),re(r))}}}function wE(s){let e,t,r,a;function h(x,S){return x[0]=="infra_type"?bE:vE}let m=h(s),l=m(s);return{c(){e=le("div"),t=le("details"),r=le("summary"),r.textContent="Legend",a=Oe(),l.c(),Ze(e,"class","svelte-1oq1sox")},m(x,S){se(x,e,S),G(e,t),G(t,r),G(t,a),l.m(t,null)},p(x,[S]){m===(m=h(x))&&l?l.p(x,S):(l.d(1),l=m(x),l&&(l.c(),l.m(t,null)))},i:Je,o:Je,d(x){x&&re(e),l.d()}}}function kE(s,e,t){let r;return Pt(s,zp,a=>t(0,r=a)),[r]}class IE extends fn{constructor(e){super(),hn(this,e,kE,wE,on,{})}}const SE="/npw/assets/help-d011708a.svg";function $y(s){let e,t;return e=new e1({props:{$$slots:{default:[EE]},$$scope:{ctx:s}}}),e.$on("close",s[3]),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&16&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function EE(s){let e,t,r;const a=s[1].default,h=Zi(a,s,s[4],null);return{c(){e=le("h2"),e.textContent="Help",t=Oe(),h&&h.c()},m(m,l){se(m,e,l),se(m,t,l),h&&h.m(m,l),r=!0},p(m,l){h&&h.p&&(!r||l&16)&&Xi(h,a,m,m[4],r?Hi(a,m[4],l,null):Wi(m[4]),null)},i(m){r||(he(h,m),r=!0)},o(m){ke(h,m),r=!1},d(m){m&&(re(e),re(t)),h&&h.d(m)}}}function AE(s){let e,t,r,a,h,m,l=s[0]&&$y(s);return{c(){e=le("button"),e.innerHTML=`<img src="${SE}" title="Help" alt="Help"/>`,t=Oe(),l&&l.c(),r=Gn(),Ze(e,"class","svelte-gb6dzm")},m(x,S){se(x,e,S),se(x,t,S),l&&l.m(x,S),se(x,r,S),a=!0,h||(m=Mt(e,"click",s[2]),h=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&he(l,1)):(l=$y(x),l.c(),he(l,1),l.m(r.parentNode,r)):l&&(Nn(),ke(l,1,1,()=>{l=null}),zn())},i(x){a||(he(l),a=!0)},o(x){ke(l),a=!1},d(x){x&&(re(e),re(t),re(r)),l&&l.d(x),h=!1,m()}}}function TE(s,e,t){let{$$slots:r={},$$scope:a}=e,h=!1;const m=()=>t(0,h=!0),l=()=>t(0,h=!1);return s.$$set=x=>{"$$scope"in x&&t(4,a=x.$$scope)},[h,r,m,l,a]}class s1 extends fn{constructor(e){super(),hn(this,e,TE,AE,on,{})}}function Yy(s,e,t){const r=s.slice();return r[1]=e[t][0],r[2]=e[t][1],r}function Jy(s){let e,t,r,a=s[1]+"",h,m;return{c(){e=le("li"),t=le("span"),r=Oe(),h=ze(a),m=Oe(),Ze(t,"class","svelte-kzgqtg"),Rn(t,"background",s[2])},m(l,x){se(l,e,x),G(e,t),G(e,r),G(e,h),G(e,m)},p(l,x){x&1&&Rn(t,"background",l[2]),x&1&&a!==(a=l[1]+"")&&Ct(h,a)},d(l){l&&re(e)}}}function CE(s){let e,t=qn(Object.entries(s[0])),r=[];for(let a=0;a<t.length;a+=1)r[a]=Jy(Yy(s,t,a));return{c(){e=le("ul");for(let a=0;a<r.length;a+=1)r[a].c()},m(a,h){se(a,e,h);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(e,null)},p(a,[h]){if(h&1){t=qn(Object.entries(a[0]));let m;for(m=0;m<t.length;m+=1){const l=Yy(a,t,m);r[m]?r[m].p(l,h):(r[m]=Jy(l),r[m].c(),r[m].m(e,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=t.length}},i:Je,o:Je,d(a){a&&re(e),yr(r,a)}}}function LE(s,e,t){let{colors:r}=e;return s.$$set=a=>{"colors"in a&&t(0,r=a.colors)},[r]}class _c extends fn{constructor(e){super(),hn(this,e,LE,CE,on,{colors:0})}}let un;const o1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&o1.decode();let vh=null;function Eh(){return(vh===null||vh.byteLength===0)&&(vh=new Uint8Array(un.memory.buffer)),vh}function _o(s,e){return s=s>>>0,o1.decode(Eh().subarray(s,s+e))}const Pa=new Array(128).fill(void 0);Pa.push(void 0,null,!0,!1);let Ah=Pa.length;function lr(s){Ah===Pa.length&&Pa.push(Pa.length+1);const e=Ah;return Ah=Pa[e],Pa[e]=s,e}function Wn(s){return Pa[s]}function ME(s){s<132||(Pa[s]=Ah,Ah=s)}function Yu(s){const e=Wn(s);return ME(s),e}function fp(s){return s==null}let bh=null;function RE(){return(bh===null||bh.byteLength===0)&&(bh=new Float64Array(un.memory.buffer)),bh}let xh=null;function li(){return(xh===null||xh.byteLength===0)&&(xh=new Int32Array(un.memory.buffer)),xh}let xl=0;const Pf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},PE=typeof Pf.encodeInto=="function"?function(s,e){return Pf.encodeInto(s,e)}:function(s,e){const t=Pf.encode(s);return e.set(t),{read:s.length,written:t.length}};function kf(s,e,t){if(t===void 0){const l=Pf.encode(s),x=e(l.length,1)>>>0;return Eh().subarray(x,x+l.length).set(l),xl=l.length,x}let r=s.length,a=e(r,1)>>>0;const h=Eh();let m=0;for(;m<r;m++){const l=s.charCodeAt(m);if(l>127)break;h[a+m]=l}if(m!==r){m!==0&&(s=s.slice(m)),a=t(a,r,r=m+s.length*3,1)>>>0;const l=Eh().subarray(a+m,a+r),x=PE(s,l);m+=x.written}return xl=m,a}function qp(s){const e=typeof s;if(e=="number"||e=="boolean"||s==null)return`${s}`;if(e=="string")return`"${s}"`;if(e=="symbol"){const a=s.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=s.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(s)){const a=s.length;let h="[";a>0&&(h+=qp(s[0]));for(let m=1;m<a;m++)h+=", "+qp(s[m]);return h+="]",h}const t=/\[object ([^\]]+)\]/.exec(toString.call(s));let r;if(t.length>1)r=t[1];else return toString.call(s);if(r=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:r}function DE(s,e){const t=e(s.length*1,1)>>>0;return Eh().set(s,t/1),xl=s.length,t}function dp(s,e){try{return s.apply(this,e)}catch(t){un.__wbindgen_exn_store(lr(t))}}class Jf{static __wrap(e){e=e>>>0;const t=Object.create(Jf.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();un.__wbg_jsroutesnapper_free(e)}constructor(e){try{const h=un.__wbindgen_add_to_stack_pointer(-16),m=DE(e,un.__wbindgen_malloc),l=xl;un.jsroutesnapper_new(h,m,l);var t=li()[h/4+0],r=li()[h/4+1],a=li()[h/4+2];if(a)throw Yu(r);return Jf.__wrap(t)}finally{un.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){un.jsroutesnapper_setRouteConfig(this.__wbg_ptr,lr(e))}setAreaMode(){un.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getConfig(h,this.__wbg_ptr);var r=li()[h/4+0],a=li()[h/4+1];return e=r,t=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const r=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_toFinalFeature(r,this.__wbg_ptr);var e=li()[r/4+0],t=li()[r/4+1];let a;return e!==0&&(a=_o(e,t).slice(),un.__wbindgen_free(e,t*1)),a}finally{un.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_renderGeojson(h,this.__wbg_ptr);var r=li()[h/4+0],a=li()[h/4+1];return e=r,t=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}toggleSnapMode(){un.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,r){return un.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,r)!==0}onClick(){un.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return un.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return un.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){un.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const a=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_editExisting(a,this.__wbg_ptr,lr(e));var t=li()[a/4+0],r=li()[a/4+1];if(r)throw Yu(t)}finally{un.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugRenderGraph(h,this.__wbg_ptr);var r=li()[h/4+0],a=li()[h/4+1];return e=r,t=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugSnappableNodes(h,this.__wbg_ptr);var r=li()[h/4+0],a=li()[h/4+1];return e=r,t=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,r;try{const T=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_routeNameForWaypoints(T,this.__wbg_ptr,lr(e));var a=li()[T/4+0],h=li()[T/4+1],m=li()[T/4+2],l=li()[T/4+3],x=a,S=h;if(l)throw x=0,S=0,Yu(m);return t=x,r=S,_o(x,S)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(t,r,1)}}addSnappedWaypoint(e,t){un.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){un.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,r;try{const T=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_calculateRoute(T,this.__wbg_ptr,lr(e));var a=li()[T/4+0],h=li()[T/4+1],m=li()[T/4+2],l=li()[T/4+3],x=a,S=h;if(l)throw x=0,S=0,Yu(m);return t=x,r=S,_o(x,S)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(t,r,1)}}getExtraNodes(e,t){let r,a;try{const C=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getExtraNodes(C,this.__wbg_ptr,lr(e),lr(t));var h=li()[C/4+0],m=li()[C/4+1],l=li()[C/4+2],x=li()[C/4+3],S=h,T=m;if(x)throw S=0,T=0,Yu(l);return r=S,a=T,_o(S,T)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(r,a,1)}}}async function NE(s,e){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,e)}catch(r){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await s.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(s,e);return t instanceof WebAssembly.Instance?{instance:t,module:s}:t}}function zE(){const s={};return s.wbg={},s.wbg.__wbindgen_string_new=function(e,t){const r=_o(e,t);return lr(r)},s.wbg.__wbindgen_object_drop_ref=function(e){Yu(e)},s.wbg.__wbindgen_error_new=function(e,t){const r=new Error(_o(e,t));return lr(r)},s.wbg.__wbindgen_number_get=function(e,t){const r=Wn(t),a=typeof r=="number"?r:void 0;RE()[e/8+1]=fp(a)?0:a,li()[e/4+0]=!fp(a)},s.wbg.__wbindgen_is_object=function(e){const t=Wn(e);return typeof t=="object"&&t!==null},s.wbg.__wbindgen_is_undefined=function(e){return Wn(e)===void 0},s.wbg.__wbindgen_in=function(e,t){return Wn(e)in Wn(t)},s.wbg.__wbindgen_boolean_get=function(e){const t=Wn(e);return typeof t=="boolean"?t?1:0:2},s.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Wn(e)==Wn(t)},s.wbg.__wbindgen_string_get=function(e,t){const r=Wn(t),a=typeof r=="string"?r:void 0;var h=fp(a)?0:kf(a,un.__wbindgen_malloc,un.__wbindgen_realloc),m=xl;li()[e/4+1]=m,li()[e/4+0]=h},s.wbg.__wbg_String_4370c5505c674d30=function(e,t){const r=String(Wn(t)),a=kf(r,un.__wbindgen_malloc,un.__wbindgen_realloc),h=xl;li()[e/4+1]=h,li()[e/4+0]=a},s.wbg.__wbindgen_object_clone_ref=function(e){const t=Wn(e);return lr(t)},s.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const r=Wn(e)[Wn(t)];return lr(r)},s.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return lr(e)},s.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=Wn(t).stack,a=kf(r,un.__wbindgen_malloc,un.__wbindgen_realloc),h=xl;li()[e/4+1]=h,li()[e/4+0]=a},s.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,a;try{r=e,a=t,console.error(_o(e,t))}finally{un.__wbindgen_free(r,a,1)}},s.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Wn(e))},s.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Wn(e))},s.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Wn(e))},s.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Wn(e))},s.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Wn(e))},s.wbg.__wbg_get_44be0491f933a435=function(e,t){const r=Wn(e)[t>>>0];return lr(r)},s.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Wn(e).length},s.wbg.__wbindgen_is_function=function(e){return typeof Wn(e)=="function"},s.wbg.__wbg_next_526fc47e980da008=function(e){const t=Wn(e).next;return lr(t)},s.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return dp(function(e){const t=Wn(e).next();return lr(t)},arguments)},s.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Wn(e).done},s.wbg.__wbg_value_1695675138684bd5=function(e){const t=Wn(e).value;return lr(t)},s.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return lr(Symbol.iterator)},s.wbg.__wbg_get_97b561fb56f034b5=function(){return dp(function(e,t){const r=Reflect.get(Wn(e),Wn(t));return lr(r)},arguments)},s.wbg.__wbg_call_cb65541d95d71282=function(){return dp(function(e,t){const r=Wn(e).call(Wn(t));return lr(r)},arguments)},s.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Wn(e))},s.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Wn(e)instanceof ArrayBuffer}catch{t=!1}return t},s.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Wn(e).buffer;return lr(t)},s.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Wn(e));return lr(t)},s.wbg.__wbg_set_5cf90238115182c3=function(e,t,r){Wn(e).set(Wn(t),r>>>0)},s.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Wn(e).length},s.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Wn(e)instanceof Uint8Array}catch{t=!1}return t},s.wbg.__wbindgen_debug_string=function(e,t){const r=qp(Wn(t)),a=kf(r,un.__wbindgen_malloc,un.__wbindgen_realloc),h=xl;li()[e/4+1]=h,li()[e/4+0]=a},s.wbg.__wbindgen_throw=function(e,t){throw new Error(_o(e,t))},s.wbg.__wbindgen_memory=function(){const e=un.memory;return lr(e)},s}function FE(s,e){return un=s.exports,a1.__wbindgen_wasm_module=e,bh=null,xh=null,vh=null,un}async function a1(s){if(un!==void 0)return un;typeof s>"u"&&(s="/npw/assets/route_snapper_bg.wasm");const e=zE();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:t,module:r}=await NE(await s,e);return FE(t,r)}const OE=30;class BE{constructor(e,t,r,a,h){this.onMouseMove=m=>{if(!this.active)return;const l=[m.point.x-OE,m.point.y],x=this.map.unproject(m.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(m.lngLat.lng,m.lngLat.lat,x)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=m=>{this.active&&(m.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||m.key=="Escape"&&(m.stopPropagation(),this.cancel())},this.onKeyPress=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||(m.key=="Enter"?(m.stopPropagation(),this.finish()):m.key=="s"||m.key=="S"?(m.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):m.key=="z"&&m.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Jf(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=r,this.snapMode=a,this.undoLength=h,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}let Qf=Yn(null);const go=Yn([]);const UE=s=>({}),Qy=s=>({}),jE=s=>({}),e0=s=>({});function t0(s,e,t){const r=s.slice();return r[51]=e[t],r[52]=e,r[53]=t,r}function n0(s,e,t){const r=s.slice();return r[54]=e[t],r[55]=e,r[56]=t,r}const qE=s=>({}),i0=s=>({});function VE(s){let e,t=s[10].length+"",r,a;return{c(){e=ze("Undo ("),r=ze(t),a=ze(")")},m(h,m){se(h,e,m),se(h,r,m),se(h,a,m)},p(h,m){m[0]&1024&&t!==(t=h[10].length+"")&&Ct(r,t)},d(h){h&&(re(e),re(r),re(a))}}}function GE(s){let e;return{c(){e=ze("Undo")},m(t,r){se(t,e,r)},p:Je,d(t){t&&re(e)}}}function ZE(s){let e,t,r,a,h;return{c(){e=le("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,t=Oe(),r=le("p"),r.textContent="Keyboard shortcuts:",a=Oe(),h=le("ul"),h.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(m,l){se(m,e,l),se(m,t,l),se(m,r,l),se(m,a,l),se(m,h,l)},p:Je,d(m){m&&(re(e),re(t),re(r),re(a),re(h))}}}function HE(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge,xe,Ee,ye,be,ve,Ce,we,_e,tt,Ve,qe,dt,mt,ct,Ut,bt,It,pt,kt,St,$t,pn,Pn,We,Kn,dn,Ot,Ae,ut,Ye,Lt,Ke,On;function xt(ei,Jt){return ei[10].length==0?GE:VE}let Se=xt(s),Bt=Se(s);ee=new s1({props:{$$slots:{default:[ZE]},$$scope:{ctx:s}}});const Mn=s[29]["extra-left"],Fn=Zi(Mn,s,s[46],Qy);return Ye=Gg(s[40][0]),Lt=Gg(s[40][1]),{c(){e=le("div"),t=le("h2"),t.textContent="Editing a route",r=Oe(),a=le("button"),h=ze("Finish"),l=Oe(),x=le("button"),Bt.c(),T=Oe(),C=le("button"),C.textContent="Delete",N=Oe(),B=le("button"),B.textContent="Cancel",U=Oe(),ot(ee.$$.fragment),ie=Oe(),ae=le("fieldset"),J=le("label"),Y=le("input"),ge=ze(`
        Snap to roads`),xe=Oe(),Ee=le("label"),ye=le("input"),be=ze(`
        Draw anywhere`),ve=Oe(),Ce=le("fieldset"),we=le("label"),_e=le("input"),tt=ze(`
        Extend from start (
        `),Ve=le("b"),Ve.textContent="1",qe=ze(`
        )`),dt=Oe(),mt=le("label"),ct=le("input"),Ut=ze(`
        Extend from end (
        `),bt=le("b"),bt.textContent="2",It=ze(`
        )`),pt=Oe(),kt=le("label"),St=le("input"),$t=ze(`
        Adjust middle points (
        `),pn=le("b"),pn.textContent="3",Pn=ze(`
        )`),We=Oe(),Kn=le("label"),dn=le("input"),Ot=ze(`
      Show major junctions`),Ae=Oe(),Fn&&Fn.c(),a.disabled=m=s[7].length<2,Ze(x,"class","secondary"),x.disabled=S=s[10].length==0,Ze(C,"class","secondary"),Ze(B,"class","secondary"),Ze(Y,"type","radio"),Y.__value="snap",vi(Y,Y.__value),Ze(ye,"type","radio"),ye.__value="free",vi(ye,ye.__value),Ze(_e,"type","radio"),_e.__value="append-start",vi(_e,_e.__value),Ze(ct,"type","radio"),ct.__value="append-end",vi(ct,ct.__value),Ze(St,"type","radio"),St.__value="adjust",vi(St,St.__value),Ze(dn,"type","checkbox"),Ze(e,"slot","left"),Ye.p(_e,ct,St),Lt.p(Y,ye)},m(ei,Jt){se(ei,e,Jt),G(e,t),G(e,r),G(e,a),G(a,h),G(e,l),G(e,x),Bt.m(x,null),G(e,T),G(e,C),G(e,N),G(e,B),G(e,U),rt(ee,e,null),G(e,ie),G(e,ae),G(ae,J),G(J,Y),Y.checked=Y.__value===s[9],G(J,ge),G(ae,xe),G(ae,Ee),G(Ee,ye),ye.checked=ye.__value===s[9],G(Ee,be),G(e,ve),G(e,Ce),G(Ce,we),G(we,_e),_e.checked=_e.__value===s[3],G(we,tt),G(we,Ve),G(we,qe),G(Ce,dt),G(Ce,mt),G(mt,ct),ct.checked=ct.__value===s[3],G(mt,Ut),G(mt,bt),G(mt,It),G(Ce,pt),G(Ce,kt),G(kt,St),St.checked=St.__value===s[3],G(kt,$t),G(kt,pn),G(kt,Pn),G(e,We),G(e,Kn),G(Kn,dn),dn.checked=s[13],G(Kn,Ot),G(e,Ae),Fn&&Fn.m(e,null),ut=!0,Ke||(On=[Mt(a,"click",function(){iu(s[0])&&s[0].apply(this,arguments)}),Mt(x,"click",s[14]),Mt(C,"click",function(){iu(s[2])&&s[2].apply(this,arguments)}),Mt(B,"click",function(){iu(s[1])&&s[1].apply(this,arguments)}),Mt(Y,"change",s[39]),Mt(Y,"change",s[15]),Mt(ye,"change",s[41]),Mt(ye,"change",s[15]),Mt(_e,"change",s[42]),Mt(ct,"change",s[43]),Mt(St,"change",s[44]),Mt(dn,"change",s[45])],Ke=!0)},p(ei,Jt){s=ei,(!ut||Jt[0]&128&&m!==(m=s[7].length<2))&&(a.disabled=m),Se===(Se=xt(s))&&Bt?Bt.p(s,Jt):(Bt.d(1),Bt=Se(s),Bt&&(Bt.c(),Bt.m(x,null))),(!ut||Jt[0]&1024&&S!==(S=s[10].length==0))&&(x.disabled=S);const Ri={};Jt[1]&32768&&(Ri.$$scope={dirty:Jt,ctx:s}),ee.$set(Ri),Jt[0]&512&&(Y.checked=Y.__value===s[9]),Jt[0]&512&&(ye.checked=ye.__value===s[9]),Jt[0]&8&&(_e.checked=_e.__value===s[3]),Jt[0]&8&&(ct.checked=ct.__value===s[3]),Jt[0]&8&&(St.checked=St.__value===s[3]),Jt[0]&8192&&(dn.checked=s[13]),Fn&&Fn.p&&(!ut||Jt[1]&32768)&&Xi(Fn,Mn,s,s[46],ut?Hi(Mn,s[46],Jt,UE):Wi(s[46]),Qy)},i(ei){ut||(he(ee.$$.fragment,ei),he(Fn,ei),ut=!0)},o(ei){ke(ee.$$.fragment,ei),ke(Fn,ei),ut=!1},d(ei){ei&&re(e),Bt.d(),st(ee),Fn&&Fn.d(ei),Ye.r(),Lt.r(),Ke=!1,Ji(On)}}}function XE(s){let e;return{c(){e=le("span"),Ze(e,"class","dot svelte-1cj4rwq"),Er(e,"snapped-node",s[54].snapped),Er(e,"free-node",!s[54].snapped),Er(e,"hide",s[6])},m(t,r){se(t,e,r)},p(t,r){r[0]&2048&&Er(e,"snapped-node",t[54].snapped),r[0]&2048&&Er(e,"free-node",!t[54].snapped),r[0]&64&&Er(e,"hide",t[6])},d(t){t&&re(e)}}}function r0(s){let e,t,r;function a(x){s[30](x,s[54])}function h(){return s[31](s[54])}function m(){return s[32](s[54])}let l={draggable:!0,zIndex:0,$$slots:{default:[XE]},$$scope:{ctx:s}};return s[54].point!==void 0&&(l.lngLat=s[54].point),e=new Zf({props:l}),Jn.push(()=>_r(e,"lngLat",a)),e.$on("dragstart",h),e.$on("drag",m),e.$on("dragend",s[23]),{c(){ot(e.$$.fragment)},m(x,S){rt(e,x,S),r=!0},p(x,S){s=x;const T={};S[0]&2112|S[1]&32768&&(T.$$scope={dirty:S,ctx:s}),!t&&S[0]&2048&&(t=!0,T.lngLat=s[54].point,gr(()=>t=!1)),e.$set(T)},i(x){r||(he(e.$$.fragment,x),r=!0)},o(x){ke(e.$$.fragment,x),r=!1},d(x){st(e,x)}}}function WE(s){let e;return{c(){e=le("span"),e.textContent=`${s[53]+1}`,Ze(e,"class","dot svelte-1cj4rwq"),Er(e,"snapped",s[51].snapped)},m(t,r){se(t,e,r)},p(t,r){r[0]&128&&Er(e,"snapped",t[51].snapped)},d(t){t&&re(e)}}}function s0(s){let e,t,r;function a(x){s[33](x,s[51])}function h(){return s[34](s[53])}function m(){return s[35](s[53])}let l={draggable:!0,zIndex:1,$$slots:{default:[WE]},$$scope:{ctx:s}};return s[51].point!==void 0&&(l.lngLat=s[51].point),e=new Zf({props:l}),Jn.push(()=>_r(e,"lngLat",a)),e.$on("click",h),e.$on("contextmenu",m),e.$on("mouseenter",s[36]),e.$on("mouseleave",s[37]),e.$on("dragstart",s[25]),e.$on("dragend",s[38]),{c(){ot(e.$$.fragment)},m(x,S){rt(e,x,S),r=!0},p(x,S){s=x;const T={};S[0]&128|S[1]&32768&&(T.$$scope={dirty:S,ctx:s}),!t&&S[0]&128&&(t=!0,T.lngLat=s[51].point,gr(()=>t=!1)),e.$set(T)},i(x){r||(he(e.$$.fragment,x),r=!0)},o(x){ke(e.$$.fragment,x),r=!1},d(x){st(e,x)}}}function KE(s){let e,t;return e=new cr({props:{paint:{"line-color":"black","line-width":10}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function $E(s){let e,t;return e=new cr({props:{paint:{"line-color":"black","line-width":3}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function YE(s){let e,t,r,a,h,m,l,x,S,T;t=new Qv({}),t.$on("click",s[16]),t.$on("mousemove",s[17]);let C=qn(s[11]),N=[];for(let Y=0;Y<C.length;Y+=1)N[Y]=r0(n0(s,C,Y));const B=Y=>ke(N[Y],1,1,()=>{N[Y]=null});let U=qn(s[7]),ee=[];for(let Y=0;Y<U.length;Y+=1)ee[Y]=s0(t0(s,U,Y));const ie=Y=>ke(ee[Y],1,1,()=>{ee[Y]=null});m=new $i({props:{data:s[20](s[8],s[7]),generateId:!0,$$slots:{default:[KE]},$$scope:{ctx:s}}}),x=new $i({props:{data:s[12],$$slots:{default:[$E]},$$scope:{ctx:s}}});const ae=s[29]["extra-map"],J=Zi(ae,s,s[46],e0);return{c(){e=le("div"),ot(t.$$.fragment),r=Oe();for(let Y=0;Y<N.length;Y+=1)N[Y].c();a=Oe();for(let Y=0;Y<ee.length;Y+=1)ee[Y].c();h=Oe(),ot(m.$$.fragment),l=Oe(),ot(x.$$.fragment),S=Oe(),J&&J.c(),Ze(e,"slot","map")},m(Y,ge){se(Y,e,ge),rt(t,e,null),G(e,r);for(let xe=0;xe<N.length;xe+=1)N[xe]&&N[xe].m(e,null);G(e,a);for(let xe=0;xe<ee.length;xe+=1)ee[xe]&&ee[xe].m(e,null);G(e,h),rt(m,e,null),G(e,l),rt(x,e,null),G(e,S),J&&J.m(e,null),T=!0},p(Y,ge){if(ge[0]&14682176){C=qn(Y[11]);let ye;for(ye=0;ye<C.length;ye+=1){const be=n0(Y,C,ye);N[ye]?(N[ye].p(be,ge),he(N[ye],1)):(N[ye]=r0(be),N[ye].c(),he(N[ye],1),N[ye].m(e,a))}for(Nn(),ye=C.length;ye<N.length;ye+=1)B(ye);zn()}if(ge[0]&34341040){U=qn(Y[7]);let ye;for(ye=0;ye<U.length;ye+=1){const be=t0(Y,U,ye);ee[ye]?(ee[ye].p(be,ge),he(ee[ye],1)):(ee[ye]=s0(be),ee[ye].c(),he(ee[ye],1),ee[ye].m(e,h))}for(Nn(),ye=U.length;ye<ee.length;ye+=1)ie(ye);zn()}const xe={};ge[0]&384&&(xe.data=Y[20](Y[8],Y[7])),ge[1]&32768&&(xe.$$scope={dirty:ge,ctx:Y}),m.$set(xe);const Ee={};ge[0]&4096&&(Ee.data=Y[12]),ge[1]&32768&&(Ee.$$scope={dirty:ge,ctx:Y}),x.$set(Ee),J&&J.p&&(!T||ge[1]&32768)&&Xi(J,ae,Y,Y[46],T?Hi(ae,Y[46],ge,jE):Wi(Y[46]),e0)},i(Y){if(!T){he(t.$$.fragment,Y);for(let ge=0;ge<C.length;ge+=1)he(N[ge]);for(let ge=0;ge<U.length;ge+=1)he(ee[ge]);he(m.$$.fragment,Y),he(x.$$.fragment,Y),he(J,Y),T=!0}},o(Y){ke(t.$$.fragment,Y),N=N.filter(Boolean);for(let ge=0;ge<N.length;ge+=1)ke(N[ge]);ee=ee.filter(Boolean);for(let ge=0;ge<ee.length;ge+=1)ke(ee[ge]);ke(m.$$.fragment,Y),ke(x.$$.fragment,Y),ke(J,Y),T=!1},d(Y){Y&&re(e),st(t),yr(N,Y),yr(ee,Y),st(m),st(x),J&&J.d(Y)}}}function JE(s){let e,t;const r=s[29]["extra-right"],a=Zi(r,s,s[46],i0);return{c(){e=le("div"),a&&a.c(),Ze(e,"slot","right")},m(h,m){se(h,e,m),a&&a.m(e,null),t=!0},p(h,m){a&&a.p&&(!t||m[1]&32768)&&Xi(a,r,h,h[46],t?Hi(r,h[46],m,qE):Wi(h[46]),i0)},i(h){t||(he(a,h),t=!0)},o(h){ke(a,h),t=!1},d(h){h&&re(e),a&&a.d(h)}}}function QE(s){let e,t,r,a;return e=new gc({props:{$$slots:{right:[JE],map:[YE],left:[HE]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(h,m){rt(e,h,m),t=!0,r||(a=Mt(window,"keydown",s[24]),r=!0)},p(h,m){const l={};m[0]&16383|m[1]&32768&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){t||(he(e.$$.fragment,h),t=!0)},o(h){ke(e.$$.fragment,h),t=!1},d(h){st(e,h),r=!1,a()}}}function eA(s,e,t){let r,a,h,m;Pt(s,go,xt=>t(7,a=xt)),Pt(s,Qf,xt=>t(8,h=xt)),Pt(s,Bp,xt=>t(13,m=xt));let{$$slots:l={},$$scope:x}=e,{map:S}=e,{finish:T}=e,{cancel:C}=e,{deleteRoute:N}=e,{editingExisting:B}=e;bo(()=>{Dn(go,a=[],a),h==null||h.stop(),S.getCanvas().style.cursor="inherit"});let U=B?"adjust":"append-end",ee="snap",ie=[],ae=[],J=null,Y=!1,ge=!1,xe=!1;function Ee(xt){let Se=xt.length==0?"crosshair":"inherit";S.getCanvas().style.cursor=Se}function ye(){let xt=ie.pop();t(10,ie),xt&&Dn(go,a=xt,a)}function be(){ie.length==100&&ie.shift(),t(10,ie=[...ie,JSON.parse(JSON.stringify(a))])}function ve(){t(9,ee=ee=="snap"?"free":"snap"),J&&t(28,J.snapped=ee=="snap",J)}function Ce(xt){be(),go.update(Se=>(U=="append-start"?Se.splice(0,0,{point:xt.detail.lngLat.toArray(),snapped:ee=="snap"}):U=="append-end"&&Se.push({point:xt.detail.lngLat.toArray(),snapped:ee=="snap"}),Se))}function we(xt){t(28,J={point:xt.detail.lngLat.toArray(),snapped:ee=="snap"})}function _e(xt){be(),go.update(Se=>(Se[xt].snapped=!Se[xt].snapped,Se))}function tt(xt){be(),go.update(Se=>(Se.splice(xt,1),Se)),t(4,Y=!1)}function Ve(xt,Se){try{if(xt)return JSON.parse(xt.inner.calculateRoute(Se))}catch{}return Mf()}function qe(xt,Se,Bt,Mn,Fn){if(Fn)return Mf();try{if(xt&&Se.length>0&&Mn){if(Bt=="append-start")return JSON.parse(xt.inner.calculateRoute([Mn,Se[0]]));if(Bt=="append-end")return JSON.parse(xt.inner.calculateRoute([Se[Se.length-1],Mn]))}}catch{}return Mf()}function dt(xt,Se,Bt,Mn){if(Mn)return;if(!xt||Bt!="adjust"){t(11,ae=[]);return}let Fn=[],ei=1;for(let Jt=0;Jt<Se.length-1;Jt++){let Ri=JSON.parse(xt.inner.getExtraNodes(Se[Jt],Se[Jt+1]));for(let[Qi,ns,ht]of Ri)Fn.push({point:[Qi,ns],snapped:ht,insertIdx:ei});ei++}t(11,ae=Fn)}function mt(xt){be(),go.update(Se=>(Se.splice(xt.insertIdx,0,{point:xt.point,snapped:xt.snapped}),Se)),t(6,xe=!0)}function ct(xt){go.update(Se=>(Se[xt.insertIdx].point=xt.point,Se))}function Ut(){t(6,xe=!1)}function bt(xt){let Se=xt.target.tagName,Bt=Se=="INPUT"||Se=="TEXTAREA";xt.key==="Enter"&&!Bt?(xt.stopPropagation(),a.length>=2&&T()):xt.key==="Escape"?(xt.stopPropagation(),C()):xt.key=="s"&&!Bt?ve():xt.key=="1"&&!Bt?t(3,U="append-start"):xt.key=="2"&&!Bt?t(3,U="append-end"):xt.key=="3"&&!Bt?t(3,U="adjust"):xt.key=="z"&&xt.ctrlKey&&(xt.stopPropagation(),ye())}function It(){be(),t(5,ge=!0)}const pt=[[],[]];function kt(xt,Se){s.$$.not_equal(Se.point,xt)&&(Se.point=xt,t(11,ae))}const St=xt=>mt(xt),$t=xt=>ct(xt);function pn(xt,Se){s.$$.not_equal(Se.point,xt)&&(Se.point=xt,go.set(a))}const Pn=xt=>_e(xt),We=xt=>tt(xt),Kn=()=>t(4,Y=!0),dn=()=>t(4,Y=!1),Ot=()=>t(5,ge=!1);function Ae(){ee=this.__value,t(9,ee)}function ut(){ee=this.__value,t(9,ee)}function Ye(){U=this.__value,t(3,U)}function Lt(){U=this.__value,t(3,U)}function Ke(){U=this.__value,t(3,U)}function On(){m=this.checked,Bp.set(m)}return s.$$set=xt=>{"map"in xt&&t(26,S=xt.map),"finish"in xt&&t(0,T=xt.finish),"cancel"in xt&&t(1,C=xt.cancel),"deleteRoute"in xt&&t(2,N=xt.deleteRoute),"editingExisting"in xt&&t(27,B=xt.editingExisting),"$$scope"in xt&&t(46,x=xt.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&456&&dt(h,a,U,xe),s.$$.dirty[0]&268435896&&t(12,r=qe(h,a,U,J,Y||ge)),s.$$.dirty[0]&128&&Ee(a)},[T,C,N,U,Y,ge,xe,a,h,ee,ie,ae,r,m,ye,ve,Ce,we,_e,tt,Ve,mt,ct,Ut,bt,It,S,B,J,l,kt,St,$t,pn,Pn,We,Kn,dn,Ot,Ae,pt,ut,Ye,Lt,Ke,On,x]}class tA extends fn{constructor(e){super(),hn(this,e,eA,QE,on,{map:26,finish:0,cancel:1,deleteRoute:2,editingExisting:27},null,[-1,-1])}}const nA="/npw/assets/SegregatedWide-90b2a345.jpg",iA="/npw/assets/OffRoad-d9bc7e74.jpg",rA="/npw/assets/SegregatedNarrow-5cd3bb62.jpg",sA="/npw/assets/SharedFootway-9cec7d1e.jpg",oA="/npw/assets/CycleLane-4550fbbf.jpg",aA="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA+Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBkZWZhdWx0IHF1YWxpdHkK/9sAQwAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy/8AAEQgA4QEsAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A7Oiiivpj8NCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoq1aafdX+/7NFv2Y3fMBjPTqfarP/CP6p/z6/wDkRf8AGolVpxdnJfeddLAYqrFTp0pNPqotr8jMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8an29L+ZfeX/ZeO/wCfM/8AwF/5GZRWn/wj+qf8+v8A5EX/ABo/4R/VP+fX/wAiL/jR7el/MvvD+y8d/wA+Z/8AgL/yMyitP/hH9U/59f8AyIv+NH/CP6p/z6/+RF/xo9vS/mX3h/ZeO/58z/8AAX/kZlFaf/CP6p/z6/8AkRf8aP8AhH9U/wCfX/yIv+NHt6X8y+8P7Lx3/Pmf/gL/AMjMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8aPb0v5l94f2Xjv+fM//AX/AJGZRWn/AMI/qn/Pr/5EX/Gj/hH9U/59f/Ii/wCNHt6X8y+8P7Lx3/Pmf/gL/wAjMorT/wCEf1T/AJ9f/Ii/40f8I/qn/Pr/AORF/wAaPb0v5l94f2Xjv+fM/wDwF/5GZRWn/wAI/qn/AD6/+RF/xo/4R/VP+fX/AMiL/jR7el/MvvD+y8d/z5n/AOAv/IzKK0/+Ef1T/n1/8iL/AI1FcaPf2sDTTQbY1xk71OMnHY01Wpt2Ul94pZdjIRcpUpJL+6/8ijRRRWhxBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAaFhql9pdsx07TVv7i4uobcI8xiRA2/LswRiAMeneof+E98RNJ4iji8LWM0ug7ftEcWqyM0uU3gRj7P8xx645rc8I/8vn/AAD/ANmrI8E/8lC8f/8AX5bf+ia8PGfx5fL8j9W4b/5FdL/t7/0pmpdeLp5ten0PQdK/tK+tY0kvGkuBBDbbhlVZ9rEsRzgKeKk0fxW+rT6lpb6f9j1+wUNJY3E3yOGHyOsig5Q9NwXI7isD4dg2Xi7x3p118t82rG7Abq0EgzGR6gcj2pIwb74/yz2fMWn6EIL116B3lLIh98fN+Fcp7hZ0Pxzr2t+HP7eh8LQvZh5FaG31EyXHyMVbajRKrdDgbsmtS68faLD4VstftmlvItQdYbKCFf3s8rHAjAPQ5BBz0wax/hFNHb/DSOaaRY4o7m7d3Y4CgTOSSfSvOvD0Etnb+BddukaPRn1+9dN4wqLNhYWPoNysQff3oA9Wm8ZX+jXFn/wkuhLptleSrAl3DeC4SKRvurL8q7c9MjcM9TXX1wHxndJPhre2AXzLu/mgt7SEfeklMqkBffAJ/Cu6tUkitIY5X3yLGqu3qQOTQBLRRRQAUUUUAFFFFABRRRQAUUUUAFZniD/kB3P/AAH/ANCFadZniD/kB3P/AAH/ANCFa0P4sfVHDmn+41v8EvyZw1FFFfQn42FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB03hH/l8/wCAf+zVb0nwlo+iandajYR3SXV3g3DyX08olI4BYO5BIHAOMiuYtNQurDf9ml2b8bvlBzjp1HvVn/hINU/5+v8AyGv+FebiMHUqVHNNH22UcSYXB4OGHqRk2r7JW1bfddzo9W8M6RrdxFc31oTcxKVjuIZXhlVT1UOhDY9s4p1h4e0rStNm0+wtfssE24ymGRlkdj1YyA7y3+1nPvXNf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFY/2fV7r+vkej/rhgf5J/cv8A5IvQfDfwtbWa2SWV01kGLfZJdQuJICSckmNpCpyeeRXQ3WmWN7pr6bc2cEtk6CM27xgptHQY6YHH0rkP+Eg1T/n6/wDIa/4Uf8JBqn/P1/5DX/Cj+z6vdf18g/1wwP8AJP7l/wDJG3p/gzQdMvor23sma5hBWGS4uJJzCD12eYzbP+A4rerhv+Eg1T/n6/8AIa/4Uf8ACQap/wA/X/kNf8KP7Pq91/XyD/XDA/yT+5f/ACR3NFcN/wAJBqn/AD9f+Q1/wo/4SDVP+fr/AMhr/hR/Z9Xuv6+Qf64YH+Sf3L/5I7miuG/4SDVP+fr/AMhr/hR/wkGqf8/X/kNf8KP7Pq91/XyD/XDA/wAk/uX/AMkdzRXDf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFH9n1e6/r5B/rhgf5J/cv/kjuaK4b/hINU/5+v/Ia/wCFH/CQap/z9f8AkNf8KP7Pq91/XyD/AFwwP8k/uX/yR3NFcN/wkGqf8/X/AJDX/Cj/AISDVP8An6/8hr/hR/Z9Xuv6+Qf64YH+Sf3L/wCSO5rM8Qf8gO5/4D/6EK5n/hINU/5+v/Ia/wCFRXGsX91A0M0+6NsZGxRnBz2FXTwNSM1JtaP+uhzYzirB18NUpRjK8otbLqrdyjRRRXqnwIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//2Q==",lA="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA+Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBkZWZhdWx0IHF1YWxpdHkK/9sAQwAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy/8AAEQgA4QEsAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A7Oiiivpj8NCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoq1aafdX+/7NFv2Y3fMBjPTqfarP/CP6p/z6/wDkRf8AGolVpxdnJfeddLAYqrFTp0pNPqotr8jMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8an29L+ZfeX/ZeO/wCfM/8AwF/5GZRWn/wj+qf8+v8A5EX/ABo/4R/VP+fX/wAiL/jR7el/MvvD+y8d/wA+Z/8AgL/yMyitP/hH9U/59f8AyIv+NH/CP6p/z6/+RF/xo9vS/mX3h/ZeO/58z/8AAX/kZlFaf/CP6p/z6/8AkRf8aP8AhH9U/wCfX/yIv+NHt6X8y+8P7Lx3/Pmf/gL/AMjMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8aPb0v5l94f2Xjv+fM//AX/AJGZRWn/AMI/qn/Pr/5EX/Gj/hH9U/59f/Ii/wCNHt6X8y+8P7Lx3/Pmf/gL/wAjMorT/wCEf1T/AJ9f/Ii/40f8I/qn/Pr/AORF/wAaPb0v5l94f2Xjv+fM/wDwF/5GZRWn/wAI/qn/AD6/+RF/xo/4R/VP+fX/AMiL/jR7el/MvvD+y8d/z5n/AOAv/IzKK0/+Ef1T/n1/8iL/AI1FcaPf2sDTTQbY1xk71OMnHY01Wpt2Ul94pZdjIRcpUpJL+6/8ijRRRWhxBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAaFhql9pdsx07TVv7i4uobcI8xiRA2/LswRiAMeneof+E98RNJ4iji8LWM0ug7ftEcWqyM0uU3gRj7P8xx645rc8I/8vn/AAD/ANmrI8E/8lC8f/8AX5bf+ia8PGfx5fL8j9W4b/5FdL/t7/0pmpdeLp5ten0PQdK/tK+tY0kvGkuBBDbbhlVZ9rEsRzgKeKk0fxW+rT6lpb6f9j1+wUNJY3E3yOGHyOsig5Q9NwXI7isD4dg2Xi7x3p118t82rG7Abq0EgzGR6gcj2pIwb74/yz2fMWn6EIL116B3lLIh98fN+Fcp7hZ0Pxzr2t+HP7eh8LQvZh5FaG31EyXHyMVbajRKrdDgbsmtS68faLD4VstftmlvItQdYbKCFf3s8rHAjAPQ5BBz0wax/hFNHb/DSOaaRY4o7m7d3Y4CgTOSSfSvOvD0Etnb+BddukaPRn1+9dN4wqLNhYWPoNysQff3oA9Wm8ZX+jXFn/wkuhLptleSrAl3DeC4SKRvurL8q7c9MjcM9TXX1wHxndJPhre2AXzLu/mgt7SEfeklMqkBffAJ/Cu6tUkitIY5X3yLGqu3qQOTQBLRRRQAUUUUAFFFFABRRRQAUUUUAFZniD/kB3P/AAH/ANCFadZniD/kB3P/AAH/ANCFa0P4sfVHDmn+41v8EvyZw1FFFfQn42FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB03hH/l8/wCAf+zVb0nwlo+iandajYR3SXV3g3DyX08olI4BYO5BIHAOMiuYtNQurDf9ml2b8bvlBzjp1HvVn/hINU/5+v8AyGv+FebiMHUqVHNNH22UcSYXB4OGHqRk2r7JW1bfddzo9W8M6RrdxFc31oTcxKVjuIZXhlVT1UOhDY9s4p1h4e0rStNm0+wtfssE24ymGRlkdj1YyA7y3+1nPvXNf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFY/2fV7r+vkej/rhgf5J/cv8A5IvQfDfwtbWa2SWV01kGLfZJdQuJICSckmNpCpyeeRXQ3WmWN7pr6bc2cEtk6CM27xgptHQY6YHH0rkP+Eg1T/n6/wDIa/4Uf8JBqn/P1/5DX/Cj+z6vdf18g/1wwP8AJP7l/wDJG3p/gzQdMvor23sma5hBWGS4uJJzCD12eYzbP+A4rerhv+Eg1T/n6/8AIa/4Uf8ACQap/wA/X/kNf8KP7Pq91/XyD/XDA/yT+5f/ACR3NFcN/wAJBqn/AD9f+Q1/wo/4SDVP+fr/AMhr/hR/Z9Xuv6+Qf64YH+Sf3L/5I7miuG/4SDVP+fr/AMhr/hR/wkGqf8/X/kNf8KP7Pq91/XyD/XDA/wAk/uX/AMkdzRXDf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFH9n1e6/r5B/rhgf5J/cv/kjuaK4b/hINU/5+v/Ia/wCFH/CQap/z9f8AkNf8KP7Pq91/XyD/AFwwP8k/uX/yR3NFcN/wkGqf8/X/AJDX/Cj/AISDVP8An6/8hr/hR/Z9Xuv6+Qf64YH+Sf3L/wCSO5rM8Qf8gO5/4D/6EK5n/hINU/5+v/Ia/wCFRXGsX91A0M0+6NsZGxRnBz2FXTwNSM1JtaP+uhzYzirB18NUpRjK8otbLqrdyjRRRXqnwIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//2Q==";function o0(s,e,t){const r=s.slice();r[3]=e[t][0],r[4]=e[t][1],r[5]=e[t][2];const a=ou[r[3]];return r[6]=a[0],r[7]=a[1],r}function a0(s){let e,t,r,a,h,m,l,x;function S(){return s[2](s[3])}return{c(){e=le("div"),t=le("img"),a=Oe(),h=le("span"),h.textContent=`${s[6]}`,m=Oe(),ts(t.src,r=s[4])||Ze(t,"src",r),Ze(t,"alt",s[6]),Rn(h,"color",s[7]),Ze(e,"class","card svelte-o9mz9k"),Er(e,"current",s[0]==s[3])},m(T,C){se(T,e,C),G(e,t),G(e,a),G(e,h),G(e,m),l||(x=Mt(e,"click",S),l=!0)},p(T,C){s=T,C&3&&Er(e,"current",s[0]==s[3])},d(T){T&&re(e),l=!1,x()}}}function uA(s){let e,t=qn(s[1]),r=[];for(let a=0;a<t.length;a+=1)r[a]=a0(o0(s,t,a));return{c(){e=le("div");for(let a=0;a<r.length;a+=1)r[a].c();Rn(e,"display","flex"),Rn(e,"flex-wrap","wrap"),Rn(e,"gap","4px")},m(a,h){se(a,e,h);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(e,null)},p(a,[h]){if(h&3){t=qn(a[1]);let m;for(m=0;m<t.length;m+=1){const l=o0(a,t,m);r[m]?r[m].p(l,h):(r[m]=a0(l),r[m].c(),r[m].m(e,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=t.length}},i:Je,o:Je,d(a){a&&re(e),yr(r,a)}}}function cA(s,e,t){let{current:r}=e,a=[["SegregatedWide",nA,"https://www.cyclestreets.net/location/81274/"],["OffRoad",iA,"https://www.cyclestreets.net/location/86744/"],["SegregatedNarrow",rA,"https://www.cyclestreets.net/location/196620/"],["SharedFootway",sA,"https://www.cyclestreets.net/location/92805/"],["CycleLane",oA,"https://www.cyclestreets.net/location/81341/"],["MixedTraffic",aA,""],["Unknown",lA,""]];const h=m=>t(0,r=m);return s.$$set=m=>{"current"in m&&t(0,r=m.current)},[r,a,h]}class hA extends fn{constructor(e){super(),hn(this,e,cA,uA,on,{current:0})}}function fA(s){let e,t,r,a,h,m,l,x,S,T;return{c(){e=le("div"),t=le("label"),r=ze(`Tier:
      `),a=le("select"),h=le("option"),h.textContent="Primary routes",m=le("option"),m.textContent="Secondary routes",l=le("option"),l.textContent="Local access routes",x=le("option"),x.textContent="Long distance routes",h.__value="Primary",vi(h,h.__value),m.__value="Secondary",vi(m,m.__value),l.__value="LocalAccess",vi(l,l.__value),x.__value="LongDistance",vi(x,x.__value),s[5]===void 0&&vo(()=>s[13].call(a)),Ze(e,"slot","extra-left")},m(C,N){se(C,e,N),G(e,t),G(t,r),G(t,a),G(a,h),G(a,m),G(a,l),G(a,x),Zr(a,s[5],!0),S||(T=Mt(a,"change",s[13]),S=!0)},p(C,N){N&32&&Zr(a,C[5])},d(C){C&&re(e),S=!1,T()}}}function l0(s){let e,t;return e=new $i({props:{data:s[6],$$slots:{default:[dA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&64&&(h.data=r[6]),a&524290&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function dA(s){let e,t;return e=new cr({props:{id:"routes",filter:s[1]==null?void 0:["!=",["id"],s[1]],paint:{"line-width":5,"line-color":au,"line-opacity":.5}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&2&&(h.filter=r[1]==null?void 0:["!=",["id"],r[1]]),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function pA(s){let e,t,r=s[6]&&l0(s);return{c(){e=le("span"),r&&r.c(),Ze(e,"slot","extra-map")},m(a,h){se(a,e,h),r&&r.m(e,null),t=!0},p(a,h){a[6]?r?(r.p(a,h),h&64&&he(r,1)):(r=l0(a),r.c(),he(r,1),r.m(e,null)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d()}}}function mA(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U;function ee(ae){s[11](ae)}let ie={};return s[4]!==void 0&&(ie.current=s[4]),m=new hA({props:ie}),Jn.push(()=>_r(m,"current",ee)),{c(){e=le("div"),t=le("label"),r=ze(`Name:
      `),a=le("input"),h=Oe(),ot(m.$$.fragment),x=Oe(),S=le("label"),T=ze(`Notes:
      `),C=le("textarea"),Ze(a,"type","text"),Ze(C,"rows","5"),Ze(e,"slot","extra-right")},m(ae,J){se(ae,e,J),G(e,t),G(t,r),G(t,a),vi(a,s[2]),G(e,h),rt(m,e,null),G(e,x),G(e,S),G(S,T),G(S,C),vi(C,s[3]),N=!0,B||(U=[Mt(a,"input",s[10]),Mt(C,"input",s[12])],B=!0)},p(ae,J){J&4&&a.value!==ae[2]&&vi(a,ae[2]);const Y={};!l&&J&16&&(l=!0,Y.current=ae[4],gr(()=>l=!1)),m.$set(Y),J&8&&vi(C,ae[3])},i(ae){N||(he(m.$$.fragment,ae),N=!0)},o(ae){ke(m.$$.fragment,ae),N=!1},d(ae){ae&&re(e),st(m),B=!1,Ji(U)}}}function gA(s){let e,t;return e=new tA({props:{map:s[0],finish:s[8],cancel:s[9],deleteRoute:s[7],editingExisting:s[1]!=null,$$slots:{"extra-right":[mA],"extra-map":[pA],"extra-left":[fA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,[a]){const h={};a&1&&(h.map=r[0]),a&2&&(h.editingExisting=r[1]!=null),a&524414&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function _A(s,e,t){let r,a,h,m,l;Pt(s,Oi,Ee=>t(14,r=Ee)),Pt(s,Yi,Ee=>t(15,a=Ee)),Pt(s,go,Ee=>t(16,h=Ee)),Pt(s,Qf,Ee=>t(17,m=Ee)),Pt(s,Ma,Ee=>t(18,l=Ee));let{map:x}=e,{id:S}=e,T="",C="",N="Unknown",B=l,U=null;cc(async()=>{if(t(6,U=await a.renderRoutes()),Dn(go,h=[],h),S!=null){let Ee=U.features.find(ye=>ye.id==S);t(2,T=Ee.properties.name),t(3,C=Ee.properties.notes),t(4,N=Ee.properties.infra_type),t(5,B=Ee.properties.tier),Dn(go,h=Ee.properties.waypoints.map(ye=>({point:[ye.lon,ye.lat],snapped:ye.snapped})),h)}});async function ee(){S&&(await a.deleteRoute(S),await Dh()),Dn(Oi,r={kind:"main"},r)}async function ie(){try{let Ee=JSON.parse(m.inner.calculateRoute(h));if(!Ee){window.alert("No route drawn");return}await a.setRoute(S,{feature:Ee,name:T,notes:C,nodes:Ee.properties.full_path,infra_type:N,tier:B}),await Dh(),Dn(Oi,r={kind:"main"},r)}catch(Ee){window.alert(Ee)}}function ae(){Dn(Oi,r={kind:"main"},r)}function J(){T=this.value,t(2,T)}function Y(Ee){N=Ee,t(4,N)}function ge(){C=this.value,t(3,C)}function xe(){B=Da(this),t(5,B)}return s.$$set=Ee=>{"map"in Ee&&t(0,x=Ee.map),"id"in Ee&&t(1,S=Ee.id)},[x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge,xe]}class yA extends fn{constructor(e){super(),hn(this,e,_A,gA,on,{map:0,id:1})}}function u0(s,e,t){const r=s.slice();return r[3]=e[t],r}function c0(s){let e,t,r,a=s[3].infra_type+"",h,m,l=s[3].name+"",x,S,T;return{c(){e=le("li"),t=le("a"),r=ze("["),h=ze(a),m=ze("] "),x=ze(l),T=Oe(),Ze(t,"href",S=s[3].way),Ze(t,"target","_blank")},m(C,N){se(C,e,N),G(e,t),G(t,r),G(t,h),G(t,m),G(t,x),G(e,T)},p(C,N){N&1&&a!==(a=C[3].infra_type+"")&&Ct(h,a),N&1&&l!==(l=C[3].name+"")&&Ct(x,l),N&1&&S!==(S=C[3].way)&&Ze(t,"href",S)},d(C){C&&re(e)}}}function vA(s){let e,t,r,a=(s[0].route_length/s[0].direct_length).toFixed(1)+"",h,m,l,x,S,T,C=(s[0].route_length/s[0].car_length).toFixed(1)+"",N,B,U,ee,ie,ae,J,Y,ge,xe=If(s[0],s[1])+"",Ee,ye,be,ve,Ce,we=Sf(s[0],s[1])+"",_e,tt,Ve,qe,dt,mt=If(s[0],s[2])+"",ct,Ut,bt,It,pt,kt=Sf(s[0],s[2])+"",St,$t,pn,Pn,We,Kn,dn,Ot,Ae=qn(s[0].directions),ut=[];for(let Ye=0;Ye<Ae.length;Ye+=1)ut[Ye]=c0(u0(s,Ae,Ye));return{c(){e=le("p"),t=ze("Detour factor: "),r=le("b"),h=ze(a),m=ze("x"),l=ze(`
  longer than straight line`),x=Oe(),S=le("p"),T=le("b"),N=ze(C),B=ze("x"),U=ze(`
  longer than the driving route (in
  `),ee=le("span"),ee.textContent="red",ie=ze(`
  )`),ae=Oe(),J=le("hr"),Y=Oe(),ge=le("p"),Ee=ze(xe),ye=ze(" changes in infrastructure type"),be=Oe(),ve=le("p"),Ce=ze("By length: "),_e=ze(we),tt=Oe(),Ve=le("hr"),qe=Oe(),dt=le("p"),ct=ze(mt),Ut=ze(" changes in level of service"),bt=Oe(),It=le("p"),pt=ze("By length: "),St=ze(kt),$t=Oe(),pn=le("hr"),Pn=Oe(),We=le("details"),Kn=le("summary"),Kn.textContent="Route directions",dn=Oe(),Ot=le("ol");for(let Ye=0;Ye<ut.length;Ye+=1)ut[Ye].c();Rn(ee,"color","red")},m(Ye,Lt){se(Ye,e,Lt),G(e,t),G(e,r),G(r,h),G(r,m),G(e,l),se(Ye,x,Lt),se(Ye,S,Lt),G(S,T),G(T,N),G(T,B),G(S,U),G(S,ee),G(S,ie),se(Ye,ae,Lt),se(Ye,J,Lt),se(Ye,Y,Lt),se(Ye,ge,Lt),G(ge,Ee),G(ge,ye),se(Ye,be,Lt),se(Ye,ve,Lt),G(ve,Ce),G(ve,_e),se(Ye,tt,Lt),se(Ye,Ve,Lt),se(Ye,qe,Lt),se(Ye,dt,Lt),G(dt,ct),G(dt,Ut),se(Ye,bt,Lt),se(Ye,It,Lt),G(It,pt),G(It,St),se(Ye,$t,Lt),se(Ye,pn,Lt),se(Ye,Pn,Lt),se(Ye,We,Lt),G(We,Kn),G(We,dn),G(We,Ot);for(let Ke=0;Ke<ut.length;Ke+=1)ut[Ke]&&ut[Ke].m(Ot,null)},p(Ye,[Lt]){if(Lt&1&&a!==(a=(Ye[0].route_length/Ye[0].direct_length).toFixed(1)+"")&&Ct(h,a),Lt&1&&C!==(C=(Ye[0].route_length/Ye[0].car_length).toFixed(1)+"")&&Ct(N,C),Lt&1&&xe!==(xe=If(Ye[0],Ye[1])+"")&&Ct(Ee,xe),Lt&1&&we!==(we=Sf(Ye[0],Ye[1])+"")&&Ct(_e,we),Lt&1&&mt!==(mt=If(Ye[0],Ye[2])+"")&&Ct(ct,mt),Lt&1&&kt!==(kt=Sf(Ye[0],Ye[2])+"")&&Ct(St,kt),Lt&1){Ae=qn(Ye[0].directions);let Ke;for(Ke=0;Ke<Ae.length;Ke+=1){const On=u0(Ye,Ae,Ke);ut[Ke]?ut[Ke].p(On,Lt):(ut[Ke]=c0(On),ut[Ke].c(),ut[Ke].m(Ot,null))}for(;Ke<ut.length;Ke+=1)ut[Ke].d(1);ut.length=Ae.length}},i:Je,o:Je,d(Ye){Ye&&(re(e),re(x),re(S),re(ae),re(J),re(Y),re(ge),re(be),re(ve),re(tt),re(Ve),re(qe),re(dt),re(bt),re(It),re($t),re(pn),re(Pn),re(We)),yr(ut,Ye)}}}function If(s,e){let t=0;for(let r=0;r<s.directions.length-1;r++){let a=e(s.directions[r]),h=e(s.directions[r+1]);a!=h&&t++}return t}function Sf(s,e){let t={};for(let h of s.directions){let m=e(h);Object.hasOwn(t,m)||(t[m]=0),t[m]+=h.length}let r=0;for(let h of Object.values(t))r+=h;let a=[];for(let[h,m]of Object.entries(t).toSorted((l,x)=>x[1]-l[1])){let l=Math.round(m/r*100);a.push(`${l}% ${h}`)}return a.join(", ")}function bA(s,e,t){let{gj:r}=e,a=m=>m.infra_type,h=m=>m.los;return s.$$set=m=>{"gj"in m&&t(0,r=m.gj)},[r,a,h]}class xA extends fn{constructor(e){super(),hn(this,e,bA,vA,on,{gj:0})}}function h0(s){let e,t;return{c(){e=le("p"),t=ze(s[6])},m(r,a){se(r,e,a),G(e,t)},p(r,a){a&64&&Ct(t,r[6])},d(r){r&&re(e)}}}function f0(s){let e,t;return e=new _c({props:{colors:im}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function d0(s){let e,t;return e=new xA({props:{gj:s[5]}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&32&&(h.gj=r[5]),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function wA(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge=s[6]&&h0(s),xe=s[2]=="los"&&f0(),Ee=s[5]&&d0(s);return{c(){e=le("div"),t=le("h2"),t.textContent="Evaluate a route mode",r=Oe(),a=le("button"),a.textContent="Back",h=Oe(),m=le("p"),m.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,l=Oe(),ge&&ge.c(),x=Oe(),S=le("label"),T=ze(`Show details along route
      `),C=le("select"),N=le("option"),N.textContent="Just show route",B=le("option"),B.textContent="Level of service",U=le("option"),U.textContent="Infrastructure type",ee=Oe(),xe&&xe.c(),ie=Oe(),Ee&&Ee.c(),N.__value="",vi(N,N.__value),B.__value="los",vi(B,B.__value),U.__value="infra_type",vi(U,U.__value),s[2]===void 0&&vo(()=>s[17].call(C)),Ze(e,"slot","left")},m(ye,be){se(ye,e,be),G(e,t),G(e,r),G(e,a),G(e,h),G(e,m),G(e,l),ge&&ge.m(e,null),G(e,x),G(e,S),G(S,T),G(S,C),G(C,N),G(C,B),G(C,U),Zr(C,s[2],!0),G(e,ee),xe&&xe.m(e,null),G(e,ie),Ee&&Ee.m(e,null),ae=!0,J||(Y=[Mt(a,"click",s[16]),Mt(C,"change",s[17])],J=!0)},p(ye,be){ye[6]?ge?ge.p(ye,be):(ge=h0(ye),ge.c(),ge.m(e,x)):ge&&(ge.d(1),ge=null),be&4&&Zr(C,ye[2]),ye[2]=="los"?xe?be&4&&he(xe,1):(xe=f0(),xe.c(),he(xe,1),xe.m(e,ie)):xe&&(Nn(),ke(xe,1,1,()=>{xe=null}),zn()),ye[5]?Ee?(Ee.p(ye,be),be&32&&he(Ee,1)):(Ee=d0(ye),Ee.c(),he(Ee,1),Ee.m(e,null)):Ee&&(Nn(),ke(Ee,1,1,()=>{Ee=null}),zn())},i(ye){ae||(he(xe),he(Ee),ae=!0)},o(ye){ke(xe),ke(Ee),ae=!1},d(ye){ye&&re(e),ge&&ge.d(),xe&&xe.d(),Ee&&Ee.d(),J=!1,Ji(Y)}}}function kA(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function IA(s){let e,t;return e=new $i({props:{data:s[20],$$slots:{default:[SA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&256&&(h.data=r[20]),a&2097664&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function SA(s){let e,t;return e=new cr({props:{id:"routes",paint:{"line-width":5,"line-color":au},layout:{visibility:s[9]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&512&&(h.layout={visibility:r[9]?"visible":"none"}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function EA(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function p0(s){let e,t,r,a,h,m;function l(C){s[14](C)}let x={draggable:!0,$$slots:{default:[AA]},$$scope:{ctx:s}};s[4]!==void 0&&(x.lngLat=s[4]),e=new Zf({props:x}),Jn.push(()=>_r(e,"lngLat",l));function S(C){s[15](C)}let T={draggable:!0,$$slots:{default:[TA]},$$scope:{ctx:s}};return s[3]!==void 0&&(T.lngLat=s[3]),a=new Zf({props:T}),Jn.push(()=>_r(a,"lngLat",S)),{c(){ot(e.$$.fragment),r=Oe(),ot(a.$$.fragment)},m(C,N){rt(e,C,N),se(C,r,N),rt(a,C,N),m=!0},p(C,N){const B={};N&2097152&&(B.$$scope={dirty:N,ctx:C}),!t&&N&16&&(t=!0,B.lngLat=C[4],gr(()=>t=!1)),e.$set(B);const U={};N&2097152&&(U.$$scope={dirty:N,ctx:C}),!h&&N&8&&(h=!0,U.lngLat=C[3],gr(()=>h=!1)),a.$set(U)},i(C){m||(he(e.$$.fragment,C),he(a.$$.fragment,C),m=!0)},o(C){ke(e.$$.fragment,C),ke(a.$$.fragment,C),m=!1},d(C){C&&re(r),st(e,C),st(a,C)}}}function AA(s){let e;return{c(){e=le("span"),e.textContent="A",Ze(e,"class","dot svelte-1ej0v4r")},m(t,r){se(t,e,r)},p:Je,d(t){t&&re(e)}}}function TA(s){let e;return{c(){e=le("span"),e.textContent="B",Ze(e,"class","dot svelte-1ej0v4r")},m(t,r){se(t,e,r)},p:Je,d(t){t&&re(e)}}}function m0(s){let e,t;return e=new $i({props:{data:s[5],generateId:!0,$$slots:{default:[CA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&32&&(h.data=r[5]),a&2097156&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function CA(s){let e,t,r,a;return e=new cr({props:{filter:["!",["has","car_route"]],paint:{"line-width":20,"line-color":s[2]==""?"cyan":s[2]=="los"?jp:au,"line-opacity":zr(.5,1)},manageHoverState:!0}}),r=new cr({props:{filter:["has","car_route"],paint:{"line-width":10,"line-color":"red","line-opacity":zr(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,m){const l={};m&4&&(l.paint={"line-width":20,"line-color":h[2]==""?"cyan":h[2]=="los"?jp:au,"line-opacity":zr(.5,1)}),e.$set(l)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function LA(s){let e,t,r,a,h,m,l;t=new Qv({}),t.$on("contextmenu",s[10]);let x={ctx:s,current:null,token:null,hasCatch:!1,pending:EA,then:IA,catch:kA,value:20,blocks:[,,,]};Xr(a=Il(s[8]).renderRoutes(),x);let S=s[4]&&s[3]&&p0(s),T=s[5]&&m0(s);return{c(){e=le("div"),ot(t.$$.fragment),r=Oe(),x.block.c(),h=Oe(),S&&S.c(),m=Oe(),T&&T.c(),Ze(e,"slot","map")},m(C,N){se(C,e,N),rt(t,e,null),G(e,r),x.block.m(e,x.anchor=null),x.mount=()=>e,x.anchor=h,G(e,h),S&&S.m(e,null),G(e,m),T&&T.m(e,null),l=!0},p(C,N){s=C,x.ctx=s,N&256&&a!==(a=Il(s[8]).renderRoutes())&&Xr(a,x)||Oa(x,s,N),s[4]&&s[3]?S?(S.p(s,N),N&24&&he(S,1)):(S=p0(s),S.c(),he(S,1),S.m(e,m)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn()),s[5]?T?(T.p(s,N),N&32&&he(T,1)):(T=m0(s),T.c(),he(T,1),T.m(e,null)):T&&(Nn(),ke(T,1,1,()=>{T=null}),zn())},i(C){l||(he(t.$$.fragment,C),he(x.block),he(S),he(T),l=!0)},o(C){ke(t.$$.fragment,C);for(let N=0;N<3;N+=1){const B=x.blocks[N];ke(B)}ke(S),ke(T),l=!1},d(C){C&&re(e),st(t),x.block.d(),x.token=null,x=null,S&&S.d(),T&&T.d()}}}function g0(s){let e,t,r,a,h,m,l,x=s[1]+1+"",S,T,C=s[0].length+"",N,B,U,ee,ie,ae,J;return{c(){e=le("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",t=Oe(),r=le("div"),a=le("button"),h=ze("Previous"),l=Oe(),S=ze(x),T=ze(" / "),N=ze(C),B=Oe(),U=le("button"),ee=ze("Next"),Ze(a,"class","secondary"),a.disabled=m=s[1]==0,Ze(U,"class","secondary"),U.disabled=ie=s[1]==s[0].length-1},m(Y,ge){se(Y,e,ge),se(Y,t,ge),se(Y,r,ge),G(r,a),G(a,h),G(r,l),G(r,S),G(r,T),G(r,N),G(r,B),G(r,U),G(U,ee),ae||(J=[Mt(a,"click",s[12]),Mt(U,"click",s[13])],ae=!0)},p(Y,ge){ge&2&&m!==(m=Y[1]==0)&&(a.disabled=m),ge&2&&x!==(x=Y[1]+1+"")&&Ct(S,x),ge&1&&C!==(C=Y[0].length+"")&&Ct(N,C),ge&3&&ie!==(ie=Y[1]==Y[0].length-1)&&(U.disabled=ie)},d(Y){Y&&(re(e),re(t),re(r)),ae=!1,Ji(J)}}}function MA(s){let e,t=s[0].length>0&&g0(s);return{c(){e=le("div"),t&&t.c(),Ze(e,"slot","right")},m(r,a){se(r,e,a),t&&t.m(e,null)},p(r,a){r[0].length>0?t?t.p(r,a):(t=g0(r),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},d(r){r&&re(e),t&&t.d()}}}function RA(s){let e,t,r,a;return e=new gc({props:{$$slots:{right:[MA],map:[LA],left:[wA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(h,m){rt(e,h,m),t=!0,r||(a=Mt(window,"keydown",s[11]),r=!0)},p(h,[m]){const l={};m&2098175&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){t||(he(e.$$.fragment,h),t=!0)},o(h){ke(e.$$.fragment,h),t=!1},d(h){st(e,h),r=!1,a()}}}function PA(s,e,t){let r,a,h,m,l;Pt(s,Oi,ye=>t(7,r=ye)),Pt(s,Sh,ye=>t(3,a=ye)),Pt(s,Qu,ye=>t(4,h=ye)),Pt(s,Yi,ye=>t(8,m=ye)),Pt(s,Op,ye=>t(9,l=ye));let{browse:x}=e,S=0,T=null,C="",N="los";async function B(ye,be,ve=""){try{t(5,T=await m.evaluateRoute({start:ye,end:[be.lng,be.lat],breakdown:ve})),t(6,C="")}catch(Ce){t(5,T=null),t(6,C=Ce.toString())}}function U(ye){Dn(Qu,h=ye.detail.lngLat,h)}async function ee(ye){if(x.length==0)return;let be=x[ye];Dn(Qu,h={lng:be[0].x,lat:be[0].y},h),Dn(Sh,a={lng:be[1].x,lat:be[1].y},a),B(h,a,N)}function ie(ye){ye.key==="Escape"&&(ye.stopPropagation(),Dn(Oi,r={kind:"main"},r))}const ae=()=>t(1,S--,S),J=()=>t(1,S++,S);function Y(ye){h=ye,Qu.set(h)}function ge(ye){a=ye,Sh.set(a)}const xe=()=>Dn(Oi,r={kind:"main"},r);function Ee(){N=Da(this),t(2,N)}return s.$$set=ye=>{"browse"in ye&&t(0,x=ye.browse)},s.$$.update=()=>{s.$$.dirty&28&&B(h,a,N),s.$$.dirty&2&&ee(S)},[x,S,N,a,h,T,C,r,m,l,U,ie,ae,J,Y,ge,xe,Ee]}class DA extends fn{constructor(e){super(),hn(this,e,PA,RA,on,{browse:0})}}function Sr(s,e){return e==0?"0%":`${Math.round(s/e*100)}%`}function ed(s){return s.reduce((e,t)=>e+t,0)}function td(s){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]]]}function rm(s){return["step",["get",s],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function l1(){return["step",["abs",["get","gradient"]],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}function _0(s,e,t){const r=s.slice();return r[5]=e[t][0],r[6]=e[t][1],r}function y0(s){let e,t=s[0].succeeded.toLocaleString()+"",r,a,h=s[0].failed.toLocaleString()+"",m,l,x,S,T,C=s[0].max_count.toLocaleString()+"",N,B,U,ee,ie,ae,J,Y=(100*s[0].percent_off_network).toFixed(1)+"",ge,xe,Ee,ye=qn(Object.entries(s[0].percent_on_network)),be=[];for(let ve=0;ve<ye.length;ve+=1)be[ve]=v0(_0(s,ye,ve));return{c(){e=le("p"),r=ze(t),a=ze(" routes succeeded, "),m=ze(h),l=ze(`
        failed`),x=Oe(),S=le("p"),T=ze("Highest count on any one road is "),N=ze(C),B=Oe(),U=le("p"),U.textContent="Percent of demand by infrastructure type:",ee=Oe(),ie=le("ul"),ae=le("li"),J=ze("Off the network: "),ge=ze(Y),xe=ze("%"),Ee=Oe();for(let ve=0;ve<be.length;ve+=1)be[ve].c()},m(ve,Ce){se(ve,e,Ce),G(e,r),G(e,a),G(e,m),G(e,l),se(ve,x,Ce),se(ve,S,Ce),G(S,T),G(S,N),se(ve,B,Ce),se(ve,U,Ce),se(ve,ee,Ce),se(ve,ie,Ce),G(ie,ae),G(ae,J),G(ae,ge),G(ae,xe),G(ie,Ee);for(let we=0;we<be.length;we+=1)be[we]&&be[we].m(ie,null)},p(ve,Ce){if(Ce&1&&t!==(t=ve[0].succeeded.toLocaleString()+"")&&Ct(r,t),Ce&1&&h!==(h=ve[0].failed.toLocaleString()+"")&&Ct(m,h),Ce&1&&C!==(C=ve[0].max_count.toLocaleString()+"")&&Ct(N,C),Ce&1&&Y!==(Y=(100*ve[0].percent_off_network).toFixed(1)+"")&&Ct(ge,Y),Ce&1){ye=qn(Object.entries(ve[0].percent_on_network));let we;for(we=0;we<ye.length;we+=1){const _e=_0(ve,ye,we);be[we]?be[we].p(_e,Ce):(be[we]=v0(_e),be[we].c(),be[we].m(ie,null))}for(;we<be.length;we+=1)be[we].d(1);be.length=ye.length}},d(ve){ve&&(re(e),re(x),re(S),re(B),re(U),re(ee),re(ie)),yr(be,ve)}}}function v0(s){let e,t=s[5]+"",r,a,h=(100*s[6]).toFixed(1)+"",m,l;return{c(){e=le("li"),r=ze(t),a=ze(": "),m=ze(h),l=ze("%")},m(x,S){se(x,e,S),G(e,r),G(e,a),G(e,m),G(e,l)},p(x,S){S&1&&t!==(t=x[5]+"")&&Ct(r,t),S&1&&h!==(h=(100*x[6]).toFixed(1)+"")&&Ct(m,h)},d(x){x&&re(e)}}}function NA(s){let e,t,r,a,h,m,l,x=s[0]&&y0(s);return{c(){e=le("div"),t=le("h2"),t.textContent="Evaluate OD mode",r=Oe(),a=le("button"),a.textContent="Back",h=Oe(),x&&x.c(),Ze(e,"slot","left")},m(S,T){se(S,e,T),G(e,t),G(e,r),G(e,a),G(e,h),x&&x.m(e,null),m||(l=Mt(a,"click",s[2]),m=!0)},p(S,T){S[0]?x?x.p(S,T):(x=y0(S),x.c(),x.m(e,null)):x&&(x.d(1),x=null)},d(S){S&&re(e),x&&x.d(),m=!1,l()}}}function b0(s){let e,t;return e=new $i({props:{data:s[0],generateId:!0,$$slots:{default:[OA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.data=r[0]),a&512&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function zA(s){let e=s[4].count+"",t,r,a=s[4].infra_type+"",h;return{c(){t=ze(e),r=ze(" on "),h=ze(a)},m(m,l){se(m,t,l),se(m,r,l),se(m,h,l)},p(m,l){l&16&&e!==(e=m[4].count+"")&&Ct(t,e),l&16&&a!==(a=m[4].infra_type+"")&&Ct(h,a)},d(m){m&&(re(t),re(r),re(h))}}}function FA(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[zA,({props:r})=>({4:r}),({props:r})=>r?16:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&528&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function OA(s){let e,t;return e=new cr({props:{paint:{"line-width":td("count"),"line-color":rm("count")},manageHoverState:!0,eventsIfTopMost:!0,$$slots:{default:[FA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&512&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function BA(s){let e,t,r=s[0]&&b0(s);return{c(){e=le("div"),r&&r.c(),Ze(e,"slot","map")},m(a,h){se(a,e,h),r&&r.m(e,null),t=!0},p(a,h){a[0]?r?(r.p(a,h),h&1&&he(r,1)):(r=b0(a),r.c(),he(r,1),r.m(e,null)):r&&(Nn(),ke(r,1,1,()=>{r=null}),zn())},i(a){t||(he(r),t=!0)},o(a){ke(r),t=!1},d(a){a&&re(e),r&&r.d()}}}function UA(s){let e,t;return e=new gc({props:{$$slots:{map:[BA],left:[NA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,[a]){const h={};a&515&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function jA(s,e,t){let r,a;Pt(s,Yi,l=>t(3,r=l)),Pt(s,Oi,l=>t(1,a=l));let h=null;return cc(async()=>{t(0,h=await r.evaluateOD())}),[h,a,()=>Dn(Oi,a={kind:"main"},a)]}class qA extends fn{constructor(e){super(),hn(this,e,jA,UA,on,{})}}function VA(s){let e;return{c(){e=le("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(t,r){se(t,e,r)},d(t){t&&re(e)}}}function GA(s){let e;return{c(){e=le("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(t,r){se(t,e,r)},d(t){t&&re(e)}}}function ZA(s){let e;return{c(){e=le("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(t,r){se(t,e,r)},d(t){t&&re(e)}}}function HA(s){let e;return{c(){e=le("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(t,r){se(t,e,r)},d(t){t&&re(e)}}}function XA(s){let e;function t(h,m){if(h[0]=="Primary")return HA;if(h[0]=="Secondary")return ZA;if(h[0]=="LocalAccess")return GA;if(h[0]=="LongDistance")return VA}let r=t(s),a=r&&r(s);return{c(){a&&a.c(),e=Gn()},m(h,m){a&&a.m(h,m),se(h,e,m)},p(h,m){r!==(r=t(h))&&(a&&a.d(1),a=r&&r(h),a&&(a.c(),a.m(e.parentNode,e)))},d(h){h&&re(e),a&&a.d(h)}}}function WA(s){let e,t,r,a,h,m,l,x,S,T,C,N,B;return T=new s1({props:{$$slots:{default:[XA]},$$scope:{ctx:s}}}),{c(){e=le("div"),t=le("button"),t.textContent="Primary routes",r=Oe(),a=le("button"),a.textContent="Secondary routes",h=Oe(),m=le("button"),m.textContent="Local access routes",l=Oe(),x=le("button"),x.textContent="Long distance routes",S=Oe(),ot(T.$$.fragment),Ze(t,"class","svelte-gv50c1"),Rn(t,"background",s[0]=="Primary"?Nr.Primary:"grey"),Ze(a,"class","svelte-gv50c1"),Rn(a,"background",s[0]=="Secondary"?Nr.Secondary:"grey"),Ze(m,"class","svelte-gv50c1"),Rn(m,"background",s[0]=="LocalAccess"?Nr.LocalAccess:"grey"),Ze(x,"class","svelte-gv50c1"),Rn(x,"background",s[0]=="LongDistance"?Nr.LongDistance:"grey"),Ze(e,"class","svelte-gv50c1")},m(U,ee){se(U,e,ee),G(e,t),G(e,r),G(e,a),G(e,h),G(e,m),G(e,l),G(e,x),G(e,S),rt(T,e,null),C=!0,N||(B=[Mt(t,"click",s[1]),Mt(a,"click",s[2]),Mt(m,"click",s[3]),Mt(x,"click",s[4])],N=!0)},p(U,[ee]){ee&1&&Rn(t,"background",U[0]=="Primary"?Nr.Primary:"grey"),ee&1&&Rn(a,"background",U[0]=="Secondary"?Nr.Secondary:"grey"),ee&1&&Rn(m,"background",U[0]=="LocalAccess"?Nr.LocalAccess:"grey"),ee&1&&Rn(x,"background",U[0]=="LongDistance"?Nr.LongDistance:"grey");const ie={};ee&33&&(ie.$$scope={dirty:ee,ctx:U}),T.$set(ie)},i(U){C||(he(T.$$.fragment,U),C=!0)},o(U){ke(T.$$.fragment,U),C=!1},d(U){U&&re(e),st(T),N=!1,Ji(B)}}}function KA(s,e,t){let r;return Pt(s,Ma,x=>t(0,r=x)),[r,()=>Dn(Ma,r="Primary",r),()=>Dn(Ma,r="Secondary",r),()=>Dn(Ma,r="LocalAccess",r),()=>Dn(Ma,r="LongDistance",r)]}class $A extends fn{constructor(e){super(),hn(this,e,KA,WA,on,{})}}function YA(s){let e,t;const r=s[3].default,a=Zi(r,s,s[2],null);return{c(){e=le("div"),a&&a.c()},m(h,m){se(h,e,m),a&&a.m(e,null),s[4](e),t=!0},p(h,[m]){a&&a.p&&(!t||m&4)&&Xi(a,r,h,h[2],t?Hi(r,h[2],m,null):Wi(h[2]),null)},i(h){t||(he(a,h),t=!0)},o(h){ke(a,h),t=!1},d(h){h&&re(e),a&&a.d(h),s[4](null)}}}function JA(s,e,t){let{$$slots:r={},$$scope:a}=e,{name:h}=e,m=null;function l(x){Jn[x?"unshift":"push"](()=>{m=x,t(0,m)})}return s.$$set=x=>{"name"in x&&t(1,h=x.name),"$$scope"in x&&t(2,a=x.$$scope)},s.$$.update=()=>{s.$$.dirty&3&&m&&r1.update(x=>(x.set(h,m),x))},[m,h,a,r,l]}class qs extends fn{constructor(e){super(),hn(this,e,JA,YA,on,{name:1})}}function x0(s){let e,t,r;return{c(){e=le("button"),e.textContent="Import existing routes",Ze(e,"class","outline")},m(a,h){se(a,e,h),t||(r=Mt(e,"click",s[6]),t=!0)},p:Je,d(a){a&&re(e),t=!1,r()}}}function QA(s){let e,t,r,a,h,m,l,x=s[0]&&x0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Existing network`),a=Oe(),x&&x.c(),h=Gn(),Ze(t,"type","checkbox")},m(S,T){se(S,e,T),G(e,t),t.checked=s[0],G(e,r),se(S,a,T),x&&x.m(S,T),se(S,h,T),m||(l=Mt(t,"change",s[5]),m=!0)},p(S,T){T&1&&(t.checked=S[0]),S[0]?x?x.p(S,T):(x=x0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(re(e),re(a),re(h)),x&&x.d(S),m=!1,l()}}}function w0(s){let e,t;return e=new e1({props:{$$slots:{default:[eT]},$$scope:{ctx:s}}}),e.$on("close",s[8]),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&4100&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function eT(s){let e,t,r,a,h,m,l,x,S;return{c(){e=le("h2"),e.textContent="Import existing routes from OpenStreetMap",t=Oe(),r=le("p"),a=ze(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),h=le("button"),h.textContent="Import existing routes",m=Oe(),l=le("button"),l.textContent="Cancel",Ze(l,"class","secondary")},m(T,C){se(T,e,C),se(T,t,C),se(T,r,C),G(r,a),G(r,h),G(r,m),G(r,l),x||(S=[Mt(h,"click",s[4]),Mt(l,"click",s[7])],x=!0)},p:Je,d(T){T&&(re(e),re(t),re(r)),x=!1,Ji(S)}}}function k0(s){let e,t,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:oT,then:nT,catch:tT,value:10,blocks:[,,,]};return Xr(t=s[3].classifyExistingNetwork(),a),{c(){e=Gn(),a.block.c()},m(h,m){se(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&8&&t!==(t=s[3].classifyExistingNetwork())&&Xr(t,a)||Oa(a,s,m)},i(h){r||(he(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];ke(l)}r=!1},d(h){h&&re(e),a.block.d(h),a.token=null,a=null}}}function tT(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function nT(s){let e,t;return e=new $i({props:{data:s[10],generateId:!0,$$slots:{default:[sT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&8&&(h.data=r[10]),a&4097&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function iT(s){let e=ou[s[11].infra_type][0]+"",t;return{c(){t=ze(e)},m(r,a){se(r,t,a)},p(r,a){a&2048&&e!==(e=ou[r[11].infra_type][0]+"")&&Ct(t,e)},d(r){r&&re(t)}}}function rT(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[iT,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function sT(s){let e,t;return e=new cr({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":zr(5,7),"line-color":au,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[rT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),a&4096&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function oT(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function aT(s){let e,t,r,a,h;e=new qs({props:{name:"existing network",$$slots:{default:[QA]},$$scope:{ctx:s}}});let m=s[2]&&w0(s),l=s[3]&&s[1]&&k0(s);return{c(){ot(e.$$.fragment),t=Oe(),m&&m.c(),r=Oe(),l&&l.c(),a=Gn()},m(x,S){rt(e,x,S),se(x,t,S),m&&m.m(x,S),se(x,r,S),l&&l.m(x,S),se(x,a,S),h=!0},p(x,[S]){const T={};S&4101&&(T.$$scope={dirty:S,ctx:x}),e.$set(T),x[2]?m?(m.p(x,S),S&4&&he(m,1)):(m=w0(x),m.c(),he(m,1),m.m(r.parentNode,r)):m&&(Nn(),ke(m,1,1,()=>{m=null}),zn()),x[3]&&x[1]?l?(l.p(x,S),S&10&&he(l,1)):(l=k0(x),l.c(),he(l,1),l.m(a.parentNode,a)):l&&(Nn(),ke(l,1,1,()=>{l=null}),zn())},i(x){h||(he(e.$$.fragment,x),he(m),he(l),h=!0)},o(x){ke(e.$$.fragment,x),ke(m),ke(l),h=!1},d(x){x&&(re(t),re(r),re(a)),st(e,x),m&&m.d(x),l&&l.d(x)}}}function lT(s,e,t){let r,a;Pt(s,Ph,B=>t(9,r=B)),Pt(s,Yi,B=>t(3,a=B));let h=!1,m=!1,l=!1;async function x(){if(t(2,l=!1),a){let B=a.importExistingRoutes(),U=B==1?"route segment":"route segments";await Dh(),Dn(Ph,r+=1,r),window.alert(`Imported ${B} ${U}`),t(0,h=!1)}}function S(){h=this.checked,t(0,h)}const T=()=>t(2,l=!0),C=()=>t(2,l=!1),N=()=>t(2,l=!1);return s.$$.update=()=>{s.$$.dirty&1&&h&&t(1,m=!0)},[h,m,l,a,x,S,T,C,N]}class uT extends fn{constructor(e){super(),hn(this,e,lT,aT,on,{})}}function I0(s,e,t){const r=s.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function S0(s,e,t){const r=s.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function E0(s,e,t){const r=s.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function A0(s,e,t){const r=s.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function T0(s,e,t){const r=s.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function C0(s,e,t){const r=s.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function L0(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J=qn(s[7]),Y=[];for(let Ce=0;Ce<J.length;Ce+=1)Y[Ce]=M0(C0(s,J,Ce));let ge=qn(s[8]),xe=[];for(let Ce=0;Ce<ge.length;Ce+=1)xe[Ce]=R0(T0(s,ge,Ce));let Ee=qn(s[9]),ye=[];for(let Ce=0;Ce<Ee.length;Ce+=1)ye[Ce]=P0(A0(s,Ee,Ce));let be=qn(s[10]),ve=[];for(let Ce=0;Ce<be.length;Ce+=1)ve[Ce]=D0(E0(s,be,Ce));return{c(){e=le("label"),t=ze(`Trip purpose:
      `),r=le("select");for(let Ce=0;Ce<Y.length;Ce+=1)Y[Ce].c();a=Oe(),h=le("label"),m=ze(`Scenario:
      `),l=le("select");for(let Ce=0;Ce<xe.length;Ce+=1)xe[Ce].c();x=Oe(),S=le("label"),T=ze(`Network type:
      `),C=le("select");for(let Ce=0;Ce<ye.length;Ce+=1)ye[Ce].c();N=Oe(),B=le("label"),U=ze(`Color by:
      `),ee=le("select");for(let Ce=0;Ce<ve.length;Ce+=1)ve[Ce].c();s[0]===void 0&&vo(()=>s[12].call(r)),s[1]===void 0&&vo(()=>s[13].call(l)),s[2]===void 0&&vo(()=>s[14].call(C)),s[3]===void 0&&vo(()=>s[15].call(ee))},m(Ce,we){se(Ce,e,we),G(e,t),G(e,r);for(let _e=0;_e<Y.length;_e+=1)Y[_e]&&Y[_e].m(r,null);Zr(r,s[0],!0),se(Ce,a,we),se(Ce,h,we),G(h,m),G(h,l);for(let _e=0;_e<xe.length;_e+=1)xe[_e]&&xe[_e].m(l,null);Zr(l,s[1],!0),se(Ce,x,we),se(Ce,S,we),G(S,T),G(S,C);for(let _e=0;_e<ye.length;_e+=1)ye[_e]&&ye[_e].m(C,null);Zr(C,s[2],!0),se(Ce,N,we),se(Ce,B,we),G(B,U),G(B,ee);for(let _e=0;_e<ve.length;_e+=1)ve[_e]&&ve[_e].m(ee,null);Zr(ee,s[3],!0),ie||(ae=[Mt(r,"change",s[12]),Mt(l,"change",s[13]),Mt(C,"change",s[14]),Mt(ee,"change",s[15])],ie=!0)},p(Ce,we){if(we[0]&128){J=qn(Ce[7]);let _e;for(_e=0;_e<J.length;_e+=1){const tt=C0(Ce,J,_e);Y[_e]?Y[_e].p(tt,we):(Y[_e]=M0(tt),Y[_e].c(),Y[_e].m(r,null))}for(;_e<Y.length;_e+=1)Y[_e].d(1);Y.length=J.length}if(we[0]&129&&Zr(r,Ce[0]),we[0]&256){ge=qn(Ce[8]);let _e;for(_e=0;_e<ge.length;_e+=1){const tt=T0(Ce,ge,_e);xe[_e]?xe[_e].p(tt,we):(xe[_e]=R0(tt),xe[_e].c(),xe[_e].m(l,null))}for(;_e<xe.length;_e+=1)xe[_e].d(1);xe.length=ge.length}if(we[0]&258&&Zr(l,Ce[1]),we[0]&512){Ee=qn(Ce[9]);let _e;for(_e=0;_e<Ee.length;_e+=1){const tt=A0(Ce,Ee,_e);ye[_e]?ye[_e].p(tt,we):(ye[_e]=P0(tt),ye[_e].c(),ye[_e].m(C,null))}for(;_e<ye.length;_e+=1)ye[_e].d(1);ye.length=Ee.length}if(we[0]&516&&Zr(C,Ce[2]),we[0]&1024){be=qn(Ce[10]);let _e;for(_e=0;_e<be.length;_e+=1){const tt=E0(Ce,be,_e);ve[_e]?ve[_e].p(tt,we):(ve[_e]=D0(tt),ve[_e].c(),ve[_e].m(ee,null))}for(;_e<ve.length;_e+=1)ve[_e].d(1);ve.length=be.length}we[0]&1032&&Zr(ee,Ce[3])},d(Ce){Ce&&(re(e),re(a),re(h),re(x),re(S),re(N),re(B)),yr(Y,Ce),yr(xe,Ce),yr(ye,Ce),yr(ve,Ce),ie=!1,Ji(ae)}}}function M0(s){let e,t=s[18]+"",r;return{c(){e=le("option"),r=ze(t),e.__value=s[17],vi(e,e.__value)},m(a,h){se(a,e,h),G(e,r)},p:Je,d(a){a&&re(e)}}}function R0(s){let e,t=s[18]+"",r;return{c(){e=le("option"),r=ze(t),e.__value=s[17],vi(e,e.__value)},m(a,h){se(a,e,h),G(e,r)},p:Je,d(a){a&&re(e)}}}function P0(s){let e,t=s[18]+"",r;return{c(){e=le("option"),r=ze(t),e.__value=s[17],vi(e,e.__value)},m(a,h){se(a,e,h),G(e,r)},p:Je,d(a){a&&re(e)}}}function D0(s){let e,t=s[18]+"",r;return{c(){e=le("option"),r=ze(t),e.__value=s[17],vi(e,e.__value)},m(a,h){se(a,e,h),G(e,r)},p:Je,d(a){a&&re(e)}}}function cT(s){let e,t,r,a,h,m,l,x=s[5]&&L0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Route network`),a=Oe(),x&&x.c(),h=Gn(),Ze(t,"type","checkbox")},m(S,T){se(S,e,T),G(e,t),t.checked=s[5],G(e,r),se(S,a,T),x&&x.m(S,T),se(S,h,T),m||(l=Mt(t,"change",s[11]),m=!0)},p(S,T){T[0]&32&&(t.checked=S[5]),S[5]?x?x.p(S,T):(x=L0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(re(e),re(a),re(h)),x&&x.d(S),m=!1,l()}}}function N0(s){let e,t,r,a,h=s[16][`${s[17]}_fastest_bicycle`].toLocaleString()+"",m,l,x,S=s[16][`${s[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",T,C,N,B=s[16][`${s[17]}_fastest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=le("tr"),t=le("th"),t.textContent=`${s[18]}`,r=Oe(),a=le("td"),m=ze(h),l=Oe(),x=le("td"),T=ze(S),C=Oe(),N=le("td"),U=ze(B),ee=Oe()},m(ie,ae){se(ie,e,ae),G(e,t),G(e,r),G(e,a),G(a,m),G(e,l),G(e,x),G(x,T),G(e,C),G(e,N),G(N,U),G(e,ee)},p(ie,ae){ae[0]&65536&&h!==(h=ie[16][`${ie[17]}_fastest_bicycle`].toLocaleString()+"")&&Ct(m,h),ae[0]&65536&&S!==(S=ie[16][`${ie[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&Ct(T,S),ae[0]&65536&&B!==(B=ie[16][`${ie[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&Ct(U,B)},d(ie){ie&&re(e)}}}function z0(s){let e,t,r,a,h=s[16][`${s[17]}_quietest_bicycle`].toLocaleString()+"",m,l,x,S=s[16][`${s[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",T,C,N,B=s[16][`${s[17]}_quietest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=le("tr"),t=le("th"),t.textContent=`${s[18]}`,r=Oe(),a=le("td"),m=ze(h),l=Oe(),x=le("td"),T=ze(S),C=Oe(),N=le("td"),U=ze(B),ee=Oe()},m(ie,ae){se(ie,e,ae),G(e,t),G(e,r),G(e,a),G(a,m),G(e,l),G(e,x),G(x,T),G(e,C),G(e,N),G(N,U),G(e,ee)},p(ie,ae){ae[0]&65536&&h!==(h=ie[16][`${ie[17]}_quietest_bicycle`].toLocaleString()+"")&&Ct(m,h),ae[0]&65536&&S!==(S=ie[16][`${ie[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&Ct(T,S),ae[0]&65536&&B!==(B=ie[16][`${ie[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&Ct(U,B)},d(ie){ie&&re(e)}}}function hT(s){let e,t,r,a=s[16][s[4]].toLocaleString()+"",h,m,l,x,S=s[16].gradient+"",T,C,N,B,U,ee=s[16].quietness+"",ie,ae,J,Y,ge,xe,Ee,ye,be,ve,Ce,we,_e,tt,Ve,qe,dt,mt=qn(s[7]),ct=[];for(let It=0;It<mt.length;It+=1)ct[It]=N0(S0(s,mt,It));let Ut=qn(s[7]),bt=[];for(let It=0;It<Ut.length;It+=1)bt[It]=z0(I0(s,Ut,It));return{c(){e=le("div"),t=le("p"),r=ze("Cyclists: "),h=ze(a),m=Oe(),l=le("p"),x=ze("Gradient: "),T=ze(S),C=ze("%"),N=Oe(),B=le("p"),U=ze("Cycle-friendliness: "),ie=ze(ee),ae=ze("%"),J=Oe(),Y=le("details"),ge=le("summary"),ge.textContent="All network details",xe=Oe(),Ee=le("p"),Ee.textContent="Fast/Direct network",ye=Oe(),be=le("table"),ve=le("tr"),ve.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ce=Oe();for(let It=0;It<ct.length;It+=1)ct[It].c();we=Oe(),_e=le("p"),_e.textContent="Quiet/Indirect network",tt=Oe(),Ve=le("table"),qe=le("tr"),qe.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",dt=Oe();for(let It=0;It<bt.length;It+=1)bt[It].c();Rn(e,"max-width","30vw"),Rn(e,"max-height","60vh"),Rn(e,"overflow","auto")},m(It,pt){se(It,e,pt),G(e,t),G(t,r),G(t,h),G(e,m),G(e,l),G(l,x),G(l,T),G(l,C),G(e,N),G(e,B),G(B,U),G(B,ie),G(B,ae),G(e,J),G(e,Y),G(Y,ge),G(Y,xe),G(Y,Ee),G(Y,ye),G(Y,be),G(be,ve),G(be,Ce);for(let kt=0;kt<ct.length;kt+=1)ct[kt]&&ct[kt].m(be,null);G(Y,we),G(Y,_e),G(Y,tt),G(Y,Ve),G(Ve,qe),G(Ve,dt);for(let kt=0;kt<bt.length;kt+=1)bt[kt]&&bt[kt].m(Ve,null)},p(It,pt){if(pt[0]&65552&&a!==(a=It[16][It[4]].toLocaleString()+"")&&Ct(h,a),pt[0]&65536&&S!==(S=It[16].gradient+"")&&Ct(T,S),pt[0]&65536&&ee!==(ee=It[16].quietness+"")&&Ct(ie,ee),pt[0]&65664){mt=qn(It[7]);let kt;for(kt=0;kt<mt.length;kt+=1){const St=S0(It,mt,kt);ct[kt]?ct[kt].p(St,pt):(ct[kt]=N0(St),ct[kt].c(),ct[kt].m(be,null))}for(;kt<ct.length;kt+=1)ct[kt].d(1);ct.length=mt.length}if(pt[0]&65664){Ut=qn(It[7]);let kt;for(kt=0;kt<Ut.length;kt+=1){const St=I0(It,Ut,kt);bt[kt]?bt[kt].p(St,pt):(bt[kt]=z0(St),bt[kt].c(),bt[kt].m(Ve,null))}for(;kt<bt.length;kt+=1)bt[kt].d(1);bt.length=Ut.length}},d(It){It&&re(e),yr(ct,It),yr(bt,It)}}}function fT(s){let e,t;return e=new Ms({props:{openOn:"click",$$slots:{default:[hT,({props:r})=>({16:r}),({props:r})=>[r?65536:0]]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a[0]&65552|a[1]&1&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function dT(s){let e,t;return e=new cr({props:{sourceLayer:"rnet",paint:{"line-color":s[6],"line-width":td(s[4])},layout:{visibility:s[5]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[fT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a[0]&80&&(h.paint={"line-color":r[6],"line-width":td(r[4])}),a[0]&32&&(h.layout={visibility:r[5]?"visible":"none"}),a[0]&16|a[1]&1&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function pT(s){let e,t,r,a;return e=new qs({props:{name:"route network",$$slots:{default:[cT]},$$scope:{ctx:s}}}),r=new em({props:{url:`pmtiles://${sd("route_network.pmtiles")}`,$$slots:{default:[dT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,m){const l={};m[0]&47|m[1]&1&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m[0]&112|m[1]&1&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function mT(s,e,t){let r,a,h=!1,m="all",l="bicycle_go_dutch",x="fastest",S="flow",T=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],C=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],N=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],B=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function U(){h=this.checked,t(5,h)}function ee(){m=Da(this),t(0,m),t(7,T)}function ie(){l=Da(this),t(1,l),t(8,C)}function ae(){x=Da(this),t(2,x),t(9,N)}function J(){S=Da(this),t(3,S),t(10,B)}return s.$$.update=()=>{s.$$.dirty[0]&7&&t(4,r=`${m}_${x}_${l}`),s.$$.dirty[0]&24&&t(6,a={none:"#304ce7",flow:rm(r),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:l1}[S])},[m,l,x,S,r,h,a,T,C,N,B,U,ee,ie,ae,J]}class gT extends fn{constructor(e){super(),hn(this,e,mT,pT,on,{},null,[-1,-1])}}function F0(s){let e,t,r,a,h,m,l,x,S,T,C;return{c(){e=le("button"),e.textContent="Import core network",t=Oe(),r=le("label"),a=le("input"),h=ze(`
      Show actual core network`),m=Oe(),l=le("label"),x=le("input"),S=ze(`
      Show map-matched core network`),Ze(e,"class","outline"),Ze(a,"type","checkbox"),Ze(x,"type","checkbox")},m(N,B){se(N,e,B),se(N,t,B),se(N,r,B),G(r,a),a.checked=s[2],G(r,h),se(N,m,B),se(N,l,B),G(l,x),x.checked=s[3],G(l,S),T||(C=[Mt(e,"click",s[5]),Mt(a,"change",s[7]),Mt(x,"change",s[8])],T=!0)},p(N,B){B&4&&(a.checked=N[2]),B&8&&(x.checked=N[3])},d(N){N&&(re(e),re(t),re(r),re(m),re(l)),T=!1,Ji(C)}}}function _T(s){let e,t,r,a,h,m,l,x=s[0]&&F0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Core network`),a=Oe(),x&&x.c(),h=Gn(),Ze(t,"type","checkbox")},m(S,T){se(S,e,T),G(e,t),t.checked=s[0],G(e,r),se(S,a,T),x&&x.m(S,T),se(S,h,T),m||(l=Mt(t,"change",s[6]),m=!0)},p(S,T){T&1&&(t.checked=S[0]),S[0]?x?x.p(S,T):(x=F0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(re(e),re(a),re(h)),x&&x.d(S),m=!1,l()}}}function yT(s){let e,t=s[11].all_fastest_bicycle_go_dutch+"",r;return{c(){e=ze("Go Dutch value "),r=ze(t)},m(a,h){se(a,e,h),se(a,r,h)},p(a,h){h&2048&&t!==(t=a[11].all_fastest_bicycle_go_dutch+"")&&Ct(r,t)},d(a){a&&(re(e),re(r))}}}function vT(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[yT,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function bT(s){let e,t;return e=new cr({props:{sourceLayer:"coherent_networks",paint:{"line-color":"black","line-width":2},layout:{visibility:s[0]&&s[2]?"visible":"none"},$$slots:{default:[vT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&5&&(h.layout={visibility:r[0]&&r[2]?"visible":"none"}),a&4096&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function O0(s){let e,t,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:IT,then:wT,catch:xT,value:10,blocks:[,,,]};return Xr(t=s[4].renderCoreNetwork(),a),{c(){e=Gn(),a.block.c()},m(h,m){se(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&16&&t!==(t=s[4].renderCoreNetwork())&&Xr(t,a)||Oa(a,s,m)},i(h){r||(he(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];ke(l)}r=!1},d(h){h&&re(e),a.block.d(h),a.token=null,a=null}}}function xT(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function wT(s){let e,t;return e=new $i({props:{data:s[10],generateId:!0,$$slots:{default:[kT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&16&&(h.data=r[10]),a&4105&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function kT(s){let e,t;return e=new cr({props:{paint:{"line-color":Up,"line-width":10,"line-opacity":.5},layout:{visibility:s[0]&&s[3]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&9&&(h.layout={visibility:r[0]&&r[3]?"visible":"none"}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function IT(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function ST(s){let e,t,r,a,h,m;e=new qs({props:{name:"core network",$$slots:{default:[_T]},$$scope:{ctx:s}}}),r=new em({props:{url:`pmtiles://${sd("core_network.pmtiles")}`,$$slots:{default:[bT]},$$scope:{ctx:s}}});let l=s[4]&&s[1]&&O0(s);return{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment),a=Oe(),l&&l.c(),h=Gn()},m(x,S){rt(e,x,S),se(x,t,S),rt(r,x,S),se(x,a,S),l&&l.m(x,S),se(x,h,S),m=!0},p(x,[S]){const T={};S&4109&&(T.$$scope={dirty:S,ctx:x}),e.$set(T);const C={};S&4101&&(C.$$scope={dirty:S,ctx:x}),r.$set(C),x[4]&&x[1]?l?(l.p(x,S),S&18&&he(l,1)):(l=O0(x),l.c(),he(l,1),l.m(h.parentNode,h)):l&&(Nn(),ke(l,1,1,()=>{l=null}),zn())},i(x){m||(he(e.$$.fragment,x),he(r.$$.fragment,x),he(l),m=!0)},o(x){ke(e.$$.fragment,x),ke(r.$$.fragment,x),ke(l),m=!1},d(x){x&&(re(t),re(a),re(h)),st(e,x),st(r,x),l&&l.d(x)}}}function ET(s,e,t){let r,a;Pt(s,Ph,B=>t(9,r=B)),Pt(s,Yi,B=>t(4,a=B));let h=!1,m=!1,l=!0,x=!0;async function S(){if(a){let B=a.importCoreNetwork(),U=B==1?"route segment":"route segments";await Dh(),Dn(Ph,r+=1,r),window.alert(`Imported ${B} ${U}`)}}function T(){h=this.checked,t(0,h)}function C(){l=this.checked,t(2,l)}function N(){x=this.checked,t(3,x)}return s.$$.update=()=>{s.$$.dirty&1&&h&&t(1,m=!0)},[h,m,l,x,a,S,T,C,N]}class AT extends fn{constructor(e){super(),hn(this,e,ET,ST,on,{})}}function TT(s){let e,t;return e=new cr({props:{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function CT(s){let e,t;return e=new $i({props:{data:s[0],generateId:!0,$$slots:{default:[TT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,[a]){const h={};a&1&&(h.data=r[0]),a&32&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function LT(s,e,t){let r;Pt(s,Yi,x=>t(3,r=x));let{kind:a}=e,{hovered:h}=e,m={type:"FeatureCollection",features:[]};async function l(x){r&&x?x.properties.reachable?t(0,m=await r.debugReachablePath(a,x.properties.idx)):t(0,m=await r.debugUnreachablePath(a,x.properties.idx)):t(0,m={type:"FeatureCollection",features:[]})}return s.$$set=x=>{"kind"in x&&t(1,a=x.kind),"hovered"in x&&t(2,h=x.hovered)},s.$$.update=()=>{s.$$.dirty&4&&l(h)},[m,a,h]}class sm extends fn{constructor(e){super(),hn(this,e,LT,CT,on,{kind:1,hovered:2})}}function B0(s){let e,t,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=Sr(s[3],s[0].features.length)+"",C,N,B,U,ee,ie,ae;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=le("button"),e.textContent="Recalculate",t=Oe(),r=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(" ("),C=ze(T),N=ze(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(J,Y){se(J,e,Y),se(J,t,Y),se(J,r,Y),G(r,h),G(r,m),G(r,x),G(r,S),G(r,C),G(r,N),se(J,B,Y),rt(U,J,Y),ee=!0,ie||(ae=Mt(e,"click",s[4]),ie=!0)},p(J,Y){(!ee||Y&8)&&a!==(a=J[3].toLocaleString()+"")&&Ct(h,a),(!ee||Y&1)&&l!==(l=J[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ee||Y&9)&&T!==(T=Sr(J[3],J[0].features.length)+"")&&Ct(C,T)},i(J){ee||(he(U.$$.fragment,J),ee=!0)},o(J){ke(U.$$.fragment,J),ee=!1},d(J){J&&(re(e),re(t),re(r),re(B)),st(U,J),ie=!1,ae()}}}function MT(s){let e,t,r,a,h,m,l,x,S=s[1]&&B0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Schools`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[1],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[5]),l=!0)},p(T,C){C&2&&(t.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&he(S,1)):(S=B0(T),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function RT(s){let e=s[8].name+"",t,r,a=s[8].kind+"",h,m,l=s[8].pupils+"",x,S,T=s[8].reachable?"is":"is not",C,N;return{c(){t=ze(e),r=ze(" is a "),h=ze(a),m=ze(" school with "),x=ze(l),S=ze(" pupils. It "),C=ze(T),N=ze(" reachable.")},m(B,U){se(B,t,U),se(B,r,U),se(B,h,U),se(B,m,U),se(B,x,U),se(B,S,U),se(B,C,U),se(B,N,U)},p(B,U){U&256&&e!==(e=B[8].name+"")&&Ct(t,e),U&256&&a!==(a=B[8].kind+"")&&Ct(h,a),U&256&&l!==(l=B[8].pupils+"")&&Ct(x,l),U&256&&T!==(T=B[8].reachable?"is":"is not")&&Ct(C,T)},d(B){B&&(re(t),re(r),re(h),re(m),re(x),re(S),re(C),re(N))}}}function PT(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[RT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function DT(s){let e,t,r;function a(m){s[6](m)}let h={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":zr(5,8)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[PT]},$$scope:{ctx:s}};return s[2]!==void 0&&(h.hovered=s[2]),e=new Qp({props:h}),Jn.push(()=>_r(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),r=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!t&&l&4&&(t=!0,x.hovered=m[2],gr(()=>t=!1)),e.$set(x)},i(m){r||(he(e.$$.fragment,m),r=!0)},o(m){ke(e.$$.fragment,m),r=!1},d(m){st(e,m)}}}function NT(s){let e,t,r,a,h,m;return e=new qs({props:{name:"schools",$$slots:{default:[MT]},$$scope:{ctx:s}}}),r=new $i({props:{data:s[0],generateId:!0,$$slots:{default:[DT]},$$scope:{ctx:s}}}),h=new sm({props:{kind:"schools",hovered:s[2]}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){rt(e,l,x),se(l,t,x),rt(r,l,x),se(l,a,x),rt(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),r.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(he(e.$$.fragment,l),he(r.$$.fragment,l),he(h.$$.fragment,l),m=!0)},o(l){ke(e.$$.fragment,l),ke(r.$$.fragment,l),ke(h.$$.fragment,l),m=!1},d(l){l&&(re(t),re(a)),st(e,l),st(r,l),st(h,l)}}}function zT(s,e,t){let r,a,h;Pt(s,Xf,C=>t(1,a=C)),Pt(s,Yi,C=>t(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&t(0,m=await h.getSchools())}function S(){a=this.checked,Xf.set(a)}function T(C){l=C,t(2,l)}return s.$$.update=()=>{s.$$.dirty&3&&a&&m.features.length==0&&x(),s.$$.dirty&1&&t(3,r=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,r,x,S,T]}class FT extends fn{constructor(e){super(),hn(this,e,zT,NT,on,{})}}function U0(s){let e,t,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=Sr(s[3],s[0].features.length)+"",C,N,B,U,ee,ie,ae;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=le("button"),e.textContent="Recalculate",t=Oe(),r=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(" ("),C=ze(T),N=ze(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(J,Y){se(J,e,Y),se(J,t,Y),se(J,r,Y),G(r,h),G(r,m),G(r,x),G(r,S),G(r,C),G(r,N),se(J,B,Y),rt(U,J,Y),ee=!0,ie||(ae=Mt(e,"click",s[4]),ie=!0)},p(J,Y){(!ee||Y&8)&&a!==(a=J[3].toLocaleString()+"")&&Ct(h,a),(!ee||Y&1)&&l!==(l=J[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ee||Y&9)&&T!==(T=Sr(J[3],J[0].features.length)+"")&&Ct(C,T)},i(J){ee||(he(U.$$.fragment,J),ee=!0)},o(J){ke(U.$$.fragment,J),ee=!1},d(J){J&&(re(e),re(t),re(r),re(B)),st(U,J),ie=!1,ae()}}}function OT(s){let e,t,r,a,h,m,l,x,S=s[1]&&U0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Town centres`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[1],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[5]),l=!0)},p(T,C){C&2&&(t.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&he(S,1)):(S=U0(T),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function BT(s){let e,t=(s[8].name||"")+"",r,a,h=s[8].reachable?"is":"is not",m,l;return{c(){e=ze("Town centre "),r=ze(t),a=Oe(),m=ze(h),l=ze(" reachable.")},m(x,S){se(x,e,S),se(x,r,S),se(x,a,S),se(x,m,S),se(x,l,S)},p(x,S){S&256&&t!==(t=(x[8].name||"")+"")&&Ct(r,t),S&256&&h!==(h=x[8].reachable?"is":"is not")&&Ct(m,h)},d(x){x&&(re(e),re(r),re(a),re(m),re(l))}}}function UT(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[BT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function jT(s){let e,t,r;function a(m){s[6](m)}let h={manageHoverState:!0,paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":zr(.7,.9)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[UT]},$$scope:{ctx:s}};return s[2]!==void 0&&(h.hovered=s[2]),e=new mc({props:h}),Jn.push(()=>_r(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),r=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!t&&l&4&&(t=!0,x.hovered=m[2],gr(()=>t=!1)),e.$set(x)},i(m){r||(he(e.$$.fragment,m),r=!0)},o(m){ke(e.$$.fragment,m),r=!1},d(m){st(e,m)}}}function qT(s){let e,t,r,a,h,m;return e=new qs({props:{name:"town centres",$$slots:{default:[OT]},$$scope:{ctx:s}}}),r=new $i({props:{data:s[0],generateId:!0,$$slots:{default:[jT]},$$scope:{ctx:s}}}),h=new sm({props:{kind:"town_centres",hovered:s[2]}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){rt(e,l,x),se(l,t,x),rt(r,l,x),se(l,a,x),rt(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),r.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(he(e.$$.fragment,l),he(r.$$.fragment,l),he(h.$$.fragment,l),m=!0)},o(l){ke(e.$$.fragment,l),ke(r.$$.fragment,l),ke(h.$$.fragment,l),m=!1},d(l){l&&(re(t),re(a)),st(e,l),st(r,l),st(h,l)}}}function VT(s,e,t){let r,a,h;Pt(s,Kf,C=>t(1,a=C)),Pt(s,Yi,C=>t(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&t(0,m=await h.getTownCentres())}function S(){a=this.checked,Kf.set(a)}function T(C){l=C,t(2,l)}return s.$$.update=()=>{s.$$.dirty&3&&a&&m.features.length==0&&x(),s.$$.dirty&1&&t(3,r=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,r,x,S,T]}class GT extends fn{constructor(e){super(),hn(this,e,VT,qT,on,{})}}function j0(s){let e,t,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=Sr(s[3],s[0].features.length)+"",C,N,B,U,ee,ie,ae;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=le("button"),e.textContent="Recalculate",t=Oe(),r=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(" ("),C=ze(T),N=ze(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(J,Y){se(J,e,Y),se(J,t,Y),se(J,r,Y),G(r,h),G(r,m),G(r,x),G(r,S),G(r,C),G(r,N),se(J,B,Y),rt(U,J,Y),ee=!0,ie||(ae=Mt(e,"click",s[4]),ie=!0)},p(J,Y){(!ee||Y&8)&&a!==(a=J[3].toLocaleString()+"")&&Ct(h,a),(!ee||Y&1)&&l!==(l=J[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ee||Y&9)&&T!==(T=Sr(J[3],J[0].features.length)+"")&&Ct(C,T)},i(J){ee||(he(U.$$.fragment,J),ee=!0)},o(J){ke(U.$$.fragment,J),ee=!1},d(J){J&&(re(e),re(t),re(r),re(B)),st(U,J),ie=!1,ae()}}}function ZT(s){let e,t,r,a,h,m,l,x,S=s[1]&&j0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    GPs and hospitals`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[1],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[5]),l=!0)},p(T,C){C&2&&(t.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&he(S,1)):(S=j0(T),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function HT(s){let e=s[8].name+"",t,r,a=s[8].kind+"",h,m,l=s[8].reachable?"is":"is not",x,S;return{c(){t=ze(e),r=ze(" is a "),h=ze(a),m=ze(". It "),x=ze(l),S=ze(" reachable.")},m(T,C){se(T,t,C),se(T,r,C),se(T,h,C),se(T,m,C),se(T,x,C),se(T,S,C)},p(T,C){C&256&&e!==(e=T[8].name+"")&&Ct(t,e),C&256&&a!==(a=T[8].kind+"")&&Ct(h,a),C&256&&l!==(l=T[8].reachable?"is":"is not")&&Ct(x,l)},d(T){T&&(re(t),re(r),re(h),re(m),re(x),re(S))}}}function XT(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[HT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function WT(s){let e,t,r;function a(m){s[6](m)}let h={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":zr(5,8)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[XT]},$$scope:{ctx:s}};return s[2]!==void 0&&(h.hovered=s[2]),e=new Qp({props:h}),Jn.push(()=>_r(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),r=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!t&&l&4&&(t=!0,x.hovered=m[2],gr(()=>t=!1)),e.$set(x)},i(m){r||(he(e.$$.fragment,m),r=!0)},o(m){ke(e.$$.fragment,m),r=!1},d(m){st(e,m)}}}function KT(s){let e,t,r,a,h,m;return e=new qs({props:{name:"gp hospitals",$$slots:{default:[ZT]},$$scope:{ctx:s}}}),r=new $i({props:{data:s[0],generateId:!0,$$slots:{default:[WT]},$$scope:{ctx:s}}}),h=new sm({props:{kind:"gp_hospitals",hovered:s[2]}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){rt(e,l,x),se(l,t,x),rt(r,l,x),se(l,a,x),rt(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),r.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(he(e.$$.fragment,l),he(r.$$.fragment,l),he(h.$$.fragment,l),m=!0)},o(l){ke(e.$$.fragment,l),ke(r.$$.fragment,l),ke(h.$$.fragment,l),m=!1},d(l){l&&(re(t),re(a)),st(e,l),st(r,l),st(h,l)}}}function $T(s,e,t){let r,a,h;Pt(s,Wf,C=>t(1,a=C)),Pt(s,Yi,C=>t(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&t(0,m=await h.getGpHospitals())}function S(){a=this.checked,Wf.set(a)}function T(C){l=C,t(2,l)}return s.$$.update=()=>{s.$$.dirty&3&&a&&m.features.length==0&&x(),s.$$.dirty&1&&t(3,r=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,r,x,S,T]}class YT extends fn{constructor(e){super(),hn(this,e,$T,KT,on,{})}}function JT(s){let e,t,r,a,h;return{c(){e=le("label"),t=le("input"),r=ze(`
    Urban areas`),Ze(t,"type","checkbox")},m(m,l){se(m,e,l),G(e,t),t.checked=s[0],G(e,r),a||(h=Mt(t,"change",s[1]),a=!0)},p(m,l){l&1&&(t.checked=m[0])},d(m){m&&re(e),a=!1,h()}}}function QT(s){let e,t;return e=new mc({props:{sourceLayer:"urban_areas",manageHoverState:!0,paint:{"fill-color":"black","fill-opacity":zr(1,.5)},layout:{visibility:s[0]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function eC(s){let e,t,r,a;return e=new qs({props:{name:"urban areas",$$slots:{default:[JT]},$$scope:{ctx:s}}}),r=new em({props:{url:`pmtiles://${sd("urban_areas.pmtiles")}`,$$slots:{default:[QT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,[m]){const l={};m&5&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&5&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function tC(s,e,t){let r=!1;function a(){r=this.checked,t(0,r)}return[r,a]}class nC extends fn{constructor(e){super(),hn(this,e,tC,eC,on,{})}}function q0(s){let e,t,r,a,h,m;return r=new _c({props:{colors:s[3]}}),{c(){e=le("button"),e.textContent="Recalculate",t=Oe(),ot(r.$$.fragment),Ze(e,"class","outline")},m(l,x){se(l,e,x),se(l,t,x),rt(r,l,x),a=!0,h||(m=Mt(e,"click",s[2]),h=!0)},p:Je,i(l){a||(he(r.$$.fragment,l),a=!0)},o(l){ke(r.$$.fragment,l),a=!1},d(l){l&&(re(e),re(t)),st(r,l),h=!1,m()}}}function iC(s){let e,t,r,a,h,m,l,x,S=s[0]&&q0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Reachable network`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[0],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[4]),l=!0)},p(T,C){C&1&&(t.checked=T[0]),T[0]?S?(S.p(T,C),C&1&&he(S,1)):(S=q0(T),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function rC(s){let e,t;return e=new cr({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":zr(5,7),"line-color":rd(["get","kind"],s[3],"black"),"line-opacity":.8},manageHoverState:!0}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function sC(s){let e,t,r,a;return e=new qs({props:{name:"reachable network",$$slots:{default:[iC]},$$scope:{ctx:s}}}),r=new $i({props:{data:s[1],generateId:!0,$$slots:{default:[rC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,[m]){const l={};m&65&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.data=h[1]),m&65&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function oC(s,e,t){let r;Pt(s,Yi,S=>t(5,r=S));let a=!1,h={type:"FeatureCollection",features:[]};async function m(){t(1,h=await r.renderReachableNetwork())}let l={network:"green",reachable:"purple",severance:"red"};function x(){a=this.checked,t(0,a)}return s.$$.update=()=>{s.$$.dirty&3&&a&&h.features.length==0&&m()},[a,h,m,l,x]}class aC extends fn{constructor(e){super(),hn(this,e,oC,sC,on,{})}}function V0(s){let e,t;return e=new _c({props:{colors:im}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function lC(s){let e,t,r,a,h,m,l,x,S=s[0]&&V0();return{c(){e=le("label"),t=le("input"),r=ze(`
    Level of Service`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[0],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[3]),l=!0)},p(T,C){C&1&&(t.checked=T[0]),T[0]?S?C&1&&he(S,1):(S=V0(),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function G0(s){let e,t,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:pC,then:cC,catch:uC,value:4,blocks:[,,,]};return Xr(t=s[2].renderLevelOfService(),a),{c(){e=Gn(),a.block.c()},m(h,m){se(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&4&&t!==(t=s[2].renderLevelOfService())&&Xr(t,a)||Oa(a,s,m)},i(h){r||(he(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];ke(l)}r=!1},d(h){h&&re(e),a.block.d(h),a.token=null,a=null}}}function uC(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function cC(s){let e,t;return e=new $i({props:{data:s[4],generateId:!0,$$slots:{default:[dC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&4&&(h.data=r[4]),a&65&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function hC(s){let e,t,r,a,h,m=s[5].los+"",l,x,S,T,C,N,B=ou[s[5].infra_type][0]+"",U,ee,ie,ae,J,Y,ge=s[5].speed+"",xe,Ee,ye,be,ve,Ce,we=s[5].traffic.toLocaleString()+"",_e;return{c(){e=le("table"),t=le("tr"),r=le("th"),r.textContent="Level of Service",a=Oe(),h=le("td"),l=ze(m),x=Oe(),S=le("tr"),T=le("th"),T.textContent="Infrastructure type",C=Oe(),N=le("td"),U=ze(B),ee=Oe(),ie=le("tr"),ae=le("th"),ae.textContent="Speed (mph)",J=Oe(),Y=le("td"),xe=ze(ge),Ee=Oe(),ye=le("tr"),be=le("th"),be.textContent="Estimated daily traffic volume",ve=Oe(),Ce=le("td"),_e=ze(we)},m(tt,Ve){se(tt,e,Ve),G(e,t),G(t,r),G(t,a),G(t,h),G(h,l),G(e,x),G(e,S),G(S,T),G(S,C),G(S,N),G(N,U),G(e,ee),G(e,ie),G(ie,ae),G(ie,J),G(ie,Y),G(Y,xe),G(e,Ee),G(e,ye),G(ye,be),G(ye,ve),G(ye,Ce),G(Ce,_e)},p(tt,Ve){Ve&32&&m!==(m=tt[5].los+"")&&Ct(l,m),Ve&32&&B!==(B=ou[tt[5].infra_type][0]+"")&&Ct(U,B),Ve&32&&ge!==(ge=tt[5].speed+"")&&Ct(xe,ge),Ve&32&&we!==(we=tt[5].traffic.toLocaleString()+"")&&Ct(_e,we)},d(tt){tt&&re(e)}}}function fC(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[hC,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&96&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function dC(s){let e,t;return e=new cr({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":zr(5,7),"line-color":jp,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[fC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),a&64&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function pC(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function mC(s){let e,t,r,a;e=new qs({props:{name:"level of service",$$slots:{default:[lC]},$$scope:{ctx:s}}});let h=s[2]&&s[1]&&G0(s);return{c(){ot(e.$$.fragment),t=Oe(),h&&h.c(),r=Gn()},m(m,l){rt(e,m,l),se(m,t,l),h&&h.m(m,l),se(m,r,l),a=!0},p(m,[l]){const x={};l&65&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?h?(h.p(m,l),l&6&&he(h,1)):(h=G0(m),h.c(),he(h,1),h.m(r.parentNode,r)):h&&(Nn(),ke(h,1,1,()=>{h=null}),zn())},i(m){a||(he(e.$$.fragment,m),he(h),a=!0)},o(m){ke(e.$$.fragment,m),ke(h),a=!1},d(m){m&&(re(t),re(r)),st(e,m),h&&h.d(m)}}}function gC(s,e,t){let r;Pt(s,Yi,l=>t(2,r=l));let a=!1,h=!1;function m(){a=this.checked,t(0,a)}return s.$$.update=()=>{s.$$.dirty&1&&a&&t(1,h=!0)},[a,h,r,m]}class _C extends fn{constructor(e){super(),hn(this,e,gC,mC,on,{})}}function Z0(s){let e,t;return e=new tm({props:{colorScale:s[3],limits:s[4]}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function yC(s){let e,t,r,a,h,m,l,x,S=s[0]&&Z0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Estimated traffic volume`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[0],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[5]),l=!0)},p(T,C){C&1&&(t.checked=T[0]),T[0]?S?(S.p(T,C),C&1&&he(S,1)):(S=Z0(T),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function H0(s){let e,t,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:IC,then:bC,catch:vC,value:6,blocks:[,,,]};return Xr(t=s[2].renderLevelOfService(),a),{c(){e=Gn(),a.block.c()},m(h,m){se(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&4&&t!==(t=s[2].renderLevelOfService())&&Xr(t,a)||Oa(a,s,m)},i(h){r||(he(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];ke(l)}r=!1},d(h){h&&re(e),a.block.d(h),a.token=null,a=null}}}function vC(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function bC(s){let e,t;return e=new $i({props:{data:s[6],generateId:!0,$$slots:{default:[kC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&4&&(h.data=r[6]),a&257&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function xC(s){let e,t=s[7].traffic.toLocaleString()+"",r;return{c(){e=le("p"),r=ze(t)},m(a,h){se(a,e,h),G(e,r)},p(a,h){h&128&&t!==(t=a[7].traffic.toLocaleString()+"")&&Ct(r,t)},d(a){a&&re(e)}}}function wC(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[xC,({props:r})=>({7:r}),({props:r})=>r?128:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&384&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function kC(s){let e,t;return e=new cr({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":Gf(["get","traffic"],s[4],[1,2,3]),"line-color":Gf(["get","traffic"],s[4],s[3]),"line-opacity":.8},manageHoverState:!0,$$slots:{default:[wC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),a&256&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function IC(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function SC(s){let e,t,r,a;e=new qs({props:{name:"traffic volume",$$slots:{default:[yC]},$$scope:{ctx:s}}});let h=s[2]&&s[1]&&H0(s);return{c(){ot(e.$$.fragment),t=Oe(),h&&h.c(),r=Gn()},m(m,l){rt(e,m,l),se(m,t,l),h&&h.m(m,l),se(m,r,l),a=!0},p(m,[l]){const x={};l&257&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?h?(h.p(m,l),l&6&&he(h,1)):(h=H0(m),h.c(),he(h,1),h.m(r.parentNode,r)):h&&(Nn(),ke(h,1,1,()=>{h=null}),zn())},i(m){a||(he(e.$$.fragment,m),he(h),a=!0)},o(m){ke(e.$$.fragment,m),ke(h),a=!1},d(m){m&&(re(t),re(r)),st(e,m),h&&h.d(m)}}}function EC(s,e,t){let r;Pt(s,Yi,S=>t(2,r=S));let a=!1,h=!1,m=["#27918d","#ffaa33","#440154"],l=[0,2e3,4e3,1e4];function x(){a=this.checked,t(0,a)}return s.$$.update=()=>{s.$$.dirty&1&&a&&t(1,h=!0)},[a,h,r,m,l,x]}class AC extends fn{constructor(e){super(),hn(this,e,EC,SC,on,{})}}function TC(s){let e,t,r,a,h;return{c(){e=le("label"),t=le("input"),r=ze(`
    Gradient`),Ze(t,"type","checkbox")},m(m,l){se(m,e,l),G(e,t),t.checked=s[0],G(e,r),a||(h=Mt(t,"change",s[3]),a=!0)},p(m,l){l&1&&(t.checked=m[0])},d(m){m&&re(e),a=!1,h()}}}function X0(s){let e,t,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:DC,then:LC,catch:CC,value:4,blocks:[,,,]};return Xr(t=s[2].renderLevelOfService(),a),{c(){e=Gn(),a.block.c()},m(h,m){se(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&4&&t!==(t=s[2].renderLevelOfService())&&Xr(t,a)||Oa(a,s,m)},i(h){r||(he(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];ke(l)}r=!1},d(h){h&&re(e),a.block.d(h),a.token=null,a=null}}}function CC(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function LC(s){let e,t;return e=new $i({props:{data:s[4],generateId:!0,$$slots:{default:[PC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&4&&(h.data=r[4]),a&65&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function MC(s){let e,t=s[5].gradient.toFixed(1)+"",r,a;return{c(){e=le("p"),r=ze(t),a=ze("%")},m(h,m){se(h,e,m),G(e,r),G(e,a)},p(h,m){m&32&&t!==(t=h[5].gradient.toFixed(1)+"")&&Ct(r,t)},d(h){h&&re(e)}}}function RC(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[MC,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&96&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function PC(s){let e,t;return e=new cr({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":zr(3,5),"line-color":l1()},manageHoverState:!0,$$slots:{default:[RC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),a&64&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function DC(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function NC(s){let e,t,r,a;e=new qs({props:{name:"gradient",$$slots:{default:[TC]},$$scope:{ctx:s}}});let h=s[2]&&s[1]&&X0(s);return{c(){ot(e.$$.fragment),t=Oe(),h&&h.c(),r=Gn()},m(m,l){rt(e,m,l),se(m,t,l),h&&h.m(m,l),se(m,r,l),a=!0},p(m,[l]){const x={};l&65&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?h?(h.p(m,l),l&6&&he(h,1)):(h=X0(m),h.c(),he(h,1),h.m(r.parentNode,r)):h&&(Nn(),ke(h,1,1,()=>{h=null}),zn())},i(m){a||(he(e.$$.fragment,m),he(h),a=!0)},o(m){ke(e.$$.fragment,m),ke(h),a=!1},d(m){m&&(re(t),re(r)),st(e,m),h&&h.d(m)}}}function zC(s,e,t){let r;Pt(s,Yi,l=>t(2,r=l));let a=!1,h=!1;function m(){a=this.checked,t(0,a)}return s.$$.update=()=>{s.$$.dirty&1&&a&&t(1,h=!0)},[a,h,r,m]}class FC extends fn{constructor(e){super(),hn(this,e,zC,NC,on,{})}}function W0(s){let e,t,r,a,h,m=s[3].toLocaleString()+"",l,x,S=s[0].features.length.toLocaleString()+"",T,C,N=s[2].toLocaleString()+"",B,U,ee=s[4].toLocaleString()+"",ie,ae,J=Sr(s[2],s[4])+"",Y,ge,xe,Ee,ye,be,ve,Ce,we;return Ee=new tm({props:{colorScale:s[6],limits:s[7]}}),{c(){e=le("button"),e.textContent="Recalculate",t=Oe(),r=le("p"),r.textContent="Only the top 20%ile most deprived zones are shown",a=Oe(),h=le("p"),l=ze(m),x=ze(" / "),T=ze(S),C=ze(` zones
      reachable. That's `),B=ze(N),U=ze(" / "),ie=ze(ee),ae=ze(`
      (`),Y=ze(J),ge=ze(") of the population."),xe=Oe(),ot(Ee.$$.fragment),ye=Oe(),be=le("p"),be.textContent=`Darker colours are more deprived. Zones with a red outline are not
      reachable by the current network.`,Ze(e,"class","outline")},m(_e,tt){se(_e,e,tt),se(_e,t,tt),se(_e,r,tt),se(_e,a,tt),se(_e,h,tt),G(h,l),G(h,x),G(h,T),G(h,C),G(h,B),G(h,U),G(h,ie),G(h,ae),G(h,Y),G(h,ge),se(_e,xe,tt),rt(Ee,_e,tt),se(_e,ye,tt),se(_e,be,tt),ve=!0,Ce||(we=Mt(e,"click",s[5]),Ce=!0)},p(_e,tt){(!ve||tt&8)&&m!==(m=_e[3].toLocaleString()+"")&&Ct(l,m),(!ve||tt&1)&&S!==(S=_e[0].features.length.toLocaleString()+"")&&Ct(T,S),(!ve||tt&4)&&N!==(N=_e[2].toLocaleString()+"")&&Ct(B,N),(!ve||tt&16)&&ee!==(ee=_e[4].toLocaleString()+"")&&Ct(ie,ee),(!ve||tt&20)&&J!==(J=Sr(_e[2],_e[4])+"")&&Ct(Y,J)},i(_e){ve||(he(Ee.$$.fragment,_e),ve=!0)},o(_e){ke(Ee.$$.fragment,_e),ve=!1},d(_e){_e&&(re(e),re(t),re(r),re(a),re(h),re(xe),re(ye),re(be)),st(Ee,_e),Ce=!1,we()}}}function OC(s){let e,t,r,a,h,m,l,x,S=s[1]&&W0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    SIMD`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[1],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[8]),l=!0)},p(T,C){C&2&&(t.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&he(S,1)):(S=W0(T),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function BC(s){let e,t,r=s[10].id+"",a,h,m=s[10].reachable?"is":"is not",l,x,S=s[10].population.toLocaleString()+"",T,C,N=s[10].imd_rank+"",B,U,ee=s[10].imd_percentile+"",ie,ae;return{c(){e=le("p"),t=ze("Data zone "),a=ze(r),h=Oe(),l=ze(m),x=ze(" reachable. It has "),T=ze(S),C=ze(`
        people, and a SIMD rank of `),B=ze(N),U=ze(", putting it in the "),ie=ze(ee),ae=ze(`
        percentile.`)},m(J,Y){se(J,e,Y),G(e,t),G(e,a),G(e,h),G(e,l),G(e,x),G(e,T),G(e,C),G(e,B),G(e,U),G(e,ie),G(e,ae)},p(J,Y){Y&1024&&r!==(r=J[10].id+"")&&Ct(a,r),Y&1024&&m!==(m=J[10].reachable?"is":"is not")&&Ct(l,m),Y&1024&&S!==(S=J[10].population.toLocaleString()+"")&&Ct(T,S),Y&1024&&N!==(N=J[10].imd_rank+"")&&Ct(B,N),Y&1024&&ee!==(ee=J[10].imd_percentile+"")&&Ct(ie,ee)},d(J){J&&re(e)}}}function UC(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[BC,({props:r})=>({10:r}),({props:r})=>r?1024:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&3072&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function jC(s){let e,t,r,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","imd_percentile"],s[7],s[6]),"fill-opacity":zr(.7,.9)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[UC]},$$scope:{ctx:s}}}),r=new cr({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:s[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,m){const l={};m&2&&(l.layout={visibility:h[1]?"visible":"none"}),m&2048&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.layout={visibility:h[1]?"visible":"none"}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function qC(s){let e,t,r,a;return e=new qs({props:{name:"simd",$$slots:{default:[OC]},$$scope:{ctx:s}}}),r=new $i({props:{data:s[0],generateId:!0,$$slots:{default:[jC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,[m]){const l={};m&2079&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&2050&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function VC(s,e,t){let r,a,h,m,l;Pt(s,$f,B=>t(1,m=B)),Pt(s,Yi,B=>t(9,l=B));let x={type:"FeatureCollection",features:[]};async function S(){if(l){let B=await l.getDataZones();B.features=B.features.filter(U=>U.properties.imd_percentile<=20),t(0,x=B)}}let T=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],C=[0,4,8,12,16,20];function N(){m=this.checked,$f.set(m)}return s.$$.update=()=>{s.$$.dirty&3&&m&&x.features.length==0&&S(),s.$$.dirty&1&&t(4,r=ed(x.features.map(B=>B.properties.population))),s.$$.dirty&1&&t(3,a=x.features.filter(B=>B.properties.reachable).length),s.$$.dirty&1&&t(2,h=ed(x.features.filter(B=>B.properties.reachable).map(B=>B.properties.population)))},[x,m,h,a,r,S,T,C,N]}class GC extends fn{constructor(e){super(),hn(this,e,VC,qC,on,{})}}function K0(s){let e,t,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=s[2].toLocaleString()+"",C,N,B=s[4].toLocaleString()+"",U,ee,ie=Sr(s[2],s[4])+"",ae,J,Y,ge,xe,Ee,ye,be,ve;return ge=new tm({props:{colorScale:s[6],limits:s[7]}}),{c(){e=le("button"),e.textContent="Recalculate",t=Oe(),r=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(` zones
      reachable. That's `),C=ze(T),N=ze(" / "),U=ze(B),ee=ze(`
      (`),ae=ze(ie),J=ze(") of the population."),Y=Oe(),ot(ge.$$.fragment),xe=Oe(),Ee=le("p"),Ee.textContent=`Darker colours are denser. Zones with a red outline are not reachable by
      the current network. Only the top 3 densest quintiles are shown.`,Ze(e,"class","outline")},m(Ce,we){se(Ce,e,we),se(Ce,t,we),se(Ce,r,we),G(r,h),G(r,m),G(r,x),G(r,S),G(r,C),G(r,N),G(r,U),G(r,ee),G(r,ae),G(r,J),se(Ce,Y,we),rt(ge,Ce,we),se(Ce,xe,we),se(Ce,Ee,we),ye=!0,be||(ve=Mt(e,"click",s[5]),be=!0)},p(Ce,we){(!ye||we&8)&&a!==(a=Ce[3].toLocaleString()+"")&&Ct(h,a),(!ye||we&1)&&l!==(l=Ce[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ye||we&4)&&T!==(T=Ce[2].toLocaleString()+"")&&Ct(C,T),(!ye||we&16)&&B!==(B=Ce[4].toLocaleString()+"")&&Ct(U,B),(!ye||we&20)&&ie!==(ie=Sr(Ce[2],Ce[4])+"")&&Ct(ae,ie)},i(Ce){ye||(he(ge.$$.fragment,Ce),ye=!0)},o(Ce){ke(ge.$$.fragment,Ce),ye=!1},d(Ce){Ce&&(re(e),re(t),re(r),re(Y),re(xe),re(Ee)),st(ge,Ce),be=!1,ve()}}}function ZC(s){let e,t,r,a,h,m,l,x,S=s[1]&&K0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    Population`),a=Oe(),S&&S.c(),h=Gn(),Ze(t,"type","checkbox")},m(T,C){se(T,e,C),G(e,t),t.checked=s[1],G(e,r),se(T,a,C),S&&S.m(T,C),se(T,h,C),m=!0,l||(x=Mt(t,"change",s[9]),l=!0)},p(T,C){C&2&&(t.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&he(S,1)):(S=K0(T),S.c(),he(S,1),S.m(h.parentNode,h)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){m||(he(S),m=!0)},o(T){ke(S),m=!1},d(T){T&&(re(e),re(a),re(h)),S&&S.d(T),l=!1,x()}}}function HC(s){let e,t,r=s[11].id+"",a,h,m=s[11].reachable?"is":"is not",l,x,S=s[11].population.toLocaleString()+"",T,C,N=Math.round(s[11].population/s[11].area_km2).toLocaleString()+"",B,U,ee=s[11].density_quintile+"",ie,ae;return{c(){e=le("p"),t=ze("Data zone "),a=ze(r),h=Oe(),l=ze(m),x=ze(" reachable. It has "),T=ze(S),C=ze(`
        people, with a density of `),B=ze(N),U=ze(" people per square kilometer, putting it in quintile "),ie=ze(ee),ae=ze(`
        for this study area.`),Rn(e,"max-width","30vw")},m(J,Y){se(J,e,Y),G(e,t),G(e,a),G(e,h),G(e,l),G(e,x),G(e,T),G(e,C),G(e,B),G(e,U),G(e,ie),G(e,ae)},p(J,Y){Y&2048&&r!==(r=J[11].id+"")&&Ct(a,r),Y&2048&&m!==(m=J[11].reachable?"is":"is not")&&Ct(l,m),Y&2048&&S!==(S=J[11].population.toLocaleString()+"")&&Ct(T,S),Y&2048&&N!==(N=Math.round(J[11].population/J[11].area_km2).toLocaleString()+"")&&Ct(B,N),Y&2048&&ee!==(ee=J[11].density_quintile+"")&&Ct(ie,ee)},d(J){J&&re(e)}}}function XC(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[HC,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function WC(s){let e,t,r,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","density_quintile"],s[7],s[6]),"fill-opacity":s[8]},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[XC]},$$scope:{ctx:s}}}),r=new cr({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:s[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,m){const l={};m&2&&(l.layout={visibility:h[1]?"visible":"none"}),m&4096&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.layout={visibility:h[1]?"visible":"none"}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function KC(s){let e,t,r,a;return e=new qs({props:{name:"population density",$$slots:{default:[ZC]},$$scope:{ctx:s}}}),r=new $i({props:{data:s[0],generateId:!0,$$slots:{default:[WC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,[m]){const l={};m&4127&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&4098&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function $C(s,e,t){let r,a,h,m,l;Pt(s,Yf,U=>t(1,m=U)),Pt(s,Yi,U=>t(10,l=U));let x={type:"FeatureCollection",features:[]};async function S(){l&&t(0,x=await l.getDataZones())}let T=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],C=[0,1,2,3,4,5],N=zr(["case",["<",["get","density_quintile"],4],.5,0],.9);function B(){m=this.checked,Yf.set(m)}return s.$$.update=()=>{s.$$.dirty&3&&m&&x.features.length==0&&S(),s.$$.dirty&1&&t(4,r=ed(x.features.map(U=>U.properties.population))),s.$$.dirty&1&&t(3,a=x.features.filter(U=>U.properties.reachable).length),s.$$.dirty&1&&t(2,h=ed(x.features.filter(U=>U.properties.reachable).map(U=>U.properties.population)))},[x,m,h,a,r,S,T,C,N,B]}class YC extends fn{constructor(e){super(),hn(this,e,$C,KC,on,{})}}function $0(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge=s[0].total_quintile_sums.length>0&&Y0(s);return{c(){e=le("div"),t=le("button"),t.textContent="Recalculate",r=Oe(),a=le("label"),h=le("input"),m=ze(`
        Only show routes covered by current edits`),l=Oe(),x=le("label"),S=ze(`Only show quintile:
        `),T=le("select"),C=le("option"),C.textContent="Show all",N=le("option"),N.textContent="1",B=le("option"),B.textContent="2",U=le("option"),U.textContent="3",ee=le("option"),ee.textContent="4",ie=le("option"),ie.textContent="5",ae=Oe(),ge&&ge.c(),Ze(t,"class","outline"),Ze(h,"type","checkbox"),C.__value="",vi(C,C.__value),N.__value="1",vi(N,N.__value),B.__value="2",vi(B,B.__value),U.__value="3",vi(U,U.__value),ee.__value="4",vi(ee,ee.__value),ie.__value="5",vi(ie,ie.__value),s[3]===void 0&&vo(()=>s[7].call(T)),Rn(e,"border","1px solid black"),Rn(e,"padding","4px")},m(xe,Ee){se(xe,e,Ee),G(e,t),G(e,r),G(e,a),G(a,h),h.checked=s[2],G(a,m),G(e,l),G(e,x),G(x,S),G(x,T),G(T,C),G(T,N),G(T,B),G(T,U),G(T,ee),G(T,ie),Zr(T,s[3],!0),G(e,ae),ge&&ge.m(e,null),J||(Y=[Mt(t,"click",s[4]),Mt(h,"change",s[6]),Mt(T,"change",s[7])],J=!0)},p(xe,Ee){Ee&4&&(h.checked=xe[2]),Ee&8&&Zr(T,xe[3]),xe[0].total_quintile_sums.length>0?ge?ge.p(xe,Ee):(ge=Y0(xe),ge.c(),ge.m(e,null)):ge&&(ge.d(1),ge=null)},d(xe){xe&&re(e),ge&&ge.d(),J=!1,Ji(Y)}}}function Y0(s){let e,t,r,a,h,m=Sr(s[0].covered_quintile_sums[0],s[0].total_quintile_sums[0])+"",l,x,S,T,C=Sr(s[0].covered_quintile_sums[1],s[0].total_quintile_sums[1])+"",N,B,U,ee,ie=Sr(s[0].covered_quintile_sums[2],s[0].total_quintile_sums[2])+"",ae,J,Y,ge,xe=Sr(s[0].covered_quintile_sums[3],s[0].total_quintile_sums[3])+"",Ee,ye,be,ve,Ce=Sr(s[0].covered_quintile_sums[4],s[0].total_quintile_sums[4])+"",we;return{c(){e=le("p"),e.textContent="Flow covered by current edits",t=Oe(),r=le("ul"),a=le("li"),h=ze("Quintile 1: "),l=ze(m),x=Oe(),S=le("li"),T=ze("Quintile 2: "),N=ze(C),B=Oe(),U=le("li"),ee=ze("Quintile 3: "),ae=ze(ie),J=Oe(),Y=le("li"),ge=ze("Quintile 4: "),Ee=ze(xe),ye=Oe(),be=le("li"),ve=ze("Quintile 5: "),we=ze(Ce)},m(_e,tt){se(_e,e,tt),se(_e,t,tt),se(_e,r,tt),G(r,a),G(a,h),G(a,l),G(r,x),G(r,S),G(S,T),G(S,N),G(r,B),G(r,U),G(U,ee),G(U,ae),G(r,J),G(r,Y),G(Y,ge),G(Y,Ee),G(r,ye),G(r,be),G(be,ve),G(be,we)},p(_e,tt){tt&1&&m!==(m=Sr(_e[0].covered_quintile_sums[0],_e[0].total_quintile_sums[0])+"")&&Ct(l,m),tt&1&&C!==(C=Sr(_e[0].covered_quintile_sums[1],_e[0].total_quintile_sums[1])+"")&&Ct(N,C),tt&1&&ie!==(ie=Sr(_e[0].covered_quintile_sums[2],_e[0].total_quintile_sums[2])+"")&&Ct(ae,ie),tt&1&&xe!==(xe=Sr(_e[0].covered_quintile_sums[3],_e[0].total_quintile_sums[3])+"")&&Ct(Ee,xe),tt&1&&Ce!==(Ce=Sr(_e[0].covered_quintile_sums[4],_e[0].total_quintile_sums[4])+"")&&Ct(we,Ce)},d(_e){_e&&(re(e),re(t),re(r))}}}function JC(s){let e,t,r,a,h,m,l,x=s[1]&&$0(s);return{c(){e=le("label"),t=le("input"),r=ze(`
    High NPT route coverage`),a=Oe(),x&&x.c(),h=Gn(),Ze(t,"type","checkbox")},m(S,T){se(S,e,T),G(e,t),t.checked=s[1],G(e,r),se(S,a,T),x&&x.m(S,T),se(S,h,T),m||(l=Mt(t,"change",s[5]),m=!0)},p(S,T){T&2&&(t.checked=S[1]),S[1]?x?x.p(S,T):(x=$0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(re(e),re(a),re(h)),x&&x.d(S),m=!1,l()}}}function QC(s){let e,t=s[9].flow.toLocaleString()+"",r,a,h=s[9].quintile+"",m,l,x=s[9].covered+"",S;return{c(){e=ze("Flow "),r=ze(t),a=ze(" is in quintile "),m=ze(h),l=ze(`,
      covered `),S=ze(x)},m(T,C){se(T,e,C),se(T,r,C),se(T,a,C),se(T,m,C),se(T,l,C),se(T,S,C)},p(T,C){C&512&&t!==(t=T[9].flow.toLocaleString()+"")&&Ct(r,t),C&512&&h!==(h=T[9].quintile+"")&&Ct(m,h),C&512&&x!==(x=T[9].covered+"")&&Ct(S,x)},d(T){T&&(re(e),re(r),re(a),re(m),re(l),re(S))}}}function eL(s){let e,t;return e=new Ms({props:{openOn:"hover",$$slots:{default:[QC,({props:r})=>({9:r}),({props:r})=>r?512:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1536&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function tL(s){let e,t;return e=new cr({props:{layout:{visibility:s[1]?"visible":"none"},filter:J0(s[2],s[3]),paint:{"line-width":td("flow"),"line-color":rm("flow")},$$slots:{default:[eL]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&2&&(h.layout={visibility:r[1]?"visible":"none"}),a&12&&(h.filter=J0(r[2],r[3])),a&1024&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function nL(s){let e,t,r,a;return e=new qs({props:{name:"high npt route coverage",$$slots:{default:[JC]},$$scope:{ctx:s}}}),r=new $i({props:{data:s[0],$$slots:{default:[tL]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,[m]){const l={};m&1039&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&1038&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function J0(s,e){let t=["all"];return s&&t.push(["get","covered"]),e.length>0&&t.push(["==",["get","quintile"],parseInt(e)]),t}function iL(s,e,t){let r,a;Pt(s,ec,N=>t(1,r=N)),Pt(s,Yi,N=>t(8,a=N));let h=!1,m="",l={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function x(){a&&t(0,l=await a.renderPrecalculatedFlows())}function S(){r=this.checked,ec.set(r)}function T(){h=this.checked,t(2,h)}function C(){m=Da(this),t(3,m)}return s.$$.update=()=>{s.$$.dirty&3&&r&&l.features.length==0&&x()},[l,r,h,m,x,S,T,C]}class rL extends fn{constructor(e){super(),hn(this,e,iL,nL,on,{})}}function sL(s){let e,t;return e=new Qp({props:{paint:{"circle-color":"purple","circle-radius":5},layout:{visibility:s[1]&&s[2].kind=="edit-route"?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&6&&(h.layout={visibility:r[1]&&r[2].kind=="edit-route"?"visible":"none"}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function oL(s){let e,t;return e=new $i({props:{data:s[0],$$slots:{default:[sL]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,[a]){const h={};a&1&&(h.data=r[0]),a&38&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function aL(s,e,t){let r,a,h;Pt(s,Bp,x=>t(1,r=x)),Pt(s,Yi,x=>t(3,a=x)),Pt(s,Oi,x=>t(2,h=x));let m={type:"FeatureCollection",features:[]};async function l(){a&&t(0,m=await a.getMajorJunctions())}return s.$$.update=()=>{s.$$.dirty&3&&r&&m.features.length==0&&l()},[m,r,h]}class lL extends fn{constructor(e){super(),hn(this,e,aL,oL,on,{})}}function uL(s){let e,t,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,ae,J,Y,ge,xe,Ee,ye,be,ve,Ce,we,_e,tt,Ve;return e=new uT({}),r=new gT({}),h=new rL({}),l=new AT({}),S=new FT({}),C=new GT({}),B=new YT({}),ee=new nC({}),ae=new _C({}),Y=new AC({}),xe=new FC({}),ye=new aC({}),ve=new GC({}),we=new YC({}),tt=new lL({}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment),m=Oe(),ot(l.$$.fragment),x=Oe(),ot(S.$$.fragment),T=Oe(),ot(C.$$.fragment),N=Oe(),ot(B.$$.fragment),U=Oe(),ot(ee.$$.fragment),ie=Oe(),ot(ae.$$.fragment),J=Oe(),ot(Y.$$.fragment),ge=Oe(),ot(xe.$$.fragment),Ee=Oe(),ot(ye.$$.fragment),be=Oe(),ot(ve.$$.fragment),Ce=Oe(),ot(we.$$.fragment),_e=Oe(),ot(tt.$$.fragment)},m(qe,dt){rt(e,qe,dt),se(qe,t,dt),rt(r,qe,dt),se(qe,a,dt),rt(h,qe,dt),se(qe,m,dt),rt(l,qe,dt),se(qe,x,dt),rt(S,qe,dt),se(qe,T,dt),rt(C,qe,dt),se(qe,N,dt),rt(B,qe,dt),se(qe,U,dt),rt(ee,qe,dt),se(qe,ie,dt),rt(ae,qe,dt),se(qe,J,dt),rt(Y,qe,dt),se(qe,ge,dt),rt(xe,qe,dt),se(qe,Ee,dt),rt(ye,qe,dt),se(qe,be,dt),rt(ve,qe,dt),se(qe,Ce,dt),rt(we,qe,dt),se(qe,_e,dt),rt(tt,qe,dt),Ve=!0},p:Je,i(qe){Ve||(he(e.$$.fragment,qe),he(r.$$.fragment,qe),he(h.$$.fragment,qe),he(l.$$.fragment,qe),he(S.$$.fragment,qe),he(C.$$.fragment,qe),he(B.$$.fragment,qe),he(ee.$$.fragment,qe),he(ae.$$.fragment,qe),he(Y.$$.fragment,qe),he(xe.$$.fragment,qe),he(ye.$$.fragment,qe),he(ve.$$.fragment,qe),he(we.$$.fragment,qe),he(tt.$$.fragment,qe),Ve=!0)},o(qe){ke(e.$$.fragment,qe),ke(r.$$.fragment,qe),ke(h.$$.fragment,qe),ke(l.$$.fragment,qe),ke(S.$$.fragment,qe),ke(C.$$.fragment,qe),ke(B.$$.fragment,qe),ke(ee.$$.fragment,qe),ke(ae.$$.fragment,qe),ke(Y.$$.fragment,qe),ke(xe.$$.fragment,qe),ke(ye.$$.fragment,qe),ke(ve.$$.fragment,qe),ke(we.$$.fragment,qe),ke(tt.$$.fragment,qe),Ve=!1},d(qe){qe&&(re(t),re(a),re(m),re(x),re(T),re(N),re(U),re(ie),re(J),re(ge),re(Ee),re(be),re(Ce),re(_e)),st(e,qe),st(r,qe),st(h,qe),st(l,qe),st(S,qe),st(C,qe),st(B,qe),st(ee,qe),st(ae,qe),st(Y,qe),st(xe,qe),st(ye,qe),st(ve,qe),st(we,qe),st(tt,qe)}}}class cL extends fn{constructor(e){super(),hn(this,e,null,uL,on,{})}}function hL(s){let e,t,r;return t=new $A({}),{c(){e=le("div"),ot(t.$$.fragment),Ze(e,"slot","top")},m(a,h){se(a,e,h),rt(t,e,null),r=!0},p:Je,i(a){r||(he(t.$$.fragment,a),r=!0)},o(a){ke(t.$$.fragment,a),r=!1},d(a){a&&re(e),st(t)}}}function fL(s){let e,t;return{c(){e=le("div"),t=le("div"),Ze(e,"slot","left")},m(r,a){se(r,e,a),G(e,t),s[14](t)},p:Je,d(r){r&&re(e),s[14](null)}}}function dL(s){let e,t;return e=new Q2({props:{map:s[0],apiKey:i1}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&1&&(h.map=r[0]),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function Q0(s){let e,t,r,a,h,m,l,x,S={ctx:s,current:null,token:null,hasCatch:!1,pending:_L,then:mL,catch:pL,value:21,blocks:[,,,]};Xr(e=s[5].getInvertedBoundary(),S),r=new cL({});const T=[kL,wL,xL,bL,vL,yL],C=[];function N(B,U){return B[6].kind=="main"?0:B[6].kind=="edit-route"&&B[0]?1:B[6].kind=="evaluate-route"?2:B[6].kind=="evaluate-od"?3:B[6].kind=="debug-network"?4:B[6].kind=="debug-mesh-density"?5:-1}return~(h=N(s))&&(m=C[h]=T[h](s)),{c(){S.block.c(),t=Oe(),ot(r.$$.fragment),a=Oe(),m&&m.c(),l=Gn()},m(B,U){S.block.m(B,S.anchor=U),S.mount=()=>t.parentNode,S.anchor=t,se(B,t,U),rt(r,B,U),se(B,a,U),~h&&C[h].m(B,U),se(B,l,U),x=!0},p(B,U){s=B,S.ctx=s,U&32&&e!==(e=s[5].getInvertedBoundary())&&Xr(e,S)||Oa(S,s,U);let ee=h;h=N(s),h===ee?~h&&C[h].p(s,U):(m&&(Nn(),ke(C[ee],1,1,()=>{C[ee]=null}),zn()),~h?(m=C[h],m?m.p(s,U):(m=C[h]=T[h](s),m.c()),he(m,1),m.m(l.parentNode,l)):m=null)},i(B){x||(he(S.block),he(r.$$.fragment,B),he(m),x=!0)},o(B){for(let U=0;U<3;U+=1){const ee=S.blocks[U];ke(ee)}ke(r.$$.fragment,B),ke(m),x=!1},d(B){B&&(re(t),re(a),re(l)),S.block.d(B),S.token=null,S=null,st(r,B),~h&&C[h].d(B)}}}function pL(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function mL(s){let e,t;return e=new $i({props:{data:s[21],$$slots:{default:[gL]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&32&&(h.data=r[21]),a&4194304&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function gL(s){let e,t;return e=new mc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function _L(s){return{c:Je,m:Je,p:Je,i:Je,o:Je,d:Je}}function yL(s){let e,t;return e=new HS({}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function vL(s){let e,t;return e=new FS({}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function bL(s){let e,t;return e=new qA({}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function xL(s){let e,t;return e=new DA({props:{browse:s[6].browse}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&64&&(h.browse=r[6].browse),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function wL(s){let e,t;return e=new yA({props:{id:s[6].id,map:s[0]}}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p(r,a){const h={};a&64&&(h.id=r[6].id),a&1&&(h.map=r[0]),e.$set(h)},i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function kL(s){let e,t;return e=new _E({}),{c(){ot(e.$$.fragment)},m(r,a){rt(e,r,a),t=!0},p:Je,i(r){t||(he(e.$$.fragment,r),t=!0)},o(r){ke(e.$$.fragment,r),t=!1},d(r){st(e,r)}}}function IL(s){let e,t,r,a,h,m,l,x=dL(s);t=new IE({});let S=s[5]&&Q0(s);return{c(){x&&x.c(),e=Oe(),ot(t.$$.fragment),r=Oe(),a=le("div"),h=Oe(),S&&S.c(),m=Gn()},m(T,C){x&&x.m(T,C),se(T,e,C),rt(t,T,C),se(T,r,C),se(T,a,C),s[11](a),se(T,h,C),S&&S.m(T,C),se(T,m,C),l=!0},p(T,C){x.p(T,C),T[5]?S?(S.p(T,C),C&32&&he(S,1)):(S=Q0(T),S.c(),he(S,1),S.m(m.parentNode,m)):S&&(Nn(),ke(S,1,1,()=>{S=null}),zn())},i(T){l||(he(x),he(t.$$.fragment,T),he(S),l=!0)},o(T){ke(x),ke(t.$$.fragment,T),ke(S),l=!1},d(T){T&&(re(e),re(r),re(a),re(h),re(m)),x&&x.d(T),st(t,T),s[11](null),S&&S.d(T)}}}function SL(s){let e,t,r,a;function h(l){s[12](l)}let m={style:`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${i1}`,standardControls:!0,$$slots:{default:[IL]},$$scope:{ctx:s}};return s[0]!==void 0&&(m.map=s[0]),t=new FI({props:m}),Jn.push(()=>_r(t,"map",h)),t.$on("error",s[13]),{c(){e=le("div"),ot(t.$$.fragment),Ze(e,"slot","main"),Rn(e,"position","relative"),Rn(e,"width","100%"),Rn(e,"height","100%")},m(l,x){se(l,e,x),rt(t,e,null),a=!0},p(l,x){const S={};x&4194405&&(S.$$scope={dirty:x,ctx:l}),!r&&x&1&&(r=!0,S.map=l[0],gr(()=>r=!1)),t.$set(S)},i(l){a||(he(t.$$.fragment,l),a=!0)},o(l){ke(t.$$.fragment,l),a=!1},d(l){l&&re(e),st(t)}}}function EL(s){let e,t;return{c(){e=le("div"),t=le("div"),Ze(e,"slot","right")},m(r,a){se(r,e,a),G(e,t),s[10](t)},p:Je,d(r){r&&re(e),s[10](null)}}}function AL(s){let e,t,r,a;return e=new rS({props:{loading:s[4]}}),r=new $I({props:{$$slots:{right:[EL],main:[SL],left:[fL],top:[hL]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),t=Oe(),ot(r.$$.fragment)},m(h,m){rt(e,h,m),se(h,t,m),rt(r,h,m),a=!0},p(h,[m]){const l={};m&16&&(l.loading=h[4]),e.$set(l);const x={};m&4194415&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(he(e.$$.fragment,h),he(r.$$.fragment,h),a=!0)},o(h){ke(e.$$.fragment,h),ke(r.$$.fragment,h),a=!1},d(h){h&&re(t),st(e,h),st(r,h)}}}function Ef(s,e,t){return e+s*(t-e)}function TL(s,e,t){let r,a,h,m,l,x,S,T,C,N;Pt(s,Pp,be=>t(7,r=be)),Pt(s,Dp,be=>t(8,a=be)),Pt(s,Rp,be=>t(9,h=be)),Pt(s,Yi,be=>t(5,m=be)),Pt(s,Qf,be=>t(15,l=be)),Pt(s,Sh,be=>t(16,x=be)),Pt(s,Qu,be=>t(17,S=be)),Pt(s,Hf,be=>t(18,T=be)),Pt(s,Fp,be=>t(19,C=be)),Pt(s,Oi,be=>t(6,N=be));let B="",U;cc(async()=>{await a1();let be=new URLSearchParams(window.location.search);Dn(Hf,T=be.get("boundary")||"LAD_City of Edinburgh",T),t(4,B=`Loading ${T}`);let ve=new SS,Ce=await fetch(`areas/${T}.bin`);Ce.ok?(console.log("Using locally hosted files"),Dn(Fp,C=!1,C)):(console.log("Using remote hosted files"),Ce=await fetch(sd(`areas/${T}.bin`)));let we=await Ce.arrayBuffer();try{await ve.loadFile(new Uint8Array(we))}catch(Ve){window.alert(`Couldn't load: ${Ve}`)}let _e=window.localStorage.getItem(`tmp-npt-editor/${T}`);if(_e)try{await ve.loadSavefile(_e)}catch(Ve){window.alert(`Couldn't restore saved state: ${Ve}`)}t(4,B="");let tt=await ve.getBounds();Dn(Qu,S={lng:Ef(.4,tt[0],tt[2]),lat:Ef(.4,tt[1],tt[3])},S),Dn(Sh,x={lng:Ef(.6,tt[0],tt[2]),lat:Ef(.6,tt[1],tt[3])},x),Dn(Qf,l=new BE(U,ve.toRouteSnapper(),Yn(Mf()),Yn(!0),Yn(0)),l),Yi.set(ve),await ee()});async function ee(){U&&m&&U.fitBounds(await m.getBounds(),{animate:!1})}let ie,ae,J;function Y(be){Jn[be?"unshift":"push"](()=>{J=be,t(3,J),t(7,r)})}function ge(be){Jn[be?"unshift":"push"](()=>{ae=be,t(2,ae),t(8,a)})}function xe(be){U=be,t(0,U)}const Ee=be=>{console.log(be.detail.error)};function ye(be){Jn[be?"unshift":"push"](()=>{ie=be,t(1,ie),t(9,h)})}return s.$$.update=()=>{s.$$.dirty&1&&U&&ES.set(U),s.$$.dirty&514&&ie&&h&&(t(1,ie.innerHTML="",ie),ie.appendChild(h)),s.$$.dirty&260&&ae&&a&&(t(2,ae.innerHTML="",ae),ae.appendChild(a)),s.$$.dirty&136&&J&&r&&(t(3,J.innerHTML="",J),J.appendChild(r))},[U,ie,ae,J,B,m,N,r,a,h,Y,ge,xe,Ee,ye]}class CL extends fn{constructor(e){super(),hn(this,e,TL,AL,on,{})}}new CL({target:document.getElementById("app")});
