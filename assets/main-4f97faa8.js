var Vb=Object.defineProperty;var qb=(r,e,i)=>e in r?Vb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i;var lh=(r,e,i)=>(qb(r,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const f of a)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function i(a){const f={};return a.integrity&&(f.integrity=a.integrity),a.referrerPolicy&&(f.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?f.credentials="include":a.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(a){if(a.ep)return;a.ep=!0;const f=i(a);fetch(a.href,f)}})();function nt(){}function Gb(r,e){for(const i in e)r[i]=e[i];return r}function Zb(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function V0(r){return r()}function jg(){return Object.create(null)}function $i(r){r.forEach(V0)}function nu(r){return typeof r=="function"}function un(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let gf;function ms(r,e){return r===e?!0:(gf||(gf=document.createElement("a")),gf.href=e,r===gf.href)}function Hb(r){return Object.keys(r).length===0}function q0(r,...e){if(r==null){for(const s of e)s(void 0);return nt}const i=r.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function Df(r){let e;return q0(r,i=>e=i)(),e}function Ot(r,e,i){r.$$.on_destroy.push(q0(e,i))}function Zi(r,e,i,s){if(r){const a=G0(r,e,i,s);return r[0](a)}}function G0(r,e,i,s){return r[1]&&s?Gb(i.ctx.slice(),r[1](s(e))):i.ctx}function Hi(r,e,i,s){if(r[2]&&s){const a=r[2](s(i));if(e.dirty===void 0)return a;if(typeof a=="object"){const f=[],g=Math.max(e.dirty.length,a.length);for(let l=0;l<g;l+=1)f[l]=e.dirty[l]|a[l];return f}return e.dirty|a}return e.dirty}function Wi(r,e,i,s,a,f){if(a){const g=G0(e,i,s,f);r.p(g,a)}}function Xi(r){if(r.ctx.length>32){const e=[],i=r.ctx.length/32;for(let s=0;s<i;s++)e[s]=-1;return e}return-1}function Wb(r){const e={};for(const i in r)e[i]=!0;return e}function Nf(r){return r??""}function Dn(r,e,i){return r.set(i),e}function pp(r){return r&&nu(r.destroy)?r.destroy:nt}const Z0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Z(r,e){r.appendChild(e)}function ae(r,e,i){r.insertBefore(e,i||null)}function oe(r){r.parentNode&&r.parentNode.removeChild(r)}function Sr(r,e){for(let i=0;i<r.length;i+=1)r[i]&&r[i].d(e)}function ce(r){return document.createElement(r)}function Da(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Fe(r){return document.createTextNode(r)}function je(){return Fe(" ")}function ai(){return Fe("")}function Pt(r,e,i,s){return r.addEventListener(e,i,s),()=>r.removeEventListener(e,i,s)}function Nh(r){return function(e){return e.preventDefault(),r.call(this,e)}}function np(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function He(r,e,i){i==null?r.removeAttribute(e):r.getAttribute(e)!==i&&r.setAttribute(e,i)}function Vg(r){let e;return{p(...i){e=i,e.forEach(s=>r.push(s))},r(){e.forEach(i=>r.splice(r.indexOf(i),1))}}}function Xb(r){return Array.from(r.childNodes)}function Mt(r,e){e=""+e,r.data!==e&&(r.data=e)}function zi(r,e){r.value=e??""}function Un(r,e,i,s){i==null?r.style.removeProperty(e):r.style.setProperty(e,i,s?"important":"")}function fs(r,e,i){for(let s=0;s<r.options.length;s+=1){const a=r.options[s];if(a.__value===e){a.selected=!0;return}}(!i||e!==void 0)&&(r.selectedIndex=-1)}function _l(r){const e=r.querySelector(":checked");return e&&e.__value}function Vr(r,e,i){r.classList.toggle(e,!!i)}function $b(r,e,{bubbles:i=!1,cancelable:s=!1}={}){return new CustomEvent(r,{detail:e,bubbles:i,cancelable:s})}let Ch;function Ra(r){Ch=r}function uc(){if(!Ch)throw new Error("Function called outside component initialization");return Ch}function cc(r){uc().$$.on_mount.push(r)}function vo(r){uc().$$.on_destroy.push(r)}function hc(){const r=uc();return(e,i,{cancelable:s=!1}={})=>{const a=r.$$.callbacks[e];if(a){const f=$b(e,i,{cancelable:s});return a.slice().forEach(g=>{g.call(r,f)}),!f.defaultPrevented}return!0}}function H0(r,e){return uc().$$.context.set(r,e),e}function W0(r){return uc().$$.context.get(r)}function ur(r,e){const i=r.$$.callbacks[e.type];i&&i.slice().forEach(s=>s.call(this,e))}const Hu=[],Jn=[];let Qu=[];const mp=[],X0=Promise.resolve();let gp=!1;function $0(){gp||(gp=!0,X0.then(jp))}function Yb(){return $0(),X0}function Po(r){Qu.push(r)}function kr(r){mp.push(r)}const ip=new Set;let Uu=0;function jp(){if(Uu!==0)return;const r=Ch;do{try{for(;Uu<Hu.length;){const e=Hu[Uu];Uu++,Ra(e),Jb(e.$$)}}catch(e){throw Hu.length=0,Uu=0,e}for(Ra(null),Hu.length=0,Uu=0;Jn.length;)Jn.pop()();for(let e=0;e<Qu.length;e+=1){const i=Qu[e];ip.has(i)||(ip.add(i),i())}Qu.length=0}while(Hu.length);for(;mp.length;)mp.pop()();gp=!1,ip.clear(),Ra(r)}function Jb(r){if(r.fragment!==null){r.update(),$i(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Po)}}function Kb(r){const e=[],i=[];Qu.forEach(s=>r.indexOf(s)===-1?e.push(s):i.push(s)),i.forEach(s=>s()),Qu=e}const Tf=new Set;let eu;function Nn(){eu={r:0,c:[],p:eu}}function zn(){eu.r||$i(eu.c),eu=eu.p}function _e(r,e){r&&r.i&&(Tf.delete(r),r.i(e))}function Ie(r,e,i,s){if(r&&r.o){if(Tf.has(r))return;Tf.add(r),eu.c.push(()=>{Tf.delete(r),s&&(i&&r.d(1),s())}),r.o(e)}else s&&s()}function gs(r,e){const i=e.token={};function s(a,f,g,l){if(e.token!==i)return;e.resolved=l;let x=e.ctx;g!==void 0&&(x=x.slice(),x[g]=l);const E=a&&(e.current=a)(x);let C=!1;e.block&&(e.blocks?e.blocks.forEach((L,N)=>{N!==f&&L&&(Nn(),Ie(L,1,1,()=>{e.blocks[N]===L&&(e.blocks[N]=null)}),zn())}):e.block.d(1),E.c(),_e(E,1),E.m(e.mount(),e.anchor),C=!0),e.block=E,e.blocks&&(e.blocks[f]=E),C&&jp()}if(Zb(r)){const a=uc();if(r.then(f=>{Ra(a),s(e.then,1,e.value,f),Ra(null)},f=>{if(Ra(a),s(e.catch,2,e.error,f),Ra(null),!e.hasCatch)throw f}),e.current!==e.pending)return s(e.pending,0),!0}else{if(e.current!==e.then)return s(e.then,1,e.value,r),!0;e.resolved=r}}function kl(r,e,i){const s=e.slice(),{resolved:a}=r;r.current===r.then&&(s[r.value]=a),r.current===r.catch&&(s[r.error]=a),r.block.p(s,i)}function Hn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Qb(r,e){Ie(r,1,1,()=>{e.delete(r.key)})}function ex(r,e,i,s,a,f,g,l,x,E,C,L){let N=r.length,B=f.length,U=N;const te={};for(;U--;)te[r[U].key]=U;const ie=[],re=new Map,J=new Map,$=[];for(U=B;U--;){const ue=L(a,f,U),xe=i(ue);let be=g.get(xe);be?s&&$.push(()=>be.p(ue,e)):(be=E(xe,ue),be.c()),re.set(xe,ie[U]=be),xe in te&&J.set(xe,Math.abs(U-te[xe]))}const fe=new Set,ve=new Set;function Pe(ue){_e(ue,1),ue.m(l,C),g.set(ue.key,ue),C=ue.first,B--}for(;N&&B;){const ue=ie[B-1],xe=r[N-1],be=ue.key,Te=xe.key;ue===xe?(C=ue.first,N--,B--):re.has(Te)?!g.has(be)||fe.has(be)?Pe(ue):ve.has(Te)?N--:J.get(be)>J.get(Te)?(ve.add(be),Pe(ue)):(fe.add(Te),N--):(x(xe,g),N--)}for(;N--;){const ue=r[N];re.has(ue.key)||x(ue,g)}for(;B;)Pe(ie[B-1]);return $i($),ie}function Ir(r,e,i){const s=r.$$.props[e];s!==void 0&&(r.$$.bound[s]=i,i(r.$$.ctx[s]))}function ot(r){r&&r.c()}function rt(r,e,i){const{fragment:s,after_update:a}=r.$$;s&&s.m(e,i),Po(()=>{const f=r.$$.on_mount.map(V0).filter(nu);r.$$.on_destroy?r.$$.on_destroy.push(...f):$i(f),r.$$.on_mount=[]}),a.forEach(Po)}function st(r,e){const i=r.$$;i.fragment!==null&&(Kb(i.after_update),$i(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function tx(r,e){r.$$.dirty[0]===-1&&(Hu.push(r),$0(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function hn(r,e,i,s,a,f,g=null,l=[-1]){const x=Ch;Ra(r);const E=r.$$={fragment:null,ctx:[],props:f,update:nt,not_equal:a,bound:jg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:jg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};g&&g(E.root);let C=!1;if(E.ctx=i?i(r,e.props||{},(L,N,...B)=>{const U=B.length?B[0]:N;return E.ctx&&a(E.ctx[L],E.ctx[L]=U)&&(!E.skip_bound&&E.bound[L]&&E.bound[L](U),C&&tx(r,L)),N}):[],E.update(),C=!0,$i(E.before_update),E.fragment=s?s(E.ctx):!1,e.target){if(e.hydrate){const L=Xb(e.target);E.fragment&&E.fragment.l(L),L.forEach(oe)}else E.fragment&&E.fragment.c();e.intro&&_e(r.$$.fragment),rt(r,e.target,e.anchor),jp()}Ra(x)}class fn{constructor(){lh(this,"$$");lh(this,"$$set")}$destroy(){st(this,1),this.$destroy=nt}$on(e,i){if(!nu(i))return nt;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(i),()=>{const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}$set(e){this.$$set&&!Hb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const nx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nx);var ix=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rx(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Y0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(r,e){(function(i,s){r.exports=s()})(ix,function(){var i={},s={};function a(g,l,x){if(s[g]=x,g==="index"){var E="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",C={};return s.shared(C),s.index(i,C),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([E],{type:"text/javascript"}))),i}}a("shared",["exports"],function(g){function l(o,n,u,m){return new(u||(u=Promise))(function(v,S){function T(O){try{R(m.next(O))}catch(j){S(j)}}function A(O){try{R(m.throw(O))}catch(j){S(j)}}function R(O){var j;O.done?v(O.value):(j=O.value,j instanceof u?j:new u(function(G){G(j)})).then(T,A)}R((m=m.apply(o,n||[])).next())})}function x(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}typeof SuppressedError=="function"&&SuppressedError;var E=C;function C(o,n){this.x=o,this.y=n}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,n){return this.clone()._rotateAround(o,n)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var n=o.x-this.x,u=o.y-this.y;return n*n+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,n){return Math.atan2(this.x*n-this.y*o,this.x*o+this.y*n)},_matMult:function(o){var n=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=n,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var n=Math.cos(o),u=Math.sin(o),m=u*this.x+n*this.y;return this.x=n*this.x-u*this.y,this.y=m,this},_rotateAround:function(o,n){var u=Math.cos(o),m=Math.sin(o),v=n.y+m*(this.x-n.x)+u*(this.y-n.y);return this.x=n.x+u*(this.x-n.x)-m*(this.y-n.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(o){return o instanceof C?o:Array.isArray(o)?new C(o[0],o[1]):o};var L=x(E),N=B;function B(o,n,u,m){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(m-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=n,this.p2x=u,this.p2y=m}B.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,n){if(n===void 0&&(n=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,m=0;m<8;m++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<n)return u;var S=this.sampleCurveDerivativeX(u);if(Math.abs(S)<1e-6)break;u-=v/S}var T=0,A=1;for(u=o,m=0;m<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<n));m++)o>v?T=u:A=u,u=.5*(A-T)+T;return u},solve:function(o,n){return this.sampleCurveY(this.solveCurveX(o,n))}};var U=x(N);let te,ie;function re(){return te==null&&(te=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),te}function J(){if(ie==null&&(ie=!1,re())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let m=0;m<5*5;m++){const v=4*m;n.fillStyle=`rgb(${v},${v+1},${v+2})`,n.fillRect(m%5,Math.floor(m/5),1,1)}const u=n.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&u[m]!==m){ie=!0;break}}}return ie||!1}function $(o,n,u,m){const v=new U(o,n,u,m);return S=>v.solve(S)}const fe=$(.25,.1,.25,1);function ve(o,n,u){return Math.min(u,Math.max(n,o))}function Pe(o,n,u){const m=u-n,v=((o-n)%m+m)%m+n;return v===n?u:v}function ue(o,...n){for(const u of n)for(const m in u)o[m]=u[m];return o}let xe=1;function be(o,n,u){const m={};for(const v in o)m[v]=n.call(this,o[v],v,o);return m}function Te(o,n,u){const m={};for(const v in o)n.call(this,o[v],v,o)&&(m[v]=o[v]);return m}function we(o){return Array.isArray(o)?o.map(we):typeof o=="object"&&o?be(o,we):o}const ye={};function ze(o){ye[o]||(typeof console<"u"&&console.warn(o),ye[o]=!0)}function Be(o,n,u){return(u.y-o.y)*(n.x-o.x)>(n.y-o.y)*(u.x-o.x)}function pt(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let St=null;function dt(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Bt(o,n,u,m,v){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(o,{timestamp:0});try{const T=S==null?void 0:S.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const A=T.startsWith("BGR"),R=new Uint8ClampedArray(m*v*4);if(yield S.copyTo(R,function(O,j,G,X,ee){const se=4*Math.max(-j,0),pe=(Math.max(0,G)-G)*X*4+se,Le=4*X,De=Math.max(0,j),tt=Math.max(0,G);return{rect:{x:De,y:tt,width:Math.min(O.width,j+X)-De,height:Math.min(O.height,G+ee)-tt},layout:[{offset:pe,stride:Le}]}}(o,n,u,m,v)),A)for(let O=0;O<R.length;O+=4){const j=R[O];R[O]=R[O+2],R[O+2]=j}return R}finally{S.close()}})}let vt,wt;const ft="AbortError";function xt(){return new Error(ft)}const It={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jt(o){return It.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const pn="global-dispatcher";class Rn extends Error{constructor(n,u,m,v){super(`AJAXError: ${u} (${n}): ${m}`),this.status=n,this.statusText=u,this.url=m,this.body=v}}const Xe=()=>pt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Wn=function(o,n){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const m=Jt(o.url);if(m)return m(o,n);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:pn},n)}if(!(/^file:/.test(u=o.url)||/^file:/.test(Xe())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,v){return l(this,void 0,void 0,function*(){const S=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:Xe(),signal:v.signal});m.type!=="json"||S.headers.has("Accept")||S.headers.set("Accept","application/json");const T=yield fetch(S);if(!T.ok){const O=yield T.blob();throw new Rn(T.status,T.statusText,m.url,O)}let A;A=m.type==="arrayBuffer"||m.type==="image"?T.arrayBuffer():m.type==="json"?T.json():T.text();const R=yield A;if(v.signal.aborted)throw xt();return{data:R,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(o,n);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:pn},n)}var u;return function(m,v){return new Promise((S,T)=>{var A;const R=new XMLHttpRequest;R.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(R.responseType="arraybuffer");for(const O in m.headers)R.setRequestHeader(O,m.headers[O]);m.type==="json"&&(R.responseType="text",!((A=m.headers)===null||A===void 0)&&A.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=m.credentials==="include",R.onerror=()=>{T(new Error(R.statusText))},R.onload=()=>{if(!v.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let O=R.response;if(m.type==="json")try{O=JSON.parse(R.response)}catch(j){return void T(j)}S({data:O,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const O=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});T(new Rn(R.status,R.statusText,m.url,O))}},v.signal.addEventListener("abort",()=>{R.abort(),T(xt())}),R.send(m.body)})}(o,n)};function dn(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const n=new URL(o),u=window.location;return n.protocol===u.protocol&&n.host===u.host}function Ft(o,n,u){u[o]&&u[o].indexOf(n)!==-1||(u[o]=u[o]||[],u[o].push(n))}function Se(o,n,u){if(u&&u[o]){const m=u[o].indexOf(n);m!==-1&&u[o].splice(m,1)}}class lt{constructor(n,u={}){ue(this,u),this.type=n}}class Je extends lt{constructor(n,u={}){super("error",ue({error:n},u))}}class Lt{on(n,u){return this._listeners=this._listeners||{},Ft(n,u,this._listeners),this}off(n,u){return Se(n,u,this._listeners),Se(n,u,this._oneTimeListeners),this}once(n,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ft(n,u,this._oneTimeListeners),this):new Promise(m=>this.once(n,m))}fire(n,u){typeof n=="string"&&(n=new lt(n,u||{}));const m=n.type;if(this.listens(m)){n.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const A of v)A.call(this,n);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const A of S)Se(m,A,this._oneTimeListeners),A.call(this,n);const T=this._eventedParent;T&&(ue(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(n))}else n instanceof Je&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,u){return this._eventedParent=n,this._eventedParentData=u,this}}var Ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const kt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vt(o,n){const u={};for(const m in o)m!=="ref"&&(u[m]=o[m]);return kt.forEach(m=>{m in n&&(u[m]=n[m])}),u}function Ee(o,n){if(Array.isArray(o)){if(!Array.isArray(n)||o.length!==n.length)return!1;for(let u=0;u<o.length;u++)if(!Ee(o[u],n[u]))return!1;return!0}if(typeof o=="object"&&o!==null&&n!==null){if(typeof n!="object"||Object.keys(o).length!==Object.keys(n).length)return!1;for(const u in o)if(!Ee(o[u],n[u]))return!1;return!0}return o===n}function Gt(o,n){o.push(n)}function _n(o,n,u){Gt(u,{command:"addSource",args:[o,n[o]]})}function Kn(o,n,u){Gt(n,{command:"removeSource",args:[o]}),u[o]=!0}function Yi(o,n,u,m){Kn(o,u,m),_n(o,n,u)}function xn(o,n,u){let m;for(m in o[u])if(Object.prototype.hasOwnProperty.call(o[u],m)&&m!=="data"&&!Ee(o[u][m],n[u][m]))return!1;for(m in n[u])if(Object.prototype.hasOwnProperty.call(n[u],m)&&m!=="data"&&!Ee(o[u][m],n[u][m]))return!1;return!0}function qi(o,n,u,m,v,S){o=o||{},n=n||{};for(const T in o)Object.prototype.hasOwnProperty.call(o,T)&&(Ee(o[T],n[T])||u.push({command:S,args:[m,T,n[T],v]}));for(const T in n)Object.prototype.hasOwnProperty.call(n,T)&&!Object.prototype.hasOwnProperty.call(o,T)&&(Ee(o[T],n[T])||u.push({command:S,args:[m,T,n[T],v]}))}function Ji(o){return o.id}function Jr(o,n){return o[n.id]=n,o}class ct{constructor(n,u,m,v){this.message=(n?`${n}: `:"")+m,v&&(this.identifier=v),u!=null&&u.__line__&&(this.line=u.__line__)}}function gr(o,...n){for(const u of n)for(const m in u)o[m]=u[m];return o}class kn extends Error{constructor(n,u){super(u),this.message=u,this.key=n}}class mn{constructor(n,u=[]){this.parent=n,this.bindings={};for(const[m,v]of u)this.bindings[m]=v}concat(n){return new mn(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const As={kind:"null"},At={kind:"number"},Ln={kind:"string"},Tt={kind:"boolean"},_r={kind:"color"},Gr={kind:"object"},wn={kind:"value"},Mi={kind:"collator"},Er={kind:"formatted"},Ki={kind:"padding"},Zr={kind:"resolvedImage"},Ae={kind:"variableAnchorOffsetCollection"};function Q(o,n){return{kind:"array",itemType:o,N:n}}function K(o){if(o.kind==="array"){const n=K(o.itemType);return typeof o.N=="number"?`array<${n}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${n}>`}return o.kind}const he=[As,At,Ln,Tt,_r,Er,Gr,Q(wn),Ki,Zr,Ae];function le(o,n){if(n.kind==="error")return null;if(o.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!le(o.itemType,n.itemType))&&(typeof o.N!="number"||o.N===n.N))return null}else{if(o.kind===n.kind)return null;if(o.kind==="value"){for(const u of he)if(!le(u,n))return null}}return`Expected ${K(o)} but found ${K(n)} instead.`}function de(o,n){return n.some(u=>u.kind===o.kind)}function Ve(o,n){return n.some(u=>u==="null"?o===null:u==="array"?Array.isArray(o):u==="object"?o&&!Array.isArray(o)&&typeof o=="object":u===typeof o)}function We(o,n){return o.kind==="array"&&n.kind==="array"?o.itemType.kind===n.itemType.kind&&typeof o.N=="number":o.kind===n.kind}const Re=.96422,et=.82521,gt=4/29,at=6/29,Dt=3*at*at,en=at*at*at,an=Math.PI/180,Vn=180/Math.PI;function Mn(o){return(o%=360)<0&&(o+=360),o}function An([o,n,u,m]){let v,S;const T=wi((.2225045*(o=Fn(o))+.7168786*(n=Fn(n))+.0606169*(u=Fn(u)))/1);o===n&&n===u?v=S=T:(v=wi((.4360747*o+.3850649*n+.1430804*u)/Re),S=wi((.0139322*o+.0971045*n+.7141733*u)/et));const A=116*T-16;return[A<0?0:A,500*(v-T),200*(T-S),m]}function Fn(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function wi(o){return o>en?Math.pow(o,1/3):o/Dt+gt}function ui([o,n,u,m]){let v=(o+16)/116,S=isNaN(n)?v:v+n/500,T=isNaN(u)?v:v-u/200;return v=1*ni(v),S=Re*ni(S),T=et*ni(T),[Cn(3.1338561*S-1.6168667*v-.4906146*T),Cn(-.9787684*S+1.9161415*v+.033454*T),Cn(.0719453*S-.2289914*v+1.4052427*T),m]}function Cn(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function ni(o){return o>at?o*o*o:Dt*(o-gt)}function hi(o){return parseInt(o.padEnd(2,o),16)/255}function Ai(o,n){return Xn(n?o/100:o,0,1)}function Xn(o,n,u){return Math.min(Math.max(n,o),u)}function Tr(o){return!o.some(Number.isNaN)}const No={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qn{constructor(n,u,m,v=1,S=!0){this.r=n,this.g=u,this.b=m,this.a=v,S||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[n,u,m,v]))}static parse(n){if(n instanceof Qn)return n;if(typeof n!="string")return;const u=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=No[m];if(v){const[T,A,R]=v;return[T/255,A/255,R/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const T=m.length<6?1:2;let A=1;return[hi(m.slice(A,A+=T)),hi(m.slice(A,A+=T)),hi(m.slice(A,A+=T)),hi(m.slice(A,A+T)||"ff")]}if(m.startsWith("rgb")){const T=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[A,R,O,j,G,X,ee,se,pe,Le,De,tt]=T,Ge=[j||" ",ee||" ",Le].join("");if(Ge==="  "||Ge==="  /"||Ge===",,"||Ge===",,,"){const Qe=[O,X,pe].join(""),ht=Qe==="%%%"?100:Qe===""?255:0;if(ht){const Et=[Xn(+R/ht,0,1),Xn(+G/ht,0,1),Xn(+se/ht,0,1),De?Ai(+De,tt):1];if(Tr(Et))return Et}}return}}const S=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[T,A,R,O,j,G,X,ee,se]=S,pe=[R||" ",j||" ",X].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const Le=[+A,Xn(+O,0,100),Xn(+G,0,100),ee?Ai(+ee,se):1];if(Tr(Le))return function([De,tt,Ge,Qe]){function ht(Et){const $t=(Et+De/30)%12,yn=tt*Math.min(Ge,1-Ge);return Ge-yn*Math.max(-1,Math.min($t-3,9-$t,1))}return De=Mn(De),tt/=100,Ge/=100,[ht(0),ht(8),ht(4),Qe]}(Le)}}}(n);return u?new Qn(...u,!1):void 0}get rgb(){const{r:n,g:u,b:m,a:v}=this,S=v||1/0;return this.overwriteGetter("rgb",[n/S,u/S,m/S,v])}get hcl(){return this.overwriteGetter("hcl",function(n){const[u,m,v,S]=An(n),T=Math.sqrt(m*m+v*v);return[Math.round(1e4*T)?Mn(Math.atan2(v,m)*Vn):NaN,T,u,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",An(this.rgb))}overwriteGetter(n,u){return Object.defineProperty(this,n,{value:u}),u}toString(){const[n,u,m,v]=this.rgb;return`rgba(${[n,u,m].map(S=>Math.round(255*S)).join(",")},${v})`}}Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1);class bo{constructor(n,u,m){this.sensitivity=n?u?"variant":"case":u?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,u){return this.collator.compare(n,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(n,u,m,v,S){this.text=n,this.image=u,this.scale=m,this.fontStack=v,this.textColor=S}}class Cr{constructor(n){this.sections=n}static fromString(n){return new Cr([new aa(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Cr?n:Cr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Dr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Dr)return n;if(typeof n=="number")return new Dr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const u of n)if(typeof u!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Dr(n)}}toString(){return JSON.stringify(this.values)}}const yc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pi{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Pi)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let u=0;u<n.length;u+=2){const m=n[u],v=n[u+1];if(typeof m!="string"||!yc.has(m)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Pi(n)}}toString(){return JSON.stringify(this.values)}}class or{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new or({name:n,available:!1}):null}}function no(o,n,u,m){return typeof o=="number"&&o>=0&&o<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof u=="number"&&u>=0&&u<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[o,n,u,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[o,n,u,m]:[o,n,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kr(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Qn||o instanceof bo||o instanceof Cr||o instanceof Dr||o instanceof Pi||o instanceof or)return!0;if(Array.isArray(o)){for(const n of o)if(!Kr(n))return!1;return!0}if(typeof o=="object"){for(const n in o)if(!Kr(o[n]))return!1;return!0}return!1}function Ri(o){if(o===null)return As;if(typeof o=="string")return Ln;if(typeof o=="boolean")return Tt;if(typeof o=="number")return At;if(o instanceof Qn)return _r;if(o instanceof bo)return Mi;if(o instanceof Cr)return Er;if(o instanceof Dr)return Ki;if(o instanceof Pi)return Ae;if(o instanceof or)return Zr;if(Array.isArray(o)){const n=o.length;let u;for(const m of o){const v=Ri(m);if(u){if(u===v)continue;u=wn;break}u=v}return Q(u||wn,n)}return Gr}function la(o){const n=typeof o;return o===null?"":n==="string"||n==="number"||n==="boolean"?String(o):o instanceof Qn||o instanceof Cr||o instanceof Dr||o instanceof Pi||o instanceof or?o.toString():JSON.stringify(o)}class _s{constructor(n,u){this.type=n,this.value=u}static parse(n,u){if(n.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Kr(n[1]))return u.error("invalid value");const m=n[1];let v=Ri(m);const S=u.expectedType;return v.kind!=="array"||v.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(v=S),new _s(v,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fi{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const ua={string:Ln,number:At,boolean:Tt,object:Gr};class Qr{constructor(n,u){this.type=n,this.args=u}static parse(n,u){if(n.length<2)return u.error("Expected at least one argument.");let m,v=1;const S=n[0];if(S==="array"){let A,R;if(n.length>2){const O=n[1];if(typeof O!="string"||!(O in ua)||O==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=ua[O],v++}else A=wn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=n[2],v++}m=Q(A,R)}else{if(!ua[S])throw new Error(`Types doesn't contain name = ${S}`);m=ua[S]}const T=[];for(;v<n.length;v++){const A=u.parse(n[v],v,wn);if(!A)return null;T.push(A)}return new Qr(m,T)}evaluate(n){for(let u=0;u<this.args.length;u++){const m=this.args[u].evaluate(n);if(!le(this.type,Ri(m)))return m;if(u===this.args.length-1)throw new Fi(`Expected value to be of type ${K(this.type)}, but found ${K(Ri(m))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const zo={"to-boolean":Tt,"to-color":_r,"to-number":At,"to-string":Ln};class Qi{constructor(n,u){this.type=n,this.args=u}static parse(n,u){if(n.length<2)return u.error("Expected at least one argument.");const m=n[0];if(!zo[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&n.length!==2)return u.error("Expected one argument.");const v=zo[m],S=[];for(let T=1;T<n.length;T++){const A=u.parse(n[T],T,wn);if(!A)return null;S.push(A)}return new Qi(v,S)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let u,m;for(const v of this.args){if(u=v.evaluate(n),m=null,u instanceof Qn)return u;if(typeof u=="string"){const S=n.parseColor(u);if(S)return S}else if(Array.isArray(u)&&(m=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:no(u[0],u[1],u[2],u[3]),!m))return new Qn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Fi(m||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const m of this.args){u=m.evaluate(n);const v=Dr.parse(u);if(v)return v}throw new Fi(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const m of this.args){u=m.evaluate(n);const v=Pi.parse(u);if(v)return v}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const m of this.args){if(u=m.evaluate(n),u===null)return 0;const v=Number(u);if(!isNaN(v))return v}throw new Fi(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Cr.fromString(la(this.args[0].evaluate(n)));case"resolvedImage":return or.fromString(la(this.args[0].evaluate(n)));default:return la(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const io=["Unknown","Point","LineString","Polygon"];class ca{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let u=this._parseColorCache[n];return u||(u=this._parseColorCache[n]=Qn.parse(n)),u}}class es{constructor(n,u,m=[],v,S=new mn,T=[]){this.registry=n,this.path=m,this.key=m.map(A=>`[${A}]`).join(""),this.scope=S,this.errors=T,this.expectedType=v,this._isConstant=u}parse(n,u,m,v,S={}){return u?this.concat(u,m,v)._parse(n,S):this._parse(n,S)}_parse(n,u){function m(v,S,T){return T==="assert"?new Qr(S,[v]):T==="coerce"?new Qi(S,[v]):v}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=n[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[v];if(S){let T=S.parse(n,this);if(!T)return null;if(this.expectedType){const A=this.expectedType,R=T.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||R.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(A.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(A.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(A,R))return null}else T=m(T,A,u.typeAnnotation||"coerce");else T=m(T,A,u.typeAnnotation||"coerce");else T=m(T,A,u.typeAnnotation||"coerce");else T=m(T,A,u.typeAnnotation||"assert")}if(!(T instanceof _s)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const A=new ca;try{T=new _s(T.type,T.evaluate(A))}catch(R){return this.error(R.message),null}}return T}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,u,m){const v=typeof n=="number"?this.path.concat(n):this.path,S=m?this.scope.concat(m):this.scope;return new es(this.registry,this._isConstant,v,u||null,S,this.errors)}error(n,...u){const m=`${this.key}${u.map(v=>`[${v}]`).join("")}`;this.errors.push(new kn(m,n))}checkSubtype(n,u){const m=le(n,u);return m&&this.error(m),m}}class ro{constructor(n,u){this.type=u.type,this.bindings=[].concat(n),this.result=u}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const u of this.bindings)n(u[1]);n(this.result)}static parse(n,u){if(n.length<4)return u.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const m=[];for(let S=1;S<n.length-1;S+=2){const T=n[S];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",S);const A=u.parse(n[S+1],S+1);if(!A)return null;m.push([T,A])}const v=u.parse(n[n.length-1],n.length-1,u.expectedType,m);return v?new ro(m,v):null}outputDefined(){return this.result.outputDefined()}}class ei{constructor(n,u){this.type=u.type,this.name=n,this.boundExpression=u}static parse(n,u){if(n.length!==2||typeof n[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const m=n[1];return u.scope.has(m)?new ei(m,u.scope.get(m)):u.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Sl{constructor(n,u,m){this.type=n,this.index=u,this.input=m}static parse(n,u){if(n.length!==3)return u.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const m=u.parse(n[1],1,At),v=u.parse(n[2],2,Q(u.expectedType||wn));return m&&v?new Sl(v.type.itemType,m,v):null}evaluate(n){const u=this.index.evaluate(n),m=this.input.evaluate(n);if(u<0)throw new Fi(`Array index out of bounds: ${u} < 0.`);if(u>=m.length)throw new Fi(`Array index out of bounds: ${u} > ${m.length-1}.`);if(u!==Math.floor(u))throw new Fi(`Array index must be an integer, but found ${u} instead.`);return m[u]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class El{constructor(n,u){this.type=Tt,this.needle=n,this.haystack=u}static parse(n,u){if(n.length!==3)return u.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const m=u.parse(n[1],1,wn),v=u.parse(n[2],2,wn);return m&&v?de(m.type,[Tt,Ln,At,As,wn])?new El(m,v):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(m.type)} instead`):null}evaluate(n){const u=this.needle.evaluate(n),m=this.haystack.evaluate(n);if(!m)return!1;if(!Ve(u,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${K(Ri(u))} instead.`);if(!Ve(m,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${K(Ri(m))} instead.`);return m.indexOf(u)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class xo{constructor(n,u,m){this.type=At,this.needle=n,this.haystack=u,this.fromIndex=m}static parse(n,u){if(n.length<=2||n.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const m=u.parse(n[1],1,wn),v=u.parse(n[2],2,wn);if(!m||!v)return null;if(!de(m.type,[Tt,Ln,At,As,wn]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(m.type)} instead`);if(n.length===4){const S=u.parse(n[3],3,At);return S?new xo(m,v,S):null}return new xo(m,v)}evaluate(n){const u=this.needle.evaluate(n),m=this.haystack.evaluate(n);if(!Ve(u,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${K(Ri(u))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(n)),Ve(m,["string"])){const S=m.indexOf(u,v);return S===-1?-1:[...m.slice(0,S)].length}if(Ve(m,["array"]))return m.indexOf(u,v);throw new Fi(`Expected second argument to be of type array or string, but found ${K(Ri(m))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class wo{constructor(n,u,m,v,S,T){this.inputType=n,this.type=u,this.input=m,this.cases=v,this.outputs=S,this.otherwise=T}static parse(n,u){if(n.length<5)return u.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return u.error("Expected an even number of arguments.");let m,v;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);const S={},T=[];for(let O=2;O<n.length-1;O+=2){let j=n[O];const G=n[O+1];Array.isArray(j)||(j=[j]);const X=u.concat(O);if(j.length===0)return X.error("Expected at least one branch label.");for(const se of j){if(typeof se!="number"&&typeof se!="string")return X.error("Branch labels must be numbers or strings.");if(typeof se=="number"&&Math.abs(se)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof se=="number"&&Math.floor(se)!==se)return X.error("Numeric branch labels must be integer values.");if(m){if(X.checkSubtype(m,Ri(se)))return null}else m=Ri(se);if(S[String(se)]!==void 0)return X.error("Branch labels must be unique.");S[String(se)]=T.length}const ee=u.parse(G,O,v);if(!ee)return null;v=v||ee.type,T.push(ee)}const A=u.parse(n[1],1,wn);if(!A)return null;const R=u.parse(n[n.length-1],n.length-1,v);return R?A.type.kind!=="value"&&u.concat(1).checkSubtype(m,A.type)?null:new wo(m,v,A,S,T,R):null}evaluate(n){const u=this.input.evaluate(n);return(Ri(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(n,u,m){this.type=n,this.branches=u,this.otherwise=m}static parse(n,u){if(n.length<4)return u.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return u.error("Expected an odd number of arguments.");let m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);const v=[];for(let T=1;T<n.length-1;T+=2){const A=u.parse(n[T],T,Tt);if(!A)return null;const R=u.parse(n[T+1],T+1,m);if(!R)return null;v.push([A,R]),m=m||R.type}const S=u.parse(n[n.length-1],n.length-1,m);if(!S)return null;if(!m)throw new Error("Can't infer output type");return new ha(m,v,S)}evaluate(n){for(const[u,m]of this.branches)if(u.evaluate(n))return m.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[u,m]of this.branches)n(u),n(m);n(this.otherwise)}outputDefined(){return this.branches.every(([n,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(n,u,m,v){this.type=n,this.input=u,this.beginIndex=m,this.endIndex=v}static parse(n,u){if(n.length<=2||n.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const m=u.parse(n[1],1,wn),v=u.parse(n[2],2,At);if(!m||!v)return null;if(!de(m.type,[Q(wn),Ln,wn]))return u.error(`Expected first argument to be of type array or string, but found ${K(m.type)} instead`);if(n.length===4){const S=u.parse(n[3],3,At);return S?new fa(m.type,m,v,S):null}return new fa(m.type,m,v)}evaluate(n){const u=this.input.evaluate(n),m=this.beginIndex.evaluate(n);let v;if(this.endIndex&&(v=this.endIndex.evaluate(n)),Ve(u,["string"]))return[...u].slice(m,v).join("");if(Ve(u,["array"]))return u.slice(m,v);throw new Fi(`Expected first argument to be of type array or string, but found ${K(Ri(u))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function da(o,n){const u=o.length-1;let m,v,S=0,T=u,A=0;for(;S<=T;)if(A=Math.floor((S+T)/2),m=o[A],v=o[A+1],m<=n){if(A===u||n<v)return A;S=A+1}else{if(!(m>n))throw new Fi("Input is not a number.");T=A-1}return 0}class Oo{constructor(n,u,m){this.type=n,this.input=u,this.labels=[],this.outputs=[];for(const[v,S]of m)this.labels.push(v),this.outputs.push(S)}static parse(n,u){if(n.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return u.error("Expected an even number of arguments.");const m=u.parse(n[1],1,At);if(!m)return null;const v=[];let S=null;u.expectedType&&u.expectedType.kind!=="value"&&(S=u.expectedType);for(let T=1;T<n.length;T+=2){const A=T===1?-1/0:n[T],R=n[T+1],O=T,j=T+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const G=u.parse(R,j,S);if(!G)return null;S=S||G.type,v.push([A,G])}return new Oo(S,m,v)}evaluate(n){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(n);const v=this.input.evaluate(n);if(v<=u[0])return m[0].evaluate(n);const S=u.length;return v>=u[S-1]?m[S-1].evaluate(n):m[da(u,v)].evaluate(n)}eachChild(n){n(this.input);for(const u of this.outputs)n(u)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function za(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ki=so;function so(o,n,u,m){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(m-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=n,this.p2x=u,this.p2y=m}so.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,n){if(n===void 0&&(n=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,m=0;m<8;m++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<n)return u;var S=this.sampleCurveDerivativeX(u);if(Math.abs(S)<1e-6)break;u-=v/S}var T=0,A=1;for(u=o,m=0;m<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<n));m++)o>v?T=u:A=u,u=.5*(A-T)+T;return u},solve:function(o,n){return this.sampleCurveY(this.solveCurveX(o,n))}};var vc=za(ki);function Vs(o,n,u){return o+u*(n-o)}function yr(o,n,u){return o.map((m,v)=>Vs(m,n[v],u))}const bi={number:Vs,color:function(o,n,u,m="rgb"){switch(m){case"rgb":{const[v,S,T,A]=yr(o.rgb,n.rgb,u);return new Qn(v,S,T,A,!1)}case"hcl":{const[v,S,T,A]=o.hcl,[R,O,j,G]=n.hcl;let X,ee;if(isNaN(v)||isNaN(R))isNaN(v)?isNaN(R)?X=NaN:(X=R,T!==1&&T!==0||(ee=O)):(X=v,j!==1&&j!==0||(ee=S));else{let tt=R-v;R>v&&tt>180?tt-=360:R<v&&v-R>180&&(tt+=360),X=v+u*tt}const[se,pe,Le,De]=function([tt,Ge,Qe,ht]){return tt=isNaN(tt)?0:tt*an,ui([Qe,Math.cos(tt)*Ge,Math.sin(tt)*Ge,ht])}([X,ee??Vs(S,O,u),Vs(T,j,u),Vs(A,G,u)]);return new Qn(se,pe,Le,De,!1)}case"lab":{const[v,S,T,A]=ui(yr(o.lab,n.lab,u));return new Qn(v,S,T,A,!1)}}},array:yr,padding:function(o,n,u){return new Dr(yr(o.values,n.values,u))},variableAnchorOffsetCollection:function(o,n,u){const m=o.values,v=n.values;if(m.length!==v.length)throw new Fi(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${n.toString()}`);const S=[];for(let T=0;T<m.length;T+=2){if(m[T]!==v[T])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${m[T]}, to[${T}]: ${v[T]}`);S.push(m[T]);const[A,R]=m[T+1],[O,j]=v[T+1];S.push([Vs(A,O,u),Vs(R,j,u)])}return new Pi(S)}};class cr{constructor(n,u,m,v,S){this.type=n,this.operator=u,this.interpolation=m,this.input=v,this.labels=[],this.outputs=[];for(const[T,A]of S)this.labels.push(T),this.outputs.push(A)}static interpolationFactor(n,u,m,v){let S=0;if(n.name==="exponential")S=Oa(u,n.base,m,v);else if(n.name==="linear")S=Oa(u,1,m,v);else if(n.name==="cubic-bezier"){const T=n.controlPoints;S=new vc(T[0],T[1],T[2],T[3]).solve(Oa(u,1,m,v))}return S}static parse(n,u){let[m,v,S,...T]=n;if(!Array.isArray(v)||v.length===0)return u.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const O=v[1];if(typeof O!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:O}}else{if(v[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const O=v.slice(1);if(O.length!==4||O.some(j=>typeof j!="number"||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:O}}}if(n.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(S=u.parse(S,2,At),!S)return null;const A=[];let R=null;m==="interpolate-hcl"||m==="interpolate-lab"?R=_r:u.expectedType&&u.expectedType.kind!=="value"&&(R=u.expectedType);for(let O=0;O<T.length;O+=2){const j=T[O],G=T[O+1],X=O+3,ee=O+4;if(typeof j!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(A.length&&A[A.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const se=u.parse(G,ee,R);if(!se)return null;R=R||se.type,A.push([j,se])}return We(R,At)||We(R,_r)||We(R,Ki)||We(R,Ae)||We(R,Q(At))?new cr(R,m,v,S,A):u.error(`Type ${K(R)} is not interpolatable.`)}evaluate(n){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(n);const v=this.input.evaluate(n);if(v<=u[0])return m[0].evaluate(n);const S=u.length;if(v>=u[S-1])return m[S-1].evaluate(n);const T=da(u,v),A=cr.interpolationFactor(this.interpolation,v,u[T],u[T+1]),R=m[T].evaluate(n),O=m[T+1].evaluate(n);switch(this.operator){case"interpolate":return bi[this.type.kind](R,O,A);case"interpolate-hcl":return bi.color(R,O,A,"hcl");case"interpolate-lab":return bi.color(R,O,A,"lab")}}eachChild(n){n(this.input);for(const u of this.outputs)n(u)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Oa(o,n,u,m){const v=m-u,S=o-u;return v===0?0:n===1?S/v:(Math.pow(n,S)-1)/(Math.pow(n,v)-1)}class Fa{constructor(n,u){this.type=n,this.args=u}static parse(n,u){if(n.length<2)return u.error("Expectected at least one argument.");let m=null;const v=u.expectedType;v&&v.kind!=="value"&&(m=v);const S=[];for(const A of n.slice(1)){const R=u.parse(A,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!R)return null;m=m||R.type,S.push(R)}if(!m)throw new Error("No output type");const T=v&&S.some(A=>le(v,A.type));return new Fa(T?wn:m,S)}evaluate(n){let u,m=null,v=0;for(const S of this.args)if(v++,m=S.evaluate(n),m&&m instanceof or&&!m.available&&(u||(u=m.name),m=null,v===this.args.length&&(m=u)),m!==null)break;return m}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function pa(o,n){return o==="=="||o==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function ma(o,n,u,m){return m.compare(n,u)===0}function Fo(o,n,u){const m=o!=="=="&&o!=="!=";return class J0{constructor(S,T,A){this.type=Tt,this.lhs=S,this.rhs=T,this.collator=A,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const A=S[0];let R=T.parse(S[1],1,wn);if(!R)return null;if(!pa(A,R.type))return T.concat(1).error(`"${A}" comparisons are not supported for type '${K(R.type)}'.`);let O=T.parse(S[2],2,wn);if(!O)return null;if(!pa(A,O.type))return T.concat(2).error(`"${A}" comparisons are not supported for type '${K(O.type)}'.`);if(R.type.kind!==O.type.kind&&R.type.kind!=="value"&&O.type.kind!=="value")return T.error(`Cannot compare types '${K(R.type)}' and '${K(O.type)}'.`);m&&(R.type.kind==="value"&&O.type.kind!=="value"?R=new Qr(O.type,[R]):R.type.kind!=="value"&&O.type.kind==="value"&&(O=new Qr(R.type,[O])));let j=null;if(S.length===4){if(R.type.kind!=="string"&&O.type.kind!=="string"&&R.type.kind!=="value"&&O.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(j=T.parse(S[3],3,Mi),!j)return null}return new J0(R,O,j)}evaluate(S){const T=this.lhs.evaluate(S),A=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const R=Ri(T),O=Ri(A);if(R.kind!==O.kind||R.kind!=="string"&&R.kind!=="number")throw new Fi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${R.kind}, ${O.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const R=Ri(T),O=Ri(A);if(R.kind!=="string"||O.kind!=="string")return n(S,T,A)}return this.collator?u(S,T,A,this.collator.evaluate(S)):n(S,T,A)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const su=Fo("==",function(o,n,u){return n===u},ma),ii=Fo("!=",function(o,n,u){return n!==u},function(o,n,u,m){return!ma(0,n,u,m)}),ys=Fo("<",function(o,n,u){return n<u},function(o,n,u,m){return m.compare(n,u)<0}),Tl=Fo(">",function(o,n,u){return n>u},function(o,n,u,m){return m.compare(n,u)>0}),ou=Fo("<=",function(o,n,u){return n<=u},function(o,n,u,m){return m.compare(n,u)<=0}),Bo=Fo(">=",function(o,n,u){return n>=u},function(o,n,u,m){return m.compare(n,u)>=0});class Uo{constructor(n,u,m){this.type=Mi,this.locale=m,this.caseSensitive=n,this.diacriticSensitive=u}static parse(n,u){if(n.length!==2)return u.error("Expected one argument.");const m=n[1];if(typeof m!="object"||Array.isArray(m))return u.error("Collator options argument must be an object.");const v=u.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,Tt);if(!v)return null;const S=u.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,Tt);if(!S)return null;let T=null;return m.locale&&(T=u.parse(m.locale,1,Ln),!T)?null:new Uo(v,S,T)}evaluate(n){return new bo(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class hr{constructor(n,u,m,v,S){this.type=Ln,this.number=n,this.locale=u,this.currency=m,this.minFractionDigits=v,this.maxFractionDigits=S}static parse(n,u){if(n.length!==3)return u.error("Expected two arguments.");const m=u.parse(n[1],1,At);if(!m)return null;const v=n[2];if(typeof v!="object"||Array.isArray(v))return u.error("NumberFormat options argument must be an object.");let S=null;if(v.locale&&(S=u.parse(v.locale,1,Ln),!S))return null;let T=null;if(v.currency&&(T=u.parse(v.currency,1,Ln),!T))return null;let A=null;if(v["min-fraction-digits"]&&(A=u.parse(v["min-fraction-digits"],1,At),!A))return null;let R=null;return v["max-fraction-digits"]&&(R=u.parse(v["max-fraction-digits"],1,At),!R)?null:new hr(m,S,T,A,R)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class ga{constructor(n){this.type=Er,this.sections=n}static parse(n,u){if(n.length<2)return u.error("Expected at least one argument.");const m=n[1];if(!Array.isArray(m)&&typeof m=="object")return u.error("First argument must be an image or text section.");const v=[];let S=!1;for(let T=1;T<=n.length-1;++T){const A=n[T];if(S&&typeof A=="object"&&!Array.isArray(A)){S=!1;let R=null;if(A["font-scale"]&&(R=u.parse(A["font-scale"],1,At),!R))return null;let O=null;if(A["text-font"]&&(O=u.parse(A["text-font"],1,Q(Ln)),!O))return null;let j=null;if(A["text-color"]&&(j=u.parse(A["text-color"],1,_r),!j))return null;const G=v[v.length-1];G.scale=R,G.font=O,G.textColor=j}else{const R=u.parse(n[T],1,wn);if(!R)return null;const O=R.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,v.push({content:R,scale:null,font:null,textColor:null})}}return new ga(v)}evaluate(n){return new Cr(this.sections.map(u=>{const m=u.content.evaluate(n);return Ri(m)===Zr?new aa("",m,null,null,null):new aa(la(m),null,u.scale?u.scale.evaluate(n):null,u.font?u.font.evaluate(n).join(","):null,u.textColor?u.textColor.evaluate(n):null)}))}eachChild(n){for(const u of this.sections)n(u.content),u.scale&&n(u.scale),u.font&&n(u.font),u.textColor&&n(u.textColor)}outputDefined(){return!1}}class _a{constructor(n){this.type=Zr,this.input=n}static parse(n,u){if(n.length!==2)return u.error("Expected two arguments.");const m=u.parse(n[1],1,Ln);return m?new _a(m):u.error("No image name provided.")}evaluate(n){const u=this.input.evaluate(n),m=or.fromString(u);return m&&n.availableImages&&(m.available=n.availableImages.indexOf(u)>-1),m}eachChild(n){n(this.input)}outputDefined(){return!1}}class Ba{constructor(n){this.type=At,this.input=n}static parse(n,u){if(n.length!==2)return u.error(`Expected 1 argument, but found ${n.length-1} instead.`);const m=u.parse(n[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${K(m.type)} instead.`):new Ba(m):null}evaluate(n){const u=this.input.evaluate(n);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new Fi(`Expected value to be of type string or array, but found ${K(Ri(u))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const vs=8192;function bc(o,n){const u=(180+o[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,v=Math.pow(2,n.z);return[Math.round(u*v*vs),Math.round(m*v*vs)]}function Ua(o,n){const u=Math.pow(2,n.z);return[(v=(o[0]/vs+n.x)/u,360*v-180),(m=(o[1]/vs+n.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,v}function Lr(o,n){o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[0]),o[3]=Math.max(o[3],n[1])}function bs(o,n){return!(o[0]<=n[0]||o[2]>=n[2]||o[1]<=n[1]||o[3]>=n[3])}function ri(o,n,u){const m=o[0]-n[0],v=o[1]-n[1],S=o[0]-u[0],T=o[1]-u[1];return m*T-S*v==0&&m*S<=0&&v*T<=0}function Mr(o,n,u,m){return(v=[m[0]-u[0],m[1]-u[1]])[0]*(S=[n[0]-o[0],n[1]-o[1]])[1]-v[1]*S[0]!=0&&!(!au(o,n,u,m)||!au(u,m,o,n));var v,S}function jo(o,n,u){for(const m of u)for(let v=0;v<m.length-1;++v)if(Mr(o,n,m[v],m[v+1]))return!0;return!1}function Vo(o,n,u=!1){let m=!1;for(const A of n)for(let R=0;R<A.length-1;R++){if(ri(o,A[R],A[R+1]))return u;(S=A[R])[1]>(v=o)[1]!=(T=A[R+1])[1]>v[1]&&v[0]<(T[0]-S[0])*(v[1]-S[1])/(T[1]-S[1])+S[0]&&(m=!m)}var v,S,T;return m}function qo(o,n){for(const u of n)if(Vo(o,u))return!0;return!1}function Cl(o,n){for(const u of o)if(!Vo(u,n))return!1;for(let u=0;u<o.length-1;++u)if(jo(o[u],o[u+1],n))return!1;return!0}function Go(o,n){for(const u of n)if(Cl(o,u))return!0;return!1}function au(o,n,u,m){const v=m[0]-u[0],S=m[1]-u[1],T=(o[0]-u[0])*S-v*(o[1]-u[1]),A=(n[0]-u[0])*S-v*(n[1]-u[1]);return T>0&&A<0||T<0&&A>0}function ts(o,n,u){const m=[];for(let v=0;v<o.length;v++){const S=[];for(let T=0;T<o[v].length;T++){const A=bc(o[v][T],u);Lr(n,A),S.push(A)}m.push(S)}return m}function Ll(o,n,u){const m=[];for(let v=0;v<o.length;v++){const S=ts(o[v],n,u);m.push(S)}return m}function lu(o,n,u,m){if(o[0]<u[0]||o[0]>u[2]){const v=.5*m;let S=o[0]-u[0]>v?-m:u[0]-o[0]>v?m:0;S===0&&(S=o[0]-u[2]>v?-m:u[2]-o[0]>v?m:0),o[0]+=S}Lr(n,o)}function uu(o,n,u,m){const v=Math.pow(2,m.z)*vs,S=[m.x*vs,m.y*vs],T=[];for(const A of o)for(const R of A){const O=[R.x+S[0],R.y+S[1]];lu(O,n,u,v),T.push(O)}return T}function cu(o,n,u,m){const v=Math.pow(2,m.z)*vs,S=[m.x*vs,m.y*vs],T=[];for(const R of o){const O=[];for(const j of R){const G=[j.x+S[0],j.y+S[1]];Lr(n,G),O.push(G)}T.push(O)}if(n[2]-n[0]<=v/2){(A=n)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const R of T)for(const O of R)lu(O,n,u,v)}var A;return T}class ko{constructor(n,u){this.type=Tt,this.geojson=n,this.geometries=u}static parse(n,u){if(n.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Kr(n[1])){const m=n[1];if(m.type==="FeatureCollection"){const v=[];for(const S of m.features){const{type:T,coordinates:A}=S.geometry;T==="Polygon"&&v.push(A),T==="MultiPolygon"&&v.push(...A)}if(v.length)return new ko(m,{type:"MultiPolygon",coordinates:v})}else if(m.type==="Feature"){const v=m.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ko(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new ko(m,m)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(u,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(m.type==="Polygon"){const A=ts(m.coordinates,S,T),R=uu(u.geometry(),v,S,T);if(!bs(v,S))return!1;for(const O of R)if(!Vo(O,A))return!1}if(m.type==="MultiPolygon"){const A=Ll(m.coordinates,S,T),R=uu(u.geometry(),v,S,T);if(!bs(v,S))return!1;for(const O of R)if(!qo(O,A))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(u,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(m.type==="Polygon"){const A=ts(m.coordinates,S,T),R=cu(u.geometry(),v,S,T);if(!bs(v,S))return!1;for(const O of R)if(!Cl(O,A))return!1}if(m.type==="MultiPolygon"){const A=Ll(m.coordinates,S,T),R=cu(u.geometry(),v,S,T);if(!bs(v,S))return!1;for(const O of R)if(!Go(O,A))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let hu=class{constructor(o=[],n=(u,m)=>u<m?-1:u>m?1:0){if(this.data=o,this.length=this.data.length,this.compare=n,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:n,compare:u}=this,m=n[o];for(;o>0;){const v=o-1>>1,S=n[v];if(u(m,S)>=0)break;n[o]=S,o=v}n[o]=m}_down(o){const{data:n,compare:u}=this,m=this.length>>1,v=n[o];for(;o<m;){let S=1+(o<<1);const T=S+1;if(T<this.length&&u(n[T],n[S])<0&&(S=T),u(n[S],v)>=0)break;n[o]=n[S],o=S}n[o]=v}};function xc(o,n,u,m,v){fu(o,n,u,m||o.length-1,v||Hr)}function fu(o,n,u,m,v){for(;m>u;){if(m-u>600){var S=m-u+1,T=n-u+1,A=Math.log(S),R=.5*Math.exp(2*A/3),O=.5*Math.sqrt(A*R*(S-R)/S)*(T-S/2<0?-1:1);fu(o,n,Math.max(u,Math.floor(n-T*R/S+O)),Math.min(m,Math.floor(n+(S-T)*R/S+O)),v)}var j=o[n],G=u,X=m;for(xs(o,u,n),v(o[m],j)>0&&xs(o,u,m);G<X;){for(xs(o,G,X),G++,X--;v(o[G],j)<0;)G++;for(;v(o[X],j)>0;)X--}v(o[u],j)===0?xs(o,u,X):xs(o,++X,m),X<=n&&(u=X+1),n<=X&&(m=X-1)}}function xs(o,n,u){var m=o[n];o[n]=o[u],o[u]=m}function Hr(o,n){return o<n?-1:o>n?1:0}function ja(o,n){if(o.length<=1)return[o];const u=[];let m,v;for(const S of o){const T=wc(S);T!==0&&(S.area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(m&&u.push(m),m=[S]):m.push(S))}if(m&&u.push(m),n>1)for(let S=0;S<u.length;S++)u[S].length<=n||(xc(u[S],n,1,u[S].length-1,du),u[S]=u[S].slice(0,n));return u}function du(o,n){return n.area-o.area}function wc(o){let n=0;for(let u,m,v=0,S=o.length,T=S-1;v<S;T=v++)u=o[v],m=o[T],n+=(m.x-u.x)*(u.y+m.y);return n}const Va=1/298.257223563,Ml=Va*(2-Va),qa=Math.PI/180;class Ga{constructor(n){const u=6378.137*qa*1e3,m=Math.cos(n*qa),v=1/(1-Ml*(1-m*m)),S=Math.sqrt(v);this.kx=u*S*m,this.ky=u*S*v*(1-Ml)}distance(n,u){const m=this.wrap(n[0]-u[0])*this.kx,v=(n[1]-u[1])*this.ky;return Math.sqrt(m*m+v*v)}pointOnLine(n,u){let m,v,S,T,A=1/0;for(let R=0;R<n.length-1;R++){let O=n[R][0],j=n[R][1],G=this.wrap(n[R+1][0]-O)*this.kx,X=(n[R+1][1]-j)*this.ky,ee=0;G===0&&X===0||(ee=(this.wrap(u[0]-O)*this.kx*G+(u[1]-j)*this.ky*X)/(G*G+X*X),ee>1?(O=n[R+1][0],j=n[R+1][1]):ee>0&&(O+=G/this.kx*ee,j+=X/this.ky*ee)),G=this.wrap(u[0]-O)*this.kx,X=(u[1]-j)*this.ky;const se=G*G+X*X;se<A&&(A=se,m=O,v=j,S=R,T=ee)}return{point:[m,v],index:S,t:Math.max(0,Math.min(1,T))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function ns(o,n){return n[0]-o[0]}function ya(o){return o[1]-o[0]+1}function Bi(o,n){return o[1]>=o[0]&&o[1]<n}function Io(o,n){if(o[0]>o[1])return[null,null];const u=ya(o);if(n){if(u===2)return[o,null];const v=Math.floor(u/2);return[[o[0],o[0]+v],[o[0]+v,o[1]]]}if(u===1)return[o,null];const m=Math.floor(u/2)-1;return[[o[0],o[0]+m],[o[0]+m+1,o[1]]]}function Al(o,n){if(!Bi(n,o.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let m=n[0];m<=n[1];++m)Lr(u,o[m]);return u}function Za(o){const n=[1/0,1/0,-1/0,-1/0];for(const u of o)for(const m of u)Lr(n,m);return n}function va(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function Ha(o,n,u){if(!va(o)||!va(n))return NaN;let m=0,v=0;return o[2]<n[0]&&(m=n[0]-o[2]),o[0]>n[2]&&(m=o[0]-n[2]),o[1]>n[3]&&(v=o[1]-n[3]),o[3]<n[1]&&(v=n[1]-o[3]),u.distance([0,0],[m,v])}function qs(o,n,u){const m=u.pointOnLine(n,o);return u.distance(o,m.point)}function Pl(o,n,u,m,v){const S=Math.min(qs(o,[u,m],v),qs(n,[u,m],v)),T=Math.min(qs(u,[o,n],v),qs(m,[o,n],v));return Math.min(S,T)}function kc(o,n,u,m,v){if(!Bi(n,o.length)||!Bi(m,u.length))return 1/0;let S=1/0;for(let T=n[0];T<n[1];++T){const A=o[T],R=o[T+1];for(let O=m[0];O<m[1];++O){const j=u[O],G=u[O+1];if(Mr(A,R,j,G))return 0;S=Math.min(S,Pl(A,R,j,G,v))}}return S}function Di(o,n,u,m,v){if(!Bi(n,o.length)||!Bi(m,u.length))return NaN;let S=1/0;for(let T=n[0];T<=n[1];++T)for(let A=m[0];A<=m[1];++A)if(S=Math.min(S,v.distance(o[T],u[A])),S===0)return S;return S}function Ic(o,n,u){if(Vo(o,n,!0))return 0;let m=1/0;for(const v of n){const S=v[0],T=v[v.length-1];if(S!==T&&(m=Math.min(m,qs(o,[T,S],u)),m===0))return m;const A=u.pointOnLine(v,o);if(m=Math.min(m,u.distance(o,A.point)),m===0)return m}return m}function Bn(o,n,u,m){if(!Bi(n,o.length))return NaN;for(let S=n[0];S<=n[1];++S)if(Vo(o[S],u,!0))return 0;let v=1/0;for(let S=n[0];S<n[1];++S){const T=o[S],A=o[S+1];for(const R of u)for(let O=0,j=R.length,G=j-1;O<j;G=O++){const X=R[G],ee=R[O];if(Mr(T,A,X,ee))return 0;v=Math.min(v,Pl(T,A,X,ee,m))}}return v}function Wa(o,n){for(const u of o)for(const m of u)if(Vo(m,n,!0))return!0;return!1}function pi(o,n,u,m=1/0){const v=Za(o),S=Za(n);if(m!==1/0&&Ha(v,S,u)>=m)return m;if(bs(v,S)){if(Wa(o,n))return 0}else if(Wa(n,o))return 0;let T=1/0;for(const A of o)for(let R=0,O=A.length,j=O-1;R<O;j=R++){const G=A[j],X=A[R];for(const ee of n)for(let se=0,pe=ee.length,Le=pe-1;se<pe;Le=se++){const De=ee[Le],tt=ee[se];if(Mr(G,X,De,tt))return 0;T=Math.min(T,Pl(G,X,De,tt,u))}}return T}function ci(o,n,u,m,v,S){if(!S)return;const T=Ha(Al(m,S),v,u);T<n&&o.push([T,S,[0,0]])}function oo(o,n,u,m,v,S,T){if(!S||!T)return;const A=Ha(Al(m,S),Al(v,T),u);A<n&&o.push([A,S,T])}function ba(o,n,u,m,v=1/0){let S=Math.min(m.distance(o[0],u[0][0]),v);if(S===0)return S;const T=new hu([[0,[0,o.length-1],[0,0]]],ns),A=Za(u);for(;T.length>0;){const R=T.pop();if(R[0]>=S)continue;const O=R[1],j=n?50:100;if(ya(O)<=j){if(!Bi(O,o.length))return NaN;if(n){const G=Bn(o,O,u,m);if(isNaN(G)||G===0)return G;S=Math.min(S,G)}else for(let G=O[0];G<=O[1];++G){const X=Ic(o[G],u,m);if(S=Math.min(S,X),S===0)return 0}}else{const G=Io(O,n);ci(T,S,m,o,A,G[0]),ci(T,S,m,o,A,G[1])}}return S}function Zo(o,n,u,m,v,S=1/0){let T=Math.min(S,v.distance(o[0],u[0]));if(T===0)return T;const A=new hu([[0,[0,o.length-1],[0,u.length-1]]],ns);for(;A.length>0;){const R=A.pop();if(R[0]>=T)continue;const O=R[1],j=R[2],G=n?50:100,X=m?50:100;if(ya(O)<=G&&ya(j)<=X){if(!Bi(O,o.length)&&Bi(j,u.length))return NaN;let ee;if(n&&m)ee=kc(o,O,u,j,v),T=Math.min(T,ee);else if(n&&!m){const se=o.slice(O[0],O[1]+1);for(let pe=j[0];pe<=j[1];++pe)if(ee=qs(u[pe],se,v),T=Math.min(T,ee),T===0)return T}else if(!n&&m){const se=u.slice(j[0],j[1]+1);for(let pe=O[0];pe<=O[1];++pe)if(ee=qs(o[pe],se,v),T=Math.min(T,ee),T===0)return T}else ee=Di(o,O,u,j,v),T=Math.min(T,ee)}else{const ee=Io(O,n),se=Io(j,m);oo(A,T,v,o,u,ee[0],se[0]),oo(A,T,v,o,u,ee[0],se[1]),oo(A,T,v,o,u,ee[1],se[0]),oo(A,T,v,o,u,ee[1],se[1])}}return T}function Rl(o){return o.type==="MultiPolygon"?o.coordinates.map(n=>({type:"Polygon",coordinates:n})):o.type==="MultiLineString"?o.coordinates.map(n=>({type:"LineString",coordinates:n})):o.type==="MultiPoint"?o.coordinates.map(n=>({type:"Point",coordinates:n})):[o]}class So{constructor(n,u){this.type=At,this.geojson=n,this.geometries=u}static parse(n,u){if(n.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Kr(n[1])){const m=n[1];if(m.type==="FeatureCollection")return new So(m,m.features.map(v=>Rl(v.geometry)).flat());if(m.type==="Feature")return new So(m,Rl(m.geometry));if("type"in m&&"coordinates"in m)return new So(m,Rl(m))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(u,m){const v=u.geometry(),S=v.flat().map(R=>Ua([R.x,R.y],u.canonical));if(v.length===0)return NaN;const T=new Ga(S[0][1]);let A=1/0;for(const R of m){switch(R.type){case"Point":A=Math.min(A,Zo(S,!1,[R.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,Zo(S,!1,R.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,ba(S,!1,R.coordinates,T,A))}if(A===0)return A}return A}(n,this.geometries);if(n.geometryType()==="LineString")return function(u,m){const v=u.geometry(),S=v.flat().map(R=>Ua([R.x,R.y],u.canonical));if(v.length===0)return NaN;const T=new Ga(S[0][1]);let A=1/0;for(const R of m){switch(R.type){case"Point":A=Math.min(A,Zo(S,!0,[R.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,Zo(S,!0,R.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,ba(S,!0,R.coordinates,T,A))}if(A===0)return A}return A}(n,this.geometries);if(n.geometryType()==="Polygon")return function(u,m){const v=u.geometry();if(v.length===0||v[0].length===0)return NaN;const S=ja(v,0).map(R=>R.map(O=>O.map(j=>Ua([j.x,j.y],u.canonical)))),T=new Ga(S[0][0][0][1]);let A=1/0;for(const R of m)for(const O of S){switch(R.type){case"Point":A=Math.min(A,ba([R.coordinates],!1,O,T,A));break;case"LineString":A=Math.min(A,ba(R.coordinates,!0,O,T,A));break;case"Polygon":A=Math.min(A,pi(O,R.coordinates,T,A))}if(A===0)return A}return A}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ho={"==":su,"!=":ii,">":Tl,"<":ys,">=":Bo,"<=":ou,array:Qr,at:Sl,boolean:Qr,case:ha,coalesce:Fa,collator:Uo,format:ga,image:_a,in:El,"index-of":xo,interpolate:cr,"interpolate-hcl":cr,"interpolate-lab":cr,length:Ba,let:ro,literal:_s,match:wo,number:Qr,"number-format":hr,object:Qr,slice:fa,step:Oo,string:Qr,"to-boolean":Qi,"to-color":Qi,"to-number":Qi,"to-string":Qi,var:ei,within:ko,distance:So};class is{constructor(n,u,m,v){this.name=n,this.type=u,this._evaluate=m,this.args=v}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,u){const m=n[0],v=is.definitions[m];if(!v)return u.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(v)?v[0]:v.type,T=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,A=T.filter(([O])=>!Array.isArray(O)||O.length===n.length-1);let R=null;for(const[O,j]of A){R=new es(u.registry,Wo,u.path,null,u.scope);const G=[];let X=!1;for(let ee=1;ee<n.length;ee++){const se=n[ee],pe=Array.isArray(O)?O[ee-1]:O.type,Le=R.parse(se,1+G.length,pe);if(!Le){X=!0;break}G.push(Le)}if(!X)if(Array.isArray(O)&&O.length!==G.length)R.error(`Expected ${O.length} arguments, but found ${G.length} instead.`);else{for(let ee=0;ee<G.length;ee++){const se=Array.isArray(O)?O[ee]:O.type,pe=G[ee];R.concat(ee+1).checkSubtype(se,pe.type)}if(R.errors.length===0)return new is(m,S,j,G)}}if(A.length===1)u.errors.push(...R.errors);else{const O=(A.length?A:T).map(([G])=>{return X=G,Array.isArray(X)?`(${X.map(K).join(", ")})`:`(${K(X.type)}...)`;var X}).join(" | "),j=[];for(let G=1;G<n.length;G++){const X=u.parse(n[G],1+j.length);if(!X)return null;j.push(K(X.type))}u.error(`Expected arguments of type ${O}, but found (${j.join(", ")}) instead.`)}return null}static register(n,u){is.definitions=u;for(const m in u)n[m]=is}}function Dl(o,[n,u,m,v]){n=n.evaluate(o),u=u.evaluate(o),m=m.evaluate(o);const S=v?v.evaluate(o):1,T=no(n,u,m,S);if(T)throw new Fi(T);return new Qn(n/255,u/255,m/255,S,!1)}function Nl(o,n){return o in n}function zl(o,n){const u=n[o];return u===void 0?null:u}function ao(o){return{type:o}}function Wo(o){if(o instanceof ei)return Wo(o.boundExpression);if(o instanceof is&&o.name==="error"||o instanceof Uo||o instanceof ko||o instanceof So)return!1;const n=o instanceof Qi||o instanceof Qr;let u=!0;return o.eachChild(m=>{u=n?u&&Wo(m):u&&m instanceof _s}),!!u&&Xo(o)&&Yo(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xo(o){if(o instanceof is&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ko||o instanceof So)return!1;let n=!0;return o.eachChild(u=>{n&&!Xo(u)&&(n=!1)}),n}function $o(o){if(o instanceof is&&o.name==="feature-state")return!1;let n=!0;return o.eachChild(u=>{n&&!$o(u)&&(n=!1)}),n}function Yo(o,n){if(o instanceof is&&n.indexOf(o.name)>=0)return!1;let u=!0;return o.eachChild(m=>{u&&!Yo(m,n)&&(u=!1)}),u}function Jo(o){return{result:"success",value:o}}function Ko(o){return{result:"error",value:o}}function Eo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Ol(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Fl(o){return!!o.expression&&o.expression.interpolated}function $n(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Gs(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Sc(o){return o}function Bl(o,n){const u=n.type==="color",m=o.stops&&typeof o.stops[0][0]=="object",v=m||!(m||o.property!==void 0),S=o.type||(Fl(n)?"exponential":"interval");if(u||n.type==="padding"){const j=u?Qn.parse:Dr.parse;(o=gr({},o)).stops&&(o.stops=o.stops.map(G=>[G[0],j(G[1])])),o.default=j(o.default?o.default:n.default)}if(o.colorSpace&&(T=o.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var T;let A,R,O;if(S==="exponential")A=c;else if(S==="interval")A=I;else if(S==="categorical"){A=ws,R=Object.create(null);for(const j of o.stops)R[j[0]]=j[1];O=typeof o.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);A=d}if(m){const j={},G=[];for(let se=0;se<o.stops.length;se++){const pe=o.stops[se],Le=pe[0].zoom;j[Le]===void 0&&(j[Le]={zoom:Le,type:o.type,property:o.property,default:o.default,stops:[]},G.push(Le)),j[Le].stops.push([pe[0].value,pe[1]])}const X=[];for(const se of G)X.push([j[se].zoom,Bl(j[se],n)]);const ee={name:"linear"};return{kind:"composite",interpolationType:ee,interpolationFactor:cr.interpolationFactor.bind(void 0,ee),zoomStops:X.map(se=>se[0]),evaluate:({zoom:se},pe)=>c({stops:X,base:o.base},n,se).evaluate(se,pe)}}if(v){const j=S==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:cr.interpolationFactor.bind(void 0,j),zoomStops:o.stops.map(G=>G[0]),evaluate:({zoom:G})=>A(o,n,G,R,O)}}return{kind:"source",evaluate(j,G){const X=G&&G.properties?G.properties[o.property]:void 0;return X===void 0?fr(o.default,n.default):A(o,n,X,R,O)}}}function fr(o,n,u){return o!==void 0?o:n!==void 0?n:u!==void 0?u:void 0}function ws(o,n,u,m,v){return fr(typeof u===v?m[u]:void 0,o.default,n.default)}function I(o,n,u){if($n(u)!=="number")return fr(o.default,n.default);const m=o.stops.length;if(m===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[m-1][0])return o.stops[m-1][1];const v=da(o.stops.map(S=>S[0]),u);return o.stops[v][1]}function c(o,n,u){const m=o.base!==void 0?o.base:1;if($n(u)!=="number")return fr(o.default,n.default);const v=o.stops.length;if(v===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[v-1][0])return o.stops[v-1][1];const S=da(o.stops.map(j=>j[0]),u),T=function(j,G,X,ee){const se=ee-X,pe=j-X;return se===0?0:G===1?pe/se:(Math.pow(G,pe)-1)/(Math.pow(G,se)-1)}(u,m,o.stops[S][0],o.stops[S+1][0]),A=o.stops[S][1],R=o.stops[S+1][1],O=bi[n.type]||Sc;return typeof A.evaluate=="function"?{evaluate(...j){const G=A.evaluate.apply(void 0,j),X=R.evaluate.apply(void 0,j);if(G!==void 0&&X!==void 0)return O(G,X,T,o.colorSpace)}}:O(A,R,T,o.colorSpace)}function d(o,n,u){switch(n.type){case"color":u=Qn.parse(u);break;case"formatted":u=Cr.fromString(u.toString());break;case"resolvedImage":u=or.fromString(u.toString());break;case"padding":u=Dr.parse(u);break;default:$n(u)===n.type||n.type==="enum"&&n.values[u]||(u=void 0)}return fr(u,o.default,n.default)}is.register(Ho,{error:[{kind:"error"},[Ln],(o,[n])=>{throw new Fi(n.evaluate(o))}],typeof:[Ln,[wn],(o,[n])=>K(Ri(n.evaluate(o)))],"to-rgba":[Q(At,4),[_r],(o,[n])=>{const[u,m,v,S]=n.evaluate(o).rgb;return[255*u,255*m,255*v,S]}],rgb:[_r,[At,At,At],Dl],rgba:[_r,[At,At,At,At],Dl],has:{type:Tt,overloads:[[[Ln],(o,[n])=>Nl(n.evaluate(o),o.properties())],[[Ln,Gr],(o,[n,u])=>Nl(n.evaluate(o),u.evaluate(o))]]},get:{type:wn,overloads:[[[Ln],(o,[n])=>zl(n.evaluate(o),o.properties())],[[Ln,Gr],(o,[n,u])=>zl(n.evaluate(o),u.evaluate(o))]]},"feature-state":[wn,[Ln],(o,[n])=>zl(n.evaluate(o),o.featureState||{})],properties:[Gr,[],o=>o.properties()],"geometry-type":[Ln,[],o=>o.geometryType()],id:[wn,[],o=>o.id()],zoom:[At,[],o=>o.globals.zoom],"heatmap-density":[At,[],o=>o.globals.heatmapDensity||0],"line-progress":[At,[],o=>o.globals.lineProgress||0],accumulated:[wn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[At,ao(At),(o,n)=>{let u=0;for(const m of n)u+=m.evaluate(o);return u}],"*":[At,ao(At),(o,n)=>{let u=1;for(const m of n)u*=m.evaluate(o);return u}],"-":{type:At,overloads:[[[At,At],(o,[n,u])=>n.evaluate(o)-u.evaluate(o)],[[At],(o,[n])=>-n.evaluate(o)]]},"/":[At,[At,At],(o,[n,u])=>n.evaluate(o)/u.evaluate(o)],"%":[At,[At,At],(o,[n,u])=>n.evaluate(o)%u.evaluate(o)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(o,[n,u])=>Math.pow(n.evaluate(o),u.evaluate(o))],sqrt:[At,[At],(o,[n])=>Math.sqrt(n.evaluate(o))],log10:[At,[At],(o,[n])=>Math.log(n.evaluate(o))/Math.LN10],ln:[At,[At],(o,[n])=>Math.log(n.evaluate(o))],log2:[At,[At],(o,[n])=>Math.log(n.evaluate(o))/Math.LN2],sin:[At,[At],(o,[n])=>Math.sin(n.evaluate(o))],cos:[At,[At],(o,[n])=>Math.cos(n.evaluate(o))],tan:[At,[At],(o,[n])=>Math.tan(n.evaluate(o))],asin:[At,[At],(o,[n])=>Math.asin(n.evaluate(o))],acos:[At,[At],(o,[n])=>Math.acos(n.evaluate(o))],atan:[At,[At],(o,[n])=>Math.atan(n.evaluate(o))],min:[At,ao(At),(o,n)=>Math.min(...n.map(u=>u.evaluate(o)))],max:[At,ao(At),(o,n)=>Math.max(...n.map(u=>u.evaluate(o)))],abs:[At,[At],(o,[n])=>Math.abs(n.evaluate(o))],round:[At,[At],(o,[n])=>{const u=n.evaluate(o);return u<0?-Math.round(-u):Math.round(u)}],floor:[At,[At],(o,[n])=>Math.floor(n.evaluate(o))],ceil:[At,[At],(o,[n])=>Math.ceil(n.evaluate(o))],"filter-==":[Tt,[Ln,wn],(o,[n,u])=>o.properties()[n.value]===u.value],"filter-id-==":[Tt,[wn],(o,[n])=>o.id()===n.value],"filter-type-==":[Tt,[Ln],(o,[n])=>o.geometryType()===n.value],"filter-<":[Tt,[Ln,wn],(o,[n,u])=>{const m=o.properties()[n.value],v=u.value;return typeof m==typeof v&&m<v}],"filter-id-<":[Tt,[wn],(o,[n])=>{const u=o.id(),m=n.value;return typeof u==typeof m&&u<m}],"filter->":[Tt,[Ln,wn],(o,[n,u])=>{const m=o.properties()[n.value],v=u.value;return typeof m==typeof v&&m>v}],"filter-id->":[Tt,[wn],(o,[n])=>{const u=o.id(),m=n.value;return typeof u==typeof m&&u>m}],"filter-<=":[Tt,[Ln,wn],(o,[n,u])=>{const m=o.properties()[n.value],v=u.value;return typeof m==typeof v&&m<=v}],"filter-id-<=":[Tt,[wn],(o,[n])=>{const u=o.id(),m=n.value;return typeof u==typeof m&&u<=m}],"filter->=":[Tt,[Ln,wn],(o,[n,u])=>{const m=o.properties()[n.value],v=u.value;return typeof m==typeof v&&m>=v}],"filter-id->=":[Tt,[wn],(o,[n])=>{const u=o.id(),m=n.value;return typeof u==typeof m&&u>=m}],"filter-has":[Tt,[wn],(o,[n])=>n.value in o.properties()],"filter-has-id":[Tt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Tt,[Q(Ln)],(o,[n])=>n.value.indexOf(o.geometryType())>=0],"filter-id-in":[Tt,[Q(wn)],(o,[n])=>n.value.indexOf(o.id())>=0],"filter-in-small":[Tt,[Ln,Q(wn)],(o,[n,u])=>u.value.indexOf(o.properties()[n.value])>=0],"filter-in-large":[Tt,[Ln,Q(wn)],(o,[n,u])=>function(m,v,S,T){for(;S<=T;){const A=S+T>>1;if(v[A]===m)return!0;v[A]>m?T=A-1:S=A+1}return!1}(o.properties()[n.value],u.value,0,u.value.length-1)],all:{type:Tt,overloads:[[[Tt,Tt],(o,[n,u])=>n.evaluate(o)&&u.evaluate(o)],[ao(Tt),(o,n)=>{for(const u of n)if(!u.evaluate(o))return!1;return!0}]]},any:{type:Tt,overloads:[[[Tt,Tt],(o,[n,u])=>n.evaluate(o)||u.evaluate(o)],[ao(Tt),(o,n)=>{for(const u of n)if(u.evaluate(o))return!0;return!1}]]},"!":[Tt,[Tt],(o,[n])=>!n.evaluate(o)],"is-supported-script":[Tt,[Ln],(o,[n])=>{const u=o.globals&&o.globals.isSupportedScript;return!u||u(n.evaluate(o))}],upcase:[Ln,[Ln],(o,[n])=>n.evaluate(o).toUpperCase()],downcase:[Ln,[Ln],(o,[n])=>n.evaluate(o).toLowerCase()],concat:[Ln,ao(wn),(o,n)=>n.map(u=>la(u.evaluate(o))).join("")],"resolved-locale":[Ln,[Mi],(o,[n])=>n.evaluate(o).resolvedLocale()]});class p{constructor(n,u){var m;this.expression=n,this._warningHistory={},this._evaluator=new ca,this._defaultValue=u?(m=u).type==="color"&&Gs(m.default)?new Qn(0,0,0,0):m.type==="color"?Qn.parse(m.default)||null:m.type==="padding"?Dr.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?Pi.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(n,u,m,v,S,T){return this._evaluator.globals=n,this._evaluator.feature=u,this._evaluator.featureState=m,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(n,u,m,v,S,T){this._evaluator.globals=n,this._evaluator.feature=u||null,this._evaluator.featureState=m||null,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function b(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ho}function M(o,n){const u=new es(Ho,Wo,[],n?function(v){const S={color:_r,string:Ln,number:At,enum:Ln,boolean:Tt,formatted:Er,padding:Ki,resolvedImage:Zr,variableAnchorOffsetCollection:Ae};return v.type==="array"?Q(S[v.value]||wn,v.length):S[v.type]}(n):void 0),m=u.parse(o,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Jo(new p(m,n)):Ko(u.errors)}class F{constructor(n,u){this.kind=n,this._styleExpression=u,this.isStateDependent=n!=="constant"&&!$o(u.expression)}evaluateWithoutErrorHandling(n,u,m,v,S,T){return this._styleExpression.evaluateWithoutErrorHandling(n,u,m,v,S,T)}evaluate(n,u,m,v,S,T){return this._styleExpression.evaluate(n,u,m,v,S,T)}}class q{constructor(n,u,m,v){this.kind=n,this.zoomStops=m,this._styleExpression=u,this.isStateDependent=n!=="camera"&&!$o(u.expression),this.interpolationType=v}evaluateWithoutErrorHandling(n,u,m,v,S,T){return this._styleExpression.evaluateWithoutErrorHandling(n,u,m,v,S,T)}evaluate(n,u,m,v,S,T){return this._styleExpression.evaluate(n,u,m,v,S,T)}interpolationFactor(n,u,m){return this.interpolationType?cr.interpolationFactor(this.interpolationType,n,u,m):0}}function Y(o,n){const u=M(o,n);if(u.result==="error")return u;const m=u.value.expression,v=Xo(m);if(!v&&!Eo(n))return Ko([new kn("","data expressions not supported")]);const S=Yo(m,["zoom"]);if(!S&&!Ol(n))return Ko([new kn("","zoom expressions not supported")]);const T=Ue(m);return T||S?T instanceof kn?Ko([T]):T instanceof cr&&!Fl(n)?Ko([new kn("",'"interpolate" expressions cannot be used with this property')]):Jo(T?new q(v?"camera":"composite",u.value,T.labels,T instanceof cr?T.interpolation:void 0):new F(v?"constant":"source",u.value)):Ko([new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class me{constructor(n,u){this._parameters=n,this._specification=u,gr(this,Bl(this._parameters,this._specification))}static deserialize(n){return new me(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ue(o){let n=null;if(o instanceof ro)n=Ue(o.result);else if(o instanceof Fa){for(const u of o.args)if(n=Ue(u),n)break}else(o instanceof Oo||o instanceof cr)&&o.input instanceof is&&o.input.name==="zoom"&&(n=o);return n instanceof kn||o.eachChild(u=>{const m=Ue(u);m instanceof kn?n=m:!n&&m?n=new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&m&&n!==m&&(n=new kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function $e(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const n of o.slice(1))if(!$e(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const mt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zt(o){if(o==null)return{filter:()=>!0,needGeometry:!1};$e(o)||(o=bn(o));const n=M(o,mt);if(n.result==="error")throw new Error(n.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,m,v)=>n.value.evaluate(u,m,{},v),needGeometry:gn(o)}}function Nt(o,n){return o<n?-1:o>n?1:0}function gn(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let n=1;n<o.length;n++)if(gn(o[n]))return!0;return!1}function bn(o){if(!o)return!0;const n=o[0];return o.length<=1?n!=="any":n==="=="?Pn(o[1],o[2],"=="):n==="!="?li(Pn(o[1],o[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Pn(o[1],o[2],n):n==="any"?(u=o.slice(1),["any"].concat(u.map(bn))):n==="all"?["all"].concat(o.slice(1).map(bn)):n==="none"?["all"].concat(o.slice(1).map(bn).map(li)):n==="in"?ti(o[1],o.slice(2)):n==="!in"?li(ti(o[1],o.slice(2))):n==="has"?mi(o[1]):n!=="!has"||li(mi(o[1]));var u}function Pn(o,n,u){switch(o){case"$type":return[`filter-type-${u}`,n];case"$id":return[`filter-id-${u}`,n];default:return[`filter-${u}`,o,n]}}function ti(o,n){if(n.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(u=>typeof u!=typeof n[0])?["filter-in-large",o,["literal",n.sort(Nt)]]:["filter-in-small",o,["literal",n]]}}function mi(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function li(o){return["!",o]}function er(o){const n=typeof o;if(n==="number"||n==="boolean"||n==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let v="[";for(const S of o)v+=`${er(S)},`;return`${v}]`}const u=Object.keys(o).sort();let m="{";for(let v=0;v<u.length;v++)m+=`${JSON.stringify(u[v])}:${er(o[u[v]])},`;return`${m}}`}function rs(o){let n="";for(const u of kt)n+=`/${er(o[u])}`;return n}function Ps(o){const n=o.value;return n?[new ct(o.key,n,"constants have been deprecated as of v8")]:[]}function fi(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ar(o){if(Array.isArray(o))return o.map(Ar);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const n={};for(const u in o)n[u]=Ar(o[u]);return n}return fi(o)}function dr(o){const n=o.key,u=o.value,m=o.valueSpec||{},v=o.objectElementValidators||{},S=o.style,T=o.styleSpec,A=o.validateSpec;let R=[];const O=$n(u);if(O!=="object")return[new ct(n,u,`object expected, ${O} found`)];for(const j in u){const G=j.split(".")[0],X=m[G]||m["*"];let ee;if(v[G])ee=v[G];else if(m[G])ee=A;else if(v["*"])ee=v["*"];else{if(!m["*"]){R.push(new ct(n,u[j],`unknown property "${j}"`));continue}ee=A}R=R.concat(ee({key:(n&&`${n}.`)+j,value:u[j],valueSpec:X,style:S,styleSpec:T,object:u,objectKey:j,validateSpec:A},u))}for(const j in m)v[j]||m[j].required&&m[j].default===void 0&&u[j]===void 0&&R.push(new ct(n,u,`missing required property "${j}"`));return R}function Rs(o){const n=o.value,u=o.valueSpec,m=o.style,v=o.styleSpec,S=o.key,T=o.arrayElementValidator||o.validateSpec;if($n(n)!=="array")return[new ct(S,n,`array expected, ${$n(n)} found`)];if(u.length&&n.length!==u.length)return[new ct(S,n,`array length ${u.length} expected, length ${n.length} found`)];if(u["min-length"]&&n.length<u["min-length"])return[new ct(S,n,`array length at least ${u["min-length"]} expected, length ${n.length} found`)];let A={type:u.value,values:u.values};v.$version<7&&(A.function=u.function),$n(u.value)==="object"&&(A=u.value);let R=[];for(let O=0;O<n.length;O++)R=R.concat(T({array:n,arrayIndex:O,value:n[O],valueSpec:A,validateSpec:o.validateSpec,style:m,styleSpec:v,key:`${S}[${O}]`}));return R}function Xa(o){const n=o.key,u=o.value,m=o.valueSpec;let v=$n(u);return v==="number"&&u!=u&&(v="NaN"),v!=="number"?[new ct(n,u,`number expected, ${v} found`)]:"minimum"in m&&u<m.minimum?[new ct(n,u,`${u} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&u>m.maximum?[new ct(n,u,`${u} is greater than the maximum value ${m.maximum}`)]:[]}function xa(o){const n=o.valueSpec,u=fi(o.value.type);let m,v,S,T={};const A=u!=="categorical"&&o.value.property===void 0,R=!A,O=$n(o.value.stops)==="array"&&$n(o.value.stops[0])==="array"&&$n(o.value.stops[0][0])==="object",j=dr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(ee){if(u==="identity")return[new ct(ee.key,ee.value,'identity function may not have a "stops" property')];let se=[];const pe=ee.value;return se=se.concat(Rs({key:ee.key,value:pe,valueSpec:ee.valueSpec,validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec,arrayElementValidator:G})),$n(pe)==="array"&&pe.length===0&&se.push(new ct(ee.key,pe,"array must have at least one stop")),se},default:function(ee){return ee.validateSpec({key:ee.key,value:ee.value,valueSpec:n,validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec})}}});return u==="identity"&&A&&j.push(new ct(o.key,o.value,'missing required property "property"')),u==="identity"||o.value.stops||j.push(new ct(o.key,o.value,'missing required property "stops"')),u==="exponential"&&o.valueSpec.expression&&!Fl(o.valueSpec)&&j.push(new ct(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(R&&!Eo(o.valueSpec)?j.push(new ct(o.key,o.value,"property functions not supported")):A&&!Ol(o.valueSpec)&&j.push(new ct(o.key,o.value,"zoom functions not supported"))),u!=="categorical"&&!O||o.value.property!==void 0||j.push(new ct(o.key,o.value,'"property" property is required')),j;function G(ee){let se=[];const pe=ee.value,Le=ee.key;if($n(pe)!=="array")return[new ct(Le,pe,`array expected, ${$n(pe)} found`)];if(pe.length!==2)return[new ct(Le,pe,`array length 2 expected, length ${pe.length} found`)];if(O){if($n(pe[0])!=="object")return[new ct(Le,pe,`object expected, ${$n(pe[0])} found`)];if(pe[0].zoom===void 0)return[new ct(Le,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new ct(Le,pe,"object stop key must have value")];if(S&&S>fi(pe[0].zoom))return[new ct(Le,pe[0].zoom,"stop zoom values must appear in ascending order")];fi(pe[0].zoom)!==S&&(S=fi(pe[0].zoom),v=void 0,T={}),se=se.concat(dr({key:`${Le}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{zoom:Xa,value:X}}))}else se=se.concat(X({key:`${Le}[0]`,value:pe[0],valueSpec:{},validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec},pe));return b(Ar(pe[1]))?se.concat([new ct(`${Le}[1]`,pe[1],"expressions are not allowed in function stops.")]):se.concat(ee.validateSpec({key:`${Le}[1]`,value:pe[1],valueSpec:n,validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec}))}function X(ee,se){const pe=$n(ee.value),Le=fi(ee.value),De=ee.value!==null?ee.value:se;if(m){if(pe!==m)return[new ct(ee.key,De,`${pe} stop domain type must match previous stop domain type ${m}`)]}else m=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new ct(ee.key,De,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&u!=="categorical"){let tt=`number expected, ${pe} found`;return Eo(n)&&u===void 0&&(tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(ee.key,De,tt)]}return u!=="categorical"||pe!=="number"||isFinite(Le)&&Math.floor(Le)===Le?u!=="categorical"&&pe==="number"&&v!==void 0&&Le<v?[new ct(ee.key,De,"stop domain values must appear in ascending order")]:(v=Le,u==="categorical"&&Le in T?[new ct(ee.key,De,"stop domain values must be unique")]:(T[Le]=!0,[])):[new ct(ee.key,De,`integer expected, found ${Le}`)]}}function lo(o){const n=(o.expressionContext==="property"?Y:M)(Ar(o.value),o.valueSpec);if(n.result==="error")return n.value.map(m=>new ct(`${o.key}${m.key}`,o.value,m.message));const u=n.value.expression||n.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!u.outputDefined())return[new ct(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!$o(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!$o(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Yo(u,["zoom","feature-state"]))return[new ct(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Xo(u))return[new ct(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ks(o){const n=o.key,u=o.value,m=o.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(fi(u))===-1&&v.push(new ct(n,u,`expected one of [${m.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(m.values).indexOf(fi(u))===-1&&v.push(new ct(n,u,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Ec(o){return $e(Ar(o.value))?lo(gr({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pu(o)}function pu(o){const n=o.value,u=o.key;if($n(n)!=="array")return[new ct(u,n,`array expected, ${$n(n)} found`)];const m=o.styleSpec;let v,S=[];if(n.length<1)return[new ct(u,n,"filter array must have at least 1 element")];switch(S=S.concat(ks({key:`${u}[0]`,value:n[0],valueSpec:m.filter_operator,style:o.style,styleSpec:o.styleSpec})),fi(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&fi(n[1])==="$type"&&S.push(new ct(u,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&S.push(new ct(u,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(v=$n(n[1]),v!=="string"&&S.push(new ct(`${u}[1]`,n[1],`string expected, ${v} found`)));for(let T=2;T<n.length;T++)v=$n(n[T]),fi(n[1])==="$type"?S=S.concat(ks({key:`${u}[${T}]`,value:n[T],valueSpec:m.geometry_type,style:o.style,styleSpec:o.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new ct(`${u}[${T}]`,n[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<n.length;T++)S=S.concat(pu({key:`${u}[${T}]`,value:n[T],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":v=$n(n[1]),n.length!==2?S.push(new ct(u,n,`filter array for "${n[0]}" operator must have 2 elements`)):v!=="string"&&S.push(new ct(`${u}[1]`,n[1],`string expected, ${v} found`))}return S}function Tc(o,n){const u=o.key,m=o.validateSpec,v=o.style,S=o.styleSpec,T=o.value,A=o.objectKey,R=S[`${n}_${o.layerType}`];if(!R)return[];const O=A.match(/^(.*)-transition$/);if(n==="paint"&&O&&R[O[1]]&&R[O[1]].transition)return m({key:u,value:T,valueSpec:S.transition,style:v,styleSpec:S});const j=o.valueSpec||R[A];if(!j)return[new ct(u,T,`unknown property "${A}"`)];let G;if($n(T)==="string"&&Eo(j)&&!j.tokens&&(G=/^{([^}]+)}$/.exec(T)))return[new ct(u,T,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const X=[];return o.layerType==="symbol"&&(A==="text-field"&&v&&!v.glyphs&&X.push(new ct(u,T,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Gs(Ar(T))&&fi(T.type)==="identity"&&X.push(new ct(u,T,'"text-font" does not support identity functions'))),X.concat(m({key:o.key,value:T,valueSpec:j,style:v,styleSpec:S,expressionContext:"property",propertyType:n,propertyKey:A}))}function mu(o){return Tc(o,"paint")}function Cc(o){return Tc(o,"layout")}function Lc(o){let n=[];const u=o.value,m=o.key,v=o.style,S=o.styleSpec;u.type||u.ref||n.push(new ct(m,u,'either "type" or "ref" is required'));let T=fi(u.type);const A=fi(u.ref);if(u.id){const R=fi(u.id);for(let O=0;O<o.arrayIndex;O++){const j=v.layers[O];fi(j.id)===R&&n.push(new ct(m,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(O=>{O in u&&n.push(new ct(m,u[O],`"${O}" is prohibited for ref layers`))}),v.layers.forEach(O=>{fi(O.id)===A&&(R=O)}),R?R.ref?n.push(new ct(m,u.ref,"ref cannot reference another ref layer")):T=fi(R.type):n.push(new ct(m,u.ref,`ref layer "${A}" not found`))}else if(T!=="background")if(u.source){const R=v.sources&&v.sources[u.source],O=R&&fi(R.type);R?O==="vector"&&T==="raster"?n.push(new ct(m,u.source,`layer "${u.id}" requires a raster source`)):O!=="raster-dem"&&T==="hillshade"?n.push(new ct(m,u.source,`layer "${u.id}" requires a raster-dem source`)):O==="raster"&&T!=="raster"?n.push(new ct(m,u.source,`layer "${u.id}" requires a vector source`)):O!=="vector"||u["source-layer"]?O==="raster-dem"&&T!=="hillshade"?n.push(new ct(m,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||O==="geojson"&&R.lineMetrics||n.push(new ct(m,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new ct(m,u,`layer "${u.id}" must specify a "source-layer"`)):n.push(new ct(m,u.source,`source "${u.source}" not found`))}else n.push(new ct(m,u,'missing required property "source"'));return n=n.concat(dr({key:m,value:u,valueSpec:S.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${m}.type`,value:u.type,valueSpec:S.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:u,objectKey:"type"}),filter:Ec,layout:R=>dr({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":O=>Cc(gr({layerType:T},O))}}),paint:R=>dr({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":O=>mu(gr({layerType:T},O))}})}})),n}function wa(o){const n=o.value,u=o.key,m=$n(n);return m!=="string"?[new ct(u,n,`string expected, ${m} found`)]:[]}const gu={promoteId:function({key:o,value:n}){if($n(n)==="string")return wa({key:o,value:n});{const u=[];for(const m in n)u.push(...wa({key:`${o}.${m}`,value:n[m]}));return u}}};function Ul(o){const n=o.value,u=o.key,m=o.styleSpec,v=o.style,S=o.validateSpec;if(!n.type)return[new ct(u,n,'"type" is required')];const T=fi(n.type);let A;switch(T){case"vector":case"raster":return A=dr({key:u,value:n,valueSpec:m[`source_${T.replace("-","_")}`],style:o.style,styleSpec:m,objectElementValidators:gu,validateSpec:S}),A;case"raster-dem":return A=function(R){var O;const j=(O=R.sourceName)!==null&&O!==void 0?O:"",G=R.value,X=R.styleSpec,ee=X.source_raster_dem,se=R.style;let pe=[];const Le=$n(G);if(G===void 0)return pe;if(Le!=="object")return pe.push(new ct("source_raster_dem",G,`object expected, ${Le} found`)),pe;const De=fi(G.encoding)==="custom",tt=["redFactor","greenFactor","blueFactor","baseShift"],Ge=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Qe in G)!De&&tt.includes(Qe)?pe.push(new ct(Qe,G[Qe],`In "${j}": "${Qe}" is only valid when "encoding" is set to "custom". ${Ge} encoding found`)):ee[Qe]?pe=pe.concat(R.validateSpec({key:Qe,value:G[Qe],valueSpec:ee[Qe],validateSpec:R.validateSpec,style:se,styleSpec:X})):pe.push(new ct(Qe,G[Qe],`unknown property "${Qe}"`));return pe}({sourceName:u,value:n,style:o.style,styleSpec:m,validateSpec:S}),A;case"geojson":if(A=dr({key:u,value:n,valueSpec:m.source_geojson,style:v,styleSpec:m,validateSpec:S,objectElementValidators:gu}),n.cluster)for(const R in n.clusterProperties){const[O,j]=n.clusterProperties[R],G=typeof O=="string"?[O,["accumulated"],["get",R]]:O;A.push(...lo({key:`${u}.${R}.map`,value:j,validateSpec:S,expressionContext:"cluster-map"})),A.push(...lo({key:`${u}.${R}.reduce`,value:G,validateSpec:S,expressionContext:"cluster-reduce"}))}return A;case"video":return dr({key:u,value:n,valueSpec:m.source_video,style:v,validateSpec:S,styleSpec:m});case"image":return dr({key:u,value:n,valueSpec:m.source_image,style:v,validateSpec:S,styleSpec:m});case"canvas":return[new ct(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ks({key:`${u}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:S,styleSpec:m})}}function Mc(o){const n=o.value,u=o.styleSpec,m=u.light,v=o.style;let S=[];const T=$n(n);if(n===void 0)return S;if(T!=="object")return S=S.concat([new ct("light",n,`object expected, ${T} found`)]),S;for(const A in n){const R=A.match(/^(.*)-transition$/);S=S.concat(R&&m[R[1]]&&m[R[1]].transition?o.validateSpec({key:A,value:n[A],valueSpec:u.transition,validateSpec:o.validateSpec,style:v,styleSpec:u}):m[A]?o.validateSpec({key:A,value:n[A],valueSpec:m[A],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(A,n[A],`unknown property "${A}"`)])}return S}function Ac(o){const n=o.value,u=o.styleSpec,m=u.sky,v=o.style,S=$n(n);if(n===void 0)return[];if(S!=="object")return[new ct("sky",n,`object expected, ${S} found`)];let T=[];for(const A in n)T=T.concat(m[A]?o.validateSpec({key:A,value:n[A],valueSpec:m[A],style:v,styleSpec:u}):[new ct(A,n[A],`unknown property "${A}"`)]);return T}function Pc(o){const n=o.value,u=o.styleSpec,m=u.terrain,v=o.style;let S=[];const T=$n(n);if(n===void 0)return S;if(T!=="object")return S=S.concat([new ct("terrain",n,`object expected, ${T} found`)]),S;for(const A in n)S=S.concat(m[A]?o.validateSpec({key:A,value:n[A],valueSpec:m[A],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(A,n[A],`unknown property "${A}"`)]);return S}function Rc(o){let n=[];const u=o.value,m=o.key;if(Array.isArray(u)){const v=[],S=[];for(const T in u)u[T].id&&v.includes(u[T].id)&&n.push(new ct(m,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),v.push(u[T].id),u[T].url&&S.includes(u[T].url)&&n.push(new ct(m,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),S.push(u[T].url),n=n.concat(dr({key:`${m}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return n}return wa({key:m,value:u})}const _u={"*":()=>[],array:Rs,boolean:function(o){const n=o.value,u=o.key,m=$n(n);return m!=="boolean"?[new ct(u,n,`boolean expected, ${m} found`)]:[]},number:Xa,color:function(o){const n=o.key,u=o.value,m=$n(u);return m!=="string"?[new ct(n,u,`color expected, ${m} found`)]:Qn.parse(String(u))?[]:[new ct(n,u,`color expected, "${u}" found`)]},constants:Ps,enum:ks,filter:Ec,function:xa,layer:Lc,object:dr,source:Ul,light:Mc,sky:Ac,terrain:Pc,projection:function(o){const n=o.value,u=o.styleSpec,m=u.projection,v=o.style,S=$n(n);if(n===void 0)return[];if(S!=="object")return[new ct("projection",n,`object expected, ${S} found`)];let T=[];for(const A in n)T=T.concat(m[A]?o.validateSpec({key:A,value:n[A],valueSpec:m[A],style:v,styleSpec:u}):[new ct(A,n[A],`unknown property "${A}"`)]);return T},string:wa,formatted:function(o){return wa(o).length===0?[]:lo(o)},resolvedImage:function(o){return wa(o).length===0?[]:lo(o)},padding:function(o){const n=o.key,u=o.value;if($n(u)==="array"){if(u.length<1||u.length>4)return[new ct(n,u,`padding requires 1 to 4 values; ${u.length} values found`)];const m={type:"number"};let v=[];for(let S=0;S<u.length;S++)v=v.concat(o.validateSpec({key:`${n}[${S}]`,value:u[S],validateSpec:o.validateSpec,valueSpec:m}));return v}return Xa({key:n,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const n=o.key,u=o.value,m=$n(u),v=o.styleSpec;if(m!=="array"||u.length<1||u.length%2!=0)return[new ct(n,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let T=0;T<u.length;T+=2)S=S.concat(ks({key:`${n}[${T}]`,value:u[T],valueSpec:v.layout_symbol["text-anchor"]})),S=S.concat(Rs({key:`${n}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:v}));return S},sprite:Rc};function $a(o){const n=o.value,u=o.valueSpec,m=o.styleSpec;return o.validateSpec=$a,u.expression&&Gs(fi(n))?xa(o):u.expression&&b(Ar(n))?lo(o):u.type&&_u[u.type]?_u[u.type](o):dr(gr({},o,{valueSpec:u.type?m[u.type]:u}))}function Bh(o){const n=o.value,u=o.key,m=wa(o);return m.length||(n.indexOf("{fontstack}")===-1&&m.push(new ct(u,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&m.push(new ct(u,n,'"glyphs" url must include a "{range}" token'))),m}function Ds(o,n=Ye){let u=[];return u=u.concat($a({key:"",value:o,valueSpec:n.$root,styleSpec:n,style:o,validateSpec:$a,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),o.constants&&(u=u.concat(Ps({key:"constants",value:o.constants,style:o,styleSpec:n,validateSpec:$a}))),Dc(u)}function uo(o){return function(n){return o({...n,validateSpec:$a})}}function Dc(o){return[].concat(o).sort((n,u)=>n.line-u.line)}function Zs(o){return function(...n){return Dc(o.apply(this,n))}}Ds.source=Zs(uo(Ul)),Ds.sprite=Zs(uo(Rc)),Ds.glyphs=Zs(uo(Bh)),Ds.light=Zs(uo(Mc)),Ds.sky=Zs(uo(Ac)),Ds.terrain=Zs(uo(Pc)),Ds.layer=Zs(uo(Lc)),Ds.filter=Zs(uo(Ec)),Ds.paintProperty=Zs(uo(mu)),Ds.layoutProperty=Zs(uo(Cc));const ka=Ds,od=ka.light,ad=ka.sky,Uh=ka.paintProperty,jh=ka.layoutProperty;function Nc(o,n){let u=!1;if(n&&n.length)for(const m of n)o.fire(new Je(new Error(m.message))),u=!0;return u}class Ya{constructor(n,u,m){const v=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const T=new Int32Array(this.arrayBuffer);n=T[0],this.d=(u=T[1])+2*(m=T[2]);for(let R=0;R<this.d*this.d;R++){const O=T[3+R],j=T[3+R+1];v.push(O===j?null:T.subarray(O,j))}const A=T[3+v.length+1];this.keys=T.subarray(T[3+v.length],A),this.bboxes=T.subarray(A),this.insert=this._insertReadonly}else{this.d=u+2*m;for(let T=0;T<this.d*this.d;T++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=n,this.padding=m,this.scale=u/n,this.uid=0;const S=m/u*n;this.min=-S,this.max=n+S}insert(n,u,m,v,S){this._forEachCell(u,m,v,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,u,m,v,S,T){this.cells[S].push(T)}query(n,u,m,v,S){const T=this.min,A=this.max;if(n<=T&&u<=T&&A<=m&&A<=v&&!S)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(n,u,m,v,this._queryCell,R,{},S),R}}_queryCell(n,u,m,v,S,T,A,R){const O=this.cells[S];if(O!==null){const j=this.keys,G=this.bboxes;for(let X=0;X<O.length;X++){const ee=O[X];if(A[ee]===void 0){const se=4*ee;(R?R(G[se+0],G[se+1],G[se+2],G[se+3]):n<=G[se+2]&&u<=G[se+3]&&m>=G[se+0]&&v>=G[se+1])?(A[ee]=!0,T.push(j[ee])):A[ee]=!1}}}}_forEachCell(n,u,m,v,S,T,A,R){const O=this._convertToCellCoord(n),j=this._convertToCellCoord(u),G=this._convertToCellCoord(m),X=this._convertToCellCoord(v);for(let ee=O;ee<=G;ee++)for(let se=j;se<=X;se++){const pe=this.d*se+ee;if((!R||R(this._convertFromCellCoord(ee),this._convertFromCellCoord(se),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(se+1)))&&S.call(this,n,u,m,v,pe,T,A,R))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,u=3+this.cells.length+1+1;let m=0;for(let T=0;T<this.cells.length;T++)m+=this.cells[T].length;const v=new Int32Array(u+m+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let S=u;for(let T=0;T<n.length;T++){const A=n[T];v[3+T]=S,v.set(A,S),S+=A.length}return v[3+n.length]=S,v.set(this.keys,S),S+=this.keys.length,v[3+n.length+1]=S,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer}static serialize(n,u){const m=n.toArrayBuffer();return u&&u.push(m),{buffer:m}}static deserialize(n){return new Ya(n.buffer)}}const Ns={};function Qt(o,n,u={}){if(Ns[o])throw new Error(`${o} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:o,writeable:!1}),Ns[o]={klass:n,omit:u.omit||[],shallow:u.shallow||[]}}Qt("Object",Object),Qt("TransferableGridIndex",Ya),Qt("Color",Qn),Qt("Error",Error),Qt("AJAXError",Rn),Qt("ResolvedImage",or),Qt("StylePropertyFunction",me),Qt("StyleExpression",p,{omit:["_evaluator"]}),Qt("ZoomDependentExpression",q),Qt("ZoomConstantExpression",F),Qt("CompoundExpression",is,{omit:["_evaluate"]});for(const o in Ho)Ho[o]._classRegistryKey||Qt(`Expression_${o}`,Ho[o]);function yu(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function zc(o){return o.$name||o.constructor._classRegistryKey}function Vh(o){return!function(n){if(n===null||typeof n!="object")return!1;const u=zc(n);return!(!u||u==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||yu(o)||dt(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Ja(o,n){if(Vh(o))return(yu(o)||dt(o))&&n&&n.push(o),ArrayBuffer.isView(o)&&n&&n.push(o.buffer),o instanceof ImageData&&n&&n.push(o.data.buffer),o;if(Array.isArray(o)){const S=[];for(const T of o)S.push(Ja(T,n));return S}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const u=zc(o);if(!u)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Ns[u])throw new Error(`${u} is not registered.`);const{klass:m}=Ns[u],v=m.serialize?m.serialize(o,n):{};if(m.serialize){if(n&&v===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in o){if(!o.hasOwnProperty(S)||Ns[u].omit.indexOf(S)>=0)continue;const T=o[S];v[S]=Ns[u].shallow.indexOf(S)>=0?T:Ja(T,n)}o instanceof Error&&(v.message=o.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(v.$name=u),v}function Ka(o){if(Vh(o))return o;if(Array.isArray(o))return o.map(Ka);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const n=zc(o)||"Object";if(!Ns[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:u}=Ns[n];if(!u)throw new Error(`can't deserialize unregistered class ${n}`);if(u.deserialize)return u.deserialize(o);const m=Object.create(u.prototype);for(const v of Object.keys(o)){if(v==="$name")continue;const S=o[v];m[v]=Ns[n].shallow.indexOf(v)>=0?S:Ka(S)}return m}class Oc{constructor(){this.first=!0}update(n,u){const m=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=u),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=m,!0))}}const qn={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Fc(o){for(const n of o)if(Uc(n.charCodeAt(0)))return!0;return!1}function ld(o){for(const n of o)if(!Qa(n.charCodeAt(0)))return!1;return!0}function Bc(o){const n=o.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(n.join("|"),"u")}const ud=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qa(o){return!ud.test(String.fromCodePoint(o))}const qh=Bc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Uc(o){return!(o!==746&&o!==747&&(o<4352||!(qn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||qn["CJK Compatibility"](o)||qn["CJK Strokes"](o)||!(!qn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||qn["Enclosed CJK Letters and Months"](o)||qn["Ideographic Description Characters"](o)||qn.Kanbun(o)||qn.Katakana(o)&&o!==12540||!(!qn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!qn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||qn["Vertical Forms"](o)||qn["Yijing Hexagram Symbols"](o)||/\p{sc=Cans}/u.test(String.fromCodePoint(o))||/\p{sc=Hang}/u.test(String.fromCodePoint(o))||qh.test(String.fromCodePoint(o)))))}function Gh(o){return!(Uc(o)||function(n){return!!(qn["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||qn["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||qn["Letterlike Symbols"](n)||qn["Number Forms"](n)||qn["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||qn["Control Pictures"](n)&&n!==9251||qn["Optical Character Recognition"](n)||qn["Enclosed Alphanumerics"](n)||qn["Geometric Shapes"](n)||qn["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||qn["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||qn["CJK Symbols and Punctuation"](n)||qn.Katakana(n)||qn["Private Use Area"](n)||qn["CJK Compatibility Forms"](n)||qn["Small Form Variants"](n)||qn["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(o))}const cd=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function jc(o){return cd.test(String.fromCodePoint(o))}function hd(o,n){return!(!n&&jc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||qn.Khmer(o))}function fd(o){for(const n of o)if(jc(n.charCodeAt(0)))return!0;return!1}const Is=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ii{constructor(n,u){this.zoom=n,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Oc,this.transition={})}isSupportedScript(n){return function(u,m){for(const v of u)if(!hd(v.charCodeAt(0),m))return!1;return!0}(n,Is.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,u=n-Math.floor(n),m=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*u}}}class el{constructor(n,u){this.property=n,this.value=u,this.expression=function(m,v){if(Gs(m))return new me(m,v);if(b(m)){const S=Y(m,v);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));return S.value}{let S=m;return v.type==="color"&&typeof m=="string"?S=Qn.parse(m):v.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(S=Pi.parse(m)):S=Dr.parse(m),{kind:"constant",evaluate:()=>S}}}(u===void 0?n.specification.default:u,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,u,m){return this.property.possiblyEvaluate(this,n,u,m)}}class vu{constructor(n){this.property=n,this.value=new el(n,void 0)}transitioned(n,u){return new Zh(this.property,this.value,u,ue({},n.transition,this.transition),n.now)}untransitioned(){return new Zh(this.property,this.value,null,{},0)}}class bu{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return we(this._values[n].value.value)}setValue(n,u){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new vu(this._values[n].property)),this._values[n].value=new el(this._values[n].property,u===null?void 0:we(u))}getTransition(n){return we(this._values[n].transition)}setTransition(n,u){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new vu(this._values[n].property)),this._values[n].transition=we(u)||void 0}serialize(){const n={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(n[u]=m);const v=this.getTransition(u);v!==void 0&&(n[`${u}-transition`]=v)}return n}transitioned(n,u){const m=new jl(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].transitioned(n,u._values[v]);return m}untransitioned(){const n=new jl(this._properties);for(const u of Object.keys(this._values))n._values[u]=this._values[u].untransitioned();return n}}class Zh{constructor(n,u,m,v,S){this.property=n,this.value=u,this.begin=S+v.delay||0,this.end=this.begin+v.duration||0,n.specification.transition&&(v.delay||v.duration)&&(this.prior=m)}possiblyEvaluate(n,u,m){const v=n.now||0,S=this.value.possiblyEvaluate(n,u,m),T=this.prior;if(T){if(v>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(v<this.begin)return T.possiblyEvaluate(n,u,m);{const A=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(n,u,m),S,function(R){if(R<=0)return 0;if(R>=1)return 1;const O=R*R,j=O*R;return 4*(R<.5?j:3*(R-O)+j-.75)}(A))}}return S}}class jl{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,u,m){const v=new ql(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(n,u,m);return v}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Vl{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return we(this._values[n].value)}setValue(n,u){this._values[n]=new el(this._values[n].property,u===null?void 0:we(u))}serialize(){const n={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(n[u]=m)}return n}possiblyEvaluate(n,u,m){const v=new ql(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(n,u,m);return v}}class co{constructor(n,u,m){this.property=n,this.value=u,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,u,m,v){return this.property.evaluate(this.value,this.parameters,n,u,m,v)}}class ql{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class nn{constructor(n){this.specification=n}possiblyEvaluate(n,u){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(u)}interpolate(n,u,m){const v=bi[this.specification.type];return v?v(n,u,m):n}}class vn{constructor(n,u){this.specification=n,this.overrides=u}possiblyEvaluate(n,u,m,v){return new co(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(u,null,{},m,v)}:n.expression,u)}interpolate(n,u,m){if(n.value.kind!=="constant"||u.value.kind!=="constant")return n;if(n.value.value===void 0||u.value.value===void 0)return new co(this,{kind:"constant",value:void 0},n.parameters);const v=bi[this.specification.type];if(v){const S=v(n.value.value,u.value.value,m);return new co(this,{kind:"constant",value:S},n.parameters)}return n}evaluate(n,u,m,v,S,T){return n.kind==="constant"?n.value:n.evaluate(u,m,v,S,T)}}class xu extends vn{possiblyEvaluate(n,u,m,v){if(n.value===void 0)return new co(this,{kind:"constant",value:void 0},u);if(n.expression.kind==="constant"){const S=n.expression.evaluate(u,null,{},m,v),T=n.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,A=this._calculate(T,T,T,u);return new co(this,{kind:"constant",value:A},u)}if(n.expression.kind==="camera"){const S=this._calculate(n.expression.evaluate({zoom:u.zoom-1}),n.expression.evaluate({zoom:u.zoom}),n.expression.evaluate({zoom:u.zoom+1}),u);return new co(this,{kind:"constant",value:S},u)}return new co(this,n.expression,u)}evaluate(n,u,m,v,S,T){if(n.kind==="source"){const A=n.evaluate(u,m,v,S,T);return this._calculate(A,A,A,u)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(u.zoom)-1},m,v),n.evaluate({zoom:Math.floor(u.zoom)},m,v),n.evaluate({zoom:Math.floor(u.zoom)+1},m,v),u):n.value}_calculate(n,u,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:n,to:u}:{from:m,to:u}}interpolate(n){return n}}class wu{constructor(n){this.specification=n}possiblyEvaluate(n,u,m,v){if(n.value!==void 0){if(n.expression.kind==="constant"){const S=n.expression.evaluate(u,null,{},m,v);return this._calculate(S,S,S,u)}return this._calculate(n.expression.evaluate(new Ii(Math.floor(u.zoom-1),u)),n.expression.evaluate(new Ii(Math.floor(u.zoom),u)),n.expression.evaluate(new Ii(Math.floor(u.zoom+1),u)),u)}}_calculate(n,u,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:n,to:u}:{from:m,to:u}}interpolate(n){return n}}class Vc{constructor(n){this.specification=n}possiblyEvaluate(n,u,m,v){return!!n.expression.evaluate(u,null,{},m,v)}interpolate(){return!1}}class k{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in n){const m=n[u];m.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new el(m,void 0),S=this.defaultTransitionablePropertyValues[u]=new vu(m);this.defaultTransitioningPropertyValues[u]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate({})}}}Qt("DataDrivenProperty",vn),Qt("DataConstantProperty",nn),Qt("CrossFadedDataDrivenProperty",xu),Qt("CrossFadedProperty",wu),Qt("ColorRampProperty",Vc);const t="-transition";class h extends Lt{constructor(n,u){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),u.layout&&(this._unevaluatedLayout=new Vl(u.layout)),u.paint)){this._transitionablePaint=new bu(u.paint);for(const m in n.paint)this.setPaintProperty(m,n.paint[m],{validate:!1});for(const m in n.layout)this.setLayoutProperty(m,n.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ql(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,u,m={}){u!=null&&this._validate(jh,`layers.${this.id}.layout.${n}`,n,u,m)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,u):this.visibility=u)}getPaintProperty(n){return n.endsWith(t)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,u,m={}){if(u!=null&&this._validate(Uh,`layers.${this.id}.paint.${n}`,n,u,m))return!1;if(n.endsWith(t))return this._transitionablePaint.setTransition(n.slice(0,-11),u||void 0),!1;{const v=this._transitionablePaint._values[n],S=v.property.specification["property-type"]==="cross-faded-data-driven",T=v.value.isDataDriven(),A=v.value;this._transitionablePaint.setValue(n,u),this._handleSpecialPaintPropertyUpdate(n);const R=this._transitionablePaint._values[n].value;return R.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(n,A,R)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,u,m){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,u){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,u)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Te(n,(u,m)=>!(u===void 0||m==="layout"&&!Object.keys(u).length||m==="paint"&&!Object.keys(u).length))}_validate(n,u,m,v,S={}){return(!S||S.validate!==!1)&&Nc(this,n.call(ka,{key:u,layerType:this.type,objectKey:m,value:v,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const u=this.paint.get(n);if(u instanceof co&&Eo(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const _={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class y{constructor(n,u){this._structArray=n,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class w{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,u){return n._trim(),u&&(n.isTransferred=!0,u.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const u=Object.create(this.prototype);return u.arrayBuffer=n.arrayBuffer,u.length=n.length,u.capacity=n.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function P(o,n=1){let u=0,m=0;return{members:o.map(v=>{const S=_[v.type].BYTES_PER_ELEMENT,T=u=D(u,Math.max(n,S)),A=v.components||1;return m=Math.max(m,S),u+=S*A,{name:v.name,type:v.type,components:A,offset:T}}),size:D(u,Math.max(m,n)),alignment:n}}function D(o,n){return Math.ceil(o/n)*n}class z extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u){const m=this.length;return this.resize(m+1),this.emplace(m,n,u)}emplace(n,u,m){const v=2*n;return this.int16[v+0]=u,this.int16[v+1]=m,n}}z.prototype.bytesPerElement=4,Qt("StructArrayLayout2i4",z);class V extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,u,m)}emplace(n,u,m,v){const S=3*n;return this.int16[S+0]=u,this.int16[S+1]=m,this.int16[S+2]=v,n}}V.prototype.bytesPerElement=6,Qt("StructArrayLayout3i6",V);class H extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,u,m,v)}emplace(n,u,m,v,S){const T=4*n;return this.int16[T+0]=u,this.int16[T+1]=m,this.int16[T+2]=v,this.int16[T+3]=S,n}}H.prototype.bytesPerElement=8,Qt("StructArrayLayout4i8",H);class W extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,n,u,m,v,S,T)}emplace(n,u,m,v,S,T,A){const R=6*n;return this.int16[R+0]=u,this.int16[R+1]=m,this.int16[R+2]=v,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=A,n}}W.prototype.bytesPerElement=12,Qt("StructArrayLayout2i4i12",W);class ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,n,u,m,v,S,T)}emplace(n,u,m,v,S,T,A){const R=4*n,O=8*n;return this.int16[R+0]=u,this.int16[R+1]=m,this.uint8[O+4]=v,this.uint8[O+5]=S,this.uint8[O+6]=T,this.uint8[O+7]=A,n}}ne.prototype.bytesPerElement=8,Qt("StructArrayLayout2i4ub8",ne);class ge extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,u){const m=this.length;return this.resize(m+1),this.emplace(m,n,u)}emplace(n,u,m){const v=2*n;return this.float32[v+0]=u,this.float32[v+1]=m,n}}ge.prototype.bytesPerElement=8,Qt("StructArrayLayout2f8",ge);class ke extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T,A,R,O,j){const G=this.length;return this.resize(G+1),this.emplace(G,n,u,m,v,S,T,A,R,O,j)}emplace(n,u,m,v,S,T,A,R,O,j,G){const X=10*n;return this.uint16[X+0]=u,this.uint16[X+1]=m,this.uint16[X+2]=v,this.uint16[X+3]=S,this.uint16[X+4]=T,this.uint16[X+5]=A,this.uint16[X+6]=R,this.uint16[X+7]=O,this.uint16[X+8]=j,this.uint16[X+9]=G,n}}ke.prototype.bytesPerElement=20,Qt("StructArrayLayout10ui20",ke);class Me extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T,A,R,O,j,G,X){const ee=this.length;return this.resize(ee+1),this.emplace(ee,n,u,m,v,S,T,A,R,O,j,G,X)}emplace(n,u,m,v,S,T,A,R,O,j,G,X,ee){const se=12*n;return this.int16[se+0]=u,this.int16[se+1]=m,this.int16[se+2]=v,this.int16[se+3]=S,this.uint16[se+4]=T,this.uint16[se+5]=A,this.uint16[se+6]=R,this.uint16[se+7]=O,this.int16[se+8]=j,this.int16[se+9]=G,this.int16[se+10]=X,this.int16[se+11]=ee,n}}Me.prototype.bytesPerElement=24,Qt("StructArrayLayout4i4ui4i24",Me);class Ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,u,m)}emplace(n,u,m,v){const S=3*n;return this.float32[S+0]=u,this.float32[S+1]=m,this.float32[S+2]=v,n}}Ne.prototype.bytesPerElement=12,Qt("StructArrayLayout3f12",Ne);class Oe extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const u=this.length;return this.resize(u+1),this.emplace(u,n)}emplace(n,u){return this.uint32[1*n+0]=u,n}}Oe.prototype.bytesPerElement=4,Qt("StructArrayLayout1ul4",Oe);class qe extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T,A,R,O){const j=this.length;return this.resize(j+1),this.emplace(j,n,u,m,v,S,T,A,R,O)}emplace(n,u,m,v,S,T,A,R,O,j){const G=10*n,X=5*n;return this.int16[G+0]=u,this.int16[G+1]=m,this.int16[G+2]=v,this.int16[G+3]=S,this.int16[G+4]=T,this.int16[G+5]=A,this.uint32[X+3]=R,this.uint16[G+8]=O,this.uint16[G+9]=j,n}}qe.prototype.bytesPerElement=20,Qt("StructArrayLayout6i1ul2ui20",qe);class Ce extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,n,u,m,v,S,T)}emplace(n,u,m,v,S,T,A){const R=6*n;return this.int16[R+0]=u,this.int16[R+1]=m,this.int16[R+2]=v,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=A,n}}Ce.prototype.bytesPerElement=12,Qt("StructArrayLayout2i2i2i12",Ce);class Ze extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S){const T=this.length;return this.resize(T+1),this.emplace(T,n,u,m,v,S)}emplace(n,u,m,v,S,T){const A=4*n,R=8*n;return this.float32[A+0]=u,this.float32[A+1]=m,this.float32[A+2]=v,this.int16[R+6]=S,this.int16[R+7]=T,n}}Ze.prototype.bytesPerElement=16,Qt("StructArrayLayout2f1f2i16",Ze);class Ke extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,n,u,m,v,S,T)}emplace(n,u,m,v,S,T,A){const R=16*n,O=4*n,j=8*n;return this.uint8[R+0]=u,this.uint8[R+1]=m,this.float32[O+1]=v,this.float32[O+2]=S,this.int16[j+6]=T,this.int16[j+7]=A,n}}Ke.prototype.bytesPerElement=16,Qt("StructArrayLayout2ub2f2i16",Ke);class it extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,u,m)}emplace(n,u,m,v){const S=3*n;return this.uint16[S+0]=u,this.uint16[S+1]=m,this.uint16[S+2]=v,n}}it.prototype.bytesPerElement=6,Qt("StructArrayLayout3ui6",it);class bt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T,A,R,O,j,G,X,ee,se,pe,Le,De){const tt=this.length;return this.resize(tt+1),this.emplace(tt,n,u,m,v,S,T,A,R,O,j,G,X,ee,se,pe,Le,De)}emplace(n,u,m,v,S,T,A,R,O,j,G,X,ee,se,pe,Le,De,tt){const Ge=24*n,Qe=12*n,ht=48*n;return this.int16[Ge+0]=u,this.int16[Ge+1]=m,this.uint16[Ge+2]=v,this.uint16[Ge+3]=S,this.uint32[Qe+2]=T,this.uint32[Qe+3]=A,this.uint32[Qe+4]=R,this.uint16[Ge+10]=O,this.uint16[Ge+11]=j,this.uint16[Ge+12]=G,this.float32[Qe+7]=X,this.float32[Qe+8]=ee,this.uint8[ht+36]=se,this.uint8[ht+37]=pe,this.uint8[ht+38]=Le,this.uint32[Qe+10]=De,this.int16[Ge+22]=tt,n}}bt.prototype.bytesPerElement=48,Qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bt);class Rt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,u,m,v,S,T,A,R,O,j,G,X,ee,se,pe,Le,De,tt,Ge,Qe,ht,Et,$t,yn,Wt,Zt,on,tn){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,n,u,m,v,S,T,A,R,O,j,G,X,ee,se,pe,Le,De,tt,Ge,Qe,ht,Et,$t,yn,Wt,Zt,on,tn)}emplace(n,u,m,v,S,T,A,R,O,j,G,X,ee,se,pe,Le,De,tt,Ge,Qe,ht,Et,$t,yn,Wt,Zt,on,tn,Kt){const yt=32*n,cn=16*n;return this.int16[yt+0]=u,this.int16[yt+1]=m,this.int16[yt+2]=v,this.int16[yt+3]=S,this.int16[yt+4]=T,this.int16[yt+5]=A,this.int16[yt+6]=R,this.int16[yt+7]=O,this.uint16[yt+8]=j,this.uint16[yt+9]=G,this.uint16[yt+10]=X,this.uint16[yt+11]=ee,this.uint16[yt+12]=se,this.uint16[yt+13]=pe,this.uint16[yt+14]=Le,this.uint16[yt+15]=De,this.uint16[yt+16]=tt,this.uint16[yt+17]=Ge,this.uint16[yt+18]=Qe,this.uint16[yt+19]=ht,this.uint16[yt+20]=Et,this.uint16[yt+21]=$t,this.uint16[yt+22]=yn,this.uint32[cn+12]=Wt,this.float32[cn+13]=Zt,this.float32[cn+14]=on,this.uint16[yt+30]=tn,this.uint16[yt+31]=Kt,n}}Rt.prototype.bytesPerElement=64,Qt("StructArrayLayout8i15ui1ul2f2ui64",Rt);class Ht extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const u=this.length;return this.resize(u+1),this.emplace(u,n)}emplace(n,u){return this.float32[1*n+0]=u,n}}Ht.prototype.bytesPerElement=4,Qt("StructArrayLayout1f4",Ht);class Yt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,u,m)}emplace(n,u,m,v){const S=3*n;return this.uint16[6*n+0]=u,this.float32[S+1]=m,this.float32[S+2]=v,n}}Yt.prototype.bytesPerElement=12,Qt("StructArrayLayout1ui2f12",Yt);class jt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,u,m)}emplace(n,u,m,v){const S=4*n;return this.uint32[2*n+0]=u,this.uint16[S+2]=m,this.uint16[S+3]=v,n}}jt.prototype.bytesPerElement=8,Qt("StructArrayLayout1ul2ui8",jt);class Ut extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,u){const m=this.length;return this.resize(m+1),this.emplace(m,n,u)}emplace(n,u,m){const v=2*n;return this.uint16[v+0]=u,this.uint16[v+1]=m,n}}Ut.prototype.bytesPerElement=4,Qt("StructArrayLayout2ui4",Ut);class rn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const u=this.length;return this.resize(u+1),this.emplace(u,n)}emplace(n,u){return this.uint16[1*n+0]=u,n}}rn.prototype.bytesPerElement=2,Qt("StructArrayLayout1ui2",rn);class Tn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,u,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,u,m,v)}emplace(n,u,m,v,S){const T=4*n;return this.float32[T+0]=u,this.float32[T+1]=m,this.float32[T+2]=v,this.float32[T+3]=S,n}}Tn.prototype.bytesPerElement=16,Qt("StructArrayLayout4f16",Tn);class qt extends y{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new L(this.anchorPointX,this.anchorPointY)}}qt.prototype.size=20;class Xt extends qe{get(n){return new qt(this,n)}}Qt("CollisionBoxArray",Xt);class In extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}In.prototype.size=48;class Si extends bt{get(n){return new In(this,n)}}Qt("PlacedSymbolArray",Si);class On extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}On.prototype.size=64;class jn extends Rt{get(n){return new On(this,n)}}Qt("SymbolInstanceArray",jn);class Ei extends Ht{getoffsetX(n){return this.float32[1*n+0]}}Qt("GlyphOffsetArray",Ei);class Nr extends V{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Qt("SymbolLineVertexArray",Nr);class Hs extends y{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Hs.prototype.size=12;class Ti extends Yt{get(n){return new Hs(this,n)}}Qt("TextAnchorOffsetArray",Ti);class ss extends y{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ss.prototype.size=8;class Wr extends jt{get(n){return new ss(this,n)}}Qt("FeatureIndexArray",Wr);class zr extends z{}class Xr extends z{}class ho extends z{}class tl extends W{}class ku extends ne{}class nl extends ge{}class zs extends ke{}class Iu extends Me{}class qc extends Ne{}class Os extends Oe{}class Fs extends Ce{}class Qo extends Ke{}class Ws extends it{}class Pr extends Ut{}const Or=P([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ss}=Or;class Gn{constructor(n=[]){this.segments=n}prepareSegment(n,u,m,v){let S=this.segments[this.segments.length-1];return n>Gn.MAX_VERTEX_ARRAY_LENGTH&&ze(`Max vertices per segment is ${Gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!S||S.vertexLength+n>Gn.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==v)&&(S={vertexOffset:u.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},v!==void 0&&(S.sortKey=v),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const n of this.segments)for(const u in n.vaos)n.vaos[u].destroy()}static simpleSegment(n,u,m,v){return new Gn([{vertexOffset:n,primitiveOffset:u,vertexLength:m,primitiveLength:v,vaos:{},sortKey:0}])}}function Ia(o,n){return 256*(o=ve(Math.floor(o),0,255))+ve(Math.floor(n),0,255)}Gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt("SegmentVector",Gn);const il=P([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rl={exports:{}},Hh={exports:{}};Hh.exports=function(o,n){var u,m,v,S,T,A,R,O;for(m=o.length-(u=3&o.length),v=n,T=3432918353,A=461845907,O=0;O<m;)R=255&o.charCodeAt(O)|(255&o.charCodeAt(++O))<<8|(255&o.charCodeAt(++O))<<16|(255&o.charCodeAt(++O))<<24,++O,v=27492+(65535&(S=5*(65535&(v=(v^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(R=0,u){case 3:R^=(255&o.charCodeAt(O+2))<<16;case 2:R^=(255&o.charCodeAt(O+1))<<8;case 1:v^=R=(65535&(R=(R=(65535&(R^=255&o.charCodeAt(O)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var dd=Hh.exports,Wh={exports:{}};Wh.exports=function(o,n){for(var u,m=o.length,v=n^m,S=0;m>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(u>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:v^=(255&o.charCodeAt(S+2))<<16;case 2:v^=(255&o.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var ea=dd,Xh=Wh.exports;rl.exports=ea,rl.exports.murmur3=ea,rl.exports.murmur2=Xh;var Su=x(rl.exports);class Gl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,u,m,v){this.ids.push(Eu(n)),this.positions.push(u,m,v)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Eu(n);let m=0,v=this.ids.length-1;for(;m<v;){const T=m+v>>1;this.ids[T]>=u?v=T:m=T+1}const S=[];for(;this.ids[m]===u;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(n,u){const m=new Float64Array(n.ids),v=new Uint32Array(n.positions);return Tu(m,v,0,m.length-1),u&&u.push(m.buffer,v.buffer),{ids:m,positions:v}}static deserialize(n){const u=new Gl;return u.ids=n.ids,u.positions=n.positions,u.indexed=!0,u}}function Eu(o){const n=+o;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Su(String(o))}function Tu(o,n,u,m){for(;u<m;){const v=o[u+m>>1];let S=u-1,T=m+1;for(;;){do S++;while(o[S]<v);do T--;while(o[T]>v);if(S>=T)break;sl(o,S,T),sl(n,3*S,3*T),sl(n,3*S+1,3*T+1),sl(n,3*S+2,3*T+2)}T-u<m-T?(Tu(o,n,u,T),u=T+1):(Tu(o,n,T+1,m),m=T)}}function sl(o,n,u){const m=o[n];o[n]=o[u],o[u]=m}Qt("FeaturePositionMap",Gl);class Zl{constructor(n,u){this.gl=n.gl,this.location=u}}class $h extends Zl{constructor(n,u){super(n,u),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class rm extends Zl{constructor(n,u){super(n,u),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class sm extends Zl{constructor(n,u){super(n,u),this.current=Qn.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const Yv=new Float32Array(16);function pd(o){return[Ia(255*o.r,255*o.g),Ia(255*o.b,255*o.a)]}class Gc{constructor(n,u,m){this.value=n,this.uniformNames=u.map(v=>`u_${v}`),this.type=m}setUniform(n,u,m){n.set(m.constantOr(this.value))}getBinding(n,u,m){return this.type==="color"?new sm(n,u):new $h(n,u)}}class Cu{constructor(n,u){this.uniformNames=u.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=n.tlbr}setUniform(n,u,m,v){const S=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&n.set(S)}getBinding(n,u,m){return m.substr(0,9)==="u_pattern"?new rm(n,u):new $h(n,u)}}class Sa{constructor(n,u,m,v){this.expression=n,this.type=m,this.maxValue=0,this.paintVertexAttributes=u.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(n,u,m,v,S){const T=this.paintVertexArray.length,A=this.expression.evaluate(new Ii(0),u,{},v,[],S);this.paintVertexArray.resize(n),this._setPaintValue(T,n,A)}updatePaintArray(n,u,m,v){const S=this.expression.evaluate({zoom:0},m,v);this._setPaintValue(n,u,S)}_setPaintValue(n,u,m){if(this.type==="color"){const v=pd(m);for(let S=n;S<u;S++)this.paintVertexArray.emplace(S,v[0],v[1])}else{for(let v=n;v<u;v++)this.paintVertexArray.emplace(v,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class To{constructor(n,u,m,v,S,T){this.expression=n,this.uniformNames=u.map(A=>`u_${A}_t`),this.type=m,this.useIntegerZoom=v,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=u.map(A=>({name:`a_${A}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(n,u,m,v,S){const T=this.expression.evaluate(new Ii(this.zoom),u,{},v,[],S),A=this.expression.evaluate(new Ii(this.zoom+1),u,{},v,[],S),R=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(R,n,T,A)}updatePaintArray(n,u,m,v){const S=this.expression.evaluate({zoom:this.zoom},m,v),T=this.expression.evaluate({zoom:this.zoom+1},m,v);this._setPaintValue(n,u,S,T)}_setPaintValue(n,u,m,v){if(this.type==="color"){const S=pd(m),T=pd(v);for(let A=n;A<u;A++)this.paintVertexArray.emplace(A,S[0],S[1],T[0],T[1])}else{for(let S=n;S<u;S++)this.paintVertexArray.emplace(S,m,v);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(v))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,u){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=ve(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);n.set(v)}getBinding(n,u,m){return new $h(n,u)}}class ol{constructor(n,u,m,v,S,T){this.expression=n,this.type=u,this.useIntegerZoom=m,this.zoom=v,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(n,u,m){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(v,n,u.patterns&&u.patterns[this.layerId],m)}updatePaintArray(n,u,m,v,S){this._setPaintValues(n,u,m.patterns&&m.patterns[this.layerId],S)}_setPaintValues(n,u,m,v){if(!v||!m)return;const{min:S,mid:T,max:A}=m,R=v[S],O=v[T],j=v[A];if(R&&O&&j)for(let G=n;G<u;G++)this.zoomInPaintVertexArray.emplace(G,O.tl[0],O.tl[1],O.br[0],O.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],O.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,O.tl[0],O.tl[1],O.br[0],O.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],O.pixelRatio,j.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,il.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,il.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class om{constructor(n,u,m){this.binders={},this._buffers=[];const v=[];for(const S in n.paint._values){if(!m(S))continue;const T=n.paint.get(S);if(!(T instanceof co&&Eo(T.property.specification)))continue;const A=Jv(S,n.type),R=T.value,O=T.property.specification.type,j=T.property.useIntegerZoom,G=T.property.specification["property-type"],X=G==="cross-faded"||G==="cross-faded-data-driven";if(R.kind==="constant")this.binders[S]=X?new Cu(R.value,A):new Gc(R.value,A,O),v.push(`/u_${S}`);else if(R.kind==="source"||X){const ee=am(S,O,"source");this.binders[S]=X?new ol(R,O,j,u,ee,n.id):new Sa(R,A,O,ee),v.push(`/a_${S}`)}else{const ee=am(S,O,"composite");this.binders[S]=new To(R,A,O,j,u,ee),v.push(`/z_${S}`)}}this.cacheKey=v.sort().join("")}getMaxValue(n){const u=this.binders[n];return u instanceof Sa||u instanceof To?u.maxValue:0}populatePaintArrays(n,u,m,v,S){for(const T in this.binders){const A=this.binders[T];(A instanceof Sa||A instanceof To||A instanceof ol)&&A.populatePaintArray(n,u,m,v,S)}}setConstantPatternPositions(n,u){for(const m in this.binders){const v=this.binders[m];v instanceof Cu&&v.setConstantPatternPositions(n,u)}}updatePaintArrays(n,u,m,v,S){let T=!1;for(const A in n){const R=u.getPositions(A);for(const O of R){const j=m.feature(O.index);for(const G in this.binders){const X=this.binders[G];if((X instanceof Sa||X instanceof To||X instanceof ol)&&X.expression.isStateDependent===!0){const ee=v.paint.get(G);X.expression=ee.value,X.updatePaintArray(O.start,O.end,j,n[A],S),T=!0}}}}return T}defines(){const n=[];for(const u in this.binders){const m=this.binders[u];(m instanceof Gc||m instanceof Cu)&&n.push(...m.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return n}getBinderAttributes(){const n=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Sa||m instanceof To)for(let v=0;v<m.paintVertexAttributes.length;v++)n.push(m.paintVertexAttributes[v].name);else if(m instanceof ol)for(let v=0;v<il.members.length;v++)n.push(il.members[v].name)}return n}getBinderUniforms(){const n=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Gc||m instanceof Cu||m instanceof To)for(const v of m.uniformNames)n.push(v)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,u){const m=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof Gc||S instanceof Cu||S instanceof To){for(const T of S.uniformNames)if(u[T]){const A=S.getBinding(n,u[T],T);m.push({name:T,property:v,binding:A})}}}return m}setUniforms(n,u,m,v){for(const{name:S,property:T,binding:A}of u)this.binders[T].setUniform(A,v,m.get(T),S)}updatePaintBuffers(n){this._buffers=[];for(const u in this.binders){const m=this.binders[u];if(n&&m instanceof ol){const v=n.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(m instanceof Sa||m instanceof To)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(n){for(const u in this.binders){const m=this.binders[u];(m instanceof Sa||m instanceof To||m instanceof ol)&&m.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const u=this.binders[n];(u instanceof Sa||u instanceof To||u instanceof ol)&&u.destroy()}}}class Hl{constructor(n,u,m=()=>!0){this.programConfigurations={};for(const v of n)this.programConfigurations[v.id]=new om(v,u,m);this.needsUpload=!1,this._featureMap=new Gl,this._bufferOffset=0}populatePaintArrays(n,u,m,v,S,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(n,u,v,S,T);u.id!==void 0&&this._featureMap.add(u.id,m,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,u,m,v){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(n,this._featureMap,u,S,v)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Jv(o,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${n}-`,"").replace(/-/g,"_")]}function am(o,n,u){const m={color:{source:ge,composite:Tn},number:{source:Ht,composite:ge}},v=function(S){return{"line-pattern":{source:zs,composite:zs},"fill-pattern":{source:zs,composite:zs},"fill-extrusion-pattern":{source:zs,composite:zs}}[S]}(o);return v&&v[u]||m[n][u]}Qt("ConstantBinder",Gc),Qt("CrossFadedConstantBinder",Cu),Qt("SourceExpressionBinder",Sa),Qt("CrossFadedCompositeBinder",ol),Qt("CompositeExpressionBinder",To),Qt("ProgramConfiguration",om,{omit:["_buffers"]}),Qt("ProgramConfigurationSet",Hl);const ar=8192,md=Math.pow(2,14)-1,lm=-md-1;function Wl(o){const n=ar/o.extent,u=o.loadGeometry();for(let m=0;m<u.length;m++){const v=u[m];for(let S=0;S<v.length;S++){const T=v[S],A=Math.round(T.x*n),R=Math.round(T.y*n);T.x=ve(A,lm,md),T.y=ve(R,lm,md),(A<T.x||A>T.x+1||R<T.y||R>T.y+1)&&ze("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Xl(o,n){return{type:o.type,id:o.id,properties:o.properties,geometry:n?Wl(o):[]}}function Yh(o,n,u,m,v){o.emplaceBack(2*n+(m+1)/2,2*u+(v+1)/2)}class gd{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(u=>u.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Xr,this.indexArray=new Ws,this.segments=new Gn,this.programConfigurations=new Hl(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(n,u,m){const v=this.layers[0],S=[];let T=null,A=!1;v.type==="circle"&&(T=v.layout.get("circle-sort-key"),A=!T.isConstant());for(const{feature:R,id:O,index:j,sourceLayerIndex:G}of n){const X=this.layers[0]._featureFilter.needGeometry,ee=Xl(R,X);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),ee,m))continue;const se=A?T.evaluate(ee,{},m):void 0,pe={id:O,properties:R.properties,type:R.type,sourceLayerIndex:G,index:j,geometry:X?ee.geometry:Wl(R),patterns:{},sortKey:se};S.push(pe)}A&&S.sort((R,O)=>R.sortKey-O.sortKey);for(const R of S){const{geometry:O,index:j,sourceLayerIndex:G}=R,X=n[j].feature;this.addFeature(R,O,j,m),u.featureIndex.insert(X,O,j,G,this.index)}}update(n,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,u,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ss),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,u,m,v){for(const S of u)for(const T of S){const A=T.x,R=T.y;if(A<0||A>=ar||R<0||R>=ar)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),j=O.vertexLength;Yh(this.layoutVertexArray,A,R,-1,-1),Yh(this.layoutVertexArray,A,R,1,-1),Yh(this.layoutVertexArray,A,R,1,1),Yh(this.layoutVertexArray,A,R,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,{},v)}}function um(o,n){for(let u=0;u<o.length;u++)if(Lu(n,o[u]))return!0;for(let u=0;u<n.length;u++)if(Lu(o,n[u]))return!0;return!!_d(o,n)}function Kv(o,n,u){return!!Lu(o,n)||!!yd(n,o,u)}function cm(o,n){if(o.length===1)return fm(n,o[0]);for(let u=0;u<n.length;u++){const m=n[u];for(let v=0;v<m.length;v++)if(Lu(o,m[v]))return!0}for(let u=0;u<o.length;u++)if(fm(n,o[u]))return!0;for(let u=0;u<n.length;u++)if(_d(o,n[u]))return!0;return!1}function Qv(o,n,u){if(o.length>1){if(_d(o,n))return!0;for(let m=0;m<n.length;m++)if(yd(n[m],o,u))return!0}for(let m=0;m<o.length;m++)if(yd(o[m],n,u))return!0;return!1}function _d(o,n){if(o.length===0||n.length===0)return!1;for(let u=0;u<o.length-1;u++){const m=o[u],v=o[u+1];for(let S=0;S<n.length-1;S++)if(e1(m,v,n[S],n[S+1]))return!0}return!1}function e1(o,n,u,m){return Be(o,u,m)!==Be(n,u,m)&&Be(o,n,u)!==Be(o,n,m)}function yd(o,n,u){const m=u*u;if(n.length===1)return o.distSqr(n[0])<m;for(let v=1;v<n.length;v++)if(hm(o,n[v-1],n[v])<m)return!0;return!1}function hm(o,n,u){const m=n.distSqr(u);if(m===0)return o.distSqr(n);const v=((o.x-n.x)*(u.x-n.x)+(o.y-n.y)*(u.y-n.y))/m;return o.distSqr(v<0?n:v>1?u:u.sub(n)._mult(v)._add(n))}function fm(o,n){let u,m,v,S=!1;for(let T=0;T<o.length;T++){u=o[T];for(let A=0,R=u.length-1;A<u.length;R=A++)m=u[A],v=u[R],m.y>n.y!=v.y>n.y&&n.x<(v.x-m.x)*(n.y-m.y)/(v.y-m.y)+m.x&&(S=!S)}return S}function Lu(o,n){let u=!1;for(let m=0,v=o.length-1;m<o.length;v=m++){const S=o[m],T=o[v];S.y>n.y!=T.y>n.y&&n.x<(T.x-S.x)*(n.y-S.y)/(T.y-S.y)+S.x&&(u=!u)}return u}function t1(o,n,u){const m=u[0],v=u[2];if(o.x<m.x&&n.x<m.x||o.x>v.x&&n.x>v.x||o.y<m.y&&n.y<m.y||o.y>v.y&&n.y>v.y)return!1;const S=Be(o,n,u[0]);return S!==Be(o,n,u[1])||S!==Be(o,n,u[2])||S!==Be(o,n,u[3])}function Zc(o,n,u){const m=n.paint.get(o).value;return m.kind==="constant"?m.value:u.programConfigurations.get(n.id).getMaxValue(o)}function Jh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Kh(o,n,u,m,v){if(!n[0]&&!n[1])return o;const S=L.convert(n)._mult(v);u==="viewport"&&S._rotate(-m);const T=[];for(let A=0;A<o.length;A++)T.push(o[A].sub(S));return T}let dm,pm;Qt("CircleBucket",gd,{omit:["layers"]});var n1={get paint(){return pm=pm||new k({"circle-radius":new vn(Ye.paint_circle["circle-radius"]),"circle-color":new vn(Ye.paint_circle["circle-color"]),"circle-blur":new vn(Ye.paint_circle["circle-blur"]),"circle-opacity":new vn(Ye.paint_circle["circle-opacity"]),"circle-translate":new nn(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new nn(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nn(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nn(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vn(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vn(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vn(Ye.paint_circle["circle-stroke-opacity"])})},get layout(){return dm=dm||new k({"circle-sort-key":new vn(Ye.layout_circle["circle-sort-key"])})}},os=1e-6,Mu=typeof Float32Array<"u"?Float32Array:Array;function vd(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function mm(o,n,u){var m=n[0],v=n[1],S=n[2],T=n[3],A=n[4],R=n[5],O=n[6],j=n[7],G=n[8],X=n[9],ee=n[10],se=n[11],pe=n[12],Le=n[13],De=n[14],tt=n[15],Ge=u[0],Qe=u[1],ht=u[2],Et=u[3];return o[0]=Ge*m+Qe*A+ht*G+Et*pe,o[1]=Ge*v+Qe*R+ht*X+Et*Le,o[2]=Ge*S+Qe*O+ht*ee+Et*De,o[3]=Ge*T+Qe*j+ht*se+Et*tt,o[4]=(Ge=u[4])*m+(Qe=u[5])*A+(ht=u[6])*G+(Et=u[7])*pe,o[5]=Ge*v+Qe*R+ht*X+Et*Le,o[6]=Ge*S+Qe*O+ht*ee+Et*De,o[7]=Ge*T+Qe*j+ht*se+Et*tt,o[8]=(Ge=u[8])*m+(Qe=u[9])*A+(ht=u[10])*G+(Et=u[11])*pe,o[9]=Ge*v+Qe*R+ht*X+Et*Le,o[10]=Ge*S+Qe*O+ht*ee+Et*De,o[11]=Ge*T+Qe*j+ht*se+Et*tt,o[12]=(Ge=u[12])*m+(Qe=u[13])*A+(ht=u[14])*G+(Et=u[15])*pe,o[13]=Ge*v+Qe*R+ht*X+Et*Le,o[14]=Ge*S+Qe*O+ht*ee+Et*De,o[15]=Ge*T+Qe*j+ht*se+Et*tt,o}Math.hypot||(Math.hypot=function(){for(var o=0,n=arguments.length;n--;)o+=arguments[n]*arguments[n];return Math.sqrt(o)});var Hc,i1=mm;function Qh(o,n,u){var m=n[0],v=n[1],S=n[2],T=n[3];return o[0]=u[0]*m+u[4]*v+u[8]*S+u[12]*T,o[1]=u[1]*m+u[5]*v+u[9]*S+u[13]*T,o[2]=u[2]*m+u[6]*v+u[10]*S+u[14]*T,o[3]=u[3]*m+u[7]*v+u[11]*S+u[15]*T,o}Hc=new Mu(4),Mu!=Float32Array&&(Hc[0]=0,Hc[1]=0,Hc[2]=0,Hc[3]=0);class r1 extends h{constructor(n){super(n,n1)}createBucket(n){return new gd(n)}queryRadius(n){const u=n;return Zc("circle-radius",this,u)+Zc("circle-stroke-width",this,u)+Jh(this.paint.get("circle-translate"))}queryIntersectsFeature(n,u,m,v,S,T,A,R){const O=Kh(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,A),j=this.paint.get("circle-radius").evaluate(u,m)+this.paint.get("circle-stroke-width").evaluate(u,m),G=this.paint.get("circle-pitch-alignment")==="map",X=G?O:function(se,pe){return se.map(Le=>gm(Le,pe))}(O,R),ee=G?j*A:j;for(const se of v)for(const pe of se){const Le=G?pe:gm(pe,R);let De=ee;const tt=Qh([],[pe.x,pe.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?De*=tt[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(De*=T.cameraToCenterDistance/tt[3]),Kv(X,Le,De))return!0}return!1}}function gm(o,n){const u=Qh([],[o.x,o.y,0,1],n);return new L(u[0]/u[3],u[1]/u[3])}class _m extends gd{}let ym;Qt("HeatmapBucket",_m,{omit:["layers"]});var s1={get paint(){return ym=ym||new k({"heatmap-radius":new vn(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vn(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nn(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vc(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nn(Ye.paint_heatmap["heatmap-opacity"])})}};function bd(o,{width:n,height:u},m,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==n*u*m)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${n*u*m}`)}else v=new Uint8Array(n*u*m);return o.width=n,o.height=u,o.data=v,o}function vm(o,{width:n,height:u},m){if(n===o.width&&u===o.height)return;const v=bd({},{width:n,height:u},m);xd(o,v,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,n),height:Math.min(o.height,u)},m),o.width=n,o.height=u,o.data=v.data}function xd(o,n,u,m,v,S){if(v.width===0||v.height===0)return n;if(v.width>o.width||v.height>o.height||u.x>o.width-v.width||u.y>o.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>n.width||v.height>n.height||m.x>n.width-v.width||m.y>n.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const T=o.data,A=n.data;if(T===A)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<v.height;R++){const O=((u.y+R)*o.width+u.x)*S,j=((m.y+R)*n.width+m.x)*S;for(let G=0;G<v.width*S;G++)A[j+G]=T[O+G]}return n}class Wc{constructor(n,u){bd(this,n,1,u)}resize(n){vm(this,n,1)}clone(){return new Wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,u,m,v,S){xd(n,u,m,v,S,1)}}class Xs{constructor(n,u){bd(this,n,4,u)}resize(n){vm(this,n,4)}replace(n,u){u?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Xs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,u,m,v,S){xd(n,u,m,v,S,4)}}function bm(o){const n={},u=o.resolution||256,m=o.clips?o.clips.length:1,v=o.image||new Xs({width:u,height:m});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const S=(T,A,R)=>{n[o.evaluationKey]=R;const O=o.expression.evaluate(n);v.data[T+A+0]=Math.floor(255*O.r/O.a),v.data[T+A+1]=Math.floor(255*O.g/O.a),v.data[T+A+2]=Math.floor(255*O.b/O.a),v.data[T+A+3]=Math.floor(255*O.a)};if(o.clips)for(let T=0,A=0;T<m;++T,A+=4*u)for(let R=0,O=0;R<u;R++,O+=4){const j=R/(u-1),{start:G,end:X}=o.clips[T];S(A,O,G*(1-j)+X*j)}else for(let T=0,A=0;T<u;T++,A+=4)S(0,A,T/(u-1));return v}Qt("AlphaImage",Wc),Qt("RGBAImage",Xs);const wd="big-fb";class o1 extends h{createBucket(n){return new _m(n)}constructor(n){super(n,s1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(wd)&&this.heatmapFbos.delete(wd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xm;var a1={get paint(){return xm=xm||new k({"hillshade-illumination-direction":new nn(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nn(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nn(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nn(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nn(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nn(Ye.paint_hillshade["hillshade-accent-color"])})}};class l1 extends h{constructor(n){super(n,a1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const u1=P([{name:"a_pos",components:2,type:"Int16"}],4),{members:c1}=u1;function wm(o,n,u=2){const m=n&&n.length,v=m?n[0]*u:o.length;let S=km(o,0,v,u,!0);const T=[];if(!S||S.next===S.prev)return T;let A,R,O;if(m&&(S=function(j,G,X,ee){const se=[];for(let pe=0,Le=G.length;pe<Le;pe++){const De=km(j,G[pe]*ee,pe<Le-1?G[pe+1]*ee:j.length,ee,!1);De===De.next&&(De.steiner=!0),se.push(y1(De))}se.sort(m1);for(let pe=0;pe<se.length;pe++)X=g1(se[pe],X);return X}(o,n,S,u)),o.length>80*u){A=1/0,R=1/0;let j=-1/0,G=-1/0;for(let X=u;X<v;X+=u){const ee=o[X],se=o[X+1];ee<A&&(A=ee),se<R&&(R=se),ee>j&&(j=ee),se>G&&(G=se)}O=Math.max(j-A,G-R),O=O!==0?32767/O:0}return Xc(S,T,u,A,R,O,0),T}function km(o,n,u,m,v){let S;if(v===function(T,A,R,O){let j=0;for(let G=A,X=R-O;G<R;G+=O)j+=(T[X]-T[G])*(T[G+1]+T[X+1]),X=G;return j}(o,n,u,m)>0)for(let T=n;T<u;T+=m)S=Em(T/m|0,o[T],o[T+1],S);else for(let T=u-m;T>=n;T-=m)S=Em(T/m|0,o[T],o[T+1],S);return S&&ef(S,S.next)&&(Yc(S),S=S.next),S}function $l(o,n){if(!o)return o;n||(n=o);let u,m=o;do if(u=!1,m.steiner||!ef(m,m.next)&&tr(m.prev,m,m.next)!==0)m=m.next;else{if(Yc(m),m=n=m.prev,m===m.next)break;u=!0}while(u||m!==n);return n}function Xc(o,n,u,m,v,S,T){if(!o)return;!T&&S&&function(R,O,j,G){let X=R;do X.z===0&&(X.z=kd(X.x,X.y,O,j,G)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==R);X.prevZ.nextZ=null,X.prevZ=null,function(ee){let se,pe=1;do{let Le,De=ee;ee=null;let tt=null;for(se=0;De;){se++;let Ge=De,Qe=0;for(let Et=0;Et<pe&&(Qe++,Ge=Ge.nextZ,Ge);Et++);let ht=pe;for(;Qe>0||ht>0&&Ge;)Qe!==0&&(ht===0||!Ge||De.z<=Ge.z)?(Le=De,De=De.nextZ,Qe--):(Le=Ge,Ge=Ge.nextZ,ht--),tt?tt.nextZ=Le:ee=Le,Le.prevZ=tt,tt=Le;De=Ge}tt.nextZ=null,pe*=2}while(se>1)}(X)}(o,m,v,S);let A=o;for(;o.prev!==o.next;){const R=o.prev,O=o.next;if(S?f1(o,m,v,S):h1(o))n.push(R.i,o.i,O.i),Yc(o),o=O.next,A=O.next;else if((o=O)===A){T?T===1?Xc(o=d1($l(o),n),n,u,m,v,S,2):T===2&&p1(o,n,u,m,v,S):Xc($l(o),n,u,m,v,S,1);break}}}function h1(o){const n=o.prev,u=o,m=o.next;if(tr(n,u,m)>=0)return!1;const v=n.x,S=u.x,T=m.x,A=n.y,R=u.y,O=m.y,j=v<S?v<T?v:T:S<T?S:T,G=A<R?A<O?A:O:R<O?R:O,X=v>S?v>T?v:T:S>T?S:T,ee=A>R?A>O?A:O:R>O?R:O;let se=m.next;for(;se!==n;){if(se.x>=j&&se.x<=X&&se.y>=G&&se.y<=ee&&Au(v,A,S,R,T,O,se.x,se.y)&&tr(se.prev,se,se.next)>=0)return!1;se=se.next}return!0}function f1(o,n,u,m){const v=o.prev,S=o,T=o.next;if(tr(v,S,T)>=0)return!1;const A=v.x,R=S.x,O=T.x,j=v.y,G=S.y,X=T.y,ee=A<R?A<O?A:O:R<O?R:O,se=j<G?j<X?j:X:G<X?G:X,pe=A>R?A>O?A:O:R>O?R:O,Le=j>G?j>X?j:X:G>X?G:X,De=kd(ee,se,n,u,m),tt=kd(pe,Le,n,u,m);let Ge=o.prevZ,Qe=o.nextZ;for(;Ge&&Ge.z>=De&&Qe&&Qe.z<=tt;){if(Ge.x>=ee&&Ge.x<=pe&&Ge.y>=se&&Ge.y<=Le&&Ge!==v&&Ge!==T&&Au(A,j,R,G,O,X,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0||(Ge=Ge.prevZ,Qe.x>=ee&&Qe.x<=pe&&Qe.y>=se&&Qe.y<=Le&&Qe!==v&&Qe!==T&&Au(A,j,R,G,O,X,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0))return!1;Qe=Qe.nextZ}for(;Ge&&Ge.z>=De;){if(Ge.x>=ee&&Ge.x<=pe&&Ge.y>=se&&Ge.y<=Le&&Ge!==v&&Ge!==T&&Au(A,j,R,G,O,X,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.prevZ}for(;Qe&&Qe.z<=tt;){if(Qe.x>=ee&&Qe.x<=pe&&Qe.y>=se&&Qe.y<=Le&&Qe!==v&&Qe!==T&&Au(A,j,R,G,O,X,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.nextZ}return!0}function d1(o,n){let u=o;do{const m=u.prev,v=u.next.next;!ef(m,v)&&Im(m,u,u.next,v)&&$c(m,v)&&$c(v,m)&&(n.push(m.i,u.i,v.i),Yc(u),Yc(u.next),u=o=v),u=u.next}while(u!==o);return $l(u)}function p1(o,n,u,m,v,S){let T=o;do{let A=T.next.next;for(;A!==T.prev;){if(T.i!==A.i&&v1(T,A)){let R=Sm(T,A);return T=$l(T,T.next),R=$l(R,R.next),Xc(T,n,u,m,v,S,0),void Xc(R,n,u,m,v,S,0)}A=A.next}T=T.next}while(T!==o)}function m1(o,n){return o.x-n.x}function g1(o,n){const u=function(v,S){let T=S;const A=v.x,R=v.y;let O,j=-1/0;do{if(R<=T.y&&R>=T.next.y&&T.next.y!==T.y){const pe=T.x+(R-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(pe<=A&&pe>j&&(j=pe,O=T.x<T.next.x?T:T.next,pe===A))return O}T=T.next}while(T!==S);if(!O)return null;const G=O,X=O.x,ee=O.y;let se=1/0;T=O;do{if(A>=T.x&&T.x>=X&&A!==T.x&&Au(R<ee?A:j,R,X,ee,R<ee?j:A,R,T.x,T.y)){const pe=Math.abs(R-T.y)/(A-T.x);$c(T,v)&&(pe<se||pe===se&&(T.x>O.x||T.x===O.x&&_1(O,T)))&&(O=T,se=pe)}T=T.next}while(T!==G);return O}(o,n);if(!u)return n;const m=Sm(u,o);return $l(m,m.next),$l(u,u.next)}function _1(o,n){return tr(o.prev,o,n.prev)<0&&tr(n.next,o,o.next)<0}function kd(o,n,u,m,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*v|0)|o<<8))|o<<4))|o<<2))|o<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-m)*v|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function y1(o){let n=o,u=o;do(n.x<u.x||n.x===u.x&&n.y<u.y)&&(u=n),n=n.next;while(n!==o);return u}function Au(o,n,u,m,v,S,T,A){return(v-T)*(n-A)>=(o-T)*(S-A)&&(o-T)*(m-A)>=(u-T)*(n-A)&&(u-T)*(S-A)>=(v-T)*(m-A)}function v1(o,n){return o.next.i!==n.i&&o.prev.i!==n.i&&!function(u,m){let v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==m.i&&v.next.i!==m.i&&Im(v,v.next,u,m))return!0;v=v.next}while(v!==u);return!1}(o,n)&&($c(o,n)&&$c(n,o)&&function(u,m){let v=u,S=!1;const T=(u.x+m.x)/2,A=(u.y+m.y)/2;do v.y>A!=v.next.y>A&&v.next.y!==v.y&&T<(v.next.x-v.x)*(A-v.y)/(v.next.y-v.y)+v.x&&(S=!S),v=v.next;while(v!==u);return S}(o,n)&&(tr(o.prev,o,n.prev)||tr(o,n.prev,n))||ef(o,n)&&tr(o.prev,o,o.next)>0&&tr(n.prev,n,n.next)>0)}function tr(o,n,u){return(n.y-o.y)*(u.x-n.x)-(n.x-o.x)*(u.y-n.y)}function ef(o,n){return o.x===n.x&&o.y===n.y}function Im(o,n,u,m){const v=nf(tr(o,n,u)),S=nf(tr(o,n,m)),T=nf(tr(u,m,o)),A=nf(tr(u,m,n));return v!==S&&T!==A||!(v!==0||!tf(o,u,n))||!(S!==0||!tf(o,m,n))||!(T!==0||!tf(u,o,m))||!(A!==0||!tf(u,n,m))}function tf(o,n,u){return n.x<=Math.max(o.x,u.x)&&n.x>=Math.min(o.x,u.x)&&n.y<=Math.max(o.y,u.y)&&n.y>=Math.min(o.y,u.y)}function nf(o){return o>0?1:o<0?-1:0}function $c(o,n){return tr(o.prev,o,o.next)<0?tr(o,n,o.next)>=0&&tr(o,o.prev,n)>=0:tr(o,n,o.prev)<0||tr(o,o.next,n)<0}function Sm(o,n){const u=Id(o.i,o.x,o.y),m=Id(n.i,n.x,n.y),v=o.next,S=n.prev;return o.next=n,n.prev=o,u.next=v,v.prev=u,m.next=u,u.prev=m,S.next=m,m.prev=S,m}function Em(o,n,u,m){const v=Id(o,n,u);return m?(v.next=m.next,v.prev=m,m.next.prev=v,m.next=v):(v.prev=v,v.next=v),v}function Yc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Id(o,n,u){return{i:o,x:n,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Sd(o,n,u){const m=u.patternDependencies;let v=!1;for(const S of n){const T=S.paint.get(`${o}-pattern`);T.isConstant()||(v=!0);const A=T.constantOr(null);A&&(v=!0,m[A.to]=!0,m[A.from]=!0)}return v}function Ed(o,n,u,m,v){const S=v.patternDependencies;for(const T of n){const A=T.paint.get(`${o}-pattern`).value;if(A.kind!=="constant"){let R=A.evaluate({zoom:m-1},u,{},v.availableImages),O=A.evaluate({zoom:m},u,{},v.availableImages),j=A.evaluate({zoom:m+1},u,{},v.availableImages);R=R&&R.name?R.name:R,O=O&&O.name?O.name:O,j=j&&j.name?j.name:j,S[R]=!0,S[O]=!0,S[j]=!0,u.patterns[T.id]={min:R,mid:O,max:j}}}return u}class Td{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(u=>u.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ho,this.indexArray=new Ws,this.indexArray2=new Pr,this.programConfigurations=new Hl(n.layers,n.zoom),this.segments=new Gn,this.segments2=new Gn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(n,u,m){this.hasPattern=Sd("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),S=!v.isConstant(),T=[];for(const{feature:A,id:R,index:O,sourceLayerIndex:j}of n){const G=this.layers[0]._featureFilter.needGeometry,X=Xl(A,G);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),X,m))continue;const ee=S?v.evaluate(X,{},m,u.availableImages):void 0,se={id:R,properties:A.properties,type:A.type,sourceLayerIndex:j,index:O,geometry:G?X.geometry:Wl(A),patterns:{},sortKey:ee};T.push(se)}S&&T.sort((A,R)=>A.sortKey-R.sortKey);for(const A of T){const{geometry:R,index:O,sourceLayerIndex:j}=A;if(this.hasPattern){const G=Ed("fill",this.layers,A,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(A,R,O,m,{});u.featureIndex.insert(n[O].feature,R,O,j,this.index)}}update(n,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,u,this.stateDependentLayers,m)}addFeatures(n,u,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,c1),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,u,m,v,S){for(const T of ja(u,500)){let A=0;for(const ee of T)A+=ee.length;const R=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),O=R.vertexLength,j=[],G=[];for(const ee of T){if(ee.length===0)continue;ee!==T[0]&&G.push(j.length/2);const se=this.segments2.prepareSegment(ee.length,this.layoutVertexArray,this.indexArray2),pe=se.vertexLength;this.layoutVertexArray.emplaceBack(ee[0].x,ee[0].y),this.indexArray2.emplaceBack(pe+ee.length-1,pe),j.push(ee[0].x),j.push(ee[0].y);for(let Le=1;Le<ee.length;Le++)this.layoutVertexArray.emplaceBack(ee[Le].x,ee[Le].y),this.indexArray2.emplaceBack(pe+Le-1,pe+Le),j.push(ee[Le].x),j.push(ee[Le].y);se.vertexLength+=ee.length,se.primitiveLength+=ee.length}const X=wm(j,G);for(let ee=0;ee<X.length;ee+=3)this.indexArray.emplaceBack(O+X[ee],O+X[ee+1],O+X[ee+2]);R.vertexLength+=A,R.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,S,v)}}let Tm,Cm;Qt("FillBucket",Td,{omit:["layers","patternFeatures"]});var b1={get paint(){return Cm=Cm||new k({"fill-antialias":new nn(Ye.paint_fill["fill-antialias"]),"fill-opacity":new vn(Ye.paint_fill["fill-opacity"]),"fill-color":new vn(Ye.paint_fill["fill-color"]),"fill-outline-color":new vn(Ye.paint_fill["fill-outline-color"]),"fill-translate":new nn(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new nn(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new xu(Ye.paint_fill["fill-pattern"])})},get layout(){return Tm=Tm||new k({"fill-sort-key":new vn(Ye.layout_fill["fill-sort-key"])})}};class x1 extends h{constructor(n){super(n,b1)}recalculate(n,u){super.recalculate(n,u);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Td(n)}queryRadius(){return Jh(this.paint.get("fill-translate"))}queryIntersectsFeature(n,u,m,v,S,T,A){return cm(Kh(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,A),v)}isTileClipped(){return!0}}const w1=P([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),k1=P([{name:"a_centroid",components:2,type:"Int16"}],4),{members:I1}=w1;var al={},S1=E,Lm=Pu;function Pu(o,n,u,m,v){this.properties={},this.extent=u,this.type=0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=v,o.readFields(E1,this,n)}function E1(o,n,u){o==1?n.id=u.readVarint():o==2?function(m,v){for(var S=m.readVarint()+m.pos;m.pos<S;){var T=v._keys[m.readVarint()],A=v._values[m.readVarint()];v.properties[T]=A}}(u,n):o==3?n.type=u.readVarint():o==4&&(n._geometry=u.pos)}function T1(o){for(var n,u,m=0,v=0,S=o.length,T=S-1;v<S;T=v++)m+=((u=o[T]).x-(n=o[v]).x)*(n.y+u.y);return m}Pu.types=["Unknown","Point","LineString","Polygon"],Pu.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var n,u=o.readVarint()+o.pos,m=1,v=0,S=0,T=0,A=[];o.pos<u;){if(v<=0){var R=o.readVarint();m=7&R,v=R>>3}if(v--,m===1||m===2)S+=o.readSVarint(),T+=o.readSVarint(),m===1&&(n&&A.push(n),n=[]),n.push(new S1(S,T));else{if(m!==7)throw new Error("unknown command "+m);n&&n.push(n[0].clone())}}return n&&A.push(n),A},Pu.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var n=o.readVarint()+o.pos,u=1,m=0,v=0,S=0,T=1/0,A=-1/0,R=1/0,O=-1/0;o.pos<n;){if(m<=0){var j=o.readVarint();u=7&j,m=j>>3}if(m--,u===1||u===2)(v+=o.readSVarint())<T&&(T=v),v>A&&(A=v),(S+=o.readSVarint())<R&&(R=S),S>O&&(O=S);else if(u!==7)throw new Error("unknown command "+u)}return[T,R,A,O]},Pu.prototype.toGeoJSON=function(o,n,u){var m,v,S=this.extent*Math.pow(2,u),T=this.extent*o,A=this.extent*n,R=this.loadGeometry(),O=Pu.types[this.type];function j(ee){for(var se=0;se<ee.length;se++){var pe=ee[se];ee[se]=[360*(pe.x+T)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+A)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(m=0;m<R.length;m++)G[m]=R[m][0];j(R=G);break;case 2:for(m=0;m<R.length;m++)j(R[m]);break;case 3:for(R=function(ee){var se=ee.length;if(se<=1)return[ee];for(var pe,Le,De=[],tt=0;tt<se;tt++){var Ge=T1(ee[tt]);Ge!==0&&(Le===void 0&&(Le=Ge<0),Le===Ge<0?(pe&&De.push(pe),pe=[ee[tt]]):pe.push(ee[tt]))}return pe&&De.push(pe),De}(R),m=0;m<R.length;m++)for(v=0;v<R[m].length;v++)j(R[m][v])}R.length===1?R=R[0]:O="Multi"+O;var X={type:"Feature",geometry:{type:O,coordinates:R},properties:this.properties};return"id"in this&&(X.id=this.id),X};var C1=Lm,Mm=Am;function Am(o,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(L1,this,n),this.length=this._features.length}function L1(o,n,u){o===15?n.version=u.readVarint():o===1?n.name=u.readString():o===5?n.extent=u.readVarint():o===2?n._features.push(u.pos):o===3?n._keys.push(u.readString()):o===4&&n._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var T=m.readVarint()>>3;v=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return v}(u))}Am.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var n=this._pbf.readVarint()+this._pbf.pos;return new C1(this._pbf,n,this.extent,this._keys,this._values)};var M1=Mm;function A1(o,n,u){if(o===3){var m=new M1(u,u.readVarint()+u.pos);m.length&&(n[m.name]=m)}}al.VectorTile=function(o,n){this.layers=o.readFields(A1,{},n)},al.VectorTileFeature=Lm,al.VectorTileLayer=Mm;const P1=al.VectorTileFeature.types,Cd=Math.pow(2,13);function Jc(o,n,u,m,v,S,T,A){o.emplaceBack(n,u,2*Math.floor(m*Cd)+T,v*Cd*2,S*Cd*2,Math.round(A))}class Ld{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(u=>u.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new tl,this.centroidVertexArray=new zr,this.indexArray=new Ws,this.programConfigurations=new Hl(n.layers,n.zoom),this.segments=new Gn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(n,u,m){this.features=[],this.hasPattern=Sd("fill-extrusion",this.layers,u);for(const{feature:v,id:S,index:T,sourceLayerIndex:A}of n){const R=this.layers[0]._featureFilter.needGeometry,O=Xl(v,R);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),O,m))continue;const j={id:S,sourceLayerIndex:A,index:T,geometry:R?O.geometry:Wl(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Ed("fill-extrusion",this.layers,j,this.zoom,u)):this.addFeature(j,j.geometry,T,m,{}),u.featureIndex.insert(v,j.geometry,T,A,this.index,!0)}}addFeatures(n,u,m){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,u,m)}}update(n,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,u,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,I1),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,k1.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,u,m,v,S){for(const T of ja(u,500)){const A={x:0,y:0,vertexCount:0};let R=0;for(const se of T)R+=se.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const se of T){if(se.length===0||D1(se))continue;let pe=0;for(let Le=0;Le<se.length;Le++){const De=se[Le];if(Le>=1){const tt=se[Le-1];if(!R1(De,tt)){O.vertexLength+4>Gn.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ge=De.sub(tt)._perp()._unit(),Qe=tt.dist(De);pe+Qe>32768&&(pe=0),Jc(this.layoutVertexArray,De.x,De.y,Ge.x,Ge.y,0,0,pe),Jc(this.layoutVertexArray,De.x,De.y,Ge.x,Ge.y,0,1,pe),A.x+=2*De.x,A.y+=2*De.y,A.vertexCount+=2,pe+=Qe,Jc(this.layoutVertexArray,tt.x,tt.y,Ge.x,Ge.y,0,0,pe),Jc(this.layoutVertexArray,tt.x,tt.y,Ge.x,Ge.y,0,1,pe),A.x+=2*tt.x,A.y+=2*tt.y,A.vertexCount+=2;const ht=O.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+R>Gn.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),P1[n.type]!=="Polygon")continue;const j=[],G=[],X=O.vertexLength;for(const se of T)if(se.length!==0){se!==T[0]&&G.push(j.length/2);for(let pe=0;pe<se.length;pe++){const Le=se[pe];Jc(this.layoutVertexArray,Le.x,Le.y,0,0,1,1,0),A.x+=Le.x,A.y+=Le.y,A.vertexCount+=1,j.push(Le.x),j.push(Le.y)}}const ee=wm(j,G);for(let se=0;se<ee.length;se+=3)this.indexArray.emplaceBack(X+ee[se],X+ee[se+2],X+ee[se+1]);O.primitiveLength+=ee.length/3,O.vertexLength+=R;for(let se=0;se<A.vertexCount;se++){const pe=Math.floor(A.x/A.vertexCount),Le=Math.floor(A.y/A.vertexCount);this.centroidVertexArray.emplaceBack(pe,Le)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,S,v)}}function R1(o,n){return o.x===n.x&&(o.x<0||o.x>ar)||o.y===n.y&&(o.y<0||o.y>ar)}function D1(o){return o.every(n=>n.x<0)||o.every(n=>n.x>ar)||o.every(n=>n.y<0)||o.every(n=>n.y>ar)}let Pm;Qt("FillExtrusionBucket",Ld,{omit:["layers","features"]});var N1={get paint(){return Pm=Pm||new k({"fill-extrusion-opacity":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vn(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xu(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vn(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vn(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class z1 extends h{constructor(n){super(n,N1)}createBucket(n){return new Ld(n)}queryRadius(){return Jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,u,m,v,S,T,A,R){const O=Kh(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,A),j=this.paint.get("fill-extrusion-height").evaluate(u,m),G=this.paint.get("fill-extrusion-base").evaluate(u,m),X=function(se,pe,Le,De){const tt=[];for(const Ge of se){const Qe=[Ge.x,Ge.y,0,1];Qh(Qe,Qe,pe),tt.push(new L(Qe[0]/Qe[3],Qe[1]/Qe[3]))}return tt}(O,R),ee=function(se,pe,Le,De){const tt=[],Ge=[],Qe=De[8]*pe,ht=De[9]*pe,Et=De[10]*pe,$t=De[11]*pe,yn=De[8]*Le,Wt=De[9]*Le,Zt=De[10]*Le,on=De[11]*Le;for(const tn of se){const Kt=[],yt=[];for(const cn of tn){const sn=cn.x,Sn=cn.y,vi=De[0]*sn+De[4]*Sn+De[12],_i=De[1]*sn+De[5]*Sn+De[13],vr=De[2]*sn+De[6]*Sn+De[14],fo=De[3]*sn+De[7]*Sn+De[15],Br=vr+Et,br=fo+$t,as=vi+yn,ls=_i+Wt,us=vr+Zt,Gi=fo+on,xr=new L((vi+Qe)/br,(_i+ht)/br);xr.z=Br/br,Kt.push(xr);const $r=new L(as/Gi,ls/Gi);$r.z=us/Gi,yt.push($r)}tt.push(Kt),Ge.push(yt)}return[tt,Ge]}(v,G,j,R);return function(se,pe,Le){let De=1/0;cm(Le,pe)&&(De=Rm(Le,pe[0]));for(let tt=0;tt<pe.length;tt++){const Ge=pe[tt],Qe=se[tt];for(let ht=0;ht<Ge.length-1;ht++){const Et=Ge[ht],$t=[Et,Ge[ht+1],Qe[ht+1],Qe[ht],Et];um(Le,$t)&&(De=Math.min(De,Rm(Le,$t)))}}return De!==1/0&&De}(ee[0],ee[1],X)}}function Kc(o,n){return o.x*n.x+o.y*n.y}function Rm(o,n){if(o.length===1){let u=0;const m=n[u++];let v;for(;!v||m.equals(v);)if(v=n[u++],!v)return 1/0;for(;u<n.length;u++){const S=n[u],T=o[0],A=v.sub(m),R=S.sub(m),O=T.sub(m),j=Kc(A,A),G=Kc(A,R),X=Kc(R,R),ee=Kc(O,A),se=Kc(O,R),pe=j*X-G*G,Le=(X*ee-G*se)/pe,De=(j*se-G*ee)/pe,tt=m.z*(1-Le-De)+v.z*Le+S.z*De;if(isFinite(tt))return tt}return 1/0}{let u=1/0;for(const m of n)u=Math.min(u,m.z);return u}}const O1=P([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:F1}=O1,B1=P([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:U1}=B1,j1=al.VectorTileFeature.types,V1=Math.cos(Math.PI/180*37.5),Dm=Math.pow(2,14)/.5;class Md{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(u=>u.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new ku,this.layoutVertexArray2=new nl,this.indexArray=new Ws,this.programConfigurations=new Hl(n.layers,n.zoom),this.segments=new Gn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(n,u,m){this.hasPattern=Sd("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),S=!v.isConstant(),T=[];for(const{feature:A,id:R,index:O,sourceLayerIndex:j}of n){const G=this.layers[0]._featureFilter.needGeometry,X=Xl(A,G);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),X,m))continue;const ee=S?v.evaluate(X,{},m):void 0,se={id:R,properties:A.properties,type:A.type,sourceLayerIndex:j,index:O,geometry:G?X.geometry:Wl(A),patterns:{},sortKey:ee};T.push(se)}S&&T.sort((A,R)=>A.sortKey-R.sortKey);for(const A of T){const{geometry:R,index:O,sourceLayerIndex:j}=A;if(this.hasPattern){const G=Ed("line",this.layers,A,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(A,R,O,m,{});u.featureIndex.insert(n[O].feature,R,O,j,this.index)}}update(n,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,u,this.stateDependentLayers,m)}addFeatures(n,u,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,U1)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,F1),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,u,m,v,S){const T=this.layers[0].layout,A=T.get("line-join").evaluate(n,{}),R=T.get("line-cap"),O=T.get("line-miter-limit"),j=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const G of u)this.addLine(G,n,A,R,O,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,S,v)}addLine(n,u,m,v,S,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let De=0;De<n.length-1;De++)this.totalDistance+=n[De].dist(n[De+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=j1[u.type]==="Polygon";let R=n.length;for(;R>=2&&n[R-1].equals(n[R-2]);)R--;let O=0;for(;O<R-1&&n[O].equals(n[O+1]);)O++;if(R<(A?3:2))return;m==="bevel"&&(S=1.05);const j=this.overscaling<=16?15*ar/(512*this.overscaling):0,G=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let X,ee,se,pe,Le;this.e1=this.e2=-1,A&&(X=n[R-2],Le=n[O].sub(X)._unit()._perp());for(let De=O;De<R;De++){if(se=De===R-1?A?n[O+1]:void 0:n[De+1],se&&n[De].equals(se))continue;Le&&(pe=Le),X&&(ee=X),X=n[De],Le=se?se.sub(X)._unit()._perp():pe,pe=pe||Le;let tt=pe.add(Le);tt.x===0&&tt.y===0||tt._unit();const Ge=pe.x*Le.x+pe.y*Le.y,Qe=tt.x*Le.x+tt.y*Le.y,ht=Qe!==0?1/Qe:1/0,Et=2*Math.sqrt(2-2*Qe),$t=Qe<V1&&ee&&se,yn=pe.x*Le.y-pe.y*Le.x>0;if($t&&De>O){const on=X.dist(ee);if(on>2*j){const tn=X.sub(X.sub(ee)._mult(j/on)._round());this.updateDistance(ee,tn),this.addCurrentVertex(tn,pe,0,0,G),ee=tn}}const Wt=ee&&se;let Zt=Wt?m:A?"butt":v;if(Wt&&Zt==="round"&&(ht<T?Zt="miter":ht<=2&&(Zt="fakeround")),Zt==="miter"&&ht>S&&(Zt="bevel"),Zt==="bevel"&&(ht>2&&(Zt="flipbevel"),ht<S&&(Zt="miter")),ee&&this.updateDistance(ee,X),Zt==="miter")tt._mult(ht),this.addCurrentVertex(X,tt,0,0,G);else if(Zt==="flipbevel"){if(ht>100)tt=Le.mult(-1);else{const on=ht*pe.add(Le).mag()/pe.sub(Le).mag();tt._perp()._mult(on*(yn?-1:1))}this.addCurrentVertex(X,tt,0,0,G),this.addCurrentVertex(X,tt.mult(-1),0,0,G)}else if(Zt==="bevel"||Zt==="fakeround"){const on=-Math.sqrt(ht*ht-1),tn=yn?on:0,Kt=yn?0:on;if(ee&&this.addCurrentVertex(X,pe,tn,Kt,G),Zt==="fakeround"){const yt=Math.round(180*Et/Math.PI/20);for(let cn=1;cn<yt;cn++){let sn=cn/yt;if(sn!==.5){const vi=sn-.5;sn+=sn*vi*(sn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*vi*vi+(.848013+Ge*(.215638*Ge-1.06021)))}const Sn=Le.sub(pe)._mult(sn)._add(pe)._unit()._mult(yn?-1:1);this.addHalfVertex(X,Sn.x,Sn.y,!1,yn,0,G)}}se&&this.addCurrentVertex(X,Le,-tn,-Kt,G)}else if(Zt==="butt")this.addCurrentVertex(X,tt,0,0,G);else if(Zt==="square"){const on=ee?1:-1;this.addCurrentVertex(X,tt,on,on,G)}else Zt==="round"&&(ee&&(this.addCurrentVertex(X,pe,0,0,G),this.addCurrentVertex(X,pe,1,1,G,!0)),se&&(this.addCurrentVertex(X,Le,-1,-1,G,!0),this.addCurrentVertex(X,Le,0,0,G)));if($t&&De<R-1){const on=X.dist(se);if(on>2*j){const tn=X.add(se.sub(X)._mult(j/on)._round());this.updateDistance(X,tn),this.addCurrentVertex(tn,Le,0,0,G),X=tn}}}}addCurrentVertex(n,u,m,v,S,T=!1){const A=u.y*v-u.x,R=-u.y-u.x*v;this.addHalfVertex(n,u.x+u.y*m,u.y-u.x*m,T,!1,m,S),this.addHalfVertex(n,A,R,T,!0,-v,S),this.distance>Dm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,u,m,v,S,T))}addHalfVertex({x:n,y:u},m,v,S,T,A,R){const O=.5*(this.lineClips?this.scaledDistance*(Dm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(S?1:0),(u<<1)+(T?1:0),Math.round(63*m)+128,Math.round(63*v)+128,1+(A===0?0:A<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),R.primitiveLength++),T?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,u){this.distance+=n.dist(u),this.updateScaledDistance()}}let Nm,zm;Qt("LineBucket",Md,{omit:["layers","patternFeatures"]});var Om={get paint(){return zm=zm||new k({"line-opacity":new vn(Ye.paint_line["line-opacity"]),"line-color":new vn(Ye.paint_line["line-color"]),"line-translate":new nn(Ye.paint_line["line-translate"]),"line-translate-anchor":new nn(Ye.paint_line["line-translate-anchor"]),"line-width":new vn(Ye.paint_line["line-width"]),"line-gap-width":new vn(Ye.paint_line["line-gap-width"]),"line-offset":new vn(Ye.paint_line["line-offset"]),"line-blur":new vn(Ye.paint_line["line-blur"]),"line-dasharray":new wu(Ye.paint_line["line-dasharray"]),"line-pattern":new xu(Ye.paint_line["line-pattern"]),"line-gradient":new Vc(Ye.paint_line["line-gradient"])})},get layout(){return Nm=Nm||new k({"line-cap":new nn(Ye.layout_line["line-cap"]),"line-join":new vn(Ye.layout_line["line-join"]),"line-miter-limit":new nn(Ye.layout_line["line-miter-limit"]),"line-round-limit":new nn(Ye.layout_line["line-round-limit"]),"line-sort-key":new vn(Ye.layout_line["line-sort-key"])})}};class q1 extends vn{possiblyEvaluate(n,u){return u=new Ii(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(n,u)}evaluate(n,u,m,v){return u=ue({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(n,u,m,v)}}let rf;class G1 extends h{constructor(n){super(n,Om),this.gradientVersion=0,rf||(rf=new q1(Om.paint.properties["line-width"].specification),rf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Oo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,u){super.recalculate(n,u),this.paint._values["line-floorwidth"]=rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Md(n)}queryRadius(n){const u=n,m=Fm(Zc("line-width",this,u),Zc("line-gap-width",this,u)),v=Zc("line-offset",this,u);return m/2+Math.abs(v)+Jh(this.paint.get("line-translate"))}queryIntersectsFeature(n,u,m,v,S,T,A){const R=Kh(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,A),O=A/2*Fm(this.paint.get("line-width").evaluate(u,m),this.paint.get("line-gap-width").evaluate(u,m)),j=this.paint.get("line-offset").evaluate(u,m);return j&&(v=function(G,X){const ee=[];for(let se=0;se<G.length;se++){const pe=G[se],Le=[];for(let De=0;De<pe.length;De++){const tt=pe[De-1],Ge=pe[De],Qe=pe[De+1],ht=De===0?new L(0,0):Ge.sub(tt)._unit()._perp(),Et=De===pe.length-1?new L(0,0):Qe.sub(Ge)._unit()._perp(),$t=ht._add(Et)._unit(),yn=$t.x*Et.x+$t.y*Et.y;yn!==0&&$t._mult(1/yn),Le.push($t._mult(X)._add(Ge))}ee.push(Le)}return ee}(v,j*A)),function(G,X,ee){for(let se=0;se<X.length;se++){const pe=X[se];if(G.length>=3){for(let Le=0;Le<pe.length;Le++)if(Lu(G,pe[Le]))return!0}if(Qv(G,pe,ee))return!0}return!1}(R,v,O)}isTileClipped(){return!0}}function Fm(o,n){return n>0?n+2*o:o}const Z1=P([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),H1=P([{name:"a_projected_pos",components:3,type:"Float32"}],4);P([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const W1=P([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);P([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bm=P([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),X1=P([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $1(o,n,u){return o.sections.forEach(m=>{m.text=function(v,S,T){const A=S.layout.get("text-transform").evaluate(T,{});return A==="uppercase"?v=v.toLocaleUpperCase():A==="lowercase"&&(v=v.toLocaleLowerCase()),Is.applyArabicShaping&&(v=Is.applyArabicShaping(v)),v}(m.text,n,u)}),o}P([{name:"triangle",components:3,type:"Uint16"}]),P([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),P([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),P([{type:"Float32",name:"offsetX"}]),P([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),P([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var pr=24,Um=gi,jm=function(o,n,u,m,v){var S,T,A=8*v-m-1,R=(1<<A)-1,O=R>>1,j=-7,G=u?v-1:0,X=u?-1:1,ee=o[n+G];for(G+=X,S=ee&(1<<-j)-1,ee>>=-j,j+=A;j>0;S=256*S+o[n+G],G+=X,j-=8);for(T=S&(1<<-j)-1,S>>=-j,j+=m;j>0;T=256*T+o[n+G],G+=X,j-=8);if(S===0)S=1-O;else{if(S===R)return T?NaN:1/0*(ee?-1:1);T+=Math.pow(2,m),S-=O}return(ee?-1:1)*T*Math.pow(2,S-m)},Vm=function(o,n,u,m,v,S){var T,A,R,O=8*S-v-1,j=(1<<O)-1,G=j>>1,X=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ee=m?0:S-1,se=m?1:-1,pe=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(A=isNaN(n)?1:0,T=j):(T=Math.floor(Math.log(n)/Math.LN2),n*(R=Math.pow(2,-T))<1&&(T--,R*=2),(n+=T+G>=1?X/R:X*Math.pow(2,1-G))*R>=2&&(T++,R/=2),T+G>=j?(A=0,T=j):T+G>=1?(A=(n*R-1)*Math.pow(2,v),T+=G):(A=n*Math.pow(2,G-1)*Math.pow(2,v),T=0));v>=8;o[u+ee]=255&A,ee+=se,A/=256,v-=8);for(T=T<<v|A,O+=v;O>0;o[u+ee]=255&T,ee+=se,T/=256,O-=8);o[u+ee-se]|=128*pe};function gi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}gi.Varint=0,gi.Fixed64=1,gi.Bytes=2,gi.Fixed32=5;var Ad=4294967296,qm=1/Ad,Gm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ea(o){return o.type===gi.Bytes?o.readVarint()+o.pos:o.pos+1}function Ru(o,n,u){return u?4294967296*n+(o>>>0):4294967296*(n>>>0)+(o>>>0)}function Zm(o,n,u){var m=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));u.realloc(m);for(var v=u.pos-1;v>=o;v--)u.buf[v+m]=u.buf[v]}function Y1(o,n){for(var u=0;u<o.length;u++)n.writeVarint(o[u])}function J1(o,n){for(var u=0;u<o.length;u++)n.writeSVarint(o[u])}function K1(o,n){for(var u=0;u<o.length;u++)n.writeFloat(o[u])}function Q1(o,n){for(var u=0;u<o.length;u++)n.writeDouble(o[u])}function eb(o,n){for(var u=0;u<o.length;u++)n.writeBoolean(o[u])}function tb(o,n){for(var u=0;u<o.length;u++)n.writeFixed32(o[u])}function nb(o,n){for(var u=0;u<o.length;u++)n.writeSFixed32(o[u])}function ib(o,n){for(var u=0;u<o.length;u++)n.writeFixed64(o[u])}function rb(o,n){for(var u=0;u<o.length;u++)n.writeSFixed64(o[u])}function sf(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+16777216*o[n+3]}function Du(o,n,u){o[u]=n,o[u+1]=n>>>8,o[u+2]=n>>>16,o[u+3]=n>>>24}function Hm(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+(o[n+3]<<24)}gi.prototype={destroy:function(){this.buf=null},readFields:function(o,n,u){for(u=u||this.length;this.pos<u;){var m=this.readVarint(),v=m>>3,S=this.pos;this.type=7&m,o(v,n,this),this.pos===S&&this.skip(m)}return n},readMessage:function(o,n){return this.readFields(o,n,this.readVarint()+this.pos)},readFixed32:function(){var o=sf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Hm(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=sf(this.buf,this.pos)+sf(this.buf,this.pos+4)*Ad;return this.pos+=8,o},readSFixed64:function(){var o=sf(this.buf,this.pos)+Hm(this.buf,this.pos+4)*Ad;return this.pos+=8,o},readFloat:function(){var o=jm(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=jm(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var n,u,m=this.buf;return n=127&(u=m[this.pos++]),u<128?n:(n|=(127&(u=m[this.pos++]))<<7,u<128?n:(n|=(127&(u=m[this.pos++]))<<14,u<128?n:(n|=(127&(u=m[this.pos++]))<<21,u<128?n:function(v,S,T){var A,R,O=T.buf;if(A=(112&(R=O[T.pos++]))>>4,R<128||(A|=(127&(R=O[T.pos++]))<<3,R<128)||(A|=(127&(R=O[T.pos++]))<<10,R<128)||(A|=(127&(R=O[T.pos++]))<<17,R<128)||(A|=(127&(R=O[T.pos++]))<<24,R<128)||(A|=(1&(R=O[T.pos++]))<<31,R<128))return Ru(v,A,S);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(u=m[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,n=this.pos;return this.pos=o,o-n>=12&&Gm?function(u,m,v){return Gm.decode(u.subarray(m,v))}(this.buf,n,o):function(u,m,v){for(var S="",T=m;T<v;){var A,R,O,j=u[T],G=null,X=j>239?4:j>223?3:j>191?2:1;if(T+X>v)break;X===1?j<128&&(G=j):X===2?(192&(A=u[T+1]))==128&&(G=(31&j)<<6|63&A)<=127&&(G=null):X===3?(R=u[T+2],(192&(A=u[T+1]))==128&&(192&R)==128&&((G=(15&j)<<12|(63&A)<<6|63&R)<=2047||G>=55296&&G<=57343)&&(G=null)):X===4&&(R=u[T+2],O=u[T+3],(192&(A=u[T+1]))==128&&(192&R)==128&&(192&O)==128&&((G=(15&j)<<18|(63&A)<<12|(63&R)<<6|63&O)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,X=1):G>65535&&(G-=65536,S+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),S+=String.fromCharCode(G),T+=X}return S}(this.buf,n,o)},readBytes:function(){var o=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,o);return this.pos=o,n},readPackedVarint:function(o,n){if(this.type!==gi.Bytes)return o.push(this.readVarint(n));var u=Ea(this);for(o=o||[];this.pos<u;)o.push(this.readVarint(n));return o},readPackedSVarint:function(o){if(this.type!==gi.Bytes)return o.push(this.readSVarint());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==gi.Bytes)return o.push(this.readBoolean());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==gi.Bytes)return o.push(this.readFloat());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==gi.Bytes)return o.push(this.readDouble());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==gi.Bytes)return o.push(this.readFixed32());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==gi.Bytes)return o.push(this.readSFixed32());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==gi.Bytes)return o.push(this.readFixed64());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==gi.Bytes)return o.push(this.readSFixed64());var n=Ea(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed64());return o},skip:function(o){var n=7&o;if(n===gi.Varint)for(;this.buf[this.pos++]>127;);else if(n===gi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===gi.Fixed32)this.pos+=4;else{if(n!==gi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(o,n){this.writeVarint(o<<3|n)},realloc:function(o){for(var n=this.length||16;n<this.pos+o;)n*=2;if(n!==this.length){var u=new Uint8Array(n);u.set(this.buf),this.buf=u,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Du(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Du(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Du(this.buf,-1&o,this.pos),Du(this.buf,Math.floor(o*qm),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Du(this.buf,-1&o,this.pos),Du(this.buf,Math.floor(o*qm),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(n,u){var m,v;if(n>=0?(m=n%4294967296|0,v=n/4294967296|0):(v=~(-n/4294967296),4294967295^(m=~(-n%4294967296))?m=m+1|0:(m=0,v=v+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(S,T,A){A.buf[A.pos++]=127&S|128,S>>>=7,A.buf[A.pos++]=127&S|128,S>>>=7,A.buf[A.pos++]=127&S|128,S>>>=7,A.buf[A.pos++]=127&S|128,A.buf[A.pos]=127&(S>>>=7)}(m,0,u),function(S,T){var A=(7&S)<<4;T.buf[T.pos++]|=A|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(v,u)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var n=this.pos;this.pos=function(m,v,S){for(var T,A,R=0;R<v.length;R++){if((T=v.charCodeAt(R))>55295&&T<57344){if(!A){T>56319||R+1===v.length?(m[S++]=239,m[S++]=191,m[S++]=189):A=T;continue}if(T<56320){m[S++]=239,m[S++]=191,m[S++]=189,A=T;continue}T=A-55296<<10|T-56320|65536,A=null}else A&&(m[S++]=239,m[S++]=191,m[S++]=189,A=null);T<128?m[S++]=T:(T<2048?m[S++]=T>>6|192:(T<65536?m[S++]=T>>12|224:(m[S++]=T>>18|240,m[S++]=T>>12&63|128),m[S++]=T>>6&63|128),m[S++]=63&T|128)}return S}(this.buf,o,this.pos);var u=this.pos-n;u>=128&&Zm(n,u,this),this.pos=n-1,this.writeVarint(u),this.pos+=u},writeFloat:function(o){this.realloc(4),Vm(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Vm(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var n=o.length;this.writeVarint(n),this.realloc(n);for(var u=0;u<n;u++)this.buf[this.pos++]=o[u]},writeRawMessage:function(o,n){this.pos++;var u=this.pos;o(n,this);var m=this.pos-u;m>=128&&Zm(u,m,this),this.pos=u-1,this.writeVarint(m),this.pos+=m},writeMessage:function(o,n,u){this.writeTag(o,gi.Bytes),this.writeRawMessage(n,u)},writePackedVarint:function(o,n){n.length&&this.writeMessage(o,Y1,n)},writePackedSVarint:function(o,n){n.length&&this.writeMessage(o,J1,n)},writePackedBoolean:function(o,n){n.length&&this.writeMessage(o,eb,n)},writePackedFloat:function(o,n){n.length&&this.writeMessage(o,K1,n)},writePackedDouble:function(o,n){n.length&&this.writeMessage(o,Q1,n)},writePackedFixed32:function(o,n){n.length&&this.writeMessage(o,tb,n)},writePackedSFixed32:function(o,n){n.length&&this.writeMessage(o,nb,n)},writePackedFixed64:function(o,n){n.length&&this.writeMessage(o,ib,n)},writePackedSFixed64:function(o,n){n.length&&this.writeMessage(o,rb,n)},writeBytesField:function(o,n){this.writeTag(o,gi.Bytes),this.writeBytes(n)},writeFixed32Field:function(o,n){this.writeTag(o,gi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(o,n){this.writeTag(o,gi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(o,n){this.writeTag(o,gi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(o,n){this.writeTag(o,gi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(o,n){this.writeTag(o,gi.Varint),this.writeVarint(n)},writeSVarintField:function(o,n){this.writeTag(o,gi.Varint),this.writeSVarint(n)},writeStringField:function(o,n){this.writeTag(o,gi.Bytes),this.writeString(n)},writeFloatField:function(o,n){this.writeTag(o,gi.Fixed32),this.writeFloat(n)},writeDoubleField:function(o,n){this.writeTag(o,gi.Fixed64),this.writeDouble(n)},writeBooleanField:function(o,n){this.writeVarintField(o,!!n)}};var Pd=x(Um);const Rd=3;function sb(o,n,u){o===1&&u.readMessage(ob,n)}function ob(o,n,u){if(o===3){const{id:m,bitmap:v,width:S,height:T,left:A,top:R,advance:O}=u.readMessage(ab,{});n.push({id:m,bitmap:new Wc({width:S+2*Rd,height:T+2*Rd},v),metrics:{width:S,height:T,left:A,top:R,advance:O}})}}function ab(o,n,u){o===1?n.id=u.readVarint():o===2?n.bitmap=u.readBytes():o===3?n.width=u.readVarint():o===4?n.height=u.readVarint():o===5?n.left=u.readSVarint():o===6?n.top=u.readSVarint():o===7&&(n.advance=u.readVarint())}const Wm=Rd;function Xm(o){let n=0,u=0;for(const T of o)n+=T.w*T.h,u=Math.max(u,T.w);o.sort((T,A)=>A.h-T.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),u),h:1/0}];let v=0,S=0;for(const T of o)for(let A=m.length-1;A>=0;A--){const R=m[A];if(!(T.w>R.w||T.h>R.h)){if(T.x=R.x,T.y=R.y,S=Math.max(S,T.y+T.h),v=Math.max(v,T.x+T.w),T.w===R.w&&T.h===R.h){const O=m.pop();A<m.length&&(m[A]=O)}else T.h===R.h?(R.x+=T.w,R.w-=T.w):T.w===R.w?(R.y+=T.h,R.h-=T.h):(m.push({x:R.x+T.w,y:R.y,w:R.w-T.w,h:T.h}),R.y+=T.h,R.h-=T.h);break}}return{w:v,h:S,fill:n/(v*S)||0}}const Es=1;class Dd{constructor(n,{pixelRatio:u,version:m,stretchX:v,stretchY:S,content:T,textFitWidth:A,textFitHeight:R}){this.paddedRect=n,this.pixelRatio=u,this.stretchX=v,this.stretchY=S,this.content=T,this.version=m,this.textFitWidth=A,this.textFitHeight=R}get tl(){return[this.paddedRect.x+Es,this.paddedRect.y+Es]}get br(){return[this.paddedRect.x+this.paddedRect.w-Es,this.paddedRect.y+this.paddedRect.h-Es]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Es)/this.pixelRatio,(this.paddedRect.h-2*Es)/this.pixelRatio]}}class $m{constructor(n,u){const m={},v={};this.haveRenderCallbacks=[];const S=[];this.addImages(n,m,S),this.addImages(u,v,S);const{w:T,h:A}=Xm(S),R=new Xs({width:T||1,height:A||1});for(const O in n){const j=n[O],G=m[O].paddedRect;Xs.copy(j.data,R,{x:0,y:0},{x:G.x+Es,y:G.y+Es},j.data)}for(const O in u){const j=u[O],G=v[O].paddedRect,X=G.x+Es,ee=G.y+Es,se=j.data.width,pe=j.data.height;Xs.copy(j.data,R,{x:0,y:0},{x:X,y:ee},j.data),Xs.copy(j.data,R,{x:0,y:pe-1},{x:X,y:ee-1},{width:se,height:1}),Xs.copy(j.data,R,{x:0,y:0},{x:X,y:ee+pe},{width:se,height:1}),Xs.copy(j.data,R,{x:se-1,y:0},{x:X-1,y:ee},{width:1,height:pe}),Xs.copy(j.data,R,{x:0,y:0},{x:X+se,y:ee},{width:1,height:pe})}this.image=R,this.iconPositions=m,this.patternPositions=v}addImages(n,u,m){for(const v in n){const S=n[v],T={x:0,y:0,w:S.data.width+2*Es,h:S.data.height+2*Es};m.push(T),u[v]=new Dd(T,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(n,u){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in n.updatedImages)this.patchUpdatedImage(this.iconPositions[m],n.getImage(m),u),this.patchUpdatedImage(this.patternPositions[m],n.getImage(m),u)}patchUpdatedImage(n,u,m){if(!n||!u||n.version===u.version)return;n.version=u.version;const[v,S]=n.tl;m.update(u.data,void 0,{x:v,y:S})}}var ll;Qt("ImagePosition",Dd),Qt("ImageAtlas",$m),g.ah=void 0,(ll=g.ah||(g.ah={}))[ll.none=0]="none",ll[ll.horizontal=1]="horizontal",ll[ll.vertical=2]="vertical",ll[ll.horizontalOnly=3]="horizontalOnly";const eh=-17;class th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,u){const m=new th;return m.scale=n||1,m.fontStack=u,m}static forImage(n){const u=new th;return u.imageName=n,u}}class Nu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,u){const m=new Nu;for(let v=0;v<n.sections.length;v++){const S=n.sections[v];S.image?m.addImageSection(S):m.addTextSection(S,u)}return m}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let u="";for(let m=0;m<n.length;m++){const v=n.charCodeAt(m+1)||null,S=n.charCodeAt(m-1)||null;u+=v&&Gh(v)&&!Qc[n[m+1]]||S&&Gh(S)&&!Qc[n[m-1]]||!Qc[n[m]]?n[m]:Qc[n[m]]}return u}(this.text)}trim(){let n=0;for(let m=0;m<this.text.length&&af[this.text.charCodeAt(m)];m++)n++;let u=this.text.length;for(let m=this.text.length-1;m>=0&&m>=n&&af[this.text.charCodeAt(m)];m--)u--;this.text=this.text.substring(n,u),this.sectionIndex=this.sectionIndex.slice(n,u)}substring(n,u){const m=new Nu;return m.text=this.text.substring(n,u),m.sectionIndex=this.sectionIndex.slice(n,u),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,u)=>Math.max(n,this.sections[u].scale),0)}addTextSection(n,u){this.text+=n.text,this.sections.push(th.forText(n.scale,n.fontStack||u));const m=this.sections.length-1;for(let v=0;v<n.text.length;++v)this.sectionIndex.push(m)}addImageSection(n){const u=n.image?n.image.name:"";if(u.length===0)return void ze("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(th.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ze("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function of(o,n,u,m,v,S,T,A,R,O,j,G,X,ee,se){const pe=Nu.fromFeature(o,v);let Le;G===g.ah.vertical&&pe.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:tt}=Is;if(De&&pe.sections.length===1){Le=[];const ht=De(pe.toString(),Nd(pe,O,S,n,m,ee));for(const Et of ht){const $t=new Nu;$t.text=Et,$t.sections=pe.sections;for(let yn=0;yn<Et.length;yn++)$t.sectionIndex.push(0);Le.push($t)}}else if(tt){Le=[];const ht=tt(pe.text,pe.sectionIndex,Nd(pe,O,S,n,m,ee));for(const Et of ht){const $t=new Nu;$t.text=Et[0],$t.sectionIndex=Et[1],$t.sections=pe.sections,Le.push($t)}}else Le=function(ht,Et){const $t=[],yn=ht.text;let Wt=0;for(const Zt of Et)$t.push(ht.substring(Wt,Zt)),Wt=Zt;return Wt<yn.length&&$t.push(ht.substring(Wt,yn.length)),$t}(pe,Nd(pe,O,S,n,m,ee));const Ge=[],Qe={positionedLines:Ge,text:pe.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(ht,Et,$t,yn,Wt,Zt,on,tn,Kt,yt,cn,sn){let Sn=0,vi=eh,_i=0,vr=0;const fo=tn==="right"?1:tn==="left"?0:.5;let Br=0;for(const Gi of Wt){Gi.trim();const xr=Gi.getMaxScale(),$r=(xr-1)*pr,Ur={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Br]=Ur;const cs=Ur.positionedGlyphs;let jr=0;if(!Gi.length()){vi+=Zt,++Br;continue}for(let Ts=0;Ts<Gi.length();Ts++){const si=Gi.getSection(Ts),xi=Gi.getSectionIndex(Ts),Ci=Gi.getCharCode(Ts);let Bs=0,Ui=null,Bu=null,na=null,ia=pr;const po=!(Kt===g.ah.horizontal||!cn&&!Uc(Ci)||cn&&(af[Ci]||(br=Ci,/\p{sc=Arab}/u.test(String.fromCodePoint(br)))));if(si.imageName){const Js=yn[si.imageName];if(!Js)continue;na=si.imageName,ht.iconsInText=ht.iconsInText||!0,Bu=Js.paddedRect;const Rr=Js.displaySize;si.scale=si.scale*pr/sn,Ui={width:Rr[0],height:Rr[1],left:Es,top:-Wm,advance:po?Rr[1]:Rr[0]},Bs=$r+(pr-Rr[1]*si.scale),ia=Ui.advance;const Ta=po?Rr[0]*si.scale-pr*xr:Rr[1]*si.scale-pr*xr;Ta>0&&Ta>jr&&(jr=Ta)}else{const Js=$t[si.fontStack],Rr=Js&&Js[Ci];if(Rr&&Rr.rect)Bu=Rr.rect,Ui=Rr.metrics;else{const Ta=Et[si.fontStack],ah=Ta&&Ta[Ci];if(!ah)continue;Ui=ah.metrics}Bs=(xr-si.scale)*pr}po?(ht.verticalizable=!0,cs.push({glyph:Ci,imageName:na,x:Sn,y:vi+Bs,vertical:po,scale:si.scale,fontStack:si.fontStack,sectionIndex:xi,metrics:Ui,rect:Bu}),Sn+=ia*si.scale+yt):(cs.push({glyph:Ci,imageName:na,x:Sn,y:vi+Bs,vertical:po,scale:si.scale,fontStack:si.fontStack,sectionIndex:xi,metrics:Ui,rect:Bu}),Sn+=Ui.advance*si.scale+yt)}cs.length!==0&&(_i=Math.max(Sn-yt,_i),hb(cs,0,cs.length-1,fo,jr)),Sn=0;const Ys=Zt*xr+jr;Ur.lineOffset=Math.max(jr,$r),vi+=Ys,vr=Math.max(Ys,vr),++Br}var br;const as=vi-eh,{horizontalAlign:ls,verticalAlign:us}=zd(on);(function(Gi,xr,$r,Ur,cs,jr,Ys,Ts,si){const xi=(xr-$r)*cs;let Ci=0;Ci=jr!==Ys?-Ts*Ur-eh:(-Ur*si+.5)*Ys;for(const Bs of Gi)for(const Ui of Bs.positionedGlyphs)Ui.x+=xi,Ui.y+=Ci})(ht.positionedLines,fo,ls,us,_i,vr,Zt,as,Wt.length),ht.top+=-us*as,ht.bottom=ht.top+as,ht.left+=-ls*_i,ht.right=ht.left+_i}(Qe,n,u,m,Le,T,A,R,G,O,X,se),!function(ht){for(const Et of ht)if(Et.positionedGlyphs.length!==0)return!1;return!0}(Ge)&&Qe}const af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ub={40:!0};function Ym(o,n,u,m,v,S){if(n.imageName){const T=m[n.imageName];return T?T.displaySize[0]*n.scale*pr/S+v:0}{const T=u[n.fontStack],A=T&&T[o];return A?A.metrics.advance*n.scale+v:0}}function Jm(o,n,u,m){const v=Math.pow(o-n,2);return m?o<n?v/2:2*v:v+Math.abs(u)*u}function cb(o,n,u){let m=0;return o===10&&(m-=1e4),u&&(m+=150),o!==40&&o!==65288||(m+=50),n!==41&&n!==65289||(m+=50),m}function Km(o,n,u,m,v,S){let T=null,A=Jm(n,u,v,S);for(const R of m){const O=Jm(n-R.x,u,v,S)+R.badness;O<=A&&(T=R,A=O)}return{index:o,x:n,priorBreak:T,badness:A}}function Qm(o){return o?Qm(o.priorBreak).concat(o.index):[]}function Nd(o,n,u,m,v,S){if(!o)return[];const T=[],A=function(G,X,ee,se,pe,Le){let De=0;for(let tt=0;tt<G.length();tt++){const Ge=G.getSection(tt);De+=Ym(G.getCharCode(tt),Ge,se,pe,X,Le)}return De/Math.max(1,Math.ceil(De/ee))}(o,n,u,m,v,S),R=o.text.indexOf("")>=0;let O=0;for(let G=0;G<o.length();G++){const X=o.getSection(G),ee=o.getCharCode(G);if(af[ee]||(O+=Ym(ee,X,m,v,n,S)),G<o.length()-1){const se=!((j=ee)<11904)&&(!!qn["CJK Compatibility Forms"](j)||!!qn["CJK Compatibility"](j)||!!qn["CJK Strokes"](j)||!!qn["CJK Symbols and Punctuation"](j)||!!qn["Enclosed CJK Letters and Months"](j)||!!qn["Halfwidth and Fullwidth Forms"](j)||!!qn["Ideographic Description Characters"](j)||!!qn["Vertical Forms"](j)||qh.test(String.fromCodePoint(j)));(lb[ee]||se||X.imageName||G!==o.length()-2&&ub[o.getCharCode(G+1)])&&T.push(Km(G+1,O,A,T,cb(ee,o.getCharCode(G+1),se&&R),!1))}}var j;return Qm(Km(o.length(),O,A,T,0,!0))}function zd(o){let n=.5,u=.5;switch(o){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:n,verticalAlign:u}}function hb(o,n,u,m,v){if(!m&&!v)return;const S=o[u],T=(o[u].x+S.metrics.advance*S.scale)*m;for(let A=n;A<=u;A++)o[A].x-=T,o[A].y+=v}function fb(o,n,u){const{horizontalAlign:m,verticalAlign:v}=zd(u),S=n[0]-o.displaySize[0]*m,T=n[1]-o.displaySize[1]*v;return{image:o,top:T,bottom:T+o.displaySize[1],left:S,right:S+o.displaySize[0]}}function eg(o){var n,u;let m=o.left,v=o.top,S=o.right-m,T=o.bottom-v;const A=(n=o.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",R=(u=o.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",O=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(R==="proportional"){if(A==="stretchOnly"&&S/T<O||A==="proportional"){const j=Math.ceil(T*O);m*=j/S,S=j}}else if(A==="proportional"&&R==="stretchOnly"&&O!==0&&S/T>O){const j=Math.ceil(S/O);v*=j/T,T=j}return{x1:m,y1:v,x2:m+S,y2:v+T}}function tg(o,n,u,m,v,S){const T=o.image;let A;if(T.content){const Le=T.content,De=T.pixelRatio||1;A=[Le[0]/De,Le[1]/De,T.displaySize[0]-Le[2]/De,T.displaySize[1]-Le[3]/De]}const R=n.left*S,O=n.right*S;let j,G,X,ee;u==="width"||u==="both"?(ee=v[0]+R-m[3],G=v[0]+O+m[1]):(ee=v[0]+(R+O-T.displaySize[0])/2,G=ee+T.displaySize[0]);const se=n.top*S,pe=n.bottom*S;return u==="height"||u==="both"?(j=v[1]+se-m[0],X=v[1]+pe+m[2]):(j=v[1]+(se+pe-T.displaySize[1])/2,X=j+T.displaySize[1]),{image:T,top:j,right:G,bottom:X,left:ee,collisionPadding:A}}const nh=255,ta=128,ul=nh*ta;function ng(o,n){const{expression:u}=n;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ii(o+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:v}=u;let S=0;for(;S<m.length&&m[S]<=o;)S++;S=Math.max(0,S-1);let T=S;for(;T<m.length&&m[T]<o+1;)T++;T=Math.min(m.length-1,T);const A=m[S],R=m[T];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:R,interpolationType:v}:{kind:"camera",minZoom:A,maxZoom:R,minSize:u.evaluate(new Ii(A)),maxSize:u.evaluate(new Ii(R)),interpolationType:v}}}function Od(o,n,u){let m="never";const v=o.get(n);return v?m=v:o.get(u)&&(m="always"),m}const db=al.VectorTileFeature.types,pb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lf(o,n,u,m,v,S,T,A,R,O,j,G,X){const ee=A?Math.min(ul,Math.round(A[0])):0,se=A?Math.min(ul,Math.round(A[1])):0;o.emplaceBack(n,u,Math.round(32*m),Math.round(32*v),S,T,(ee<<1)+(R?1:0),se,16*O,16*j,256*G,256*X)}function Fd(o,n,u){o.emplaceBack(n.x,n.y,u),o.emplaceBack(n.x,n.y,u),o.emplaceBack(n.x,n.y,u),o.emplaceBack(n.x,n.y,u)}function mb(o){for(const n of o.sections)if(fd(n.text))return!0;return!1}class Bd{constructor(n){this.layoutVertexArray=new Iu,this.indexArray=new Ws,this.programConfigurations=n,this.segments=new Gn,this.dynamicLayoutVertexArray=new qc,this.opacityVertexArray=new Os,this.hasVisibleVertices=!1,this.placedSymbolArray=new Si}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,u,m,v){this.isEmpty()||(m&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Z1.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,H1.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,pb,!0),this.opacityVertexBuffer.itemSize=1),(m||v)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qt("SymbolBuffers",Bd);class Ud{constructor(n,u,m){this.layoutVertexArray=new n,this.layoutAttributes=u,this.indexArray=new m,this.segments=new Gn,this.collisionVertexArray=new Qo}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,W1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Qt("CollisionBuffers",Ud);class zu{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(T=>T.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vd([]),this.placementViewportMatrix=vd([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ng(this.zoom,u["text-size"]),this.iconSizeData=ng(this.zoom,u["icon-size"]);const m=this.layers[0].layout,v=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=Od(m,"text-overlap","text-allow-overlap")!=="never"||Od(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(T=>g.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=n.sourceID}createArrays(){this.text=new Bd(new Hl(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Bd(new Hl(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Ei,this.lineVertexArray=new Nr,this.symbolInstances=new jn,this.textAnchorOffsets=new Ti}calculateGlyphDependencies(n,u,m,v,S){for(let T=0;T<n.length;T++)if(u[n.charCodeAt(T)]=!0,(m||v)&&S){const A=Qc[n.charAt(T)];A&&(u[A.charCodeAt(0)]=!0)}}populate(n,u,m){const v=this.layers[0],S=v.layout,T=S.get("text-font"),A=S.get("text-field"),R=S.get("icon-image"),O=(A.value.kind!=="constant"||A.value.value instanceof Cr&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),j=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,G=S.get("symbol-sort-key");if(this.features=[],!O&&!j)return;const X=u.iconDependencies,ee=u.glyphDependencies,se=u.availableImages,pe=new Ii(this.zoom);for(const{feature:Le,id:De,index:tt,sourceLayerIndex:Ge}of n){const Qe=v._featureFilter.needGeometry,ht=Xl(Le,Qe);if(!v._featureFilter.filter(pe,ht,m))continue;let Et,$t;if(Qe||(ht.geometry=Wl(Le)),O){const Wt=v.getValueAndResolveTokens("text-field",ht,m,se),Zt=Cr.factory(Wt),on=this.hasRTLText=this.hasRTLText||mb(Zt);(!on||Is.getRTLTextPluginStatus()==="unavailable"||on&&Is.isParsed())&&(Et=$1(Zt,v,ht))}if(j){const Wt=v.getValueAndResolveTokens("icon-image",ht,m,se);$t=Wt instanceof or?Wt:or.fromString(Wt)}if(!Et&&!$t)continue;const yn=this.sortFeaturesByKey?G.evaluate(ht,{},m):void 0;if(this.features.push({id:De,text:Et,icon:$t,index:tt,sourceLayerIndex:Ge,geometry:ht.geometry,properties:Le.properties,type:db[Le.type],sortKey:yn}),$t&&(X[$t.name]=!0),Et){const Wt=T.evaluate(ht,{},m).join(","),Zt=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.ah.vertical)>=0;for(const on of Et.sections)if(on.image)X[on.image.name]=!0;else{const tn=Fc(Et.toString()),Kt=on.fontStack||Wt,yt=ee[Kt]=ee[Kt]||{};this.calculateGlyphDependencies(on.text,yt,Zt,this.allowVerticalPlacement,tn)}}}S.get("symbol-placement")==="line"&&(this.features=function(Le){const De={},tt={},Ge=[];let Qe=0;function ht(Wt){Ge.push(Le[Wt]),Qe++}function Et(Wt,Zt,on){const tn=tt[Wt];return delete tt[Wt],tt[Zt]=tn,Ge[tn].geometry[0].pop(),Ge[tn].geometry[0]=Ge[tn].geometry[0].concat(on[0]),tn}function $t(Wt,Zt,on){const tn=De[Zt];return delete De[Zt],De[Wt]=tn,Ge[tn].geometry[0].shift(),Ge[tn].geometry[0]=on[0].concat(Ge[tn].geometry[0]),tn}function yn(Wt,Zt,on){const tn=on?Zt[0][Zt[0].length-1]:Zt[0][0];return`${Wt}:${tn.x}:${tn.y}`}for(let Wt=0;Wt<Le.length;Wt++){const Zt=Le[Wt],on=Zt.geometry,tn=Zt.text?Zt.text.toString():null;if(!tn){ht(Wt);continue}const Kt=yn(tn,on),yt=yn(tn,on,!0);if(Kt in tt&&yt in De&&tt[Kt]!==De[yt]){const cn=$t(Kt,yt,on),sn=Et(Kt,yt,Ge[cn].geometry);delete De[Kt],delete tt[yt],tt[yn(tn,Ge[sn].geometry,!0)]=sn,Ge[cn].geometry=null}else Kt in tt?Et(Kt,yt,on):yt in De?$t(Kt,yt,on):(ht(Wt),De[Kt]=Qe-1,tt[yt]=Qe-1)}return Ge.filter(Wt=>Wt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Le,De)=>Le.sortKey-De.sortKey)}update(n,u,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,u,this.layers,m),this.icon.programConfigurations.updatePaintArrays(n,u,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,u){const m=this.lineVertexArray.length;if(n.segment!==void 0){let v=n.dist(u[n.segment+1]),S=n.dist(u[n.segment]);const T={};for(let A=n.segment+1;A<u.length;A++)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:v},A<u.length-1&&(v+=u[A+1].dist(u[A]));for(let A=n.segment||0;A>=0;A--)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:S},A>0&&(S+=u[A-1].dist(u[A]));for(let A=0;A<u.length;A++){const R=T[A];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(n,u,m,v,S,T,A,R,O,j,G,X){const ee=n.indexArray,se=n.layoutVertexArray,pe=n.segments.prepareSegment(4*u.length,se,ee,this.canOverlap?T.sortKey:void 0),Le=this.glyphOffsetArray.length,De=pe.vertexLength,tt=this.allowVerticalPlacement&&A===g.ah.vertical?Math.PI/2:0,Ge=T.text&&T.text.sections;for(let Qe=0;Qe<u.length;Qe++){const{tl:ht,tr:Et,bl:$t,br:yn,tex:Wt,pixelOffsetTL:Zt,pixelOffsetBR:on,minFontScaleX:tn,minFontScaleY:Kt,glyphOffset:yt,isSDF:cn,sectionIndex:sn}=u[Qe],Sn=pe.vertexLength,vi=yt[1];lf(se,R.x,R.y,ht.x,vi+ht.y,Wt.x,Wt.y,m,cn,Zt.x,Zt.y,tn,Kt),lf(se,R.x,R.y,Et.x,vi+Et.y,Wt.x+Wt.w,Wt.y,m,cn,on.x,Zt.y,tn,Kt),lf(se,R.x,R.y,$t.x,vi+$t.y,Wt.x,Wt.y+Wt.h,m,cn,Zt.x,on.y,tn,Kt),lf(se,R.x,R.y,yn.x,vi+yn.y,Wt.x+Wt.w,Wt.y+Wt.h,m,cn,on.x,on.y,tn,Kt),Fd(n.dynamicLayoutVertexArray,R,tt),ee.emplaceBack(Sn,Sn+1,Sn+2),ee.emplaceBack(Sn+1,Sn+2,Sn+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),Qe!==u.length-1&&sn===u[Qe+1].sectionIndex||n.programConfigurations.populatePaintArrays(se.length,T,T.index,{},X,Ge&&Ge[sn])}n.placedSymbolArray.emplaceBack(R.x,R.y,Le,this.glyphOffsetArray.length-Le,De,O,j,R.segment,m?m[0]:0,m?m[1]:0,v[0],v[1],A,0,!1,0,G)}_addCollisionDebugVertex(n,u,m,v,S,T){return u.emplaceBack(0,0),n.emplaceBack(m.x,m.y,v,S,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(n,u,m,v,S,T,A){const R=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),O=R.vertexLength,j=S.layoutVertexArray,G=S.collisionVertexArray,X=A.anchorX,ee=A.anchorY;this._addCollisionDebugVertex(j,G,T,X,ee,new L(n,u)),this._addCollisionDebugVertex(j,G,T,X,ee,new L(m,u)),this._addCollisionDebugVertex(j,G,T,X,ee,new L(m,v)),this._addCollisionDebugVertex(j,G,T,X,ee,new L(n,v)),R.vertexLength+=4;const se=S.indexArray;se.emplaceBack(O,O+1),se.emplaceBack(O+1,O+2),se.emplaceBack(O+2,O+3),se.emplaceBack(O+3,O),R.primitiveLength+=4}addDebugCollisionBoxes(n,u,m,v){for(let S=n;S<u;S++){const T=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,v?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ud(Fs,Bm.members,Pr),this.iconCollisionBox=new Ud(Fs,Bm.members,Pr);for(let n=0;n<this.symbolInstances.length;n++){const u=this.symbolInstances.get(n);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(n,u,m,v,S,T,A,R,O){const j={};for(let G=u;G<m;G++){const X=n.get(G);j.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.textFeatureIndex=X.featureIndex;break}for(let G=v;G<S;G++){const X=n.get(G);j.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.verticalTextFeatureIndex=X.featureIndex;break}for(let G=T;G<A;G++){const X=n.get(G);j.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.iconFeatureIndex=X.featureIndex;break}for(let G=R;G<O;G++){const X=n.get(G);j.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.verticalIconFeatureIndex=X.featureIndex;break}return j}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,u){const m=n.placedSymbolArray.get(u),v=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<v;S+=4)n.indexArray.emplaceBack(S,S+1,S+2),n.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(n),m=Math.cos(n),v=[],S=[],T=[];for(let A=0;A<this.symbolInstances.length;++A){T.push(A);const R=this.symbolInstances.get(A);v.push(0|Math.round(u*R.anchorX+m*R.anchorY)),S.push(R.featureIndex)}return T.sort((A,R)=>v[A]-v[R]||S[R]-S[A]),T}addToSortKeyRanges(n,u){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===u?m.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const m=this.symbolInstances.get(u);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((v,S,T)=>{v>=0&&T.indexOf(v)===S&&this.addIndicesForPlacedSymbol(this.text,v)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ig,rg;Qt("SymbolBucket",zu,{omit:["layers","collisionBoxArray","features","compareText"]}),zu.MAX_GLYPHS=65535,zu.addDynamicAttributes=Fd;var jd={get paint(){return rg=rg||new k({"icon-opacity":new vn(Ye.paint_symbol["icon-opacity"]),"icon-color":new vn(Ye.paint_symbol["icon-color"]),"icon-halo-color":new vn(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new vn(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vn(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new nn(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new nn(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new vn(Ye.paint_symbol["text-opacity"]),"text-color":new vn(Ye.paint_symbol["text-color"],{runtimeType:_r,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new vn(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new vn(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new vn(Ye.paint_symbol["text-halo-blur"]),"text-translate":new nn(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new nn(Ye.paint_symbol["text-translate-anchor"])})},get layout(){return ig=ig||new k({"symbol-placement":new nn(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new nn(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nn(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vn(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nn(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nn(Ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nn(Ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nn(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new nn(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nn(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new vn(Ye.layout_symbol["icon-size"]),"icon-text-fit":new nn(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nn(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new vn(Ye.layout_symbol["icon-image"]),"icon-rotate":new vn(Ye.layout_symbol["icon-rotate"]),"icon-padding":new vn(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new nn(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new vn(Ye.layout_symbol["icon-offset"]),"icon-anchor":new vn(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nn(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nn(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nn(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new vn(Ye.layout_symbol["text-field"]),"text-font":new vn(Ye.layout_symbol["text-font"]),"text-size":new vn(Ye.layout_symbol["text-size"]),"text-max-width":new vn(Ye.layout_symbol["text-max-width"]),"text-line-height":new nn(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new vn(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new vn(Ye.layout_symbol["text-justify"]),"text-radial-offset":new vn(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nn(Ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new vn(Ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new vn(Ye.layout_symbol["text-anchor"]),"text-max-angle":new nn(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new nn(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new vn(Ye.layout_symbol["text-rotate"]),"text-padding":new nn(Ye.layout_symbol["text-padding"]),"text-keep-upright":new nn(Ye.layout_symbol["text-keep-upright"]),"text-transform":new vn(Ye.layout_symbol["text-transform"]),"text-offset":new vn(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new nn(Ye.layout_symbol["text-allow-overlap"]),"text-overlap":new nn(Ye.layout_symbol["text-overlap"]),"text-ignore-placement":new nn(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new nn(Ye.layout_symbol["text-optional"])})}};class sg{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:As,this.defaultValue=n}evaluate(n){if(n.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(n.formattedSection))return u.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt("FormatSectionOverride",sg,{omit:["defaultValue"]});class uf extends h{constructor(n){super(n,jd)}recalculate(n,u){if(super.recalculate(n,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const v=[];for(const S of m)v.indexOf(S)<0&&v.push(S);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,u,m,v){const S=this.layout.get(n).evaluate(u,{},m,v),T=this._unevaluatedLayout._values[n];return T.isDataDriven()||b(T.value)||!S?S:function(A,R){return R.replace(/{([^{}]+)}/g,(O,j)=>A&&j in A?String(A[j]):"")}(u.properties,S)}createBucket(n){return new zu(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of jd.paint.overridableProperties){if(!uf.hasPaintOverride(this.layout,n))continue;const u=this.paint.get(n),m=new sg(u),v=new p(m,u.property.specification);let S=null;S=u.value.kind==="constant"||u.value.kind==="source"?new F("source",v):new q("composite",v,u.value.zoomStops),this.paint._values[n]=new co(u.property,S,u.parameters)}}_handleOverridablePaintPropertyUpdate(n,u,m){return!(!this.layout||u.isDataDriven()||m.isDataDriven())&&uf.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,u){const m=n.get("text-field"),v=jd.paint.properties[u];let S=!1;const T=A=>{for(const R of A)if(v.overrides&&v.overrides.hasOverride(R))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Cr)T(m.value.value.sections);else if(m.value.kind==="source"){const A=O=>{S||(O instanceof _s&&Ri(O.value)===Er?T(O.value.sections):O instanceof ga?T(O.sections):O.eachChild(A))},R=m.value;R._styleExpression&&A(R._styleExpression.expression)}return S}}let og;var gb={get paint(){return og=og||new k({"background-color":new nn(Ye.paint_background["background-color"]),"background-pattern":new wu(Ye.paint_background["background-pattern"]),"background-opacity":new nn(Ye.paint_background["background-opacity"])})}};class _b extends h{constructor(n){super(n,gb)}}let ag;var yb={get paint(){return ag=ag||new k({"raster-opacity":new nn(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new nn(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nn(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nn(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new nn(Ye.paint_raster["raster-saturation"]),"raster-contrast":new nn(Ye.paint_raster["raster-contrast"]),"raster-resampling":new nn(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new nn(Ye.paint_raster["raster-fade-duration"])})}};class vb extends h{constructor(n){super(n,yb)}}class bb extends h{constructor(n){super(n,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class xb{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Vd=63710088e-1;class cl{constructor(n,u){if(isNaN(n)||isNaN(u))throw new Error(`Invalid LngLat object: (${n}, ${u})`);if(this.lng=+n,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cl(Pe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const u=Math.PI/180,m=this.lat*u,v=n.lat*u,S=Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos((n.lng-this.lng)*u);return Vd*Math.acos(Math.min(S,1))}static convert(n){if(n instanceof cl)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new cl(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new cl(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lg=2*Math.PI*Vd;function ug(o){return lg*Math.cos(o*Math.PI/180)}function cg(o){return(180+o)/360}function hg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function fg(o,n){return o/ug(n)}function qd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class ih{constructor(n,u,m=0){this.x=+n,this.y=+u,this.z=+m}static fromLngLat(n,u=0){const m=cl.convert(n);return new ih(cg(m.lng),hg(m.lat),fg(u,m.lat))}toLngLat(){return new cl(360*this.x-180,qd(this.y))}toAltitude(){return this.z*ug(qd(this.y))}meterInMercatorCoordinateUnits(){return 1/lg*(n=qd(this.y),1/Math.cos(n*Math.PI/180));var n}}function dg(o,n,u){var m=2*Math.PI*6378137/256/Math.pow(2,u);return[o*m-2*Math.PI*6378137/2,n*m-2*Math.PI*6378137/2]}class Gd{constructor(n,u,m){if(!function(v,S,T){return!(v<0||v>25||T<0||T>=Math.pow(2,v)||S<0||S>=Math.pow(2,v))}(n,u,m))throw new Error(`x=${u}, y=${m}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=u,this.y=m,this.key=rh(0,n,n,u,m)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,u,m){const v=(T=this.y,A=this.z,R=dg(256*(S=this.x),256*(T=Math.pow(2,A)-T-1),A),O=dg(256*(S+1),256*(T+1),A),R[0]+","+R[1]+","+O[0]+","+O[1]);var S,T,A,R,O;const j=function(G,X,ee){let se,pe="";for(let Le=G;Le>0;Le--)se=1<<Le-1,pe+=(X&se?1:0)+(ee&se?2:0);return pe}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,v)}isChildOf(n){const u=this.z-n.z;return u>0&&n.x===this.x>>u&&n.y===this.y>>u}getTilePoint(n){const u=Math.pow(2,this.z);return new L((n.x*u-this.x)*ar,(n.y*u-this.y)*ar)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pg{constructor(n,u){this.wrap=n,this.canonical=u,this.key=rh(n,u.z,u.z,u.x,u.y)}}class $s{constructor(n,u,m,v,S){if(n<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${m}`);this.overscaledZ=n,this.wrap=u,this.canonical=new Gd(m,+v,+S),this.key=rh(u,n,m,v,S)}clone(){return new $s(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-n;return n>this.canonical.z?new $s(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $s(n,this.wrap,n,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(n,u){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-n;return n>this.canonical.z?rh(this.wrap*+u,n,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+u,n,n,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const u=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>u&&n.canonical.y===this.canonical.y>>u}children(n){if(this.overscaledZ>=n)return[new $s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,m=2*this.canonical.x,v=2*this.canonical.y;return[new $s(u,this.wrap,u,m,v),new $s(u,this.wrap,u,m+1,v),new $s(u,this.wrap,u,m,v+1),new $s(u,this.wrap,u,m+1,v+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new $s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new $s(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new ih(n.x-this.wrap,n.y))}}function rh(o,n,u,m,v){(o*=2)<0&&(o=-1*o-1);const S=1<<u;return(S*S*o+S*v+m).toString(36)+u.toString(36)+n.toString(36)}Qt("CanonicalTileID",Gd),Qt("OverscaledTileID",$s,{omit:["posMatrix"]});class mg{constructor(n,u,m,v=1,S=1,T=1,A=0){if(this.uid=n,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void ze(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const R=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=S,this.blueFactor=T,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<R;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(R,O)]=this.data[this._idx(R-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,R)]=this.data[this._idx(O,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<R;O++)for(let j=0;j<R;j++){const G=this.get(O,j);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(n,u){const m=new Uint8Array(this.data.buffer),v=4*this._idx(n,u);return this.unpack(m[v],m[v+1],m[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,u){if(n<-1||n>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(n+1)}unpack(n,u,m){return n*this.redFactor+u*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Xs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,u,m){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let v=u*this.dim,S=u*this.dim+this.dim,T=m*this.dim,A=m*this.dim+this.dim;switch(u){case-1:v=S-1;break;case 1:S=v+1}switch(m){case-1:T=A-1;break;case 1:A=T+1}const R=-u*this.dim,O=-m*this.dim;for(let j=T;j<A;j++)for(let G=v;G<S;G++)this.data[this._idx(G,j)]=n.data[this._idx(G+R,j+O)]}}Qt("DEMData",mg);class gg{constructor(n){this._stringToNumber={},this._numberToString=[];for(let u=0;u<n.length;u++){const m=n[u];this._stringToNumber[m]=u,this._numberToString[u]=m}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class _g{constructor(n,u,m,v,S){this.type="Feature",this._vectorTileFeature=n,n._z=u,n._x=m,n._y=v,this.properties=n.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(n[u]=this[u]);return n}}class yg{constructor(n,u){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Ya(ar,16,0),this.grid3D=new Ya(ar,16,0),this.featureIndexArray=new Wr,this.promoteId=u}insert(n,u,m,v,S,T){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,v,S);const R=T?this.grid3D:this.grid;for(let O=0;O<u.length;O++){const j=u[O],G=[1/0,1/0,-1/0,-1/0];for(let X=0;X<j.length;X++){const ee=j[X];G[0]=Math.min(G[0],ee.x),G[1]=Math.min(G[1],ee.y),G[2]=Math.max(G[2],ee.x),G[3]=Math.max(G[3],ee.y)}G[0]<ar&&G[1]<ar&&G[2]>=0&&G[3]>=0&&R.insert(A,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new al.VectorTile(new Pd(this.rawTileData)).layers,this.sourceLayerCoder=new gg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,u,m,v){this.loadVTLayers();const S=n.params||{},T=ar/n.tileSize/n.scale,A=zt(S.filter),R=n.queryGeometry,O=n.queryPadding*T,j=bg(R),G=this.grid.query(j.minX-O,j.minY-O,j.maxX+O,j.maxY+O),X=bg(n.cameraQueryGeometry),ee=this.grid3D.query(X.minX-O,X.minY-O,X.maxX+O,X.maxY+O,(Le,De,tt,Ge)=>function(Qe,ht,Et,$t,yn){for(const Zt of Qe)if(ht<=Zt.x&&Et<=Zt.y&&$t>=Zt.x&&yn>=Zt.y)return!0;const Wt=[new L(ht,Et),new L(ht,yn),new L($t,yn),new L($t,Et)];if(Qe.length>2){for(const Zt of Wt)if(Lu(Qe,Zt))return!0}for(let Zt=0;Zt<Qe.length-1;Zt++)if(t1(Qe[Zt],Qe[Zt+1],Wt))return!0;return!1}(n.cameraQueryGeometry,Le-O,De-O,tt+O,Ge+O));for(const Le of ee)G.push(Le);G.sort(wb);const se={};let pe;for(let Le=0;Le<G.length;Le++){const De=G[Le];if(De===pe)continue;pe=De;const tt=this.featureIndexArray.get(De);let Ge=null;this.loadMatchingFeature(se,tt.bucketIndex,tt.sourceLayerIndex,tt.featureIndex,A,S.layers,S.availableImages,u,m,v,(Qe,ht,Et)=>(Ge||(Ge=Wl(Qe)),ht.queryIntersectsFeature(R,Qe,Et,Ge,this.z,n.transform,T,n.pixelPosMatrix)))}return se}loadMatchingFeature(n,u,m,v,S,T,A,R,O,j,G){const X=this.bucketLayerIDs[u];if(T&&!function(Le,De){for(let tt=0;tt<Le.length;tt++)if(De.indexOf(Le[tt])>=0)return!0;return!1}(T,X))return;const ee=this.sourceLayerCoder.decode(m),se=this.vtLayers[ee].feature(v);if(S.needGeometry){const Le=Xl(se,!0);if(!S.filter(new Ii(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!S.filter(new Ii(this.tileID.overscaledZ),se))return;const pe=this.getId(se,ee);for(let Le=0;Le<X.length;Le++){const De=X[Le];if(T&&T.indexOf(De)<0)continue;const tt=R[De];if(!tt)continue;let Ge={};pe&&j&&(Ge=j.getState(tt.sourceLayer||"_geojsonTileLayer",pe));const Qe=ue({},O[De]);Qe.paint=vg(Qe.paint,tt.paint,se,Ge,A),Qe.layout=vg(Qe.layout,tt.layout,se,Ge,A);const ht=!G||G(se,tt,Ge);if(!ht)continue;const Et=new _g(se,this.z,this.x,this.y,pe);Et.layer=Qe;let $t=n[De];$t===void 0&&($t=n[De]=[]),$t.push({featureIndex:v,feature:Et,intersectionZ:ht})}}lookupSymbolFeatures(n,u,m,v,S,T,A,R){const O={};this.loadVTLayers();const j=zt(S);for(const G of n)this.loadMatchingFeature(O,m,v,G,j,T,A,R,u);return O}hasLayer(n){for(const u of this.bucketLayerIDs)for(const m of u)if(n===m)return!0;return!1}getId(n,u){let m=n.id;return this.promoteId&&(m=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof m=="boolean"&&(m=Number(m))),m}}function vg(o,n,u,m,v){return be(o,(S,T)=>{const A=n instanceof ql?n.get(T):null;return A&&A.evaluate?A.evaluate(u,m,v):A})}function bg(o){let n=1/0,u=1/0,m=-1/0,v=-1/0;for(const S of o)n=Math.min(n,S.x),u=Math.min(u,S.y),m=Math.max(m,S.x),v=Math.max(v,S.y);return{minX:n,minY:u,maxX:m,maxY:v}}function wb(o,n){return n-o}function xg(o,n,u,m,v){const S=[];for(let T=0;T<o.length;T++){const A=o[T];let R;for(let O=0;O<A.length-1;O++){let j=A[O],G=A[O+1];j.x<n&&G.x<n||(j.x<n?j=new L(n,j.y+(n-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<n&&(G=new L(n,j.y+(n-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<u&&G.y<u||(j.y<u?j=new L(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round():G.y<u&&(G=new L(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round()),j.x>=m&&G.x>=m||(j.x>=m?j=new L(m,j.y+(m-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=m&&(G=new L(m,j.y+(m-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=v&&G.y>=v||(j.y>=v?j=new L(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round():G.y>=v&&(G=new L(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round()),R&&j.equals(R[R.length-1])||(R=[j],S.push(R)),R.push(G)))))}}return S}Qt("FeatureIndex",yg,{omit:["rawTileData","sourceLayerCoder"]});class hl extends L{constructor(n,u,m,v){super(n,u),this.angle=m,v!==void 0&&(this.segment=v)}clone(){return new hl(this.x,this.y,this.angle,this.segment)}}function wg(o,n,u,m,v){if(n.segment===void 0||u===0)return!0;let S=n,T=n.segment+1,A=0;for(;A>-u/2;){if(T--,T<0)return!1;A-=o[T].dist(S),S=o[T]}A+=o[T].dist(o[T+1]),T++;const R=[];let O=0;for(;A<u/2;){const j=o[T],G=o[T+1];if(!G)return!1;let X=o[T-1].angleTo(j)-j.angleTo(G);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:A,angleDelta:X}),O+=X;A-R[0].distance>m;)O-=R.shift().angleDelta;if(O>v)return!1;T++,A+=j.dist(G)}return!0}function kg(o){let n=0;for(let u=0;u<o.length-1;u++)n+=o[u].dist(o[u+1]);return n}function Ig(o,n,u){return o?.6*n*u:0}function Sg(o,n){return Math.max(o?o.right-o.left:0,n?n.right-n.left:0)}function kb(o,n,u,m,v,S){const T=Ig(u,v,S),A=Sg(u,m)*S;let R=0;const O=kg(o)/2;for(let j=0;j<o.length-1;j++){const G=o[j],X=o[j+1],ee=G.dist(X);if(R+ee>O){const se=(O-R)/ee,pe=bi.number(G.x,X.x,se),Le=bi.number(G.y,X.y,se),De=new hl(pe,Le,X.angleTo(G),j);return De._round(),!T||wg(o,De,A,T,n)?De:void 0}R+=ee}}function Ib(o,n,u,m,v,S,T,A,R){const O=Ig(m,S,T),j=Sg(m,v),G=j*T,X=o[0].x===0||o[0].x===R||o[0].y===0||o[0].y===R;return n-G<n/4&&(n=G+n/4),Eg(o,X?n/2*A%n:(j/2+2*S)*T*A%n,n,O,u,G,X,!1,R)}function Eg(o,n,u,m,v,S,T,A,R){const O=S/2,j=kg(o);let G=0,X=n-u,ee=[];for(let se=0;se<o.length-1;se++){const pe=o[se],Le=o[se+1],De=pe.dist(Le),tt=Le.angleTo(pe);for(;X+u<G+De;){X+=u;const Ge=(X-G)/De,Qe=bi.number(pe.x,Le.x,Ge),ht=bi.number(pe.y,Le.y,Ge);if(Qe>=0&&Qe<R&&ht>=0&&ht<R&&X-O>=0&&X+O<=j){const Et=new hl(Qe,ht,tt,se);Et._round(),m&&!wg(o,Et,S,m,v)||ee.push(Et)}}G+=De}return A||ee.length||T||(ee=Eg(o,G/2,u,m,v,S,T,!0,R)),ee}Qt("Anchor",hl);const Ou=Es;function Tg(o,n,u,m){const v=[],S=o.image,T=S.pixelRatio,A=S.paddedRect.w-2*Ou,R=S.paddedRect.h-2*Ou;let O={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const j=S.stretchX||[[0,A]],G=S.stretchY||[[0,R]],X=(yt,cn)=>yt+cn[1]-cn[0],ee=j.reduce(X,0),se=G.reduce(X,0),pe=A-ee,Le=R-se;let De=0,tt=ee,Ge=0,Qe=se,ht=0,Et=pe,$t=0,yn=Le;if(S.content&&m){const yt=S.content,cn=yt[2]-yt[0],sn=yt[3]-yt[1];(S.textFitWidth||S.textFitHeight)&&(O=eg(o)),De=cf(j,0,yt[0]),Ge=cf(G,0,yt[1]),tt=cf(j,yt[0],yt[2]),Qe=cf(G,yt[1],yt[3]),ht=yt[0]-De,$t=yt[1]-Ge,Et=cn-tt,yn=sn-Qe}const Wt=O.x1,Zt=O.y1,on=O.x2-Wt,tn=O.y2-Zt,Kt=(yt,cn,sn,Sn)=>{const vi=hf(yt.stretch-De,tt,on,Wt),_i=ff(yt.fixed-ht,Et,yt.stretch,ee),vr=hf(cn.stretch-Ge,Qe,tn,Zt),fo=ff(cn.fixed-$t,yn,cn.stretch,se),Br=hf(sn.stretch-De,tt,on,Wt),br=ff(sn.fixed-ht,Et,sn.stretch,ee),as=hf(Sn.stretch-Ge,Qe,tn,Zt),ls=ff(Sn.fixed-$t,yn,Sn.stretch,se),us=new L(vi,vr),Gi=new L(Br,vr),xr=new L(Br,as),$r=new L(vi,as),Ur=new L(_i/T,fo/T),cs=new L(br/T,ls/T),jr=n*Math.PI/180;if(jr){const si=Math.sin(jr),xi=Math.cos(jr),Ci=[xi,-si,si,xi];us._matMult(Ci),Gi._matMult(Ci),$r._matMult(Ci),xr._matMult(Ci)}const Ys=yt.stretch+yt.fixed,Ts=cn.stretch+cn.fixed;return{tl:us,tr:Gi,bl:$r,br:xr,tex:{x:S.paddedRect.x+Ou+Ys,y:S.paddedRect.y+Ou+Ts,w:sn.stretch+sn.fixed-Ys,h:Sn.stretch+Sn.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ur,pixelOffsetBR:cs,minFontScaleX:Et/T/on,minFontScaleY:yn/T/tn,isSDF:u}};if(m&&(S.stretchX||S.stretchY)){const yt=Cg(j,pe,ee),cn=Cg(G,Le,se);for(let sn=0;sn<yt.length-1;sn++){const Sn=yt[sn],vi=yt[sn+1];for(let _i=0;_i<cn.length-1;_i++)v.push(Kt(Sn,cn[_i],vi,cn[_i+1]))}}else v.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:R+1}));return v}function cf(o,n,u){let m=0;for(const v of o)m+=Math.max(n,Math.min(u,v[1]))-Math.max(n,Math.min(u,v[0]));return m}function Cg(o,n,u){const m=[{fixed:-Ou,stretch:0}];for(const[v,S]of o){const T=m[m.length-1];m.push({fixed:v-T.stretch,stretch:T.stretch}),m.push({fixed:v-T.stretch,stretch:T.stretch+(S-v)})}return m.push({fixed:n+Ou,stretch:u}),m}function hf(o,n,u,m){return o/n*u+m}function ff(o,n,u,m){return o-n*u/m}class df{constructor(n,u,m,v,S,T,A,R,O,j){var G;if(this.boxStartIndex=n.length,O){let X=T.top,ee=T.bottom;const se=T.collisionPadding;se&&(X-=se[1],ee+=se[3]);let pe=ee-X;pe>0&&(pe=Math.max(10,pe),this.circleDiameter=pe)}else{const X=!((G=T.image)===null||G===void 0)&&G.content&&(T.image.textFitWidth||T.image.textFitHeight)?eg(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};X.y1=X.y1*A-R[0],X.y2=X.y2*A+R[2],X.x1=X.x1*A-R[3],X.x2=X.x2*A+R[1];const ee=T.collisionPadding;if(ee&&(X.x1-=ee[0]*A,X.y1-=ee[1]*A,X.x2+=ee[2]*A,X.y2+=ee[3]*A),j){const se=new L(X.x1,X.y1),pe=new L(X.x2,X.y1),Le=new L(X.x1,X.y2),De=new L(X.x2,X.y2),tt=j*Math.PI/180;se._rotate(tt),pe._rotate(tt),Le._rotate(tt),De._rotate(tt),X.x1=Math.min(se.x,pe.x,Le.x,De.x),X.x2=Math.max(se.x,pe.x,Le.x,De.x),X.y1=Math.min(se.y,pe.y,Le.y,De.y),X.y2=Math.max(se.y,pe.y,Le.y,De.y)}n.emplaceBack(u.x,u.y,X.x1,X.y1,X.x2,X.y2,m,v,S)}this.boxEndIndex=n.length}}class Sb{constructor(n=[],u=(m,v)=>m<v?-1:m>v?1:0){if(this.data=n,this.length=this.data.length,this.compare=u,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:u,compare:m}=this,v=u[n];for(;n>0;){const S=n-1>>1,T=u[S];if(m(v,T)>=0)break;u[n]=T,n=S}u[n]=v}_down(n){const{data:u,compare:m}=this,v=this.length>>1,S=u[n];for(;n<v;){let T=1+(n<<1);const A=T+1;if(A<this.length&&m(u[A],u[T])<0&&(T=A),m(u[T],S)>=0)break;u[n]=u[T],n=T}u[n]=S}}function Eb(o,n=1,u=!1){let m=1/0,v=1/0,S=-1/0,T=-1/0;const A=o[0];for(let ee=0;ee<A.length;ee++){const se=A[ee];(!ee||se.x<m)&&(m=se.x),(!ee||se.y<v)&&(v=se.y),(!ee||se.x>S)&&(S=se.x),(!ee||se.y>T)&&(T=se.y)}const R=Math.min(S-m,T-v);let O=R/2;const j=new Sb([],Tb);if(R===0)return new L(m,v);for(let ee=m;ee<S;ee+=R)for(let se=v;se<T;se+=R)j.push(new Fu(ee+O,se+O,O,o));let G=function(ee){let se=0,pe=0,Le=0;const De=ee[0];for(let tt=0,Ge=De.length,Qe=Ge-1;tt<Ge;Qe=tt++){const ht=De[tt],Et=De[Qe],$t=ht.x*Et.y-Et.x*ht.y;pe+=(ht.x+Et.x)*$t,Le+=(ht.y+Et.y)*$t,se+=3*$t}return new Fu(pe/se,Le/se,0,ee)}(o),X=j.length;for(;j.length;){const ee=j.pop();(ee.d>G.d||!G.d)&&(G=ee,u&&console.log("found best %d after %d probes",Math.round(1e4*ee.d)/1e4,X)),ee.max-G.d<=n||(O=ee.h/2,j.push(new Fu(ee.p.x-O,ee.p.y-O,O,o)),j.push(new Fu(ee.p.x+O,ee.p.y-O,O,o)),j.push(new Fu(ee.p.x-O,ee.p.y+O,O,o)),j.push(new Fu(ee.p.x+O,ee.p.y+O,O,o)),X+=4)}return u&&(console.log(`num probes: ${X}`),console.log(`best distance: ${G.d}`)),G.p}function Tb(o,n){return n.max-o.max}function Fu(o,n,u,m){this.p=new L(o,n),this.h=u,this.d=function(v,S){let T=!1,A=1/0;for(let R=0;R<S.length;R++){const O=S[R];for(let j=0,G=O.length,X=G-1;j<G;X=j++){const ee=O[j],se=O[X];ee.y>v.y!=se.y>v.y&&v.x<(se.x-ee.x)*(v.y-ee.y)/(se.y-ee.y)+ee.x&&(T=!T),A=Math.min(A,hm(v,ee,se))}}return(T?1:-1)*Math.sqrt(A)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var Fr;g.aq=void 0,(Fr=g.aq||(g.aq={}))[Fr.center=1]="center",Fr[Fr.left=2]="left",Fr[Fr.right=3]="right",Fr[Fr.top=4]="top",Fr[Fr.bottom=5]="bottom",Fr[Fr["top-left"]=6]="top-left",Fr[Fr["top-right"]=7]="top-right",Fr[Fr["bottom-left"]=8]="bottom-left",Fr[Fr["bottom-right"]=9]="bottom-right";const fl=7,Zd=Number.POSITIVE_INFINITY;function Lg(o,n){return n[1]!==Zd?function(u,m,v){let S=0,T=0;switch(m=Math.abs(m),v=Math.abs(v),u){case"top-right":case"top-left":case"top":T=v-fl;break;case"bottom-right":case"bottom-left":case"bottom":T=-v+fl}switch(u){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,T]}(o,n[0],n[1]):function(u,m){let v=0,S=0;m<0&&(m=0);const T=m/Math.SQRT2;switch(u){case"top-right":case"top-left":S=T-fl;break;case"bottom-right":case"bottom-left":S=-T+fl;break;case"bottom":S=-m+fl;break;case"top":S=m-fl}switch(u){case"top-right":case"bottom-right":v=-T;break;case"top-left":case"bottom-left":v=T;break;case"left":v=m;break;case"right":v=-m}return[v,S]}(o,n[0])}function Mg(o,n,u){var m;const v=o.layout,S=(m=v.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(n,{},u);if(S){const A=S.values,R=[];for(let O=0;O<A.length;O+=2){const j=R[O]=A[O],G=A[O+1].map(X=>X*pr);j.startsWith("top")?G[1]-=fl:j.startsWith("bottom")&&(G[1]+=fl),R[O+1]=G}return new Pi(R)}const T=v.get("text-variable-anchor");if(T){let A;A=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(n,{},u)*pr,Zd]:v.get("text-offset").evaluate(n,{},u).map(O=>O*pr);const R=[];for(const O of T)R.push(O,Lg(O,A));return new Pi(R)}return null}function Hd(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cb(o,n,u,m,v,S,T,A,R,O,j){let G=S.textMaxSize.evaluate(n,{});G===void 0&&(G=T);const X=o.layers[0].layout,ee=X.get("icon-offset").evaluate(n,{},j),se=Pg(u.horizontal),pe=T/24,Le=o.tilePixelRatio*pe,De=o.tilePixelRatio*G/24,tt=o.tilePixelRatio*A,Ge=o.tilePixelRatio*X.get("symbol-spacing"),Qe=X.get("text-padding")*o.tilePixelRatio,ht=function(yt,cn,sn,Sn=1){const vi=yt.get("icon-padding").evaluate(cn,{},sn),_i=vi&&vi.values;return[_i[0]*Sn,_i[1]*Sn,_i[2]*Sn,_i[3]*Sn]}(X,n,j,o.tilePixelRatio),Et=X.get("text-max-angle")/180*Math.PI,$t=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",yn=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Wt=X.get("symbol-placement"),Zt=Ge/2,on=X.get("icon-text-fit");let tn;m&&on!=="none"&&(o.allowVerticalPlacement&&u.vertical&&(tn=tg(m,u.vertical,on,X.get("icon-text-fit-padding"),ee,pe)),se&&(m=tg(m,se,on,X.get("icon-text-fit-padding"),ee,pe)));const Kt=(yt,cn)=>{cn.x<0||cn.x>=ar||cn.y<0||cn.y>=ar||function(sn,Sn,vi,_i,vr,fo,Br,br,as,ls,us,Gi,xr,$r,Ur,cs,jr,Ys,Ts,si,xi,Ci,Bs,Ui,Bu){const na=sn.addToLineVertexArray(Sn,vi);let ia,po,Js,Rr,Ta=0,ah=0,zg=0,Og=0,ep=-1,tp=-1;const Ca={};let Fg=Su("");if(sn.allowVerticalPlacement&&_i.vertical){const Yr=br.layout.get("text-rotate").evaluate(xi,{},Ui)+90;Js=new df(as,Sn,ls,us,Gi,_i.vertical,xr,$r,Ur,Yr),Br&&(Rr=new df(as,Sn,ls,us,Gi,Br,jr,Ys,Ur,Yr))}if(vr){const Yr=br.layout.get("icon-rotate").evaluate(xi,{}),Ks=br.layout.get("icon-text-fit")!=="none",Yl=Tg(vr,Yr,Bs,Ks),Lo=Br?Tg(Br,Yr,Bs,Ks):void 0;po=new df(as,Sn,ls,us,Gi,vr,jr,Ys,!1,Yr),Ta=4*Yl.length;const Jl=sn.iconSizeData;let ra=null;Jl.kind==="source"?(ra=[ta*br.layout.get("icon-size").evaluate(xi,{})],ra[0]>ul&&ze(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)):Jl.kind==="composite"&&(ra=[ta*Ci.compositeIconSizes[0].evaluate(xi,{},Ui),ta*Ci.compositeIconSizes[1].evaluate(xi,{},Ui)],(ra[0]>ul||ra[1]>ul)&&ze(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)),sn.addSymbols(sn.icon,Yl,ra,si,Ts,xi,g.ah.none,Sn,na.lineStartIndex,na.lineLength,-1,Ui),ep=sn.icon.placedSymbolArray.length-1,Lo&&(ah=4*Lo.length,sn.addSymbols(sn.icon,Lo,ra,si,Ts,xi,g.ah.vertical,Sn,na.lineStartIndex,na.lineLength,-1,Ui),tp=sn.icon.placedSymbolArray.length-1)}const Bg=Object.keys(_i.horizontal);for(const Yr of Bg){const Ks=_i.horizontal[Yr];if(!ia){Fg=Su(Ks.text);const Lo=br.layout.get("text-rotate").evaluate(xi,{},Ui);ia=new df(as,Sn,ls,us,Gi,Ks,xr,$r,Ur,Lo)}const Yl=Ks.positionedLines.length===1;if(zg+=Ag(sn,Sn,Ks,fo,br,Ur,xi,cs,na,_i.vertical?g.ah.horizontal:g.ah.horizontalOnly,Yl?Bg:[Yr],Ca,ep,Ci,Ui),Yl)break}_i.vertical&&(Og+=Ag(sn,Sn,_i.vertical,fo,br,Ur,xi,cs,na,g.ah.vertical,["vertical"],Ca,tp,Ci,Ui));const Ab=ia?ia.boxStartIndex:sn.collisionBoxArray.length,Pb=ia?ia.boxEndIndex:sn.collisionBoxArray.length,Rb=Js?Js.boxStartIndex:sn.collisionBoxArray.length,Db=Js?Js.boxEndIndex:sn.collisionBoxArray.length,Nb=po?po.boxStartIndex:sn.collisionBoxArray.length,zb=po?po.boxEndIndex:sn.collisionBoxArray.length,Ob=Rr?Rr.boxStartIndex:sn.collisionBoxArray.length,Fb=Rr?Rr.boxEndIndex:sn.collisionBoxArray.length;let Co=-1;const mf=(Yr,Ks)=>Yr&&Yr.circleDiameter?Math.max(Yr.circleDiameter,Ks):Ks;Co=mf(ia,Co),Co=mf(Js,Co),Co=mf(po,Co),Co=mf(Rr,Co);const Ug=Co>-1?1:0;Ug&&(Co*=Bu/pr),sn.glyphOffsetArray.length>=zu.MAX_GLYPHS&&ze("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&sn.addToSortKeyRanges(sn.symbolInstances.length,xi.sortKey);const Bb=Mg(br,xi,Ui),[Ub,jb]=function(Yr,Ks){const Yl=Yr.length,Lo=Ks==null?void 0:Ks.values;if((Lo==null?void 0:Lo.length)>0)for(let Jl=0;Jl<Lo.length;Jl+=2){const ra=Lo[Jl+1];Yr.emplaceBack(g.aq[Lo[Jl]],ra[0],ra[1])}return[Yl,Yr.length]}(sn.textAnchorOffsets,Bb);sn.symbolInstances.emplaceBack(Sn.x,Sn.y,Ca.right>=0?Ca.right:-1,Ca.center>=0?Ca.center:-1,Ca.left>=0?Ca.left:-1,Ca.vertical||-1,ep,tp,Fg,Ab,Pb,Rb,Db,Nb,zb,Ob,Fb,ls,zg,Og,Ta,ah,Ug,0,xr,Co,Ub,jb)}(o,cn,yt,u,m,v,tn,o.layers[0],o.collisionBoxArray,n.index,n.sourceLayerIndex,o.index,Le,[Qe,Qe,Qe,Qe],$t,R,tt,ht,yn,ee,n,S,O,j,T)};if(Wt==="line")for(const yt of xg(n.geometry,0,0,ar,ar)){const cn=Ib(yt,Ge,Et,u.vertical||se,m,24,De,o.overscaling,ar);for(const sn of cn)se&&Lb(o,se.text,Zt,sn)||Kt(yt,sn)}else if(Wt==="line-center"){for(const yt of n.geometry)if(yt.length>1){const cn=kb(yt,Et,u.vertical||se,m,24,De);cn&&Kt(yt,cn)}}else if(n.type==="Polygon")for(const yt of ja(n.geometry,0)){const cn=Eb(yt,16);Kt(yt[0],new hl(cn.x,cn.y,0))}else if(n.type==="LineString")for(const yt of n.geometry)Kt(yt,new hl(yt[0].x,yt[0].y,0));else if(n.type==="Point")for(const yt of n.geometry)for(const cn of yt)Kt([cn],new hl(cn.x,cn.y,0))}function Ag(o,n,u,m,v,S,T,A,R,O,j,G,X,ee,se){const pe=function(tt,Ge,Qe,ht,Et,$t,yn,Wt){const Zt=ht.layout.get("text-rotate").evaluate($t,{})*Math.PI/180,on=[];for(const tn of Ge.positionedLines)for(const Kt of tn.positionedGlyphs){if(!Kt.rect)continue;const yt=Kt.rect||{};let cn=Wm+1,sn=!0,Sn=1,vi=0;const _i=(Et||Wt)&&Kt.vertical,vr=Kt.metrics.advance*Kt.scale/2;if(Wt&&Ge.verticalizable&&(vi=tn.lineOffset/2-(Kt.imageName?-(pr-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*pr)),Kt.imageName){const si=yn[Kt.imageName];sn=si.sdf,Sn=si.pixelRatio,cn=Es/Sn}const fo=Et?[Kt.x+vr,Kt.y]:[0,0];let Br=Et?[0,0]:[Kt.x+vr+Qe[0],Kt.y+Qe[1]-vi],br=[0,0];_i&&(br=Br,Br=[0,0]);const as=Kt.metrics.isDoubleResolution?2:1,ls=(Kt.metrics.left-cn)*Kt.scale-vr+Br[0],us=(-Kt.metrics.top-cn)*Kt.scale+Br[1],Gi=ls+yt.w/as*Kt.scale/Sn,xr=us+yt.h/as*Kt.scale/Sn,$r=new L(ls,us),Ur=new L(Gi,us),cs=new L(ls,xr),jr=new L(Gi,xr);if(_i){const si=new L(-vr,vr-eh),xi=-Math.PI/2,Ci=pr/2-vr,Bs=new L(5-eh-Ci,-(Kt.imageName?Ci:0)),Ui=new L(...br);$r._rotateAround(xi,si)._add(Bs)._add(Ui),Ur._rotateAround(xi,si)._add(Bs)._add(Ui),cs._rotateAround(xi,si)._add(Bs)._add(Ui),jr._rotateAround(xi,si)._add(Bs)._add(Ui)}if(Zt){const si=Math.sin(Zt),xi=Math.cos(Zt),Ci=[xi,-si,si,xi];$r._matMult(Ci),Ur._matMult(Ci),cs._matMult(Ci),jr._matMult(Ci)}const Ys=new L(0,0),Ts=new L(0,0);on.push({tl:$r,tr:Ur,bl:cs,br:jr,tex:yt,writingMode:Ge.writingMode,glyphOffset:fo,sectionIndex:Kt.sectionIndex,isSDF:sn,pixelOffsetTL:Ys,pixelOffsetBR:Ts,minFontScaleX:0,minFontScaleY:0})}return on}(0,u,A,v,S,T,m,o.allowVerticalPlacement),Le=o.textSizeData;let De=null;Le.kind==="source"?(De=[ta*v.layout.get("text-size").evaluate(T,{})],De[0]>ul&&ze(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)):Le.kind==="composite"&&(De=[ta*ee.compositeTextSizes[0].evaluate(T,{},se),ta*ee.compositeTextSizes[1].evaluate(T,{},se)],(De[0]>ul||De[1]>ul)&&ze(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)),o.addSymbols(o.text,pe,De,A,S,T,O,n,R.lineStartIndex,R.lineLength,X,se);for(const tt of j)G[tt]=o.text.placedSymbolArray.length-1;return 4*pe.length}function Pg(o){for(const n in o)return o[n];return null}function Lb(o,n,u,m){const v=o.compareText;if(n in v){const S=v[n];for(let T=S.length-1;T>=0;T--)if(m.dist(S[T])<u)return!0}else v[n]=[];return v[n].push(m),!1}const Rg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wd{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,m]=new Uint8Array(n,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=m>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const S=Rg[15&m];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(n,2,1),[A]=new Uint32Array(n,4,1);return new Wd(A,T,S,n)}constructor(n,u=64,m=Float64Array,v){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=m,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const S=Rg.indexOf(this.ArrayType),T=2*n*this.ArrayType.BYTES_PER_ELEMENT,A=n*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-A%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+A+R,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+T+A+R),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+A+R,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=n)}add(n,u){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=n,this.coords[this._pos++]=u,m}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Xd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,u,m,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:A}=this,R=[0,S.length-1,0],O=[];for(;R.length;){const j=R.pop()||0,G=R.pop()||0,X=R.pop()||0;if(G-X<=A){for(let Le=X;Le<=G;Le++){const De=T[2*Le],tt=T[2*Le+1];De>=n&&De<=m&&tt>=u&&tt<=v&&O.push(S[Le])}continue}const ee=X+G>>1,se=T[2*ee],pe=T[2*ee+1];se>=n&&se<=m&&pe>=u&&pe<=v&&O.push(S[ee]),(j===0?n<=se:u<=pe)&&(R.push(X),R.push(ee-1),R.push(1-j)),(j===0?m>=se:v>=pe)&&(R.push(ee+1),R.push(G),R.push(1-j))}return O}within(n,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:S,nodeSize:T}=this,A=[0,v.length-1,0],R=[],O=m*m;for(;A.length;){const j=A.pop()||0,G=A.pop()||0,X=A.pop()||0;if(G-X<=T){for(let Le=X;Le<=G;Le++)Ng(S[2*Le],S[2*Le+1],n,u)<=O&&R.push(v[Le]);continue}const ee=X+G>>1,se=S[2*ee],pe=S[2*ee+1];Ng(se,pe,n,u)<=O&&R.push(v[ee]),(j===0?n-m<=se:u-m<=pe)&&(A.push(X),A.push(ee-1),A.push(1-j)),(j===0?n+m>=se:u+m>=pe)&&(A.push(ee+1),A.push(G),A.push(1-j))}return R}}function Xd(o,n,u,m,v,S){if(v-m<=u)return;const T=m+v>>1;Dg(o,n,T,m,v,S),Xd(o,n,u,m,T-1,1-S),Xd(o,n,u,T+1,v,1-S)}function Dg(o,n,u,m,v,S){for(;v>m;){if(v-m>600){const O=v-m+1,j=u-m+1,G=Math.log(O),X=.5*Math.exp(2*G/3),ee=.5*Math.sqrt(G*X*(O-X)/O)*(j-O/2<0?-1:1);Dg(o,n,u,Math.max(m,Math.floor(u-j*X/O+ee)),Math.min(v,Math.floor(u+(O-j)*X/O+ee)),S)}const T=n[2*u+S];let A=m,R=v;for(sh(o,n,m,u),n[2*v+S]>T&&sh(o,n,m,v);A<R;){for(sh(o,n,A,R),A++,R--;n[2*A+S]<T;)A++;for(;n[2*R+S]>T;)R--}n[2*m+S]===T?sh(o,n,m,R):(R++,sh(o,n,R,v)),R<=u&&(m=R+1),u<=R&&(v=R-1)}}function sh(o,n,u,m){$d(o,u,m),$d(n,2*u,2*m),$d(n,2*u+1,2*m+1)}function $d(o,n,u){const m=o[n];o[n]=o[u],o[u]=m}function Ng(o,n,u,m){const v=o-u,S=n-m;return v*v+S*S}var Yd;g.bg=void 0,(Yd=g.bg||(g.bg={})).create="create",Yd.load="load",Yd.fullLoad="fullLoad";let pf=null,oh=[];const Jd=1e3/60,Kd="loadTime",Qd="fullLoadTime",Mb={mark(o){performance.mark(o)},frame(o){const n=o;pf!=null&&oh.push(n-pf),pf=n},clearMetrics(){pf=null,oh=[],performance.clearMeasures(Kd),performance.clearMeasures(Qd);for(const o in g.bg)performance.clearMarks(g.bg[o])},getPerformanceMetrics(){performance.measure(Kd,g.bg.create,g.bg.load),performance.measure(Qd,g.bg.create,g.bg.fullLoad);const o=performance.getEntriesByName(Kd)[0].duration,n=performance.getEntriesByName(Qd)[0].duration,u=oh.length,m=1/(oh.reduce((S,T)=>S+T,0)/u/1e3),v=oh.filter(S=>S>Jd).reduce((S,T)=>S+(T-Jd)/Jd,0);return{loadTime:o,fullLoadTime:n,fps:m,percentDroppedFrames:v/(u+v)*100,totalFrames:u}}};g.$=class extends H{},g.A=Mu,g.B=ad,g.C=function(o){if(St==null){const n=o.navigator?o.navigator.userAgent:null;St=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return St},g.D=nn,g.E=Lt,g.F=class{constructor(o,n){this.target=o,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new xb(()=>this.process()),this.subscription=function(u,m,v,S){return u.addEventListener(m,v,!1),{unsubscribe:()=>{u.removeEventListener(m,v,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=pt(self)?o:window}registerMessageHandler(o,n){this.messageHandlers[o]=n}sendAsync(o,n){return new Promise((u,m)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:u,reject:m},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const A={id:v,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},{once:!0});const S=[],T=Object.assign(Object.assign({},o),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Ja(o.data,S)});this.target.postMessage(T,{transfer:S})})}receive(o){const n=o.data,u=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[u];const m=this.abortControllers[u];return delete this.abortControllers[u],void(m&&m.abort())}if(pt(self)||n.mustQueue)return this.tasks[u]=n,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,n)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),n=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(o,n)}processTask(o,n){return l(this,void 0,void 0,function*(){if(n.type==="<response>"){const v=this.resolveRejects[o];return delete this.resolveRejects[o],v?void(n.error?v.reject(Ka(n.error)):v.resolve(Ka(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=Ka(n.data),m=new AbortController;this.abortControllers[o]=m;try{const v=yield this.messageHandlers[n.type](n.sourceMapId,u,m);this.completeTask(o,null,v)}catch(v){this.completeTask(o,v)}})}completeTask(o,n,u){const m=[];delete this.abortControllers[o];const v={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?Ja(n):null,data:Ja(u,m)};this.target.postMessage(v,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},g.G=pn,g.H=function(){var o=new Mu(16);return Mu!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},g.I=Dd,g.J=function(o,n,u){var m,v,S,T,A,R,O,j,G,X,ee,se,pe=u[0],Le=u[1],De=u[2];return n===o?(o[12]=n[0]*pe+n[4]*Le+n[8]*De+n[12],o[13]=n[1]*pe+n[5]*Le+n[9]*De+n[13],o[14]=n[2]*pe+n[6]*Le+n[10]*De+n[14],o[15]=n[3]*pe+n[7]*Le+n[11]*De+n[15]):(v=n[1],S=n[2],T=n[3],A=n[4],R=n[5],O=n[6],j=n[7],G=n[8],X=n[9],ee=n[10],se=n[11],o[0]=m=n[0],o[1]=v,o[2]=S,o[3]=T,o[4]=A,o[5]=R,o[6]=O,o[7]=j,o[8]=G,o[9]=X,o[10]=ee,o[11]=se,o[12]=m*pe+A*Le+G*De+n[12],o[13]=v*pe+R*Le+X*De+n[13],o[14]=S*pe+O*Le+ee*De+n[14],o[15]=T*pe+j*Le+se*De+n[15]),o},g.K=function(o,n,u){var m=u[0],v=u[1],S=u[2];return o[0]=n[0]*m,o[1]=n[1]*m,o[2]=n[2]*m,o[3]=n[3]*m,o[4]=n[4]*v,o[5]=n[5]*v,o[6]=n[6]*v,o[7]=n[7]*v,o[8]=n[8]*S,o[9]=n[9]*S,o[10]=n[10]*S,o[11]=n[11]*S,o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},g.L=mm,g.M=function(o,n){const u={};for(let m=0;m<n.length;m++){const v=n[m];v in o&&(u[v]=o[v])}return u},g.N=cl,g.O=cg,g.P=L,g.Q=hg,g.R=Xs,g.S=$s,g.T=bu,g.U=re,g.V=J,g.W=Bt,g.X=ar,g.Y=P,g.Z=ih,g._=l,g.a=It,g.a$=function(o,n){var u=o[0],m=o[1],v=o[2],S=o[3],T=o[4],A=o[5],R=o[6],O=o[7],j=o[8],G=o[9],X=o[10],ee=o[11],se=o[12],pe=o[13],Le=o[14],De=o[15],tt=n[0],Ge=n[1],Qe=n[2],ht=n[3],Et=n[4],$t=n[5],yn=n[6],Wt=n[7],Zt=n[8],on=n[9],tn=n[10],Kt=n[11],yt=n[12],cn=n[13],sn=n[14],Sn=n[15];return Math.abs(u-tt)<=os*Math.max(1,Math.abs(u),Math.abs(tt))&&Math.abs(m-Ge)<=os*Math.max(1,Math.abs(m),Math.abs(Ge))&&Math.abs(v-Qe)<=os*Math.max(1,Math.abs(v),Math.abs(Qe))&&Math.abs(S-ht)<=os*Math.max(1,Math.abs(S),Math.abs(ht))&&Math.abs(T-Et)<=os*Math.max(1,Math.abs(T),Math.abs(Et))&&Math.abs(A-$t)<=os*Math.max(1,Math.abs(A),Math.abs($t))&&Math.abs(R-yn)<=os*Math.max(1,Math.abs(R),Math.abs(yn))&&Math.abs(O-Wt)<=os*Math.max(1,Math.abs(O),Math.abs(Wt))&&Math.abs(j-Zt)<=os*Math.max(1,Math.abs(j),Math.abs(Zt))&&Math.abs(G-on)<=os*Math.max(1,Math.abs(G),Math.abs(on))&&Math.abs(X-tn)<=os*Math.max(1,Math.abs(X),Math.abs(tn))&&Math.abs(ee-Kt)<=os*Math.max(1,Math.abs(ee),Math.abs(Kt))&&Math.abs(se-yt)<=os*Math.max(1,Math.abs(se),Math.abs(yt))&&Math.abs(pe-cn)<=os*Math.max(1,Math.abs(pe),Math.abs(cn))&&Math.abs(Le-sn)<=os*Math.max(1,Math.abs(Le),Math.abs(sn))&&Math.abs(De-Sn)<=os*Math.max(1,Math.abs(De),Math.abs(Sn))},g.a0=Gn,g.a1=Gd,g.a2=ct,g.a3=o=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(u=>{n.onloadstart=()=>{u(n)};for(const m of o){const v=window.document.createElement("source");dn(m)||(n.crossOrigin="Anonymous"),v.src=m,n.appendChild(v)}})},g.a4=function(){return xe++},g.a5=Xt,g.a6=zu,g.a7=zt,g.a8=Xl,g.a9=_g,g.aA=function(o){if(o.type==="custom")return new bb(o);switch(o.type){case"background":return new _b(o);case"circle":return new r1(o);case"fill":return new x1(o);case"fill-extrusion":return new z1(o);case"heatmap":return new o1(o);case"hillshade":return new l1(o);case"line":return new G1(o);case"raster":return new vb(o);case"symbol":return new uf(o)}},g.aB=we,g.aC=function(o,n){if(!o)return[{command:"setStyle",args:[n]}];let u=[];try{if(!Ee(o.version,n.version))return[{command:"setStyle",args:[n]}];Ee(o.center,n.center)||u.push({command:"setCenter",args:[n.center]}),Ee(o.zoom,n.zoom)||u.push({command:"setZoom",args:[n.zoom]}),Ee(o.bearing,n.bearing)||u.push({command:"setBearing",args:[n.bearing]}),Ee(o.pitch,n.pitch)||u.push({command:"setPitch",args:[n.pitch]}),Ee(o.sprite,n.sprite)||u.push({command:"setSprite",args:[n.sprite]}),Ee(o.glyphs,n.glyphs)||u.push({command:"setGlyphs",args:[n.glyphs]}),Ee(o.transition,n.transition)||u.push({command:"setTransition",args:[n.transition]}),Ee(o.light,n.light)||u.push({command:"setLight",args:[n.light]}),Ee(o.terrain,n.terrain)||u.push({command:"setTerrain",args:[n.terrain]}),Ee(o.sky,n.sky)||u.push({command:"setSky",args:[n.sky]}),Ee(o.projection,n.projection)||u.push({command:"setProjection",args:[n.projection]});const m={},v=[];(function(T,A,R,O){let j;for(j in A=A||{},T=T||{})Object.prototype.hasOwnProperty.call(T,j)&&(Object.prototype.hasOwnProperty.call(A,j)||Kn(j,R,O));for(j in A)Object.prototype.hasOwnProperty.call(A,j)&&(Object.prototype.hasOwnProperty.call(T,j)?Ee(T[j],A[j])||(T[j].type==="geojson"&&A[j].type==="geojson"&&xn(T,A,j)?Gt(R,{command:"setGeoJSONSourceData",args:[j,A[j].data]}):Yi(j,A,R,O)):_n(j,A,R))})(o.sources,n.sources,v,m);const S=[];o.layers&&o.layers.forEach(T=>{"source"in T&&m[T.source]?u.push({command:"removeLayer",args:[T.id]}):S.push(T)}),u=u.concat(v),function(T,A,R){A=A||[];const O=(T=T||[]).map(Ji),j=A.map(Ji),G=T.reduce(Jr,{}),X=A.reduce(Jr,{}),ee=O.slice(),se=Object.create(null);let pe,Le,De,tt,Ge;for(let Qe=0,ht=0;Qe<O.length;Qe++)pe=O[Qe],Object.prototype.hasOwnProperty.call(X,pe)?ht++:(Gt(R,{command:"removeLayer",args:[pe]}),ee.splice(ee.indexOf(pe,ht),1));for(let Qe=0,ht=0;Qe<j.length;Qe++)pe=j[j.length-1-Qe],ee[ee.length-1-Qe]!==pe&&(Object.prototype.hasOwnProperty.call(G,pe)?(Gt(R,{command:"removeLayer",args:[pe]}),ee.splice(ee.lastIndexOf(pe,ee.length-ht),1)):ht++,tt=ee[ee.length-Qe],Gt(R,{command:"addLayer",args:[X[pe],tt]}),ee.splice(ee.length-Qe,0,pe),se[pe]=!0);for(let Qe=0;Qe<j.length;Qe++)if(pe=j[Qe],Le=G[pe],De=X[pe],!se[pe]&&!Ee(Le,De))if(Ee(Le.source,De.source)&&Ee(Le["source-layer"],De["source-layer"])&&Ee(Le.type,De.type)){for(Ge in qi(Le.layout,De.layout,R,pe,null,"setLayoutProperty"),qi(Le.paint,De.paint,R,pe,null,"setPaintProperty"),Ee(Le.filter,De.filter)||Gt(R,{command:"setFilter",args:[pe,De.filter]}),Ee(Le.minzoom,De.minzoom)&&Ee(Le.maxzoom,De.maxzoom)||Gt(R,{command:"setLayerZoomRange",args:[pe,De.minzoom,De.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?qi(Le[Ge],De[Ge],R,pe,Ge.slice(6),"setPaintProperty"):Ee(Le[Ge],De[Ge])||Gt(R,{command:"setLayerProperty",args:[pe,Ge,De[Ge]]}));for(Ge in De)Object.prototype.hasOwnProperty.call(De,Ge)&&!Object.prototype.hasOwnProperty.call(Le,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?qi(Le[Ge],De[Ge],R,pe,Ge.slice(6),"setPaintProperty"):Ee(Le[Ge],De[Ge])||Gt(R,{command:"setLayerProperty",args:[pe,Ge,De[Ge]]}))}else Gt(R,{command:"removeLayer",args:[pe]}),tt=ee[ee.lastIndexOf(pe)+1],Gt(R,{command:"addLayer",args:[De,tt]})}(S,n.layers,u)}catch(m){console.warn("Unable to compute style diff:",m),u=[{command:"setStyle",args:[n]}]}return u},g.aD=function(o){const n=[],u=o.id;return u===void 0&&n.push({message:`layers.${u}: missing required property "id"`}),o.render===void 0&&n.push({message:`layers.${u}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&n.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),n},g.aE=function o(n,u){if(Array.isArray(n)){if(!Array.isArray(u)||n.length!==u.length)return!1;for(let m=0;m<n.length;m++)if(!o(n[m],u[m]))return!1;return!0}if(typeof n=="object"&&n!==null&&u!==null){if(typeof u!="object"||Object.keys(n).length!==Object.keys(u).length)return!1;for(const m in n)if(!o(n[m],u[m]))return!1;return!0}return n===u},g.aF=be,g.aG=Te,g.aH=class extends Zl{constructor(o,n){super(o,n),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},g.aI=$h,g.aJ=class extends Zl{constructor(o,n){super(o,n),this.current=Yv}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let n=1;n<16;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},g.aK=rm,g.aL=sm,g.aM=Qn,g.aN=class extends Zl{constructor(o,n){super(o,n),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},g.aO=class extends Zl{constructor(o,n){super(o,n),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},g.aP=function(o,n,u,m,v,S,T){var A=1/(n-u),R=1/(m-v),O=1/(S-T);return o[0]=-2*A,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*R,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*O,o[11]=0,o[12]=(n+u)*A,o[13]=(v+m)*R,o[14]=(T+S)*O,o[15]=1,o},g.aQ=i1,g.aR=class extends Ze{},g.aS=X1,g.aT=class extends it{},g.aU=wd,g.aV=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},g.aW=bm,g.aX=zr,g.aY=Ws,g.aZ=class extends rn{},g.a_=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]&&o[3]===n[3]&&o[4]===n[4]&&o[5]===n[5]&&o[6]===n[6]&&o[7]===n[7]&&o[8]===n[8]&&o[9]===n[9]&&o[10]===n[10]&&o[11]===n[11]&&o[12]===n[12]&&o[13]===n[13]&&o[14]===n[14]&&o[15]===n[15]},g.aa=function(o){const n={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,m,v,S)=>{const T=v||S;return n[m]=!T||T.toLowerCase(),""}),n["max-age"]){const u=parseInt(n["max-age"],10);isNaN(u)?delete n["max-age"]:n["max-age"]=u}return n},g.ab=function(o,n){const u=[];for(const m in o)m in n||u.push(m);return u},g.ac=ve,g.ad=function(o,n,u){var m=Math.sin(u),v=Math.cos(u),S=n[0],T=n[1],A=n[2],R=n[3],O=n[4],j=n[5],G=n[6],X=n[7];return n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=S*v+O*m,o[1]=T*v+j*m,o[2]=A*v+G*m,o[3]=R*v+X*m,o[4]=O*v-S*m,o[5]=j*v-T*m,o[6]=G*v-A*m,o[7]=X*v-R*m,o},g.ae=function(o){var n=new Mu(16);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=o[6],n[7]=o[7],n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},g.af=Qh,g.ag=function(o,n){let u=0,m=0;if(o.kind==="constant")m=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:v,minZoom:S,maxZoom:T}=o,A=v?ve(cr.interpolationFactor(v,n,S,T),0,1):0;o.kind==="camera"?m=bi.number(o.minSize,o.maxSize,A):u=A}return{uSizeT:u,uSize:m}},g.ai=function(o,{uSize:n,uSizeT:u},{lowerSize:m,upperSize:v}){return o.kind==="source"?m/ta:o.kind==="composite"?bi.number(m/ta,v/ta,u):n},g.aj=Fd,g.ak=function(o,n,u,m){const v=n.y-o.y,S=n.x-o.x,T=m.y-u.y,A=m.x-u.x,R=T*S-A*v;if(R===0)return null;const O=(A*(o.y-u.y)-T*(o.x-u.x))/R;return new L(o.x+O*S,o.y+O*v)},g.al=xg,g.am=um,g.an=vd,g.ao=function(o){let n=1/0,u=1/0,m=-1/0,v=-1/0;for(const S of o)n=Math.min(n,S.x),u=Math.min(u,S.y),m=Math.max(m,S.x),v=Math.max(v,S.y);return[n,u,m,v]},g.ap=pr,g.ar=Od,g.as=function(o,n){var u=n[0],m=n[1],v=n[2],S=n[3],T=n[4],A=n[5],R=n[6],O=n[7],j=n[8],G=n[9],X=n[10],ee=n[11],se=n[12],pe=n[13],Le=n[14],De=n[15],tt=u*A-m*T,Ge=u*R-v*T,Qe=u*O-S*T,ht=m*R-v*A,Et=m*O-S*A,$t=v*O-S*R,yn=j*pe-G*se,Wt=j*Le-X*se,Zt=j*De-ee*se,on=G*Le-X*pe,tn=G*De-ee*pe,Kt=X*De-ee*Le,yt=tt*Kt-Ge*tn+Qe*on+ht*Zt-Et*Wt+$t*yn;return yt?(o[0]=(A*Kt-R*tn+O*on)*(yt=1/yt),o[1]=(v*tn-m*Kt-S*on)*yt,o[2]=(pe*$t-Le*Et+De*ht)*yt,o[3]=(X*Et-G*$t-ee*ht)*yt,o[4]=(R*Zt-T*Kt-O*Wt)*yt,o[5]=(u*Kt-v*Zt+S*Wt)*yt,o[6]=(Le*Qe-se*$t-De*Ge)*yt,o[7]=(j*$t-X*Qe+ee*Ge)*yt,o[8]=(T*tn-A*Zt+O*yn)*yt,o[9]=(m*Zt-u*tn-S*yn)*yt,o[10]=(se*Et-pe*Qe+De*tt)*yt,o[11]=(G*Qe-j*Et-ee*tt)*yt,o[12]=(A*Wt-T*on-R*yn)*yt,o[13]=(u*on-m*Wt+v*yn)*yt,o[14]=(pe*Ge-se*ht-Le*tt)*yt,o[15]=(j*ht-G*Ge+X*tt)*yt,o):null},g.at=Hd,g.au=zd,g.av=Wd,g.aw=function(){const o={},n=Ye.$version;for(const u in Ye.$root){const m=Ye.$root[u];if(m.required){let v=null;v=u==="version"?n:m.type==="array"?[]:{},v!=null&&(o[u]=v)}}return o},g.ax=Oc,g.ay=Xe,g.az=function(o){o=o.slice();const n=Object.create(null);for(let u=0;u<o.length;u++)n[o[u].id]=o[u];for(let u=0;u<o.length;u++)"ref"in o[u]&&(o[u]=Vt(o[u],n[o[u].ref]));return o},g.b=dt,g.b0=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},g.b1=function(o,n,u){return o[0]=n[0]*u[0],o[1]=n[1]*u[1],o[2]=n[2]*u[2],o[3]=n[3]*u[3],o},g.b2=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]+o[3]*n[3]},g.b3=Pe,g.b4=pg,g.b5=fg,g.b6=function(o,n,u,m,v){var S,T=1/Math.tan(n/2);return o[0]=T/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,v!=null&&v!==1/0?(o[10]=(v+m)*(S=1/(m-v)),o[14]=2*v*m*S):(o[10]=-1,o[14]=-2*m),o},g.b7=function(o,n,u){var m=Math.sin(u),v=Math.cos(u),S=n[4],T=n[5],A=n[6],R=n[7],O=n[8],j=n[9],G=n[10],X=n[11];return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[4]=S*v+O*m,o[5]=T*v+j*m,o[6]=A*v+G*m,o[7]=R*v+X*m,o[8]=O*v-S*m,o[9]=j*v-T*m,o[10]=G*v-A*m,o[11]=X*v-R*m,o},g.b8=$,g.b9=fe,g.bA=Um,g.bB=function(o){return o.message===ft},g.bC=M,g.bD=Is,g.ba=function(o){return o*Math.PI/180},g.bb=function(o,n){const{x:u,y:m}=ih.fromLngLat(n);return!(o<0||o>25||m<0||m>=1||u<0||u>=1)},g.bc=function(o,n){return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},g.bd=class extends V{},g.be=Vd,g.bf=Mb,g.bh=Rn,g.bi=function(o,n){It.REGISTERED_PROTOCOLS[o]=n},g.bj=function(o){delete It.REGISTERED_PROTOCOLS[o]},g.bk=function(o,n){const u={};for(let v=0;v<o.length;v++){const S=n&&n[o[v].id]||rs(o[v]);n&&(n[o[v].id]=S);let T=u[S];T||(T=u[S]=[]),T.push(o[v])}const m=[];for(const v in u)m.push(u[v]);return m},g.bl=Qt,g.bm=gg,g.bn=yg,g.bo=$m,g.bp=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ar/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const n=o.bucket.layers[0],u=n.layout,m=n._unevaluatedLayout._values,v={layoutIconSize:m["icon-size"].possiblyEvaluate(new Ii(o.bucket.zoom+1),o.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Ii(o.bucket.zoom+1),o.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Ii(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:j}=o.bucket.textSizeData;v.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Ii(O),o.canonical),m["text-size"].possiblyEvaluate(new Ii(j),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:j}=o.bucket.iconSizeData;v.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Ii(O),o.canonical),m["icon-size"].possiblyEvaluate(new Ii(j),o.canonical)]}const S=u.get("text-line-height")*pr,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",A=u.get("text-keep-upright"),R=u.get("text-size");for(const O of o.bucket.features){const j=u.get("text-font").evaluate(O,{},o.canonical).join(","),G=R.evaluate(O,{},o.canonical),X=v.layoutTextSize.evaluate(O,{},o.canonical),ee=v.layoutIconSize.evaluate(O,{},o.canonical),se={horizontal:{},vertical:void 0},pe=O.text;let Le,De=[0,0];if(pe){const Qe=pe.toString(),ht=u.get("text-letter-spacing").evaluate(O,{},o.canonical)*pr,Et=ld(Qe)?ht:0,$t=u.get("text-anchor").evaluate(O,{},o.canonical),yn=Mg(n,O,o.canonical);if(!yn){const tn=u.get("text-radial-offset").evaluate(O,{},o.canonical);De=tn?Lg($t,[tn*pr,Zd]):u.get("text-offset").evaluate(O,{},o.canonical).map(Kt=>Kt*pr)}let Wt=T?"center":u.get("text-justify").evaluate(O,{},o.canonical);const Zt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(O,{},o.canonical)*pr:1/0,on=()=>{o.bucket.allowVerticalPlacement&&Fc(Qe)&&(se.vertical=of(pe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,S,$t,"left",Et,De,g.ah.vertical,!0,X,G))};if(!T&&yn){const tn=new Set;if(Wt==="auto")for(let yt=0;yt<yn.values.length;yt+=2)tn.add(Hd(yn.values[yt]));else tn.add(Wt);let Kt=!1;for(const yt of tn)if(!se.horizontal[yt])if(Kt)se.horizontal[yt]=se.horizontal[0];else{const cn=of(pe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,S,"center",yt,Et,De,g.ah.horizontal,!1,X,G);cn&&(se.horizontal[yt]=cn,Kt=cn.positionedLines.length===1)}on()}else{Wt==="auto"&&(Wt=Hd($t));const tn=of(pe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,S,$t,Wt,Et,De,g.ah.horizontal,!1,X,G);tn&&(se.horizontal[Wt]=tn),on(),Fc(Qe)&&T&&A&&(se.vertical=of(pe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,S,$t,Wt,Et,De,g.ah.vertical,!1,X,G))}}let tt=!1;if(O.icon&&O.icon.name){const Qe=o.imageMap[O.icon.name];Qe&&(Le=fb(o.imagePositions[O.icon.name],u.get("icon-offset").evaluate(O,{},o.canonical),u.get("icon-anchor").evaluate(O,{},o.canonical)),tt=!!Qe.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=tt:o.bucket.sdfIcons!==tt&&ze("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==o.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const Ge=Pg(se.horizontal)||se.vertical;o.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||Le)&&Cb(o.bucket,O,se,Le,o.imageMap,v,X,ee,De,tt,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},g.bq=Md,g.br=Td,g.bs=Ld,g.bt=al,g.bu=Pd,g.bv=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},g.bw=function(o,n,u,m,v){return l(this,void 0,void 0,function*(){if(J())try{return yield Bt(o,n,u,m,v)}catch{}return function(S,T,A,R,O){const j=S.width,G=S.height;vt&&wt||(vt=new OffscreenCanvas(j,G),wt=vt.getContext("2d",{willReadFrequently:!0})),vt.width=j,vt.height=G,wt.drawImage(S,0,0,j,G);const X=wt.getImageData(T,A,R,O);return wt.clearRect(0,0,j,G),X.data}(o,n,u,m,v)})},g.bx=mg,g.by=x,g.bz=E,g.c=xt,g.d=o=>l(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(n)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),g.e=ue,g.f=o=>new Promise((n,u)=>{const m=new Image;m.onload=()=>{n(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=ut})},m.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(o)],{type:"image/png"});m.src=o.byteLength?URL.createObjectURL(v):ut}),g.g=Jt,g.h=(o,n)=>Wn(ue(o,{type:"json"}),n),g.i=pt,g.j=Je,g.k=lt,g.l=(o,n)=>Wn(ue(o,{type:"arrayBuffer"}),n),g.m=Wn,g.n=function(o){return new Pd(o).readFields(sb,[])},g.o=Wc,g.p=Xm,g.q=k,g.r=od,g.s=dn,g.t=Nc,g.u=ka,g.v=Ye,g.w=ze,g.x=function([o,n,u]){return n+=90,n*=Math.PI/180,u*=Math.PI/180,{x:o*Math.cos(n)*Math.sin(u),y:o*Math.sin(n)*Math.sin(u),z:o*Math.cos(u)}},g.y=bi,g.z=Ii}),a("worker",["./shared"],function(g){class l{constructor(Q){this.keyCache={},Q&&this.replace(Q)}replace(Q){this._layerConfigs={},this._layers={},this.update(Q,[])}update(Q,K){for(const le of Q){this._layerConfigs[le.id]=le;const de=this._layers[le.id]=g.aA(le);de._featureFilter=g.a7(de.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of K)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const he=g.bk(Object.values(this._layerConfigs),this.keyCache);for(const le of he){const de=le.map(at=>this._layers[at.id]),Ve=de[0];if(Ve.visibility==="none")continue;const We=Ve.source||"";let Re=this.familiesBySource[We];Re||(Re=this.familiesBySource[We]={});const et=Ve.sourceLayer||"_geojsonTileLayer";let gt=Re[et];gt||(gt=Re[et]=[]),gt.push(de)}}}class x{constructor(Q){const K={},he=[];for(const We in Q){const Re=Q[We],et=K[We]={};for(const gt in Re){const at=Re[+gt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Dt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};he.push(Dt),et[gt]={rect:Dt,metrics:at.metrics}}}const{w:le,h:de}=g.p(he),Ve=new g.o({width:le||1,height:de||1});for(const We in Q){const Re=Q[We];for(const et in Re){const gt=Re[+et];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const at=K[We][et].rect;g.o.copy(gt.bitmap,Ve,{x:0,y:0},{x:at.x+1,y:at.y+1},gt.bitmap)}}this.image=Ve,this.positions=K}}g.bl("GlyphAtlas",x);class E{constructor(Q){this.tileID=new g.S(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[]}parse(Q,K,he,le){return g._(this,void 0,void 0,function*(){this.status="parsing",this.data=Q,this.collisionBoxArray=new g.a5;const de=new g.bm(Object.keys(Q.layers).sort()),Ve=new g.bn(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const We={},Re={featureIndex:Ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:he},et=K.familiesBySource[this.source];for(const Cn in et){const ni=Q.layers[Cn];if(!ni)continue;ni.version===1&&g.w(`Vector tile source "${this.source}" layer "${Cn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const hi=de.encode(Cn),Ai=[];for(let Xn=0;Xn<ni.length;Xn++){const Tr=ni.feature(Xn),No=Ve.getId(Tr,Cn);Ai.push({feature:Tr,id:No,index:Xn,sourceLayerIndex:hi})}for(const Xn of et[Cn]){const Tr=Xn[0];Tr.source!==this.source&&g.w(`layer.source = ${Tr.source} does not equal this.source = ${this.source}`),Tr.minzoom&&this.zoom<Math.floor(Tr.minzoom)||Tr.maxzoom&&this.zoom>=Tr.maxzoom||Tr.visibility!=="none"&&(C(Xn,this.zoom,he),(We[Tr.id]=Tr.createBucket({index:Ve.bucketLayerIDs.length,layers:Xn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hi,sourceID:this.source})).populate(Ai,Re,this.tileID.canonical),Ve.bucketLayerIDs.push(Xn.map(No=>No.id)))}}const gt=g.aF(Re.glyphDependencies,Cn=>Object.keys(Cn).map(Number));this.inFlightDependencies.forEach(Cn=>Cn==null?void 0:Cn.abort()),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(gt).length){const Cn=new AbortController;this.inFlightDependencies.push(Cn),at=le.sendAsync({type:"GG",data:{stacks:gt,source:this.source,tileID:this.tileID,type:"glyphs"}},Cn)}const Dt=Object.keys(Re.iconDependencies);let en=Promise.resolve({});if(Dt.length){const Cn=new AbortController;this.inFlightDependencies.push(Cn),en=le.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"icons"}},Cn)}const an=Object.keys(Re.patternDependencies);let Vn=Promise.resolve({});if(an.length){const Cn=new AbortController;this.inFlightDependencies.push(Cn),Vn=le.sendAsync({type:"GI",data:{icons:an,source:this.source,tileID:this.tileID,type:"patterns"}},Cn)}const[Mn,An,Fn]=yield Promise.all([at,en,Vn]),wi=new x(Mn),ui=new g.bo(An,Fn);for(const Cn in We){const ni=We[Cn];ni instanceof g.a6?(C(ni.layers,this.zoom,he),g.bp({bucket:ni,glyphMap:Mn,glyphPositions:wi.positions,imageMap:An,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ni.hasPattern&&(ni instanceof g.bq||ni instanceof g.br||ni instanceof g.bs)&&(C(ni.layers,this.zoom,he),ni.addFeatures(Re,this.tileID.canonical,ui.patternPositions))}return this.status="done",{buckets:Object.values(We).filter(Cn=>!Cn.isEmpty()),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wi.image,imageAtlas:ui,glyphMap:this.returnDependencies?Mn:null,iconMap:this.returnDependencies?An:null,glyphPositions:this.returnDependencies?wi.positions:null}})}}function C(Ae,Q,K){const he=new g.z(Q);for(const le of Ae)le.recalculate(he,K)}class L{constructor(Q,K,he){this.actor=Q,this.layerIndex=K,this.availableImages=he,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Q,K){return g._(this,void 0,void 0,function*(){const he=yield g.l(Q.request,K);try{return{vectorTile:new g.bt.VectorTile(new g.bu(he.data)),rawData:he.data,cacheControl:he.cacheControl,expires:he.expires}}catch(le){const de=new Uint8Array(he.data);let Ve=`Unable to parse the tile at ${Q.request.url}, `;throw Ve+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.message}`,new Error(Ve)}})}loadTile(Q){return g._(this,void 0,void 0,function*(){const K=Q.uid,he=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new g.bv(Q.request),le=new E(Q);this.loading[K]=le;const de=new AbortController;le.abort=de;try{const Ve=yield this.loadVectorTile(Q,de);if(delete this.loading[K],!Ve)return null;const We=Ve.rawData,Re={};Ve.expires&&(Re.expires=Ve.expires),Ve.cacheControl&&(Re.cacheControl=Ve.cacheControl);const et={};if(he){const at=he.finish();at&&(et.resourceTiming=JSON.parse(JSON.stringify(at)))}le.vectorTile=Ve.vectorTile;const gt=le.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[K]=le,this.fetching[K]={rawTileData:We,cacheControl:Re,resourceTiming:et};try{const at=yield gt;return g.e({rawTileData:We.slice(0)},at,Re,et)}finally{delete this.fetching[K]}}catch(Ve){throw delete this.loading[K],le.status="done",this.loaded[K]=le,Ve}})}reloadTile(Q){return g._(this,void 0,void 0,function*(){const K=Q.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const he=this.loaded[K];if(he.showCollisionBoxes=Q.showCollisionBoxes,he.status==="parsing"){const le=yield he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor);let de;if(this.fetching[K]){const{rawTileData:Ve,cacheControl:We,resourceTiming:Re}=this.fetching[K];delete this.fetching[K],de=g.e({rawTileData:Ve.slice(0)},le,We,Re)}else de=le;return de}if(he.status==="done"&&he.vectorTile)return he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Q){return g._(this,void 0,void 0,function*(){const K=this.loading,he=Q.uid;K&&K[he]&&K[he].abort&&(K[he].abort.abort(),delete K[he])})}removeTile(Q){return g._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Q.uid]&&delete this.loaded[Q.uid]})}}class N{constructor(){this.loaded={}}loadTile(Q){return g._(this,void 0,void 0,function*(){const{uid:K,encoding:he,rawImageData:le,redFactor:de,greenFactor:Ve,blueFactor:We,baseShift:Re}=Q,et=le.width+2,gt=le.height+2,at=g.b(le)?new g.R({width:et,height:gt},yield g.bw(le,-1,-1,et,gt)):le,Dt=new g.bx(K,at,he,de,Ve,We,Re);return this.loaded=this.loaded||{},this.loaded[K]=Dt,Dt})}removeTile(Q){const K=this.loaded,he=Q.uid;K&&K[he]&&delete K[he]}}function B(Ae,Q){if(Ae.length!==0){U(Ae[0],Q);for(var K=1;K<Ae.length;K++)U(Ae[K],!Q)}}function U(Ae,Q){for(var K=0,he=0,le=0,de=Ae.length,Ve=de-1;le<de;Ve=le++){var We=(Ae[le][0]-Ae[Ve][0])*(Ae[Ve][1]+Ae[le][1]),Re=K+We;he+=Math.abs(K)>=Math.abs(We)?K-Re+We:We-Re+K,K=Re}K+he>=0!=!!Q&&Ae.reverse()}var te=g.by(function Ae(Q,K){var he,le=Q&&Q.type;if(le==="FeatureCollection")for(he=0;he<Q.features.length;he++)Ae(Q.features[he],K);else if(le==="GeometryCollection")for(he=0;he<Q.geometries.length;he++)Ae(Q.geometries[he],K);else if(le==="Feature")Ae(Q.geometry,K);else if(le==="Polygon")B(Q.coordinates,K);else if(le==="MultiPolygon")for(he=0;he<Q.coordinates.length;he++)B(Q.coordinates[he],K);return Q});const ie=g.bt.VectorTileFeature.prototype.toGeoJSON;var re={exports:{}},J=g.bz,$=g.bt.VectorTileFeature,fe=ve;function ve(Ae,Q){this.options=Q||{},this.features=Ae,this.length=Ae.length}function Pe(Ae,Q){this.id=typeof Ae.id=="number"?Ae.id:void 0,this.type=Ae.type,this.rawGeometry=Ae.type===1?[Ae.geometry]:Ae.geometry,this.properties=Ae.tags,this.extent=Q||4096}ve.prototype.feature=function(Ae){return new Pe(this.features[Ae],this.options.extent)},Pe.prototype.loadGeometry=function(){var Ae=this.rawGeometry;this.geometry=[];for(var Q=0;Q<Ae.length;Q++){for(var K=Ae[Q],he=[],le=0;le<K.length;le++)he.push(new J(K[le][0],K[le][1]));this.geometry.push(he)}return this.geometry},Pe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ae=this.geometry,Q=1/0,K=-1/0,he=1/0,le=-1/0,de=0;de<Ae.length;de++)for(var Ve=Ae[de],We=0;We<Ve.length;We++){var Re=Ve[We];Q=Math.min(Q,Re.x),K=Math.max(K,Re.x),he=Math.min(he,Re.y),le=Math.max(le,Re.y)}return[Q,he,K,le]},Pe.prototype.toGeoJSON=$.prototype.toGeoJSON;var ue=g.bA,xe=fe;function be(Ae){var Q=new ue;return function(K,he){for(var le in K.layers)he.writeMessage(3,Te,K.layers[le])}(Ae,Q),Q.finish()}function Te(Ae,Q){var K;Q.writeVarintField(15,Ae.version||1),Q.writeStringField(1,Ae.name||""),Q.writeVarintField(5,Ae.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Ae.length;K++)he.feature=Ae.feature(K),Q.writeMessage(2,we,he);var le=he.keys;for(K=0;K<le.length;K++)Q.writeStringField(3,le[K]);var de=he.values;for(K=0;K<de.length;K++)Q.writeMessage(4,St,de[K])}function we(Ae,Q){var K=Ae.feature;K.id!==void 0&&Q.writeVarintField(1,K.id),Q.writeMessage(2,ye,Ae),Q.writeVarintField(3,K.type),Q.writeMessage(4,pt,K)}function ye(Ae,Q){var K=Ae.feature,he=Ae.keys,le=Ae.values,de=Ae.keycache,Ve=Ae.valuecache;for(var We in K.properties){var Re=K.properties[We],et=de[We];if(Re!==null){et===void 0&&(he.push(We),de[We]=et=he.length-1),Q.writeVarint(et);var gt=typeof Re;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(Re=JSON.stringify(Re));var at=gt+":"+Re,Dt=Ve[at];Dt===void 0&&(le.push(Re),Ve[at]=Dt=le.length-1),Q.writeVarint(Dt)}}}function ze(Ae,Q){return(Q<<3)+(7&Ae)}function Be(Ae){return Ae<<1^Ae>>31}function pt(Ae,Q){for(var K=Ae.loadGeometry(),he=Ae.type,le=0,de=0,Ve=K.length,We=0;We<Ve;We++){var Re=K[We],et=1;he===1&&(et=Re.length),Q.writeVarint(ze(1,et));for(var gt=he===3?Re.length-1:Re.length,at=0;at<gt;at++){at===1&&he!==1&&Q.writeVarint(ze(2,gt-1));var Dt=Re[at].x-le,en=Re[at].y-de;Q.writeVarint(Be(Dt)),Q.writeVarint(Be(en)),le+=Dt,de+=en}he===3&&Q.writeVarint(ze(7,1))}}function St(Ae,Q){var K=typeof Ae;K==="string"?Q.writeStringField(1,Ae):K==="boolean"?Q.writeBooleanField(7,Ae):K==="number"&&(Ae%1!=0?Q.writeDoubleField(3,Ae):Ae<0?Q.writeSVarintField(6,Ae):Q.writeVarintField(5,Ae))}re.exports=be,re.exports.fromVectorTileJs=be,re.exports.fromGeojsonVt=function(Ae,Q){Q=Q||{};var K={};for(var he in Ae)K[he]=new xe(Ae[he].features,Q),K[he].name=he,K[he].version=Q.version,K[he].extent=Q.extent;return be({layers:K})},re.exports.GeoJSONWrapper=xe;var dt=g.by(re.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},Bt=Math.fround||(vt=new Float32Array(1),Ae=>(vt[0]=+Ae,vt[0]));var vt;const wt=3,ft=5,xt=6;class It{constructor(Q){this.options=Object.assign(Object.create(ut),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:K,minZoom:he,maxZoom:le}=this.options;K&&console.time("total time");const de=`prepare ${Q.length} points`;K&&console.time(de),this.points=Q;const Ve=[];for(let Re=0;Re<Q.length;Re++){const et=Q[Re];if(!et.geometry)continue;const[gt,at]=et.geometry.coordinates,Dt=Bt(Rn(gt)),en=Bt(Xe(at));Ve.push(Dt,en,1/0,Re,-1,1),this.options.reduce&&Ve.push(0)}let We=this.trees[le+1]=this._createTree(Ve);K&&console.timeEnd(de);for(let Re=le;Re>=he;Re--){const et=+Date.now();We=this.trees[Re]=this._createTree(this._cluster(We,Re)),K&&console.log("z%d: %d clusters in %dms",Re,We.numItems,+Date.now()-et)}return K&&console.timeEnd("total time"),this}getClusters(Q,K){let he=((Q[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,Q[1]));let de=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)he=-180,de=180;else if(he>de){const at=this.getClusters([he,le,180,Ve],K),Dt=this.getClusters([-180,le,de,Ve],K);return at.concat(Dt)}const We=this.trees[this._limitZoom(K)],Re=We.range(Rn(he),Xe(Ve),Rn(de),Xe(le)),et=We.data,gt=[];for(const at of Re){const Dt=this.stride*at;gt.push(et[Dt+ft]>1?Jt(et,Dt,this.clusterProps):this.points[et[Dt+wt]])}return gt}getChildren(Q){const K=this._getOriginId(Q),he=this._getOriginZoom(Q),le="No cluster with the specified id.",de=this.trees[he];if(!de)throw new Error(le);const Ve=de.data;if(K*this.stride>=Ve.length)throw new Error(le);const We=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Re=de.within(Ve[K*this.stride],Ve[K*this.stride+1],We),et=[];for(const gt of Re){const at=gt*this.stride;Ve[at+4]===Q&&et.push(Ve[at+ft]>1?Jt(Ve,at,this.clusterProps):this.points[Ve[at+wt]])}if(et.length===0)throw new Error(le);return et}getLeaves(Q,K,he){const le=[];return this._appendLeaves(le,Q,K=K||10,he=he||0,0),le}getTile(Q,K,he){const le=this.trees[this._limitZoom(Q)],de=Math.pow(2,Q),{extent:Ve,radius:We}=this.options,Re=We/Ve,et=(he-Re)/de,gt=(he+1+Re)/de,at={features:[]};return this._addTileFeatures(le.range((K-Re)/de,et,(K+1+Re)/de,gt),le.data,K,he,de,at),K===0&&this._addTileFeatures(le.range(1-Re/de,et,1,gt),le.data,de,he,de,at),K===de-1&&this._addTileFeatures(le.range(0,et,Re/de,gt),le.data,-1,he,de,at),at.features.length?at:null}getClusterExpansionZoom(Q){let K=this._getOriginZoom(Q)-1;for(;K<=this.options.maxZoom;){const he=this.getChildren(Q);if(K++,he.length!==1)break;Q=he[0].properties.cluster_id}return K}_appendLeaves(Q,K,he,le,de){const Ve=this.getChildren(K);for(const We of Ve){const Re=We.properties;if(Re&&Re.cluster?de+Re.point_count<=le?de+=Re.point_count:de=this._appendLeaves(Q,Re.cluster_id,he,le,de):de<le?de++:Q.push(We),Q.length===he)break}return de}_createTree(Q){const K=new g.av(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<Q.length;he+=this.stride)K.add(Q[he],Q[he+1]);return K.finish(),K.data=Q,K}_addTileFeatures(Q,K,he,le,de,Ve){for(const We of Q){const Re=We*this.stride,et=K[Re+ft]>1;let gt,at,Dt;if(et)gt=pn(K,Re,this.clusterProps),at=K[Re],Dt=K[Re+1];else{const Vn=this.points[K[Re+wt]];gt=Vn.properties;const[Mn,An]=Vn.geometry.coordinates;at=Rn(Mn),Dt=Xe(An)}const en={type:1,geometry:[[Math.round(this.options.extent*(at*de-he)),Math.round(this.options.extent*(Dt*de-le))]],tags:gt};let an;an=et||this.options.generateId?K[Re+wt]:this.points[K[Re+wt]].id,an!==void 0&&(en.id=an),Ve.features.push(en)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,K){const{radius:he,extent:le,reduce:de,minPoints:Ve}=this.options,We=he/(le*Math.pow(2,K)),Re=Q.data,et=[],gt=this.stride;for(let at=0;at<Re.length;at+=gt){if(Re[at+2]<=K)continue;Re[at+2]=K;const Dt=Re[at],en=Re[at+1],an=Q.within(Re[at],Re[at+1],We),Vn=Re[at+ft];let Mn=Vn;for(const An of an){const Fn=An*gt;Re[Fn+2]>K&&(Mn+=Re[Fn+ft])}if(Mn>Vn&&Mn>=Ve){let An,Fn=Dt*Vn,wi=en*Vn,ui=-1;const Cn=((at/gt|0)<<5)+(K+1)+this.points.length;for(const ni of an){const hi=ni*gt;if(Re[hi+2]<=K)continue;Re[hi+2]=K;const Ai=Re[hi+ft];Fn+=Re[hi]*Ai,wi+=Re[hi+1]*Ai,Re[hi+4]=Cn,de&&(An||(An=this._map(Re,at,!0),ui=this.clusterProps.length,this.clusterProps.push(An)),de(An,this._map(Re,hi)))}Re[at+4]=Cn,et.push(Fn/Mn,wi/Mn,1/0,Cn,-1,Mn),de&&et.push(ui)}else{for(let An=0;An<gt;An++)et.push(Re[at+An]);if(Mn>1)for(const An of an){const Fn=An*gt;if(!(Re[Fn+2]<=K)){Re[Fn+2]=K;for(let wi=0;wi<gt;wi++)et.push(Re[Fn+wi])}}}}return et}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,K,he){if(Q[K+ft]>1){const Ve=this.clusterProps[Q[K+xt]];return he?Object.assign({},Ve):Ve}const le=this.points[Q[K+wt]].properties,de=this.options.map(le);return he&&de===le?Object.assign({},de):de}}function Jt(Ae,Q,K){return{type:"Feature",id:Ae[Q+wt],properties:pn(Ae,Q,K),geometry:{type:"Point",coordinates:[(he=Ae[Q],360*(he-.5)),Wn(Ae[Q+1])]}};var he}function pn(Ae,Q,K){const he=Ae[Q+ft],le=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,de=Ae[Q+xt],Ve=de===-1?{}:Object.assign({},K[de]);return Object.assign(Ve,{cluster:!0,cluster_id:Ae[Q+wt],point_count:he,point_count_abbreviated:le})}function Rn(Ae){return Ae/360+.5}function Xe(Ae){const Q=Math.sin(Ae*Math.PI/180),K=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return K<0?0:K>1?1:K}function Wn(Ae){const Q=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function dn(Ae,Q,K,he){let le=he;const de=Q+(K-Q>>1);let Ve,We=K-Q;const Re=Ae[Q],et=Ae[Q+1],gt=Ae[K],at=Ae[K+1];for(let Dt=Q+3;Dt<K;Dt+=3){const en=Ft(Ae[Dt],Ae[Dt+1],Re,et,gt,at);if(en>le)Ve=Dt,le=en;else if(en===le){const an=Math.abs(Dt-de);an<We&&(Ve=Dt,We=an)}}le>he&&(Ve-Q>3&&dn(Ae,Q,Ve,he),Ae[Ve+2]=le,K-Ve>3&&dn(Ae,Ve,K,he))}function Ft(Ae,Q,K,he,le,de){let Ve=le-K,We=de-he;if(Ve!==0||We!==0){const Re=((Ae-K)*Ve+(Q-he)*We)/(Ve*Ve+We*We);Re>1?(K=le,he=de):Re>0&&(K+=Ve*Re,he+=We*Re)}return Ve=Ae-K,We=Q-he,Ve*Ve+We*We}function Se(Ae,Q,K,he){const le={id:Ae??null,type:Q,geometry:K,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")lt(le,K);else if(Q==="Polygon")lt(le,K[0]);else if(Q==="MultiLineString")for(const de of K)lt(le,de);else if(Q==="MultiPolygon")for(const de of K)lt(le,de[0]);return le}function lt(Ae,Q){for(let K=0;K<Q.length;K+=3)Ae.minX=Math.min(Ae.minX,Q[K]),Ae.minY=Math.min(Ae.minY,Q[K+1]),Ae.maxX=Math.max(Ae.maxX,Q[K]),Ae.maxY=Math.max(Ae.maxY,Q[K+1])}function Je(Ae,Q,K,he){if(!Q.geometry)return;const le=Q.geometry.coordinates;if(le&&le.length===0)return;const de=Q.geometry.type,Ve=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let We=[],Re=Q.id;if(K.promoteId?Re=Q.properties[K.promoteId]:K.generateId&&(Re=he||0),de==="Point")Lt(le,We);else if(de==="MultiPoint")for(const et of le)Lt(et,We);else if(de==="LineString")Ye(le,We,Ve,!1);else if(de==="MultiLineString"){if(K.lineMetrics){for(const et of le)We=[],Ye(et,We,Ve,!1),Ae.push(Se(Re,"LineString",We,Q.properties));return}kt(le,We,Ve,!1)}else if(de==="Polygon")kt(le,We,Ve,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const et of Q.geometry.geometries)Je(Ae,{id:Re,geometry:et,properties:Q.properties},K,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const et of le){const gt=[];kt(et,gt,Ve,!0),We.push(gt)}}Ae.push(Se(Re,de,We,Q.properties))}function Lt(Ae,Q){Q.push(Vt(Ae[0]),Ee(Ae[1]),0)}function Ye(Ae,Q,K,he){let le,de,Ve=0;for(let Re=0;Re<Ae.length;Re++){const et=Vt(Ae[Re][0]),gt=Ee(Ae[Re][1]);Q.push(et,gt,0),Re>0&&(Ve+=he?(le*gt-et*de)/2:Math.sqrt(Math.pow(et-le,2)+Math.pow(gt-de,2))),le=et,de=gt}const We=Q.length-3;Q[2]=1,dn(Q,0,We,K),Q[We+2]=1,Q.size=Math.abs(Ve),Q.start=0,Q.end=Q.size}function kt(Ae,Q,K,he){for(let le=0;le<Ae.length;le++){const de=[];Ye(Ae[le],de,K,he),Q.push(de)}}function Vt(Ae){return Ae/360+.5}function Ee(Ae){const Q=Math.sin(Ae*Math.PI/180),K=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return K<0?0:K>1?1:K}function Gt(Ae,Q,K,he,le,de,Ve,We){if(he/=Q,de>=(K/=Q)&&Ve<he)return Ae;if(Ve<K||de>=he)return null;const Re=[];for(const et of Ae){const gt=et.geometry;let at=et.type;const Dt=le===0?et.minX:et.minY,en=le===0?et.maxX:et.maxY;if(Dt>=K&&en<he){Re.push(et);continue}if(en<K||Dt>=he)continue;let an=[];if(at==="Point"||at==="MultiPoint")_n(gt,an,K,he,le);else if(at==="LineString")Kn(gt,an,K,he,le,!1,We.lineMetrics);else if(at==="MultiLineString")xn(gt,an,K,he,le,!1);else if(at==="Polygon")xn(gt,an,K,he,le,!0);else if(at==="MultiPolygon")for(const Vn of gt){const Mn=[];xn(Vn,Mn,K,he,le,!0),Mn.length&&an.push(Mn)}if(an.length){if(We.lineMetrics&&at==="LineString"){for(const Vn of an)Re.push(Se(et.id,at,Vn,et.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(an.length===1?(at="LineString",an=an[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=an.length===3?"Point":"MultiPoint"),Re.push(Se(et.id,at,an,et.tags))}}return Re.length?Re:null}function _n(Ae,Q,K,he,le){for(let de=0;de<Ae.length;de+=3){const Ve=Ae[de+le];Ve>=K&&Ve<=he&&qi(Q,Ae[de],Ae[de+1],Ae[de+2])}}function Kn(Ae,Q,K,he,le,de,Ve){let We=Yi(Ae);const Re=le===0?Ji:Jr;let et,gt,at=Ae.start;for(let Mn=0;Mn<Ae.length-3;Mn+=3){const An=Ae[Mn],Fn=Ae[Mn+1],wi=Ae[Mn+2],ui=Ae[Mn+3],Cn=Ae[Mn+4],ni=le===0?An:Fn,hi=le===0?ui:Cn;let Ai=!1;Ve&&(et=Math.sqrt(Math.pow(An-ui,2)+Math.pow(Fn-Cn,2))),ni<K?hi>K&&(gt=Re(We,An,Fn,ui,Cn,K),Ve&&(We.start=at+et*gt)):ni>he?hi<he&&(gt=Re(We,An,Fn,ui,Cn,he),Ve&&(We.start=at+et*gt)):qi(We,An,Fn,wi),hi<K&&ni>=K&&(gt=Re(We,An,Fn,ui,Cn,K),Ai=!0),hi>he&&ni<=he&&(gt=Re(We,An,Fn,ui,Cn,he),Ai=!0),!de&&Ai&&(Ve&&(We.end=at+et*gt),Q.push(We),We=Yi(Ae)),Ve&&(at+=et)}let Dt=Ae.length-3;const en=Ae[Dt],an=Ae[Dt+1],Vn=le===0?en:an;Vn>=K&&Vn<=he&&qi(We,en,an,Ae[Dt+2]),Dt=We.length-3,de&&Dt>=3&&(We[Dt]!==We[0]||We[Dt+1]!==We[1])&&qi(We,We[0],We[1],We[2]),We.length&&Q.push(We)}function Yi(Ae){const Q=[];return Q.size=Ae.size,Q.start=Ae.start,Q.end=Ae.end,Q}function xn(Ae,Q,K,he,le,de){for(const Ve of Ae)Kn(Ve,Q,K,he,le,de,!1)}function qi(Ae,Q,K,he){Ae.push(Q,K,he)}function Ji(Ae,Q,K,he,le,de){const Ve=(de-Q)/(he-Q);return qi(Ae,de,K+(le-K)*Ve,1),Ve}function Jr(Ae,Q,K,he,le,de){const Ve=(de-K)/(le-K);return qi(Ae,Q+(he-Q)*Ve,de,1),Ve}function ct(Ae,Q){const K=[];for(let he=0;he<Ae.length;he++){const le=Ae[he],de=le.type;let Ve;if(de==="Point"||de==="MultiPoint"||de==="LineString")Ve=gr(le.geometry,Q);else if(de==="MultiLineString"||de==="Polygon"){Ve=[];for(const We of le.geometry)Ve.push(gr(We,Q))}else if(de==="MultiPolygon"){Ve=[];for(const We of le.geometry){const Re=[];for(const et of We)Re.push(gr(et,Q));Ve.push(Re)}}K.push(Se(le.id,de,Ve,le.tags))}return K}function gr(Ae,Q){const K=[];K.size=Ae.size,Ae.start!==void 0&&(K.start=Ae.start,K.end=Ae.end);for(let he=0;he<Ae.length;he+=3)K.push(Ae[he]+Q,Ae[he+1],Ae[he+2]);return K}function kn(Ae,Q){if(Ae.transformed)return Ae;const K=1<<Ae.z,he=Ae.x,le=Ae.y;for(const de of Ae.features){const Ve=de.geometry,We=de.type;if(de.geometry=[],We===1)for(let Re=0;Re<Ve.length;Re+=2)de.geometry.push(mn(Ve[Re],Ve[Re+1],Q,K,he,le));else for(let Re=0;Re<Ve.length;Re++){const et=[];for(let gt=0;gt<Ve[Re].length;gt+=2)et.push(mn(Ve[Re][gt],Ve[Re][gt+1],Q,K,he,le));de.geometry.push(et)}}return Ae.transformed=!0,Ae}function mn(Ae,Q,K,he,le,de){return[Math.round(K*(Ae*he-le)),Math.round(K*(Q*he-de))]}function As(Ae,Q,K,he,le){const de=Q===le.maxZoom?0:le.tolerance/((1<<Q)*le.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:K,y:he,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of Ae)At(Ve,We,de,le);return Ve}function At(Ae,Q,K,he){const le=Q.geometry,de=Q.type,Ve=[];if(Ae.minX=Math.min(Ae.minX,Q.minX),Ae.minY=Math.min(Ae.minY,Q.minY),Ae.maxX=Math.max(Ae.maxX,Q.maxX),Ae.maxY=Math.max(Ae.maxY,Q.maxY),de==="Point"||de==="MultiPoint")for(let We=0;We<le.length;We+=3)Ve.push(le[We],le[We+1]),Ae.numPoints++,Ae.numSimplified++;else if(de==="LineString")Ln(Ve,le,Ae,K,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let We=0;We<le.length;We++)Ln(Ve,le[We],Ae,K,de==="Polygon",We===0);else if(de==="MultiPolygon")for(let We=0;We<le.length;We++){const Re=le[We];for(let et=0;et<Re.length;et++)Ln(Ve,Re[et],Ae,K,!0,et===0)}if(Ve.length){let We=Q.tags||null;if(de==="LineString"&&he.lineMetrics){We={};for(const et in Q.tags)We[et]=Q.tags[et];We.mapbox_clip_start=le.start/le.size,We.mapbox_clip_end=le.end/le.size}const Re={geometry:Ve,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:We};Q.id!==null&&(Re.id=Q.id),Ae.features.push(Re)}}function Ln(Ae,Q,K,he,le,de){const Ve=he*he;if(he>0&&Q.size<(le?Ve:he))return void(K.numPoints+=Q.length/3);const We=[];for(let Re=0;Re<Q.length;Re+=3)(he===0||Q[Re+2]>Ve)&&(K.numSimplified++,We.push(Q[Re],Q[Re+1])),K.numPoints++;le&&function(Re,et){let gt=0;for(let at=0,Dt=Re.length,en=Dt-2;at<Dt;en=at,at+=2)gt+=(Re[at]-Re[en])*(Re[at+1]+Re[en+1]);if(gt>0===et)for(let at=0,Dt=Re.length;at<Dt/2;at+=2){const en=Re[at],an=Re[at+1];Re[at]=Re[Dt-2-at],Re[at+1]=Re[Dt-1-at],Re[Dt-2-at]=en,Re[Dt-1-at]=an}}(We,de),Ae.push(We)}const Tt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _r{constructor(Q,K){const he=(K=this.options=function(de,Ve){for(const We in Ve)de[We]=Ve[We];return de}(Object.create(Tt),K)).debug;if(he&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let le=function(de,Ve){const We=[];if(de.type==="FeatureCollection")for(let Re=0;Re<de.features.length;Re++)Je(We,de.features[Re],Ve,Re);else Je(We,de.type==="Feature"?de:{geometry:de},Ve);return We}(Q,K);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(de,Ve){const We=Ve.buffer/Ve.extent;let Re=de;const et=Gt(de,1,-1-We,We,0,-1,2,Ve),gt=Gt(de,1,1-We,2+We,0,-1,2,Ve);return(et||gt)&&(Re=Gt(de,1,-We,1+We,0,-1,2,Ve)||[],et&&(Re=ct(et,1).concat(Re)),gt&&(Re=Re.concat(ct(gt,-1)))),Re}(le,K),le.length&&this.splitTile(le,0,0,0),he&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,K,he,le,de,Ve,We){const Re=[Q,K,he,le],et=this.options,gt=et.debug;for(;Re.length;){le=Re.pop(),he=Re.pop(),K=Re.pop(),Q=Re.pop();const at=1<<K,Dt=Gr(K,he,le);let en=this.tiles[Dt];if(!en&&(gt>1&&console.time("creation"),en=this.tiles[Dt]=As(Q,K,he,le,et),this.tileCoords.push({z:K,x:he,y:le}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,he,le,en.numFeatures,en.numPoints,en.numSimplified),console.timeEnd("creation"));const Ai=`z${K}`;this.stats[Ai]=(this.stats[Ai]||0)+1,this.total++}if(en.source=Q,de==null){if(K===et.indexMaxZoom||en.numPoints<=et.indexMaxPoints)continue}else{if(K===et.maxZoom||K===de)continue;if(de!=null){const Ai=de-K;if(he!==Ve>>Ai||le!==We>>Ai)continue}}if(en.source=null,Q.length===0)continue;gt>1&&console.time("clipping");const an=.5*et.buffer/et.extent,Vn=.5-an,Mn=.5+an,An=1+an;let Fn=null,wi=null,ui=null,Cn=null,ni=Gt(Q,at,he-an,he+Mn,0,en.minX,en.maxX,et),hi=Gt(Q,at,he+Vn,he+An,0,en.minX,en.maxX,et);Q=null,ni&&(Fn=Gt(ni,at,le-an,le+Mn,1,en.minY,en.maxY,et),wi=Gt(ni,at,le+Vn,le+An,1,en.minY,en.maxY,et),ni=null),hi&&(ui=Gt(hi,at,le-an,le+Mn,1,en.minY,en.maxY,et),Cn=Gt(hi,at,le+Vn,le+An,1,en.minY,en.maxY,et),hi=null),gt>1&&console.timeEnd("clipping"),Re.push(Fn||[],K+1,2*he,2*le),Re.push(wi||[],K+1,2*he,2*le+1),Re.push(ui||[],K+1,2*he+1,2*le),Re.push(Cn||[],K+1,2*he+1,2*le+1)}}getTile(Q,K,he){Q=+Q,K=+K,he=+he;const le=this.options,{extent:de,debug:Ve}=le;if(Q<0||Q>24)return null;const We=1<<Q,Re=Gr(Q,K=K+We&We-1,he);if(this.tiles[Re])return kn(this.tiles[Re],de);Ve>1&&console.log("drilling down to z%d-%d-%d",Q,K,he);let et,gt=Q,at=K,Dt=he;for(;!et&&gt>0;)gt--,at>>=1,Dt>>=1,et=this.tiles[Gr(gt,at,Dt)];return et&&et.source?(Ve>1&&(console.log("found parent tile z%d-%d-%d",gt,at,Dt),console.time("drilling down")),this.splitTile(et.source,gt,at,Dt,Q,K,he),Ve>1&&console.timeEnd("drilling down"),this.tiles[Re]?kn(this.tiles[Re],de):null):null}}function Gr(Ae,Q,K){return 32*((1<<Ae)*K+Q)+Ae}function wn(Ae,Q){return Q?Ae.properties[Q]:Ae.id}function Mi(Ae,Q){if(Ae==null)return!0;if(Ae.type==="Feature")return wn(Ae,Q)!=null;if(Ae.type==="FeatureCollection"){const K=new Set;for(const he of Ae.features){const le=wn(he,Q);if(le==null||K.has(le))return!1;K.add(le)}return!0}return!1}function Er(Ae,Q){const K=new Map;if(Ae!=null)if(Ae.type==="Feature")K.set(wn(Ae,Q),Ae);else for(const he of Ae.features)K.set(wn(he,Q),he);return K}class Ki extends L{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Q,K){return g._(this,void 0,void 0,function*(){const he=Q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!le)return null;const de=new class{constructor(We){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.X,this.length=We.length,this._features=We}feature(We){return new class{constructor(Re){this._feature=Re,this.extent=g.X,this.type=Re.type,this.properties=Re.tags,"id"in Re&&!isNaN(Re.id)&&(this.id=parseInt(Re.id,10))}loadGeometry(){if(this._feature.type===1){const Re=[];for(const et of this._feature.geometry)Re.push([new g.P(et[0],et[1])]);return Re}{const Re=[];for(const et of this._feature.geometry){const gt=[];for(const at of et)gt.push(new g.P(at[0],at[1]));Re.push(gt)}return Re}}toGeoJSON(Re,et,gt){return ie.call(this,Re,et,gt)}}(this._features[We])}}(le.features);let Ve=dt(de);return Ve.byteOffset===0&&Ve.byteLength===Ve.buffer.byteLength||(Ve=new Uint8Array(Ve)),{vectorTile:de,rawData:Ve.buffer}})}loadData(Q){return g._(this,void 0,void 0,function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const he=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new g.bv(Q.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Q,this._pendingRequest),this._geoJSONIndex=Q.cluster?new It(function({superclusterOptions:Ve,clusterProperties:We}){if(!We||!Ve)return Ve;const Re={},et={},gt={accumulated:null,zoom:0},at={properties:null},Dt=Object.keys(We);for(const en of Dt){const[an,Vn]=We[en],Mn=g.bC(Vn),An=g.bC(typeof an=="string"?[an,["accumulated"],["get",en]]:an);Re[en]=Mn.value,et[en]=An.value}return Ve.map=en=>{at.properties=en;const an={};for(const Vn of Dt)an[Vn]=Re[Vn].evaluate(gt,at);return an},Ve.reduce=(en,an)=>{at.properties=an;for(const Vn of Dt)gt.accumulated=en[Vn],en[Vn]=et[Vn].evaluate(gt,at)},Ve}(Q)).load((yield this._pendingData).features):(le=yield this._pendingData,new _r(le,Q.geojsonVtOptions)),this.loaded={};const de={};if(he){const Ve=he.finish();Ve&&(de.resourceTiming={},de.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Ve)))}return de}catch(de){if(delete this._pendingRequest,g.bB(de))return{abandoned:!0};throw de}var le})}getData(){return g._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Q){const K=this.loaded;return K&&K[Q.uid]?super.reloadTile(Q):this.loadTile(Q)}loadAndProcessGeoJSON(Q,K){return g._(this,void 0,void 0,function*(){let he=yield this.loadGeoJSON(Q,K);if(delete this._pendingRequest,typeof he!="object")throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(te(he,!0),Q.filter){const le=g.bC(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));he={type:"FeatureCollection",features:he.features.filter(Ve=>le.value.evaluate({zoom:0},Ve))}}return he})}loadGeoJSON(Q,K){return g._(this,void 0,void 0,function*(){const{promoteId:he}=Q;if(Q.request){const le=yield g.h(Q.request,K);return this._dataUpdateable=Mi(le.data,he)?Er(le.data,he):void 0,le.data}if(typeof Q.data=="string")try{const le=JSON.parse(Q.data);return this._dataUpdateable=Mi(le,he)?Er(le,he):void 0,le}catch{throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`)}if(!Q.dataDiff)throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Q.source}`);return function(le,de,Ve){var We,Re,et,gt;if(de.removeAll&&le.clear(),de.remove)for(const at of de.remove)le.delete(at);if(de.add)for(const at of de.add){const Dt=wn(at,Ve);Dt!=null&&le.set(Dt,at)}if(de.update)for(const at of de.update){let Dt=le.get(at.id);if(Dt==null)continue;const en=!at.removeAllProperties&&(((We=at.removeProperties)===null||We===void 0?void 0:We.length)>0||((Re=at.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0);if((at.newGeometry||at.removeAllProperties||en)&&(Dt=Object.assign({},Dt),le.set(at.id,Dt),en&&(Dt.properties=Object.assign({},Dt.properties))),at.newGeometry&&(Dt.geometry=at.newGeometry),at.removeAllProperties)Dt.properties={};else if(((et=at.removeProperties)===null||et===void 0?void 0:et.length)>0)for(const an of at.removeProperties)Object.prototype.hasOwnProperty.call(Dt.properties,an)&&delete Dt.properties[an];if(((gt=at.addOrUpdateProperties)===null||gt===void 0?void 0:gt.length)>0)for(const{key:an,value:Vn}of at.addOrUpdateProperties)Dt.properties[an]=Vn}}(this._dataUpdateable,Q.dataDiff,he),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Q){return g._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Q){return this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId)}getClusterChildren(Q){return this._geoJSONIndex.getChildren(Q.clusterId)}getClusterLeaves(Q){return this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset)}}class Zr{constructor(Q){this.self=Q,this.actor=new g.F(Q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(K,he)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=he},this.self.addProtocol=g.bi,this.self.removeProtocol=g.bj,this.self.registerRTLTextPlugin=K=>{if(g.bD.isParsed())throw new Error("RTL text plugin already registered.");g.bD.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,he)=>this._getDEMWorkerSource(K,he.source).loadTile(he)),this.actor.registerMessageHandler("RDT",(K,he)=>g._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,he.source).removeTile(he)})),this.actor.registerMessageHandler("GCEZ",(K,he)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(K,he.type,he.source).getClusterExpansionZoom(he)})),this.actor.registerMessageHandler("GCC",(K,he)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(K,he.type,he.source).getClusterChildren(he)})),this.actor.registerMessageHandler("GCL",(K,he)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(K,he.type,he.source).getClusterLeaves(he)})),this.actor.registerMessageHandler("LD",(K,he)=>this._getWorkerSource(K,he.type,he.source).loadData(he)),this.actor.registerMessageHandler("GD",(K,he)=>this._getWorkerSource(K,he.type,he.source).getData()),this.actor.registerMessageHandler("LT",(K,he)=>this._getWorkerSource(K,he.type,he.source).loadTile(he)),this.actor.registerMessageHandler("RT",(K,he)=>this._getWorkerSource(K,he.type,he.source).reloadTile(he)),this.actor.registerMessageHandler("AT",(K,he)=>this._getWorkerSource(K,he.type,he.source).abortTile(he)),this.actor.registerMessageHandler("RMT",(K,he)=>this._getWorkerSource(K,he.type,he.source).removeTile(he)),this.actor.registerMessageHandler("RS",(K,he)=>g._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][he.type]||!this.workerSources[K][he.type][he.source])return;const le=this.workerSources[K][he.type][he.source];delete this.workerSources[K][he.type][he.source],le.removeSource!==void 0&&le.removeSource(he)})),this.actor.registerMessageHandler("RM",K=>g._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K]})),this.actor.registerMessageHandler("SR",(K,he)=>g._(this,void 0,void 0,function*(){this.referrer=he})),this.actor.registerMessageHandler("SRPS",(K,he)=>this._syncRTLPluginState(K,he)),this.actor.registerMessageHandler("IS",(K,he)=>g._(this,void 0,void 0,function*(){this.self.importScripts(he)})),this.actor.registerMessageHandler("SI",(K,he)=>this._setImages(K,he)),this.actor.registerMessageHandler("UL",(K,he)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(he.layers,he.removedIds)})),this.actor.registerMessageHandler("SL",(K,he)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(he)}))}_setImages(Q,K){return g._(this,void 0,void 0,function*(){this.availableImages[Q]=K;for(const he in this.workerSources[Q]){const le=this.workerSources[Q][he];for(const de in le)le[de].availableImages=K}})}_syncRTLPluginState(Q,K){return g._(this,void 0,void 0,function*(){if(g.bD.isParsed())return g.bD.getState();if(K.pluginStatus!=="loading")return g.bD.setState(K),K;const he=K.pluginURL;if(this.self.importScripts(he),g.bD.isParsed()){const le={pluginStatus:"loaded",pluginURL:he};return g.bD.setState(le),le}throw g.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${he}`)})}_getAvailableImages(Q){let K=this.availableImages[Q];return K||(K=[]),K}_getLayerIndex(Q){let K=this.layerIndexes[Q];return K||(K=this.layerIndexes[Q]=new l),K}_getWorkerSource(Q,K,he){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][K]||(this.workerSources[Q][K]={}),!this.workerSources[Q][K][he]){const le={sendAsync:(de,Ve)=>(de.targetMapId=Q,this.actor.sendAsync(de,Ve))};switch(K){case"vector":this.workerSources[Q][K][he]=new L(le,this._getLayerIndex(Q),this._getAvailableImages(Q));break;case"geojson":this.workerSources[Q][K][he]=new Ki(le,this._getLayerIndex(Q),this._getAvailableImages(Q));break;default:this.workerSources[Q][K][he]=new this.externalWorkerSourceTypes[K](le,this._getLayerIndex(Q),this._getAvailableImages(Q))}}return this.workerSources[Q][K][he]}_getDEMWorkerSource(Q,K){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][K]||(this.demWorkerSources[Q][K]=new N),this.demWorkerSources[Q][K]}}return g.i(self)&&(self.worker=new Zr(self)),Zr}),a("index",["exports","./shared"],function(g,l){var x="4.7.0";let E,C;const L={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:k=>new Promise((t,h)=>{const _=requestAnimationFrame(t);k.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),h(l.c())})}),getImageData(k,t=0){return this.getImageCanvasContext(k).getImageData(-t,-t,k.width+2*t,k.height+2*t)},getImageCanvasContext(k){const t=window.document.createElement("canvas"),h=t.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return t.width=k.width,t.height=k.height,h.drawImage(k,0,0,k.width,k.height),h},resolveURL:k=>(E||(E=document.createElement("a")),E.href=k,E.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(C==null&&(C=matchMedia("(prefers-reduced-motion: reduce)")),C.matches)}};class N{static testProp(t){if(!N.docStyle)return t[0];for(let h=0;h<t.length;h++)if(t[h]in N.docStyle)return t[h];return t[0]}static create(t,h,_){const y=window.document.createElement(t);return h!==void 0&&(y.className=h),_&&_.appendChild(y),y}static createNS(t,h){return window.document.createElementNS(t,h)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(t,h){t.style[N.transformProp]=h}static addEventListener(t,h,_,y={}){t.addEventListener(h,_,"passive"in y?y:y.capture)}static removeEventListener(t,h,_,y={}){t.removeEventListener(h,_,"passive"in y?y:y.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(t){const h=t.getBoundingClientRect();return{x:h.width/t.offsetWidth||1,y:h.height/t.offsetHeight||1,boundingClientRect:h}}static getPoint(t,h,_){const y=h.boundingClientRect;return new l.P((_.clientX-y.left)/h.x-t.clientLeft,(_.clientY-y.top)/h.y-t.clientTop)}static mousePos(t,h){const _=N.getScale(t);return N.getPoint(t,_,h)}static touchPos(t,h){const _=[],y=N.getScale(t);for(let w=0;w<h.length;w++)_.push(N.getPoint(t,y,h[w]));return _}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(k){!ie&&te&&(re?J(k):U=k)}};let U,te,ie=!1,re=!1;function J(k){const t=k.createTexture();k.bindTexture(k.TEXTURE_2D,t);try{if(k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,te),k.isContextLost())return;B.supported=!0}catch{}k.deleteTexture(t),ie=!0}var $;typeof document<"u"&&(te=document.createElement("img"),te.onload=()=>{U&&J(U),U=null,re=!0},te.onerror=()=>{ie=!0,U=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(k){let t,h,_,y;k.resetRequestQueue=()=>{t=[],h=0,_=0,y={}},k.addThrottleControl=z=>{const V=_++;return y[V]=z,V},k.removeThrottleControl=z=>{delete y[z],P()},k.getImage=(z,V,H=!0)=>new Promise((W,ne)=>{B.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),l.e(z,{type:"image"}),t.push({abortController:V,requestParameters:z,supportImageRefresh:H,state:"queued",onError:ge=>{ne(ge)},onSuccess:ge=>{W(ge)}}),P()});const w=z=>l._(this,void 0,void 0,function*(){z.state="running";const{requestParameters:V,supportImageRefresh:H,onError:W,onSuccess:ne,abortController:ge}=z,ke=H===!1&&!l.i(self)&&!l.g(V.url)&&(!V.headers||Object.keys(V.headers).reduce((Oe,qe)=>Oe&&qe==="accept",!0));h++;const Me=ke?D(V,ge):l.m(V,ge);try{const Oe=yield Me;delete z.abortController,z.state="completed",Oe.data instanceof HTMLImageElement||l.b(Oe.data)?ne(Oe):Oe.data&&ne({data:yield(Ne=Oe.data,typeof createImageBitmap=="function"?l.d(Ne):l.f(Ne)),cacheControl:Oe.cacheControl,expires:Oe.expires})}catch(Oe){delete z.abortController,W(Oe)}finally{h--,P()}var Ne}),P=()=>{const z=(()=>{for(const V of Object.keys(y))if(y[V]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let V=h;V<z&&t.length>0;V++){const H=t.shift();H.abortController.signal.aborted?V--:w(H)}},D=(z,V)=>new Promise((H,W)=>{const ne=new Image,ge=z.url,ke=z.credentials;ke&&ke==="include"?ne.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!l.s(ge))&&(ne.crossOrigin="anonymous"),V.signal.addEventListener("abort",()=>{ne.src="",W(l.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,H({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,V.signal.aborted||W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=ge})}($||($={})),$.resetRequestQueue();class fe{constructor(t){this._transformRequestFn=t}transformRequest(t,h){return this._transformRequestFn&&this._transformRequestFn(t,h)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ve(k){var t=new l.A(3);return t[0]=k[0],t[1]=k[1],t[2]=k[2],t}var Pe,ue=function(k,t,h){return k[0]=t[0]-h[0],k[1]=t[1]-h[1],k[2]=t[2]-h[2],k};Pe=new l.A(3),l.A!=Float32Array&&(Pe[0]=0,Pe[1]=0,Pe[2]=0);var xe=function(k){var t=k[0],h=k[1];return t*t+h*h};function be(k){const t=[];if(typeof k=="string")t.push({id:"default",url:k});else if(k&&k.length>0){const h=[];for(const{id:_,url:y}of k){const w=`${_}${y}`;h.indexOf(w)===-1&&(h.push(w),t.push({id:_,url:y}))}}return t}function Te(k,t,h){const _=k.split("?");return _[0]+=`${t}${h}`,_.join("?")}(function(){var k=new l.A(2);l.A!=Float32Array&&(k[0]=0,k[1]=0)})();class we{constructor(t,h,_,y){this.context=t,this.format=_,this.texture=t.gl.createTexture(),this.update(h,y)}update(t,h,_){const{width:y,height:w}=t,P=!(this.size&&this.size[0]===y&&this.size[1]===w||_),{context:D}=this,{gl:z}=D;if(this.useMipmap=!!(h&&h.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!h||h.premultiply!==!1)),P)this.size=[y,w],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,t):z.texImage2D(z.TEXTURE_2D,0,this.format,y,w,0,this.format,z.UNSIGNED_BYTE,t.data);else{const{x:V,y:H}=_||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texSubImage2D(z.TEXTURE_2D,0,V,H,z.RGBA,z.UNSIGNED_BYTE,t):z.texSubImage2D(z.TEXTURE_2D,0,V,H,y,w,z.RGBA,z.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(t,h,_){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),_!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=w.LINEAR),t!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,t),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,_||t),this.filter=t),h!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,h),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ye(k){const{userImage:t}=k;return!!(t&&t.render&&t.render())&&(k.data.replace(new Uint8Array(t.data.buffer)),!0)}class ze extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:h,promiseResolve:_}of this.requestors)_(this._getImagesForIds(h));this.requestors=[]}}getImage(t){const h=this.images[t];if(h&&!h.data&&h.spriteData){const _=h.spriteData;h.data=new l.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),h.spriteData=null}return h}addImage(t,h){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,h)&&(this.images[t]=h)}_validate(t,h){let _=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "content" value`))),_=!1),_}_validateStretch(t,h){if(!t)return!0;let _=0;for(const y of t){if(y[0]<_||y[1]<y[0]||h<y[1])return!1;_=y[1]}return!0}_validateContent(t,h){if(!t)return!0;if(t.length!==4)return!1;const _=h.spriteData,y=_&&_.width||h.data.width,w=_&&_.height||h.data.height;return!(t[0]<0||y<t[0]||t[1]<0||w<t[1]||t[2]<0||y<t[2]||t[3]<0||w<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,h,_=!0){const y=this.getImage(t);if(_&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[t]=h,this.updatedImages[t]=!0}removeImage(t){const h=this.images[t];delete this.images[t],delete this.patterns[t],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((h,_)=>{let y=!0;if(!this.isLoaded())for(const w of t)this.images[w]||(y=!1);this.isLoaded()||y?h(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:h})})}_getImagesForIds(t){const h={};for(const _ of t){let y=this.getImage(_);y||(this.fire(new l.k("styleimagemissing",{id:_})),y=this.getImage(_)),y?h[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:l.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:t,height:h}=this.atlasImage;return{width:t,height:h}}getPattern(t){const h=this.patterns[t],_=this.getImage(t);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new l.I(y,_);this.patterns[t]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const h=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(t,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const w in this.patterns)t.push(this.patterns[w].bin);const{w:h,h:_}=l.p(t),y=this.atlasImage;y.resize({width:h||1,height:_||1});for(const w in this.patterns){const{bin:P}=this.patterns[w],D=P.x+1,z=P.y+1,V=this.getImage(w).data,H=V.width,W=V.height;l.R.copy(V,y,{x:0,y:0},{x:D,y:z},{width:H,height:W}),l.R.copy(V,y,{x:0,y:W-1},{x:D,y:z-1},{width:H,height:1}),l.R.copy(V,y,{x:0,y:0},{x:D,y:z+W},{width:H,height:1}),l.R.copy(V,y,{x:H-1,y:0},{x:D-1,y:z},{width:1,height:W}),l.R.copy(V,y,{x:0,y:0},{x:D+H,y:z},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const h of t){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.getImage(h);_||l.w(`Image with ID: "${h}" was not found`),ye(_)&&this.updateImage(h,_)}}}const Be=1e20;function pt(k,t,h,_,y,w,P,D,z){for(let V=t;V<t+_;V++)St(k,h*w+V,w,y,P,D,z);for(let V=h;V<h+y;V++)St(k,V*w+t,1,_,P,D,z)}function St(k,t,h,_,y,w,P){w[0]=0,P[0]=-Be,P[1]=Be,y[0]=k[t];for(let D=1,z=0,V=0;D<_;D++){y[D]=k[t+D*h];const H=D*D;do{const W=w[z];V=(y[D]-y[W]+H-W*W)/(D-W)/2}while(V<=P[z]&&--z>-1);z++,w[z]=D,P[z]=V,P[z+1]=Be}for(let D=0,z=0;D<_;D++){for(;P[z+1]<D;)z++;const V=w[z],H=D-V;k[t+D*h]=y[V]+H*H}}class dt{constructor(t,h){this.requestManager=t,this.localIdeographFontFamily=h,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,function*(){const h=[];for(const w in t)for(const P of t[w])h.push(this._getAndCacheGlyphsPromise(w,P));const _=yield Promise.all(h),y={};for(const{stack:w,id:P,glyph:D}of _)y[w]||(y[w]={}),y[w][P]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return y})}_getAndCacheGlyphsPromise(t,h){return l._(this,void 0,void 0,function*(){let _=this.entries[t];_||(_=this.entries[t]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[h];if(y!==void 0)return{stack:t,id:h,glyph:y};if(y=this._tinySDF(_,t,h),y)return _.glyphs[h]=y,{stack:t,id:h,glyph:y};const w=Math.floor(h/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[w])return{stack:t,id:h,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[w]){const D=dt.loadGlyphRange(t,w,this.url,this.requestManager);_.requests[w]=D}const P=yield _.requests[w];for(const D in P)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=P[+D]);return _.ranges[w]=!0,{stack:t,id:h,glyph:P[h]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(t))}_tinySDF(t,h,_){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(_))return;let w=t.tinySDF;if(!w){let D="400";/bold/i.test(h)?D="900":/medium/i.test(h)?D="500":/light/i.test(h)&&(D="200"),w=t.tinySDF=new dt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:D})}const P=w.draw(String.fromCharCode(_));return{id:_,bitmap:new l.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}dt.loadGlyphRange=function(k,t,h,_){return l._(this,void 0,void 0,function*(){const y=256*t,w=y+255,P=_.transformRequest(h.replace("{fontstack}",k).replace("{range}",`${y}-${w}`),"Glyphs"),D=yield l.l(P,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${t}, ${y}-${w}`);const z={};for(const V of l.n(D.data))z[V.id]=V;return z})},dt.TinySDF=class{constructor({fontSize:k=24,buffer:t=3,radius:h=8,cutoff:_=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:P="normal"}={}){this.buffer=t,this.cutoff=_,this.radius=h;const D=this.size=k+4*t,z=this._createCanvas(D),V=this.ctx=z.getContext("2d",{willReadFrequently:!0});V.font=`${P} ${w} ${k}px ${y}`,V.textBaseline="alphabetic",V.textAlign="left",V.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(k){const t=document.createElement("canvas");return t.width=t.height=k,t}draw(k){const{width:t,actualBoundingBoxAscent:h,actualBoundingBoxDescent:_,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(k),P=Math.ceil(h),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),z=Math.min(this.size-this.buffer,P+Math.ceil(_)),V=D+2*this.buffer,H=z+2*this.buffer,W=Math.max(V*H,0),ne=new Uint8ClampedArray(W),ge={data:ne,width:V,height:H,glyphWidth:D,glyphHeight:z,glyphTop:P,glyphLeft:0,glyphAdvance:t};if(D===0||z===0)return ge;const{ctx:ke,buffer:Me,gridInner:Ne,gridOuter:Oe}=this;ke.clearRect(Me,Me,D,z),ke.fillText(k,Me,Me+P);const qe=ke.getImageData(Me,Me,D,z);Oe.fill(Be,0,W),Ne.fill(0,0,W);for(let Ce=0;Ce<z;Ce++)for(let Ze=0;Ze<D;Ze++){const Ke=qe.data[4*(Ce*D+Ze)+3]/255;if(Ke===0)continue;const it=(Ce+Me)*V+Ze+Me;if(Ke===1)Oe[it]=0,Ne[it]=Be;else{const bt=.5-Ke;Oe[it]=bt>0?bt*bt:0,Ne[it]=bt<0?bt*bt:0}}pt(Oe,0,0,V,H,V,this.f,this.v,this.z),pt(Ne,Me,Me,D,z,V,this.f,this.v,this.z);for(let Ce=0;Ce<W;Ce++){const Ze=Math.sqrt(Oe[Ce])-Math.sqrt(Ne[Ce]);ne[Ce]=Math.round(255-255*(Ze/this.radius+this.cutoff))}return ge}};class ut{constructor(){this.specification=l.v.light.position}possiblyEvaluate(t,h){return l.x(t.expression.evaluate(h))}interpolate(t,h,_){return{x:l.y.number(t.x,h.x,_),y:l.y.number(t.y,h.y,_),z:l.y.number(t.z,h.z,_)}}}let Bt;class vt extends l.E{constructor(t){super(),Bt=Bt||new l.q({anchor:new l.D(l.v.light.anchor),position:new ut,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Bt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,h={}){if(!this._validate(l.r,t,h))for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,h,_){return(!_||_.validate!==!1)&&l.t(this,t.call(l.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const wt=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class ft extends l.E{constructor(t){super(),this._transitionable=new l.T(wt),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(t,h={}){if(!this._validate(l.B,t,h)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,h,_={}){return(_==null?void 0:_.validate)!==!1&&l.t(this,t.call(l.u,l.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class xt{constructor(t,h){this.width=t,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,h){const _=t.join(",")+String(h);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(t,h)),this.dashEntry[_]}getDashRanges(t,h,_){const y=[];let w=t.length%2==1?-t[t.length-1]*_:0,P=t[0]*_,D=!0;y.push({left:w,right:P,isDash:D,zeroLength:t[0]===0});let z=t[0];for(let V=1;V<t.length;V++){D=!D;const H=t[V];w=z*_,z+=H,P=z*_,y.push({left:w,right:P,isDash:D,zeroLength:H===0})}return y}addRoundDash(t,h,_){const y=h/2;for(let w=-_;w<=_;w++){const P=this.width*(this.nextRow+_+w);let D=0,z=t[D];for(let V=0;V<this.width;V++){V/z.right>1&&(z=t[++D]);const H=Math.abs(V-z.left),W=Math.abs(V-z.right),ne=Math.min(H,W);let ge;const ke=w/_*(y+1);if(z.isDash){const Me=y-Math.abs(ke);ge=Math.sqrt(ne*ne+Me*Me)}else ge=y-Math.sqrt(ne*ne+ke*ke);this.data[P+V]=Math.max(0,Math.min(255,ge+128))}}}addRegularDash(t){for(let D=t.length-1;D>=0;--D){const z=t[D],V=t[D+1];z.zeroLength?t.splice(D,1):V&&V.isDash===z.isDash&&(V.left=z.left,t.splice(D,1))}const h=t[0],_=t[t.length-1];h.isDash===_.isDash&&(h.left=_.left-this.width,_.right=h.right+this.width);const y=this.width*this.nextRow;let w=0,P=t[w];for(let D=0;D<this.width;D++){D/P.right>1&&(P=t[++w]);const z=Math.abs(D-P.left),V=Math.abs(D-P.right),H=Math.min(z,V);this.data[y+D]=Math.max(0,Math.min(255,(P.isDash?H:-H)+128))}}addDash(t,h){const _=h?7:0,y=2*_+1;if(this.nextRow+y>this.height)return l.w("LineAtlas out of space"),null;let w=0;for(let D=0;D<t.length;D++)w+=t[D];if(w!==0){const D=this.width/w,z=this.getDashRanges(t,this.width,D);h?this.addRoundDash(z,D,_):this.addRegularDash(z)}const P={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:w};return this.nextRow+=y,this.dirty=!0,P}bind(t){const h=t.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const It="maplibre_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}const pn=Math.floor(L.hardwareConcurrency/2);let Rn,Xe;function Wn(){return Rn||(Rn=new Jt),Rn}Jt.workerCount=l.C(globalThis)?Math.max(Math.min(pn,3),1):1;class dn{constructor(t,h){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=h;const _=this.workerPool.acquire(h);for(let y=0;y<_.length;y++){const w=new l.F(_[y],h);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,h){const _=[];for(const y of this.actors)_.push(y.sendAsync({type:t,data:h}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,h){for(const _ of this.actors)_.registerMessageHandler(t,h)}}function Ft(){return Xe||(Xe=new dn(Wn(),l.G),Xe.registerMessageHandler("GR",(k,t,h)=>l.m(t,h))),Xe}function Se(k,t){const h=l.H();return l.J(h,h,[1,1,0]),l.K(h,h,[.5*k.width,.5*k.height,1]),l.L(h,h,k.calculatePosMatrix(t.toUnwrapped()))}function lt(k,t,h,_,y,w){const P=function(W,ne,ge){if(W)for(const ke of W){const Me=ne[ke];if(Me&&Me.source===ge&&Me.type==="fill-extrusion")return!0}else for(const ke in ne){const Me=ne[ke];if(Me.source===ge&&Me.type==="fill-extrusion")return!0}return!1}(y&&y.layers,t,k.id),D=w.maxPitchScaleFactor(),z=k.tilesIn(_,D,P);z.sort(Je);const V=[];for(const W of z)V.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(t,h,k._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,y,w,D,Se(k.transform,W.tileID))});const H=function(W){const ne={},ge={};for(const ke of W){const Me=ke.queryResults,Ne=ke.wrappedTileID,Oe=ge[Ne]=ge[Ne]||{};for(const qe in Me){const Ce=Me[qe],Ze=Oe[qe]=Oe[qe]||{},Ke=ne[qe]=ne[qe]||[];for(const it of Ce)Ze[it.featureIndex]||(Ze[it.featureIndex]=!0,Ke.push(it))}}return ne}(V);for(const W in H)H[W].forEach(ne=>{const ge=ne.feature,ke=k.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ke});return H}function Je(k,t){const h=k.tileID,_=t.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Lt(k,t,h){return l._(this,void 0,void 0,function*(){let _=k;if(k.url?_=(yield l.h(t.transformRequest(k.url,"Source"),h)).data:yield L.frameAsync(h),!_)return null;const y=l.M(l.e(_,k),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(y.vectorLayerIds=_.vector_layers.map(w=>w.id)),y})}class Ye{constructor(t,h){t&&(h?this.setSouthWest(t).setNorthEast(h):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}extend(t){const h=this._sw,_=this._ne;let y,w;if(t instanceof l.N)y=t,w=t;else{if(!(t instanceof Ye))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ye.convert(t)):this.extend(l.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.N.convert(t)):this;if(y=t._sw,w=t._ne,!y||!w)return this}return h||_?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),_.lng=Math.max(w.lng,_.lng),_.lat=Math.max(w.lat,_.lat)):(this._sw=new l.N(y.lng,y.lat),this._ne=new l.N(w.lng,w.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:h,lat:_}=l.N.convert(t);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&y}static convert(t){return t instanceof Ye?t:t&&new Ye(t)}static fromLngLat(t,h=0){const _=360*h/40075017,y=_/Math.cos(Math.PI/180*t.lat);return new Ye(new l.N(t.lng-y,t.lat-_),new l.N(t.lng+y,t.lat+_))}adjustAntiMeridian(){const t=new l.N(this._sw.lng,this._sw.lat),h=new l.N(this._ne.lng,this._ne.lat);return new Ye(t,t.lng>h.lng?new l.N(h.lng+360,h.lat):h)}}class kt{constructor(t,h,_){this.bounds=Ye.convert(this.validateBounds(t)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const h=Math.pow(2,t.z),_=Math.floor(l.O(this.bounds.getWest())*h),y=Math.floor(l.Q(this.bounds.getNorth())*h),w=Math.ceil(l.O(this.bounds.getEast())*h),P=Math.ceil(l.Q(this.bounds.getSouth())*h);return t.x>=_&&t.x<w&&t.y>=y&&t.y<P}}class Vt extends l.E{constructor(t,h,_,y){if(super(),this.id=t,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(h,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new kt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(h,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((w,P)=>{t.reloadPromise={resolve:w,reject:P}})}else t.actor=this.dispatcher.getActor(),y="LT";t.abortController=new AbortController;try{const w=yield t.actor.sendAsync({type:y,data:_},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,w)}catch(w){if(delete t.abortController,t.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,h){if(h&&h.resourceTiming&&(t.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&t.setExpiryData(h),t.loadVectorData(h,this.map.painter),t.reloadPromise){const _=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(_.resolve).catch(_.reject)}}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ee extends l.E{constructor(t,h,_,y){super(),this.id=t,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},h),l.e(this,l.M(h,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(l.e(this,t),t.bounds&&(this.tileBounds=new kt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const _=yield $.getImage(this.map._requestManager.transformRequest(h,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&t.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const y=this.map.painter.context,w=y.gl,P=_.data;t.texture=this.map.painter.getTileTexture(P.width),t.texture?t.texture.update(P,{useMipmap:!0}):(t.texture=new we(y,P,w.RGBA,{useMipmap:!0}),t.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(_){if(delete t.abortController,t.aborted)t.state="unloaded";else if(_)throw t.state="errored",_}})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Gt extends Ee{constructor(t,h,_,y){super(t,h,_,y),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(h,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const y=yield $.getImage(_,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&t.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const P=l.b(w)&&l.U()?w:yield this.readImageNow(w),D={type:this.type,uid:t.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const z=yield t.actor.sendAsync({type:"LDT",data:D});t.dem=z,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(y){if(delete t.abortController,t.aborted)t.state="unloaded";else if(y)throw t.state="errored",y}})}readImageNow(t){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const h=t.width+2,_=t.height+2;try{return new l.R({width:h,height:_},yield l.W(t,-1,-1,h,_))}catch{}}return L.getImageData(t,1)})}_getNeighboringTiles(t){const h=t.canonical,_=Math.pow(2,h.z),y=(h.x-1+_)%_,w=h.x===0?t.wrap-1:t.wrap,P=(h.x+1+_)%_,D=h.x+1===_?t.wrap+1:t.wrap,z={};return z[new l.S(t.overscaledZ,w,h.z,y,h.y).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,h.z,P,h.y).key]={backfilled:!1},h.y>0&&(z[new l.S(t.overscaledZ,w,h.z,y,h.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,h.z,P,h.y-1).key]={backfilled:!1}),h.y+1<_&&(z[new l.S(t.overscaledZ,w,h.z,y,h.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,h.z,P,h.y+1).key]={backfilled:!1}),z}unloadTile(t){return l._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class _n extends l.E{constructor(t,h,_,y){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(y),this._data=h.data,this._options=l.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const w=l.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*w,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*w,extent:l.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.X,radius:(h.clusterRadius||50)*w,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return l._(this,void 0,void 0,function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,h,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:h,offset:_}})}_updateWorkerData(t){return l._(this,void 0,void 0,function*(){const h=l.e({type:this.type},this.workerOptions);t?h.dataDiff=t:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(L.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let y=null;_.resourceTiming&&_.resourceTiming[this.id]&&(y=_.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(w,{resourceTiming:y}),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.actor?"RT":"LT";t.actor=this.actor;const _={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const y=yield this.actor.sendAsync({type:h,data:_},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(y,this.map.painter,h==="RT")})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Kn=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Yi extends l.E{constructor(t,h,_,y){super(),this.id=t,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(t){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield $.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,t&&(this.coordinates=t),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new l.j(h))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const h=t.map(l.Z.fromLngLat);this.tileID=function(y){let w=1/0,P=1/0,D=-1/0,z=-1/0;for(const ne of y)w=Math.min(w,ne.x),P=Math.min(P,ne.y),D=Math.max(D,ne.x),z=Math.max(z,ne.y);const V=Math.max(D-w,z-P),H=Math.max(0,Math.floor(-Math.log(V)/Math.LN2)),W=Math.pow(2,H);return new l.a1(H,Math.floor((w+D)/2*W),Math.floor((P+z)/2*W))}(h),this.minzoom=this.maxzoom=this.tileID.z;const _=h.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,l.X,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,l.X),this._boundsArray.emplaceBack(_[2].x,_[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,h=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Kn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(t,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class xn extends Yi{constructor(t,h,_,y){super(t,h,_,y),this.roundZoom=!0,this.type="video",this.options=h}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const h of t.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield l.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new l.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const h=this.video.seekable;t<h.start(0)||t>h.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,h=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Kn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new we(t,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class qi extends Yi{constructor(t,h,_,y){super(t,h,_,y),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(P=>typeof P!="number"))||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,_=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Kn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(h,this.canvas,_.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,y=!0)}y&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ji={},Jr=k=>{switch(k){case"geojson":return _n;case"image":return Yi;case"raster":return Ee;case"raster-dem":return Gt;case"vector":return Vt;case"video":return xn;case"canvas":return qi}return Ji[k]},ct="RTLPluginLoaded";class gr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ft()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,function*(h,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=L.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let kn=null;function mn(){return kn||(kn=new gr),kn}class As{constructor(t,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const h=t+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,h,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(y,w){const P={};if(!w)return P;for(const D of y){const z=D.layerIds.map(V=>w.getLayer(V)).filter(Boolean);if(z.length!==0){D.layers=z,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(V=>z.filter(H=>H.id===V)[0]));for(const V of z)P[V.id]=D}}return P}(t.buckets,h.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6){if(this.hasSymbolBuckets=!0,!_)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6&&w.hasRTLText){this.hasRTLText=!0,mn().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(w))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(t)}const h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,h,_,y,w,P,D,z,V,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:P,tileSize:this.tileSize,pixelPosMatrix:H,transform:z,params:D,queryPadding:this.queryPadding*V},t,h,_):{}}querySourceFeatures(t,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const y=_.loadVTLayers(),w=h&&h.sourceLayer?h.sourceLayer:"",P=y._geojsonTileLayer||y[w];if(!P)return;const D=l.a7(h&&h.filter),{z,x:V,y:H}=this.tileID.canonical,W={z,x:V,y:H};for(let ne=0;ne<P.length;ne++){const ge=P.feature(ne);if(D.needGeometry){const Ne=l.a8(ge,!0);if(!D.filter(new l.z(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!D.filter(new l.z(this.tileID.overscaledZ),ge))continue;const ke=_.getId(ge,w),Me=new l.a9(ge,z,V,H,ke);Me.tile=W,t.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const h=this.expirationTime;if(t.cacheControl){const _=l.aa(t.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const _=Date.now();let y=!1;if(this.expirationTime>_)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const w=this.expirationTime-h;w?this.expirationTime=_+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const w=this.buckets[y],P=w.layers[0].sourceLayer||"_geojsonTileLayer",D=_[P],z=t[P];if(!D||!z||Object.keys(z).length===0)continue;w.update(z,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const V=h&&h.style&&h.style.getLayer(y);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<L.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=L.now()+t}setDependencies(t,h){const _={};for(const y of h)_[y]=!0;this.dependencies[t]=_}hasDependency(t,h){for(const _ of t){const y=this.dependencies[_];if(y){for(const w of h)if(y[w])return!0}}return!1}}class At{constructor(t,h){this.max=t,this.onRemove=h,this.reset()}reset(){for(const t in this.data)for(const h of this.data[t])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(t,h,_){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:h,timeout:void 0};if(_!==void 0&&(w.timeout=setTimeout(()=>{this.remove(t,w)},_)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const h=this.data[t].shift();return h.timeout&&clearTimeout(h.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),h.value}getByKey(t){const h=this.data[t];return h?h[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,h){if(!this.has(t))return this;const _=t.wrapped().key,y=h===void 0?0:this.data[_].indexOf(h),w=this.data[_][y];return this.data[_].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(w.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(t){const h=[];for(const _ in this.data)for(const y of this.data[_])t(y.value)||h.push(y);for(const _ of h)this.remove(_.value.tileID,_)}}class Ln{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,h,_){const y=String(h);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},l.e(this.stateChanges[t][y],_),this.deletedStates[t]===null){this.deletedStates[t]={};for(const w in this.state[t])w!==y&&(this.deletedStates[t][w]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const w in this.state[t][y])_[w]||(this.deletedStates[t][y][w]=null)}else for(const w in _)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][w]===null&&delete this.deletedStates[t][y][w]}removeFeatureState(t,h,_){if(this.deletedStates[t]===null)return;const y=String(h);if(this.deletedStates[t]=this.deletedStates[t]||{},_&&h!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][_]=null);else if(h!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(_ in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][_]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,h){const _=String(h),y=l.e({},(this.state[t]||{})[_],(this.stateChanges[t]||{})[_]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const w=this.deletedStates[t][h];if(w===null)return{};for(const P in w)delete y[P]}return y}initializeTileState(t,h){t.setFeatureState(this.state,h)}coalesceChanges(t,h){const _={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const P in this.stateChanges[y])this.state[y][P]||(this.state[y][P]={}),l.e(this.state[y][P],this.stateChanges[y][P]),w[P]=this.state[y][P];_[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const P in this.state[y])w[P]={},this.state[y][P]={};else for(const P in this.deletedStates[y]){if(this.deletedStates[y][P]===null)this.state[y][P]={};else for(const D of Object.keys(this.deletedStates[y][P]))delete this.state[y][P][D];w[P]=this.state[y][P]}_[y]=_[y]||{},l.e(_[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const y in t)t[y].setFeatureState(_,h)}}class Tt extends l.E{constructor(t,h,_){super(),this.id=t,this.dispatcher=_,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,w,P,D)=>{const z=new(Jr(w.type))(y,w,P,D);if(z.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${z.id}`);return z})(t,h,_,this),this._tiles={},this._cache=new At(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ln,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const h=this._tiles[t];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,h,_){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,h,_)}catch(y){t.state="errored",y.status!==404?this._source.fire(new l.j(y,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(t),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(_r).map(t=>t.key)}getRenderableIds(t){const h=[];for(const _ in this._tiles)this._isIdRenderable(_,t)&&h.push(this._tiles[_]);return t?h.sort((_,y)=>{const w=_.tileID,P=y.tileID,D=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),z=new l.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-P.overscaledZ||z.y-D.y||z.x-D.x}).map(_=>_.tileID.key):h.map(_=>_.tileID).sort(_r).map(_=>_.key)}hasRenderableParent(t){const h=this.findLoadedParent(t,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(t,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(h||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,h){return l._(this,void 0,void 0,function*(){const _=this._tiles[t];_&&(_.state!=="loading"&&(_.state=h),yield this._loadTile(_,t,h))})}_tileLoaded(t,h,_){t.timeAdded=L.now(),_==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(h,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const w=h[y];if(t.neighboringTiles&&t.neighboringTiles[w]){const P=this.getTileByID(w);_(t,P),_(P,t)}}function _(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let P=w.tileID.canonical.x-y.tileID.canonical.x;const D=w.tileID.canonical.y-y.tileID.canonical.y,z=Math.pow(2,y.tileID.canonical.z),V=w.tileID.key;P===0&&D===0||Math.abs(D)>1||(Math.abs(P)>1&&(Math.abs(P+z)===1?P+=z:Math.abs(P-z)===1&&(P-=z)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,P,D),y.neighboringTiles&&y.neighboringTiles[V]&&(y.neighboringTiles[V].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,h,_,y){for(const w in this._tiles){let P=this._tiles[w];if(y[w]||!P.hasData()||P.tileID.overscaledZ<=h||P.tileID.overscaledZ>_)continue;let D=P.tileID;for(;P&&P.tileID.overscaledZ>h+1;){const V=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[V.key],P&&P.hasData()&&(D=V)}let z=D;for(;z.overscaledZ>h;)if(z=z.scaledTo(z.overscaledZ-1),t[z.key]){y[D.key]=D;break}}}findLoadedParent(t,h){if(t.key in this._loadedParentTiles){const _=this._loadedParentTiles[t.key];return _&&_.tileID.overscaledZ>=h?_:null}for(let _=t.overscaledZ-1;_>=h;_--){const y=t.scaledTo(_),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const h=this._tiles[t.key];return h&&h.hasData()?h:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const h=Math.ceil(t.width/this._source.tileSize)+1,_=Math.ceil(t.height/this._source.tileSize)+1,y=Math.floor(h*_*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(t){const h=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,h){const _={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),_[w.tileID.key]=w}this._tiles=_;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(t,h,_,y,w,P){const D={},z={},V=Object.keys(t),H=L.now();for(const W of V){const ne=t[W],ge=this._tiles[W];if(!ge||ge.fadeEndTime!==0&&ge.fadeEndTime<=H)continue;const ke=this.findLoadedParent(ne,h),Me=this.findLoadedSibling(ne),Ne=ke||Me||null;Ne&&(this._addTile(Ne.tileID),D[Ne.tileID.key]=Ne.tileID),z[W]=ne}this._retainLoadedChildren(z,y,_,t);for(const W in D)t[W]||(this._coveredTiles[W]=!0,t[W]=D[W]);if(P){const W={},ne={};for(const ge of w)this._tiles[ge.key].hasData()?W[ge.key]=ge:ne[ge.key]=ge;for(const ge in ne){const ke=ne[ge].children(this._source.maxzoom);this._tiles[ke[0].key]&&this._tiles[ke[1].key]&&this._tiles[ke[2].key]&&this._tiles[ke[3].key]&&(W[ke[0].key]=t[ke[0].key]=ke[0],W[ke[1].key]=t[ke[1].key]=ke[1],W[ke[2].key]=t[ke[2].key]=ke[2],W[ke[3].key]=t[ke[3].key]=ke[3],delete ne[ge])}for(const ge in ne){const ke=ne[ge],Me=this.findLoadedParent(ke,this._source.minzoom),Ne=this.findLoadedSibling(ke),Oe=Me||Ne||null;if(Oe){W[Oe.tileID.key]=t[Oe.tileID.key]=Oe.tileID;for(const qe in W)W[qe].isChildOf(Oe.tileID)&&delete W[qe]}}for(const ge in this._tiles)W[ge]||(this._coveredTiles[ge]=!0)}}update(t,h){if(!this._sourceLoaded||this._paused)return;let _;this.transform=t,this.terrain=h,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new l.S(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y)):(_=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(_=_.filter(H=>this._source.hasTile(H)))):_=[];const y=t.coveringZoomLevel(this._source),w=Math.max(y-Tt.maxOverzooming,this._source.minzoom),P=Math.max(y+Tt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const H={};for(const W of _)if(W.canonical.z>this._source.minzoom){const ne=W.scaledTo(W.canonical.z-1);H[ne.key]=ne;const ge=W.scaledTo(Math.max(this._source.minzoom,Math.min(W.canonical.z,5)));H[ge.key]=ge}_=_.concat(Object.values(H))}const D=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const z=this._updateRetainedTiles(_,y);Gr(this._source.type)&&this._updateCoveredAndRetainedTiles(z,w,P,y,_,h);for(const H in z)this._tiles[H].clearFadeHold();const V=l.ab(this._tiles,z);for(const H of V){const W=this._tiles[H];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(H)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,h){var _;const y={},w={},P=Math.max(h-Tt.maxOverzooming,this._source.minzoom),D=Math.max(h+Tt.maxUnderzooming,this._source.minzoom),z={};for(const V of t){const H=this._addTile(V);y[V.key]=V,H.hasData()||h<this._source.maxzoom&&(z[V.key]=V)}this._retainLoadedChildren(z,h,D,y);for(const V of t){let H=this._tiles[V.key];if(H.hasData())continue;if(h+1>this._source.maxzoom){const ne=V.children(this._source.maxzoom)[0],ge=this.getTile(ne);if(ge&&ge.hasData()){y[ne.key]=ne;continue}}else{const ne=V.children(this._source.maxzoom);if(y[ne[0].key]&&y[ne[1].key]&&y[ne[2].key]&&y[ne[3].key])continue}let W=H.wasRequested();for(let ne=V.overscaledZ-1;ne>=P;--ne){const ge=V.scaledTo(ne);if(w[ge.key])break;if(w[ge.key]=!0,H=this.getTile(ge),!H&&W&&(H=this._addTile(ge)),H){const ke=H.hasData();if((ke||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||W)&&(y[ge.key]=ge),W=H.wasRequested(),ke)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const h=[];let _,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){_=this._loadedParentTiles[y.key];break}h.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(_=this._getLoadedTile(w),_)break;y=w}for(const w of h)this._loadedParentTiles[w]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const h=this._tiles[t].tileID,_=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=_}}_addTile(t){let h=this._tiles[t.key];if(h)return h;h=this._cache.getAndRemove(t),h&&(this._setTileReloadTimer(t.key,h),h.tileID=t,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,h)));const _=h;return h||(h=new As(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(h,t.key,h.state)),h.uses++,this._tiles[t.key]=h,_||this._source.fire(new l.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(t,h){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const _=h.getExpiryTimeout();_&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},_))}_removeTile(t){const h=this._tiles[t];h&&(h.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(t){const h=t.sourceDataType;t.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,h,_){const y=[],w=this.transform;if(!w)return y;const P=_?w.getCameraQueryGeometry(t):t,D=t.map(ke=>w.pointCoordinate(ke,this.terrain)),z=P.map(ke=>w.pointCoordinate(ke,this.terrain)),V=this.getIds();let H=1/0,W=1/0,ne=-1/0,ge=-1/0;for(const ke of z)H=Math.min(H,ke.x),W=Math.min(W,ke.y),ne=Math.max(ne,ke.x),ge=Math.max(ge,ke.y);for(let ke=0;ke<V.length;ke++){const Me=this._tiles[V[ke]];if(Me.holdingForFade())continue;const Ne=Me.tileID,Oe=Math.pow(2,w.zoom-Me.tileID.overscaledZ),qe=h*Me.queryPadding*l.X/Me.tileSize/Oe,Ce=[Ne.getTilePoint(new l.Z(H,W)),Ne.getTilePoint(new l.Z(ne,ge))];if(Ce[0].x-qe<l.X&&Ce[0].y-qe<l.X&&Ce[1].x+qe>=0&&Ce[1].y+qe>=0){const Ze=D.map(it=>Ne.getTilePoint(it)),Ke=z.map(it=>Ne.getTilePoint(it));y.push({tile:Me,tileID:Ne,queryGeometry:Ze,cameraQueryGeometry:Ke,scale:Oe})}}return y}getVisibleCoordinates(t){const h=this.getRenderableIds(t).map(_=>this._tiles[_].tileID);for(const _ of h)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Gr(this._source.type)){const t=L.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=t)return!0}return!1}setFeatureState(t,h,_){this._state.updateState(t=t||"_geojsonTileLayer",h,_)}removeFeatureState(t,h,_){this._state.removeFeatureState(t=t||"_geojsonTileLayer",h,_)}getFeatureState(t,h){return this._state.getState(t=t||"_geojsonTileLayer",h)}setDependencies(t,h,_){const y=this._tiles[t];y&&y.setDependencies(h,_)}reloadTilesForDependencies(t,h){for(const _ in this._tiles)this._tiles[_].hasDependency(t,h)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(t,h))}}function _r(k,t){const h=Math.abs(2*k.wrap)-+(k.wrap<0),_=Math.abs(2*t.wrap)-+(t.wrap<0);return k.overscaledZ-t.overscaledZ||_-h||t.canonical.y-k.canonical.y||t.canonical.x-k.canonical.x}function Gr(k){return k==="raster"||k==="image"||k==="video"}Tt.maxOverzooming=10,Tt.maxUnderzooming=3;class wn{constructor(t,h){this.reset(t,h)}reset(t,h){this.points=t||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.ac(t,0,1);let h=1,_=this._distances[h];const y=t*this.paddedLength+this.padding;for(;_<y&&h<this._distances.length;)_=this._distances[++h];const w=h-1,P=this._distances[w],D=_-P,z=D>0?(y-P)/D:0;return this.points[w].mult(1-z).add(this.points[h].mult(z))}}function Mi(k,t){let h=!0;return k==="always"||k!=="never"&&t!=="never"||(h=!1),h}class Er{constructor(t,h,_){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(t/_),this.yCellCount=Math.ceil(h/_);for(let P=0;P<this.xCellCount*this.yCellCount;P++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=h,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,h,_,y,w){this._forEachCell(h,_,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(t,h,_,y){this._forEachCell(h-y,_-y,h+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(h),this.circles.push(_),this.circles.push(y)}_insertBoxCell(t,h,_,y,w,P){this.boxCells[w].push(P)}_insertCircleCell(t,h,_,y,w,P){this.circleCells[w].push(P)}_query(t,h,_,y,w,P,D){if(_<0||t>this.width||y<0||h>this.height)return[];const z=[];if(t<=0&&h<=0&&this.width<=_&&this.height<=y){if(w)return[{key:null,x1:t,y1:h,x2:_,y2:y}];for(let V=0;V<this.boxKeys.length;V++)z.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const H=this.circles[3*V],W=this.circles[3*V+1],ne=this.circles[3*V+2];z.push({key:this.circleKeys[V],x1:H-ne,y1:W-ne,x2:H+ne,y2:W+ne})}}else this._forEachCell(t,h,_,y,this._queryCell,z,{hitTest:w,overlapMode:P,seenUids:{box:{},circle:{}}},D);return z}query(t,h,_,y){return this._query(t,h,_,y,!1,null)}hitTest(t,h,_,y,w,P){return this._query(t,h,_,y,!0,w,P).length>0}hitTestCircle(t,h,_,y,w){const P=t-_,D=t+_,z=h-_,V=h+_;if(D<0||P>this.width||V<0||z>this.height)return!1;const H=[];return this._forEachCell(P,z,D,V,this._queryCellCircle,H,{hitTest:!0,overlapMode:y,circle:{x:t,y:h,radius:_},seenUids:{box:{},circle:{}}},w),H.length>0}_queryCell(t,h,_,y,w,P,D,z){const{seenUids:V,hitTest:H,overlapMode:W}=D,ne=this.boxCells[w];if(ne!==null){const ke=this.bboxes;for(const Me of ne)if(!V.box[Me]){V.box[Me]=!0;const Ne=4*Me,Oe=this.boxKeys[Me];if(t<=ke[Ne+2]&&h<=ke[Ne+3]&&_>=ke[Ne+0]&&y>=ke[Ne+1]&&(!z||z(Oe))&&(!H||!Mi(W,Oe.overlapMode))&&(P.push({key:Oe,x1:ke[Ne],y1:ke[Ne+1],x2:ke[Ne+2],y2:ke[Ne+3]}),H))return!0}}const ge=this.circleCells[w];if(ge!==null){const ke=this.circles;for(const Me of ge)if(!V.circle[Me]){V.circle[Me]=!0;const Ne=3*Me,Oe=this.circleKeys[Me];if(this._circleAndRectCollide(ke[Ne],ke[Ne+1],ke[Ne+2],t,h,_,y)&&(!z||z(Oe))&&(!H||!Mi(W,Oe.overlapMode))){const qe=ke[Ne],Ce=ke[Ne+1],Ze=ke[Ne+2];if(P.push({key:Oe,x1:qe-Ze,y1:Ce-Ze,x2:qe+Ze,y2:Ce+Ze}),H)return!0}}}return!1}_queryCellCircle(t,h,_,y,w,P,D,z){const{circle:V,seenUids:H,overlapMode:W}=D,ne=this.boxCells[w];if(ne!==null){const ke=this.bboxes;for(const Me of ne)if(!H.box[Me]){H.box[Me]=!0;const Ne=4*Me,Oe=this.boxKeys[Me];if(this._circleAndRectCollide(V.x,V.y,V.radius,ke[Ne+0],ke[Ne+1],ke[Ne+2],ke[Ne+3])&&(!z||z(Oe))&&!Mi(W,Oe.overlapMode))return P.push(!0),!0}}const ge=this.circleCells[w];if(ge!==null){const ke=this.circles;for(const Me of ge)if(!H.circle[Me]){H.circle[Me]=!0;const Ne=3*Me,Oe=this.circleKeys[Me];if(this._circlesCollide(ke[Ne],ke[Ne+1],ke[Ne+2],V.x,V.y,V.radius)&&(!z||z(Oe))&&!Mi(W,Oe.overlapMode))return P.push(!0),!0}}}_forEachCell(t,h,_,y,w,P,D,z){const V=this._convertToXCellCoord(t),H=this._convertToYCellCoord(h),W=this._convertToXCellCoord(_),ne=this._convertToYCellCoord(y);for(let ge=V;ge<=W;ge++)for(let ke=H;ke<=ne;ke++)if(w.call(this,t,h,_,y,this.xCellCount*ke+ge,P,D,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,h,_,y,w,P){const D=y-t,z=w-h,V=_+P;return V*V>D*D+z*z}_circleAndRectCollide(t,h,_,y,w,P,D){const z=(P-y)/2,V=Math.abs(t-(y+z));if(V>z+_)return!1;const H=(D-w)/2,W=Math.abs(h-(w+H));if(W>H+_)return!1;if(V<=z||W<=H)return!0;const ne=V-z,ge=W-H;return ne*ne+ge*ge<=_*_}}function Ki(k,t,h,_,y){const w=l.H();return t?(l.K(w,w,[1/y,1/y,1]),h||l.ad(w,w,_.angle)):l.L(w,_.labelPlaneMatrix,k),w}function Zr(k,t,h,_,y){if(t){const w=l.ae(k);return l.K(w,w,[y,y,1]),h||l.ad(w,w,-_.angle),w}return _.glCoordMatrix}function Ae(k,t,h,_){let y;_?(y=[k,t,_(k,t),1],l.af(y,y,h)):(y=[k,t,0,1],Vn(y,y,h));const w=y[3];return{point:new l.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function Q(k,t){return .5+k/t*.5}function K(k,t){return k.x>=-t[0]&&k.x<=t[0]&&k.y>=-t[1]&&k.y<=t[1]}function he(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke){const Me=_?k.textSizeData:k.iconSizeData,Ne=l.ag(Me,h.transform.zoom),Oe=[256/h.width*2+1,256/h.height*2+1],qe=_?k.text.dynamicLayoutVertexArray:k.icon.dynamicLayoutVertexArray;qe.clear();const Ce=k.lineVertexArray,Ze=_?k.text.placedSymbolArray:k.icon.placedSymbolArray,Ke=h.transform.width/h.transform.height;let it=!1;for(let bt=0;bt<Ze.length;bt++){const Rt=Ze.get(bt);if(Rt.hidden||Rt.writingMode===l.ah.vertical&&!it){an(Rt.numGlyphs,qe);continue}it=!1;const Ht=Ae(Rt.anchorX,Rt.anchorY,t,ke);if(!K(Ht.point,Oe)){an(Rt.numGlyphs,qe);continue}const Yt=Q(h.transform.cameraToCenterDistance,Ht.signedDistanceFromCamera),jt=l.ai(Me,Ne,Rt),Ut=P?jt/Yt:jt*Yt,rn={getElevation:ke,labelPlaneMatrix:y,lineVertexArray:Ce,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:V,tileAnchorPoint:new l.P(Rt.anchorX,Rt.anchorY),unwrappedTileID:H,width:W,height:ne,translation:ge},Tn=Ve(rn,Rt,Ut,!1,D,t,w,k.glyphOffsetArray,qe,Ke,z);it=Tn.useVertical,(Tn.notEnoughRoom||it||Tn.needsFlipping&&Ve(rn,Rt,Ut,!0,D,t,w,k.glyphOffsetArray,qe,Ke,z).notEnoughRoom)&&an(Rt.numGlyphs,qe)}_?k.text.dynamicLayoutVertexBuffer.updateData(qe):k.icon.dynamicLayoutVertexBuffer.updateData(qe)}function le(k,t,h,_,y,w,P,D){const z=w.glyphStartIndex+w.numGlyphs,V=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,W=t.getoffsetX(w.glyphStartIndex),ne=t.getoffsetX(z-1),ge=Dt(k*W,h,_,y,w.segment,V,H,D,P);if(!ge)return null;const ke=Dt(k*ne,h,_,y,w.segment,V,H,D,P);return ke?D.projectionCache.anyProjectionOccluded?null:{first:ge,last:ke}:null}function de(k,t,h,_){return k===l.ah.horizontal&&Math.abs(h.y-t.y)>Math.abs(h.x-t.x)*_?{useVertical:!0}:(k===l.ah.vertical?t.y<h.y:t.x>h.x)?{needsFlipping:!0}:null}function Ve(k,t,h,_,y,w,P,D,z,V,H){const W=h/24,ne=t.lineOffsetX*W,ge=t.lineOffsetY*W;let ke;if(t.numGlyphs>1){const Me=t.glyphStartIndex+t.numGlyphs,Ne=t.lineStartIndex,Oe=t.lineStartIndex+t.lineLength,qe=le(W,D,ne,ge,_,t,H,k);if(!qe)return{notEnoughRoom:!0};const Ce=Ae(qe.first.point.x,qe.first.point.y,P,k.getElevation).point,Ze=Ae(qe.last.point.x,qe.last.point.y,P,k.getElevation).point;if(y&&!_){const Ke=de(t.writingMode,Ce,Ze,V);if(Ke)return Ke}ke=[qe.first];for(let Ke=t.glyphStartIndex+1;Ke<Me-1;Ke++)ke.push(Dt(W*D.getoffsetX(Ke),ne,ge,_,t.segment,Ne,Oe,k,H));ke.push(qe.last)}else{if(y&&!_){const Ne=Ae(k.tileAnchorPoint.x,k.tileAnchorPoint.y,w,k.getElevation).point,Oe=t.lineStartIndex+t.segment+1,qe=new l.P(k.lineVertexArray.getx(Oe),k.lineVertexArray.gety(Oe)),Ce=Ae(qe.x,qe.y,w,k.getElevation),Ze=Ce.signedDistanceFromCamera>0?Ce.point:function(it,bt,Rt,Ht,Yt,jt){return We(it,bt,Rt,1,Yt,jt)}(k.tileAnchorPoint,qe,Ne,0,w,k),Ke=de(t.writingMode,Ne,Ze,V);if(Ke)return Ke}const Me=Dt(W*D.getoffsetX(t.glyphStartIndex),ne,ge,_,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,k,H);if(!Me||k.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ke=[Me]}for(const Me of ke)l.aj(z,Me.point,Me.angle);return{}}function We(k,t,h,_,y,w){const P=k.add(k.sub(t)._unit()),D=y!==void 0?Ae(P.x,P.y,y,w.getElevation).point:et(P.x,P.y,w).point,z=h.sub(D);return h.add(z._mult(_/z.mag()))}function Re(k,t,h){const _=t.projectionCache;if(_.projections[k])return _.projections[k];const y=new l.P(t.lineVertexArray.getx(k),t.lineVertexArray.gety(k)),w=et(y.x,y.y,t);if(w.signedDistanceFromCamera>0)return _.projections[k]=w.point,_.anyProjectionOccluded=_.anyProjectionOccluded||w.isOccluded,w.point;const P=k-h.direction;return function(D,z,V,H,W){return We(D,z,V,H,void 0,W)}(h.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(P),t.lineVertexArray.gety(P)),y,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,t)}function et(k,t,h){const _=k+h.translation[0],y=t+h.translation[1];let w;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(w=h.projection.projectTileCoordinates(_,y,h.unwrappedTileID,h.getElevation),w.point.x=(.5*w.point.x+.5)*h.width,w.point.y=(.5*-w.point.y+.5)*h.height):(w=Ae(_,y,h.labelPlaneMatrix,h.getElevation),w.isOccluded=!1),w}function gt(k,t,h){return k._unit()._perp()._mult(t*h)}function at(k,t,h,_,y,w,P,D,z){if(D.projectionCache.offsets[k])return D.projectionCache.offsets[k];const V=h.add(t);if(k+z.direction<_||k+z.direction>=y)return D.projectionCache.offsets[k]=V,V;const H=Re(k+z.direction,D,z),W=gt(H.sub(h),P,z.direction),ne=h.add(W),ge=H.add(W);return D.projectionCache.offsets[k]=l.ak(w,V,ne,ge)||V,D.projectionCache.offsets[k]}function Dt(k,t,h,_,y,w,P,D,z){const V=_?k-t:k+t;let H=V>0?1:-1,W=0;_&&(H*=-1,W=Math.PI),H<0&&(W+=Math.PI);let ne,ge=H>0?w+y:w+y+1;D.projectionCache.cachedAnchorPoint?ne=D.projectionCache.cachedAnchorPoint:(ne=et(D.tileAnchorPoint.x,D.tileAnchorPoint.y,D).point,D.projectionCache.cachedAnchorPoint=ne);let ke,Me,Ne=ne,Oe=ne,qe=0,Ce=0;const Ze=Math.abs(V),Ke=[];let it;for(;qe+Ce<=Ze;){if(ge+=H,ge<w||ge>=P)return null;qe+=Ce,Oe=Ne,Me=ke;const Ht={absOffsetX:Ze,direction:H,distanceFromAnchor:qe,previousVertex:Oe};if(Ne=Re(ge,D,Ht),h===0)Ke.push(Oe),it=Ne.sub(Oe);else{let Yt;const jt=Ne.sub(Oe);Yt=jt.mag()===0?gt(Re(ge+H,D,Ht).sub(Ne),h,H):gt(jt,h,H),Me||(Me=Oe.add(Yt)),ke=at(ge,Yt,Ne,w,P,Me,h,D,Ht),Ke.push(Me),it=ke.sub(Me)}Ce=it.mag()}const bt=it._mult((Ze-qe)/Ce)._add(Me||Oe),Rt=W+Math.atan2(Ne.y-Oe.y,Ne.x-Oe.x);return Ke.push(bt),{point:bt,angle:z?Rt:0,path:Ke}}const en=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function an(k,t){for(let h=0;h<k;h++){const _=t.length;t.resize(_+4),t.float32.set(en,3*_)}}function Vn(k,t,h){const _=t[0],y=t[1];return k[0]=h[0]*_+h[4]*y+h[12],k[1]=h[1]*_+h[5]*y+h[13],k[3]=h[3]*_+h[7]*y+h[15],k}const Mn=100;class An{constructor(t,h,_=new Er(t.width+200,t.height+200,25),y=new Er(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=h,this.grid=_,this.ignoredGrid=y,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Mn,this.screenBottomBoundary=t.height+Mn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,h,_,y,w,P,D,z,V,H,W){const ne=t.anchorPointX+z[0],ge=t.anchorPointY+z[1],ke=this.projectAndGetPerspectiveRatio(y,ne,ge,w,H),Me=_*ke.perspectiveRatio;let Ne;if(P||D)Ne=this._projectCollisionBox(t,Me,y,w,P,D,z,ke,H,W);else{const Ke=ke.point.x+(W?W.x*Me:0),it=ke.point.y+(W?W.y*Me:0);Ne={allPointsOccluded:!1,box:[Ke+t.x1*Me,it+t.y1*Me,Ke+t.x2*Me,it+t.y2*Me]}}const[Oe,qe,Ce,Ze]=Ne.box;return this.mapProjection.useSpecialProjectionForSymbols&&(P?Ne.allPointsOccluded:this.mapProjection.isOccluded(ne,ge,w))||ke.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Oe,qe,Ce,Ze)||h!=="always"&&this.grid.hitTest(Oe,qe,Ce,Ze,h,V)?{box:[Oe,qe,Ce,Ze],placeable:!1,offscreen:!1}:{box:[Oe,qe,Ce,Ze],placeable:!0,offscreen:this.isOffscreen(Oe,qe,Ce,Ze)}}placeCollisionCircles(t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke,Me,Ne){const Oe=[],qe=new l.P(h.anchorX,h.anchorY),Ce=this.getPerspectiveRatio(P,qe.x,qe.y,D,Ne),Ze=(W?w/Ce:w*Ce)/l.ap,Ke={getElevation:Ne,labelPlaneMatrix:z,lineVertexArray:_,pitchWithMap:W,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:qe,unwrappedTileID:D,width:this.transform.width,height:this.transform.height,translation:Me},it=le(Ze,y,h.lineOffsetX*Ze,h.lineOffsetY*Ze,!1,h,!1,Ke);let bt=!1,Rt=!1,Ht=!0;if(it){const Yt=.5*ge*Ce+ke,jt=new l.P(-100,-100),Ut=new l.P(this.screenRightBoundary,this.screenBottomBoundary),rn=new wn,Tn=it.first,qt=it.last;let Xt=[];for(let On=Tn.path.length-1;On>=1;On--)Xt.push(Tn.path[On]);for(let On=1;On<qt.path.length;On++)Xt.push(qt.path[On]);const In=2.5*Yt;if(V){const On=this.projectPathToScreenSpace(Xt,Ke,V);Xt=On.some(jn=>jn.signedDistanceFromCamera<=0)?[]:On.map(jn=>jn.point)}let Si=[];if(Xt.length>0){const On=Xt[0].clone(),jn=Xt[0].clone();for(let Ei=1;Ei<Xt.length;Ei++)On.x=Math.min(On.x,Xt[Ei].x),On.y=Math.min(On.y,Xt[Ei].y),jn.x=Math.max(jn.x,Xt[Ei].x),jn.y=Math.max(jn.y,Xt[Ei].y);Si=On.x>=jt.x&&jn.x<=Ut.x&&On.y>=jt.y&&jn.y<=Ut.y?[Xt]:jn.x<jt.x||On.x>Ut.x||jn.y<jt.y||On.y>Ut.y?[]:l.al([Xt],jt.x,jt.y,Ut.x,Ut.y)}for(const On of Si){rn.reset(On,.25*Yt);let jn=0;jn=rn.length<=.5*Yt?1:Math.ceil(rn.paddedLength/In)+1;for(let Ei=0;Ei<jn;Ei++){const Nr=Ei/Math.max(jn-1,1),Hs=rn.lerp(Nr),Ti=Hs.x+Mn,ss=Hs.y+Mn;Oe.push(Ti,ss,Yt,0);const Wr=Ti-Yt,zr=ss-Yt,Xr=Ti+Yt,ho=ss+Yt;if(Ht=Ht&&this.isOffscreen(Wr,zr,Xr,ho),Rt=Rt||this.isInsideGrid(Wr,zr,Xr,ho),t!=="always"&&this.grid.hitTestCircle(Ti,ss,Yt,t,ne)&&(bt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:bt}}}}return{circles:!H&&bt||!Rt||Ce<this.perspectiveRatioCutoff?[]:Oe,offscreen:Ht,collisionDetected:bt}}projectPathToScreenSpace(t,h,_){return t.map(y=>Ae(y.x,y.y,_,h.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,y=1/0,w=-1/0,P=-1/0;for(const H of t){const W=new l.P(H.x+Mn,H.y+Mn);_=Math.min(_,W.x),y=Math.min(y,W.y),w=Math.max(w,W.x),P=Math.max(P,W.y),h.push(W)}const D=this.grid.query(_,y,w,P).concat(this.ignoredGrid.query(_,y,w,P)),z={},V={};for(const H of D){const W=H.key;if(z[W.bucketInstanceId]===void 0&&(z[W.bucketInstanceId]={}),z[W.bucketInstanceId][W.featureIndex])continue;const ne=[new l.P(H.x1,H.y1),new l.P(H.x2,H.y1),new l.P(H.x2,H.y2),new l.P(H.x1,H.y2)];l.am(h,ne)&&(z[W.bucketInstanceId][W.featureIndex]=!0,V[W.bucketInstanceId]===void 0&&(V[W.bucketInstanceId]=[]),V[W.bucketInstanceId].push(W.featureIndex))}return V}insertCollisionBox(t,h,_,y,w,P){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:P,overlapMode:h},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,h,_,y,w,P){const D=_?this.ignoredGrid:this.grid,z={bucketInstanceId:y,featureIndex:w,collisionGroupID:P,overlapMode:h};for(let V=0;V<t.length;V+=4)D.insertCircle(z,t[V],t[V+1],t[V+2])}projectAndGetPerspectiveRatio(t,h,_,y,w){let P;w?(P=[h,_,w(h,_),1],l.af(P,P,t)):(P=[h,_,0,1],Vn(P,P,t));const D=P[3];return{point:new l.P((P[0]/D+1)/2*this.transform.width+Mn,(-P[1]/D+1)/2*this.transform.height+Mn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D*.5,isOccluded:!1,signedDistanceFromCamera:D}}getPerspectiveRatio(t,h,_,y,w){const P=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,_,y,w):Ae(h,_,t,w);return .5+this.transform.cameraToCenterDistance/P.signedDistanceFromCamera*.5}isOffscreen(t,h,_,y){return _<Mn||t>=this.screenRightBoundary||y<Mn||h>this.screenBottomBoundary}isInsideGrid(t,h,_,y){return _>=0&&t<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const t=l.an([]);return l.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,h,_,y,w,P,D,z,V,H){let W=new l.P(1,0),ne=new l.P(0,1);const ge=new l.P(t.anchorPointX+D[0],t.anchorPointY+D[1]);if(P&&!w){const Ht=this.projectAndGetPerspectiveRatio(_,ge.x+1,ge.y,y,V).point.sub(z.point).unit(),Yt=Math.atan(Ht.y/Ht.x)+(Ht.x<0?Math.PI:0),jt=Math.sin(Yt),Ut=Math.cos(Yt);W=new l.P(Ut,jt),ne=new l.P(-jt,Ut)}else if(!P&&w){const Ht=-this.transform.angle,Yt=Math.sin(Ht),jt=Math.cos(Ht);W=new l.P(jt,Yt),ne=new l.P(-Yt,jt)}let ke=z.point,Me=h;if(w){ke=ge;const Ht=this.transform.zoom-Math.floor(this.transform.zoom);Me=Math.pow(2,-Ht),Me*=this.mapProjection.getPitchedTextCorrection(this.transform,ge,y),H||(Me*=l.ac(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}H&&(ke=ke.add(W.mult(H.x*Me)).add(ne.mult(H.y*Me)));const Ne=t.x1*Me,Oe=t.x2*Me,qe=(Ne+Oe)/2,Ce=t.y1*Me,Ze=t.y2*Me,Ke=(Ce+Ze)/2,it=[{offsetX:Ne,offsetY:Ce},{offsetX:qe,offsetY:Ce},{offsetX:Oe,offsetY:Ce},{offsetX:Oe,offsetY:Ke},{offsetX:Oe,offsetY:Ze},{offsetX:qe,offsetY:Ze},{offsetX:Ne,offsetY:Ze},{offsetX:Ne,offsetY:Ke}];let bt=[];for(const{offsetX:Ht,offsetY:Yt}of it)bt.push(new l.P(ke.x+W.x*Ht+ne.x*Yt,ke.y+W.y*Ht+ne.y*Yt));let Rt=!1;if(w){const Ht=bt.map(Yt=>this.projectAndGetPerspectiveRatio(_,Yt.x,Yt.y,y,V));Rt=Ht.some(Yt=>!Yt.isOccluded),bt=Ht.map(Yt=>Yt.point)}else Rt=!0;return{box:l.ao(bt),allPointsOccluded:!Rt}}}function Fn(k,t,h){return t*(l.X/(k.tileSize*Math.pow(2,h-k.tileID.overscaledZ)))}class wi{constructor(t,h,_,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?h:-h))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class ui{constructor(t,h,_,y,w){this.text=new wi(t?t.text:null,h,_,w),this.icon=new wi(t?t.icon:null,h,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cn{constructor(t,h,_){this.text=t,this.icon=h,this.skipFade=_}}class ni{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class hi{constructor(t,h,_,y,w){this.bucketInstanceId=t,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=w}}class Ai{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const h=++this.maxGroupID;this.collisionGroups[t]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[t]}}function Xn(k,t,h,_,y){const{horizontalAlign:w,verticalAlign:P}=l.au(k);return new l.P(-(w-.5)*t+_[0]*y,-(P-.5)*h+_[1]*y)}class Tr{constructor(t,h,_,y,w,P){this.transform=t.clone(),this.terrain=_,this.collisionIndex=new An(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Ai(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=P,P&&(P.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const h=this.terrain;return h?(_,y)=>h.getElevation(t,_,y):null}getBucketParts(t,h,_,y){const w=_.getBucket(h),P=_.latestFeatureIndex;if(!w||!P||h.id!==w.layerIds[0])return;const D=_.collisionBoxArray,z=w.layers[0].layout,V=w.layers[0].paint,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),W=_.tileSize/l.X,ne=_.tileID.toUnwrapped(),ge=this.transform.calculatePosMatrix(ne),ke=z.get("text-pitch-alignment")==="map",Me=z.get("text-rotation-alignment")==="map",Ne=Fn(_,1,this.transform.zoom),Oe=this.collisionIndex.mapProjection.translatePosition(this.transform,_,V.get("text-translate"),V.get("text-translate-anchor")),qe=this.collisionIndex.mapProjection.translatePosition(this.transform,_,V.get("icon-translate"),V.get("icon-translate-anchor")),Ce=Ki(ge,ke,Me,this.transform,Ne);let Ze=null;if(ke){const it=Zr(ge,ke,Me,this.transform,Ne);Ze=l.L([],this.transform.labelPlaneMatrix,it)}this.retainedQueryData[w.bucketInstanceId]=new hi(w.bucketInstanceId,P,w.sourceLayerIndex,w.index,_.tileID);const Ke={bucket:w,layout:z,translationText:Oe,translationIcon:qe,posMatrix:ge,unwrappedTileID:ne,textLabelPlaneMatrix:Ce,labelToScreenMatrix:Ze,scale:H,textPixelRatio:W,holdingForFade:_.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:l.ag(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const it of w.sortKeyRanges){const{sortKey:bt,symbolInstanceStart:Rt,symbolInstanceEnd:Ht}=it;t.push({sortKey:bt,symbolInstanceStart:Rt,symbolInstanceEnd:Ht,parameters:Ke})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ke})}attemptAnchorPlacement(t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke,Me,Ne,Oe,qe,Ce){const Ze=l.aq[t.textAnchor],Ke=[t.textOffset0,t.textOffset1],it=Xn(Ze,_,y,Ke,w),bt=this.collisionIndex.placeCollisionBox(h,ne,z,V,H,D,P,Ne,W.predicate,Ce,it);if((!qe||this.collisionIndex.placeCollisionBox(qe,ne,z,V,H,D,P,Oe,W.predicate,Ce,it).placeable)&&bt.placeable){let Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(Rt=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ge.crossTileID]={textOffset:Ke,width:_,height:y,anchor:Ze,textBoxScale:w,prevAnchor:Rt},this.markUsedJustification(ke,Ze,ge,Me),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Me,ge),this.placedOrientations[ge.crossTileID]=Me),{shift:it,placedGlyphBoxes:bt}}}placeLayerBucketPart(t,h,_){const{bucket:y,layout:w,translationText:P,translationIcon:D,posMatrix:z,unwrappedTileID:V,textLabelPlaneMatrix:H,labelToScreenMatrix:W,textPixelRatio:ne,holdingForFade:ge,collisionBoxArray:ke,partiallyEvaluatedTextSize:Me,collisionGroup:Ne}=t.parameters,Oe=w.get("text-optional"),qe=w.get("icon-optional"),Ce=l.ar(w,"text-overlap","text-allow-overlap"),Ze=Ce==="always",Ke=l.ar(w,"icon-overlap","icon-allow-overlap"),it=Ke==="always",bt=w.get("text-rotation-alignment")==="map",Rt=w.get("text-pitch-alignment")==="map",Ht=w.get("icon-text-fit")!=="none",Yt=w.get("symbol-z-order")==="viewport-y",jt=Ze&&(it||!y.hasIconData()||qe),Ut=it&&(Ze||!y.hasTextData()||Oe);!y.collisionArrays&&ke&&y.deserializeCollisionBoxes(ke);const rn=this._getTerrainElevationFunc(this.retainedQueryData[y.bucketInstanceId].tileID),Tn=(qt,Xt,In)=>{var Si,On;if(h[qt.crossTileID])return;if(ge)return void(this.placements[qt.crossTileID]=new Cn(!1,!1,!1));let jn=!1,Ei=!1,Nr=!0,Hs=null,Ti={box:null,placeable:!1,offscreen:null},ss={box:null,placeable:!1,offscreen:null},Wr=null,zr=null,Xr=null,ho=0,tl=0,ku=0;Xt.textFeatureIndex?ho=Xt.textFeatureIndex:qt.useRuntimeCollisionCircles&&(ho=qt.featureIndex),Xt.verticalTextFeatureIndex&&(tl=Xt.verticalTextFeatureIndex);const nl=Xt.textBox;if(nl){const Os=Pr=>{let Or=l.ah.horizontal;if(y.allowVerticalPlacement&&!Pr&&this.prevPlacement){const Ss=this.prevPlacement.placedOrientations[qt.crossTileID];Ss&&(this.placedOrientations[qt.crossTileID]=Ss,Or=Ss,this.markUsedOrientation(y,Or,qt))}return Or},Fs=(Pr,Or)=>{if(y.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Ss of y.writingModes)if(Ss===l.ah.vertical?(Ti=Or(),ss=Ti):Ti=Pr(),Ti&&Ti.placeable)break}else Ti=Pr()},Qo=qt.textAnchorOffsetStartIndex,Ws=qt.textAnchorOffsetEndIndex;if(Ws===Qo){const Pr=(Or,Ss)=>{const Gn=this.collisionIndex.placeCollisionBox(Or,Ce,ne,z,V,Rt,bt,P,Ne.predicate,rn);return Gn&&Gn.placeable&&(this.markUsedOrientation(y,Ss,qt),this.placedOrientations[qt.crossTileID]=Ss),Gn};Fs(()=>Pr(nl,l.ah.horizontal),()=>{const Or=Xt.verticalTextBox;return y.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&Or?Pr(Or,l.ah.vertical):{box:null,offscreen:null}}),Os(Ti&&Ti.placeable)}else{let Pr=l.aq[(On=(Si=this.prevPlacement)===null||Si===void 0?void 0:Si.variableOffsets[qt.crossTileID])===null||On===void 0?void 0:On.anchor];const Or=(Gn,Ia,il)=>{const rl=Gn.x2-Gn.x1,Hh=Gn.y2-Gn.y1,dd=qt.textBoxScale,Wh=Ht&&Ke==="never"?Ia:null;let ea=null,Xh=Ce==="never"?1:2,Su="never";Pr&&Xh++;for(let Gl=0;Gl<Xh;Gl++){for(let Eu=Qo;Eu<Ws;Eu++){const Tu=y.textAnchorOffsets.get(Eu);if(Pr&&Tu.textAnchor!==Pr)continue;const sl=this.attemptAnchorPlacement(Tu,Gn,rl,Hh,dd,bt,Rt,ne,z,V,Ne,Su,qt,y,il,P,D,Wh,rn);if(sl&&(ea=sl.placedGlyphBoxes,ea&&ea.placeable))return jn=!0,Hs=sl.shift,ea}Pr?Pr=null:Su=Ce}return _&&!ea&&(ea={box:this.collisionIndex.placeCollisionBox(nl,"always",ne,z,V,Rt,bt,P,Ne.predicate,rn,new l.P(0,0)).box,offscreen:!1,placeable:!1}),ea};Fs(()=>Or(nl,Xt.iconBox,l.ah.horizontal),()=>{const Gn=Xt.verticalTextBox;return y.allowVerticalPlacement&&(!Ti||!Ti.placeable)&&qt.numVerticalGlyphVertices>0&&Gn?Or(Gn,Xt.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ti&&(jn=Ti.placeable,Nr=Ti.offscreen);const Ss=Os(Ti&&Ti.placeable);if(!jn&&this.prevPlacement){const Gn=this.prevPlacement.variableOffsets[qt.crossTileID];Gn&&(this.variableOffsets[qt.crossTileID]=Gn,this.markUsedJustification(y,Gn.anchor,qt,Ss))}}}if(Wr=Ti,jn=Wr&&Wr.placeable,Nr=Wr&&Wr.offscreen,qt.useRuntimeCollisionCircles){const Os=y.text.placedSymbolArray.get(qt.centerJustifiedTextSymbolIndex),Fs=l.ai(y.textSizeData,Me,Os),Qo=w.get("text-padding");zr=this.collisionIndex.placeCollisionCircles(Ce,Os,y.lineVertexArray,y.glyphOffsetArray,Fs,z,V,H,W,_,Rt,Ne.predicate,qt.collisionCircleDiameter,Qo,P,rn),zr.circles.length&&zr.collisionDetected&&!_&&l.w("Collisions detected, but collision boxes are not shown"),jn=Ze||zr.circles.length>0&&!zr.collisionDetected,Nr=Nr&&zr.offscreen}if(Xt.iconFeatureIndex&&(ku=Xt.iconFeatureIndex),Xt.iconBox){const Os=Fs=>this.collisionIndex.placeCollisionBox(Fs,Ke,ne,z,V,Rt,bt,D,Ne.predicate,rn,Ht&&Hs?Hs:void 0);ss&&ss.placeable&&Xt.verticalIconBox?(Xr=Os(Xt.verticalIconBox),Ei=Xr.placeable):(Xr=Os(Xt.iconBox),Ei=Xr.placeable),Nr=Nr&&Xr.offscreen}const zs=Oe||qt.numHorizontalGlyphVertices===0&&qt.numVerticalGlyphVertices===0,Iu=qe||qt.numIconVertices===0;zs||Iu?Iu?zs||(Ei=Ei&&jn):jn=Ei&&jn:Ei=jn=Ei&&jn;const qc=Ei&&Xr.placeable;if(jn&&Wr.placeable&&this.collisionIndex.insertCollisionBox(Wr.box,Ce,w.get("text-ignore-placement"),y.bucketInstanceId,ss&&ss.placeable&&tl?tl:ho,Ne.ID),qc&&this.collisionIndex.insertCollisionBox(Xr.box,Ke,w.get("icon-ignore-placement"),y.bucketInstanceId,ku,Ne.ID),zr&&jn&&this.collisionIndex.insertCollisionCircles(zr.circles,Ce,w.get("text-ignore-placement"),y.bucketInstanceId,ho,Ne.ID),_&&this.storeCollisionData(y.bucketInstanceId,In,Xt,Wr,Xr,zr),qt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qt.crossTileID]=new Cn(jn||jt,Ei||Ut,Nr||y.justReloaded),h[qt.crossTileID]=!0};if(Yt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qt=y.getSortedSymbolIndexes(this.transform.angle);for(let Xt=qt.length-1;Xt>=0;--Xt){const In=qt[Xt];Tn(y.symbolInstances.get(In),y.collisionArrays[In],In)}}else for(let qt=t.symbolInstanceStart;qt<t.symbolInstanceEnd;qt++)Tn(y.symbolInstances.get(qt),y.collisionArrays[qt],qt);if(_&&y.bucketInstanceId in this.collisionCircleArrays){const qt=this.collisionCircleArrays[y.bucketInstanceId];l.as(qt.invProjMatrix,z),qt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}storeCollisionData(t,h,_,y,w,P){if(_.textBox||_.iconBox){let D,z;this.collisionBoxArrays.has(t)?D=this.collisionBoxArrays.get(t):(D=new Map,this.collisionBoxArrays.set(t,D)),D.has(h)?z=D.get(h):(z={text:null,icon:null},D.set(h,z)),_.textBox&&(z.text=y.box),_.iconBox&&(z.icon=w.box)}if(P){let D=this.collisionCircleArrays[t];D===void 0&&(D=this.collisionCircleArrays[t]=new ni);for(let z=0;z<P.circles.length;z+=4)D.circles.push(P.circles[z+0]),D.circles.push(P.circles[z+1]),D.circles.push(P.circles[z+2]),D.circles.push(P.collisionDetected?1:0)}}markUsedJustification(t,h,_,y){let w;w=y===l.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.at(h)];const P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const D of P)D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=w>=0&&D!==w?0:_.crossTileID)}markUsedOrientation(t,h,_){const y=h===l.ah.horizontal||h===l.ah.horizontalOnly?h:0,w=h===l.ah.vertical?h:0,P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const D of P)t.text.placedSymbolArray.get(D).placedOrientation=y;_.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(t):1,w=h?h.opacities:{},P=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const z in this.placements){const V=this.placements[z],H=w[z];H?(this.opacities[z]=new ui(H,y,V.text,V.icon),_=_||V.text!==H.text.placed||V.icon!==H.icon.placed):(this.opacities[z]=new ui(null,y,V.text,V.icon,V.skipFade),_=_||V.text||V.icon)}for(const z in w){const V=w[z];if(!this.opacities[z]){const H=new ui(V,y,!1,!1);H.isHidden()||(this.opacities[z]=H,_=_||V.text.placed||V.icon.placed)}}for(const z in P)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=P[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:t)}updateLayerOpacities(t,h){const _={};for(const y of h){const w=y.getBucket(t);w&&y.latestFeatureIndex&&t.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,_,y.collisionBoxArray)}}updateBucketOpacities(t,h,_,y){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const w=t.layers[0],P=w.layout,D=new ui(null,0,!1,!1,!0),z=P.get("text-allow-overlap"),V=P.get("icon-allow-overlap"),H=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=P.get("text-rotation-alignment")==="map",ne=P.get("text-pitch-alignment")==="map",ge=P.get("icon-text-fit")!=="none",ke=new ui(null,0,z&&(V||!t.hasIconData()||P.get("icon-optional")),V&&(z||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Me=(Oe,qe,Ce)=>{for(let Ze=0;Ze<qe/4;Ze++)Oe.opacityVertexArray.emplaceBack(Ce);Oe.hasVisibleVertices=Oe.hasVisibleVertices||Ce!==no},Ne=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Oe=0;Oe<t.symbolInstances.length;Oe++){const qe=t.symbolInstances.get(Oe),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Ze,crossTileID:Ke}=qe;let it=this.opacities[Ke];_[Ke]?it=D:it||(it=ke,this.opacities[Ke]=it),_[Ke]=!0;const bt=qe.numIconVertices>0,Rt=this.placedOrientations[qe.crossTileID],Ht=Rt===l.ah.vertical,Yt=Rt===l.ah.horizontal||Rt===l.ah.horizontalOnly;if(Ce>0||Ze>0){const Ut=or(it.text);Me(t.text,Ce,Ht?no:Ut),Me(t.text,Ze,Yt?no:Ut);const rn=it.text.isHidden();[qe.rightJustifiedTextSymbolIndex,qe.centerJustifiedTextSymbolIndex,qe.leftJustifiedTextSymbolIndex].forEach(Xt=>{Xt>=0&&(t.text.placedSymbolArray.get(Xt).hidden=rn||Ht?1:0)}),qe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(qe.verticalPlacedTextSymbolIndex).hidden=rn||Yt?1:0);const Tn=this.variableOffsets[qe.crossTileID];Tn&&this.markUsedJustification(t,Tn.anchor,qe,Rt);const qt=this.placedOrientations[qe.crossTileID];qt&&(this.markUsedJustification(t,"left",qe,qt),this.markUsedOrientation(t,qt,qe))}if(bt){const Ut=or(it.icon),rn=!(ge&&qe.verticalPlacedIconSymbolIndex&&Ht);qe.placedIconSymbolIndex>=0&&(Me(t.icon,qe.numIconVertices,rn?Ut:no),t.icon.placedSymbolArray.get(qe.placedIconSymbolIndex).hidden=it.icon.isHidden()),qe.verticalPlacedIconSymbolIndex>=0&&(Me(t.icon,qe.numVerticalIconVertices,rn?no:Ut),t.icon.placedSymbolArray.get(qe.verticalPlacedIconSymbolIndex).hidden=it.icon.isHidden())}const jt=Ne&&Ne.has(Oe)?Ne.get(Oe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ut=t.collisionArrays[Oe];if(Ut){let rn=new l.P(0,0);if(Ut.textBox||Ut.verticalTextBox){let Tn=!0;if(H){const qt=this.variableOffsets[Ke];qt?(rn=Xn(qt.anchor,qt.width,qt.height,qt.textOffset,qt.textBoxScale),W&&rn._rotate(ne?this.transform.angle:-this.transform.angle)):Tn=!1}if(Ut.textBox||Ut.verticalTextBox){let qt;Ut.textBox&&(qt=Ht),Ut.verticalTextBox&&(qt=Yt),No(t.textCollisionBox.collisionVertexArray,it.text.placed,!Tn||qt,jt.text,rn.x,rn.y)}}if(Ut.iconBox||Ut.verticalIconBox){const Tn=!!(!Yt&&Ut.verticalIconBox);let qt;Ut.iconBox&&(qt=Tn),Ut.verticalIconBox&&(qt=!Tn),No(t.iconCollisionBox.collisionVertexArray,it.icon.placed,qt,jt.icon,ge?rn.x:0,ge?rn.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Oe.invProjMatrix,t.placementViewportMatrix=Oe.viewportMatrix,t.collisionCircleArray=Oe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>t}setStale(){this.stale=!0}}function No(k,t,h,_,y,w){_&&_.length!==0||(_=[0,0,0,0]);const P=_[0]-Mn,D=_[1]-Mn,z=_[2]-Mn,V=_[3]-Mn;k.emplaceBack(t?1:0,h?1:0,y||0,w||0,P,D),k.emplaceBack(t?1:0,h?1:0,y||0,w||0,z,D),k.emplaceBack(t?1:0,h?1:0,y||0,w||0,z,V),k.emplaceBack(t?1:0,h?1:0,y||0,w||0,P,V)}const Qn=Math.pow(2,25),bo=Math.pow(2,24),aa=Math.pow(2,17),Cr=Math.pow(2,16),Dr=Math.pow(2,9),yc=Math.pow(2,8),Pi=Math.pow(2,1);function or(k){if(k.opacity===0&&!k.placed)return 0;if(k.opacity===1&&k.placed)return 4294967295;const t=k.placed?1:0,h=Math.floor(127*k.opacity);return h*Qn+t*bo+h*aa+t*Cr+h*Dr+t*yc+h*Pi+t}const no=0;function Kr(){return{isOccluded:(k,t,h)=>!1,getPitchedTextCorrection:(k,t,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(k,t,h,_){throw new Error("Not implemented.")},translatePosition:(k,t,h,_)=>function(y,w,P,D,z=!1){if(!P[0]&&!P[1])return[0,0];const V=z?D==="map"?y.angle:0:D==="viewport"?-y.angle:0;if(V){const H=Math.sin(V),W=Math.cos(V);P=[P[0]*W-P[1]*H,P[0]*H+P[1]*W]}return[z?P[0]:Fn(w,P[0],y.zoom),z?P[1]:Fn(w,P[1],y.zoom)]}(k,t,h,_),getCircleRadiusCorrection:k=>1}}class Ri{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,h,_,y,w){const P=this._bucketParts;for(;this._currentTileIndex<t.length;)if(h.getBucketParts(P,y,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((D,z)=>D.sortKey-z.sortKey));this._currentPartIndex<P.length;)if(h.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,w())return!0;return!1}}class la{constructor(t,h,_,y,w,P,D,z){this.placement=new Tr(t,Kr(),h,P,D,z),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(t,h,_){const y=L.now(),w=()=>!this._forceFullPlacement&&L.now()-y>2;for(;this._currentPlacementIndex>=0;){const P=h[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Ri(P)),this._inProgressLayer.continuePlacement(_[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const _s=512/l.X/2;class Fi{constructor(t,h,_){this.tileID=t,this.bucketInstanceId=_,this._symbolsByKey={};const y=new Map;for(let w=0;w<h.length;w++){const P=h.get(w),D=P.key,z=y.get(D);z?z.push(P):y.set(D,[P])}for(const[w,P]of y){const D={positions:P.map(z=>({x:Math.floor(z.anchorX*_s),y:Math.floor(z.anchorY*_s)})),crossTileIDs:P.map(z=>z.crossTileID)};if(D.positions.length>128){const z=new l.av(D.positions.length,16,Uint16Array);for(const{x:V,y:H}of D.positions)z.add(V,H);z.finish(),delete D.positions,D.index=z}this._symbolsByKey[w]=D}}getScaledCoordinates(t,h){const{x:_,y,z:w}=this.tileID.canonical,{x:P,y:D,z}=h.canonical,V=_s/Math.pow(2,z-w),H=(D*l.X+t.anchorY)*V,W=y*l.X*_s;return{x:Math.floor((P*l.X+t.anchorX)*V-_*l.X*_s),y:Math.floor(H-W)}}findMatches(t,h,_){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<t.length;w++){const P=t.get(w);if(P.crossTileID)continue;const D=this._symbolsByKey[P.key];if(!D)continue;const z=this.getScaledCoordinates(P,h);if(D.index){const V=D.index.range(z.x-y,z.y-y,z.x+y,z.y+y).sort();for(const H of V){const W=D.crossTileIDs[H];if(!_[W]){_[W]=!0,P.crossTileID=W;break}}}else if(D.positions)for(let V=0;V<D.positions.length;V++){const H=D.positions[V],W=D.crossTileIDs[V];if(Math.abs(H.x-z.x)<=y&&Math.abs(H.y-z.y)<=y&&!_[W]){_[W]=!0,P.crossTileID=W;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const h=Math.round((t-this.lng)/360);if(h!==0)for(const _ in this.indexes){const y=this.indexes[_],w={};for(const P in y){const D=y[P];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),w[D.tileID.key]=D}this.indexes[_]=w}this.lng=t}addBucket(t,h,_){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const y=this.usedCrossTileIDs[t.overscaledZ];for(const w in this.indexes){const P=this.indexes[w];if(Number(w)>t.overscaledZ)for(const D in P){const z=P[D];z.tileID.isChildOf(t)&&z.findMatches(h.symbolInstances,t,y)}else{const D=P[t.scaledTo(Number(w)).key];D&&D.findMatches(h.symbolInstances,t,y)}}for(let w=0;w<h.symbolInstances.length;w++){const P=h.symbolInstances.get(w);P.crossTileID||(P.crossTileID=_.generate(),y[P.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fi(t,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(t,h){for(const _ of h.getCrossTileIDsLists())for(const y of _)delete this.usedCrossTileIDs[t][y]}removeStaleBuckets(t){let h=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const w in y)t[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[w]),delete y[w],h=!0)}return h}}class zo{constructor(){this.layerIndexes={},this.crossTileIDs=new ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,h,_){let y=this.layerIndexes[t.id];y===void 0&&(y=this.layerIndexes[t.id]=new Qr);let w=!1;const P={};y.handleWrapJump(_);for(const D of h){const z=D.getBucket(t);z&&t.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(D.tileID,z,this.crossTileIDs)&&(w=!0),P[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(P)&&(w=!0),w}pruneUnusedLayers(t){const h={};t.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Qi=(k,t)=>l.t(k,t&&t.filter(h=>h.identifier!=="source.canvas")),io=l.aw();class ca extends l.E{constructor(t,h={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const y=this.sourceCaches[_].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[_].reload()}},this.map=t,this.dispatcher=new dn(Wn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,y)=>this.getGlyphs(_,y)),this.dispatcher.registerMessageHandler("GI",(_,y)=>this.getImages(_,y)),this.imageManager=new ze,this.imageManager.setEventedParent(this),this.glyphManager=new dt(t._requestManager,h.localIdeographFontFamily),this.lineAtlas=new xt(256,512),this.crossTileSymbolIndex=new zo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),mn().on(ct,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.sourceCaches[_.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const P in this._layers){const D=this._layers[P];D.source===w.id&&this._validateLayer(D)}})}loadURL(t,h={},_){this.fire(new l.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const y=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;l.h(y,this._loadStyleRequest).then(P=>{this._loadStyleRequest=null,this._load(P.data,h,_)}).catch(P=>{this._loadStyleRequest=null,P&&!w.signal.aborted&&this.fire(new l.j(P))})}loadJSON(t,h={},_){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(t,h,_)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(io,{validate:!1})}_load(t,h,_){var y;const w=h.transformStyle?h.transformStyle(_,t):t;if(!h.validate||!Qi(this,l.u(w))){this._loaded=!0,this.stylesheet=w;for(const P in w.sources)this.addSource(P,w.sources[P],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new vt(this.stylesheet.light),this.sky=new ft(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const t=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of t){const _=l.aA(h);_.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=_}}_loadSprite(t,h=!1,_=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,P,D,z){return l._(this,void 0,void 0,function*(){const V=be(w),H=D>1?"@2x":"",W={},ne={};for(const{id:ge,url:ke}of V){const Me=P.transformRequest(Te(ke,H,".json"),"SpriteJSON");W[ge]=l.h(Me,z);const Ne=P.transformRequest(Te(ke,H,".png"),"SpriteImage");ne[ge]=$.getImage(Ne,z)}return yield Promise.all([...Object.values(W),...Object.values(ne)]),function(ge,ke){return l._(this,void 0,void 0,function*(){const Me={};for(const Ne in ge){Me[Ne]={};const Oe=L.getImageCanvasContext((yield ke[Ne]).data),qe=(yield ge[Ne]).data;for(const Ce in qe){const{width:Ze,height:Ke,x:it,y:bt,sdf:Rt,pixelRatio:Ht,stretchX:Yt,stretchY:jt,content:Ut,textFitWidth:rn,textFitHeight:Tn}=qe[Ce];Me[Ne][Ce]={data:null,pixelRatio:Ht,sdf:Rt,stretchX:Yt,stretchY:jt,content:Ut,textFitWidth:rn,textFitHeight:Tn,spriteData:{width:Ze,height:Ke,x:it,y:bt,context:Oe}}}}return Me})}(W,ne)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const P in w){this._spritesImagesIds[P]=[];const D=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(z=>!(z in w)):[];for(const z of D)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in w[P]){const V=P==="default"?z:`${P}:${z}`;this._spritesImagesIds[P].push(V),V in this.imageManager.images?this.imageManager.updateImage(V,w[P][z],!1):this.imageManager.addImage(V,w[P][z]),h&&(this._changedImages[V]=!0)}}}).catch(w=>{this._spriteRequest=null,y=w,this.fire(new l.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),_&&_(y)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(t){const h=this.sourceCaches[t.source];if(!h)return;const _=t.sourceLayer;if(!_)return;const y=h.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(_)===-1)&&this.fire(new l.j(new Error(`Source layer "${_}" does not exist on source "${y.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,h=!1){const _=this._serializedAllLayers();if(!t||t.length===0)return Object.values(h?l.aB(_):_);const y=[];for(const w of t)if(_[w]){const P=h?l.aB(_[w]):_[w];y.push(P)}return y}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const h=Object.keys(this._layers);for(const _ of h){const y=this._layers[_];y.type!=="custom"&&(t[_]=y.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const h=this._changed;if(h){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const P in this._updatedSources){const D=this._updatedSources[P];if(D==="reload")this._reloadSource(P);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const _={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];_[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(t,this._availableImages),!w.isHidden(t.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in _){const w=this.sourceCaches[y];!!_[y]!=!!w.used&&w.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,h&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,h={}){var _;this._checkLoaded();const y=this.serialize();if(t=h.transformStyle?h.transformStyle(y,t):t,((_=h.validate)===null||_===void 0||_)&&Qi(this,l.u(t)))return!1;(t=l.aB(t)).layers=l.az(t.layers);const w=l.aC(y,t),P=this._getOperationsToPerform(w);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const D of P.operations)D();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const h=[],_=[];for(const y of t)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":h.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":h.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,y.args));break;case"setSky":h.push(()=>this.setSky.apply(this,y.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setTransition":h.push(()=>{});break;default:_.push(y.command)}return{operations:h,unimplemented:_}}addImage(t,h){if(this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,h),this._afterImageUpdated(t)}updateImage(t,h){this.imageManager.updateImage(t,h)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,h,_={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.u.source,`sources.${t}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[t]=new Tt(t,h,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:t})),y.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new l.j(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));const h=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],h.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,h){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const _=this.sourceCaches[t].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(h),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,h,_={}){this._checkLoaded();const y=t.id;if(this.getLayer(y))return void this.fire(new l.j(new Error(`Layer "${y}" already exists on this map.`)));let w;if(t.type==="custom"){if(Qi(this,l.aD(t)))return;w=l.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(y,t.source),t=l.aB(t),t=l.e(t,{source:y})),this._validate(l.u.layer,`layers.${y}`,t,{arrayIndex:-1},_))return;w=l.aA(t),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const P=h?this._order.indexOf(h):this._order.length;if(h&&P===-1)this.fire(new l.j(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(P,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const D=this._removedLayers[y];delete this._removedLayers[y],D.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(t,h){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===h)return;const _=this._order.indexOf(t);this._order.splice(_,1);const y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new l.j(new Error(`Cannot move layer "${t}" before non-existing layer "${h}".`))):(this._order.splice(y,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const h=this._layers[t];if(!h)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${t}".`)));h.setEventedParent(null);const _=this._order.indexOf(t);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=h,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],h.onRemove&&h.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,h,_){this._checkLoaded();const y=this.getLayer(t);y?y.minzoom===h&&y.maxzoom===_||(h!=null&&(y.minzoom=h),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,h,_={}){this._checkLoaded();const y=this.getLayer(t);if(y){if(!l.aE(y.filter,h))return h==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(l.u.filter,`layers.${y.id}.filter`,h,null,_)||(y.filter=l.aB(h),this._updateLayer(y)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.aB(this.getLayer(t).filter)}setLayoutProperty(t,h,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getLayoutProperty(h),_)||(w.setLayoutProperty(h,_,y),this._updateLayer(w)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,h){const _=this.getLayer(t);if(_)return _.getLayoutProperty(h);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,h,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getPaintProperty(h),_)||(w.setPaintProperty(h,_,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,h){return this.getLayer(t).getPaintProperty(h)}setFeatureState(t,h){this._checkLoaded();const _=t.source,y=t.sourceLayer,w=this.sourceCaches[_];if(w===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const P=w.getSource().type;P==="geojson"&&y?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||y?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,t.id,h)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,h){this._checkLoaded();const _=t.source,y=this.sourceCaches[_];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const w=y.getSource().type,P=w==="vector"?t.sourceLayer:void 0;w!=="vector"||P?h&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(P,t.id,h):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const h=t.source,_=t.sourceLayer,y=this.sourceCaches[h];if(y!==void 0)return y.getSource().type!=="vector"||_?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(_,t.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.aF(this.sourceCaches,w=>w.serialize()),h=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,y=this.stylesheet;return l.aG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:t,layers:h,terrain:_},w=>w!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const h=P=>this._layers[P].type==="fill-extrusion",_={},y=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(h(D)){_[D]=P;for(const z of t){const V=z[D];if(V)for(const H of V)y.push(H)}}}y.sort((P,D)=>D.intersectionZ-P.intersectionZ);const w=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(h(D))for(let z=y.length-1;z>=0;z--){const V=y[z].feature;if(_[V.layer.id]<P)break;w.push(V),y.pop()}else for(const z of t){const V=z[D];if(V)for(const H of V)w.push(H.feature)}}return w}queryRenderedFeatures(t,h,_){h&&h.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const D of h.layers){const z=this._layers[D];if(!z)return this.fire(new l.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const w=[];h.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const D in this.sourceCaches)h.layers&&!y[D]||w.push(lt(this.sourceCaches[D],this._layers,P,t,h,_));return this.placement&&w.push(function(D,z,V,H,W,ne,ge){const ke={},Me=ne.queryRenderedSymbols(H),Ne=[];for(const Oe of Object.keys(Me).map(Number))Ne.push(ge[Oe]);Ne.sort(Je);for(const Oe of Ne){const qe=Oe.featureIndex.lookupSymbolFeatures(Me[Oe.bucketInstanceId],z,Oe.bucketIndex,Oe.sourceLayerIndex,W.filter,W.layers,W.availableImages,D);for(const Ce in qe){const Ze=ke[Ce]=ke[Ce]||[],Ke=qe[Ce];Ke.sort((it,bt)=>{const Rt=Oe.featureSortOrder;if(Rt){const Ht=Rt.indexOf(it.featureIndex);return Rt.indexOf(bt.featureIndex)-Ht}return bt.featureIndex-it.featureIndex});for(const it of Ke)Ze.push(it)}}for(const Oe in ke)ke[Oe].forEach(qe=>{const Ce=qe.feature,Ze=V[D[Oe].source].getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=Ze});return ke}(this._layers,P,this.sourceCaches,t,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(t,h){h&&h.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",h.filter,null,h);const _=this.sourceCaches[t];return _?function(y,w){const P=y.getRenderableIds().map(V=>y.getTileByID(V)),D=[],z={};for(let V=0;V<P.length;V++){const H=P[V],W=H.tileID.canonical.key;z[W]||(z[W]=!0,H.querySourceFeatures(D,w))}return D}(_,h):[]}getLight(){return this.light.getLight()}setLight(t,h={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const P in t)if(!l.aE(t[P],_[P])){y=!0;break}if(!y)return;const w={now:L.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,h),this.light.updateTransitions(w)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,h={}){const _=this.getSky();let y=!1;if(!t&&!_)return;if(t&&!_)y=!0;else if(!t&&_)y=!0;else for(const P in t)if(!l.aE(t[P],_[P])){y=!0;break}if(!y)return;const w={now:L.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,h),this.sky.updateTransitions(w)}_validate(t,h,_,y,w={}){return(!w||w.validate!==!1)&&Qi(this,t.call(l.u,l.e({key:h,style:this.serialize(),value:_,styleSpec:l.v},y)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),mn().off(ct,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const _=this.sourceCaches[h];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const h in this.sourceCaches)this.sourceCaches[h].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,h,_,y,w=!1){let P=!1,D=!1;const z={};for(const V of this._order){const H=this._layers[V];if(H.type!=="symbol")continue;if(!z[H.source]){const ne=this.sourceCaches[H.source];z[H.source]=ne.getRenderableIds(!0).map(ge=>ne.getTileByID(ge)).sort((ge,ke)=>ke.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(ke.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(H,z[H.source],t.center.lng);P=P||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(L.now(),t.zoom))&&(this.pauseablePlacement=new la(t,this.map.terrain,this._order,w,h,_,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(L.now()),D=!0),P&&this.pauseablePlacement.placement.setStale()),D||P)for(const V of this._order){const H=this._layers[V];H.type==="symbol"&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(L.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,h){return l._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,h.icons),_})}getGlyphs(t,h){return l._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(h.stacks),y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,h={}){this._checkLoaded(),t&&this._validate(l.u.glyphs,"glyphs",t,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,h,_={},y){this._checkLoaded();const w=[{id:t,url:h}],P=[...be(this.stylesheet.sprite),...w];this._validate(l.u.sprite,"sprite",P,null,_)||(this.stylesheet.sprite=P,this._loadSprite(w,!0,y))}removeSprite(t){this._checkLoaded();const h=be(this.stylesheet.sprite);if(h.find(_=>_.id===t)){if(this._spritesImagesIds[t])for(const _ of this._spritesImagesIds[t])this.imageManager.removeImage(_),this._changedImages[_]=!0;h.splice(h.findIndex(_=>_.id===t),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return be(this.stylesheet.sprite)}setSprite(t,h={},_){this._checkLoaded(),t&&this._validate(l.u.sprite,"sprite",t,null,h)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,_):(this._unloadSprite(),_&&_(null)))}}var es=l.Y([{name:"a_pos",type:"Int16",components:2}]);const ro={prelude:ei(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ei(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ei(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ei(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ei("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ei(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ei(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ei("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ei("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ei(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ei(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ei(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ei(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ei(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ei(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ei(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ei(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ei(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ei(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ei(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ei("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ei("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ei("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ei("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ei(k,t){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=t.match(/attribute ([\w]+) ([\w]+)/g),y=k.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(y):y,D={};return{fragmentSource:k=k.replace(h,(z,V,H,W,ne)=>(D[ne]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${H} ${W} ${ne};
#else
uniform ${H} ${W} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${H} ${W} ${ne} = u_${ne};
#endif
`)),vertexSource:t=t.replace(h,(z,V,H,W,ne)=>{const ge=W==="float"?"vec2":"vec4",ke=ne.match(/color/)?"color":ge;return D[ne]?V==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${ge} a_${ne};
varying ${H} ${W} ${ne};
#else
uniform ${H} ${W} u_${ne};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${ke}(a_${ne}, u_${ne}_t);
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${ge} a_${ne};
#else
uniform ${H} ${W} u_${ne};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${W} ${ne} = a_${ne};
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${W} ${ne} = unpack_mix_${ke}(a_${ne}, u_${ne}_t);
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`}),staticAttributes:_,staticUniforms:P}}class Sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,h,_,y,w,P,D,z,V){this.context=t;let H=this.boundPaintVertexBuffers.length!==y.length;for(let W=0;!H&&W<y.length;W++)this.boundPaintVertexBuffers[W]!==y[W]&&(H=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==V?this.freshBind(h,_,y,w,P,D,z,V):(t.bindVertexArray.set(this.vao),D&&D.bind(),w&&w.dynamicDraw&&w.bind(),z&&z.bind(),V&&V.bind())}freshBind(t,h,_,y,w,P,D,z){const V=t.numAttributes,H=this.context,W=H.gl;this.vao&&this.destroy(),this.vao=H.createVertexArray(),H.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=z,h.enableAttributes(W,t);for(const ne of _)ne.enableAttributes(W,t);P&&P.enableAttributes(W,t),D&&D.enableAttributes(W,t),z&&z.enableAttributes(W,t),h.bind(),h.setVertexAttribPointers(W,t,w);for(const ne of _)ne.bind(),ne.setVertexAttribPointers(W,t,w);P&&(P.bind(),P.setVertexAttribPointers(W,t,w)),y&&y.bind(),D&&(D.bind(),D.setVertexAttribPointers(W,t,w)),z&&(z.bind(),z.setVertexAttribPointers(W,t,w)),H.currentNumAttributes=V}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const El=(k,t,h,_,y)=>({u_matrix:k,u_texture:0,u_ele_delta:t,u_fog_matrix:h,u_fog_color:_?_.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:_?_.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?_.calculateFogBlendOpacity(y):0,u_horizon_color:_?_.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:_?_.properties.get("horizon-fog-blend"):1});function xo(k){const t=[];for(let h=0;h<k.length;h++){if(k[h]===null)continue;const _=k[h].split(" ");t.push(_.pop())}return t}class wo{constructor(t,h,_,y,w,P){const D=t.gl;this.program=D.createProgram();const z=xo(h.staticAttributes),V=_?_.getBinderAttributes():[],H=z.concat(V),W=ro.prelude.staticUniforms?xo(ro.prelude.staticUniforms):[],ne=h.staticUniforms?xo(h.staticUniforms):[],ge=_?_.getBinderUniforms():[],ke=W.concat(ne).concat(ge),Me=[];for(const it of ke)Me.indexOf(it)<0&&Me.push(it);const Ne=_?_.defines():[];w&&Ne.push("#define OVERDRAW_INSPECTOR;"),P&&Ne.push("#define TERRAIN3D;");const Oe=Ne.concat(ro.prelude.fragmentSource,h.fragmentSource).join(`
`),qe=Ne.concat(ro.prelude.vertexSource,h.vertexSource).join(`
`),Ce=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ce,Oe),D.compileShader(Ce),!D.getShaderParameter(Ce,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Ce)}`);D.attachShader(this.program,Ce);const Ze=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ze,qe),D.compileShader(Ze),!D.getShaderParameter(Ze,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ze)}`);D.attachShader(this.program,Ze),this.attributes={};const Ke={};this.numAttributes=H.length;for(let it=0;it<this.numAttributes;it++)H[it]&&(D.bindAttribLocation(this.program,it,H[it]),this.attributes[H[it]]=it);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ze),D.deleteShader(Ce);for(let it=0;it<Me.length;it++){const bt=Me[it];if(bt&&!Ke[bt]){const Rt=D.getUniformLocation(this.program,bt);Rt&&(Ke[bt]=Rt)}}this.fixedUniforms=y(t,Ke),this.terrainUniforms=((it,bt)=>({u_depth:new l.aH(it,bt.u_depth),u_terrain:new l.aH(it,bt.u_terrain),u_terrain_dim:new l.aI(it,bt.u_terrain_dim),u_terrain_matrix:new l.aJ(it,bt.u_terrain_matrix),u_terrain_unpack:new l.aK(it,bt.u_terrain_unpack),u_terrain_exaggeration:new l.aI(it,bt.u_terrain_exaggeration)}))(t,Ke),this.binderUniforms=_?_.getUniforms(t,Ke):[]}draw(t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke,Me,Ne,Oe,qe){const Ce=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(_),t.setStencilMode(y),t.setColorMode(w),t.setCullFace(P),z){t.activeTexture.set(Ce.TEXTURE2),Ce.bindTexture(Ce.TEXTURE_2D,z.depthTexture),t.activeTexture.set(Ce.TEXTURE3),Ce.bindTexture(Ce.TEXTURE_2D,z.texture);for(const Ke in this.terrainUniforms)this.terrainUniforms[Ke].set(z[Ke])}for(const Ke in this.fixedUniforms)this.fixedUniforms[Ke].set(D[Ke]);Me&&Me.setUniforms(t,this.binderUniforms,ge,{zoom:ke});let Ze=0;switch(h){case Ce.LINES:Ze=2;break;case Ce.TRIANGLES:Ze=3;break;case Ce.LINE_STRIP:Ze=1}for(const Ke of ne.get()){const it=Ke.vaos||(Ke.vaos={});(it[V]||(it[V]=new Sl)).bind(t,this,H,Me?Me.getPaintVertexBuffers():[],W,Ke.vertexOffset,Ne,Oe,qe),Ce.drawElements(h,Ke.primitiveLength*Ze,Ce.UNSIGNED_SHORT,Ke.primitiveOffset*Ze*2)}}}function ha(k,t,h){const _=1/Fn(h,1,t.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,t.transform.tileZoom)/y,P=w*(h.tileID.canonical.x+h.tileID.wrap*y),D=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,k.fromScale,k.toScale],u_fade:k.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[65535&P,65535&D]}}const fa=(k,t,h,_)=>{const y=t.style.light,w=y.properties.get("position"),P=[w.x,w.y,w.z],D=function(){var V=new l.A(9);return l.A!=Float32Array&&(V[1]=0,V[2]=0,V[3]=0,V[5]=0,V[6]=0,V[7]=0),V[0]=1,V[4]=1,V[8]=1,V}();y.properties.get("anchor")==="viewport"&&function(V,H){var W=Math.sin(H),ne=Math.cos(H);V[0]=ne,V[1]=W,V[2]=0,V[3]=-W,V[4]=ne,V[5]=0,V[6]=0,V[7]=0,V[8]=1}(D,-t.transform.angle),function(V,H,W){var ne=H[0],ge=H[1],ke=H[2];V[0]=ne*W[0]+ge*W[3]+ke*W[6],V[1]=ne*W[1]+ge*W[4]+ke*W[7],V[2]=ne*W[2]+ge*W[5]+ke*W[8]}(P,P,D);const z=y.properties.get("color");return{u_matrix:k,u_lightpos:P,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+h,u_opacity:_}},da=(k,t,h,_,y,w,P)=>l.e(fa(k,t,h,_),ha(w,t,P),{u_height_factor:-Math.pow(2,y.overscaledZ)/P.tileSize/8}),Oo=k=>({u_matrix:k}),za=(k,t,h,_)=>l.e(Oo(k),ha(h,t,_)),ki=(k,t)=>({u_matrix:k,u_world:t}),so=(k,t,h,_,y)=>l.e(za(k,t,h,_),{u_world:y}),vc=(k,t,h,_)=>{const y=k.transform;let w,P;if(_.paint.get("circle-pitch-alignment")==="map"){const D=Fn(h,1,y.zoom);w=!0,P=[D,D]}else w=!1,P=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:k.translatePosMatrix(t.posMatrix,h,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:k.pixelRatio,u_extrude_scale:P}},Vs=(k,t,h)=>({u_matrix:k,u_inv_matrix:t,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),yr=(k,t,h=1)=>({u_matrix:k,u_color:t,u_overlay:0,u_overlay_scale:h}),bi=k=>({u_matrix:k}),cr=(k,t,h,_)=>({u_matrix:k,u_extrude_scale:Fn(t,1,h),u_intensity:_}),Oa=(k,t,h,_)=>{const y=l.H();l.aP(y,0,k.width,k.height,0,0,1);const w=k.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:h,u_color_ramp:_,u_opacity:t.paint.get("heatmap-opacity")}};function Fa(k,t){const h=Math.pow(2,t.canonical.z),_=t.canonical.y;return[new l.Z(0,_/h).toLngLat().lat,new l.Z(0,(_+1)/h).toLngLat().lat]}const pa=(k,t,h,_)=>{const y=k.transform;return{u_matrix:ys(k,t,h,_),u_ratio:1/Fn(t,1,y.zoom),u_device_pixel_ratio:k.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ma=(k,t,h,_,y)=>l.e(pa(k,t,h,y),{u_image:0,u_image_height:_}),Fo=(k,t,h,_,y)=>{const w=k.transform,P=ii(t,w);return{u_matrix:ys(k,t,h,y),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Fn(t,1,w.zoom),u_device_pixel_ratio:k.pixelRatio,u_image:0,u_scale:[P,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},su=(k,t,h,_,y,w)=>{const P=k.lineAtlas,D=ii(t,k.transform),z=h.layout.get("line-cap")==="round",V=P.getDash(_.from,z),H=P.getDash(_.to,z),W=V.width*y.fromScale,ne=H.width*y.toScale;return l.e(pa(k,t,h,w),{u_patternscale_a:[D/W,-V.height/2],u_patternscale_b:[D/ne,-H.height/2],u_sdfgamma:P.width/(256*Math.min(W,ne)*k.pixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:H.y,u_mix:y.t})};function ii(k,t){return 1/Fn(k,1,t.tileZoom)}function ys(k,t,h,_){return k.translatePosMatrix(_?_.posMatrix:t.tileID.posMatrix,t,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Tl=(k,t,h,_,y)=>{return{u_matrix:k,u_tl_parent:t,u_scale_parent:h,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(P=y.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:ou(y.paint.get("raster-hue-rotate"))};var w,P};function ou(k){k*=Math.PI/180;const t=Math.sin(k),h=Math.cos(k);return[(2*h+1)/3,(-Math.sqrt(3)*t-h+1)/3,(Math.sqrt(3)*t-h+1)/3]}const Bo=(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge)=>{const ke=P.transform;return{u_is_size_zoom_constant:+(k==="constant"||k==="source"),u_is_size_feature_constant:+(k==="constant"||k==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ke.cameraToCenterDistance,u_pitch:ke.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ke.width/ke.height,u_fade_change:P.options.fadeDuration?P.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:z,u_coord_matrix:V,u_is_text:+W,u_pitch_with_map:+_,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:ge}},Uo=(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke)=>{const Me=P.transform;return l.e(Bo(k,t,h,_,y,w,P,D,z,V,H,W,ne,ke),{u_gamma_scale:_?Math.cos(Me._pitch)*Me.cameraToCenterDistance:1,u_device_pixel_ratio:P.pixelRatio,u_is_halo:+ge})},hr=(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge)=>l.e(Uo(k,t,h,_,y,w,P,D,z,V,H,!0,W,!0,ge),{u_texsize_icon:ne,u_texture_icon:1}),ga=(k,t,h)=>({u_matrix:k,u_opacity:t,u_color:h}),_a=(k,t,h,_,y,w)=>l.e(function(P,D,z,V){const H=z.imageManager.getPattern(P.from.toString()),W=z.imageManager.getPattern(P.to.toString()),{width:ne,height:ge}=z.imageManager.getPixelSize(),ke=Math.pow(2,V.tileID.overscaledZ),Me=V.tileSize*Math.pow(2,z.transform.tileZoom)/ke,Ne=Me*(V.tileID.canonical.x+V.tileID.wrap*ke),Oe=Me*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:W.tl,u_pattern_br_b:W.br,u_texsize:[ne,ge],u_mix:D.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:W.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Fn(V,1,z.transform.tileZoom),u_pixel_coord_upper:[Ne>>16,Oe>>16],u_pixel_coord_lower:[65535&Ne,65535&Oe]}}(_,w,h,y),{u_matrix:k,u_opacity:t}),Ba={fillExtrusion:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_opacity:new l.aI(k,t.u_opacity)}),fillExtrusionPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_height_factor:new l.aI(k,t.u_height_factor),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade),u_opacity:new l.aI(k,t.u_opacity)}),fill:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),fillPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),fillOutline:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world)}),fillOutlinePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),circle:(k,t)=>({u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_scale_with_map:new l.aH(k,t.u_scale_with_map),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_extrude_scale:new l.aO(k,t.u_extrude_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_matrix:new l.aJ(k,t.u_matrix)}),collisionBox:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_pixel_extrude_scale:new l.aO(k,t.u_pixel_extrude_scale)}),collisionCircle:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_inv_matrix:new l.aJ(k,t.u_inv_matrix),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_viewport_size:new l.aO(k,t.u_viewport_size)}),debug:(k,t)=>({u_color:new l.aL(k,t.u_color),u_matrix:new l.aJ(k,t.u_matrix),u_overlay:new l.aH(k,t.u_overlay),u_overlay_scale:new l.aI(k,t.u_overlay_scale)}),clippingMask:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),heatmap:(k,t)=>({u_extrude_scale:new l.aI(k,t.u_extrude_scale),u_intensity:new l.aI(k,t.u_intensity),u_matrix:new l.aJ(k,t.u_matrix)}),heatmapTexture:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_color_ramp:new l.aH(k,t.u_color_ramp),u_opacity:new l.aI(k,t.u_opacity)}),hillshade:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_latrange:new l.aO(k,t.u_latrange),u_light:new l.aO(k,t.u_light),u_shadow:new l.aL(k,t.u_shadow),u_highlight:new l.aL(k,t.u_highlight),u_accent:new l.aL(k,t.u_accent)}),hillshadePrepare:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_dimension:new l.aO(k,t.u_dimension),u_zoom:new l.aI(k,t.u_zoom),u_unpack:new l.aK(k,t.u_unpack)}),line:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels)}),lineGradient:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_image:new l.aH(k,t.u_image),u_image_height:new l.aI(k,t.u_image_height)}),linePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texsize:new l.aO(k,t.u_texsize),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_image:new l.aH(k,t.u_image),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),lineSDF:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_patternscale_a:new l.aO(k,t.u_patternscale_a),u_patternscale_b:new l.aO(k,t.u_patternscale_b),u_sdfgamma:new l.aI(k,t.u_sdfgamma),u_image:new l.aH(k,t.u_image),u_tex_y_a:new l.aI(k,t.u_tex_y_a),u_tex_y_b:new l.aI(k,t.u_tex_y_b),u_mix:new l.aI(k,t.u_mix)}),raster:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_tl_parent:new l.aO(k,t.u_tl_parent),u_scale_parent:new l.aI(k,t.u_scale_parent),u_buffer_scale:new l.aI(k,t.u_buffer_scale),u_fade_t:new l.aI(k,t.u_fade_t),u_opacity:new l.aI(k,t.u_opacity),u_image0:new l.aH(k,t.u_image0),u_image1:new l.aH(k,t.u_image1),u_brightness_low:new l.aI(k,t.u_brightness_low),u_brightness_high:new l.aI(k,t.u_brightness_high),u_saturation_factor:new l.aI(k,t.u_saturation_factor),u_contrast_factor:new l.aI(k,t.u_contrast_factor),u_spin_weights:new l.aN(k,t.u_spin_weights)}),symbolIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolSDF:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolTextAndIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texsize_icon:new l.aO(k,t.u_texsize_icon),u_texture:new l.aH(k,t.u_texture),u_texture_icon:new l.aH(k,t.u_texture_icon),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),background:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_color:new l.aL(k,t.u_color)}),backgroundPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_image:new l.aH(k,t.u_image),u_pattern_tl_a:new l.aO(k,t.u_pattern_tl_a),u_pattern_br_a:new l.aO(k,t.u_pattern_br_a),u_pattern_tl_b:new l.aO(k,t.u_pattern_tl_b),u_pattern_br_b:new l.aO(k,t.u_pattern_br_b),u_texsize:new l.aO(k,t.u_texsize),u_mix:new l.aI(k,t.u_mix),u_pattern_size_a:new l.aO(k,t.u_pattern_size_a),u_pattern_size_b:new l.aO(k,t.u_pattern_size_b),u_scale_a:new l.aI(k,t.u_scale_a),u_scale_b:new l.aI(k,t.u_scale_b),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(k,t.u_tile_units_to_pixels)}),terrain:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_ele_delta:new l.aI(k,t.u_ele_delta),u_fog_matrix:new l.aJ(k,t.u_fog_matrix),u_fog_color:new l.aL(k,t.u_fog_color),u_fog_ground_blend:new l.aI(k,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(k,t.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon_fog_blend:new l.aI(k,t.u_horizon_fog_blend)}),terrainDepth:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ele_delta:new l.aI(k,t.u_ele_delta)}),terrainCoords:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_terrain_coords_id:new l.aI(k,t.u_terrain_coords_id),u_ele_delta:new l.aI(k,t.u_ele_delta)}),sky:(k,t)=>({u_sky_color:new l.aL(k,t.u_sky_color),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon:new l.aI(k,t.u_horizon),u_sky_horizon_blend:new l.aI(k,t.u_sky_horizon_blend)})};class vs{constructor(t,h,_){this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ua{constructor(t,h,_,y){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,h){for(let _=0;_<this.attributes.length;_++){const y=h.attributes[this.attributes[_].name];y!==void 0&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,h,_){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],P=h.attributes[w.name];P!==void 0&&t.vertexAttribPointer(P,w.components,t[bc[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr=new WeakMap;function bs(k){var t;if(Lr.has(k))return Lr.get(k);{const h=(t=k.getParameter(k.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Lr.set(k,h),h}}class ri{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mr extends ri{getDefault(){return l.aM.transparent}set(t){const h=this.current;(t.r!==h.r||t.g!==h.g||t.b!==h.b||t.a!==h.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class jo extends ri{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Vo extends ri{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qo extends ri{getDefault(){return[!0,!0,!0,!0]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||t[2]!==h[2]||t[3]!==h[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends ri{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Go extends ri{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class au extends ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const h=this.current;(t.func!==h.func||t.ref!==h.ref||t.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ts extends ri{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||t[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ll extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=t,this.dirty=!1}}class lu extends ri{getDefault(){return[0,1]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class uu extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=t,this.dirty=!1}}class cu extends ri{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ko extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.BLEND):h.disable(h.BLEND),this.current=t,this.dirty=!1}}class hu extends ri{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class xc extends ri{getDefault(){return l.aM.transparent}set(t){const h=this.current;(t.r!==h.r||t.g!==h.g||t.b!==h.b||t.a!==h.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class fu extends ri{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class xs extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=t,this.dirty=!1}}class Hr extends ri{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ja extends ri{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class du extends ri{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class wc extends ri{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Va extends ri{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||t[2]!==h[2]||t[3]!==h[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ml extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class qa extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ga extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ns extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ya extends ri{getDefault(){return null}set(t){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Bi extends ri{getDefault(){return null}set(t){var h;if(t===this.current&&!this.dirty)return;const _=this.gl;bs(_)?_.bindVertexArray(t):(h=_.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Io extends ri{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Al extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Za extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class va extends ri{constructor(t,h){super(t),this.context=t,this.parent=h}getDefault(){return null}}class Ha extends va{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class qs extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pl extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kc{constructor(t,h,_,y,w){this.context=t,this.width=h,this.height=_;const P=t.gl,D=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new Ha(t,D),y)this.depthAttachment=w?new Pl(t,D):new qs(t,D);else if(w)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,h=this.colorAttachment.get();if(h&&t.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&t.deleteRenderbuffer(_)}t.deleteFramebuffer(this.framebuffer)}}class Di{constructor(t,h,_){this.blendFunction=t,this.blendColor=h,this.mask=_}}Di.Replace=[1,0],Di.disabled=new Di(Di.Replace,l.aM.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,l.aM.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,771],l.aM.transparent,[!0,!0,!0,!0]);class Ic{constructor(t){var h,_;if(this.gl=t,this.clearColor=new Mr(this),this.clearDepth=new jo(this),this.clearStencil=new Vo(this),this.colorMask=new qo(this),this.depthMask=new Cl(this),this.stencilMask=new Go(this),this.stencilFunc=new au(this),this.stencilOp=new ts(this),this.stencilTest=new Ll(this),this.depthRange=new lu(this),this.depthTest=new uu(this),this.depthFunc=new cu(this),this.blend=new ko(this),this.blendFunc=new hu(this),this.blendColor=new xc(this),this.blendEquation=new fu(this),this.cullFace=new xs(this),this.cullFaceSide=new Hr(this),this.frontFace=new ja(this),this.program=new du(this),this.activeTexture=new wc(this),this.viewport=new Va(this),this.bindFramebuffer=new Ml(this),this.bindRenderbuffer=new qa(this),this.bindTexture=new Ga(this),this.bindVertexBuffer=new ns(this),this.bindElementBuffer=new ya(this),this.bindVertexArray=new Bi(this),this.pixelStoreUnpack=new Io(this),this.pixelStoreUnpackPremultiplyAlpha=new Al(this),this.pixelStoreUnpackFlipY=new Za(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),bs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const y=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=t.RGBA16F)!==null&&h!==void 0?h:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(_=t.RGB16F)!==null&&_!==void 0?_:y==null?void 0:y.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const y=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,h){return new vs(this,t,h)}createVertexBuffer(t,h,_){return new Ua(this,t,h,_)}createRenderbuffer(t,h,_){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,t,h,_),this.bindRenderbuffer.set(null),w}createFramebuffer(t,h,_,y){return new kc(this,t,h,_,y)}clear({color:t,depth:h,stencil:_}){const y=this.gl;let w=0;t&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.aE(t.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return bs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var h;return bs(this.gl)?this.gl.deleteVertexArray(t):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Bn{constructor(t,h,_){this.func=t,this.mask=h,this.range=_}}Bn.ReadOnly=!1,Bn.ReadWrite=!0,Bn.disabled=new Bn(519,Bn.ReadOnly,[0,1]);const Wa=7680;class pi{constructor(t,h,_,y,w,P){this.test=t,this.ref=h,this.mask=_,this.fail=y,this.depthFail=w,this.pass=P}}pi.disabled=new pi({func:519,mask:0},0,0,Wa,Wa,Wa);class ci{constructor(t,h,_){this.enable=t,this.mode=h,this.frontFace=_}}let oo;function ba(k,t,h,_,y){const w=k.context,P=w.gl,D=k.useProgram("collisionBox"),z=[];let V=0,H=0;for(let Oe=0;Oe<_.length;Oe++){const qe=_[Oe],Ce=t.getTile(qe).getBucket(h);if(!Ce)continue;const Ze=y?Ce.textCollisionBox:Ce.iconCollisionBox,Ke=Ce.collisionCircleArray;if(Ke.length>0){const it=l.H();l.aQ(it,Ce.placementInvProjMatrix,k.transform.glCoordMatrix),l.aQ(it,it,Ce.placementViewportMatrix),z.push({circleArray:Ke,circleOffset:H,transform:qe.posMatrix,invTransform:it,coord:qe}),V+=Ke.length/4,H=V}Ze&&D.draw(w,P.LINES,Bn.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,{u_matrix:qe.posMatrix,u_pixel_extrude_scale:[1/(W=k.transform).width,1/W.height]},k.style.map.terrain&&k.style.map.terrain.getTerrainData(qe),h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,k.transform.zoom,null,null,Ze.collisionVertexBuffer)}var W;if(!y||!z.length)return;const ne=k.useProgram("collisionCircle"),ge=new l.aR;ge.resize(4*V),ge._trim();let ke=0;for(const Oe of z)for(let qe=0;qe<Oe.circleArray.length/4;qe++){const Ce=4*qe,Ze=Oe.circleArray[Ce+0],Ke=Oe.circleArray[Ce+1],it=Oe.circleArray[Ce+2],bt=Oe.circleArray[Ce+3];ge.emplace(ke++,Ze,Ke,it,bt,0),ge.emplace(ke++,Ze,Ke,it,bt,1),ge.emplace(ke++,Ze,Ke,it,bt,2),ge.emplace(ke++,Ze,Ke,it,bt,3)}(!oo||oo.length<2*V)&&(oo=function(Oe){const qe=2*Oe,Ce=new l.aT;Ce.resize(qe),Ce._trim();for(let Ze=0;Ze<qe;Ze++){const Ke=6*Ze;Ce.uint16[Ke+0]=4*Ze+0,Ce.uint16[Ke+1]=4*Ze+1,Ce.uint16[Ke+2]=4*Ze+2,Ce.uint16[Ke+3]=4*Ze+2,Ce.uint16[Ke+4]=4*Ze+3,Ce.uint16[Ke+5]=4*Ze+0}return Ce}(V));const Me=w.createIndexBuffer(oo,!0),Ne=w.createVertexBuffer(ge,l.aS.members,!0);for(const Oe of z){const qe=Vs(Oe.transform,Oe.invTransform,k.transform);ne.draw(w,P.TRIANGLES,Bn.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,qe,k.style.map.terrain&&k.style.map.terrain.getTerrainData(Oe.coord),h.id,Ne,Me,l.a0.simpleSegment(0,2*Oe.circleOffset,Oe.circleArray.length,Oe.circleArray.length/2),null,k.transform.zoom,null,null,null)}Ne.destroy(),Me.destroy()}ci.disabled=new ci(!1,1029,2305),ci.backCCW=new ci(!0,1029,2305);const Zo=l.an(new Float32Array(16));function Rl(k,t,h,_,y,w){const{horizontalAlign:P,verticalAlign:D}=l.au(k);return new l.P((-(P-.5)*t/y+_[0])*w,(-(D-.5)*h/y+_[1])*w)}function So(k,t,h,_,y,w){const P=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let D=_.mult(w);h||(D=D.rotate(-y));const z=P.add(D);return Ae(z.x,z.y,t.labelPlaneMatrix,t.getElevation).point}if(h){const D=et(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(k),z=Math.atan(D.y/D.x)+(D.x<0?Math.PI:0);return k.add(_.rotate(z))}return k.add(_)}function Ho(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge){const ke=k.text.placedSymbolArray,Me=k.text.dynamicLayoutVertexArray,Ne=k.icon.dynamicLayoutVertexArray,Oe={};Me.clear();for(let qe=0;qe<ke.length;qe++){const Ce=ke.get(qe),Ze=Ce.hidden||!Ce.crossTileID||k.allowVerticalPlacement&&!Ce.placedOrientation?null:_[Ce.crossTileID];if(Ze){const Ke=new l.P(Ce.anchorX,Ce.anchorY),it={getElevation:ge,width:y.width,height:y.height,labelPlaneMatrix:w,lineVertexArray:null,pitchWithMap:h,projection:H,projectionCache:null,tileAnchorPoint:Ke,translation:W,unwrappedTileID:ne},bt=h?Ae(Ke.x,Ke.y,P,ge):et(Ke.x,Ke.y,it),Rt=Q(y.cameraToCenterDistance,bt.signedDistanceFromCamera);let Ht=l.ai(k.textSizeData,z,Ce)*Rt/l.ap;h&&(Ht*=k.tilePixelRatio/D);const{width:Yt,height:jt,anchor:Ut,textOffset:rn,textBoxScale:Tn}=Ze,qt=Rl(Ut,Yt,jt,rn,Tn,Ht),Xt=H.getPitchedTextCorrection(y,Ke.add(new l.P(W[0],W[1])),ne),In=So(bt.point,it,t,qt,y.angle,Xt),Si=k.allowVerticalPlacement&&Ce.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let On=0;On<Ce.numGlyphs;On++)l.aj(Me,In,Si);V&&Ce.associatedIconIndex>=0&&(Oe[Ce.associatedIconIndex]={shiftedAnchor:In,angle:Si})}else an(Ce.numGlyphs,Me)}if(V){Ne.clear();const qe=k.icon.placedSymbolArray;for(let Ce=0;Ce<qe.length;Ce++){const Ze=qe.get(Ce);if(Ze.hidden)an(Ze.numGlyphs,Ne);else{const Ke=Oe[Ce];if(Ke)for(let it=0;it<Ze.numGlyphs;it++)l.aj(Ne,Ke.shiftedAnchor,Ke.angle);else an(Ze.numGlyphs,Ne)}}k.icon.dynamicLayoutVertexBuffer.updateData(Ne)}k.text.dynamicLayoutVertexBuffer.updateData(Me)}function is(k,t,h){return h.iconsInText&&t?"symbolTextAndIcon":k?"symbolSDF":"symbolIcon"}function Dl(k,t,h,_,y,w,P,D,z,V,H,W){const ne=k.context,ge=ne.gl,ke=k.transform,Me=Kr(),Ne=D==="map",Oe=z==="map",qe=D!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ce=Ne&&!Oe&&!qe,Ze=!Oe&&qe,Ke=!h.layout.get("symbol-sort-key").isConstant();let it=!1;const bt=k.depthModeForSublayer(0,Bn.ReadOnly),Rt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ht=[],Yt=Me.getCircleRadiusCorrection(ke);for(const jt of _){const Ut=t.getTile(jt),rn=Ut.getBucket(h);if(!rn)continue;const Tn=y?rn.text:rn.icon;if(!Tn||!Tn.segments.get().length||!Tn.hasVisibleVertices)continue;const qt=Tn.programConfigurations.get(h.id),Xt=y||rn.sdfIcons,In=y?rn.textSizeData:rn.iconSizeData,Si=Oe||ke.pitch!==0,On=k.useProgram(is(Xt,y,rn),qt),jn=l.ag(In,ke.zoom),Ei=k.style.map.terrain&&k.style.map.terrain.getTerrainData(jt);let Nr,Hs,Ti,ss,Wr=[0,0],zr=null;if(y)Hs=Ut.glyphAtlasTexture,Ti=ge.LINEAR,Nr=Ut.glyphAtlasTexture.size,rn.iconsInText&&(Wr=Ut.imageAtlasTexture.size,zr=Ut.imageAtlasTexture,ss=Si||k.options.rotating||k.options.zooming||In.kind==="composite"||In.kind==="camera"?ge.LINEAR:ge.NEAREST);else{const Gn=h.layout.get("icon-size").constantOr(0)!==1||rn.iconsNeedLinear;Hs=Ut.imageAtlasTexture,Ti=Xt||k.options.rotating||k.options.zooming||Gn||Si?ge.LINEAR:ge.NEAREST,Nr=Ut.imageAtlasTexture.size}const Xr=Fn(Ut,1,k.transform.zoom),ho=Ze?jt.posMatrix:Zo,tl=Ki(ho,Oe,Ne,k.transform,Xr),ku=Zr(ho,Oe,Ne,k.transform,Xr),nl=Zr(jt.posMatrix,Oe,Ne,k.transform,Xr),zs=Me.translatePosition(k.transform,Ut,w,P),Iu=Rt&&rn.hasTextData(),qc=h.layout.get("icon-text-fit")!=="none"&&Iu&&rn.hasIconData();if(qe){const Gn=k.style.map.terrain?(il,rl)=>k.style.map.terrain.getElevation(jt,il,rl):null,Ia=h.layout.get("text-rotation-alignment")==="map";he(rn,jt.posMatrix,k,y,tl,nl,Oe,V,Ia,Me,jt.toUnwrapped(),ke.width,ke.height,zs,Gn)}const Os=jt.posMatrix,Fs=y&&Rt||qc,Qo=qe||Fs?Zo:tl,Ws=ku,Pr=Xt&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Or;Or=Xt?rn.iconsInText?hr(In.kind,jn,Ce,Oe,qe,Fs,k,Os,Qo,Ws,zs,Nr,Wr,Yt):Uo(In.kind,jn,Ce,Oe,qe,Fs,k,Os,Qo,Ws,zs,y,Nr,!0,Yt):Bo(In.kind,jn,Ce,Oe,qe,Fs,k,Os,Qo,Ws,zs,y,Nr,Yt);const Ss={program:On,buffers:Tn,uniformValues:Or,atlasTexture:Hs,atlasTextureIcon:zr,atlasInterpolation:Ti,atlasInterpolationIcon:ss,isSDF:Xt,hasHalo:Pr};if(Ke&&rn.canOverlap){it=!0;const Gn=Tn.segments.get();for(const Ia of Gn)Ht.push({segments:new l.a0([Ia]),sortKey:Ia.sortKey,state:Ss,terrainData:Ei})}else Ht.push({segments:Tn.segments,sortKey:0,state:Ss,terrainData:Ei})}it&&Ht.sort((jt,Ut)=>jt.sortKey-Ut.sortKey);for(const jt of Ht){const Ut=jt.state;if(ne.activeTexture.set(ge.TEXTURE0),Ut.atlasTexture.bind(Ut.atlasInterpolation,ge.CLAMP_TO_EDGE),Ut.atlasTextureIcon&&(ne.activeTexture.set(ge.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,ge.CLAMP_TO_EDGE)),Ut.isSDF){const rn=Ut.uniformValues;Ut.hasHalo&&(rn.u_is_halo=1,Nl(Ut.buffers,jt.segments,h,k,Ut.program,bt,H,W,rn,jt.terrainData)),rn.u_is_halo=0}Nl(Ut.buffers,jt.segments,h,k,Ut.program,bt,H,W,Ut.uniformValues,jt.terrainData)}}function Nl(k,t,h,_,y,w,P,D,z,V){const H=_.context;y.draw(H,H.gl.TRIANGLES,w,P,D,ci.disabled,z,V,h.id,k.layoutVertexBuffer,k.indexBuffer,t,h.paint,_.transform.zoom,k.programConfigurations.get(h.id),k.dynamicLayoutVertexBuffer,k.opacityVertexBuffer)}function zl(k,t,h,_){const y=k.context,w=y.gl,P=pi.disabled,D=new Di([w.ONE,w.ONE],l.aM.transparent,[!0,!0,!0,!0]),z=t.getBucket(h);if(!z)return;const V=_.key;let H=h.heatmapFbos.get(V);H||(H=Wo(y,t.tileSize,t.tileSize),h.heatmapFbos.set(V,H)),y.bindFramebuffer.set(H.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:l.aM.transparent});const W=z.programConfigurations.get(h.id),ne=k.useProgram("heatmap",W),ge=k.style.map.terrain.getTerrainData(_);ne.draw(y,w.TRIANGLES,Bn.disabled,P,D,ci.disabled,cr(_.posMatrix,t,k.transform.zoom,h.paint.get("heatmap-intensity")),ge,h.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,h.paint,k.transform.zoom,W)}function ao(k,t,h){const _=k.context,y=_.gl;_.setColorMode(k.colorModeForRenderPass());const w=Xo(_,t),P=h.key,D=t.heatmapFbos.get(P);D&&(_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,D.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1),w.bind(y.LINEAR,y.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(_,y.TRIANGLES,Bn.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,Oa(k,t,0,1),null,t.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments,t.paint,k.transform.zoom),D.destroy(),t.heatmapFbos.delete(P))}function Wo(k,t,h){var _,y;const w=k.gl,P=w.createTexture();w.bindTexture(w.TEXTURE_2D,P),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const D=(_=k.HALF_FLOAT)!==null&&_!==void 0?_:w.UNSIGNED_BYTE,z=(y=k.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,z,t,h,0,w.RGBA,D,null);const V=k.createFramebuffer(t,h,!1,!1);return V.colorAttachment.set(P),V}function Xo(k,t){return t.colorRampTexture||(t.colorRampTexture=new we(k,t.colorRamp,k.gl.RGBA)),t.colorRampTexture}function $o(k,t,h,_,y){if(!h||!_||!_.imageAtlas)return;const w=_.imageAtlas.patternPositions;let P=w[h.to.toString()],D=w[h.from.toString()];if(!P&&D&&(P=D),!D&&P&&(D=P),!P||!D){const z=y.getPaintProperty(t);P=w[z],D=w[z]}P&&D&&k.setConstantPatternPositions(P,D)}function Yo(k,t,h,_,y,w,P){const D=k.context.gl,z="fill-pattern",V=h.paint.get(z),H=V&&V.constantOr(1),W=h.getCrossfadeParameters();let ne,ge,ke,Me,Ne;P?(ge=H&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=D.LINES):(ge=H?"fillPattern":"fill",ne=D.TRIANGLES);const Oe=V.constantOr(null);for(const qe of _){const Ce=t.getTile(qe);if(H&&!Ce.patternsLoaded())continue;const Ze=Ce.getBucket(h);if(!Ze)continue;const Ke=Ze.programConfigurations.get(h.id),it=k.useProgram(ge,Ke),bt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(qe);H&&(k.context.activeTexture.set(D.TEXTURE0),Ce.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ke.updatePaintBuffers(W)),$o(Ke,z,Oe,Ce,h);const Rt=bt?qe:null,Ht=k.translatePosMatrix(Rt?Rt.posMatrix:qe.posMatrix,Ce,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(P){Me=Ze.indexBuffer2,Ne=Ze.segments2;const Yt=[D.drawingBufferWidth,D.drawingBufferHeight];ke=ge==="fillOutlinePattern"&&H?so(Ht,k,W,Ce,Yt):ki(Ht,Yt)}else Me=Ze.indexBuffer,Ne=Ze.segments,ke=H?za(Ht,k,W,Ce):Oo(Ht);it.draw(k.context,ne,y,k.stencilModeForClipping(qe),w,ci.disabled,ke,bt,h.id,Ze.layoutVertexBuffer,Me,Ne,h.paint,k.transform.zoom,Ke)}}function Jo(k,t,h,_,y,w,P){const D=k.context,z=D.gl,V="fill-extrusion-pattern",H=h.paint.get(V),W=H.constantOr(1),ne=h.getCrossfadeParameters(),ge=h.paint.get("fill-extrusion-opacity"),ke=H.constantOr(null);for(const Me of _){const Ne=t.getTile(Me),Oe=Ne.getBucket(h);if(!Oe)continue;const qe=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Me),Ce=Oe.programConfigurations.get(h.id),Ze=k.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Ce);W&&(k.context.activeTexture.set(z.TEXTURE0),Ne.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ce.updatePaintBuffers(ne)),$o(Ce,V,ke,Ne,h);const Ke=k.translatePosMatrix(Me.posMatrix,Ne,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),it=h.paint.get("fill-extrusion-vertical-gradient"),bt=W?da(Ke,k,it,ge,Me,ne,Ne):fa(Ke,k,it,ge);Ze.draw(D,D.gl.TRIANGLES,y,w,P,ci.backCCW,bt,qe,h.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,h.paint,k.transform.zoom,Ce,k.style.map.terrain&&Oe.centroidVertexBuffer)}}function Ko(k,t,h,_,y,w,P){const D=k.context,z=D.gl,V=h.fbo;if(!V)return;const H=k.useProgram("hillshade"),W=k.style.map.terrain&&k.style.map.terrain.getTerrainData(t);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,V.colorAttachment.get()),H.draw(D,z.TRIANGLES,y,w,P,ci.disabled,((ne,ge,ke,Me)=>{const Ne=ke.paint.get("hillshade-shadow-color"),Oe=ke.paint.get("hillshade-highlight-color"),qe=ke.paint.get("hillshade-accent-color");let Ce=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ce-=ne.transform.angle);const Ze=!ne.options.moving;return{u_matrix:Me?Me.posMatrix:ne.transform.calculatePosMatrix(ge.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:Fa(0,ge.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Ce],u_shadow:Ne,u_highlight:Oe,u_accent:qe}})(k,h,_,W?t:null),W,_.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}function Eo(k,t,h,_,y,w){const P=k.context,D=P.gl,z=t.dem;if(z&&z.data){const V=z.dim,H=z.stride,W=z.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||k.getTileTexture(H),t.demTexture){const ge=t.demTexture;ge.update(W,{premultiply:!1}),ge.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else t.demTexture=new we(P,W,D.RGBA,{premultiply:!1}),t.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);let ne=t.fbo;if(!ne){const ge=new we(P,{width:V,height:V,data:null},D.RGBA);ge.bind(D.LINEAR,D.CLAMP_TO_EDGE),ne=t.fbo=P.createFramebuffer(V,V,!0,!1),ne.colorAttachment.set(ge.texture)}P.bindFramebuffer.set(ne.framebuffer),P.viewport.set([0,0,V,V]),k.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,_,y,w,ci.disabled,((ge,ke)=>{const Me=ke.stride,Ne=l.H();return l.aP(Ne,0,l.X,-l.X,0,0,1),l.J(Ne,Ne,[0,-l.X,0]),{u_matrix:Ne,u_image:1,u_dimension:[Me,Me],u_zoom:ge.overscaledZ,u_unpack:ke.getUnpackVector()}})(t.tileID,z),null,h.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ol(k,t,h,_,y,w){const P=_.paint.get("raster-fade-duration");if(!w&&P>0){const D=L.now(),z=(D-k.timeAdded)/P,V=t?(D-t.timeAdded)/P:-1,H=h.getSource(),W=y.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ne=!t||Math.abs(t.tileID.overscaledZ-W)>Math.abs(k.tileID.overscaledZ-W),ge=ne&&k.refreshedUponExpiration?1:l.ac(ne?z:1-V,0,1);return k.refreshedUponExpiration&&z>=1&&(k.refreshedUponExpiration=!1),t?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}const Fl=new l.aM(1,0,0,1),$n=new l.aM(0,1,0,1),Gs=new l.aM(0,0,1,1),Sc=new l.aM(1,0,1,1),Bl=new l.aM(0,1,1,1);function fr(k,t,h,_){I(k,0,t+h/2,k.transform.width,h,_)}function ws(k,t,h,_){I(k,t-h/2,0,h,k.transform.height,_)}function I(k,t,h,_,y,w){const P=k.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*k.pixelRatio,h*k.pixelRatio,_*k.pixelRatio,y*k.pixelRatio),P.clear({color:w}),D.disable(D.SCISSOR_TEST)}function c(k,t,h){const _=k.context,y=_.gl,w=h.posMatrix,P=k.useProgram("debug"),D=Bn.disabled,z=pi.disabled,V=k.colorModeForRenderPass(),H="$debug",W=k.style.map.terrain&&k.style.map.terrain.getTerrainData(h);_.activeTexture.set(y.TEXTURE0);const ne=t.getTileByID(h.key).latestRawTileData,ge=Math.floor((ne&&ne.byteLength||0)/1024),ke=t.getTile(h).tileSize,Me=512/Math.min(ke,512)*(h.overscaledZ/k.transform.zoom)*.5;let Ne=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ne+=` => ${h.overscaledZ}`),function(Oe,qe){Oe.initDebugOverlayCanvas();const Ce=Oe.debugOverlayCanvas,Ze=Oe.context.gl,Ke=Oe.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Ce.width,Ce.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(qe,5,5),Ke.strokeText(qe,5,5),Oe.debugOverlayTexture.update(Ce),Oe.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(k,`${Ne} ${ge}kB`),P.draw(_,y.TRIANGLES,D,z,Di.alphaBlended,ci.disabled,yr(w,l.aM.transparent,Me),null,H,k.debugBuffer,k.quadTriangleIndexBuffer,k.debugSegments),P.draw(_,y.LINE_STRIP,D,z,V,ci.disabled,yr(w,l.aM.red),W,H,k.debugBuffer,k.tileBorderIndexBuffer,k.debugSegments)}function d(k,t,h){const _=k.context,y=_.gl,w=k.colorModeForRenderPass(),P=new Bn(y.LEQUAL,Bn.ReadWrite,k.depthRangeFor3D),D=k.useProgram("terrain"),z=t.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,k.width,k.height]);for(const V of h){const H=k.renderToTexture.getTexture(V),W=t.getTerrainData(V.tileID);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,H.texture);const ne=k.transform.calculatePosMatrix(V.tileID.toUnwrapped()),ge=t.getMeshFrameDelta(k.transform.zoom),ke=k.transform.calculateFogMatrix(V.tileID.toUnwrapped()),Me=El(ne,ge,ke,k.style.sky,k.transform.pitch);D.draw(_,y.TRIANGLES,P,pi.disabled,w,ci.backCCW,Me,W,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}class p{constructor(t,h,_){this.vertexBuffer=t,this.indexBuffer=h,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class b{constructor(t,h){this.context=new Ic(t),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Tt.maxUnderzooming+Tt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zo}resize(t,h,_){if(this.width=Math.floor(t*_),this.height=Math.floor(h*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const t=this.context,h=new l.aX;h.emplaceBack(0,0),h.emplaceBack(l.X,0),h.emplaceBack(0,l.X),h.emplaceBack(l.X,l.X),this.tileExtentBuffer=t.createVertexBuffer(h,es.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const _=new l.aX;_.emplaceBack(0,0),_.emplaceBack(l.X,0),_.emplaceBack(0,l.X),_.emplaceBack(l.X,l.X),this.debugBuffer=t.createVertexBuffer(_,es.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const y=new l.$;y.emplaceBack(0,0,0,0),y.emplaceBack(l.X,0,l.X,0),y.emplaceBack(0,l.X,0,l.X),y.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=t.createVertexBuffer(y,Kn.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const w=new l.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,es.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const P=new l.aZ;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(P);const D=new l.aY;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const z=this.context.gl;this.stencilClearMode=new pi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const t=this.context,h=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=l.H();l.aP(_,0,this.width,this.height,0,0,1),l.K(_,_,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,h.TRIANGLES,Bn.disabled,this.stencilClearMode,Di.disabled,ci.disabled,bi(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,h){if(this.currentStencilSource===t.source||!t.isTileClipped()||!h||!h.length)return;this.currentStencilSource=t.source;const _=this.context,y=_.gl;this.nextStencilID+h.length>256&&this.clearStencil(),_.setColorMode(Di.disabled),_.setDepthMode(Bn.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of h){const D=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);w.draw(_,y.TRIANGLES,Bn.disabled,new pi({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),Di.disabled,ci.disabled,bi(P.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,h=this.context.gl;return new pi({func:h.NOTEQUAL,mask:255},t,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(t){const h=this.context.gl;return new pi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(t){const h=this.context.gl,_=t.sort((P,D)=>D.overscaledZ-P.overscaledZ),y=_[_.length-1].overscaledZ,w=_[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const P={};for(let D=0;D<w;D++)P[D+y]=new pi({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[P,_]}return[{[y]:pi.disabled},_]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Di([t.CONSTANT_COLOR,t.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Di.unblended:Di.alphaBlended}depthModeForSublayer(t,h,_){if(!this.opaquePassEnabledForLayer())return Bn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Bn(_||this.context.gl.LEQUAL,h,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,h){this.style=t,this.options=h,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(L.now()),this.imageManager.beginFrame();const _=this.style._order,y=this.style.sourceCaches,w={},P={},D={};for(const z in y){const V=y[z];V.used&&V.prepare(this.context),w[z]=V.getVisibleCoordinates(),P[z]=w[z].slice().reverse(),D[z]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of _){const V=this.style._layers[z];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const H=P[V.source];(V.type==="custom"||H.length)&&this.renderLayer(this,y[V.source],V,H)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,V){const H=z.context,W=H.gl,ne=((Oe,qe,Ce)=>({u_sky_color:Oe.properties.get("sky-color"),u_horizon_color:Oe.properties.get("horizon-color"),u_horizon:(qe.height/2+qe.getHorizon())*Ce,u_sky_horizon_blend:Oe.properties.get("sky-horizon-blend")*qe.height/2*Ce}))(V,z.style.map.transform,z.pixelRatio),ge=new Bn(W.LEQUAL,Bn.ReadWrite,[0,1]),ke=pi.disabled,Me=z.colorModeForRenderPass(),Ne=z.useProgram("sky");if(!V.mesh){const Oe=new l.aX;Oe.emplaceBack(-1,-1),Oe.emplaceBack(1,-1),Oe.emplaceBack(1,1),Oe.emplaceBack(-1,1);const qe=new l.aY;qe.emplaceBack(0,1,2),qe.emplaceBack(0,2,3),V.mesh=new p(H.createVertexBuffer(Oe,es.members),H.createIndexBuffer(qe),l.a0.simpleSegment(0,0,Oe.length,qe.length))}Ne.draw(H,W.TRIANGLES,ge,ke,Me,ci.disabled,ne,void 0,"sky",V.mesh.vertexBuffer,V.mesh.indexBuffer,V.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],V=y[z.source],H=w[z.source];this._renderTileClippingMasks(z,H),this.renderLayer(this,V,z,H)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],V=y[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z))continue;const H=(z.type==="symbol"?D:P)[z.source];this._renderTileClippingMasks(z,w[z.source]),this.renderLayer(this,V,z,H)}if(this.options.showTileBoundaries){const z=function(V,H){let W=null;const ne=Object.values(V._layers).flatMap(Ne=>Ne.source&&!Ne.isHidden(H)?[V.sourceCaches[Ne.source]]:[]),ge=ne.filter(Ne=>Ne.getSource().type==="vector"),ke=ne.filter(Ne=>Ne.getSource().type!=="vector"),Me=Ne=>{(!W||W.getSource().maxzoom<Ne.getSource().maxzoom)&&(W=Ne)};return ge.forEach(Ne=>Me(Ne)),W||ke.forEach(Ne=>Me(Ne)),W}(this.style,this.transform.zoom);z&&function(V,H,W){for(let ne=0;ne<W.length;ne++)c(V,H,W[ne])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const V=z.transform.padding;fr(z,z.transform.height-(V.top||0),3,Fl),fr(z,V.bottom||0,3,$n),ws(z,V.left||0,3,Gs),ws(z,z.transform.width-(V.right||0),3,Sc);const H=z.transform.centerPoint;(function(W,ne,ge,ke){I(W,ne-1,ge-10,2,20,ke),I(W,ne-10,ge-1,20,2,ke)})(z,H.x,z.transform.height-H.y,Bl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=t?!l.a_(h,_):!l.a$(h,_)),y||(y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),y&&(l.b0(h,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,P){const D=w.context,z=D.gl,V=Di.unblended,H=new Bn(z.LEQUAL,Bn.ReadWrite,[0,1]),W=P.getTerrainMesh(),ne=P.sourceCache.getRenderableTiles(),ge=w.useProgram("terrainDepth");D.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1});for(const ke of ne){const Me=P.getTerrainData(ke.tileID),Ne={u_matrix:w.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(w.transform.zoom)};ge.draw(D,z.TRIANGLES,H,pi.disabled,V,ci.backCCW,Ne,Me,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,P){const D=w.context,z=D.gl,V=Di.unblended,H=new Bn(z.LEQUAL,Bn.ReadWrite,[0,1]),W=P.getTerrainMesh(),ne=P.getCoordsTexture(),ge=P.sourceCache.getRenderableTiles(),ke=w.useProgram("terrainCoords");D.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1}),P.coordsIndex=[];for(const Me of ge){const Ne=P.getTerrainData(Me.tileID);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ne.texture);const Oe={u_matrix:w.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(w.transform.zoom)};ke.draw(D,z.TRIANGLES,H,pi.disabled,V,ci.backCCW,Oe,Ne,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),P.coordsIndex.push(Me.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(t,h,_,y){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(y||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(w,P,D,z,V){if(w.renderPass!=="translucent")return;const H=pi.disabled,W=w.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,ge,ke,Me,Ne,Oe,qe,Ce,Ze){const Ke=ge.transform,it=Kr(),bt=Ne==="map",Rt=Oe==="map";for(const Ht of ne){const Yt=Me.getTile(Ht),jt=Yt.getBucket(ke);if(!jt||!jt.text||!jt.text.segments.get().length)continue;const Ut=l.ag(jt.textSizeData,Ke.zoom),rn=Fn(Yt,1,ge.transform.zoom),Tn=Ki(Ht.posMatrix,Rt,bt,ge.transform,rn),qt=ke.layout.get("icon-text-fit")!=="none"&&jt.hasIconData();if(Ut){const Xt=Math.pow(2,Ke.zoom-Yt.tileID.overscaledZ),In=ge.style.map.terrain?(On,jn)=>ge.style.map.terrain.getElevation(Ht,On,jn):null,Si=it.translatePosition(Ke,Yt,qe,Ce);Ho(jt,bt,Rt,Ze,Ke,Tn,Ht.posMatrix,Xt,Ut,qt,it,Si,Ht.toUnwrapped(),In)}}}(z,w,D,P,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),V),D.paint.get("icon-opacity").constantOr(1)!==0&&Dl(w,P,D,z,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),H,W),D.paint.get("text-opacity").constantOr(1)!==0&&Dl(w,P,D,z,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),H,W),P.map.showCollisionBoxes&&(ba(w,P,D,z,!0),ba(w,P,D,z,!1))})(t,h,_,y,this.style.placement.variableOffsets);break;case"circle":(function(w,P,D,z){if(w.renderPass!=="translucent")return;const V=D.paint.get("circle-opacity"),H=D.paint.get("circle-stroke-width"),W=D.paint.get("circle-stroke-opacity"),ne=!D.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&(H.constantOr(1)===0||W.constantOr(1)===0))return;const ge=w.context,ke=ge.gl,Me=w.depthModeForSublayer(0,Bn.ReadOnly),Ne=pi.disabled,Oe=w.colorModeForRenderPass(),qe=[];for(let Ce=0;Ce<z.length;Ce++){const Ze=z[Ce],Ke=P.getTile(Ze),it=Ke.getBucket(D);if(!it)continue;const bt=it.programConfigurations.get(D.id),Rt=w.useProgram("circle",bt),Ht=it.layoutVertexBuffer,Yt=it.indexBuffer,jt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ze),Ut={programConfiguration:bt,program:Rt,layoutVertexBuffer:Ht,indexBuffer:Yt,uniformValues:vc(w,Ze,Ke,D),terrainData:jt};if(ne){const rn=it.segments.get();for(const Tn of rn)qe.push({segments:new l.a0([Tn]),sortKey:Tn.sortKey,state:Ut})}else qe.push({segments:it.segments,sortKey:0,state:Ut})}ne&&qe.sort((Ce,Ze)=>Ce.sortKey-Ze.sortKey);for(const Ce of qe){const{programConfiguration:Ze,program:Ke,layoutVertexBuffer:it,indexBuffer:bt,uniformValues:Rt,terrainData:Ht}=Ce.state;Ke.draw(ge,ke.TRIANGLES,Me,Ne,Oe,ci.disabled,Rt,Ht,D.id,it,bt,Ce.segments,D.paint,w.transform.zoom,Ze)}})(t,h,_,y);break;case"heatmap":(function(w,P,D,z){if(D.paint.get("heatmap-opacity")===0)return;const V=w.context;if(w.style.map.terrain){for(const H of z){const W=P.getTile(H);P.hasRenderableParent(H)||(w.renderPass==="offscreen"?zl(w,W,D,H):w.renderPass==="translucent"&&ao(w,D,H))}V.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(H,W,ne,ge){const ke=H.context,Me=ke.gl,Ne=pi.disabled,Oe=new Di([Me.ONE,Me.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(qe,Ce,Ze){const Ke=qe.gl;qe.activeTexture.set(Ke.TEXTURE1),qe.viewport.set([0,0,Ce.width/4,Ce.height/4]);let it=Ze.heatmapFbos.get(l.aU);it?(Ke.bindTexture(Ke.TEXTURE_2D,it.colorAttachment.get()),qe.bindFramebuffer.set(it.framebuffer)):(it=Wo(qe,Ce.width/4,Ce.height/4),Ze.heatmapFbos.set(l.aU,it))})(ke,H,ne),ke.clear({color:l.aM.transparent});for(let qe=0;qe<ge.length;qe++){const Ce=ge[qe];if(W.hasRenderableParent(Ce))continue;const Ze=W.getTile(Ce),Ke=Ze.getBucket(ne);if(!Ke)continue;const it=Ke.programConfigurations.get(ne.id),bt=H.useProgram("heatmap",it),{zoom:Rt}=H.transform;bt.draw(ke,Me.TRIANGLES,Bn.disabled,Ne,Oe,ci.disabled,cr(Ce.posMatrix,Ze,Rt,ne.paint.get("heatmap-intensity")),null,ne.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,ne.paint,H.transform.zoom,it)}ke.viewport.set([0,0,H.width,H.height])}(w,P,D,z):w.renderPass==="translucent"&&function(H,W){const ne=H.context,ge=ne.gl;ne.setColorMode(H.colorModeForRenderPass());const ke=W.heatmapFbos.get(l.aU);ke&&(ne.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,ke.colorAttachment.get()),ne.activeTexture.set(ge.TEXTURE1),Xo(ne,W).bind(ge.LINEAR,ge.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(ne,ge.TRIANGLES,Bn.disabled,pi.disabled,H.colorModeForRenderPass(),ci.disabled,Oa(H,W,0,1),null,W.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,W.paint,H.transform.zoom))}(w,D)})(t,h,_,y);break;case"line":(function(w,P,D,z){if(w.renderPass!=="translucent")return;const V=D.paint.get("line-opacity"),H=D.paint.get("line-width");if(V.constantOr(1)===0||H.constantOr(1)===0)return;const W=w.depthModeForSublayer(0,Bn.ReadOnly),ne=w.colorModeForRenderPass(),ge=D.paint.get("line-dasharray"),ke=D.paint.get("line-pattern"),Me=ke.constantOr(1),Ne=D.paint.get("line-gradient"),Oe=D.getCrossfadeParameters(),qe=Me?"linePattern":ge?"lineSDF":Ne?"lineGradient":"line",Ce=w.context,Ze=Ce.gl;let Ke=!0;for(const it of z){const bt=P.getTile(it);if(Me&&!bt.patternsLoaded())continue;const Rt=bt.getBucket(D);if(!Rt)continue;const Ht=Rt.programConfigurations.get(D.id),Yt=w.context.program.get(),jt=w.useProgram(qe,Ht),Ut=Ke||jt.program!==Yt,rn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(it),Tn=ke.constantOr(null);if(Tn&&bt.imageAtlas){const In=bt.imageAtlas,Si=In.patternPositions[Tn.to.toString()],On=In.patternPositions[Tn.from.toString()];Si&&On&&Ht.setConstantPatternPositions(Si,On)}const qt=rn?it:null,Xt=Me?Fo(w,bt,D,Oe,qt):ge?su(w,bt,D,ge,Oe,qt):Ne?ma(w,bt,D,Rt.lineClipsArray.length,qt):pa(w,bt,D,qt);if(Me)Ce.activeTexture.set(Ze.TEXTURE0),bt.imageAtlasTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),Ht.updatePaintBuffers(Oe);else if(ge&&(Ut||w.lineAtlas.dirty))Ce.activeTexture.set(Ze.TEXTURE0),w.lineAtlas.bind(Ce);else if(Ne){const In=Rt.gradients[D.id];let Si=In.texture;if(D.gradientVersion!==In.version){let On=256;if(D.stepInterpolant){const jn=P.getSource().maxzoom,Ei=it.canonical.z===jn?Math.ceil(1<<w.transform.maxZoom-it.canonical.z):1;On=l.ac(l.aV(Rt.maxLineLength/l.X*1024*Ei),256,Ce.maxTextureSize)}In.gradient=l.aW({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:On,image:In.gradient||void 0,clips:Rt.lineClipsArray}),In.texture?In.texture.update(In.gradient):In.texture=new we(Ce,In.gradient,Ze.RGBA),In.version=D.gradientVersion,Si=In.texture}Ce.activeTexture.set(Ze.TEXTURE0),Si.bind(D.stepInterpolant?Ze.NEAREST:Ze.LINEAR,Ze.CLAMP_TO_EDGE)}jt.draw(Ce,Ze.TRIANGLES,W,w.stencilModeForClipping(it),ne,ci.disabled,Xt,rn,D.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,D.paint,w.transform.zoom,Ht,Rt.layoutVertexBuffer2),Ke=!1}})(t,h,_,y);break;case"fill":(function(w,P,D,z){const V=D.paint.get("fill-color"),H=D.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const W=w.colorModeForRenderPass(),ne=D.paint.get("fill-pattern"),ge=w.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&V.constantOr(l.aM.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===ge){const ke=w.depthModeForSublayer(1,w.renderPass==="opaque"?Bn.ReadWrite:Bn.ReadOnly);Yo(w,P,D,z,ke,W,!1)}if(w.renderPass==="translucent"&&D.paint.get("fill-antialias")){const ke=w.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,Bn.ReadOnly);Yo(w,P,D,z,ke,W,!0)}})(t,h,_,y);break;case"fill-extrusion":(function(w,P,D,z){const V=D.paint.get("fill-extrusion-opacity");if(V!==0&&w.renderPass==="translucent"){const H=new Bn(w.context.gl.LEQUAL,Bn.ReadWrite,w.depthRangeFor3D);if(V!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Jo(w,P,D,z,H,pi.disabled,Di.disabled),Jo(w,P,D,z,H,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const W=w.colorModeForRenderPass();Jo(w,P,D,z,H,pi.disabled,W)}}})(t,h,_,y);break;case"hillshade":(function(w,P,D,z){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const V=w.context,H=w.depthModeForSublayer(0,Bn.ReadOnly),W=w.colorModeForRenderPass(),[ne,ge]=w.renderPass==="translucent"?w.stencilConfigForOverlap(z):[{},z];for(const ke of ge){const Me=P.getTile(ke);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&w.renderPass==="offscreen"?Eo(w,Me,D,H,pi.disabled,W):w.renderPass==="translucent"&&Ko(w,ke,Me,D,H,ne[ke.overscaledZ],W)}V.viewport.set([0,0,w.width,w.height])})(t,h,_,y);break;case"raster":(function(w,P,D,z){if(w.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!z.length)return;const V=w.context,H=V.gl,W=P.getSource(),ne=w.useProgram("raster"),ge=w.colorModeForRenderPass(),[ke,Me]=W instanceof Yi?[{},z]:w.stencilConfigForOverlap(z),Ne=Me[Me.length-1].overscaledZ,Oe=!w.options.moving;for(const qe of Me){const Ce=w.depthModeForSublayer(qe.overscaledZ-Ne,D.paint.get("raster-opacity")===1?Bn.ReadWrite:Bn.ReadOnly,H.LESS),Ze=P.getTile(qe);Ze.registerFadeDuration(D.paint.get("raster-fade-duration"));const Ke=P.findLoadedParent(qe,0),it=P.findLoadedSibling(qe),bt=Ol(Ze,Ke||it||null,P,D,w.transform,w.style.map.terrain);let Rt,Ht;const Yt=D.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;V.activeTexture.set(H.TEXTURE0),Ze.texture.bind(Yt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),V.activeTexture.set(H.TEXTURE1),Ke?(Ke.texture.bind(Yt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Rt=Math.pow(2,Ke.tileID.overscaledZ-Ze.tileID.overscaledZ),Ht=[Ze.tileID.canonical.x*Rt%1,Ze.tileID.canonical.y*Rt%1]):Ze.texture.bind(Yt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Ze.texture.useMipmap&&V.extTextureFilterAnisotropic&&w.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const jt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(qe),Ut=jt?qe:null,rn=Ut?Ut.posMatrix:w.transform.calculatePosMatrix(qe.toUnwrapped(),Oe),Tn=Tl(rn,Ht||[0,0],Rt||1,bt,D);W instanceof Yi?ne.draw(V,H.TRIANGLES,Ce,pi.disabled,ge,ci.disabled,Tn,jt,D.id,W.boundsBuffer,w.quadTriangleIndexBuffer,W.boundsSegments):ne.draw(V,H.TRIANGLES,Ce,ke[qe.overscaledZ],ge,ci.disabled,Tn,jt,D.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(t,h,_,y);break;case"background":(function(w,P,D,z){const V=D.paint.get("background-color"),H=D.paint.get("background-opacity");if(H===0)return;const W=w.context,ne=W.gl,ge=w.transform,ke=ge.tileSize,Me=D.paint.get("background-pattern");if(w.isPatternMissing(Me))return;const Ne=!Me&&V.a===1&&H===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Ne)return;const Oe=pi.disabled,qe=w.depthModeForSublayer(0,Ne==="opaque"?Bn.ReadWrite:Bn.ReadOnly),Ce=w.colorModeForRenderPass(),Ze=w.useProgram(Me?"backgroundPattern":"background"),Ke=z||ge.coveringTiles({tileSize:ke,terrain:w.style.map.terrain});Me&&(W.activeTexture.set(ne.TEXTURE0),w.imageManager.bind(w.context));const it=D.getCrossfadeParameters();for(const bt of Ke){const Rt=z?bt.posMatrix:w.transform.calculatePosMatrix(bt.toUnwrapped()),Ht=Me?_a(Rt,H,w,Me,{tileID:bt,tileSize:ke},it):ga(Rt,H,V),Yt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(bt);Ze.draw(W,ne.TRIANGLES,qe,Oe,Ce,ci.disabled,Ht,Yt,D.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(t,0,_,y);break;case"custom":(function(w,P,D){const z=w.context,V=D.implementation;if(w.renderPass==="offscreen"){const H=V.prerender;H&&(w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),H.call(V,z.gl,w.transform.customLayerMatrix()),z.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),z.setStencilMode(pi.disabled);const H=V.renderingMode==="3d"?new Bn(w.context.gl.LEQUAL,Bn.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,Bn.ReadOnly);z.setDepthMode(H),V.render(z.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),z.setDirty(),w.setBaseState(),z.bindFramebuffer.set(null)}})(t,0,_)}}translatePosMatrix(t,h,_,y,w){if(!_[0]&&!_[1])return t;const P=w?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(P){const V=Math.sin(P),H=Math.cos(P);_=[_[0]*H-_[1]*V,_[0]*V+_[1]*H]}const D=[w?_[0]:Fn(h,_[0],this.transform.zoom),w?_[1]:Fn(h,_[1],this.transform.zoom),0],z=new Float32Array(16);return l.J(z,t,D),z}saveTileTexture(t){const h=this._tileTextures[t.size[0]];h?h.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const h=this._tileTextures[t];return h&&h.length>0?h.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const h=this.imageManager.getPattern(t.from.toString()),_=this.imageManager.getPattern(t.to.toString());return!h||!_}useProgram(t,h){this.cache=this.cache||{};const _=t+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new wo(this.context,ro[t],h,Ba[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:h}=this.context.gl;return this.width!==t||this.height!==h}}class M{constructor(t,h){this.points=t,this.planes=h}static fromInvProjectionMatrix(t,h,_){const y=Math.pow(2,_),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const z=1/(D=l.af([],D,t))[3]/h*y;return l.b1(D,D,[z,z,1/D[3],z])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const z=function(ne,ge){var ke=ge[0],Me=ge[1],Ne=ge[2],Oe=ke*ke+Me*Me+Ne*Ne;return Oe>0&&(Oe=1/Math.sqrt(Oe)),ne[0]=ge[0]*Oe,ne[1]=ge[1]*Oe,ne[2]=ge[2]*Oe,ne}([],function(ne,ge,ke){var Me=ge[0],Ne=ge[1],Oe=ge[2],qe=ke[0],Ce=ke[1],Ze=ke[2];return ne[0]=Ne*Ze-Oe*Ce,ne[1]=Oe*qe-Me*Ze,ne[2]=Me*Ce-Ne*qe,ne}([],ue([],w[D[0]],w[D[1]]),ue([],w[D[2]],w[D[1]]))),V=-((H=z)[0]*(W=w[D[1]])[0]+H[1]*W[1]+H[2]*W[2]);var H,W;return z.concat(V)});return new M(w,P)}}class F{constructor(t,h){this.min=t,this.max=h,this.center=function(_,y,w){return _[0]=.5*y[0],_[1]=.5*y[1],_[2]=.5*y[2],_}([],function(_,y,w){return _[0]=y[0]+w[0],_[1]=y[1]+w[1],_[2]=y[2]+w[2],_}([],this.min,this.max))}quadrant(t){const h=[t%2==0,t<2],_=ve(this.min),y=ve(this.max);for(let w=0;w<h.length;w++)_[w]=h[w]?this.min[w]:this.center[w],y[w]=h[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new F(_,y)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let y=0;y<t.planes.length;y++){const w=t.planes[y];let P=0;for(let D=0;D<h.length;D++)l.b2(w,h[D])>=0&&P++;if(P===0)return 0;P!==h.length&&(_=!1)}if(_)return 2;for(let y=0;y<3;y++){let w=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let D=0;D<t.points.length;D++){const z=t.points[D][y]-this.min[y];w=Math.min(w,z),P=Math.max(P,z)}if(P<0||w>this.max[y]-this.min[y])return 0}return 1}}class q{constructor(t=0,h=0,_=0,y=0){if(isNaN(t)||t<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=h,this.left=_,this.right=y}interpolate(t,h,_){return h.top!=null&&t.top!=null&&(this.top=l.y.number(t.top,h.top,_)),h.bottom!=null&&t.bottom!=null&&(this.bottom=l.y.number(t.bottom,h.bottom,_)),h.left!=null&&t.left!=null&&(this.left=l.y.number(t.left,h.left,_)),h.right!=null&&t.right!=null&&(this.right=l.y.number(t.right,h.right,_)),this}getCenter(t,h){const _=l.ac((this.left+t-this.right)/2,0,t),y=l.ac((this.top+h-this.bottom)/2,0,h);return new l.P(_,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new q(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Y=85.051129;class me{constructor(t,h,_,y,w){this.tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=t||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new q,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new me(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const h=-l.b3(t,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var _=new l.A(4);return l.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,y,w){var P=y[0],D=y[1],z=y[2],V=y[3],H=Math.sin(w),W=Math.cos(w);_[0]=P*W+z*H,_[1]=D*W+V*H,_[2]=P*-H+z*W,_[3]=D*-H+V*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const h=l.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const h=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,h,_){this._unmodified=!1,this._edgeInsets.interpolate(t,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const h=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(t){const h=[new l.b4(0,t)];if(this._renderWorldCopies){const _=this.pointCoordinate(new l.P(0,0)),y=this.pointCoordinate(new l.P(this.width,0)),w=this.pointCoordinate(new l.P(this.width,this.height)),P=this.pointCoordinate(new l.P(0,this.height)),D=Math.floor(Math.min(_.x,y.x,w.x,P.x)),z=Math.floor(Math.max(_.x,y.x,w.x,P.x)),V=1;for(let H=D-V;H<=z+V;H++)H!==0&&h.push(new l.b4(H,t))}return h}coveringTiles(t){var h,_;let y=this.coveringZoomLevel(t);const w=y;if(t.minzoom!==void 0&&y<t.minzoom)return[];t.maxzoom!==void 0&&y>t.maxzoom&&(y=t.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),D=l.Z.fromLngLat(this.center),z=Math.pow(2,y),V=[z*P.x,z*P.y,0],H=[z*D.x,z*D.y,0],W=M.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,y);let ne=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=y);const ge=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,ke=Ce=>({aabb:new F([Ce*z,0,0],[(Ce+1)*z,z,0]),zoom:0,x:0,y:0,wrap:Ce,fullyVisible:!1}),Me=[],Ne=[],Oe=y,qe=t.reparseOverscaled?w:y;if(this._renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)Me.push(ke(-Ce)),Me.push(ke(Ce));for(Me.push(ke(0));Me.length>0;){const Ce=Me.pop(),Ze=Ce.x,Ke=Ce.y;let it=Ce.fullyVisible;if(!it){const jt=Ce.aabb.intersects(W);if(jt===0)continue;it=jt===2}const bt=t.terrain?V:H,Rt=Ce.aabb.distanceX(bt),Ht=Ce.aabb.distanceY(bt),Yt=Math.max(Math.abs(Rt),Math.abs(Ht));if(Ce.zoom===Oe||Yt>ge+(1<<Oe-Ce.zoom)-2&&Ce.zoom>=ne){const jt=Oe-Ce.zoom,Ut=V[0]-.5-(Ze<<jt),rn=V[1]-.5-(Ke<<jt);Ne.push({tileID:new l.S(Ce.zoom===Oe?qe:Ce.zoom,Ce.wrap,Ce.zoom,Ze,Ke),distanceSq:xe([H[0]-.5-Ze,H[1]-.5-Ke]),tileDistanceToCamera:Math.sqrt(Ut*Ut+rn*rn)})}else for(let jt=0;jt<4;jt++){const Ut=(Ze<<1)+jt%2,rn=(Ke<<1)+(jt>>1),Tn=Ce.zoom+1;let qt=Ce.aabb.quadrant(jt);if(t.terrain){const Xt=new l.S(Tn,Ce.wrap,Tn,Ut,rn),In=t.terrain.getMinMaxElevation(Xt),Si=(h=In.minElevation)!==null&&h!==void 0?h:this.elevation,On=(_=In.maxElevation)!==null&&_!==void 0?_:this.elevation;qt=new F([qt.min[0],qt.min[1],Si],[qt.max[0],qt.max[1],On])}Me.push({aabb:qt,zoom:Tn,x:Ut,y:rn,wrap:Ce.wrap,fullyVisible:it})}}return Ne.sort((Ce,Ze)=>Ce.distanceSq-Ze.distanceSq).map(Ce=>Ce.tileID)}resize(t,h){this.width=t,this.height=h,this.pixelsToGLUnits=[2/t,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const h=l.ac(t.lat,-85.051129,Y);return new l.P(l.O(t.lng)*this.worldSize,l.Q(h)*this.worldSize)}unproject(t){return new l.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const h=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,y=this.pointLocation(this.centerPoint,t),w=t.getElevationForLngLatZoom(y,this.tileZoom);if(!(this.elevation-w))return;const P=_+h-w,D=Math.cos(this._pitch)*this.cameraToCenterDistance/P/l.b5(1,y.lat),z=this.scaleZoom(D/this.tileSize);this._elevation=w,this._center=y,this.zoom=z}setLocationAtPoint(t,h){const _=this.pointCoordinate(h),y=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(t),P=new l.Z(w.x-(_.x-y.x),w.y-(_.y-y.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,h){return h?this.coordinatePoint(this.locationCoordinate(t),h.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,h){return this.coordinateLocation(this.pointCoordinate(t,h))}locationCoordinate(t){return l.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,h){if(h){const ne=h.pointCoordinate(t);if(ne!=null)return ne}const _=[t.x,t.y,0,1],y=[t.x,t.y,1,1];l.af(_,_,this.pixelMatrixInverse),l.af(y,y,this.pixelMatrixInverse);const w=_[3],P=y[3],D=_[1]/w,z=y[1]/P,V=_[2]/w,H=y[2]/P,W=V===H?0:(0-V)/(H-V);return new l.Z(l.y.number(_[0]/w,y[0]/P,W)/this.worldSize,l.y.number(D,z,W)/this.worldSize)}coordinatePoint(t,h=0,_=this.pixelMatrix){const y=[t.x*this.worldSize,t.y*this.worldSize,h,1];return l.af(y,y,_),new l.P(y[0]/y[3],y[1]/y[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ye().extend(this.pointLocation(new l.P(0,t))).extend(this.pointLocation(new l.P(this.width,t))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Y])}calculateTileMatrix(t){const h=t.canonical,_=this.worldSize/this.zoomScale(h.z),y=h.x+Math.pow(2,h.z)*t.wrap,w=l.an(new Float64Array(16));return l.J(w,w,[y*_,h.y*_,0]),l.K(w,w,[_/l.X,_/l.X,1]),w}calculatePosMatrix(t,h=!1){const _=t.key,y=h?this._alignedPosMatrixCache:this._posMatrixCache;if(y[_])return y[_];const w=this.calculateTileMatrix(t);return l.L(w,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,w),y[_]=new Float32Array(w),y[_]}calculateFogMatrix(t){const h=t.key,_=this._fogMatrixCache;if(_[h])return _[h];const y=this.calculateTileMatrix(t);return l.L(y,this.fogMatrix,y),_[h]=new Float32Array(y),_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,h){h=l.ac(+h,this.minZoom,this.maxZoom);const _={center:new l.N(t.lng,t.lat),zoom:h};let y=this.lngRange;if(!this._renderWorldCopies&&y===null){const Ce=179.9999999999;y=[-Ce,Ce]}const w=this.tileSize*this.zoomScale(_.zoom);let P=0,D=w,z=0,V=w,H=0,W=0;const{x:ne,y:ge}=this.size;if(this.latRange){const Ce=this.latRange;P=l.Q(Ce[1])*w,D=l.Q(Ce[0])*w,D-P<ge&&(H=ge/(D-P))}y&&(z=l.b3(l.O(y[0])*w,0,w),V=l.b3(l.O(y[1])*w,0,w),V<z&&(V+=w),V-z<ne&&(W=ne/(V-z)));const{x:ke,y:Me}=this.project.call({worldSize:w},t);let Ne,Oe;const qe=Math.max(W||0,H||0);if(qe){const Ce=new l.P(W?(V+z)/2:ke,H?(D+P)/2:Me);return _.center=this.unproject.call({worldSize:w},Ce).wrap(),_.zoom+=this.scaleZoom(qe),_}if(this.latRange){const Ce=ge/2;Me-Ce<P&&(Oe=P+Ce),Me+Ce>D&&(Oe=D-Ce)}if(y){const Ce=(z+V)/2;let Ze=ke;this._renderWorldCopies&&(Ze=l.b3(ke,Ce-w/2,Ce+w/2));const Ke=ne/2;Ze-Ke<z&&(Ne=z+Ke),Ze+Ke>V&&(Ne=V-Ke)}if(Ne!==void 0||Oe!==void 0){const Ce=new l.P(Ne??ke,Oe??Me);_.center=this.unproject.call({worldSize:w},Ce).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:h,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=_,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,h=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let y=l.an(new Float64Array(16));l.K(y,y,[this.width/2,-this.height/2,1]),l.J(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=l.an(new Float64Array(16)),l.K(y,y,[1,-1,1]),l.J(y,y,[-1,-1,0]),l.K(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),D=w-P*this._pixelPerMeter/Math.cos(this._pitch),z=P<0?D:w,V=Math.PI/2+this._pitch,H=this._fov*(.5+t.y/this.height),W=Math.sin(H)*z/Math.sin(l.ac(Math.PI-V-H,.01,Math.PI-.01)),ne=this.getHorizon(),ge=2*Math.atan(ne/this.cameraToCenterDistance)*(.5+t.y/(2*ne)),ke=Math.sin(ge)*z/Math.sin(l.ac(Math.PI-V-ge,.01,Math.PI-.01)),Me=Math.min(W,ke);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+z),this.nearZ=this.height/50,y=new Float64Array(16),l.b6(y,this._fov,this.width/this.height,this.nearZ,this.farZ),y[8]=2*-t.x/this.width,y[9]=2*t.y/this.height,this.projectionMatrix=l.ae(y),l.K(y,y,[1,-1,1]),l.J(y,y,[0,0,-this.cameraToCenterDistance]),l.b7(y,y,this._pitch),l.ad(y,y,this.angle),l.J(y,y,[-h,-_,0]),this.mercatorMatrix=l.K([],y,[this.worldSize,this.worldSize,this.worldSize]),l.K(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,y),l.J(y,y,[0,0,-this.elevation]),this.modelViewProjectionMatrix=y,this.invModelViewProjectionMatrix=l.as([],y),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,w,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-h,-_,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,y);const Ne=this.width%2/2,Oe=this.height%2/2,qe=Math.cos(this.angle),Ce=Math.sin(this.angle),Ze=h-Math.round(h)+qe*Ne+Ce*Oe,Ke=_-Math.round(_)+qe*Oe+Ce*Ne,it=new Float64Array(y);if(l.J(it,it,[Ze>.5?Ze-1:Ze,Ke>.5?Ke-1:Ke,0]),this.alignedModelViewProjectionMatrix=it,y=l.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.P(0,0)),h=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,t))}getCameraQueryGeometry(t){const h=this.getCameraPoint();if(t.length===1)return[t[0],h];{let _=h.x,y=h.y,w=h.x,P=h.y;for(const D of t)_=Math.min(_,D.x),y=Math.min(y,D.y),w=Math.max(w,D.x),P=Math.max(P,D.y);return[new l.P(_,y),new l.P(w,y),new l.P(w,P),new l.P(_,P),new l.P(_,y)]}}lngLatToCameraDepth(t,h){const _=this.locationCoordinate(t),y=[_.x*this.worldSize,_.y*this.worldSize,h,1];return l.af(y,y,this.modelViewProjectionMatrix),y[2]/y[3]}}function Ue(k,t){let h,_=!1,y=null,w=null;const P=()=>{y=null,_&&(k.apply(w,h),y=setTimeout(P,t),_=!1)};return(...D)=>(_=!0,w=this,h=D,y||P(),y)}class $e{constructor(t){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let _;return h.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(_=y)}),(_&&_[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const _=h.join("/");let y=_;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${_}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let P=window.location.href.replace(/(#.+)?$/,w);P=P.replace("&&","&"),window.history.replaceState(window.history.state,null,P)},this._updateHash=Ue(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const h=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),P=Math.round(h.lng*w)/w,D=Math.round(h.lat*w)/w,z=this._map.getBearing(),V=this._map.getPitch();let H="";if(H+=t?`/${P}/${D}/${_}`:`${_}/${D}/${P}`,(z||V)&&(H+="/"+Math.round(10*z)/10),V&&(H+=`/${Math.round(V)}`),this._hashName){const W=this._hashName;let ne=!1;const ge=window.location.hash.slice(1).split("&").map(ke=>{const Me=ke.split("=")[0];return Me===W?(ne=!0,`${Me}=${H}`):ke}).filter(ke=>ke);return ne||ge.push(`${W}=${H}`),`#${ge.join("&")}`}return`#${H}`}}const mt={linearity:.3,easing:l.b8(0,0,.3,1)},zt=l.e({deceleration:2500,maxSpeed:1400},mt),Nt=l.e({deceleration:20,maxSpeed:1400},mt),gn=l.e({deceleration:1e3,maxSpeed:360},mt),bn=l.e({deceleration:1e3,maxSpeed:90},mt);class Pn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:L.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,h=L.now();for(;t.length>0&&h-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const w=mi(h.pan.mag(),_,l.e({},zt,t||{}));y.offset=h.pan.mult(w.amount/h.pan.mag()),y.center=this._map.transform.center,ti(y,w)}if(h.zoom){const w=mi(h.zoom,_,Nt);y.zoom=this._map.transform.zoom+w.amount,ti(y,w)}if(h.bearing){const w=mi(h.bearing,_,gn);y.bearing=this._map.transform.bearing+l.ac(w.amount,-179,179),ti(y,w)}if(h.pitch){const w=mi(h.pitch,_,bn);y.pitch=this._map.transform.pitch+w.amount,ti(y,w)}if(y.zoom||y.bearing){const w=h.pinchAround===void 0?h.around:h.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),l.e(y,{noMoveStart:!0})}}function ti(k,t){(!k.duration||k.duration<t.duration)&&(k.duration=t.duration,k.easing=t.easing)}function mi(k,t,h){const{maxSpeed:_,linearity:y,deceleration:w}=h,P=l.ac(k*y/(t/1e3),-_,_),D=Math.abs(P)/(w*y);return{easing:h.easing,duration:1e3*D,amount:P*(D/2)}}class li extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,h,_,y={}){const w=N.mousePos(h.getCanvas(),_),P=h.unproject(w);super(t,l.e({point:w,lngLat:P,originalEvent:_},y)),this._defaultPrevented=!1,this.target=h}}class er extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,h,_){const y=t==="touchend"?_.changedTouches:_.touches,w=N.touchPos(h.getCanvasContainer(),y),P=w.map(z=>h.unproject(z)),D=w.reduce((z,V,H,W)=>z.add(V.div(W.length)),new l.P(0,0));super(t,{points:w,point:D,lngLats:P,lngLat:h.unproject(D),originalEvent:_}),this._defaultPrevented=!1}}class rs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,h,_){super(t,{originalEvent:_}),this._defaultPrevented=!1}}class Ps{constructor(t,h){this._map=t,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new rs(t.type,this._map,t))}mousedown(t,h){return this._mousedownPos=h,this._firePreventable(new li(t.type,this._map,t))}mouseup(t){this._map.fire(new li(t.type,this._map,t))}click(t,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new li(t.type,this._map,t))}dblclick(t){return this._firePreventable(new li(t.type,this._map,t))}mouseover(t){this._map.fire(new li(t.type,this._map,t))}mouseout(t){this._map.fire(new li(t.type,this._map,t))}touchstart(t){return this._firePreventable(new er(t.type,this._map,t))}touchmove(t){this._map.fire(new er(t.type,this._map,t))}touchend(t){this._map.fire(new er(t.type,this._map,t))}touchcancel(t){this._map.fire(new er(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new li(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new li(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ar{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.P.convert(t),this._map.terrain)}}class dr{constructor(t,h){this._map=t,this._tr=new Ar(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,h){this.isEnabled()&&t.shiftKey&&t.button===0&&(N.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(t,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=_,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(y.x,_.x),P=Math.max(y.x,_.x),D=Math.min(y.y,_.y),z=Math.max(y.y,_.y);N.setTransform(this._box,`translate(${w}px,${D}px)`),this._box.style.width=P-w+"px",this._box.style.height=z-D+"px"}mouseupWindow(t,h){if(!this._active||t.button!==0)return;const _=this._startPos,y=h;if(this.reset(),N.suppressClick(),_.x!==y.x||_.y!==y.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:t})),{cameraAnimation:w=>w.fitScreenCoordinates(_,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,h){return this._map.fire(new l.k(t,{originalEvent:h}))}}function Rs(k,t){if(k.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${k.length}, points ${t.length}`);const h={};for(let _=0;_<k.length;_++)h[k[_].identifier]=t[_];return h}class Xa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const w=new l.P(0,0);for(const P of y)w._add(P);return w.div(y.length)}(h),this.touches=Rs(_,h)))}touchmove(t,h,_){if(this.aborted||!this.centroid)return;const y=Rs(_,h);for(const w in this.touches){const P=y[w];(!P||P.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(t,h,_){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class xa{constructor(t){this.singleTap=new Xa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,h,_){this.singleTap.touchstart(t,h,_)}touchmove(t,h,_){this.singleTap.touchmove(t,h,_)}touchend(t,h,_){const y=this.singleTap.touchend(t,h,_);if(y){const w=t.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(y)<30;if(w&&P||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class lo{constructor(t){this._tr=new Ar(t),this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,h,_){this._zoomIn.touchstart(t,h,_),this._zoomOut.touchstart(t,h,_)}touchmove(t,h,_){this._zoomIn.touchmove(t,h,_),this._zoomOut.touchmove(t,h,_)}touchend(t,h,_){const y=this._zoomIn.touchend(t,h,_),w=this._zoomOut.touchend(t,h,_),P=this._tr;return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(y)},{originalEvent:t})}):w?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(w)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ks{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const h=this._moveFunction(...t);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(t,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,h){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const y=h.length?h[0]:h;return!this._moved&&y.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(_,y))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&N.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ec={0:1,2:2};class pu{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const h=N.mouseButton(t);this._eventButton=h}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(h,_){const y=Ec[_];return h.buttons===void 0||(h.buttons&y)!==y}(t,this._eventButton)}isValidEndEvent(t){return N.mouseButton(t)===this._eventButton}}class Tc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const mu=k=>{k.mousedown=k.dragStart,k.mousemoveWindow=k.dragMove,k.mouseup=k.dragEnd,k.contextmenu=t=>{t.preventDefault()}},Cc=({enable:k,clickTolerance:t,bearingDegreesPerPixelMoved:h=.8})=>{const _=new pu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ks({clickTolerance:t,move:(y,w)=>({bearingDelta:(w.x-y.x)*h}),moveStateManager:_,enable:k,assignEvents:mu})},Lc=({enable:k,clickTolerance:t,pitchDegreesPerPixelMoved:h=-.5})=>{const _=new pu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ks({clickTolerance:t,move:(y,w)=>({pitchDelta:(w.y-y.y)*h}),moveStateManager:_,enable:k,assignEvents:mu})};class wa{constructor(t,h){this._clickTolerance=t.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,h,_){return this._calculateTransform(t,h,_)}touchmove(t,h,_){if(this._active){if(!this._shouldBePrevented(_.length))return t.preventDefault(),this._calculateTransform(t,h,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,h,_){this._calculateTransform(t,h,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,h,_){_.length>0&&(this._active=!0);const y=Rs(_,h),w=new l.P(0,0),P=new l.P(0,0);let D=0;for(const V in y){const H=y[V],W=this._touches[V];W&&(w._add(H),P._add(H.sub(W)),D++,y[V]=H)}if(this._touches=y,this._shouldBePrevented(D)||!P.mag())return;const z=P.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(D),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(t,h,_){if(!this._firstTwoTouches)return;t.preventDefault();const[y,w]=this._firstTwoTouches,P=Ul(_,h,y),D=Ul(_,h,w);if(!P||!D)return;const z=this._aroundCenter?null:P.add(D).div(2);return this._move([P,D],z,t)}touchend(t,h,_){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,P=Ul(_,h,y),D=Ul(_,h,w);P&&D||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ul(k,t,h){for(let _=0;_<k.length;_++)if(k[_].identifier===h)return t[_]}function Mc(k,t){return Math.log(k/t)/Math.LN2}class Ac extends gu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,h){const _=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Mc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mc(this._distance,_),pinchAround:h}}}function Pc(k,t){return 180*k.angleWith(t)/Math.PI}class Rc extends gu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,h,_){const y=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pc(this._vector,y),pinchAround:h}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const h=25/(Math.PI*this._minDiameter)*360,_=Pc(t,this._startVector);return Math.abs(_)<h}}function _u(k){return Math.abs(k.y)>Math.abs(k.x)}class $a extends gu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,h,_){super.touchstart(t,h,_),this._currentTouchCount=_.length}_start(t){this._lastPoints=t,_u(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,h,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=t[0].sub(this._lastPoints[0]),w=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,_.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(t,h,_){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,w=h.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const P=t.y>0==h.y>0;return _u(t)&&_u(h)&&P}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class Ds{constructor(t){this._tr=new Ar(t);const h=Bh;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let h=0,_=0,y=0,w=0,P=0;switch(t.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:t.shiftKey?_=-1:(t.preventDefault(),w=-1);break;case 39:t.shiftKey?_=1:(t.preventDefault(),w=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),P=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:D=>{const z=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:h?Math.round(z.zoom)+h*(t.shiftKey?2:1):z.zoom,bearing:z.bearing+_*this._bearingStep,pitch:z.pitch+y*this._pitchStep,offset:[-w*this._panStep,-P*this._panStep],center:z.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(k){return k*(2-k)}const Dc=4.000244140625;class Zs{constructor(t,h){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=t,this._tr=new Ar(t),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let h=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const _=L.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%Dc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),t.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=t,this._delta-=h,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=N.mousePos(this._map.getCanvas(),t),_=this._tr;this._around=h.y>_.transform.height/2-_.transform.getHorizon()?l.N.convert(this._aroundCenter?_.center:_.unproject(h)):l.N.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Dc?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&V!==0&&(V=1/V);const H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*V))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,_=this._startZoom,y=this._easing;let w,P=!1;const D=L.now()-this._lastWheelEventTime;if(this._type==="wheel"&&_&&y&&D){const z=Math.min(D/200,1),V=y(z);w=l.y.number(_,h,V),z<1?this._frameId||(this._frameId=!0):P=!0}else w=h,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:w-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let h=l.b9;if(this._prevEase){const _=this._prevEase,y=(L.now()-_.start)/_.duration,w=_.easing(y+.01)-_.easing(y),P=.27/Math.sqrt(w*w+1e-4)*.01,D=Math.sqrt(.0729-P*P);h=l.b8(P,D,.25,1)}return this._prevEase={start:L.now(),duration:t,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ka{constructor(t,h){this._clickZoom=t,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class od{constructor(t){this._tr=new Ar(t),this.reset()}reset(){this._active=!1}dblclick(t,h){return t.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,h,_){if(!this._swipePoint)if(this._tapTime){const y=h[0],w=t.timeStamp-this._tapTime<500,P=this._tapPoint.dist(y)<30;w&&P?_.length>0&&(this._swipePoint=y,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(t,h,_)}touchmove(t,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=h[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(t,h,_)}touchend(t,h,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const y=this._tap.touchend(t,h,_);y&&(this._tapTime=t.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(t,h,_){this._el=t,this._mousePan=h,this._touchPan=_}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jh{constructor(t,h,_){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nc{constructor(t,h,_,y){this._el=t,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ya{constructor(t,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",t);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=h,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=_,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,h){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:t,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ns=k=>k.zoom||k.drag||k.pitch||k.rotate;class Qt extends l.k{}function yu(k){return k.panDelta&&k.panDelta.mag()||k.zoomDelta||k.bearingDelta||k.pitchDelta}class zc{constructor(t,h){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=y.type==="renderFrame"?void 0:y,D={needsRenderFrame:!1},z={},V={},H=y.touches,W=H?this._getMapTouches(H):void 0,ne=W?N.touchPos(this._map.getCanvas(),W):N.mousePos(this._map.getCanvas(),y);for(const{handlerName:Me,handler:Ne,allowed:Oe}of this._handlers){if(!Ne.isEnabled())continue;let qe;this._blockedByActive(V,Oe,Me)?Ne.reset():Ne[w||y.type]&&(qe=Ne[w||y.type](y,ne,W),this.mergeHandlerResult(D,z,qe,Me,P),qe&&qe.needsRenderFrame&&this._triggerRenderFrame()),(qe||Ne.isActive())&&(V[Me]=Ne)}const ge={};for(const Me in this._previousActiveHandlers)V[Me]||(ge[Me]=P);this._previousActiveHandlers=V,(Object.keys(ge).length||yu(D))&&(this._changes.push([D,z,ge]),this._triggerRenderFrame()),(Object.keys(V).length||yu(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=D;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pn(t),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,P]of this._listeners)N.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[t,h,_]of this._listeners)N.removeEventListener(t,h,t===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(t){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Ps(h,t));const y=h.boxZoom=new dr(h,t);this._add("boxZoom",y),t.interactive&&t.boxZoom&&y.enable();const w=h.cooperativeGestures=new Ya(h,t.cooperativeGestures);this._add("cooperativeGestures",w),t.cooperativeGestures&&w.enable();const P=new lo(h),D=new od(h);h.doubleClickZoom=new ka(D,P),this._add("tapZoom",P),this._add("clickZoom",D),t.interactive&&t.doubleClickZoom&&h.doubleClickZoom.enable();const z=new ad;this._add("tapDragZoom",z);const V=h.touchPitch=new $a(h);this._add("touchPitch",V),t.interactive&&t.touchPitch&&h.touchPitch.enable(t.touchPitch);const H=Cc(t),W=Lc(t);h.dragRotate=new jh(t,H,W),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]),t.interactive&&t.dragRotate&&h.dragRotate.enable();const ne=(({enable:qe,clickTolerance:Ce})=>{const Ze=new pu({checkCorrectEvent:Ke=>N.mouseButton(Ke)===0&&!Ke.ctrlKey});return new ks({clickTolerance:Ce,move:(Ke,it)=>({around:it,panDelta:it.sub(Ke)}),activateOnStart:!0,moveStateManager:Ze,enable:qe,assignEvents:mu})})(t),ge=new wa(t,h);h.dragPan=new Uh(_,ne,ge),this._add("mousePan",ne),this._add("touchPan",ge,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&h.dragPan.enable(t.dragPan);const ke=new Rc,Me=new Ac;h.touchZoomRotate=new Nc(_,Me,ke,z),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&h.touchZoomRotate.enable(t.touchZoomRotate);const Ne=h.scrollZoom=new Zs(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Ne,["mousePan"]),t.interactive&&t.scrollZoom&&h.scrollZoom.enable(t.scrollZoom);const Oe=h.keyboard=new Ds(h);this._add("keyboard",Oe),t.interactive&&t.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new fi(h))}_add(t,h,_){this._handlers.push({handlerName:t,handler:h,allowed:_}),this._handlersById[t]=h}stop(t){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ns(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,h,_){for(const y in t)if(y!==_&&(!h||h.indexOf(y)<0))return!0;return!1}_getMapTouches(t){const h=[];for(const _ of t)this._el.contains(_.target)&&h.push(_);return h}mergeHandlerResult(t,h,_,y,w){if(!_)return;l.e(t,_);const P={handlerName:y,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(h.zoom=P),_.panDelta!==void 0&&(h.drag=P),_.pitchDelta!==void 0&&(h.pitch=P),_.bearingDelta!==void 0&&(h.rotate=P)}_applyChanges(){const t={},h={},_={};for(const[y,w,P]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),l.e(h,w),l.e(_,P);this._updateMapTransform(t,h,_),this._changes=[]}_updateMapTransform(t,h,_){const y=this._map,w=y._getTransformForUpdate(),P=y.terrain;if(!(yu(t)||P&&this._terrainMovement))return this._fireEvents(h,_,!0);let{panDelta:D,zoomDelta:z,bearingDelta:V,pitchDelta:H,around:W,pinchAround:ne}=t;ne!==void 0&&(W=ne),y._stop(!0),W=W||y.transform.centerPoint;const ge=w.pointLocation(D?W.sub(D):W);V&&(w.bearing+=V),H&&(w.pitch+=H),z&&(w.zoom+=z),P?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(D)):w.setLocationAtPoint(ge,W):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(ge,W)):w.setLocationAtPoint(ge,W),y._applyUpdatedTransform(w),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(h,_,!0)}_fireEvents(t,h,_){const y=Ns(this._eventsInProgress),w=Ns(t),P={};for(const W in t){const{originalEvent:ne}=t[W];this._eventsInProgress[W]||(P[`${W}start`]=ne),this._eventsInProgress[W]=t[W]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const W in P)this._fireEvent(W,P[W]);w&&this._fireEvent("move",w.originalEvent);for(const W in t){const{originalEvent:ne}=t[W];this._fireEvent(W,ne)}const D={};let z;for(const W in this._eventsInProgress){const{handlerName:ne,originalEvent:ge}=this._eventsInProgress[W];this._handlersById[ne].isActive()||(delete this._eventsInProgress[W],z=h[ne]||ge,D[`${W}end`]=z)}for(const W in D)this._fireEvent(W,D[W]);const V=Ns(this._eventsInProgress),H=(y||w)&&!V;if(H&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const W=this._map._getTransformForUpdate();W.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(W)}if(_&&H){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=ge=>ge!==0&&-this._bearingSnap<ge&&ge<this._bearingSnap;!W||!W.essential&&L.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:z})),ne(this._map.getBearing())&&this._map.resetNorth()):(ne(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(t,h){this._map.fire(new l.k(t,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Qt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Vh extends l.E{constructor(t,h){super(),this._renderFrameCallback=()=>{const _=Math.min((L.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,h){return this.jumpTo({center:t},h)}panBy(t,h,_){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},h),_)}panTo(t,h,_){return this.easeTo(l.e({center:t},h),_)}getZoom(){return this.transform.zoom}setZoom(t,h){return this.jumpTo({zoom:t},h),this}zoomTo(t,h,_){return this.easeTo(l.e({zoom:t},h),_)}zoomIn(t,h){return this.zoomTo(this.getZoom()+1,t,h),this}zoomOut(t,h){return this.zoomTo(this.getZoom()-1,t,h),this}getBearing(){return this.transform.bearing}setBearing(t,h){return this.jumpTo({bearing:t},h),this}getPadding(){return this.transform.padding}setPadding(t,h){return this.jumpTo({padding:t},h),this}rotateTo(t,h,_){return this.easeTo(l.e({bearing:t},h),_)}resetNorth(t,h){return this.rotateTo(0,l.e({duration:1e3},t),h),this}resetNorthPitch(t,h){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},t),h),this}snapToNorth(t,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,h):this}getPitch(){return this.transform.pitch}setPitch(t,h){return this.jumpTo({pitch:t},h),this}cameraForBounds(t,h){t=Ye.convert(t).adjustAntiMeridian();const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),_,h)}_cameraForBoxAndBearing(t,h,_,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=l.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const jt=y.padding;y.padding={top:jt,bottom:jt,right:jt,left:jt}}y.padding=l.e(w,y.padding);const P=this.transform,D=P.padding,z=new Ye(t,h),V=P.project(z.getNorthWest()),H=P.project(z.getNorthEast()),W=P.project(z.getSouthEast()),ne=P.project(z.getSouthWest()),ge=l.ba(-_),ke=V.rotate(ge),Me=H.rotate(ge),Ne=W.rotate(ge),Oe=ne.rotate(ge),qe=new l.P(Math.max(ke.x,Me.x,Oe.x,Ne.x),Math.max(ke.y,Me.y,Oe.y,Ne.y)),Ce=new l.P(Math.min(ke.x,Me.x,Oe.x,Ne.x),Math.min(ke.y,Me.y,Oe.y,Ne.y)),Ze=qe.sub(Ce),Ke=(P.width-(D.left+D.right+y.padding.left+y.padding.right))/Ze.x,it=(P.height-(D.top+D.bottom+y.padding.top+y.padding.bottom))/Ze.y;if(it<0||Ke<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(P.scaleZoom(P.scale*Math.min(Ke,it)),y.maxZoom),Rt=l.P.convert(y.offset),Ht=new l.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(l.ba(_)),Yt=Rt.add(Ht).mult(P.scale/P.zoomScale(bt));return{center:P.unproject(V.add(W).div(2).sub(Yt)),zoom:bt,bearing:_}}fitBounds(t,h,_){return this._fitInternal(this.cameraForBounds(t,h),h,_)}fitScreenCoordinates(t,h,_,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(t)),this.transform.pointLocation(l.P.convert(h)),_,y),y,w)}_fitInternal(t,h,_){return t?(delete(h=l.e(t,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(t,h){this.stop();const _=this._getTransformForUpdate();let y=!1,w=!1,P=!1;return"zoom"in t&&_.zoom!==+t.zoom&&(y=!0,_.zoom=+t.zoom),t.center!==void 0&&(_.center=l.N.convert(t.center)),"bearing"in t&&_.bearing!==+t.bearing&&(w=!0,_.bearing=+t.bearing),"pitch"in t&&_.pitch!==+t.pitch&&(P=!0,_.pitch=+t.pitch),t.padding==null||_.isPaddingEqual(t.padding)||(_.padding=t.padding),this._applyUpdatedTransform(_),this.fire(new l.k("movestart",h)).fire(new l.k("move",h)),y&&this.fire(new l.k("zoomstart",h)).fire(new l.k("zoom",h)).fire(new l.k("zoomend",h)),w&&this.fire(new l.k("rotatestart",h)).fire(new l.k("rotate",h)).fire(new l.k("rotateend",h)),P&&this.fire(new l.k("pitchstart",h)).fire(new l.k("pitch",h)).fire(new l.k("pitchend",h)),this.fire(new l.k("moveend",h))}calculateCameraOptionsFromTo(t,h,_,y=0){const w=l.Z.fromLngLat(t,h),P=l.Z.fromLngLat(_,y),D=P.x-w.x,z=P.y-w.y,V=P.z-w.z,H=Math.hypot(D,z,V);if(H===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(D,z),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/H/this.transform.tileSize),ge=180*Math.atan2(D,-z)/Math.PI;let ke=180*Math.acos(W/H)/Math.PI;return ke=V<0?90-ke:90+ke,{center:P.toLngLat(),zoom:ne,pitch:ke,bearing:ge}}easeTo(t,h){var _;this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.b9},t)).animate===!1||!t.essential&&L.prefersReducedMotion)&&(t.duration=0);const y=this._getTransformForUpdate(),w=y.zoom,P=y.bearing,D=y.pitch,z=y.padding,V="bearing"in t?this._normalizeBearing(t.bearing,P):P,H="pitch"in t?+t.pitch:D,W="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let ge=y.centerPoint.add(ne);const ke=y.pointLocation(ge),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(t.center||ke),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const Oe=y.project(ke),qe=y.project(Me).sub(Oe),Ce=y.zoomScale(Ne-w);let Ze,Ke;t.around&&(Ze=l.N.convert(t.around),Ke=y.locationPoint(Ze));const it={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ne!==w,this._rotating=this._rotating||P!==V,this._pitching=this._pitching||H!==D,this._padding=!y.isPaddingEqual(W),this._easeId=t.easeId,this._prepareEase(h,t.noMoveStart,it),this.terrain&&this._prepareElevation(Me),this._ease(bt=>{if(this._zooming&&(y.zoom=l.y.number(w,Ne,bt)),this._rotating&&(y.bearing=l.y.number(P,V,bt)),this._pitching&&(y.pitch=l.y.number(D,H,bt)),this._padding&&(y.interpolatePadding(z,W,bt),ge=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(bt),Ze)y.setLocationAtPoint(Ze,Ke);else{const Rt=y.zoomScale(y.zoom-w),Ht=Ne>w?Math.min(2,Ce):Math.max(.5,Ce),Yt=Math.pow(Ht,1-bt),jt=y.unproject(Oe.add(qe.mult(bt*Yt)).mult(Rt));y.setLocationAtPoint(y.renderWorldCopies?jt.wrap():jt,ge)}this._applyUpdatedTransform(y),this._fireMoveEvents(h)},bt=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(h,bt)},t),this}_prepareEase(t,h,_={}){this._moving=!0,h||_.moving||this.fire(new l.k("movestart",t)),this._zooming&&!_.zooming&&this.fire(new l.k("zoomstart",t)),this._rotating&&!_.rotating&&this.fire(new l.k("rotatestart",t)),this._pitching&&!_.pitching&&this.fire(new l.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&h!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(_-(h-(_*t+this._elevationStart))/(1-t)),this._elevationTarget=h}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const h=t.getCameraPosition(),_=this.terrain.getElevationForLngLatZoom(h.lngLat,t.zoom);if(h.altitude<_){const y=this.calculateCameraOptionsFromTo(h.lngLat,_,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const h=[];if(this.terrain&&h.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&h.push(y=>this.transformCameraUpdate(y)),!h.length)return;const _=t.clone();for(const y of h){const w=_.clone(),{center:P,zoom:D,pitch:z,bearing:V,elevation:H}=y(w);P&&(w.center=P),D!==void 0&&(w.zoom=D),z!==void 0&&(w.pitch=z),V!==void 0&&(w.bearing=V),H!==void 0&&(w.elevation=H),_.apply(w)}this.transform.apply(_)}_fireMoveEvents(t){this.fire(new l.k("move",t)),this._zooming&&this.fire(new l.k("zoom",t)),this._rotating&&this.fire(new l.k("rotate",t)),this._pitching&&this.fire(new l.k("pitch",t))}_afterEase(t,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const _=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new l.k("zoomend",t)),y&&this.fire(new l.k("rotateend",t)),w&&this.fire(new l.k("pitchend",t)),this.fire(new l.k("moveend",t))}flyTo(t,h){var _;if(!t.essential&&L.prefersReducedMotion){const Xt=l.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xt,h)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},t);const y=this._getTransformForUpdate(),w=y.zoom,P=y.bearing,D=y.pitch,z=y.padding,V="bearing"in t?this._normalizeBearing(t.bearing,P):P,H="pitch"in t?+t.pitch:D,W="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let ge=y.centerPoint.add(ne);const ke=y.pointLocation(ge),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(t.center||ke),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const Oe=y.zoomScale(Ne-w),qe=y.project(ke),Ce=y.project(Me).sub(qe);let Ze=t.curve;const Ke=Math.max(y.width,y.height),it=Ke/Oe,bt=Ce.mag();if("minZoom"in t){const Xt=l.ac(Math.min(t.minZoom,w,Ne),y.minZoom,y.maxZoom),In=Ke/y.zoomScale(Xt-w);Ze=Math.sqrt(In/bt*2)}const Rt=Ze*Ze;function Ht(Xt){const In=(it*it-Ke*Ke+(Xt?-1:1)*Rt*Rt*bt*bt)/(2*(Xt?it:Ke)*Rt*bt);return Math.log(Math.sqrt(In*In+1)-In)}function Yt(Xt){return(Math.exp(Xt)-Math.exp(-Xt))/2}function jt(Xt){return(Math.exp(Xt)+Math.exp(-Xt))/2}const Ut=Ht(!1);let rn=function(Xt){return jt(Ut)/jt(Ut+Ze*Xt)},Tn=function(Xt){return Ke*((jt(Ut)*(Yt(In=Ut+Ze*Xt)/jt(In))-Yt(Ut))/Rt)/bt;var In},qt=(Ht(!0)-Ut)/Ze;if(Math.abs(bt)<1e-6||!isFinite(qt)){if(Math.abs(Ke-it)<1e-6)return this.easeTo(t,h);const Xt=it<Ke?-1:1;qt=Math.abs(Math.log(it/Ke))/Ze,Tn=()=>0,rn=In=>Math.exp(Xt*Ze*In)}return t.duration="duration"in t?+t.duration:1e3*qt/("screenSpeed"in t?+t.screenSpeed/Ze:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=P!==V,this._pitching=H!==D,this._padding=!y.isPaddingEqual(W),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Me),this._ease(Xt=>{const In=Xt*qt,Si=1/rn(In);y.zoom=Xt===1?Ne:w+y.scaleZoom(Si),this._rotating&&(y.bearing=l.y.number(P,V,Xt)),this._pitching&&(y.pitch=l.y.number(D,H,Xt)),this._padding&&(y.interpolatePadding(z,W,Xt),ge=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(Xt);const On=Xt===1?Me:y.unproject(qe.add(Ce.mult(Tn(In))).mult(Si));y.setLocationAtPoint(y.renderWorldCopies?On.wrap():On,ge),this._applyUpdatedTransform(y),this._fireMoveEvents(h)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,h){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}return t||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(t,h,_){_.animate===!1||_.duration===0?(t(1),h()):(this._easeStart=L.now(),this._easeOptions=_,this._onEaseFrame=t,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,h){t=l.b3(t,-180,180);const _=Math.abs(t-h);return Math.abs(t-360-h)<_&&(t-=360),Math.abs(t+360-h)<_&&(t+=360),t}_normalizeCenter(t,h){if(!h.renderWorldCopies||h.lngRange)return;const _=t.lng-h.center.lng;t.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ja={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ka{constructor(t=Ja){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,h){const _=this._map._getUIString(`AttributionControl.${h}`);t.title=_,t.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const w=h[y];if(w.used||w.usedForTerrain){const P=w.getSource();P.attribution&&t.indexOf(P.attribution)<0&&t.push(P.attribution)}}t=t.filter(y=>String(y).trim()),t.sort((y,w)=>y.length-w.length),t=t.filter((y,w)=>{for(let P=w+1;P<t.length;P++)if(t[P].indexOf(y)>=0)return!1;return!0});const _=t.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,t.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Oc{constructor(t={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const _=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const h=N.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class qn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const h=++this._id;return this._queue.push({callback:t,id:h,cancelled:!1}),h}remove(t){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const y of _)if(y.id===t)return void(y.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Fc=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ld extends l.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,h){this.sourceCache.update(t,h),this._renderableTilesKeys=[];const _={};for(const y of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))_[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),l.aP(y.posMatrix,0,l.X,0,l.X,0,1),this._tiles[y.key]=new As(y,this.tileSize));for(const y in this._tiles)_[y]||delete this._tiles[y]}freeRtt(t){for(const h in this._tiles){const _=this._tiles[h];(!t||_.tileID.equals(t)||_.tileID.isChildOf(t)||t.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const h={};for(const _ of this._renderableTilesKeys){const y=this._tiles[_].tileID;if(y.canonical.equals(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16),l.aP(w.posMatrix,0,l.X,0,l.X,0,1),h[_]=w}else if(y.canonical.isChildOf(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const P=y.canonical.z-t.canonical.z,D=y.canonical.x-(y.canonical.x>>P<<P),z=y.canonical.y-(y.canonical.y>>P<<P),V=l.X>>P;l.aP(w.posMatrix,0,V,0,V,0,1),l.J(w.posMatrix,w.posMatrix,[-D*V,-z*V,0]),h[_]=w}else if(t.canonical.isChildOf(y.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const P=t.canonical.z-y.canonical.z,D=t.canonical.x-(t.canonical.x>>P<<P),z=t.canonical.y-(t.canonical.y>>P<<P),V=l.X>>P;l.aP(w.posMatrix,0,l.X,0,l.X,0,1),l.J(w.posMatrix,w.posMatrix,[D*V,z*V,0]),l.K(w.posMatrix,w.posMatrix,[1/2**P,1/2**P,0]),h[_]=w}}return h}getSourceTile(t,h){const _=this.sourceCache._source;let y=t.overscaledZ-this.deltaZoom;if(y>_.maxzoom&&(y=_.maxzoom),y<_.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!w||!w.dem)&&h)for(;y>=_.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(t.scaledTo(y--).key);return w}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=t)}}class Bc{constructor(t,h,_){this.painter=t,this.sourceCache=new ld(h),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,h,_,y=l.X){var w;if(!(h>=0&&h<y&&_>=0&&_<y))return 0;const P=this.getTerrainData(t),D=(w=P.tile)===null||w===void 0?void 0:w.dem;if(!D)return 0;const z=function(ke,Me,Ne){var Oe=Me[0],qe=Me[1];return ke[0]=Ne[0]*Oe+Ne[4]*qe+Ne[12],ke[1]=Ne[1]*Oe+Ne[5]*qe+Ne[13],ke}([],[h/y*l.X,_/y*l.X],P.u_terrain_matrix),V=[z[0]*D.dim,z[1]*D.dim],H=Math.floor(V[0]),W=Math.floor(V[1]),ne=V[0]-H,ge=V[1]-W;return D.get(H,W)*(1-ne)*(1-ge)+D.get(H+1,W)*ne*(1-ge)+D.get(H,W+1)*(1-ne)*ge+D.get(H+1,W+1)*ne*ge}getElevationForLngLatZoom(t,h){if(!l.bb(h,t.wrap()))return 0;const{tileID:_,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(t,h);return this.getElevation(_,y%l.X,w%l.X,l.X)}getElevation(t,h,_,y=l.X){return this.getDEMElevation(t,h,_,y)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const y=this.painter.context,w=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(y,new l.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const h=this.sourceCache.getSourceTile(t,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new we(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const _=h&&h+h.tileID.key+t.key;if(_&&!this._demMatrixCache[_]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=t.canonical.z-h.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=y?w=t.canonical.z-y:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=t.canonical.x-(t.canonical.x>>w<<w),D=t.canonical.y-(t.canonical.y>>w<<w),z=l.bc(new Float64Array(16),[1/(l.X<<w),1/(l.X<<w),0]);l.J(z,z,[P*l.X,D*l.X,0]),this._demMatrixCache[t.key]={matrix:z,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(t){const h=this.painter,_=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(h.context,{width:_,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(h.context,{width:_,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(_,y,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,_,y))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,P=0;w<this._coordsTextureSize;w++)for(let D=0;D<this._coordsTextureSize;D++,P+=4)h[P+0]=255&D,h[P+1]=255&w,h[P+2]=D>>8<<4|w>>8,h[P+3]=0;const _=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new we(t,_,t.gl.RGBA,{premultiply:!1});return y.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),_=this.painter.context,y=_.gl,w=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,D-P-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const z=h[0]+(h[2]>>4<<8),V=h[1]+((15&h[2])<<8),H=this.coordsIndex[255-h[3]],W=H&&this.sourceCache.getTileByID(H);if(!W)return null;const ne=this._coordsTextureSize,ge=(1<<W.tileID.canonical.z)*ne;return new l.Z((W.tileID.canonical.x*ne+z)/ge+W.tileID.wrap,(W.tileID.canonical.y*ne+V)/ge,this.getElevation(W.tileID,z,V,ne))}depthAtPoint(t){const h=new Uint8Array(4),_=this.painter.context,y=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,h=new l.bd,_=new l.aY,y=this.meshSize,w=l.X/y,P=y*y;for(let W=0;W<=y;W++)for(let ne=0;ne<=y;ne++)h.emplaceBack(ne*w,W*w,0);for(let W=0;W<P;W+=y+1)for(let ne=0;ne<y;ne++)_.emplaceBack(ne+W,y+ne+W+1,y+ne+W+2),_.emplaceBack(ne+W,y+ne+W+2,ne+W+1);const D=h.length,z=D+2*(y+1);for(const W of[0,1])for(let ne=0;ne<=y;ne++)for(const ge of[0,1])h.emplaceBack(ne*w,W*l.X,ge);for(let W=0;W<2*y;W+=2)_.emplaceBack(z+W,z+W+1,z+W+3),_.emplaceBack(z+W,z+W+3,z+W+2),_.emplaceBack(D+W,D+W+3,D+W+1),_.emplaceBack(D+W,D+W+2,D+W+3);const V=h.length,H=V+2*(y+1);for(const W of[0,1])for(let ne=0;ne<=y;ne++)for(const ge of[0,1])h.emplaceBack(W*l.X,ne*w,ge);for(let W=0;W<2*y;W+=2)_.emplaceBack(V+W,V+W+1,V+W+3),_.emplaceBack(V+W,V+W+3,V+W+2),_.emplaceBack(H+W,H+W+3,H+W+1),_.emplaceBack(H+W,H+W+2,H+W+3);return this._mesh=new p(t.createVertexBuffer(h,Fc.members),t.createIndexBuffer(_),l.a0.simpleSegment(0,0,h.length,_.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,h){var _;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(t,h);return(_=this.getMinMaxElevation(y).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(t){const h=this.getTerrainData(t).tile,_={minElevation:null,maxElevation:null};return h&&h.dem&&(_.minElevation=h.dem.min*this.exaggeration,_.maxElevation=h.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(t,h){const _=l.Z.fromLngLat(t.wrap()),y=(1<<h)*l.X,w=_.x*y,P=_.y*y,D=Math.floor(w/l.X),z=Math.floor(P/l.X);return{tileID:new l.S(h,0,h,D,z),mercatorX:w,mercatorY:P}}}class ud{constructor(t,h,_){this._context=t,this._size=h,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new we(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(_.texture),{id:t,fbo:h,texture:_,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>t.id!==h),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Qa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class qh{constructor(t,h){this.painter=t,this.terrain=h,this.pool=new ud(t.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(_=>!t._layers[_].isHidden(h)),this._coordsDescendingInv={};for(const _ in t.sourceCaches){this._coordsDescendingInv[_]={};const y=t.sourceCaches[_].getVisibleCoordinates();for(const w of y){const P=this.terrain.sourceCache.getTerrainCoords(w);for(const D in P)this._coordsDescendingInv[_][D]||(this._coordsDescendingInv[_][D]=[]),this._coordsDescendingInv[_][D].push(P[D])}}this._coordsDescendingInvStr={};for(const _ of t._order){const y=t._layers[_],w=y.source;if(Qa[y.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const P in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][P]=this._coordsDescendingInv[w][P].map(D=>D.key).sort().join()}}for(const _ of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[y][_.tileID.key];w&&w!==_.rttCoords[y]&&(_.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const h=t.type,_=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Qa[h]&&(this._prevType&&Qa[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!y))return!0;if(Qa[this._prevType]||Qa[h]&&y){this._prevType=h;const w=this._stacks.length-1,P=this._stacks[w]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[w]){const V=this.pool.getObjectForId(D.rtt[w].id);if(V.stamp===D.rtt[w].stamp){this.pool.useObject(V);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),D.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:l.aM.transparent,stencil:0}),_.currentStencilSource=void 0;for(let V=0;V<P.length;V++){const H=_.style._layers[P[V]],W=H.source?this._coordsDescendingInv[H.source][D.tileID.key]:[D.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(H,W),_.renderLayer(_,_.style.sourceCaches[H.source],H,W),H.source&&(D.rttCoords[H.source]=this._coordsDescendingInvStr[H.source][D.tileID.key])}}return d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Qa[h]}return!1}}const Uc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=x,cd={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ja,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},jc=k=>{k.touchstart=k.dragStart,k.touchmoveWindow=k.dragMove,k.touchend=k.dragEnd},hd={showCompass:!0,showZoom:!0,visualizePitch:!1};class fd{constructor(t,h,_=!1){this.mousedown=P=>{this.startMouse(l.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),N.mousePos(this.element,P)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,N.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=t.dragRotate._mouseRotate.getClickTolerance(),w=t.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Cc({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:D,bearingDegreesPerPixelMoved:z=.8})=>{const V=new Tc;return new ks({clickTolerance:D,move:(H,W)=>({bearingDelta:(W.x-H.x)*z}),moveStateManager:V,enable:P,assignEvents:jc})})({clickTolerance:y,enable:!0}),this.map=t,_&&(this.mousePitch=Lc({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:D,pitchDegreesPerPixelMoved:z=-.5})=>{const V=new Tc;return new ks({clickTolerance:D,move:(H,W)=>({pitchDelta:(W.y-H.y)*z}),moveStateManager:V,enable:P,assignEvents:jc})})({clickTolerance:w,enable:!0})),N.addEventListener(h,"mousedown",this.mousedown),N.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(h,"touchcancel",this.reset)}startMouse(t,h){this.mouseRotate.dragStart(t,h),this.mousePitch&&this.mousePitch.dragStart(t,h),N.disableDrag()}startTouch(t,h){this.touchRotate.dragStart(t,h),this.touchPitch&&this.touchPitch.dragStart(t,h),N.disableDrag()}moveMouse(t,h){const _=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(t,h)||{};if(y&&_.setBearing(_.getBearing()+y),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(t,h)||{};w&&_.setPitch(_.getPitch()+w)}}moveTouch(t,h){const _=this.map,{bearingDelta:y}=this.touchRotate.dragMove(t,h)||{};if(y&&_.setBearing(_.getBearing()+y),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(t,h)||{};w&&_.setPitch(_.getPitch()+w)}}off(){const t=this.element;N.removeEventListener(t,"mousedown",this.mousedown),N.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let Is;function Ii(k,t,h){const _=new l.N(k.lng,k.lat);if(k=new l.N(k.lng,k.lat),t){const y=new l.N(k.lng-360,k.lat),w=new l.N(k.lng+360,k.lat),P=h.locationPoint(k).distSqr(t);h.locationPoint(y).distSqr(t)<P?k=y:h.locationPoint(w).distSqr(t)<P&&(k=w)}for(;Math.abs(k.lng-h.center.lng)>180;){const y=h.locationPoint(k);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;k.lng>h.center.lng?k.lng-=360:k.lng+=360}return k.lng!==_.lng&&h.locationPoint(k).y>h.height/2-h.getHorizon()?k:_}const el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vu(k,t,h){const _=k.classList;for(const y in el)_.remove(`maplibregl-${h}-anchor-${y}`);_.add(`maplibregl-${h}-anchor-${t}`)}class bu extends l.E{constructor(t){if(super(),this._onKeyPress=h=>{const _=h.code,y=h.charCode||h.keyCode;_!=="Space"&&_!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=h=>{const _=h.originalEvent.target,y=this._element;this._popup&&(_===y||y.contains(_))&&this.togglePopup()},this._update=h=>{var _;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ii(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${el[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${w}`),L.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const h=N.createNS("http://www.w3.org/2000/svg","svg"),_=41,y=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${_}px`),h.setAttributeNS(null,"width",`${y}px`),h.setAttributeNS(null,"viewBox",`0 0 ${y} ${_}`);const w=N.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const P=N.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const D=N.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Oe of z){const qe=N.createNS("http://www.w3.org/2000/svg","ellipse");qe.setAttributeNS(null,"opacity","0.04"),qe.setAttributeNS(null,"cx","10.5"),qe.setAttributeNS(null,"cy","5.80029008"),qe.setAttributeNS(null,"rx",Oe.rx),qe.setAttributeNS(null,"ry",Oe.ry),D.appendChild(qe)}const V=N.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill",this._color);const H=N.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),V.appendChild(H);const W=N.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const ne=N.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(ne);const ge=N.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");const ke=N.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=N.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const Ne=N.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Me),ke.appendChild(Ne),P.appendChild(D),P.appendChild(V),P.appendChild(W),P.appendChild(ge),P.appendChild(ke),h.appendChild(P),h.setAttributeNS(null,"height",_*this._scale+"px"),h.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(h),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),vu(this._element,this._anchor,"marker"),t&&t.className)for(const h of t.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var h,_;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),P=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,P)-w<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/y.transform._pixelPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*D,V=y.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),H=y.transform.lngLatToCameraDepth(this._lngLat,P+z)-V>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,h){return t===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Zh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let jl=0,Vl=!1;const co={maxWidth:100,unit:"metric"};function ql(k,t,h){const _=h&&h.maxWidth||100,y=k._container.clientHeight/2,w=k.unproject([0,y]),P=k.unproject([_,y]),D=w.distanceTo(P);if(h&&h.unit==="imperial"){const z=3.2808*D;z>5280?nn(t,_,z/5280,k._getUIString("ScaleControl.Miles")):nn(t,_,z,k._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?nn(t,_,D/1852,k._getUIString("ScaleControl.NauticalMiles")):D>=1e3?nn(t,_,D/1e3,k._getUIString("ScaleControl.Kilometers")):nn(t,_,D,k._getUIString("ScaleControl.Meters"))}function nn(k,t,h,_){const y=function(w){const P=Math.pow(10,`${Math.floor(w)}`.length-1);let D=w/P;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(z){const V=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*V)/V}(D),P*D}(h);k.style.width=t*(y/h)+"px",k.innerHTML=`${y}&nbsp;${_}`}const vn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},xu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wu(k){if(k){if(typeof k=="number"){const t=Math.round(Math.abs(k)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,k),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-k),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(k,0),right:new l.P(-k,0)}}if(k instanceof l.P||Array.isArray(k)){const t=l.P.convert(k);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(k.center||[0,0]),top:l.P.convert(k.top||[0,0]),"top-left":l.P.convert(k["top-left"]||[0,0]),"top-right":l.P.convert(k["top-right"]||[0,0]),bottom:l.P.convert(k.bottom||[0,0]),"bottom-left":l.P.convert(k["bottom-left"]||[0,0]),"bottom-right":l.P.convert(k["bottom-right"]||[0,0]),left:l.P.convert(k.left||[0,0]),right:l.P.convert(k.right||[0,0])}}return wu(new l.P(0,0))}const Vc=x;g.AJAXError=l.bh,g.Evented=l.E,g.LngLat=l.N,g.MercatorCoordinate=l.Z,g.Point=l.P,g.addProtocol=l.bi,g.config=l.a,g.removeProtocol=l.bj,g.AttributionControl=Ka,g.BoxZoomHandler=dr,g.CanvasSource=qi,g.CooperativeGesturesHandler=Ya,g.DoubleClickZoomHandler=ka,g.DragPanHandler=Uh,g.DragRotateHandler=jh,g.EdgeInsets=q,g.FullscreenControl=class extends l.E{constructor(k={}){super(),this._onFullscreenChange=()=>{var t;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=h==null?void 0:h.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,k&&k.container&&(k.container instanceof HTMLElement?this._container=k.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(k){return this._map=k,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const k=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",k).setAttribute("aria-hidden","true"),k.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const k=this._getTitle();this._fullscreenButton.setAttribute("aria-label",k),this._fullscreenButton.title=k}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},g.GeoJSONSource=_n,g.GeolocateControl=class extends l.E{constructor(k){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const h=new l.N(t.coords.longitude,t.coords.latitude),_=t.coords.accuracy,y=this._map.getBearing(),w=l.e({bearing:y},this.options.fitBoundsOptions),P=Ye.fromLngLat(h,_);this._map.fitBounds(P,w,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const h=new l.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Vl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bu({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Zh,k)}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(t=!1){if(Is!==void 0&&!t)return Is;if(window.navigator.permissions===void 0)return Is=!!window.navigator.geolocation,Is;try{Is=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Is=!!window.navigator.geolocation}return Is})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,jl=0,Vl=!1}_isOutOfMapMaxBounds(k){const t=this._map.getMaxBounds(),h=k.coords;return t&&(h.longitude<t.getWest()||h.longitude>t.getEast()||h.latitude<t.getSouth()||h.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const k=this._map.getBounds(),t=k.getSouthEast(),h=k.getNorthEast(),_=t.distanceTo(h),y=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jl--,Vl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let k;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),jl++,jl>1?(k={maximumAge:6e5,timeout:0},Vl=!0):(k=this.options.positionOptions,Vl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,k)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},g.Hash=$e,g.ImageSource=Yi,g.KeyboardHandler=Ds,g.LngLatBounds=Ye,g.LogoControl=Oc,g.Map=class extends Vh{constructor(k){l.bf.mark(l.bg.create);const t=Object.assign(Object.assign({},cd),k);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new me(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new qn,this._controls=[],this._mapId=l.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Uc),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=$.addThrottleControl(()=>this.isMoving()),this._requestManager=new fe(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const _=Ue(y=>{this._trackResize&&!this._removed&&(this.resize(y),this.redraw())},50);this._resizeObserver=new ResizeObserver(y=>{h?_(y):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,t),this._hash=t.hash&&new $e(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,l.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Ka(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Oc,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(k,t){if(t===void 0&&(t=k.getDefaultPosition?k.getDefaultPosition():"top-right"),!k||!k.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=k.onAdd(this);this._controls.push(k);const _=this._controlPositions[t];return t.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(k){if(!k||!k.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(k);return t>-1&&this._controls.splice(t,1),k.onRemove(this),this}hasControl(k){return this._controls.indexOf(k)>-1}calculateCameraOptionsFromTo(k,t,h,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(k,t,h,_)}resize(k){var t;const h=this._containerDimensions(),_=h[0],y=h[1],w=this._getClampedPixelRatio(_,y);if(this._resizeCanvas(_,y,w),this.painter.resize(_,y,w),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const z=this._getClampedPixelRatio(_,y);this._resizeCanvas(_,y,z),this.painter.resize(_,y,z)}this.transform.resize(_,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(_,y);const P=!this._moving;return P&&(this.stop(),this.fire(new l.k("movestart",k)).fire(new l.k("move",k))),this.fire(new l.k("resize",k)),P&&this.fire(new l.k("moveend",k)),this}_getClampedPixelRatio(k,t){const{0:h,1:_}=this._maxCanvasSize,y=this.getPixelRatio(),w=k*y,P=t*y;return Math.min(w>h?h/w:1,P>_?_/P:1)*y}getPixelRatio(){var k;return(k=this._overridePixelRatio)!==null&&k!==void 0?k:devicePixelRatio}setPixelRatio(k){this._overridePixelRatio=k,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(k){return this.transform.setMaxBounds(Ye.convert(k)),this._update()}setMinZoom(k){if((k=k??-2)>=-2&&k<=this.transform.maxZoom)return this.transform.minZoom=k,this._update(),this.getZoom()<k&&this.setZoom(k),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(k){if((k=k??22)>=this.transform.minZoom)return this.transform.maxZoom=k,this._update(),this.getZoom()>k&&this.setZoom(k),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(k){if((k=k??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(k>=0&&k<=this.transform.maxPitch)return this.transform.minPitch=k,this._update(),this.getPitch()<k&&this.setPitch(k),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(k){if((k=k??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(k>=this.transform.minPitch)return this.transform.maxPitch=k,this._update(),this.getPitch()>k&&this.setPitch(k),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(k){return this.transform.renderWorldCopies=k,this._update()}project(k){return this.transform.locationPoint(l.N.convert(k),this.style&&this.terrain)}unproject(k){return this.transform.pointLocation(l.P.convert(k),this.terrain)}isMoving(){var k;return this._moving||((k=this.handlers)===null||k===void 0?void 0:k.isMoving())}isZooming(){var k;return this._zooming||((k=this.handlers)===null||k===void 0?void 0:k.isZooming())}isRotating(){var k;return this._rotating||((k=this.handlers)===null||k===void 0?void 0:k.isRotating())}_createDelegatedListener(k,t,h){if(k==="mouseenter"||k==="mouseover"){let _=!1;return{layers:t,listener:h,delegates:{mousemove:w=>{const P=t.filter(z=>this.getLayer(z)),D=P.length!==0?this.queryRenderedFeatures(w.point,{layers:P}):[];D.length?_||(_=!0,h.call(this,new li(k,this,w.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(k==="mouseleave"||k==="mouseout"){let _=!1;return{layers:t,listener:h,delegates:{mousemove:P=>{const D=t.filter(z=>this.getLayer(z));(D.length!==0?this.queryRenderedFeatures(P.point,{layers:D}):[]).length?_=!0:_&&(_=!1,h.call(this,new li(k,this,P.originalEvent)))},mouseout:P=>{_&&(_=!1,h.call(this,new li(k,this,P.originalEvent)))}}}}{const _=y=>{const w=t.filter(D=>this.getLayer(D)),P=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];P.length&&(y.features=P,h.call(this,y),delete y.features)};return{layers:t,listener:h,delegates:{[k]:_}}}}_saveDelegatedListener(k,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[k]=this._delegatedListeners[k]||[],this._delegatedListeners[k].push(t)}_removeDelegatedListener(k,t,h){if(!this._delegatedListeners||!this._delegatedListeners[k])return;const _=this._delegatedListeners[k];for(let y=0;y<_.length;y++){const w=_[y];if(w.listener===h&&w.layers.length===t.length&&w.layers.every(P=>t.includes(P))){for(const P in w.delegates)this.off(P,w.delegates[P]);return void _.splice(y,1)}}}on(k,t,h){if(h===void 0)return super.on(k,t);const _=this._createDelegatedListener(k,typeof t=="string"?[t]:t,h);this._saveDelegatedListener(k,_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(k,t,h){if(h===void 0)return super.once(k,t);const _=typeof t=="string"?[t]:t,y=this._createDelegatedListener(k,_,h);for(const w in y.delegates){const P=y.delegates[w];y.delegates[w]=(...D)=>{this._removeDelegatedListener(k,_,h),P(...D)}}this._saveDelegatedListener(k,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(k,t,h){return h===void 0?super.off(k,t):(this._removeDelegatedListener(k,typeof t=="string"?[t]:t,h),this)}queryRenderedFeatures(k,t){if(!this.style)return[];let h;const _=k instanceof l.P||Array.isArray(k),y=_?k:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(_?{}:k)||{},y instanceof l.P||typeof y[0]=="number")h=[l.P.convert(y)];else{const w=l.P.convert(y[0]),P=l.P.convert(y[1]);h=[w,new l.P(P.x,w.y),P,new l.P(w.x,P.y),w]}return this.style.queryRenderedFeatures(h,t,this.transform)}querySourceFeatures(k,t){return this.style.querySourceFeatures(k,t)}setStyle(k,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&k?(this._diffStyle(k,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(k,t))}setTransformRequest(k){return this._requestManager.setTransformRequest(k),this}_getUIString(k){const t=this._locale[k];if(t==null)throw new Error(`Missing UI string '${k}'`);return t}_updateStyle(k,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(k,t));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!k)),k?(this.style=new ca(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof k=="string"?this.style.loadURL(k,t,h):this.style.loadJSON(k,t,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(k,t){if(typeof k=="string"){const h=this._requestManager.transformRequest(k,"Style");l.h(h,new AbortController).then(_=>{this._updateDiff(_.data,t)}).catch(_=>{_&&this.fire(new l.j(_))})}else typeof k=="object"&&this._updateDiff(k,t)}_updateDiff(k,t){try{this.style.setState(k,t)&&this._update(!0)}catch(h){l.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(k,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(k,t){return this._lazyInitEmptyStyle(),this.style.addSource(k,t),this._update(!0)}isSourceLoaded(k){const t=this.style&&this.style.sourceCaches[k];if(t!==void 0)return t.loaded();this.fire(new l.j(new Error(`There is no source with ID '${k}'`)))}setTerrain(k){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),k){const t=this.style.sourceCaches[k.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${k.source}`);this.terrain===null&&t.reload();for(const h in this.style._layers){const _=this.style._layers[h];_.type==="hillshade"&&_.source===k.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bc(this.painter,t,k),this.painter.renderToTexture=new qh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==k.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:k})),this}getTerrain(){var k,t;return(t=(k=this.terrain)===null||k===void 0?void 0:k.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const k=this.style&&this.style.sourceCaches;for(const t in k){const h=k[t]._tiles;for(const _ in h){const y=h[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(k){return this.style.removeSource(k),this._update(!0)}getSource(k){return this.style.getSource(k)}addImage(k,t,h={}){const{pixelRatio:_=1,sdf:y=!1,stretchX:w,stretchY:P,content:D,textFitWidth:z,textFitHeight:V}=h;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:W,data:ne}=t,ge=t;return this.style.addImage(k,{data:new l.R({width:H,height:W},new Uint8Array(ne)),pixelRatio:_,stretchX:w,stretchY:P,content:D,textFitWidth:z,textFitHeight:V,sdf:y,version:0,userImage:ge}),ge.onAdd&&ge.onAdd(this,k),this}}{const{width:H,height:W,data:ne}=L.getImageData(t);this.style.addImage(k,{data:new l.R({width:H,height:W},ne),pixelRatio:_,stretchX:w,stretchY:P,content:D,textFitWidth:z,textFitHeight:V,sdf:y,version:0})}}updateImage(k,t){const h=this.style.getImage(k);if(!h)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||l.b(t)?L.getImageData(t):t,{width:y,height:w,data:P}=_;if(y===void 0||w===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||w!==h.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(t instanceof HTMLImageElement||l.b(t));return h.data.replace(P,D),this.style.updateImage(k,h),this}getImage(k){return this.style.getImage(k)}hasImage(k){return k?!!this.style.getImage(k):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(k){this.style.removeImage(k)}loadImage(k){return $.getImage(this._requestManager.transformRequest(k,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(k,t){return this._lazyInitEmptyStyle(),this.style.addLayer(k,t),this._update(!0)}moveLayer(k,t){return this.style.moveLayer(k,t),this._update(!0)}removeLayer(k){return this.style.removeLayer(k),this._update(!0)}getLayer(k){return this.style.getLayer(k)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(k,t,h){return this.style.setLayerZoomRange(k,t,h),this._update(!0)}setFilter(k,t,h={}){return this.style.setFilter(k,t,h),this._update(!0)}getFilter(k){return this.style.getFilter(k)}setPaintProperty(k,t,h,_={}){return this.style.setPaintProperty(k,t,h,_),this._update(!0)}getPaintProperty(k,t){return this.style.getPaintProperty(k,t)}setLayoutProperty(k,t,h,_={}){return this.style.setLayoutProperty(k,t,h,_),this._update(!0)}getLayoutProperty(k,t){return this.style.getLayoutProperty(k,t)}setGlyphs(k,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(k,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(k,t,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(k,t,h,_=>{_||this._update(!0)}),this}removeSprite(k){return this._lazyInitEmptyStyle(),this.style.removeSprite(k),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(k,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(k,t,h=>{h||this._update(!0)}),this}setLight(k,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(k,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(k){return this._lazyInitEmptyStyle(),this.style.setSky(k),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(k,t){return this.style.setFeatureState(k,t),this._update()}removeFeatureState(k,t){return this.style.removeFeatureState(k,t),this._update()}getFeatureState(k){return this.style.getFeatureState(k)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let k=0,t=0;return this._container&&(k=this._container.clientWidth||400,t=this._container.clientHeight||300),[k,t]}_setupContainer(){const k=this._container;k.classList.add("maplibregl-map");const t=this._canvasContainer=N.create("div","maplibregl-canvas-container",k);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),_=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],_);const y=this._controlContainer=N.create("div","maplibregl-control-container",k),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{w[P]=N.create("div",`maplibregl-ctrl-${P} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(k,t,h){this._canvas.width=Math.floor(h*k),this._canvas.height=Math.floor(h*t),this._canvas.style.width=`${k}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const k={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{t={requestedAttributes:k},_&&(t.statusMessage=_.statusMessage,t.type=_.type)},{once:!0});const h=this._canvas.getContext("webgl2",k)||this._canvas.getContext("webgl",k);if(!h){const _="Failed to initialize WebGL";throw t?(t.message=_,new Error(JSON.stringify(t))):new Error(_)}this.painter=new b(h,this.transform),B.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(k){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||k,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(k){return this._update(),this._renderTaskQueue.add(k)}_cancelRenderFrame(k){this._renderTaskQueue.remove(k)}_render(k){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(k),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,w=L.now();this.style.zoomHistory.update(y,w);const P=new l.z(y,{now:w,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=P.crossFadingFactor();D===1&&D===this._crossFadingFactor||(h=!0,this._crossFadingFactor=D),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var k;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$.removeThrottleControl(this._imageQueueHandle),(k=this._resizeObserver)===null||k===void 0||k.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then(k=>{l.bf.frame(k),this._frameRequest=null,this._render(k)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(k){this._showTileBoundaries!==k&&(this._showTileBoundaries=k,this._update())}get showPadding(){return!!this._showPadding}set showPadding(k){this._showPadding!==k&&(this._showPadding=k,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(k){this._showCollisionBoxes!==k&&(this._showCollisionBoxes=k,k?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(k){this._showOverdrawInspector!==k&&(this._showOverdrawInspector=k,this._update())}get repaint(){return!!this._repaint}set repaint(k){this._repaint!==k&&(this._repaint=k,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(k){this._vertices=k,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}},g.MapMouseEvent=li,g.MapTouchEvent=er,g.MapWheelEvent=rs,g.Marker=bu,g.NavigationControl=class{constructor(k){this._updateZoomButtons=()=>{const t=this._map.getZoom(),h=t===this._map.getMaxZoom(),_=t===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,h)=>{const _=this._map._getUIString(`NavigationControl.${h}`);t.title=_,t.setAttribute("aria-label",_)},this.options=l.e({},hd,k),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(k){return this._map=k,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(k,t){const h=N.create("button",k,this._container);return h.type="button",h.addEventListener("click",t),h}},g.Popup=class extends l.E{constructor(k){super(),this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ii(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!t)return;const _=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let y=this.options.anchor;const w=wu(this.options.offset);if(!y){const D=this._container.offsetWidth,z=this._container.offsetHeight;let V;V=_.y+w.bottom.y<z?["top"]:_.y>this._map.transform.height-z?["bottom"]:[],_.x<D/2?V.push("left"):_.x>this._map.transform.width-D/2&&V.push("right"),y=V.length===0?"bottom":V.join("-")}let P=_.add(w[y]);this.options.subpixelPositioning||(P=P.round()),N.setTransform(this._container,`${el[y]} translate(${P.x}px,${P.y}px)`),vu(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(vn),k)}addTo(k){return this._map&&this.remove(),this._map=k,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(k){return this._lngLat=l.N.convert(k),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(k){return this.setDOMContent(document.createTextNode(k))}setHTML(k){const t=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=k;_=h.firstChild,_;)t.appendChild(_);return this.setDOMContent(t)}getMaxWidth(){var k;return(k=this._container)===null||k===void 0?void 0:k.style.maxWidth}setMaxWidth(k){return this.options.maxWidth=k,this._update(),this}setDOMContent(k){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(k),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(k){return this._container&&this._container.classList.add(k),this}removeClassName(k){return this._container&&this._container.classList.remove(k),this}setOffset(k){return this.options.offset=k,this._update(),this}toggleClassName(k){if(this._container)return this._container.classList.toggle(k)}setSubpixelPositioning(k){this.options.subpixelPositioning=k}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const k=this._container.querySelector(xu);k&&k.focus()}},g.RasterDEMTileSource=Gt,g.RasterTileSource=Ee,g.ScaleControl=class{constructor(k){this._onMove=()=>{ql(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ql(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},co),k)}getDefaultPosition(){return"bottom-left"}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",k.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},g.ScrollZoomHandler=Zs,g.Style=ca,g.TerrainControl=class{constructor(k){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=k}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},g.TwoFingersTouchPitchHandler=$a,g.TwoFingersTouchRotateHandler=Rc,g.TwoFingersTouchZoomHandler=Ac,g.TwoFingersTouchZoomRotateHandler=Nc,g.VectorTileSource=Vt,g.VideoSource=xn,g.addSourceType=(k,t)=>l._(void 0,void 0,void 0,function*(){if(Jr(k))throw new Error(`A source type called "${k}" already exists.`);((h,_)=>{Ji[h]=_})(k,t)}),g.clearPrewarmedResources=function(){const k=Rn;k&&(k.isPreloaded()&&k.numActive()===1?(k.release(It),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},g.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},g.getRTLTextPluginStatus=function(){return mn().getRTLTextPluginStatus()},g.getVersion=function(){return Vc},g.getWorkerCount=function(){return Jt.workerCount},g.getWorkerUrl=function(){return l.a.WORKER_URL},g.importScriptInWorkers=function(k){return Ft().broadcast("IS",k)},g.prewarm=function(){Wn().acquire(It)},g.setMaxParallelImageRequests=function(k){l.a.MAX_PARALLEL_IMAGE_REQUESTS=k},g.setRTLTextPlugin=function(k,t){return mn().setRTLTextPlugin(k,t)},g.setWorkerCount=function(k){Jt.workerCount=k},g.setWorkerUrl=function(k){l.a.WORKER_URL=k}});var f=i;return f})})(Y0);var sx=Y0.exports;const Ls=rx(sx);var ox=Object.defineProperty,ax=(r,e,i)=>e in r?ox(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i,qg=(r,e,i)=>ax(r,typeof e!="symbol"?e+"":e,i);function Lh(){}function K0(r){return r()}function Gg(){return Object.create(null)}function nd(r){r.forEach(K0)}function Q0(r){return typeof r=="function"}function lx(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function ux(r){return Object.keys(r).length===0}function cx(r,e){r.appendChild(e)}function hx(r,e,i){r.insertBefore(e,i||null)}function ev(r){r.parentNode&&r.parentNode.removeChild(r)}function Zg(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function dl(r,e,i){i==null?r.removeAttribute(e):r.getAttribute(e)!==i&&r.setAttribute(e,i)}function fx(r){return Array.from(r.childNodes)}function _f(r,e,i){r.classList.toggle(e,!!i)}let Vp;function wh(r){Vp=r}const Wu=[],Hg=[];let ec=[];const Wg=[],dx=Promise.resolve();let _p=!1;function px(){_p||(_p=!0,dx.then(tv))}function yp(r){ec.push(r)}const rp=new Set;let ju=0;function tv(){if(ju!==0)return;const r=Vp;do{try{for(;ju<Wu.length;){const e=Wu[ju];ju++,wh(e),mx(e.$$)}}catch(e){throw Wu.length=0,ju=0,e}for(wh(null),Wu.length=0,ju=0;Hg.length;)Hg.pop()();for(let e=0;e<ec.length;e+=1){const i=ec[e];rp.has(i)||(rp.add(i),i())}ec.length=0}while(Wu.length);for(;Wg.length;)Wg.pop()();_p=!1,rp.clear(),wh(r)}function mx(r){if(r.fragment!==null){r.update(),nd(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(yp)}}function gx(r){const e=[],i=[];ec.forEach(s=>r.indexOf(s)===-1?e.push(s):i.push(s)),i.forEach(s=>s()),ec=e}const _x=new Set;function yx(r,e){r&&r.i&&(_x.delete(r),r.i(e))}function vx(r,e,i){const{fragment:s,after_update:a}=r.$$;s&&s.m(e,i),yp(()=>{const f=r.$$.on_mount.map(K0).filter(Q0);r.$$.on_destroy?r.$$.on_destroy.push(...f):nd(f),r.$$.on_mount=[]}),a.forEach(yp)}function bx(r,e){const i=r.$$;i.fragment!==null&&(gx(i.after_update),nd(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function xx(r,e){r.$$.dirty[0]===-1&&(Wu.push(r),px(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function wx(r,e,i,s,a,f,g=null,l=[-1]){const x=Vp;wh(r);const E=r.$$={fragment:null,ctx:[],props:f,update:Lh,not_equal:a,bound:Gg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:Gg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};g&&g(E.root);let C=!1;if(E.ctx=i?i(r,e.props||{},(L,N,...B)=>{const U=B.length?B[0]:N;return E.ctx&&a(E.ctx[L],E.ctx[L]=U)&&(!E.skip_bound&&E.bound[L]&&E.bound[L](U),C&&xx(r,L)),N}):[],E.update(),C=!0,nd(E.before_update),E.fragment=s?s(E.ctx):!1,e.target){if(e.hydrate){const L=fx(e.target);E.fragment&&E.fragment.l(L),L.forEach(ev)}else E.fragment&&E.fragment.c();e.intro&&yx(r.$$.fragment),vx(r,e.target,e.anchor),tv()}wh(x)}class kx{constructor(){qg(this,"$$"),qg(this,"$$set")}$destroy(){bx(this,1),this.$destroy=Lh}$on(e,i){if(!Q0(i))return Lh;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(i),()=>{const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}$set(e){this.$$set&&!ux(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ix="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ix);function Sx(r){let e,i,s;return{c(){e=Zg("svg"),i=Zg("path"),dl(i,"stroke-width","4"),dl(i,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),dl(i,"class","svelte-gzo3ar"),dl(e,"width",s=r[0]==="list"?20:void 0),dl(e,"viewBox","0 0 70 85"),dl(e,"fill","none"),dl(e,"class","svelte-gzo3ar"),_f(e,"in-map",r[0]!=="list"),_f(e,"list-icon",r[0]==="list")},m(a,f){hx(a,e,f),cx(e,i)},p(a,[f]){f&1&&s!==(s=a[0]==="list"?20:void 0)&&dl(e,"width",s),f&1&&_f(e,"in-map",a[0]!=="list"),f&1&&_f(e,"list-icon",a[0]==="list")},i:Lh,o:Lh,d(a){a&&ev(e)}}}function Ex(r,e,i){let{displayIn:s}=e;return r.$$set=a=>{"displayIn"in a&&i(0,s=a.displayIn)},[s]}class Tx extends kx{constructor(e){super(),wx(this,e,Ex,Sx,lx,{displayIn:0})}}const Cx=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Lx={decimalLatitude:40.123,decimalLongitude:-74.123},Mx=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Ax=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Px(){const r=[];return Cx.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...Lx})}),[...r,...Mx,...Ax]}const Rx=Px();Rx.map(r=>r.verbatimCoordinates);var Us=63710088e-1,nv={centimeters:Us*100,centimetres:Us*100,degrees:360/(2*Math.PI),feet:Us*3.28084,inches:Us*39.37,kilometers:Us/1e3,kilometres:Us/1e3,meters:Us,metres:Us,miles:Us/1609.344,millimeters:Us*1e3,millimetres:Us*1e3,nauticalmiles:Us/1852,radians:1,yards:Us*1.0936};function zh(r,e,i={}){const s={type:"Feature"};return(i.id===0||i.id)&&(s.id=i.id),i.bbox&&(s.bbox=i.bbox),s.properties=e||{},s.geometry=r,s}function Dx(r,e,i={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xg(r[0])||!Xg(r[1]))throw new Error("coordinates must contain numbers");return zh({type:"Point",coordinates:r},e,i)}function qp(r,e,i={}){for(const s of r){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return zh({type:"Polygon",coordinates:r},e,i)}function iu(r,e={}){const i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=r,i}function iv(r,e,i={}){return zh({type:"MultiPolygon",coordinates:r},e,i)}function Nx(r,e="kilometers"){const i=nv[e];if(!i)throw new Error(e+" units is invalid");return r*i}function zx(r,e="kilometers"){const i=nv[e];if(!i)throw new Error(e+" units is invalid");return r/i}function Xg(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ox(r,e){var i={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},s,a,f,g;return g={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function l(E){return function(C){return x([E,C])}}function x(E){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,a&&(f=E[0]&2?a.return:E[0]?a.throw||((f=a.return)&&f.call(a),0):a.next)&&!(f=f.call(a,E[1])).done)return f;switch(a=0,f&&(E=[E[0]&2,f.value]),E[0]){case 0:case 1:f=E;break;case 4:return i.label++,{value:E[1],done:!1};case 5:i.label++,a=E[1],E=[0];continue;case 7:E=i.ops.pop(),i.trys.pop();continue;default:if(f=i.trys,!(f=f.length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){i=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){i.label=E[1];break}if(E[0]===6&&i.label<f[1]){i.label=f[1],f=E;break}if(f&&i.label<f[2]){i.label=f[2],i.ops.push(E);break}f[2]&&i.ops.pop(),i.trys.pop();continue}E=e.call(r,i)}catch(C){E=[6,C],a=0}finally{s=f=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}var xl=function(){function r(e,i){this.next=null,this.key=e,this.data=i,this.left=null,this.right=null}return r}();function Fx(r,e){return r>e?1:r<e?-1:0}function gl(r,e,i){for(var s=new xl(null,null),a=s,f=s;;){var g=i(r,e.key);if(g<0){if(e.left===null)break;if(i(r,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}f.left=e,f=e,e=e.left}else if(g>0){if(e.right===null)break;if(i(r,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}a.right=e,a=e,e=e.right}else break}return a.right=e.left,f.left=e.right,e.left=s.right,e.right=s.left,e}function sp(r,e,i,s){var a=new xl(r,e);if(i===null)return a.left=a.right=null,a;i=gl(r,i,s);var f=s(r,i.key);return f<0?(a.left=i.left,a.right=i,i.left=null):f>=0&&(a.right=i.right,a.left=i,i.right=null),a}function $g(r,e,i){var s=null,a=null;if(e){e=gl(r,e,i);var f=i(e.key,r);f===0?(s=e.left,a=e.right):f<0?(a=e.right,e.right=null,s=e):(s=e.left,e.left=null,a=e)}return{left:s,right:a}}function Bx(r,e,i){return e===null?r:(r===null||(e=gl(r.key,e,i),e.left=r),e)}function vp(r,e,i,s,a){if(r){s(""+e+(i?" ":" ")+a(r)+`
`);var f=e+(i?"    ":"   ");r.left&&vp(r.left,f,!1,s,a),r.right&&vp(r.right,f,!0,s,a)}}var Gp=function(){function r(e){e===void 0&&(e=Fx),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,i){return this._size++,this._root=sp(e,i,this._root,this._comparator)},r.prototype.add=function(e,i){var s=new xl(e,i);this._root===null&&(s.left=s.right=null,this._size++,this._root=s);var a=this._comparator,f=gl(e,this._root,a),g=a(e,f.key);return g===0?this._root=f:(g<0?(s.left=f.left,s.right=f,f.left=null):g>0&&(s.right=f.right,s.left=f,f.right=null),this._size++,this._root=s),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,i,s){var a;if(i===null)return null;i=gl(e,i,s);var f=s(e,i.key);return f===0?(i.left===null?a=i.right:(a=gl(e,i.left,s),a.right=i.right),this._size--,a):i},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=gl(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var i=this._root,s=this._comparator;i;){var a=s(e,i.key);if(a===0)return i;a<0?i=i.left:i=i.right}return null},r.prototype.find=function(e){return this._root&&(this._root=gl(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var i=this._root,s=this._comparator;i;){var a=s(e,i.key);if(a===0)return!0;a<0?i=i.left:i=i.right}return!1},r.prototype.forEach=function(e,i){for(var s=this._root,a=[],f=!1;!f;)s!==null?(a.push(s),s=s.left):a.length!==0?(s=a.pop(),e.call(i,s),s=s.right):f=!0;return this},r.prototype.range=function(e,i,s,a){for(var f=[],g=this._comparator,l=this._root,x;f.length!==0||l;)if(l)f.push(l),l=l.left;else{if(l=f.pop(),x=g(l.key,i),x>0)break;if(g(l.key,e)>=0&&s.call(a,l))return this;l=l.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(i){var s=i.key;return e.push(s)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(i){var s=i.data;return e.push(s)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var i=this._root,s=!1,a=0,f=[];!s;)if(i)f.push(i),i=i.left;else if(f.length>0){if(i=f.pop(),a===e)return i;a++,i=i.right}else s=!0;return null},r.prototype.next=function(e){var i=this._root,s=null;if(e.right){for(s=e.right;s.left;)s=s.left;return s}for(var a=this._comparator;i;){var f=a(e.key,i.key);if(f===0)break;f<0?(s=i,i=i.left):i=i.right}return s},r.prototype.prev=function(e){var i=this._root,s=null;if(e.left!==null){for(s=e.left;s.right;)s=s.right;return s}for(var a=this._comparator;i;){var f=a(e.key,i.key);if(f===0)break;f<0?i=i.left:(s=i,i=i.right)}return s},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return jx(this._root)},r.prototype.load=function(e,i,s){i===void 0&&(i=[]),s===void 0&&(s=!1);var a=e.length,f=this._comparator;if(s&&wp(e,i,0,a-1,f),this._root===null)this._root=bp(e,i,0,a),this._size=a;else{var g=Vx(this.toList(),Ux(e,i),f);a=this._size+a,this._root=xp({head:g},0,a)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(s){return String(s.key)});var i=[];return vp(this._root,"",!0,function(s){return i.push(s)},e),i.join("")},r.prototype.update=function(e,i,s){var a=this._comparator,f=$g(e,this._root,a),g=f.left,l=f.right;a(e,i)<0?l=sp(i,s,l,a):g=sp(i,s,g,a),this._root=Bx(g,l,a)},r.prototype.split=function(e){return $g(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,i,s;return Ox(this,function(a){switch(a.label){case 0:e=this._root,i=[],s=!1,a.label=1;case 1:return s?[3,6]:e===null?[3,2]:(i.push(e),e=e.left,[3,5]);case 2:return i.length===0?[3,4]:(e=i.pop(),[4,e]);case 3:return a.sent(),e=e.right,[3,5];case 4:s=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function bp(r,e,i,s){var a=s-i;if(a>0){var f=i+Math.floor(a/2),g=r[f],l=e[f],x=new xl(g,l);return x.left=bp(r,e,i,f),x.right=bp(r,e,f+1,s),x}return null}function Ux(r,e){for(var i=new xl(null,null),s=i,a=0;a<r.length;a++)s=s.next=new xl(r[a],e[a]);return s.next=null,i.next}function jx(r){for(var e=r,i=[],s=!1,a=new xl(null,null),f=a;!s;)e?(i.push(e),e=e.left):i.length>0?(e=f=f.next=i.pop(),e=e.right):s=!0;return f.next=null,a.next}function xp(r,e,i){var s=i-e;if(s>0){var a=e+Math.floor(s/2),f=xp(r,e,a),g=r.head;return g.left=f,r.head=r.head.next,g.right=xp(r,a+1,i),g}return null}function Vx(r,e,i){for(var s=new xl(null,null),a=s,f=r,g=e;f!==null&&g!==null;)i(f.key,g.key)<0?(a.next=f,f=f.next):(a.next=g,g=g.next),a=a.next;return f!==null?a.next=f:g!==null&&(a.next=g),s.next}function wp(r,e,i,s,a){if(!(i>=s)){for(var f=r[i+s>>1],g=i-1,l=s+1;;){do g++;while(a(r[g],f)<0);do l--;while(a(r[l],f)>0);if(g>=l)break;var x=r[g];r[g]=r[l],r[l]=x,x=e[g],e[g]=e[l],e[l]=x}wp(r,e,i,l,a),wp(r,e,l+1,s,a)}}const Na=11102230246251565e-32,hs=134217729,qx=(3+8*Na)*Na;function op(r,e,i,s,a){let f,g,l,x,E=e[0],C=s[0],L=0,N=0;C>E==C>-E?(f=E,E=e[++L]):(f=C,C=s[++N]);let B=0;if(L<r&&N<i)for(C>E==C>-E?(g=E+f,l=f-(g-E),E=e[++L]):(g=C+f,l=f-(g-C),C=s[++N]),f=g,l!==0&&(a[B++]=l);L<r&&N<i;)C>E==C>-E?(g=f+E,x=g-f,l=f-(g-x)+(E-x),E=e[++L]):(g=f+C,x=g-f,l=f-(g-x)+(C-x),C=s[++N]),f=g,l!==0&&(a[B++]=l);for(;L<r;)g=f+E,x=g-f,l=f-(g-x)+(E-x),E=e[++L],f=g,l!==0&&(a[B++]=l);for(;N<i;)g=f+C,x=g-f,l=f-(g-x)+(C-x),C=s[++N],f=g,l!==0&&(a[B++]=l);return(f!==0||B===0)&&(a[B++]=f),B}function Gx(r,e){let i=e[0];for(let s=1;s<r;s++)i+=e[s];return i}function Oh(r){return new Float64Array(r)}const Zx=(3+16*Na)*Na,Hx=(2+12*Na)*Na,Wx=(9+64*Na)*Na*Na,Vu=Oh(4),Yg=Oh(8),Jg=Oh(12),Kg=Oh(16),Cs=Oh(4);function Xx(r,e,i,s,a,f,g){let l,x,E,C,L,N,B,U,te,ie,re,J,$,fe,ve,Pe,ue,xe;const be=r-a,Te=i-a,we=e-f,ye=s-f;fe=be*ye,N=hs*be,B=N-(N-be),U=be-B,N=hs*ye,te=N-(N-ye),ie=ye-te,ve=U*ie-(fe-B*te-U*te-B*ie),Pe=we*Te,N=hs*we,B=N-(N-we),U=we-B,N=hs*Te,te=N-(N-Te),ie=Te-te,ue=U*ie-(Pe-B*te-U*te-B*ie),re=ve-ue,L=ve-re,Vu[0]=ve-(re+L)+(L-ue),J=fe+re,L=J-fe,$=fe-(J-L)+(re-L),re=$-Pe,L=$-re,Vu[1]=$-(re+L)+(L-Pe),xe=J+re,L=xe-J,Vu[2]=J-(xe-L)+(re-L),Vu[3]=xe;let ze=Gx(4,Vu),Be=Hx*g;if(ze>=Be||-ze>=Be||(L=r-be,l=r-(be+L)+(L-a),L=i-Te,E=i-(Te+L)+(L-a),L=e-we,x=e-(we+L)+(L-f),L=s-ye,C=s-(ye+L)+(L-f),l===0&&x===0&&E===0&&C===0)||(Be=Wx*g+qx*Math.abs(ze),ze+=be*C+ye*l-(we*E+Te*x),ze>=Be||-ze>=Be))return ze;fe=l*ye,N=hs*l,B=N-(N-l),U=l-B,N=hs*ye,te=N-(N-ye),ie=ye-te,ve=U*ie-(fe-B*te-U*te-B*ie),Pe=x*Te,N=hs*x,B=N-(N-x),U=x-B,N=hs*Te,te=N-(N-Te),ie=Te-te,ue=U*ie-(Pe-B*te-U*te-B*ie),re=ve-ue,L=ve-re,Cs[0]=ve-(re+L)+(L-ue),J=fe+re,L=J-fe,$=fe-(J-L)+(re-L),re=$-Pe,L=$-re,Cs[1]=$-(re+L)+(L-Pe),xe=J+re,L=xe-J,Cs[2]=J-(xe-L)+(re-L),Cs[3]=xe;const pt=op(4,Vu,4,Cs,Yg);fe=be*C,N=hs*be,B=N-(N-be),U=be-B,N=hs*C,te=N-(N-C),ie=C-te,ve=U*ie-(fe-B*te-U*te-B*ie),Pe=we*E,N=hs*we,B=N-(N-we),U=we-B,N=hs*E,te=N-(N-E),ie=E-te,ue=U*ie-(Pe-B*te-U*te-B*ie),re=ve-ue,L=ve-re,Cs[0]=ve-(re+L)+(L-ue),J=fe+re,L=J-fe,$=fe-(J-L)+(re-L),re=$-Pe,L=$-re,Cs[1]=$-(re+L)+(L-Pe),xe=J+re,L=xe-J,Cs[2]=J-(xe-L)+(re-L),Cs[3]=xe;const St=op(pt,Yg,4,Cs,Jg);fe=l*C,N=hs*l,B=N-(N-l),U=l-B,N=hs*C,te=N-(N-C),ie=C-te,ve=U*ie-(fe-B*te-U*te-B*ie),Pe=x*E,N=hs*x,B=N-(N-x),U=x-B,N=hs*E,te=N-(N-E),ie=E-te,ue=U*ie-(Pe-B*te-U*te-B*ie),re=ve-ue,L=ve-re,Cs[0]=ve-(re+L)+(L-ue),J=fe+re,L=J-fe,$=fe-(J-L)+(re-L),re=$-Pe,L=$-re,Cs[1]=$-(re+L)+(L-Pe),xe=J+re,L=xe-J,Cs[2]=J-(xe-L)+(re-L),Cs[3]=xe;const dt=op(St,Jg,4,Cs,Kg);return Kg[dt-1]}function $x(r,e,i,s,a,f){const g=(e-f)*(i-a),l=(r-a)*(s-f),x=g-l,E=Math.abs(g+l);return Math.abs(x)>=Zx*E?x:-Xx(r,e,i,s,a,f,E)}const uh=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,kp=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const i=r.ll.x<e.ll.x?e.ll.x:r.ll.x,s=r.ur.x<e.ur.x?r.ur.x:e.ur.x,a=r.ll.y<e.ll.y?e.ll.y:r.ll.y,f=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:i,y:a},ur:{x:s,y:f}}};let yl=Number.EPSILON;yl===void 0&&(yl=Math.pow(2,-52));const Yx=yl*yl,Qg=(r,e)=>{if(-yl<r&&r<yl&&-yl<e&&e<yl)return 0;const i=r-e;return i*i<Yx*r*e?0:r<e?-1:1};class Jx{constructor(){this.reset()}reset(){this.xRounder=new e_,this.yRounder=new e_}round(e,i){return{x:this.xRounder.round(e),y:this.yRounder.round(i)}}}class e_{constructor(){this.tree=new Gp,this.round(0)}round(e){const i=this.tree.add(e),s=this.tree.prev(i);if(s!==null&&Qg(i.key,s.key)===0)return this.tree.remove(e),s.key;const a=this.tree.next(i);return a!==null&&Qg(i.key,a.key)===0?(this.tree.remove(e),a.key):e}}const Mh=new Jx,Cf=(r,e)=>r.x*e.y-r.y*e.x,rv=(r,e)=>r.x*e.x+r.y*e.y,t_=(r,e,i)=>{const s=$x(r.x,r.y,e.x,e.y,i.x,i.y);return s>0?-1:s<0?1:0},zf=r=>Math.sqrt(rv(r,r)),Kx=(r,e,i)=>{const s={x:e.x-r.x,y:e.y-r.y},a={x:i.x-r.x,y:i.y-r.y};return Cf(a,s)/zf(a)/zf(s)},Qx=(r,e,i)=>{const s={x:e.x-r.x,y:e.y-r.y},a={x:i.x-r.x,y:i.y-r.y};return rv(a,s)/zf(a)/zf(s)},n_=(r,e,i)=>e.y===0?null:{x:r.x+e.x/e.y*(i-r.y),y:i},i_=(r,e,i)=>e.x===0?null:{x:i,y:r.y+e.y/e.x*(i-r.x)},ew=(r,e,i,s)=>{if(e.x===0)return i_(i,s,r.x);if(s.x===0)return i_(r,e,i.x);if(e.y===0)return n_(i,s,r.y);if(s.y===0)return n_(r,e,i.y);const a=Cf(e,s);if(a==0)return null;const f={x:i.x-r.x,y:i.y-r.y},g=Cf(f,e)/a,l=Cf(f,s)/a,x=r.x+l*e.x,E=i.x+g*s.x,C=r.y+l*e.y,L=i.y+g*s.y,N=(x+E)/2,B=(C+L)/2;return{x:N,y:B}};class yo{static compare(e,i){const s=yo.comparePoints(e.point,i.point);return s!==0?s:(e.point!==i.point&&e.link(i),e.isLeft!==i.isLeft?e.isLeft?1:-1:bl.compare(e.segment,i.segment))}static comparePoints(e,i){return e.x<i.x?-1:e.x>i.x?1:e.y<i.y?-1:e.y>i.y?1:0}constructor(e,i){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=i}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const i=e.point.events;for(let s=0,a=i.length;s<a;s++){const f=i[s];this.point.events.push(f),f.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let i=0;i<e;i++){const s=this.point.events[i];if(s.segment.consumedBy===void 0)for(let a=i+1;a<e;a++){const f=this.point.events[a];f.consumedBy===void 0&&s.otherSE.point.events===f.otherSE.point.events&&s.segment.consume(f.segment)}}}getAvailableLinkedEvents(){const e=[];for(let i=0,s=this.point.events.length;i<s;i++){const a=this.point.events[i];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&e.push(a)}return e}getLeftmostComparator(e){const i=new Map,s=a=>{const f=a.otherSE;i.set(a,{sine:Kx(this.point,e.point,f.point),cosine:Qx(this.point,e.point,f.point)})};return(a,f)=>{i.has(a)||s(a),i.has(f)||s(f);const{sine:g,cosine:l}=i.get(a),{sine:x,cosine:E}=i.get(f);return g>=0&&x>=0?l<E?1:l>E?-1:0:g<0&&x<0?l<E?-1:l>E?1:0:x<g?-1:x>g?1:0}}}let tw=0;class bl{static compare(e,i){const s=e.leftSE.point.x,a=i.leftSE.point.x,f=e.rightSE.point.x,g=i.rightSE.point.x;if(g<s)return 1;if(f<a)return-1;const l=e.leftSE.point.y,x=i.leftSE.point.y,E=e.rightSE.point.y,C=i.rightSE.point.y;if(s<a){if(x<l&&x<E)return 1;if(x>l&&x>E)return-1;const L=e.comparePoint(i.leftSE.point);if(L<0)return 1;if(L>0)return-1;const N=i.comparePoint(e.rightSE.point);return N!==0?N:-1}if(s>a){if(l<x&&l<C)return-1;if(l>x&&l>C)return 1;const L=i.comparePoint(e.leftSE.point);if(L!==0)return L;const N=e.comparePoint(i.rightSE.point);return N<0?1:N>0?-1:1}if(l<x)return-1;if(l>x)return 1;if(f<g){const L=i.comparePoint(e.rightSE.point);if(L!==0)return L}if(f>g){const L=e.comparePoint(i.rightSE.point);if(L<0)return 1;if(L>0)return-1}if(f!==g){const L=E-l,N=f-s,B=C-x,U=g-a;if(L>N&&B<U)return 1;if(L<N&&B>U)return-1}return f>g?1:f<g||E<C?-1:E>C?1:e.id<i.id?-1:e.id>i.id?1:0}constructor(e,i,s,a){this.id=++tw,this.leftSE=e,e.segment=this,e.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=e,this.rings=s,this.windings=a}static fromRing(e,i,s){let a,f,g;const l=yo.comparePoints(e,i);if(l<0)a=e,f=i,g=1;else if(l>0)a=i,f=e,g=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const x=new yo(a,!0),E=new yo(f,!1);return new bl(x,E,[s],[g])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<i?e:i},ur:{x:this.rightSE.point.x,y:e>i?e:i}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const i=this.leftSE.point,s=this.rightSE.point,a=this.vector();if(i.x===s.x)return e.x===i.x?0:e.x<i.x?1:-1;const f=(e.y-i.y)/a.y,g=i.x+f*a.x;if(e.x===g)return 0;const l=(e.x-i.x)/a.x,x=i.y+l*a.y;return e.y===x?0:e.y<x?-1:1}getIntersection(e){const i=this.bbox(),s=e.bbox(),a=kp(i,s);if(a===null)return null;const f=this.leftSE.point,g=this.rightSE.point,l=e.leftSE.point,x=e.rightSE.point,E=uh(i,l)&&this.comparePoint(l)===0,C=uh(s,f)&&e.comparePoint(f)===0,L=uh(i,x)&&this.comparePoint(x)===0,N=uh(s,g)&&e.comparePoint(g)===0;if(C&&E)return N&&!L?g:!N&&L?x:null;if(C)return L&&f.x===x.x&&f.y===x.y?null:f;if(E)return N&&g.x===l.x&&g.y===l.y?null:l;if(N&&L)return null;if(N)return g;if(L)return x;const B=ew(f,this.vector(),l,e.vector());return B===null||!uh(a,B)?null:Mh.round(B.x,B.y)}split(e){const i=[],s=e.events!==void 0,a=new yo(e,!0),f=new yo(e,!1),g=this.rightSE;this.replaceRightSE(f),i.push(f),i.push(a);const l=new bl(a,g,this.rings.slice(),this.windings.slice());return yo.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),yo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(a.checkForConsuming(),f.checkForConsuming()),i}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let i=0,s=this.windings.length;i<s;i++)this.windings[i]*=-1}consume(e){let i=this,s=e;for(;i.consumedBy;)i=i.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const a=bl.compare(i,s);if(a!==0){if(a>0){const f=i;i=s,s=f}if(i.prev===s){const f=i;i=s,s=f}for(let f=0,g=s.rings.length;f<g;f++){const l=s.rings[f],x=s.windings[f],E=i.rings.indexOf(l);E===-1?(i.rings.push(l),i.windings.push(x)):i.windings[E]+=x}s.rings=null,s.windings=null,s.consumedBy=i,s.leftSE.consumedBy=i.leftSE,s.rightSE.consumedBy=i.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const i=this._afterState.rings,s=this._afterState.windings,a=this._afterState.multiPolys;for(let l=0,x=this.rings.length;l<x;l++){const E=this.rings[l],C=this.windings[l],L=i.indexOf(E);L===-1?(i.push(E),s.push(C)):s[L]+=C}const f=[],g=[];for(let l=0,x=i.length;l<x;l++){if(s[l]===0)continue;const E=i[l],C=E.poly;if(g.indexOf(C)===-1)if(E.isExterior)f.push(C);else{g.indexOf(C)===-1&&g.push(C);const L=f.indexOf(E.poly);L!==-1&&f.splice(L,1)}}for(let l=0,x=f.length;l<x;l++){const E=f[l].multiPoly;a.indexOf(E)===-1&&a.push(E)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(Ro.type){case"union":{const s=e.length===0,a=i.length===0;this._isInResult=s!==a;break}case"intersection":{let s,a;e.length<i.length?(s=e.length,a=i.length):(s=i.length,a=e.length),this._isInResult=a===Ro.numMultiPolys&&s<a;break}case"xor":{const s=Math.abs(e.length-i.length);this._isInResult=s%2===1;break}case"difference":{const s=a=>a.length===1&&a[0].isSubject;this._isInResult=s(e)!==s(i);break}default:throw new Error(`Unrecognized operation type found ${Ro.type}`)}return this._isInResult}}class r_{constructor(e,i,s){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=s,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=Mh.round(e[0][0],e[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let f=a;for(let g=1,l=e.length;g<l;g++){if(typeof e[g][0]!="number"||typeof e[g][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let x=Mh.round(e[g][0],e[g][1]);x.x===f.x&&x.y===f.y||(this.segments.push(bl.fromRing(f,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),f=x)}(a.x!==f.x||a.y!==f.y)&&this.segments.push(bl.fromRing(f,a,this))}getSweepEvents(){const e=[];for(let i=0,s=this.segments.length;i<s;i++){const a=this.segments[i];e.push(a.leftSE),e.push(a.rightSE)}return e}}class nw{constructor(e,i){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new r_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let s=1,a=e.length;s<a;s++){const f=new r_(e[s],this,!1);f.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=f.bbox.ll.x),f.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=f.bbox.ll.y),f.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=f.bbox.ur.x),f.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=f.bbox.ur.y),this.interiorRings.push(f)}this.multiPoly=i}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let i=0,s=this.interiorRings.length;i<s;i++){const a=this.interiorRings[i].getSweepEvents();for(let f=0,g=a.length;f<g;f++)e.push(a[f])}return e}}class s_{constructor(e,i){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let s=0,a=e.length;s<a;s++){const f=new nw(e[s],this);f.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=f.bbox.ll.x),f.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=f.bbox.ll.y),f.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=f.bbox.ur.x),f.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=f.bbox.ur.y),this.polys.push(f)}this.isSubject=i}getSweepEvents(){const e=[];for(let i=0,s=this.polys.length;i<s;i++){const a=this.polys[i].getSweepEvents();for(let f=0,g=a.length;f<g;f++)e.push(a[f])}return e}}class Of{static factory(e){const i=[];for(let s=0,a=e.length;s<a;s++){const f=e[s];if(!f.isInResult()||f.ringOut)continue;let g=null,l=f.leftSE,x=f.rightSE;const E=[l],C=l.point,L=[];for(;g=l,l=x,E.push(l),l.point!==C;)for(;;){const N=l.getAvailableLinkedEvents();if(N.length===0){const te=E[0].point,ie=E[E.length-1].point;throw new Error(`Unable to complete output ring starting at [${te.x}, ${te.y}]. Last matching segment found ends at [${ie.x}, ${ie.y}].`)}if(N.length===1){x=N[0].otherSE;break}let B=null;for(let te=0,ie=L.length;te<ie;te++)if(L[te].point===l.point){B=te;break}if(B!==null){const te=L.splice(B)[0],ie=E.splice(te.index);ie.unshift(ie[0].otherSE),i.push(new Of(ie.reverse()));continue}L.push({index:E.length,point:l.point});const U=l.getLeftmostComparator(g);x=N.sort(U)[0].otherSE;break}i.push(new Of(E))}return i}constructor(e){this.events=e;for(let i=0,s=e.length;i<s;i++)e[i].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const i=[e];for(let E=1,C=this.events.length-1;E<C;E++){const L=this.events[E].point,N=this.events[E+1].point;t_(L,e,N)!==0&&(i.push(L),e=L)}if(i.length===1)return null;const s=i[0],a=i[1];t_(s,e,a)===0&&i.shift(),i.push(i[0]);const f=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:i.length-1,l=this.isExteriorRing()?i.length:-1,x=[];for(let E=g;E!=l;E+=f)x.push([i[E].x,i[E].y]);return x}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let a=1,f=this.events.length;a<f;a++){const g=this.events[a];yo.compare(e,g)>0&&(e=g)}let i=e.segment.prevInResult(),s=i?i.prevInResult():null;for(;;){if(!i)return null;if(!s)return i.ringOut;if(s.ringOut!==i.ringOut)return s.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=s.prevInResult(),s=i?i.prevInResult():null}}}class o_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let i=0,s=this.interiorRings.length;i<s;i++){const a=this.interiorRings[i].getGeom();a!==null&&e.push(a)}return e}}let iw=class{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let i=0,s=this.polys.length;i<s;i++){const a=this.polys[i].getGeom();a!==null&&e.push(a)}return e}_composePolys(e){const i=[];for(let s=0,a=e.length;s<a;s++){const f=e[s];if(!f.poly)if(f.isExteriorRing())i.push(new o_(f));else{const g=f.enclosingRing();g.poly||i.push(new o_(g)),g.poly.addInterior(f)}}return i}};class rw{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bl.compare;this.queue=e,this.tree=new Gp(i),this.segments=[]}process(e){const i=e.segment,s=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(i),s;const a=e.isLeft?this.tree.add(i):this.tree.find(i);if(!a)throw new Error(`Unable to find segment #${i.id} [${i.leftSE.point.x}, ${i.leftSE.point.y}] -> [${i.rightSE.point.x}, ${i.rightSE.point.y}] in SweepLine tree.`);let f=a,g=a,l,x;for(;l===void 0;)f=this.tree.prev(f),f===null?l=null:f.key.consumedBy===void 0&&(l=f.key);for(;x===void 0;)g=this.tree.next(g),g===null?x=null:g.key.consumedBy===void 0&&(x=g.key);if(e.isLeft){let E=null;if(l){const L=l.getIntersection(i);if(L!==null&&(i.isAnEndpoint(L)||(E=L),!l.isAnEndpoint(L))){const N=this._splitSafely(l,L);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}}let C=null;if(x){const L=x.getIntersection(i);if(L!==null&&(i.isAnEndpoint(L)||(C=L),!x.isAnEndpoint(L))){const N=this._splitSafely(x,L);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}}if(E!==null||C!==null){let L=null;E===null?L=C:C===null?L=E:L=yo.comparePoints(E,C)<=0?E:C,this.queue.remove(i.rightSE),s.push(i.rightSE);const N=i.split(L);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}s.length>0?(this.tree.remove(i),s.push(e)):(this.segments.push(i),i.prev=l)}else{if(l&&x){const E=l.getIntersection(x);if(E!==null){if(!l.isAnEndpoint(E)){const C=this._splitSafely(l,E);for(let L=0,N=C.length;L<N;L++)s.push(C[L])}if(!x.isAnEndpoint(E)){const C=this._splitSafely(x,E);for(let L=0,N=C.length;L<N;L++)s.push(C[L])}}}this.tree.remove(i)}return s}_splitSafely(e,i){this.tree.remove(e);const s=e.rightSE;this.queue.remove(s);const a=e.split(i);return a.push(s),e.consumedBy===void 0&&this.tree.add(e),a}}const a_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,sw=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class ow{run(e,i,s){Ro.type=e,Mh.reset();const a=[new s_(i,!0)];for(let C=0,L=s.length;C<L;C++)a.push(new s_(s[C],!1));if(Ro.numMultiPolys=a.length,Ro.type==="difference"){const C=a[0];let L=1;for(;L<a.length;)kp(a[L].bbox,C.bbox)!==null?L++:a.splice(L,1)}if(Ro.type==="intersection")for(let C=0,L=a.length;C<L;C++){const N=a[C];for(let B=C+1,U=a.length;B<U;B++)if(kp(N.bbox,a[B].bbox)===null)return[]}const f=new Gp(yo.compare);for(let C=0,L=a.length;C<L;C++){const N=a[C].getSweepEvents();for(let B=0,U=N.length;B<U;B++)if(f.insert(N[B]),f.size>a_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const g=new rw(f);let l=f.size,x=f.pop();for(;x;){const C=x.key;if(f.size===l){const N=C.segment;throw new Error(`Unable to pop() ${C.isLeft?"left":"right"} SweepEvent [${C.point.x}, ${C.point.y}] from segment #${N.id} [${N.leftSE.point.x}, ${N.leftSE.point.y}] -> [${N.rightSE.point.x}, ${N.rightSE.point.y}] from queue.`)}if(f.size>a_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(g.segments.length>sw)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const L=g.process(C);for(let N=0,B=L.length;N<B;N++){const U=L[N];U.consumedBy===void 0&&f.insert(U)}l=f.size,x=f.pop()}Mh.reset();const E=Of.factory(g.segments);return new iw(E).getGeom()}}const Ro=new ow,aw=function(r){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return Ro.run("union",r,i)},lw=function(r){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return Ro.run("intersection",r,i)},uw=function(r){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return Ro.run("xor",r,i)},cw=function(r){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return Ro.run("difference",r,i)};var sv={union:aw,intersection:lw,xor:uw,difference:cw};function ov(r,e,i){if(r!==null)for(var s,a,f,g,l,x,E,C=0,L=0,N,B=r.type,U=B==="FeatureCollection",te=B==="Feature",ie=U?r.features.length:1,re=0;re<ie;re++){E=U?r.features[re].geometry:te?r.geometry:r,N=E?E.type==="GeometryCollection":!1,l=N?E.geometries.length:1;for(var J=0;J<l;J++){var $=0,fe=0;if(g=N?E.geometries[J]:E,g!==null){x=g.coordinates;var ve=g.type;switch(C=0,ve){case null:break;case"Point":if(e(x,L,re,$,fe)===!1)return!1;L++,$++;break;case"LineString":case"MultiPoint":for(s=0;s<x.length;s++){if(e(x[s],L,re,$,fe)===!1)return!1;L++,ve==="MultiPoint"&&$++}ve==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(s=0;s<x.length;s++){for(a=0;a<x[s].length-C;a++){if(e(x[s][a],L,re,$,fe)===!1)return!1;L++}ve==="MultiLineString"&&$++,ve==="Polygon"&&fe++}ve==="Polygon"&&$++;break;case"MultiPolygon":for(s=0;s<x.length;s++){for(fe=0,a=0;a<x[s].length;a++){for(f=0;f<x[s][a].length-C;f++){if(e(x[s][a][f],L,re,$,fe)===!1)return!1;L++}fe++}$++}break;case"GeometryCollection":for(s=0;s<g.geometries.length;s++)if(ov(g.geometries[s],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function l_(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var i=0;i<r.features.length&&e(r.features[i],i)!==!1;i++);}function id(r,e){var i,s,a,f,g,l,x,E,C,L,N=0,B=r.type==="FeatureCollection",U=r.type==="Feature",te=B?r.features.length:1;for(i=0;i<te;i++){for(l=B?r.features[i].geometry:U?r.geometry:r,E=B?r.features[i].properties:U?r.properties:{},C=B?r.features[i].bbox:U?r.bbox:void 0,L=B?r.features[i].id:U?r.id:void 0,x=l?l.type==="GeometryCollection":!1,g=x?l.geometries.length:1,a=0;a<g;a++){if(f=x?l.geometries[a]:l,f===null){if(e(null,N,E,C,L)===!1)return!1;continue}switch(f.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(f,N,E,C,L)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<f.geometries.length;s++)if(e(f.geometries[s],N,E,C,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}N++}}function hw(r,e={}){const i=[];if(id(r,a=>{i.push(a.coordinates)}),i.length<2)throw new Error("Must have at least 2 geometries");const s=sv.union(i[0],...i.slice(1));return s.length===0?null:s.length===1?qp(s[0],e.properties):iv(s,e.properties)}var fw=hw;function dw(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const i=[1/0,1/0,-1/0,-1/0];return ov(r,s=>{i[0]>s[0]&&(i[0]=s[0]),i[1]>s[1]&&(i[1]=s[1]),i[2]<s[0]&&(i[2]=s[0]),i[3]<s[1]&&(i[3]=s[1])}),i}function pw(r,e={}){const i=dw(r),s=(i[0]+i[2])/2,a=(i[1]+i[3])/2;return Dx([s,a],e.properties,e)}var mw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var av={exports:{}};(function(r,e){(function(i,s){r.exports=s()})(mw,function(){function i(I,c){if(!(I instanceof c))throw new TypeError("Cannot call a class as a function")}function s(I,c){for(var d=0;d<c.length;d++){var p=c[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(I,p.key,p)}}function a(I,c,d){return c&&s(I.prototype,c),d&&s(I,d),I}function f(I,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(c&&c.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),c&&l(I,c)}function g(I){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},g(I)}function l(I,c){return l=Object.setPrototypeOf||function(d,p){return d.__proto__=p,d},l(I,c)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function E(I,c,d){return E=x()?Reflect.construct:function(p,b,M){var F=[null];F.push.apply(F,b);var q=new(Function.bind.apply(p,F));return M&&l(q,M.prototype),q},E.apply(null,arguments)}function C(I){var c=typeof Map=="function"?new Map:void 0;return C=function(d){if(d===null||(p=d,Function.toString.call(p).indexOf("[native code]")===-1))return d;var p;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(d))return c.get(d);c.set(d,b)}function b(){return E(d,arguments,g(this).constructor)}return b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),l(b,d)},C(I)}function L(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function N(I,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return L(I)}function B(I){var c=x();return function(){var d,p=g(I);if(c){var b=g(this).constructor;d=Reflect.construct(p,arguments,b)}else d=p.apply(this,arguments);return N(this,d)}}function U(I,c,d){return U=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,b,M){var F=function(Y,me){for(;!Object.prototype.hasOwnProperty.call(Y,me)&&(Y=g(Y))!==null;);return Y}(p,b);if(F){var q=Object.getOwnPropertyDescriptor(F,b);return q.get?q.get.call(M):q.value}},U(I,c,d||I)}function te(I){return function(c){if(Array.isArray(c))return re(c)}(I)||function(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(I)||ie(I)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ie(I,c){if(I){if(typeof I=="string")return re(I,c);var d=Object.prototype.toString.call(I).slice(8,-1);return d==="Object"&&I.constructor&&(d=I.constructor.name),d==="Map"||d==="Set"?Array.from(I):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?re(I,c):void 0}}function re(I,c){(c==null||c>I.length)&&(c=I.length);for(var d=0,p=new Array(c);d<c;d++)p[d]=I[d];return p}function J(I,c){var d=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!d){if(Array.isArray(I)||(d=ie(I))||c){d&&(I=d);var p=0,b=function(){};return{s:b,n:function(){return p>=I.length?{done:!0}:{done:!1,value:I[p++]}},e:function(Y){throw Y},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M,F=!0,q=!1;return{s:function(){d=d.call(I)},n:function(){var Y=d.next();return F=Y.done,Y},e:function(Y){q=!0,M=Y},f:function(){try{F||d.return==null||d.return()}finally{if(q)throw M}}}}var $=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(c){this._quadrantSegments=c,this._quadrantSegments===0&&(this._joinStyle=I.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=I.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),c<=0&&(this._quadrantSegments=1),this._joinStyle!==I.JOIN_ROUND&&(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(c){this._joinStyle=c}},{key:"setSimplifyFactor",value:function(c){this._simplifyFactor=c<0?0:c}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(c){this._endCapStyle=c}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(c){this._mitreLimit=c}},{key:"setSingleSided",value:function(c){this._isSingleSided=c}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=I.CAP_ROUND,this._joinStyle=I.JOIN_ROUND,this._mitreLimit=I.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=I.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var c=arguments[0];this.setQuadrantSegments(c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.setQuadrantSegments(d),this.setEndCapStyle(p)}else if(arguments.length===4){var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3];this.setQuadrantSegments(b),this.setEndCapStyle(M),this.setJoinStyle(F),this.setMitreLimit(q)}}}},{key:"bufferDistanceError",value:function(c){var d=Math.PI/2/c;return 1-Math.cos(d/2)}}]),I}();$.CAP_ROUND=1,$.CAP_FLAT=2,$.CAP_SQUARE=3,$.JOIN_ROUND=1,$.JOIN_MITRE=2,$.JOIN_BEVEL=3,$.DEFAULT_QUADRANT_SEGMENTS=8,$.DEFAULT_MITRE_LIMIT=5,$.DEFAULT_SIMPLIFY_FACTOR=.01;var fe=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this,p)).name=Object.keys({Exception:d})[0],b}return a(d,[{key:"toString",value:function(){return this.message}}]),d}(C(Error)),ve=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this,p)).name=Object.keys({IllegalArgumentException:d})[0],b}return d}(fe),Pe=function(){function I(){i(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}();function ue(){}function xe(){}function be(){}var Te,we,ye,ze,Be,pt,St,dt,ut=function(){function I(){i(this,I)}return a(I,null,[{key:"equalsWithTolerance",value:function(c,d,p){return Math.abs(c-d)<=p}}]),I}(),Bt=function(){function I(c,d){i(this,I),this.low=d||0,this.high=c||0}return a(I,null,[{key:"toBinaryString",value:function(c){var d,p="";for(d=2147483648;d>0;d>>>=1)p+=(c.high&d)===d?"1":"0";for(d=2147483648;d>0;d>>>=1)p+=(c.low&d)===d?"1":"0";return p}}]),I}();function vt(){}function wt(){}vt.NaN=NaN,vt.isNaN=function(I){return Number.isNaN(I)},vt.isInfinite=function(I){return!Number.isFinite(I)},vt.MAX_VALUE=Number.MAX_VALUE,vt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,vt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(pt=2146435072,St=new Float64Array(1),dt=new Int32Array(St.buffer),vt.doubleToLongBits=function(I){St[0]=I;var c=0|dt[0],d=0|dt[1];return(d&pt)===pt&&1048575&d&&c!==0&&(c=0,d=2146959360),new Bt(d,c)},vt.longBitsToDouble=function(I){return dt[0]=I.low,dt[1]=I.high,St[0]}):(Te=1023,we=Math.log2,ye=Math.floor,ze=Math.pow,Be=function(){for(var I=53;I>0;I--){var c=ze(2,I)-1;if(ye(we(c))+1===I)return c}return 0}(),vt.doubleToLongBits=function(I){var c,d,p,b,M,F,q,Y,me;if(I<0||1/I===Number.NEGATIVE_INFINITY?(F=1<<31,I=-I):F=0,I===0)return new Bt(Y=F,me=0);if(I===1/0)return new Bt(Y=2146435072|F,me=0);if(I!=I)return new Bt(Y=2146959360,me=0);if(b=0,me=0,(c=ye(I))>1)if(c<=Be)(b=ye(we(c)))<=20?(me=0,Y=c<<20-b&1048575):(me=c%(d=ze(2,p=b-20))<<32-p,Y=c/d&1048575);else for(p=c,me=0;(p=ye(d=p/2))!==0;)b++,me>>>=1,me|=(1&Y)<<31,Y>>>=1,d!==p&&(Y|=524288);if(q=b+Te,M=c===0,c=I-c,b<52&&c!==0)for(p=0;;){if((d=2*c)>=1?(c=d-1,M?(q--,M=!1):(p<<=1,p|=1,b++)):(c=d,M?--q==0&&(b++,M=!1):(p<<=1,b++)),b===20)Y|=p,p=0;else if(b===52){me|=p;break}if(d===1){b<20?Y|=p<<20-b:b<52&&(me|=p<<52-b);break}}return Y|=q<<20,new Bt(Y|=F,me)},vt.longBitsToDouble=function(I){var c,d,p,b,M=I.high,F=I.low,q=M&1<<31?-1:1;for(p=((2146435072&M)>>20)-Te,b=0,d=1<<19,c=1;c<=20;c++)M&d&&(b+=ze(2,-c)),d>>>=1;for(d=1<<31,c=21;c<=52;c++)F&d&&(b+=ze(2,-c)),d>>>=1;if(p===-1023){if(b===0)return 0*q;p=-1022}else{if(p===1024)return b===0?q/0:NaN;b+=1}return q*b*ze(2,p)});var ft=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this,p)).name=Object.keys({RuntimeException:d})[0],b}return d}(fe),xt=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){if(arguments.length===0)ft.constructor_.call(this);else if(arguments.length===1){var p=arguments[0];ft.constructor_.call(this,p)}}}]),d}(ft),It=function(){function I(){i(this,I)}return a(I,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)I.shouldNeverReachHere(null);else if(arguments.length===1){var c=arguments[0];throw new xt("Should never reach here"+(c!==null?": "+c:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var c=arguments[0];I.isTrue(c,null)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(!d)throw p===null?new xt:new xt(p)}}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];I.equals(c,d,null)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2];if(!b.equals(p))throw new xt("Expected "+p+" but encountered "+b+(M!==null?": "+M:""))}}}]),I}(),Jt=new ArrayBuffer(8),pn=new Float64Array(Jt),Rn=new Int32Array(Jt),Xe=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(){return vt.NaN}},{key:"setOrdinate",value:function(c,d){switch(c){case I.X:this.x=d;break;case I.Y:this.y=d;break;case I.Z:this.setZ(d);break;default:throw new ve("Invalid ordinate index: "+c)}}},{key:"equals2D",value:function(){if(arguments.length===1){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(arguments.length===2){var d=arguments[0],p=arguments[1];return!!ut.equalsWithTolerance(this.x,d.x,p)&&!!ut.equalsWithTolerance(this.y,d.y,p)}}},{key:"setM",value:function(c){throw new ve("Invalid ordinate index: "+I.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(c){switch(c){case I.X:return this.x;case I.Y:return this.y;case I.Z:return this.getZ()}throw new ve("Invalid ordinate index: "+c)}},{key:"equals3D",value:function(c){return this.x===c.x&&this.y===c.y&&(this.getZ()===c.getZ()||vt.isNaN(this.getZ())&&vt.isNaN(c.getZ()))}},{key:"equals",value:function(c){return c instanceof I&&this.equals2D(c)}},{key:"equalInZ",value:function(c,d){return ut.equalsWithTolerance(this.getZ(),c.getZ(),d)}},{key:"setX",value:function(c){this.x=c}},{key:"compareTo",value:function(c){var d=c;return this.x<d.x?-1:this.x>d.x?1:this.y<d.y?-1:this.y>d.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(c){this.z=c}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return It.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw c}}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(c){var d=this.x-c.x,p=this.y-c.y,b=this.getZ()-c.getZ();return Math.sqrt(d*d+p*p+b*b)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(c){this.y=c}},{key:"distance",value:function(c){var d=this.x-c.x,p=this.y-c.y;return Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*c+I.hashCode(this.x))+I.hashCode(this.y)}},{key:"setCoordinate",value:function(c){this.x=c.x,this.y=c.y,this.z=c.getZ()}},{key:"interfaces_",get:function(){return[ue,xe,be]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)I.constructor_.call(this,0,0);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.x,c.y,c.getZ())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];I.constructor_.call(this,d,p,I.NULL_ORDINATE)}else if(arguments.length===3){var b=arguments[0],M=arguments[1],F=arguments[2];this.x=b,this.y=M,this.z=F}}},{key:"hashCode",value:function(c){return pn[0]=c,Rn[0]^Rn[1]}}]),I}(),Wn=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compare",value:function(c,d){var p=I.compare(c.x,d.x);if(p!==0)return p;var b=I.compare(c.y,d.y);return b!==0?b:this._dimensionsToTest<=2?0:I.compare(c.getZ(),d.getZ())}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)I.constructor_.call(this,2);else if(arguments.length===1){var c=arguments[0];if(c!==2&&c!==3)throw new ve("only 2 or 3 dimensions may be specified");this._dimensionsToTest=c}}},{key:"compare",value:function(c,d){return c<d?-1:c>d?1:vt.isNaN(c)?vt.isNaN(d)?0:-1:vt.isNaN(d)?1:0}}]),I}();Xe.DimensionalComparator=Wn,Xe.NULL_ORDINATE=vt.NaN,Xe.X=0,Xe.Y=1,Xe.Z=2,Xe.M=3;var dn=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()}},{key:"intersection",value:function(c){if(this.isNull()||c.isNull()||!this.intersects(c))return new I;var d=this._minx>c._minx?this._minx:c._minx,p=this._miny>c._miny?this._miny:c._miny;return new I(d,this._maxx<c._maxx?this._maxx:c._maxx,p,this._maxy<c._maxy?this._maxy:c._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];return this.covers(c.x,c.y)}if(arguments[0]instanceof I){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return!this.isNull()&&p>=this._minx&&p<=this._maxx&&b>=this._miny&&b<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return!this.isNull()&&!c.isNull()&&!(c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny)}if(arguments[0]instanceof Xe){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(arguments.length===2){if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var p=arguments[0],b=arguments[1];if(this.isNull())return!1;var M=p.x<b.x?p.x:b.x;if(M>this._maxx)return!1;var F=p.x>b.x?p.x:b.x;if(F<this._minx)return!1;var q=p.y<b.y?p.y:b.y;if(q>this._maxy)return!1;var Y=p.y>b.y?p.y:b.y;return!(Y<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var me=arguments[0],Ue=arguments[1];return!this.isNull()&&!(me>this._maxx||me<this._minx||Ue>this._maxy||Ue<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return Math.sqrt(c*c+d*d)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];this.expandToInclude(c.x,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.isNull()?(this._minx=p,this._maxx=p,this._miny=b,this._maxy=b):(p<this._minx&&(this._minx=p),p>this._maxx&&(this._maxx=p),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c<d?c:d}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(c){var d=c;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0}},{key:"translate",value:function(c,d){if(this.isNull())return null;this.init(this.getMinX()+c,this.getMaxX()+c,this.getMinY()+d,this.getMaxY()+d)}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(c){return!(!this.isNull()&&!c.isNull())||c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c>d?c:d}},{key:"expandBy",value:function(){if(arguments.length===1){var c=arguments[0];this.expandBy(c,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=p,this._maxy+=p,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.covers(c)}if(arguments[0]instanceof Xe){var d=arguments[0];return this.covers(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.covers(p,b)}}},{key:"centre",value:function(){return this.isNull()?null:new Xe((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];M<F?(this._minx=M,this._maxx=F):(this._minx=F,this._maxx=M),q<Y?(this._miny=q,this._maxy=Y):(this._miny=Y,this._maxy=q)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(c){if(this.intersects(c))return 0;var d=0;this._maxx<c._minx?d=c._minx-this._maxx:this._minx>c._maxx&&(d=this._minx-c._maxx);var p=0;return this._maxy<c._miny?p=c._miny-this._maxy:this._miny>c._maxy&&(p=this._miny-c._maxy),d===0?p:p===0?d:Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*(c=37*(c=37*c+Xe.hashCode(this._minx))+Xe.hashCode(this._maxx))+Xe.hashCode(this._miny))+Xe.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[ue,be]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];this.init(M,F,q,Y)}}},{key:"intersects",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2];return p.x>=(c.x<d.x?c.x:d.x)&&p.x<=(c.x>d.x?c.x:d.x)&&p.y>=(c.y<d.y?c.y:d.y)&&p.y<=(c.y>d.y?c.y:d.y)}if(arguments.length===4){var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3],Y=Math.min(F.x,q.x),me=Math.max(F.x,q.x),Ue=Math.min(b.x,M.x),$e=Math.max(b.x,M.x);return!(Ue>me)&&!($e<Y)&&(Y=Math.min(F.y,q.y),me=Math.max(F.y,q.y),Ue=Math.min(b.y,M.y),$e=Math.max(b.y,M.y),!(Ue>me)&&!($e<Y))}}}]),I}(),Ft=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(c){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(c){return this===c||this.equalsExact(c,0)}},{key:"geometryChanged",value:function(){this.apply(I.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(c){return c!==null&&this.norm().equalsExact(c.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var c;if(arguments.length===1){var d=arguments[0];return c=d,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(d)}if(arguments.length===2){var p=arguments[0],b=arguments[1];return c=p,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(p,b)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(c){if(c.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION)throw new ve("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(c,d,p){return p===0?c.equals(d):c.distance(d)<=p}},{key:"norm",value:function(){var c=this.copy();return c.normalize(),c}},{key:"reverse",value:function(){var c=this.reverseInternal();return this.envelope!=null&&(c.envelope=this.envelope.copy()),c.setSRID(this.getSRID()),c}},{key:"copy",value:function(){var c=this.copyInternal();return c.envelope=this._envelope==null?null:this._envelope.copy(),c._SRID=this._SRID,c._userData=this._userData,c}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new dn(this._envelope)}},{key:"setSRID",value:function(c){this._SRID=c}},{key:"setUserData",value:function(c){this._userData=c}},{key:"compare",value:function(c,d){for(var p=c.iterator(),b=d.iterator();p.hasNext()&&b.hasNext();){var M=p.next(),F=b.next(),q=M.compareTo(F);if(q!==0)return q}return p.hasNext()?1:b.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(c){return this.getClass()===c.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===I.TYPECODE_MULTIPOINT||this.getTypeCode()===I.TYPECODE_MULTILINESTRING||this.getTypeCode()===I.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[xe,ue,be]}},{key:"getClass",value:function(){return I}}],[{key:"hasNonEmptyElements",value:function(c){for(var d=0;d<c.length;d++)if(!c[d].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(c){for(var d=0;d<c.length;d++)if(c[d]===null)return!0;return!1}}]),I}();Ft.constructor_=function(I){I&&(this._envelope=null,this._userData=null,this._factory=I,this._SRID=I.getSRID())},Ft.TYPECODE_POINT=0,Ft.TYPECODE_MULTIPOINT=1,Ft.TYPECODE_LINESTRING=2,Ft.TYPECODE_LINEARRING=3,Ft.TYPECODE_MULTILINESTRING=4,Ft.TYPECODE_POLYGON=5,Ft.TYPECODE_MULTIPOLYGON=6,Ft.TYPECODE_GEOMETRYCOLLECTION=7,Ft.TYPENAME_POINT="Point",Ft.TYPENAME_MULTIPOINT="MultiPoint",Ft.TYPENAME_LINESTRING="LineString",Ft.TYPENAME_LINEARRING="LinearRing",Ft.TYPENAME_MULTILINESTRING="MultiLineString",Ft.TYPENAME_POLYGON="Polygon",Ft.TYPENAME_MULTIPOLYGON="MultiPolygon",Ft.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Ft.geometryChangedFilter={get interfaces_(){return[Pe]},filter:function(I){I.geometryChangedAction()}};var Se=function(){function I(){i(this,I)}return a(I,null,[{key:"toLocationSymbol",value:function(c){switch(c){case I.EXTERIOR:return"e";case I.BOUNDARY:return"b";case I.INTERIOR:return"i";case I.NONE:return"-"}throw new ve("Unknown location value: "+c)}}]),I}();Se.INTERIOR=0,Se.BOUNDARY=1,Se.EXTERIOR=2,Se.NONE=-1;var lt=function(){function I(){i(this,I)}return a(I,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),I}(),Je=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this,p)).name=Object.keys({NoSuchElementException:d})[0],b}return d}(fe),Lt=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this,p)).name=Object.keys({UnsupportedOperationException:d})[0],b}return d}(fe),Ye=function(I){f(d,I);var c=B(d);function d(){return i(this,d),c.apply(this,arguments)}return a(d,[{key:"contains",value:function(){}}]),d}(lt),kt=function(I,c){f(p,I);var d=B(p);function p(b){var M;return i(this,p),(M=d.call(this)).map=new Map,b instanceof lt&&M.addAll(b),M}return a(p,[{key:"contains",value:function(b){var M=b.hashCode?b.hashCode():b;return!!this.map.has(M)}},{key:"add",value:function(b){var M=b.hashCode?b.hashCode():b;return!this.map.has(M)&&!!this.map.set(M,b)}},{key:"addAll",value:function(b){var M,F=J(b);try{for(F.s();!(M=F.n()).done;){var q=M.value;this.add(q)}}catch(Y){F.e(Y)}finally{F.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Vt(this.map)}},{key:c,value:function(){return this.map}}]),p}(Ye,Symbol.iterator),Vt=function(){function I(c){i(this,I),this.iterator=c.values();var d=this.iterator.next(),p=d.done,b=d.value;this.done=p,this.value=b}return a(I,[{key:"next",value:function(){if(this.done)throw new Je;var c=this.value,d=this.iterator.next(),p=d.done,b=d.value;return this.done=p,this.value=b,c}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Lt}}]),I}(),Ee=function(){function I(){i(this,I)}return a(I,null,[{key:"opposite",value:function(c){return c===I.LEFT?I.RIGHT:c===I.RIGHT?I.LEFT:c}}]),I}();Ee.ON=0,Ee.LEFT=1,Ee.RIGHT=2;var Gt=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this,p)).name=Object.keys({EmptyStackException:d})[0],b}return d}(fe),_n=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this,p)).name=Object.keys({IndexOutOfBoundsException:d})[0],b}return d}(fe),Kn=function(I){f(d,I);var c=B(d);function d(){return i(this,d),c.apply(this,arguments)}return a(d,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),d}(lt),Yi=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),(p=c.call(this)).array=[],p}return a(d,[{key:"add",value:function(p){return this.array.push(p),!0}},{key:"get",value:function(p){if(p<0||p>=this.size())throw new _n;return this.array[p]}},{key:"push",value:function(p){return this.array.push(p),p}},{key:"pop",value:function(){if(this.array.length===0)throw new Gt;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Gt;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(p){return this.array.indexOf(p)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),d}(Kn);function xn(I,c){return I.interfaces_&&I.interfaces_.indexOf(c)>-1}var qi=function(){function I(c){i(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),Ji=function(){function I(c){i(this,I),this.value=c}return a(I,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(c){return this.value<c?-1:this.value>c?1:0}}],[{key:"compare",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"isNan",value:function(c){return Number.isNaN(c)}},{key:"valueOf",value:function(c){return new I(c)}}]),I}(),Jr=function(){function I(){i(this,I)}return a(I,null,[{key:"isWhitespace",value:function(c){return c<=32&&c>=0||c===127}},{key:"toUpperCase",value:function(c){return c.toUpperCase()}}]),I}(),ct=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"le",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<=c._lo}},{key:"extractSignificantDigits",value:function(c,d){var p=this.abs(),b=I.magnitude(p._hi),M=I.TEN.pow(b);(p=p.divide(M)).gt(I.TEN)?(p=p.divide(I.TEN),b+=1):p.lt(I.ONE)&&(p=p.multiply(I.TEN),b-=1);for(var F=b+1,q=new qi,Y=I.MAX_PRINT_DIGITS-1,me=0;me<=Y;me++){c&&me===F&&q.append(".");var Ue=Math.trunc(p._hi);if(Ue<0)break;var $e=!1,mt=0;Ue>9?($e=!0,mt="9"):mt="0"+Ue,q.append(mt),p=p.subtract(I.valueOf(Ue)).multiply(I.TEN),$e&&p.selfAdd(I.TEN);var zt=!0,Nt=I.magnitude(p._hi);if(Nt<0&&Math.abs(Nt)>=Y-me&&(zt=!1),!zt)break}return d[0]=b,q.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.add(c.negate())}if(typeof arguments[0]=="number"){var d=arguments[0];return this.add(-d)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof I){var c=arguments[0];return this._hi===c._hi&&this._lo===c._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.isNaN()?this:this.selfAdd(-c._hi,-c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(c){return this.le(c)?this:c}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfDivide(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfDivide(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],M=null,F=null,q=null,Y=null,me=null,Ue=null,$e=null,mt=null;return me=this._hi/p,mt=(M=(Ue=I.SPLIT*me)-(M=Ue-me))*(q=(mt=I.SPLIT*p)-(q=mt-p))-($e=me*p)+M*(Y=p-q)+(F=me-M)*q+F*Y,mt=me+(Ue=(this._hi-$e-mt+this._lo-me*b)/p),this._hi=mt,this._lo=me-mt+Ue,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=null,p=null,b=null,M=null,F=null,q=null,Y=null,me=null;p=(F=this._hi/c._hi)-(d=(q=I.SPLIT*F)-(d=q-F)),me=d*(b=(me=I.SPLIT*c._hi)-(b=me-c._hi))-(Y=F*c._hi)+d*(M=c._hi-b)+p*b+p*M;var Ue=me=F+(q=(this._hi-Y-me+this._lo-F*c._lo)/c._hi),$e=F-me+q;return new I(Ue,$e)}if(typeof arguments[0]=="number"){var mt=arguments[0];return vt.isNaN(mt)?I.createNaN():I.copy(this).selfDivide(mt,0)}}},{key:"ge",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>=c._lo}},{key:"pow",value:function(c){if(c===0)return I.valueOf(1);var d=new I(this),p=I.valueOf(1),b=Math.abs(c);if(b>1)for(;b>0;)b%2==1&&p.selfMultiply(d),(b/=2)>0&&(d=d.sqr());else p=d;return c<0?p.reciprocal():p}},{key:"ceil",value:function(){if(this.isNaN())return I.NaN;var c=Math.ceil(this._hi),d=0;return c===this._hi&&(d=Math.ceil(this._lo)),new I(c,d)}},{key:"compareTo",value:function(c){var d=c;return this._hi<d._hi?-1:this._hi>d._hi?1:this._lo<d._lo?-1:this._lo>d._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.init(c),this}if(typeof arguments[0]=="number"){var d=arguments[0];return this.init(d),this}}},{key:"max",value:function(c){return this.ge(c)?this:c}},{key:"sqrt",value:function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var c=1/Math.sqrt(this._hi),d=this._hi*c,p=I.valueOf(d),b=this.subtract(p.sqr())._hi*(.5*c);return p.add(b)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfAdd(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0],p=null,b=null,M=null,F=null,q=null,Y=null;return F=(M=this._hi+d)-(q=M-this._hi),b=(Y=(F=d-q+(this._hi-F))+this._lo)+(M-(p=M+Y)),this._hi=p+b,this._lo=b+(p-this._hi),this}}else if(arguments.length===2){var me=arguments[0],Ue=arguments[1],$e=null,mt=null,zt=null,Nt=null,gn=null,bn=null,Pn=null;Nt=this._hi+me,mt=this._lo+Ue,gn=Nt-(bn=Nt-this._hi),zt=mt-(Pn=mt-this._lo);var ti=($e=Nt+(bn=(gn=me-bn+(this._hi-gn))+mt))+(bn=(zt=Ue-Pn+(this._lo-zt))+(bn+(Nt-$e))),mi=bn+($e-ti);return this._hi=ti,this._lo=mi,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfMultiply(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfMultiply(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],M=null,F=null,q=null,Y=null,me=null,Ue=null;M=(me=I.SPLIT*this._hi)-this._hi,Ue=I.SPLIT*p,M=me-M,F=this._hi-M,q=Ue-p;var $e=(me=this._hi*p)+(Ue=M*(q=Ue-q)-me+M*(Y=p-q)+F*q+F*Y+(this._hi*b+this._lo*p)),mt=Ue+(M=me-$e);return this._hi=$e,this._lo=mt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return I.NaN;var c=Math.floor(this._hi),d=0;return c===this._hi&&(d=Math.floor(this._lo)),new I(c,d)}},{key:"negate",value:function(){return this.isNaN()?this:new I(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return null;throw c}}},{key:"multiply",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return c.isNaN()?I.createNaN():I.copy(this).selfMultiply(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return vt.isNaN(d)?I.createNaN():I.copy(this).selfMultiply(d,0)}}},{key:"isNaN",value:function(){return vt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var c=I.magnitude(this._hi);return c>=-3&&c<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!0,d),b=d[0]+1,M=p;if(p.charAt(0)===".")M="0"+p;else if(b<0)M="0."+I.stringOfChar("0",-b)+p;else if(p.indexOf(".")===-1){var F=b-p.length;M=p+I.stringOfChar("0",F)+".0"}return this.isNegative()?"-"+M:M}},{key:"reciprocal",value:function(){var c,d,p,b,M=null,F=null,q=null,Y=null;c=(p=1/this._hi)-(M=(q=I.SPLIT*p)-(M=q-p)),F=(Y=I.SPLIT*this._hi)-this._hi;var me=p+(q=(1-(b=p*this._hi)-(Y=M*(F=Y-F)-b+M*(d=this._hi-F)+c*F+c*d)-p*this._lo)/this._hi);return new I(me,p-me+q)}},{key:"toSciNotation",value:function(){if(this.isZero())return I.SCI_NOT_ZERO;var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!1,d),b=I.SCI_NOT_EXPONENT_CHAR+d[0];if(p.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+p);var M="";p.length>1&&(M=p.substring(1));var F=p.charAt(0)+"."+M;return this.isNegative()?"-"+F+b:F+b}},{key:"abs",value:function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<c._lo}},{key:"add",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return I.copy(this).selfAdd(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return I.copy(this).selfAdd(d)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this._hi=c,this._lo=0}else if(arguments[0]instanceof I){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this._hi=p,this._lo=b}}},{key:"gt",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>c._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[be,ue,xe]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this.init(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}else if(typeof arguments[0]=="string"){var p=arguments[0];I.constructor_.call(this,I.parse(p))}}else if(arguments.length===2){var b=arguments[0],M=arguments[1];this.init(b,M)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];return I.determinant(I.valueOf(c),I.valueOf(d),I.valueOf(p),I.valueOf(b))}if(arguments[3]instanceof I&&arguments[2]instanceof I&&arguments[0]instanceof I&&arguments[1]instanceof I){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3],me=M.multiply(Y).selfSubtract(F.multiply(q));return me}}},{key:"sqr",value:function(c){return I.valueOf(c).selfMultiply(c)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var c=arguments[0];return I.parse(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return new I(d)}}},{key:"sqrt",value:function(c){return I.valueOf(c).sqrt()}},{key:"parse",value:function(c){for(var d=0,p=c.length;Jr.isWhitespace(c.charAt(d));)d++;var b=!1;if(d<p){var M=c.charAt(d);M!=="-"&&M!=="+"||(d++,M==="-"&&(b=!0))}for(var F=new I,q=0,Y=0,me=0,Ue=!1;!(d>=p);){var $e=c.charAt(d);if(d++,Jr.isDigit($e)){var mt=$e-"0";F.selfMultiply(I.TEN),F.selfAdd(mt),q++}else{if($e!=="."){if($e==="e"||$e==="E"){var zt=c.substring(d);try{me=Ji.parseInt(zt)}catch(ti){throw ti instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+zt+" in string "+c):ti}break}throw new NumberFormatException("Unexpected character '"+$e+"' at position "+d+" in string "+c)}Y=q,Ue=!0}}var Nt=F;Ue||(Y=q);var gn=q-Y-me;if(gn===0)Nt=F;else if(gn>0){var bn=I.TEN.pow(gn);Nt=F.divide(bn)}else if(gn<0){var Pn=I.TEN.pow(-gn);Nt=F.multiply(Pn)}return b?Nt.negate():Nt}},{key:"createNaN",value:function(){return new I(vt.NaN,vt.NaN)}},{key:"copy",value:function(c){return new I(c)}},{key:"magnitude",value:function(c){var d=Math.abs(c),p=Math.log(d)/Math.log(10),b=Math.trunc(Math.floor(p));return 10*Math.pow(10,b)<=d&&(b+=1),b}},{key:"stringOfChar",value:function(c,d){for(var p=new qi,b=0;b<d;b++)p.append(c);return p.toString()}}]),I}();ct.PI=new ct(3.141592653589793,12246467991473532e-32),ct.TWO_PI=new ct(6.283185307179586,24492935982947064e-32),ct.PI_2=new ct(1.5707963267948966,6123233995736766e-32),ct.E=new ct(2.718281828459045,14456468917292502e-32),ct.NaN=new ct(vt.NaN,vt.NaN),ct.EPS=123259516440783e-46,ct.SPLIT=134217729,ct.MAX_PRINT_DIGITS=32,ct.TEN=ct.valueOf(10),ct.ONE=ct.valueOf(1),ct.SCI_NOT_EXPONENT_CHAR="E",ct.SCI_NOT_ZERO="0.0E0";var gr=function(){function I(){i(this,I)}return a(I,null,[{key:"orientationIndex",value:function(c,d,p){var b=I.orientationIndexFilter(c,d,p);if(b<=1)return b;var M=ct.valueOf(d.x).selfAdd(-c.x),F=ct.valueOf(d.y).selfAdd(-c.y),q=ct.valueOf(p.x).selfAdd(-d.x),Y=ct.valueOf(p.y).selfAdd(-d.y);return M.selfMultiply(Y).selfSubtract(F.selfMultiply(q)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof ct&&arguments[2]instanceof ct&&arguments[0]instanceof ct&&arguments[1]instanceof ct){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3],M=c.multiply(b).selfSubtract(d.multiply(p));return M.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var F=arguments[0],q=arguments[1],Y=arguments[2],me=arguments[3],Ue=ct.valueOf(F),$e=ct.valueOf(q),mt=ct.valueOf(Y),zt=ct.valueOf(me),Nt=Ue.multiply(zt).selfSubtract($e.multiply(mt));return Nt.signum()}}},{key:"intersection",value:function(c,d,p,b){var M=new ct(c.y).selfSubtract(d.y),F=new ct(d.x).selfSubtract(c.x),q=new ct(c.x).selfMultiply(d.y).selfSubtract(new ct(d.x).selfMultiply(c.y)),Y=new ct(p.y).selfSubtract(b.y),me=new ct(b.x).selfSubtract(p.x),Ue=new ct(p.x).selfMultiply(b.y).selfSubtract(new ct(b.x).selfMultiply(p.y)),$e=F.multiply(Ue).selfSubtract(me.multiply(q)),mt=Y.multiply(q).selfSubtract(M.multiply(Ue)),zt=M.multiply(me).selfSubtract(Y.multiply(F)),Nt=$e.selfDivide(zt).doubleValue(),gn=mt.selfDivide(zt).doubleValue();return vt.isNaN(Nt)||vt.isInfinite(Nt)||vt.isNaN(gn)||vt.isInfinite(gn)?null:new Xe(Nt,gn)}},{key:"orientationIndexFilter",value:function(c,d,p){var b=null,M=(c.x-p.x)*(d.y-p.y),F=(c.y-p.y)*(d.x-p.x),q=M-F;if(M>0){if(F<=0)return I.signum(q);b=M+F}else{if(!(M<0)||F>=0)return I.signum(q);b=-M-F}var Y=I.DP_SAFE_EPSILON*b;return q>=Y||-q>=Y?I.signum(q):2}},{key:"signum",value:function(c){return c>0?1:c<0?-1:0}}]),I}();gr.DP_SAFE_EPSILON=1e-15;var kn=function(){function I(){i(this,I)}return a(I,[{key:"getM",value:function(c){if(this.hasM()){var d=this.getDimension()-this.getMeasures();return this.getOrdinate(c,d)}return vt.NaN}},{key:"setOrdinate",value:function(c,d,p){}},{key:"getZ",value:function(c){return this.hasZ()?this.getOrdinate(c,2):vt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(c,d){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(c){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(c){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(c){}},{key:"copy",value:function(){}},{key:"getY",value:function(c){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[xe]}}]),I}();kn.X=0,kn.Y=1,kn.Z=2,kn.M=3;var mn=function(){function I(){i(this,I)}return a(I,null,[{key:"index",value:function(c,d,p){return gr.orientationIndex(c,d,p)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var c=arguments[0],d=c.length-1;if(d<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=c[0],b=0,M=1;M<=d;M++){var F=c[M];F.y>p.y&&(p=F,b=M)}var q=b;do(q-=1)<0&&(q=d);while(c[q].equals2D(p)&&q!==b);var Y=b;do Y=(Y+1)%d;while(c[Y].equals2D(p)&&Y!==b);var me=c[q],Ue=c[Y];if(me.equals2D(p)||Ue.equals2D(p)||me.equals2D(Ue))return!1;var $e=I.index(me,p,Ue),mt=null;return mt=$e===0?me.x>Ue.x:$e>0,mt}if(xn(arguments[0],kn)){var zt=arguments[0],Nt=zt.size()-1;if(Nt<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var gn=zt.getCoordinate(0),bn=0,Pn=1;Pn<=Nt;Pn++){var ti=zt.getCoordinate(Pn);ti.y>gn.y&&(gn=ti,bn=Pn)}var mi=null,li=bn;do(li-=1)<0&&(li=Nt),mi=zt.getCoordinate(li);while(mi.equals2D(gn)&&li!==bn);var er=null,rs=bn;do rs=(rs+1)%Nt,er=zt.getCoordinate(rs);while(er.equals2D(gn)&&rs!==bn);if(mi.equals2D(gn)||er.equals2D(gn)||mi.equals2D(er))return!1;var Ps=I.index(mi,gn,er);return Ps===0?mi.x>er.x:Ps>0}}}]),I}();mn.CLOCKWISE=-1,mn.RIGHT=mn.CLOCKWISE,mn.COUNTERCLOCKWISE=1,mn.LEFT=mn.COUNTERCLOCKWISE,mn.COLLINEAR=0,mn.STRAIGHT=mn.COLLINEAR;var As=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(c,d){var p=this.getRightmostSideOfSegment(c,d);return p<0&&(p=this.getRightmostSideOfSegment(c,d-1)),p<0&&(this._minCoord=null,this.checkForRightmostCoordinate(c)),p}},{key:"findRightmostEdgeAtVertex",value:function(){var c=this._minDe.getEdge().getCoordinates();It.isTrue(this._minIndex>0&&this._minIndex<c.length,"rightmost point expected to be interior vertex of edge");var d=c[this._minIndex-1],p=c[this._minIndex+1],b=mn.index(this._minCoord,p,d),M=!1;(d.y<this._minCoord.y&&p.y<this._minCoord.y&&b===mn.COUNTERCLOCKWISE||d.y>this._minCoord.y&&p.y>this._minCoord.y&&b===mn.CLOCKWISE)&&(M=!0),M&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(c,d){var p=c.getEdge().getCoordinates();if(d<0||d+1>=p.length||p[d].y===p[d+1].y)return-1;var b=Ee.LEFT;return p[d].y<p[d+1].y&&(b=Ee.RIGHT),b}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(c){for(var d=c.getEdge().getCoordinates(),p=0;p<d.length-1;p++)(this._minCoord===null||d[p].x>this._minCoord.x)&&(this._minDe=c,this._minIndex=p,this._minCoord=d[p])}},{key:"findRightmostEdgeAtNode",value:function(){var c=this._minDe.getNode().getEdges();this._minDe=c.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();p.isForward()&&this.checkForRightmostCoordinate(p)}It.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ee.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),I}(),At=function(I){f(d,I);var c=B(d);function d(p,b){var M;return i(this,d),(M=c.call(this,b?p+" [ "+b+" ]":p)).pt=b?new Xe(b):void 0,M.name=Object.keys({TopologyException:d})[0],M}return a(d,[{key:"getCoordinate",value:function(){return this.pt}}]),d}(ft),Ln=function(){function I(){i(this,I),this.array=[]}return a(I,[{key:"addLast",value:function(c){this.array.push(c)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),I}(),Tt=function(I,c){f(p,I);var d=B(p);function p(b){var M;return i(this,p),(M=d.call(this)).array=[],b instanceof lt&&M.addAll(b),M}return a(p,[{key:"interfaces_",get:function(){return[Kn,lt]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(b){return arguments.length===1?this.array.push(b):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(b){var M,F=J(b);try{for(F.s();!(M=F.n()).done;){var q=M.value;this.array.push(q)}}catch(Y){F.e(Y)}finally{F.f()}}},{key:"set",value:function(b,M){var F=this.array[b];return this.array[b]=M,F}},{key:"iterator",value:function(){return new _r(this)}},{key:"get",value:function(b){if(b<0||b>=this.size())throw new _n;return this.array[b]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(b){b?this.array.sort(function(M,F){return b.compare(M,F)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(b){for(var M=0,F=this.array.length;M<F;M++)if(this.array[M]===b)return!!this.array.splice(M,1);return!1}},{key:c,value:function(){return this.array.values()}}]),p}(Kn,Symbol.iterator),_r=function(){function I(c){i(this,I),this.arrayList=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Je;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(c){return this.arrayList.set(this.position-1,c)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),I}(),Gr=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"clearVisitedEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();)c.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(c){for(var d=null,p=c.getEdges().iterator();p.hasNext();){var b=p.next();if(b.isVisited()||b.getSym().isVisited()){d=b;break}}if(d===null)throw new At("unable to find edge to compute depths at "+c.getCoordinate());c.getEdges().computeDepths(d);for(var M=c.getEdges().iterator();M.hasNext();){var F=M.next();F.setVisited(!0),this.copySymDepths(F)}}},{key:"computeDepth",value:function(c){this.clearVisitedEdges();var d=this._finder.getEdge();d.getNode(),d.getLabel(),d.setEdgeDepths(Ee.RIGHT,c),this.copySymDepths(d),this.computeDepths(d)}},{key:"create",value:function(c){this.addReachable(c),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();){var d=c.next();d.getDepth(Ee.RIGHT)>=1&&d.getDepth(Ee.LEFT)<=0&&!d.isInteriorAreaEdge()&&d.setInResult(!0)}}},{key:"computeDepths",value:function(c){var d=new kt,p=new Ln,b=c.getNode();for(p.addLast(b),d.add(b),c.setVisited(!0);!p.isEmpty();){var M=p.removeFirst();d.add(M),this.computeNodeDepth(M);for(var F=M.getEdges().iterator();F.hasNext();){var q=F.next().getSym();if(!q.isVisited()){var Y=q.getNode();d.contains(Y)||(p.addLast(Y),d.add(Y))}}}}},{key:"compareTo",value:function(c){var d=c;return this._rightMostCoord.x<d._rightMostCoord.x?-1:this._rightMostCoord.x>d._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var c=new dn,d=this._dirEdgeList.iterator();d.hasNext();)for(var p=d.next().getEdge().getCoordinates(),b=0;b<p.length-1;b++)c.expandToInclude(p[b]);this._env=c}return this._env}},{key:"addReachable",value:function(c){var d=new Yi;for(d.add(c);!d.empty();){var p=d.pop();this.add(p,d)}}},{key:"copySymDepths",value:function(c){var d=c.getSym();d.setDepth(Ee.LEFT,c.getDepth(Ee.RIGHT)),d.setDepth(Ee.RIGHT,c.getDepth(Ee.LEFT))}},{key:"add",value:function(c,d){c.setVisited(!0),this._nodes.add(c);for(var p=c.getEdges().iterator();p.hasNext();){var b=p.next();this._dirEdgeList.add(b);var M=b.getSym().getNode();M.isVisited()||d.push(M)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new Tt,this._nodes=new Tt,this._rightMostCoord=null,this._env=null,this._finder=new As}}]),I}(),wn=function(){function I(){i(this,I)}return a(I,null,[{key:"intersection",value:function(c,d,p,b){var M=c.x<d.x?c.x:d.x,F=c.y<d.y?c.y:d.y,q=c.x>d.x?c.x:d.x,Y=c.y>d.y?c.y:d.y,me=p.x<b.x?p.x:b.x,Ue=p.y<b.y?p.y:b.y,$e=p.x>b.x?p.x:b.x,mt=p.y>b.y?p.y:b.y,zt=((M>me?M:me)+(q<$e?q:$e))/2,Nt=((F>Ue?F:Ue)+(Y<mt?Y:mt))/2,gn=c.x-zt,bn=c.y-Nt,Pn=d.x-zt,ti=d.y-Nt,mi=p.x-zt,li=p.y-Nt,er=b.x-zt,rs=b.y-Nt,Ps=bn-ti,fi=Pn-gn,Ar=gn*ti-Pn*bn,dr=li-rs,Rs=er-mi,Xa=mi*rs-er*li,xa=Ps*Rs-dr*fi,lo=(fi*Xa-Rs*Ar)/xa,ks=(dr*Ar-Ps*Xa)/xa;return vt.isNaN(lo)||vt.isInfinite(lo)||vt.isNaN(ks)||vt.isInfinite(ks)?null:new Xe(lo+zt,ks+Nt)}}]),I}(),Mi=function(){function I(){i(this,I)}return a(I,null,[{key:"arraycopy",value:function(c,d,p,b,M){for(var F=0,q=d;q<d+M;q++)p[b+F]=c[q],F++}},{key:"getProperty",value:function(c){return{"line.separator":`
`}[c]}}]),I}(),Er=function(){function I(){i(this,I)}return a(I,null,[{key:"log10",value:function(c){var d=Math.log(c);return vt.isInfinite(d)||vt.isNaN(d)?d:d/I.LOG_10}},{key:"min",value:function(c,d,p,b){var M=c;return d<M&&(M=d),p<M&&(M=p),b<M&&(M=b),M}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2];return c<d?d:c>p?p:c}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],M=arguments[1],F=arguments[2];return b<M?M:b>F?F:b}}},{key:"wrap",value:function(c,d){return c<0?d- -c%d:c%d}},{key:"max",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2],b=c;return d>b&&(b=d),p>b&&(b=p),b}if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3],me=M;return F>me&&(me=F),q>me&&(me=q),Y>me&&(me=Y),me}}},{key:"average",value:function(c,d){return(c+d)/2}}]),I}();Er.LOG_10=Math.log(10);var Ki=function(){function I(){i(this,I)}return a(I,null,[{key:"segmentToSegment",value:function(c,d,p,b){if(c.equals(d))return I.pointToSegment(c,p,b);if(p.equals(b))return I.pointToSegment(b,c,d);var M=!1;if(dn.intersects(c,d,p,b)){var F=(d.x-c.x)*(b.y-p.y)-(d.y-c.y)*(b.x-p.x);if(F===0)M=!0;else{var q=(c.y-p.y)*(b.x-p.x)-(c.x-p.x)*(b.y-p.y),Y=((c.y-p.y)*(d.x-c.x)-(c.x-p.x)*(d.y-c.y))/F,me=q/F;(me<0||me>1||Y<0||Y>1)&&(M=!0)}}else M=!0;return M?Er.min(I.pointToSegment(c,p,b),I.pointToSegment(d,p,b),I.pointToSegment(p,c,d),I.pointToSegment(b,c,d)):0}},{key:"pointToSegment",value:function(c,d,p){if(d.x===p.x&&d.y===p.y)return c.distance(d);var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),M=((c.x-d.x)*(p.x-d.x)+(c.y-d.y)*(p.y-d.y))/b;if(M<=0)return c.distance(d);if(M>=1)return c.distance(p);var F=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(F)*Math.sqrt(b)}},{key:"pointToLinePerpendicular",value:function(c,d,p){var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),M=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(M)*Math.sqrt(b)}},{key:"pointToSegmentString",value:function(c,d){if(d.length===0)throw new ve("Line array must contain at least one vertex");for(var p=c.distance(d[0]),b=0;b<d.length-1;b++){var M=I.pointToSegment(c,d[b],d[b+1]);M<p&&(p=M)}return p}}]),I}(),Zr=function(){function I(){i(this,I)}return a(I,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||xn(arguments[0],kn);else if(arguments.length!==2&&arguments.length===3){var c=arguments[0],d=arguments[1];return this.create(c,d)}}}]),I}(),Ae=function(){function I(){i(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),Q=function(){function I(){i(this,I)}return a(I,null,[{key:"ofLine",value:function(c){var d=c.size();if(d<=1)return 0;var p=0,b=new Xe;c.getCoordinate(0,b);for(var M=b.x,F=b.y,q=1;q<d;q++){c.getCoordinate(q,b);var Y=b.x,me=b.y,Ue=Y-M,$e=me-F;p+=Math.sqrt(Ue*Ue+$e*$e),M=Y,F=me}return p}}]),I}(),K=function I(){i(this,I)},he=function(){function I(){i(this,I)}return a(I,null,[{key:"copyCoord",value:function(c,d,p,b){for(var M=Math.min(c.getDimension(),p.getDimension()),F=0;F<M;F++)p.setOrdinate(b,F,c.getOrdinate(d,F))}},{key:"isRing",value:function(c){var d=c.size();return d===0||!(d<=3)&&c.getOrdinate(0,kn.X)===c.getOrdinate(d-1,kn.X)&&c.getOrdinate(0,kn.Y)===c.getOrdinate(d-1,kn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(xn(arguments[0],kn)&&Number.isInteger(arguments[1])){var c=arguments[0],d=arguments[1];I.scroll(c,d,I.isRing(c))}else if(xn(arguments[0],kn)&&arguments[1]instanceof Xe){var p=arguments[0],b=arguments[1],M=I.indexOf(b,p);if(M<=0)return null;I.scroll(p,M)}}else if(arguments.length===3){var F=arguments[0],q=arguments[1],Y=arguments[2],me=q;if(me<=0)return null;for(var Ue=F.copy(),$e=Y?F.size()-1:F.size(),mt=0;mt<$e;mt++)for(var zt=0;zt<F.getDimension();zt++)F.setOrdinate(mt,zt,Ue.getOrdinate((q+mt)%$e,zt));if(Y)for(var Nt=0;Nt<F.getDimension();Nt++)F.setOrdinate($e,Nt,F.getOrdinate(0,Nt))}}},{key:"isEqual",value:function(c,d){var p=c.size();if(p!==d.size())return!1;for(var b=Math.min(c.getDimension(),d.getDimension()),M=0;M<p;M++)for(var F=0;F<b;F++){var q=c.getOrdinate(M,F),Y=d.getOrdinate(M,F);if(c.getOrdinate(M,F)!==d.getOrdinate(M,F)&&(!vt.isNaN(q)||!vt.isNaN(Y)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var c=arguments[0];return I.minCoordinateIndex(c,0,c.size()-1)}if(arguments.length===3){for(var d=arguments[0],p=arguments[1],b=arguments[2],M=-1,F=null,q=p;q<=b;q++){var Y=d.getCoordinate(q);(F===null||F.compareTo(Y)>0)&&(F=Y,M=q)}return M}}},{key:"extend",value:function(c,d,p){var b=c.create(p,d.getDimension()),M=d.size();if(I.copy(d,0,b,0,M),M>0)for(var F=M;F<p;F++)I.copy(d,M-1,b,F,1);return b}},{key:"reverse",value:function(c){for(var d=c.size()-1,p=Math.trunc(d/2),b=0;b<=p;b++)I.swap(c,b,d-b)}},{key:"swap",value:function(c,d,p){if(d===p)return null;for(var b=0;b<c.getDimension();b++){var M=c.getOrdinate(d,b);c.setOrdinate(d,b,c.getOrdinate(p,b)),c.setOrdinate(p,b,M)}}},{key:"copy",value:function(c,d,p,b,M){for(var F=0;F<M;F++)I.copyCoord(c,d+F,p,b+F)}},{key:"ensureValidRing",value:function(c,d){var p=d.size();return p===0?d:p<=3?I.createClosedRing(c,d,4):d.getOrdinate(0,kn.X)===d.getOrdinate(p-1,kn.X)&&d.getOrdinate(0,kn.Y)===d.getOrdinate(p-1,kn.Y)?d:I.createClosedRing(c,d,p+1)}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.size();p++)if(c.x===d.getOrdinate(p,kn.X)&&c.y===d.getOrdinate(p,kn.Y))return p;return-1}},{key:"createClosedRing",value:function(c,d,p){var b=c.create(p,d.getDimension()),M=d.size();I.copy(d,0,b,0,M);for(var F=M;F<p;F++)I.copy(d,0,b,F,1);return b}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.size();p++){var b=c.getCoordinate(p);(d===null||d.compareTo(b)>0)&&(d=b)}return d}}]),I}(),le=function(){function I(){i(this,I)}return a(I,null,[{key:"toDimensionSymbol",value:function(c){switch(c){case I.FALSE:return I.SYM_FALSE;case I.TRUE:return I.SYM_TRUE;case I.DONTCARE:return I.SYM_DONTCARE;case I.P:return I.SYM_P;case I.L:return I.SYM_L;case I.A:return I.SYM_A}throw new ve("Unknown dimension value: "+c)}},{key:"toDimensionValue",value:function(c){switch(Jr.toUpperCase(c)){case I.SYM_FALSE:return I.FALSE;case I.SYM_TRUE:return I.TRUE;case I.SYM_DONTCARE:return I.DONTCARE;case I.SYM_P:return I.P;case I.SYM_L:return I.L;case I.SYM_A:return I.A}throw new ve("Unknown dimension symbol: "+c)}}]),I}();le.P=0,le.L=1,le.A=2,le.FALSE=-1,le.TRUE=-2,le.DONTCARE=-3,le.SYM_FALSE="F",le.SYM_TRUE="T",le.SYM_DONTCARE="*",le.SYM_P="0",le.SYM_L="1",le.SYM_A="2";var de=function(){function I(){i(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),Ve=function(){function I(){i(this,I)}return a(I,[{key:"filter",value:function(c,d){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),I}(),We=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new dn:this._points.expandEnvelope(new dn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var M=p;if(this._points.size()!==M._points.size())return!1;for(var F=0;F<this._points.size();F++)if(!this.equal(this._points.getCoordinate(F),M._points.getCoordinate(F),b))return!1;return!0}return U(g(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<Math.trunc(this._points.size()/2);p++){var b=this._points.size()-1-p;if(!this._points.getCoordinate(p).equals(this._points.getCoordinate(b))){if(this._points.getCoordinate(p).compareTo(this._points.getCoordinate(b))>0){var M=this._points.copy();he.reverse(M),this._points=M}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var p=this._points.copy();return he.reverse(p),this.getFactory().createLineString(p)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Q.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var p=arguments[0],b=p,M=0,F=0;M<this._points.size()&&F<b._points.size();){var q=this._points.getCoordinate(M).compareTo(b._points.getCoordinate(F));if(q!==0)return q;M++,F++}return M<this._points.size()?1:F<b._points.size()?-1:0}if(arguments.length===2){var Y=arguments[0],me=arguments[1],Ue=Y;return me.compare(this._points,Ue._points)}}},{key:"apply",value:function(){if(xn(arguments[0],Ae))for(var p=arguments[0],b=0;b<this._points.size();b++)p.filter(this._points.getCoordinate(b));else if(xn(arguments[0],Ve)){var M=arguments[0];if(this._points.size()===0)return null;for(var F=0;F<this._points.size()&&(M.filter(this._points,F),!M.isDone());F++);M.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],de)){var q=arguments[0];q.filter(this)}else if(xn(arguments[0],Pe)){var Y=arguments[0];Y.filter(this)}}},{key:"getBoundary",value:function(){throw new Lt}},{key:"isEquivalentClass",value:function(p){return p instanceof d}},{key:"getCoordinateN",value:function(p){return this._points.getCoordinate(p)}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(p){if(p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),p.size()===1)throw new ve("Invalid number of points in LineString (found "+p.size()+" - must be 0 or >= 2)");this._points=p}},{key:"isCoordinate",value:function(p){for(var b=0;b<this._points.size();b++)if(this._points.getCoordinate(b).equals(p))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(p){return this.getFactory().createPoint(this._points.getCoordinate(p))}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];Ft.constructor_.call(this,b),this.init(p)}}}]),d}(Ft),Re=function I(){i(this,I)},et=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new dn;var p=new dn;return p.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),p}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new d(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&(!(!this.isEmpty()||!p.isEmpty())||this.isEmpty()===p.isEmpty()&&this.equal(p.getCoordinate(),this.getCoordinate(),b))}return U(g(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=p;return this.getCoordinate().compareTo(b.getCoordinate())}if(arguments.length===2){var M=arguments[0],F=arguments[1],q=M;return F.compare(this._coordinates,q._coordinates)}}},{key:"apply",value:function(){if(xn(arguments[0],Ae)){var p=arguments[0];if(this.isEmpty())return null;p.filter(this.getCoordinate())}else if(xn(arguments[0],Ve)){var b=arguments[0];if(this.isEmpty())return null;b.filter(this._coordinates,0),b.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],de)){var M=arguments[0];M.filter(this)}else if(xn(arguments[0],Pe)){var F=arguments[0];F.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(p){p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),It.isTrue(p.size()<=1),this._coordinates=p}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Re]}}],[{key:"constructor_",value:function(){this._coordinates=null;var p=arguments[0],b=arguments[1];Ft.constructor_.call(this,b),this.init(p)}}]),d}(Ft),gt=function(){function I(){i(this,I)}return a(I,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];return Math.abs(I.ofRingSigned(c))}if(xn(arguments[0],kn)){var d=arguments[0];return Math.abs(I.ofRingSigned(d))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];if(c.length<3)return 0;for(var d=0,p=c[0].x,b=1;b<c.length-1;b++){var M=c[b].x-p,F=c[b+1].y,q=c[b-1].y;d+=M*(q-F)}return d/2}if(xn(arguments[0],kn)){var Y=arguments[0],me=Y.size();if(me<3)return 0;var Ue=new Xe,$e=new Xe,mt=new Xe;Y.getCoordinate(0,$e),Y.getCoordinate(1,mt);var zt=$e.x;mt.x-=zt;for(var Nt=0,gn=1;gn<me-1;gn++)Ue.y=$e.y,$e.x=mt.x,$e.y=mt.y,Y.getCoordinate(gn+1,mt),mt.x-=zt,Nt+=$e.x*(Ue.y-mt.y);return Nt/2}}}]),I}(),at=function(){function I(){i(this,I)}return a(I,null,[{key:"sort",value:function(){var c=arguments,d=arguments[0];if(arguments.length===1)d.sort(function(zt,Nt){return zt.compareTo(Nt)});else if(arguments.length===2)d.sort(function(zt,Nt){return c[1].compare(zt,Nt)});else if(arguments.length===3){var p=d.slice(arguments[1],arguments[2]);p.sort();var b=d.slice(0,arguments[1]).concat(p,d.slice(arguments[2],d.length));d.splice(0,d.length);var M,F=J(b);try{for(F.s();!(M=F.n()).done;){var q=M.value;d.push(q)}}catch(zt){F.e(zt)}finally{F.f()}}else if(arguments.length===4){var Y=d.slice(arguments[1],arguments[2]);Y.sort(function(zt,Nt){return c[3].compare(zt,Nt)});var me=d.slice(0,arguments[1]).concat(Y,d.slice(arguments[2],d.length));d.splice(0,d.length);var Ue,$e=J(me);try{for($e.s();!(Ue=$e.n()).done;){var mt=Ue.value;d.push(mt)}}catch(zt){$e.e(zt)}finally{$e.f()}}}},{key:"asList",value:function(c){var d,p=new Tt,b=J(c);try{for(b.s();!(d=b.n()).done;){var M=d.value;p.add(M)}}catch(F){b.e(F)}finally{b.f()}return p}},{key:"copyOf",value:function(c,d){return c.slice(0,d)}}]),I}(),Dt=function I(){i(this,I)},en=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var p=new Array(this.getNumPoints()).fill(null),b=-1,M=this._shell.getCoordinates(),F=0;F<M.length;F++)p[++b]=M[F];for(var q=0;q<this._holes.length;q++)for(var Y=this._holes[q].getCoordinates(),me=0;me<Y.length;me++)p[++b]=Y[me];return p}},{key:"getArea",value:function(){var p=0;p+=gt.ofRing(this._shell.getCoordinateSequence());for(var b=0;b<this._holes.length;b++)p-=gt.ofRing(this._holes[b].getCoordinateSequence());return p}},{key:"copyInternal",value:function(){for(var p=this._shell.copy(),b=new Array(this._holes.length).fill(null),M=0;M<this._holes.length;M++)b[M]=this._holes[M].copy();return new d(p,b,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var p=this._shell.getCoordinateSequence(),b=this.getEnvelopeInternal(),M=0;M<5;M++){var F=p.getX(M);if(F!==b.getMinX()&&F!==b.getMaxX())return!1;var q=p.getY(M);if(q!==b.getMinY()&&q!==b.getMaxY())return!1}for(var Y=p.getX(0),me=p.getY(0),Ue=1;Ue<=4;Ue++){var $e=p.getX(Ue),mt=p.getY(Ue);if($e!==Y==(mt!==me))return!1;Y=$e,me=mt}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var M=p,F=this._shell,q=M._shell;if(!F.equalsExact(q,b)||this._holes.length!==M._holes.length)return!1;for(var Y=0;Y<this._holes.length;Y++)if(!this._holes[Y].equalsExact(M._holes[Y],b))return!1;return!0}return U(g(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var p=0;p<this._holes.length;p++)this._holes[p]=this.normalized(this._holes[p],!1);at.sort(this._holes)}else if(arguments.length===2){var b=arguments[0],M=arguments[1];if(b.isEmpty())return null;var F=b.getCoordinateSequence(),q=he.minCoordinateIndex(F,0,F.size()-2);he.scroll(F,q,!0),mn.isCCW(F)===M&&he.reverse(F)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var p=this.getExteriorRing().reverse(),b=new Array(this.getNumInteriorRing()).fill(null),M=0;M<b.length;M++)b[M]=this.getInteriorRingN(M).reverse();return this.getFactory().createPolygon(p,b)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var p=0;p+=this._shell.getLength();for(var b=0;b<this._holes.length;b++)p+=this._holes[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=this._shell.getNumPoints(),b=0;b<this._holes.length;b++)p+=this._holes[b].getNumPoints();return p}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(p,b){var M=p.copy();return this.normalize(M,b),M}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=this._shell,M=p._shell;return b.compareToSameClass(M)}if(arguments.length===2){var F=arguments[0],q=arguments[1],Y=F,me=this._shell,Ue=Y._shell,$e=me.compareToSameClass(Ue,q);if($e!==0)return $e;for(var mt=this.getNumInteriorRing(),zt=Y.getNumInteriorRing(),Nt=0;Nt<mt&&Nt<zt;){var gn=this.getInteriorRingN(Nt),bn=Y.getInteriorRingN(Nt),Pn=gn.compareToSameClass(bn,q);if(Pn!==0)return Pn;Nt++}return Nt<mt?1:Nt<zt?-1:0}}},{key:"apply",value:function(){if(xn(arguments[0],Ae)){var p=arguments[0];this._shell.apply(p);for(var b=0;b<this._holes.length;b++)this._holes[b].apply(p)}else if(xn(arguments[0],Ve)){var M=arguments[0];if(this._shell.apply(M),!M.isDone())for(var F=0;F<this._holes.length&&(this._holes[F].apply(M),!M.isDone());F++);M.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],de)){var q=arguments[0];q.filter(this)}else if(xn(arguments[0],Pe)){var Y=arguments[0];Y.filter(this),this._shell.apply(Y);for(var me=0;me<this._holes.length;me++)this._holes[me].apply(Y)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var p=new Array(this._holes.length+1).fill(null);p[0]=this._shell;for(var b=0;b<this._holes.length;b++)p[b+1]=this._holes[b];return p.length<=1?this.getFactory().createLinearRing(p[0].getCoordinateSequence()):this.getFactory().createMultiLineString(p)}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(p){return this._holes[p]}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var p=arguments[0],b=arguments[1],M=arguments[2];if(Ft.constructor_.call(this,M),p===null&&(p=this.getFactory().createLinearRing()),b===null&&(b=[]),Ft.hasNullElements(b))throw new ve("holes must not contain null elements");if(p.isEmpty()&&Ft.hasNonEmptyElements(b))throw new ve("shell is empty but holes are not");this._shell=p,this._holes=b}}]),d}(Ft),an=function(I){f(d,I);var c=B(d);function d(){return i(this,d),c.apply(this,arguments)}return d}(Ye),Vn=function(I){f(d,I);var c=B(d);function d(p){var b;return i(this,d),(b=c.call(this)).array=[],p instanceof lt&&b.addAll(p),b}return a(d,[{key:"contains",value:function(p){var b,M=J(this.array);try{for(M.s();!(b=M.n()).done;)if(b.value.compareTo(p)===0)return!0}catch(F){M.e(F)}finally{M.f()}return!1}},{key:"add",value:function(p){if(this.contains(p))return!1;for(var b=0,M=this.array.length;b<M;b++)if(this.array[b].compareTo(p)===1)return!!this.array.splice(b,0,p);return this.array.push(p),!0}},{key:"addAll",value:function(p){var b,M=J(p);try{for(M.s();!(b=M.n()).done;){var F=b.value;this.add(F)}}catch(q){M.e(q)}finally{M.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Mn(this.array)}}]),d}(an),Mn=function(){function I(c){i(this,I),this.array=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.array.length)throw new Je;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Lt}}]),I}(),An=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){for(var p=new dn,b=0;b<this._geometries.length;b++)p.expandToInclude(this._geometries[b].getEnvelopeInternal());return p}},{key:"getGeometryN",value:function(p){return this._geometries[p]}},{key:"getCoordinates",value:function(){for(var p=new Array(this.getNumPoints()).fill(null),b=-1,M=0;M<this._geometries.length;M++)for(var F=this._geometries[M].getCoordinates(),q=0;q<F.length;q++)p[++b]=F[q];return p}},{key:"getArea",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getArea();return p}},{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var M=p;if(this._geometries.length!==M._geometries.length)return!1;for(var F=0;F<this._geometries.length;F++)if(!this._geometries[F].equalsExact(M._geometries[F],b))return!1;return!0}return U(g(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<this._geometries.length;p++)this._geometries[p].normalize();at.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var p=le.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getBoundaryDimension());return p}},{key:"reverseInternal",value:function(){for(var p=this._geometries.length,b=new Tt(p),M=0;M<p;M++)b.add(this._geometries[M].reverse());return this.getFactory().buildGeometry(b)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var p=le.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getDimension());return p}},{key:"getLength",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getNumPoints();return p}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=new Vn(at.asList(this._geometries)),M=new Vn(at.asList(p._geometries));return this.compare(b,M)}if(arguments.length===2){for(var F=arguments[0],q=arguments[1],Y=F,me=this.getNumGeometries(),Ue=Y.getNumGeometries(),$e=0;$e<me&&$e<Ue;){var mt=this.getGeometryN($e),zt=Y.getGeometryN($e),Nt=mt.compareToSameClass(zt,q);if(Nt!==0)return Nt;$e++}return $e<me?1:$e<Ue?-1:0}}},{key:"apply",value:function(){if(xn(arguments[0],Ae))for(var p=arguments[0],b=0;b<this._geometries.length;b++)this._geometries[b].apply(p);else if(xn(arguments[0],Ve)){var M=arguments[0];if(this._geometries.length===0)return null;for(var F=0;F<this._geometries.length&&(this._geometries[F].apply(M),!M.isDone());F++);M.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],de)){var q=arguments[0];q.filter(this);for(var Y=0;Y<this._geometries.length;Y++)this._geometries[Y].apply(q)}else if(xn(arguments[0],Pe)){var me=arguments[0];me.filter(this);for(var Ue=0;Ue<this._geometries.length;Ue++)this._geometries[Ue].apply(me)}}},{key:"getBoundary",value:function(){return Ft.checkNotGeometryCollection(this),It.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];if(Ft.constructor_.call(this,b),p===null&&(p=[]),Ft.hasNullElements(p))throw new ve("geometries must not contain null elements");this._geometries=p}}}]),d}(Ft),Fn=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(g(d.prototype),"equalsExact",this).call(this,p,b)}return U(g(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var p=arguments[0];return this._geometries[p].getCoordinate()}return U(g(d.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Re]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];An.constructor_.call(this,p,b)}}]),d}(An),wi=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||U(g(d.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var p=this._points.copy();return he.reverse(p),this.getFactory().createLinearRing(p)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!U(g(d.prototype),"isClosed",this).call(this))throw new ve("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<d.MINIMUM_VALID_SIZE)throw new ve("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];We.constructor_.call(this,p,b),this.validateConstruction()}}]),d}(We);wi.MINIMUM_VALID_SIZE=4;var ui=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"getZ",value:function(){return Xe.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Xe.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];Xe.constructor_.call(this,p.x,p.y)}else if(arguments[0]instanceof Xe){var b=arguments[0];Xe.constructor_.call(this,b.x,b.y)}}else if(arguments.length===2){var M=arguments[0],F=arguments[1];Xe.constructor_.call(this,M,F,Xe.NULL_ORDINATE)}}}]),d}(Xe);ui.X=0,ui.Y=1,ui.Z=-1,ui.M=-1;var Cn=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;case d.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getZ",value:function(){return Xe.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y;case d.M:return this._m}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Xe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];Xe.constructor_.call(this,p.x,p.y),this._m=p._m}else if(arguments[0]instanceof Xe){var b=arguments[0];Xe.constructor_.call(this,b.x,b.y),this._m=this.getM()}}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];Xe.constructor_.call(this,M,F,Xe.NULL_ORDINATE),this._m=q}}}]),d}(Xe);Cn.X=0,Cn.Y=1,Cn.Z=-1,Cn.M=2;var ni=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case Xe.X:this.x=b;break;case Xe.Y:this.y=b;break;case Xe.Z:this.z=b;break;case Xe.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getOrdinate",value:function(p){switch(p){case Xe.X:return this.x;case Xe.Y:return this.y;case Xe.Z:return this.getZ();case Xe.M:return this.getM()}throw new ve("Invalid ordinate index: "+p)}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Xe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];Xe.constructor_.call(this,p),this._m=p._m}else if(arguments[0]instanceof Xe){var b=arguments[0];Xe.constructor_.call(this,b),this._m=this.getM()}}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];Xe.constructor_.call(this,M,F,q),this._m=Y}}}]),d}(Xe),hi=function(){function I(){i(this,I)}return a(I,null,[{key:"measures",value:function(c){return c instanceof ui?0:c instanceof Cn||c instanceof ni?1:0}},{key:"dimension",value:function(c){return c instanceof ui?2:c instanceof Cn?3:c instanceof ni?4:3}},{key:"create",value:function(){if(arguments.length===1){var c=arguments[0];return I.create(c,0)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return d===2?new ui:d===3&&p===0?new Xe:d===3&&p===1?new Cn:d===4&&p===1?new ni:new Xe}}}]),I}(),Ai=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getCoordinate",value:function(p){return this.get(p)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&xn(arguments[0],lt)){for(var p=arguments[0],b=arguments[1],M=!1,F=p.iterator();F.hasNext();)this.add(F.next(),b),M=!0;return M}return U(g(d.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var p=U(g(d.prototype),"clone",this).call(this),b=0;b<this.size();b++)p.add(b,this.get(b).clone());return p}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(d.coordArrayType);if(arguments.length===1){var p=arguments[0];if(p)return this.toArray(d.coordArrayType);for(var b=this.size(),M=new Array(b).fill(null),F=0;F<b;F++)M[F]=this.get(b-F-1);return M}}},{key:"add",value:function(){if(arguments.length===1){var p=arguments[0];return U(g(d.prototype),"add",this).call(this,p)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var b=arguments[0],M=arguments[1];return this.add(b,M,!0),!0}if(arguments[0]instanceof Xe&&typeof arguments[1]=="boolean"){var F=arguments[0],q=arguments[1];if(!q&&this.size()>=1){var Y=this.get(this.size()-1);if(Y.equals2D(F))return null}U(g(d.prototype),"add",this).call(this,F)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var me=arguments[0],Ue=arguments[1];return this.add(me,Ue),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var $e=arguments[0],mt=arguments[1],zt=arguments[2];if(zt)for(var Nt=0;Nt<$e.length;Nt++)this.add($e[Nt],mt);else for(var gn=$e.length-1;gn>=0;gn--)this.add($e[gn],mt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Xe){var bn=arguments[0],Pn=arguments[1],ti=arguments[2];if(!ti){var mi=this.size();if(mi>0){if(bn>0){var li=this.get(bn-1);if(li.equals2D(Pn))return null}if(bn<mi){var er=this.get(bn);if(er.equals2D(Pn))return null}}}U(g(d.prototype),"add",this).call(this,bn,Pn)}}else if(arguments.length===4){var rs=arguments[0],Ps=arguments[1],fi=arguments[2],Ar=arguments[3],dr=1;fi>Ar&&(dr=-1);for(var Rs=fi;Rs!==Ar;Rs+=dr)this.add(rs[Rs],Ps);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var p=this.get(0).copy();this.add(p,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.ensureCapacity(p.length),this.add(p,!0)}else if(arguments.length===2){var b=arguments[0],M=arguments[1];this.ensureCapacity(b.length),this.add(b,M)}}}}]),d}(Tt);Ai.coordArrayType=new Array(0).fill(null);var Xn=function(){function I(){i(this,I)}return a(I,null,[{key:"isRing",value:function(c){return!(c.length<4)&&!!c[0].equals2D(c[c.length-1])}},{key:"ptNotInList",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p];if(I.indexOf(b,d)<0)return b}return null}},{key:"scroll",value:function(c,d){var p=I.indexOf(d,c);if(p<0)return null;var b=new Array(c.length).fill(null);Mi.arraycopy(c,p,b,0,c.length-p),Mi.arraycopy(c,0,b,c.length-p,p),Mi.arraycopy(b,0,c,0,c.length)}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];if(c===d)return!0;if(c===null||d===null||c.length!==d.length)return!1;for(var p=0;p<c.length;p++)if(!c[p].equals(d[p]))return!1;return!0}if(arguments.length===3){var b=arguments[0],M=arguments[1],F=arguments[2];if(b===M)return!0;if(b===null||M===null||b.length!==M.length)return!1;for(var q=0;q<b.length;q++)if(F.compare(b[q],M[q])!==0)return!1;return!0}}},{key:"intersection",value:function(c,d){for(var p=new Ai,b=0;b<c.length;b++)d.intersects(c[b])&&p.add(c[b],!0);return p.toCoordinateArray()}},{key:"measures",value:function(c){if(c===null||c.length===0)return 0;var d,p=0,b=J(c);try{for(b.s();!(d=b.n()).done;){var M=d.value;p=Math.max(p,hi.measures(M))}}catch(F){b.e(F)}finally{b.f()}return p}},{key:"hasRepeatedPoints",value:function(c){for(var d=1;d<c.length;d++)if(c[d-1].equals(c[d]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(c){return I.hasRepeatedPoints(c)?new Ai(c,!1).toCoordinateArray():c}},{key:"reverse",value:function(c){for(var d=c.length-1,p=Math.trunc(d/2),b=0;b<=p;b++){var M=c[b];c[b]=c[d-b],c[d-b]=M}}},{key:"removeNull",value:function(c){for(var d=0,p=0;p<c.length;p++)c[p]!==null&&d++;var b=new Array(d).fill(null);if(d===0)return b;for(var M=0,F=0;F<c.length;F++)c[F]!==null&&(b[M++]=c[F]);return b}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Array(c.length).fill(null),p=0;p<c.length;p++)d[p]=c[p].copy();return d}if(arguments.length===5)for(var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3],Y=arguments[4],me=0;me<Y;me++)F[q+me]=b[M+me].copy()}},{key:"isEqualReversed",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p],M=d[c.length-p-1];if(b.compareTo(M)!==0)return!1}return!0}},{key:"envelope",value:function(c){for(var d=new dn,p=0;p<c.length;p++)d.expandToInclude(c[p]);return d}},{key:"toCoordinateArray",value:function(c){return c.toArray(I.coordArrayType)}},{key:"dimension",value:function(c){if(c===null||c.length===0)return 3;var d,p=0,b=J(c);try{for(b.s();!(d=b.n()).done;){var M=d.value;p=Math.max(p,hi.dimension(M))}}catch(F){b.e(F)}finally{b.f()}return p}},{key:"atLeastNCoordinatesOrNothing",value:function(c,d){return d.length>=c?d:[]}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.length;p++)if(c.equals(d[p]))return p;return-1}},{key:"increasingDirection",value:function(c){for(var d=0;d<Math.trunc(c.length/2);d++){var p=c.length-1-d,b=c[d].compareTo(c[p]);if(b!==0)return b}return 1}},{key:"compare",value:function(c,d){for(var p=0;p<c.length&&p<d.length;){var b=c[p].compareTo(d[p]);if(b!==0)return b;p++}return p<d.length?-1:p<c.length?1:0}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.length;p++)(d===null||d.compareTo(c[p])>0)&&(d=c[p]);return d}},{key:"extract",value:function(c,d,p){d=Er.clamp(d,0,c.length);var b=(p=Er.clamp(p,-1,c.length))-d+1;p<0&&(b=0),d>=c.length&&(b=0),p<d&&(b=0);var M=new Array(b).fill(null);if(b===0)return M;for(var F=0,q=d;q<=p;q++)M[F++]=c[q];return M}}]),I}(),Tr=function(){function I(){i(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;return Xn.compare(p,b)}},{key:"interfaces_",get:function(){return[wt]}}]),I}(),No=function(){function I(){i(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;var M=Xn.compare(p,b);return Xn.isEqualReversed(p,b)?0:M}},{key:"OLDcompare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;for(var M=Xn.increasingDirection(p),F=Xn.increasingDirection(b),q=M>0?0:p.length-1,Y=F>0?0:p.length-1,me=0;me<p.length;me++){var Ue=p[q].compareTo(b[Y]);if(Ue!==0)return Ue;q+=M,Y+=F}return 0}},{key:"interfaces_",get:function(){return[wt]}}]),I}();Xn.ForwardComparator=Tr,Xn.BidirectionalComparator=No,Xn.coordArrayType=new Array(0).fill(null);var Qn=function(){function I(c){i(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),bo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(c){return this.hasM()?this._coordinates[c].getM():vt.NaN}},{key:"setOrdinate",value:function(c,d,p){switch(d){case kn.X:this._coordinates[c].x=p;break;case kn.Y:this._coordinates[c].y=p;break;default:this._coordinates[c].setOrdinate(d,p)}}},{key:"getZ",value:function(c){return this.hasZ()?this._coordinates[c].getZ():vt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(c,d){switch(d){case kn.X:return this._coordinates[c].x;case kn.Y:return this._coordinates[c].y;default:return this._coordinates[c].getOrdinate(d)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var c=arguments[0];return this._coordinates[c]}if(arguments.length===2){var d=arguments[0],p=arguments[1];p.setCoordinate(this._coordinates[d])}}},{key:"getCoordinateCopy",value:function(c){var d=this.createCoordinate();return d.setCoordinate(this._coordinates[c]),d}},{key:"createCoordinate",value:function(){return hi.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(c){return this._coordinates[c].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(c){for(var d=0;d<this._coordinates.length;d++)c.expandToInclude(this._coordinates[d]);return c}},{key:"copy",value:function(){for(var c=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++){var p=this.createCoordinate();p.setCoordinate(this._coordinates[d]),c[d]=p}return new I(c,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var c=new Qn(17*this._coordinates.length);c.append("("),c.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)c.append(", "),c.append(this._coordinates[d]);return c.append(")"),c.toString()}return"()"}},{key:"getY",value:function(c){return this._coordinates[c].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[kn,be]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];I.constructor_.call(this,c,Xn.dimension(c),Xn.measures(c))}else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=new Array(d).fill(null);for(var p=0;p<d;p++)this._coordinates[p]=new Xe}else if(xn(arguments[0],kn)){var b=arguments[0];if(b===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=b.getDimension(),this._measures=b.getMeasures(),this._coordinates=new Array(b.size()).fill(null);for(var M=0;M<this._coordinates.length;M++)this._coordinates[M]=b.getCoordinateCopy(M)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var F=arguments[0],q=arguments[1];I.constructor_.call(this,F,q,Xn.measures(F))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Y=arguments[0],me=arguments[1];this._coordinates=new Array(Y).fill(null),this._dimension=me;for(var Ue=0;Ue<Y;Ue++)this._coordinates[Ue]=hi.create(me)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var $e=arguments[0],mt=arguments[1],zt=arguments[2];this._dimension=mt,this._measures=zt,this._coordinates=$e===null?new Array(0).fill(null):$e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Nt=arguments[0],gn=arguments[1],bn=arguments[2];this._coordinates=new Array(Nt).fill(null),this._dimension=gn,this._measures=bn;for(var Pn=0;Pn<Nt;Pn++)this._coordinates[Pn]=this.createCoordinate()}}}}]),I}(),aa=function(){function I(){i(this,I)}return a(I,[{key:"readResolve",value:function(){return I.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new bo(c)}if(xn(arguments[0],kn)){var d=arguments[0];return new bo(d)}}else{if(arguments.length===2){var p=arguments[0],b=arguments[1];return b>3&&(b=3),b<2&&(b=2),new bo(p,b)}if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2],Y=F-q;return q>1&&(q=1),Y>3&&(Y=3),Y<2&&(Y=2),new bo(M,Y+q,q)}}}},{key:"interfaces_",get:function(){return[Zr,be]}}],[{key:"instance",value:function(){return I.instanceObject}}]),I}();aa.instanceObject=new aa;var Cr=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(g(d.prototype),"equalsExact",this).call(this,p,b)}return U(g(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var p=new Tt,b=0;b<this._geometries.length;b++)for(var M=this._geometries[b].getBoundary(),F=0;F<M.getNumGeometries();F++)p.add(M.getGeometryN(F));var q=new Array(p.size()).fill(null);return this.getFactory().createMultiLineString(p.toArray(q))}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];An.constructor_.call(this,p,b)}}]),d}(An),Dr=function(){function I(){i(this,I)}return a(I,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),I}(),yc=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),(p=c.call(this)).map=new Map,p}return a(d,[{key:"get",value:function(p){return this.map.get(p)||null}},{key:"put",value:function(p,b){return this.map.set(p,b),b}},{key:"values",value:function(){for(var p=new Tt,b=this.map.values(),M=b.next();!M.done;)p.add(M.value),M=b.next();return p}},{key:"entrySet",value:function(){var p=new kt;return this.map.entries().forEach(function(b){return p.add(b)}),p}},{key:"size",value:function(){return this.map.size()}}]),d}(Dr),Pi=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this._modelType===d._modelType&&this._scale===d._scale}},{key:"compareTo",value:function(c){var d=c,p=this.getMaximumSignificantDigits(),b=d.getMaximumSignificantDigits();return Ji.compare(p,b)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===I.FLOATING||this._modelType===I.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var c="UNKNOWN";return this._modelType===I.FLOATING?c="Floating":this._modelType===I.FLOATING_SINGLE?c="Floating-Single":this._modelType===I.FIXED&&(c="Fixed (Scale="+this.getScale()+")"),c}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var c=arguments[0];return vt.isNaN(c)||this._modelType===I.FLOATING_SINGLE?c:this._modelType===I.FIXED?Math.round(c*this._scale)/this._scale:c}if(arguments[0]instanceof Xe){var d=arguments[0];if(this._modelType===I.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}}},{key:"getMaximumSignificantDigits",value:function(){var c=16;return this._modelType===I.FLOATING?c=16:this._modelType===I.FLOATING_SINGLE?c=6:this._modelType===I.FIXED&&(c=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),c}},{key:"setScale",value:function(c){this._scale=Math.abs(c)}},{key:"interfaces_",get:function(){return[be,ue]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=I.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof or){var c=arguments[0];this._modelType=c,c===I.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var d=arguments[0];this._modelType=I.FIXED,this.setScale(d)}else if(arguments[0]instanceof I){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}}},{key:"mostPrecise",value:function(c,d){return c.compareTo(d)>=0?c:d}}]),I}(),or=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"readResolve",value:function(){return I.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){this._name=null;var c=arguments[0];this._name=c,I.nameToTypeMap.put(c,this)}}]),I}();or.nameToTypeMap=new yc,Pi.Type=or,Pi.FIXED=new or("FIXED"),Pi.FLOATING=new or("FLOATING"),Pi.FLOATING_SINGLE=new or("FLOATING SINGLE"),Pi.maximumPreciseValue=9007199254740992;var no=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(g(d.prototype),"equalsExact",this).call(this,p,b)}return U(g(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Lt}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];An.constructor_.call(this,p,b)}}]),d}(An),Kr=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"createEmpty",value:function(c){switch(c){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new ve("Invalid dimension: "+c)}}},{key:"toGeometry",value:function(c){return c.isNull()?this.createPoint():c.getMinX()===c.getMaxX()&&c.getMinY()===c.getMaxY()?this.createPoint(new Xe(c.getMinX(),c.getMinY())):c.getMinX()===c.getMaxX()||c.getMinY()===c.getMaxY()?this.createLineString([new Xe(c.getMinX(),c.getMinY()),new Xe(c.getMaxX(),c.getMaxY())]):this.createPolygon(this.createLinearRing([new Xe(c.getMinX(),c.getMinY()),new Xe(c.getMinX(),c.getMaxY()),new Xe(c.getMaxX(),c.getMaxY()),new Xe(c.getMaxX(),c.getMinY()),new Xe(c.getMinX(),c.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLineString(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new We(d,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new no(null,this);if(arguments.length===1){var c=arguments[0];return new no(c,this)}}},{key:"buildGeometry",value:function(c){for(var d=null,p=!1,b=!1,M=c.iterator();M.hasNext();){var F=M.next(),q=F.getTypeCode();d===null&&(d=q),q!==d&&(p=!0),F instanceof An&&(b=!0)}if(d===null)return this.createGeometryCollection();if(p||b)return this.createGeometryCollection(I.toGeometryArray(c));var Y=c.iterator().next();if(c.size()>1){if(Y instanceof en)return this.createMultiPolygon(I.toPolygonArray(c));if(Y instanceof We)return this.createMultiLineString(I.toLineStringArray(c));if(Y instanceof et)return this.createMultiPoint(I.toPointArray(c));It.shouldNeverReachHere("Unhandled geometry type: "+Y.getGeometryType())}return Y}},{key:"createMultiPointFromCoords",value:function(c){return this.createMultiPoint(c!==null?this.getCoordinateSequenceFactory().create(c):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];return this.createPoint(c!==null?this.getCoordinateSequenceFactory().create([c]):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new et(d,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(xn(arguments[0],kn)){var c=arguments[0];return this.createPolygon(this.createLinearRing(c))}if(arguments[0]instanceof Array){var d=arguments[0];return this.createPolygon(this.createLinearRing(d))}if(arguments[0]instanceof wi){var p=arguments[0];return this.createPolygon(p,null)}}else if(arguments.length===2){var b=arguments[0],M=arguments[1];return new en(b,M,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new An(null,this);if(arguments.length===1){var c=arguments[0];return new An(c,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLinearRing(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new wi(d,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new Cr(null,this);if(arguments.length===1){var c=arguments[0];return new Cr(c,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Fn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new Fn(c,this)}if(xn(arguments[0],kn)){var d=arguments[0];if(d===null)return this.createMultiPoint(new Array(0).fill(null));for(var p=new Array(d.size()).fill(null),b=0;b<d.size();b++){var M=this.getCoordinateSequenceFactory().create(1,d.getDimension(),d.getMeasures());he.copy(d,b,M,0,1),p[b]=this.createPoint(M)}return this.createMultiPoint(p)}}}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)I.constructor_.call(this,new Pi,0);else if(arguments.length===1){if(xn(arguments[0],Zr)){var c=arguments[0];I.constructor_.call(this,new Pi,0,c)}else if(arguments[0]instanceof Pi){var d=arguments[0];I.constructor_.call(this,d,0,I.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];I.constructor_.call(this,p,b,I.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this._precisionModel=M,this._coordinateSequenceFactory=q,this._SRID=F}}},{key:"toMultiPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toGeometryArray",value:function(c){if(c===null)return null;var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return aa.instance()}},{key:"toMultiLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toMultiPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLinearRingArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"createPointFromInternalCoord",value:function(c,d){return d.getPrecisionModel().makePrecise(c),d.getFactory().createPoint(c)}}]),I}(),Ri="XY",la="XYZ",_s="XYM",Fi="XYZM",ua={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Qr="EMPTY",zo=1,Qi=2,io=3,ca=4,es=5,ro=6;for(var ei in ua)ua[ei].toUpperCase();var Sl=function(){function I(c){i(this,I),this.wkt=c,this.index_=-1}return a(I,[{key:"isAlpha_",value:function(c){return c>="a"&&c<="z"||c>="A"&&c<="Z"}},{key:"isNumeric_",value:function(c,d){return c>="0"&&c<="9"||c=="."&&!(d!==void 0&&d)}},{key:"isWhiteSpace_",value:function(c){return c==" "||c=="	"||c=="\r"||c==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var c,d=this.nextChar_(),p=this.index_,b=d;if(d=="(")c=Qi;else if(d==",")c=es;else if(d==")")c=io;else if(this.isNumeric_(d)||d=="-")c=ca,b=this.readNumber_();else if(this.isAlpha_(d))c=zo,b=this.readText_();else{if(this.isWhiteSpace_(d))return this.nextToken();if(d!=="")throw new Error("Unexpected character: "+d);c=ro}return{position:p,value:b,type:c}}},{key:"readNumber_",value:function(){var c,d=this.index_,p=!1,b=!1;do c=="."?p=!0:c!="e"&&c!="E"||(b=!0),c=this.nextChar_();while(this.isNumeric_(c,p)||!b&&(c=="e"||c=="E")||b&&(c=="-"||c=="+"));return parseFloat(this.wkt.substring(d,this.index_--))}},{key:"readText_",value:function(){var c,d=this.index_;do c=this.nextChar_();while(this.isAlpha_(c));return this.wkt.substring(d,this.index_--).toUpperCase()}}]),I}(),El=function(){function I(c,d){i(this,I),this.lexer_=c,this.token_,this.layout_=Ri,this.factory=d}return a(I,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(c){return this.token_.type==c}},{key:"match",value:function(c){var d=this.isTokenType(c);return d&&this.consume_(),d}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var c=Ri,d=this.token_;if(this.isTokenType(zo)){var p=d.value;p==="Z"?c=la:p==="M"?c=_s:p==="ZM"&&(c=Fi),c!==Ri&&this.consume_()}return c}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Qi)){var c=[];do c.push(this.parseGeometry_());while(this.match(es));if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Qi)){var c=this.parsePoint_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Qi)){var c=this.parsePointList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var c;if(this.match(Qi)){if(c=this.token_.type==Qi?this.parsePointTextList_():this.parsePointList_(),this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Qi)){var c=this.parsePolygonTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var c=[],d=this.layout_.length,p=0;p<d;++p){var b=this.token_;if(!this.match(ca))break;c.push(b.value)}if(c.length==d)return c;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var c=[this.parsePoint_()];this.match(es);)c.push(this.parsePoint_());return c}},{key:"parsePointTextList_",value:function(){for(var c=[this.parsePointText_()];this.match(es);)c.push(this.parsePointText_());return c}},{key:"parseLineStringTextList_",value:function(){for(var c=[this.parseLineStringText_()];this.match(es);)c.push(this.parseLineStringText_());return c}},{key:"parsePolygonTextList_",value:function(){for(var c=[this.parsePolygonText_()];this.match(es);)c.push(this.parsePolygonText_());return c}},{key:"isEmptyGeometry_",value:function(){var c=this.isTokenType(zo)&&this.token_.value==Qr;return c&&this.consume_(),c}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var c=this.factory,d=function(bn){return E(Xe,te(bn))},p=function(bn){var Pn=bn.map(function(ti){return c.createLinearRing(ti.map(d))});return Pn.length>1?c.createPolygon(Pn[0],Pn.slice(1)):c.createPolygon(Pn[0])},b=this.token_;if(this.match(zo)){var M=b.value;if(this.layout_=this.parseGeometryLayout_(),M=="GEOMETRYCOLLECTION"){var F=this.parseGeometryCollectionText_();return c.createGeometryCollection(F)}switch(M){case"POINT":var q=this.parsePointText_();return q?c.createPoint(E(Xe,te(q))):c.createPoint();case"LINESTRING":var Y=this.parseLineStringText_().map(d);return c.createLineString(Y);case"LINEARRING":var me=this.parseLineStringText_().map(d);return c.createLinearRing(me);case"POLYGON":var Ue=this.parsePolygonText_();return Ue&&Ue.length!==0?p(Ue):c.createPolygon();case"MULTIPOINT":var $e=this.parseMultiPointText_();if(!$e||$e.length===0)return c.createMultiPoint();var mt=$e.map(d).map(function(bn){return c.createPoint(bn)});return c.createMultiPoint(mt);case"MULTILINESTRING":var zt=this.parseMultiLineStringText_().map(function(bn){return c.createLineString(bn.map(d))});return c.createMultiLineString(zt);case"MULTIPOLYGON":var Nt=this.parseMultiPolygonText_();if(!Nt||Nt.length===0)return c.createMultiPolygon();var gn=Nt.map(p);return c.createMultiPolygon(gn);default:throw new Error("Invalid geometry type: "+M)}}throw new Error(this.formatErrorMessage_())}}]),I}();function xo(I){if(I.isEmpty())return"";var c=I.getCoordinate(),d=[c.x,c.y];return c.z===void 0||Number.isNaN(c.z)||d.push(c.z),c.m===void 0||Number.isNaN(c.m)||d.push(c.m),d.join(" ")}function wo(I){for(var c=I.getCoordinates().map(function(M){var F=[M.x,M.y];return M.z===void 0||Number.isNaN(M.z)||F.push(M.z),M.m===void 0||Number.isNaN(M.m)||F.push(M.m),F}),d=[],p=0,b=c.length;p<b;++p)d.push(c[p].join(" "));return d.join(", ")}function ha(I){var c=[];c.push("("+wo(I.getExteriorRing())+")");for(var d=0,p=I.getNumInteriorRing();d<p;++d)c.push("("+wo(I.getInteriorRingN(d))+")");return c.join(", ")}var fa={Point:xo,LineString:wo,LinearRing:wo,Polygon:ha,MultiPoint:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+xo(I.getGeometryN(d))+")");return c.join(", ")},MultiLineString:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+wo(I.getGeometryN(d))+")");return c.join(", ")},MultiPolygon:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+ha(I.getGeometryN(d))+")");return c.join(", ")},GeometryCollection:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push(da(I.getGeometryN(d)));return c.join(", ")}};function da(I){var c=I.getGeometryType(),d=fa[c];c=c.toUpperCase();var p=function(b){var M="";if(b.isEmpty())return M;var F=b.getCoordinate();return F.z===void 0||Number.isNaN(F.z)||(M+="Z"),F.m===void 0||Number.isNaN(F.m)||(M+="M"),M}(I);return p.length>0&&(c+=" "+p),I.isEmpty()?c+" "+Qr:c+" ("+d(I)+")"}var Oo=function(){function I(c){i(this,I),this.geometryFactory=c||new Kr,this.precisionModel=this.geometryFactory.getPrecisionModel()}return a(I,[{key:"read",value:function(c){var d=new Sl(c);return new El(d,this.geometryFactory).parse()}},{key:"write",value:function(c){return da(c)}}]),I}(),za=function(){function I(c){i(this,I),this.parser=new Oo(c)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}],[{key:"toLineString",value:function(c,d){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+c.x+" "+c.y+", "+d.x+" "+d.y+" )"}}]),I}(),ki=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getIndexAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intLineIndex[c][d]}},{key:"getTopologySummary",value:function(){var c=new Qn;return this.isEndPoint()&&c.append(" endpoint"),this._isProper&&c.append(" proper"),this.isCollinear()&&c.append(" collinear"),c.toString()}},{key:"computeIntersection",value:function(c,d,p,b){this._inputLines[0][0]=c,this._inputLines[0][1]=d,this._inputLines[1][0]=p,this._inputLines[1][1]=b,this._result=this.computeIntersect(c,d,p,b)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var c=arguments[0],d=this.getEdgeDistance(c,0),p=this.getEdgeDistance(c,1);d>p?(this._intLineIndex[c][0]=0,this._intLineIndex[c][1]=1):(this._intLineIndex[c][0]=1,this._intLineIndex[c][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var c=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[c][0])&&!this._intPt[d].equals2D(this._inputLines[c][1]))return!0;return!1}}},{key:"getIntersection",value:function(c){return this._intPt[c]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==I.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(c,d){return I.computeEdgeDistance(this._intPt[d],this._inputLines[c][0],this._inputLines[c][1])}},{key:"isCollinear",value:function(){return this._result===I.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return za.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+za.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(c,d){return this._inputLines[c][d]}},{key:"isIntersection",value:function(c){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(c))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[c][d]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Xe,this._intPt[1]=new Xe,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(c,d,p){var b=Math.abs(p.x-d.x),M=Math.abs(p.y-d.y),F=-1;if(c.equals(d))F=0;else if(c.equals(p))F=b>M?b:M;else{var q=Math.abs(c.x-d.x),Y=Math.abs(c.y-d.y);(F=b>M?q:Y)!==0||c.equals(d)||(F=Math.max(q,Y))}return It.isTrue(!(F===0&&!c.equals(d)),"Bad distance calculation"),F}},{key:"nonRobustComputeEdgeDistance",value:function(c,d,p){var b=c.x-d.x,M=c.y-d.y,F=Math.sqrt(b*b+M*M);return It.isTrue(!(F===0&&!c.equals(d)),"Invalid distance calculation"),F}}]),I}();ki.DONT_INTERSECT=0,ki.DO_INTERSECT=1,ki.COLLINEAR=2,ki.NO_INTERSECTION=0,ki.POINT_INTERSECTION=1,ki.COLLINEAR_INTERSECTION=2;var so=function(I){f(d,I);var c=B(d);function d(){return i(this,d),c.call(this)}return a(d,[{key:"isInSegmentEnvelopes",value:function(p){var b=new dn(this._inputLines[0][0],this._inputLines[0][1]),M=new dn(this._inputLines[1][0],this._inputLines[1][1]);return b.contains(p)&&M.contains(p)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return U(g(d.prototype),"computeIntersection",this).apply(this,arguments);var p=arguments[0],b=arguments[1],M=arguments[2];if(this._isProper=!1,dn.intersects(b,M,p)&&mn.index(b,M,p)===0&&mn.index(M,b,p)===0)return this._isProper=!0,(p.equals(b)||p.equals(M))&&(this._isProper=!1),this._result=ki.POINT_INTERSECTION,null;this._result=ki.NO_INTERSECTION}},{key:"intersection",value:function(p,b,M,F){var q=this.intersectionSafe(p,b,M,F);return this.isInSegmentEnvelopes(q)||(q=new Xe(d.nearestEndpoint(p,b,M,F))),this._precisionModel!==null&&this._precisionModel.makePrecise(q),q}},{key:"checkDD",value:function(p,b,M,F,q){var Y=gr.intersection(p,b,M,F),me=this.isInSegmentEnvelopes(Y);Mi.out.println("DD in env = "+me+"  --------------------- "+Y),q.distance(Y)>1e-4&&Mi.out.println("Distance = "+q.distance(Y))}},{key:"intersectionSafe",value:function(p,b,M,F){var q=wn.intersection(p,b,M,F);return q===null&&(q=d.nearestEndpoint(p,b,M,F)),q}},{key:"computeCollinearIntersection",value:function(p,b,M,F){var q=dn.intersects(p,b,M),Y=dn.intersects(p,b,F),me=dn.intersects(M,F,p),Ue=dn.intersects(M,F,b);return q&&Y?(this._intPt[0]=M,this._intPt[1]=F,ki.COLLINEAR_INTERSECTION):me&&Ue?(this._intPt[0]=p,this._intPt[1]=b,ki.COLLINEAR_INTERSECTION):q&&me?(this._intPt[0]=M,this._intPt[1]=p,!M.equals(p)||Y||Ue?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):q&&Ue?(this._intPt[0]=M,this._intPt[1]=b,!M.equals(b)||Y||me?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):Y&&me?(this._intPt[0]=F,this._intPt[1]=p,!F.equals(p)||q||Ue?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):Y&&Ue?(this._intPt[0]=F,this._intPt[1]=b,!F.equals(b)||q||me?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):ki.NO_INTERSECTION}},{key:"computeIntersect",value:function(p,b,M,F){if(this._isProper=!1,!dn.intersects(p,b,M,F))return ki.NO_INTERSECTION;var q=mn.index(p,b,M),Y=mn.index(p,b,F);if(q>0&&Y>0||q<0&&Y<0)return ki.NO_INTERSECTION;var me=mn.index(M,F,p),Ue=mn.index(M,F,b);return me>0&&Ue>0||me<0&&Ue<0?ki.NO_INTERSECTION:q===0&&Y===0&&me===0&&Ue===0?this.computeCollinearIntersection(p,b,M,F):(q===0||Y===0||me===0||Ue===0?(this._isProper=!1,p.equals2D(M)||p.equals2D(F)?this._intPt[0]=p:b.equals2D(M)||b.equals2D(F)?this._intPt[0]=b:q===0?this._intPt[0]=new Xe(M):Y===0?this._intPt[0]=new Xe(F):me===0?this._intPt[0]=new Xe(p):Ue===0&&(this._intPt[0]=new Xe(b))):(this._isProper=!0,this._intPt[0]=this.intersection(p,b,M,F)),ki.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(p,b,M,F){var q=p,Y=Ki.pointToSegment(p,M,F),me=Ki.pointToSegment(b,M,F);return me<Y&&(Y=me,q=b),(me=Ki.pointToSegment(M,p,b))<Y&&(Y=me,q=M),(me=Ki.pointToSegment(F,p,b))<Y&&(Y=me,q=F),q}}]),d}(ki),vc=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"countSegment",value:function(c,d){if(c.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(c.y===this._p.y&&d.y===this._p.y){var p=c.x,b=d.x;return p>b&&(p=d.x,b=c.x),this._p.x>=p&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(c.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&c.y<=this._p.y){var M=mn.index(c,d,this._p);if(M===mn.COLLINEAR)return this._isPointOnSegment=!0,null;d.y<c.y&&(M=-M),M===mn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Se.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Se.BOUNDARY:this._crossingCount%2==1?Se.INTERIOR:Se.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var c=arguments[0];this._p=c}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Xe&&xn(arguments[1],kn)){for(var c=arguments[0],d=arguments[1],p=new I(c),b=new Xe,M=new Xe,F=1;F<d.size();F++)if(d.getCoordinate(F,b),d.getCoordinate(F-1,M),p.countSegment(b,M),p.isOnSegment())return p.getLocation();return p.getLocation()}if(arguments[0]instanceof Xe&&arguments[1]instanceof Array){for(var q=arguments[0],Y=arguments[1],me=new I(q),Ue=1;Ue<Y.length;Ue++){var $e=Y[Ue],mt=Y[Ue-1];if(me.countSegment($e,mt),me.isOnSegment())return me.getLocation()}return me.getLocation()}}}]),I}(),Vs=function(){function I(){i(this,I)}return a(I,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Xe&&xn(arguments[1],kn)){for(var c=arguments[0],d=arguments[1],p=new so,b=new Xe,M=new Xe,F=d.size(),q=1;q<F;q++)if(d.getCoordinate(q-1,b),d.getCoordinate(q,M),p.computeIntersection(c,b,M),p.hasIntersection())return!0;return!1}if(arguments[0]instanceof Xe&&arguments[1]instanceof Array){for(var Y=arguments[0],me=arguments[1],Ue=new so,$e=1;$e<me.length;$e++){var mt=me[$e-1],zt=me[$e];if(Ue.computeIntersection(Y,mt,zt),Ue.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(c,d){return vc.locatePointInRing(c,d)}},{key:"isInRing",value:function(c,d){return I.locateInRing(c,d)!==Se.EXTERIOR}}]),I}(),yr=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setAllLocations",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]=c}},{key:"isNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]!==Se.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]===Se.NONE&&(this.location[d]=c)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(c){if(c.location.length>this.location.length){var d=new Array(3).fill(null);d[Ee.ON]=this.location[Ee.ON],d[Ee.LEFT]=Se.NONE,d[Ee.RIGHT]=Se.NONE,this.location=d}for(var p=0;p<this.location.length;p++)this.location[p]===Se.NONE&&p<c.location.length&&(this.location[p]=c.location[p])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var c=this.location[Ee.LEFT];this.location[Ee.LEFT]=this.location[Ee.RIGHT],this.location[Ee.RIGHT]=c}},{key:"toString",value:function(){var c=new qi;return this.location.length>1&&c.append(Se.toLocationSymbol(this.location[Ee.LEFT])),c.append(Se.toLocationSymbol(this.location[Ee.ON])),this.location.length>1&&c.append(Se.toLocationSymbol(this.location[Ee.RIGHT])),c.toString()}},{key:"setLocations",value:function(c,d,p){this.location[Ee.ON]=c,this.location[Ee.LEFT]=d,this.location[Ee.RIGHT]=p}},{key:"get",value:function(c){return c<this.location.length?this.location[c]:Se.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]===Se.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var c=arguments[0];this.setLocation(Ee.ON,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.location[d]=p}}},{key:"init",value:function(c){this.location=new Array(c).fill(null),this.setAllLocations(Se.NONE)}},{key:"isEqualOnSide",value:function(c,d){return this.location[d]===c.location[d]}},{key:"allPositionsEqual",value:function(c){for(var d=0;d<this.location.length;d++)if(this.location[d]!==c)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];this.init(c.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[Ee.ON]=d}else if(arguments[0]instanceof I){var p=arguments[0];if(this.init(p.location.length),p!==null)for(var b=0;b<this.location.length;b++)this.location[b]=p.location[b]}}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this.init(3),this.location[Ee.ON]=M,this.location[Ee.LEFT]=F,this.location[Ee.RIGHT]=q}}}]),I}(),bi=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getGeometryCount",value:function(){var c=0;return this.elt[0].isNull()||c++,this.elt[1].isNull()||c++,c}},{key:"setAllLocations",value:function(c,d){this.elt[c].setAllLocations(d)}},{key:"isNull",value:function(c){return this.elt[c].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var c=arguments[0];this.setAllLocationsIfNull(0,c),this.setAllLocationsIfNull(1,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.elt[d].setAllLocationsIfNull(p)}}},{key:"isLine",value:function(c){return this.elt[c].isLine()}},{key:"merge",value:function(c){for(var d=0;d<2;d++)this.elt[d]===null&&c.elt[d]!==null?this.elt[d]=new yr(c.elt[d]):this.elt[d].merge(c.elt[d])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var c=arguments[0];return this.elt[c].get(Ee.ON)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return this.elt[d].get(p)}}},{key:"toString",value:function(){var c=new qi;return this.elt[0]!==null&&(c.append("A:"),c.append(this.elt[0].toString())),this.elt[1]!==null&&(c.append(" B:"),c.append(this.elt[1].toString())),c.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var c=arguments[0];return this.elt[c].isArea()}}},{key:"isAnyNull",value:function(c){return this.elt[c].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.elt[c].setLocation(Ee.ON,d)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2];this.elt[p].setLocation(b,M)}}},{key:"isEqualOnSide",value:function(c,d){return this.elt[0].isEqualOnSide(c.elt[0],d)&&this.elt[1].isEqualOnSide(c.elt[1],d)}},{key:"allPositionsEqual",value:function(c,d){return this.elt[c].allPositionsEqual(d)}},{key:"toLine",value:function(c){this.elt[c].isArea()&&(this.elt[c]=new yr(this.elt[c].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var c=arguments[0];this.elt[0]=new yr(c),this.elt[1]=new yr(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.elt[0]=new yr(d.elt[0]),this.elt[1]=new yr(d.elt[1])}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.elt[0]=new yr(Se.NONE),this.elt[1]=new yr(Se.NONE),this.elt[p].setLocation(b)}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this.elt[0]=new yr(M,F,q),this.elt[1]=new yr(M,F,q)}else if(arguments.length===4){var Y=arguments[0],me=arguments[1],Ue=arguments[2],$e=arguments[3];this.elt[0]=new yr(Se.NONE,Se.NONE,Se.NONE),this.elt[1]=new yr(Se.NONE,Se.NONE,Se.NONE),this.elt[Y].setLocations(me,Ue,$e)}}},{key:"toLineLabel",value:function(c){for(var d=new I(Se.NONE),p=0;p<2;p++)d.setLocation(p,c.getLocation(p));return d}}]),I}(),cr=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var c=new Array(this._pts.size()).fill(null),d=0;d<this._pts.size();d++)c[d]=this._pts.get(d);this._ring=this._geometryFactory.createLinearRing(c),this._isHole=mn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(c){this._startDe=c;var d=c,p=!0;do{if(d===null)throw new At("Found null DirectedEdge");if(d.getEdgeRing()===this)throw new At("Directed Edge visited twice during ring-building at "+d.getCoordinate());this._edges.add(d);var b=d.getLabel();It.isTrue(b.isArea()),this.mergeLabel(b),this.addPoints(d.getEdge(),d.isForward(),p),p=!1,this.setEdgeRing(d,this),d=this.getNext(d)}while(d!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(c){return this._pts.get(c)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var c=this._startDe;do{var d=c.getNode().getEdges().getOutgoingDegree(this);d>this._maxNodeDegree&&(this._maxNodeDegree=d),c=this.getNext(c)}while(c!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(c,d,p){var b=c.getCoordinates();if(d){var M=1;p&&(M=0);for(var F=M;F<b.length;F++)this._pts.add(b[F])}else{var q=b.length-2;p&&(q=b.length-1);for(var Y=q;Y>=0;Y--)this._pts.add(b[Y])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var c=this._startDe;do c.getEdge().setInResult(!0),c=c.getNext();while(c!==this._startDe)}},{key:"containsPoint",value:function(c){var d=this.getLinearRing();if(!d.getEnvelopeInternal().contains(c)||!Vs.isInRing(c,d.getCoordinates()))return!1;for(var p=this._holes.iterator();p.hasNext();)if(p.next().containsPoint(c))return!1;return!0}},{key:"addHole",value:function(c){this._holes.add(c)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var c=arguments[0];this.mergeLabel(c,0),this.mergeLabel(c,1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1],b=d.getLocation(p,Ee.RIGHT);if(b===Se.NONE)return null;if(this._label.getLocation(p)===Se.NONE)return this._label.setLocation(p,b),null}}},{key:"setShell",value:function(c){this._shell=c,c!==null&&c.addHole(this)}},{key:"toPolygon",value:function(c){for(var d=new Array(this._holes.size()).fill(null),p=0;p<this._holes.size();p++)d[p]=this._holes.get(p).getLinearRing();return c.createPolygon(this.getLinearRing(),d)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new Tt,this._pts=new Tt,this._label=new bi(Se.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Tt,this._geometryFactory=null,arguments.length!==0&&arguments.length===2){var c=arguments[0],d=arguments[1];this._geometryFactory=d,this.computePoints(c),this.computeRing()}}}]),I}(),Oa=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"setEdgeRing",value:function(p,b){p.setMinEdgeRing(b)}},{key:"getNext",value:function(p){return p.getNextMin()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),Fa=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"buildMinimalRings",value:function(){var p=new Tt,b=this._startDe;do{if(b.getMinEdgeRing()===null){var M=new Oa(b,this._geometryFactory);p.add(M)}b=b.getNext()}while(b!==this._startDe);return p}},{key:"setEdgeRing",value:function(p,b){p.setEdgeRing(b)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var p=this._startDe;do p.getNode().getEdges().linkMinimalDirectedEdges(this),p=p.getNext();while(p!==this._startDe)}},{key:"getNext",value:function(p){return p.getNext()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),pa=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setVisited",value:function(c){this._isVisited=c}},{key:"setInResult",value:function(c){this._isInResult=c}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(c){this._label=c}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(c){this._isCovered=c,this._isCoveredSet=!0}},{key:"updateIM",value:function(c){It.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(c)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._label=c}}}]),I}(),ma=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"isIncidentEdgeInResult",value:function(){for(var p=this.getEdges().getEdges().iterator();p.hasNext();)if(p.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(p){p.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(p){}},{key:"computeMergedLocation",value:function(p,b){var M=Se.NONE;if(M=this._label.getLocation(b),!p.isNull(b)){var F=p.getLocation(b);M!==Se.BOUNDARY&&(M=F)}return M}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return U(g(d.prototype),"setLabel",this).apply(this,arguments);var p=arguments[0],b=arguments[1];this._label===null?this._label=new bi(p,b):this._label.setLocation(p,b)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof d){var p=arguments[0];this.mergeLabel(p._label)}else if(arguments[0]instanceof bi)for(var b=arguments[0],M=0;M<2;M++){var F=this.computeMergedLocation(b,M),q=this._label.getLocation(M);q===Se.NONE&&this._label.setLocation(M,F)}}},{key:"add",value:function(p){this._edges.insert(p),p.setNode(this)}},{key:"setLabelBoundary",value:function(p){if(this._label===null)return null;var b=Se.NONE;this._label!==null&&(b=this._label.getLocation(p));var M=null;switch(b){case Se.BOUNDARY:M=Se.INTERIOR;break;case Se.INTERIOR:default:M=Se.BOUNDARY}this._label.setLocation(p,M)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var p=arguments[0],b=arguments[1];this._coord=p,this._edges=b,this._label=new bi(0,Se.NONE)}}]),d}(pa),Fo=function(I){f(d,I);var c=B(d);function d(){return i(this,d),c.apply(this,arguments)}return d}(Dr);function su(I){return I==null?0:I.color}function ii(I){return I==null?null:I.parent}function ys(I,c){I!==null&&(I.color=c)}function Tl(I){return I==null?null:I.left}function ou(I){return I==null?null:I.right}var Bo=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),(p=c.call(this)).root_=null,p.size_=0,p}return a(d,[{key:"get",value:function(p){for(var b=this.root_;b!==null;){var M=p.compareTo(b.key);if(M<0)b=b.left;else{if(!(M>0))return b.value;b=b.right}}return null}},{key:"put",value:function(p,b){if(this.root_===null)return this.root_={key:p,value:b,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var M,F,q=this.root_;do if(M=q,(F=p.compareTo(q.key))<0)q=q.left;else{if(!(F>0)){var Y=q.value;return q.value=b,Y}q=q.right}while(q!==null);var me={key:p,left:null,right:null,value:b,parent:M,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return F<0?M.left=me:M.right=me,this.fixAfterInsertion(me),this.size_++,null}},{key:"fixAfterInsertion",value:function(p){var b;for(p.color=1;p!=null&&p!==this.root_&&p.parent.color===1;)ii(p)===Tl(ii(ii(p)))?su(b=ou(ii(ii(p))))===1?(ys(ii(p),0),ys(b,0),ys(ii(ii(p)),1),p=ii(ii(p))):(p===ou(ii(p))&&(p=ii(p),this.rotateLeft(p)),ys(ii(p),0),ys(ii(ii(p)),1),this.rotateRight(ii(ii(p)))):su(b=Tl(ii(ii(p))))===1?(ys(ii(p),0),ys(b,0),ys(ii(ii(p)),1),p=ii(ii(p))):(p===Tl(ii(p))&&(p=ii(p),this.rotateRight(p)),ys(ii(p),0),ys(ii(ii(p)),1),this.rotateLeft(ii(ii(p))));this.root_.color=0}},{key:"values",value:function(){var p=new Tt,b=this.getFirstEntry();if(b!==null)for(p.add(b.value);(b=d.successor(b))!==null;)p.add(b.value);return p}},{key:"entrySet",value:function(){var p=new kt,b=this.getFirstEntry();if(b!==null)for(p.add(b);(b=d.successor(b))!==null;)p.add(b);return p}},{key:"rotateLeft",value:function(p){if(p!=null){var b=p.right;p.right=b.left,b.left!=null&&(b.left.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.left===p?p.parent.left=b:p.parent.right=b,b.left=p,p.parent=b}}},{key:"rotateRight",value:function(p){if(p!=null){var b=p.left;p.left=b.right,b.right!=null&&(b.right.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.right===p?p.parent.right=b:p.parent.left=b,b.right=p,p.parent=b}}},{key:"getFirstEntry",value:function(){var p=this.root_;if(p!=null)for(;p.left!=null;)p=p.left;return p}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(p){for(var b=this.root_;b!==null;){var M=p.compareTo(b.key);if(M<0)b=b.left;else{if(!(M>0))return!0;b=b.right}}return!1}}],[{key:"successor",value:function(p){var b;if(p===null)return null;if(p.right!==null){for(b=p.right;b.left!==null;)b=b.left;return b}b=p.parent;for(var M=p;b!==null&&M===b.right;)M=b,b=b.parent;return b}}]),d}(Fo),Uo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"find",value:function(c){return this.nodeMap.get(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof Xe){var c=arguments[0],d=this.nodeMap.get(c);return d===null&&(d=this.nodeFact.createNode(c),this.nodeMap.put(c,d)),d}if(arguments[0]instanceof ma){var p=arguments[0],b=this.nodeMap.get(p.getCoordinate());return b===null?(this.nodeMap.put(p.getCoordinate(),p),p):(b.mergeLabel(p),b)}}},{key:"print",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(c){for(var d=new Tt,p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().getLocation(c)===Se.BOUNDARY&&d.add(b)}return d}},{key:"add",value:function(c){var d=c.getCoordinate();this.addNode(d).add(c)}}],[{key:"constructor_",value:function(){this.nodeMap=new Bo,this.nodeFact=null;var c=arguments[0];this.nodeFact=c}}]),I}(),hr=function(){function I(){i(this,I)}return a(I,null,[{key:"isNorthern",value:function(c){return c===I.NE||c===I.NW}},{key:"isOpposite",value:function(c,d){return c!==d&&(c-d+4)%4===2}},{key:"commonHalfPlane",value:function(c,d){if(c===d)return c;if((c-d+4)%4===2)return-1;var p=c<d?c:d;return p===0&&(c>d?c:d)===3?3:p}},{key:"isInHalfPlane",value:function(c,d){return d===I.SE?c===I.SE||c===I.SW:c===d||c===d+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the quadrant for point ( "+c+", "+d+" )");return c>=0?d>=0?I.NE:I.SE:d>=0?I.NW:I.SW}if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var p=arguments[0],b=arguments[1];if(b.x===p.x&&b.y===p.y)throw new ve("Cannot compute the quadrant for two identical points "+p);return b.x>=p.x?b.y>=p.y?I.NE:I.SE:b.y>=p.y?I.NW:I.SW}}}]),I}();hr.NE=0,hr.NW=1,hr.SW=2,hr.SE=3;var ga=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareDirection",value:function(c){return this._dx===c._dx&&this._dy===c._dy?0:this._quadrant>c._quadrant?1:this._quadrant<c._quadrant?-1:mn.index(c._p0,c._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(c){this._node=c}},{key:"print",value:function(c){var d=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),b=p.lastIndexOf("."),M=p.substring(b+1);c.print("  "+M+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)}},{key:"compareTo",value:function(c){var d=c;return this.compareDirection(d)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var c=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),p=d.lastIndexOf(".");return"  "+d.substring(p+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+c+"   "+this._label}},{key:"computeLabel",value:function(c){}},{key:"init",value:function(c,d){this._p0=c,this._p1=d,this._dx=d.x-c.x,this._dy=d.y-c.y,this._quadrant=hr.quadrant(this._dx,this._dy),It.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var c=arguments[0];this._edge=c}else if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2];I.constructor_.call(this,d,p,b,null)}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];I.constructor_.call(this,M),this.init(F,q),this._label=Y}}}]),I}(),_a=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(p){return this._depth[p]}},{key:"setVisited",value:function(p){this._isVisited=p}},{key:"computeDirectedLabel",value:function(){this._label=new bi(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(p,b){if(this._depth[p]!==-999&&this._depth[p]!==b)throw new At("assigned depths do not match",this.getCoordinate());this._depth[p]=b}},{key:"isInteriorAreaEdge",value:function(){for(var p=!0,b=0;b<2;b++)this._label.isArea(b)&&this._label.getLocation(b,Ee.LEFT)===Se.INTERIOR&&this._label.getLocation(b,Ee.RIGHT)===Se.INTERIOR||(p=!1);return p}},{key:"setNextMin",value:function(p){this._nextMin=p}},{key:"print",value:function(p){U(g(d.prototype),"print",this).call(this,p),p.print(" "+this._depth[Ee.LEFT]+"/"+this._depth[Ee.RIGHT]),p.print(" ("+this.getDepthDelta()+")"),this._isInResult&&p.print(" inResult")}},{key:"setMinEdgeRing",value:function(p){this._minEdgeRing=p}},{key:"isLineEdge",value:function(){var p=this._label.isLine(0)||this._label.isLine(1),b=!this._label.isArea(0)||this._label.allPositionsEqual(0,Se.EXTERIOR),M=!this._label.isArea(1)||this._label.allPositionsEqual(1,Se.EXTERIOR);return p&&b&&M}},{key:"setEdgeRing",value:function(p){this._edgeRing=p}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var p=this._edge.getDepthDelta();return this._isForward||(p=-p),p}},{key:"setInResult",value:function(p){this._isInResult=p}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(p){this.print(p),p.print(" "),this._isForward?this._edge.print(p):this._edge.printReverse(p)}},{key:"setSym",value:function(p){this._sym=p}},{key:"setVisitedEdge",value:function(p){this.setVisited(p),this._sym.setVisited(p)}},{key:"setEdgeDepths",value:function(p,b){var M=this.getEdge().getDepthDelta();this._isForward||(M=-M);var F=1;p===Ee.LEFT&&(F=-1);var q=Ee.opposite(p),Y=b+M*F;this.setDepth(p,b),this.setDepth(q,Y)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(p){this._next=p}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var p=arguments[0],b=arguments[1];if(ga.constructor_.call(this,p),this._isForward=b,b)this.init(p.getCoordinate(0),p.getCoordinate(1));else{var M=p.getNumPoints()-1;this.init(p.getCoordinate(M),p.getCoordinate(M-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(p,b){return p===Se.EXTERIOR&&b===Se.INTERIOR?1:p===Se.INTERIOR&&b===Se.EXTERIOR?-1:0}}]),d}(ga),Ba=function(){function I(){i(this,I)}return a(I,[{key:"createNode",value:function(c){return new ma(c,null)}}]),I}(),vs=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"printEdges",value:function(c){c.println("Edges:");for(var d=0;d<this._edges.size();d++){c.println("edge "+d+":");var p=this._edges.get(d);p.print(c),p.eiList.print(c)}}},{key:"find",value:function(c){return this._nodes.find(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof ma){var c=arguments[0];return this._nodes.addNode(c)}if(arguments[0]instanceof Xe){var d=arguments[0];return this._nodes.addNode(d)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(c){Mi.out.println(c)}},{key:"isBoundaryNode",value:function(c,d){var p=this._nodes.find(d);if(p===null)return!1;var b=p.getLabel();return b!==null&&b.getLocation(c)===Se.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(c,d,p,b){return!!c.equals(p)&&mn.index(c,d,b)===mn.COLLINEAR&&hr.quadrant(c,d)===hr.quadrant(p,b)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(c){Mi.out.print(c)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),M=b.getCoordinates();if(this.matchInSameDirection(c,d,M[0],M[1])||this.matchInSameDirection(c,d,M[M.length-1],M[M.length-2]))return b}return null}},{key:"insertEdge",value:function(c){this._edges.add(c)}},{key:"findEdgeEnd",value:function(c){for(var d=this.getEdgeEnds().iterator();d.hasNext();){var p=d.next();if(p.getEdge()===c)return p}return null}},{key:"addEdges",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();this._edges.add(p);var b=new _a(p,!0),M=new _a(p,!1);b.setSym(M),M.setSym(b),this.add(b),this.add(M)}}},{key:"add",value:function(c){this._nodes.add(c),this._edgeEndList.add(c)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),M=b.getCoordinates();if(c.equals(M[0])&&d.equals(M[1]))return b}return null}}],[{key:"constructor_",value:function(){if(this._edges=new Tt,this._nodes=null,this._edgeEndList=new Tt,arguments.length===0)this._nodes=new Uo(new Ba);else if(arguments.length===1){var c=arguments[0];this._nodes=new Uo(c)}}},{key:"linkResultDirectedEdges",value:function(c){for(var d=c.iterator();d.hasNext();)d.next().getEdges().linkResultDirectedEdges()}}]),I}(),bc=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"sortShellsAndHoles",value:function(c,d,p){for(var b=c.iterator();b.hasNext();){var M=b.next();M.isHole()?p.add(M):d.add(M)}}},{key:"computePolygons",value:function(c){for(var d=new Tt,p=c.iterator();p.hasNext();){var b=p.next().toPolygon(this._geometryFactory);d.add(b)}return d}},{key:"placeFreeHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();if(b.getShell()===null){var M=I.findEdgeRingContaining(b,c);if(M===null)throw new At("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(M)}}}},{key:"buildMinimalEdgeRings",value:function(c,d,p){for(var b=new Tt,M=c.iterator();M.hasNext();){var F=M.next();if(F.getMaxNodeDegree()>2){F.linkDirectedEdgesForMinimalEdgeRings();var q=F.buildMinimalRings(),Y=this.findShell(q);Y!==null?(this.placePolygonHoles(Y,q),d.add(Y)):p.addAll(q)}else b.add(F)}return b}},{key:"buildMaximalEdgeRings",value:function(c){for(var d=new Tt,p=c.iterator();p.hasNext();){var b=p.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var M=new Fa(b,this._geometryFactory);d.add(M),M.setInResult()}}return d}},{key:"placePolygonHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();b.isHole()&&b.setShell(c)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(c){for(var d=0,p=null,b=c.iterator();b.hasNext();){var M=b.next();M.isHole()||(p=M,d++)}return It.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),p}},{key:"add",value:function(){if(arguments.length===1){var c=arguments[0];this.add(c.getEdgeEnds(),c.getNodes())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];vs.linkResultDirectedEdges(p);var b=this.buildMaximalEdgeRings(d),M=new Tt,F=this.buildMinimalEdgeRings(b,this._shellList,M);this.sortShellsAndHoles(F,this._shellList,M),this.placeFreeHoles(this._shellList,M)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new Tt;var c=arguments[0];this._geometryFactory=c}},{key:"findEdgeRingContaining",value:function(c,d){for(var p=c.getLinearRing(),b=p.getEnvelopeInternal(),M=p.getCoordinateN(0),F=null,q=null,Y=d.iterator();Y.hasNext();){var me=Y.next(),Ue=me.getLinearRing(),$e=Ue.getEnvelopeInternal();if(!$e.equals(b)&&$e.contains(b)){M=Xn.ptNotInList(p.getCoordinates(),Ue.getCoordinates());var mt=!1;Vs.isInRing(M,Ue.getCoordinates())&&(mt=!0),mt&&(F===null||q.contains($e))&&(q=(F=me).getLinearRing().getEnvelopeInternal())}}return F}}]),I}(),Ua=function(){function I(){i(this,I)}return a(I,[{key:"getBounds",value:function(){}}]),I}(),Lr=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var c=arguments[0],d=arguments[1];this._bounds=c,this._item=d}}]),I}(),bs=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"poll",value:function(){if(this.isEmpty())return null;var c=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),c}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(c){for(var d=null,p=this._items.get(c);2*c<=this._size&&((d=2*c)!==this._size&&this._items.get(d+1).compareTo(this._items.get(d))<0&&d++,this._items.get(d).compareTo(p)<0);c=d)this._items.set(c,this._items.get(d));this._items.set(c,p)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(c){this._items.add(null),this._size+=1;var d=this._size;for(this._items.set(0,c);c.compareTo(this._items.get(Math.trunc(d/2)))<0;d/=2)this._items.set(d,this._items.get(Math.trunc(d/2)));this._items.set(d,c)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new Tt,this._items.add(null)}}]),I}(),ri=function(){function I(){i(this,I)}return a(I,[{key:"insert",value:function(c,d){}},{key:"remove",value:function(c,d){}},{key:"query",value:function(){}}]),I}(),Mr=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(c){It.isTrue(this._bounds===null),this._childBoundables.add(c)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new Tt,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._level=c}}}]),I}(),jo={reverseOrder:function(){return{compare:function(I,c){return c.compareTo(I)}}},min:function(I){return jo.sort(I),I.get(0)},sort:function(I,c){var d=I.toArray();c?at.sort(d,c):at.sort(d);for(var p=I.iterator(),b=0,M=d.length;b<M;b++)p.next(),p.set(d[b])},singletonList:function(I){var c=new Tt;return c.add(I),c}},Vo=function(){function I(){i(this,I)}return a(I,null,[{key:"maxDistance",value:function(c,d,p,b,M,F,q,Y){var me=I.distance(c,d,M,F);return me=Math.max(me,I.distance(c,d,q,Y)),me=Math.max(me,I.distance(p,b,M,F)),me=Math.max(me,I.distance(p,b,q,Y))}},{key:"distance",value:function(c,d,p,b){var M=p-c,F=b-d;return Math.sqrt(M*M+F*F)}},{key:"maximumDistance",value:function(c,d){var p=Math.min(c.getMinX(),d.getMinX()),b=Math.min(c.getMinY(),d.getMinY()),M=Math.max(c.getMaxX(),d.getMaxX()),F=Math.max(c.getMaxY(),d.getMaxY());return I.distance(p,b,M,F)}},{key:"minMaxDistance",value:function(c,d){var p=c.getMinX(),b=c.getMinY(),M=c.getMaxX(),F=c.getMaxY(),q=d.getMinX(),Y=d.getMinY(),me=d.getMaxX(),Ue=d.getMaxY(),$e=I.maxDistance(p,b,p,F,q,Y,q,Ue);return $e=Math.min($e,I.maxDistance(p,b,p,F,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(p,b,p,F,me,Ue,q,Ue)),$e=Math.min($e,I.maxDistance(p,b,p,F,me,Ue,me,Y)),$e=Math.min($e,I.maxDistance(p,b,M,b,q,Y,q,Ue)),$e=Math.min($e,I.maxDistance(p,b,M,b,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(p,b,M,b,me,Ue,q,Ue)),$e=Math.min($e,I.maxDistance(p,b,M,b,me,Ue,me,Y)),$e=Math.min($e,I.maxDistance(M,F,p,F,q,Y,q,Ue)),$e=Math.min($e,I.maxDistance(M,F,p,F,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(M,F,p,F,me,Ue,q,Ue)),$e=Math.min($e,I.maxDistance(M,F,p,F,me,Ue,me,Y)),$e=Math.min($e,I.maxDistance(M,F,M,b,q,Y,q,Ue)),$e=Math.min($e,I.maxDistance(M,F,M,b,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(M,F,M,b,me,Ue,q,Ue)),$e=Math.min($e,I.maxDistance(M,F,M,b,me,Ue,me,Y))}}]),I}(),qo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"maximumDistance",value:function(){return Vo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(c,d){var p=I.isComposite(this._boundable1),b=I.isComposite(this._boundable2);if(p&&b)return I.area(this._boundable1)>I.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,c,d),null):(this.expand(this._boundable2,this._boundable1,!0,c,d),null);if(p)return this.expand(this._boundable1,this._boundable2,!1,c,d),null;if(b)return this.expand(this._boundable2,this._boundable1,!0,c,d),null;throw new ve("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(I.isComposite(this._boundable1)||I.isComposite(this._boundable2))}},{key:"compareTo",value:function(c){var d=c;return this._distance<d._distance?-1:this._distance>d._distance?1:0}},{key:"expand",value:function(c,d,p,b,M){for(var F=c.getChildBoundables().iterator();F.hasNext();){var q=F.next(),Y=null;(Y=p?new I(d,q,this._itemDistance):new I(q,d,this._itemDistance)).getDistance()<M&&b.add(Y)}}},{key:"getBoundable",value:function(c){return c===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var c=arguments[0],d=arguments[1],p=arguments[2];this._boundable1=c,this._boundable2=d,this._itemDistance=p,this._distance=this.distance()}},{key:"area",value:function(c){return c.getBounds().getArea()}},{key:"isComposite",value:function(c){return c instanceof Mr}}]),I}(),Cl=function(){function I(){i(this,I)}return a(I,[{key:"visitItem",value:function(c){}}]),I}(),Go=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"queryInternal",value:function(){if(xn(arguments[2],Cl)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var c=arguments[0],d=arguments[1],p=arguments[2],b=d.getChildBoundables(),M=0;M<b.size();M++){var F=b.get(M);this.getIntersectsOp().intersects(F.getBounds(),c)&&(F instanceof Mr?this.queryInternal(c,F,p):F instanceof Lr?p.visitItem(F.getItem()):It.shouldNeverReachHere())}else if(xn(arguments[2],Kn)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var q=arguments[0],Y=arguments[1],me=arguments[2],Ue=Y.getChildBoundables(),$e=0;$e<Ue.size();$e++){var mt=Ue.get($e);this.getIntersectsOp().intersects(mt.getBounds(),q)&&(mt instanceof Mr?this.queryInternal(q,mt,me):mt instanceof Lr?me.add(mt.getItem()):It.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(c){return c.get(c.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();b instanceof Mr?d+=this.size(b):b instanceof Lr&&(d+=1)}return d}}},{key:"removeItem",value:function(c,d){for(var p=null,b=c.getChildBoundables().iterator();b.hasNext();){var M=b.next();M instanceof Lr&&M.getItem()===d&&(p=M)}return p!==null&&(c.getChildBoundables().remove(p),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var c=this.itemsTree(this._root);return c===null?new Tt:c}if(arguments.length===1){for(var d=arguments[0],p=new Tt,b=d.getChildBoundables().iterator();b.hasNext();){var M=b.next();if(M instanceof Mr){var F=this.itemsTree(M);F!==null&&p.add(F)}else M instanceof Lr?p.add(M.getItem()):It.shouldNeverReachHere()}return p.size()<=0?null:p}}},{key:"insert",value:function(c,d){It.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Lr(c,d))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var c=arguments[0],d=new Tt;return this.boundablesAtLevel(c,this._root,d),d}if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2];if(It.isTrue(p>-2),b.getLevel()===p)return M.add(b),null;for(var F=b.getChildBoundables().iterator();F.hasNext();){var q=F.next();q instanceof Mr?this.boundablesAtLevel(p,q,M):(It.isTrue(q instanceof Lr),p===-1&&M.add(q))}return null}}},{key:"query",value:function(){if(arguments.length===1){var c=arguments[0];this.build();var d=new Tt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,d),d}if(arguments.length===2){var p=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.queryInternal(p,this._root,b)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.remove(c,this._root,d)}if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2],F=this.removeItem(b,M);if(F)return!0;for(var q=null,Y=b.getChildBoundables().iterator();Y.hasNext();){var me=Y.next();if(this.getIntersectsOp().intersects(me.getBounds(),p)&&me instanceof Mr&&(F=this.remove(p,me,M))){q=me;break}}return q!==null&&q.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(q),F}}},{key:"createHigherLevels",value:function(c,d){It.isTrue(!c.isEmpty());var p=this.createParentBoundables(c,d+1);return p.size()===1?p.get(0):this.createHigherLevels(p,d+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();if(b instanceof Mr){var M=this.depth(b);M>d&&(d=M)}}return d+1}}},{key:"createParentBoundables",value:function(c,d){It.isTrue(!c.isEmpty());var p=new Tt;p.add(this.createNode(d));var b=new Tt(c);jo.sort(b,this.getComparator());for(var M=b.iterator();M.hasNext();){var F=M.next();this.lastNode(p).getChildBoundables().size()===this.getNodeCapacity()&&p.add(this.createNode(d)),this.lastNode(p).addChildBoundable(F)}return p}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new Tt,this._nodeCapacity=null,arguments.length===0)I.constructor_.call(this,I.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var c=arguments[0];It.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}}},{key:"compareDoubles",value:function(c,d){return c>d?1:c<d?-1:0}}]),I}();Go.IntersectsOp=function(){},Go.DEFAULT_NODE_CAPACITY=10;var au=function(){function I(){i(this,I)}return a(I,[{key:"distance",value:function(c,d){}}]),I}(),ts=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"createParentBoundablesFromVerticalSlices",value:function(p,b){It.isTrue(p.length>0);for(var M=new Tt,F=0;F<p.length;F++)M.addAll(this.createParentBoundablesFromVerticalSlice(p[F],b));return M}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.nearestNeighbourK(p,vt.POSITIVE_INFINITY,b)}if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2],Y=F,me=new bs;me.add(M);for(var Ue=new bs;!me.isEmpty()&&Y>=0;){var $e=me.poll(),mt=$e.getDistance();if(mt>=Y)break;if($e.isLeaves())if(Ue.size()<q)Ue.add($e);else{var zt=Ue.peek();zt.getDistance()>mt&&(Ue.poll(),Ue.add($e));var Nt=Ue.peek();Y=Nt.getDistance()}else $e.expandToQueue(me,Y)}return d.getItems(Ue)}}},{key:"createNode",value:function(p){return new Ll(p)}},{key:"size",value:function(){return arguments.length===0?U(g(d.prototype),"size",this).call(this):U(g(d.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn))return U(g(d.prototype),"insert",this).apply(this,arguments);var p=arguments[0],b=arguments[1];if(p.isNull())return null;U(g(d.prototype),"insert",this).call(this,p,b)}},{key:"getIntersectsOp",value:function(){return d.intersectsOp}},{key:"verticalSlices",value:function(p,b){for(var M=Math.trunc(Math.ceil(p.size()/b)),F=new Array(b).fill(null),q=p.iterator(),Y=0;Y<b;Y++){F[Y]=new Tt;for(var me=0;q.hasNext()&&me<M;){var Ue=q.next();F[Y].add(Ue),me++}}return F}},{key:"query",value:function(){if(arguments.length===1){var p=arguments[0];return U(g(d.prototype),"query",this).call(this,p)}if(arguments.length===2){var b=arguments[0],M=arguments[1];U(g(d.prototype),"query",this).call(this,b,M)}}},{key:"getComparator",value:function(){return d.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(p,b){return U(g(d.prototype),"createParentBoundables",this).call(this,p,b)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn){var p=arguments[0],b=arguments[1];return U(g(d.prototype),"remove",this).call(this,p,b)}return U(g(d.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?U(g(d.prototype),"depth",this).call(this):U(g(d.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(p,b){It.isTrue(!p.isEmpty());var M=Math.trunc(Math.ceil(p.size()/this.getNodeCapacity())),F=new Tt(p);jo.sort(F,d.xComparator);var q=this.verticalSlices(F,Math.trunc(Math.ceil(Math.sqrt(M))));return this.createParentBoundablesFromVerticalSlices(q,b)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(xn(arguments[0],au)){var p=arguments[0];if(this.isEmpty())return null;var b=new qo(this.getRoot(),this.getRoot(),p);return this.nearestNeighbour(b)}if(arguments[0]instanceof qo){var M=arguments[0],F=vt.POSITIVE_INFINITY,q=null,Y=new bs;for(Y.add(M);!Y.isEmpty()&&F>0;){var me=Y.poll(),Ue=me.getDistance();if(Ue>=F)break;me.isLeaves()?(F=Ue,q=me):me.expandToQueue(Y,F)}return q===null?null:[q.getBoundable(0).getItem(),q.getBoundable(1).getItem()]}}else{if(arguments.length===2){var $e=arguments[0],mt=arguments[1];if(this.isEmpty()||$e.isEmpty())return null;var zt=new qo(this.getRoot(),$e.getRoot(),mt);return this.nearestNeighbour(zt)}if(arguments.length===3){var Nt=arguments[0],gn=arguments[1],bn=arguments[2],Pn=new Lr(Nt,gn),ti=new qo(this.getRoot(),Pn,bn);return this.nearestNeighbour(ti)[0]}if(arguments.length===4){var mi=arguments[0],li=arguments[1],er=arguments[2],rs=arguments[3],Ps=new Lr(mi,li),fi=new qo(this.getRoot(),Ps,er);return this.nearestNeighbourK(fi,rs)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1],M=vt.POSITIVE_INFINITY,F=new bs;for(F.add(p);!F.isEmpty();){var q=F.poll(),Y=q.getDistance();if(Y>b)return!1;if(q.maximumDistance()<=b)return!0;if(q.isLeaves()){if((M=Y)<=b)return!0}else q.expandToQueue(F,M)}return!1}if(arguments.length===3){var me=arguments[0],Ue=arguments[1],$e=arguments[2],mt=new qo(this.getRoot(),me.getRoot(),Ue);return this.isWithinDistance(mt,$e)}}},{key:"interfaces_",get:function(){return[ri,be]}}],[{key:"constructor_",value:function(){if(arguments.length===0)d.constructor_.call(this,d.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var p=arguments[0];Go.constructor_.call(this,p)}}},{key:"centreX",value:function(p){return d.avg(p.getMinX(),p.getMaxX())}},{key:"avg",value:function(p,b){return(p+b)/2}},{key:"getItems",value:function(p){for(var b=new Array(p.size()).fill(null),M=0;!p.isEmpty();){var F=p.poll();b[M]=F.getBoundable(0).getItem(),M++}return b}},{key:"centreY",value:function(p){return d.avg(p.getMinY(),p.getMaxY())}}]),d}(Go),Ll=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeBounds",value:function(){for(var p=null,b=this.getChildBoundables().iterator();b.hasNext();){var M=b.next();p===null?p=new dn(M.getBounds()):p.expandToInclude(M.getBounds())}return p}}],[{key:"constructor_",value:function(){var p=arguments[0];Mr.constructor_.call(this,p)}}]),d}(Mr);ts.STRtreeNode=Ll,ts.xComparator=new(function(){function I(){i(this,I)}return a(I,[{key:"interfaces_",get:function(){return[wt]}},{key:"compare",value:function(c,d){return Go.compareDoubles(ts.centreX(c.getBounds()),ts.centreX(d.getBounds()))}}]),I}()),ts.yComparator=new(function(){function I(){i(this,I)}return a(I,[{key:"interfaces_",get:function(){return[wt]}},{key:"compare",value:function(c,d){return Go.compareDoubles(ts.centreY(c.getBounds()),ts.centreY(d.getBounds()))}}]),I}()),ts.intersectsOp=new(function(){function I(){i(this,I)}return a(I,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(c,d){return c.intersects(d)}}]),I}()),ts.DEFAULT_NODE_CAPACITY=10;var lu=function(){function I(){i(this,I)}return a(I,null,[{key:"relativeSign",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"compare",value:function(c,d,p){if(d.equals2D(p))return 0;var b=I.relativeSign(d.x,p.x),M=I.relativeSign(d.y,p.y);switch(c){case 0:return I.compareValue(b,M);case 1:return I.compareValue(M,b);case 2:return I.compareValue(M,-b);case 3:return I.compareValue(-b,M);case 4:return I.compareValue(-b,-M);case 5:return I.compareValue(-M,-b);case 6:return I.compareValue(-M,b);case 7:return I.compareValue(b,-M)}return It.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(c,d){return c<0?-1:c>0?1:d<0?-1:d>0?1:0}}]),I}(),uu=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(c){var d=c;return this.segmentIndex<d.segmentIndex?-1:this.segmentIndex>d.segmentIndex?1:this.coord.equals2D(d.coord)?0:this._isInterior?d._isInterior?lu.compare(this._segmentOctant,this.coord,d.coord):1:-1}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===c}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._segString=c,this.coord=new Xe(d),this.segmentIndex=p,this._segmentOctant=b,this._isInterior=!d.equals2D(c.getCoordinate(p))}}]),I}(),cu=function(){function I(){i(this,I)}return a(I,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),I}(),ko=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSplitCoordinates",value:function(){var c=new Ai;this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next();this.addEdgeCoordinates(p,b,c),p=b}return c.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var c=new Tt;this.findCollapsesFromInsertedNodes(c),this.findCollapsesFromExistingVertices(c);for(var d=c.iterator();d.hasNext();){var p=d.next().intValue();this.add(this._edge.getCoordinate(p),p)}}},{key:"createSplitEdgePts",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2;if(p===2)return[new Xe(c.coord),new Xe(d.coord)];var b=this._edge.getCoordinate(d.segmentIndex),M=d.isInterior()||!d.coord.equals2D(b);M||p--;var F=new Array(p).fill(null),q=0;F[q++]=new Xe(c.coord);for(var Y=c.segmentIndex+1;Y<=d.segmentIndex;Y++)F[q++]=this._edge.getCoordinate(Y);return M&&(F[q]=new Xe(d.coord)),F}},{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"findCollapsesFromExistingVertices",value:function(c){for(var d=0;d<this._edge.size()-2;d++){var p=this._edge.getCoordinate(d);this._edge.getCoordinate(d+1);var b=this._edge.getCoordinate(d+2);p.equals2D(b)&&c.add(Ji.valueOf(d+1))}}},{key:"addEdgeCoordinates",value:function(c,d,p){var b=this.createSplitEdgePts(c,d);p.add(b,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints(),this.addCollapsedNodes();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),M=this.createSplitEdge(p,b);c.add(M),p=b}}},{key:"findCollapseIndex",value:function(c,d,p){if(!c.coord.equals2D(d.coord))return!1;var b=d.segmentIndex-c.segmentIndex;return d.isInterior()||b--,b===1&&(p[0]=c.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(c){for(var d=new Array(1).fill(null),p=this.iterator(),b=p.next();p.hasNext();){var M=p.next();this.findCollapseIndex(b,M,d)&&c.add(Ji.valueOf(d[0])),b=M}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var c=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(c),c)}},{key:"createSplitEdge",value:function(c,d){var p=this.createSplitEdgePts(c,d);return new xs(p,this._edge.getData())}},{key:"add",value:function(c,d){var p=new uu(this._edge,c,d,this._edge.getSegmentOctant(d)),b=this._nodeMap.get(p);return b!==null?(It.isTrue(b.coord.equals2D(c),"Found equal nodes with different coordinates"),b):(this._nodeMap.put(p,p),p)}},{key:"checkSplitEdgesCorrectness",value:function(c){var d=this._edge.getCoordinates(),p=c.get(0).getCoordinate(0);if(!p.equals2D(d[0]))throw new ft("bad split edge start point at "+p);var b=c.get(c.size()-1).getCoordinates(),M=b[b.length-1];if(!M.equals2D(d[d.length-1]))throw new ft("bad split edge end point at "+M)}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this._edge=null;var c=arguments[0];this._edge=c}}]),I}(),hu=function(){function I(){i(this,I)}return a(I,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the octant for point ( "+c+", "+d+" )");var p=Math.abs(c),b=Math.abs(d);return c>=0?d>=0?p>=b?0:1:p>=b?7:6:d>=0?p>=b?3:2:p>=b?4:5}if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var M=arguments[0],F=arguments[1],q=F.x-M.x,Y=F.y-M.y;if(q===0&&Y===0)throw new ve("Cannot compute the octant for two identical points "+M);return I.octant(q,Y)}}}]),I}(),xc=function(){function I(){i(this,I)}return a(I,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(c){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(c){}},{key:"getData",value:function(){}}]),I}(),fu=function(){function I(){i(this,I)}return a(I,[{key:"addIntersection",value:function(c,d){}},{key:"interfaces_",get:function(){return[xc]}}]),I}(),xs=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(c){return this._pts[c]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(c){return c===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(c),this.getCoordinate(c+1))}},{key:"setData",value:function(c){this._data=c}},{key:"safeOctant",value:function(c,d){return c.equals2D(d)?0:hu.octant(c,d)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.addIntersectionNode(c,d)}else if(arguments.length===4){var p=arguments[0],b=arguments[1],M=arguments[3],F=new Xe(p.getIntersection(M));this.addIntersection(F,b)}}},{key:"toString",value:function(){return za.toLineString(new bo(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(c,d){var p=d,b=p+1;if(b<this._pts.length){var M=this._pts[b];c.equals2D(M)&&(p=b)}return this._nodeList.add(c,p)}},{key:"addIntersections",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++)this.addIntersection(c,d,p,b)}},{key:"interfaces_",get:function(){return[fu]}}],[{key:"constructor_",value:function(){this._nodeList=new ko(this),this._pts=null,this._data=null;var c=arguments[0],d=arguments[1];this._pts=c,this._data=d}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var c=arguments[0],d=new Tt;return I.getNodedSubstrings(c,d),d}if(arguments.length===2)for(var p=arguments[0],b=arguments[1],M=p.iterator();M.hasNext();){var F=M.next();F.getNodeList().addSplitEdges(b)}}}]),I}(),Hr=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=mn.index(this.p0,this.p1,c.p0),p=mn.index(this.p0,this.p1,c.p1);return d>=0&&p>=0||d<=0&&p<=0?Math.max(d,p):0}if(arguments[0]instanceof Xe){var b=arguments[0];return mn.index(this.p0,this.p1,b)}}},{key:"toGeometry",value:function(c){return c.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)}},{key:"intersection",value:function(c){var d=new so;return d.computeIntersection(this.p0,this.p1,c.p0,c.p1),d.hasIntersection()?d.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Xe){var c=arguments[0];if(c.equals(this.p0)||c.equals(this.p1))return new Xe(c);var d=this.projectionFactor(c),p=new Xe;return p.x=this.p0.x+d*(this.p1.x-this.p0.x),p.y=this.p0.y+d*(this.p1.y-this.p0.y),p}if(arguments[0]instanceof I){var b=arguments[0],M=this.projectionFactor(b.p0),F=this.projectionFactor(b.p1);if(M>=1&&F>=1||M<=0&&F<=0)return null;var q=this.project(b.p0);M<0&&(q=this.p0),M>1&&(q=this.p1);var Y=this.project(b.p1);return F<0&&(Y=this.p0),F>1&&(Y=this.p1),new I(q,Y)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(c){return c===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(c){return Ki.pointToLinePerpendicular(c,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return I.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(c){if(c.equals(this.p0))return 0;if(c.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,b=d*d+p*p;return b<=0?vt.NaN:((c.x-this.p0.x)*d+(c.y-this.p0.y)*p)/b}},{key:"closestPoints",value:function(c){var d=this.intersection(c);if(d!==null)return[d,d];var p=new Array(2).fill(null),b=vt.MAX_VALUE,M=null,F=this.closestPoint(c.p0);b=F.distance(c.p0),p[0]=F,p[1]=c.p0;var q=this.closestPoint(c.p1);(M=q.distance(c.p1))<b&&(b=M,p[0]=q,p[1]=c.p1);var Y=c.closestPoint(this.p0);(M=Y.distance(this.p0))<b&&(b=M,p[0]=this.p0,p[1]=Y);var me=c.closestPoint(this.p1);return(M=me.distance(this.p1))<b&&(b=M,p[0]=this.p1,p[1]=me),p}},{key:"closestPoint",value:function(c){var d=this.projectionFactor(c);return d>0&&d<1?this.project(c):this.p0.distance(c)<this.p1.distance(c)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(c){var d=c,p=this.p0.compareTo(d.p0);return p!==0?p:this.p1.compareTo(d.p1)}},{key:"reverse",value:function(){var c=this.p0;this.p0=this.p1,this.p1=c}},{key:"equalsTopo",value:function(c){return this.p0.equals(c.p0)&&this.p1.equals(c.p1)||this.p0.equals(c.p1)&&this.p1.equals(c.p0)}},{key:"lineIntersection",value:function(c){return wn.intersection(this.p0,this.p1,c.p0,c.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(c,d){var p=this.p0.x+c*(this.p1.x-this.p0.x),b=this.p0.y+c*(this.p1.y-this.p0.y),M=this.p1.x-this.p0.x,F=this.p1.y-this.p0.y,q=Math.sqrt(M*M+F*F),Y=0,me=0;if(d!==0){if(q<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");Y=d*M/q,me=d*F/q}return new Xe(p-me,b+Y)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var c=arguments[0];this.setCoordinates(c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=p.x,this.p1.y=p.y}}},{key:"segmentFraction",value:function(c){var d=this.projectionFactor(c);return d<0?d=0:(d>1||vt.isNaN(d))&&(d=1),d}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(c){var d=this.p1.getY()-this.p0.getY(),p=this.p0.getX()-this.p1.getX(),b=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),M=d*d+p*p,F=d*d-p*p,q=c.getX(),Y=c.getY();return new Xe((-F*q-2*d*p*Y-2*d*b)/M,(F*Y-2*d*p*q-2*p*b)/M)}},{key:"distance",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return Ki.segmentToSegment(this.p0,this.p1,c.p0,c.p1)}if(arguments[0]instanceof Xe){var d=arguments[0];return Ki.pointToSegment(d,this.p0,this.p1)}}},{key:"pointAlong",value:function(c){var d=new Xe;return d.x=this.p0.x+c*(this.p1.x-this.p0.x),d.y=this.p0.y+c*(this.p1.y-this.p0.y),d}},{key:"hashCode",value:function(){var c=vt.doubleToLongBits(this.p0.x);c^=31*vt.doubleToLongBits(this.p0.y);var d=Math.trunc(c)^Math.trunc(c>>32),p=vt.doubleToLongBits(this.p1.x);return p^=31*vt.doubleToLongBits(this.p1.y),d^(Math.trunc(p)^Math.trunc(p>>32))}},{key:"interfaces_",get:function(){return[ue,be]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)I.constructor_.call(this,new Xe,new Xe);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0=d,this.p1=p}else if(arguments.length===4){var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3];I.constructor_.call(this,new Xe(b,M),new Xe(F,q))}}},{key:"midPoint",value:function(c,d){return new Xe((c.x+d.x)/2,(c.y+d.y)/2)}}]),I}(),ja=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"overlap",value:function(){if(arguments.length!==2&&arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];c.getLineSegment(d,this._overlapSeg1),p.getLineSegment(b,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Hr,this._overlapSeg2=new Hr}}]),I}(),du=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLineSegment",value:function(c,d){d.p0=this._pts[c],d.p1=this._pts[c+1]}},{key:"computeSelect",value:function(c,d,p,b){var M=this._pts[d],F=this._pts[p];if(p-d==1)return b.select(this,d),null;if(!c.intersects(M,F))return null;var q=Math.trunc((d+p)/2);d<q&&this.computeSelect(c,d,q,b),q<p&&this.computeSelect(c,q,p,b)}},{key:"getCoordinates",value:function(){for(var c=new Array(this._end-this._start+1).fill(null),d=0,p=this._start;p<=this._end;p++)c[d++]=this._pts[p];return c}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.computeOverlaps(this._start,this._end,c,c._start,c._end,d)}else if(arguments.length===6){var p=arguments[0],b=arguments[1],M=arguments[2],F=arguments[3],q=arguments[4],Y=arguments[5];if(b-p==1&&q-F==1)return Y.overlap(this,p,M,F),null;if(!this.overlaps(p,b,M,F,q))return null;var me=Math.trunc((p+b)/2),Ue=Math.trunc((F+q)/2);p<me&&(F<Ue&&this.computeOverlaps(p,me,M,F,Ue,Y),Ue<q&&this.computeOverlaps(p,me,M,Ue,q,Y)),me<b&&(F<Ue&&this.computeOverlaps(me,b,M,F,Ue,Y),Ue<q&&this.computeOverlaps(me,b,M,Ue,q,Y))}}},{key:"setId",value:function(c){this._id=c}},{key:"select",value:function(c,d){this.computeSelect(c,this._start,this._end,d)}},{key:"getEnvelope",value:function(){if(this._env===null){var c=this._pts[this._start],d=this._pts[this._end];this._env=new dn(c,d)}return this._env}},{key:"overlaps",value:function(c,d,p,b,M){return dn.intersects(this._pts[c],this._pts[d],p._pts[b],p._pts[M])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._pts=c,this._start=d,this._end=p,this._context=b}}]),I}(),wc=function(){function I(){i(this,I)}return a(I,null,[{key:"findChainEnd",value:function(c,d){for(var p=d;p<c.length-1&&c[p].equals2D(c[p+1]);)p++;if(p>=c.length-1)return c.length-1;for(var b=hr.quadrant(c[p],c[p+1]),M=d+1;M<c.length&&!(!c[M-1].equals2D(c[M])&&hr.quadrant(c[M-1],c[M])!==b);)M++;return M-1}},{key:"getChains",value:function(){if(arguments.length===1){var c=arguments[0];return I.getChains(c,null)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=new Tt,M=0;do{var F=I.findChainEnd(d,M),q=new du(d,M,F,p);b.add(q),M=F}while(M<d.length-1);return b}}}]),I}(),Va=function(){function I(){i(this,I)}return a(I,[{key:"computeNodes",value:function(c){}},{key:"getNodedSubstrings",value:function(){}}]),I}(),Ml=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setSegmentIntersector",value:function(c){this._segInt=c}},{key:"interfaces_",get:function(){return[Va]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this.setSegmentIntersector(c)}}}]),I}(),qa=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return xs.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(p){for(var b=wc.getChains(p.getCoordinates(),p).iterator();b.hasNext();){var M=b.next();M.setId(this._idCounter++),this._index.insert(M.getEnvelope(),M),this._monoChains.add(M)}}},{key:"computeNodes",value:function(p){this._nodedSegStrings=p;for(var b=p.iterator();b.hasNext();)this.add(b.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var p=new Ga(this._segInt),b=this._monoChains.iterator();b.hasNext();)for(var M=b.next(),F=this._index.query(M.getEnvelope()).iterator();F.hasNext();){var q=F.next();if(q.getId()>M.getId()&&(M.computeOverlaps(q,p),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new Tt,this._index=new ts,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0&&arguments.length===1){var p=arguments[0];Ml.constructor_.call(this,p)}}}]),d}(Ml),Ga=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"overlap",value:function(){if(arguments.length!==4)return U(g(d.prototype),"overlap",this).apply(this,arguments);var p=arguments[0],b=arguments[1],M=arguments[2],F=arguments[3],q=p.getContext(),Y=M.getContext();this._si.processIntersections(q,b,Y,F)}}],[{key:"constructor_",value:function(){this._si=null;var p=arguments[0];this._si=p}}]),d}(ja);qa.SegmentOverlapAction=Ga;var ns=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isDeletable",value:function(c,d,p,b){var M=this._inputLine[c],F=this._inputLine[d],q=this._inputLine[p];return!!this.isConcave(M,F,q)&&!!this.isShallow(M,F,q,b)&&this.isShallowSampled(M,F,c,p,b)}},{key:"deleteShallowConcavities",value:function(){for(var c=1,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d),b=!1;p<this._inputLine.length;){var M=!1;this.isDeletable(c,d,p,this._distanceTol)&&(this._isDeleted[d]=I.DELETE,M=!0,b=!0),c=M?p:d,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d)}return b}},{key:"isShallowConcavity",value:function(c,d,p,b){return mn.index(c,d,p)===this._angleOrientation&&Ki.pointToSegment(d,c,p)<b}},{key:"isShallowSampled",value:function(c,d,p,b,M){var F=Math.trunc((b-p)/I.NUM_PTS_TO_CHECK);F<=0&&(F=1);for(var q=p;q<b;q+=F)if(!this.isShallow(c,d,this._inputLine[q],M))return!1;return!0}},{key:"isConcave",value:function(c,d,p){var b=mn.index(c,d,p)===this._angleOrientation;return b}},{key:"simplify",value:function(c){this._distanceTol=Math.abs(c),c<0&&(this._angleOrientation=mn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do d=this.deleteShallowConcavities();while(d);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(c){for(var d=c+1;d<this._inputLine.length&&this._isDeleted[d]===I.DELETE;)d++;return d}},{key:"isShallow",value:function(c,d,p,b){return Ki.pointToSegment(d,c,p)<b}},{key:"collapseLine",value:function(){for(var c=new Ai,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==I.DELETE&&c.add(this._inputLine[d]);return c.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=mn.COUNTERCLOCKWISE;var c=arguments[0];this._inputLine=c}},{key:"simplify",value:function(c,d){return new I(c).simplify(d)}}]),I}();ns.INIT=0,ns.DELETE=1,ns.KEEP=1,ns.NUM_PTS_TO_CHECK=10;var ya=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._ptList.toArray(I.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"addPt",value:function(c){var d=new Xe(c);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(c,d){if(d)for(var p=0;p<c.length;p++)this.addPt(c[p]);else for(var b=c.length-1;b>=0;b--)this.addPt(c[b])}},{key:"isRedundant",value:function(c){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return c.distance(d)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Kr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var c=new Xe(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(c.equals(d))return null;this._ptList.add(c)}},{key:"setMinimumVertexDistance",value:function(c){this._minimimVertexDistance=c}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Tt}}]),I}();ya.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Bi=function(){function I(){i(this,I)}return a(I,null,[{key:"toDegrees",value:function(c){return 180*c/Math.PI}},{key:"normalize",value:function(c){for(;c>Math.PI;)c-=I.PI_TIMES_2;for(;c<=-Math.PI;)c+=I.PI_TIMES_2;return c}},{key:"angle",value:function(){if(arguments.length===1){var c=arguments[0];return Math.atan2(c.y,c.x)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=p.x-d.x,M=p.y-d.y;return Math.atan2(M,b)}}},{key:"isAcute",value:function(c,d,p){var b=c.x-d.x,M=c.y-d.y;return b*(p.x-d.x)+M*(p.y-d.y)>0}},{key:"isObtuse",value:function(c,d,p){var b=c.x-d.x,M=c.y-d.y;return b*(p.x-d.x)+M*(p.y-d.y)<0}},{key:"interiorAngle",value:function(c,d,p){var b=I.angle(d,c),M=I.angle(d,p);return Math.abs(M-b)}},{key:"normalizePositive",value:function(c){if(c<0){for(;c<0;)c+=I.PI_TIMES_2;c>=I.PI_TIMES_2&&(c=0)}else{for(;c>=I.PI_TIMES_2;)c-=I.PI_TIMES_2;c<0&&(c=0)}return c}},{key:"angleBetween",value:function(c,d,p){var b=I.angle(d,c),M=I.angle(d,p);return I.diff(b,M)}},{key:"diff",value:function(c,d){var p=null;return(p=c<d?d-c:c-d)>Math.PI&&(p=2*Math.PI-p),p}},{key:"toRadians",value:function(c){return c*Math.PI/180}},{key:"getTurn",value:function(c,d){var p=Math.sin(d-c);return p>0?I.COUNTERCLOCKWISE:p<0?I.CLOCKWISE:I.NONE}},{key:"angleBetweenOriented",value:function(c,d,p){var b=I.angle(d,c),M=I.angle(d,p)-b;return M<=-Math.PI?M+I.PI_TIMES_2:M>Math.PI?M-I.PI_TIMES_2:M}}]),I}();Bi.PI_TIMES_2=2*Math.PI,Bi.PI_OVER_2=Math.PI/2,Bi.PI_OVER_4=Math.PI/4,Bi.COUNTERCLOCKWISE=mn.COUNTERCLOCKWISE,Bi.CLOCKWISE=mn.CLOCKWISE,Bi.NONE=mn.COLLINEAR;var Io=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addNextSegment",value:function(c,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=c,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var p=mn.index(this._s0,this._s1,this._s2),b=p===mn.CLOCKWISE&&this._side===Ee.LEFT||p===mn.COUNTERCLOCKWISE&&this._side===Ee.RIGHT;p===0?this.addCollinear(d):b?this.addOutsideTurn(p,d):this.addInsideTurn(p,d)}},{key:"addLineEndCap",value:function(c,d){var p=new Hr(c,d),b=new Hr;this.computeOffsetSegment(p,Ee.LEFT,this._distance,b);var M=new Hr;this.computeOffsetSegment(p,Ee.RIGHT,this._distance,M);var F=d.x-c.x,q=d.y-c.y,Y=Math.atan2(q,F);switch(this._bufParams.getEndCapStyle()){case $.CAP_ROUND:this._segList.addPt(b.p1),this.addDirectedFillet(d,Y+Math.PI/2,Y-Math.PI/2,mn.CLOCKWISE,this._distance),this._segList.addPt(M.p1);break;case $.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(M.p1);break;case $.CAP_SQUARE:var me=new Xe;me.x=Math.abs(this._distance)*Math.cos(Y),me.y=Math.abs(this._distance)*Math.sin(Y);var Ue=new Xe(b.p1.x+me.x,b.p1.y+me.y),$e=new Xe(M.p1.x+me.x,M.p1.y+me.y);this._segList.addPt(Ue),this._segList.addPt($e)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(c,d,p,b){var M=wn.intersection(d.p0,d.p1,p.p0,p.p1);if(M!==null&&(b<=0?1:M.distance(c)/Math.abs(b))<=this._bufParams.getMitreLimit())return this._segList.addPt(M),null;this.addLimitedMitreJoin(d,p,b,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(c,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*I.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===$.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===$.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,c,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(c){this._segList.addPt(new Xe(c.x+this._distance,c.y+this._distance)),this._segList.addPt(new Xe(c.x+this._distance,c.y-this._distance)),this._segList.addPt(new Xe(c.x-this._distance,c.y-this._distance)),this._segList.addPt(new Xe(c.x-this._distance,c.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(c,d){this._segList.addPts(c,d)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(c,d,p,b,M){var F=d.x-c.x,q=d.y-c.y,Y=Math.atan2(q,F),me=p.x-c.x,Ue=p.y-c.y,$e=Math.atan2(Ue,me);b===mn.CLOCKWISE?Y<=$e&&(Y+=2*Math.PI):Y>=$e&&(Y-=2*Math.PI),this._segList.addPt(d),this.addDirectedFillet(c,Y,$e,b,M),this._segList.addPt(p)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(c,d,p){this._s1=c,this._s2=d,this._side=p,this._seg1.setCoordinates(c,d),this.computeOffsetSegment(this._seg1,p,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(c,d,p,b){var M=this._seg0.p1,F=Bi.angle(M,this._seg0.p0),q=Bi.angleBetweenOriented(this._seg0.p0,M,this._seg1.p1)/2,Y=Bi.normalize(F+q),me=Bi.normalize(Y+Math.PI),Ue=b*p,$e=p-Ue*Math.abs(Math.sin(q)),mt=M.x+Ue*Math.cos(me),zt=M.y+Ue*Math.sin(me),Nt=new Xe(mt,zt),gn=new Hr(M,Nt),bn=gn.pointAlongOffset(1,$e),Pn=gn.pointAlongOffset(1,-$e);this._side===Ee.LEFT?(this._segList.addPt(bn),this._segList.addPt(Pn)):(this._segList.addPt(Pn),this._segList.addPt(bn))}},{key:"addDirectedFillet",value:function(c,d,p,b,M){var F=b===mn.CLOCKWISE?-1:1,q=Math.abs(d-p),Y=Math.trunc(q/this._filletAngleQuantum+.5);if(Y<1)return null;for(var me=q/Y,Ue=new Xe,$e=0;$e<Y;$e++){var mt=d+F*$e*me;Ue.x=c.x+M*Math.cos(mt),Ue.y=c.y+M*Math.sin(mt),this._segList.addPt(Ue)}}},{key:"computeOffsetSegment",value:function(c,d,p,b){var M=d===Ee.LEFT?1:-1,F=c.p1.x-c.p0.x,q=c.p1.y-c.p0.y,Y=Math.sqrt(F*F+q*q),me=M*p*F/Y,Ue=M*p*q/Y;b.p0.x=c.p0.x-Ue,b.p0.y=c.p0.y+me,b.p1.x=c.p1.x-Ue,b.p1.y=c.p1.y+me}},{key:"addInsideTurn",value:function(c,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*I.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var p=new Xe((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p);var b=new Xe((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(c){var d=new Xe(c.x+this._distance,c.y);this._segList.addPt(d),this.addDirectedFillet(c,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(c,d){this._segList.addPt(c.p1),this._segList.addPt(d.p0)}},{key:"init",value:function(c){this._distance=c,this._maxCurveSegmentError=c*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ya,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(c*I.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(c){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===$.JOIN_BEVEL||this._bufParams.getJoinStyle()===$.JOIN_MITRE?(c&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,mn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Hr,this._seg1=new Hr,this._offset0=new Hr,this._offset1=new Hr,this._side=0,this._hasNarrowConcaveAngle=!1;var c=arguments[0],d=arguments[1],p=arguments[2];this._precisionModel=c,this._bufParams=d,this._li=new so,this._filletAngleQuantum=Math.PI/2/d.getQuadrantSegments(),d.getQuadrantSegments()>=8&&d.getJoinStyle()===$.JOIN_ROUND&&(this._closingSegLengthFactor=I.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)}}]),I}();Io.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Io.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Io.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Io.MAX_CLOSING_SEG_LEN_FACTOR=80;var Al=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getOffsetCurve",value:function(c,d){if(this._distance=d,d===0)return null;var p=d<0,b=Math.abs(d),M=this.getSegGen(b);c.length<=1?this.computePointCurve(c[0],M):this.computeOffsetCurve(c,p,M);var F=M.getCoordinates();return p&&Xn.reverse(F),F}},{key:"computeSingleSidedBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){p.addSegments(c,!0);var M=ns.simplify(c,-b),F=M.length-1;p.initSideSegments(M[F],M[F-1],Ee.LEFT),p.addFirstSegment();for(var q=F-2;q>=0;q--)p.addNextSegment(M[q],!0)}else{p.addSegments(c,!1);var Y=ns.simplify(c,b),me=Y.length-1;p.initSideSegments(Y[0],Y[1],Ee.LEFT),p.addFirstSegment();for(var Ue=2;Ue<=me;Ue++)p.addNextSegment(Y[Ue],!0)}p.addLastSegment(),p.closeRing()}},{key:"computeRingBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);d===Ee.RIGHT&&(b=-b);var M=ns.simplify(c,b),F=M.length-1;p.initSideSegments(M[F-1],M[0],d);for(var q=1;q<=F;q++){var Y=q!==1;p.addNextSegment(M[q],Y)}p.closeRing()}},{key:"computeLineBufferCurve",value:function(c,d){var p=this.simplifyTolerance(this._distance),b=ns.simplify(c,p),M=b.length-1;d.initSideSegments(b[0],b[1],Ee.LEFT);for(var F=2;F<=M;F++)d.addNextSegment(b[F],!0);d.addLastSegment(),d.addLineEndCap(b[M-1],b[M]);var q=ns.simplify(c,-p),Y=q.length-1;d.initSideSegments(q[Y],q[Y-1],Ee.LEFT);for(var me=Y-2;me>=0;me--)d.addNextSegment(q[me],!0);d.addLastSegment(),d.addLineEndCap(q[1],q[0]),d.closeRing()}},{key:"computePointCurve",value:function(c,d){switch(this._bufParams.getEndCapStyle()){case $.CAP_ROUND:d.createCircle(c);break;case $.CAP_SQUARE:d.createSquare(c)}}},{key:"getLineCurve",value:function(c,d){if(this._distance=d,this.isLineOffsetEmpty(d))return null;var p=Math.abs(d),b=this.getSegGen(p);if(c.length<=1)this.computePointCurve(c[0],b);else if(this._bufParams.isSingleSided()){var M=d<0;this.computeSingleSidedBufferCurve(c,M,b)}else this.computeLineBufferCurve(c,b);return b.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(c){return c*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(c,d,p){if(this._distance=p,c.length<=2)return this.getLineCurve(c,p);if(p===0)return I.copyCoordinates(c);var b=this.getSegGen(p);return this.computeRingBufferCurve(c,d,b),b.getCoordinates()}},{key:"computeOffsetCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){var M=ns.simplify(c,-b),F=M.length-1;p.initSideSegments(M[F],M[F-1],Ee.LEFT),p.addFirstSegment();for(var q=F-2;q>=0;q--)p.addNextSegment(M[q],!0)}else{var Y=ns.simplify(c,b),me=Y.length-1;p.initSideSegments(Y[0],Y[1],Ee.LEFT),p.addFirstSegment();for(var Ue=2;Ue<=me;Ue++)p.addNextSegment(Y[Ue],!0)}p.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(c){return c===0||c<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(c){return new Io(this._precisionModel,this._bufParams,c)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var c=arguments[0],d=arguments[1];this._precisionModel=c,this._bufParams=d}},{key:"copyCoordinates",value:function(c){for(var d=new Array(c.length).fill(null),p=0;p<d.length;p++)d[p]=new Xe(c[p]);return d}}]),I}(),Za=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Tt,p=this._subgraphs.iterator();p.hasNext();){var b=p.next(),M=b.getEnvelope();c.y<M.getMinY()||c.y>M.getMaxY()||this.findStabbedSegments(c,b.getDirectedEdges(),d)}return d}if(arguments.length===3){if(xn(arguments[2],Kn)&&arguments[0]instanceof Xe&&arguments[1]instanceof _a)for(var F=arguments[0],q=arguments[1],Y=arguments[2],me=q.getEdge().getCoordinates(),Ue=0;Ue<me.length-1;Ue++){this._seg.p0=me[Ue],this._seg.p1=me[Ue+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var $e=Math.max(this._seg.p0.x,this._seg.p1.x);if(!($e<F.x)&&!(this._seg.isHorizontal()||F.y<this._seg.p0.y||F.y>this._seg.p1.y||mn.index(this._seg.p0,this._seg.p1,F)===mn.RIGHT)){var mt=q.getDepth(Ee.LEFT);this._seg.p0.equals(me[Ue])||(mt=q.getDepth(Ee.RIGHT));var zt=new va(this._seg,mt);Y.add(zt)}}else if(xn(arguments[2],Kn)&&arguments[0]instanceof Xe&&xn(arguments[1],Kn))for(var Nt=arguments[0],gn=arguments[1],bn=arguments[2],Pn=gn.iterator();Pn.hasNext();){var ti=Pn.next();ti.isForward()&&this.findStabbedSegments(Nt,ti,bn)}}}},{key:"getDepth",value:function(c){var d=this.findStabbedSegments(c);return d.size()===0?0:jo.min(d)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Hr;var c=arguments[0];this._subgraphs=c}}]),I}(),va=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;if(this._upwardSeg.minX()>=d._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=d._upwardSeg.minX())return-1;var p=this._upwardSeg.orientationIndex(d._upwardSeg);return p!==0||(p=-1*d._upwardSeg.orientationIndex(this._upwardSeg))!==0?p:this._upwardSeg.compareTo(d._upwardSeg)}},{key:"compareX",value:function(c,d){var p=c.p0.compareTo(d.p0);return p!==0?p:c.p1.compareTo(d.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var c=arguments[0],d=arguments[1];this._upwardSeg=new Hr(c),this._leftDepth=d}}]),I}();Za.DepthSegment=va;var Ha=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){fe.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),d}(fe),qs=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getY",value:function(){var c=this.y/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getX",value:function(){var c=this.x/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getCoordinate",value:function(){var c=new Xe;return c.x=this.getX(),c.y=this.getY(),c}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var d=arguments[0],p=arguments[1];this.x=d,this.y=p,this.w=1}else if(arguments[0]instanceof I&&arguments[1]instanceof I){var b=arguments[0],M=arguments[1];this.x=b.y*M.w-M.y*b.w,this.y=M.x*b.w-b.x*M.w,this.w=b.x*M.y-M.x*b.y}else if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var F=arguments[0],q=arguments[1];this.x=F.y-q.y,this.y=q.x-F.x,this.w=F.x*q.y-q.x*F.y}}else if(arguments.length===3){var Y=arguments[0],me=arguments[1],Ue=arguments[2];this.x=Y,this.y=me,this.w=Ue}else if(arguments.length===4){var $e=arguments[0],mt=arguments[1],zt=arguments[2],Nt=arguments[3],gn=$e.y-mt.y,bn=mt.x-$e.x,Pn=$e.x*mt.y-mt.x*$e.y,ti=zt.y-Nt.y,mi=Nt.x-zt.x,li=zt.x*Nt.y-Nt.x*zt.y;this.x=bn*li-mi*Pn,this.y=ti*Pn-gn*li,this.w=gn*mi-ti*bn}}}]),I}(),Pl=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"area",value:function(){return I.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return I.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(c){if(c===null)throw new ve("Supplied point is null.");return I.interpolateZ(c,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return I.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return I.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return I.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return I.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return I.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return I.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.p0=c,this.p1=d,this.p2=p}},{key:"area",value:function(c,d,p){return Math.abs(((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2)}},{key:"signedArea",value:function(c,d,p){return((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2}},{key:"det",value:function(c,d,p,b){return c*b-d*p}},{key:"interpolateZ",value:function(c,d,p,b){var M=d.x,F=d.y,q=p.x-M,Y=b.x-M,me=p.y-F,Ue=b.y-F,$e=q*Ue-Y*me,mt=c.x-M,zt=c.y-F,Nt=(Ue*mt-Y*zt)/$e,gn=(-me*mt+q*zt)/$e;return d.getZ()+Nt*(p.getZ()-d.getZ())+gn*(b.getZ()-d.getZ())}},{key:"longestSideLength",value:function(c,d,p){var b=c.distance(d),M=d.distance(p),F=p.distance(c),q=b;return M>q&&(q=M),F>q&&(q=F),q}},{key:"circumcentreDD",value:function(c,d,p){var b=ct.valueOf(c.x).subtract(p.x),M=ct.valueOf(c.y).subtract(p.y),F=ct.valueOf(d.x).subtract(p.x),q=ct.valueOf(d.y).subtract(p.y),Y=ct.determinant(b,M,F,q).multiply(2),me=b.sqr().add(M.sqr()),Ue=F.sqr().add(q.sqr()),$e=ct.determinant(M,me,q,Ue),mt=ct.determinant(b,me,F,Ue),zt=ct.valueOf(p.x).subtract($e.divide(Y)).doubleValue(),Nt=ct.valueOf(p.y).add(mt.divide(Y)).doubleValue();return new Xe(zt,Nt)}},{key:"isAcute",value:function(c,d,p){return!!Bi.isAcute(c,d,p)&&!!Bi.isAcute(d,p,c)&&!!Bi.isAcute(p,c,d)}},{key:"circumcentre",value:function(c,d,p){var b=p.x,M=p.y,F=c.x-b,q=c.y-M,Y=d.x-b,me=d.y-M,Ue=2*I.det(F,q,Y,me),$e=I.det(q,F*F+q*q,me,Y*Y+me*me),mt=I.det(F,F*F+q*q,Y,Y*Y+me*me);return new Xe(b-$e/Ue,M+mt/Ue)}},{key:"perpendicularBisector",value:function(c,d){var p=d.x-c.x,b=d.y-c.y,M=new qs(c.x+p/2,c.y+b/2,1),F=new qs(c.x-b+p/2,c.y+p+b/2,1);return new qs(M,F)}},{key:"angleBisector",value:function(c,d,p){var b=d.distance(c),M=b/(b+d.distance(p)),F=p.x-c.x,q=p.y-c.y;return new Xe(c.x+M*F,c.y+M*q)}},{key:"area3D",value:function(c,d,p){var b=d.x-c.x,M=d.y-c.y,F=d.getZ()-c.getZ(),q=p.x-c.x,Y=p.y-c.y,me=p.getZ()-c.getZ(),Ue=M*me-F*Y,$e=F*q-b*me,mt=b*Y-M*q,zt=Ue*Ue+$e*$e+mt*mt,Nt=Math.sqrt(zt)/2;return Nt}},{key:"centroid",value:function(c,d,p){var b=(c.x+d.x+p.x)/3,M=(c.y+d.y+p.y)/3;return new Xe(b,M)}},{key:"inCentre",value:function(c,d,p){var b=d.distance(p),M=c.distance(p),F=c.distance(d),q=b+M+F,Y=(b*c.x+M*d.x+F*p.x)/q,me=(b*c.y+M*d.y+F*p.y)/q;return new Xe(Y,me)}}]),I}(),kc=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addRingSide",value:function(c,d,p,b,M){if(d===0&&c.length<wi.MINIMUM_VALID_SIZE)return null;var F=b,q=M;c.length>=wi.MINIMUM_VALID_SIZE&&mn.isCCW(c)&&(F=M,q=b,p=Ee.opposite(p));var Y=this._curveBuilder.getRingCurve(c,p,d);this.addCurve(Y,F,q)}},{key:"addRingBothSides",value:function(c,d){this.addRingSide(c,d,Ee.LEFT,Se.EXTERIOR,Se.INTERIOR),this.addRingSide(c,d,Ee.RIGHT,Se.INTERIOR,Se.EXTERIOR)}},{key:"addPoint",value:function(c){if(this._distance<=0)return null;var d=c.getCoordinates(),p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Se.EXTERIOR,Se.INTERIOR)}},{key:"addPolygon",value:function(c){var d=this._distance,p=Ee.LEFT;this._distance<0&&(d=-this._distance,p=Ee.RIGHT);var b=c.getExteriorRing(),M=Xn.removeRepeatedPoints(b.getCoordinates());if(this._distance<0&&this.isErodedCompletely(b,this._distance)||this._distance<=0&&M.length<3)return null;this.addRingSide(M,d,p,Se.EXTERIOR,Se.INTERIOR);for(var F=0;F<c.getNumInteriorRing();F++){var q=c.getInteriorRingN(F),Y=Xn.removeRepeatedPoints(q.getCoordinates());this._distance>0&&this.isErodedCompletely(q,-this._distance)||this.addRingSide(Y,d,Ee.opposite(p),Se.INTERIOR,Se.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(c,d){var p=new Pl(c[0],c[1],c[2]),b=p.inCentre();return Ki.pointToSegment(b,p.p0,p.p1)<Math.abs(d)}},{key:"addLineString",value:function(c){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var d=Xn.removeRepeatedPoints(c.getCoordinates());if(Xn.isRing(d)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(d,this._distance);else{var p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Se.EXTERIOR,Se.INTERIOR)}}},{key:"addCurve",value:function(c,d,p){if(c===null||c.length<2)return null;var b=new xs(c,new bi(0,Se.BOUNDARY,d,p));this._curveList.add(b)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(c){if(c.isEmpty())return null;if(c instanceof en)this.addPolygon(c);else if(c instanceof We)this.addLineString(c);else if(c instanceof et)this.addPoint(c);else if(c instanceof Fn)this.addCollection(c);else if(c instanceof no)this.addCollection(c);else if(c instanceof Cr)this.addCollection(c);else{if(!(c instanceof An))throw new Lt(c.getGeometryType());this.addCollection(c)}}},{key:"isErodedCompletely",value:function(c,d){var p=c.getCoordinates();if(p.length<4)return d<0;if(p.length===4)return this.isTriangleErodedCompletely(p,d);var b=c.getEnvelopeInternal(),M=Math.min(b.getHeight(),b.getWidth());return d<0&&2*Math.abs(d)>M}},{key:"addCollection",value:function(c){for(var d=0;d<c.getNumGeometries();d++){var p=c.getGeometryN(d);this.add(p)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Tt;var c=arguments[0],d=arguments[1],p=arguments[2];this._inputGeom=c,this._distance=d,this._curveBuilder=p}}]),I}(),Di=function(){function I(){i(this,I)}return a(I,[{key:"locate",value:function(c){}}]),I}(),Ic=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,I.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Je;var c=this._parent.getGeometryN(this._index++);return c instanceof An?(this._subcollectionIterator=new I(c),this._subcollectionIterator.next()):c}},{key:"remove",value:function(){throw new Lt(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[cu]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var c=arguments[0];this._parent=c,this._atStart=!0,this._index=0,this._max=c.getNumGeometries()}},{key:"isAtomic",value:function(c){return!(c instanceof An)}}]),I}(),Bn=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"locate",value:function(c){return I.locate(c,this._geom)}},{key:"interfaces_",get:function(){return[Di]}}],[{key:"constructor_",value:function(){this._geom=null;var c=arguments[0];this._geom=c}},{key:"locatePointInPolygon",value:function(c,d){if(d.isEmpty())return Se.EXTERIOR;var p=d.getExteriorRing(),b=I.locatePointInRing(c,p);if(b!==Se.INTERIOR)return b;for(var M=0;M<d.getNumInteriorRing();M++){var F=d.getInteriorRingN(M),q=I.locatePointInRing(c,F);if(q===Se.BOUNDARY)return Se.BOUNDARY;if(q===Se.INTERIOR)return Se.EXTERIOR}return Se.INTERIOR}},{key:"locatePointInRing",value:function(c,d){return d.getEnvelopeInternal().intersects(c)?Vs.locateInRing(c,d.getCoordinates()):Se.EXTERIOR}},{key:"containsPointInPolygon",value:function(c,d){return Se.EXTERIOR!==I.locatePointInPolygon(c,d)}},{key:"locateInGeometry",value:function(c,d){if(d instanceof en)return I.locatePointInPolygon(c,d);if(d instanceof An)for(var p=new Ic(d);p.hasNext();){var b=p.next();if(b!==d){var M=I.locateInGeometry(c,b);if(M!==Se.EXTERIOR)return M}}return Se.EXTERIOR}},{key:"isContained",value:function(c,d){return Se.EXTERIOR!==I.locate(c,d)}},{key:"locate",value:function(c,d){return d.isEmpty()?Se.EXTERIOR:d.getEnvelopeInternal().intersects(c)?I.locateInGeometry(c,d):Se.EXTERIOR}}]),I}(),Wa=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getNextCW",value:function(c){this.getEdges();var d=this._edgeList.indexOf(c),p=d-1;return d===0&&(p=this._edgeList.size()-1),this._edgeList.get(p)}},{key:"propagateSideLabels",value:function(c){for(var d=Se.NONE,p=this.iterator();p.hasNext();){var b=p.next().getLabel();b.isArea(c)&&b.getLocation(c,Ee.LEFT)!==Se.NONE&&(d=b.getLocation(c,Ee.LEFT))}if(d===Se.NONE)return null;for(var M=d,F=this.iterator();F.hasNext();){var q=F.next(),Y=q.getLabel();if(Y.getLocation(c,Ee.ON)===Se.NONE&&Y.setLocation(c,Ee.ON,M),Y.isArea(c)){var me=Y.getLocation(c,Ee.LEFT),Ue=Y.getLocation(c,Ee.RIGHT);if(Ue!==Se.NONE){if(Ue!==M)throw new At("side location conflict",q.getCoordinate());me===Se.NONE&&It.shouldNeverReachHere("found single null side (at "+q.getCoordinate()+")"),M=me}else It.isTrue(Y.getLocation(c,Ee.LEFT)===Se.NONE,"found single null side"),Y.setLocation(c,Ee.RIGHT,M),Y.setLocation(c,Ee.LEFT,M)}}}},{key:"getCoordinate",value:function(){var c=this.iterator();return c.hasNext()?c.next().getCoordinate():null}},{key:"print",value:function(c){Mi.out.println("EdgeEndStar:   "+this.getCoordinate());for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"isAreaLabelsConsistent",value:function(c){return this.computeEdgeEndLabels(c.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(c){var d=this.getEdges();if(d.size()<=0)return!0;var p=d.size()-1,b=d.get(p).getLabel().getLocation(c,Ee.LEFT);It.isTrue(b!==Se.NONE,"Found unlabelled area edge");for(var M=b,F=this.iterator();F.hasNext();){var q=F.next().getLabel();It.isTrue(q.isArea(c),"Found non-area edge");var Y=q.getLocation(c,Ee.LEFT),me=q.getLocation(c,Ee.RIGHT);if(Y===me||me!==M)return!1;M=Y}return!0}},{key:"findIndex",value:function(c){this.iterator();for(var d=0;d<this._edgeList.size();d++)if(this._edgeList.get(d)===c)return d;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new Tt(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(c,d,p){return this._ptInAreaLocation[c]===Se.NONE&&(this._ptInAreaLocation[c]=Bn.locate(d,p[c].getGeometry())),this._ptInAreaLocation[c]}},{key:"toString",value:function(){var c=new qi;c.append("EdgeEndStar:   "+this.getCoordinate()),c.append(`
`);for(var d=this.iterator();d.hasNext();){var p=d.next();c.append(p),c.append(`
`)}return c.toString()}},{key:"computeEdgeEndLabels",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().computeLabel(c)}},{key:"computeLabelling",value:function(c){this.computeEdgeEndLabels(c[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var d=[!1,!1],p=this.iterator();p.hasNext();)for(var b=p.next().getLabel(),M=0;M<2;M++)b.isLine(M)&&b.getLocation(M)===Se.BOUNDARY&&(d[M]=!0);for(var F=this.iterator();F.hasNext();)for(var q=F.next(),Y=q.getLabel(),me=0;me<2;me++)if(Y.isAnyNull(me)){var Ue=Se.NONE;if(d[me])Ue=Se.EXTERIOR;else{var $e=q.getCoordinate();Ue=this.getLocation(me,$e,c)}Y.setAllLocationsIfNull(me,Ue)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(c,d){this._edgeMap.put(c,d),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Bo,this._edgeList=null,this._ptInAreaLocation=[Se.NONE,Se.NONE]}}]),I}(),pi=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var p=null,b=null,M=this._SCANNING_FOR_INCOMING,F=0;F<this._resultAreaEdgeList.size();F++){var q=this._resultAreaEdgeList.get(F),Y=q.getSym();if(q.getLabel().isArea())switch(p===null&&q.isInResult()&&(p=q),M){case this._SCANNING_FOR_INCOMING:if(!Y.isInResult())continue;b=Y,M=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!q.isInResult())continue;b.setNext(q),M=this._SCANNING_FOR_INCOMING}}if(M===this._LINKING_TO_OUTGOING){if(p===null)throw new At("no outgoing dirEdge found",this.getCoordinate());It.isTrue(p.isInResult(),"unable to link last incoming dirEdge"),b.setNext(p)}}},{key:"insert",value:function(p){var b=p;this.insertEdgeEnd(b,b)}},{key:"getRightmostEdge",value:function(){var p=this.getEdges(),b=p.size();if(b<1)return null;var M=p.get(0);if(b===1)return M;var F=p.get(b-1),q=M.getQuadrant(),Y=F.getQuadrant();return hr.isNorthern(q)&&hr.isNorthern(Y)?M:hr.isNorthern(q)||hr.isNorthern(Y)?M.getDy()!==0?M:F.getDy()!==0?F:(It.shouldNeverReachHere("found two horizontal edges incident on node"),null):F}},{key:"print",value:function(p){Mi.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var b=this.iterator();b.hasNext();){var M=b.next();p.print("out "),M.print(p),p.println(),p.print("in "),M.getSym().print(p),p.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Tt;for(var p=this.iterator();p.hasNext();){var b=p.next();(b.isInResult()||b.getSym().isInResult())&&this._resultAreaEdgeList.add(b)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(p){for(var b=this.iterator();b.hasNext();){var M=b.next().getLabel();M.setAllLocationsIfNull(0,p.getLocation(0)),M.setAllLocationsIfNull(1,p.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var p=null,b=null,M=this._edgeList.size()-1;M>=0;M--){var F=this._edgeList.get(M),q=F.getSym();b===null&&(b=q),p!==null&&q.setNext(p),p=F}b.setNext(p)}},{key:"computeDepths",value:function(){if(arguments.length===1){var p=arguments[0],b=this.findIndex(p),M=p.getDepth(Ee.LEFT),F=p.getDepth(Ee.RIGHT),q=this.computeDepths(b+1,this._edgeList.size(),M),Y=this.computeDepths(0,b,q);if(Y!==F)throw new At("depth mismatch at "+p.getCoordinate())}else if(arguments.length===3){for(var me=arguments[0],Ue=arguments[1],$e=arguments[2],mt=$e,zt=me;zt<Ue;zt++){var Nt=this._edgeList.get(zt);Nt.setEdgeDepths(Ee.RIGHT,mt),mt=Nt.getDepth(Ee.LEFT)}return mt}}},{key:"mergeSymLabels",value:function(){for(var p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().merge(b.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(p){for(var b=null,M=null,F=this._SCANNING_FOR_INCOMING,q=this._resultAreaEdgeList.size()-1;q>=0;q--){var Y=this._resultAreaEdgeList.get(q),me=Y.getSym();switch(b===null&&Y.getEdgeRing()===p&&(b=Y),F){case this._SCANNING_FOR_INCOMING:if(me.getEdgeRing()!==p)continue;M=me,F=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(Y.getEdgeRing()!==p)continue;M.setNextMin(Y),F=this._SCANNING_FOR_INCOMING}}F===this._LINKING_TO_OUTGOING&&(It.isTrue(b!==null,"found null for first outgoing dirEdge"),It.isTrue(b.getEdgeRing()===p,"unable to link last incoming dirEdge"),M.setNextMin(b))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var p=0,b=this.iterator();b.hasNext();){var M=b.next();M.isInResult()&&p++}return p}if(arguments.length===1){for(var F=arguments[0],q=0,Y=this.iterator();Y.hasNext();){var me=Y.next();me.getEdgeRing()===F&&q++}return q}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var p=Se.NONE,b=this.iterator();b.hasNext();){var M=b.next(),F=M.getSym();if(!M.isLineEdge()){if(M.isInResult()){p=Se.INTERIOR;break}if(F.isInResult()){p=Se.EXTERIOR;break}}}if(p===Se.NONE)return null;for(var q=p,Y=this.iterator();Y.hasNext();){var me=Y.next(),Ue=me.getSym();me.isLineEdge()?me.getEdge().setCovered(q===Se.INTERIOR):(me.isInResult()&&(q=Se.EXTERIOR),Ue.isInResult()&&(q=Se.INTERIOR))}}},{key:"computeLabelling",value:function(p){U(g(d.prototype),"computeLabelling",this).call(this,p),this._label=new bi(Se.NONE);for(var b=this.iterator();b.hasNext();)for(var M=b.next().getEdge().getLabel(),F=0;F<2;F++){var q=M.getLocation(F);q!==Se.INTERIOR&&q!==Se.BOUNDARY||this._label.setLocation(F,Se.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),d}(Wa),ci=function(I){f(d,I);var c=B(d);function d(){return i(this,d),c.call(this)}return a(d,[{key:"createNode",value:function(p){return new ma(p,new pi)}}]),d}(Ba),oo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;return I.compareOriented(this._pts,this._orientation,d._pts,d._orientation)}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var c=arguments[0];this._pts=c,this._orientation=I.orientation(c)}},{key:"orientation",value:function(c){return Xn.increasingDirection(c)===1}},{key:"compareOriented",value:function(c,d,p,b){for(var M=d?1:-1,F=b?1:-1,q=d?c.length:-1,Y=b?p.length:-1,me=d?0:c.length-1,Ue=b?0:p.length-1;;){var $e=c[me].compareTo(p[Ue]);if($e!==0)return $e;var mt=(me+=M)===q,zt=(Ue+=F)===Y;if(mt&&!zt)return-1;if(!mt&&zt)return 1;if(mt&&zt)return 0}}}]),I}(),ba=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.print("MULTILINESTRING ( ");for(var d=0;d<this._edges.size();d++){var p=this._edges.get(d);d>0&&c.print(","),c.print("(");for(var b=p.getCoordinates(),M=0;M<b.length;M++)M>0&&c.print(","),c.print(b[M].x+" "+b[M].y);c.println(")")}c.print(")  ")}},{key:"addAll",value:function(c){for(var d=c.iterator();d.hasNext();)this.add(d.next())}},{key:"findEdgeIndex",value:function(c){for(var d=0;d<this._edges.size();d++)if(this._edges.get(d).equals(c))return d;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(c){return this._edges.get(c)}},{key:"findEqualEdge",value:function(c){var d=new oo(c.getCoordinates());return this._ocaMap.get(d)}},{key:"add",value:function(c){this._edges.add(c);var d=new oo(c.getCoordinates());this._ocaMap.put(d,c)}}],[{key:"constructor_",value:function(){this._edges=new Tt,this._ocaMap=new Bo}}]),I}(),Zo=function(){function I(){i(this,I)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){}},{key:"isDone",value:function(){}}]),I}(),Rl=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isTrivialIntersection",value:function(c,d,p,b){if(c===p&&this._li.getIntersectionNum()===1){if(I.isAdjacentSegments(d,b))return!0;if(c.isClosed()){var M=c.size()-1;if(d===0&&b===M||b===0&&d===M)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;this.numTests++;var M=c.getCoordinates()[d],F=c.getCoordinates()[d+1],q=p.getCoordinates()[b],Y=p.getCoordinates()[b+1];this._li.computeIntersection(M,F,q,Y),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(c,d,p,b)||(this._hasIntersection=!0,c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var c=arguments[0];this._li=c}},{key:"isAdjacentSegments",value:function(c,d){return Math.abs(c-d)===1}}]),I}(),So=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex),c.println(" dist = "+this.dist)}},{key:"compareTo",value:function(c){var d=c;return this.compare(d.segmentIndex,d.dist)}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===c}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(c,d){return this.segmentIndex<c?-1:this.segmentIndex>c?1:this.dist<d?-1:this.dist>d?1:0}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.coord=new Xe(c),this.segmentIndex=d,this.dist=p}}]),I}(),Ho=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),M=this.createSplitEdge(p,b);c.add(M),p=b}}},{key:"addEndpoints",value:function(){var c=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[c],c,0)}},{key:"createSplitEdge",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2,b=this.edge.pts[d.segmentIndex],M=d.dist>0||!d.coord.equals2D(b);M||p--;var F=new Array(p).fill(null),q=0;F[q++]=new Xe(c.coord);for(var Y=c.segmentIndex+1;Y<=d.segmentIndex;Y++)F[q++]=this.edge.pts[Y];return M&&(F[q]=d.coord),new Wo(F,new bi(this.edge._label))}},{key:"add",value:function(c,d,p){var b=new So(c,d,p),M=this._nodeMap.get(b);return M!==null?M:(this._nodeMap.put(b,b),b)}},{key:"isIntersection",value:function(c){for(var d=this.iterator();d.hasNext();)if(d.next().coord.equals(c))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this.edge=null;var c=arguments[0];this.edge=c}}]),I}(),is=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"isCoveredBy",value:function(){return(I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this._matrix[p][b]=le.toDimensionValue(c.charAt(d))}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this._matrix[M][F]=q}}},{key:"isContains",value:function(){return I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this.setAtLeast(p,b,le.toDimensionValue(c.charAt(d)))}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this._matrix[M][F]<q&&(this._matrix[M][F]=q)}}},{key:"setAtLeastIfValid",value:function(c,d,p){c>=0&&d>=0&&this.setAtLeast(c,d,p)}},{key:"isWithin",value:function(){return I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE}},{key:"isTouches",value:function(c,d){return c>d?this.isTouches(d,c):(c===le.A&&d===le.A||c===le.L&&d===le.L||c===le.L&&d===le.A||c===le.P&&d===le.A||c===le.P&&d===le.L)&&this._matrix[Se.INTERIOR][Se.INTERIOR]===le.FALSE&&(I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))}},{key:"isOverlaps",value:function(c,d){return c===le.P&&d===le.P||c===le.A&&d===le.A?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):c===le.L&&d===le.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===1&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR])}},{key:"isEquals",value:function(c,d){return c===d&&I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"toString",value:function(){for(var c=new Qn("123456789"),d=0;d<3;d++)for(var p=0;p<3;p++)c.setCharAt(3*d+p,le.toDimensionSymbol(this._matrix[d][p]));return c.toString()}},{key:"setAll",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this._matrix[d][p]=c}},{key:"get",value:function(c,d){return this._matrix[c][d]}},{key:"transpose",value:function(){var c=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=c,c=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=c,c=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=c,this}},{key:"matches",value:function(c){if(c.length!==9)throw new ve("Should be length 9: "+c);for(var d=0;d<3;d++)for(var p=0;p<3;p++)if(!I.matches(this._matrix[d][p],c.charAt(3*d+p)))return!1;return!0}},{key:"add",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this.setAtLeast(d,p,c.get(d,p))}},{key:"isDisjoint",value:function(){return this._matrix[Se.INTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.INTERIOR][Se.BOUNDARY]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.INTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.BOUNDARY]===le.FALSE}},{key:"isCrosses",value:function(c,d){return c===le.P&&d===le.L||c===le.P&&d===le.A||c===le.L&&d===le.A?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR]):c===le.L&&d===le.P||c===le.A&&d===le.P||c===le.A&&d===le.L?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):c===le.L&&d===le.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===0}},{key:"interfaces_",get:function(){return[xe]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(le.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var c=arguments[0];I.constructor_.call(this),this.set(c)}else if(arguments[0]instanceof I){var d=arguments[0];I.constructor_.call(this),this._matrix[Se.INTERIOR][Se.INTERIOR]=d._matrix[Se.INTERIOR][Se.INTERIOR],this._matrix[Se.INTERIOR][Se.BOUNDARY]=d._matrix[Se.INTERIOR][Se.BOUNDARY],this._matrix[Se.INTERIOR][Se.EXTERIOR]=d._matrix[Se.INTERIOR][Se.EXTERIOR],this._matrix[Se.BOUNDARY][Se.INTERIOR]=d._matrix[Se.BOUNDARY][Se.INTERIOR],this._matrix[Se.BOUNDARY][Se.BOUNDARY]=d._matrix[Se.BOUNDARY][Se.BOUNDARY],this._matrix[Se.BOUNDARY][Se.EXTERIOR]=d._matrix[Se.BOUNDARY][Se.EXTERIOR],this._matrix[Se.EXTERIOR][Se.INTERIOR]=d._matrix[Se.EXTERIOR][Se.INTERIOR],this._matrix[Se.EXTERIOR][Se.BOUNDARY]=d._matrix[Se.EXTERIOR][Se.BOUNDARY],this._matrix[Se.EXTERIOR][Se.EXTERIOR]=d._matrix[Se.EXTERIOR][Se.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var c=arguments[0],d=arguments[1];return d===le.SYM_DONTCARE||d===le.SYM_TRUE&&(c>=0||c===le.TRUE)||d===le.SYM_FALSE&&c===le.FALSE||d===le.SYM_P&&c===le.P||d===le.SYM_L&&c===le.L||d===le.SYM_A&&c===le.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var p=arguments[0],b=arguments[1],M=new I(p);return M.matches(b)}}},{key:"isTrue",value:function(c){return c>=0||c===le.TRUE}}]),I}(),Dl=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(c){return c===null||c.length===0?null:(this.ensureCapacity(this._size+c.length),Mi.arraycopy(c,0,this._data,this._size,c.length),void(this._size+=c.length))}},{key:"ensureCapacity",value:function(c){if(c<=this._data.length)return null;var d=Math.max(c,2*this._data.length);this._data=at.copyOf(this._data,d)}},{key:"toArray",value:function(){var c=new Array(this._size).fill(null);return Mi.arraycopy(this._data,0,c,0,this._size),c}},{key:"add",value:function(c){this.ensureCapacity(this._size+1),this._data[this._size]=c,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)I.constructor_.call(this,10);else if(arguments.length===1){var c=arguments[0];this._data=new Array(c).fill(null)}}}]),I}(),Nl=function(){function I(){i(this,I)}return a(I,[{key:"getChainStartIndices",value:function(c){var d=0,p=new Dl(Math.trunc(c.length/2));p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return p.toArray()}},{key:"findChainEnd",value:function(c,d){for(var p=hr.quadrant(c[d],c[d+1]),b=d+1;b<c.length&&hr.quadrant(c[b-1],c[b])===p;)b++;return b-1}},{key:"OLDgetChainStartIndices",value:function(c){var d=0,p=new Tt;p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return I.toIntArray(p)}}],[{key:"toIntArray",value:function(c){for(var d=new Array(c.size()).fill(null),p=0;p<d.length;p++)d[p]=c.get(p).intValue();return d}}]),I}(),zl=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d>p?d:p}},{key:"getMinX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d<p?d:p}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this.computeIntersectsForChain(this.startIndex[c],this.startIndex[c+1],d,d.startIndex[p],d.startIndex[p+1],b)}else if(arguments.length===6){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3],me=arguments[4],Ue=arguments[5];if(F-M==1&&me-Y==1)return Ue.addIntersections(this.e,M,q.e,Y),null;if(!this.overlaps(M,F,q,Y,me))return null;var $e=Math.trunc((M+F)/2),mt=Math.trunc((Y+me)/2);M<$e&&(Y<mt&&this.computeIntersectsForChain(M,$e,q,Y,mt,Ue),mt<me&&this.computeIntersectsForChain(M,$e,q,mt,me,Ue)),$e<F&&(Y<mt&&this.computeIntersectsForChain($e,F,q,Y,mt,Ue),mt<me&&this.computeIntersectsForChain($e,F,q,mt,me,Ue))}}},{key:"overlaps",value:function(c,d,p,b,M){return dn.intersects(this.pts[c],this.pts[d],p.pts[b],p.pts[M])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(c,d){for(var p=0;p<this.startIndex.length-1;p++)for(var b=0;b<c.startIndex.length-1;b++)this.computeIntersectsForChain(p,c,b,d)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var c=arguments[0];this.e=c,this.pts=c.getCoordinates();var d=new Nl;this.startIndex=d.getChainStartIndices(this.pts)}}]),I}(),ao=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getDepth",value:function(c,d){return this._depth[c][d]}},{key:"setDepth",value:function(c,d,p){this._depth[c][d]=p}},{key:"isNull",value:function(){if(arguments.length===0){for(var c=0;c<2;c++)for(var d=0;d<3;d++)if(this._depth[c][d]!==I.NULL_VALUE)return!1;return!0}if(arguments.length===1){var p=arguments[0];return this._depth[p][1]===I.NULL_VALUE}if(arguments.length===2){var b=arguments[0],M=arguments[1];return this._depth[b][M]===I.NULL_VALUE}}},{key:"normalize",value:function(){for(var c=0;c<2;c++)if(!this.isNull(c)){var d=this._depth[c][1];this._depth[c][2]<d&&(d=this._depth[c][2]),d<0&&(d=0);for(var p=1;p<3;p++){var b=0;this._depth[c][p]>d&&(b=1),this._depth[c][p]=b}}}},{key:"getDelta",value:function(c){return this._depth[c][Ee.RIGHT]-this._depth[c][Ee.LEFT]}},{key:"getLocation",value:function(c,d){return this._depth[c][d]<=0?Se.EXTERIOR:Se.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<2;d++)for(var p=1;p<3;p++){var b=c.getLocation(d,p);b!==Se.EXTERIOR&&b!==Se.INTERIOR||(this.isNull(d,p)?this._depth[d][p]=I.depthAtLocation(b):this._depth[d][p]+=I.depthAtLocation(b))}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];q===Se.INTERIOR&&this._depth[M][F]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var c=0;c<2;c++)for(var d=0;d<3;d++)this._depth[c][d]=I.NULL_VALUE}},{key:"depthAtLocation",value:function(c){return c===Se.EXTERIOR?0:c===Se.INTERIOR?1:I.NULL_VALUE}}]),I}();ao.NULL_VALUE=-1;var Wo=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var p=new Array(2).fill(null);return p[0]=this.pts[0],p[1]=this.pts[1],new d(p,bi.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(p){this._isIsolated=p}},{key:"setName",value:function(p){this._name=p}},{key:"equals",value:function(p){if(!(p instanceof d))return!1;var b=p;if(this.pts.length!==b.pts.length)return!1;for(var M=!0,F=!0,q=this.pts.length,Y=0;Y<this.pts.length;Y++)if(this.pts[Y].equals2D(b.pts[Y])||(M=!1),this.pts[Y].equals2D(b.pts[--q])||(F=!1),!M&&!F)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var p=arguments[0];return this.pts[p]}}},{key:"print",value:function(p){p.print("edge "+this._name+": "),p.print("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.print(","),p.print(this.pts[b].x+" "+this.pts[b].y);p.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(p){d.updateIM(this._label,p)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(p){p.print("edge "+this._name+": ");for(var b=this.pts.length-1;b>=0;b--)p.print(this.pts[b]+" ");p.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new zl(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new dn;for(var p=0;p<this.pts.length;p++)this._env.expandToInclude(this.pts[p])}return this._env}},{key:"addIntersection",value:function(p,b,M,F){var q=new Xe(p.getIntersection(F)),Y=b,me=p.getEdgeDistance(M,F),Ue=Y+1;if(Ue<this.pts.length){var $e=this.pts[Ue];q.equals2D($e)&&(Y=Ue,me=0)}this.eiList.add(q,Y,me)}},{key:"toString",value:function(){var p=new Qn;p.append("edge "+this._name+": "),p.append("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.append(","),p.append(this.pts[b].x+" "+this.pts[b].y);return p.append(")  "+this._label+" "+this._depthDelta),p.toString()}},{key:"isPointwiseEqual",value:function(p){if(this.pts.length!==p.pts.length)return!1;for(var b=0;b<this.pts.length;b++)if(!this.pts[b].equals2D(p.pts[b]))return!1;return!0}},{key:"setDepthDelta",value:function(p){this._depthDelta=p}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(p,b,M){for(var F=0;F<p.getIntersectionNum();F++)this.addIntersection(p,b,M,F)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Ho(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ao,this._depthDelta=0,arguments.length===1){var p=arguments[0];d.constructor_.call(this,p,null)}else if(arguments.length===2){var b=arguments[0],M=arguments[1];this.pts=b,this._label=M}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof is&&arguments[0]instanceof bi))return U(g(d),"updateIM",this).apply(this,arguments);var p=arguments[0],b=arguments[1];b.setAtLeastIfValid(p.getLocation(0,Ee.ON),p.getLocation(1,Ee.ON),1),p.isArea()&&(b.setAtLeastIfValid(p.getLocation(0,Ee.LEFT),p.getLocation(1,Ee.LEFT),2),b.setAtLeastIfValid(p.getLocation(0,Ee.RIGHT),p.getLocation(1,Ee.RIGHT),2))}}]),d}(pa),Xo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setWorkingPrecisionModel",value:function(c){this._workingPrecisionModel=c}},{key:"insertUniqueEdge",value:function(c){var d=this._edgeList.findEqualEdge(c);if(d!==null){var p=d.getLabel(),b=c.getLabel();d.isPointwiseEqual(c)||(b=new bi(c.getLabel())).flip(),p.merge(b);var M=I.depthDelta(b),F=d.getDepthDelta()+M;d.setDepthDelta(F)}else this._edgeList.add(c),c.setDepthDelta(I.depthDelta(c.getLabel()))}},{key:"buildSubgraphs",value:function(c,d){for(var p=new Tt,b=c.iterator();b.hasNext();){var M=b.next(),F=M.getRightmostCoordinate(),q=new Za(p).getDepth(F);M.computeDepth(q),M.findResultEdges(),p.add(M),d.add(M.getDirectedEdges(),M.getNodes())}}},{key:"createSubgraphs",value:function(c){for(var d=new Tt,p=c.getNodes().iterator();p.hasNext();){var b=p.next();if(!b.isVisited()){var M=new Gr;M.create(b),d.add(M)}}return jo.sort(d,jo.reverseOrder()),d}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(c){if(this._workingNoder!==null)return this._workingNoder;var d=new qa,p=new so;return p.setPrecisionModel(c),d.setSegmentIntersector(new Rl(p)),d}},{key:"buffer",value:function(c,d){var p=this._workingPrecisionModel;p===null&&(p=c.getPrecisionModel()),this._geomFact=c.getFactory();var b=new Al(p,this._bufParams),M=new kc(c,d,b).getCurves();if(M.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(M,p),this._graph=new vs(new ci),this._graph.addEdges(this._edgeList.getEdges());var F=this.createSubgraphs(this._graph),q=new bc(this._geomFact);this.buildSubgraphs(F,q);var Y=q.getPolygons();return Y.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(Y)}},{key:"computeNodedEdges",value:function(c,d){var p=this.getNoder(d);p.computeNodes(c);for(var b=p.getNodedSubstrings().iterator();b.hasNext();){var M=b.next(),F=M.getCoordinates();if(F.length!==2||!F[0].equals2D(F[1])){var q=M.getData(),Y=new Wo(M.getCoordinates(),new bi(q));this.insertUniqueEdge(Y)}}}},{key:"setNoder",value:function(c){this._workingNoder=c}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ba;var c=arguments[0];this._bufParams=c}},{key:"depthDelta",value:function(c){var d=c.getLocation(0,Ee.LEFT),p=c.getLocation(0,Ee.RIGHT);return d===Se.INTERIOR&&p===Se.EXTERIOR?1:d===Se.EXTERIOR&&p===Se.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(c){for(var d=new Kr,p=new Tt;c.hasNext();){var b=c.next(),M=d.createLineString(b.getCoordinates());p.add(M)}return d.buildGeometry(p)}}]),I}(),$o=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"rescale",value:function(){if(xn(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.rescale(p.getCoordinates())}else if(arguments[0]instanceof Array){for(var b=arguments[0],M=0;M<b.length;M++)b[M].x=b[M].x/this._scaleFactor+this._offsetX,b[M].y=b[M].y/this._scaleFactor+this._offsetY;b.length===2&&b[0].equals2D(b[1])&&Mi.out.println(b)}}},{key:"scale",value:function(){if(xn(arguments[0],lt)){for(var c=arguments[0],d=new Tt(c.size()),p=c.iterator();p.hasNext();){var b=p.next();d.add(new xs(this.scale(b.getCoordinates()),b.getData()))}return d}if(arguments[0]instanceof Array){for(var M=arguments[0],F=new Array(M.length).fill(null),q=0;q<M.length;q++)F[q]=new Xe(Math.round((M[q].x-this._offsetX)*this._scaleFactor),Math.round((M[q].y-this._offsetY)*this._scaleFactor),M[q].getZ());var Y=Xn.removeRepeatedPoints(F);return Y}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var c=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(c),c}},{key:"computeNodes",value:function(c){var d=c;this._isScaled&&(d=this.scale(c)),this._noder.computeNodes(d)}},{key:"interfaces_",get:function(){return[Va]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var c=arguments[0],d=arguments[1];I.constructor_.call(this,c,d,0,0)}else if(arguments.length===4){var p=arguments[0],b=arguments[1];this._noder=p,this._scaleFactor=b,this._isScaled=!this.isIntegerPrecision()}}}]),I}(),Yo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next(),p=d.getCoordinates();this.checkEndPtVertexIntersections(p[0],this._segStrings),this.checkEndPtVertexIntersections(p[p.length-1],this._segStrings)}else if(arguments.length===2){for(var b=arguments[0],M=arguments[1],F=M.iterator();F.hasNext();)for(var q=F.next(),Y=q.getCoordinates(),me=1;me<Y.length-1;me++)if(Y[me].equals(b))throw new ft("found endpt/interior pt intersection at index "+me+" :pt "+b)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();)for(var d=c.next(),p=this._segStrings.iterator();p.hasNext();){var b=p.next();this.checkInteriorIntersections(d,b)}else if(arguments.length===2)for(var M=arguments[0],F=arguments[1],q=M.getCoordinates(),Y=F.getCoordinates(),me=0;me<q.length-1;me++)for(var Ue=0;Ue<Y.length-1;Ue++)this.checkInteriorIntersections(M,me,F,Ue);else if(arguments.length===4){var $e=arguments[0],mt=arguments[1],zt=arguments[2],Nt=arguments[3];if($e===zt&&mt===Nt)return null;var gn=$e.getCoordinates()[mt],bn=$e.getCoordinates()[mt+1],Pn=zt.getCoordinates()[Nt],ti=zt.getCoordinates()[Nt+1];if(this._li.computeIntersection(gn,bn,Pn,ti),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,gn,bn)||this.hasInteriorIntersection(this._li,Pn,ti)))throw new ft("found non-noded intersection at "+gn+"-"+bn+" and "+Pn+"-"+ti)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next();this.checkCollapses(d)}else if(arguments.length===1)for(var p=arguments[0],b=p.getCoordinates(),M=0;M<b.length-2;M++)this.checkCollapse(b[M],b[M+1],b[M+2])}},{key:"hasInteriorIntersection",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++){var M=c.getIntersection(b);if(!M.equals(d)&&!M.equals(p))return!0}return!1}},{key:"checkCollapse",value:function(c,d,p){if(c.equals(p))throw new ft("found non-noded collapse at "+I.fact.createLineString([c,d,p]))}}],[{key:"constructor_",value:function(){this._li=new so,this._segStrings=null;var c=arguments[0];this._segStrings=c}}]),I}();Yo.fact=new Kr;var Jo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"intersectsScaled",value:function(c,d){var p=Math.min(c.x,d.x),b=Math.max(c.x,d.x),M=Math.min(c.y,d.y),F=Math.max(c.y,d.y),q=this._maxx<p||this._minx>b||this._maxy<M||this._miny>F;if(q)return!1;var Y=this.intersectsToleranceSquare(c,d);return It.isTrue(!(q&&Y),"Found bad envelope test"),Y}},{key:"initCorners",value:function(c){var d=.5;this._minx=c.x-d,this._maxx=c.x+d,this._miny=c.y-d,this._maxy=c.y+d,this._corner[0]=new Xe(this._maxx,this._maxy),this._corner[1]=new Xe(this._minx,this._maxy),this._corner[2]=new Xe(this._minx,this._miny),this._corner[3]=new Xe(this._maxx,this._miny)}},{key:"intersects",value:function(c,d){return this._scaleFactor===1?this.intersectsScaled(c,d):(this.copyScaled(c,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(c){return Math.round(c*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(c,d){d.x=this.scale(c.x),d.y=this.scale(c.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var c=I.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new dn(this._originalPt.x-c,this._originalPt.x+c,this._originalPt.y-c,this._originalPt.y+c)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(c,d){return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(c,d){var p=!1,b=!1;return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!p||!b)||!!c.equals(this._pt)||!!d.equals(this._pt))))}},{key:"addSnappedNode",value:function(c,d){var p=c.getCoordinate(d),b=c.getCoordinate(d+1);return!!this.intersects(p,b)&&(c.addIntersection(this.getCoordinate(),d),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var c=arguments[0],d=arguments[1],p=arguments[2];if(this._originalPt=c,this._pt=c,this._scaleFactor=d,this._li=p,d<=0)throw new ve("Scale factor must be non-zero");d!==1&&(this._pt=new Xe(this.scale(c.x),this.scale(c.y)),this._p0Scaled=new Xe,this._p1Scaled=new Xe),this.initCorners(this._pt)}}]),I}();Jo.SAFE_ENV_EXPANSION_FACTOR=.75;var Ko=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"select",value:function(){if(arguments.length!==1&&arguments.length===2){var c=arguments[0],d=arguments[1];c.getLineSegment(d,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Hr}}]),I}(),Eo=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"snap",value:function(){if(arguments.length===1){var c=arguments[0];return this.snap(c,null,-1)}if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2],M=d.getSafeEnvelope(),F=new Ol(d,p,b);return this._index.query(M,new(function(){function q(){i(this,q)}return a(q,[{key:"interfaces_",get:function(){return[Cl]}},{key:"visitItem",value:function(Y){Y.select(M,F)}}]),q}())),F.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var c=arguments[0];this._index=c}}]),I}(),Ol=function(I){f(d,I);var c=B(d);function d(){var p;return i(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof du))return U(g(d.prototype),"select",this).apply(this,arguments);var p=arguments[0],b=arguments[1],M=p.getContext();if(this._parentEdge===M&&(b===this._hotPixelVertexIndex||b+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(M,b)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var p=arguments[0],b=arguments[1],M=arguments[2];this._hotPixel=p,this._parentEdge=b,this._hotPixelVertexIndex=M}}]),d}(Ko);Eo.HotPixelSnapAction=Ol;var Fl=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;var M=c.getCoordinates()[d],F=c.getCoordinates()[d+1],q=p.getCoordinates()[b],Y=p.getCoordinates()[b+1];if(this._li.computeIntersection(M,F,q,Y),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var me=0;me<this._li.getIntersectionNum();me++)this._interiorIntersections.add(this._li.getIntersection(me));c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var c=arguments[0];this._li=c,this._interiorIntersections=new Tt}}]),I}(),$n=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkCorrectness",value:function(c){var d=xs.getNodedSubstrings(c),p=new Yo(d);try{p.checkValid()}catch(b){if(!(b instanceof fe))throw b;b.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return xs.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(c,d){var p=this.findInteriorIntersections(c,d);this.computeIntersectionSnaps(p),this.computeVertexSnaps(c)}},{key:"findInteriorIntersections",value:function(c,d){var p=new Fl(d);return this._noder.setSegmentIntersector(p),this._noder.computeNodes(c),p.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(xn(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.computeVertexSnaps(p)}else if(arguments[0]instanceof xs)for(var b=arguments[0],M=b.getCoordinates(),F=0;F<M.length;F++){var q=new Jo(M[F],this._scaleFactor,this._li),Y=this._pointSnapper.snap(q,b,F);Y&&b.addIntersection(M[F],F)}}},{key:"computeNodes",value:function(c){this._nodedSegStrings=c,this._noder=new qa,this._pointSnapper=new Eo(this._noder.getIndex()),this.snapRound(c,this._li)}},{key:"computeIntersectionSnaps",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next(),b=new Jo(p,this._scaleFactor,this._li);this._pointSnapper.snap(b)}}},{key:"interfaces_",get:function(){return[Va]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var c=arguments[0];this._pm=c,this._li=new so,this._li.setPrecisionModel(c),this._scaleFactor=c.getScale()}}]),I}(),Gs=function(){function I(){i(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"bufferFixedPrecision",value:function(c){var d=new $o(new $n(new Pi(1)),c.getScale()),p=new Xo(this._bufParams);p.setWorkingPrecisionModel(c),p.setNoder(d),this._resultGeometry=p.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var c=I.MAX_PRECISION_DIGITS;c>=0;c--){try{this.bufferReducedPrecision(c)}catch(M){if(!(M instanceof At))throw M;this._saveException=M}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var d=arguments[0],p=I.precisionScaleFactor(this._argGeom,this._distance,d),b=new Pi(p);this.bufferFixedPrecision(b)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var c=this._argGeom.getFactory().getPrecisionModel();c.getType()===Pi.FIXED?this.bufferFixedPrecision(c):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(c){this._bufParams.setQuadrantSegments(c)}},{key:"bufferOriginalPrecision",value:function(){try{var c=new Xo(this._bufParams);this._resultGeometry=c.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof ft))throw d;this._saveException=d}}},{key:"getResultGeometry",value:function(c){return this._distance=c,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(c){this._bufParams.setEndCapStyle(c)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new $,this._resultGeometry=null,this._saveException=null,arguments.length===1){var c=arguments[0];this._argGeom=c}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this._argGeom=d,this._bufParams=p}}},{key:"bufferOp",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1],p=new I(c),b=p.getResultGeometry(d);return b}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ft&&typeof arguments[1]=="number"){var M=arguments[0],F=arguments[1],q=arguments[2],Y=new I(M);Y.setQuadrantSegments(q);var me=Y.getResultGeometry(F);return me}if(arguments[2]instanceof $&&arguments[0]instanceof Ft&&typeof arguments[1]=="number"){var Ue=arguments[0],$e=arguments[1],mt=arguments[2],zt=new I(Ue,mt),Nt=zt.getResultGeometry($e);return Nt}}else if(arguments.length===4){var gn=arguments[0],bn=arguments[1],Pn=arguments[2],ti=arguments[3],mi=new I(gn);mi.setQuadrantSegments(Pn),mi.setEndCapStyle(ti);var li=mi.getResultGeometry(bn);return li}}},{key:"precisionScaleFactor",value:function(c,d,p){var b=c.getEnvelopeInternal(),M=Er.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(d>0?d:0),F=p-Math.trunc(Math.log(M)/Math.log(10)+1);return Math.pow(10,F)}}]),I}();Gs.CAP_ROUND=$.CAP_ROUND,Gs.CAP_BUTT=$.CAP_FLAT,Gs.CAP_FLAT=$.CAP_FLAT,Gs.CAP_SQUARE=$.CAP_SQUARE,Gs.MAX_PRECISION_DIGITS=12;var Sc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Bl=function(){function I(c){i(this,I),this.geometryFactory=c||new Kr}return a(I,[{key:"read",value:function(c){var d,p=(d=typeof c=="string"?JSON.parse(c):c).type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+d.type);return Sc.indexOf(p)!==-1?fr[p].call(this,d.coordinates):p==="GeometryCollection"?fr[p].call(this,d.geometries):fr[p].call(this,d)}},{key:"write",value:function(c){var d=c.getGeometryType();if(!ws[d])throw new Error("Geometry is not supported");return ws[d].call(this,c)}}]),I}(),fr={Feature:function(I){var c={};for(var d in I)c[d]=I[d];if(I.geometry){var p=I.geometry.type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+I.type);c.geometry=this.read(I.geometry)}return I.bbox&&(c.bbox=fr.bbox.call(this,I.bbox)),c},FeatureCollection:function(I){var c={};if(I.features){c.features=[];for(var d=0;d<I.features.length;++d)c.features.push(this.read(I.features[d]))}return I.bbox&&(c.bbox=this.parse.bbox.call(this,I.bbox)),c},coordinates:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(E(Xe,te(p)))}return c},bbox:function(I){return this.geometryFactory.createLinearRing([new Xe(I[0],I[1]),new Xe(I[2],I[1]),new Xe(I[2],I[3]),new Xe(I[0],I[3]),new Xe(I[0],I[1])])},Point:function(I){var c=E(Xe,te(I));return this.geometryFactory.createPoint(c)},MultiPoint:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.Point.call(this,I[d]));return this.geometryFactory.createMultiPoint(c)},LineString:function(I){var c=fr.coordinates.call(this,I);return this.geometryFactory.createLineString(c)},MultiLineString:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.LineString.call(this,I[d]));return this.geometryFactory.createMultiLineString(c)},Polygon:function(I){for(var c=fr.coordinates.call(this,I[0]),d=this.geometryFactory.createLinearRing(c),p=[],b=1;b<I.length;++b){var M=I[b],F=fr.coordinates.call(this,M),q=this.geometryFactory.createLinearRing(F);p.push(q)}return this.geometryFactory.createPolygon(d,p)},MultiPolygon:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(fr.Polygon.call(this,p))}return this.geometryFactory.createMultiPolygon(c)},GeometryCollection:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(this.read(p))}return this.geometryFactory.createGeometryCollection(c)}},ws={coordinate:function(I){var c=[I.x,I.y];return I.z&&c.push(I.z),I.m&&c.push(I.m),c},Point:function(I){return{type:"Point",coordinates:ws.coordinate.call(this,I.getCoordinate())}},MultiPoint:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.Point.call(this,p);c.push(b.coordinates)}return{type:"MultiPoint",coordinates:c}},LineString:function(I){for(var c=[],d=I.getCoordinates(),p=0;p<d.length;++p){var b=d[p];c.push(ws.coordinate.call(this,b))}return{type:"LineString",coordinates:c}},MultiLineString:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.LineString.call(this,p);c.push(b.coordinates)}return{type:"MultiLineString",coordinates:c}},Polygon:function(I){var c=[],d=ws.LineString.call(this,I._shell);c.push(d.coordinates);for(var p=0;p<I._holes.length;++p){var b=I._holes[p],M=ws.LineString.call(this,b);c.push(M.coordinates)}return{type:"Polygon",coordinates:c}},MultiPolygon:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.Polygon.call(this,p);c.push(b.coordinates)}return{type:"MultiPolygon",coordinates:c}},GeometryCollection:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=p.getGeometryType();c.push(ws[b].call(this,p))}return{type:"GeometryCollection",geometries:c}}};return{BufferOp:Gs,GeoJSONReader:function(){function I(c){i(this,I),this.parser=new Bl(c||new Kr)}return a(I,[{key:"read",value:function(c){return this.parser.read(c)}}]),I}(),GeoJSONWriter:function(){function I(){i(this,I),this.parser=new Bl(this.geometryFactory)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}]),I}()}})})(av);var _w=av.exports;const yw=gw(_w);function Il(){return new Ff}function Ff(){this.reset()}Ff.prototype={constructor:Ff,reset:function(){this.s=this.t=0},add:function(r){u_(yf,r,this.t),u_(this,yf.s,this.s),this.s?this.t+=yf.t:this.s=yf.t},valueOf:function(){return this.s}};var yf=new Ff;function u_(r,e,i){var s=r.s=e+i,a=s-e,f=s-a;r.t=e-f+(i-a)}var Oi=1e-6,di=Math.PI,sa=di/2,c_=di/4,oa=di*2,pl=180/di,mo=di/180,qr=Math.abs,vw=Math.atan,ic=Math.atan2,nr=Math.cos,ir=Math.sin,fc=Math.sqrt;function lv(r){return r>1?0:r<-1?di:Math.acos(r)}function ru(r){return r>1?sa:r<-1?-sa:Math.asin(r)}function mh(){}function Bf(r,e){r&&f_.hasOwnProperty(r.type)&&f_[r.type](r,e)}var h_={Feature:function(r,e){Bf(r.geometry,e)},FeatureCollection:function(r,e){for(var i=r.features,s=-1,a=i.length;++s<a;)Bf(i[s].geometry,e)}},f_={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var i=r.coordinates,s=-1,a=i.length;++s<a;)r=i[s],e.point(r[0],r[1],r[2])},LineString:function(r,e){Ip(r.coordinates,e,0)},MultiLineString:function(r,e){for(var i=r.coordinates,s=-1,a=i.length;++s<a;)Ip(i[s],e,0)},Polygon:function(r,e){d_(r.coordinates,e)},MultiPolygon:function(r,e){for(var i=r.coordinates,s=-1,a=i.length;++s<a;)d_(i[s],e)},GeometryCollection:function(r,e){for(var i=r.geometries,s=-1,a=i.length;++s<a;)Bf(i[s],e)}};function Ip(r,e,i){var s=-1,a=r.length-i,f;for(e.lineStart();++s<a;)f=r[s],e.point(f[0],f[1],f[2]);e.lineEnd()}function d_(r,e){var i=-1,s=r.length;for(e.polygonStart();++i<s;)Ip(r[i],e,1);e.polygonEnd()}function bw(r,e){r&&h_.hasOwnProperty(r.type)?h_[r.type](r,e):Bf(r,e)}Il();Il();function Sp(r){return[ic(r[1],r[0]),ru(r[2])]}function rc(r){var e=r[0],i=r[1],s=nr(i);return[s*nr(e),s*ir(e),ir(i)]}function vf(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Uf(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function ap(r,e){r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]}function bf(r,e){return[r[0]*e,r[1]*e,r[2]*e]}function Ep(r){var e=fc(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=e,r[1]/=e,r[2]/=e}Il();function uv(r,e){function i(s,a){return s=r(s,a),e(s[0],s[1])}return r.invert&&e.invert&&(i.invert=function(s,a){return s=e.invert(s,a),s&&r.invert(s[0],s[1])}),i}function Tp(r,e){return[r>di?r-oa:r<-di?r+oa:r,e]}Tp.invert=Tp;function xw(r,e,i){return(r%=oa)?e||i?uv(m_(r),g_(e,i)):m_(r):e||i?g_(e,i):Tp}function p_(r){return function(e,i){return e+=r,[e>di?e-oa:e<-di?e+oa:e,i]}}function m_(r){var e=p_(r);return e.invert=p_(-r),e}function g_(r,e){var i=nr(r),s=ir(r),a=nr(e),f=ir(e);function g(l,x){var E=nr(x),C=nr(l)*E,L=ir(l)*E,N=ir(x),B=N*i+C*s;return[ic(L*a-B*f,C*i-N*s),ru(B*a+L*f)]}return g.invert=function(l,x){var E=nr(x),C=nr(l)*E,L=ir(l)*E,N=ir(x),B=N*a-L*f;return[ic(L*a+N*f,C*i+B*s),ru(B*i-C*s)]},g}function ww(r,e,i,s,a,f){if(i){var g=nr(e),l=ir(e),x=s*i;a==null?(a=e+s*oa,f=e-x/2):(a=__(g,a),f=__(g,f),(s>0?a<f:a>f)&&(a+=s*oa));for(var E,C=a;s>0?C>f:C<f;C-=x)E=Sp([g,-l*nr(C),-l*ir(C)]),r.point(E[0],E[1])}}function __(r,e){e=rc(e),e[0]-=r,Ep(e);var i=lv(-e[1]);return((-e[2]<0?-i:i)+oa-Oi)%oa}function cv(){var r=[],e;return{point:function(i,s){e.push([i,s])},lineStart:function(){r.push(e=[])},lineEnd:mh,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var i=r;return r=[],e=null,i}}}function kw(r,e,i,s,a,f){var g=r[0],l=r[1],x=e[0],E=e[1],C=0,L=1,N=x-g,B=E-l,U;if(U=i-g,!(!N&&U>0)){if(U/=N,N<0){if(U<C)return;U<L&&(L=U)}else if(N>0){if(U>L)return;U>C&&(C=U)}if(U=a-g,!(!N&&U<0)){if(U/=N,N<0){if(U>L)return;U>C&&(C=U)}else if(N>0){if(U<C)return;U<L&&(L=U)}if(U=s-l,!(!B&&U>0)){if(U/=B,B<0){if(U<C)return;U<L&&(L=U)}else if(B>0){if(U>L)return;U>C&&(C=U)}if(U=f-l,!(!B&&U<0)){if(U/=B,B<0){if(U>L)return;U>C&&(C=U)}else if(B>0){if(U<C)return;U<L&&(L=U)}return C>0&&(r[0]=g+C*N,r[1]=l+C*B),L<1&&(e[0]=g+L*N,e[1]=l+L*B),!0}}}}}function Lf(r,e){return qr(r[0]-e[0])<Oi&&qr(r[1]-e[1])<Oi}function xf(r,e,i,s){this.x=r,this.z=e,this.o=i,this.e=s,this.v=!1,this.n=this.p=null}function hv(r,e,i,s,a){var f=[],g=[],l,x;if(r.forEach(function(U){if(!((te=U.length-1)<=0)){var te,ie=U[0],re=U[te],J;if(Lf(ie,re)){for(a.lineStart(),l=0;l<te;++l)a.point((ie=U[l])[0],ie[1]);a.lineEnd();return}f.push(J=new xf(ie,U,null,!0)),g.push(J.o=new xf(ie,null,J,!1)),f.push(J=new xf(re,U,null,!1)),g.push(J.o=new xf(re,null,J,!0))}}),!!f.length){for(g.sort(e),y_(f),y_(g),l=0,x=g.length;l<x;++l)g[l].e=i=!i;for(var E=f[0],C,L;;){for(var N=E,B=!0;N.v;)if((N=N.n)===E)return;C=N.z,a.lineStart();do{if(N.v=N.o.v=!0,N.e){if(B)for(l=0,x=C.length;l<x;++l)a.point((L=C[l])[0],L[1]);else s(N.x,N.n.x,1,a);N=N.n}else{if(B)for(C=N.p.z,l=C.length-1;l>=0;--l)a.point((L=C[l])[0],L[1]);else s(N.x,N.p.x,-1,a);N=N.p}N=N.o,C=N.z,B=!B}while(!N.v);a.lineEnd()}}}function y_(r){if(e=r.length){for(var e,i=0,s=r[0],a;++i<e;)s.n=a=r[i],a.p=s,s=a;s.n=a=r[0],a.p=s}}function fv(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Iw(r){return r.length===1&&(r=Sw(r)),{left:function(e,i,s,a){for(s==null&&(s=0),a==null&&(a=e.length);s<a;){var f=s+a>>>1;r(e[f],i)<0?s=f+1:a=f}return s},right:function(e,i,s,a){for(s==null&&(s=0),a==null&&(a=e.length);s<a;){var f=s+a>>>1;r(e[f],i)>0?a=f:s=f+1}return s}}}function Sw(r){return function(e,i){return fv(r(e),i)}}Iw(fv);function dv(r){for(var e=r.length,i,s=-1,a=0,f,g;++s<e;)a+=r[s].length;for(f=new Array(a);--e>=0;)for(g=r[e],i=g.length;--i>=0;)f[--a]=g[i];return f}var gh=1e9,wf=-gh;function Ew(r,e,i,s){function a(E,C){return r<=E&&E<=i&&e<=C&&C<=s}function f(E,C,L,N){var B=0,U=0;if(E==null||(B=g(E,L))!==(U=g(C,L))||x(E,C)<0^L>0)do N.point(B===0||B===3?r:i,B>1?s:e);while((B=(B+L+4)%4)!==U);else N.point(C[0],C[1])}function g(E,C){return qr(E[0]-r)<Oi?C>0?0:3:qr(E[0]-i)<Oi?C>0?2:1:qr(E[1]-e)<Oi?C>0?1:0:C>0?3:2}function l(E,C){return x(E.x,C.x)}function x(E,C){var L=g(E,1),N=g(C,1);return L!==N?L-N:L===0?C[1]-E[1]:L===1?E[0]-C[0]:L===2?E[1]-C[1]:C[0]-E[0]}return function(E){var C=E,L=cv(),N,B,U,te,ie,re,J,$,fe,ve,Pe,ue={point:xe,lineStart:ye,lineEnd:ze,polygonStart:Te,polygonEnd:we};function xe(pt,St){a(pt,St)&&C.point(pt,St)}function be(){for(var pt=0,St=0,dt=B.length;St<dt;++St)for(var ut=B[St],Bt=1,vt=ut.length,wt=ut[0],ft,xt,It=wt[0],Jt=wt[1];Bt<vt;++Bt)ft=It,xt=Jt,wt=ut[Bt],It=wt[0],Jt=wt[1],xt<=s?Jt>s&&(It-ft)*(s-xt)>(Jt-xt)*(r-ft)&&++pt:Jt<=s&&(It-ft)*(s-xt)<(Jt-xt)*(r-ft)&&--pt;return pt}function Te(){C=L,N=[],B=[],Pe=!0}function we(){var pt=be(),St=Pe&&pt,dt=(N=dv(N)).length;(St||dt)&&(E.polygonStart(),St&&(E.lineStart(),f(null,null,1,E),E.lineEnd()),dt&&hv(N,l,pt,f,E),E.polygonEnd()),C=E,N=B=U=null}function ye(){ue.point=Be,B&&B.push(U=[]),ve=!0,fe=!1,J=$=NaN}function ze(){N&&(Be(te,ie),re&&fe&&L.rejoin(),N.push(L.result())),ue.point=xe,fe&&C.lineEnd()}function Be(pt,St){var dt=a(pt,St);if(B&&U.push([pt,St]),ve)te=pt,ie=St,re=dt,ve=!1,dt&&(C.lineStart(),C.point(pt,St));else if(dt&&fe)C.point(pt,St);else{var ut=[J=Math.max(wf,Math.min(gh,J)),$=Math.max(wf,Math.min(gh,$))],Bt=[pt=Math.max(wf,Math.min(gh,pt)),St=Math.max(wf,Math.min(gh,St))];kw(ut,Bt,r,e,i,s)?(fe||(C.lineStart(),C.point(ut[0],ut[1])),C.point(Bt[0],Bt[1]),dt||C.lineEnd(),Pe=!1):dt&&(C.lineStart(),C.point(pt,St),Pe=!1)}J=pt,$=St,fe=dt}return ue}}var lp=Il();function Tw(r,e){var i=e[0],s=e[1],a=[ir(i),-nr(i),0],f=0,g=0;lp.reset();for(var l=0,x=r.length;l<x;++l)if(C=(E=r[l]).length)for(var E,C,L=E[C-1],N=L[0],B=L[1]/2+c_,U=ir(B),te=nr(B),ie=0;ie<C;++ie,N=J,U=fe,te=ve,L=re){var re=E[ie],J=re[0],$=re[1]/2+c_,fe=ir($),ve=nr($),Pe=J-N,ue=Pe>=0?1:-1,xe=ue*Pe,be=xe>di,Te=U*fe;if(lp.add(ic(Te*ue*ir(xe),te*ve+Te*nr(xe))),f+=be?Pe+ue*oa:Pe,be^N>=i^J>=i){var we=Uf(rc(L),rc(re));Ep(we);var ye=Uf(a,we);Ep(ye);var ze=(be^Pe>=0?-1:1)*ru(ye[2]);(s>ze||s===ze&&(we[0]||we[1]))&&(g+=be^Pe>=0?1:-1)}}return(f<-Oi||f<Oi&&lp<-Oi)^g&1}Il();function v_(r){return r}Il();Il();var sc=1/0,jf=sc,Ah=-sc,Vf=Ah,b_={point:Cw,lineStart:mh,lineEnd:mh,polygonStart:mh,polygonEnd:mh,result:function(){var r=[[sc,jf],[Ah,Vf]];return Ah=Vf=-(jf=sc=1/0),r}};function Cw(r,e){r<sc&&(sc=r),r>Ah&&(Ah=r),e<jf&&(jf=e),e>Vf&&(Vf=e)}Il();function pv(r,e,i,s){return function(a,f){var g=e(f),l=a.invert(s[0],s[1]),x=cv(),E=e(x),C=!1,L,N,B,U={point:te,lineStart:re,lineEnd:J,polygonStart:function(){U.point=$,U.lineStart=fe,U.lineEnd=ve,N=[],L=[]},polygonEnd:function(){U.point=te,U.lineStart=re,U.lineEnd=J,N=dv(N);var Pe=Tw(L,l);N.length?(C||(f.polygonStart(),C=!0),hv(N,Mw,Pe,i,f)):Pe&&(C||(f.polygonStart(),C=!0),f.lineStart(),i(null,null,1,f),f.lineEnd()),C&&(f.polygonEnd(),C=!1),N=L=null},sphere:function(){f.polygonStart(),f.lineStart(),i(null,null,1,f),f.lineEnd(),f.polygonEnd()}};function te(Pe,ue){var xe=a(Pe,ue);r(Pe=xe[0],ue=xe[1])&&f.point(Pe,ue)}function ie(Pe,ue){var xe=a(Pe,ue);g.point(xe[0],xe[1])}function re(){U.point=ie,g.lineStart()}function J(){U.point=te,g.lineEnd()}function $(Pe,ue){B.push([Pe,ue]);var xe=a(Pe,ue);E.point(xe[0],xe[1])}function fe(){E.lineStart(),B=[]}function ve(){$(B[0][0],B[0][1]),E.lineEnd();var Pe=E.clean(),ue=x.result(),xe,be=ue.length,Te,we,ye;if(B.pop(),L.push(B),B=null,!!be){if(Pe&1){if(we=ue[0],(Te=we.length-1)>0){for(C||(f.polygonStart(),C=!0),f.lineStart(),xe=0;xe<Te;++xe)f.point((ye=we[xe])[0],ye[1]);f.lineEnd()}return}be>1&&Pe&2&&ue.push(ue.pop().concat(ue.shift())),N.push(ue.filter(Lw))}}return U}}function Lw(r){return r.length>1}function Mw(r,e){return((r=r.x)[0]<0?r[1]-sa-Oi:sa-r[1])-((e=e.x)[0]<0?e[1]-sa-Oi:sa-e[1])}const x_=pv(function(){return!0},Aw,Rw,[-di,-sa]);function Aw(r){var e=NaN,i=NaN,s=NaN,a;return{lineStart:function(){r.lineStart(),a=1},point:function(f,g){var l=f>0?di:-di,x=qr(f-e);qr(x-di)<Oi?(r.point(e,i=(i+g)/2>0?sa:-sa),r.point(s,i),r.lineEnd(),r.lineStart(),r.point(l,i),r.point(f,i),a=0):s!==l&&x>=di&&(qr(e-s)<Oi&&(e-=s*Oi),qr(f-l)<Oi&&(f-=l*Oi),i=Pw(e,i,f,g),r.point(s,i),r.lineEnd(),r.lineStart(),r.point(l,i),a=0),r.point(e=f,i=g),s=l},lineEnd:function(){r.lineEnd(),e=i=NaN},clean:function(){return 2-a}}}function Pw(r,e,i,s){var a,f,g=ir(r-i);return qr(g)>Oi?vw((ir(e)*(f=nr(s))*ir(i)-ir(s)*(a=nr(e))*ir(r))/(a*f*g)):(e+s)/2}function Rw(r,e,i,s){var a;if(r==null)a=i*sa,s.point(-di,a),s.point(0,a),s.point(di,a),s.point(di,0),s.point(di,-a),s.point(0,-a),s.point(-di,-a),s.point(-di,0),s.point(-di,a);else if(qr(r[0]-e[0])>Oi){var f=r[0]<e[0]?di:-di;a=i*f/2,s.point(-f,a),s.point(0,a),s.point(f,a)}else s.point(e[0],e[1])}function Dw(r,e){var i=nr(r),s=i>0,a=qr(i)>Oi;function f(C,L,N,B){ww(B,r,e,N,C,L)}function g(C,L){return nr(C)*nr(L)>i}function l(C){var L,N,B,U,te;return{lineStart:function(){U=B=!1,te=1},point:function(ie,re){var J=[ie,re],$,fe=g(ie,re),ve=s?fe?0:E(ie,re):fe?E(ie+(ie<0?di:-di),re):0;if(!L&&(U=B=fe)&&C.lineStart(),fe!==B&&($=x(L,J),(!$||Lf(L,$)||Lf(J,$))&&(J[0]+=Oi,J[1]+=Oi,fe=g(J[0],J[1]))),fe!==B)te=0,fe?(C.lineStart(),$=x(J,L),C.point($[0],$[1])):($=x(L,J),C.point($[0],$[1]),C.lineEnd()),L=$;else if(a&&L&&s^fe){var Pe;!(ve&N)&&(Pe=x(J,L,!0))&&(te=0,s?(C.lineStart(),C.point(Pe[0][0],Pe[0][1]),C.point(Pe[1][0],Pe[1][1]),C.lineEnd()):(C.point(Pe[1][0],Pe[1][1]),C.lineEnd(),C.lineStart(),C.point(Pe[0][0],Pe[0][1])))}fe&&(!L||!Lf(L,J))&&C.point(J[0],J[1]),L=J,B=fe,N=ve},lineEnd:function(){B&&C.lineEnd(),L=null},clean:function(){return te|(U&&B)<<1}}}function x(C,L,N){var B=rc(C),U=rc(L),te=[1,0,0],ie=Uf(B,U),re=vf(ie,ie),J=ie[0],$=re-J*J;if(!$)return!N&&C;var fe=i*re/$,ve=-i*J/$,Pe=Uf(te,ie),ue=bf(te,fe),xe=bf(ie,ve);ap(ue,xe);var be=Pe,Te=vf(ue,be),we=vf(be,be),ye=Te*Te-we*(vf(ue,ue)-1);if(!(ye<0)){var ze=fc(ye),Be=bf(be,(-Te-ze)/we);if(ap(Be,ue),Be=Sp(Be),!N)return Be;var pt=C[0],St=L[0],dt=C[1],ut=L[1],Bt;St<pt&&(Bt=pt,pt=St,St=Bt);var vt=St-pt,wt=qr(vt-di)<Oi,ft=wt||vt<Oi;if(!wt&&ut<dt&&(Bt=dt,dt=ut,ut=Bt),ft?wt?dt+ut>0^Be[1]<(qr(Be[0]-pt)<Oi?dt:ut):dt<=Be[1]&&Be[1]<=ut:vt>di^(pt<=Be[0]&&Be[0]<=St)){var xt=bf(be,(-Te+ze)/we);return ap(xt,ue),[Be,Sp(xt)]}}}function E(C,L){var N=s?r:di-r,B=0;return C<-N?B|=1:C>N&&(B|=2),L<-N?B|=4:L>N&&(B|=8),B}return pv(g,l,f,s?[0,-r]:[-di,r-di])}function mv(r){return function(e){var i=new Cp;for(var s in r)i[s]=r[s];return i.stream=e,i}}function Cp(){}Cp.prototype={constructor:Cp,point:function(r,e){this.stream.point(r,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function gv(r,e,i){var s=e[1][0]-e[0][0],a=e[1][1]-e[0][1],f=r.clipExtent&&r.clipExtent();r.scale(150).translate([0,0]),f!=null&&r.clipExtent(null),bw(i,r.stream(b_));var g=b_.result(),l=Math.min(s/(g[1][0]-g[0][0]),a/(g[1][1]-g[0][1])),x=+e[0][0]+(s-l*(g[1][0]+g[0][0]))/2,E=+e[0][1]+(a-l*(g[1][1]+g[0][1]))/2;return f!=null&&r.clipExtent(f),r.scale(l*150).translate([x,E])}function Nw(r,e,i){return gv(r,[[0,0],e],i)}var w_=16,zw=nr(30*mo);function k_(r,e){return+e?Fw(r,e):Ow(r)}function Ow(r){return mv({point:function(e,i){e=r(e,i),this.stream.point(e[0],e[1])}})}function Fw(r,e){function i(s,a,f,g,l,x,E,C,L,N,B,U,te,ie){var re=E-s,J=C-a,$=re*re+J*J;if($>4*e&&te--){var fe=g+N,ve=l+B,Pe=x+U,ue=fc(fe*fe+ve*ve+Pe*Pe),xe=ru(Pe/=ue),be=qr(qr(Pe)-1)<Oi||qr(f-L)<Oi?(f+L)/2:ic(ve,fe),Te=r(be,xe),we=Te[0],ye=Te[1],ze=we-s,Be=ye-a,pt=J*ze-re*Be;(pt*pt/$>e||qr((re*ze+J*Be)/$-.5)>.3||g*N+l*B+x*U<zw)&&(i(s,a,f,g,l,x,we,ye,be,fe/=ue,ve/=ue,Pe,te,ie),ie.point(we,ye),i(we,ye,be,fe,ve,Pe,E,C,L,N,B,U,te,ie))}}return function(s){var a,f,g,l,x,E,C,L,N,B,U,te,ie={point:re,lineStart:J,lineEnd:fe,polygonStart:function(){s.polygonStart(),ie.lineStart=ve},polygonEnd:function(){s.polygonEnd(),ie.lineStart=J}};function re(xe,be){xe=r(xe,be),s.point(xe[0],xe[1])}function J(){L=NaN,ie.point=$,s.lineStart()}function $(xe,be){var Te=rc([xe,be]),we=r(xe,be);i(L,N,C,B,U,te,L=we[0],N=we[1],C=xe,B=Te[0],U=Te[1],te=Te[2],w_,s),s.point(L,N)}function fe(){ie.point=re,s.lineEnd()}function ve(){J(),ie.point=Pe,ie.lineEnd=ue}function Pe(xe,be){$(a=xe,be),f=L,g=N,l=B,x=U,E=te,ie.point=$}function ue(){i(L,N,C,B,U,te,f,g,a,l,x,E,w_,s),ie.lineEnd=fe,fe()}return ie}}var Bw=mv({point:function(r,e){this.stream.point(r*mo,e*mo)}});function Uw(r){return jw(function(){return r})()}function jw(r){var e,i=150,s=480,a=250,f,g,l=0,x=0,E=0,C=0,L=0,N,B,U=null,te=x_,ie=null,re,J,$,fe=v_,ve=.5,Pe=k_(we,ve),ue,xe;function be(Be){return Be=B(Be[0]*mo,Be[1]*mo),[Be[0]*i+f,g-Be[1]*i]}function Te(Be){return Be=B.invert((Be[0]-f)/i,(g-Be[1])/i),Be&&[Be[0]*pl,Be[1]*pl]}function we(Be,pt){return Be=e(Be,pt),[Be[0]*i+f,g-Be[1]*i]}be.stream=function(Be){return ue&&xe===Be?ue:ue=Bw(te(N,Pe(fe(xe=Be))))},be.clipAngle=function(Be){return arguments.length?(te=+Be?Dw(U=Be*mo,6*mo):(U=null,x_),ze()):U*pl},be.clipExtent=function(Be){return arguments.length?(fe=Be==null?(ie=re=J=$=null,v_):Ew(ie=+Be[0][0],re=+Be[0][1],J=+Be[1][0],$=+Be[1][1]),ze()):ie==null?null:[[ie,re],[J,$]]},be.scale=function(Be){return arguments.length?(i=+Be,ye()):i},be.translate=function(Be){return arguments.length?(s=+Be[0],a=+Be[1],ye()):[s,a]},be.center=function(Be){return arguments.length?(l=Be[0]%360*mo,x=Be[1]%360*mo,ye()):[l*pl,x*pl]},be.rotate=function(Be){return arguments.length?(E=Be[0]%360*mo,C=Be[1]%360*mo,L=Be.length>2?Be[2]%360*mo:0,ye()):[E*pl,C*pl,L*pl]},be.precision=function(Be){return arguments.length?(Pe=k_(we,ve=Be*Be),ze()):fc(ve)},be.fitExtent=function(Be,pt){return gv(be,Be,pt)},be.fitSize=function(Be,pt){return Nw(be,Be,pt)};function ye(){B=uv(N=xw(E,C,L),e);var Be=e(l,x);return f=s-Be[0]*i,g=a+Be[1]*i,ze()}function ze(){return ue=xe=null,be}return function(){return e=r.apply(this,arguments),be.invert=e.invert&&Te,ye()}}function _v(r){return function(e,i){var s=nr(e),a=nr(i),f=r(s*a);return[f*a*ir(e),f*ir(i)]}}function yv(r){return function(e,i){var s=fc(e*e+i*i),a=r(s),f=ir(a),g=nr(a);return[ic(e*f,s*g),ru(s&&i*f/s)]}}var Vw=_v(function(r){return fc(2/(1+r))});Vw.invert=yv(function(r){return 2*ru(r/2)});var vv=_v(function(r){return(r=lv(r))&&r/ir(r)});vv.invert=yv(function(r){return r});function qw(){return Uw(vv).scale(79.4188).clipAngle(180-.001)}function I_(r,e){return[r,e]}I_.invert=I_;var{BufferOp:Gw,GeoJSONReader:Zw,GeoJSONWriter:Hw}=yw;function Ww(r,e,i){i=i||{};var s=i.units||"kilometers",a=i.steps||8;if(!r)throw new Error("geojson is required");if(typeof i!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var f=[];switch(r.type){case"GeometryCollection":return id(r,function(g){var l=Mf(g,e,s,a);l&&f.push(l)}),iu(f);case"FeatureCollection":return l_(r,function(g){var l=Mf(g,e,s,a);l&&l_(l,function(x){x&&f.push(x)})}),iu(f)}return Mf(r,e,s,a)}function Mf(r,e,i,s){var a=r.properties||{},f=r.type==="Feature"?r.geometry:r;if(f.type==="GeometryCollection"){var g=[];return id(r,function(te){var ie=Mf(te,e,i,s);ie&&g.push(ie)}),iu(g)}var l=Xw(f),x={type:f.type,coordinates:xv(f.coordinates,l)},E=new Zw,C=E.read(x),L=Nx(zx(e,i),"meters"),N=Gw.bufferOp(C,L,s),B=new Hw;if(N=B.write(N),!bv(N.coordinates)){var U={type:N.type,coordinates:wv(N.coordinates,l)};return zh(U,a)}}function bv(r){return Array.isArray(r[0])?bv(r[0]):isNaN(r[0])}function xv(r,e){return typeof r[0]!="object"?e(r):r.map(function(i){return xv(i,e)})}function wv(r,e){return typeof r[0]!="object"?e.invert(r):r.map(function(i){return wv(i,e)})}function Xw(r){var e=pw(r).geometry.coordinates,i=[-e[0],-e[1]];return qw().rotate(i).scale(Us)}var $w=Ww;function Yw(r){const e=[];if(id(r,a=>{e.push(a.coordinates)}),e.length<2)throw new Error("Must have at least two features");const i=r.features[0].properties||{},s=sv.difference(e[0],...e.slice(1));return s.length===0?null:s.length===1?qp(s[0],i):iv(s,i)}var Jw=Yw;function S_(r){let e;for(const i of r)e&&i[0]-e[0]>=180?i[0]-=360:e&&i[0]-e[0]<-180&&(i[0]+=360),e=i}function E_(r,e){const i=Jw(iu([qp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!i)return;i.properties={isMask:"y"};const s=$w(r,0);if(s){if(s.geometry.type==="Polygon")for(const a of s.geometry.coordinates)S_(a);else for(const a of s.geometry.coordinates)for(const f of a)S_(f);e(iu([s,i]))}}const T_=iu([]);function Kw(r,e,i=!0,s=!0,a={},f={},g={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let l;const x=[];let E,C,L;function N(){!r.getSource("full-geom")&&(g!=null&&g.fill||g!=null&&g.line)&&r.addSource("full-geom",{type:"geojson",data:T_}),!r.getLayer("full-geom-fill")&&g!=null&&g.fill&&r.addLayer({...g==null?void 0:g.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),!r.getLayer("full-geom-line")&&g!=null&&g.line&&r.addLayer({...g==null?void 0:g.line,id:"full-geom-line",type:"line",source:"full-geom"}),L&&te(L)}r.loaded()?N():r.once("load",()=>{N()}),r.on("styledata",()=>{N()});const B=ie=>{l==null||l({type:"mapClick",coordinates:[ie.lngLat.lng,ie.lngLat.lat]})};function U(ie=!1){if(!e)throw new Error;const re=document.createElement("div");return ie&&re.classList.add("marker-interactive"),new Tx({props:{displayIn:"maplibre"},target:re}),new e.Marker({element:re,offset:[1,-13]})}function te(ie){var re;L=ie,(re=r.getSource("full-geom"))==null||re.setData(ie)}return{setEventHandler(ie){ie?(l=ie,r.on("click",B)):(l=void 0,r.off("click",B))},flyTo(ie,re){r.flyTo({center:ie,zoom:re,...a})},fitBounds(ie,re,J){r.fitBounds([[ie[0],ie[1]],[ie[2],ie[3]]],{padding:re,maxZoom:J,...f})},indicateReverse(ie){r.getCanvasContainer().style.cursor=ie?"crosshair":""},setReverseMarker(ie){!e||!i||(C?ie?C.setLngLat(ie):(C.remove(),C=void 0):ie&&(C=(typeof i=="object"?new e.Marker(i):U()).setLngLat(ie).addTo(r),C.getElement().classList.add("marker-reverse")))},setMarkers(ie,re){if(i){for(const J of x)J.remove();if(x.length=0,te(T_),!!e){if(re){let J=!1;if(re.geometry.type==="GeometryCollection"){const $=re.geometry.geometries.filter(fe=>fe.type==="Polygon"||fe.type==="MultiPolygon");e:if($.length>0){const fe=fw(iu($.map(ve=>zh(ve))));if(!fe)break e;E_({...re,geometry:fe.geometry},te),J=!0}else{const fe=re.geometry.geometries.filter(ve=>ve.type==="LineString"||ve.type==="MultiLineString");fe.length>0&&(te({...re,geometry:{type:"GeometryCollection",geometries:fe}}),J=!0)}}if(!J){if(re.geometry.type==="Polygon"||re.geometry.type==="MultiPolygon")E_(re,te);else if(re.geometry.type==="LineString"||re.geometry.type==="MultiLineString"){te(re);return}}i&&x.push((typeof i=="object"?new e.Marker(i):U()).setLngLat(re.center).addTo(r))}if(s)for(const J of ie??[]){if(J===re)continue;const $=(typeof s=="object"?new e.Marker(s):U(!0)).setLngLat(J.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(J.place_type[0]==="reverse"?J.place_name:J.place_name.replace(/,.*/,""))).addTo(r),fe=$.getElement();fe.addEventListener("click",ve=>{ve.stopPropagation(),l==null||l({type:"markerClick",id:J.id})}),fe.addEventListener("mouseenter",()=>{l==null||l({type:"markerMouseEnter",id:J.id}),$.togglePopup()}),fe.addEventListener("mouseleave",()=>{l==null||l({type:"markerMouseLeave",id:J.id}),$.togglePopup()}),x.push($)}}}},setSelectedMarker(ie){E&&E.getElement().classList.toggle("marker-selected",!1),E=ie>-1?x[ie]:void 0,E==null||E.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const ie=r.getCenter();return[r.getZoom(),ie.lng,ie.lat]}}}function Qw(r){let e,i;return{c(){e=Da("svg"),i=Da("path"),He(i,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),He(e,"viewBox","0 0 14 14"),He(e,"width","13"),He(e,"height","13"),He(e,"class","svelte-en2qvf")},m(s,a){ae(s,e,a),Z(e,i)},p:nt,i:nt,o:nt,d(s){s&&oe(e)}}}class kv extends fn{constructor(e){super(),hn(this,e,null,Qw,un,{})}}function e2(r){let e,i;return{c(){e=Da("svg"),i=Da("path"),He(i,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),He(e,"viewBox","0 0 30 30"),He(e,"fill","none"),He(e,"xmlns","http://www.w3.org/2000/svg"),He(e,"class","svelte-d2loi5")},m(s,a){ae(s,e,a),Z(e,i)},p:nt,i:nt,o:nt,d(s){s&&oe(e)}}}class Iv extends fn{constructor(e){super(),hn(this,e,null,e2,un,{})}}function t2(r){let e,i;return{c(){e=ce("img"),ms(e.src,i=r[3]+"area.svg")||He(e,"src",i),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,i=s[3]+"area.svg")&&He(e,"src",i),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function n2(r){let e,i;return{c(){e=ce("img"),ms(e.src,i=r[3]+"reverse.svg")||He(e,"src",i),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,i=s[3]+"reverse.svg")&&He(e,"src",i),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function i2(r){let e,i;return{c(){e=ce("img"),ms(e.src,i=r[3]+"poi.svg")||He(e,"src",i),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,i=s[3]+"poi.svg")&&He(e,"src",i),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function r2(r){let e,i;return{c(){e=ce("img"),ms(e.src,i=r[3]+"postal_code.svg")||He(e,"src",i),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,i=s[3]+"postal_code.svg")&&He(e,"src",i),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function s2(r){let e,i;return{c(){e=ce("img"),ms(e.src,i=r[3]+"street.svg")||He(e,"src",i),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,i=s[3]+"street.svg")&&He(e,"src",i),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function o2(r){let e,i;return{c(){e=ce("img"),ms(e.src,i=r[3]+"road.svg")||He(e,"src",i),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,i=s[3]+"road.svg")&&He(e,"src",i),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function a2(r){let e,i;return{c(){e=ce("img"),ms(e.src,i=r[3]+"housenumber.svg")||He(e,"src",i),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,i=s[3]+"housenumber.svg")&&He(e,"src",i),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function l2(r){let e,i,s,a;return{c(){e=ce("img"),ms(e.src,i=r[5])||He(e,"src",i),He(e,"alt",r[4]),He(e,"class","svelte-ltkwvy")},m(f,g){ae(f,e,g),s||(a=Pt(e,"error",r[14]),s=!0)},p(f,g){g&32&&!ms(e.src,i=f[5])&&He(e,"src",i),g&16&&He(e,"alt",f[4])},d(f){f&&oe(e),s=!1,a()}}}function C_(r){let e,i;return{c(){e=ce("span"),i=Fe(r[6]),He(e,"class","secondary svelte-ltkwvy")},m(s,a){ae(s,e,a),Z(e,i)},p(s,a){a&64&&Mt(i,s[6])},d(s){s&&oe(e)}}}function u2(r){var ue,xe;let e,i,s,a,f,g,l,x,E=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",C,L,N=r[2]==="always"||r[2]&&!r[0].address&&((ue=r[0].properties)==null?void 0:ue.kind)!=="road"&&((xe=r[0].properties)==null?void 0:xe.kind)!=="road_relation"&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],B,U,te=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",ie,re,J;function $(be,Te){var we,ye;return Te&1&&(i=null),Te&1&&(s=null),Te&1&&(a=null),be[5]?l2:be[0].address?a2:((we=be[0].properties)==null?void 0:we.kind)==="road"||((ye=be[0].properties)==null?void 0:ye.kind)==="road_relation"?o2:(i==null&&(i=!!be[0].id.startsWith("address.")),i?s2:(s==null&&(s=!!be[0].id.startsWith("postal_code.")),s?r2:(a==null&&(a=!!be[0].id.startsWith("poi.")),a?i2:be[7]?n2:t2)))}let fe=$(r,-1),ve=fe(r),Pe=N&&C_(r);return{c(){e=ce("li"),ve.c(),f=je(),g=ce("span"),l=ce("span"),x=ce("span"),C=Fe(E),L=je(),Pe&&Pe.c(),B=je(),U=ce("span"),ie=Fe(te),He(x,"class","primary svelte-ltkwvy"),He(l,"class","svelte-ltkwvy"),He(U,"class","line2 svelte-ltkwvy"),He(g,"class","texts svelte-ltkwvy"),He(e,"tabindex","0"),He(e,"data-selected",r[1]),He(e,"class","svelte-ltkwvy"),Vr(e,"selected",r[1])},m(be,Te){ae(be,e,Te),ve.m(e,null),Z(e,f),Z(e,g),Z(g,l),Z(l,x),Z(x,C),Z(l,L),Pe&&Pe.m(l,null),Z(g,B),Z(g,U),Z(U,ie),re||(J=[Pt(e,"mouseenter",r[12]),Pt(e,"focus",r[13])],re=!0)},p(be,[Te]){var we,ye;fe===(fe=$(be,Te))&&ve?ve.p(be,Te):(ve.d(1),ve=fe(be),ve&&(ve.c(),ve.m(e,f))),Te&1&&E!==(E=(be[7]?be[0].place_name:be[0].place_name.replace(/,.*/,""))+"")&&Mt(C,E),Te&37&&(N=be[2]==="always"||be[2]&&!be[0].address&&((we=be[0].properties)==null?void 0:we.kind)!=="road"&&((ye=be[0].properties)==null?void 0:ye.kind)!=="road_relation"&&!be[0].id.startsWith("address.")&&!be[0].id.startsWith("postal_code.")&&(!be[0].id.startsWith("poi.")||!be[5])&&!be[7]),N?Pe?Pe.p(be,Te):(Pe=C_(be),Pe.c(),Pe.m(l,null)):Pe&&(Pe.d(1),Pe=null),Te&1&&te!==(te=(be[7]?"":be[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Mt(ie,te),Te&2&&He(e,"data-selected",be[1]),Te&2&&Vr(e,"selected",be[1])},i:nt,o:nt,d(be){be&&oe(e),ve.d(),Pe&&Pe.d(),re=!1,$i(J)}}}function c2(r,e,i){var $;let s,a,{feature:f}=e,{selected:g=!1}=e,{showPlaceType:l}=e,{missingIconsCache:x}=e,{iconsBaseUrl:E}=e;const C=($=f.properties)==null?void 0:$.categories;let L,N,B=0,U=f.place_type[0]==="reverse";function te(){N&&x.add(N),i(10,B++,B)}function ie(fe){ur.call(this,r,fe)}function re(fe){ur.call(this,r,fe)}const J=()=>te();return r.$$set=fe=>{"feature"in fe&&i(0,f=fe.feature),"selected"in fe&&i(1,g=fe.selected),"showPlaceType"in fe&&i(2,l=fe.showPlaceType),"missingIconsCache"in fe&&i(9,x=fe.missingIconsCache),"iconsBaseUrl"in fe&&i(3,E=fe.iconsBaseUrl)},r.$$.update=()=>{var fe,ve,Pe,ue;if(r.$$.dirty&3640)do i(11,s--,s),i(4,L=C==null?void 0:C[s]),i(5,N=L?E+L.replace(/ /g,"_")+".svg":void 0);while(s>-1&&(!N||x.has(N)));r.$$.dirty&1&&i(6,a=f.id.startsWith("poi.")?(ve=(fe=f.properties)==null?void 0:fe.categories)==null?void 0:ve.join(", "):((ue=(Pe=f.properties)==null?void 0:Pe.place_type_name)==null?void 0:ue[0])??f.place_type[0])},i(11,s=(C==null?void 0:C.length)??0),[f,g,l,E,L,N,a,U,te,x,B,s,ie,re,J]}class h2 extends fn{constructor(e){super(),hn(this,e,c2,u2,un,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function f2(r){let e;return{c(){e=ce("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',He(e,"class","svelte-7cmwmc")},m(i,s){ae(i,e,s)},p:nt,i:nt,o:nt,d(i){i&&oe(e)}}}class d2 extends fn{constructor(e){super(),hn(this,e,null,f2,un,{})}}function p2(r){let e,i;return{c(){e=Da("svg"),i=Da("path"),He(i,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),He(e,"viewBox","0 0 60.006 21.412"),He(e,"width","14"),He(e,"height","20"),He(e,"class","svelte-en2qvf")},m(s,a){ae(s,e,a),Z(e,i)},p:nt,i:nt,o:nt,d(s){s&&oe(e)}}}class m2 extends fn{constructor(e){super(),hn(this,e,null,p2,un,{})}}function g2(r){let e,i,s;return{c(){e=Da("svg"),i=Da("circle"),s=Da("path"),He(i,"cx","4.789"),He(i,"cy","4.787"),He(i,"r","3.85"),He(i,"class","svelte-1aq105l"),He(s,"d","M12.063 12.063 7.635 7.635"),He(s,"class","svelte-1aq105l"),He(e,"xmlns","http://www.w3.org/2000/svg"),He(e,"width","13"),He(e,"height","13"),He(e,"viewBox","0 0 13 13"),He(e,"class","svelte-1aq105l")},m(a,f){ae(a,e,f),Z(e,i),Z(e,s)},p:nt,i:nt,o:nt,d(a){a&&oe(e)}}}class _2 extends fn{constructor(e){super(),hn(this,e,null,g2,un,{})}}function y2(r,e,i){const s=e[1],a=e[0],f=s-a;return r===s&&i?r:((r-a)%f+f)%f+a}function L_(r){const e=[...r];return e[2]<e[0]&&(e[2]+=360),e}let ch;async function v2(r,e,i){const s=r==null?void 0:r.getCenterAndZoom();for(const a of e??[])if(!(s&&(a.minZoom!=null&&a.minZoom>s[0]||a.maxZoom!=null&&a.maxZoom<s[0]))){if(a.type==="fixed")return a.coordinates.join(",");e:if(a.type==="client-geolocation"){if(ch&&a.cachedLocationExpiry&&ch.time+a.cachedLocationExpiry>Date.now()){if(!ch.coords)break e;return ch.coords}let f;try{return f=await new Promise((g,l)=>{i.signal.addEventListener("abort",()=>{l(Error("aborted"))}),navigator.geolocation.getCurrentPosition(x=>{g([x.coords.longitude,x.coords.latitude].map(E=>E.toFixed(6)).join(","))},x=>{l(x)},a)}),f}catch{}finally{a.cachedLocationExpiry&&(ch={time:Date.now(),coords:f})}if(i.signal.aborted)return}if(a.type==="server-geolocation")return"ip";if(s&&a.type==="map-center")return s[1].toFixed(6)+","+s[2].toFixed(6)}}const b2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,M_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,A_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,P_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,R_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,D_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function x2(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(B=>Number(B.trim())),i=Number(e[0]),s=Number(e[1]),a=Math.abs(i),f=Math.abs(s),g=i>0?"N":"S",l=s>0?"E":"W";let x;r=="DD"&&(x=`${a} ${g}, ${f} ${l}`);const E=Math.floor(a),C=Math.floor(f),L=(a-E)*60,N=(f-C)*60;if(r=="DM"){let B=N_(L,3).toFixed(3).padStart(6,"0"),U=N_(N,3).toFixed(3).padStart(6,"0");B.endsWith(".000")&&U.endsWith(".000")&&(B=B.replace(/\.000$/,""),U=U.replace(/\.000$/,"")),x=`${E} ${B}' ${g}, ${C} ${U}' ${l}`}if(r=="DMS"){const B=Math.floor(L),U=Math.floor(N);let te=((L-B)*60).toFixed(1).padStart(4,"0"),ie=((N-U)*60).toFixed(1).padStart(4,"0");const re=B.toString().padStart(2,"0"),J=U.toString().padStart(2,"0");te.endsWith(".0")&&ie.endsWith(".0")&&(te=te.replace(/\.0$/,""),ie=ie.replace(/\.0$/,"")),x=`${E} ${re}' ${te}" ${g}, ${C} ${J}' ${ie}" ${l}`}return x}else throw new Error("no decimal coordinates to convert")}function N_(r,e){const i=Math.pow(10,e);return Math.round((r+Number.EPSILON)*i)/i}function Zp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let i=null,s=null,a="",f="",g=null,l=[],x=!1;if(b2.test(r))throw new Error("invalid coordinate value");if(M_.test(r))if(l=M_.exec(r),x=hh(l),x)i=Math.abs(l[1])+l[2]/60,Number(l[1])<0&&(i*=-1),s=Math.abs(l[3])+l[4]/60,Number(l[3])<0&&(s*=-1),g="DM";else throw new Error("invalid coordinate format");else if(A_.test(r))if(l=A_.exec(r),x=hh(l),x){if(i=l[2],s=l[6],i.includes(",")&&(i=i.replace(",",".")),s.includes(",")&&(s=s.replace(",",".")),g="DD",Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");if(Number(Math.round(s))==Number(s))throw new Error("integer only coordinate provided");l[1]?(a=l[1],f=l[5]):l[4]&&(a=l[4],f=l[8])}else throw new Error("invalid decimal coordinate format");else if(P_.test(r))if(l=P_.exec(r),x=hh(l),x)i=Math.abs(parseInt(l[2])),l[4]&&(i+=l[4]/60,g="DM"),l[6]&&(i+=l[6].replace(",",".")/3600,g="DMS"),parseInt(l[2])<0&&(i=-1*i),s=Math.abs(parseInt(l[9])),l[11]&&(s+=l[11]/60),l[13]&&(s+=l[13].replace(",",".")/3600),parseInt(l[9])<0&&(s=-1*s),l[1]?(a=l[1],f=l[8]):l[7]&&(a=l[7],f=l[14]);else throw new Error("invalid DMS coordinates format");else if(R_.test(r))if(l=R_.exec(r),x=hh(l),x)i=Math.abs(parseInt(l[2])),l[4]&&(i+=l[4]/60,g="DM"),l[6]&&(i+=l[6]/3600,g="DMS"),parseInt(l[2])<0&&(i=-1*i),s=Math.abs(parseInt(l[10])),l[12]&&(s+=l[12]/60),l[14]&&(s+=l[14]/3600),parseInt(l[10])<0&&(s=-1*s),l[1]?(a=l[1],f=l[9]):l[8]&&(a=l[8],f=l[16]);else throw new Error("invalid DMS coordinates format");else if(D_.test(r)){if(l=D_.exec(r),x=hh(l),l.filter(E=>E).length<=5)throw new Error("invalid coordinates format");if(x)i=Math.abs(parseInt(l[2])),l[4]&&(i+=l[4].replace(",",".")/60,g="DM"),l[6]&&(i+=l[6].replace(",",".")/3600,g="DMS"),parseInt(l[2])<0&&(i=-1*i),s=Math.abs(parseInt(l[10])),l[12]&&(s+=l[12].replace(",",".")/60),l[14]&&(s+=l[14].replace(",",".")/3600),parseInt(l[10])<0&&(s=-1*s),l[1]?(a=l[1],f=l[9]):l[8]&&(a=l[8],f=l[16]);else throw new Error("invalid coordinates format")}if(x){if(Math.abs(s)>=180)throw new Error("invalid longitude value");if(Math.abs(i)>=90)throw new Error("invalid latitude value");if(a&&!f||!a&&f)throw new Error("invalid coordinates value");if(a&&a==f)throw new Error("invalid coordinates format");i.toString().includes(",")&&(i=i.replace(",",".")),s.toString().includes(",")&&(s=s.replace(",","."));let E=/S|SOUTH/i;E.test(a)&&i>0&&(i=-1*i),E=/W|WEST/i,E.test(f)&&s>0&&(s=-1*s);const C=l[0].trim();let L,N;const B=/[,/;\u0020]/g,U=C.match(B);if(U==null){const re=Math.floor(r.length/2);L=C.substring(0,re).trim(),N=C.substring(re).trim()}else{let re;U.length%2==1?re=Math.floor(U.length/2):re=U.length/2-1;let J=0;if(re==0)J=C.indexOf(U[0]),L=C.substring(0,J).trim(),N=C.substring(J+1).trim();else{let $=0,fe=0;for(;$<=re;)J=C.indexOf(U[$],fe),fe=J+1,$++;L=C.substring(0,J).trim(),N=C.substring(J+1).trim()}}const te=L.split(".");if(te.length==2&&te[1]==0&&te[1].length!=2)throw new Error("invalid coordinates format");const ie=N.split(".");if(ie.length==2&&ie[1]==0&&ie[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(L)||/^\d+$/.test(N))throw new Error("degree only coordinate/s provided");return i=Number(Number(i).toFixed(e)),s=Number(Number(s).toFixed(e)),Object.freeze({verbatimCoordinates:C,verbatimLatitude:L,verbatimLongitude:N,decimalLatitude:i,decimalLongitude:s,decimalCoordinates:`${i},${s}`,originalFormat:g,closeEnough:w2,toCoordinateFormat:x2})}else throw new Error("coordinates pattern match failed")}function hh(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const i=/^[-+]?\d+([\.,]\d+)?$/,s=/[eastsouthnorthwest]+/i,a=e.length/2;for(let f=0;f<a;f++){const g=e[f],l=e[f+a],x=i.test(g)&&i.test(l),E=s.test(g)&&s.test(l),C=g==l;if(!(g==null&&l==null)){if(g==null||l==null)return!1;if(x||E||C)continue;return!1}}return!0}function z_(r,e){const i=Math.abs(r-e);return Number(i.toFixed(6))<=1e-5}function w2(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return z_(this.decimalLatitude,Number(e[0]))&&z_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const k2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Zp.to=k2;const I2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],S2={decimalLatitude:40.123,decimalLongitude:-74.123},E2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],T2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function C2(){const r=[];return I2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...S2})}),[...r,...E2,...T2]}const L2=C2();Zp.formats=L2.map(r=>r.verbatimCoordinates);const M2=Zp;function O_(r,e,i){const s=r.slice();return s[81]=e[i],s[83]=i,s}function F_(r){let e,i;return e=new d2({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function B_(r){let e,i,s,a,f;return i=new m2({}),{c(){e=ce("button"),ot(i.$$.fragment),He(e,"type","button"),He(e,"title",r[9]),He(e,"class","svelte-zh3kmv"),Vr(e,"active",r[0])},m(g,l){ae(g,e,l),rt(i,e,null),s=!0,a||(f=Pt(e,"click",r[67]),a=!0)},p(g,l){(!s||l[0]&512)&&He(e,"title",g[9]),(!s||l[0]&1)&&Vr(e,"active",g[0])},i(g){s||(_e(i.$$.fragment,g),s=!0)},o(g){Ie(i.$$.fragment,g),s=!1},d(g){g&&oe(e),st(i),a=!1,f()}}}function A2(r){let e,i=[],s=new Map,a,f,g,l=Hn(r[14]);const x=E=>E[81].id+(E[81].address?","+E[81].address:"");for(let E=0;E<l.length;E+=1){let C=O_(r,l,E),L=x(C);s.set(L,i[E]=U_(L,C))}return{c(){e=ce("ul");for(let E=0;E<i.length;E+=1)i[E].c();He(e,"class","svelte-zh3kmv")},m(E,C){ae(E,e,C);for(let L=0;L<i.length;L+=1)i[L]&&i[L].m(e,null);a=!0,f||(g=[Pt(e,"mouseleave",r[71]),Pt(e,"blur",r[72])],f=!0)},p(E,C){C[0]&17880064&&(l=Hn(E[14]),Nn(),i=ex(i,C,x,1,E,l,s,e,Qb,U_,null,O_),zn())},i(E){if(!a){for(let C=0;C<l.length;C+=1)_e(i[C]);a=!0}},o(E){for(let C=0;C<i.length;C+=1)Ie(i[C]);a=!1},d(E){E&&oe(e);for(let C=0;C<i.length;C+=1)i[C].d();f=!1,$i(g)}}}function P2(r){let e,i,s,a,f,g;return i=new Iv({}),{c(){e=ce("div"),ot(i.$$.fragment),s=je(),a=ce("div"),f=Fe(r[7]),He(a,"class","svelte-zh3kmv"),He(e,"class","no-results svelte-zh3kmv")},m(l,x){ae(l,e,x),rt(i,e,null),Z(e,s),Z(e,a),Z(a,f),g=!0},p(l,x){(!g||x[0]&128)&&Mt(f,l[7])},i(l){g||(_e(i.$$.fragment,l),g=!0)},o(l){Ie(i.$$.fragment,l),g=!1},d(l){l&&oe(e),st(i)}}}function R2(r){let e="",i;return{c(){i=Fe(e)},m(s,a){ae(s,i,a)},p:nt,i:nt,o:nt,d(s){s&&oe(i)}}}function D2(r){let e,i,s,a,f,g,l,x,E,C,L;return i=new Iv({}),x=new kv({}),{c(){e=ce("div"),ot(i.$$.fragment),s=je(),a=ce("div"),f=Fe(r[6]),g=je(),l=ce("button"),ot(x.$$.fragment),He(a,"class","svelte-zh3kmv"),He(l,"class","svelte-zh3kmv"),He(e,"class","error svelte-zh3kmv")},m(N,B){ae(N,e,B),rt(i,e,null),Z(e,s),Z(e,a),Z(a,f),Z(e,g),Z(e,l),rt(x,l,null),E=!0,C||(L=Pt(l,"click",r[68]),C=!0)},p(N,B){(!E||B[0]&64)&&Mt(f,N[6])},i(N){E||(_e(i.$$.fragment,N),_e(x.$$.fragment,N),E=!0)},o(N){Ie(i.$$.fragment,N),Ie(x.$$.fragment,N),E=!1},d(N){N&&oe(e),st(i),st(x),C=!1,L()}}}function U_(r,e){let i,s,a;function f(){return e[69](e[83])}function g(){return e[70](e[81])}return s=new h2({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),s.$on("mouseenter",f),s.$on("focus",g),{key:r,first:null,c(){i=ai(),ot(s.$$.fragment),this.first=i},m(l,x){ae(l,i,x),rt(s,l,x),a=!0},p(l,x){e=l;const E={};x[0]&16384&&(E.feature=e[81]),x[0]&1024&&(E.showPlaceType=e[10]),x[0]&49152&&(E.selected=e[15]===e[83]),x[0]&4096&&(E.iconsBaseUrl=e[12]),s.$set(E)},i(l){a||(_e(s.$$.fragment,l),a=!0)},o(l){Ie(s.$$.fragment,l),a=!1},d(l){l&&oe(i),st(s,l)}}}function N2(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re,J,$,fe,ve,Pe=!1;f=new _2({}),L=new kv({});let ue=r[19]&&F_(),xe=r[5]===!0&&B_(r);const be=r[59].default,Te=Zi(be,r,r[58],null),we=[D2,R2,P2,A2],ye=[];function ze(Be,pt){var St,dt;return Be[18]?0:Be[16]?((St=Be[14])==null?void 0:St.length)===0?2:Be[16]&&((dt=Be[14])!=null&&dt.length)?3:-1:1}return~(ie=ze(r))&&(re=ye[ie]=we[ie](r)),{c(){e=je(),i=ce("form"),s=ce("div"),a=ce("button"),ot(f.$$.fragment),g=je(),l=ce("input"),x=je(),E=ce("div"),C=ce("button"),ot(L.$$.fragment),N=je(),ue&&ue.c(),B=je(),xe&&xe.c(),U=je(),Te&&Te.c(),te=je(),re&&re.c(),He(a,"class","search-button svelte-zh3kmv"),He(a,"type","button"),He(l,"placeholder",r[8]),He(l,"aria-label",r[8]),He(l,"class","svelte-zh3kmv"),He(C,"type","button"),He(C,"title",r[3]),He(C,"class","svelte-zh3kmv"),He(E,"class","clear-button-container svelte-zh3kmv"),Vr(E,"displayable",r[1]!==""),He(s,"class","input-group svelte-zh3kmv"),He(i,"tabindex","0"),He(i,"class",J=Nf(r[2])+" svelte-zh3kmv"),Vr(i,"can-collapse",r[4]&&r[1]==="")},m(Be,pt){ae(Be,e,pt),ae(Be,i,pt),Z(i,s),Z(s,a),rt(f,a,null),Z(s,g),Z(s,l),r[61](l),zi(l,r[1]),Z(s,x),Z(s,E),Z(E,C),rt(L,C,null),Z(E,N),ue&&ue.m(E,null),Z(s,B),xe&&xe.m(s,null),Z(s,U),Te&&Te.m(s,null),Z(i,te),~ie&&ye[ie].m(i,null),$=!0,fe||(ve=[Pt(a,"click",r[60]),Pt(l,"input",r[62]),Pt(l,"focus",r[63]),Pt(l,"blur",r[64]),Pt(l,"keydown",r[22]),Pt(l,"input",r[65]),Pt(C,"click",r[66]),Pt(i,"submit",Nh(r[21]))],fe=!0)},p(Be,pt){(!$||pt[0]&256)&&He(l,"placeholder",Be[8]),(!$||pt[0]&256)&&He(l,"aria-label",Be[8]),pt[0]&2&&l.value!==Be[1]&&zi(l,Be[1]),(!$||pt[0]&8)&&He(C,"title",Be[3]),Be[19]?ue?pt[0]&524288&&_e(ue,1):(ue=F_(),ue.c(),_e(ue,1),ue.m(E,null)):ue&&(Nn(),Ie(ue,1,1,()=>{ue=null}),zn()),(!$||pt[0]&2)&&Vr(E,"displayable",Be[1]!==""),Be[5]===!0?xe?(xe.p(Be,pt),pt[0]&32&&_e(xe,1)):(xe=B_(Be),xe.c(),_e(xe,1),xe.m(s,U)):xe&&(Nn(),Ie(xe,1,1,()=>{xe=null}),zn()),Te&&Te.p&&(!$||pt[1]&134217728)&&Wi(Te,be,Be,Be[58],$?Hi(be,Be[58],pt,null):Xi(Be[58]),null);let St=ie;ie=ze(Be),ie===St?~ie&&ye[ie].p(Be,pt):(re&&(Nn(),Ie(ye[St],1,1,()=>{ye[St]=null}),zn()),~ie?(re=ye[ie],re?re.p(Be,pt):(re=ye[ie]=we[ie](Be),re.c()),_e(re,1),re.m(i,null)):re=null),(!$||pt[0]&4&&J!==(J=Nf(Be[2])+" svelte-zh3kmv"))&&He(i,"class",J),(!$||pt[0]&22)&&Vr(i,"can-collapse",Be[4]&&Be[1]==="")},i(Be){$||(_e(Pe),_e(f.$$.fragment,Be),_e(L.$$.fragment,Be),_e(ue),_e(xe),_e(Te,Be),_e(re),$=!0)},o(Be){Ie(Pe),Ie(f.$$.fragment,Be),Ie(L.$$.fragment,Be),Ie(ue),Ie(xe),Ie(Te,Be),Ie(re),$=!1},d(Be){Be&&(oe(e),oe(i)),st(f),r[61](null),st(L),ue&&ue.d(),xe&&xe.d(),Te&&Te.d(Be),~ie&&ye[ie].d(),fe=!1,$i(ve)}}}function z2(r,e,i){let s,{$$slots:a={},$$scope:f}=e,{class:g=void 0}=e,{apiKey:l}=e,{bbox:x=void 0}=e,{clearButtonTitle:E="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:L=!1}=e,{country:N=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:U=!1}=e,{errorMessage:te="Something went wrong"}=e,{filter:ie=()=>!0}=e,{flyTo:re=!0}=e,{fuzzyMatch:J=!0}=e,{language:$=void 0}=e,{limit:fe=void 0}=e,{mapController:ve=void 0}=e,{minLength:Pe=2}=e,{noResultsMessage:ue="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:xe="Search"}=e,{proximity:be=[{type:"server-geolocation"}]}=e,{reverseActive:Te=U==="always"}=e,{reverseButtonTitle:we="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{showFullGeometry:ze=!0}=e,{showPlaceType:Be="ifNeeded"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:St=!0}=e,{flyToSelected:dt=!1}=e,{markerOnSelected:ut=!0}=e,{types:Bt=void 0}=e,{excludeTypes:vt=!1}=e,{zoom:wt=16}=e,{maxZoom:ft=18}=e,{apiUrl:xt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:It={}}=e,{iconsBaseUrl:Jt="https://cdn.maptiler.com/maptiler-geocoding-control/v1.3.3/icons/"}=e,{adjustUrlQuery:pn=()=>{}}=e;function Rn(){kt.focus()}function Xe(){kt.blur()}function Wn(de,Ve=!0,We=!1){i(1,ye=de),Ve?(i(15,Vt=-1),Jr()):(At(!We,We),setTimeout(()=>{kt.focus(),kt.select()}))}function dn(){i(14,lt=void 0),i(55,Lt=void 0),i(15,Vt=-1)}function Ft(){i(54,Je=[]),i(55,Lt=void 0)}let Se=!1,lt,Je,Lt,Ye="",kt,Vt=-1,Ee,Gt=[],_n,Kn,Yi,xn;const qi=new Set,Ji=hc();vo(()=>{ve&&(ve.setEventHandler(void 0),ve.indicateReverse(!1),ve.setSelectedMarker(-1),ve.setMarkers(void 0,void 0))});function Jr(de){if(Kn&&(clearTimeout(Kn),Kn=void 0),Vt>-1&&lt)i(55,Lt=lt[Vt]),i(1,ye=Lt.place_type[0]==="reverse"?Lt.place_name:Lt.place_name.replace(/,.*/,"")),i(18,Ee=void 0),i(54,Je=void 0),i(15,Vt=-1);else if(ye){const Ve=de||!ct(ye);gr(ye,{exact:!0}).then(()=>{i(54,Je=lt),i(55,Lt=void 0),Ve&&kn()}).catch(We=>i(18,Ee=We))}}function ct(de){try{return M2(de,6)}catch{return!1}}async function gr(de,{byId:Ve=!1,exact:We=!1}={}){i(18,Ee=void 0),_n==null||_n.abort();const Re=new AbortController;i(19,_n=Re);try{const et=ct(de),gt=new URLSearchParams;if($!==void 0&&gt.set("language",Array.isArray($)?$.join(","):$??""),Bt&&gt.set("types",Bt.join(",")),vt&&gt.set("excludeTypes",String(vt)),x&&gt.set("bbox",x.map(an=>an.toFixed(6)).join(",")),N&&gt.set("country",Array.isArray(N)?N.join(","):N),!Ve&&!et){const an=await v2(ve,be,Re);an&&gt.set("proximity",an),(We||!pt)&&gt.set("autocomplete","false"),gt.set("fuzzyMatch",String(J))}fe!==void 0&&(!et||(Bt==null?void 0:Bt.length)===1)&&gt.set("limit",String(fe)),gt.set("key",l),pn(gt);const at=xt+"/"+encodeURIComponent(et?et.decimalLongitude+","+et.decimalLatitude:de)+".json?"+gt.toString();if(at===Ye){Ve?(i(14,lt=void 0),i(55,Lt=Gt[0])):i(14,lt=Gt);return}Ye=at;const Dt=await fetch(at,{signal:Re.signal,...It});if(!Dt.ok)throw new Error(await Dt.text());const en=await Dt.json();Ji("response",{url:at,featureCollection:en}),Ve?(i(14,lt=void 0),i(55,Lt=en.features[0]),Gt=[Lt]):(i(14,lt=en.features.filter(ie)),et&&lt.unshift({type:"Feature",properties:{},id:"reverse_"+et.decimalLongitude+"_"+et.decimalLatitude,text:et.decimalLatitude+", "+et.decimalLongitude,place_name:et.decimalLatitude+", "+et.decimalLongitude,place_type:["reverse"],center:[et.decimalLongitude,et.decimalLatitude],bbox:[et.decimalLongitude,et.decimalLatitude,et.decimalLongitude,et.decimalLatitude],geometry:{type:"Point",coordinates:[et.decimalLongitude,et.decimalLatitude]}}),Gt=lt,et&&kt.focus())}catch(et){if(et&&typeof et=="object"&&"name"in et&&et.name==="AbortError")return;throw et}finally{Re===_n&&i(19,_n=void 0)}}function kn(){var We;if(!(Je!=null&&Je.length)||!re)return;const de=[180,90,-180,-90],Ve=!Je.some(Re=>!Re.matching_text);for(const Re of Je)if(Ve||!Re.matching_text)for(const et of[0,1,2,3])de[et]=Math[et<2?"min":"max"](de[et],((We=Re.bbox)==null?void 0:We[et])??Re.center[et%2]);ve&&Je.length>0&&(Lt&&de[0]===de[2]&&de[1]===de[3]?ve.flyTo(Lt.center,wt):ve.fitBounds(L_(de),50,ft))}function mn(de){i(0,Te=U==="always"),i(14,lt=void 0),i(55,Lt=void 0),i(15,Vt=-1),Wn(de[1].toFixed(6)+", "+y2(de[0],[-180,180],!0).toFixed(6),!1,!0)}function As(de){if(!lt)return;let Ve=de.key==="ArrowDown"?1:de.key==="ArrowUp"?-1:0;Ve&&(Vt===(St?0:-1)&&Ve===-1&&i(15,Vt=lt.length),i(15,Vt+=Ve),Vt>=lt.length&&i(15,Vt=-1),Vt<0&&St&&i(15,Vt=0),de.preventDefault())}function At(de=!0,Ve=!1){if(i(18,Ee=void 0),pt||Ve){if(Kn&&clearTimeout(Kn),ye.length<Pe)return;const We=ye;Kn=window.setTimeout(()=>{gr(We).catch(Re=>i(18,Ee=Re))},de?B:0)}else i(14,lt=void 0),i(18,Ee=void 0)}function Ln(de){i(55,Lt=de),i(1,ye=de.place_name),i(15,Vt=-1)}const Tt=()=>kt.focus();function _r(de){Jn[de?"unshift":"push"](()=>{kt=de,i(17,kt)})}function Gr(){ye=this.value,i(1,ye),i(13,Se),i(27,C)}const wn=()=>i(13,Se=!0),Mi=()=>i(13,Se=!1),Er=()=>At(),Ki=()=>{i(1,ye=""),kt.focus()},Zr=()=>i(0,Te=!Te),Ae=()=>i(18,Ee=void 0),Q=de=>i(15,Vt=de),K=de=>Ln(de),he=()=>{St||i(15,Vt=-1)},le=()=>{};return r.$$set=de=>{"class"in de&&i(2,g=de.class),"apiKey"in de&&i(25,l=de.apiKey),"bbox"in de&&i(26,x=de.bbox),"clearButtonTitle"in de&&i(3,E=de.clearButtonTitle),"clearOnBlur"in de&&i(27,C=de.clearOnBlur),"collapsed"in de&&i(4,L=de.collapsed),"country"in de&&i(28,N=de.country),"debounceSearch"in de&&i(29,B=de.debounceSearch),"enableReverse"in de&&i(5,U=de.enableReverse),"errorMessage"in de&&i(6,te=de.errorMessage),"filter"in de&&i(30,ie=de.filter),"flyTo"in de&&i(31,re=de.flyTo),"fuzzyMatch"in de&&i(32,J=de.fuzzyMatch),"language"in de&&i(33,$=de.language),"limit"in de&&i(34,fe=de.limit),"mapController"in de&&i(35,ve=de.mapController),"minLength"in de&&i(36,Pe=de.minLength),"noResultsMessage"in de&&i(7,ue=de.noResultsMessage),"placeholder"in de&&i(8,xe=de.placeholder),"proximity"in de&&i(37,be=de.proximity),"reverseActive"in de&&i(0,Te=de.reverseActive),"reverseButtonTitle"in de&&i(9,we=de.reverseButtonTitle),"searchValue"in de&&i(1,ye=de.searchValue),"showFullGeometry"in de&&i(38,ze=de.showFullGeometry),"showPlaceType"in de&&i(10,Be=de.showPlaceType),"showResultsWhileTyping"in de&&i(39,pt=de.showResultsWhileTyping),"selectFirst"in de&&i(11,St=de.selectFirst),"flyToSelected"in de&&i(40,dt=de.flyToSelected),"markerOnSelected"in de&&i(41,ut=de.markerOnSelected),"types"in de&&i(42,Bt=de.types),"excludeTypes"in de&&i(43,vt=de.excludeTypes),"zoom"in de&&i(44,wt=de.zoom),"maxZoom"in de&&i(45,ft=de.maxZoom),"apiUrl"in de&&i(46,xt=de.apiUrl),"fetchParameters"in de&&i(47,It=de.fetchParameters),"iconsBaseUrl"in de&&i(12,Jt=de.iconsBaseUrl),"adjustUrlQuery"in de&&i(48,pn=de.adjustUrlQuery),"$$scope"in de&&i(58,f=de.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&i(0,Te=U==="always"),r.$$.dirty[0]&134225920&&setTimeout(()=>{i(16,Yi=Se),C&&!Se&&i(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&32&&ye.length<Pe&&(i(55,Lt=void 0),i(14,lt=void 0),i(18,Ee=void 0),i(54,Je=lt)),r.$$.dirty[1]&16777344&&ze&&Lt&&!Lt.address&&Lt.geometry.type==="Point"&&Lt.place_type[0]!=="reverse"&&gr(Lt.id,{byId:!0}).catch(de=>i(18,Ee=de)),r.$$.dirty[1]&50356241&&(ve&&Lt&&Lt.id!==xn&&re&&(!Lt.bbox||Lt.bbox[0]===Lt.bbox[2]&&Lt.bbox[1]===Lt.bbox[3]?ve.flyTo(Lt.center,Lt.id.startsWith("poi.")||Lt.id.startsWith("address.")?ft:wt):ve.fitBounds(L_(Lt.bbox),50,ft),i(14,lt=void 0),i(54,Je=void 0),i(15,Vt=-1)),i(56,xn=Lt==null?void 0:Lt.id)),r.$$.dirty[0]&18432&&St&&lt!=null&&lt.length&&i(15,Vt=0),r.$$.dirty[0]&2050&&(St||i(15,Vt=-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&8388608&&Je!==lt&&i(54,Je=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&8388624&&ve&&ve.setEventHandler(de=>{switch(de.type){case"mapClick":Te&&mn(de.coordinates);break;case"markerClick":{const Ve=lt==null?void 0:lt.find(We=>We.id===de.id);Ve&&Ln(Ve)}break;case"markerMouseEnter":Je&&i(15,Vt=Yi?(lt==null?void 0:lt.findIndex(Ve=>Ve.id===de.id))??-1:-1);break;case"markerMouseLeave":Je&&i(15,Vt=-1);break}}),r.$$.dirty[0]&49152&&i(57,s=lt==null?void 0:lt[Vt]),r.$$.dirty[1]&67133969&&ve&&s&&re&&dt&&ve.flyTo(s.center,s.id.startsWith("poi.")||s.id.startsWith("address.")?ft:wt),r.$$.dirty[1]&1040&&(ut||ve==null||ve.setMarkers(void 0,void 0)),r.$$.dirty[1]&75498512&&ve&&ut&&!Je&&(ve.setMarkers(s?[s]:void 0,void 0),ve.setSelectedMarker(s?0:-1)),r.$$.dirty[1]&25165840&&ve&&ve.setMarkers(Je,Lt),r.$$.dirty[0]&32768|r.$$.dirty[1]&8388624&&Je&&ve&&ve.setSelectedMarker(Vt),r.$$.dirty[0]&2|r.$$.dirty[1]&16&&ve){const de=ct(ye);ve.setReverseMarker(de?[de.decimalLongitude,de.decimalLatitude]:void 0)}r.$$.dirty[1]&67108864&&Ji("select",s),r.$$.dirty[1]&16777216&&Ji("pick",Lt),r.$$.dirty[0]&81920&&Ji("optionsVisibilityChange",Yi&&!!lt),r.$$.dirty[0]&16384&&Ji("featuresListed",lt),r.$$.dirty[1]&8388608&&Ji("featuresMarked",Je),r.$$.dirty[0]&1&&Ji("reverseToggle",Te),r.$$.dirty[0]&2&&Ji("queryChange",ye),r.$$.dirty[0]&1|r.$$.dirty[1]&16&&ve&&ve.indicateReverse(Te)},[Te,ye,g,E,L,U,te,ue,xe,we,Be,St,Jt,Se,lt,Vt,Yi,kt,Ee,_n,qi,Jr,As,At,Ln,l,x,C,N,B,ie,re,J,$,fe,ve,Pe,be,ze,pt,dt,ut,Bt,vt,wt,ft,xt,It,pn,Rn,Xe,Wn,dn,Ft,Je,Lt,xn,s,f,a,Tt,_r,Gr,wn,Mi,Er,Ki,Zr,Ae,Q,K,he,le]}class O2 extends fn{constructor(e){super(),hn(this,e,z2,N2,un,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function j_(r){let e,i,s;return i=new O2({props:{mapController:r[1],apiKey:r[0]}}),{c(){e=ce("div"),ot(i.$$.fragment),He(e,"class","svelte-ixhnie")},m(a,f){ae(a,e,f),rt(i,e,null),s=!0},p(a,f){const g={};f&2&&(g.mapController=a[1]),f&1&&(g.apiKey=a[0]),i.$set(g)},i(a){s||(_e(i.$$.fragment,a),s=!0)},o(a){Ie(i.$$.fragment,a),s=!1},d(a){a&&oe(e),st(i)}}}function F2(r){let e,i,s=r[1]&&j_(r);return{c(){s&&s.c(),e=ai()},m(a,f){s&&s.m(a,f),ae(a,e,f),i=!0},p(a,[f]){a[1]?s?(s.p(a,f),f&2&&_e(s,1)):(s=j_(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d(a)}}}function B2(r,e,i){let s,{apiKey:a}=e,{map:f}=e;return r.$$set=g=>{"apiKey"in g&&i(0,a=g.apiKey),"map"in g&&i(2,f=g.map)},r.$$.update=()=>{r.$$.dirty&4&&i(1,s=f?Kw(f,Ls):null)},[a,s,f]}class U2 extends fn{constructor(e){super(),hn(this,e,B2,F2,un,{apiKey:0,map:2})}}const qu=[];function up(r,e){return{subscribe:Yn(r,e).subscribe}}function Yn(r,e=nt){let i;const s=new Set;function a(l){if(un(r,l)&&(r=l,i)){const x=!qu.length;for(const E of s)E[1](),qu.push(E,r);if(x){for(let E=0;E<qu.length;E+=2)qu[E][0](qu[E+1]);qu.length=0}}}function f(l){a(l(r))}function g(l,x=nt){const E=[l,x];return s.add(E),s.size===1&&(i=e(a,f)||nt),l(r),()=>{s.delete(E),s.size===0&&i&&(i(),i=null)}}return{set:a,update:f,subscribe:g}}const j2=Symbol.for("svelte-maplibre");function V2(){return W0(j2)}function q2(r){return"layerType"in r&&r.layerType==="deckgl"}var Ph=G2;function G2(r){var e,i,s;if(r){if(Array.isArray(r)){for(e=[],i=r.length,s=0;s<i;s++){var a=r[s];a!=null&&e.push(a)}return e}if(typeof r=="object"){e={};var f=Object.keys(r);for(i=f.length,s=0;s<i;s++){var g=f[s],l=r[g];l!=null&&(e[g]=l)}return e}}}var Gu=Hp;function Hp(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?V_(r,e):{}.toString.call(r)=="[object Set]"?V_(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?H2(r,e):Z2(r,e)}function Z2(r,e){return r.toString()===e.toString()}function V_(r,e){var i=r.length;if(i!=e.length)return!1;for(var s=0;s<i;s++)if(!Hp(r[s],e[s]))return!1;return!0}function H2(r,e){var i=Object.keys(r),s=i.length;if(s!=Object.keys(e).length)return!1;for(var a=0;a<s;a++){var f=i[a];if(!(e.hasOwnProperty(f)&&Hp(r[f],e[f])))return!1}return!0}const W2=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),q_=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function G_(r){let e,i,s=(r[4]||r[3]instanceof Ls.Marker)&&Z_(r);return{c(){e=ce("div"),s&&s.c()},m(a,f){ae(a,e,f),s&&s.m(e,null),r[32](e),i=!0},p(a,f){a[4]||a[3]instanceof Ls.Marker?s?(s.p(a,f),f[0]&24&&_e(s,1)):(s=Z_(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d(),r[32](null)}}}function Z_(r){let e;const i=r[30].default,s=Zi(i,r,r[29],q_);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f[0]&536870933)&&Wi(s,i,a,a[29],e?Hi(i,a[29],f,W2):Xi(a[29]),q_)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function X2(r){let e,i,s=r[9].default&&G_(r);return{c(){s&&s.c(),e=ai()},m(a,f){s&&s.m(a,f),ae(a,e,f),i=!0},p(a,f){a[9].default?s?(s.p(a,f),f[0]&512&&_e(s,1)):(s=G_(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d(a)}}}function $2(r,e,i){let s,a,f,g,l,x,{$$slots:E={},$$scope:C}=e;const L=Wb(E);let{closeButton:N=void 0}=e,{closeOnClickOutside:B=!0}=e,{closeOnClickInside:U=!1}=e,{closeOnMove:te=!1}=e,{openOn:ie="click"}=e,{openIfTopMost:re=!0}=e,{focusAfterOpen:J=!0}=e,{anchor:$=void 0}=e,{offset:fe=void 0}=e,{popupClass:ve=void 0}=e,{maxWidth:Pe=void 0}=e,{lngLat:ue=void 0}=e,{html:xe=void 0}=e,{open:be=!1}=e;const Te=hc(),{map:we,popupTarget:ye,layerEvent:ze,layer:Be,eventTopMost:pt}=V2();Ot(r,we,Je=>i(2,f=Je)),Ot(r,ye,Je=>i(3,l=Je)),Ot(r,ze,Je=>i(28,g=Je)),Ot(r,Be,Je=>i(35,x=Je));const St=["click","dblclick","contextmenu"];let dt,ut=!1,Bt;function vt(){if(!dt)return;let Je=dt.getElement();!Je||Je===Bt||(Bt=Je,ie==="hover"&&(Bt.style.pointerEvents="none"),Bt.addEventListener("mouseenter",()=>{i(24,ut=!0)},{passive:!0}),Bt.addEventListener("mouseleave",()=>{i(24,ut=!1)},{passive:!0}),Bt.addEventListener("click",()=>{U&&i(0,be=!1)},{passive:!0}))}cc(()=>{if(f)return f.on("click",dn),f.on("contextmenu",dn),typeof l=="string"&&(f.on("click",l,It),f.on("dblclick",l,It),f.on("contextmenu",l,It),f.on("mousemove",l,Wn),f.on("mouseleave",l,Xe),f.on("touchstart",l,pn),f.on("touchend",l,Rn)),()=>{f!=null&&f.loaded()&&(dt==null||dt.remove(),f.off("click",dn),f.off("contextmenu",dn),l instanceof Ls.Marker?l.getPopup()===dt&&l.setPopup(void 0):typeof l=="string"&&(f.off("click",l,It),f.off("dblclick",l,It),f.off("contextmenu",l,It),f.off("mousemove",l,Wn),f.off("mouseleave",l,Xe),f.off("touchstart",l,pn),f.off("touchend",l,Rn)))}});function wt(Je){return re?!("marker"in Je)&&!q2(Je)&&pt(Je)!==x:!1}let ft=null,xt="normal";function It(Je){Je.type===ie&&(wt(Je)||("layerType"in Je?Je.layerType==="deckgl"?(i(10,ue=Je.coordinate),i(4,ft=Je.object?[Je.object]:null)):(i(10,ue=Je.lngLat),i(4,ft=Je.features??[])):(i(10,ue=Je.lngLat),i(4,ft=Je.features??[])),setTimeout(()=>i(0,be=!0))))}let Jt=null;function pn(Je){Jt=Je.point}function Rn(Je){if(!Jt||ie!=="hover")return;let Lt=Jt.dist(Je.point);Jt=null,Lt<3&&(i(10,ue=Je.lngLat),i(4,ft=Je.features??[]),dt.isOpen()?i(25,xt="justOpened"):(i(25,xt="opening"),i(0,be=!0)))}function Xe(Je){ie!=="hover"||Jt||xt!=="normal"||(i(0,be=!1),i(4,ft=null))}function Wn(Je){if(!(ie!=="hover"||Jt||xt!=="normal")){if(wt(Je)){i(0,be=!1),i(4,ft=null);return}i(0,be=!0),i(4,ft=Je.features??[]),i(10,ue=Je.lngLat)}}function dn(Je){if(xt==="justOpened"){i(25,xt="normal");return}if(!B)return;let Lt=[Bt,l instanceof Ls.Marker?l==null?void 0:l.getElement():null];be&&dt.isOpen()&&!Lt.some(Ye=>Ye==null?void 0:Ye.contains(Je.originalEvent.target))&&(Je.type==="contextmenu"&&ie==="contextmenu"||Je.type!=="contextmenu")&&i(0,be=!1)}vo(()=>{f&&(dt!=null&&dt.isOpen())&&dt.remove()});let Ft;const Se=()=>i(0,be=!1);function lt(Je){Jn[Je?"unshift":"push"](()=>{Ft=Je,i(1,Ft)})}return r.$$set=Je=>{"closeButton"in Je&&i(11,N=Je.closeButton),"closeOnClickOutside"in Je&&i(12,B=Je.closeOnClickOutside),"closeOnClickInside"in Je&&i(13,U=Je.closeOnClickInside),"closeOnMove"in Je&&i(14,te=Je.closeOnMove),"openOn"in Je&&i(15,ie=Je.openOn),"openIfTopMost"in Je&&i(16,re=Je.openIfTopMost),"focusAfterOpen"in Je&&i(17,J=Je.focusAfterOpen),"anchor"in Je&&i(18,$=Je.anchor),"offset"in Je&&i(19,fe=Je.offset),"popupClass"in Je&&i(20,ve=Je.popupClass),"maxWidth"in Je&&i(21,Pe=Je.maxWidth),"lngLat"in Je&&i(10,ue=Je.lngLat),"html"in Je&&i(22,xe=Je.html),"open"in Je&&i(0,be=Je.open),"$$scope"in Je&&i(29,C=Je.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&i(27,s=N??(!B&&!U)),r.$$.dirty[0]&146685952&&(dt||(i(23,dt=new Ls.Popup({closeButton:s,closeOnClick:!1,closeOnMove:te,focusAfterOpen:J,maxWidth:Pe,className:ve,anchor:$,offset:fe})),Bt=dt.getElement(),dt.on("open",()=>{i(0,be=!0),vt(),Te("open",dt)}),dt.on("close",()=>{i(0,be=!1),Te("close",dt)}),dt.on("hover",()=>{Te("hover",dt)}))),r.$$.dirty[0]&8421384&&dt&&l instanceof Ls.Marker&&(ie==="click"?l.setPopup(dt):l.getPopup()===dt&&l.setPopup(void 0)),r.$$.dirty[0]&268468224&&St.includes(ie)&&(g==null?void 0:g.type)===ie&&(It(g),Dn(ze,g=null,g)),r.$$.dirty[0]&268468224&&i(26,a=ie==="hover"&&((g==null?void 0:g.type)==="mousemove"||(g==null?void 0:g.type)==="mouseenter")),r.$$.dirty[0]&352354304&&ie==="hover"&&ze&&(a&&g&&(g.layerType==="deckgl"?(i(10,ue=g.coordinate),i(4,ft=g.object?[g.object]:null)):(i(10,ue=g.lngLat),i(4,ft=g.features??[]))),i(0,be=(a||ut)??!1)),r.$$.dirty[0]&12582914&&(Ft?dt.setDOMContent(Ft):xe&&dt.setHTML(xe)),r.$$.dirty[0]&8389632&&ue&&dt.setLngLat(ue),r.$$.dirty[0]&41943045&&f){let Je=dt.isOpen();be&&!Je?(dt.addTo(f),xt==="opening"&&i(25,xt="justOpened")):!be&&Je&&dt.remove()}},[be,Ft,f,l,ft,we,ye,ze,Be,L,ue,N,B,U,te,ie,re,J,$,fe,ve,Pe,xe,dt,ut,xt,a,s,g,C,E,Se,lt]}class Y2 extends fn{constructor(e){super(),hn(this,e,$2,X2,un,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var tc=Math.pow,ps=(r,e,i)=>new Promise((s,a)=>{var f=x=>{try{l(i.next(x))}catch(E){a(E)}},g=x=>{try{l(i.throw(x))}catch(E){a(E)}},l=x=>x.done?s(x.value):Promise.resolve(x.value).then(f,g);l((i=i.apply(r,e)).next())}),eo=Uint8Array,Yu=Uint16Array,J2=Int32Array,Sv=new eo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ev=new eo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),K2=new eo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tv=function(r,e){for(var i=new Yu(31),s=0;s<31;++s)i[s]=e+=1<<r[s-1];for(var a=new J2(i[30]),s=1;s<30;++s)for(var f=i[s];f<i[s+1];++f)a[f]=f-i[s]<<5|s;return{b:i,r:a}},Cv=Tv(Sv,2),Lv=Cv.b,Q2=Cv.r;Lv[28]=258,Q2[258]=28;var ek=Tv(Ev,0),tk=ek.b,Lp=new Yu(32768);for(yi=0;yi<32768;++yi)La=(yi&43690)>>1|(yi&21845)<<1,La=(La&52428)>>2|(La&13107)<<2,La=(La&61680)>>4|(La&3855)<<4,Lp[yi]=((La&65280)>>8|(La&255)<<8)>>1;var La,yi,kh=function(r,e,i){for(var s=r.length,a=0,f=new Yu(e);a<s;++a)r[a]&&++f[r[a]-1];var g=new Yu(e);for(a=1;a<e;++a)g[a]=g[a-1]+f[a-1]<<1;var l;if(i){l=new Yu(1<<e);var x=15-e;for(a=0;a<s;++a)if(r[a])for(var E=a<<4|r[a],C=e-r[a],L=g[r[a]-1]++<<C,N=L|(1<<C)-1;L<=N;++L)l[Lp[L]>>x]=E}else for(l=new Yu(s),a=0;a<s;++a)r[a]&&(l[a]=Lp[g[r[a]-1]++]>>15-r[a]);return l},Fh=new eo(288);for(yi=0;yi<144;++yi)Fh[yi]=8;var yi;for(yi=144;yi<256;++yi)Fh[yi]=9;var yi;for(yi=256;yi<280;++yi)Fh[yi]=7;var yi;for(yi=280;yi<288;++yi)Fh[yi]=8;var yi,Mv=new eo(32);for(yi=0;yi<32;++yi)Mv[yi]=5;var yi,nk=kh(Fh,9,1),ik=kh(Mv,5,1),cp=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},Mo=function(r,e,i){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(e&7)&i},hp=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(e&7)},rk=function(r){return(r+7)/8|0},sk=function(r,e,i){(e==null||e<0)&&(e=0),(i==null||i>r.length)&&(i=r.length);var s=new eo(i-e);return s.set(r.subarray(e,i)),s},ok=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qs=function(r,e,i){var s=new Error(e||ok[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,Qs),!i)throw s;return s},Wp=function(r,e,i,s){var a=r.length,f=s?s.length:0;if(!a||e.f&&!e.l)return i||new eo(0);var g=!i||e.i!=2,l=e.i;i||(i=new eo(a*3));var x=function(dn){var Ft=i.length;if(dn>Ft){var Se=new eo(Math.max(Ft*2,dn));Se.set(i),i=Se}},E=e.f||0,C=e.p||0,L=e.b||0,N=e.l,B=e.d,U=e.m,te=e.n,ie=a*8;do{if(!N){E=Mo(r,C,1);var re=Mo(r,C+1,3);if(C+=3,re)if(re==1)N=nk,B=ik,U=9,te=5;else if(re==2){var ve=Mo(r,C,31)+257,Pe=Mo(r,C+10,15)+4,ue=ve+Mo(r,C+5,31)+1;C+=14;for(var xe=new eo(ue),be=new eo(19),Te=0;Te<Pe;++Te)be[K2[Te]]=Mo(r,C+Te*3,7);C+=Pe*3;for(var we=cp(be),ye=(1<<we)-1,ze=kh(be,we,1),Te=0;Te<ue;){var Be=ze[Mo(r,C,ye)];C+=Be&15;var J=Be>>4;if(J<16)xe[Te++]=J;else{var pt=0,St=0;for(J==16?(St=3+Mo(r,C,3),C+=2,pt=xe[Te-1]):J==17?(St=3+Mo(r,C,7),C+=3):J==18&&(St=11+Mo(r,C,127),C+=7);St--;)xe[Te++]=pt}}var dt=xe.subarray(0,ve),ut=xe.subarray(ve);U=cp(dt),te=cp(ut),N=kh(dt,U,1),B=kh(ut,te,1)}else Qs(1);else{var J=rk(C)+4,$=r[J-4]|r[J-3]<<8,fe=J+$;if(fe>a){l&&Qs(0);break}g&&x(L+$),i.set(r.subarray(J,fe),L),e.b=L+=$,e.p=C=fe*8,e.f=E;continue}if(C>ie){l&&Qs(0);break}}g&&x(L+131072);for(var Bt=(1<<U)-1,vt=(1<<te)-1,wt=C;;wt=C){var pt=N[hp(r,C)&Bt],ft=pt>>4;if(C+=pt&15,C>ie){l&&Qs(0);break}if(pt||Qs(2),ft<256)i[L++]=ft;else if(ft==256){wt=C,N=null;break}else{var xt=ft-254;if(ft>264){var Te=ft-257,It=Sv[Te];xt=Mo(r,C,(1<<It)-1)+Lv[Te],C+=It}var Jt=B[hp(r,C)&vt],pn=Jt>>4;Jt||Qs(3),C+=Jt&15;var ut=tk[pn];if(pn>3){var It=Ev[pn];ut+=hp(r,C)&(1<<It)-1,C+=It}if(C>ie){l&&Qs(0);break}g&&x(L+131072);var Rn=L+xt;if(L<ut){var Xe=f-ut,Wn=Math.min(ut,Rn);for(Xe+L<0&&Qs(3);L<Wn;++L)i[L]=s[Xe+L]}for(;L<Rn;L+=4)i[L]=i[L-ut],i[L+1]=i[L+1-ut],i[L+2]=i[L+2-ut],i[L+3]=i[L+3-ut];L=Rn}}e.l=N,e.p=wt,e.b=L,e.f=E,N&&(E=1,e.m=U,e.d=B,e.n=te)}while(!E);return L==i.length?i:sk(i,0,L)},ak=new eo(0),lk=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Qs(6,"invalid gzip data");var e=r[3],i=10;e&4&&(i+=(r[10]|r[11]<<8)+2);for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!r[i++]);return i+(e&2)},uk=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},ck=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Qs(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Qs(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function hk(r,e){return Wp(r,{i:2},e&&e.out,e&&e.dictionary)}function fk(r,e){var i=lk(r);return i+8>r.length&&Qs(6,"invalid gzip data"),Wp(r.subarray(i,-8),{i:2},e&&e.out||new eo(uk(r)),e&&e.dictionary)}function dk(r,e){return Wp(r.subarray(ck(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Mp(r,e){return r[0]==31&&r[1]==139&&r[2]==8?fk(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?hk(r,e):dk(r,e)}var pk=typeof TextDecoder<"u"&&new TextDecoder,mk=0;try{pk.decode(ak,{stream:!0}),mk=1}catch{}var Av=(r,e)=>r*tc(2,e),fh=(r,e)=>Math.floor(r/tc(2,e)),qf=(r,e)=>Av(r.getUint16(e+1,!0),8)+r.getUint8(e),Pv=(r,e)=>Av(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),gk=(r,e,i,s,a)=>{if(r!==s.getUint8(a))return r-s.getUint8(a);const f=qf(s,a+1);if(e!==f)return e-f;const g=qf(s,a+4);return i!==g?i-g:0},_k=(r,e,i,s)=>{const a=Rv(r,e|128,i,s);return a?{z:e,x:i,y:s,offset:a[0],length:a[1],isDir:!0}:null},H_=(r,e,i,s)=>{const a=Rv(r,e,i,s);return a?{z:e,x:i,y:s,offset:a[0],length:a[1],isDir:!1}:null},Rv=(r,e,i,s)=>{let a=0,f=r.byteLength/17-1;for(;a<=f;){const g=f+a>>1,l=gk(e,i,s,r,g*17);if(l>0)a=g+1;else if(l<0)f=g-1;else return[Pv(r,g*17+7),r.getUint32(g*17+13,!0)]}return null},yk=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Dv=(r,e)=>{const i=r.getUint8(e*17);return{z:i&127,x:qf(r,e*17+1),y:qf(r,e*17+4),offset:Pv(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:i>>7===1}},W_=r=>{const e=[],i=new DataView(r);for(let s=0;s<i.byteLength/17;s++)e.push(Dv(i,s));return vk(e)},vk=r=>{r.sort(yk);const e=new ArrayBuffer(17*r.length),i=new Uint8Array(e);for(let s=0;s<r.length;s++){const a=r[s];let f=a.z;a.isDir&&(f=f|128),i[s*17]=f,i[s*17+1]=a.x&255,i[s*17+2]=a.x>>8&255,i[s*17+3]=a.x>>16&255,i[s*17+4]=a.y&255,i[s*17+5]=a.y>>8&255,i[s*17+6]=a.y>>16&255,i[s*17+7]=a.offset&255,i[s*17+8]=fh(a.offset,8)&255,i[s*17+9]=fh(a.offset,16)&255,i[s*17+10]=fh(a.offset,24)&255,i[s*17+11]=fh(a.offset,32)&255,i[s*17+12]=fh(a.offset,48)&255,i[s*17+13]=a.length&255,i[s*17+14]=a.length>>8&255,i[s*17+15]=a.length>>16&255,i[s*17+16]=a.length>>24&255}return e},bk=(r,e)=>{if(r.byteLength<17)return null;const i=r.byteLength/17,s=Dv(r,i-1);if(s.isDir){const a=s.z,f=e.z-a,g=Math.trunc(e.x/(1<<f)),l=Math.trunc(e.y/(1<<f));return{z:a,x:g,y:l}}return null};function xk(r){return ps(this,null,function*(){const e=yield r.getBytes(0,512e3),i=new DataView(e.data),s=i.getUint32(4,!0),a=i.getUint16(8,!0),f=new TextDecoder("utf-8"),g=JSON.parse(f.decode(new DataView(e.data,10,s)));let l=0;g.compression==="gzip"&&(l=2);let x=0;"minzoom"in g&&(x=+g.minzoom);let E=0;"maxzoom"in g&&(E=+g.maxzoom);let C=0,L=0,N=0,B=-180,U=-85,te=180,ie=85;if(g.bounds){const J=g.bounds.split(",");B=+J[0],U=+J[1],te=+J[2],ie=+J[3]}if(g.center){const J=g.center.split(",");C=+J[0],L=+J[1],N=+J[2]}return{specVersion:i.getUint16(2,!0),rootDirectoryOffset:10+s,rootDirectoryLength:a*17,jsonMetadataOffset:10,jsonMetadataLength:s,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:x,maxZoom:E,minLon:B,minLat:U,maxLon:te,maxLat:ie,centerZoom:N,centerLon:C,centerLat:L,etag:e.etag}})}function wk(r,e,i,s,a,f,g){return ps(this,null,function*(){let l=yield i.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(l=W_(l));const x=H_(new DataView(l),s,a,f);if(x){let L=(yield e.getBytes(x.offset,x.length,g)).data;const N=new DataView(L);return N.getUint8(0)===31&&N.getUint8(1)===139&&(L=Mp(new Uint8Array(L))),{data:L}}const E=bk(new DataView(l),{z:s,x:a,y:f});if(E){const C=_k(new DataView(l),E.z,E.x,E.y);if(C){let L=yield i.getArrayBuffer(e,C.offset,C.length,r);r.specVersion===1&&(L=W_(L));const N=H_(new DataView(L),s,a,f);if(N){let U=(yield e.getBytes(N.offset,N.length,g)).data;const te=new DataView(U);return te.getUint8(0)===31&&te.getUint8(1)===139&&(U=Mp(new Uint8Array(U))),{data:U}}}}})}var Nv={getHeader:xk,getZxy:wk},kk=r=>(e,i)=>{if(i instanceof AbortController)return r(e,i);const s=new AbortController;return r(e,s).then(a=>i(void 0,a.data,a.cacheControl||"",a.expires||""),a=>i(a)).catch(a=>i(a)),{cancel:()=>s.abort()}},Ik=class{constructor(){this.tilev4=(r,e)=>ps(this,null,function*(){if(r.type==="json"){const L=r.url.substr(10);let N=this.tiles.get(L);N||(N=new X_(L),this.tiles.set(L,N));const B=yield N.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:B.minZoom,maxzoom:B.maxZoom,bounds:[B.minLon,B.minLat,B.maxLon,B.maxLat]}}}const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=r.url.match(i);if(!s)throw new Error("Invalid PMTiles protocol URL");const a=s[1];let f=this.tiles.get(a);f||(f=new X_(a),this.tiles.set(a,f));const g=s[2],l=s[3],x=s[4],E=yield f.getHeader(),C=yield f==null?void 0:f.getZxy(+g,+l,+x,e.signal);return C?{data:new Uint8Array(C.data),cacheControl:C.cacheControl,expires:C.expires}:E.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=kk(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Zu(r,e){return(e>>>0)*4294967296+(r>>>0)}function Sk(r,e){const i=e.buf;let s=i[e.pos++],a=(s&112)>>4;if(s<128||(s=i[e.pos++],a|=(s&127)<<3,s<128)||(s=i[e.pos++],a|=(s&127)<<10,s<128)||(s=i[e.pos++],a|=(s&127)<<17,s<128)||(s=i[e.pos++],a|=(s&127)<<24,s<128)||(s=i[e.pos++],a|=(s&1)<<31,s<128))return Zu(r,a);throw new Error("Expected varint not more than 10 bytes")}function dh(r){const e=r.buf;let i=e[r.pos++],s=i&127;return i<128||(i=e[r.pos++],s|=(i&127)<<7,i<128)||(i=e[r.pos++],s|=(i&127)<<14,i<128)||(i=e[r.pos++],s|=(i&127)<<21,i<128)?s:(i=e[r.pos],s|=(i&15)<<28,Sk(s,r))}function Ek(r,e,i,s){if(s===0){i===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const a=e[0];e[0]=e[1],e[1]=a}}var Tk=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ck(r,e,i){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>tc(2,r)-1||i>tc(2,r)-1)throw Error("tile x/y outside zoom level bounds");const s=Tk[r],a=tc(2,r);let f=0,g=0,l=0;const x=[e,i];let E=a/2;for(;E>0;)f=(x[0]&E)>0?1:0,g=(x[1]&E)>0?1:0,l+=E*E*(3*f^g),Ek(E,x,f,g),E=E/2;return s+l}function zv(r,e){return ps(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Mp(new Uint8Array(r));const i=new Response(r).body;if(!i)throw Error("Failed to read response stream");const s=i.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(s).arrayBuffer()}throw Error("Compression method not supported")})}var Lk=127;function Mk(r,e){let i=0,s=r.length-1;for(;i<=s;){const a=s+i>>1,f=e-r[a].tileId;if(f>0)i=a+1;else if(f<0)s=a-1;else return r[a]}return s>=0&&(r[s].runLength===0||e-r[s].tileId<r[s].runLength)?r[s]:null}var Ak=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,i,s){return ps(this,null,function*(){let a,f;i?f=i:(a=new AbortController,f=a.signal);const g=new Headers(this.customHeaders);g.set("range",`bytes=${r}-${r+e-1}`);let l;this.mustReload&&(l="reload");let x=yield fetch(this.url,{signal:f,cache:l,headers:g});if(r===0&&x.status===416){const N=x.headers.get("Content-Range");if(!N||!N.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const B=+N.substr(8);x=yield fetch(this.url,{signal:f,cache:"reload",headers:{range:`bytes=0-${B-1}`}})}let E=x.headers.get("Etag");if(E!=null&&E.startsWith("W/")&&(E=null),x.status===416||s&&E&&E!==s)throw this.mustReload=!0,new Ap(`Server returned non-matching ETag ${s} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(x.status>=300)throw Error(`Bad response code: ${x.status}`);const C=x.headers.get("Content-Length");if(x.status===200&&(!C||+C>e))throw a&&a.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield x.arrayBuffer(),etag:E||void 0,cacheControl:x.headers.get("Cache-Control")||void 0,expires:x.headers.get("Expires")||void 0}})}};function Ao(r,e){const i=r.getUint32(e+4,!0),s=r.getUint32(e+0,!0);return i*tc(2,32)+s}function Pk(r,e){const i=new DataView(r),s=i.getUint8(7);if(s>3)throw Error(`Archive is spec version ${s} but this library supports up to spec version 3`);return{specVersion:s,rootDirectoryOffset:Ao(i,8),rootDirectoryLength:Ao(i,16),jsonMetadataOffset:Ao(i,24),jsonMetadataLength:Ao(i,32),leafDirectoryOffset:Ao(i,40),leafDirectoryLength:Ao(i,48),tileDataOffset:Ao(i,56),tileDataLength:Ao(i,64),numAddressedTiles:Ao(i,72),numTileEntries:Ao(i,80),numTileContents:Ao(i,88),clustered:i.getUint8(96)===1,internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}function Ov(r){const e={buf:new Uint8Array(r),pos:0},i=dh(e),s=[];let a=0;for(let f=0;f<i;f++){const g=dh(e);s.push({tileId:a+g,offset:0,length:0,runLength:1}),a+=g}for(let f=0;f<i;f++)s[f].runLength=dh(e);for(let f=0;f<i;f++)s[f].length=dh(e);for(let f=0;f<i;f++){const g=dh(e);g===0&&f>0?s[f].offset=s[f-1].offset+s[f-1].length:s[f].offset=g-1}return s}function Rk(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Ap=class extends Error{};function Dk(r,e){return ps(this,null,function*(){const i=yield r.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Rk(i.data)<3)return[yield Nv.getHeader(r)];const a=i.data.slice(0,Lk),f=Pk(a,i.etag),g=i.data.slice(f.rootDirectoryOffset,f.rootDirectoryOffset+f.rootDirectoryLength),l=`${r.getKey()}|${f.etag||""}|${f.rootDirectoryOffset}|${f.rootDirectoryLength}`,x=Ov(yield e(g,f.internalCompression));return[f,[l,x.length,x]]})}function Nk(r,e,i,s,a){return ps(this,null,function*(){const f=yield r.getBytes(i,s,void 0,a.etag),g=yield e(f.data,a.internalCompression),l=Ov(g);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var zk=class{constructor(r=100,e=!0,i=zv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=i}getHeader(r){return ps(this,null,function*(){const e=r.getKey(),i=this.cache.get(e);if(i)return i.lastUsed=this.counter++,yield i.data;const s=new Promise((a,f)=>{Dk(r,this.decompress).then(g=>{g[1]&&this.cache.set(g[1][0],{lastUsed:this.counter++,data:Promise.resolve(g[1][2])}),a(g[0]),this.prune()}).catch(g=>{f(g)})});return this.cache.set(e,{lastUsed:this.counter++,data:s}),s})}getDirectory(r,e,i,s){return ps(this,null,function*(){const a=`${r.getKey()}|${s.etag||""}|${e}|${i}`,f=this.cache.get(a);if(f)return f.lastUsed=this.counter++,yield f.data;const g=new Promise((l,x)=>{Nk(r,this.decompress,e,i,s).then(E=>{l(E),this.prune()}).catch(E=>{x(E)})});return this.cache.set(a,{lastUsed:this.counter++,data:g}),g})}getArrayBuffer(r,e,i,s){return ps(this,null,function*(){const a=`${r.getKey()}|${s.etag||""}|${e}|${i}`,f=this.cache.get(a);if(f)return f.lastUsed=this.counter++,yield f.data;const g=new Promise((l,x)=>{r.getBytes(e,i,void 0,s.etag).then(E=>{l(E.data),this.cache.has(a),this.prune()}).catch(E=>{x(E)})});return this.cache.set(a,{lastUsed:this.counter++,data:g}),g})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((i,s)=>{i.lastUsed<r&&(r=i.lastUsed,e=s)}),e&&this.cache.delete(e)}}invalidate(r){return ps(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const i=new Promise((s,a)=>{this.getHeader(r).then(f=>{s(),this.invalidations.delete(e)}).catch(f=>{a(f)})});this.invalidations.set(e,i)})}},X_=class{constructor(r,e,i){typeof r=="string"?this.source=new Ak(r):this.source=r,i?this.decompress=i:this.decompress=zv,e?this.cache=e:this.cache=new zk}getHeader(){return ps(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,i,s){return ps(this,null,function*(){const a=Ck(r,e,i),f=yield this.cache.getHeader(this.source);if(f.specVersion<3)return Nv.getZxy(f,this.source,this.cache,r,e,i,s);if(r<f.minZoom||r>f.maxZoom)return;let g=f.rootDirectoryOffset,l=f.rootDirectoryLength;for(let x=0;x<=3;x++){const E=yield this.cache.getDirectory(this.source,g,l,f),C=Mk(E,a);if(C){if(C.runLength>0){const L=yield this.source.getBytes(f.tileDataOffset+C.offset,C.length,s,f.etag);return{data:yield this.decompress(L.data,f.tileCompression),cacheControl:L.cacheControl,expires:L.expires}}g=f.leafDirectoryOffset+C.offset,l=C.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,i,s){return ps(this,null,function*(){try{return yield this.getZxyAttempt(r,e,i,s)}catch(a){if(a instanceof Ap)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,i,s);throw a}})}getMetadataAttempt(){return ps(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),i=yield this.decompress(e.data,r.internalCompression),s=new TextDecoder("utf-8");return JSON.parse(s.decode(i))})}getMetadata(){return ps(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof Ap)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};const Ok=r=>({props:r&8}),$_=r=>({props:Uk(r[3])});function Fk(r){let e;const i=r[1].default,s=Zi(i,r,r[2],$_);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&12)&&Wi(s,i,a,a[2],e?Hi(i,a[2],f,Ok):Xi(a[2]),$_)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function Bk(r){let e,i;return e=new Y2({props:{openOn:r[0],$$slots:{default:[Fk,({features:s})=>({3:s}),({features:s})=>s?8:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,[a]){const f={};a&1&&(f.openOn=s[0]),a&12&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function Uk(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function jk(r,e,i){let{$$slots:s={},$$scope:a}=e,{openOn:f="hover"}=e;return r.$$set=g=>{"openOn"in g&&i(0,f=g.openOn),"$$scope"in g&&i(2,a=g.$$scope)},[f,s,a]}class js extends fn{constructor(e){super(),hn(this,e,jk,Bk,un,{openOn:0})}}function Xp(r,e,i){let s=["match",r];for(let[a,f]of Object.entries(e))s.push(a),s.push(f);return s.push(i),s}function Gf(r,e,i){let s=["step",r];for(let a=1;a<e.length;a++)s.push(i[a-1]),s.push(e[a]);return s.push(i[i.length-1]),s}function Af(){return{type:"FeatureCollection",features:[]}}let Vk=Date.now();function dc(r){return`${r}-${Vk++}`}const $p=Symbol.for("svelte-maplibre");function pc(){return W0($p)}function qk(r){let e=new WeakMap;return i=>{var g;let s=e.get(i.originalEvent);if(s!==void 0)return s;let f=(g=i.target.queryRenderedFeatures(i.point).find(l=>{var x;return(x=r.get(l.layer.id))==null?void 0:x.interactive}))==null?void 0:g.layer.id;return e.set(i.originalEvent,f),f}}function Gk(){let r=new Map;return H0($p,{map:Yn(null),source:up(null),layer:up(null),popupTarget:up(null),cluster:Yn(),loadedImages:Yn(new Set),minzoom:Yn(0),maxzoom:Yn(24),layerEvent:Yn(null),layerInfo:r,eventTopMost:qk(r),markerClickManager:new Wk})}function Y_(r){return{subscribe:r.subscribe}}function Yp({key:r,setPopupTarget:e=!1,setCluster:i=!1,setMouseEvent:s=!1}){let a=pc(),f=Yn(null),g=Y_(f),l={...a,[r]:Y_(f)};if(e&&(l.popupTarget=g),s){let x=Yn(null);l.layerEvent=x,a.layerEvent=x}return i&&(l.cluster=Yn()),H0($p,l),{...a,self:f}}function Fv(){return Yp({key:"source",setCluster:!0})}function Zk(r=!0){return Yp({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Hk(){return Yp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Wk{constructor(){lh(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const i of this._handlers)i(e)}}function J_(r){let e;return i=>{if(i)for(let s in i){let a=e==null?void 0:e[s],f=i[s];a!==f&&r(s,f,a)}else if(e)for(let s in e)r(s,void 0,e[s]);e=i}}function Xk(r,...e){let i=[r];for(let s of e)if(s)Array.isArray(s)&&s[0]===r?i.push(...s.slice(1)):i.push(s);else continue;if(i.length!==1)return i.length===2?i[1]:i}function $k(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Ms(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}function K_(r){let e=r[0],i,s,a=Q_(r);return{c(){a.c(),i=ai()},m(f,g){a.m(f,g),ae(f,i,g),s=!0},p(f,g){g[0]&1&&un(e,e=f[0])?(Nn(),Ie(a,1,1,nt),zn(),a=Q_(f),a.c(),_e(a,1),a.m(i.parentNode,i)):a.p(f,g)},i(f){s||(_e(a),s=!0)},o(f){Ie(a),s=!1},d(f){f&&oe(i),a.d(f)}}}function Q_(r){let e;const i=r[36].default,s=Zi(i,r,r[35],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f[1]&16)&&Wi(s,i,a,a[35],e?Hi(i,a[35],f,null):Xi(a[35]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function Yk(r){let e,i,s=r[0]&&K_(r);return{c(){s&&s.c(),e=ai()},m(a,f){s&&s.m(a,f),ae(a,e,f),i=!0},p(a,f){a[0]?s?(s.p(a,f),f[0]&1&&_e(s,1)):(s=K_(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d(a)}}}function Jk(r,e,i){let s,a,f,g,l,x,E,C,L,N,B,U,{$$slots:te={},$$scope:ie}=e,{id:re=dc("layer")}=e,{source:J=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:fe=void 0}=e,{beforeLayerType:ve=void 0}=e,{type:Pe}=e,{paint:ue=void 0}=e,{layout:xe=void 0}=e,{filter:be=void 0}=e,{applyToClusters:Te=void 0}=e,{minzoom:we=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:ze=!1}=e,{hovered:Be=null}=e,{interactive:pt=!0}=e,{hoverCursor:St=void 0}=e,{eventsIfTopMost:dt=!1}=e;const ut=hc(),{map:Bt,source:vt,self:wt,minzoom:ft,maxzoom:xt,eventTopMost:It,layerInfo:Jt}=Zk();Ot(r,Bt,lt=>i(31,L=lt)),Ot(r,vt,lt=>i(32,N=lt)),Ot(r,wt,lt=>i(0,C=lt)),Ot(r,ft,lt=>i(34,U=lt)),Ot(r,xt,lt=>i(33,B=lt)),vo(()=>{C&&L&&(Jt.delete(C),L==null||L.removeLayer(C))});let pn;function Rn(lt){var kt,Vt;if(!pt||!C||!L||dt&&It(lt)!==C)return;let Je=lt.features??[],Lt=(Vt=(kt=Je[0])==null?void 0:kt.properties)==null?void 0:Vt.cluster_id,Ye={event:lt,map:L,clusterId:Lt,layer:C,source:l,features:Je};ut(lt.type,Ye)}function Xe(lt){var kt,Vt;if(!pt||!C||!L||dt&&It(lt)!==C)return;St&&(L.getCanvas().style.cursor=St);let Je=lt.features??[];i(6,Be=Je[0]??null);let Lt=(Vt=(kt=Je[0])==null?void 0:kt.properties)==null?void 0:Vt.cluster_id;ut("mouseenter",{event:lt,map:L,clusterId:Lt,layer:C,source:l,features:Je})}function Wn(lt){var kt,Vt,Ee;if(!pt||!L)return;if(dt&&It(lt)!==C){i(6,Be=null),ze&&pn!==void 0&&(L==null||L.setFeatureState({source:l,sourceLayer:$,id:pn},{hover:!1}),pn=void 0);return}L.getCanvas().style.cursor=St;let Je=lt.features??[],Lt=(Vt=(kt=Je[0])==null?void 0:kt.properties)==null?void 0:Vt.cluster_id,Ye=(Ee=Je[0])==null?void 0:Ee.id;Ye!==pn&&(ze&&(pn!==void 0&&(L==null||L.setFeatureState({source:l,id:pn,sourceLayer:$},{hover:!1})),L==null||L.setFeatureState({source:l,id:Ye,sourceLayer:$},{hover:!0})),pn=Ye,i(6,Be=Je[0]??null)),ut("mousemove",{event:lt,map:L,clusterId:Lt,layer:C,source:l,features:Je})}function dn(lt){if(!(!pt||!C||!L)){if(St&&(L.getCanvas().style.cursor=""),i(6,Be=null),ze&&pn!==void 0){const Je={source:l,id:pn,sourceLayer:$};L==null||L.setFeatureState(Je,{hover:!1}),pn=void 0}ut("mouseleave",{map:L,layer:C,source:l})}}let Ft=!0;function Se(lt){L&&(L.off("click",lt,Rn),L.off("dblclick",lt,Rn),L.off("contextmenu",lt,Rn),L.off("mouseenter",lt,Xe),L.off("mousemove",lt,Wn),L.off("mouseleave",lt,dn))}return vo(()=>{L&&C&&Se(C)}),r.$$set=lt=>{"id"in lt&&i(7,re=lt.id),"source"in lt&&i(8,J=lt.source),"sourceLayer"in lt&&i(9,$=lt.sourceLayer),"beforeId"in lt&&i(10,fe=lt.beforeId),"beforeLayerType"in lt&&i(11,ve=lt.beforeLayerType),"type"in lt&&i(12,Pe=lt.type),"paint"in lt&&i(13,ue=lt.paint),"layout"in lt&&i(14,xe=lt.layout),"filter"in lt&&i(15,be=lt.filter),"applyToClusters"in lt&&i(16,Te=lt.applyToClusters),"minzoom"in lt&&i(17,we=lt.minzoom),"maxzoom"in lt&&i(18,ye=lt.maxzoom),"manageHoverState"in lt&&i(19,ze=lt.manageHoverState),"hovered"in lt&&i(6,Be=lt.hovered),"interactive"in lt&&i(20,pt=lt.interactive),"hoverCursor"in lt&&i(21,St=lt.hoverCursor),"eventsIfTopMost"in lt&&i(22,dt=lt.eventsIfTopMost),"$$scope"in lt&&i(35,ie=lt.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&i(30,s=$k(Te)),r.$$.dirty[0]&1073774592&&i(24,a=Xk("all",s,be)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&i(26,f=we??U),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&i(25,g=ye??B),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&i(29,l=J||N),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&L&&C!==re&&l){C&&(Se(C),Jt.delete(C));let lt=fe;if(!fe&&ve){let Je=L.getStyle().layers,Lt=typeof ve=="function"?ve:kt=>kt.type===ve,Ye=Je==null?void 0:Je.find(Lt);Ye&&(lt=Ye.id)}Dn(wt,C=re,C),L.addLayer(Ph({id:C,type:Pe,source:l,"source-layer":$,filter:a,paint:ue,layout:xe,minzoom:f,maxzoom:g}),lt),i(23,Ft=!0),L.on("click",C,Rn),L.on("dblclick",C,Rn),L.on("contextmenu",C,Rn),L.on("mouseenter",C,Xe),L.on("mousemove",C,Wn),L.on("mouseleave",C,dn)}r.$$.dirty[0]&1048577&&C&&Jt.set(C,{interactive:pt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&i(28,x=C?J_((lt,Je)=>L==null?void 0:L.setPaintProperty(C,lt,Je)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&i(27,E=C?J_((lt,Je)=>L==null?void 0:L.setLayoutProperty(C,lt,Je)):void 0),r.$$.dirty[0]&268443648&&(x==null||x(ue)),r.$$.dirty[0]&134234112&&(E==null||E(xe)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&C&&(L==null||L.setLayerZoomRange(C,f,g)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&C&&(Ft?i(23,Ft=!1):L==null||L.setFilter(C,a))},[C,Bt,vt,wt,ft,xt,Be,re,J,$,fe,ve,Pe,ue,xe,be,Te,we,ye,ze,pt,St,dt,Ft,a,g,f,E,x,l,s,L,N,B,U,ie,te]}class Jp extends fn{constructor(e){super(),hn(this,e,Jk,Yk,un,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function Kk(r){let e;const i=r[16].default,s=Zi(i,r,r[24],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&16777216)&&Wi(s,i,a,a[24],e?Hi(i,a[24],f,null):Xi(a[24]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function Qk(r){let e,i,s;function a(g){r[17](g)}let f={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Kk]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.hovered=r[0]),e=new Jp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ot(e.$$.fragment)},m(g,l){rt(e,g,l),s=!0},p(g,[l]){const x={};l&2&&(x.id=g[1]),l&4&&(x.source=g[2]),l&8&&(x.sourceLayer=g[3]),l&16&&(x.beforeId=g[4]),l&32&&(x.beforeLayerType=g[5]),l&64&&(x.paint=g[6]),l&128&&(x.layout=g[7]),l&256&&(x.filter=g[8]),l&512&&(x.applyToClusters=g[9]),l&1024&&(x.minzoom=g[10]),l&2048&&(x.maxzoom=g[11]),l&4096&&(x.hoverCursor=g[12]),l&8192&&(x.manageHoverState=g[13]),l&16384&&(x.eventsIfTopMost=g[14]),l&32768&&(x.interactive=g[15]),l&16777216&&(x.$$scope={dirty:l,ctx:g}),!i&&l&1&&(i=!0,x.hovered=g[0],kr(()=>i=!1)),e.$set(x)},i(g){s||(_e(e.$$.fragment,g),s=!0)},o(g){Ie(e.$$.fragment,g),s=!1},d(g){st(e,g)}}}function eI(r,e,i){let{$$slots:s={},$$scope:a}=e,{id:f=dc("circle")}=e,{source:g=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:E=void 0}=e,{paint:C}=e,{layout:L=void 0}=e,{filter:N=void 0}=e,{applyToClusters:B=void 0}=e,{minzoom:U=void 0}=e,{maxzoom:te=void 0}=e,{hoverCursor:ie=void 0}=e,{manageHoverState:re=!1}=e,{hovered:J=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:fe=!0}=e;function ve(ye){J=ye,i(0,J)}function Pe(ye){ur.call(this,r,ye)}function ue(ye){ur.call(this,r,ye)}function xe(ye){ur.call(this,r,ye)}function be(ye){ur.call(this,r,ye)}function Te(ye){ur.call(this,r,ye)}function we(ye){ur.call(this,r,ye)}return r.$$set=ye=>{"id"in ye&&i(1,f=ye.id),"source"in ye&&i(2,g=ye.source),"sourceLayer"in ye&&i(3,l=ye.sourceLayer),"beforeId"in ye&&i(4,x=ye.beforeId),"beforeLayerType"in ye&&i(5,E=ye.beforeLayerType),"paint"in ye&&i(6,C=ye.paint),"layout"in ye&&i(7,L=ye.layout),"filter"in ye&&i(8,N=ye.filter),"applyToClusters"in ye&&i(9,B=ye.applyToClusters),"minzoom"in ye&&i(10,U=ye.minzoom),"maxzoom"in ye&&i(11,te=ye.maxzoom),"hoverCursor"in ye&&i(12,ie=ye.hoverCursor),"manageHoverState"in ye&&i(13,re=ye.manageHoverState),"hovered"in ye&&i(0,J=ye.hovered),"eventsIfTopMost"in ye&&i(14,$=ye.eventsIfTopMost),"interactive"in ye&&i(15,fe=ye.interactive),"$$scope"in ye&&i(24,a=ye.$$scope)},[J,f,g,l,x,E,C,L,N,B,U,te,ie,re,$,fe,s,ve,Pe,ue,xe,be,Te,we,a]}class Kp extends fn{constructor(e){super(),hn(this,e,eI,Qk,un,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function tI(r){let e;const i=r[15].default,s=Zi(i,r,r[23],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&8388608)&&Wi(s,i,a,a[23],e?Hi(i,a[23],f,null):Xi(a[23]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function nI(r){let e,i,s;function a(g){r[16](g)}let f={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[tI]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.hovered=r[0]),e=new Jp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ot(e.$$.fragment)},m(g,l){rt(e,g,l),s=!0},p(g,[l]){const x={};l&2&&(x.id=g[1]),l&4&&(x.source=g[2]),l&8&&(x.sourceLayer=g[3]),l&16&&(x.beforeId=g[4]),l&32&&(x.beforeLayerType=g[5]),l&64&&(x.paint=g[6]),l&128&&(x.layout=g[7]),l&256&&(x.filter=g[8]),l&512&&(x.minzoom=g[9]),l&1024&&(x.maxzoom=g[10]),l&2048&&(x.hoverCursor=g[11]),l&4096&&(x.manageHoverState=g[12]),l&8192&&(x.eventsIfTopMost=g[13]),l&16384&&(x.interactive=g[14]),l&8388608&&(x.$$scope={dirty:l,ctx:g}),!i&&l&1&&(i=!0,x.hovered=g[0],kr(()=>i=!1)),e.$set(x)},i(g){s||(_e(e.$$.fragment,g),s=!0)},o(g){Ie(e.$$.fragment,g),s=!1},d(g){st(e,g)}}}function iI(r,e,i){let{$$slots:s={},$$scope:a}=e,{id:f=dc("fill")}=e,{source:g=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:E=void 0}=e,{paint:C}=e,{layout:L=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:te=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:re=null}=e,{eventsIfTopMost:J=!1}=e,{interactive:$=!0}=e;function fe(we){re=we,i(0,re)}function ve(we){ur.call(this,r,we)}function Pe(we){ur.call(this,r,we)}function ue(we){ur.call(this,r,we)}function xe(we){ur.call(this,r,we)}function be(we){ur.call(this,r,we)}function Te(we){ur.call(this,r,we)}return r.$$set=we=>{"id"in we&&i(1,f=we.id),"source"in we&&i(2,g=we.source),"sourceLayer"in we&&i(3,l=we.sourceLayer),"beforeId"in we&&i(4,x=we.beforeId),"beforeLayerType"in we&&i(5,E=we.beforeLayerType),"paint"in we&&i(6,C=we.paint),"layout"in we&&i(7,L=we.layout),"filter"in we&&i(8,N=we.filter),"minzoom"in we&&i(9,B=we.minzoom),"maxzoom"in we&&i(10,U=we.maxzoom),"hoverCursor"in we&&i(11,te=we.hoverCursor),"manageHoverState"in we&&i(12,ie=we.manageHoverState),"hovered"in we&&i(0,re=we.hovered),"eventsIfTopMost"in we&&i(13,J=we.eventsIfTopMost),"interactive"in we&&i(14,$=we.interactive),"$$scope"in we&&i(23,a=we.$$scope)},[re,f,g,l,x,E,C,L,N,B,U,te,ie,J,$,s,fe,ve,Pe,ue,xe,be,Te,a]}class mc extends fn{constructor(e){super(),hn(this,e,iI,nI,un,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function rI(r,e,i){let s;const{map:a}=pc();Ot(r,a,x=>i(4,s=x));let{position:f="top-left"}=e,{container:g=void 0}=e,l=null;return vo(()=>{s!=null&&s.loaded()&&l&&s.removeControl(l)}),r.$$set=x=>{"position"in x&&i(1,f=x.position),"container"in x&&i(2,g=x.container)},r.$$.update=()=>{if(r.$$.dirty&30&&s&&!l){let x;typeof g=="string"?x=document.querySelector(g)??void 0:x=g,i(3,l=new Ls.FullscreenControl({container:x})),s.addControl(l,f)}},[a,f,g,l,s]}class sI extends fn{constructor(e){super(),hn(this,e,rI,null,un,{position:1,container:2})}}function Bv(r,e,i,s,a){let f=!1;r.getSource(e)&&(f=!0,r.removeSource(e));const g=()=>{s(e)&&(r.addSource(e,i),a())};if(f){const l=()=>{e&&(r.getSource(e)?setTimeout(l,1):g())};l()}else g()}function Uv(r,e,i){Yb().then(()=>{let s=Df(r);if(!s)return;s.getSource(e)===i&&s.removeSource(e)})}function ey(r){let e=r[0],i,s,a=ty(r);return{c(){a.c(),i=ai()},m(f,g){a.m(f,g),ae(f,i,g),s=!0},p(f,g){g&1&&un(e,e=f[0])?(Nn(),Ie(a,1,1,nt),zn(),a=ty(f),a.c(),_e(a,1),a.m(i.parentNode,i)):a.p(f,g)},i(f){s||(_e(a),s=!0)},o(f){Ie(a),s=!1},d(f){f&&oe(i),a.d(f)}}}function ty(r){let e;const i=r[19].default,s=Zi(i,r,r[18],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&262144)&&Wi(s,i,a,a[18],e?Hi(i,a[18],f,null):Xi(a[18]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function oI(r){let e,i,s=r[0]&&ey(r);return{c(){s&&s.c(),e=ai()},m(a,f){s&&s.m(a,f),ae(a,e,f),i=!0},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=ey(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d(a)}}}function aI(r,e,i){let s,a,f,{$$slots:g={},$$scope:l}=e,{id:x=dc("geojson")}=e,{data:E}=e,{generateId:C=!1}=e,{promoteId:L=void 0}=e,{filter:N=void 0}=e,{lineMetrics:B=void 0}=e,{cluster:U=void 0}=e,{maxzoom:te=void 0}=e,{attribution:ie=void 0}=e,{buffer:re=void 0}=e,{tolerance:J=void 0}=e;const{map:$,cluster:fe,self:ve}=Fv();Ot(r,$,xe=>i(17,a=xe)),Ot(r,fe,xe=>i(20,f=xe)),Ot(r,ve,xe=>i(0,s=xe));let Pe,ue=!0;return vo(()=>{s&&Pe&&a&&(Uv($,s,Pe),Dn(ve,s=null,s),i(15,Pe=void 0))}),r.$$set=xe=>{"id"in xe&&i(4,x=xe.id),"data"in xe&&i(5,E=xe.data),"generateId"in xe&&i(6,C=xe.generateId),"promoteId"in xe&&i(7,L=xe.promoteId),"filter"in xe&&i(8,N=xe.filter),"lineMetrics"in xe&&i(9,B=xe.lineMetrics),"cluster"in xe&&i(10,U=xe.cluster),"maxzoom"in xe&&i(11,te=xe.maxzoom),"attribution"in xe&&i(12,ie=xe.attribution),"buffer"in xe&&i(13,re=xe.buffer),"tolerance"in xe&&i(14,J=xe.tolerance),"$$scope"in xe&&i(18,l=xe.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Dn(fe,f=U,f),r.$$.dirty&196593&&a&&s!==x&&(Dn(ve,s=x,s),Bv(a,s,Ph({type:"geojson",data:E,filter:N,lineMetrics:B,generateId:C,promoteId:L,cluster:!!U,clusterMinPoints:U==null?void 0:U.minPoints,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius,clusterProperties:U==null?void 0:U.properties,maxzoom:te,attribution:ie,buffer:re,tolerance:J}),xe=>a&&xe===s,()=>{s&&(i(15,Pe=a==null?void 0:a.getSource(s)),i(16,ue=!0))})),r.$$.dirty&131088&&(a==null||a.on("style.load",()=>{i(15,Pe=a==null?void 0:a.getSource(x))})),r.$$.dirty&98336&&Pe&&(ue?i(16,ue=!1):Pe.setData(E)),r.$$.dirty&33792&&(Pe==null||Pe.setClusterOptions(Ph({cluster:!!U,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius})))},[s,$,fe,ve,x,E,C,L,N,B,U,te,ie,re,J,Pe,ue,a,l,g]}class rr extends fn{constructor(e){super(),hn(this,e,aI,oI,un,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function lI(r,e,i){let s;const{map:a}=pc();Ot(r,a,N=>i(8,s=N));let{position:f="top-left"}=e,{positionOptions:g=void 0}=e,{fitBoundsOptions:l=void 0}=e,{trackUserLocation:x=!1}=e,{showAccuracyCircle:E=!0}=e,{showUserLocation:C=!0}=e,{control:L=null}=e;return vo(()=>{s!=null&&s.loaded()&&L&&s.removeControl(L)}),r.$$set=N=>{"position"in N&&i(2,f=N.position),"positionOptions"in N&&i(3,g=N.positionOptions),"fitBoundsOptions"in N&&i(4,l=N.fitBoundsOptions),"trackUserLocation"in N&&i(5,x=N.trackUserLocation),"showAccuracyCircle"in N&&i(6,E=N.showAccuracyCircle),"showUserLocation"in N&&i(7,C=N.showUserLocation),"control"in N&&i(1,L=N.control)},r.$$.update=()=>{r.$$.dirty&510&&s&&!L&&(i(1,L=new Ls.GeolocateControl({positionOptions:g,fitBoundsOptions:l,trackUserLocation:x,showAccuracyCircle:E,showUserLocation:C})),s.addControl(L,f))},[a,L,f,g,l,x,E,C,s]}class uI extends fn{constructor(e){super(),hn(this,e,lI,null,un,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function cI(r){let e;const i=r[15].default,s=Zi(i,r,r[23],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&8388608)&&Wi(s,i,a,a[23],e?Hi(i,a[23],f,null):Xi(a[23]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function hI(r){let e,i,s;function a(g){r[16](g)}let f={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[cI]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.hovered=r[0]),e=new Jp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ot(e.$$.fragment)},m(g,l){rt(e,g,l),s=!0},p(g,[l]){const x={};l&2&&(x.id=g[1]),l&4&&(x.source=g[2]),l&8&&(x.sourceLayer=g[3]),l&16&&(x.beforeId=g[4]),l&32&&(x.beforeLayerType=g[5]),l&64&&(x.paint=g[6]),l&128&&(x.layout=g[7]),l&256&&(x.filter=g[8]),l&512&&(x.minzoom=g[9]),l&1024&&(x.maxzoom=g[10]),l&2048&&(x.hoverCursor=g[11]),l&4096&&(x.manageHoverState=g[12]),l&8192&&(x.eventsIfTopMost=g[13]),l&16384&&(x.interactive=g[14]),l&8388608&&(x.$$scope={dirty:l,ctx:g}),!i&&l&1&&(i=!0,x.hovered=g[0],kr(()=>i=!1)),e.$set(x)},i(g){s||(_e(e.$$.fragment,g),s=!0)},o(g){Ie(e.$$.fragment,g),s=!1},d(g){st(e,g)}}}function fI(r,e,i){let{$$slots:s={},$$scope:a}=e,{id:f=dc("line")}=e,{source:g=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:E=void 0}=e,{paint:C}=e,{layout:L=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:te=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:re=null}=e,{eventsIfTopMost:J=!1}=e,{interactive:$=!0}=e;function fe(we){re=we,i(0,re)}function ve(we){ur.call(this,r,we)}function Pe(we){ur.call(this,r,we)}function ue(we){ur.call(this,r,we)}function xe(we){ur.call(this,r,we)}function be(we){ur.call(this,r,we)}function Te(we){ur.call(this,r,we)}return r.$$set=we=>{"id"in we&&i(1,f=we.id),"source"in we&&i(2,g=we.source),"sourceLayer"in we&&i(3,l=we.sourceLayer),"beforeId"in we&&i(4,x=we.beforeId),"beforeLayerType"in we&&i(5,E=we.beforeLayerType),"paint"in we&&i(6,C=we.paint),"layout"in we&&i(7,L=we.layout),"filter"in we&&i(8,N=we.filter),"minzoom"in we&&i(9,B=we.minzoom),"maxzoom"in we&&i(10,U=we.maxzoom),"hoverCursor"in we&&i(11,te=we.hoverCursor),"manageHoverState"in we&&i(12,ie=we.manageHoverState),"hovered"in we&&i(0,re=we.hovered),"eventsIfTopMost"in we&&i(13,J=we.eventsIfTopMost),"interactive"in we&&i(14,$=we.interactive),"$$scope"in we&&i(23,a=we.$$scope)},[re,f,g,l,x,E,C,L,N,B,U,te,ie,J,$,s,fe,ve,Pe,ue,xe,be,Te,a]}class mr extends fn{constructor(e){super(),hn(this,e,fI,hI,un,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function dI(r,e,i){let s;const a=hc();let{layer:f=void 0}=e;const{map:g}=pc();Ot(r,g,C=>i(2,s=C));function l(C){a(C.type,{...C,map:g})}const x=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],E=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return vo(()=>{if(s)if(f)for(const C of x)s.off(C,f,l);else for(const C of E)s.off(C,l)}),r.$$set=C=>{"layer"in C&&i(1,f=C.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&s)if(f)for(const C of x)s.on(C,f,l);else for(const C of E)s.on(C,l)},[g,f,s]}class jv extends fn{constructor(e){super(),hn(this,e,dI,null,un,{layer:1})}}function pI(r){let e=r.getCenter(),i=Math.round(r.getZoom()*100)/100,s=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,s),f=Math.round(e.lat*a)/a,g=Math.round(e.lng*a)/a,l=`${i}/${f}/${g}`,x=r.getBearing(),E=r.getPitch();return(x||E)&&(l+=`/${Math.round(x*10)/10}`),E&&(l+=`/${Math.round(E)}`),`#${l}`}function mI(r){return r.replace("#","").split("/").map(parseFloat)}function gI(r,e,i){let s;const{map:a}=pc();Ot(r,a,C=>i(6,s=C));let{position:f="top-left"}=e,{showCompass:g=!0}=e,{showZoom:l=!0}=e,{visualizePitch:x=!1}=e,E=null;return vo(()=>{s!=null&&s.loaded()&&E&&s.removeControl(E)}),r.$$set=C=>{"position"in C&&i(1,f=C.position),"showCompass"in C&&i(2,g=C.showCompass),"showZoom"in C&&i(3,l=C.showZoom),"visualizePitch"in C&&i(4,x=C.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&s&&!E&&(i(5,E=new Ls.NavigationControl({showCompass:g,showZoom:l,visualizePitch:x})),s.addControl(E,f))},[a,f,g,l,x,E,s]}class _I extends fn{constructor(e){super(),hn(this,e,gI,null,un,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function yI(r,e,i){let s;const{map:a}=pc();Ot(r,a,E=>i(5,s=E));let{position:f="bottom-left"}=e,{maxWidth:g=void 0}=e,{unit:l="metric"}=e,x=null;return vo(()=>{s!=null&&s.loaded()&&x&&s.removeControl(x)}),r.$$set=E=>{"position"in E&&i(1,f=E.position),"maxWidth"in E&&i(2,g=E.maxWidth),"unit"in E&&i(3,l=E.unit)},r.$$.update=()=>{r.$$.dirty&62&&s&&!x&&(i(4,x=new Ls.ScaleControl({maxWidth:g,unit:l})),s.addControl(x,f))},[a,f,g,l,x,s]}class vI extends fn{constructor(e){super(),hn(this,e,yI,null,un,{position:1,maxWidth:2,unit:3})}}const{window:bI}=Z0,xI=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),ny=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function iy(r){let e,i,s=r[3]&&ry(r);const a=r[46].default,f=Zi(a,r,r[45],ny);return{c(){s&&s.c(),e=je(),f&&f.c()},m(g,l){s&&s.m(g,l),ae(g,e,l),f&&f.m(g,l),i=!0},p(g,l){g[3]?s?(s.p(g,l),l[0]&8&&_e(s,1)):(s=ry(g),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn()),f&&f.p&&(!i||l[0]&112|l[1]&16384)&&Wi(f,a,g,g[45],i?Hi(a,g[45],l,xI):Xi(g[45]),ny)},i(g){i||(_e(s),_e(f,g),i=!0)},o(g){Ie(s),Ie(f,g),i=!1},d(g){g&&oe(e),s&&s.d(g),f&&f.d(g)}}}function ry(r){let e,i,s,a,f,g,l,x;return e=new _I({props:{position:r[7]}}),s=new uI({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),f=new sI({props:{position:r[7]}}),l=new vI({props:{position:r[7]}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment),a=je(),ot(f.$$.fragment),g=je(),ot(l.$$.fragment)},m(E,C){rt(e,E,C),ae(E,i,C),rt(s,E,C),ae(E,a,C),rt(f,E,C),ae(E,g,C),rt(l,E,C),x=!0},p(E,C){const L={};C[0]&128&&(L.position=E[7]),e.$set(L);const N={};C[0]&128&&(N.position=E[7]),s.$set(N);const B={};C[0]&128&&(B.position=E[7]),f.$set(B);const U={};C[0]&128&&(U.position=E[7]),l.$set(U)},i(E){x||(_e(e.$$.fragment,E),_e(s.$$.fragment,E),_e(f.$$.fragment,E),_e(l.$$.fragment,E),x=!0)},o(E){Ie(e.$$.fragment,E),Ie(s.$$.fragment,E),Ie(f.$$.fragment,E),Ie(l.$$.fragment,E),x=!1},d(E){E&&(oe(i),oe(a),oe(g)),st(e,E),st(s,E),st(f,E),st(l,E)}}}function wI(r){let e,i,s,a,f,g=r[4]&&r[0]&&iy(r);return{c(){e=ce("div"),g&&g.c(),He(e,"class",i=Nf(r[2])+" svelte-p00lfq"),He(e,"data-testid","map-container"),Vr(e,"expand-map",!r[2])},m(l,x){ae(l,e,x),g&&g.m(e,null),r[47](e),s=!0,a||(f=[Pt(bI,"hashchange",r[11]),pp(r[10].call(null,e))],a=!0)},p(l,x){l[4]&&l[0]?g?(g.p(l,x),x[0]&17&&_e(g,1)):(g=iy(l),g.c(),_e(g,1),g.m(e,null)):g&&(Nn(),Ie(g,1,1,()=>{g=null}),zn()),(!s||x[0]&4&&i!==(i=Nf(l[2])+" svelte-p00lfq"))&&He(e,"class",i),(!s||x[0]&4)&&Vr(e,"expand-map",!l[2])},i(l){s||(_e(g),s=!0)},o(l){Ie(g),s=!1},d(l){l&&oe(e),g&&g.d(),r[47](null),a=!1,$i(f)}}}function kI(r,e,i){let s,a,f,g,{$$slots:l={},$$scope:x}=e,{map:E=null}=e,{mapContainer:C=void 0}=e,{class:L=void 0}=e,{style:N}=e,{diffStyleUpdates:B=!1}=e,{center:U=void 0}=e,{zoom:te=void 0}=e,{pitch:ie=0}=e,{bearing:re=0}=e,{bounds:J=void 0}=e,{hash:$=!1}=e,{updateHash:fe=Ee=>{window.history.replaceState(window.history.state,"",Ee)}}=e,{loaded:ve=!1}=e,{minZoom:Pe=0}=e,{maxZoom:ue=22}=e,{minPitch:xe=0}=e,{maxPitch:be=60}=e,{renderWorldCopies:Te=void 0}=e,{dragPan:we=void 0}=e,{dragRotate:ye=void 0}=e,{pitchWithRotate:ze=void 0}=e,{antialias:Be=void 0}=e,{zoomOnDoubleClick:pt=!0}=e,{locale:St=void 0}=e,{interactive:dt=!0}=e,{attributionControl:ut=!0}=e,{cooperativeGestures:Bt=!1}=e,{preserveDrawingBuffer:vt=!1}=e,{maxBounds:wt=void 0}=e,{images:ft=[]}=e,{standardControls:xt=!1}=e,{filterLayers:It=void 0}=e,{transformRequest:Jt=void 0}=e;const pn=hc(),{map:Rn,loadedImages:Xe}=Gk();Ot(r,Rn,Ee=>i(4,f=Ee)),Ot(r,Xe,Ee=>i(5,g=Ee));let Wn=new Set;async function dn(Ee,Gt=!1){if(f&&!(!f.loaded()&&!Gt))if("url"in Ee){Wn.add(Ee.id);try{let _n=await f.loadImage(Ee.url);f==null||f.addImage(Ee.id,_n.data,Ee.options),g.add(Ee.id),Xe.set(g)}catch(_n){pn("error",_n)}finally{Wn.delete(Ee.id)}}else f.addImage(Ee.id,Ee.data,Ee.options),g.add(Ee.id),Xe.set(g)}let Ft,Se,lt,Je;function Lt(Ee){return kt(),Dn(Rn,f=new Ls.Map(Ph({container:Ee,style:N,locale:St,center:U,zoom:te,pitch:ie,bearing:re,minZoom:Pe,maxZoom:ue,minPitch:xe,maxPitch:be,renderWorldCopies:Te,dragPan:we,dragRotate:ye,pitchWithRotate:ze,antialias:Be,interactive:dt,preserveDrawingBuffer:vt,maxBounds:wt,bounds:J,attributionControl:ut,transformRequest:Jt,cooperativeGestures:Bt})),f),f.on("load",Gt=>{Gt.target.getContainer().setAttribute("data-testid","map"),Gt.target.getCanvas().setAttribute("data-testid","map-canvas"),i(0,ve=!0),pn("load",f)}),f.on("error",Gt=>pn("error",{...Gt,map:f})),f.on("movestart",Gt=>pn("movestart",{...Gt,map:f})),f.on("moveend",Gt=>{if(i(12,U=Gt.target.getCenter()),i(13,te=Gt.target.getZoom()),i(14,ie=Gt.target.getPitch()),i(15,re=Gt.target.getBearing()),i(16,J=Gt.target.getBounds()),pn("moveend",{...Gt,map:f}),$){let _n=new URL(window.location.href.replace(/(#.+)?$/,pI(f)));fe(_n)}}),f.on("click",Gt=>pn("click",{...Gt,map:f})),f.on("dblclick",Gt=>pn("dblclick",{...Gt,map:f})),f.on("contextmenu",Gt=>pn("contextmenu",{...Gt,map:f})),f.on("zoomstart",Gt=>pn("zoomstart",{...Gt,map:f})),f.on("zoom",Gt=>{pn("zoom",{...Gt,map:f})}),f.on("zoomend",Gt=>{pn("zoomend",{...Gt,map:f})}),f.on("style.load",()=>{if(f){const Gt=f.getStyle();if(i(42,Ft=Gt.layers.map(_n=>_n.id)),i(43,Se=Object.keys(Gt.sources)),Je)for(const[_n,Kn]of Object.entries(Je))f.addSource(_n,Kn);if(lt)for(const _n of lt)f.addLayer(_n);for(const _n of ft)dn(_n,!0)}}),f.on("styledata",Gt=>{if(f&&It){const _n=f.getStyle().layers;if(_n)for(let Kn of _n)It(Kn)||f.setLayoutProperty(Kn.id,"visibility","none")}pn("styledata",{...Gt,map:f})}),{destroy(){i(0,ve=!1),f==null||f.remove(),Dn(Rn,f=null,f)}}}let Ye=N;function kt(){if($){let Ee=mI(window.location.hash);Ee.length>=3&&(i(13,te=Ee[0]),i(12,U=[Ee[2],Ee[1]])),Ee.length==5&&(i(15,re=Ee[3]),i(14,ie=Ee[4]))}}function Vt(Ee){Jn[Ee?"unshift":"push"](()=>{C=Ee,i(1,C)})}return r.$$set=Ee=>{"map"in Ee&&i(17,E=Ee.map),"mapContainer"in Ee&&i(1,C=Ee.mapContainer),"class"in Ee&&i(2,L=Ee.class),"style"in Ee&&i(18,N=Ee.style),"diffStyleUpdates"in Ee&&i(19,B=Ee.diffStyleUpdates),"center"in Ee&&i(12,U=Ee.center),"zoom"in Ee&&i(13,te=Ee.zoom),"pitch"in Ee&&i(14,ie=Ee.pitch),"bearing"in Ee&&i(15,re=Ee.bearing),"bounds"in Ee&&i(16,J=Ee.bounds),"hash"in Ee&&i(20,$=Ee.hash),"updateHash"in Ee&&i(21,fe=Ee.updateHash),"loaded"in Ee&&i(0,ve=Ee.loaded),"minZoom"in Ee&&i(22,Pe=Ee.minZoom),"maxZoom"in Ee&&i(23,ue=Ee.maxZoom),"minPitch"in Ee&&i(24,xe=Ee.minPitch),"maxPitch"in Ee&&i(25,be=Ee.maxPitch),"renderWorldCopies"in Ee&&i(26,Te=Ee.renderWorldCopies),"dragPan"in Ee&&i(27,we=Ee.dragPan),"dragRotate"in Ee&&i(28,ye=Ee.dragRotate),"pitchWithRotate"in Ee&&i(29,ze=Ee.pitchWithRotate),"antialias"in Ee&&i(30,Be=Ee.antialias),"zoomOnDoubleClick"in Ee&&i(31,pt=Ee.zoomOnDoubleClick),"locale"in Ee&&i(32,St=Ee.locale),"interactive"in Ee&&i(33,dt=Ee.interactive),"attributionControl"in Ee&&i(34,ut=Ee.attributionControl),"cooperativeGestures"in Ee&&i(35,Bt=Ee.cooperativeGestures),"preserveDrawingBuffer"in Ee&&i(36,vt=Ee.preserveDrawingBuffer),"maxBounds"in Ee&&i(37,wt=Ee.maxBounds),"images"in Ee&&i(38,ft=Ee.images),"standardControls"in Ee&&i(3,xt=Ee.standardControls),"filterLayers"in Ee&&i(39,It=Ee.filterLayers),"transformRequest"in Ee&&i(40,Jt=Ee.transformRequest),"$$scope"in Ee&&i(45,x=Ee.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&i(7,s=typeof xt=="boolean"?void 0:xt),r.$$.dirty[0]&16&&i(17,E=f),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&f&&!Gu(N,Ye)){const Ee=f.getStyle();if(Ft&&(lt=Ee.layers.filter(Gt=>!Ft.includes(Gt.id))),Se){const Gt=Object.keys(Ee.sources).filter(_n=>!Se.includes(_n));Je={};for(const _n of Gt)Je[_n]=Ee.sources[_n]}i(44,Ye=N),f.setStyle(N,{diff:B}),Dn(Xe,g=new Set,g),i(41,Wn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&ve&&f!=null&&f.loaded())for(let Ee of ft)!g.has(Ee.id)&&!Wn.has(Ee.id)&&!f.hasImage(Ee.id)&&dn(Ee);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&i(6,a=ft.every(Ee=>g.has(Ee.id))),r.$$.dirty[0]&61456&&f){let Ee={};U!=null&&!Gu(U,f==null?void 0:f.getCenter())&&(Ee.center=U),te!=null&&!Gu(te,f==null?void 0:f.getZoom())&&(Ee.zoom=te),re!=null&&!Gu(re,f==null?void 0:f.getBearing())&&(Ee.bearing=re),ie!=null&&!Gu(ie,f==null?void 0:f.getPitch())&&(Ee.pitch=ie),Object.keys(Ee).length&&f.easeTo(Ee)}r.$$.dirty[0]&65552&&J&&!Gu(J,f==null?void 0:f.getBounds())&&(f==null||f.fitBounds(J)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(pt?f==null||f.doubleClickZoom.enable():f==null||f.doubleClickZoom.disable())},[ve,C,L,xt,f,g,a,s,Rn,Xe,Lt,kt,U,te,ie,re,J,E,N,B,$,fe,Pe,ue,xe,be,Te,we,ye,ze,Be,pt,St,dt,ut,Bt,vt,wt,ft,It,Jt,Wn,Ft,Se,Ye,x,l,Vt]}class II extends fn{constructor(e){super(),hn(this,e,kI,wI,un,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const SI=r=>({marker:r&8}),sy=r=>({marker:r[3]});function EI(r){let e,i,s,a,f,g,l;const x=r[19].default,E=Zi(x,r,r[18],sy);return{c(){e=ce("div"),E&&E.c(),He(e,"tabindex",i=r[1]?0:void 0),He(e,"role",s=r[1]?"button":void 0),Un(e,"z-index",r[2])},m(C,L){ae(C,e,L),E&&E.m(e,null),f=!0,g||(l=[pp(r[7].call(null,e)),pp(a=TI.call(null,e,r[0])),Pt(e,"click",np(r[20])),Pt(e,"dblclick",np(r[21])),Pt(e,"contextmenu",np(Nh(r[22]))),Pt(e,"mouseenter",r[23]),Pt(e,"mouseleave",r[24]),Pt(e,"mousemove",r[25]),Pt(e,"keydown",r[8])],g=!0)},p(C,[L]){E&&E.p&&(!f||L&262152)&&Wi(E,x,C,C[18],f?Hi(x,C[18],L,SI):Xi(C[18]),sy),(!f||L&2&&i!==(i=C[1]?0:void 0))&&He(e,"tabindex",i),(!f||L&2&&s!==(s=C[1]?"button":void 0))&&He(e,"role",s),a&&nu(a.update)&&L&1&&a.update.call(null,C[0]),L&4&&Un(e,"z-index",C[2])},i(C){f||(_e(E,C),f=!0)},o(C){Ie(E,C),f=!1},d(C){C&&oe(e),E&&E.d(C),g=!1,$i(l)}}}function TI(r,e){const i=r.className;function s(a){a?r.className=`${i} ${a}`:r.className=i}return s(e),{update:s}}function CI(r,e,i){let s,a,f,{$$slots:g={},$$scope:l}=e,{marker:x=void 0}=e,{lngLat:E}=e,{class:C=void 0}=e,{interactive:L=!0}=e,{asButton:N=!1}=e,{draggable:B=!1}=e,{feature:U=null}=e,{offset:te=void 0}=e,{zIndex:ie=void 0}=e,{rotation:re=0}=e,{opacity:J=1}=e;const $=hc(),{map:fe,layerEvent:ve,self:Pe,markerClickManager:ue}=Hk();Ot(r,fe,ut=>i(27,f=ut)),Ot(r,ve,ut=>i(26,s=ut)),Ot(r,Pe,ut=>i(3,a=ut));function xe(ut){Dn(Pe,a=new Ls.Marker({element:ut,rotation:re,draggable:B,offset:te,opacity:J.toString()}).setLngLat(E).addTo(f),a),i(11,x=a);const Bt=()=>we("dragstart"),vt=()=>{be(),we("drag")},wt=()=>{be(),we("dragend")};return B&&(a.on("dragstart",Bt),a.on("drag",vt),a.on("dragend",wt)),{destroy(){B&&(a==null||a.off("dragstart",Bt),a==null||a.off("drag",vt),a==null||a.off("dragend",wt)),i(11,x=void 0),a==null||a.remove()}}}function be(){let ut=a==null?void 0:a.getLngLat();ut&&(Array.isArray(E)?i(10,E=[ut.lng,ut.lat]):E&&"lon"in E?i(10,E={lon:ut.lng,lat:ut.lat}):i(10,E=ut))}function Te(ut){ut.key===" "&&(ut.preventDefault(),ut.stopPropagation(),we("click"))}function we(ut){if(!L)return;let Bt=a==null?void 0:a.getLngLat();if(!Bt)return;const vt=[Bt.lng,Bt.lat];let wt={map:f,marker:a,lngLat:vt,features:[{type:"Feature",properties:(U==null?void 0:U.properties)??{},geometry:{type:"Point",coordinates:vt}}]};(ut==="click"||ut==="contextmenu")&&ue.handleClick(wt),Dn(ve,s={...wt,layerType:"marker",type:ut},s),$(ut,wt)}const ye=()=>we("click"),ze=()=>we("dblclick"),Be=()=>{we("contextmenu")},pt=()=>{we("mouseenter")},St=()=>{we("mouseleave")},dt=()=>we("mousemove");return r.$$set=ut=>{"marker"in ut&&i(11,x=ut.marker),"lngLat"in ut&&i(10,E=ut.lngLat),"class"in ut&&i(0,C=ut.class),"interactive"in ut&&i(12,L=ut.interactive),"asButton"in ut&&i(1,N=ut.asButton),"draggable"in ut&&i(13,B=ut.draggable),"feature"in ut&&i(14,U=ut.feature),"offset"in ut&&i(15,te=ut.offset),"zIndex"in ut&&i(2,ie=ut.zIndex),"rotation"in ut&&i(16,re=ut.rotation),"opacity"in ut&&i(17,J=ut.opacity),"$$scope"in ut&&i(18,l=ut.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(a==null||a.setLngLat(E)),r.$$.dirty&32776&&(a==null||a.setOffset(te??[0,0])),r.$$.dirty&65544&&(a==null||a.setRotation(re)),r.$$.dirty&131080&&(a==null||a.setOpacity(J.toString()))},[C,N,ie,a,fe,ve,Pe,xe,Te,we,E,x,L,B,U,te,re,J,l,g,ye,ze,Be,pt,St,dt]}class Zf extends fn{constructor(e){super(),hn(this,e,CI,EI,un,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function oy(r){let e=r[0],i,s,a=ay(r);return{c(){a.c(),i=ai()},m(f,g){a.m(f,g),ae(f,i,g),s=!0},p(f,g){g&1&&un(e,e=f[0])?(Nn(),Ie(a,1,1,nt),zn(),a=ay(f),a.c(),_e(a,1),a.m(i.parentNode,i)):a.p(f,g)},i(f){s||(_e(a),s=!0)},o(f){Ie(a),s=!1},d(f){f&&oe(i),a.d(f)}}}function ay(r){let e;const i=r[15].default,s=Zi(i,r,r[14],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&16384)&&Wi(s,i,a,a[14],e?Hi(i,a[14],f,null):Xi(a[14]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function LI(r){let e,i,s=r[0]&&oy(r);return{c(){s&&s.c(),e=ai()},m(a,f){s&&s.m(a,f),ae(a,e,f),i=!0},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=oy(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d(a)}}}function MI(r,e,i){let s,a,{$$slots:f={},$$scope:g}=e,{id:l=dc("vector")}=e,{url:x=null}=e,{tiles:E=null}=e,{promoteId:C=null}=e,{bounds:L=null}=e,{scheme:N=null}=e,{attribution:B=null}=e,{minzoom:U=null}=e,{maxzoom:te=null}=e,{volatile:ie=null}=e;if(x&&x.includes("pmtiles://")&&!Ls.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let fe=new Ik;Ls.addProtocol("pmtiles",fe.tile)}const{map:re,self:J}=Fv();Ot(r,re,fe=>i(13,a=fe)),Ot(r,J,fe=>i(0,s=fe));let $;return vo(()=>{s&&a&&(Uv(re,s,$),Dn(J,s=null,s),$=void 0)}),r.$$set=fe=>{"id"in fe&&i(3,l=fe.id),"url"in fe&&i(4,x=fe.url),"tiles"in fe&&i(5,E=fe.tiles),"promoteId"in fe&&i(6,C=fe.promoteId),"bounds"in fe&&i(7,L=fe.bounds),"scheme"in fe&&i(8,N=fe.scheme),"attribution"in fe&&i(9,B=fe.attribution),"minzoom"in fe&&i(10,U=fe.minzoom),"maxzoom"in fe&&i(11,te=fe.maxzoom),"volatile"in fe&&i(12,ie=fe.volatile),"$$scope"in fe&&i(14,g=fe.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&a&&s!==l&&(Dn(J,s=l,s),Bv(a,s,Ph({type:"vector",url:x,tiles:E,promoteId:C,bounds:L,scheme:N,attribution:B,minzoom:U,maxzoom:te,volatile:ie}),fe=>a&&fe===s,()=>{s&&($=a==null?void 0:a.getSource(s))})),r.$$.dirty&8200&&(a==null||a.on("style.load",()=>{$=a==null?void 0:a.getSource(l)}))},[s,re,J,l,x,E,C,L,N,B,U,te,ie,a,g,f]}class Qp extends fn{constructor(e){super(),hn(this,e,MI,LI,un,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const AI=r=>({}),ly=r=>({}),PI=r=>({}),uy=r=>({}),RI=r=>({}),cy=r=>({}),DI=r=>({}),hy=r=>({});function NI(r){let e,i,s,a,f,g,l,x,E;const C=r[1].top,L=Zi(C,r,r[0],hy),N=r[1].left,B=Zi(N,r,r[0],cy),U=r[1].main,te=Zi(U,r,r[0],uy),ie=r[1].right,re=Zi(ie,r,r[0],ly);return{c(){e=ce("div"),L&&L.c(),i=je(),s=ce("div"),a=ce("div"),B&&B.c(),f=je(),g=ce("div"),te&&te.c(),l=je(),x=ce("div"),re&&re.c(),He(e,"class","top svelte-11kzs8g"),He(a,"class","left svelte-11kzs8g"),He(g,"class","main svelte-11kzs8g"),He(x,"class","right svelte-11kzs8g"),He(s,"class","main-row svelte-11kzs8g")},m(J,$){ae(J,e,$),L&&L.m(e,null),ae(J,i,$),ae(J,s,$),Z(s,a),B&&B.m(a,null),Z(s,f),Z(s,g),te&&te.m(g,null),Z(s,l),Z(s,x),re&&re.m(x,null),E=!0},p(J,[$]){L&&L.p&&(!E||$&1)&&Wi(L,C,J,J[0],E?Hi(C,J[0],$,DI):Xi(J[0]),hy),B&&B.p&&(!E||$&1)&&Wi(B,N,J,J[0],E?Hi(N,J[0],$,RI):Xi(J[0]),cy),te&&te.p&&(!E||$&1)&&Wi(te,U,J,J[0],E?Hi(U,J[0],$,PI):Xi(J[0]),uy),re&&re.p&&(!E||$&1)&&Wi(re,ie,J,J[0],E?Hi(ie,J[0],$,AI):Xi(J[0]),ly)},i(J){E||(_e(L,J),_e(B,J),_e(te,J),_e(re,J),E=!0)},o(J){Ie(L,J),Ie(B,J),Ie(te,J),Ie(re,J),E=!1},d(J){J&&(oe(e),oe(i),oe(s)),L&&L.d(J),B&&B.d(J),te&&te.d(J),re&&re.d(J)}}}function zI(r,e,i){let{$$slots:s={},$$scope:a}=e;return r.$$set=f=>{"$$scope"in f&&i(0,a=f.$$scope)},[a,s]}class OI extends fn{constructor(e){super(),hn(this,e,zI,NI,un,{})}}const FI=r=>({}),fy=r=>({}),BI=r=>({}),dy=r=>({}),UI=r=>({}),py=r=>({});function jI(r){let e,i,s,a,f,g;const l=r[4].left,x=Zi(l,r,r[3],py),E=r[4].map,C=Zi(E,r,r[3],dy),L=r[4].right,N=Zi(L,r,r[3],fy);return{c(){e=ce("div"),x&&x.c(),i=je(),s=ce("div"),C&&C.c(),a=je(),f=ce("div"),N&&N.c()},m(B,U){ae(B,e,U),x&&x.m(e,null),r[5](e),ae(B,i,U),ae(B,s,U),C&&C.m(s,null),r[6](s),ae(B,a,U),ae(B,f,U),N&&N.m(f,null),r[7](f),g=!0},p(B,[U]){x&&x.p&&(!g||U&8)&&Wi(x,l,B,B[3],g?Hi(l,B[3],U,UI):Xi(B[3]),py),C&&C.p&&(!g||U&8)&&Wi(C,E,B,B[3],g?Hi(E,B[3],U,BI):Xi(B[3]),dy),N&&N.p&&(!g||U&8)&&Wi(N,L,B,B[3],g?Hi(L,B[3],U,FI):Xi(B[3]),fy)},i(B){g||(_e(x,B),_e(C,B),_e(N,B),g=!0)},o(B){Ie(x,B),Ie(C,B),Ie(N,B),g=!1},d(B){B&&(oe(e),oe(i),oe(s),oe(a),oe(f)),x&&x.d(B),r[5](null),C&&C.d(B),r[6](null),N&&N.d(B),r[7](null)}}}function VI(r,e,i){let s,a,f;Ot(r,Pp,L=>i(0,s=L)),Ot(r,Dp,L=>i(1,a=L)),Ot(r,Rp,L=>i(2,f=L));let{$$slots:g={},$$scope:l}=e;function x(L){Jn[L?"unshift":"push"](()=>{s=L,Pp.set(s)})}function E(L){Jn[L?"unshift":"push"](()=>{a=L,Dp.set(a)})}function C(L){Jn[L?"unshift":"push"](()=>{f=L,Rp.set(f)})}return r.$$set=L=>{"$$scope"in L&&i(3,l=L.$$scope)},[s,a,f,l,g,x,E,C]}class gc extends fn{constructor(e){super(),hn(this,e,VI,jI,un,{})}}let Pp=Yn(null),Rp=Yn(null),Dp=Yn(null);function my(r){let e,i;return{c(){e=ce("div"),i=Fe(r[0]),He(e,"class","svelte-1uuov7f")},m(s,a){ae(s,e,a),Z(e,i)},p(s,a){a&1&&Mt(i,s[0])},d(s){s&&oe(e)}}}function qI(r){let e,i=r[0]&&my(r);return{c(){i&&i.c(),e=ai()},m(s,a){i&&i.m(s,a),ae(s,e,a)},p(s,[a]){s[0]?i?i.p(s,a):(i=my(s),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:nt,o:nt,d(s){s&&oe(e),i&&i.d(s)}}}function GI(r,e,i){let{loading:s}=e;return r.$$set=a=>{"loading"in a&&i(0,s=a.loading)},[s]}class ZI extends fn{constructor(e){super(),hn(this,e,GI,qI,un,{loading:0})}}const HI=r=>({dialog:r&1}),gy=r=>({dialog:r[0]});function WI(r){let e,i,s,a,f;const g=r[4].default,l=Zi(g,r,r[3],gy);return{c(){e=ce("dialog"),i=ce("article"),l&&l.c(),e.open=!0},m(x,E){ae(x,e,E),Z(e,i),l&&l.m(i,null),r[6](e),s=!0,a||(f=[Pt(window,"click",r[1]),Pt(window,"keydown",r[2]),Pt(e,"close",r[5])],a=!0)},p(x,[E]){l&&l.p&&(!s||E&9)&&Wi(l,g,x,x[3],s?Hi(g,x[3],E,HI):Xi(x[3]),gy)},i(x){s||(_e(l,x),s=!0)},o(x){Ie(l,x),s=!1},d(x){x&&oe(e),l&&l.d(x),r[6](null),a=!1,$i(f)}}}function XI(r,e,i){let{$$slots:s={},$$scope:a}=e,f;function g(C){f.open&&C.target==f&&f.close()}function l(C){(C.key=="Escape"||C.key=="Enter")&&(C.stopPropagation(),f.close())}function x(C){ur.call(this,r,C)}function E(C){Jn[C?"unshift":"push"](()=>{f=C,i(0,f)})}return r.$$set=C=>{"$$scope"in C&&i(3,a=C.$$scope)},[f,g,l,a,s,x,E]}class Vv extends fn{constructor(e){super(),hn(this,e,XI,WI,un,{})}}function _y(r,e,i){const s=r.slice();return s[1]=e[i][0],s[2]=e[i][1],s}function yy(r){let e,i,s=r[1]+"",a,f,g,l=r[2]+"",x,E;return{c(){e=ce("tr"),i=ce("td"),a=Fe(s),f=je(),g=ce("td"),x=Fe(l),E=je()},m(C,L){ae(C,e,L),Z(e,i),Z(i,a),Z(e,f),Z(e,g),Z(g,x),Z(e,E)},p(C,L){L&1&&s!==(s=C[1]+"")&&Mt(a,s),L&1&&l!==(l=C[2]+"")&&Mt(x,l)},d(C){C&&oe(e)}}}function $I(r){let e,i,s=Hn(Object.entries(r[0])),a=[];for(let f=0;f<s.length;f+=1)a[f]=yy(_y(r,s,f));return{c(){e=ce("table"),i=ce("tbody");for(let f=0;f<a.length;f+=1)a[f].c();He(e,"class","svelte-lh2o9l")},m(f,g){ae(f,e,g),Z(e,i);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(i,null)},p(f,[g]){if(g&1){s=Hn(Object.entries(f[0]));let l;for(l=0;l<s.length;l+=1){const x=_y(f,s,l);a[l]?a[l].p(x,g):(a[l]=yy(x),a[l].c(),a[l].m(i,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=s.length}},i:nt,o:nt,d(f){f&&oe(e),Sr(a,f)}}}function YI(r,e,i){let{properties:s}=e;return r.$$set=a=>{"properties"in a&&i(0,s=a.properties)},[s]}class JI extends fn{constructor(e){super(),hn(this,e,YI,$I,un,{properties:0})}}function vy(r,e,i){const s=r.slice();return s[3]=e[i],s}function by(r,e,i){const s=r.slice();return s[6]=e[i],s}function xy(r){let e,i;return{c(){e=ce("span"),i=Fe(`
    `),Un(e,"background",r[6]),Un(e,"width","100%"),Un(e,"border","1px solid black")},m(s,a){ae(s,e,a),Z(e,i)},p(s,a){a&1&&Un(e,"background",s[6])},d(s){s&&oe(e)}}}function KI(r){let e,i=r[3]+"",s;return{c(){e=ce("span"),s=Fe(i)},m(a,f){ae(a,e,f),Z(e,s)},p(a,f){f&2&&i!==(i=a[3]+"")&&Mt(s,i)},d(a){a&&oe(e)}}}function QI(r){let e,i=r[3].toFixed(r[2])+"",s;return{c(){e=ce("span"),s=Fe(i)},m(a,f){ae(a,e,f),Z(e,s)},p(a,f){f&6&&i!==(i=a[3].toFixed(a[2])+"")&&Mt(s,i)},d(a){a&&oe(e)}}}function wy(r){let e;function i(f,g){return f[2]>0?QI:KI}let s=i(r),a=s(r);return{c(){a.c(),e=ai()},m(f,g){a.m(f,g),ae(f,e,g)},p(f,g){s===(s=i(f))&&a?a.p(f,g):(a.d(1),a=s(f),a&&(a.c(),a.m(e.parentNode,e)))},d(f){f&&oe(e),a.d(f)}}}function eS(r){let e,i,s,a=Hn(r[0]),f=[];for(let x=0;x<a.length;x+=1)f[x]=xy(by(r,a,x));let g=Hn(r[1]),l=[];for(let x=0;x<g.length;x+=1)l[x]=wy(vy(r,g,x));return{c(){e=ce("div");for(let x=0;x<f.length;x+=1)f[x].c();i=je(),s=ce("div");for(let x=0;x<l.length;x+=1)l[x].c();Un(e,"display","flex"),Un(s,"display","flex"),Un(s,"justify-content","space-between")},m(x,E){ae(x,e,E);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(e,null);ae(x,i,E),ae(x,s,E);for(let C=0;C<l.length;C+=1)l[C]&&l[C].m(s,null)},p(x,[E]){if(E&1){a=Hn(x[0]);let C;for(C=0;C<a.length;C+=1){const L=by(x,a,C);f[C]?f[C].p(L,E):(f[C]=xy(L),f[C].c(),f[C].m(e,null))}for(;C<f.length;C+=1)f[C].d(1);f.length=a.length}if(E&6){g=Hn(x[1]);let C;for(C=0;C<g.length;C+=1){const L=vy(x,g,C);l[C]?l[C].p(L,E):(l[C]=wy(L),l[C].c(),l[C].m(s,null))}for(;C<l.length;C+=1)l[C].d(1);l.length=g.length}},i:nt,o:nt,d(x){x&&(oe(e),oe(i),oe(s)),Sr(f,x),Sr(l,x)}}}function tS(r,e,i){let{colorScale:s}=e,{limits:a}=e,{decimalPlaces:f=0}=e;return r.$$set=g=>{"colorScale"in g&&i(0,s=g.colorScale),"limits"in g&&i(1,a=g.limits),"decimalPlaces"in g&&i(2,f=g.decimalPlaces)},[s,a,f]}class em extends fn{constructor(e){super(),hn(this,e,tS,eS,un,{colorScale:0,limits:1,decimalPlaces:2})}}function wl(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let _t;const Ma=new Array(128).fill(void 0);Ma.push(void 0,null,!0,!1);function En(r){return Ma[r]}let Ih=Ma.length;function nS(r){r<132||(Ma[r]=Ih,Ih=r)}function ji(r){const e=En(r);return nS(r),e}const qv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&qv.decode();let _h=null;function nc(){return(_h===null||_h.byteLength===0)&&(_h=new Uint8Array(_t.memory.buffer)),_h}function Vi(r,e){return r=r>>>0,qv.decode(nc().subarray(r,r+e))}function Li(r){Ih===Ma.length&&Ma.push(Ma.length+1);const e=Ih;return Ih=Ma[e],Ma[e]=r,e}let Do=0;const Pf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},iS=typeof Pf.encodeInto=="function"?function(r,e){return Pf.encodeInto(r,e)}:function(r,e){const i=Pf.encode(r);return e.set(i),{read:r.length,written:i.length}};function tu(r,e,i){if(i===void 0){const l=Pf.encode(r),x=e(l.length,1)>>>0;return nc().subarray(x,x+l.length).set(l),Do=l.length,x}let s=r.length,a=e(s,1)>>>0;const f=nc();let g=0;for(;g<s;g++){const l=r.charCodeAt(g);if(l>127)break;f[a+g]=l}if(g!==s){g!==0&&(r=r.slice(g)),a=i(a,s,s=g+r.length*3,1)>>>0;const l=nc().subarray(a+g,a+s),x=iS(r,l);g+=x.written,a=i(a,s,g,1)>>>0}return Do=g,a}function Ql(r){return r==null}let Kl=null;function Ct(){return(Kl===null||Kl.buffer.detached===!0||Kl.buffer.detached===void 0&&Kl.buffer!==_t.memory.buffer)&&(Kl=new DataView(_t.memory.buffer)),Kl}function Np(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const a=r.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=r.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(r)){const a=r.length;let f="[";a>0&&(f+=Np(r[0]));for(let g=1;g<a;g++)f+=", "+Np(r[g]);return f+="]",f}const i=/\[object ([^\]]+)\]/.exec(toString.call(r));let s;if(i.length>1)s=i[1];else return toString.call(r);if(s=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:s}function rS(r,e){const i=e(r.length*1,1)>>>0;return nc().set(r,i/1),Do=r.length,i}let yh=null;function sS(){return(yh===null||yh.byteLength===0)&&(yh=new Float64Array(_t.memory.buffer)),yh}function oS(r,e){return r=r>>>0,sS().subarray(r/8,r/8+e)}function aS(r,e){return r=r>>>0,nc().subarray(r/1,r/1+e)}function ml(r,e){try{return r.apply(this,e)}catch(i){_t.__wbindgen_exn_store(Li(i))}}const ky=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>_t.__wbg_mapmodel_free(r>>>0,1));class lS{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ky.unregister(this),e}free(){const e=this.__destroy_into_raw();_t.__wbg_mapmodel_free(e,0)}constructor(e){try{const f=_t.__wbindgen_add_to_stack_pointer(-16),g=rS(e,_t.__wbindgen_malloc),l=Do;_t.mapmodel_new(f,g,l);var i=Ct().getInt32(f+4*0,!0),s=Ct().getInt32(f+4*1,!0),a=Ct().getInt32(f+4*2,!0);if(a)throw ji(s);return this.__wbg_ptr=i>>>0,ky.register(this,this.__wbg_ptr,this),this}finally{_t.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderDebug(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}getInvertedBoundary(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getInvertedBoundary(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}getBounds(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getBounds(a,this.__wbg_ptr);var e=Ct().getInt32(a+4*0,!0),i=Ct().getInt32(a+4*1,!0),s=oS(e,i).slice();return _t.__wbindgen_free(e,i*8,8),s}finally{_t.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toRouteSnapper(a,this.__wbg_ptr);var e=Ct().getInt32(a+4*0,!0),i=Ct().getInt32(a+4*1,!0),s=aS(e,i).slice();return _t.__wbindgen_free(e,i*1,1),s}finally{_t.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,i){try{const g=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_setRoute(g,this.__wbg_ptr,!Ql(e),Ql(e)?0:e,Li(i));var s=Ct().getInt32(g+4*0,!0),a=Ct().getInt32(g+4*1,!0),f=Ct().getInt32(g+4*2,!0);if(f)throw ji(a);return s>>>0}finally{_t.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_deleteRoute(a,this.__wbg_ptr,e);var i=Ct().getInt32(a+4*0,!0),s=Ct().getInt32(a+4*1,!0);if(s)throw ji(i)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){_t.mapmodel_clearAllRoutes(this.__wbg_ptr)}renderRoutes(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderRoutes(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}evaluateRoute(e){let i,s;try{const C=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateRoute(C,this.__wbg_ptr,Li(e));var a=Ct().getInt32(C+4*0,!0),f=Ct().getInt32(C+4*1,!0),g=Ct().getInt32(C+4*2,!0),l=Ct().getInt32(C+4*3,!0),x=a,E=f;if(l)throw x=0,E=0,ji(g);return i=x,s=E,Vi(x,E)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(i,s,1)}}debugReachablePath(e,i){let s,a;try{const L=_t.__wbindgen_add_to_stack_pointer(-16),N=tu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Do;_t.mapmodel_debugReachablePath(L,this.__wbg_ptr,N,B,i);var f=Ct().getInt32(L+4*0,!0),g=Ct().getInt32(L+4*1,!0),l=Ct().getInt32(L+4*2,!0),x=Ct().getInt32(L+4*3,!0),E=f,C=g;if(x)throw E=0,C=0,ji(l);return s=E,a=C,Vi(E,C)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(s,a,1)}}debugUnreachablePath(e,i){let s,a;try{const L=_t.__wbindgen_add_to_stack_pointer(-16),N=tu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Do;_t.mapmodel_debugUnreachablePath(L,this.__wbg_ptr,N,B,i);var f=Ct().getInt32(L+4*0,!0),g=Ct().getInt32(L+4*1,!0),l=Ct().getInt32(L+4*2,!0),x=Ct().getInt32(L+4*3,!0),E=f,C=g;if(x)throw E=0,C=0,ji(l);return s=E,a=C,Vi(E,C)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(s,a,1)}}evaluateOD(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateOD(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}recalculateStats(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_recalculateStats(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}toSavefile(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toSavefile(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}loadSavefile(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16),f=tu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),g=Do;_t.mapmodel_loadSavefile(a,this.__wbg_ptr,f,g);var i=Ct().getInt32(a+4*0,!0),s=Ct().getInt32(a+4*1,!0);if(s)throw ji(i)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_meshDensity(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}classifyExistingNetwork(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_classifyExistingNetwork(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}importExistingRoutes(){return _t.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return _t.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getSchools(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}getGPHospitals(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getGPHospitals(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}getTownCentres(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getTownCentres(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}getDataZones(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getDataZones(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}renderReachableNetwork(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderReachableNetwork(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}renderLevelOfService(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderLevelOfService(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}renderCoreNetwork(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderCoreNetwork(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}renderPrecalculatedFlows(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderPrecalculatedFlows(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}getMajorJunctions(){let e,i;try{const E=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getMajorJunctions(E,this.__wbg_ptr);var s=Ct().getInt32(E+4*0,!0),a=Ct().getInt32(E+4*1,!0),f=Ct().getInt32(E+4*2,!0),g=Ct().getInt32(E+4*3,!0),l=s,x=a;if(g)throw l=0,x=0,ji(f);return e=l,i=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,i,1)}}}async function uS(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const i=await r.arrayBuffer();return await WebAssembly.instantiate(i,e)}else{const i=await WebAssembly.instantiate(r,e);return i instanceof WebAssembly.Instance?{instance:i,module:r}:i}}function cS(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){ji(e)},r.wbg.__wbindgen_string_new=function(e,i){const s=Vi(e,i);return Li(s)},r.wbg.__wbindgen_string_get=function(e,i){const s=En(i),a=typeof s=="string"?s:void 0;var f=Ql(a)?0:tu(a,_t.__wbindgen_malloc,_t.__wbindgen_realloc),g=Do;Ct().setInt32(e+4*1,g,!0),Ct().setInt32(e+4*0,f,!0)},r.wbg.__wbindgen_number_get=function(e,i){const s=En(i),a=typeof s=="number"?s:void 0;Ct().setFloat64(e+8*1,Ql(a)?0:a,!0),Ct().setInt32(e+4*0,!Ql(a),!0)},r.wbg.__wbindgen_error_new=function(e,i){const s=new Error(Vi(e,i));return Li(s)},r.wbg.__wbindgen_boolean_get=function(e){const i=En(e);return typeof i=="boolean"?i?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof En(e)=="bigint"},r.wbg.__wbindgen_is_object=function(e){const i=En(e);return typeof i=="object"&&i!==null},r.wbg.__wbindgen_in=function(e,i){return En(e)in En(i)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Li(e)},r.wbg.__wbindgen_jsval_eq=function(e,i){return En(e)===En(i)},r.wbg.__wbindgen_bigint_from_u64=function(e){const i=BigInt.asUintN(64,e);return Li(i)},r.wbg.__wbindgen_is_string=function(e){return typeof En(e)=="string"},r.wbg.__wbindgen_is_undefined=function(e){return En(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,i){return En(e)==En(i)},r.wbg.__wbindgen_as_number=function(e){return+En(e)},r.wbg.__wbg_String_b9412f8799faab3e=function(e,i){const s=String(En(i)),a=tu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),f=Do;Ct().setInt32(e+4*1,f,!0),Ct().setInt32(e+4*0,a,!0)},r.wbg.__wbindgen_object_clone_ref=function(e){const i=En(e);return Li(i)},r.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,i){const s=En(e)[En(i)];return Li(s)},r.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(En(e))},r.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(En(e))},r.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(En(e))},r.wbg.__wbg_log_b103404cc5920657=function(e){console.log(En(e))},r.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(En(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Li(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,i){const s=En(i).stack,a=tu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),f=Do;Ct().setInt32(e+4*1,f,!0),Ct().setInt32(e+4*0,a,!0)},r.wbg.__wbg_error_f851667af71bcfc6=function(e,i){let s,a;try{s=e,a=i,console.error(Vi(e,i))}finally{_t.__wbindgen_free(s,a,1)}},r.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const i=En(e).performance;return Li(i)},r.wbg.__wbg_now_abd80e969af37148=function(e){return En(e).now()},r.wbg.__wbg_get_3baa728f9d58d3f6=function(e,i){const s=En(e)[i>>>0];return Li(s)},r.wbg.__wbg_length_ae22078168b726f5=function(e){return En(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof En(e)=="function"},r.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,i){const s=new Function(Vi(e,i));return Li(s)},r.wbg.__wbg_next_de3e9db4440638b2=function(e){const i=En(e).next;return Li(i)},r.wbg.__wbg_next_f9cb570345655b9a=function(){return ml(function(e){const i=En(e).next();return Li(i)},arguments)},r.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return En(e).done},r.wbg.__wbg_value_6d39332ab4788d86=function(e){const i=En(e).value;return Li(i)},r.wbg.__wbg_iterator_888179a48810a9fe=function(){return Li(Symbol.iterator)},r.wbg.__wbg_get_224d16597dbbfd96=function(){return ml(function(e,i){const s=Reflect.get(En(e),En(i));return Li(s)},arguments)},r.wbg.__wbg_call_1084a111329e68ce=function(){return ml(function(e,i){const s=En(e).call(En(i));return Li(s)},arguments)},r.wbg.__wbg_self_3093d5d1f7bcb682=function(){return ml(function(){const e=self.self;return Li(e)},arguments)},r.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return ml(function(){const e=window.window;return Li(e)},arguments)},r.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return ml(function(){const e=globalThis.globalThis;return Li(e)},arguments)},r.wbg.__wbg_global_e5a3fe56f8be9485=function(){return ml(function(){const e=global.global;return Li(e)},arguments)},r.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(En(e))},r.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let i;try{i=En(e)instanceof ArrayBuffer}catch{i=!1}return i},r.wbg.__wbg_call_89af060b4e1523f2=function(){return ml(function(e,i,s){const a=En(e).call(En(i),En(s));return Li(a)},arguments)},r.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let i;try{i=En(e)instanceof Map}catch{i=!1}return i},r.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(En(e))},r.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const i=Object.entries(En(e));return Li(i)},r.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const i=En(e).buffer;return Li(i)},r.wbg.__wbg_new_ea1883e1e5e86686=function(e){const i=new Uint8Array(En(e));return Li(i)},r.wbg.__wbg_set_d1e79e2388520f18=function(e,i,s){En(e).set(En(i),s>>>0)},r.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return En(e).length},r.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let i;try{i=En(e)instanceof Uint8Array}catch{i=!1}return i},r.wbg.__wbindgen_bigint_get_as_i64=function(e,i){const s=En(i),a=typeof s=="bigint"?s:void 0;Ct().setBigInt64(e+8*1,Ql(a)?BigInt(0):a,!0),Ct().setInt32(e+4*0,!Ql(a),!0)},r.wbg.__wbindgen_debug_string=function(e,i){const s=Np(En(i)),a=tu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),f=Do;Ct().setInt32(e+4*1,f,!0),Ct().setInt32(e+4*0,a,!0)},r.wbg.__wbindgen_throw=function(e,i){throw new Error(Vi(e,i))},r.wbg.__wbindgen_memory=function(){const e=_t.memory;return Li(e)},r}function hS(r,e){return _t=r.exports,Gv.__wbindgen_wasm_module=e,Kl=null,yh=null,_h=null,_t}async function Gv(r){if(_t!==void 0)return _t;typeof r<"u"&&Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof r>"u"&&(r=new URL("backend_bg.wasm",self.location));const e=cS();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:i,module:s}=await uS(await r,e);return hS(i,s)}class fS{constructor(){lh(this,"inner");this.inner=null}async loadFile(e){await Gv(),this.inner=new lS(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,i){return this.checkReady(),this.inner.setRoute(e??void 0,i)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,i){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,i))}debugUnreachablePath(e,i){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,i))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let Zv="MZEJTanw3WpxRvt7qDfo",Hf=Yn(""),Ni=Yn({kind:"main"}),Xu=Yn("primary"),dS=Yn(null),Rh=Yn(0),sr=Yn(null),Ju=Yn(null),Sh=Yn(null),rd=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],oc=Object.fromEntries(rd.map(([r,e,i])=>[r,[e,i]]));async function Dh(){let r=Df(sr),e=Df(Hf);if(!r||!e)return;let i=await r.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,i)}let zp=Yn(!0);function sd(r){return Df(zp)?`https://assets.od2net.org/tmp_npt_editor/${r}`:r}let Iy=Yn(null);function pS(r){let e,i,s,a,f,g,l,x;return{c(){e=ce("div"),i=ce("h2"),i.textContent="Debug network mode",s=je(),a=ce("button"),a.textContent="Back",f=je(),g=ce("p"),g.textContent="Hover to see a segment's properties, and click to open OSM",He(e,"slot","left")},m(E,C){ae(E,e,C),Z(e,i),Z(e,s),Z(e,a),Z(e,f),Z(e,g),l||(x=Pt(a,"click",r[3]),l=!0)},p:nt,d(E){E&&oe(e),l=!1,x()}}}function mS(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function gS(r){let e,i;return e=new rr({props:{data:r[4],generateId:!0,$$slots:{default:[vS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.data=s[4]),a&64&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function _S(r){let e,i;return e=new JI({props:{properties:r[5]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&32&&(f.properties=s[5]),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function yS(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[_S,({props:s})=>({5:s}),({props:s})=>s?32:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&96&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function vS(r){let e,i;return e=new mr({props:{id:"network",paint:{"line-width":Ms(5,7),"line-color":"black"},manageHoverState:!0,hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[yS]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&64&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function bS(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function xS(r){let e,i,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:bS,then:gS,catch:mS,value:4,blocks:[,,,]};return gs(i=wl(r[0]).renderDebug(),a),{c(){e=ce("div"),a.block.c(),He(e,"slot","map")},m(f,g){ae(f,e,g),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,s=!0},p(f,g){r=f,a.ctx=r,g&1&&i!==(i=wl(r[0]).renderDebug())&&gs(i,a)||kl(a,r,g)},i(f){s||(_e(a.block),s=!0)},o(f){for(let g=0;g<3;g+=1){const l=a.blocks[g];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(),a.token=null,a=null}}}function wS(r){let e,i;return e=new gc({props:{$$slots:{map:[xS],left:[pS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,[a]){const f={};a&67&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function kS(r,e,i){let s,a;return Ot(r,sr,l=>i(0,s=l)),Ot(r,Ni,l=>i(1,a=l)),[s,a,l=>window.open(wl(l.detail.features[0].properties).way,"_blank"),()=>Dn(Ni,a={kind:"main"},a)]}class IS extends fn{constructor(e){super(),hn(this,e,kS,wS,un,{})}}function SS(r){let e,i,s,a,f,g;return{c(){e=ce("div"),i=ce("h2"),i.textContent="Debug mesh density mode",s=je(),a=ce("button"),a.textContent="Back",He(e,"slot","left")},m(l,x){ae(l,e,x),Z(e,i),Z(e,s),Z(e,a),f||(g=Pt(a,"click",r[2]),f=!0)},p:nt,d(l){l&&oe(e),f=!1,g()}}}function ES(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function TS(r){let e,i;return e=new rr({props:{data:r[3],generateId:!0,$$slots:{default:[CS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.data=s[3]),a&16&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function CS(r){let e,i,s,a;return e=new mr({props:{paint:{"line-color":"black"}}}),s=new mc({props:{paint:{"fill-color":"grey","fill-opacity":Ms(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p:nt,i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function LS(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function MS(r){let e,i,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:LS,then:TS,catch:ES,value:3,blocks:[,,,]};return gs(i=wl(r[0]).meshDensity(),a),{c(){e=ce("div"),a.block.c(),He(e,"slot","map")},m(f,g){ae(f,e,g),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,s=!0},p(f,g){r=f,a.ctx=r,g&1&&i!==(i=wl(r[0]).meshDensity())&&gs(i,a)||kl(a,r,g)},i(f){s||(_e(a.block),s=!0)},o(f){for(let g=0;g<3;g+=1){const l=a.blocks[g];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(),a.token=null,a=null}}}function AS(r){let e,i;return e=new gc({props:{$$slots:{map:[MS],left:[SS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,[a]){const f={};a&19&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function PS(r,e,i){let s,a;return Ot(r,sr,g=>i(0,s=g)),Ot(r,Ni,g=>i(1,a=g)),[s,a,()=>Dn(Ni,a={kind:"main"},a)]}class RS extends fn{constructor(e){super(),hn(this,e,PS,AS,un,{})}}let Hv=Yn(new Map),Op=Yn(!0),Wf=Yn(!1),Xf=Yn(!1),$f=Yn(!1),Yf=Yn(!1),Jf=Yn(!1),Ku=Yn(!1),Fp=Yn(!0),Sy=Yn(!1);function DS(r){let e,i,s,a;const f=r[1].default,g=Zi(f,r,r[0],null);return{c(){e=ce("a"),g&&g.c(),He(e,"href","#")},m(l,x){ae(l,e,x),g&&g.m(e,null),i=!0,s||(a=Pt(e,"click",Nh(r[2])),s=!0)},p(l,[x]){g&&g.p&&(!i||x&1)&&Wi(g,f,l,l[0],i?Hi(f,l[0],x,null):Xi(l[0]),null)},i(l){i||(_e(g,l),i=!0)},o(l){Ie(g,l),i=!1},d(l){l&&oe(e),g&&g.d(l),s=!1,a()}}}function NS(r,e,i){let{$$slots:s={},$$scope:a}=e;function f(g){ur.call(this,r,g)}return r.$$set=g=>{"$$scope"in g&&i(0,a=g.$$scope)},[a,s,f]}class zS extends fn{constructor(e){super(),hn(this,e,NS,DS,un,{})}}let ds={primaryRoutes:"#c00000",secondaryRoutes:"#e97132",localAccessRoutes:"#ffc000",longDistanceRoutes:"#4ea72e"},tm={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},ac=Xp(["get","infra_type"],Object.fromEntries(rd.map(r=>[r[0],r[2]])),"red"),Bp=Xp(["get","los"],tm,"black");function OS(r){let e,i,s,a,f,g,l,x,E,C=`2px solid ${ds.primaryRoutes}`,L,N,B,U,te,ie=`2px solid ${ds.secondaryRoutes}`,re,J,$,fe,ve,Pe=`2px solid ${ds.localAccessRoutes}`,ue,xe,be,Te,we,ye=`2px solid ${ds.longDistanceRoutes}`;return{c(){e=ce("details"),i=ce("summary"),i.textContent="Basic Reference Layers",s=je(),a=ce("div"),f=je(),g=ce("details"),l=ce("summary"),l.textContent="Primary Route Reference Layers",x=je(),E=ce("div"),L=je(),N=ce("details"),B=ce("summary"),B.textContent="Secondary Route Reference Layers",U=je(),te=ce("div"),re=je(),J=ce("details"),$=ce("summary"),$.textContent="Local Access Route Reference Layers",fe=je(),ve=ce("div"),ue=je(),xe=ce("details"),be=ce("summary"),be.textContent="Long Disance Route Reference Layers",Te=je(),we=ce("div"),e.open=!0,Un(e,"border","2px solid black"),g.open=!0,Un(g,"border",C),N.open=!0,Un(N,"border",ie),J.open=!0,Un(J,"border",Pe),xe.open=!0,Un(xe,"border",ye)},m(ze,Be){ae(ze,e,Be),Z(e,i),Z(e,s),Z(e,a),r[6](a),ae(ze,f,Be),ae(ze,g,Be),Z(g,l),Z(g,x),Z(g,E),r[7](E),ae(ze,L,Be),ae(ze,N,Be),Z(N,B),Z(N,U),Z(N,te),r[8](te),ae(ze,re,Be),ae(ze,J,Be),Z(J,$),Z(J,fe),Z(J,ve),r[9](ve),ae(ze,ue,Be),ae(ze,xe,Be),Z(xe,be),Z(xe,Te),Z(xe,we),r[10](we)},p:nt,i:nt,o:nt,d(ze){ze&&(oe(e),oe(f),oe(g),oe(L),oe(N),oe(re),oe(J),oe(ue),oe(xe)),r[6](null),r[7](null),r[8](null),r[9](null),r[10](null)}}}function ph(r,e,i){if(r){r.innerHTML="";for(let s of i){let a=e.get(s);a&&r.appendChild(a)}}}function FS(r,e,i){let s;Ot(r,Hv,U=>i(5,s=U));let a=null,f=null,g=null,l=null,x=null;function E(U){Jn[U?"unshift":"push"](()=>{a=U,i(0,a)})}function C(U){Jn[U?"unshift":"push"](()=>{f=U,i(1,f)})}function L(U){Jn[U?"unshift":"push"](()=>{g=U,i(2,g)})}function N(U){Jn[U?"unshift":"push"](()=>{l=U,i(3,l)})}function B(U){Jn[U?"unshift":"push"](()=>{x=U,i(4,x)})}return r.$$.update=()=>{r.$$.dirty&33&&ph(a,s,["route network","simd","population density","core network","existing network","level of service","traffic volume","reachable network"]),r.$$.dirty&34&&ph(f,s,["high npt route coverage"]),r.$$.dirty&36&&ph(g,s,["town centres"]),r.$$.dirty&40&&ph(l,s,["schools","gp hospitals"]),r.$$.dirty&48&&ph(x,s,["urban areas"])},[a,f,g,l,x,s,E,C,L,N,B]}class BS extends fn{constructor(e){super(),hn(this,e,FS,OS,un,{})}}function US(r){let e,i,s,a,f,g=Math.round(r[2]*100)+"",l,x,E,C,L,N,B;return{c(){e=ce("p"),i=ce("a"),s=Fe(r[1]),a=Fe(`
  :
  `),f=ce("b"),l=Fe(g),x=Fe("%"),E=je(),C=ce("progress"),He(i,"href","#"),C.value=L=r[2]*100,He(C,"max","100")},m(U,te){ae(U,e,te),Z(e,i),Z(i,s),Z(e,a),Z(e,f),Z(f,l),Z(f,x),Z(e,E),Z(e,C),N||(B=Pt(i,"click",Nh(r[3])),N=!0)},p(U,[te]){te&2&&Mt(s,U[1]),te&4&&g!==(g=Math.round(U[2]*100)+"")&&Mt(l,g),te&4&&L!==(L=U[2]*100)&&(C.value=L)},i:nt,o:nt,d(U){U&&oe(e),N=!1,B()}}}function jS(r,e,i){let{label:s}=e,{showLayer:a}=e,{pct:f}=e;const g=()=>i(0,a=!0);return r.$$set=l=>{"label"in l&&i(1,s=l.label),"showLayer"in l&&i(0,a=l.showLayer),"pct"in l&&i(2,f=l.pct)},[a,s,f,g]}class Aa extends fn{constructor(e){super(),hn(this,e,jS,US,un,{label:1,showLayer:0,pct:2})}}function Ey(r,e,i){const s=r.slice();return s[22]=e[i][0],s[23]=e[i][1],s}function Ty(r,e,i){const s=r.slice();return s[22]=e[i][0],s[23]=e[i][1],s}function Cy(r){let e,i,s,a=`2px solid ${ds.primaryRoutes}`,f,g,l,x,E,C,L,N,B=r[0].average_weighted_directness.toFixed(1)+"",U,te,ie,re,J,$,fe,ve,Pe,ue,xe,be,Te,we,ye;function ze(ft){r[11](ft)}let Be={label:"High cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[0],r[0].total_flow_quintile_sums[0])};r[1]!==void 0&&(Be.showLayer=r[1]),i=new Aa({props:Be}),Jn.push(()=>Ir(i,"showLayer",ze));let pt=(r[2]=="secondary"||r[2]=="local access"||r[2]=="long distance")&&Ly(r),St=(r[2]=="local access"||r[2]=="long distance")&&My(r),dt=r[2]=="long distance"&&Ay(r),ut=Hn(Object.entries(r[0].od_percents_infra_type).toSorted(Dy)),Bt=[];for(let ft=0;ft<ut.length;ft+=1)Bt[ft]=Py(Ty(r,ut,ft));let vt=Hn(Object.entries(r[0].od_percents_los).toSorted(Ny)),wt=[];for(let ft=0;ft<vt.length;ft+=1)wt[ft]=Ry(Ey(r,vt,ft));return{c(){e=ce("div"),ot(i.$$.fragment),f=je(),pt&&pt.c(),g=je(),St&&St.c(),l=je(),dt&&dt.c(),x=je(),E=ce("div"),C=ce("p"),L=ce("a"),L.textContent="Average weighted directness",N=Fe(`
      : `),U=Fe(B),te=Fe("x"),ie=je(),re=ce("details"),J=ce("summary"),J.textContent="Percent of demand by infrastructure type",$=je(),fe=ce("ul");for(let ft=0;ft<Bt.length;ft+=1)Bt[ft].c();ve=je(),Pe=ce("details"),ue=ce("summary"),ue.textContent="Percent of demand by level of service:",xe=je(),be=ce("ul");for(let ft=0;ft<wt.length;ft+=1)wt[ft].c();Un(e,"border",a),He(L,"href","#"),Un(E,"margin-top","4px"),Un(E,"border","2px solid black")},m(ft,xt){ae(ft,e,xt),rt(i,e,null),ae(ft,f,xt),pt&&pt.m(ft,xt),ae(ft,g,xt),St&&St.m(ft,xt),ae(ft,l,xt),dt&&dt.m(ft,xt),ae(ft,x,xt),ae(ft,E,xt),Z(E,C),Z(C,L),Z(C,N),Z(C,U),Z(C,te),Z(E,ie),Z(E,re),Z(re,J),Z(re,$),Z(re,fe);for(let It=0;It<Bt.length;It+=1)Bt[It]&&Bt[It].m(fe,null);Z(E,ve),Z(E,Pe),Z(Pe,ue),Z(Pe,xe),Z(Pe,be);for(let It=0;It<wt.length;It+=1)wt[It]&&wt[It].m(be,null);Te=!0,we||(ye=Pt(L,"click",Nh(r[20])),we=!0)},p(ft,xt){const It={};if(xt&1&&(It.pct=lc(ft[0].covered_flow_quintile_sums[0],ft[0].total_flow_quintile_sums[0])),!s&&xt&2&&(s=!0,It.showLayer=ft[1],kr(()=>s=!1)),i.$set(It),ft[2]=="secondary"||ft[2]=="local access"||ft[2]=="long distance"?pt?(pt.p(ft,xt),xt&4&&_e(pt,1)):(pt=Ly(ft),pt.c(),_e(pt,1),pt.m(g.parentNode,g)):pt&&(Nn(),Ie(pt,1,1,()=>{pt=null}),zn()),ft[2]=="local access"||ft[2]=="long distance"?St?(St.p(ft,xt),xt&4&&_e(St,1)):(St=My(ft),St.c(),_e(St,1),St.m(l.parentNode,l)):St&&(Nn(),Ie(St,1,1,()=>{St=null}),zn()),ft[2]=="long distance"?dt?(dt.p(ft,xt),xt&4&&_e(dt,1)):(dt=Ay(ft),dt.c(),_e(dt,1),dt.m(x.parentNode,x)):dt&&(Nn(),Ie(dt,1,1,()=>{dt=null}),zn()),(!Te||xt&1)&&B!==(B=ft[0].average_weighted_directness.toFixed(1)+"")&&Mt(U,B),xt&1){ut=Hn(Object.entries(ft[0].od_percents_infra_type).toSorted(Dy));let Jt;for(Jt=0;Jt<ut.length;Jt+=1){const pn=Ty(ft,ut,Jt);Bt[Jt]?Bt[Jt].p(pn,xt):(Bt[Jt]=Py(pn),Bt[Jt].c(),Bt[Jt].m(fe,null))}for(;Jt<Bt.length;Jt+=1)Bt[Jt].d(1);Bt.length=ut.length}if(xt&1){vt=Hn(Object.entries(ft[0].od_percents_los).toSorted(Ny));let Jt;for(Jt=0;Jt<vt.length;Jt+=1){const pn=Ey(ft,vt,Jt);wt[Jt]?wt[Jt].p(pn,xt):(wt[Jt]=Ry(pn),wt[Jt].c(),wt[Jt].m(be,null))}for(;Jt<wt.length;Jt+=1)wt[Jt].d(1);wt.length=vt.length}},i(ft){Te||(_e(i.$$.fragment,ft),_e(pt),_e(St),_e(dt),Te=!0)},o(ft){Ie(i.$$.fragment,ft),Ie(pt),Ie(St),Ie(dt),Te=!1},d(ft){ft&&(oe(e),oe(f),oe(g),oe(l),oe(x),oe(E)),st(i),pt&&pt.d(ft),St&&St.d(ft),dt&&dt.d(ft),Sr(Bt,ft),Sr(wt,ft),we=!1,ye()}}}function Ly(r){let e,i,s,a,f,g,l=`2px solid ${ds.secondaryRoutes}`,x;function E(B){r[12](B)}let C={label:"Medium cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[1],r[0].total_flow_quintile_sums[1])};r[1]!==void 0&&(C.showLayer=r[1]),i=new Aa({props:C}),Jn.push(()=>Ir(i,"showLayer",E));function L(B){r[13](B)}let N={label:"Town centres",pct:r[0].percent_reachable_town_centres};return r[3]!==void 0&&(N.showLayer=r[3]),f=new Aa({props:N}),Jn.push(()=>Ir(f,"showLayer",L)),{c(){e=ce("div"),ot(i.$$.fragment),a=je(),ot(f.$$.fragment),Un(e,"margin-top","4px"),Un(e,"border",l)},m(B,U){ae(B,e,U),rt(i,e,null),Z(e,a),rt(f,e,null),x=!0},p(B,U){const te={};U&1&&(te.pct=lc(B[0].covered_flow_quintile_sums[1],B[0].total_flow_quintile_sums[1])),!s&&U&2&&(s=!0,te.showLayer=B[1],kr(()=>s=!1)),i.$set(te);const ie={};U&1&&(ie.pct=B[0].percent_reachable_town_centres),!g&&U&8&&(g=!0,ie.showLayer=B[3],kr(()=>g=!1)),f.$set(ie)},i(B){x||(_e(i.$$.fragment,B),_e(f.$$.fragment,B),x=!0)},o(B){Ie(i.$$.fragment,B),Ie(f.$$.fragment,B),x=!1},d(B){B&&oe(e),st(i),st(f)}}}function My(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie=`2px solid ${ds.localAccessRoutes}`,re;function J(ye){r[14](ye)}let $={label:"Low cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[2],r[0].total_flow_quintile_sums[2])};r[1]!==void 0&&($.showLayer=r[1]),i=new Aa({props:$}),Jn.push(()=>Ir(i,"showLayer",J));function fe(ye){r[15](ye)}let ve={label:"Schools",pct:r[0].percent_reachable_schools};r[4]!==void 0&&(ve.showLayer=r[4]),f=new Aa({props:ve}),Jn.push(()=>Ir(f,"showLayer",fe));function Pe(ye){r[16](ye)}let ue={label:"GPs and hospitals",pct:r[0].percent_reachable_gp_hospitals};r[5]!==void 0&&(ue.showLayer=r[5]),x=new Aa({props:ue}),Jn.push(()=>Ir(x,"showLayer",Pe));function xe(ye){r[17](ye)}let be={label:"Deprived population coverage",pct:r[0].percent_reachable_imd_population};r[6]!==void 0&&(be.showLayer=r[6]),L=new Aa({props:be}),Jn.push(()=>Ir(L,"showLayer",xe));function Te(ye){r[18](ye)}let we={label:"Population coverage",pct:r[0].percent_reachable_population};return r[7]!==void 0&&(we.showLayer=r[7]),U=new Aa({props:we}),Jn.push(()=>Ir(U,"showLayer",Te)),{c(){e=ce("div"),ot(i.$$.fragment),a=je(),ot(f.$$.fragment),l=je(),ot(x.$$.fragment),C=je(),ot(L.$$.fragment),B=je(),ot(U.$$.fragment),Un(e,"margin-top","4px"),Un(e,"border",ie)},m(ye,ze){ae(ye,e,ze),rt(i,e,null),Z(e,a),rt(f,e,null),Z(e,l),rt(x,e,null),Z(e,C),rt(L,e,null),Z(e,B),rt(U,e,null),re=!0},p(ye,ze){const Be={};ze&1&&(Be.pct=lc(ye[0].covered_flow_quintile_sums[2],ye[0].total_flow_quintile_sums[2])),!s&&ze&2&&(s=!0,Be.showLayer=ye[1],kr(()=>s=!1)),i.$set(Be);const pt={};ze&1&&(pt.pct=ye[0].percent_reachable_schools),!g&&ze&16&&(g=!0,pt.showLayer=ye[4],kr(()=>g=!1)),f.$set(pt);const St={};ze&1&&(St.pct=ye[0].percent_reachable_gp_hospitals),!E&&ze&32&&(E=!0,St.showLayer=ye[5],kr(()=>E=!1)),x.$set(St);const dt={};ze&1&&(dt.pct=ye[0].percent_reachable_imd_population),!N&&ze&64&&(N=!0,dt.showLayer=ye[6],kr(()=>N=!1)),L.$set(dt);const ut={};ze&1&&(ut.pct=ye[0].percent_reachable_population),!te&&ze&128&&(te=!0,ut.showLayer=ye[7],kr(()=>te=!1)),U.$set(ut)},i(ye){re||(_e(i.$$.fragment,ye),_e(f.$$.fragment,ye),_e(x.$$.fragment,ye),_e(L.$$.fragment,ye),_e(U.$$.fragment,ye),re=!0)},o(ye){Ie(i.$$.fragment,ye),Ie(f.$$.fragment,ye),Ie(x.$$.fragment,ye),Ie(L.$$.fragment,ye),Ie(U.$$.fragment,ye),re=!1},d(ye){ye&&oe(e),st(i),st(f),st(x),st(L),st(U)}}}function Ay(r){let e,i,s,a=`2px solid ${ds.longDistanceRoutes}`,f;function g(x){r[19](x)}let l={label:"Reachable settlements (TODO)",pct:0};return r[8]!==void 0&&(l.showLayer=r[8]),i=new Aa({props:l}),Jn.push(()=>Ir(i,"showLayer",g)),{c(){e=ce("div"),ot(i.$$.fragment),Un(e,"margin-top","4px"),Un(e,"border",a)},m(x,E){ae(x,e,E),rt(i,e,null),f=!0},p(x,E){const C={};!s&&E&256&&(s=!0,C.showLayer=x[8],kr(()=>s=!1)),i.$set(C)},i(x){f||(_e(i.$$.fragment,x),f=!0)},o(x){Ie(i.$$.fragment,x),f=!1},d(x){x&&oe(e),st(i)}}}function Py(r){let e,i=r[22]+"",s,a,f=Math.round(r[23]*100)+"",g,l;return{c(){e=ce("li"),s=Fe(i),a=Fe(": "),g=Fe(f),l=Fe("%")},m(x,E){ae(x,e,E),Z(e,s),Z(e,a),Z(e,g),Z(e,l)},p(x,E){E&1&&i!==(i=x[22]+"")&&Mt(s,i),E&1&&f!==(f=Math.round(x[23]*100)+"")&&Mt(g,f)},d(x){x&&oe(e)}}}function Ry(r){let e,i=r[22]+"",s,a,f=Math.round(r[23]*100)+"",g,l;return{c(){e=ce("li"),s=Fe(i),a=Fe(": "),g=Fe(f),l=Fe("%")},m(x,E){ae(x,e,E),Z(e,s),Z(e,a),Z(e,g),Z(e,l)},p(x,E){E&1&&i!==(i=x[22]+"")&&Mt(s,i),E&1&&f!==(f=Math.round(x[23]*100)+"")&&Mt(g,f)},d(x){x&&oe(e)}}}function VS(r){let e,i,s,a,f,g,l=r[0]&&Cy(r);return{c(){e=ce("button"),e.textContent="Recalculate",i=je(),l&&l.c(),s=ai()},m(x,E){ae(x,e,E),ae(x,i,E),l&&l.m(x,E),ae(x,s,E),a=!0,f||(g=Pt(e,"click",r[10]),f=!0)},p(x,[E]){x[0]?l?(l.p(x,E),E&1&&_e(l,1)):(l=Cy(x),l.c(),_e(l,1),l.m(s.parentNode,s)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){a||(_e(l),a=!0)},o(x){Ie(l),a=!1},d(x){x&&(oe(e),oe(i),oe(s)),l&&l.d(x),f=!1,g()}}}function lc(r,e){return e==0?0:r/e}const Dy=(r,e)=>e[1]-r[1],Ny=(r,e)=>e[1]-r[1];function qS(r,e,i){let s,a,f,g,l,x,E,C,L,N,B;Ot(r,Iy,be=>i(0,s=be)),Ot(r,sr,be=>i(21,a=be)),Ot(r,Ku,be=>i(1,f=be)),Ot(r,Xu,be=>i(2,g=be)),Ot(r,$f,be=>i(3,l=be)),Ot(r,Wf,be=>i(4,x=be)),Ot(r,Xf,be=>i(5,E=be)),Ot(r,Yf,be=>i(6,C=be)),Ot(r,Jf,be=>i(7,L=be)),Ot(r,Sy,be=>i(8,N=be)),Ot(r,Ni,be=>i(9,B=be));async function U(){Dn(Iy,s=await a.recalculateStats(),s)}cc(async()=>{s==null&&await U()});function te(be){f=be,Ku.set(f)}function ie(be){f=be,Ku.set(f)}function re(be){l=be,$f.set(l)}function J(be){f=be,Ku.set(f)}function $(be){x=be,Wf.set(x)}function fe(be){E=be,Xf.set(E)}function ve(be){C=be,Yf.set(C)}function Pe(be){L=be,Jf.set(L)}function ue(be){N=be,Sy.set(N)}return[s,f,g,l,x,E,C,L,N,B,U,te,ie,re,J,$,fe,ve,Pe,ue,()=>Dn(Ni,B={kind:"evaluate-route",browse:wl(s).worst_directness_routes},B)]}class GS extends fn{constructor(e){super(),hn(this,e,qS,VS,un,{})}}function zy(r,e,i){const s=r.slice();return s[4]=e[i],s}function Oy(r){let e,i=r[4]+"",s;return{c(){e=ce("option"),s=Fe(i),e.__value=r[4],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:nt,d(a){a&&oe(e)}}}function ZS(r){let e,i,s,a,f,g=Hn(r[1]),l=[];for(let x=0;x<g.length;x+=1)l[x]=Oy(zy(r,g,x));return{c(){e=ce("label"),i=Fe(`Area:
  `),s=ce("select");for(let x=0;x<l.length;x+=1)l[x].c();r[0]===void 0&&Po(()=>r[3].call(s))},m(x,E){ae(x,e,E),Z(e,i),Z(e,s);for(let C=0;C<l.length;C+=1)l[C]&&l[C].m(s,null);fs(s,r[0],!0),a||(f=[Pt(s,"change",r[3]),Pt(s,"change",r[2])],a=!0)},p(x,[E]){if(E&2){g=Hn(x[1]);let C;for(C=0;C<g.length;C+=1){const L=zy(x,g,C);l[C]?l[C].p(L,E):(l[C]=Oy(L),l[C].c(),l[C].m(s,null))}for(;C<l.length;C+=1)l[C].d(1);l.length=g.length}E&3&&fs(s,x[0])},i:nt,o:nt,d(x){x&&oe(e),Sr(l,x),a=!1,$i(f)}}}function HS(r,e,i){let{area:s}=e,a=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];a.sort();function f(){window.location.href=`index.html?boundary=${s}`}function g(){s=_l(this),i(0,s),i(1,a)}return r.$$set=l=>{"area"in l&&i(0,s=l.area)},[s,a,f,g]}class WS extends fn{constructor(e){super(),hn(this,e,HS,ZS,un,{area:0})}}const{window:XS}=Z0;function Fy(r,e,i){const s=r.slice();return s[19]=e[i],s}function By(r){let e,i,s=Hn(r[0].features),a=[];for(let g=0;g<s.length;g+=1)a[g]=Uy(Fy(r,s,g));const f=g=>Ie(a[g],1,1,()=>{a[g]=null});return{c(){e=ce("ol");for(let g=0;g<a.length;g+=1)a[g].c()},m(g,l){ae(g,e,l);for(let x=0;x<a.length;x+=1)a[x]&&a[x].m(e,null);i=!0},p(g,l){if(l&65){s=Hn(g[0].features);let x;for(x=0;x<s.length;x+=1){const E=Fy(g,s,x);a[x]?(a[x].p(E,l),_e(a[x],1)):(a[x]=Uy(E),a[x].c(),_e(a[x],1),a[x].m(e,null))}for(Nn(),x=s.length;x<a.length;x+=1)f(x);zn()}},i(g){if(!i){for(let l=0;l<s.length;l+=1)_e(a[l]);i=!0}},o(g){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Ie(a[l]);i=!1},d(g){g&&oe(e),Sr(a,g)}}}function $S(r){var l,x;let e=(((l=r[19].properties)==null?void 0:l.name)||`Untitled route ${r[19].id}`)+"",i,s,a=((x=r[19].properties)==null?void 0:x.infra_type)+"",f,g;return{c(){i=Fe(e),s=Fe(" ("),f=Fe(a),g=Fe(")")},m(E,C){ae(E,i,C),ae(E,s,C),ae(E,f,C),ae(E,g,C)},p(E,C){var L,N;C&1&&e!==(e=(((L=E[19].properties)==null?void 0:L.name)||`Untitled route ${E[19].id}`)+"")&&Mt(i,e),C&1&&a!==(a=((N=E[19].properties)==null?void 0:N.infra_type)+"")&&Mt(f,a)},d(E){E&&(oe(i),oe(s),oe(f),oe(g))}}}function Uy(r){let e,i,s,a;function f(){return r[15](r[19])}return i=new zS({props:{$$slots:{default:[$S]},$$scope:{ctx:r}}}),i.$on("click",f),{c(){e=ce("li"),ot(i.$$.fragment),s=je()},m(g,l){ae(g,e,l),rt(i,e,null),Z(e,s),a=!0},p(g,l){r=g;const x={};l&4194305&&(x.$$scope={dirty:l,ctx:r}),i.$set(x)},i(g){a||(_e(i.$$.fragment,g),a=!0)},o(g){Ie(i.$$.fragment,g),a=!1},d(g){g&&oe(e),st(i)}}}function YS(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re,J,$,fe,ve,Pe;i=new WS({props:{area:r[3]}});let ue=r[0]&&By(r);return $=new BS({}),{c(){e=ce("div"),ot(i.$$.fragment),s=je(),a=ce("div"),f=ce("button"),f.innerHTML=`Draw new <u>r</u>
        oute line`,g=je(),l=ce("button"),l.textContent="Clear all",x=je(),E=ce("label"),C=ce("input"),L=Fe(`
      Show current network`),N=je(),B=ce("details"),U=ce("summary"),U.textContent="Current network routes",te=je(),ue&&ue.c(),ie=je(),re=ce("hr"),J=je(),ot($.$$.fragment),He(l,"class","secondary"),He(C,"type","checkbox"),He(e,"slot","left")},m(xe,be){ae(xe,e,be),rt(i,e,null),Z(e,s),Z(e,a),Z(a,f),Z(a,g),Z(a,l),Z(e,x),Z(e,E),Z(E,C),C.checked=r[2],Z(E,L),Z(e,N),Z(e,B),Z(B,U),Z(B,te),ue&&ue.m(B,null),Z(e,ie),Z(e,re),Z(e,J),rt($,e,null),fe=!0,ve||(Pe=[Pt(f,"click",r[13]),Pt(l,"click",r[7]),Pt(C,"change",r[14])],ve=!0)},p(xe,be){const Te={};be&8&&(Te.area=xe[3]),i.$set(Te),be&4&&(C.checked=xe[2]),xe[0]?ue?(ue.p(xe,be),be&1&&_e(ue,1)):(ue=By(xe),ue.c(),_e(ue,1),ue.m(B,null)):ue&&(Nn(),Ie(ue,1,1,()=>{ue=null}),zn())},i(xe){fe||(_e(i.$$.fragment,xe),_e(ue),_e($.$$.fragment,xe),fe=!0)},o(xe){Ie(i.$$.fragment,xe),Ie(ue),Ie($.$$.fragment,xe),fe=!1},d(xe){xe&&oe(e),st(i),ue&&ue.d(),st($),ve=!1,$i(Pe)}}}function jy(r){let e,i;return e=new rr({props:{data:r[0],$$slots:{default:[QS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.data=s[0]),a&4194308&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function JS(r){let e=(r[18].name||"Untitled")+"",i,s,a=oc[r[18].infra_type][0]+"",f,g;return{c(){i=Fe(e),s=Fe(" ("),f=Fe(a),g=Fe(")")},m(l,x){ae(l,i,x),ae(l,s,x),ae(l,f,x),ae(l,g,x)},p(l,x){x&262144&&e!==(e=(l[18].name||"Untitled")+"")&&Mt(i,e),x&262144&&a!==(a=oc[l[18].infra_type][0]+"")&&Mt(f,a)},d(l){l&&(oe(i),oe(s),oe(f),oe(g))}}}function KS(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[JS,({props:s})=>({18:s}),({props:s})=>s?262144:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&4456448&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function QS(r){let e,i;return e=new mr({props:{id:"routes",paint:{"line-width":Ms(5,7),"line-color":ac},layout:{visibility:r[2]?"visible":"none"},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[KS]},$$scope:{ctx:r}}}),e.$on("click",r[5]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&4&&(f.layout={visibility:s[2]?"visible":"none"}),a&4194304&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function eE(r){let e,i,s=r[0]&&jy(r);return{c(){e=ce("div"),s&&s.c(),He(e,"slot","map")},m(a,f){ae(a,e,f),s&&s.m(e,null),i=!0},p(a,f){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=jy(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d()}}}function tE(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re;return i=new GS({}),{c(){e=ce("div"),ot(i.$$.fragment),s=je(),a=ce("div"),f=ce("button"),f.textContent="Evaluate a route",g=je(),l=ce("div"),x=ce("button"),x.textContent="Evaluate OD",E=je(),C=ce("div"),L=ce("button"),L.textContent="Debug network",N=je(),B=ce("div"),U=ce("button"),U.textContent="Debug mesh density",He(f,"class","secondary"),He(x,"class","secondary"),He(L,"class","secondary"),He(U,"class","secondary"),He(e,"slot","right")},m(J,$){ae(J,e,$),rt(i,e,null),Z(e,s),Z(e,a),Z(a,f),Z(e,g),Z(e,l),Z(l,x),Z(e,E),Z(e,C),Z(C,L),Z(e,N),Z(e,B),Z(B,U),te=!0,ie||(re=[Pt(f,"click",r[9]),Pt(x,"click",r[10]),Pt(L,"click",r[11]),Pt(U,"click",r[12])],ie=!0)},p:nt,i(J){te||(_e(i.$$.fragment,J),te=!0)},o(J){Ie(i.$$.fragment,J),te=!1},d(J){J&&oe(e),st(i),ie=!1,$i(re)}}}function nE(r){let e,i,s,a;return e=new gc({props:{$$slots:{right:[tE],map:[eE],left:[YS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(f,g){rt(e,f,g),i=!0,s||(a=Pt(XS,"keydown",r[4]),s=!0)},p(f,[g]){const l={};g&4194319&&(l.$$scope={dirty:g,ctx:f}),e.$set(l)},i(f){i||(_e(e.$$.fragment,f),i=!0)},o(f){Ie(e.$$.fragment,f),i=!1},d(f){st(e,f),s=!1,a()}}}function iE(r,e,i){let s,a,f,g,l;Ot(r,sr,ve=>i(16,s=ve)),Ot(r,Ni,ve=>i(1,a=ve)),Ot(r,Rh,ve=>i(8,f=ve)),Ot(r,Op,ve=>i(2,g=ve)),Ot(r,Hf,ve=>i(3,l=ve));let x=null;cc(E);async function E(){i(0,x=await s.renderRoutes())}function C(ve){ve.key=="r"&&(ve.preventDefault(),Dn(Ni,a={kind:"edit-route",id:null},a))}function L(ve){Dn(Ni,a={kind:"edit-route",id:ve.detail.features[0].id},a)}function N(ve){Dn(Ni,a={kind:"edit-route",id:ve},a)}async function B(){window.confirm("Clear everything? You can't undo this")&&(await(s==null?void 0:s.clearAllRoutes()),await Dh(),await E())}const U=()=>Dn(Ni,a={kind:"evaluate-route",browse:[]},a),te=()=>Dn(Ni,a={kind:"evaluate-od"},a),ie=()=>Dn(Ni,a={kind:"debug-network"},a),re=()=>Dn(Ni,a={kind:"debug-mesh-density"},a),J=()=>Dn(Ni,a={kind:"edit-route",id:null},a);function $(){g=this.checked,Op.set(g)}const fe=ve=>N(ve.id);return r.$$.update=()=>{r.$$.dirty&256&&f>0&&E()},[x,a,g,l,C,L,N,B,f,U,te,ie,re,J,$,fe]}class rE extends fn{constructor(e){super(),hn(this,e,iE,nE,un,{})}}function sE(r,e,i){const s=r.slice();return s[0]=e[i][0],s[1]=e[i][1],s[2]=e[i][2],s}function oE(r){let e,i,s;return{c(){e=ce("span"),e.textContent=`${r[1]}`,i=je(),s=ce("br"),Un(e,"color",r[2])},m(a,f){ae(a,e,f),ae(a,i,f),ae(a,s,f)},p:nt,d(a){a&&(oe(e),oe(i),oe(s))}}}function aE(r){let e,i,s,a,f=Hn(rd),g=[];for(let l=0;l<f.length;l+=1)g[l]=oE(sE(r,f,l));return{c(){e=ce("div"),i=ce("details"),s=ce("summary"),s.textContent="Legend",a=je();for(let l=0;l<g.length;l+=1)g[l].c();i.open=!0,He(e,"class","svelte-1oq1sox")},m(l,x){ae(l,e,x),Z(e,i),Z(i,s),Z(i,a);for(let E=0;E<g.length;E+=1)g[E]&&g[E].m(i,null)},p:nt,i:nt,o:nt,d(l){l&&oe(e),Sr(g,l)}}}class lE extends fn{constructor(e){super(),hn(this,e,null,aE,un,{})}}const uE="/npw/assets/help-d011708a.svg";function Vy(r){let e,i;return e=new Vv({props:{$$slots:{default:[cE]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&16&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function cE(r){let e,i,s;const a=r[1].default,f=Zi(a,r,r[4],null);return{c(){e=ce("h2"),e.textContent="Help",i=je(),f&&f.c()},m(g,l){ae(g,e,l),ae(g,i,l),f&&f.m(g,l),s=!0},p(g,l){f&&f.p&&(!s||l&16)&&Wi(f,a,g,g[4],s?Hi(a,g[4],l,null):Xi(g[4]),null)},i(g){s||(_e(f,g),s=!0)},o(g){Ie(f,g),s=!1},d(g){g&&(oe(e),oe(i)),f&&f.d(g)}}}function hE(r){let e,i,s,a,f,g,l=r[0]&&Vy(r);return{c(){e=ce("button"),e.innerHTML=`<img src="${uE}" title="Help" alt="Help"/>`,i=je(),l&&l.c(),s=ai(),He(e,"class","svelte-gb6dzm")},m(x,E){ae(x,e,E),ae(x,i,E),l&&l.m(x,E),ae(x,s,E),a=!0,f||(g=Pt(e,"click",r[2]),f=!0)},p(x,[E]){x[0]?l?(l.p(x,E),E&1&&_e(l,1)):(l=Vy(x),l.c(),_e(l,1),l.m(s.parentNode,s)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){a||(_e(l),a=!0)},o(x){Ie(l),a=!1},d(x){x&&(oe(e),oe(i),oe(s)),l&&l.d(x),f=!1,g()}}}function fE(r,e,i){let{$$slots:s={},$$scope:a}=e,f=!1;const g=()=>i(0,f=!0),l=()=>i(0,f=!1);return r.$$set=x=>{"$$scope"in x&&i(4,a=x.$$scope)},[f,s,g,l,a]}class Wv extends fn{constructor(e){super(),hn(this,e,fE,hE,un,{})}}function qy(r,e,i){const s=r.slice();return s[1]=e[i][0],s[2]=e[i][1],s}function Gy(r){let e,i,s,a=r[1]+"",f,g;return{c(){e=ce("li"),i=ce("span"),s=je(),f=Fe(a),g=je(),He(i,"class","svelte-kzgqtg"),Un(i,"background",r[2])},m(l,x){ae(l,e,x),Z(e,i),Z(e,s),Z(e,f),Z(e,g)},p(l,x){x&1&&Un(i,"background",l[2]),x&1&&a!==(a=l[1]+"")&&Mt(f,a)},d(l){l&&oe(e)}}}function dE(r){let e,i=Hn(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=Gy(qy(r,i,a));return{c(){e=ce("ul");for(let a=0;a<s.length;a+=1)s[a].c()},m(a,f){ae(a,e,f);for(let g=0;g<s.length;g+=1)s[g]&&s[g].m(e,null)},p(a,[f]){if(f&1){i=Hn(Object.entries(a[0]));let g;for(g=0;g<i.length;g+=1){const l=qy(a,i,g);s[g]?s[g].p(l,f):(s[g]=Gy(l),s[g].c(),s[g].m(e,null))}for(;g<s.length;g+=1)s[g].d(1);s.length=i.length}},i:nt,o:nt,d(a){a&&oe(e),Sr(s,a)}}}function pE(r,e,i){let{colors:s}=e;return r.$$set=a=>{"colors"in a&&i(0,s=a.colors)},[s]}class _c extends fn{constructor(e){super(),hn(this,e,pE,dE,un,{colors:0})}}let ln;const Xv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Xv.decode();let vh=null;function Eh(){return(vh===null||vh.byteLength===0)&&(vh=new Uint8Array(ln.memory.buffer)),vh}function _o(r,e){return r=r>>>0,Xv.decode(Eh().subarray(r,r+e))}const Pa=new Array(128).fill(void 0);Pa.push(void 0,null,!0,!1);let Th=Pa.length;function lr(r){Th===Pa.length&&Pa.push(Pa.length+1);const e=Th;return Th=Pa[e],Pa[e]=r,e}function Zn(r){return Pa[r]}function mE(r){r<132||(Pa[r]=Th,Th=r)}function $u(r){const e=Zn(r);return mE(r),e}function fp(r){return r==null}let bh=null;function gE(){return(bh===null||bh.byteLength===0)&&(bh=new Float64Array(ln.memory.buffer)),bh}let xh=null;function oi(){return(xh===null||xh.byteLength===0)&&(xh=new Int32Array(ln.memory.buffer)),xh}let vl=0;const Rf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},_E=typeof Rf.encodeInto=="function"?function(r,e){return Rf.encodeInto(r,e)}:function(r,e){const i=Rf.encode(r);return e.set(i),{read:r.length,written:i.length}};function kf(r,e,i){if(i===void 0){const l=Rf.encode(r),x=e(l.length,1)>>>0;return Eh().subarray(x,x+l.length).set(l),vl=l.length,x}let s=r.length,a=e(s,1)>>>0;const f=Eh();let g=0;for(;g<s;g++){const l=r.charCodeAt(g);if(l>127)break;f[a+g]=l}if(g!==s){g!==0&&(r=r.slice(g)),a=i(a,s,s=g+r.length*3,1)>>>0;const l=Eh().subarray(a+g,a+s),x=_E(r,l);g+=x.written}return vl=g,a}function Up(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const a=r.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=r.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(r)){const a=r.length;let f="[";a>0&&(f+=Up(r[0]));for(let g=1;g<a;g++)f+=", "+Up(r[g]);return f+="]",f}const i=/\[object ([^\]]+)\]/.exec(toString.call(r));let s;if(i.length>1)s=i[1];else return toString.call(r);if(s=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:s}function yE(r,e){const i=e(r.length*1,1)>>>0;return Eh().set(r,i/1),vl=r.length,i}function dp(r,e){try{return r.apply(this,e)}catch(i){ln.__wbindgen_exn_store(lr(i))}}class Kf{static __wrap(e){e=e>>>0;const i=Object.create(Kf.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ln.__wbg_jsroutesnapper_free(e)}constructor(e){try{const f=ln.__wbindgen_add_to_stack_pointer(-16),g=yE(e,ln.__wbindgen_malloc),l=vl;ln.jsroutesnapper_new(f,g,l);var i=oi()[f/4+0],s=oi()[f/4+1],a=oi()[f/4+2];if(a)throw $u(s);return Kf.__wrap(i)}finally{ln.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){ln.jsroutesnapper_setRouteConfig(this.__wbg_ptr,lr(e))}setAreaMode(){ln.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,i;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_getConfig(f,this.__wbg_ptr);var s=oi()[f/4+0],a=oi()[f/4+1];return e=s,i=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,i,1)}}toFinalFeature(){try{const s=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_toFinalFeature(s,this.__wbg_ptr);var e=oi()[s/4+0],i=oi()[s/4+1];let a;return e!==0&&(a=_o(e,i).slice(),ln.__wbindgen_free(e,i*1)),a}finally{ln.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,i;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_renderGeojson(f,this.__wbg_ptr);var s=oi()[f/4+0],a=oi()[f/4+1];return e=s,i=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,i,1)}}toggleSnapMode(){ln.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,i,s){return ln.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,i,s)!==0}onClick(){ln.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return ln.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return ln.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){ln.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const a=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_editExisting(a,this.__wbg_ptr,lr(e));var i=oi()[a/4+0],s=oi()[a/4+1];if(s)throw $u(i)}finally{ln.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,i;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_debugRenderGraph(f,this.__wbg_ptr);var s=oi()[f/4+0],a=oi()[f/4+1];return e=s,i=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,i,1)}}debugSnappableNodes(){let e,i;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_debugSnappableNodes(f,this.__wbg_ptr);var s=oi()[f/4+0],a=oi()[f/4+1];return e=s,i=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,i,1)}}routeNameForWaypoints(e){let i,s;try{const C=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_routeNameForWaypoints(C,this.__wbg_ptr,lr(e));var a=oi()[C/4+0],f=oi()[C/4+1],g=oi()[C/4+2],l=oi()[C/4+3],x=a,E=f;if(l)throw x=0,E=0,$u(g);return i=x,s=E,_o(x,E)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(i,s,1)}}addSnappedWaypoint(e,i){ln.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,i)}undo(){ln.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let i,s;try{const C=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_calculateRoute(C,this.__wbg_ptr,lr(e));var a=oi()[C/4+0],f=oi()[C/4+1],g=oi()[C/4+2],l=oi()[C/4+3],x=a,E=f;if(l)throw x=0,E=0,$u(g);return i=x,s=E,_o(x,E)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(i,s,1)}}getExtraNodes(e,i){let s,a;try{const L=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_getExtraNodes(L,this.__wbg_ptr,lr(e),lr(i));var f=oi()[L/4+0],g=oi()[L/4+1],l=oi()[L/4+2],x=oi()[L/4+3],E=f,C=g;if(x)throw E=0,C=0,$u(l);return s=E,a=C,_o(E,C)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(s,a,1)}}}async function vE(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const i=await r.arrayBuffer();return await WebAssembly.instantiate(i,e)}else{const i=await WebAssembly.instantiate(r,e);return i instanceof WebAssembly.Instance?{instance:i,module:r}:i}}function bE(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,i){const s=_o(e,i);return lr(s)},r.wbg.__wbindgen_object_drop_ref=function(e){$u(e)},r.wbg.__wbindgen_error_new=function(e,i){const s=new Error(_o(e,i));return lr(s)},r.wbg.__wbindgen_number_get=function(e,i){const s=Zn(i),a=typeof s=="number"?s:void 0;gE()[e/8+1]=fp(a)?0:a,oi()[e/4+0]=!fp(a)},r.wbg.__wbindgen_is_object=function(e){const i=Zn(e);return typeof i=="object"&&i!==null},r.wbg.__wbindgen_is_undefined=function(e){return Zn(e)===void 0},r.wbg.__wbindgen_in=function(e,i){return Zn(e)in Zn(i)},r.wbg.__wbindgen_boolean_get=function(e){const i=Zn(e);return typeof i=="boolean"?i?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,i){return Zn(e)==Zn(i)},r.wbg.__wbindgen_string_get=function(e,i){const s=Zn(i),a=typeof s=="string"?s:void 0;var f=fp(a)?0:kf(a,ln.__wbindgen_malloc,ln.__wbindgen_realloc),g=vl;oi()[e/4+1]=g,oi()[e/4+0]=f},r.wbg.__wbg_String_4370c5505c674d30=function(e,i){const s=String(Zn(i)),a=kf(s,ln.__wbindgen_malloc,ln.__wbindgen_realloc),f=vl;oi()[e/4+1]=f,oi()[e/4+0]=a},r.wbg.__wbindgen_object_clone_ref=function(e){const i=Zn(e);return lr(i)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,i){const s=Zn(e)[Zn(i)];return lr(s)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return lr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,i){const s=Zn(i).stack,a=kf(s,ln.__wbindgen_malloc,ln.__wbindgen_realloc),f=vl;oi()[e/4+1]=f,oi()[e/4+0]=a},r.wbg.__wbg_error_f851667af71bcfc6=function(e,i){let s,a;try{s=e,a=i,console.error(_o(e,i))}finally{ln.__wbindgen_free(s,a,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Zn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Zn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Zn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Zn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Zn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,i){const s=Zn(e)[i>>>0];return lr(s)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Zn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Zn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const i=Zn(e).next;return lr(i)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return dp(function(e){const i=Zn(e).next();return lr(i)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Zn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const i=Zn(e).value;return lr(i)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return lr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return dp(function(e,i){const s=Reflect.get(Zn(e),Zn(i));return lr(s)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return dp(function(e,i){const s=Zn(e).call(Zn(i));return lr(s)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Zn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let i;try{i=Zn(e)instanceof ArrayBuffer}catch{i=!1}return i},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const i=Zn(e).buffer;return lr(i)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const i=new Uint8Array(Zn(e));return lr(i)},r.wbg.__wbg_set_5cf90238115182c3=function(e,i,s){Zn(e).set(Zn(i),s>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Zn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let i;try{i=Zn(e)instanceof Uint8Array}catch{i=!1}return i},r.wbg.__wbindgen_debug_string=function(e,i){const s=Up(Zn(i)),a=kf(s,ln.__wbindgen_malloc,ln.__wbindgen_realloc),f=vl;oi()[e/4+1]=f,oi()[e/4+0]=a},r.wbg.__wbindgen_throw=function(e,i){throw new Error(_o(e,i))},r.wbg.__wbindgen_memory=function(){const e=ln.memory;return lr(e)},r}function xE(r,e){return ln=r.exports,$v.__wbindgen_wasm_module=e,bh=null,xh=null,vh=null,ln}async function $v(r){if(ln!==void 0)return ln;typeof r>"u"&&(r="/npw/assets/route_snapper_bg.wasm");const e=bE();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:i,module:s}=await vE(await r,e);return xE(i,s)}const wE=30;class kE{constructor(e,i,s,a,f){this.onMouseMove=g=>{if(!this.active)return;const l=[g.point.x-wE,g.point.y],x=this.map.unproject(g.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(g.lngLat.lng,g.lngLat.lat,x)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=g=>{this.active&&(g.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=g=>{if(!this.active)return;let l=g.target.tagName;l=="INPUT"||l=="TEXTAREA"||g.key=="Escape"&&(g.stopPropagation(),this.cancel())},this.onKeyPress=g=>{if(!this.active)return;let l=g.target.tagName;l=="INPUT"||l=="TEXTAREA"||(g.key=="Enter"?(g.stopPropagation(),this.finish()):g.key=="s"||g.key=="S"?(g.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):g.key=="z"&&g.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Kf(i),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=s,this.snapMode=a,this.undoLength=f,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let i of this.eventListenersSuccess)i(JSON.parse(e));else for(let i of this.eventListenersFailure)i();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let i of this.eventListenersUpdated)i(JSON.parse(e))}}let Qf=Yn(null);const go=Yn([]);const IE=r=>({}),Zy=r=>({});function Hy(r,e,i){const s=r.slice();return s[50]=e[i],s[51]=e,s[52]=i,s}function Wy(r,e,i){const s=r.slice();return s[53]=e[i],s[54]=e,s[55]=i,s}const SE=r=>({}),Xy=r=>({});function EE(r){let e,i=r[10].length+"",s,a;return{c(){e=Fe("Undo ("),s=Fe(i),a=Fe(")")},m(f,g){ae(f,e,g),ae(f,s,g),ae(f,a,g)},p(f,g){g[0]&1024&&i!==(i=f[10].length+"")&&Mt(s,i)},d(f){f&&(oe(e),oe(s),oe(a))}}}function TE(r){let e;return{c(){e=Fe("Undo")},m(i,s){ae(i,e,s)},p:nt,d(i){i&&oe(e)}}}function CE(r){let e,i,s,a,f;return{c(){e=ce("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,i=je(),s=ce("p"),s.textContent="Keyboard shortcuts:",a=je(),f=ce("ul"),f.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(g,l){ae(g,e,l),ae(g,i,l),ae(g,s,l),ae(g,a,l),ae(g,f,l)},p:nt,d(g){g&&(oe(e),oe(i),oe(s),oe(a),oe(f))}}}function LE(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re,J,$,fe,ve,Pe,ue,xe,be,Te,we,ye,ze,Be,pt,St,dt,ut,Bt,vt,wt,ft,xt,It,Jt,pn,Rn,Xe,Wn,dn,Ft,Se,lt,Je,Lt,Ye;function kt(Gt,_n){return Gt[10].length==0?TE:EE}let Vt=kt(r),Ee=Vt(r);return te=new Wv({props:{$$slots:{default:[CE]},$$scope:{ctx:r}}}),lt=Vg(r[39][0]),Je=Vg(r[39][1]),{c(){e=ce("div"),i=ce("h2"),i.textContent="Editing a route",s=je(),a=ce("button"),f=Fe("Finish"),l=je(),x=ce("button"),Ee.c(),C=je(),L=ce("button"),L.textContent="Delete",N=je(),B=ce("button"),B.textContent="Cancel",U=je(),ot(te.$$.fragment),ie=je(),re=ce("fieldset"),J=ce("label"),$=ce("input"),fe=Fe(`
        Snap to roads`),ve=je(),Pe=ce("label"),ue=ce("input"),xe=Fe(`
        Draw anywhere`),be=je(),Te=ce("fieldset"),we=ce("label"),ye=ce("input"),ze=Fe(`
        Extend from start (
        `),Be=ce("b"),Be.textContent="1",pt=Fe(`
        )`),St=je(),dt=ce("label"),ut=ce("input"),Bt=Fe(`
        Extend from end (
        `),vt=ce("b"),vt.textContent="2",wt=Fe(`
        )`),ft=je(),xt=ce("label"),It=ce("input"),Jt=Fe(`
        Adjust middle points (
        `),pn=ce("b"),pn.textContent="3",Rn=Fe(`
        )`),Xe=je(),Wn=ce("label"),dn=ce("input"),Ft=Fe(`
      Show major junctions`),a.disabled=g=r[7].length<2,He(x,"class","secondary"),x.disabled=E=r[10].length==0,He(L,"class","secondary"),He(B,"class","secondary"),He($,"type","radio"),$.__value="snap",zi($,$.__value),He(ue,"type","radio"),ue.__value="free",zi(ue,ue.__value),He(ye,"type","radio"),ye.__value="append-start",zi(ye,ye.__value),He(ut,"type","radio"),ut.__value="append-end",zi(ut,ut.__value),He(It,"type","radio"),It.__value="adjust",zi(It,It.__value),He(dn,"type","checkbox"),He(e,"slot","left"),lt.p(ye,ut,It),Je.p($,ue)},m(Gt,_n){ae(Gt,e,_n),Z(e,i),Z(e,s),Z(e,a),Z(a,f),Z(e,l),Z(e,x),Ee.m(x,null),Z(e,C),Z(e,L),Z(e,N),Z(e,B),Z(e,U),rt(te,e,null),Z(e,ie),Z(e,re),Z(re,J),Z(J,$),$.checked=$.__value===r[9],Z(J,fe),Z(re,ve),Z(re,Pe),Z(Pe,ue),ue.checked=ue.__value===r[9],Z(Pe,xe),Z(e,be),Z(e,Te),Z(Te,we),Z(we,ye),ye.checked=ye.__value===r[3],Z(we,ze),Z(we,Be),Z(we,pt),Z(Te,St),Z(Te,dt),Z(dt,ut),ut.checked=ut.__value===r[3],Z(dt,Bt),Z(dt,vt),Z(dt,wt),Z(Te,ft),Z(Te,xt),Z(xt,It),It.checked=It.__value===r[3],Z(xt,Jt),Z(xt,pn),Z(xt,Rn),Z(e,Xe),Z(e,Wn),Z(Wn,dn),dn.checked=r[13],Z(Wn,Ft),Se=!0,Lt||(Ye=[Pt(a,"click",function(){nu(r[0])&&r[0].apply(this,arguments)}),Pt(x,"click",r[14]),Pt(L,"click",function(){nu(r[2])&&r[2].apply(this,arguments)}),Pt(B,"click",function(){nu(r[1])&&r[1].apply(this,arguments)}),Pt($,"change",r[38]),Pt($,"change",r[15]),Pt(ue,"change",r[40]),Pt(ue,"change",r[15]),Pt(ye,"change",r[41]),Pt(ut,"change",r[42]),Pt(It,"change",r[43]),Pt(dn,"change",r[44])],Lt=!0)},p(Gt,_n){r=Gt,(!Se||_n[0]&128&&g!==(g=r[7].length<2))&&(a.disabled=g),Vt===(Vt=kt(r))&&Ee?Ee.p(r,_n):(Ee.d(1),Ee=Vt(r),Ee&&(Ee.c(),Ee.m(x,null))),(!Se||_n[0]&1024&&E!==(E=r[10].length==0))&&(x.disabled=E);const Kn={};_n[1]&16384&&(Kn.$$scope={dirty:_n,ctx:r}),te.$set(Kn),_n[0]&512&&($.checked=$.__value===r[9]),_n[0]&512&&(ue.checked=ue.__value===r[9]),_n[0]&8&&(ye.checked=ye.__value===r[3]),_n[0]&8&&(ut.checked=ut.__value===r[3]),_n[0]&8&&(It.checked=It.__value===r[3]),_n[0]&8192&&(dn.checked=r[13])},i(Gt){Se||(_e(te.$$.fragment,Gt),Se=!0)},o(Gt){Ie(te.$$.fragment,Gt),Se=!1},d(Gt){Gt&&oe(e),Ee.d(),st(te),lt.r(),Je.r(),Lt=!1,$i(Ye)}}}function ME(r){let e;return{c(){e=ce("span"),He(e,"class","dot svelte-1cj4rwq"),Vr(e,"snapped-node",r[53].snapped),Vr(e,"free-node",!r[53].snapped),Vr(e,"hide",r[6])},m(i,s){ae(i,e,s)},p(i,s){s[0]&2048&&Vr(e,"snapped-node",i[53].snapped),s[0]&2048&&Vr(e,"free-node",!i[53].snapped),s[0]&64&&Vr(e,"hide",i[6])},d(i){i&&oe(e)}}}function $y(r){let e,i,s;function a(x){r[29](x,r[53])}function f(){return r[30](r[53])}function g(){return r[31](r[53])}let l={draggable:!0,zIndex:0,$$slots:{default:[ME]},$$scope:{ctx:r}};return r[53].point!==void 0&&(l.lngLat=r[53].point),e=new Zf({props:l}),Jn.push(()=>Ir(e,"lngLat",a)),e.$on("dragstart",f),e.$on("drag",g),e.$on("dragend",r[23]),{c(){ot(e.$$.fragment)},m(x,E){rt(e,x,E),s=!0},p(x,E){r=x;const C={};E[0]&2112|E[1]&16384&&(C.$$scope={dirty:E,ctx:r}),!i&&E[0]&2048&&(i=!0,C.lngLat=r[53].point,kr(()=>i=!1)),e.$set(C)},i(x){s||(_e(e.$$.fragment,x),s=!0)},o(x){Ie(e.$$.fragment,x),s=!1},d(x){st(e,x)}}}function AE(r){let e;return{c(){e=ce("span"),e.textContent=`${r[52]+1}`,He(e,"class","dot svelte-1cj4rwq"),Vr(e,"snapped",r[50].snapped)},m(i,s){ae(i,e,s)},p(i,s){s[0]&128&&Vr(e,"snapped",i[50].snapped)},d(i){i&&oe(e)}}}function Yy(r){let e,i,s;function a(x){r[32](x,r[50])}function f(){return r[33](r[52])}function g(){return r[34](r[52])}let l={draggable:!0,zIndex:1,$$slots:{default:[AE]},$$scope:{ctx:r}};return r[50].point!==void 0&&(l.lngLat=r[50].point),e=new Zf({props:l}),Jn.push(()=>Ir(e,"lngLat",a)),e.$on("click",f),e.$on("contextmenu",g),e.$on("mouseenter",r[35]),e.$on("mouseleave",r[36]),e.$on("dragstart",r[25]),e.$on("dragend",r[37]),{c(){ot(e.$$.fragment)},m(x,E){rt(e,x,E),s=!0},p(x,E){r=x;const C={};E[0]&128|E[1]&16384&&(C.$$scope={dirty:E,ctx:r}),!i&&E[0]&128&&(i=!0,C.lngLat=r[50].point,kr(()=>i=!1)),e.$set(C)},i(x){s||(_e(e.$$.fragment,x),s=!0)},o(x){Ie(e.$$.fragment,x),s=!1},d(x){st(e,x)}}}function PE(r){let e,i;return e=new mr({props:{paint:{"line-color":"black","line-width":10}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function RE(r){let e,i;return e=new mr({props:{paint:{"line-color":"black","line-width":3}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function DE(r){let e,i,s,a,f,g,l,x,E,C;i=new jv({}),i.$on("click",r[16]),i.$on("mousemove",r[17]);let L=Hn(r[11]),N=[];for(let $=0;$<L.length;$+=1)N[$]=$y(Wy(r,L,$));const B=$=>Ie(N[$],1,1,()=>{N[$]=null});let U=Hn(r[7]),te=[];for(let $=0;$<U.length;$+=1)te[$]=Yy(Hy(r,U,$));const ie=$=>Ie(te[$],1,1,()=>{te[$]=null});g=new rr({props:{data:r[20](r[8],r[7]),generateId:!0,$$slots:{default:[PE]},$$scope:{ctx:r}}}),x=new rr({props:{data:r[12],$$slots:{default:[RE]},$$scope:{ctx:r}}});const re=r[28]["extra-map"],J=Zi(re,r,r[45],Zy);return{c(){e=ce("div"),ot(i.$$.fragment),s=je();for(let $=0;$<N.length;$+=1)N[$].c();a=je();for(let $=0;$<te.length;$+=1)te[$].c();f=je(),ot(g.$$.fragment),l=je(),ot(x.$$.fragment),E=je(),J&&J.c(),He(e,"slot","map")},m($,fe){ae($,e,fe),rt(i,e,null),Z(e,s);for(let ve=0;ve<N.length;ve+=1)N[ve]&&N[ve].m(e,null);Z(e,a);for(let ve=0;ve<te.length;ve+=1)te[ve]&&te[ve].m(e,null);Z(e,f),rt(g,e,null),Z(e,l),rt(x,e,null),Z(e,E),J&&J.m(e,null),C=!0},p($,fe){if(fe[0]&14682176){L=Hn($[11]);let ue;for(ue=0;ue<L.length;ue+=1){const xe=Wy($,L,ue);N[ue]?(N[ue].p(xe,fe),_e(N[ue],1)):(N[ue]=$y(xe),N[ue].c(),_e(N[ue],1),N[ue].m(e,a))}for(Nn(),ue=L.length;ue<N.length;ue+=1)B(ue);zn()}if(fe[0]&34341040){U=Hn($[7]);let ue;for(ue=0;ue<U.length;ue+=1){const xe=Hy($,U,ue);te[ue]?(te[ue].p(xe,fe),_e(te[ue],1)):(te[ue]=Yy(xe),te[ue].c(),_e(te[ue],1),te[ue].m(e,f))}for(Nn(),ue=U.length;ue<te.length;ue+=1)ie(ue);zn()}const ve={};fe[0]&384&&(ve.data=$[20]($[8],$[7])),fe[1]&16384&&(ve.$$scope={dirty:fe,ctx:$}),g.$set(ve);const Pe={};fe[0]&4096&&(Pe.data=$[12]),fe[1]&16384&&(Pe.$$scope={dirty:fe,ctx:$}),x.$set(Pe),J&&J.p&&(!C||fe[1]&16384)&&Wi(J,re,$,$[45],C?Hi(re,$[45],fe,IE):Xi($[45]),Zy)},i($){if(!C){_e(i.$$.fragment,$);for(let fe=0;fe<L.length;fe+=1)_e(N[fe]);for(let fe=0;fe<U.length;fe+=1)_e(te[fe]);_e(g.$$.fragment,$),_e(x.$$.fragment,$),_e(J,$),C=!0}},o($){Ie(i.$$.fragment,$),N=N.filter(Boolean);for(let fe=0;fe<N.length;fe+=1)Ie(N[fe]);te=te.filter(Boolean);for(let fe=0;fe<te.length;fe+=1)Ie(te[fe]);Ie(g.$$.fragment,$),Ie(x.$$.fragment,$),Ie(J,$),C=!1},d($){$&&oe(e),st(i),Sr(N,$),Sr(te,$),st(g),st(x),J&&J.d($)}}}function NE(r){let e,i;const s=r[28]["extra-right"],a=Zi(s,r,r[45],Xy);return{c(){e=ce("div"),a&&a.c(),He(e,"slot","right")},m(f,g){ae(f,e,g),a&&a.m(e,null),i=!0},p(f,g){a&&a.p&&(!i||g[1]&16384)&&Wi(a,s,f,f[45],i?Hi(s,f[45],g,SE):Xi(f[45]),Xy)},i(f){i||(_e(a,f),i=!0)},o(f){Ie(a,f),i=!1},d(f){f&&oe(e),a&&a.d(f)}}}function zE(r){let e,i,s,a;return e=new gc({props:{$$slots:{right:[NE],map:[DE],left:[LE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(f,g){rt(e,f,g),i=!0,s||(a=Pt(window,"keydown",r[24]),s=!0)},p(f,g){const l={};g[0]&16383|g[1]&16384&&(l.$$scope={dirty:g,ctx:f}),e.$set(l)},i(f){i||(_e(e.$$.fragment,f),i=!0)},o(f){Ie(e.$$.fragment,f),i=!1},d(f){st(e,f),s=!1,a()}}}function OE(r,e,i){let s,a,f,g;Ot(r,go,kt=>i(7,a=kt)),Ot(r,Qf,kt=>i(8,f=kt)),Ot(r,Fp,kt=>i(13,g=kt));let{$$slots:l={},$$scope:x}=e,{map:E}=e,{finish:C}=e,{cancel:L}=e,{deleteRoute:N}=e;vo(()=>{Dn(go,a=[],a),f==null||f.stop(),E.getCanvas().style.cursor="inherit"});let B="append-end",U="snap",te=[],ie=[],re=null,J=!1,$=!1,fe=!1;function ve(kt){let Vt=kt.length==0?"crosshair":"inherit";E.getCanvas().style.cursor=Vt}function Pe(){let kt=te.pop();i(10,te),kt&&Dn(go,a=kt,a)}function ue(){te.length==100&&te.shift(),i(10,te=[...te,JSON.parse(JSON.stringify(a))])}function xe(){i(9,U=U=="snap"?"free":"snap"),re&&i(27,re.snapped=U=="snap",re)}function be(kt){ue(),go.update(Vt=>(B=="append-start"?Vt.splice(0,0,{point:kt.detail.lngLat.toArray(),snapped:U=="snap"}):B=="append-end"&&Vt.push({point:kt.detail.lngLat.toArray(),snapped:U=="snap"}),Vt))}function Te(kt){i(27,re={point:kt.detail.lngLat.toArray(),snapped:U=="snap"})}function we(kt){ue(),go.update(Vt=>(Vt[kt].snapped=!Vt[kt].snapped,Vt))}function ye(kt){ue(),go.update(Vt=>(Vt.splice(kt,1),Vt)),i(4,J=!1)}function ze(kt,Vt){try{if(kt)return JSON.parse(kt.inner.calculateRoute(Vt))}catch{}return Af()}function Be(kt,Vt,Ee,Gt,_n){if(_n)return Af();try{if(kt&&Vt.length>0&&Gt){if(Ee=="append-start")return JSON.parse(kt.inner.calculateRoute([Gt,Vt[0]]));if(Ee=="append-end")return JSON.parse(kt.inner.calculateRoute([Vt[Vt.length-1],Gt]))}}catch{}return Af()}function pt(kt,Vt,Ee,Gt){if(Gt)return;if(!kt||Ee!="adjust"){i(11,ie=[]);return}let _n=[],Kn=1;for(let Yi=0;Yi<Vt.length-1;Yi++){let xn=JSON.parse(kt.inner.getExtraNodes(Vt[Yi],Vt[Yi+1]));for(let[qi,Ji,Jr]of xn)_n.push({point:[qi,Ji],snapped:Jr,insertIdx:Kn});Kn++}i(11,ie=_n)}function St(kt){ue(),go.update(Vt=>(Vt.splice(kt.insertIdx,0,{point:kt.point,snapped:kt.snapped}),Vt)),i(6,fe=!0)}function dt(kt){go.update(Vt=>(Vt[kt.insertIdx].point=kt.point,Vt))}function ut(){i(6,fe=!1)}function Bt(kt){let Vt=kt.target.tagName,Ee=Vt=="INPUT"||Vt=="TEXTAREA";kt.key==="Enter"&&!Ee?(kt.stopPropagation(),a.length>=2&&C()):kt.key==="Escape"?(kt.stopPropagation(),L()):kt.key=="s"&&!Ee?xe():kt.key=="1"&&!Ee?i(3,B="append-start"):kt.key=="2"&&!Ee?i(3,B="append-end"):kt.key=="3"&&!Ee?i(3,B="adjust"):kt.key=="z"&&kt.ctrlKey&&(kt.stopPropagation(),Pe())}function vt(){ue(),i(5,$=!0)}const wt=[[],[]];function ft(kt,Vt){r.$$.not_equal(Vt.point,kt)&&(Vt.point=kt,i(11,ie))}const xt=kt=>St(kt),It=kt=>dt(kt);function Jt(kt,Vt){r.$$.not_equal(Vt.point,kt)&&(Vt.point=kt,go.set(a))}const pn=kt=>we(kt),Rn=kt=>ye(kt),Xe=()=>i(4,J=!0),Wn=()=>i(4,J=!1),dn=()=>i(5,$=!1);function Ft(){U=this.__value,i(9,U)}function Se(){U=this.__value,i(9,U)}function lt(){B=this.__value,i(3,B)}function Je(){B=this.__value,i(3,B)}function Lt(){B=this.__value,i(3,B)}function Ye(){g=this.checked,Fp.set(g)}return r.$$set=kt=>{"map"in kt&&i(26,E=kt.map),"finish"in kt&&i(0,C=kt.finish),"cancel"in kt&&i(1,L=kt.cancel),"deleteRoute"in kt&&i(2,N=kt.deleteRoute),"$$scope"in kt&&i(45,x=kt.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&456&&pt(f,a,B,fe),r.$$.dirty[0]&134218168&&i(12,s=Be(f,a,B,re,J||$)),r.$$.dirty[0]&128&&ve(a)},[C,L,N,B,J,$,fe,a,f,U,te,ie,s,g,Pe,xe,be,Te,we,ye,ze,St,dt,ut,Bt,vt,E,re,l,ft,xt,It,Jt,pn,Rn,Xe,Wn,dn,Ft,wt,Se,lt,Je,Lt,Ye,x]}class FE extends fn{constructor(e){super(),hn(this,e,OE,zE,un,{map:26,finish:0,cancel:1,deleteRoute:2},null,[-1,-1])}}function BE(r,e,i){const s=r.slice();return s[16]=e[i][0],s[17]=e[i][1],s[18]=e[i][2],s}function Jy(r){let e,i;return e=new rr({props:{data:r[5],$$slots:{default:[UE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&32&&(f.data=s[5]),a&2097154&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function UE(r){let e,i;return e=new mr({props:{id:"routes",filter:r[1]==null?void 0:["!=",["id"],r[1]],paint:{"line-width":5,"line-color":ac,"line-opacity":.5}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&2&&(f.filter=s[1]==null?void 0:["!=",["id"],s[1]]),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function jE(r){let e,i,s=r[5]&&Jy(r);return{c(){e=ce("span"),s&&s.c(),He(e,"slot","extra-map")},m(a,f){ae(a,e,f),s&&s.m(e,null),i=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&_e(s,1)):(s=Jy(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d()}}}function VE(r){let e;return{c(){e=ce("option"),e.textContent=`${r[17]}`,e.__value=r[16],zi(e,e.__value)},m(i,s){ae(i,e,s)},p:nt,d(i){i&&oe(e)}}}function qE(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te=Hn(rd),ie=[];for(let re=0;re<te.length;re+=1)ie[re]=VE(BE(r,te,re));return{c(){e=ce("div"),i=ce("label"),s=Fe(`Name:
      `),a=ce("input"),f=je(),g=ce("label"),l=Fe(`Infrastructure type:
      `),x=ce("select");for(let re=0;re<ie.length;re+=1)ie[re].c();E=je(),C=ce("label"),L=Fe(`Notes:
      `),N=ce("textarea"),He(a,"type","text"),r[4]===void 0&&Po(()=>r[10].call(x)),He(N,"rows","5"),He(e,"slot","extra-right")},m(re,J){ae(re,e,J),Z(e,i),Z(i,s),Z(i,a),zi(a,r[2]),Z(e,f),Z(e,g),Z(g,l),Z(g,x);for(let $=0;$<ie.length;$+=1)ie[$]&&ie[$].m(x,null);fs(x,r[4],!0),Z(e,E),Z(e,C),Z(C,L),Z(C,N),zi(N,r[3]),B||(U=[Pt(a,"input",r[9]),Pt(x,"change",r[10]),Pt(N,"input",r[11])],B=!0)},p(re,J){J&4&&a.value!==re[2]&&zi(a,re[2]),J&16&&fs(x,re[4]),J&8&&zi(N,re[3])},d(re){re&&oe(e),Sr(ie,re),B=!1,$i(U)}}}function GE(r){let e,i;return e=new FE({props:{map:r[0],finish:r[7],cancel:r[8],deleteRoute:r[6],$$slots:{"extra-right":[qE],"extra-map":[jE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,[a]){const f={};a&1&&(f.map=s[0]),a&2097214&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function ZE(r,e,i){let s,a,f,g;Ot(r,Ni,$=>i(12,s=$)),Ot(r,sr,$=>i(13,a=$)),Ot(r,go,$=>i(14,f=$)),Ot(r,Qf,$=>i(15,g=$));let{map:l}=e,{id:x}=e,E="",C="",L="Unknown",N=null;cc(async()=>{if(i(5,N=await a.renderRoutes()),Dn(go,f=[],f),x!=null){let $=N.features.find(fe=>fe.id==x);i(2,E=$.properties.name),i(3,C=$.properties.notes),i(4,L=$.properties.infra_type),Dn(go,f=$.properties.waypoints.map(fe=>({point:[fe.lon,fe.lat],snapped:fe.snapped})),f)}});async function B(){x&&(await a.deleteRoute(x),await Dh()),Dn(Ni,s={kind:"main"},s)}async function U(){try{let $=JSON.parse(g.inner.calculateRoute(f));if(!$){window.alert("No route drawn");return}await a.setRoute(x,{feature:$,name:E,notes:C,nodes:$.properties.full_path,infra_type:L}),await Dh(),Dn(Ni,s={kind:"main"},s)}catch($){window.alert($)}}function te(){Dn(Ni,s={kind:"main"},s)}function ie(){E=this.value,i(2,E)}function re(){L=_l(this),i(4,L)}function J(){C=this.value,i(3,C)}return r.$$set=$=>{"map"in $&&i(0,l=$.map),"id"in $&&i(1,x=$.id)},[l,x,E,C,L,N,B,U,te,ie,re,J]}class HE extends fn{constructor(e){super(),hn(this,e,ZE,GE,un,{map:0,id:1})}}function Ky(r,e,i){const s=r.slice();return s[3]=e[i],s}function Qy(r){let e,i,s,a=r[3].infra_type+"",f,g,l=r[3].name+"",x,E,C;return{c(){e=ce("li"),i=ce("a"),s=Fe("["),f=Fe(a),g=Fe("] "),x=Fe(l),C=je(),He(i,"href",E=r[3].way),He(i,"target","_blank")},m(L,N){ae(L,e,N),Z(e,i),Z(i,s),Z(i,f),Z(i,g),Z(i,x),Z(e,C)},p(L,N){N&1&&a!==(a=L[3].infra_type+"")&&Mt(f,a),N&1&&l!==(l=L[3].name+"")&&Mt(x,l),N&1&&E!==(E=L[3].way)&&He(i,"href",E)},d(L){L&&oe(e)}}}function WE(r){let e,i,s,a=(r[0].route_length/r[0].direct_length).toFixed(1)+"",f,g,l,x,E,C,L=(r[0].route_length/r[0].car_length).toFixed(1)+"",N,B,U,te,ie,re,J,$,fe,ve=If(r[0],r[1])+"",Pe,ue,xe,be,Te,we=Sf(r[0],r[1])+"",ye,ze,Be,pt,St,dt=If(r[0],r[2])+"",ut,Bt,vt,wt,ft,xt=Sf(r[0],r[2])+"",It,Jt,pn,Rn,Xe,Wn,dn,Ft,Se=Hn(r[0].directions),lt=[];for(let Je=0;Je<Se.length;Je+=1)lt[Je]=Qy(Ky(r,Se,Je));return{c(){e=ce("p"),i=Fe("Detour factor: "),s=ce("b"),f=Fe(a),g=Fe("x"),l=Fe(`
  longer than straight line`),x=je(),E=ce("p"),C=ce("b"),N=Fe(L),B=Fe("x"),U=Fe(`
  longer than the driving route (in
  `),te=ce("span"),te.textContent="red",ie=Fe(`
  )`),re=je(),J=ce("hr"),$=je(),fe=ce("p"),Pe=Fe(ve),ue=Fe(" changes in infrastructure type"),xe=je(),be=ce("p"),Te=Fe("By length: "),ye=Fe(we),ze=je(),Be=ce("hr"),pt=je(),St=ce("p"),ut=Fe(dt),Bt=Fe(" changes in level of service"),vt=je(),wt=ce("p"),ft=Fe("By length: "),It=Fe(xt),Jt=je(),pn=ce("hr"),Rn=je(),Xe=ce("details"),Wn=ce("summary"),Wn.textContent="Route directions",dn=je(),Ft=ce("ol");for(let Je=0;Je<lt.length;Je+=1)lt[Je].c();Un(te,"color","red")},m(Je,Lt){ae(Je,e,Lt),Z(e,i),Z(e,s),Z(s,f),Z(s,g),Z(e,l),ae(Je,x,Lt),ae(Je,E,Lt),Z(E,C),Z(C,N),Z(C,B),Z(E,U),Z(E,te),Z(E,ie),ae(Je,re,Lt),ae(Je,J,Lt),ae(Je,$,Lt),ae(Je,fe,Lt),Z(fe,Pe),Z(fe,ue),ae(Je,xe,Lt),ae(Je,be,Lt),Z(be,Te),Z(be,ye),ae(Je,ze,Lt),ae(Je,Be,Lt),ae(Je,pt,Lt),ae(Je,St,Lt),Z(St,ut),Z(St,Bt),ae(Je,vt,Lt),ae(Je,wt,Lt),Z(wt,ft),Z(wt,It),ae(Je,Jt,Lt),ae(Je,pn,Lt),ae(Je,Rn,Lt),ae(Je,Xe,Lt),Z(Xe,Wn),Z(Xe,dn),Z(Xe,Ft);for(let Ye=0;Ye<lt.length;Ye+=1)lt[Ye]&&lt[Ye].m(Ft,null)},p(Je,[Lt]){if(Lt&1&&a!==(a=(Je[0].route_length/Je[0].direct_length).toFixed(1)+"")&&Mt(f,a),Lt&1&&L!==(L=(Je[0].route_length/Je[0].car_length).toFixed(1)+"")&&Mt(N,L),Lt&1&&ve!==(ve=If(Je[0],Je[1])+"")&&Mt(Pe,ve),Lt&1&&we!==(we=Sf(Je[0],Je[1])+"")&&Mt(ye,we),Lt&1&&dt!==(dt=If(Je[0],Je[2])+"")&&Mt(ut,dt),Lt&1&&xt!==(xt=Sf(Je[0],Je[2])+"")&&Mt(It,xt),Lt&1){Se=Hn(Je[0].directions);let Ye;for(Ye=0;Ye<Se.length;Ye+=1){const kt=Ky(Je,Se,Ye);lt[Ye]?lt[Ye].p(kt,Lt):(lt[Ye]=Qy(kt),lt[Ye].c(),lt[Ye].m(Ft,null))}for(;Ye<lt.length;Ye+=1)lt[Ye].d(1);lt.length=Se.length}},i:nt,o:nt,d(Je){Je&&(oe(e),oe(x),oe(E),oe(re),oe(J),oe($),oe(fe),oe(xe),oe(be),oe(ze),oe(Be),oe(pt),oe(St),oe(vt),oe(wt),oe(Jt),oe(pn),oe(Rn),oe(Xe)),Sr(lt,Je)}}}function If(r,e){let i=0;for(let s=0;s<r.directions.length-1;s++){let a=e(r.directions[s]),f=e(r.directions[s+1]);a!=f&&i++}return i}function Sf(r,e){let i={};for(let f of r.directions){let g=e(f);Object.hasOwn(i,g)||(i[g]=0),i[g]+=f.length}let s=0;for(let f of Object.values(i))s+=f;let a=[];for(let[f,g]of Object.entries(i).toSorted((l,x)=>x[1]-l[1])){let l=Math.round(g/s*100);a.push(`${l}% ${f}`)}return a.join(", ")}function XE(r,e,i){let{gj:s}=e,a=g=>g.infra_type,f=g=>g.los;return r.$$set=g=>{"gj"in g&&i(0,s=g.gj)},[s,a,f]}class $E extends fn{constructor(e){super(),hn(this,e,XE,WE,un,{gj:0})}}function e0(r){let e,i;return{c(){e=ce("p"),i=Fe(r[6])},m(s,a){ae(s,e,a),Z(e,i)},p(s,a){a&64&&Mt(i,s[6])},d(s){s&&oe(e)}}}function t0(r){let e,i;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function n0(r){let e,i;return e=new $E({props:{gj:r[5]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&32&&(f.gj=s[5]),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function YE(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re,J,$,fe=r[6]&&e0(r),ve=r[2]=="los"&&t0(),Pe=r[5]&&n0(r);return{c(){e=ce("div"),i=ce("h2"),i.textContent="Evaluate a route mode",s=je(),a=ce("button"),a.textContent="Back",f=je(),g=ce("p"),g.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,l=je(),fe&&fe.c(),x=je(),E=ce("label"),C=Fe(`Show details along route
      `),L=ce("select"),N=ce("option"),N.textContent="Just show route",B=ce("option"),B.textContent="Level of service",U=ce("option"),U.textContent="Infrastructure type",te=je(),ve&&ve.c(),ie=je(),Pe&&Pe.c(),N.__value="",zi(N,N.__value),B.__value="los",zi(B,B.__value),U.__value="infra_type",zi(U,U.__value),r[2]===void 0&&Po(()=>r[17].call(L)),He(e,"slot","left")},m(ue,xe){ae(ue,e,xe),Z(e,i),Z(e,s),Z(e,a),Z(e,f),Z(e,g),Z(e,l),fe&&fe.m(e,null),Z(e,x),Z(e,E),Z(E,C),Z(E,L),Z(L,N),Z(L,B),Z(L,U),fs(L,r[2],!0),Z(e,te),ve&&ve.m(e,null),Z(e,ie),Pe&&Pe.m(e,null),re=!0,J||($=[Pt(a,"click",r[16]),Pt(L,"change",r[17])],J=!0)},p(ue,xe){ue[6]?fe?fe.p(ue,xe):(fe=e0(ue),fe.c(),fe.m(e,x)):fe&&(fe.d(1),fe=null),xe&4&&fs(L,ue[2]),ue[2]=="los"?ve?xe&4&&_e(ve,1):(ve=t0(),ve.c(),_e(ve,1),ve.m(e,ie)):ve&&(Nn(),Ie(ve,1,1,()=>{ve=null}),zn()),ue[5]?Pe?(Pe.p(ue,xe),xe&32&&_e(Pe,1)):(Pe=n0(ue),Pe.c(),_e(Pe,1),Pe.m(e,null)):Pe&&(Nn(),Ie(Pe,1,1,()=>{Pe=null}),zn())},i(ue){re||(_e(ve),_e(Pe),re=!0)},o(ue){Ie(ve),Ie(Pe),re=!1},d(ue){ue&&oe(e),fe&&fe.d(),ve&&ve.d(),Pe&&Pe.d(),J=!1,$i($)}}}function JE(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function KE(r){let e,i;return e=new rr({props:{data:r[20],$$slots:{default:[QE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&256&&(f.data=s[20]),a&2097664&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function QE(r){let e,i;return e=new mr({props:{id:"routes",paint:{"line-width":5,"line-color":ac},layout:{visibility:r[9]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&512&&(f.layout={visibility:s[9]?"visible":"none"}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function eT(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function i0(r){let e,i,s,a,f,g;function l(L){r[14](L)}let x={draggable:!0,$$slots:{default:[tT]},$$scope:{ctx:r}};r[4]!==void 0&&(x.lngLat=r[4]),e=new Zf({props:x}),Jn.push(()=>Ir(e,"lngLat",l));function E(L){r[15](L)}let C={draggable:!0,$$slots:{default:[nT]},$$scope:{ctx:r}};return r[3]!==void 0&&(C.lngLat=r[3]),a=new Zf({props:C}),Jn.push(()=>Ir(a,"lngLat",E)),{c(){ot(e.$$.fragment),s=je(),ot(a.$$.fragment)},m(L,N){rt(e,L,N),ae(L,s,N),rt(a,L,N),g=!0},p(L,N){const B={};N&2097152&&(B.$$scope={dirty:N,ctx:L}),!i&&N&16&&(i=!0,B.lngLat=L[4],kr(()=>i=!1)),e.$set(B);const U={};N&2097152&&(U.$$scope={dirty:N,ctx:L}),!f&&N&8&&(f=!0,U.lngLat=L[3],kr(()=>f=!1)),a.$set(U)},i(L){g||(_e(e.$$.fragment,L),_e(a.$$.fragment,L),g=!0)},o(L){Ie(e.$$.fragment,L),Ie(a.$$.fragment,L),g=!1},d(L){L&&oe(s),st(e,L),st(a,L)}}}function tT(r){let e;return{c(){e=ce("span"),e.textContent="A",He(e,"class","dot svelte-1ej0v4r")},m(i,s){ae(i,e,s)},p:nt,d(i){i&&oe(e)}}}function nT(r){let e;return{c(){e=ce("span"),e.textContent="B",He(e,"class","dot svelte-1ej0v4r")},m(i,s){ae(i,e,s)},p:nt,d(i){i&&oe(e)}}}function r0(r){let e,i;return e=new rr({props:{data:r[5],generateId:!0,$$slots:{default:[iT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&32&&(f.data=s[5]),a&2097156&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function iT(r){let e,i,s,a;return e=new mr({props:{filter:["!",["has","car_route"]],paint:{"line-width":20,"line-color":r[2]==""?"cyan":r[2]=="los"?Bp:ac,"line-opacity":Ms(.5,1)},manageHoverState:!0}}),s=new mr({props:{filter:["has","car_route"],paint:{"line-width":10,"line-color":"red","line-opacity":Ms(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,g){const l={};g&4&&(l.paint={"line-width":20,"line-color":f[2]==""?"cyan":f[2]=="los"?Bp:ac,"line-opacity":Ms(.5,1)}),e.$set(l)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function rT(r){let e,i,s,a,f,g,l;i=new jv({}),i.$on("contextmenu",r[10]);let x={ctx:r,current:null,token:null,hasCatch:!1,pending:eT,then:KE,catch:JE,value:20,blocks:[,,,]};gs(a=wl(r[8]).renderRoutes(),x);let E=r[4]&&r[3]&&i0(r),C=r[5]&&r0(r);return{c(){e=ce("div"),ot(i.$$.fragment),s=je(),x.block.c(),f=je(),E&&E.c(),g=je(),C&&C.c(),He(e,"slot","map")},m(L,N){ae(L,e,N),rt(i,e,null),Z(e,s),x.block.m(e,x.anchor=null),x.mount=()=>e,x.anchor=f,Z(e,f),E&&E.m(e,null),Z(e,g),C&&C.m(e,null),l=!0},p(L,N){r=L,x.ctx=r,N&256&&a!==(a=wl(r[8]).renderRoutes())&&gs(a,x)||kl(x,r,N),r[4]&&r[3]?E?(E.p(r,N),N&24&&_e(E,1)):(E=i0(r),E.c(),_e(E,1),E.m(e,g)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn()),r[5]?C?(C.p(r,N),N&32&&_e(C,1)):(C=r0(r),C.c(),_e(C,1),C.m(e,null)):C&&(Nn(),Ie(C,1,1,()=>{C=null}),zn())},i(L){l||(_e(i.$$.fragment,L),_e(x.block),_e(E),_e(C),l=!0)},o(L){Ie(i.$$.fragment,L);for(let N=0;N<3;N+=1){const B=x.blocks[N];Ie(B)}Ie(E),Ie(C),l=!1},d(L){L&&oe(e),st(i),x.block.d(),x.token=null,x=null,E&&E.d(),C&&C.d()}}}function s0(r){let e,i,s,a,f,g,l,x=r[1]+1+"",E,C,L=r[0].length+"",N,B,U,te,ie,re,J;return{c(){e=ce("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",i=je(),s=ce("div"),a=ce("button"),f=Fe("Previous"),l=je(),E=Fe(x),C=Fe(" / "),N=Fe(L),B=je(),U=ce("button"),te=Fe("Next"),He(a,"class","secondary"),a.disabled=g=r[1]==0,He(U,"class","secondary"),U.disabled=ie=r[1]==r[0].length-1},m($,fe){ae($,e,fe),ae($,i,fe),ae($,s,fe),Z(s,a),Z(a,f),Z(s,l),Z(s,E),Z(s,C),Z(s,N),Z(s,B),Z(s,U),Z(U,te),re||(J=[Pt(a,"click",r[12]),Pt(U,"click",r[13])],re=!0)},p($,fe){fe&2&&g!==(g=$[1]==0)&&(a.disabled=g),fe&2&&x!==(x=$[1]+1+"")&&Mt(E,x),fe&1&&L!==(L=$[0].length+"")&&Mt(N,L),fe&3&&ie!==(ie=$[1]==$[0].length-1)&&(U.disabled=ie)},d($){$&&(oe(e),oe(i),oe(s)),re=!1,$i(J)}}}function sT(r){let e,i=r[0].length>0&&s0(r);return{c(){e=ce("div"),i&&i.c(),He(e,"slot","right")},m(s,a){ae(s,e,a),i&&i.m(e,null)},p(s,a){s[0].length>0?i?i.p(s,a):(i=s0(s),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(s){s&&oe(e),i&&i.d()}}}function oT(r){let e,i,s,a;return e=new gc({props:{$$slots:{right:[sT],map:[rT],left:[YE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(f,g){rt(e,f,g),i=!0,s||(a=Pt(window,"keydown",r[11]),s=!0)},p(f,[g]){const l={};g&2098175&&(l.$$scope={dirty:g,ctx:f}),e.$set(l)},i(f){i||(_e(e.$$.fragment,f),i=!0)},o(f){Ie(e.$$.fragment,f),i=!1},d(f){st(e,f),s=!1,a()}}}function aT(r,e,i){let s,a,f,g,l;Ot(r,Ni,ue=>i(7,s=ue)),Ot(r,Sh,ue=>i(3,a=ue)),Ot(r,Ju,ue=>i(4,f=ue)),Ot(r,sr,ue=>i(8,g=ue)),Ot(r,Op,ue=>i(9,l=ue));let{browse:x}=e,E=0,C=null,L="",N="los";async function B(ue,xe,be=""){try{i(5,C=await g.evaluateRoute({start:ue,end:[xe.lng,xe.lat],breakdown:be})),i(6,L="")}catch(Te){i(5,C=null),i(6,L=Te.toString())}}function U(ue){Dn(Ju,f=ue.detail.lngLat,f)}async function te(ue){if(x.length==0)return;let xe=x[ue];Dn(Ju,f={lng:xe[0].x,lat:xe[0].y},f),Dn(Sh,a={lng:xe[1].x,lat:xe[1].y},a),B(f,a,N)}function ie(ue){ue.key==="Escape"&&(ue.stopPropagation(),Dn(Ni,s={kind:"main"},s))}const re=()=>i(1,E--,E),J=()=>i(1,E++,E);function $(ue){f=ue,Ju.set(f)}function fe(ue){a=ue,Sh.set(a)}const ve=()=>Dn(Ni,s={kind:"main"},s);function Pe(){N=_l(this),i(2,N)}return r.$$set=ue=>{"browse"in ue&&i(0,x=ue.browse)},r.$$.update=()=>{r.$$.dirty&28&&B(f,a,N),r.$$.dirty&2&&te(E)},[x,E,N,a,f,C,L,s,g,l,U,ie,re,J,$,fe,ve,Pe]}class lT extends fn{constructor(e){super(),hn(this,e,aT,oT,un,{browse:0})}}function wr(r,e){return e==0?"0%":`${Math.round(r/e*100)}%`}function ed(r){return r.reduce((e,i)=>e+i,0)}function td(r){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]]]}function nm(r){return["step",["get",r],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function o0(r,e,i){const s=r.slice();return s[5]=e[i][0],s[6]=e[i][1],s}function a0(r){let e,i=r[0].succeeded.toLocaleString()+"",s,a,f=r[0].failed.toLocaleString()+"",g,l,x,E,C,L=r[0].max_count.toLocaleString()+"",N,B,U,te,ie,re,J,$=(100*r[0].percent_off_network).toFixed(1)+"",fe,ve,Pe,ue=Hn(Object.entries(r[0].percent_on_network)),xe=[];for(let be=0;be<ue.length;be+=1)xe[be]=l0(o0(r,ue,be));return{c(){e=ce("p"),s=Fe(i),a=Fe(" routes succeeded, "),g=Fe(f),l=Fe(`
        failed`),x=je(),E=ce("p"),C=Fe("Highest count on any one road is "),N=Fe(L),B=je(),U=ce("p"),U.textContent="Percent of demand by infrastructure type:",te=je(),ie=ce("ul"),re=ce("li"),J=Fe("Off the network: "),fe=Fe($),ve=Fe("%"),Pe=je();for(let be=0;be<xe.length;be+=1)xe[be].c()},m(be,Te){ae(be,e,Te),Z(e,s),Z(e,a),Z(e,g),Z(e,l),ae(be,x,Te),ae(be,E,Te),Z(E,C),Z(E,N),ae(be,B,Te),ae(be,U,Te),ae(be,te,Te),ae(be,ie,Te),Z(ie,re),Z(re,J),Z(re,fe),Z(re,ve),Z(ie,Pe);for(let we=0;we<xe.length;we+=1)xe[we]&&xe[we].m(ie,null)},p(be,Te){if(Te&1&&i!==(i=be[0].succeeded.toLocaleString()+"")&&Mt(s,i),Te&1&&f!==(f=be[0].failed.toLocaleString()+"")&&Mt(g,f),Te&1&&L!==(L=be[0].max_count.toLocaleString()+"")&&Mt(N,L),Te&1&&$!==($=(100*be[0].percent_off_network).toFixed(1)+"")&&Mt(fe,$),Te&1){ue=Hn(Object.entries(be[0].percent_on_network));let we;for(we=0;we<ue.length;we+=1){const ye=o0(be,ue,we);xe[we]?xe[we].p(ye,Te):(xe[we]=l0(ye),xe[we].c(),xe[we].m(ie,null))}for(;we<xe.length;we+=1)xe[we].d(1);xe.length=ue.length}},d(be){be&&(oe(e),oe(x),oe(E),oe(B),oe(U),oe(te),oe(ie)),Sr(xe,be)}}}function l0(r){let e,i=r[5]+"",s,a,f=(100*r[6]).toFixed(1)+"",g,l;return{c(){e=ce("li"),s=Fe(i),a=Fe(": "),g=Fe(f),l=Fe("%")},m(x,E){ae(x,e,E),Z(e,s),Z(e,a),Z(e,g),Z(e,l)},p(x,E){E&1&&i!==(i=x[5]+"")&&Mt(s,i),E&1&&f!==(f=(100*x[6]).toFixed(1)+"")&&Mt(g,f)},d(x){x&&oe(e)}}}function uT(r){let e,i,s,a,f,g,l,x=r[0]&&a0(r);return{c(){e=ce("div"),i=ce("h2"),i.textContent="Evaluate OD mode",s=je(),a=ce("button"),a.textContent="Back",f=je(),x&&x.c(),He(e,"slot","left")},m(E,C){ae(E,e,C),Z(e,i),Z(e,s),Z(e,a),Z(e,f),x&&x.m(e,null),g||(l=Pt(a,"click",r[2]),g=!0)},p(E,C){E[0]?x?x.p(E,C):(x=a0(E),x.c(),x.m(e,null)):x&&(x.d(1),x=null)},d(E){E&&oe(e),x&&x.d(),g=!1,l()}}}function u0(r){let e,i;return e=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[fT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.data=s[0]),a&512&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function cT(r){let e=r[4].count+"",i,s,a=r[4].infra_type+"",f;return{c(){i=Fe(e),s=Fe(" on "),f=Fe(a)},m(g,l){ae(g,i,l),ae(g,s,l),ae(g,f,l)},p(g,l){l&16&&e!==(e=g[4].count+"")&&Mt(i,e),l&16&&a!==(a=g[4].infra_type+"")&&Mt(f,a)},d(g){g&&(oe(i),oe(s),oe(f))}}}function hT(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[cT,({props:s})=>({4:s}),({props:s})=>s?16:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&528&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function fT(r){let e,i;return e=new mr({props:{paint:{"line-width":td("count"),"line-color":nm("count")},manageHoverState:!0,eventsIfTopMost:!0,$$slots:{default:[hT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&512&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function dT(r){let e,i,s=r[0]&&u0(r);return{c(){e=ce("div"),s&&s.c(),He(e,"slot","map")},m(a,f){ae(a,e,f),s&&s.m(e,null),i=!0},p(a,f){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=u0(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){i||(_e(s),i=!0)},o(a){Ie(s),i=!1},d(a){a&&oe(e),s&&s.d()}}}function pT(r){let e,i;return e=new gc({props:{$$slots:{map:[dT],left:[uT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,[a]){const f={};a&515&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function mT(r,e,i){let s,a;Ot(r,sr,l=>i(3,s=l)),Ot(r,Ni,l=>i(1,a=l));let f=null;return cc(async()=>{i(0,f=await s.evaluateOD())}),[f,a,()=>Dn(Ni,a={kind:"main"},a)]}class gT extends fn{constructor(e){super(),hn(this,e,mT,pT,un,{})}}function _T(r){let e;return{c(){e=ce("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(i,s){ae(i,e,s)},d(i){i&&oe(e)}}}function yT(r){let e;return{c(){e=ce("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(i,s){ae(i,e,s)},d(i){i&&oe(e)}}}function vT(r){let e;return{c(){e=ce("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(i,s){ae(i,e,s)},d(i){i&&oe(e)}}}function bT(r){let e;return{c(){e=ce("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(i,s){ae(i,e,s)},d(i){i&&oe(e)}}}function xT(r){let e;function i(f,g){if(f[0]=="primary")return bT;if(f[0]=="secondary")return vT;if(f[0]=="local access")return yT;if(f[0]=="long distance")return _T}let s=i(r),a=s&&s(r);return{c(){a&&a.c(),e=ai()},m(f,g){a&&a.m(f,g),ae(f,e,g)},p(f,g){s!==(s=i(f))&&(a&&a.d(1),a=s&&s(f),a&&(a.c(),a.m(e.parentNode,e)))},d(f){f&&oe(e),a&&a.d(f)}}}function wT(r){let e,i,s,a,f,g,l,x,E,C,L,N,B;return C=new Wv({props:{$$slots:{default:[xT]},$$scope:{ctx:r}}}),{c(){e=ce("div"),i=ce("button"),i.textContent="Primary routes",s=je(),a=ce("button"),a.textContent="Secondary routes",f=je(),g=ce("button"),g.textContent="Local access routes",l=je(),x=ce("button"),x.textContent="Long distance routes",E=je(),ot(C.$$.fragment),He(i,"class","svelte-gv50c1"),Un(i,"background",r[0]=="primary"?ds.primaryRoutes:"grey"),He(a,"class","svelte-gv50c1"),Un(a,"background",r[0]=="secondary"?ds.secondaryRoutes:"grey"),He(g,"class","svelte-gv50c1"),Un(g,"background",r[0]=="local access"?ds.localAccessRoutes:"grey"),He(x,"class","svelte-gv50c1"),Un(x,"background",r[0]=="long distance"?ds.longDistanceRoutes:"grey"),He(e,"class","svelte-gv50c1")},m(U,te){ae(U,e,te),Z(e,i),Z(e,s),Z(e,a),Z(e,f),Z(e,g),Z(e,l),Z(e,x),Z(e,E),rt(C,e,null),L=!0,N||(B=[Pt(i,"click",r[1]),Pt(a,"click",r[2]),Pt(g,"click",r[3]),Pt(x,"click",r[4])],N=!0)},p(U,[te]){te&1&&Un(i,"background",U[0]=="primary"?ds.primaryRoutes:"grey"),te&1&&Un(a,"background",U[0]=="secondary"?ds.secondaryRoutes:"grey"),te&1&&Un(g,"background",U[0]=="local access"?ds.localAccessRoutes:"grey"),te&1&&Un(x,"background",U[0]=="long distance"?ds.longDistanceRoutes:"grey");const ie={};te&33&&(ie.$$scope={dirty:te,ctx:U}),C.$set(ie)},i(U){L||(_e(C.$$.fragment,U),L=!0)},o(U){Ie(C.$$.fragment,U),L=!1},d(U){U&&oe(e),st(C),N=!1,$i(B)}}}function kT(r,e,i){let s;return Ot(r,Xu,x=>i(0,s=x)),[s,()=>Dn(Xu,s="primary",s),()=>Dn(Xu,s="secondary",s),()=>Dn(Xu,s="local access",s),()=>Dn(Xu,s="long distance",s)]}class IT extends fn{constructor(e){super(),hn(this,e,kT,wT,un,{})}}function ST(r){let e,i;const s=r[3].default,a=Zi(s,r,r[2],null);return{c(){e=ce("div"),a&&a.c()},m(f,g){ae(f,e,g),a&&a.m(e,null),r[4](e),i=!0},p(f,[g]){a&&a.p&&(!i||g&4)&&Wi(a,s,f,f[2],i?Hi(s,f[2],g,null):Xi(f[2]),null)},i(f){i||(_e(a,f),i=!0)},o(f){Ie(a,f),i=!1},d(f){f&&oe(e),a&&a.d(f),r[4](null)}}}function ET(r,e,i){let{$$slots:s={},$$scope:a}=e,{name:f}=e,g=null;function l(x){Jn[x?"unshift":"push"](()=>{g=x,i(0,g)})}return r.$$set=x=>{"name"in x&&i(1,f=x.name),"$$scope"in x&&i(2,a=x.$$scope)},r.$$.update=()=>{r.$$.dirty&3&&g&&Hv.update(x=>(x.set(f,g),x))},[g,f,a,s,l]}class to extends fn{constructor(e){super(),hn(this,e,ET,ST,un,{name:1})}}function c0(r){let e,i,s;return{c(){e=ce("button"),e.textContent="Import existing routes",He(e,"class","outline")},m(a,f){ae(a,e,f),i||(s=Pt(e,"click",r[6]),i=!0)},p:nt,d(a){a&&oe(e),i=!1,s()}}}function TT(r){let e,i,s,a,f,g,l,x=r[0]&&c0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Existing network`),a=je(),x&&x.c(),f=ai(),He(i,"type","checkbox")},m(E,C){ae(E,e,C),Z(e,i),i.checked=r[0],Z(e,s),ae(E,a,C),x&&x.m(E,C),ae(E,f,C),g||(l=Pt(i,"change",r[5]),g=!0)},p(E,C){C&1&&(i.checked=E[0]),E[0]?x?x.p(E,C):(x=c0(E),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(E){E&&(oe(e),oe(a),oe(f)),x&&x.d(E),g=!1,l()}}}function h0(r){let e,i;return e=new Vv({props:{$$slots:{default:[CT]},$$scope:{ctx:r}}}),e.$on("close",r[8]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&4100&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function CT(r){let e,i,s,a,f,g,l,x,E;return{c(){e=ce("h2"),e.textContent="Import existing routes from OpenStreetMap",i=je(),s=ce("p"),a=Fe(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),f=ce("button"),f.textContent="Import existing routes",g=je(),l=ce("button"),l.textContent="Cancel",He(l,"class","secondary")},m(C,L){ae(C,e,L),ae(C,i,L),ae(C,s,L),Z(s,a),Z(s,f),Z(s,g),Z(s,l),x||(E=[Pt(f,"click",r[4]),Pt(l,"click",r[7])],x=!0)},p:nt,d(C){C&&(oe(e),oe(i),oe(s)),x=!1,$i(E)}}}function f0(r){let e,i,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:DT,then:MT,catch:LT,value:10,blocks:[,,,]};return gs(i=r[3].classifyExistingNetwork(),a),{c(){e=ai(),a.block.c()},m(f,g){ae(f,e,g),a.block.m(f,a.anchor=g),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,g){r=f,a.ctx=r,g&8&&i!==(i=r[3].classifyExistingNetwork())&&gs(i,a)||kl(a,r,g)},i(f){s||(_e(a.block),s=!0)},o(f){for(let g=0;g<3;g+=1){const l=a.blocks[g];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function LT(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function MT(r){let e,i;return e=new rr({props:{data:r[10],generateId:!0,$$slots:{default:[RT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&8&&(f.data=s[10]),a&4097&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function AT(r){let e=oc[r[11].infra_type][0]+"",i;return{c(){i=Fe(e)},m(s,a){ae(s,i,a)},p(s,a){a&2048&&e!==(e=oc[s[11].infra_type][0]+"")&&Mt(i,e)},d(s){s&&oe(i)}}}function PT(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[AT,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&6144&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function RT(r){let e,i;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ms(5,7),"line-color":ac,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[PT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),a&4096&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function DT(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function NT(r){let e,i,s,a,f;e=new to({props:{name:"existing network",$$slots:{default:[TT]},$$scope:{ctx:r}}});let g=r[2]&&h0(r),l=r[3]&&r[1]&&f0(r);return{c(){ot(e.$$.fragment),i=je(),g&&g.c(),s=je(),l&&l.c(),a=ai()},m(x,E){rt(e,x,E),ae(x,i,E),g&&g.m(x,E),ae(x,s,E),l&&l.m(x,E),ae(x,a,E),f=!0},p(x,[E]){const C={};E&4101&&(C.$$scope={dirty:E,ctx:x}),e.$set(C),x[2]?g?(g.p(x,E),E&4&&_e(g,1)):(g=h0(x),g.c(),_e(g,1),g.m(s.parentNode,s)):g&&(Nn(),Ie(g,1,1,()=>{g=null}),zn()),x[3]&&x[1]?l?(l.p(x,E),E&10&&_e(l,1)):(l=f0(x),l.c(),_e(l,1),l.m(a.parentNode,a)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){f||(_e(e.$$.fragment,x),_e(g),_e(l),f=!0)},o(x){Ie(e.$$.fragment,x),Ie(g),Ie(l),f=!1},d(x){x&&(oe(i),oe(s),oe(a)),st(e,x),g&&g.d(x),l&&l.d(x)}}}function zT(r,e,i){let s,a;Ot(r,Rh,B=>i(9,s=B)),Ot(r,sr,B=>i(3,a=B));let f=!1,g=!1,l=!1;async function x(){if(i(2,l=!1),a){let B=a.importExistingRoutes(),U=B==1?"route segment":"route segments";await Dh(),Dn(Rh,s+=1,s),window.alert(`Imported ${B} ${U}`),i(0,f=!1)}}function E(){f=this.checked,i(0,f)}const C=()=>i(2,l=!0),L=()=>i(2,l=!1),N=()=>i(2,l=!1);return r.$$.update=()=>{r.$$.dirty&1&&f&&i(1,g=!0)},[f,g,l,a,x,E,C,L,N]}class OT extends fn{constructor(e){super(),hn(this,e,zT,NT,un,{})}}function d0(r,e,i){const s=r.slice();return s[17]=e[i][0],s[18]=e[i][1],s}function p0(r,e,i){const s=r.slice();return s[17]=e[i][0],s[18]=e[i][1],s}function m0(r,e,i){const s=r.slice();return s[17]=e[i][0],s[18]=e[i][1],s}function g0(r,e,i){const s=r.slice();return s[17]=e[i][0],s[18]=e[i][1],s}function _0(r,e,i){const s=r.slice();return s[17]=e[i][0],s[18]=e[i][1],s}function y0(r,e,i){const s=r.slice();return s[17]=e[i][0],s[18]=e[i][1],s}function v0(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re,J=Hn(r[7]),$=[];for(let Te=0;Te<J.length;Te+=1)$[Te]=b0(y0(r,J,Te));let fe=Hn(r[8]),ve=[];for(let Te=0;Te<fe.length;Te+=1)ve[Te]=x0(_0(r,fe,Te));let Pe=Hn(r[9]),ue=[];for(let Te=0;Te<Pe.length;Te+=1)ue[Te]=w0(g0(r,Pe,Te));let xe=Hn(r[10]),be=[];for(let Te=0;Te<xe.length;Te+=1)be[Te]=k0(m0(r,xe,Te));return{c(){e=ce("label"),i=Fe(`Trip purpose:
      `),s=ce("select");for(let Te=0;Te<$.length;Te+=1)$[Te].c();a=je(),f=ce("label"),g=Fe(`Scenario:
      `),l=ce("select");for(let Te=0;Te<ve.length;Te+=1)ve[Te].c();x=je(),E=ce("label"),C=Fe(`Network type:
      `),L=ce("select");for(let Te=0;Te<ue.length;Te+=1)ue[Te].c();N=je(),B=ce("label"),U=Fe(`Color by:
      `),te=ce("select");for(let Te=0;Te<be.length;Te+=1)be[Te].c();r[0]===void 0&&Po(()=>r[12].call(s)),r[1]===void 0&&Po(()=>r[13].call(l)),r[2]===void 0&&Po(()=>r[14].call(L)),r[3]===void 0&&Po(()=>r[15].call(te))},m(Te,we){ae(Te,e,we),Z(e,i),Z(e,s);for(let ye=0;ye<$.length;ye+=1)$[ye]&&$[ye].m(s,null);fs(s,r[0],!0),ae(Te,a,we),ae(Te,f,we),Z(f,g),Z(f,l);for(let ye=0;ye<ve.length;ye+=1)ve[ye]&&ve[ye].m(l,null);fs(l,r[1],!0),ae(Te,x,we),ae(Te,E,we),Z(E,C),Z(E,L);for(let ye=0;ye<ue.length;ye+=1)ue[ye]&&ue[ye].m(L,null);fs(L,r[2],!0),ae(Te,N,we),ae(Te,B,we),Z(B,U),Z(B,te);for(let ye=0;ye<be.length;ye+=1)be[ye]&&be[ye].m(te,null);fs(te,r[3],!0),ie||(re=[Pt(s,"change",r[12]),Pt(l,"change",r[13]),Pt(L,"change",r[14]),Pt(te,"change",r[15])],ie=!0)},p(Te,we){if(we[0]&128){J=Hn(Te[7]);let ye;for(ye=0;ye<J.length;ye+=1){const ze=y0(Te,J,ye);$[ye]?$[ye].p(ze,we):($[ye]=b0(ze),$[ye].c(),$[ye].m(s,null))}for(;ye<$.length;ye+=1)$[ye].d(1);$.length=J.length}if(we[0]&129&&fs(s,Te[0]),we[0]&256){fe=Hn(Te[8]);let ye;for(ye=0;ye<fe.length;ye+=1){const ze=_0(Te,fe,ye);ve[ye]?ve[ye].p(ze,we):(ve[ye]=x0(ze),ve[ye].c(),ve[ye].m(l,null))}for(;ye<ve.length;ye+=1)ve[ye].d(1);ve.length=fe.length}if(we[0]&258&&fs(l,Te[1]),we[0]&512){Pe=Hn(Te[9]);let ye;for(ye=0;ye<Pe.length;ye+=1){const ze=g0(Te,Pe,ye);ue[ye]?ue[ye].p(ze,we):(ue[ye]=w0(ze),ue[ye].c(),ue[ye].m(L,null))}for(;ye<ue.length;ye+=1)ue[ye].d(1);ue.length=Pe.length}if(we[0]&516&&fs(L,Te[2]),we[0]&1024){xe=Hn(Te[10]);let ye;for(ye=0;ye<xe.length;ye+=1){const ze=m0(Te,xe,ye);be[ye]?be[ye].p(ze,we):(be[ye]=k0(ze),be[ye].c(),be[ye].m(te,null))}for(;ye<be.length;ye+=1)be[ye].d(1);be.length=xe.length}we[0]&1032&&fs(te,Te[3])},d(Te){Te&&(oe(e),oe(a),oe(f),oe(x),oe(E),oe(N),oe(B)),Sr($,Te),Sr(ve,Te),Sr(ue,Te),Sr(be,Te),ie=!1,$i(re)}}}function b0(r){let e,i=r[18]+"",s;return{c(){e=ce("option"),s=Fe(i),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:nt,d(a){a&&oe(e)}}}function x0(r){let e,i=r[18]+"",s;return{c(){e=ce("option"),s=Fe(i),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:nt,d(a){a&&oe(e)}}}function w0(r){let e,i=r[18]+"",s;return{c(){e=ce("option"),s=Fe(i),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:nt,d(a){a&&oe(e)}}}function k0(r){let e,i=r[18]+"",s;return{c(){e=ce("option"),s=Fe(i),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:nt,d(a){a&&oe(e)}}}function FT(r){let e,i,s,a,f,g,l,x=r[5]&&v0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Route network`),a=je(),x&&x.c(),f=ai(),He(i,"type","checkbox")},m(E,C){ae(E,e,C),Z(e,i),i.checked=r[5],Z(e,s),ae(E,a,C),x&&x.m(E,C),ae(E,f,C),g||(l=Pt(i,"change",r[11]),g=!0)},p(E,C){C[0]&32&&(i.checked=E[5]),E[5]?x?x.p(E,C):(x=v0(E),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(E){E&&(oe(e),oe(a),oe(f)),x&&x.d(E),g=!1,l()}}}function I0(r){let e,i,s,a,f=r[16][`${r[17]}_fastest_bicycle`].toLocaleString()+"",g,l,x,E=r[16][`${r[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",C,L,N,B=r[16][`${r[17]}_fastest_bicycle_ebike`].toLocaleString()+"",U,te;return{c(){e=ce("tr"),i=ce("th"),i.textContent=`${r[18]}`,s=je(),a=ce("td"),g=Fe(f),l=je(),x=ce("td"),C=Fe(E),L=je(),N=ce("td"),U=Fe(B),te=je()},m(ie,re){ae(ie,e,re),Z(e,i),Z(e,s),Z(e,a),Z(a,g),Z(e,l),Z(e,x),Z(x,C),Z(e,L),Z(e,N),Z(N,U),Z(e,te)},p(ie,re){re[0]&65536&&f!==(f=ie[16][`${ie[17]}_fastest_bicycle`].toLocaleString()+"")&&Mt(g,f),re[0]&65536&&E!==(E=ie[16][`${ie[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&Mt(C,E),re[0]&65536&&B!==(B=ie[16][`${ie[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&Mt(U,B)},d(ie){ie&&oe(e)}}}function S0(r){let e,i,s,a,f=r[16][`${r[17]}_quietest_bicycle`].toLocaleString()+"",g,l,x,E=r[16][`${r[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",C,L,N,B=r[16][`${r[17]}_quietest_bicycle_ebike`].toLocaleString()+"",U,te;return{c(){e=ce("tr"),i=ce("th"),i.textContent=`${r[18]}`,s=je(),a=ce("td"),g=Fe(f),l=je(),x=ce("td"),C=Fe(E),L=je(),N=ce("td"),U=Fe(B),te=je()},m(ie,re){ae(ie,e,re),Z(e,i),Z(e,s),Z(e,a),Z(a,g),Z(e,l),Z(e,x),Z(x,C),Z(e,L),Z(e,N),Z(N,U),Z(e,te)},p(ie,re){re[0]&65536&&f!==(f=ie[16][`${ie[17]}_quietest_bicycle`].toLocaleString()+"")&&Mt(g,f),re[0]&65536&&E!==(E=ie[16][`${ie[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&Mt(C,E),re[0]&65536&&B!==(B=ie[16][`${ie[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&Mt(U,B)},d(ie){ie&&oe(e)}}}function BT(r){let e,i,s,a=r[16][r[4]].toLocaleString()+"",f,g,l,x,E=r[16].gradient+"",C,L,N,B,U,te=r[16].quietness+"",ie,re,J,$,fe,ve,Pe,ue,xe,be,Te,we,ye,ze,Be,pt,St,dt=Hn(r[7]),ut=[];for(let wt=0;wt<dt.length;wt+=1)ut[wt]=I0(p0(r,dt,wt));let Bt=Hn(r[7]),vt=[];for(let wt=0;wt<Bt.length;wt+=1)vt[wt]=S0(d0(r,Bt,wt));return{c(){e=ce("div"),i=ce("p"),s=Fe("Cyclists: "),f=Fe(a),g=je(),l=ce("p"),x=Fe("Gradient: "),C=Fe(E),L=Fe("%"),N=je(),B=ce("p"),U=Fe("Cycle-friendliness: "),ie=Fe(te),re=Fe("%"),J=je(),$=ce("details"),fe=ce("summary"),fe.textContent="All network details",ve=je(),Pe=ce("p"),Pe.textContent="Fast/Direct network",ue=je(),xe=ce("table"),be=ce("tr"),be.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Te=je();for(let wt=0;wt<ut.length;wt+=1)ut[wt].c();we=je(),ye=ce("p"),ye.textContent="Quiet/Indirect network",ze=je(),Be=ce("table"),pt=ce("tr"),pt.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",St=je();for(let wt=0;wt<vt.length;wt+=1)vt[wt].c();Un(e,"max-width","30vw"),Un(e,"max-height","60vh"),Un(e,"overflow","auto")},m(wt,ft){ae(wt,e,ft),Z(e,i),Z(i,s),Z(i,f),Z(e,g),Z(e,l),Z(l,x),Z(l,C),Z(l,L),Z(e,N),Z(e,B),Z(B,U),Z(B,ie),Z(B,re),Z(e,J),Z(e,$),Z($,fe),Z($,ve),Z($,Pe),Z($,ue),Z($,xe),Z(xe,be),Z(xe,Te);for(let xt=0;xt<ut.length;xt+=1)ut[xt]&&ut[xt].m(xe,null);Z($,we),Z($,ye),Z($,ze),Z($,Be),Z(Be,pt),Z(Be,St);for(let xt=0;xt<vt.length;xt+=1)vt[xt]&&vt[xt].m(Be,null)},p(wt,ft){if(ft[0]&65552&&a!==(a=wt[16][wt[4]].toLocaleString()+"")&&Mt(f,a),ft[0]&65536&&E!==(E=wt[16].gradient+"")&&Mt(C,E),ft[0]&65536&&te!==(te=wt[16].quietness+"")&&Mt(ie,te),ft[0]&65664){dt=Hn(wt[7]);let xt;for(xt=0;xt<dt.length;xt+=1){const It=p0(wt,dt,xt);ut[xt]?ut[xt].p(It,ft):(ut[xt]=I0(It),ut[xt].c(),ut[xt].m(xe,null))}for(;xt<ut.length;xt+=1)ut[xt].d(1);ut.length=dt.length}if(ft[0]&65664){Bt=Hn(wt[7]);let xt;for(xt=0;xt<Bt.length;xt+=1){const It=d0(wt,Bt,xt);vt[xt]?vt[xt].p(It,ft):(vt[xt]=S0(It),vt[xt].c(),vt[xt].m(Be,null))}for(;xt<vt.length;xt+=1)vt[xt].d(1);vt.length=Bt.length}},d(wt){wt&&oe(e),Sr(ut,wt),Sr(vt,wt)}}}function UT(r){let e,i;return e=new js({props:{openOn:"click",$$slots:{default:[BT,({props:s})=>({16:s}),({props:s})=>[s?65536:0]]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a[0]&65552|a[1]&1&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function jT(r){let e,i;return e=new mr({props:{sourceLayer:"rnet",paint:{"line-color":r[6],"line-width":td(r[4])},layout:{visibility:r[5]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[UT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a[0]&80&&(f.paint={"line-color":s[6],"line-width":td(s[4])}),a[0]&32&&(f.layout={visibility:s[5]?"visible":"none"}),a[0]&16|a[1]&1&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function VT(r){let e,i,s,a;return e=new to({props:{name:"route network",$$slots:{default:[FT]},$$scope:{ctx:r}}}),s=new Qp({props:{url:`pmtiles://${sd("route_network.pmtiles")}`,$$slots:{default:[jT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,g){const l={};g[0]&47|g[1]&1&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g[0]&112|g[1]&1&&(x.$$scope={dirty:g,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function qT(r,e,i){let s,a,f=!1,g="all",l="bicycle_go_dutch",x="fastest",E="flow",C=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],L=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],N=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],B=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function U(){f=this.checked,i(5,f)}function te(){g=_l(this),i(0,g),i(7,C)}function ie(){l=_l(this),i(1,l),i(8,L)}function re(){x=_l(this),i(2,x),i(9,N)}function J(){E=_l(this),i(3,E),i(10,B)}return r.$$.update=()=>{r.$$.dirty[0]&7&&i(4,s=`${g}_${x}_${l}`),r.$$.dirty[0]&24&&i(6,a={none:"#304ce7",flow:nm(s),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:["step",["get","gradient"],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}[E])},[g,l,x,E,s,f,a,C,L,N,B,U,te,ie,re,J]}class GT extends fn{constructor(e){super(),hn(this,e,qT,VT,un,{},null,[-1,-1])}}function E0(r){let e,i,s,a,f,g,l,x,E,C,L;return{c(){e=ce("button"),e.textContent="Import core network",i=je(),s=ce("label"),a=ce("input"),f=Fe(`
      Show actual core network`),g=je(),l=ce("label"),x=ce("input"),E=Fe(`
      Show map-matched core network`),He(e,"class","outline"),He(a,"type","checkbox"),He(x,"type","checkbox"),Un(l,"color","red")},m(N,B){ae(N,e,B),ae(N,i,B),ae(N,s,B),Z(s,a),a.checked=r[2],Z(s,f),ae(N,g,B),ae(N,l,B),Z(l,x),x.checked=r[3],Z(l,E),C||(L=[Pt(e,"click",r[5]),Pt(a,"change",r[7]),Pt(x,"change",r[8])],C=!0)},p(N,B){B&4&&(a.checked=N[2]),B&8&&(x.checked=N[3])},d(N){N&&(oe(e),oe(i),oe(s),oe(g),oe(l)),C=!1,$i(L)}}}function ZT(r){let e,i,s,a,f,g,l,x=r[0]&&E0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Core network`),a=je(),x&&x.c(),f=ai(),He(i,"type","checkbox")},m(E,C){ae(E,e,C),Z(e,i),i.checked=r[0],Z(e,s),ae(E,a,C),x&&x.m(E,C),ae(E,f,C),g||(l=Pt(i,"change",r[6]),g=!0)},p(E,C){C&1&&(i.checked=E[0]),E[0]?x?x.p(E,C):(x=E0(E),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(E){E&&(oe(e),oe(a),oe(f)),x&&x.d(E),g=!1,l()}}}function HT(r){let e,i=r[11].all_fastest_bicycle_go_dutch+"",s;return{c(){e=Fe("Go Dutch value "),s=Fe(i)},m(a,f){ae(a,e,f),ae(a,s,f)},p(a,f){f&2048&&i!==(i=a[11].all_fastest_bicycle_go_dutch+"")&&Mt(s,i)},d(a){a&&(oe(e),oe(s))}}}function WT(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[HT,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&6144&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function XT(r){let e,i;return e=new mr({props:{sourceLayer:"coherent_networks",paint:{"line-color":"black","line-width":2},layout:{visibility:r[0]&&r[2]?"visible":"none"},$$slots:{default:[WT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&5&&(f.layout={visibility:s[0]&&s[2]?"visible":"none"}),a&4096&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function T0(r){let e,i,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:KT,then:YT,catch:$T,value:10,blocks:[,,,]};return gs(i=r[4].renderCoreNetwork(),a),{c(){e=ai(),a.block.c()},m(f,g){ae(f,e,g),a.block.m(f,a.anchor=g),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,g){r=f,a.ctx=r,g&16&&i!==(i=r[4].renderCoreNetwork())&&gs(i,a)||kl(a,r,g)},i(f){s||(_e(a.block),s=!0)},o(f){for(let g=0;g<3;g+=1){const l=a.blocks[g];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function $T(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function YT(r){let e,i;return e=new rr({props:{data:r[10],generateId:!0,$$slots:{default:[JT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&16&&(f.data=s[10]),a&4105&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function JT(r){let e,i;return e=new mr({props:{paint:{"line-color":"red","line-width":10,"line-opacity":.5},layout:{visibility:r[0]&&r[3]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&9&&(f.layout={visibility:s[0]&&s[3]?"visible":"none"}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function KT(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function QT(r){let e,i,s,a,f,g;e=new to({props:{name:"core network",$$slots:{default:[ZT]},$$scope:{ctx:r}}}),s=new Qp({props:{url:`pmtiles://${sd("core_network.pmtiles")}`,$$slots:{default:[XT]},$$scope:{ctx:r}}});let l=r[4]&&r[1]&&T0(r);return{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment),a=je(),l&&l.c(),f=ai()},m(x,E){rt(e,x,E),ae(x,i,E),rt(s,x,E),ae(x,a,E),l&&l.m(x,E),ae(x,f,E),g=!0},p(x,[E]){const C={};E&4109&&(C.$$scope={dirty:E,ctx:x}),e.$set(C);const L={};E&4101&&(L.$$scope={dirty:E,ctx:x}),s.$set(L),x[4]&&x[1]?l?(l.p(x,E),E&18&&_e(l,1)):(l=T0(x),l.c(),_e(l,1),l.m(f.parentNode,f)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){g||(_e(e.$$.fragment,x),_e(s.$$.fragment,x),_e(l),g=!0)},o(x){Ie(e.$$.fragment,x),Ie(s.$$.fragment,x),Ie(l),g=!1},d(x){x&&(oe(i),oe(a),oe(f)),st(e,x),st(s,x),l&&l.d(x)}}}function eC(r,e,i){let s,a;Ot(r,Rh,B=>i(9,s=B)),Ot(r,sr,B=>i(4,a=B));let f=!1,g=!1,l=!0,x=!0;async function E(){if(a){let B=a.importCoreNetwork(),U=B==1?"route segment":"route segments";await Dh(),Dn(Rh,s+=1,s),window.alert(`Imported ${B} ${U}`)}}function C(){f=this.checked,i(0,f)}function L(){l=this.checked,i(2,l)}function N(){x=this.checked,i(3,x)}return r.$$.update=()=>{r.$$.dirty&1&&f&&i(1,g=!0)},[f,g,l,x,a,E,C,L,N]}class tC extends fn{constructor(e){super(),hn(this,e,eC,QT,un,{})}}function nC(r){let e,i;return e=new mr({props:{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function iC(r){let e,i;return e=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[nC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,[a]){const f={};a&1&&(f.data=s[0]),a&32&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function rC(r,e,i){let s;Ot(r,sr,x=>i(3,s=x));let{kind:a}=e,{hovered:f}=e,g={type:"FeatureCollection",features:[]};async function l(x){s&&x?x.properties.reachable?i(0,g=await s.debugReachablePath(a,x.properties.idx)):i(0,g=await s.debugUnreachablePath(a,x.properties.idx)):i(0,g={type:"FeatureCollection",features:[]})}return r.$$set=x=>{"kind"in x&&i(1,a=x.kind),"hovered"in x&&i(2,f=x.hovered)},r.$$.update=()=>{r.$$.dirty&4&&l(f)},[g,a,f]}class im extends fn{constructor(e){super(),hn(this,e,rC,iC,un,{kind:1,hovered:2})}}function C0(r){let e,i,s,a=r[3].toLocaleString()+"",f,g,l=r[0].features.length.toLocaleString()+"",x,E,C=wr(r[3],r[0].features.length)+"",L,N,B,U,te,ie,re;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ce("button"),e.textContent="Recalculate",i=je(),s=ce("p"),f=Fe(a),g=Fe(" / "),x=Fe(l),E=Fe(" ("),L=Fe(C),N=Fe(") reachable"),B=je(),ot(U.$$.fragment),He(e,"class","outline")},m(J,$){ae(J,e,$),ae(J,i,$),ae(J,s,$),Z(s,f),Z(s,g),Z(s,x),Z(s,E),Z(s,L),Z(s,N),ae(J,B,$),rt(U,J,$),te=!0,ie||(re=Pt(e,"click",r[4]),ie=!0)},p(J,$){(!te||$&8)&&a!==(a=J[3].toLocaleString()+"")&&Mt(f,a),(!te||$&1)&&l!==(l=J[0].features.length.toLocaleString()+"")&&Mt(x,l),(!te||$&9)&&C!==(C=wr(J[3],J[0].features.length)+"")&&Mt(L,C)},i(J){te||(_e(U.$$.fragment,J),te=!0)},o(J){Ie(U.$$.fragment,J),te=!1},d(J){J&&(oe(e),oe(i),oe(s),oe(B)),st(U,J),ie=!1,re()}}}function sC(r){let e,i,s,a,f,g,l,x,E=r[1]&&C0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Schools`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[1],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[5]),l=!0)},p(C,L){L&2&&(i.checked=C[1]),C[1]?E?(E.p(C,L),L&2&&_e(E,1)):(E=C0(C),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function oC(r){let e=r[8].name+"",i,s,a=r[8].kind+"",f,g,l=r[8].pupils+"",x,E,C=r[8].reachable?"is":"is not",L,N;return{c(){i=Fe(e),s=Fe(" is a "),f=Fe(a),g=Fe(" school with "),x=Fe(l),E=Fe(" pupils. It "),L=Fe(C),N=Fe(" reachable.")},m(B,U){ae(B,i,U),ae(B,s,U),ae(B,f,U),ae(B,g,U),ae(B,x,U),ae(B,E,U),ae(B,L,U),ae(B,N,U)},p(B,U){U&256&&e!==(e=B[8].name+"")&&Mt(i,e),U&256&&a!==(a=B[8].kind+"")&&Mt(f,a),U&256&&l!==(l=B[8].pupils+"")&&Mt(x,l),U&256&&C!==(C=B[8].reachable?"is":"is not")&&Mt(L,C)},d(B){B&&(oe(i),oe(s),oe(f),oe(g),oe(x),oe(E),oe(L),oe(N))}}}function aC(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[oC,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&768&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function lC(r){let e,i,s;function a(g){r[6](g)}let f={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Ms(5,8)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[aC]},$$scope:{ctx:r}};return r[2]!==void 0&&(f.hovered=r[2]),e=new Kp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(g,l){rt(e,g,l),s=!0},p(g,l){const x={};l&2&&(x.layout={visibility:g[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:g}),!i&&l&4&&(i=!0,x.hovered=g[2],kr(()=>i=!1)),e.$set(x)},i(g){s||(_e(e.$$.fragment,g),s=!0)},o(g){Ie(e.$$.fragment,g),s=!1},d(g){st(e,g)}}}function uC(r){let e,i,s,a,f,g;return e=new to({props:{name:"schools",$$slots:{default:[sC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[lC]},$$scope:{ctx:r}}}),f=new im({props:{kind:"schools",hovered:r[2]}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment),a=je(),ot(f.$$.fragment)},m(l,x){rt(e,l,x),ae(l,i,x),rt(s,l,x),ae(l,a,x),rt(f,l,x),g=!0},p(l,[x]){const E={};x&523&&(E.$$scope={dirty:x,ctx:l}),e.$set(E);const C={};x&1&&(C.data=l[0]),x&518&&(C.$$scope={dirty:x,ctx:l}),s.$set(C);const L={};x&4&&(L.hovered=l[2]),f.$set(L)},i(l){g||(_e(e.$$.fragment,l),_e(s.$$.fragment,l),_e(f.$$.fragment,l),g=!0)},o(l){Ie(e.$$.fragment,l),Ie(s.$$.fragment,l),Ie(f.$$.fragment,l),g=!1},d(l){l&&(oe(i),oe(a)),st(e,l),st(s,l),st(f,l)}}}function cC(r,e,i){let s,a,f;Ot(r,Wf,L=>i(1,a=L)),Ot(r,sr,L=>i(7,f=L));let g={type:"FeatureCollection",features:[]},l;async function x(){f&&i(0,g=await f.getSchools())}function E(){a=this.checked,Wf.set(a)}function C(L){l=L,i(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&g.features.length==0&&x(),r.$$.dirty&1&&i(3,s=g.features.filter(L=>L.properties.reachable).length)},[g,a,l,s,x,E,C]}class hC extends fn{constructor(e){super(),hn(this,e,cC,uC,un,{})}}function L0(r){let e,i,s,a=r[3].toLocaleString()+"",f,g,l=r[0].features.length.toLocaleString()+"",x,E,C=wr(r[3],r[0].features.length)+"",L,N,B,U,te,ie,re;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ce("button"),e.textContent="Recalculate",i=je(),s=ce("p"),f=Fe(a),g=Fe(" / "),x=Fe(l),E=Fe(" ("),L=Fe(C),N=Fe(") reachable"),B=je(),ot(U.$$.fragment),He(e,"class","outline")},m(J,$){ae(J,e,$),ae(J,i,$),ae(J,s,$),Z(s,f),Z(s,g),Z(s,x),Z(s,E),Z(s,L),Z(s,N),ae(J,B,$),rt(U,J,$),te=!0,ie||(re=Pt(e,"click",r[4]),ie=!0)},p(J,$){(!te||$&8)&&a!==(a=J[3].toLocaleString()+"")&&Mt(f,a),(!te||$&1)&&l!==(l=J[0].features.length.toLocaleString()+"")&&Mt(x,l),(!te||$&9)&&C!==(C=wr(J[3],J[0].features.length)+"")&&Mt(L,C)},i(J){te||(_e(U.$$.fragment,J),te=!0)},o(J){Ie(U.$$.fragment,J),te=!1},d(J){J&&(oe(e),oe(i),oe(s),oe(B)),st(U,J),ie=!1,re()}}}function fC(r){let e,i,s,a,f,g,l,x,E=r[1]&&L0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Town centres`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[1],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[5]),l=!0)},p(C,L){L&2&&(i.checked=C[1]),C[1]?E?(E.p(C,L),L&2&&_e(E,1)):(E=L0(C),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function dC(r){let e,i=(r[8].name||"")+"",s,a,f=r[8].reachable?"is":"is not",g,l;return{c(){e=Fe("Town centre "),s=Fe(i),a=je(),g=Fe(f),l=Fe(" reachable.")},m(x,E){ae(x,e,E),ae(x,s,E),ae(x,a,E),ae(x,g,E),ae(x,l,E)},p(x,E){E&256&&i!==(i=(x[8].name||"")+"")&&Mt(s,i),E&256&&f!==(f=x[8].reachable?"is":"is not")&&Mt(g,f)},d(x){x&&(oe(e),oe(s),oe(a),oe(g),oe(l))}}}function pC(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[dC,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&768&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function mC(r){let e,i,s;function a(g){r[6](g)}let f={manageHoverState:!0,paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":Ms(.7,.9)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[pC]},$$scope:{ctx:r}};return r[2]!==void 0&&(f.hovered=r[2]),e=new mc({props:f}),Jn.push(()=>Ir(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(g,l){rt(e,g,l),s=!0},p(g,l){const x={};l&2&&(x.layout={visibility:g[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:g}),!i&&l&4&&(i=!0,x.hovered=g[2],kr(()=>i=!1)),e.$set(x)},i(g){s||(_e(e.$$.fragment,g),s=!0)},o(g){Ie(e.$$.fragment,g),s=!1},d(g){st(e,g)}}}function gC(r){let e,i,s,a,f,g;return e=new to({props:{name:"town centres",$$slots:{default:[fC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[mC]},$$scope:{ctx:r}}}),f=new im({props:{kind:"town_centres",hovered:r[2]}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment),a=je(),ot(f.$$.fragment)},m(l,x){rt(e,l,x),ae(l,i,x),rt(s,l,x),ae(l,a,x),rt(f,l,x),g=!0},p(l,[x]){const E={};x&523&&(E.$$scope={dirty:x,ctx:l}),e.$set(E);const C={};x&1&&(C.data=l[0]),x&518&&(C.$$scope={dirty:x,ctx:l}),s.$set(C);const L={};x&4&&(L.hovered=l[2]),f.$set(L)},i(l){g||(_e(e.$$.fragment,l),_e(s.$$.fragment,l),_e(f.$$.fragment,l),g=!0)},o(l){Ie(e.$$.fragment,l),Ie(s.$$.fragment,l),Ie(f.$$.fragment,l),g=!1},d(l){l&&(oe(i),oe(a)),st(e,l),st(s,l),st(f,l)}}}function _C(r,e,i){let s,a,f;Ot(r,$f,L=>i(1,a=L)),Ot(r,sr,L=>i(7,f=L));let g={type:"FeatureCollection",features:[]},l;async function x(){f&&i(0,g=await f.getTownCentres())}function E(){a=this.checked,$f.set(a)}function C(L){l=L,i(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&g.features.length==0&&x(),r.$$.dirty&1&&i(3,s=g.features.filter(L=>L.properties.reachable).length)},[g,a,l,s,x,E,C]}class yC extends fn{constructor(e){super(),hn(this,e,_C,gC,un,{})}}function M0(r){let e,i,s,a=r[3].toLocaleString()+"",f,g,l=r[0].features.length.toLocaleString()+"",x,E,C=wr(r[3],r[0].features.length)+"",L,N,B,U,te,ie,re;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ce("button"),e.textContent="Recalculate",i=je(),s=ce("p"),f=Fe(a),g=Fe(" / "),x=Fe(l),E=Fe(" ("),L=Fe(C),N=Fe(") reachable"),B=je(),ot(U.$$.fragment),He(e,"class","outline")},m(J,$){ae(J,e,$),ae(J,i,$),ae(J,s,$),Z(s,f),Z(s,g),Z(s,x),Z(s,E),Z(s,L),Z(s,N),ae(J,B,$),rt(U,J,$),te=!0,ie||(re=Pt(e,"click",r[4]),ie=!0)},p(J,$){(!te||$&8)&&a!==(a=J[3].toLocaleString()+"")&&Mt(f,a),(!te||$&1)&&l!==(l=J[0].features.length.toLocaleString()+"")&&Mt(x,l),(!te||$&9)&&C!==(C=wr(J[3],J[0].features.length)+"")&&Mt(L,C)},i(J){te||(_e(U.$$.fragment,J),te=!0)},o(J){Ie(U.$$.fragment,J),te=!1},d(J){J&&(oe(e),oe(i),oe(s),oe(B)),st(U,J),ie=!1,re()}}}function vC(r){let e,i,s,a,f,g,l,x,E=r[1]&&M0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    GPs and hospitals`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[1],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[5]),l=!0)},p(C,L){L&2&&(i.checked=C[1]),C[1]?E?(E.p(C,L),L&2&&_e(E,1)):(E=M0(C),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function bC(r){let e=r[8].name+"",i,s,a=r[8].kind+"",f,g,l=r[8].reachable?"is":"is not",x,E;return{c(){i=Fe(e),s=Fe(" is a "),f=Fe(a),g=Fe(". It "),x=Fe(l),E=Fe(" reachable.")},m(C,L){ae(C,i,L),ae(C,s,L),ae(C,f,L),ae(C,g,L),ae(C,x,L),ae(C,E,L)},p(C,L){L&256&&e!==(e=C[8].name+"")&&Mt(i,e),L&256&&a!==(a=C[8].kind+"")&&Mt(f,a),L&256&&l!==(l=C[8].reachable?"is":"is not")&&Mt(x,l)},d(C){C&&(oe(i),oe(s),oe(f),oe(g),oe(x),oe(E))}}}function xC(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[bC,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&768&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function wC(r){let e,i,s;function a(g){r[6](g)}let f={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Ms(5,8)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[xC]},$$scope:{ctx:r}};return r[2]!==void 0&&(f.hovered=r[2]),e=new Kp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(g,l){rt(e,g,l),s=!0},p(g,l){const x={};l&2&&(x.layout={visibility:g[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:g}),!i&&l&4&&(i=!0,x.hovered=g[2],kr(()=>i=!1)),e.$set(x)},i(g){s||(_e(e.$$.fragment,g),s=!0)},o(g){Ie(e.$$.fragment,g),s=!1},d(g){st(e,g)}}}function kC(r){let e,i,s,a,f,g;return e=new to({props:{name:"gp hospitals",$$slots:{default:[vC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[wC]},$$scope:{ctx:r}}}),f=new im({props:{kind:"gp_hospitals",hovered:r[2]}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment),a=je(),ot(f.$$.fragment)},m(l,x){rt(e,l,x),ae(l,i,x),rt(s,l,x),ae(l,a,x),rt(f,l,x),g=!0},p(l,[x]){const E={};x&523&&(E.$$scope={dirty:x,ctx:l}),e.$set(E);const C={};x&1&&(C.data=l[0]),x&518&&(C.$$scope={dirty:x,ctx:l}),s.$set(C);const L={};x&4&&(L.hovered=l[2]),f.$set(L)},i(l){g||(_e(e.$$.fragment,l),_e(s.$$.fragment,l),_e(f.$$.fragment,l),g=!0)},o(l){Ie(e.$$.fragment,l),Ie(s.$$.fragment,l),Ie(f.$$.fragment,l),g=!1},d(l){l&&(oe(i),oe(a)),st(e,l),st(s,l),st(f,l)}}}function IC(r,e,i){let s,a,f;Ot(r,Xf,L=>i(1,a=L)),Ot(r,sr,L=>i(7,f=L));let g={type:"FeatureCollection",features:[]},l;async function x(){f&&i(0,g=await f.getGpHospitals())}function E(){a=this.checked,Xf.set(a)}function C(L){l=L,i(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&g.features.length==0&&x(),r.$$.dirty&1&&i(3,s=g.features.filter(L=>L.properties.reachable).length)},[g,a,l,s,x,E,C]}class SC extends fn{constructor(e){super(),hn(this,e,IC,kC,un,{})}}function EC(r){let e,i,s,a,f;return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Urban areas`),He(i,"type","checkbox")},m(g,l){ae(g,e,l),Z(e,i),i.checked=r[0],Z(e,s),a||(f=Pt(i,"change",r[1]),a=!0)},p(g,l){l&1&&(i.checked=g[0])},d(g){g&&oe(e),a=!1,f()}}}function TC(r){let e,i;return e=new mc({props:{sourceLayer:"urban_areas",manageHoverState:!0,paint:{"fill-color":"black","fill-opacity":Ms(1,.5)},layout:{visibility:r[0]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function CC(r){let e,i,s,a;return e=new to({props:{name:"urban areas",$$slots:{default:[EC]},$$scope:{ctx:r}}}),s=new Qp({props:{url:`pmtiles://${sd("urban_areas.pmtiles")}`,$$slots:{default:[TC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,[g]){const l={};g&5&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g&5&&(x.$$scope={dirty:g,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function LC(r,e,i){let s=!1;function a(){s=this.checked,i(0,s)}return[s,a]}class MC extends fn{constructor(e){super(),hn(this,e,LC,CC,un,{})}}function A0(r){let e,i,s,a,f,g;return s=new _c({props:{colors:r[3]}}),{c(){e=ce("button"),e.textContent="Recalculate",i=je(),ot(s.$$.fragment),He(e,"class","outline")},m(l,x){ae(l,e,x),ae(l,i,x),rt(s,l,x),a=!0,f||(g=Pt(e,"click",r[2]),f=!0)},p:nt,i(l){a||(_e(s.$$.fragment,l),a=!0)},o(l){Ie(s.$$.fragment,l),a=!1},d(l){l&&(oe(e),oe(i)),st(s,l),f=!1,g()}}}function AC(r){let e,i,s,a,f,g,l,x,E=r[0]&&A0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Reachable network`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[0],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[4]),l=!0)},p(C,L){L&1&&(i.checked=C[0]),C[0]?E?(E.p(C,L),L&1&&_e(E,1)):(E=A0(C),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function PC(r){let e,i;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ms(5,7),"line-color":Xp(["get","kind"],r[3],"black"),"line-opacity":.8},manageHoverState:!0}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function RC(r){let e,i,s,a;return e=new to({props:{name:"reachable network",$$slots:{default:[AC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[1],generateId:!0,$$slots:{default:[PC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,[g]){const l={};g&65&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g&2&&(x.data=f[1]),g&65&&(x.$$scope={dirty:g,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function DC(r,e,i){let s;Ot(r,sr,E=>i(5,s=E));let a=!1,f={type:"FeatureCollection",features:[]};async function g(){i(1,f=await s.renderReachableNetwork())}let l={network:"green",reachable:"purple",severance:"red"};function x(){a=this.checked,i(0,a)}return r.$$.update=()=>{r.$$.dirty&3&&a&&f.features.length==0&&g()},[a,f,g,l,x]}class NC extends fn{constructor(e){super(),hn(this,e,DC,RC,un,{})}}function P0(r){let e,i;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function zC(r){let e,i,s,a,f,g,l,x,E=r[0]&&P0();return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Level of Service`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[0],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[3]),l=!0)},p(C,L){L&1&&(i.checked=C[0]),C[0]?E?L&1&&_e(E,1):(E=P0(),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function R0(r){let e,i,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:VC,then:FC,catch:OC,value:4,blocks:[,,,]};return gs(i=r[2].renderLevelOfService(),a),{c(){e=ai(),a.block.c()},m(f,g){ae(f,e,g),a.block.m(f,a.anchor=g),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,g){r=f,a.ctx=r,g&4&&i!==(i=r[2].renderLevelOfService())&&gs(i,a)||kl(a,r,g)},i(f){s||(_e(a.block),s=!0)},o(f){for(let g=0;g<3;g+=1){const l=a.blocks[g];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function OC(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function FC(r){let e,i;return e=new rr({props:{data:r[4],generateId:!0,$$slots:{default:[jC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&4&&(f.data=s[4]),a&65&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function BC(r){let e,i,s,a,f,g=r[5].los+"",l,x,E,C,L,N,B=oc[r[5].infra_type][0]+"",U,te,ie,re,J,$,fe=r[5].speed+"",ve,Pe,ue,xe,be,Te,we=r[5].traffic.toLocaleString()+"",ye;return{c(){e=ce("table"),i=ce("tr"),s=ce("th"),s.textContent="Level of Service",a=je(),f=ce("td"),l=Fe(g),x=je(),E=ce("tr"),C=ce("th"),C.textContent="Infrastructure type",L=je(),N=ce("td"),U=Fe(B),te=je(),ie=ce("tr"),re=ce("th"),re.textContent="Speed (mph)",J=je(),$=ce("td"),ve=Fe(fe),Pe=je(),ue=ce("tr"),xe=ce("th"),xe.textContent="Estimated daily traffic volume",be=je(),Te=ce("td"),ye=Fe(we)},m(ze,Be){ae(ze,e,Be),Z(e,i),Z(i,s),Z(i,a),Z(i,f),Z(f,l),Z(e,x),Z(e,E),Z(E,C),Z(E,L),Z(E,N),Z(N,U),Z(e,te),Z(e,ie),Z(ie,re),Z(ie,J),Z(ie,$),Z($,ve),Z(e,Pe),Z(e,ue),Z(ue,xe),Z(ue,be),Z(ue,Te),Z(Te,ye)},p(ze,Be){Be&32&&g!==(g=ze[5].los+"")&&Mt(l,g),Be&32&&B!==(B=oc[ze[5].infra_type][0]+"")&&Mt(U,B),Be&32&&fe!==(fe=ze[5].speed+"")&&Mt(ve,fe),Be&32&&we!==(we=ze[5].traffic.toLocaleString()+"")&&Mt(ye,we)},d(ze){ze&&oe(e)}}}function UC(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[BC,({props:s})=>({5:s}),({props:s})=>s?32:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&96&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function jC(r){let e,i;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ms(5,7),"line-color":Bp,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[UC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),a&64&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function VC(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function qC(r){let e,i,s,a;e=new to({props:{name:"level of service",$$slots:{default:[zC]},$$scope:{ctx:r}}});let f=r[2]&&r[1]&&R0(r);return{c(){ot(e.$$.fragment),i=je(),f&&f.c(),s=ai()},m(g,l){rt(e,g,l),ae(g,i,l),f&&f.m(g,l),ae(g,s,l),a=!0},p(g,[l]){const x={};l&65&&(x.$$scope={dirty:l,ctx:g}),e.$set(x),g[2]&&g[1]?f?(f.p(g,l),l&6&&_e(f,1)):(f=R0(g),f.c(),_e(f,1),f.m(s.parentNode,s)):f&&(Nn(),Ie(f,1,1,()=>{f=null}),zn())},i(g){a||(_e(e.$$.fragment,g),_e(f),a=!0)},o(g){Ie(e.$$.fragment,g),Ie(f),a=!1},d(g){g&&(oe(i),oe(s)),st(e,g),f&&f.d(g)}}}function GC(r,e,i){let s;Ot(r,sr,l=>i(2,s=l));let a=!1,f=!1;function g(){a=this.checked,i(0,a)}return r.$$.update=()=>{r.$$.dirty&1&&a&&i(1,f=!0)},[a,f,s,g]}class ZC extends fn{constructor(e){super(),hn(this,e,GC,qC,un,{})}}function D0(r){let e,i;return e=new em({props:{colorScale:r[3],limits:r[4]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function HC(r){let e,i,s,a,f,g,l,x,E=r[0]&&D0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Estimated traffic volume`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[0],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[5]),l=!0)},p(C,L){L&1&&(i.checked=C[0]),C[0]?E?(E.p(C,L),L&1&&_e(E,1)):(E=D0(C),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function N0(r){let e,i,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:KC,then:XC,catch:WC,value:6,blocks:[,,,]};return gs(i=r[2].renderLevelOfService(),a),{c(){e=ai(),a.block.c()},m(f,g){ae(f,e,g),a.block.m(f,a.anchor=g),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,g){r=f,a.ctx=r,g&4&&i!==(i=r[2].renderLevelOfService())&&gs(i,a)||kl(a,r,g)},i(f){s||(_e(a.block),s=!0)},o(f){for(let g=0;g<3;g+=1){const l=a.blocks[g];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function WC(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function XC(r){let e,i;return e=new rr({props:{data:r[6],generateId:!0,$$slots:{default:[JC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&4&&(f.data=s[6]),a&257&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function $C(r){let e,i=r[7].traffic.toLocaleString()+"",s;return{c(){e=ce("p"),s=Fe(i)},m(a,f){ae(a,e,f),Z(e,s)},p(a,f){f&128&&i!==(i=a[7].traffic.toLocaleString()+"")&&Mt(s,i)},d(a){a&&oe(e)}}}function YC(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[$C,({props:s})=>({7:s}),({props:s})=>s?128:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&384&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function JC(r){let e,i;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Gf(["get","traffic"],r[4],[1,2,3]),"line-color":Gf(["get","traffic"],r[4],r[3]),"line-opacity":.8},manageHoverState:!0,$$slots:{default:[YC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),a&256&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function KC(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function QC(r){let e,i,s,a;e=new to({props:{name:"traffic volume",$$slots:{default:[HC]},$$scope:{ctx:r}}});let f=r[2]&&r[1]&&N0(r);return{c(){ot(e.$$.fragment),i=je(),f&&f.c(),s=ai()},m(g,l){rt(e,g,l),ae(g,i,l),f&&f.m(g,l),ae(g,s,l),a=!0},p(g,[l]){const x={};l&257&&(x.$$scope={dirty:l,ctx:g}),e.$set(x),g[2]&&g[1]?f?(f.p(g,l),l&6&&_e(f,1)):(f=N0(g),f.c(),_e(f,1),f.m(s.parentNode,s)):f&&(Nn(),Ie(f,1,1,()=>{f=null}),zn())},i(g){a||(_e(e.$$.fragment,g),_e(f),a=!0)},o(g){Ie(e.$$.fragment,g),Ie(f),a=!1},d(g){g&&(oe(i),oe(s)),st(e,g),f&&f.d(g)}}}function eL(r,e,i){let s;Ot(r,sr,E=>i(2,s=E));let a=!1,f=!1,g=["#27918d","#ffaa33","#440154"],l=[0,2e3,4e3,1e4];function x(){a=this.checked,i(0,a)}return r.$$.update=()=>{r.$$.dirty&1&&a&&i(1,f=!0)},[a,f,s,g,l,x]}class tL extends fn{constructor(e){super(),hn(this,e,eL,QC,un,{})}}function z0(r){let e,i,s,a,f,g=r[3].toLocaleString()+"",l,x,E=r[0].features.length.toLocaleString()+"",C,L,N=r[2].toLocaleString()+"",B,U,te=r[4].toLocaleString()+"",ie,re,J=wr(r[2],r[4])+"",$,fe,ve,Pe,ue,xe,be,Te,we;return Pe=new em({props:{colorScale:r[6],limits:r[7]}}),{c(){e=ce("button"),e.textContent="Recalculate",i=je(),s=ce("p"),s.textContent="Only the top 20%ile most deprived zones are shown",a=je(),f=ce("p"),l=Fe(g),x=Fe(" / "),C=Fe(E),L=Fe(` zones
      reachable. That's `),B=Fe(N),U=Fe(" / "),ie=Fe(te),re=Fe(`
      (`),$=Fe(J),fe=Fe(") of the population."),ve=je(),ot(Pe.$$.fragment),ue=je(),xe=ce("p"),xe.textContent=`Darker colours are more deprived. Zones with a red outline are not
      reachable by the current network.`,He(e,"class","outline")},m(ye,ze){ae(ye,e,ze),ae(ye,i,ze),ae(ye,s,ze),ae(ye,a,ze),ae(ye,f,ze),Z(f,l),Z(f,x),Z(f,C),Z(f,L),Z(f,B),Z(f,U),Z(f,ie),Z(f,re),Z(f,$),Z(f,fe),ae(ye,ve,ze),rt(Pe,ye,ze),ae(ye,ue,ze),ae(ye,xe,ze),be=!0,Te||(we=Pt(e,"click",r[5]),Te=!0)},p(ye,ze){(!be||ze&8)&&g!==(g=ye[3].toLocaleString()+"")&&Mt(l,g),(!be||ze&1)&&E!==(E=ye[0].features.length.toLocaleString()+"")&&Mt(C,E),(!be||ze&4)&&N!==(N=ye[2].toLocaleString()+"")&&Mt(B,N),(!be||ze&16)&&te!==(te=ye[4].toLocaleString()+"")&&Mt(ie,te),(!be||ze&20)&&J!==(J=wr(ye[2],ye[4])+"")&&Mt($,J)},i(ye){be||(_e(Pe.$$.fragment,ye),be=!0)},o(ye){Ie(Pe.$$.fragment,ye),be=!1},d(ye){ye&&(oe(e),oe(i),oe(s),oe(a),oe(f),oe(ve),oe(ue),oe(xe)),st(Pe,ye),Te=!1,we()}}}function nL(r){let e,i,s,a,f,g,l,x,E=r[1]&&z0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    SIMD`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[1],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[8]),l=!0)},p(C,L){L&2&&(i.checked=C[1]),C[1]?E?(E.p(C,L),L&2&&_e(E,1)):(E=z0(C),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function iL(r){let e,i,s=r[10].id+"",a,f,g=r[10].reachable?"is":"is not",l,x,E=r[10].population.toLocaleString()+"",C,L,N=r[10].imd_rank+"",B,U,te=r[10].imd_percentile+"",ie,re;return{c(){e=ce("p"),i=Fe("Data zone "),a=Fe(s),f=je(),l=Fe(g),x=Fe(" reachable. It has "),C=Fe(E),L=Fe(`
        people, and a SIMD rank of `),B=Fe(N),U=Fe(", putting it in the "),ie=Fe(te),re=Fe(`
        percentile.`)},m(J,$){ae(J,e,$),Z(e,i),Z(e,a),Z(e,f),Z(e,l),Z(e,x),Z(e,C),Z(e,L),Z(e,B),Z(e,U),Z(e,ie),Z(e,re)},p(J,$){$&1024&&s!==(s=J[10].id+"")&&Mt(a,s),$&1024&&g!==(g=J[10].reachable?"is":"is not")&&Mt(l,g),$&1024&&E!==(E=J[10].population.toLocaleString()+"")&&Mt(C,E),$&1024&&N!==(N=J[10].imd_rank+"")&&Mt(B,N),$&1024&&te!==(te=J[10].imd_percentile+"")&&Mt(ie,te)},d(J){J&&oe(e)}}}function rL(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[iL,({props:s})=>({10:s}),({props:s})=>s?1024:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&3072&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function sL(r){let e,i,s,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","imd_percentile"],r[7],r[6]),"fill-opacity":Ms(.7,.9)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[rL]},$$scope:{ctx:r}}}),s=new mr({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:r[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,g){const l={};g&2&&(l.layout={visibility:f[1]?"visible":"none"}),g&2048&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g&2&&(x.layout={visibility:f[1]?"visible":"none"}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function oL(r){let e,i,s,a;return e=new to({props:{name:"simd",$$slots:{default:[nL]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[sL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,[g]){const l={};g&2079&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g&1&&(x.data=f[0]),g&2050&&(x.$$scope={dirty:g,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function aL(r,e,i){let s,a,f,g,l;Ot(r,Yf,B=>i(1,g=B)),Ot(r,sr,B=>i(9,l=B));let x={type:"FeatureCollection",features:[]};async function E(){if(l){let B=await l.getDataZones();B.features=B.features.filter(U=>U.properties.imd_percentile<=20),i(0,x=B)}}let C=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],L=[0,4,8,12,16,20];function N(){g=this.checked,Yf.set(g)}return r.$$.update=()=>{r.$$.dirty&3&&g&&x.features.length==0&&E(),r.$$.dirty&1&&i(4,s=ed(x.features.map(B=>B.properties.population))),r.$$.dirty&1&&i(3,a=x.features.filter(B=>B.properties.reachable).length),r.$$.dirty&1&&i(2,f=ed(x.features.filter(B=>B.properties.reachable).map(B=>B.properties.population)))},[x,g,f,a,s,E,C,L,N]}class lL extends fn{constructor(e){super(),hn(this,e,aL,oL,un,{})}}function O0(r){let e,i,s,a=r[3].toLocaleString()+"",f,g,l=r[0].features.length.toLocaleString()+"",x,E,C=r[2].toLocaleString()+"",L,N,B=r[4].toLocaleString()+"",U,te,ie=wr(r[2],r[4])+"",re,J,$,fe,ve,Pe,ue,xe,be;return fe=new em({props:{colorScale:r[6],limits:r[7]}}),{c(){e=ce("button"),e.textContent="Recalculate",i=je(),s=ce("p"),f=Fe(a),g=Fe(" / "),x=Fe(l),E=Fe(` zones
      reachable. That's `),L=Fe(C),N=Fe(" / "),U=Fe(B),te=Fe(`
      (`),re=Fe(ie),J=Fe(") of the population."),$=je(),ot(fe.$$.fragment),ve=je(),Pe=ce("p"),Pe.textContent=`Darker colours are denser. Zones with a red outline are not reachable by
      the current network. Only the top 3 densest quintiles are shown.`,He(e,"class","outline")},m(Te,we){ae(Te,e,we),ae(Te,i,we),ae(Te,s,we),Z(s,f),Z(s,g),Z(s,x),Z(s,E),Z(s,L),Z(s,N),Z(s,U),Z(s,te),Z(s,re),Z(s,J),ae(Te,$,we),rt(fe,Te,we),ae(Te,ve,we),ae(Te,Pe,we),ue=!0,xe||(be=Pt(e,"click",r[5]),xe=!0)},p(Te,we){(!ue||we&8)&&a!==(a=Te[3].toLocaleString()+"")&&Mt(f,a),(!ue||we&1)&&l!==(l=Te[0].features.length.toLocaleString()+"")&&Mt(x,l),(!ue||we&4)&&C!==(C=Te[2].toLocaleString()+"")&&Mt(L,C),(!ue||we&16)&&B!==(B=Te[4].toLocaleString()+"")&&Mt(U,B),(!ue||we&20)&&ie!==(ie=wr(Te[2],Te[4])+"")&&Mt(re,ie)},i(Te){ue||(_e(fe.$$.fragment,Te),ue=!0)},o(Te){Ie(fe.$$.fragment,Te),ue=!1},d(Te){Te&&(oe(e),oe(i),oe(s),oe($),oe(ve),oe(Pe)),st(fe,Te),xe=!1,be()}}}function uL(r){let e,i,s,a,f,g,l,x,E=r[1]&&O0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    Population`),a=je(),E&&E.c(),f=ai(),He(i,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,i),i.checked=r[1],Z(e,s),ae(C,a,L),E&&E.m(C,L),ae(C,f,L),g=!0,l||(x=Pt(i,"change",r[9]),l=!0)},p(C,L){L&2&&(i.checked=C[1]),C[1]?E?(E.p(C,L),L&2&&_e(E,1)):(E=O0(C),E.c(),_e(E,1),E.m(f.parentNode,f)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){g||(_e(E),g=!0)},o(C){Ie(E),g=!1},d(C){C&&(oe(e),oe(a),oe(f)),E&&E.d(C),l=!1,x()}}}function cL(r){let e,i,s=r[11].id+"",a,f,g=r[11].reachable?"is":"is not",l,x,E=r[11].population.toLocaleString()+"",C,L,N=Math.round(r[11].population/r[11].area_km2).toLocaleString()+"",B,U,te=r[11].density_quintile+"",ie,re;return{c(){e=ce("p"),i=Fe("Data zone "),a=Fe(s),f=je(),l=Fe(g),x=Fe(" reachable. It has "),C=Fe(E),L=Fe(`
        people, with a density of `),B=Fe(N),U=Fe(" people per square kilometer, putting it in quintile "),ie=Fe(te),re=Fe(`
        for this study area.`),Un(e,"max-width","30vw")},m(J,$){ae(J,e,$),Z(e,i),Z(e,a),Z(e,f),Z(e,l),Z(e,x),Z(e,C),Z(e,L),Z(e,B),Z(e,U),Z(e,ie),Z(e,re)},p(J,$){$&2048&&s!==(s=J[11].id+"")&&Mt(a,s),$&2048&&g!==(g=J[11].reachable?"is":"is not")&&Mt(l,g),$&2048&&E!==(E=J[11].population.toLocaleString()+"")&&Mt(C,E),$&2048&&N!==(N=Math.round(J[11].population/J[11].area_km2).toLocaleString()+"")&&Mt(B,N),$&2048&&te!==(te=J[11].density_quintile+"")&&Mt(ie,te)},d(J){J&&oe(e)}}}function hL(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[cL,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&6144&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function fL(r){let e,i,s,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","density_quintile"],r[7],r[6]),"fill-opacity":r[8]},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[hL]},$$scope:{ctx:r}}}),s=new mr({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:r[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,g){const l={};g&2&&(l.layout={visibility:f[1]?"visible":"none"}),g&4096&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g&2&&(x.layout={visibility:f[1]?"visible":"none"}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function dL(r){let e,i,s,a;return e=new to({props:{name:"population density",$$slots:{default:[uL]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[fL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,[g]){const l={};g&4127&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g&1&&(x.data=f[0]),g&4098&&(x.$$scope={dirty:g,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function pL(r,e,i){let s,a,f,g,l;Ot(r,Jf,U=>i(1,g=U)),Ot(r,sr,U=>i(10,l=U));let x={type:"FeatureCollection",features:[]};async function E(){l&&i(0,x=await l.getDataZones())}let C=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],L=[0,1,2,3,4,5],N=Ms(["case",["<",["get","density_quintile"],4],.5,0],.9);function B(){g=this.checked,Jf.set(g)}return r.$$.update=()=>{r.$$.dirty&3&&g&&x.features.length==0&&E(),r.$$.dirty&1&&i(4,s=ed(x.features.map(U=>U.properties.population))),r.$$.dirty&1&&i(3,a=x.features.filter(U=>U.properties.reachable).length),r.$$.dirty&1&&i(2,f=ed(x.features.filter(U=>U.properties.reachable).map(U=>U.properties.population)))},[x,g,f,a,s,E,C,L,N,B]}class mL extends fn{constructor(e){super(),hn(this,e,pL,dL,un,{})}}function F0(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re,J,$,fe=r[0].total_quintile_sums.length>0&&B0(r);return{c(){e=ce("div"),i=ce("button"),i.textContent="Recalculate",s=je(),a=ce("label"),f=ce("input"),g=Fe(`
        Only show routes covered by current edits`),l=je(),x=ce("label"),E=Fe(`Only show quintile:
        `),C=ce("select"),L=ce("option"),L.textContent="Show all",N=ce("option"),N.textContent="1",B=ce("option"),B.textContent="2",U=ce("option"),U.textContent="3",te=ce("option"),te.textContent="4",ie=ce("option"),ie.textContent="5",re=je(),fe&&fe.c(),He(i,"class","outline"),He(f,"type","checkbox"),L.__value="",zi(L,L.__value),N.__value="1",zi(N,N.__value),B.__value="2",zi(B,B.__value),U.__value="3",zi(U,U.__value),te.__value="4",zi(te,te.__value),ie.__value="5",zi(ie,ie.__value),r[3]===void 0&&Po(()=>r[7].call(C)),Un(e,"border","1px solid black"),Un(e,"padding","4px")},m(ve,Pe){ae(ve,e,Pe),Z(e,i),Z(e,s),Z(e,a),Z(a,f),f.checked=r[2],Z(a,g),Z(e,l),Z(e,x),Z(x,E),Z(x,C),Z(C,L),Z(C,N),Z(C,B),Z(C,U),Z(C,te),Z(C,ie),fs(C,r[3],!0),Z(e,re),fe&&fe.m(e,null),J||($=[Pt(i,"click",r[4]),Pt(f,"change",r[6]),Pt(C,"change",r[7])],J=!0)},p(ve,Pe){Pe&4&&(f.checked=ve[2]),Pe&8&&fs(C,ve[3]),ve[0].total_quintile_sums.length>0?fe?fe.p(ve,Pe):(fe=B0(ve),fe.c(),fe.m(e,null)):fe&&(fe.d(1),fe=null)},d(ve){ve&&oe(e),fe&&fe.d(),J=!1,$i($)}}}function B0(r){let e,i,s,a,f,g=wr(r[0].covered_quintile_sums[0],r[0].total_quintile_sums[0])+"",l,x,E,C,L=wr(r[0].covered_quintile_sums[1],r[0].total_quintile_sums[1])+"",N,B,U,te,ie=wr(r[0].covered_quintile_sums[2],r[0].total_quintile_sums[2])+"",re,J,$,fe,ve=wr(r[0].covered_quintile_sums[3],r[0].total_quintile_sums[3])+"",Pe,ue,xe,be,Te=wr(r[0].covered_quintile_sums[4],r[0].total_quintile_sums[4])+"",we;return{c(){e=ce("p"),e.textContent="Flow covered by current edits",i=je(),s=ce("ul"),a=ce("li"),f=Fe("Quintile 1: "),l=Fe(g),x=je(),E=ce("li"),C=Fe("Quintile 2: "),N=Fe(L),B=je(),U=ce("li"),te=Fe("Quintile 3: "),re=Fe(ie),J=je(),$=ce("li"),fe=Fe("Quintile 4: "),Pe=Fe(ve),ue=je(),xe=ce("li"),be=Fe("Quintile 5: "),we=Fe(Te)},m(ye,ze){ae(ye,e,ze),ae(ye,i,ze),ae(ye,s,ze),Z(s,a),Z(a,f),Z(a,l),Z(s,x),Z(s,E),Z(E,C),Z(E,N),Z(s,B),Z(s,U),Z(U,te),Z(U,re),Z(s,J),Z(s,$),Z($,fe),Z($,Pe),Z(s,ue),Z(s,xe),Z(xe,be),Z(xe,we)},p(ye,ze){ze&1&&g!==(g=wr(ye[0].covered_quintile_sums[0],ye[0].total_quintile_sums[0])+"")&&Mt(l,g),ze&1&&L!==(L=wr(ye[0].covered_quintile_sums[1],ye[0].total_quintile_sums[1])+"")&&Mt(N,L),ze&1&&ie!==(ie=wr(ye[0].covered_quintile_sums[2],ye[0].total_quintile_sums[2])+"")&&Mt(re,ie),ze&1&&ve!==(ve=wr(ye[0].covered_quintile_sums[3],ye[0].total_quintile_sums[3])+"")&&Mt(Pe,ve),ze&1&&Te!==(Te=wr(ye[0].covered_quintile_sums[4],ye[0].total_quintile_sums[4])+"")&&Mt(we,Te)},d(ye){ye&&(oe(e),oe(i),oe(s))}}}function gL(r){let e,i,s,a,f,g,l,x=r[1]&&F0(r);return{c(){e=ce("label"),i=ce("input"),s=Fe(`
    High NPT route coverage`),a=je(),x&&x.c(),f=ai(),He(i,"type","checkbox")},m(E,C){ae(E,e,C),Z(e,i),i.checked=r[1],Z(e,s),ae(E,a,C),x&&x.m(E,C),ae(E,f,C),g||(l=Pt(i,"change",r[5]),g=!0)},p(E,C){C&2&&(i.checked=E[1]),E[1]?x?x.p(E,C):(x=F0(E),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(E){E&&(oe(e),oe(a),oe(f)),x&&x.d(E),g=!1,l()}}}function _L(r){let e,i=r[9].flow.toLocaleString()+"",s,a,f=r[9].quintile+"",g,l,x=r[9].covered+"",E;return{c(){e=Fe("Flow "),s=Fe(i),a=Fe(" is in quintile "),g=Fe(f),l=Fe(`,
      covered `),E=Fe(x)},m(C,L){ae(C,e,L),ae(C,s,L),ae(C,a,L),ae(C,g,L),ae(C,l,L),ae(C,E,L)},p(C,L){L&512&&i!==(i=C[9].flow.toLocaleString()+"")&&Mt(s,i),L&512&&f!==(f=C[9].quintile+"")&&Mt(g,f),L&512&&x!==(x=C[9].covered+"")&&Mt(E,x)},d(C){C&&(oe(e),oe(s),oe(a),oe(g),oe(l),oe(E))}}}function yL(r){let e,i;return e=new js({props:{openOn:"hover",$$slots:{default:[_L,({props:s})=>({9:s}),({props:s})=>s?512:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1536&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function vL(r){let e,i;return e=new mr({props:{layout:{visibility:r[1]?"visible":"none"},filter:U0(r[2],r[3]),paint:{"line-width":td("flow"),"line-color":nm("flow")},$$slots:{default:[yL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&2&&(f.layout={visibility:s[1]?"visible":"none"}),a&12&&(f.filter=U0(s[2],s[3])),a&1024&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function bL(r){let e,i,s,a;return e=new to({props:{name:"high npt route coverage",$$slots:{default:[gL]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],$$slots:{default:[vL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,[g]){const l={};g&1039&&(l.$$scope={dirty:g,ctx:f}),e.$set(l);const x={};g&1&&(x.data=f[0]),g&1038&&(x.$$scope={dirty:g,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function U0(r,e){let i=["all"];return r&&i.push(["get","covered"]),e.length>0&&i.push(["==",["get","quintile"],parseInt(e)]),i}function xL(r,e,i){let s,a;Ot(r,Ku,N=>i(1,s=N)),Ot(r,sr,N=>i(8,a=N));let f=!1,g="",l={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function x(){a&&i(0,l=await a.renderPrecalculatedFlows())}function E(){s=this.checked,Ku.set(s)}function C(){f=this.checked,i(2,f)}function L(){g=_l(this),i(3,g)}return r.$$.update=()=>{r.$$.dirty&3&&s&&l.features.length==0&&x()},[l,s,f,g,x,E,C,L]}class wL extends fn{constructor(e){super(),hn(this,e,xL,bL,un,{})}}function kL(r){let e,i;return e=new Kp({props:{paint:{"circle-color":"purple","circle-radius":5},layout:{visibility:r[1]&&r[2].kind=="edit-route"?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&6&&(f.layout={visibility:s[1]&&s[2].kind=="edit-route"?"visible":"none"}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function IL(r){let e,i;return e=new rr({props:{data:r[0],$$slots:{default:[kL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,[a]){const f={};a&1&&(f.data=s[0]),a&38&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function SL(r,e,i){let s,a,f;Ot(r,Fp,x=>i(1,s=x)),Ot(r,sr,x=>i(3,a=x)),Ot(r,Ni,x=>i(2,f=x));let g={type:"FeatureCollection",features:[]};async function l(){a&&i(0,g=await a.getMajorJunctions())}return r.$$.update=()=>{r.$$.dirty&3&&s&&g.features.length==0&&l()},[g,s,f]}class EL extends fn{constructor(e){super(),hn(this,e,SL,IL,un,{})}}function TL(r){let e,i,s,a,f,g,l,x,E,C,L,N,B,U,te,ie,re,J,$,fe,ve,Pe,ue,xe,be,Te,we,ye;return e=new OT({}),s=new GT({}),f=new wL({}),l=new tC({}),E=new hC({}),L=new yC({}),B=new SC({}),te=new MC({}),re=new ZC({}),$=new tL({}),ve=new NC({}),ue=new lL({}),be=new mL({}),we=new EL({}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment),a=je(),ot(f.$$.fragment),g=je(),ot(l.$$.fragment),x=je(),ot(E.$$.fragment),C=je(),ot(L.$$.fragment),N=je(),ot(B.$$.fragment),U=je(),ot(te.$$.fragment),ie=je(),ot(re.$$.fragment),J=je(),ot($.$$.fragment),fe=je(),ot(ve.$$.fragment),Pe=je(),ot(ue.$$.fragment),xe=je(),ot(be.$$.fragment),Te=je(),ot(we.$$.fragment)},m(ze,Be){rt(e,ze,Be),ae(ze,i,Be),rt(s,ze,Be),ae(ze,a,Be),rt(f,ze,Be),ae(ze,g,Be),rt(l,ze,Be),ae(ze,x,Be),rt(E,ze,Be),ae(ze,C,Be),rt(L,ze,Be),ae(ze,N,Be),rt(B,ze,Be),ae(ze,U,Be),rt(te,ze,Be),ae(ze,ie,Be),rt(re,ze,Be),ae(ze,J,Be),rt($,ze,Be),ae(ze,fe,Be),rt(ve,ze,Be),ae(ze,Pe,Be),rt(ue,ze,Be),ae(ze,xe,Be),rt(be,ze,Be),ae(ze,Te,Be),rt(we,ze,Be),ye=!0},p:nt,i(ze){ye||(_e(e.$$.fragment,ze),_e(s.$$.fragment,ze),_e(f.$$.fragment,ze),_e(l.$$.fragment,ze),_e(E.$$.fragment,ze),_e(L.$$.fragment,ze),_e(B.$$.fragment,ze),_e(te.$$.fragment,ze),_e(re.$$.fragment,ze),_e($.$$.fragment,ze),_e(ve.$$.fragment,ze),_e(ue.$$.fragment,ze),_e(be.$$.fragment,ze),_e(we.$$.fragment,ze),ye=!0)},o(ze){Ie(e.$$.fragment,ze),Ie(s.$$.fragment,ze),Ie(f.$$.fragment,ze),Ie(l.$$.fragment,ze),Ie(E.$$.fragment,ze),Ie(L.$$.fragment,ze),Ie(B.$$.fragment,ze),Ie(te.$$.fragment,ze),Ie(re.$$.fragment,ze),Ie($.$$.fragment,ze),Ie(ve.$$.fragment,ze),Ie(ue.$$.fragment,ze),Ie(be.$$.fragment,ze),Ie(we.$$.fragment,ze),ye=!1},d(ze){ze&&(oe(i),oe(a),oe(g),oe(x),oe(C),oe(N),oe(U),oe(ie),oe(J),oe(fe),oe(Pe),oe(xe),oe(Te)),st(e,ze),st(s,ze),st(f,ze),st(l,ze),st(E,ze),st(L,ze),st(B,ze),st(te,ze),st(re,ze),st($,ze),st(ve,ze),st(ue,ze),st(be,ze),st(we,ze)}}}class CL extends fn{constructor(e){super(),hn(this,e,null,TL,un,{})}}function LL(r){let e,i,s;return i=new IT({}),{c(){e=ce("div"),ot(i.$$.fragment),He(e,"slot","top")},m(a,f){ae(a,e,f),rt(i,e,null),s=!0},p:nt,i(a){s||(_e(i.$$.fragment,a),s=!0)},o(a){Ie(i.$$.fragment,a),s=!1},d(a){a&&oe(e),st(i)}}}function ML(r){let e,i;return{c(){e=ce("div"),i=ce("div"),He(e,"slot","left")},m(s,a){ae(s,e,a),Z(e,i),r[14](i)},p:nt,d(s){s&&oe(e),r[14](null)}}}function AL(r){let e,i;return e=new U2({props:{map:r[0],apiKey:Zv}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&1&&(f.map=s[0]),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function j0(r){let e,i,s,a,f,g,l,x,E={ctx:r,current:null,token:null,hasCatch:!1,pending:NL,then:RL,catch:PL,value:21,blocks:[,,,]};gs(e=r[5].getInvertedBoundary(),E),s=new CL({});const C=[jL,UL,BL,FL,OL,zL],L=[];function N(B,U){return B[6].kind=="main"?0:B[6].kind=="edit-route"&&B[0]?1:B[6].kind=="evaluate-route"?2:B[6].kind=="evaluate-od"?3:B[6].kind=="debug-network"?4:B[6].kind=="debug-mesh-density"?5:-1}return~(f=N(r))&&(g=L[f]=C[f](r)),{c(){E.block.c(),i=je(),ot(s.$$.fragment),a=je(),g&&g.c(),l=ai()},m(B,U){E.block.m(B,E.anchor=U),E.mount=()=>i.parentNode,E.anchor=i,ae(B,i,U),rt(s,B,U),ae(B,a,U),~f&&L[f].m(B,U),ae(B,l,U),x=!0},p(B,U){r=B,E.ctx=r,U&32&&e!==(e=r[5].getInvertedBoundary())&&gs(e,E)||kl(E,r,U);let te=f;f=N(r),f===te?~f&&L[f].p(r,U):(g&&(Nn(),Ie(L[te],1,1,()=>{L[te]=null}),zn()),~f?(g=L[f],g?g.p(r,U):(g=L[f]=C[f](r),g.c()),_e(g,1),g.m(l.parentNode,l)):g=null)},i(B){x||(_e(E.block),_e(s.$$.fragment,B),_e(g),x=!0)},o(B){for(let U=0;U<3;U+=1){const te=E.blocks[U];Ie(te)}Ie(s.$$.fragment,B),Ie(g),x=!1},d(B){B&&(oe(i),oe(a),oe(l)),E.block.d(B),E.token=null,E=null,st(s,B),~f&&L[f].d(B)}}}function PL(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function RL(r){let e,i;return e=new rr({props:{data:r[21],$$slots:{default:[DL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&32&&(f.data=s[21]),a&4194304&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function DL(r){let e,i;return e=new mc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function NL(r){return{c:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function zL(r){let e,i;return e=new RS({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function OL(r){let e,i;return e=new IS({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function FL(r){let e,i;return e=new gT({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function BL(r){let e,i;return e=new lT({props:{browse:r[6].browse}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&64&&(f.browse=s[6].browse),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function UL(r){let e,i;return e=new HE({props:{id:r[6].id,map:r[0]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p(s,a){const f={};a&64&&(f.id=s[6].id),a&1&&(f.map=s[0]),e.$set(f)},i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function jL(r){let e,i;return e=new rE({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),i=!0},p:nt,i(s){i||(_e(e.$$.fragment,s),i=!0)},o(s){Ie(e.$$.fragment,s),i=!1},d(s){st(e,s)}}}function VL(r){let e,i,s,a,f,g,l,x=AL(r);i=new lE({});let E=r[5]&&j0(r);return{c(){x&&x.c(),e=je(),ot(i.$$.fragment),s=je(),a=ce("div"),f=je(),E&&E.c(),g=ai()},m(C,L){x&&x.m(C,L),ae(C,e,L),rt(i,C,L),ae(C,s,L),ae(C,a,L),r[11](a),ae(C,f,L),E&&E.m(C,L),ae(C,g,L),l=!0},p(C,L){x.p(C,L),C[5]?E?(E.p(C,L),L&32&&_e(E,1)):(E=j0(C),E.c(),_e(E,1),E.m(g.parentNode,g)):E&&(Nn(),Ie(E,1,1,()=>{E=null}),zn())},i(C){l||(_e(x),_e(i.$$.fragment,C),_e(E),l=!0)},o(C){Ie(x),Ie(i.$$.fragment,C),Ie(E),l=!1},d(C){C&&(oe(e),oe(s),oe(a),oe(f),oe(g)),x&&x.d(C),st(i,C),r[11](null),E&&E.d(C)}}}function qL(r){let e,i,s,a;function f(l){r[12](l)}let g={style:`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${Zv}`,standardControls:!0,$$slots:{default:[VL]},$$scope:{ctx:r}};return r[0]!==void 0&&(g.map=r[0]),i=new II({props:g}),Jn.push(()=>Ir(i,"map",f)),i.$on("error",r[13]),{c(){e=ce("div"),ot(i.$$.fragment),He(e,"slot","main"),Un(e,"position","relative"),Un(e,"width","100%"),Un(e,"height","100%")},m(l,x){ae(l,e,x),rt(i,e,null),a=!0},p(l,x){const E={};x&4194405&&(E.$$scope={dirty:x,ctx:l}),!s&&x&1&&(s=!0,E.map=l[0],kr(()=>s=!1)),i.$set(E)},i(l){a||(_e(i.$$.fragment,l),a=!0)},o(l){Ie(i.$$.fragment,l),a=!1},d(l){l&&oe(e),st(i)}}}function GL(r){let e,i;return{c(){e=ce("div"),i=ce("div"),He(e,"slot","right")},m(s,a){ae(s,e,a),Z(e,i),r[10](i)},p:nt,d(s){s&&oe(e),r[10](null)}}}function ZL(r){let e,i,s,a;return e=new ZI({props:{loading:r[4]}}),s=new OI({props:{$$slots:{right:[GL],main:[qL],left:[ML],top:[LL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),i=je(),ot(s.$$.fragment)},m(f,g){rt(e,f,g),ae(f,i,g),rt(s,f,g),a=!0},p(f,[g]){const l={};g&16&&(l.loading=f[4]),e.$set(l);const x={};g&4194415&&(x.$$scope={dirty:g,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(i),st(e,f),st(s,f)}}}function Ef(r,e,i){return e+r*(i-e)}function HL(r,e,i){let s,a,f,g,l,x,E,C,L,N;Ot(r,Rp,xe=>i(7,s=xe)),Ot(r,Dp,xe=>i(8,a=xe)),Ot(r,Pp,xe=>i(9,f=xe)),Ot(r,sr,xe=>i(5,g=xe)),Ot(r,Qf,xe=>i(15,l=xe)),Ot(r,Sh,xe=>i(16,x=xe)),Ot(r,Ju,xe=>i(17,E=xe)),Ot(r,Hf,xe=>i(18,C=xe)),Ot(r,zp,xe=>i(19,L=xe)),Ot(r,Ni,xe=>i(6,N=xe));let B="",U;cc(async()=>{await $v();let xe=new URLSearchParams(window.location.search);Dn(Hf,C=xe.get("boundary")||"LAD_City of Edinburgh",C),i(4,B=`Loading ${C}`);let be=new fS,Te=await fetch(`areas/${C}.bin`);Te.ok?(console.log("Using locally hosted files"),Dn(zp,L=!1,L)):(console.log("Using remote hosted files"),Te=await fetch(sd(`areas/${C}.bin`)));let we=await Te.arrayBuffer();try{await be.loadFile(new Uint8Array(we))}catch(Be){window.alert(`Couldn't load: ${Be}`)}let ye=window.localStorage.getItem(`tmp-npt-editor/${C}`);if(ye)try{await be.loadSavefile(ye)}catch(Be){window.alert(`Couldn't restore saved state: ${Be}`)}i(4,B="");let ze=await be.getBounds();Dn(Ju,E={lng:Ef(.4,ze[0],ze[2]),lat:Ef(.4,ze[1],ze[3])},E),Dn(Sh,x={lng:Ef(.6,ze[0],ze[2]),lat:Ef(.6,ze[1],ze[3])},x),Dn(Qf,l=new kE(U,be.toRouteSnapper(),Yn(Af()),Yn(!0),Yn(0)),l),sr.set(be),await te()});async function te(){U&&g&&U.fitBounds(await g.getBounds(),{animate:!1})}let ie,re,J;function $(xe){Jn[xe?"unshift":"push"](()=>{J=xe,i(3,J),i(7,s)})}function fe(xe){Jn[xe?"unshift":"push"](()=>{re=xe,i(2,re),i(8,a)})}function ve(xe){U=xe,i(0,U)}const Pe=xe=>{console.log(xe.detail.error)};function ue(xe){Jn[xe?"unshift":"push"](()=>{ie=xe,i(1,ie),i(9,f)})}return r.$$.update=()=>{r.$$.dirty&1&&U&&dS.set(U),r.$$.dirty&514&&ie&&f&&(i(1,ie.innerHTML="",ie),ie.appendChild(f)),r.$$.dirty&260&&re&&a&&(i(2,re.innerHTML="",re),re.appendChild(a)),r.$$.dirty&136&&J&&s&&(i(3,J.innerHTML="",J),J.appendChild(s))},[U,ie,re,J,B,g,N,s,a,f,$,fe,ve,Pe,ue]}class WL extends fn{constructor(e){super(),hn(this,e,HL,ZL,un,{})}}new WL({target:document.getElementById("app")});
