var Dv=Object.defineProperty;var Rv=(r,e,t)=>e in r?Dv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var zu=(r,e,t)=>(Rv(r,typeof e!="symbol"?e+"":e,t),t);function Fv(r,e){for(var t=0;t<e.length;t++){const o=e[t];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in r)){const u=Object.getOwnPropertyDescriptor(o,l);u&&Object.defineProperty(r,l,u.get?u:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function We(){}function Di(r,e){for(const t in e)r[t]=e[t];return r}function Bv(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function U0(r){return r()}function U_(){return Object.create(null)}function cn(r){r.forEach(U0)}function tl(r){return typeof r=="function"}function Vt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let fd;function zr(r,e){return r===e?!0:(fd||(fd=document.createElement("a")),fd.href=e,r===fd.href)}function Ov(r){return Object.keys(r).length===0}function $0(r,...e){if(r==null){for(const o of e)o(void 0);return We}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Yu(r){let e;return $0(r,t=>e=t)(),e}function yt(r,e,t){r.$$.on_destroy.push($0(e,t))}function bn(r,e,t,o){if(r){const l=V0(r,e,t,o);return r[0](l)}}function V0(r,e,t,o){return r[1]&&o?Di(t.ctx.slice(),r[1](o(e))):t.ctx}function vn(r,e,t,o){if(r[2]&&o){const l=r[2](o(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function wn(r,e,t,o,l,u){if(l){const d=V0(e,t,o,u);r.p(d,l)}}function xn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let o=0;o<t;o++)e[o]=-1;return e}return-1}function Nv(r){const e={};for(const t in r)e[t]=!0;return e}function Cd(r){return r??""}function si(r,e,t){return r.set(t),e}function mp(r){return r&&tl(r.destroy)?r.destroy:We}const q0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function B(r,e){r.appendChild(e)}function te(r,e,t){r.insertBefore(e,t||null)}function ee(r){r.parentNode&&r.parentNode.removeChild(r)}function $n(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function ie(r){return document.createElement(r)}function ks(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function we(r){return document.createTextNode(r)}function Se(){return we(" ")}function tn(){return we("")}function wt(r,e,t,o){return r.addEventListener(e,t,o),()=>r.removeEventListener(e,t,o)}function lh(r){return function(e){return e.preventDefault(),r.call(this,e)}}function op(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function Fe(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function $_(r){let e;return{p(...t){e=t,e.forEach(o=>r.push(o))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function jv(r){return Array.from(r.childNodes)}function dt(r,e){e=""+e,r.data!==e&&(r.data=e)}function Gi(r,e){r.value=e??""}function ui(r,e,t,o){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,o?"important":"")}function hr(r,e,t){for(let o=0;o<r.options.length;o+=1){const l=r.options[o];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function ws(r){const e=r.querySelector(":checked");return e&&e.__value}function dr(r,e,t){r.classList.toggle(e,!!t)}function Uv(r,e,{bubbles:t=!1,cancelable:o=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:o})}let Qu;function xs(r){Qu=r}function gc(){if(!Qu)throw new Error("Function called outside component initialization");return Qu}function yc(r){gc().$$.on_mount.push(r)}function Po(r){gc().$$.on_destroy.push(r)}function bc(){const r=gc();return(e,t,{cancelable:o=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=Uv(e,t,{cancelable:o});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function Z0(r,e){return gc().$$.context.set(r,e),e}function G0(r){return gc().$$.context.get(r)}function On(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(o=>o.call(this,e))}const oc=[],oi=[];let uc=[];const _p=[],W0=Promise.resolve();let gp=!1;function H0(){gp||(gp=!0,W0.then(jp))}function $v(){return H0(),W0}function Mo(r){uc.push(r)}function $i(r){_p.push(r)}const sp=new Set;let Ql=0;function jp(){if(Ql!==0)return;const r=Qu;do{try{for(;Ql<oc.length;){const e=oc[Ql];Ql++,xs(e),Vv(e.$$)}}catch(e){throw oc.length=0,Ql=0,e}for(xs(null),oc.length=0,Ql=0;oi.length;)oi.pop()();for(let e=0;e<uc.length;e+=1){const t=uc[e];sp.has(t)||(sp.add(t),t())}uc.length=0}while(oc.length);for(;_p.length;)_p.pop()();gp=!1,sp.clear(),xs(r)}function Vv(r){if(r.fragment!==null){r.update(),cn(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Mo)}}function qv(r){const e=[],t=[];uc.forEach(o=>r.indexOf(o)===-1?e.push(o):t.push(o)),t.forEach(o=>o()),uc=e}const vd=new Set;let Ya;function Li(){Ya={r:0,c:[],p:Ya}}function Mi(){Ya.r||cn(Ya.c),Ya=Ya.p}function se(r,e){r&&r.i&&(vd.delete(r),r.i(e))}function de(r,e,t,o){if(r&&r.o){if(vd.has(r))return;vd.add(r),Ya.c.push(()=>{vd.delete(r),o&&(t&&r.d(1),o())}),r.o(e)}else o&&o()}function Dr(r,e){const t=e.token={};function o(l,u,d,a){if(e.token!==t)return;e.resolved=a;let g=e.ctx;d!==void 0&&(g=g.slice(),g[d]=a);const v=l&&(e.current=l)(g);let k=!1;e.block&&(e.blocks?e.blocks.forEach((S,E)=>{E!==u&&S&&(Li(),de(S,1,1,()=>{e.blocks[E]===S&&(e.blocks[E]=null)}),Mi())}):e.block.d(1),v.c(),se(v,1),v.m(e.mount(),e.anchor),k=!0),e.block=v,e.blocks&&(e.blocks[u]=v),k&&jp()}if(Bv(r)){const l=gc();if(r.then(u=>{xs(l),o(e.then,1,e.value,u),xs(null)},u=>{if(xs(l),o(e.catch,2,e.error,u),xs(null),!e.hasCatch)throw u}),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,r),!0;e.resolved=r}}function ba(r,e,t){const o=e.slice(),{resolved:l}=r;r.current===r.then&&(o[r.value]=l),r.current===r.catch&&(o[r.error]=l),r.block.p(o,t)}function yi(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Zv(r,e){de(r,1,1,()=>{e.delete(r.key)})}function Gv(r,e,t,o,l,u,d,a,g,v,k,S){let E=r.length,P=u.length,z=E;const V={};for(;z--;)V[r[z].key]=z;const $=[],H=new Map,G=new Map,X=[];for(z=P;z--;){const Y=S(l,u,z),K=t(Y);let ue=d.get(K);ue?o&&X.push(()=>ue.p(Y,e)):(ue=v(K,Y),ue.c()),H.set(K,$[z]=ue),K in V&&G.set(K,Math.abs(z-V[K]))}const le=new Set,xe=new Set;function Ie(Y){se(Y,1),Y.m(a,k),d.set(Y.key,Y),k=Y.first,P--}for(;E&&P;){const Y=$[P-1],K=r[E-1],ue=Y.key,fe=K.key;Y===K?(k=Y.first,E--,P--):H.has(fe)?!d.has(ue)||le.has(ue)?Ie(Y):xe.has(fe)?E--:G.get(ue)>G.get(fe)?(xe.add(ue),Ie(Y)):(le.add(fe),E--):(g(K,d),E--)}for(;E--;){const Y=r[E];H.has(Y.key)||g(Y,d)}for(;P;)Ie($[P-1]);return cn(X),$}function pn(r,e){const t={},o={},l={$$scope:1};let u=r.length;for(;u--;){const d=r[u],a=e[u];if(a){for(const g in d)g in a||(o[g]=1);for(const g in a)l[g]||(t[g]=a[g],l[g]=1);r[u]=a}else for(const g in d)l[g]=1}for(const d in o)d in t||(t[d]=void 0);return t}function Wv(r){return typeof r=="object"&&r!==null?r:{}}function Vi(r,e,t){const o=r.$$.props[e];o!==void 0&&(r.$$.bound[o]=t,t(r.$$.ctx[o]))}function Ue(r){r&&r.c()}function Ne(r,e,t){const{fragment:o,after_update:l}=r.$$;o&&o.m(e,t),Mo(()=>{const u=r.$$.on_mount.map(U0).filter(tl);r.$$.on_destroy?r.$$.on_destroy.push(...u):cn(u),r.$$.on_mount=[]}),l.forEach(Mo)}function je(r,e){const t=r.$$;t.fragment!==null&&(qv(t.after_update),cn(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Hv(r,e){r.$$.dirty[0]===-1&&(oc.push(r),H0(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Gt(r,e,t,o,l,u,d=null,a=[-1]){const g=Qu;xs(r);const v=r.$$={fragment:null,ctx:[],props:u,update:We,not_equal:l,bound:U_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:U_(),dirty:a,skip_bound:!1,root:e.target||g.$$.root};d&&d(v.root);let k=!1;if(v.ctx=t?t(r,e.props||{},(S,E,...P)=>{const z=P.length?P[0]:E;return v.ctx&&l(v.ctx[S],v.ctx[S]=z)&&(!v.skip_bound&&v.bound[S]&&v.bound[S](z),k&&Hv(r,S)),E}):[],v.update(),k=!0,cn(v.before_update),v.fragment=o?o(v.ctx):!1,e.target){if(e.hydrate){const S=jv(e.target);v.fragment&&v.fragment.l(S),S.forEach(ee)}else v.fragment&&v.fragment.c();e.intro&&se(r.$$.fragment),Ne(r,e.target,e.anchor),jp()}xs(g)}class Wt{constructor(){zu(this,"$$");zu(this,"$$set")}$destroy(){je(this,1),this.$destroy=We}$on(e,t){if(!tl(t))return We;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(t),()=>{const l=o.indexOf(t);l!==-1&&o.splice(l,1)}}$set(e){this.$$set&&!Ov(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Xv="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Xv);var Kv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jv(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var X0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(r,e){(function(t,o){r.exports=o()})(Kv,function(){var t={},o={};function l(d,a,g){if(o[d]=g,d==="index"){var v="var sharedModule = {}; ("+o.shared+")(sharedModule); ("+o.worker+")(sharedModule);",k={};return o.shared(k),o.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function a(s,n,c,f){return new(c||(c=Promise))(function(_,w){function x(A){try{C(f.next(A))}catch(D){w(D)}}function T(A){try{C(f.throw(A))}catch(D){w(D)}}function C(A){var D;A.done?_(A.value):(D=A.value,D instanceof c?D:new c(function(F){F(D)})).then(x,T)}C((f=f.apply(s,n||[])).next())})}function g(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var v=k;function k(s,n){this.x=s,this.y=n}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,n){return this.clone()._rotateAround(s,n)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var n=s.x-this.x,c=s.y-this.y;return n*n+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,n){return Math.atan2(this.x*n-this.y*s,this.x*s+this.y*n)},_matMult:function(s){var n=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=n,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var n=Math.cos(s),c=Math.sin(s),f=c*this.x+n*this.y;return this.x=n*this.x-c*this.y,this.y=f,this},_rotateAround:function(s,n){var c=Math.cos(s),f=Math.sin(s),_=n.y+f*(this.x-n.x)+c*(this.y-n.y);return this.x=n.x+c*(this.x-n.x)-f*(this.y-n.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var S=g(v),E=P;function P(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}P.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var _=this.sampleCurveX(c)-s;if(Math.abs(_)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=_/w}var x=0,T=1;for(c=s,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-s)<n));f++)s>_?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var z=g(E);let V,$;function H(){return V==null&&(V=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),V}function G(){if($==null&&($=!1,H())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let f=0;f<5*5;f++){const _=4*f;n.fillStyle=`rgb(${_},${_+1},${_+2})`,n.fillRect(f%5,Math.floor(f/5),1,1)}const c=n.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){$=!0;break}}}return $||!1}function X(s,n,c,f){const _=new z(s,n,c,f);return w=>_.solve(w)}const le=X(.25,.1,.25,1);function xe(s,n,c){return Math.min(c,Math.max(n,s))}function Ie(s,n,c){const f=c-n,_=((s-n)%f+f)%f+n;return _===n?c:_}function Y(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}let K=1;function ue(s,n,c){const f={};for(const _ in s)f[_]=n.call(this,s[_],_,s);return f}function fe(s,n,c){const f={};for(const _ in s)n.call(this,s[_],_,s)&&(f[_]=s[_]);return f}function ce(s){return Array.isArray(s)?s.map(ce):typeof s=="object"&&s?ue(s,ce):s}const ae={};function Ge(s){ae[s]||(typeof console<"u"&&console.warn(s),ae[s]=!0)}function Le(s,n,c){return(c.y-s.y)*(n.x-s.x)>(n.y-s.y)*(c.x-s.x)}function Pe(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let rt=null;function it(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ft(s,n,c,f,_){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const T=x.startsWith("BGR"),C=new Uint8ClampedArray(f*_*4);if(yield w.copyTo(C,function(A,D,F,U,W){const Q=4*Math.max(-D,0),re=(Math.max(0,F)-F)*U*4+Q,_e=4*U,be=Math.max(0,D),Ze=Math.max(0,F);return{rect:{x:be,y:Ze,width:Math.min(A.width,D+U)-be,height:Math.min(A.height,F+W)-Ze},layout:[{offset:re,stride:_e}]}}(s,n,c,f,_)),T)for(let A=0;A<C.length;A+=4){const D=C[A];C[A]=C[A+2],C[A+2]=D}return C}finally{w.close()}})}let jt,ut;const et="AbortError";function at(){return new Error(et)}const Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Dt(s){return Bt.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const Ht="global-dispatcher";class li extends Error{constructor(n,c,f,_){super(`AJAXError: ${c} (${n}): ${f}`),this.status=n,this.statusText=c,this.url=f,this.body=_}}const ai=()=>Pe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ki=function(s,n){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=Dt(s.url);if(f)return f(s,n);if(Pe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:Ht},n)}if(!(/^file:/.test(c=s.url)||/^file:/.test(ai())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,_){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:ai(),signal:_.signal});f.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const A=yield x.blob();throw new li(x.status,x.statusText,f.url,A)}let T;T=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const C=yield T;if(_.signal.aborted)throw at();return{data:C,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,n);if(Pe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:Ht},n)}var c;return function(f,_){return new Promise((w,x)=>{var T;const C=new XMLHttpRequest;C.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(C.responseType="arraybuffer");for(const A in f.headers)C.setRequestHeader(A,f.headers[A]);f.type==="json"&&(C.responseType="text",!((T=f.headers)===null||T===void 0)&&T.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=f.credentials==="include",C.onerror=()=>{x(new Error(C.statusText))},C.onload=()=>{if(!_.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let A=C.response;if(f.type==="json")try{A=JSON.parse(C.response)}catch(D){return void x(D)}w({data:A,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const A=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});x(new li(C.status,C.statusText,f.url,A))}},_.signal.addEventListener("abort",()=>{C.abort(),x(at())}),C.send(f.body)})}(s,n)};function Fi(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const n=new URL(s),c=window.location;return n.protocol===c.protocol&&n.host===c.host}function bi(s,n,c){c[s]&&c[s].indexOf(n)!==-1||(c[s]=c[s]||[],c[s].push(n))}function di(s,n,c){if(c&&c[s]){const f=c[s].indexOf(n);f!==-1&&c[s].splice(f,1)}}class lt{constructor(n,c={}){Y(this,c),this.type=n}}class qe extends lt{constructor(n,c={}){super("error",Y({error:n},c))}}class st{on(n,c){return this._listeners=this._listeners||{},bi(n,c,this._listeners),this}off(n,c){return di(n,c,this._listeners),di(n,c,this._oneTimeListeners),this}once(n,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},bi(n,c,this._oneTimeListeners),this):new Promise(f=>this.once(n,f))}fire(n,c){typeof n=="string"&&(n=new lt(n,c||{}));const f=n.type;if(this.listens(f)){n.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of _)T.call(this,n);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of w)di(f,T,this._oneTimeListeners),T.call(this,n);const x=this._eventedParent;x&&(Y(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(n))}else n instanceof qe&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,c){return this._eventedParent=n,this._eventedParentData=c,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const pt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function gt(s,n){const c={};for(const f in s)f!=="ref"&&(c[f]=s[f]);return pt.forEach(f=>{f in n&&(c[f]=n[f])}),c}function Ce(s,n){if(Array.isArray(s)){if(!Array.isArray(n)||s.length!==n.length)return!1;for(let c=0;c<s.length;c++)if(!Ce(s[c],n[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&n!==null){if(typeof n!="object"||Object.keys(s).length!==Object.keys(n).length)return!1;for(const c in s)if(!Ce(s[c],n[c]))return!1;return!0}return s===n}function nt(s,n){s.push(n)}function Xt(s,n,c){nt(c,{command:"addSource",args:[s,n[s]]})}function vi(s,n,c){nt(n,{command:"removeSource",args:[s]}),c[s]=!0}function ji(s,n,c,f){vi(s,c,f),Xt(s,n,c)}function Ci(s,n,c){let f;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!Ce(s[c][f],n[c][f]))return!1;for(f in n[c])if(Object.prototype.hasOwnProperty.call(n[c],f)&&f!=="data"&&!Ce(s[c][f],n[c][f]))return!1;return!0}function _i(s,n,c,f,_,w){s=s||{},n=n||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(Ce(s[x],n[x])||c.push({command:w,args:[f,x,n[x],_]}));for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(Ce(s[x],n[x])||c.push({command:w,args:[f,x,n[x],_]}))}function Bi(s){return s.id}function br(s,n){return s[n.id]=n,s}class ct{constructor(n,c,f,_){this.message=(n?`${n}: `:"")+f,_&&(this.identifier=_),c!=null&&c.__line__&&(this.line=c.__line__)}}function tr(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}class _n extends Error{constructor(n,c){super(c),this.message=c,this.key=n}}class qn{constructor(n,c=[]){this.parent=n,this.bindings={};for(const[f,_]of c)this.bindings[f]=_}concat(n){return new qn(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Wr={kind:"null"},bt={kind:"number"},ci={kind:"string"},Jt={kind:"boolean"},In={kind:"color"},Nn={kind:"object"},ei={kind:"value"},vr={kind:"collator"},Fr={kind:"formatted"},Hr={kind:"padding"},wr={kind:"resolvedImage"},ye={kind:"variableAnchorOffsetCollection"};function Z(s,n){return{kind:"array",itemType:s,N:n}}function q(s){if(s.kind==="array"){const n=q(s.itemType);return typeof s.N=="number"?`array<${n}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${n}>`}return s.kind}const ne=[Wr,bt,ci,Jt,In,Fr,Nn,Z(ei),Hr,wr,ye];function pe(s,n){if(n.kind==="error")return null;if(s.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!pe(s.itemType,n.itemType))&&(typeof s.N!="number"||s.N===n.N))return null}else{if(s.kind===n.kind)return null;if(s.kind==="value"){for(const c of ne)if(!pe(c,n))return null}}return`Expected ${q(s)} but found ${q(n)} instead.`}function Me(s,n){return n.some(c=>c.kind===s.kind)}function ze(s,n){return n.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function Ve(s,n){return s.kind==="array"&&n.kind==="array"?s.itemType.kind===n.itemType.kind&&typeof s.N=="number":s.kind===n.kind}const j=.96422,Re=.82521,Ke=4/29,$e=6/29,Xe=3*$e*$e,mt=$e*$e*$e,Et=Math.PI/180,pi=180/Math.PI;function Qt(s){return(s%=360)<0&&(s+=360),s}function hi([s,n,c,f]){let _,w;const x=Dn((.2225045*(s=wi(s))+.7168786*(n=wi(n))+.0606169*(c=wi(c)))/1);s===n&&n===c?_=w=x:(_=Dn((.4360747*s+.3850649*n+.1430804*c)/j),w=Dn((.0139322*s+.0971045*n+.7141733*c)/Re));const T=116*x-16;return[T<0?0:T,500*(_-x),200*(x-w),f]}function wi(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Dn(s){return s>mt?Math.pow(s,1/3):s/Xe+Ke}function gn([s,n,c,f]){let _=(s+16)/116,w=isNaN(n)?_:_+n/500,x=isNaN(c)?_:_-c/200;return _=1*qi(_),w=j*qi(w),x=Re*qi(x),[mi(3.1338561*w-1.6168667*_-.4906146*x),mi(-.9787684*w+1.9161415*_+.033454*x),mi(.0719453*w-.2289914*_+1.4052427*x),f]}function mi(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function qi(s){return s>$e?s*s*s:Xe*(s-Ke)}function un(s){return parseInt(s.padEnd(2,s),16)/255}function Zn(s,n){return Kn(n?s/100:s,0,1)}function Kn(s,n,c){return Math.min(Math.max(n,s),c)}function fr(s){return!s.some(Number.isNaN)}const Es={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Zi{constructor(n,c,f,_=1,w=!0){this.r=n,this.g=c,this.b=f,this.a=_,w||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[n,c,f,_]))}static parse(n){if(n instanceof Zi)return n;if(typeof n!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Es[f];if(_){const[x,T,C]=_;return[x/255,T/255,C/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let T=1;return[un(f.slice(T,T+=x)),un(f.slice(T,T+=x)),un(f.slice(T,T+=x)),un(f.slice(T,T+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,C,A,D,F,U,W,Q,re,_e,be,Ze]=x,Ae=[D||" ",W||" ",_e].join("");if(Ae==="  "||Ae==="  /"||Ae===",,"||Ae===",,,"){const Oe=[A,U,re].join(""),Je=Oe==="%%%"?100:Oe===""?255:0;if(Je){const _t=[Kn(+C/Je,0,1),Kn(+F/Je,0,1),Kn(+Q/Je,0,1),be?Zn(+be,Ze):1];if(fr(_t))return _t}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,T,C,A,D,F,U,W,Q]=w,re=[C||" ",D||" ",U].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const _e=[+T,Kn(+A,0,100),Kn(+F,0,100),W?Zn(+W,Q):1];if(fr(_e))return function([be,Ze,Ae,Oe]){function Je(_t){const Mt=(_t+be/30)%12,Kt=Ze*Math.min(Ae,1-Ae);return Ae-Kt*Math.max(-1,Math.min(Mt-3,9-Mt,1))}return be=Qt(be),Ze/=100,Ae/=100,[Je(0),Je(8),Je(4),Oe]}(_e)}}}(n);return c?new Zi(...c,!1):void 0}get rgb(){const{r:n,g:c,b:f,a:_}=this,w=_||1/0;return this.overwriteGetter("rgb",[n/w,c/w,f/w,_])}get hcl(){return this.overwriteGetter("hcl",function(n){const[c,f,_,w]=hi(n),x=Math.sqrt(f*f+_*_);return[Math.round(1e4*x)?Qt(Math.atan2(_,f)*pi):NaN,x,c,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",hi(this.rgb))}overwriteGetter(n,c){return Object.defineProperty(this,n,{value:c}),c}toString(){const[n,c,f,_]=this.rgb;return`rgba(${[n,c,f].map(w=>Math.round(255*w)).join(",")},${_})`}}Zi.black=new Zi(0,0,0,1),Zi.white=new Zi(1,1,1,1),Zi.transparent=new Zi(0,0,0,0),Zi.red=new Zi(1,0,0,1);class Tc{constructor(n,c,f){this.sensitivity=n?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,c){return this.collator.compare(n,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ic{constructor(n,c,f,_,w){this.text=n,this.image=c,this.scale=f,this.fontStack=_,this.textColor=w}}class Br{constructor(n){this.sections=n}static fromString(n){return new Br([new Ic(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Br?n:Br.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Or{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Or)return n;if(typeof n=="number")return new Or([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const c of n)if(typeof c!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Or(n)}}toString(){return JSON.stringify(this.values)}}const Vd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Xr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let c=0;c<n.length;c+=2){const f=n[c],_=n[c+1];if(typeof f!="string"||!Vd.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Xr(n)}}toString(){return JSON.stringify(this.values)}}class Nr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Nr({name:n,available:!1}):null}}function Ls(s,n,c,f){return typeof s=="number"&&s>=0&&s<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,n,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,n,c,f]:[s,n,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Zi||s instanceof Tc||s instanceof Br||s instanceof Or||s instanceof Xr||s instanceof Nr)return!0;if(Array.isArray(s)){for(const n of s)if(!Qo(n))return!1;return!0}if(typeof s=="object"){for(const n in s)if(!Qo(s[n]))return!1;return!0}return!1}function Rn(s){if(s===null)return Wr;if(typeof s=="string")return ci;if(typeof s=="boolean")return Jt;if(typeof s=="number")return bt;if(s instanceof Zi)return In;if(s instanceof Tc)return vr;if(s instanceof Br)return Fr;if(s instanceof Or)return Hr;if(s instanceof Xr)return ye;if(s instanceof Nr)return wr;if(Array.isArray(s)){const n=s.length;let c;for(const f of s){const _=Rn(f);if(c){if(c===_)continue;c=ei;break}c=_}return Z(c||ei,n)}return Nn}function Sa(s){const n=typeof s;return s===null?"":n==="string"||n==="number"||n==="boolean"?String(s):s instanceof Zi||s instanceof Br||s instanceof Or||s instanceof Xr||s instanceof Nr?s.toString():JSON.stringify(s)}class ro{constructor(n,c){this.type=n,this.value=c}static parse(n,c){if(n.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Qo(n[1]))return c.error("invalid value");const f=n[1];let _=Rn(f);const w=c.expectedType;return _.kind!=="array"||_.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(_=w),new ro(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Pn{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const ol={string:ci,number:bt,boolean:Jt,object:Nn};class oo{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");let f,_=1;const w=n[0];if(w==="array"){let T,C;if(n.length>2){const A=n[1];if(typeof A!="string"||!(A in ol)||A==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=ol[A],_++}else T=ei;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return c.error('The length argument to "array" must be a positive integer literal',2);C=n[2],_++}f=Z(T,C)}else{if(!ol[w])throw new Error(`Types doesn't contain name = ${w}`);f=ol[w]}const x=[];for(;_<n.length;_++){const T=c.parse(n[_],_,ei);if(!T)return null;x.push(T)}return new oo(f,x)}evaluate(n){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(n);if(!pe(this.type,Rn(f)))return f;if(c===this.args.length-1)throw new Pn(`Expected value to be of type ${q(this.type)}, but found ${q(Rn(f))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Cc={"to-boolean":Jt,"to-color":In,"to-number":bt,"to-string":ci};class so{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[0];if(!Cc[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&n.length!==2)return c.error("Expected one argument.");const _=Cc[f],w=[];for(let x=1;x<n.length;x++){const T=c.parse(n[x],x,ei);if(!T)return null;w.push(T)}return new so(_,w)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let c,f;for(const _ of this.args){if(c=_.evaluate(n),f=null,c instanceof Zi)return c;if(typeof c=="string"){const w=n.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Ls(c[0],c[1],c[2],c[3]),!f))return new Zi(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Pn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(n);const _=Or.parse(c);if(_)return _}throw new Pn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(n);const _=Xr.parse(c);if(_)return _}throw new Pn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(n),c===null)return 0;const _=Number(c);if(!isNaN(_))return _}throw new Pn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Br.fromString(Sa(this.args[0].evaluate(n)));case"resolvedImage":return Nr.fromString(Sa(this.args[0].evaluate(n)));default:return Sa(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const qd=["Unknown","Point","LineString","Polygon"];class sl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let c=this._parseColorCache[n];return c||(c=this._parseColorCache[n]=Zi.parse(n)),c}}class es{constructor(n,c,f=[],_,w=new qn,x=[]){this.registry=n,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=w,this.errors=x,this.expectedType=_,this._isConstant=c}parse(n,c,f,_,w={}){return c?this.concat(c,f,_)._parse(n,w):this._parse(n,w)}_parse(n,c){function f(_,w,x){return x==="assert"?new oo(w,[_]):x==="coerce"?new so(w,[_]):_}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=n[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[_];if(w){let x=w.parse(n,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,C=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||C.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(T.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(T,C))return null}else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"assert")}if(!(x instanceof ro)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const T=new sl;try{x=new ro(x.type,x.evaluate(T))}catch(C){return this.error(C.message),null}}return x}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,c,f){const _=typeof n=="number"?this.path.concat(n):this.path,w=f?this.scope.concat(f):this.scope;return new es(this.registry,this._isConstant,_,c||null,w,this.errors)}error(n,...c){const f=`${this.key}${c.map(_=>`[${_}]`).join("")}`;this.errors.push(new _n(f,n))}checkSubtype(n,c){const f=pe(n,c);return f&&this.error(f),f}}class qo{constructor(n,c){this.type=c.type,this.bindings=[].concat(n),this.result=c}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const c of this.bindings)n(c[1]);n(this.result)}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const f=[];for(let w=1;w<n.length-1;w+=2){const x=n[w];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const T=c.parse(n[w+1],w+1);if(!T)return null;f.push([x,T])}const _=c.parse(n[n.length-1],n.length-1,c.expectedType,f);return _?new qo(f,_):null}outputDefined(){return this.result.outputDefined()}}class Oi{constructor(n,c){this.type=c.type,this.name=n,this.boundExpression=c}static parse(n,c){if(n.length!==2||typeof n[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=n[1];return c.scope.has(f)?new Oi(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Ec{constructor(n,c,f){this.type=n,this.index=c,this.input=f}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,bt),_=c.parse(n[2],2,Z(c.expectedType||ei));return f&&_?new Ec(_.type.itemType,f,_):null}evaluate(n){const c=this.index.evaluate(n),f=this.input.evaluate(n);if(c<0)throw new Pn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new Pn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new Pn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Lc{constructor(n,c){this.type=Jt,this.needle=n,this.haystack=c}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ei),_=c.parse(n[2],2,ei);return f&&_?Me(f.type,[Jt,ci,bt,Wr,ei])?new Lc(f,_):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${q(f.type)} instead`):null}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!f)return!1;if(!ze(c,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${q(Rn(c))} instead.`);if(!ze(f,["string","array"]))throw new Pn(`Expected second argument to be of type array or string, but found ${q(Rn(f))} instead.`);return f.indexOf(c)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Ms{constructor(n,c,f){this.type=bt,this.needle=n,this.haystack=c,this.fromIndex=f}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ei),_=c.parse(n[2],2,ei);if(!f||!_)return null;if(!Me(f.type,[Jt,ci,bt,Wr,ei]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${q(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,bt);return w?new Ms(f,_,w):null}return new Ms(f,_)}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!ze(c,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${q(Rn(c))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(n)),ze(f,["string"])){const w=f.indexOf(c,_);return w===-1?-1:[...f.slice(0,w)].length}if(ze(f,["array"]))return f.indexOf(c,_);throw new Pn(`Expected second argument to be of type array or string, but found ${q(Rn(f))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class Mc{constructor(n,c,f,_,w,x){this.inputType=n,this.type=c,this.input=f,this.cases=_,this.outputs=w,this.otherwise=x}static parse(n,c){if(n.length<5)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return c.error("Expected an even number of arguments.");let f,_;c.expectedType&&c.expectedType.kind!=="value"&&(_=c.expectedType);const w={},x=[];for(let A=2;A<n.length-1;A+=2){let D=n[A];const F=n[A+1];Array.isArray(D)||(D=[D]);const U=c.concat(A);if(D.length===0)return U.error("Expected at least one branch label.");for(const Q of D){if(typeof Q!="number"&&typeof Q!="string")return U.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return U.error("Numeric branch labels must be integer values.");if(f){if(U.checkSubtype(f,Rn(Q)))return null}else f=Rn(Q);if(w[String(Q)]!==void 0)return U.error("Branch labels must be unique.");w[String(Q)]=x.length}const W=c.parse(F,A,_);if(!W)return null;_=_||W.type,x.push(W)}const T=c.parse(n[1],1,ei);if(!T)return null;const C=c.parse(n[n.length-1],n.length-1,_);return C?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new Mc(f,_,T,w,x,C):null}evaluate(n){const c=this.input.evaluate(n);return(Rn(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class al{constructor(n,c,f){this.type=n,this.branches=c,this.otherwise=f}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const _=[];for(let x=1;x<n.length-1;x+=2){const T=c.parse(n[x],x,Jt);if(!T)return null;const C=c.parse(n[x+1],x+1,f);if(!C)return null;_.push([T,C]),f=f||C.type}const w=c.parse(n[n.length-1],n.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new al(f,_,w)}evaluate(n){for(const[c,f]of this.branches)if(c.evaluate(n))return f.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[c,f]of this.branches)n(c),n(f);n(this.otherwise)}outputDefined(){return this.branches.every(([n,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Ta{constructor(n,c,f,_){this.type=n,this.input=c,this.beginIndex=f,this.endIndex=_}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ei),_=c.parse(n[2],2,bt);if(!f||!_)return null;if(!Me(f.type,[Z(ei),ci,ei]))return c.error(`Expected first argument to be of type array or string, but found ${q(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,bt);return w?new Ta(f.type,f,_,w):null}return new Ta(f.type,f,_)}evaluate(n){const c=this.input.evaluate(n),f=this.beginIndex.evaluate(n);let _;if(this.endIndex&&(_=this.endIndex.evaluate(n)),ze(c,["string"]))return[...c].slice(f,_).join("");if(ze(c,["array"]))return c.slice(f,_);throw new Pn(`Expected first argument to be of type array or string, but found ${q(Rn(c))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function ll(s,n){const c=s.length-1;let f,_,w=0,x=c,T=0;for(;w<=x;)if(T=Math.floor((w+x)/2),f=s[T],_=s[T+1],f<=n){if(T===c||n<_)return T;w=T+1}else{if(!(f>n))throw new Pn("Input is not a number.");x=T-1}return 0}class As{constructor(n,c,f){this.type=n,this.input=c,this.labels=[],this.outputs=[];for(const[_,w]of f)this.labels.push(_),this.outputs.push(w)}static parse(n,c){if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(n[1],1,bt);if(!f)return null;const _=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let x=1;x<n.length;x+=2){const T=x===1?-1/0:n[x],C=n[x+1],A=x,D=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(_.length&&_[_.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const F=c.parse(C,D,w);if(!F)return null;w=w||F.type,_.push([T,F])}return new As(w,f,_)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const _=this.input.evaluate(n);if(_<=c[0])return f[0].evaluate(n);const w=c.length;return _>=c[w-1]?f[w-1].evaluate(n):f[ll(c,_)].evaluate(n)}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function hh(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Zd=dh;function dh(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}dh.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var _=this.sampleCurveX(c)-s;if(Math.abs(_)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=_/w}var x=0,T=1;for(c=s,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-s)<n));f++)s>_?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var Gd=hh(Zd);function ts(s,n,c){return s+c*(n-s)}function Ia(s,n,c){return s.map((f,_)=>ts(f,n[_],c))}const xr={number:ts,color:function(s,n,c,f="rgb"){switch(f){case"rgb":{const[_,w,x,T]=Ia(s.rgb,n.rgb,c);return new Zi(_,w,x,T,!1)}case"hcl":{const[_,w,x,T]=s.hcl,[C,A,D,F]=n.hcl;let U,W;if(isNaN(_)||isNaN(C))isNaN(_)?isNaN(C)?U=NaN:(U=C,x!==1&&x!==0||(W=A)):(U=_,D!==1&&D!==0||(W=w));else{let Ze=C-_;C>_&&Ze>180?Ze-=360:C<_&&_-C>180&&(Ze+=360),U=_+c*Ze}const[Q,re,_e,be]=function([Ze,Ae,Oe,Je]){return Ze=isNaN(Ze)?0:Ze*Et,gn([Oe,Math.cos(Ze)*Ae,Math.sin(Ze)*Ae,Je])}([U,W??ts(w,A,c),ts(x,D,c),ts(T,F,c)]);return new Zi(Q,re,_e,be,!1)}case"lab":{const[_,w,x,T]=gn(Ia(s.lab,n.lab,c));return new Zi(_,w,x,T,!1)}}},array:Ia,padding:function(s,n,c){return new Or(Ia(s.values,n.values,c))},variableAnchorOffsetCollection:function(s,n,c){const f=s.values,_=n.values;if(f.length!==_.length)throw new Pn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${n.toString()}`);const w=[];for(let x=0;x<f.length;x+=2){if(f[x]!==_[x])throw new Pn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${_[x]}`);w.push(f[x]);const[T,C]=f[x+1],[A,D]=_[x+1];w.push([ts(T,A,c),ts(C,D,c)])}return new Xr(w)}};class kr{constructor(n,c,f,_,w){this.type=n,this.operator=c,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[x,T]of w)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(n,c,f,_){let w=0;if(n.name==="exponential")w=cl(c,n.base,f,_);else if(n.name==="linear")w=cl(c,1,f,_);else if(n.name==="cubic-bezier"){const x=n.controlPoints;w=new Gd(x[0],x[1],x[2],x[3]).solve(cl(c,1,f,_))}return w}static parse(n,c){let[f,_,w,...x]=n;if(!Array.isArray(_)||_.length===0)return c.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const A=_[1];if(typeof A!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:A}}else{if(_[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const A=_.slice(1);if(A.length!==4||A.some(D=>typeof D!="number"||D<0||D>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:A}}}if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,bt),!w)return null;const T=[];let C=null;f==="interpolate-hcl"||f==="interpolate-lab"?C=In:c.expectedType&&c.expectedType.kind!=="value"&&(C=c.expectedType);for(let A=0;A<x.length;A+=2){const D=x[A],F=x[A+1],U=A+3,W=A+4;if(typeof D!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(T.length&&T[T.length-1][0]>=D)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const Q=c.parse(F,W,C);if(!Q)return null;C=C||Q.type,T.push([D,Q])}return Ve(C,bt)||Ve(C,In)||Ve(C,Hr)||Ve(C,ye)||Ve(C,Z(bt))?new kr(C,f,_,w,T):c.error(`Type ${q(C)} is not interpolatable.`)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const _=this.input.evaluate(n);if(_<=c[0])return f[0].evaluate(n);const w=c.length;if(_>=c[w-1])return f[w-1].evaluate(n);const x=ll(c,_),T=kr.interpolationFactor(this.interpolation,_,c[x],c[x+1]),C=f[x].evaluate(n),A=f[x+1].evaluate(n);switch(this.operator){case"interpolate":return xr[this.type.kind](C,A,T);case"interpolate-hcl":return xr.color(C,A,T,"hcl");case"interpolate-lab":return xr.color(C,A,T,"lab")}}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function cl(s,n,c,f){const _=f-c,w=s-c;return _===0?0:n===1?w/_:(Math.pow(n,w)-1)/(Math.pow(n,_)-1)}class ul{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expectected at least one argument.");let f=null;const _=c.expectedType;_&&_.kind!=="value"&&(f=_);const w=[];for(const T of n.slice(1)){const C=c.parse(T,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,w.push(C)}if(!f)throw new Error("No output type");const x=_&&w.some(T=>pe(_,T.type));return new ul(x?ei:f,w)}evaluate(n){let c,f=null,_=0;for(const w of this.args)if(_++,f=w.evaluate(n),f&&f instanceof Nr&&!f.available&&(c||(c=f.name),f=null,_===this.args.length&&(f=c)),f!==null)break;return f}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function hl(s,n){return s==="=="||s==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function fh(s,n,c,f){return f.compare(n,c)===0}function Ps(s,n,c){const f=s!=="=="&&s!=="!=";return class K0{constructor(w,x,T){this.type=Jt,this.lhs=w,this.rhs=x,this.collator=T,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const T=w[0];let C=x.parse(w[1],1,ei);if(!C)return null;if(!hl(T,C.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${q(C.type)}'.`);let A=x.parse(w[2],2,ei);if(!A)return null;if(!hl(T,A.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${q(A.type)}'.`);if(C.type.kind!==A.type.kind&&C.type.kind!=="value"&&A.type.kind!=="value")return x.error(`Cannot compare types '${q(C.type)}' and '${q(A.type)}'.`);f&&(C.type.kind==="value"&&A.type.kind!=="value"?C=new oo(A.type,[C]):C.type.kind!=="value"&&A.type.kind==="value"&&(A=new oo(C.type,[A])));let D=null;if(w.length===4){if(C.type.kind!=="string"&&A.type.kind!=="string"&&C.type.kind!=="value"&&A.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(w[3],3,vr),!D)return null}return new K0(C,A,D)}evaluate(w){const x=this.lhs.evaluate(w),T=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const C=Rn(x),A=Rn(T);if(C.kind!==A.kind||C.kind!=="string"&&C.kind!=="number")throw new Pn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${C.kind}, ${A.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=Rn(x),A=Rn(T);if(C.kind!=="string"||A.kind!=="string")return n(w,x,T)}return this.collator?c(w,x,T,this.collator.evaluate(w)):n(w,x,T)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Wd=Ps("==",function(s,n,c){return n===c},fh),ph=Ps("!=",function(s,n,c){return n!==c},function(s,n,c,f){return!fh(0,n,c,f)}),mh=Ps("<",function(s,n,c){return n<c},function(s,n,c,f){return f.compare(n,c)<0}),Hd=Ps(">",function(s,n,c){return n>c},function(s,n,c,f){return f.compare(n,c)>0}),Xd=Ps("<=",function(s,n,c){return n<=c},function(s,n,c,f){return f.compare(n,c)<=0}),_h=Ps(">=",function(s,n,c){return n>=c},function(s,n,c,f){return f.compare(n,c)>=0});class Ca{constructor(n,c,f){this.type=vr,this.locale=f,this.caseSensitive=n,this.diacriticSensitive=c}static parse(n,c){if(n.length!==2)return c.error("Expected one argument.");const f=n[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const _=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Jt);if(!_)return null;const w=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Jt);if(!w)return null;let x=null;return f.locale&&(x=c.parse(f.locale,1,ci),!x)?null:new Ca(_,w,x)}evaluate(n){return new Tc(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class Ac{constructor(n,c,f,_,w){this.type=ci,this.number=n,this.locale=c,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=w}static parse(n,c){if(n.length!==3)return c.error("Expected two arguments.");const f=c.parse(n[1],1,bt);if(!f)return null;const _=n[2];if(typeof _!="object"||Array.isArray(_))return c.error("NumberFormat options argument must be an object.");let w=null;if(_.locale&&(w=c.parse(_.locale,1,ci),!w))return null;let x=null;if(_.currency&&(x=c.parse(_.currency,1,ci),!x))return null;let T=null;if(_["min-fraction-digits"]&&(T=c.parse(_["min-fraction-digits"],1,bt),!T))return null;let C=null;return _["max-fraction-digits"]&&(C=c.parse(_["max-fraction-digits"],1,bt),!C)?null:new Ac(f,w,x,T,C)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class dl{constructor(n){this.type=Fr,this.sections=n}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const _=[];let w=!1;for(let x=1;x<=n.length-1;++x){const T=n[x];if(w&&typeof T=="object"&&!Array.isArray(T)){w=!1;let C=null;if(T["font-scale"]&&(C=c.parse(T["font-scale"],1,bt),!C))return null;let A=null;if(T["text-font"]&&(A=c.parse(T["text-font"],1,Z(ci)),!A))return null;let D=null;if(T["text-color"]&&(D=c.parse(T["text-color"],1,In),!D))return null;const F=_[_.length-1];F.scale=C,F.font=A,F.textColor=D}else{const C=c.parse(n[x],1,ei);if(!C)return null;const A=C.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,_.push({content:C,scale:null,font:null,textColor:null})}}return new dl(_)}evaluate(n){return new Br(this.sections.map(c=>{const f=c.content.evaluate(n);return Rn(f)===wr?new Ic("",f,null,null,null):new Ic(Sa(f),null,c.scale?c.scale.evaluate(n):null,c.font?c.font.evaluate(n).join(","):null,c.textColor?c.textColor.evaluate(n):null)}))}eachChild(n){for(const c of this.sections)n(c.content),c.scale&&n(c.scale),c.font&&n(c.font),c.textColor&&n(c.textColor)}outputDefined(){return!1}}class Pc{constructor(n){this.type=wr,this.input=n}static parse(n,c){if(n.length!==2)return c.error("Expected two arguments.");const f=c.parse(n[1],1,ci);return f?new Pc(f):c.error("No image name provided.")}evaluate(n){const c=this.input.evaluate(n),f=Nr.fromString(c);return f&&n.availableImages&&(f.available=n.availableImages.indexOf(c)>-1),f}eachChild(n){n(this.input)}outputDefined(){return!1}}class zc{constructor(n){this.type=bt,this.input=n}static parse(n,c){if(n.length!==2)return c.error(`Expected 1 argument, but found ${n.length-1} instead.`);const f=c.parse(n[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${q(f.type)} instead.`):new zc(f):null}evaluate(n){const c=this.input.evaluate(n);if(typeof c=="string")return[...c].length;if(Array.isArray(c))return c.length;throw new Pn(`Expected value to be of type string or array, but found ${q(Rn(c))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const wo=8192;function Kd(s,n){const c=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,_=Math.pow(2,n.z);return[Math.round(c*_*wo),Math.round(f*_*wo)]}function Dc(s,n){const c=Math.pow(2,n.z);return[(_=(s[0]/wo+n.x)/c,360*_-180),(f=(s[1]/wo+n.y)/c,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,_}function is(s,n){s[0]=Math.min(s[0],n[0]),s[1]=Math.min(s[1],n[1]),s[2]=Math.max(s[2],n[0]),s[3]=Math.max(s[3],n[1])}function Zo(s,n){return!(s[0]<=n[0]||s[2]>=n[2]||s[1]<=n[1]||s[3]>=n[3])}function Ui(s,n,c){const f=s[0]-n[0],_=s[1]-n[1],w=s[0]-c[0],x=s[1]-c[1];return f*x-w*_==0&&f*w<=0&&_*x<=0}function fl(s,n,c,f){return(_=[f[0]-c[0],f[1]-c[1]])[0]*(w=[n[0]-s[0],n[1]-s[1]])[1]-_[1]*w[0]!=0&&!(!yh(s,n,c,f)||!yh(c,f,s,n));var _,w}function Jd(s,n,c){for(const f of c)for(let _=0;_<f.length-1;++_)if(fl(s,n,f[_],f[_+1]))return!0;return!1}function zs(s,n,c=!1){let f=!1;for(const T of n)for(let C=0;C<T.length-1;C++){if(Ui(s,T[C],T[C+1]))return c;(w=T[C])[1]>(_=s)[1]!=(x=T[C+1])[1]>_[1]&&_[0]<(x[0]-w[0])*(_[1]-w[1])/(x[1]-w[1])+w[0]&&(f=!f)}var _,w,x;return f}function Yd(s,n){for(const c of n)if(zs(s,c))return!0;return!1}function gh(s,n){for(const c of s)if(!zs(c,n))return!1;for(let c=0;c<s.length-1;++c)if(Jd(s[c],s[c+1],n))return!1;return!0}function Qd(s,n){for(const c of n)if(gh(s,c))return!0;return!1}function yh(s,n,c,f){const _=f[0]-c[0],w=f[1]-c[1],x=(s[0]-c[0])*w-_*(s[1]-c[1]),T=(n[0]-c[0])*w-_*(n[1]-c[1]);return x>0&&T<0||x<0&&T>0}function Rc(s,n,c){const f=[];for(let _=0;_<s.length;_++){const w=[];for(let x=0;x<s[_].length;x++){const T=Kd(s[_][x],c);is(n,T),w.push(T)}f.push(w)}return f}function bh(s,n,c){const f=[];for(let _=0;_<s.length;_++){const w=Rc(s[_],n,c);f.push(w)}return f}function vh(s,n,c,f){if(s[0]<c[0]||s[0]>c[2]){const _=.5*f;let w=s[0]-c[0]>_?-f:c[0]-s[0]>_?f:0;w===0&&(w=s[0]-c[2]>_?-f:c[2]-s[0]>_?f:0),s[0]+=w}is(n,s)}function wh(s,n,c,f){const _=Math.pow(2,f.z)*wo,w=[f.x*wo,f.y*wo],x=[];for(const T of s)for(const C of T){const A=[C.x+w[0],C.y+w[1]];vh(A,n,c,_),x.push(A)}return x}function xh(s,n,c,f){const _=Math.pow(2,f.z)*wo,w=[f.x*wo,f.y*wo],x=[];for(const C of s){const A=[];for(const D of C){const F=[D.x+w[0],D.y+w[1]];is(n,F),A.push(F)}x.push(A)}if(n[2]-n[0]<=_/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of x)for(const A of C)vh(A,n,c,_)}var T;return x}class ns{constructor(n,c){this.type=Jt,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Qo(n[1])){const f=n[1];if(f.type==="FeatureCollection"){const _=[];for(const w of f.features){const{type:x,coordinates:T}=w.geometry;x==="Polygon"&&_.push(T),x==="MultiPolygon"&&_.push(...T)}if(_.length)return new ns(f,{type:"MultiPolygon",coordinates:_})}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ns(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ns(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Rc(f.coordinates,w,x),C=wh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!zs(A,T))return!1}if(f.type==="MultiPolygon"){const T=bh(f.coordinates,w,x),C=wh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!Yd(A,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Rc(f.coordinates,w,x),C=xh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!gh(A,T))return!1}if(f.type==="MultiPolygon"){const T=bh(f.coordinates,w,x),C=xh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!Qd(A,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let kh=class{constructor(s=[],n=(c,f)=>c<f?-1:c>f?1:0){if(this.data=s,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:n,compare:c}=this,f=n[s];for(;s>0;){const _=s-1>>1,w=n[_];if(c(f,w)>=0)break;n[s]=w,s=_}n[s]=f}_down(s){const{data:n,compare:c}=this,f=this.length>>1,_=n[s];for(;s<f;){let w=1+(s<<1);const x=w+1;if(x<this.length&&c(n[x],n[w])<0&&(w=x),c(n[w],_)>=0)break;n[s]=n[w],s=w}n[s]=_}};function ef(s,n,c,f,_){Sh(s,n,c,f||s.length-1,_||tf)}function Sh(s,n,c,f,_){for(;f>c;){if(f-c>600){var w=f-c+1,x=n-c+1,T=Math.log(w),C=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*C*(w-C)/w)*(x-w/2<0?-1:1);Sh(s,n,Math.max(c,Math.floor(n-x*C/w+A)),Math.min(f,Math.floor(n+(w-x)*C/w+A)),_)}var D=s[n],F=c,U=f;for(Ea(s,c,n),_(s[f],D)>0&&Ea(s,c,f);F<U;){for(Ea(s,F,U),F++,U--;_(s[F],D)<0;)F++;for(;_(s[U],D)>0;)U--}_(s[c],D)===0?Ea(s,c,U):Ea(s,++U,f),U<=n&&(c=U+1),n<=U&&(f=U-1)}}function Ea(s,n,c){var f=s[n];s[n]=s[c],s[c]=f}function tf(s,n){return s<n?-1:s>n?1:0}function pl(s,n){if(s.length<=1)return[s];const c=[];let f,_;for(const w of s){const x=rf(w);x!==0&&(w.area=Math.abs(x),_===void 0&&(_=x<0),_===x<0?(f&&c.push(f),f=[w]):f.push(w))}if(f&&c.push(f),n>1)for(let w=0;w<c.length;w++)c[w].length<=n||(ef(c[w],n,1,c[w].length-1,nf),c[w]=c[w].slice(0,n));return c}function nf(s,n){return n.area-s.area}function rf(s){let n=0;for(let c,f,_=0,w=s.length,x=w-1;_<w;x=_++)c=s[_],f=s[x],n+=(f.x-c.x)*(c.y+f.y);return n}const Th=1/298.257223563,Ih=Th*(2-Th),Ch=Math.PI/180;class Fc{constructor(n){const c=6378.137*Ch*1e3,f=Math.cos(n*Ch),_=1/(1-Ih*(1-f*f)),w=Math.sqrt(_);this.kx=c*w*f,this.ky=c*w*_*(1-Ih)}distance(n,c){const f=this.wrap(n[0]-c[0])*this.kx,_=(n[1]-c[1])*this.ky;return Math.sqrt(f*f+_*_)}pointOnLine(n,c){let f,_,w,x,T=1/0;for(let C=0;C<n.length-1;C++){let A=n[C][0],D=n[C][1],F=this.wrap(n[C+1][0]-A)*this.kx,U=(n[C+1][1]-D)*this.ky,W=0;F===0&&U===0||(W=(this.wrap(c[0]-A)*this.kx*F+(c[1]-D)*this.ky*U)/(F*F+U*U),W>1?(A=n[C+1][0],D=n[C+1][1]):W>0&&(A+=F/this.kx*W,D+=U/this.ky*W)),F=this.wrap(c[0]-A)*this.kx,U=(c[1]-D)*this.ky;const Q=F*F+U*U;Q<T&&(T=Q,f=A,_=D,w=C,x=W)}return{point:[f,_],index:w,t:Math.max(0,Math.min(1,x))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Eh(s,n){return n[0]-s[0]}function ml(s){return s[1]-s[0]+1}function Do(s,n){return s[1]>=s[0]&&s[1]<n}function Bc(s,n){if(s[0]>s[1])return[null,null];const c=ml(s);if(n){if(c===2)return[s,null];const _=Math.floor(c/2);return[[s[0],s[0]+_],[s[0]+_,s[1]]]}if(c===1)return[s,null];const f=Math.floor(c/2)-1;return[[s[0],s[0]+f],[s[0]+f+1,s[1]]]}function Oc(s,n){if(!Do(n,s.length))return[1/0,1/0,-1/0,-1/0];const c=[1/0,1/0,-1/0,-1/0];for(let f=n[0];f<=n[1];++f)is(c,s[f]);return c}function Nc(s){const n=[1/0,1/0,-1/0,-1/0];for(const c of s)for(const f of c)is(n,f);return n}function _l(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function jc(s,n,c){if(!_l(s)||!_l(n))return NaN;let f=0,_=0;return s[2]<n[0]&&(f=n[0]-s[2]),s[0]>n[2]&&(f=s[0]-n[2]),s[1]>n[3]&&(_=s[1]-n[3]),s[3]<n[1]&&(_=n[1]-s[3]),c.distance([0,0],[f,_])}function rs(s,n,c){const f=c.pointOnLine(n,s);return c.distance(s,f.point)}function Uc(s,n,c,f,_){const w=Math.min(rs(s,[c,f],_),rs(n,[c,f],_)),x=Math.min(rs(c,[s,n],_),rs(f,[s,n],_));return Math.min(w,x)}function of(s,n,c,f,_){if(!Do(n,s.length)||!Do(f,c.length))return 1/0;let w=1/0;for(let x=n[0];x<n[1];++x){const T=s[x],C=s[x+1];for(let A=f[0];A<f[1];++A){const D=c[A],F=c[A+1];if(fl(T,C,D,F))return 0;w=Math.min(w,Uc(T,C,D,F,_))}}return w}function Cn(s,n,c,f,_){if(!Do(n,s.length)||!Do(f,c.length))return NaN;let w=1/0;for(let x=n[0];x<=n[1];++x)for(let T=f[0];T<=f[1];++T)if(w=Math.min(w,_.distance(s[x],c[T])),w===0)return w;return w}function sf(s,n,c){if(zs(s,n,!0))return 0;let f=1/0;for(const _ of n){const w=_[0],x=_[_.length-1];if(w!==x&&(f=Math.min(f,rs(s,[x,w],c)),f===0))return f;const T=c.pointOnLine(_,s);if(f=Math.min(f,c.distance(s,T.point)),f===0)return f}return f}function gi(s,n,c,f){if(!Do(n,s.length))return NaN;for(let w=n[0];w<=n[1];++w)if(zs(s[w],c,!0))return 0;let _=1/0;for(let w=n[0];w<n[1];++w){const x=s[w],T=s[w+1];for(const C of c)for(let A=0,D=C.length,F=D-1;A<D;F=A++){const U=C[F],W=C[A];if(fl(x,T,U,W))return 0;_=Math.min(_,Uc(x,T,U,W,f))}}return _}function gl(s,n){for(const c of s)for(const f of c)if(zs(f,n,!0))return!0;return!1}function Yi(s,n,c,f=1/0){const _=Nc(s),w=Nc(n);if(f!==1/0&&jc(_,w,c)>=f)return f;if(Zo(_,w)){if(gl(s,n))return 0}else if(gl(n,s))return 0;let x=1/0;for(const T of s)for(let C=0,A=T.length,D=A-1;C<A;D=C++){const F=T[D],U=T[C];for(const W of n)for(let Q=0,re=W.length,_e=re-1;Q<re;_e=Q++){const be=W[_e],Ze=W[Q];if(fl(F,U,be,Ze))return 0;x=Math.min(x,Uc(F,U,be,Ze,c))}}return x}function Wi(s,n,c,f,_,w){if(!w)return;const x=jc(Oc(f,w),_,c);x<n&&s.push([x,w,[0,0]])}function os(s,n,c,f,_,w,x){if(!w||!x)return;const T=jc(Oc(f,w),Oc(_,x),c);T<n&&s.push([T,w,x])}function La(s,n,c,f,_=1/0){let w=Math.min(f.distance(s[0],c[0][0]),_);if(w===0)return w;const x=new kh([[0,[0,s.length-1],[0,0]]],Eh),T=Nc(c);for(;x.length>0;){const C=x.pop();if(C[0]>=w)continue;const A=C[1],D=n?50:100;if(ml(A)<=D){if(!Do(A,s.length))return NaN;if(n){const F=gi(s,A,c,f);if(isNaN(F)||F===0)return F;w=Math.min(w,F)}else for(let F=A[0];F<=A[1];++F){const U=sf(s[F],c,f);if(w=Math.min(w,U),w===0)return 0}}else{const F=Bc(A,n);Wi(x,w,f,s,T,F[0]),Wi(x,w,f,s,T,F[1])}}return w}function Ma(s,n,c,f,_,w=1/0){let x=Math.min(w,_.distance(s[0],c[0]));if(x===0)return x;const T=new kh([[0,[0,s.length-1],[0,c.length-1]]],Eh);for(;T.length>0;){const C=T.pop();if(C[0]>=x)continue;const A=C[1],D=C[2],F=n?50:100,U=f?50:100;if(ml(A)<=F&&ml(D)<=U){if(!Do(A,s.length)&&Do(D,c.length))return NaN;let W;if(n&&f)W=of(s,A,c,D,_),x=Math.min(x,W);else if(n&&!f){const Q=s.slice(A[0],A[1]+1);for(let re=D[0];re<=D[1];++re)if(W=rs(c[re],Q,_),x=Math.min(x,W),x===0)return x}else if(!n&&f){const Q=c.slice(D[0],D[1]+1);for(let re=A[0];re<=A[1];++re)if(W=rs(s[re],Q,_),x=Math.min(x,W),x===0)return x}else W=Cn(s,A,c,D,_),x=Math.min(x,W)}else{const W=Bc(A,n),Q=Bc(D,f);os(T,x,_,s,c,W[0],Q[0]),os(T,x,_,s,c,W[0],Q[1]),os(T,x,_,s,c,W[1],Q[0]),os(T,x,_,s,c,W[1],Q[1])}}return x}function $c(s){return s.type==="MultiPolygon"?s.coordinates.map(n=>({type:"Polygon",coordinates:n})):s.type==="MultiLineString"?s.coordinates.map(n=>({type:"LineString",coordinates:n})):s.type==="MultiPoint"?s.coordinates.map(n=>({type:"Point",coordinates:n})):[s]}class ss{constructor(n,c){this.type=bt,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Qo(n[1])){const f=n[1];if(f.type==="FeatureCollection")return new ss(f,f.features.map(_=>$c(_.geometry)).flat());if(f.type==="Feature")return new ss(f,$c(f.geometry));if("type"in f&&"coordinates"in f)return new ss(f,$c(f))}return c.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,f){const _=c.geometry(),w=_.flat().map(C=>Dc([C.x,C.y],c.canonical));if(_.length===0)return NaN;const x=new Fc(w[0][1]);let T=1/0;for(const C of f){switch(C.type){case"Point":T=Math.min(T,Ma(w,!1,[C.coordinates],!1,x,T));break;case"LineString":T=Math.min(T,Ma(w,!1,C.coordinates,!0,x,T));break;case"Polygon":T=Math.min(T,La(w,!1,C.coordinates,x,T))}if(T===0)return T}return T}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,f){const _=c.geometry(),w=_.flat().map(C=>Dc([C.x,C.y],c.canonical));if(_.length===0)return NaN;const x=new Fc(w[0][1]);let T=1/0;for(const C of f){switch(C.type){case"Point":T=Math.min(T,Ma(w,!0,[C.coordinates],!1,x,T));break;case"LineString":T=Math.min(T,Ma(w,!0,C.coordinates,!0,x,T));break;case"Polygon":T=Math.min(T,La(w,!0,C.coordinates,x,T))}if(T===0)return T}return T}(n,this.geometries);if(n.geometryType()==="Polygon")return function(c,f){const _=c.geometry();if(_.length===0||_[0].length===0)return NaN;const w=pl(_,0).map(C=>C.map(A=>A.map(D=>Dc([D.x,D.y],c.canonical)))),x=new Fc(w[0][0][0][1]);let T=1/0;for(const C of f)for(const A of w){switch(C.type){case"Point":T=Math.min(T,La([C.coordinates],!1,A,x,T));break;case"LineString":T=Math.min(T,La(C.coordinates,!0,A,x,T));break;case"Polygon":T=Math.min(T,Yi(A,C.coordinates,x,T))}if(T===0)return T}return T}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ds={"==":Wd,"!=":ph,">":Hd,"<":mh,">=":_h,"<=":Xd,array:oo,at:Ec,boolean:oo,case:al,coalesce:ul,collator:Ca,format:dl,image:Pc,in:Lc,"index-of":Ms,interpolate:kr,"interpolate-hcl":kr,"interpolate-lab":kr,length:zc,let:qo,literal:ro,match:Mc,number:oo,"number-format":Ac,object:oo,slice:Ta,step:As,string:oo,"to-boolean":so,"to-color":so,"to-number":so,"to-string":so,var:Oi,within:ns,distance:ss};class Kr{constructor(n,c,f,_){this.name=n,this.type=c,this._evaluate=f,this.args=_}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,c){const f=n[0],_=Kr.definitions[f];if(!_)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(_)?_[0]:_.type,x=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,T=x.filter(([A])=>!Array.isArray(A)||A.length===n.length-1);let C=null;for(const[A,D]of T){C=new es(c.registry,Aa,c.path,null,c.scope);const F=[];let U=!1;for(let W=1;W<n.length;W++){const Q=n[W],re=Array.isArray(A)?A[W-1]:A.type,_e=C.parse(Q,1+F.length,re);if(!_e){U=!0;break}F.push(_e)}if(!U)if(Array.isArray(A)&&A.length!==F.length)C.error(`Expected ${A.length} arguments, but found ${F.length} instead.`);else{for(let W=0;W<F.length;W++){const Q=Array.isArray(A)?A[W]:A.type,re=F[W];C.concat(W+1).checkSubtype(Q,re.type)}if(C.errors.length===0)return new Kr(f,w,D,F)}}if(T.length===1)c.errors.push(...C.errors);else{const A=(T.length?T:x).map(([F])=>{return U=F,Array.isArray(U)?`(${U.map(q).join(", ")})`:`(${q(U.type)}...)`;var U}).join(" | "),D=[];for(let F=1;F<n.length;F++){const U=c.parse(n[F],1+D.length);if(!U)return null;D.push(q(U.type))}c.error(`Expected arguments of type ${A}, but found (${D.join(", ")}) instead.`)}return null}static register(n,c){Kr.definitions=c;for(const f in c)n[f]=Kr}}function Vc(s,[n,c,f,_]){n=n.evaluate(s),c=c.evaluate(s),f=f.evaluate(s);const w=_?_.evaluate(s):1,x=Ls(n,c,f,w);if(x)throw new Pn(x);return new Zi(n/255,c/255,f/255,w,!1)}function qc(s,n){return s in n}function Zc(s,n){const c=n[s];return c===void 0?null:c}function as(s){return{type:s}}function Aa(s){if(s instanceof Oi)return Aa(s.boundExpression);if(s instanceof Kr&&s.name==="error"||s instanceof Ca||s instanceof ns||s instanceof ss)return!1;const n=s instanceof so||s instanceof oo;let c=!0;return s.eachChild(f=>{c=n?c&&Aa(f):c&&f instanceof ro}),!!c&&Pa(s)&&za(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Pa(s){if(s instanceof Kr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof ns||s instanceof ss)return!1;let n=!0;return s.eachChild(c=>{n&&!Pa(c)&&(n=!1)}),n}function Rs(s){if(s instanceof Kr&&s.name==="feature-state")return!1;let n=!0;return s.eachChild(c=>{n&&!Rs(c)&&(n=!1)}),n}function za(s,n){if(s instanceof Kr&&n.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(f=>{c&&!za(f,n)&&(c=!1)}),c}function yl(s){return{result:"success",value:s}}function Fs(s){return{result:"error",value:s}}function Bs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Lh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Gc(s){return!!s.expression&&s.expression.interpolated}function Ai(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function bl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function af(s){return s}function Mh(s,n){const c=n.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",_=f||!(f||s.property!==void 0),w=s.type||(Gc(n)?"exponential":"interval");if(c||n.type==="padding"){const D=c?Zi.parse:Or.parse;(s=tr({},s)).stops&&(s.stops=s.stops.map(F=>[F[0],D(F[1])])),s.default=D(s.default?s.default:n.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let T,C,A;if(w==="exponential")T=Ph;else if(w==="interval")T=vl;else if(w==="categorical"){T=Ah,C=Object.create(null);for(const D of s.stops)C[D[0]]=D[1];A=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);T=zh}if(f){const D={},F=[];for(let Q=0;Q<s.stops.length;Q++){const re=s.stops[Q],_e=re[0].zoom;D[_e]===void 0&&(D[_e]={zoom:_e,type:s.type,property:s.property,default:s.default,stops:[]},F.push(_e)),D[_e].stops.push([re[0].value,re[1]])}const U=[];for(const Q of F)U.push([D[Q].zoom,Mh(D[Q],n)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:kr.interpolationFactor.bind(void 0,W),zoomStops:U.map(Q=>Q[0]),evaluate:({zoom:Q},re)=>Ph({stops:U,base:s.base},n,Q).evaluate(Q,re)}}if(_){const D=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:kr.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(F=>F[0]),evaluate:({zoom:F})=>T(s,n,F,C,A)}}return{kind:"source",evaluate(D,F){const U=F&&F.properties?F.properties[s.property]:void 0;return U===void 0?Os(s.default,n.default):T(s,n,U,C,A)}}}function Os(s,n,c){return s!==void 0?s:n!==void 0?n:c!==void 0?c:void 0}function Ah(s,n,c,f,_){return Os(typeof c===_?f[c]:void 0,s.default,n.default)}function vl(s,n,c){if(Ai(c)!=="number")return Os(s.default,n.default);const f=s.stops.length;if(f===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[f-1][0])return s.stops[f-1][1];const _=ll(s.stops.map(w=>w[0]),c);return s.stops[_][1]}function Ph(s,n,c){const f=s.base!==void 0?s.base:1;if(Ai(c)!=="number")return Os(s.default,n.default);const _=s.stops.length;if(_===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[_-1][0])return s.stops[_-1][1];const w=ll(s.stops.map(D=>D[0]),c),x=function(D,F,U,W){const Q=W-U,re=D-U;return Q===0?0:F===1?re/Q:(Math.pow(F,re)-1)/(Math.pow(F,Q)-1)}(c,f,s.stops[w][0],s.stops[w+1][0]),T=s.stops[w][1],C=s.stops[w+1][1],A=xr[n.type]||af;return typeof T.evaluate=="function"?{evaluate(...D){const F=T.evaluate.apply(void 0,D),U=C.evaluate.apply(void 0,D);if(F!==void 0&&U!==void 0)return A(F,U,x,s.colorSpace)}}:A(T,C,x,s.colorSpace)}function zh(s,n,c){switch(n.type){case"color":c=Zi.parse(c);break;case"formatted":c=Br.fromString(c.toString());break;case"resolvedImage":c=Nr.fromString(c.toString());break;case"padding":c=Or.parse(c);break;default:Ai(c)===n.type||n.type==="enum"&&n.values[c]||(c=void 0)}return Os(c,s.default,n.default)}Kr.register(Ds,{error:[{kind:"error"},[ci],(s,[n])=>{throw new Pn(n.evaluate(s))}],typeof:[ci,[ei],(s,[n])=>q(Rn(n.evaluate(s)))],"to-rgba":[Z(bt,4),[In],(s,[n])=>{const[c,f,_,w]=n.evaluate(s).rgb;return[255*c,255*f,255*_,w]}],rgb:[In,[bt,bt,bt],Vc],rgba:[In,[bt,bt,bt,bt],Vc],has:{type:Jt,overloads:[[[ci],(s,[n])=>qc(n.evaluate(s),s.properties())],[[ci,Nn],(s,[n,c])=>qc(n.evaluate(s),c.evaluate(s))]]},get:{type:ei,overloads:[[[ci],(s,[n])=>Zc(n.evaluate(s),s.properties())],[[ci,Nn],(s,[n,c])=>Zc(n.evaluate(s),c.evaluate(s))]]},"feature-state":[ei,[ci],(s,[n])=>Zc(n.evaluate(s),s.featureState||{})],properties:[Nn,[],s=>s.properties()],"geometry-type":[ci,[],s=>s.geometryType()],id:[ei,[],s=>s.id()],zoom:[bt,[],s=>s.globals.zoom],"heatmap-density":[bt,[],s=>s.globals.heatmapDensity||0],"line-progress":[bt,[],s=>s.globals.lineProgress||0],accumulated:[ei,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[bt,as(bt),(s,n)=>{let c=0;for(const f of n)c+=f.evaluate(s);return c}],"*":[bt,as(bt),(s,n)=>{let c=1;for(const f of n)c*=f.evaluate(s);return c}],"-":{type:bt,overloads:[[[bt,bt],(s,[n,c])=>n.evaluate(s)-c.evaluate(s)],[[bt],(s,[n])=>-n.evaluate(s)]]},"/":[bt,[bt,bt],(s,[n,c])=>n.evaluate(s)/c.evaluate(s)],"%":[bt,[bt,bt],(s,[n,c])=>n.evaluate(s)%c.evaluate(s)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(s,[n,c])=>Math.pow(n.evaluate(s),c.evaluate(s))],sqrt:[bt,[bt],(s,[n])=>Math.sqrt(n.evaluate(s))],log10:[bt,[bt],(s,[n])=>Math.log(n.evaluate(s))/Math.LN10],ln:[bt,[bt],(s,[n])=>Math.log(n.evaluate(s))],log2:[bt,[bt],(s,[n])=>Math.log(n.evaluate(s))/Math.LN2],sin:[bt,[bt],(s,[n])=>Math.sin(n.evaluate(s))],cos:[bt,[bt],(s,[n])=>Math.cos(n.evaluate(s))],tan:[bt,[bt],(s,[n])=>Math.tan(n.evaluate(s))],asin:[bt,[bt],(s,[n])=>Math.asin(n.evaluate(s))],acos:[bt,[bt],(s,[n])=>Math.acos(n.evaluate(s))],atan:[bt,[bt],(s,[n])=>Math.atan(n.evaluate(s))],min:[bt,as(bt),(s,n)=>Math.min(...n.map(c=>c.evaluate(s)))],max:[bt,as(bt),(s,n)=>Math.max(...n.map(c=>c.evaluate(s)))],abs:[bt,[bt],(s,[n])=>Math.abs(n.evaluate(s))],round:[bt,[bt],(s,[n])=>{const c=n.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[bt,[bt],(s,[n])=>Math.floor(n.evaluate(s))],ceil:[bt,[bt],(s,[n])=>Math.ceil(n.evaluate(s))],"filter-==":[Jt,[ci,ei],(s,[n,c])=>s.properties()[n.value]===c.value],"filter-id-==":[Jt,[ei],(s,[n])=>s.id()===n.value],"filter-type-==":[Jt,[ci],(s,[n])=>s.geometryType()===n.value],"filter-<":[Jt,[ci,ei],(s,[n,c])=>{const f=s.properties()[n.value],_=c.value;return typeof f==typeof _&&f<_}],"filter-id-<":[Jt,[ei],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<f}],"filter->":[Jt,[ci,ei],(s,[n,c])=>{const f=s.properties()[n.value],_=c.value;return typeof f==typeof _&&f>_}],"filter-id->":[Jt,[ei],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>f}],"filter-<=":[Jt,[ci,ei],(s,[n,c])=>{const f=s.properties()[n.value],_=c.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[Jt,[ei],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<=f}],"filter->=":[Jt,[ci,ei],(s,[n,c])=>{const f=s.properties()[n.value],_=c.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[Jt,[ei],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>=f}],"filter-has":[Jt,[ei],(s,[n])=>n.value in s.properties()],"filter-has-id":[Jt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Jt,[Z(ci)],(s,[n])=>n.value.indexOf(s.geometryType())>=0],"filter-id-in":[Jt,[Z(ei)],(s,[n])=>n.value.indexOf(s.id())>=0],"filter-in-small":[Jt,[ci,Z(ei)],(s,[n,c])=>c.value.indexOf(s.properties()[n.value])>=0],"filter-in-large":[Jt,[ci,Z(ei)],(s,[n,c])=>function(f,_,w,x){for(;w<=x;){const T=w+x>>1;if(_[T]===f)return!0;_[T]>f?x=T-1:w=T+1}return!1}(s.properties()[n.value],c.value,0,c.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(s,[n,c])=>n.evaluate(s)&&c.evaluate(s)],[as(Jt),(s,n)=>{for(const c of n)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(s,[n,c])=>n.evaluate(s)||c.evaluate(s)],[as(Jt),(s,n)=>{for(const c of n)if(c.evaluate(s))return!0;return!1}]]},"!":[Jt,[Jt],(s,[n])=>!n.evaluate(s)],"is-supported-script":[Jt,[ci],(s,[n])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(n.evaluate(s))}],upcase:[ci,[ci],(s,[n])=>n.evaluate(s).toUpperCase()],downcase:[ci,[ci],(s,[n])=>n.evaluate(s).toLowerCase()],concat:[ci,as(ei),(s,n)=>n.map(c=>Sa(c.evaluate(s))).join("")],"resolved-locale":[ci,[vr],(s,[n])=>n.evaluate(s).resolvedLocale()]});class wl{constructor(n,c){var f;this.expression=n,this._warningHistory={},this._evaluator=new sl,this._defaultValue=c?(f=c).type==="color"&&bl(f.default)?new Zi(0,0,0,0):f.type==="color"?Zi.parse(f.default)||null:f.type==="padding"?Or.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Xr.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(n,c,f,_,w,x){return this._evaluator.globals=n,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(n,c,f,_,w,x){this._evaluator.globals=n,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Pn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function xl(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ds}function Ns(s,n){const c=new es(Ds,Aa,[],n?function(_){const w={color:In,string:ci,number:bt,enum:ci,boolean:Jt,formatted:Fr,padding:Hr,resolvedImage:wr,variableAnchorOffsetCollection:ye};return _.type==="array"?Z(w[_.value]||ei,_.length):w[_.type]}(n):void 0),f=c.parse(s,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?yl(new wl(f,n)):Fs(c.errors)}class js{constructor(n,c){this.kind=n,this._styleExpression=c,this.isStateDependent=n!=="constant"&&!Rs(c.expression)}evaluateWithoutErrorHandling(n,c,f,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,_,w,x)}evaluate(n,c,f,_,w,x){return this._styleExpression.evaluate(n,c,f,_,w,x)}}class Us{constructor(n,c,f,_){this.kind=n,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=n!=="camera"&&!Rs(c.expression),this.interpolationType=_}evaluateWithoutErrorHandling(n,c,f,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,_,w,x)}evaluate(n,c,f,_,w,x){return this._styleExpression.evaluate(n,c,f,_,w,x)}interpolationFactor(n,c,f){return this.interpolationType?kr.interpolationFactor(this.interpolationType,n,c,f):0}}function Wc(s,n){const c=Ns(s,n);if(c.result==="error")return c;const f=c.value.expression,_=Pa(f);if(!_&&!Bs(n))return Fs([new _n("","data expressions not supported")]);const w=za(f,["zoom"]);if(!w&&!Lh(n))return Fs([new _n("","zoom expressions not supported")]);const x=Da(f);return x||w?x instanceof _n?Fs([x]):x instanceof kr&&!Gc(n)?Fs([new _n("",'"interpolate" expressions cannot be used with this property')]):yl(x?new Us(_?"camera":"composite",c.value,x.labels,x instanceof kr?x.interpolation:void 0):new js(_?"constant":"source",c.value)):Fs([new _n("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $s{constructor(n,c){this._parameters=n,this._specification=c,tr(this,Mh(this._parameters,this._specification))}static deserialize(n){return new $s(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Da(s){let n=null;if(s instanceof qo)n=Da(s.result);else if(s instanceof ul){for(const c of s.args)if(n=Da(c),n)break}else(s instanceof As||s instanceof kr)&&s.input instanceof Kr&&s.input.name==="zoom"&&(n=s);return n instanceof _n||s.eachChild(c=>{const f=Da(c);f instanceof _n?n=f:!n&&f?n=new _n("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&f&&n!==f&&(n=new _n("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function kl(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const n of s.slice(1))if(!kl(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Sl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hc(s){if(s==null)return{filter:()=>!0,needGeometry:!1};kl(s)||(s=Tl(s));const n=Ns(s,Sl);if(n.result==="error")throw new Error(n.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,_)=>n.value.evaluate(c,f,{},_),needGeometry:Dh(s)}}function lf(s,n){return s<n?-1:s>n?1:0}function Dh(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let n=1;n<s.length;n++)if(Dh(s[n]))return!0;return!1}function Tl(s){if(!s)return!0;const n=s[0];return s.length<=1?n!=="any":n==="=="?Xc(s[1],s[2],"=="):n==="!="?ir(Xc(s[1],s[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Xc(s[1],s[2],n):n==="any"?(c=s.slice(1),["any"].concat(c.map(Tl))):n==="all"?["all"].concat(s.slice(1).map(Tl)):n==="none"?["all"].concat(s.slice(1).map(Tl).map(ir)):n==="in"?Ra(s[1],s.slice(2)):n==="!in"?ir(Ra(s[1],s.slice(2))):n==="has"?Fa(s[1]):n!=="!has"||ir(Fa(s[1]));var c}function Xc(s,n,c){switch(s){case"$type":return[`filter-type-${c}`,n];case"$id":return[`filter-id-${c}`,n];default:return[`filter-${c}`,s,n]}}function Ra(s,n){if(n.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(c=>typeof c!=typeof n[0])?["filter-in-large",s,["literal",n.sort(lf)]]:["filter-in-small",s,["literal",n]]}}function Fa(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ir(s){return["!",s]}function ls(s){const n=typeof s;if(n==="number"||n==="boolean"||n==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let _="[";for(const w of s)_+=`${ls(w)},`;return`${_}]`}const c=Object.keys(s).sort();let f="{";for(let _=0;_<c.length;_++)f+=`${JSON.stringify(c[_])}:${ls(s[c[_]])},`;return`${f}}`}function Rh(s){let n="";for(const c of pt)n+=`/${ls(s[c])}`;return n}function Fh(s){const n=s.value;return n?[new ct(s.key,n,"constants have been deprecated as of v8")]:[]}function En(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function ao(s){if(Array.isArray(s))return s.map(ao);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const n={};for(const c in s)n[c]=ao(s[c]);return n}return En(s)}function jr(s){const n=s.key,c=s.value,f=s.valueSpec||{},_=s.objectElementValidators||{},w=s.style,x=s.styleSpec,T=s.validateSpec;let C=[];const A=Ai(c);if(A!=="object")return[new ct(n,c,`object expected, ${A} found`)];for(const D in c){const F=D.split(".")[0],U=f[F]||f["*"];let W;if(_[F])W=_[F];else if(f[F])W=T;else if(_["*"])W=_["*"];else{if(!f["*"]){C.push(new ct(n,c[D],`unknown property "${D}"`));continue}W=T}C=C.concat(W({key:(n&&`${n}.`)+D,value:c[D],valueSpec:U,style:w,styleSpec:x,object:c,objectKey:D,validateSpec:T},c))}for(const D in f)_[D]||f[D].required&&f[D].default===void 0&&c[D]===void 0&&C.push(new ct(n,c,`missing required property "${D}"`));return C}function Ba(s){const n=s.value,c=s.valueSpec,f=s.style,_=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(Ai(n)!=="array")return[new ct(w,n,`array expected, ${Ai(n)} found`)];if(c.length&&n.length!==c.length)return[new ct(w,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new ct(w,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let T={type:c.value,values:c.values};_.$version<7&&(T.function=c.function),Ai(c.value)==="object"&&(T=c.value);let C=[];for(let A=0;A<n.length;A++)C=C.concat(x({array:n,arrayIndex:A,value:n[A],valueSpec:T,validateSpec:s.validateSpec,style:f,styleSpec:_,key:`${w}[${A}]`}));return C}function Kc(s){const n=s.key,c=s.value,f=s.valueSpec;let _=Ai(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new ct(n,c,`number expected, ${_} found`)]:"minimum"in f&&c<f.minimum?[new ct(n,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new ct(n,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function Il(s){const n=s.valueSpec,c=En(s.value.type);let f,_,w,x={};const T=c!=="categorical"&&s.value.property===void 0,C=!T,A=Ai(s.value.stops)==="array"&&Ai(s.value.stops[0])==="array"&&Ai(s.value.stops[0][0])==="object",D=jr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(W){if(c==="identity")return[new ct(W.key,W.value,'identity function may not have a "stops" property')];let Q=[];const re=W.value;return Q=Q.concat(Ba({key:W.key,value:re,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:F})),Ai(re)==="array"&&re.length===0&&Q.push(new ct(W.key,re,"array must have at least one stop")),Q},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:n,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return c==="identity"&&T&&D.push(new ct(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||D.push(new ct(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!Gc(s.valueSpec)&&D.push(new ct(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(C&&!Bs(s.valueSpec)?D.push(new ct(s.key,s.value,"property functions not supported")):T&&!Lh(s.valueSpec)&&D.push(new ct(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!A||s.value.property!==void 0||D.push(new ct(s.key,s.value,'"property" property is required')),D;function F(W){let Q=[];const re=W.value,_e=W.key;if(Ai(re)!=="array")return[new ct(_e,re,`array expected, ${Ai(re)} found`)];if(re.length!==2)return[new ct(_e,re,`array length 2 expected, length ${re.length} found`)];if(A){if(Ai(re[0])!=="object")return[new ct(_e,re,`object expected, ${Ai(re[0])} found`)];if(re[0].zoom===void 0)return[new ct(_e,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new ct(_e,re,"object stop key must have value")];if(w&&w>En(re[0].zoom))return[new ct(_e,re[0].zoom,"stop zoom values must appear in ascending order")];En(re[0].zoom)!==w&&(w=En(re[0].zoom),_=void 0,x={}),Q=Q.concat(jr({key:`${_e}[0]`,value:re[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Kc,value:U}}))}else Q=Q.concat(U({key:`${_e}[0]`,value:re[0],valueSpec:{},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},re));return xl(ao(re[1]))?Q.concat([new ct(`${_e}[1]`,re[1],"expressions are not allowed in function stops.")]):Q.concat(W.validateSpec({key:`${_e}[1]`,value:re[1],valueSpec:n,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function U(W,Q){const re=Ai(W.value),_e=En(W.value),be=W.value!==null?W.value:Q;if(f){if(re!==f)return[new ct(W.key,be,`${re} stop domain type must match previous stop domain type ${f}`)]}else f=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new ct(W.key,be,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&c!=="categorical"){let Ze=`number expected, ${re} found`;return Bs(n)&&c===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(W.key,be,Ze)]}return c!=="categorical"||re!=="number"||isFinite(_e)&&Math.floor(_e)===_e?c!=="categorical"&&re==="number"&&_!==void 0&&_e<_?[new ct(W.key,be,"stop domain values must appear in ascending order")]:(_=_e,c==="categorical"&&_e in x?[new ct(W.key,be,"stop domain values must be unique")]:(x[_e]=!0,[])):[new ct(W.key,be,`integer expected, found ${_e}`)]}}function Vs(s){const n=(s.expressionContext==="property"?Wc:Ns)(ao(s.value),s.valueSpec);if(n.result==="error")return n.value.map(f=>new ct(`${s.key}${f.key}`,s.value,f.message));const c=n.value.expression||n.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new ct(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Rs(c))return[new ct(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!Rs(c))return[new ct(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!za(c,["zoom","feature-state"]))return[new ct(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Pa(c))return[new ct(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ro(s){const n=s.key,c=s.value,f=s.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(En(c))===-1&&_.push(new ct(n,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(En(c))===-1&&_.push(new ct(n,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Jc(s){return kl(ao(s.value))?Vs(tr({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cl(s)}function Cl(s){const n=s.value,c=s.key;if(Ai(n)!=="array")return[new ct(c,n,`array expected, ${Ai(n)} found`)];const f=s.styleSpec;let _,w=[];if(n.length<1)return[new ct(c,n,"filter array must have at least 1 element")];switch(w=w.concat(Ro({key:`${c}[0]`,value:n[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),En(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&En(n[1])==="$type"&&w.push(new ct(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&w.push(new ct(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=Ai(n[1]),_!=="string"&&w.push(new ct(`${c}[1]`,n[1],`string expected, ${_} found`)));for(let x=2;x<n.length;x++)_=Ai(n[x]),En(n[1])==="$type"?w=w.concat(Ro({key:`${c}[${x}]`,value:n[x],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&w.push(new ct(`${c}[${x}]`,n[x],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)w=w.concat(Cl({key:`${c}[${x}]`,value:n[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":_=Ai(n[1]),n.length!==2?w.push(new ct(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&w.push(new ct(`${c}[1]`,n[1],`string expected, ${_} found`))}return w}function Yc(s,n){const c=s.key,f=s.validateSpec,_=s.style,w=s.styleSpec,x=s.value,T=s.objectKey,C=w[`${n}_${s.layerType}`];if(!C)return[];const A=T.match(/^(.*)-transition$/);if(n==="paint"&&A&&C[A[1]]&&C[A[1]].transition)return f({key:c,value:x,valueSpec:w.transition,style:_,styleSpec:w});const D=s.valueSpec||C[T];if(!D)return[new ct(c,x,`unknown property "${T}"`)];let F;if(Ai(x)==="string"&&Bs(D)&&!D.tokens&&(F=/^{([^}]+)}$/.exec(x)))return[new ct(c,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const U=[];return s.layerType==="symbol"&&(T==="text-field"&&_&&!_.glyphs&&U.push(new ct(c,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&bl(ao(x))&&En(x.type)==="identity"&&U.push(new ct(c,x,'"text-font" does not support identity functions'))),U.concat(f({key:s.key,value:x,valueSpec:D,style:_,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:T}))}function El(s){return Yc(s,"paint")}function Qc(s){return Yc(s,"layout")}function eu(s){let n=[];const c=s.value,f=s.key,_=s.style,w=s.styleSpec;c.type||c.ref||n.push(new ct(f,c,'either "type" or "ref" is required'));let x=En(c.type);const T=En(c.ref);if(c.id){const C=En(c.id);for(let A=0;A<s.arrayIndex;A++){const D=_.layers[A];En(D.id)===C&&n.push(new ct(f,c.id,`duplicate layer id "${c.id}", previously used at line ${D.id.__line__}`))}}if("ref"in c){let C;["type","source","source-layer","filter","layout"].forEach(A=>{A in c&&n.push(new ct(f,c[A],`"${A}" is prohibited for ref layers`))}),_.layers.forEach(A=>{En(A.id)===T&&(C=A)}),C?C.ref?n.push(new ct(f,c.ref,"ref cannot reference another ref layer")):x=En(C.type):n.push(new ct(f,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const C=_.sources&&_.sources[c.source],A=C&&En(C.type);C?A==="vector"&&x==="raster"?n.push(new ct(f,c.source,`layer "${c.id}" requires a raster source`)):A!=="raster-dem"&&x==="hillshade"?n.push(new ct(f,c.source,`layer "${c.id}" requires a raster-dem source`)):A==="raster"&&x!=="raster"?n.push(new ct(f,c.source,`layer "${c.id}" requires a vector source`)):A!=="vector"||c["source-layer"]?A==="raster-dem"&&x!=="hillshade"?n.push(new ct(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||A==="geojson"&&C.lineMetrics||n.push(new ct(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new ct(f,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new ct(f,c.source,`source "${c.source}" not found`))}else n.push(new ct(f,c,'missing required property "source"'));return n=n.concat(jr({key:f,value:c,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:c.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Jc,layout:C=>jr({layer:c,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":A=>Qc(tr({layerType:x},A))}}),paint:C=>jr({layer:c,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":A=>El(tr({layerType:x},A))}})}})),n}function cs(s){const n=s.value,c=s.key,f=Ai(n);return f!=="string"?[new ct(c,n,`string expected, ${f} found`)]:[]}const Ll={promoteId:function({key:s,value:n}){if(Ai(n)==="string")return cs({key:s,value:n});{const c=[];for(const f in n)c.push(...cs({key:`${s}.${f}`,value:n[f]}));return c}}};function Oa(s){const n=s.value,c=s.key,f=s.styleSpec,_=s.style,w=s.validateSpec;if(!n.type)return[new ct(c,n,'"type" is required')];const x=En(n.type);let T;switch(x){case"vector":case"raster":return T=jr({key:c,value:n,valueSpec:f[`source_${x.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Ll,validateSpec:w}),T;case"raster-dem":return T=function(C){var A;const D=(A=C.sourceName)!==null&&A!==void 0?A:"",F=C.value,U=C.styleSpec,W=U.source_raster_dem,Q=C.style;let re=[];const _e=Ai(F);if(F===void 0)return re;if(_e!=="object")return re.push(new ct("source_raster_dem",F,`object expected, ${_e} found`)),re;const be=En(F.encoding)==="custom",Ze=["redFactor","greenFactor","blueFactor","baseShift"],Ae=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const Oe in F)!be&&Ze.includes(Oe)?re.push(new ct(Oe,F[Oe],`In "${D}": "${Oe}" is only valid when "encoding" is set to "custom". ${Ae} encoding found`)):W[Oe]?re=re.concat(C.validateSpec({key:Oe,value:F[Oe],valueSpec:W[Oe],validateSpec:C.validateSpec,style:Q,styleSpec:U})):re.push(new ct(Oe,F[Oe],`unknown property "${Oe}"`));return re}({sourceName:c,value:n,style:s.style,styleSpec:f,validateSpec:w}),T;case"geojson":if(T=jr({key:c,value:n,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:w,objectElementValidators:Ll}),n.cluster)for(const C in n.clusterProperties){const[A,D]=n.clusterProperties[C],F=typeof A=="string"?[A,["accumulated"],["get",C]]:A;T.push(...Vs({key:`${c}.${C}.map`,value:D,validateSpec:w,expressionContext:"cluster-map"})),T.push(...Vs({key:`${c}.${C}.reduce`,value:F,validateSpec:w,expressionContext:"cluster-reduce"}))}return T;case"video":return jr({key:c,value:n,valueSpec:f.source_video,style:_,validateSpec:w,styleSpec:f});case"image":return jr({key:c,value:n,valueSpec:f.source_image,style:_,validateSpec:w,styleSpec:f});case"canvas":return[new ct(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ro({key:`${c}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:w,styleSpec:f})}}function tu(s){const n=s.value,c=s.styleSpec,f=c.light,_=s.style;let w=[];const x=Ai(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new ct("light",n,`object expected, ${x} found`)]),w;for(const T in n){const C=T.match(/^(.*)-transition$/);w=w.concat(C&&f[C[1]]&&f[C[1]].transition?s.validateSpec({key:T,value:n[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:_,styleSpec:c}):f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)])}return w}function iu(s){const n=s.value,c=s.styleSpec,f=c.sky,_=s.style,w=Ai(n);if(n===void 0)return[];if(w!=="object")return[new ct("sky",n,`object expected, ${w} found`)];let x=[];for(const T in n)x=x.concat(f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)]);return x}function nu(s){const n=s.value,c=s.styleSpec,f=c.terrain,_=s.style;let w=[];const x=Ai(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new ct("terrain",n,`object expected, ${x} found`)]),w;for(const T in n)w=w.concat(f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)]);return w}function ru(s){let n=[];const c=s.value,f=s.key;if(Array.isArray(c)){const _=[],w=[];for(const x in c)c[x].id&&_.includes(c[x].id)&&n.push(new ct(f,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),_.push(c[x].id),c[x].url&&w.includes(c[x].url)&&n.push(new ct(f,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),w.push(c[x].url),n=n.concat(jr({key:`${f}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return n}return cs({key:f,value:c})}const Ml={"*":()=>[],array:Ba,boolean:function(s){const n=s.value,c=s.key,f=Ai(n);return f!=="boolean"?[new ct(c,n,`boolean expected, ${f} found`)]:[]},number:Kc,color:function(s){const n=s.key,c=s.value,f=Ai(c);return f!=="string"?[new ct(n,c,`color expected, ${f} found`)]:Zi.parse(String(c))?[]:[new ct(n,c,`color expected, "${c}" found`)]},constants:Fh,enum:Ro,filter:Jc,function:Il,layer:eu,object:jr,source:Oa,light:tu,sky:iu,terrain:nu,projection:function(s){const n=s.value,c=s.styleSpec,f=c.projection,_=s.style,w=Ai(n);if(n===void 0)return[];if(w!=="object")return[new ct("projection",n,`object expected, ${w} found`)];let x=[];for(const T in n)x=x.concat(f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)]);return x},string:cs,formatted:function(s){return cs(s).length===0?[]:Vs(s)},resolvedImage:function(s){return cs(s).length===0?[]:Vs(s)},padding:function(s){const n=s.key,c=s.value;if(Ai(c)==="array"){if(c.length<1||c.length>4)return[new ct(n,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let _=[];for(let w=0;w<c.length;w++)_=_.concat(s.validateSpec({key:`${n}[${w}]`,value:c[w],validateSpec:s.validateSpec,valueSpec:f}));return _}return Kc({key:n,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const n=s.key,c=s.value,f=Ai(c),_=s.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new ct(n,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<c.length;x+=2)w=w.concat(Ro({key:`${n}[${x}]`,value:c[x],valueSpec:_.layout_symbol["text-anchor"]})),w=w.concat(Ba({key:`${n}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:_}));return w},sprite:ru};function qs(s){const n=s.value,c=s.valueSpec,f=s.styleSpec;return s.validateSpec=qs,c.expression&&bl(En(n))?Il(s):c.expression&&xl(ao(n))?Vs(s):c.type&&Ml[c.type]?Ml[c.type](s):jr(tr({},s,{valueSpec:c.type?f[c.type]:c}))}function Bh(s){const n=s.value,c=s.key,f=cs(s);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new ct(c,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new ct(c,n,'"glyphs" url must include a "{range}" token'))),f}function Jr(s,n=Te){let c=[];return c=c.concat(qs({key:"",value:s,valueSpec:n.$root,styleSpec:n,style:s,validateSpec:qs,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),s.constants&&(c=c.concat(Fh({key:"constants",value:s.constants,style:s,styleSpec:n,validateSpec:qs}))),ou(c)}function xo(s){return function(n){return s({...n,validateSpec:qs})}}function ou(s){return[].concat(s).sort((n,c)=>n.line-c.line)}function lo(s){return function(...n){return ou(s.apply(this,n))}}Jr.source=lo(xo(Oa)),Jr.sprite=lo(xo(ru)),Jr.glyphs=lo(xo(Bh)),Jr.light=lo(xo(tu)),Jr.sky=lo(xo(iu)),Jr.terrain=lo(xo(nu)),Jr.layer=lo(xo(eu)),Jr.filter=lo(xo(Jc)),Jr.paintProperty=lo(xo(El)),Jr.layoutProperty=lo(xo(Qc));const us=Jr,cf=us.light,uf=us.sky,Oh=us.paintProperty,Nh=us.layoutProperty;function su(s,n){let c=!1;if(n&&n.length)for(const f of n)s.fire(new qe(new Error(f.message))),c=!0;return c}class Zs{constructor(n,c,f){const _=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(c=x[1])+2*(f=x[2]);for(let C=0;C<this.d*this.d;C++){const A=x[3+C],D=x[3+C+1];_.push(A===D?null:x.subarray(A,D))}const T=x[3+_.length+1];this.keys=x.subarray(x[3+_.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let x=0;x<this.d*this.d;x++)_.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=f,this.scale=c/n,this.uid=0;const w=f/c*n;this.min=-w,this.max=n+w}insert(n,c,f,_,w){this._forEachCell(c,f,_,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,c,f,_,w,x){this.cells[w].push(x)}query(n,c,f,_,w){const x=this.min,T=this.max;if(n<=x&&c<=x&&T<=f&&T<=_&&!w)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(n,c,f,_,this._queryCell,C,{},w),C}}_queryCell(n,c,f,_,w,x,T,C){const A=this.cells[w];if(A!==null){const D=this.keys,F=this.bboxes;for(let U=0;U<A.length;U++){const W=A[U];if(T[W]===void 0){const Q=4*W;(C?C(F[Q+0],F[Q+1],F[Q+2],F[Q+3]):n<=F[Q+2]&&c<=F[Q+3]&&f>=F[Q+0]&&_>=F[Q+1])?(T[W]=!0,x.push(D[W])):T[W]=!1}}}}_forEachCell(n,c,f,_,w,x,T,C){const A=this._convertToCellCoord(n),D=this._convertToCellCoord(c),F=this._convertToCellCoord(f),U=this._convertToCellCoord(_);for(let W=A;W<=F;W++)for(let Q=D;Q<=U;Q++){const re=this.d*Q+W;if((!C||C(this._convertFromCellCoord(W),this._convertFromCellCoord(Q),this._convertFromCellCoord(W+1),this._convertFromCellCoord(Q+1)))&&w.call(this,n,c,f,_,re,x,T,C))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,c=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const _=new Int32Array(c+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let w=c;for(let x=0;x<n.length;x++){const T=n[x];_[3+x]=w,_.set(T,w),w+=T.length}return _[3+n.length]=w,_.set(this.keys,w),w+=this.keys.length,_[3+n.length+1]=w,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer}static serialize(n,c){const f=n.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(n){return new Zs(n.buffer)}}const Yr={};function zt(s,n,c={}){if(Yr[s])throw new Error(`${s} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:s,writeable:!1}),Yr[s]={klass:n,omit:c.omit||[],shallow:c.shallow||[]}}zt("Object",Object),zt("TransferableGridIndex",Zs),zt("Color",Zi),zt("Error",Error),zt("AJAXError",li),zt("ResolvedImage",Nr),zt("StylePropertyFunction",$s),zt("StyleExpression",wl,{omit:["_evaluator"]}),zt("ZoomDependentExpression",Us),zt("ZoomConstantExpression",js),zt("CompoundExpression",Kr,{omit:["_evaluate"]});for(const s in Ds)Ds[s]._classRegistryKey||zt(`Expression_${s}`,Ds[s]);function Al(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function au(s){return s.$name||s.constructor._classRegistryKey}function jh(s){return!function(n){if(n===null||typeof n!="object")return!1;const c=au(n);return!(!c||c==="Object")}(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Al(s)||it(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function Gs(s,n){if(jh(s))return(Al(s)||it(s))&&n&&n.push(s),ArrayBuffer.isView(s)&&n&&n.push(s.buffer),s instanceof ImageData&&n&&n.push(s.data.buffer),s;if(Array.isArray(s)){const w=[];for(const x of s)w.push(Gs(x,n));return w}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const c=au(s);if(!c)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!Yr[c])throw new Error(`${c} is not registered.`);const{klass:f}=Yr[c],_=f.serialize?f.serialize(s,n):{};if(f.serialize){if(n&&_===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||Yr[c].omit.indexOf(w)>=0)continue;const x=s[w];_[w]=Yr[c].shallow.indexOf(w)>=0?x:Gs(x,n)}s instanceof Error&&(_.message=s.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(_.$name=c),_}function Ws(s){if(jh(s))return s;if(Array.isArray(s))return s.map(Ws);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const n=au(s)||"Object";if(!Yr[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:c}=Yr[n];if(!c)throw new Error(`can't deserialize unregistered class ${n}`);if(c.deserialize)return c.deserialize(s);const f=Object.create(c.prototype);for(const _ of Object.keys(s)){if(_==="$name")continue;const w=s[_];f[_]=Yr[n].shallow.indexOf(_)>=0?w:Ws(w)}return f}class lu{constructor(){this.first=!0}update(n,c){const f=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=f,!0))}}const Si={"Latin-1 Supplement":s=>s>=128&&s<=255,"Hangul Jamo":s=>s>=4352&&s<=4607,Khmer:s=>s>=6016&&s<=6143,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Katakana:s=>s>=12448&&s<=12543,Kanbun:s=>s>=12688&&s<=12703,"CJK Strokes":s=>s>=12736&&s<=12783,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"Private Use Area":s=>s>=57344&&s<=63743,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function cu(s){for(const n of s)if(hu(n.charCodeAt(0)))return!0;return!1}function hf(s){for(const n of s)if(!Hs(n.charCodeAt(0)))return!1;return!0}function uu(s){const n=s.map(c=>{try{return new RegExp(`\\p{sc=${c}}`,"u").source}catch{return null}}).filter(c=>c);return new RegExp(n.join("|"),"u")}const df=uu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Hs(s){return!df.test(String.fromCodePoint(s))}const Uh=uu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function hu(s){return!(s!==746&&s!==747&&(s<4352||!(Si["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Si["CJK Compatibility"](s)||Si["CJK Strokes"](s)||!(!Si["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Si["Enclosed CJK Letters and Months"](s)||Si["Ideographic Description Characters"](s)||Si.Kanbun(s)||Si.Katakana(s)&&s!==12540||!(!Si["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Si["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Si["Vertical Forms"](s)||Si["Yijing Hexagram Symbols"](s)||/\p{sc=Cans}/u.test(String.fromCodePoint(s))||/\p{sc=Hang}/u.test(String.fromCodePoint(s))||Uh.test(String.fromCodePoint(s)))))}function $h(s){return!(hu(s)||function(n){return!!(Si["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Si["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Si["Letterlike Symbols"](n)||Si["Number Forms"](n)||Si["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Si["Control Pictures"](n)&&n!==9251||Si["Optical Character Recognition"](n)||Si["Enclosed Alphanumerics"](n)||Si["Geometric Shapes"](n)||Si["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Si["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Si["CJK Symbols and Punctuation"](n)||Si.Katakana(n)||Si["Private Use Area"](n)||Si["CJK Compatibility Forms"](n)||Si["Small Form Variants"](n)||Si["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(s))}const ff=uu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function du(s){return ff.test(String.fromCodePoint(s))}function pf(s,n){return!(!n&&du(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Si.Khmer(s))}function mf(s){for(const n of s)if(du(n.charCodeAt(0)))return!0;return!1}const Ur=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class nn{constructor(n,c){this.zoom=n,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lu,this.transition={})}isSupportedScript(n){return function(c,f){for(const _ of c)if(!pf(_.charCodeAt(0),f))return!1;return!0}(n,Ur.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,c=n-Math.floor(n),f=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class Xs{constructor(n,c){this.property=n,this.value=c,this.expression=function(f,_){if(bl(f))return new $s(f,_);if(xl(f)){const w=Wc(f,_);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return _.type==="color"&&typeof f=="string"?w=Zi.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Xr.parse(f)):w=Or.parse(f),{kind:"constant",evaluate:()=>w}}}(c===void 0?n.specification.default:c,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,c,f){return this.property.possiblyEvaluate(this,n,c,f)}}class Pl{constructor(n){this.property=n,this.value=new Xs(n,void 0)}transitioned(n,c){return new Vh(this.property,this.value,c,Y({},n.transition,this.transition),n.now)}untransitioned(){return new Vh(this.property,this.value,null,{},0)}}class zl{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return ce(this._values[n].value.value)}setValue(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Pl(this._values[n].property)),this._values[n].value=new Xs(this._values[n].property,c===null?void 0:ce(c))}getTransition(n){return ce(this._values[n].transition)}setTransition(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Pl(this._values[n].property)),this._values[n].transition=ce(c)||void 0}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f);const _=this.getTransition(c);_!==void 0&&(n[`${c}-transition`]=_)}return n}transitioned(n,c){const f=new Na(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(n,c._values[_]);return f}untransitioned(){const n=new Na(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].untransitioned();return n}}class Vh{constructor(n,c,f,_,w){this.property=n,this.value=c,this.begin=w+_.delay||0,this.end=this.begin+_.duration||0,n.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(n,c,f){const _=n.now||0,w=this.value.possiblyEvaluate(n,c,f),x=this.prior;if(x){if(_>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(_<this.begin)return x.possiblyEvaluate(n,c,f);{const T=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(n,c,f),w,function(C){if(C<=0)return 0;if(C>=1)return 1;const A=C*C,D=A*C;return 4*(C<.5?D:3*(C-A)+D-.75)}(T))}}return w}}class Na{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,c,f){const _=new Ua(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(n,c,f);return _}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class ja{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return ce(this._values[n].value)}setValue(n,c){this._values[n]=new Xs(this._values[n].property,c===null?void 0:ce(c))}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f)}return n}possiblyEvaluate(n,c,f){const _=new Ua(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(n,c,f);return _}}class ko{constructor(n,c,f){this.property=n,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,c,f,_){return this.property.evaluate(this.value,this.parameters,n,c,f,_)}}class Ua{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Ot{constructor(n){this.specification=n}possiblyEvaluate(n,c){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(c)}interpolate(n,c,f){const _=xr[this.specification.type];return _?_(n,c,f):n}}class Yt{constructor(n,c){this.specification=n,this.overrides=c}possiblyEvaluate(n,c,f,_){return new ko(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(c,null,{},f,_)}:n.expression,c)}interpolate(n,c,f){if(n.value.kind!=="constant"||c.value.kind!=="constant")return n;if(n.value.value===void 0||c.value.value===void 0)return new ko(this,{kind:"constant",value:void 0},n.parameters);const _=xr[this.specification.type];if(_){const w=_(n.value.value,c.value.value,f);return new ko(this,{kind:"constant",value:w},n.parameters)}return n}evaluate(n,c,f,_,w,x){return n.kind==="constant"?n.value:n.evaluate(c,f,_,w,x)}}class Dl extends Yt{possiblyEvaluate(n,c,f,_){if(n.value===void 0)return new ko(this,{kind:"constant",value:void 0},c);if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,_),x=n.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,T=this._calculate(x,x,x,c);return new ko(this,{kind:"constant",value:T},c)}if(n.expression.kind==="camera"){const w=this._calculate(n.expression.evaluate({zoom:c.zoom-1}),n.expression.evaluate({zoom:c.zoom}),n.expression.evaluate({zoom:c.zoom+1}),c);return new ko(this,{kind:"constant",value:w},c)}return new ko(this,n.expression,c)}evaluate(n,c,f,_,w,x){if(n.kind==="source"){const T=n.evaluate(c,f,_,w,x);return this._calculate(T,T,T,c)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(c.zoom)-1},f,_),n.evaluate({zoom:Math.floor(c.zoom)},f,_),n.evaluate({zoom:Math.floor(c.zoom)+1},f,_),c):n.value}_calculate(n,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class Rl{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,_){if(n.value!==void 0){if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,_);return this._calculate(w,w,w,c)}return this._calculate(n.expression.evaluate(new nn(Math.floor(c.zoom-1),c)),n.expression.evaluate(new nn(Math.floor(c.zoom),c)),n.expression.evaluate(new nn(Math.floor(c.zoom+1),c)),c)}}_calculate(n,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class fu{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,_){return!!n.expression.evaluate(c,null,{},f,_)}interpolate(){return!1}}class b{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in n){const f=n[c];f.specification.overridable&&this.overridableProperties.push(c);const _=this.defaultPropertyValues[c]=new Xs(f,void 0),w=this.defaultTransitionablePropertyValues[c]=new Pl(f);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=_.possiblyEvaluate({})}}}zt("DataDrivenProperty",Yt),zt("DataConstantProperty",Ot),zt("CrossFadedDataDrivenProperty",Dl),zt("CrossFadedProperty",Rl),zt("ColorRampProperty",fu);const i="-transition";class h extends st{constructor(n,c){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),c.layout&&(this._unevaluatedLayout=new ja(c.layout)),c.paint)){this._transitionablePaint=new zl(c.paint);for(const f in n.paint)this.setPaintProperty(f,n.paint[f],{validate:!1});for(const f in n.layout)this.setLayoutProperty(f,n.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ua(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,c,f={}){c!=null&&this._validate(Nh,`layers.${this.id}.layout.${n}`,n,c,f)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,c):this.visibility=c)}getPaintProperty(n){return n.endsWith(i)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,c,f={}){if(c!=null&&this._validate(Oh,`layers.${this.id}.paint.${n}`,n,c,f))return!1;if(n.endsWith(i))return this._transitionablePaint.setTransition(n.slice(0,-11),c||void 0),!1;{const _=this._transitionablePaint._values[n],w=_.property.specification["property-type"]==="cross-faded-data-driven",x=_.value.isDataDriven(),T=_.value;this._transitionablePaint.setValue(n,c),this._handleSpecialPaintPropertyUpdate(n);const C=this._transitionablePaint._values[n].value;return C.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(n,T,C)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,c,f){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,c){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,c)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),fe(n,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(n,c,f,_,w={}){return(!w||w.validate!==!1)&&su(this,n.call(us,{key:c,layerType:this.type,objectKey:f,value:_,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const c=this.paint.get(n);if(c instanceof ko&&Bs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(n,c){this._structArray=n,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,c){return n._trim(),c&&(n.isTransferred=!0,c.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const c=Object.create(this.prototype);return c.arrayBuffer=n.arrayBuffer,c.length=n.length,c.capacity=n.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function I(s,n=1){let c=0,f=0;return{members:s.map(_=>{const w=p[_.type].BYTES_PER_ELEMENT,x=c=L(c,Math.max(n,w)),T=_.components||1;return f=Math.max(f,w),c+=w*T,{name:_.name,type:_.type,components:T,offset:x}}),size:L(c,Math.max(f,n)),alignment:n}}function L(s,n){return Math.ceil(s/n)*n}class M extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const _=2*n;return this.int16[_+0]=c,this.int16[_+1]=f,n}}M.prototype.bytesPerElement=4,zt("StructArrayLayout2i4",M);class R extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=_,n}}R.prototype.bytesPerElement=6,zt("StructArrayLayout3i6",R);class O extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,_)}emplace(n,c,f,_,w){const x=4*n;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=_,this.int16[x+3]=w,n}}O.prototype.bytesPerElement=8,zt("StructArrayLayout4i8",O);class N extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=6*n;return this.int16[C+0]=c,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=T,n}}N.prototype.bytesPerElement=12,zt("StructArrayLayout2i4i12",N);class J extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=4*n,A=8*n;return this.int16[C+0]=c,this.int16[C+1]=f,this.uint8[A+4]=_,this.uint8[A+5]=w,this.uint8[A+6]=x,this.uint8[A+7]=T,n}}J.prototype.bytesPerElement=8,zt("StructArrayLayout2i4ub8",J);class oe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const _=2*n;return this.float32[_+0]=c,this.float32[_+1]=f,n}}oe.prototype.bytesPerElement=8,zt("StructArrayLayout2f8",oe);class he extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,D){const F=this.length;return this.resize(F+1),this.emplace(F,n,c,f,_,w,x,T,C,A,D)}emplace(n,c,f,_,w,x,T,C,A,D,F){const U=10*n;return this.uint16[U+0]=c,this.uint16[U+1]=f,this.uint16[U+2]=_,this.uint16[U+3]=w,this.uint16[U+4]=x,this.uint16[U+5]=T,this.uint16[U+6]=C,this.uint16[U+7]=A,this.uint16[U+8]=D,this.uint16[U+9]=F,n}}he.prototype.bytesPerElement=20,zt("StructArrayLayout10ui20",he);class ge extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,D,F,U){const W=this.length;return this.resize(W+1),this.emplace(W,n,c,f,_,w,x,T,C,A,D,F,U)}emplace(n,c,f,_,w,x,T,C,A,D,F,U,W){const Q=12*n;return this.int16[Q+0]=c,this.int16[Q+1]=f,this.int16[Q+2]=_,this.int16[Q+3]=w,this.uint16[Q+4]=x,this.uint16[Q+5]=T,this.uint16[Q+6]=C,this.uint16[Q+7]=A,this.int16[Q+8]=D,this.int16[Q+9]=F,this.int16[Q+10]=U,this.int16[Q+11]=W,n}}ge.prototype.bytesPerElement=24,zt("StructArrayLayout4i4ui4i24",ge);class ve extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,n}}ve.prototype.bytesPerElement=12,zt("StructArrayLayout3f12",ve);class ke extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint32[1*n+0]=c,n}}ke.prototype.bytesPerElement=4,zt("StructArrayLayout1ul4",ke);class Ee extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A){const D=this.length;return this.resize(D+1),this.emplace(D,n,c,f,_,w,x,T,C,A)}emplace(n,c,f,_,w,x,T,C,A,D){const F=10*n,U=5*n;return this.int16[F+0]=c,this.int16[F+1]=f,this.int16[F+2]=_,this.int16[F+3]=w,this.int16[F+4]=x,this.int16[F+5]=T,this.uint32[U+3]=C,this.uint16[F+8]=A,this.uint16[F+9]=D,n}}Ee.prototype.bytesPerElement=20,zt("StructArrayLayout6i1ul2ui20",Ee);class me extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=6*n;return this.int16[C+0]=c,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=T,n}}me.prototype.bytesPerElement=12,zt("StructArrayLayout2i2i2i12",me);class De extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w){const x=this.length;return this.resize(x+1),this.emplace(x,n,c,f,_,w)}emplace(n,c,f,_,w,x){const T=4*n,C=8*n;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=_,this.int16[C+6]=w,this.int16[C+7]=x,n}}De.prototype.bytesPerElement=16,zt("StructArrayLayout2f1f2i16",De);class Be extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=16*n,A=4*n,D=8*n;return this.uint8[C+0]=c,this.uint8[C+1]=f,this.float32[A+1]=_,this.float32[A+2]=w,this.int16[D+6]=x,this.int16[D+7]=T,n}}Be.prototype.bytesPerElement=16,zt("StructArrayLayout2ub2f2i16",Be);class He extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.uint16[w+0]=c,this.uint16[w+1]=f,this.uint16[w+2]=_,n}}He.prototype.bytesPerElement=6,zt("StructArrayLayout3ui6",He);class ot extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,D,F,U,W,Q,re,_e,be){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,n,c,f,_,w,x,T,C,A,D,F,U,W,Q,re,_e,be)}emplace(n,c,f,_,w,x,T,C,A,D,F,U,W,Q,re,_e,be,Ze){const Ae=24*n,Oe=12*n,Je=48*n;return this.int16[Ae+0]=c,this.int16[Ae+1]=f,this.uint16[Ae+2]=_,this.uint16[Ae+3]=w,this.uint32[Oe+2]=x,this.uint32[Oe+3]=T,this.uint32[Oe+4]=C,this.uint16[Ae+10]=A,this.uint16[Ae+11]=D,this.uint16[Ae+12]=F,this.float32[Oe+7]=U,this.float32[Oe+8]=W,this.uint8[Je+36]=Q,this.uint8[Je+37]=re,this.uint8[Je+38]=_e,this.uint32[Oe+10]=be,this.int16[Ae+22]=Ze,n}}ot.prototype.bytesPerElement=48,zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ot);class vt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,D,F,U,W,Q,re,_e,be,Ze,Ae,Oe,Je,_t,Mt,Kt,Ct,Tt,$t,Rt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,n,c,f,_,w,x,T,C,A,D,F,U,W,Q,re,_e,be,Ze,Ae,Oe,Je,_t,Mt,Kt,Ct,Tt,$t,Rt)}emplace(n,c,f,_,w,x,T,C,A,D,F,U,W,Q,re,_e,be,Ze,Ae,Oe,Je,_t,Mt,Kt,Ct,Tt,$t,Rt,Pt){const tt=32*n,Zt=16*n;return this.int16[tt+0]=c,this.int16[tt+1]=f,this.int16[tt+2]=_,this.int16[tt+3]=w,this.int16[tt+4]=x,this.int16[tt+5]=T,this.int16[tt+6]=C,this.int16[tt+7]=A,this.uint16[tt+8]=D,this.uint16[tt+9]=F,this.uint16[tt+10]=U,this.uint16[tt+11]=W,this.uint16[tt+12]=Q,this.uint16[tt+13]=re,this.uint16[tt+14]=_e,this.uint16[tt+15]=be,this.uint16[tt+16]=Ze,this.uint16[tt+17]=Ae,this.uint16[tt+18]=Oe,this.uint16[tt+19]=Je,this.uint16[tt+20]=_t,this.uint16[tt+21]=Mt,this.uint16[tt+22]=Kt,this.uint32[Zt+12]=Ct,this.float32[Zt+13]=Tt,this.float32[Zt+14]=$t,this.uint16[tt+30]=Rt,this.uint16[tt+31]=Pt,n}}vt.prototype.bytesPerElement=64,zt("StructArrayLayout8i15ui1ul2f2ui64",vt);class It extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.float32[1*n+0]=c,n}}It.prototype.bytesPerElement=4,zt("StructArrayLayout1f4",It);class At extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.uint16[6*n+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,n}}At.prototype.bytesPerElement=12,zt("StructArrayLayout1ui2f12",At);class kt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=4*n;return this.uint32[2*n+0]=c,this.uint16[w+2]=f,this.uint16[w+3]=_,n}}kt.prototype.bytesPerElement=8,zt("StructArrayLayout1ul2ui8",kt);class xt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const _=2*n;return this.uint16[_+0]=c,this.uint16[_+1]=f,n}}xt.prototype.bytesPerElement=4,zt("StructArrayLayout2ui4",xt);class Nt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint16[1*n+0]=c,n}}Nt.prototype.bytesPerElement=2,zt("StructArrayLayout1ui2",Nt);class ri extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,_)}emplace(n,c,f,_,w){const x=4*n;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=_,this.float32[x+3]=w,n}}ri.prototype.bytesPerElement=16,zt("StructArrayLayout4f16",ri);class St extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}St.prototype.size=20;class Lt extends Ee{get(n){return new St(this,n)}}zt("CollisionBoxArray",Lt);class ti extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ti.prototype.size=48;class rn extends ot{get(n){return new ti(this,n)}}zt("PlacedSymbolArray",rn);class fi extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}fi.prototype.size=64;class xi extends vt{get(n){return new fi(this,n)}}zt("SymbolInstanceArray",xi);class on extends It{getoffsetX(n){return this.float32[1*n+0]}}zt("GlyphOffsetArray",on);class nr extends R{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}zt("SymbolLineVertexArray",nr);class co extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}co.prototype.size=12;class sn extends At{get(n){return new co(this,n)}}zt("TextAnchorOffsetArray",sn);class Sr extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Sr.prototype.size=8;class pr extends kt{get(n){return new Sr(this,n)}}zt("FeatureIndexArray",pr);class rr extends M{}class mr extends M{}class So extends M{}class Ks extends N{}class Fl extends J{}class Js extends oe{}class Qr extends he{}class Bl extends ge{}class pu extends ve{}class eo extends ke{}class to extends me{}class Go extends Be{}class uo extends He{}class Jn extends xt{}const or=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:$r}=or;class Ti{constructor(n=[]){this.segments=n}prepareSegment(n,c,f,_){let w=this.segments[this.segments.length-1];return n>Ti.MAX_VERTEX_ARRAY_LENGTH&&Ge(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!w||w.vertexLength+n>Ti.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==_)&&(w={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},_!==void 0&&(w.sortKey=_),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const n of this.segments)for(const c in n.vaos)n.vaos[c].destroy()}static simpleSegment(n,c,f,_){return new Ti([{vertexOffset:n,primitiveOffset:c,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function hs(s,n){return 256*(s=xe(Math.floor(s),0,255))+xe(Math.floor(n),0,255)}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt("SegmentVector",Ti);const Ys=I([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Qs={exports:{}},qh={exports:{}};qh.exports=function(s,n){var c,f,_,w,x,T,C,A;for(f=s.length-(c=3&s.length),_=n,x=3432918353,T=461845907,A=0;A<f;)C=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24,++A,_=27492+(65535&(w=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(C=0,c){case 3:C^=(255&s.charCodeAt(A+2))<<16;case 2:C^=(255&s.charCodeAt(A+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&s.charCodeAt(A)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var _f=qh.exports,Zh={exports:{}};Zh.exports=function(s,n){for(var c,f=s.length,_=n^f,w=0;f>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(c>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:_^=(255&s.charCodeAt(w+2))<<16;case 2:_^=(255&s.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var Wo=_f,Gh=Zh.exports;Qs.exports=Wo,Qs.exports.murmur3=Wo,Qs.exports.murmur2=Gh;var Ol=g(Qs.exports);class $a{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,c,f,_){this.ids.push(Nl(n)),this.positions.push(c,f,_)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Nl(n);let f=0,_=this.ids.length-1;for(;f<_;){const x=f+_>>1;this.ids[x]>=c?_=x:f=x+1}const w=[];for(;this.ids[f]===c;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(n,c){const f=new Float64Array(n.ids),_=new Uint32Array(n.positions);return jl(f,_,0,f.length-1),c&&c.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(n){const c=new $a;return c.ids=n.ids,c.positions=n.positions,c.indexed=!0,c}}function Nl(s){const n=+s;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Ol(String(s))}function jl(s,n,c,f){for(;c<f;){const _=s[c+f>>1];let w=c-1,x=f+1;for(;;){do w++;while(s[w]<_);do x--;while(s[x]>_);if(w>=x)break;ea(s,w,x),ea(n,3*w,3*x),ea(n,3*w+1,3*x+1),ea(n,3*w+2,3*x+2)}x-c<f-x?(jl(s,n,c,x),c=x+1):(jl(s,n,x+1,f),f=x)}}function ea(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}zt("FeaturePositionMap",$a);class Va{constructor(n,c){this.gl=n.gl,this.location=c}}class Wh extends Va{constructor(n,c){super(n,c),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class rm extends Va{constructor(n,c){super(n,c),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class om extends Va{constructor(n,c){super(n,c),this.current=Zi.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const $1=new Float32Array(16);function gf(s){return[hs(255*s.r,255*s.g),hs(255*s.b,255*s.a)]}class mu{constructor(n,c,f){this.value=n,this.uniformNames=c.map(_=>`u_${_}`),this.type=f}setUniform(n,c,f){n.set(f.constantOr(this.value))}getBinding(n,c,f){return this.type==="color"?new om(n,c):new Wh(n,c)}}class Ul{constructor(n,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=n.tlbr}setUniform(n,c,f,_){const w=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&n.set(w)}getBinding(n,c,f){return f.substr(0,9)==="u_pattern"?new rm(n,c):new Wh(n,c)}}class ds{constructor(n,c,f,_){this.expression=n,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,c,f,_,w){const x=this.paintVertexArray.length,T=this.expression.evaluate(new nn(0),c,{},_,[],w);this.paintVertexArray.resize(n),this._setPaintValue(x,n,T)}updatePaintArray(n,c,f,_){const w=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(n,c,w)}_setPaintValue(n,c,f){if(this.type==="color"){const _=gf(f);for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,_[0],_[1])}else{for(let _=n;_<c;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fo{constructor(n,c,f,_,w,x){this.expression=n,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(n,c,f,_,w){const x=this.expression.evaluate(new nn(this.zoom),c,{},_,[],w),T=this.expression.evaluate(new nn(this.zoom+1),c,{},_,[],w),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,x,T)}updatePaintArray(n,c,f,_){const w=this.expression.evaluate({zoom:this.zoom},f,_),x=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(n,c,w,x)}_setPaintValue(n,c,f,_){if(this.type==="color"){const w=gf(f),x=gf(_);for(let T=n;T<c;T++)this.paintVertexArray.emplace(T,w[0],w[1],x[0],x[1])}else{for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,_=xe(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(_)}getBinding(n,c,f){return new Wh(n,c)}}class ta{constructor(n,c,f,_,w,x){this.expression=n,this.type=c,this.useIntegerZoom=f,this.zoom=_,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(n,c,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(_,n,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(n,c,f,_,w){this._setPaintValues(n,c,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(n,c,f,_){if(!_||!f)return;const{min:w,mid:x,max:T}=f,C=_[w],A=_[x],D=_[T];if(C&&A&&D)for(let F=n;F<c;F++)this.zoomInPaintVertexArray.emplace(F,A.tl[0],A.tl[1],A.br[0],A.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],A.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,A.tl[0],A.tl[1],A.br[0],A.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],A.pixelRatio,D.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Ys.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Ys.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class sm{constructor(n,c,f){this.binders={},this._buffers=[];const _=[];for(const w in n.paint._values){if(!f(w))continue;const x=n.paint.get(w);if(!(x instanceof ko&&Bs(x.property.specification)))continue;const T=V1(w,n.type),C=x.value,A=x.property.specification.type,D=x.property.useIntegerZoom,F=x.property.specification["property-type"],U=F==="cross-faded"||F==="cross-faded-data-driven";if(C.kind==="constant")this.binders[w]=U?new Ul(C.value,T):new mu(C.value,T,A),_.push(`/u_${w}`);else if(C.kind==="source"||U){const W=am(w,A,"source");this.binders[w]=U?new ta(C,A,D,c,W,n.id):new ds(C,T,A,W),_.push(`/a_${w}`)}else{const W=am(w,A,"composite");this.binders[w]=new Fo(C,T,A,D,c,W),_.push(`/z_${w}`)}}this.cacheKey=_.sort().join("")}getMaxValue(n){const c=this.binders[n];return c instanceof ds||c instanceof Fo?c.maxValue:0}populatePaintArrays(n,c,f,_,w){for(const x in this.binders){const T=this.binders[x];(T instanceof ds||T instanceof Fo||T instanceof ta)&&T.populatePaintArray(n,c,f,_,w)}}setConstantPatternPositions(n,c){for(const f in this.binders){const _=this.binders[f];_ instanceof Ul&&_.setConstantPatternPositions(n,c)}}updatePaintArrays(n,c,f,_,w){let x=!1;for(const T in n){const C=c.getPositions(T);for(const A of C){const D=f.feature(A.index);for(const F in this.binders){const U=this.binders[F];if((U instanceof ds||U instanceof Fo||U instanceof ta)&&U.expression.isStateDependent===!0){const W=_.paint.get(F);U.expression=W.value,U.updatePaintArray(A.start,A.end,D,n[T],w),x=!0}}}}return x}defines(){const n=[];for(const c in this.binders){const f=this.binders[c];(f instanceof mu||f instanceof Ul)&&n.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return n}getBinderAttributes(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ds||f instanceof Fo)for(let _=0;_<f.paintVertexAttributes.length;_++)n.push(f.paintVertexAttributes[_].name);else if(f instanceof ta)for(let _=0;_<Ys.members.length;_++)n.push(Ys.members[_].name)}return n}getBinderUniforms(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof mu||f instanceof Ul||f instanceof Fo)for(const _ of f.uniformNames)n.push(_)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,c){const f=[];for(const _ in this.binders){const w=this.binders[_];if(w instanceof mu||w instanceof Ul||w instanceof Fo){for(const x of w.uniformNames)if(c[x]){const T=w.getBinding(n,c[x],x);f.push({name:x,property:_,binding:T})}}}return f}setUniforms(n,c,f,_){for(const{name:w,property:x,binding:T}of c)this.binders[x].setUniform(T,_,f.get(x),w)}updatePaintBuffers(n){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(n&&f instanceof ta){const _=n.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof ds||f instanceof Fo)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(n){for(const c in this.binders){const f=this.binders[c];(f instanceof ds||f instanceof Fo||f instanceof ta)&&f.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const c=this.binders[n];(c instanceof ds||c instanceof Fo||c instanceof ta)&&c.destroy()}}}class qa{constructor(n,c,f=()=>!0){this.programConfigurations={};for(const _ of n)this.programConfigurations[_.id]=new sm(_,c,f);this.needsUpload=!1,this._featureMap=new $a,this._bufferOffset=0}populatePaintArrays(n,c,f,_,w,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,c,_,w,x);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,c,f,_){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(n,this._featureMap,c,w,_)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function V1(s,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${n}-`,"").replace(/-/g,"_")]}function am(s,n,c){const f={color:{source:oe,composite:ri},number:{source:It,composite:oe}},_=function(w){return{"line-pattern":{source:Qr,composite:Qr},"fill-pattern":{source:Qr,composite:Qr},"fill-extrusion-pattern":{source:Qr,composite:Qr}}[w]}(s);return _&&_[c]||f[n][c]}zt("ConstantBinder",mu),zt("CrossFadedConstantBinder",Ul),zt("SourceExpressionBinder",ds),zt("CrossFadedCompositeBinder",ta),zt("CompositeExpressionBinder",Fo),zt("ProgramConfiguration",sm,{omit:["_buffers"]}),zt("ProgramConfigurationSet",qa);const Fn=8192,yf=Math.pow(2,14)-1,lm=-yf-1;function Za(s){const n=Fn/s.extent,c=s.loadGeometry();for(let f=0;f<c.length;f++){const _=c[f];for(let w=0;w<_.length;w++){const x=_[w],T=Math.round(x.x*n),C=Math.round(x.y*n);x.x=xe(T,lm,yf),x.y=xe(C,lm,yf),(T<x.x||T>x.x+1||C<x.y||C>x.y+1)&&Ge("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function Ga(s,n){return{type:s.type,id:s.id,properties:s.properties,geometry:n?Za(s):[]}}function Hh(s,n,c,f,_){s.emplaceBack(2*n+(f+1)/2,2*c+(_+1)/2)}class bf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new mr,this.indexArray=new uo,this.segments=new Ti,this.programConfigurations=new qa(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){const _=this.layers[0],w=[];let x=null,T=!1;_.type==="circle"&&(x=_.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:C,id:A,index:D,sourceLayerIndex:F}of n){const U=this.layers[0]._featureFilter.needGeometry,W=Ga(C,U);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),W,f))continue;const Q=T?x.evaluate(W,{},f):void 0,re={id:A,properties:C.properties,type:C.type,sourceLayerIndex:F,index:D,geometry:U?W.geometry:Za(C),patterns:{},sortKey:Q};w.push(re)}T&&w.sort((C,A)=>C.sortKey-A.sortKey);for(const C of w){const{geometry:A,index:D,sourceLayerIndex:F}=C,U=n[D].feature;this.addFeature(C,A,D,f),c.featureIndex.insert(U,A,D,F,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,$r),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,c,f,_){for(const w of c)for(const x of w){const T=x.x,C=x.y;if(T<0||T>=Fn||C<0||C>=Fn)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),D=A.vertexLength;Hh(this.layoutVertexArray,T,C,-1,-1),Hh(this.layoutVertexArray,T,C,1,-1),Hh(this.layoutVertexArray,T,C,1,1),Hh(this.layoutVertexArray,T,C,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,{},_)}}function cm(s,n){for(let c=0;c<s.length;c++)if($l(n,s[c]))return!0;for(let c=0;c<n.length;c++)if($l(s,n[c]))return!0;return!!vf(s,n)}function q1(s,n,c){return!!$l(s,n)||!!wf(n,s,c)}function um(s,n){if(s.length===1)return dm(n,s[0]);for(let c=0;c<n.length;c++){const f=n[c];for(let _=0;_<f.length;_++)if($l(s,f[_]))return!0}for(let c=0;c<s.length;c++)if(dm(n,s[c]))return!0;for(let c=0;c<n.length;c++)if(vf(s,n[c]))return!0;return!1}function Z1(s,n,c){if(s.length>1){if(vf(s,n))return!0;for(let f=0;f<n.length;f++)if(wf(n[f],s,c))return!0}for(let f=0;f<s.length;f++)if(wf(s[f],n,c))return!0;return!1}function vf(s,n){if(s.length===0||n.length===0)return!1;for(let c=0;c<s.length-1;c++){const f=s[c],_=s[c+1];for(let w=0;w<n.length-1;w++)if(G1(f,_,n[w],n[w+1]))return!0}return!1}function G1(s,n,c,f){return Le(s,c,f)!==Le(n,c,f)&&Le(s,n,c)!==Le(s,n,f)}function wf(s,n,c){const f=c*c;if(n.length===1)return s.distSqr(n[0])<f;for(let _=1;_<n.length;_++)if(hm(s,n[_-1],n[_])<f)return!0;return!1}function hm(s,n,c){const f=n.distSqr(c);if(f===0)return s.distSqr(n);const _=((s.x-n.x)*(c.x-n.x)+(s.y-n.y)*(c.y-n.y))/f;return s.distSqr(_<0?n:_>1?c:c.sub(n)._mult(_)._add(n))}function dm(s,n){let c,f,_,w=!1;for(let x=0;x<s.length;x++){c=s[x];for(let T=0,C=c.length-1;T<c.length;C=T++)f=c[T],_=c[C],f.y>n.y!=_.y>n.y&&n.x<(_.x-f.x)*(n.y-f.y)/(_.y-f.y)+f.x&&(w=!w)}return w}function $l(s,n){let c=!1;for(let f=0,_=s.length-1;f<s.length;_=f++){const w=s[f],x=s[_];w.y>n.y!=x.y>n.y&&n.x<(x.x-w.x)*(n.y-w.y)/(x.y-w.y)+w.x&&(c=!c)}return c}function W1(s,n,c){const f=c[0],_=c[2];if(s.x<f.x&&n.x<f.x||s.x>_.x&&n.x>_.x||s.y<f.y&&n.y<f.y||s.y>_.y&&n.y>_.y)return!1;const w=Le(s,n,c[0]);return w!==Le(s,n,c[1])||w!==Le(s,n,c[2])||w!==Le(s,n,c[3])}function _u(s,n,c){const f=n.paint.get(s).value;return f.kind==="constant"?f.value:c.programConfigurations.get(n.id).getMaxValue(s)}function Xh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Kh(s,n,c,f,_){if(!n[0]&&!n[1])return s;const w=S.convert(n)._mult(_);c==="viewport"&&w._rotate(-f);const x=[];for(let T=0;T<s.length;T++)x.push(s[T].sub(w));return x}let fm,pm;zt("CircleBucket",bf,{omit:["layers"]});var H1={get paint(){return pm=pm||new b({"circle-radius":new Yt(Te.paint_circle["circle-radius"]),"circle-color":new Yt(Te.paint_circle["circle-color"]),"circle-blur":new Yt(Te.paint_circle["circle-blur"]),"circle-opacity":new Yt(Te.paint_circle["circle-opacity"]),"circle-translate":new Ot(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return fm=fm||new b({"circle-sort-key":new Yt(Te.layout_circle["circle-sort-key"])})}},Tr=1e-6,Vl=typeof Float32Array<"u"?Float32Array:Array;function xf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function mm(s,n,c){var f=n[0],_=n[1],w=n[2],x=n[3],T=n[4],C=n[5],A=n[6],D=n[7],F=n[8],U=n[9],W=n[10],Q=n[11],re=n[12],_e=n[13],be=n[14],Ze=n[15],Ae=c[0],Oe=c[1],Je=c[2],_t=c[3];return s[0]=Ae*f+Oe*T+Je*F+_t*re,s[1]=Ae*_+Oe*C+Je*U+_t*_e,s[2]=Ae*w+Oe*A+Je*W+_t*be,s[3]=Ae*x+Oe*D+Je*Q+_t*Ze,s[4]=(Ae=c[4])*f+(Oe=c[5])*T+(Je=c[6])*F+(_t=c[7])*re,s[5]=Ae*_+Oe*C+Je*U+_t*_e,s[6]=Ae*w+Oe*A+Je*W+_t*be,s[7]=Ae*x+Oe*D+Je*Q+_t*Ze,s[8]=(Ae=c[8])*f+(Oe=c[9])*T+(Je=c[10])*F+(_t=c[11])*re,s[9]=Ae*_+Oe*C+Je*U+_t*_e,s[10]=Ae*w+Oe*A+Je*W+_t*be,s[11]=Ae*x+Oe*D+Je*Q+_t*Ze,s[12]=(Ae=c[12])*f+(Oe=c[13])*T+(Je=c[14])*F+(_t=c[15])*re,s[13]=Ae*_+Oe*C+Je*U+_t*_e,s[14]=Ae*w+Oe*A+Je*W+_t*be,s[15]=Ae*x+Oe*D+Je*Q+_t*Ze,s}Math.hypot||(Math.hypot=function(){for(var s=0,n=arguments.length;n--;)s+=arguments[n]*arguments[n];return Math.sqrt(s)});var gu,X1=mm;function Jh(s,n,c){var f=n[0],_=n[1],w=n[2],x=n[3];return s[0]=c[0]*f+c[4]*_+c[8]*w+c[12]*x,s[1]=c[1]*f+c[5]*_+c[9]*w+c[13]*x,s[2]=c[2]*f+c[6]*_+c[10]*w+c[14]*x,s[3]=c[3]*f+c[7]*_+c[11]*w+c[15]*x,s}gu=new Vl(4),Vl!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0,gu[3]=0);class K1 extends h{constructor(n){super(n,H1)}createBucket(n){return new bf(n)}queryRadius(n){const c=n;return _u("circle-radius",this,c)+_u("circle-stroke-width",this,c)+Xh(this.paint.get("circle-translate"))}queryIntersectsFeature(n,c,f,_,w,x,T,C){const A=Kh(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,T),D=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),F=this.paint.get("circle-pitch-alignment")==="map",U=F?A:function(Q,re){return Q.map(_e=>_m(_e,re))}(A,C),W=F?D*T:D;for(const Q of _)for(const re of Q){const _e=F?re:_m(re,C);let be=W;const Ze=Jh([],[re.x,re.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?be*=Ze[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(be*=x.cameraToCenterDistance/Ze[3]),q1(U,_e,be))return!0}return!1}}function _m(s,n){const c=Jh([],[s.x,s.y,0,1],n);return new S(c[0]/c[3],c[1]/c[3])}class gm extends bf{}let ym;zt("HeatmapBucket",gm,{omit:["layers"]});var J1={get paint(){return ym=ym||new b({"heatmap-radius":new Yt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fu(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(Te.paint_heatmap["heatmap-opacity"])})}};function kf(s,{width:n,height:c},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==n*c*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${n*c*f}`)}else _=new Uint8Array(n*c*f);return s.width=n,s.height=c,s.data=_,s}function bm(s,{width:n,height:c},f){if(n===s.width&&c===s.height)return;const _=kf({},{width:n,height:c},f);Sf(s,_,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,n),height:Math.min(s.height,c)},f),s.width=n,s.height=c,s.data=_.data}function Sf(s,n,c,f,_,w){if(_.width===0||_.height===0)return n;if(_.width>s.width||_.height>s.height||c.x>s.width-_.width||c.y>s.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>n.width||_.height>n.height||f.x>n.width-_.width||f.y>n.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,T=n.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<_.height;C++){const A=((c.y+C)*s.width+c.x)*w,D=((f.y+C)*n.width+f.x)*w;for(let F=0;F<_.width*w;F++)T[D+F]=x[A+F]}return n}class yu{constructor(n,c){kf(this,n,1,c)}resize(n){bm(this,n,1)}clone(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,_,w){Sf(n,c,f,_,w,1)}}class ho{constructor(n,c){kf(this,n,4,c)}resize(n){bm(this,n,4)}replace(n,c){c?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,_,w){Sf(n,c,f,_,w,4)}}function vm(s){const n={},c=s.resolution||256,f=s.clips?s.clips.length:1,_=s.image||new ho({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(x,T,C)=>{n[s.evaluationKey]=C;const A=s.expression.evaluate(n);_.data[x+T+0]=Math.floor(255*A.r/A.a),_.data[x+T+1]=Math.floor(255*A.g/A.a),_.data[x+T+2]=Math.floor(255*A.b/A.a),_.data[x+T+3]=Math.floor(255*A.a)};if(s.clips)for(let x=0,T=0;x<f;++x,T+=4*c)for(let C=0,A=0;C<c;C++,A+=4){const D=C/(c-1),{start:F,end:U}=s.clips[x];w(T,A,F*(1-D)+U*D)}else for(let x=0,T=0;x<c;x++,T+=4)w(0,T,x/(c-1));return _}zt("AlphaImage",yu),zt("RGBAImage",ho);const Tf="big-fb";class Y1 extends h{createBucket(n){return new gm(n)}constructor(n){super(n,J1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Tf)&&this.heatmapFbos.delete(Tf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wm;var Q1={get paint(){return wm=wm||new b({"hillshade-illumination-direction":new Ot(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(Te.paint_hillshade["hillshade-accent-color"])})}};class eb extends h{constructor(n){super(n,Q1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const tb=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:ib}=tb;function xm(s,n,c=2){const f=n&&n.length,_=f?n[0]*c:s.length;let w=km(s,0,_,c,!0);const x=[];if(!w||w.next===w.prev)return x;let T,C,A;if(f&&(w=function(D,F,U,W){const Q=[];for(let re=0,_e=F.length;re<_e;re++){const be=km(D,F[re]*W,re<_e-1?F[re+1]*W:D.length,W,!1);be===be.next&&(be.steiner=!0),Q.push(ub(be))}Q.sort(ab);for(let re=0;re<Q.length;re++)U=lb(Q[re],U);return U}(s,n,w,c)),s.length>80*c){T=1/0,C=1/0;let D=-1/0,F=-1/0;for(let U=c;U<_;U+=c){const W=s[U],Q=s[U+1];W<T&&(T=W),Q<C&&(C=Q),W>D&&(D=W),Q>F&&(F=Q)}A=Math.max(D-T,F-C),A=A!==0?32767/A:0}return bu(w,x,c,T,C,A,0),x}function km(s,n,c,f,_){let w;if(_===function(x,T,C,A){let D=0;for(let F=T,U=C-A;F<C;F+=A)D+=(x[U]-x[F])*(x[F+1]+x[U+1]),U=F;return D}(s,n,c,f)>0)for(let x=n;x<c;x+=f)w=Im(x/f|0,s[x],s[x+1],w);else for(let x=c-f;x>=n;x-=f)w=Im(x/f|0,s[x],s[x+1],w);return w&&Yh(w,w.next)&&(wu(w),w=w.next),w}function Wa(s,n){if(!s)return s;n||(n=s);let c,f=s;do if(c=!1,f.steiner||!Yh(f,f.next)&&zn(f.prev,f,f.next)!==0)f=f.next;else{if(wu(f),f=n=f.prev,f===f.next)break;c=!0}while(c||f!==n);return n}function bu(s,n,c,f,_,w,x){if(!s)return;!x&&w&&function(C,A,D,F){let U=C;do U.z===0&&(U.z=If(U.x,U.y,A,D,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==C);U.prevZ.nextZ=null,U.prevZ=null,function(W){let Q,re=1;do{let _e,be=W;W=null;let Ze=null;for(Q=0;be;){Q++;let Ae=be,Oe=0;for(let _t=0;_t<re&&(Oe++,Ae=Ae.nextZ,Ae);_t++);let Je=re;for(;Oe>0||Je>0&&Ae;)Oe!==0&&(Je===0||!Ae||be.z<=Ae.z)?(_e=be,be=be.nextZ,Oe--):(_e=Ae,Ae=Ae.nextZ,Je--),Ze?Ze.nextZ=_e:W=_e,_e.prevZ=Ze,Ze=_e;be=Ae}Ze.nextZ=null,re*=2}while(Q>1)}(U)}(s,f,_,w);let T=s;for(;s.prev!==s.next;){const C=s.prev,A=s.next;if(w?rb(s,f,_,w):nb(s))n.push(C.i,s.i,A.i),wu(s),s=A.next,T=A.next;else if((s=A)===T){x?x===1?bu(s=ob(Wa(s),n),n,c,f,_,w,2):x===2&&sb(s,n,c,f,_,w):bu(Wa(s),n,c,f,_,w,1);break}}}function nb(s){const n=s.prev,c=s,f=s.next;if(zn(n,c,f)>=0)return!1;const _=n.x,w=c.x,x=f.x,T=n.y,C=c.y,A=f.y,D=_<w?_<x?_:x:w<x?w:x,F=T<C?T<A?T:A:C<A?C:A,U=_>w?_>x?_:x:w>x?w:x,W=T>C?T>A?T:A:C>A?C:A;let Q=f.next;for(;Q!==n;){if(Q.x>=D&&Q.x<=U&&Q.y>=F&&Q.y<=W&&ql(_,T,w,C,x,A,Q.x,Q.y)&&zn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function rb(s,n,c,f){const _=s.prev,w=s,x=s.next;if(zn(_,w,x)>=0)return!1;const T=_.x,C=w.x,A=x.x,D=_.y,F=w.y,U=x.y,W=T<C?T<A?T:A:C<A?C:A,Q=D<F?D<U?D:U:F<U?F:U,re=T>C?T>A?T:A:C>A?C:A,_e=D>F?D>U?D:U:F>U?F:U,be=If(W,Q,n,c,f),Ze=If(re,_e,n,c,f);let Ae=s.prevZ,Oe=s.nextZ;for(;Ae&&Ae.z>=be&&Oe&&Oe.z<=Ze;){if(Ae.x>=W&&Ae.x<=re&&Ae.y>=Q&&Ae.y<=_e&&Ae!==_&&Ae!==x&&ql(T,D,C,F,A,U,Ae.x,Ae.y)&&zn(Ae.prev,Ae,Ae.next)>=0||(Ae=Ae.prevZ,Oe.x>=W&&Oe.x<=re&&Oe.y>=Q&&Oe.y<=_e&&Oe!==_&&Oe!==x&&ql(T,D,C,F,A,U,Oe.x,Oe.y)&&zn(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Ae&&Ae.z>=be;){if(Ae.x>=W&&Ae.x<=re&&Ae.y>=Q&&Ae.y<=_e&&Ae!==_&&Ae!==x&&ql(T,D,C,F,A,U,Ae.x,Ae.y)&&zn(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.prevZ}for(;Oe&&Oe.z<=Ze;){if(Oe.x>=W&&Oe.x<=re&&Oe.y>=Q&&Oe.y<=_e&&Oe!==_&&Oe!==x&&ql(T,D,C,F,A,U,Oe.x,Oe.y)&&zn(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function ob(s,n){let c=s;do{const f=c.prev,_=c.next.next;!Yh(f,_)&&Sm(f,c,c.next,_)&&vu(f,_)&&vu(_,f)&&(n.push(f.i,c.i,_.i),wu(c),wu(c.next),c=s=_),c=c.next}while(c!==s);return Wa(c)}function sb(s,n,c,f,_,w){let x=s;do{let T=x.next.next;for(;T!==x.prev;){if(x.i!==T.i&&hb(x,T)){let C=Tm(x,T);return x=Wa(x,x.next),C=Wa(C,C.next),bu(x,n,c,f,_,w,0),void bu(C,n,c,f,_,w,0)}T=T.next}x=x.next}while(x!==s)}function ab(s,n){return s.x-n.x}function lb(s,n){const c=function(_,w){let x=w;const T=_.x,C=_.y;let A,D=-1/0;do{if(C<=x.y&&C>=x.next.y&&x.next.y!==x.y){const re=x.x+(C-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(re<=T&&re>D&&(D=re,A=x.x<x.next.x?x:x.next,re===T))return A}x=x.next}while(x!==w);if(!A)return null;const F=A,U=A.x,W=A.y;let Q=1/0;x=A;do{if(T>=x.x&&x.x>=U&&T!==x.x&&ql(C<W?T:D,C,U,W,C<W?D:T,C,x.x,x.y)){const re=Math.abs(C-x.y)/(T-x.x);vu(x,_)&&(re<Q||re===Q&&(x.x>A.x||x.x===A.x&&cb(A,x)))&&(A=x,Q=re)}x=x.next}while(x!==F);return A}(s,n);if(!c)return n;const f=Tm(c,s);return Wa(f,f.next),Wa(c,c.next)}function cb(s,n){return zn(s.prev,s,n.prev)<0&&zn(n.next,s,s.next)<0}function If(s,n,c,f,_){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-f)*_|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function ub(s){let n=s,c=s;do(n.x<c.x||n.x===c.x&&n.y<c.y)&&(c=n),n=n.next;while(n!==s);return c}function ql(s,n,c,f,_,w,x,T){return(_-x)*(n-T)>=(s-x)*(w-T)&&(s-x)*(f-T)>=(c-x)*(n-T)&&(c-x)*(w-T)>=(_-x)*(f-T)}function hb(s,n){return s.next.i!==n.i&&s.prev.i!==n.i&&!function(c,f){let _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==f.i&&_.next.i!==f.i&&Sm(_,_.next,c,f))return!0;_=_.next}while(_!==c);return!1}(s,n)&&(vu(s,n)&&vu(n,s)&&function(c,f){let _=c,w=!1;const x=(c.x+f.x)/2,T=(c.y+f.y)/2;do _.y>T!=_.next.y>T&&_.next.y!==_.y&&x<(_.next.x-_.x)*(T-_.y)/(_.next.y-_.y)+_.x&&(w=!w),_=_.next;while(_!==c);return w}(s,n)&&(zn(s.prev,s,n.prev)||zn(s,n.prev,n))||Yh(s,n)&&zn(s.prev,s,s.next)>0&&zn(n.prev,n,n.next)>0)}function zn(s,n,c){return(n.y-s.y)*(c.x-n.x)-(n.x-s.x)*(c.y-n.y)}function Yh(s,n){return s.x===n.x&&s.y===n.y}function Sm(s,n,c,f){const _=ed(zn(s,n,c)),w=ed(zn(s,n,f)),x=ed(zn(c,f,s)),T=ed(zn(c,f,n));return _!==w&&x!==T||!(_!==0||!Qh(s,c,n))||!(w!==0||!Qh(s,f,n))||!(x!==0||!Qh(c,s,f))||!(T!==0||!Qh(c,n,f))}function Qh(s,n,c){return n.x<=Math.max(s.x,c.x)&&n.x>=Math.min(s.x,c.x)&&n.y<=Math.max(s.y,c.y)&&n.y>=Math.min(s.y,c.y)}function ed(s){return s>0?1:s<0?-1:0}function vu(s,n){return zn(s.prev,s,s.next)<0?zn(s,n,s.next)>=0&&zn(s,s.prev,n)>=0:zn(s,n,s.prev)<0||zn(s,s.next,n)<0}function Tm(s,n){const c=Cf(s.i,s.x,s.y),f=Cf(n.i,n.x,n.y),_=s.next,w=n.prev;return s.next=n,n.prev=s,c.next=_,_.prev=c,f.next=c,c.prev=f,w.next=f,f.prev=w,f}function Im(s,n,c,f){const _=Cf(s,n,c);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function wu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Cf(s,n,c){return{i:s,x:n,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ef(s,n,c){const f=c.patternDependencies;let _=!1;for(const w of n){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(_=!0);const T=x.constantOr(null);T&&(_=!0,f[T.to]=!0,f[T.from]=!0)}return _}function Lf(s,n,c,f,_){const w=_.patternDependencies;for(const x of n){const T=x.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:f-1},c,{},_.availableImages),A=T.evaluate({zoom:f},c,{},_.availableImages),D=T.evaluate({zoom:f+1},c,{},_.availableImages);C=C&&C.name?C.name:C,A=A&&A.name?A.name:A,D=D&&D.name?D.name:D,w[C]=!0,w[A]=!0,w[D]=!0,c.patterns[x.id]={min:C,mid:A,max:D}}}return c}class Mf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new So,this.indexArray=new uo,this.indexArray2=new Jn,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=Ef("fill",this.layers,c);const _=this.layers[0].layout.get("fill-sort-key"),w=!_.isConstant(),x=[];for(const{feature:T,id:C,index:A,sourceLayerIndex:D}of n){const F=this.layers[0]._featureFilter.needGeometry,U=Ga(T,F);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),U,f))continue;const W=w?_.evaluate(U,{},f,c.availableImages):void 0,Q={id:C,properties:T.properties,type:T.type,sourceLayerIndex:D,index:A,geometry:F?U.geometry:Za(T),patterns:{},sortKey:W};x.push(Q)}w&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:A,sourceLayerIndex:D}=T;if(this.hasPattern){const F=Lf("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(T,C,A,f,{});c.featureIndex.insert(n[A].feature,C,A,D,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ib),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,c,f,_,w){for(const x of pl(c,500)){let T=0;for(const W of x)T+=W.length;const C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=C.vertexLength,D=[],F=[];for(const W of x){if(W.length===0)continue;W!==x[0]&&F.push(D.length/2);const Q=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),re=Q.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(re+W.length-1,re),D.push(W[0].x),D.push(W[0].y);for(let _e=1;_e<W.length;_e++)this.layoutVertexArray.emplaceBack(W[_e].x,W[_e].y),this.indexArray2.emplaceBack(re+_e-1,re+_e),D.push(W[_e].x),D.push(W[_e].y);Q.vertexLength+=W.length,Q.primitiveLength+=W.length}const U=xm(D,F);for(let W=0;W<U.length;W+=3)this.indexArray.emplaceBack(A+U[W],A+U[W+1],A+U[W+2]);C.vertexLength+=T,C.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,_)}}let Cm,Em;zt("FillBucket",Mf,{omit:["layers","patternFeatures"]});var db={get paint(){return Em=Em||new b({"fill-antialias":new Ot(Te.paint_fill["fill-antialias"]),"fill-opacity":new Yt(Te.paint_fill["fill-opacity"]),"fill-color":new Yt(Te.paint_fill["fill-color"]),"fill-outline-color":new Yt(Te.paint_fill["fill-outline-color"]),"fill-translate":new Ot(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dl(Te.paint_fill["fill-pattern"])})},get layout(){return Cm=Cm||new b({"fill-sort-key":new Yt(Te.layout_fill["fill-sort-key"])})}};class fb extends h{constructor(n){super(n,db)}recalculate(n,c){super.recalculate(n,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Mf(n)}queryRadius(){return Xh(this.paint.get("fill-translate"))}queryIntersectsFeature(n,c,f,_,w,x,T){return um(Kh(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,T),_)}isTileClipped(){return!0}}const pb=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),mb=I([{name:"a_centroid",components:2,type:"Int16"}],4),{members:_b}=pb;var ia={},gb=v,Lm=Zl;function Zl(s,n,c,f,_){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=_,s.readFields(yb,this,n)}function yb(s,n,c){s==1?n.id=c.readVarint():s==2?function(f,_){for(var w=f.readVarint()+f.pos;f.pos<w;){var x=_._keys[f.readVarint()],T=_._values[f.readVarint()];_.properties[x]=T}}(c,n):s==3?n.type=c.readVarint():s==4&&(n._geometry=c.pos)}function bb(s){for(var n,c,f=0,_=0,w=s.length,x=w-1;_<w;x=_++)f+=((c=s[x]).x-(n=s[_]).x)*(n.y+c.y);return f}Zl.types=["Unknown","Point","LineString","Polygon"],Zl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var n,c=s.readVarint()+s.pos,f=1,_=0,w=0,x=0,T=[];s.pos<c;){if(_<=0){var C=s.readVarint();f=7&C,_=C>>3}if(_--,f===1||f===2)w+=s.readSVarint(),x+=s.readSVarint(),f===1&&(n&&T.push(n),n=[]),n.push(new gb(w,x));else{if(f!==7)throw new Error("unknown command "+f);n&&n.push(n[0].clone())}}return n&&T.push(n),T},Zl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var n=s.readVarint()+s.pos,c=1,f=0,_=0,w=0,x=1/0,T=-1/0,C=1/0,A=-1/0;s.pos<n;){if(f<=0){var D=s.readVarint();c=7&D,f=D>>3}if(f--,c===1||c===2)(_+=s.readSVarint())<x&&(x=_),_>T&&(T=_),(w+=s.readSVarint())<C&&(C=w),w>A&&(A=w);else if(c!==7)throw new Error("unknown command "+c)}return[x,C,T,A]},Zl.prototype.toGeoJSON=function(s,n,c){var f,_,w=this.extent*Math.pow(2,c),x=this.extent*s,T=this.extent*n,C=this.loadGeometry(),A=Zl.types[this.type];function D(W){for(var Q=0;Q<W.length;Q++){var re=W[Q];W[Q]=[360*(re.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+T)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(f=0;f<C.length;f++)F[f]=C[f][0];D(C=F);break;case 2:for(f=0;f<C.length;f++)D(C[f]);break;case 3:for(C=function(W){var Q=W.length;if(Q<=1)return[W];for(var re,_e,be=[],Ze=0;Ze<Q;Ze++){var Ae=bb(W[Ze]);Ae!==0&&(_e===void 0&&(_e=Ae<0),_e===Ae<0?(re&&be.push(re),re=[W[Ze]]):re.push(W[Ze]))}return re&&be.push(re),be}(C),f=0;f<C.length;f++)for(_=0;_<C[f].length;_++)D(C[f][_])}C.length===1?C=C[0]:A="Multi"+A;var U={type:"Feature",geometry:{type:A,coordinates:C},properties:this.properties};return"id"in this&&(U.id=this.id),U};var vb=Lm,Mm=Am;function Am(s,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(wb,this,n),this.length=this._features.length}function wb(s,n,c){s===15?n.version=c.readVarint():s===1?n.name=c.readString():s===5?n.extent=c.readVarint():s===2?n._features.push(c.pos):s===3?n._keys.push(c.readString()):s===4&&n._values.push(function(f){for(var _=null,w=f.readVarint()+f.pos;f.pos<w;){var x=f.readVarint()>>3;_=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return _}(c))}Am.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var n=this._pbf.readVarint()+this._pbf.pos;return new vb(this._pbf,n,this.extent,this._keys,this._values)};var xb=Mm;function kb(s,n,c){if(s===3){var f=new xb(c,c.readVarint()+c.pos);f.length&&(n[f.name]=f)}}ia.VectorTile=function(s,n){this.layers=s.readFields(kb,{},n)},ia.VectorTileFeature=Lm,ia.VectorTileLayer=Mm;const Sb=ia.VectorTileFeature.types,Af=Math.pow(2,13);function xu(s,n,c,f,_,w,x,T){s.emplaceBack(n,c,2*Math.floor(f*Af)+x,_*Af*2,w*Af*2,Math.round(T))}class Pf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Ks,this.centroidVertexArray=new rr,this.indexArray=new uo,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.features=[],this.hasPattern=Ef("fill-extrusion",this.layers,c);for(const{feature:_,id:w,index:x,sourceLayerIndex:T}of n){const C=this.layers[0]._featureFilter.needGeometry,A=Ga(_,C);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),A,f))continue;const D={id:w,sourceLayerIndex:T,index:x,geometry:C?A.geometry:Za(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Lf("fill-extrusion",this.layers,D,this.zoom,c)):this.addFeature(D,D.geometry,x,f,{}),c.featureIndex.insert(_,D.geometry,x,T,this.index,!0)}}addFeatures(n,c,f){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,c,f)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,_b),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,mb.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,c,f,_,w){for(const x of pl(c,500)){const T={x:0,y:0,vertexCount:0};let C=0;for(const Q of x)C+=Q.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Q of x){if(Q.length===0||Ib(Q))continue;let re=0;for(let _e=0;_e<Q.length;_e++){const be=Q[_e];if(_e>=1){const Ze=Q[_e-1];if(!Tb(be,Ze)){A.vertexLength+4>Ti.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ae=be.sub(Ze)._perp()._unit(),Oe=Ze.dist(be);re+Oe>32768&&(re=0),xu(this.layoutVertexArray,be.x,be.y,Ae.x,Ae.y,0,0,re),xu(this.layoutVertexArray,be.x,be.y,Ae.x,Ae.y,0,1,re),T.x+=2*be.x,T.y+=2*be.y,T.vertexCount+=2,re+=Oe,xu(this.layoutVertexArray,Ze.x,Ze.y,Ae.x,Ae.y,0,0,re),xu(this.layoutVertexArray,Ze.x,Ze.y,Ae.x,Ae.y,0,1,re),T.x+=2*Ze.x,T.y+=2*Ze.y,T.vertexCount+=2;const Je=A.vertexLength;this.indexArray.emplaceBack(Je,Je+2,Je+1),this.indexArray.emplaceBack(Je+1,Je+2,Je+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+C>Ti.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),Sb[n.type]!=="Polygon")continue;const D=[],F=[],U=A.vertexLength;for(const Q of x)if(Q.length!==0){Q!==x[0]&&F.push(D.length/2);for(let re=0;re<Q.length;re++){const _e=Q[re];xu(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),T.x+=_e.x,T.y+=_e.y,T.vertexCount+=1,D.push(_e.x),D.push(_e.y)}}const W=xm(D,F);for(let Q=0;Q<W.length;Q+=3)this.indexArray.emplaceBack(U+W[Q],U+W[Q+2],U+W[Q+1]);A.primitiveLength+=W.length/3,A.vertexLength+=C;for(let Q=0;Q<T.vertexCount;Q++){const re=Math.floor(T.x/T.vertexCount),_e=Math.floor(T.y/T.vertexCount);this.centroidVertexArray.emplaceBack(re,_e)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,_)}}function Tb(s,n){return s.x===n.x&&(s.x<0||s.x>Fn)||s.y===n.y&&(s.y<0||s.y>Fn)}function Ib(s){return s.every(n=>n.x<0)||s.every(n=>n.x>Fn)||s.every(n=>n.y<0)||s.every(n=>n.y>Fn)}let Pm;zt("FillExtrusionBucket",Pf,{omit:["layers","features"]});var Cb={get paint(){return Pm=Pm||new b({"fill-extrusion-opacity":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dl(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Eb extends h{constructor(n){super(n,Cb)}createBucket(n){return new Pf(n)}queryRadius(){return Xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,c,f,_,w,x,T,C){const A=Kh(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,T),D=this.paint.get("fill-extrusion-height").evaluate(c,f),F=this.paint.get("fill-extrusion-base").evaluate(c,f),U=function(Q,re,_e,be){const Ze=[];for(const Ae of Q){const Oe=[Ae.x,Ae.y,0,1];Jh(Oe,Oe,re),Ze.push(new S(Oe[0]/Oe[3],Oe[1]/Oe[3]))}return Ze}(A,C),W=function(Q,re,_e,be){const Ze=[],Ae=[],Oe=be[8]*re,Je=be[9]*re,_t=be[10]*re,Mt=be[11]*re,Kt=be[8]*_e,Ct=be[9]*_e,Tt=be[10]*_e,$t=be[11]*_e;for(const Rt of Q){const Pt=[],tt=[];for(const Zt of Rt){const Ut=Zt.x,ii=Zt.y,Ji=be[0]*Ut+be[4]*ii+be[12],Xi=be[1]*Ut+be[5]*ii+be[13],Gn=be[2]*Ut+be[6]*ii+be[14],To=be[3]*Ut+be[7]*ii+be[15],ar=Gn+_t,Wn=To+Mt,Ir=Ji+Kt,Cr=Xi+Ct,Er=Gn+Tt,Ln=To+$t,Hn=new S((Ji+Oe)/Wn,(Xi+Je)/Wn);Hn.z=ar/Wn,Pt.push(Hn);const _r=new S(Ir/Ln,Cr/Ln);_r.z=Er/Ln,tt.push(_r)}Ze.push(Pt),Ae.push(tt)}return[Ze,Ae]}(_,F,D,C);return function(Q,re,_e){let be=1/0;um(_e,re)&&(be=zm(_e,re[0]));for(let Ze=0;Ze<re.length;Ze++){const Ae=re[Ze],Oe=Q[Ze];for(let Je=0;Je<Ae.length-1;Je++){const _t=Ae[Je],Mt=[_t,Ae[Je+1],Oe[Je+1],Oe[Je],_t];cm(_e,Mt)&&(be=Math.min(be,zm(_e,Mt)))}}return be!==1/0&&be}(W[0],W[1],U)}}function ku(s,n){return s.x*n.x+s.y*n.y}function zm(s,n){if(s.length===1){let c=0;const f=n[c++];let _;for(;!_||f.equals(_);)if(_=n[c++],!_)return 1/0;for(;c<n.length;c++){const w=n[c],x=s[0],T=_.sub(f),C=w.sub(f),A=x.sub(f),D=ku(T,T),F=ku(T,C),U=ku(C,C),W=ku(A,T),Q=ku(A,C),re=D*U-F*F,_e=(U*W-F*Q)/re,be=(D*Q-F*W)/re,Ze=f.z*(1-_e-be)+_.z*_e+w.z*be;if(isFinite(Ze))return Ze}return 1/0}{let c=1/0;for(const f of n)c=Math.min(c,f.z);return c}}const Lb=I([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Mb}=Lb,Ab=I([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Pb}=Ab,zb=ia.VectorTileFeature.types,Db=Math.cos(Math.PI/180*37.5),Dm=Math.pow(2,14)/.5;class zf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Fl,this.layoutVertexArray2=new Js,this.indexArray=new uo,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=Ef("line",this.layers,c);const _=this.layers[0].layout.get("line-sort-key"),w=!_.isConstant(),x=[];for(const{feature:T,id:C,index:A,sourceLayerIndex:D}of n){const F=this.layers[0]._featureFilter.needGeometry,U=Ga(T,F);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),U,f))continue;const W=w?_.evaluate(U,{},f):void 0,Q={id:C,properties:T.properties,type:T.type,sourceLayerIndex:D,index:A,geometry:F?U.geometry:Za(T),patterns:{},sortKey:W};x.push(Q)}w&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:A,sourceLayerIndex:D}=T;if(this.hasPattern){const F=Lf("line",this.layers,T,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(T,C,A,f,{});c.featureIndex.insert(n[A].feature,C,A,D,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,Pb)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Mb),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,c,f,_,w){const x=this.layers[0].layout,T=x.get("line-join").evaluate(n,{}),C=x.get("line-cap"),A=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const F of c)this.addLine(F,n,T,C,A,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,_)}addLine(n,c,f,_,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<n.length-1;be++)this.totalDistance+=n[be].dist(n[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=zb[c.type]==="Polygon";let C=n.length;for(;C>=2&&n[C-1].equals(n[C-2]);)C--;let A=0;for(;A<C-1&&n[A].equals(n[A+1]);)A++;if(C<(T?3:2))return;f==="bevel"&&(w=1.05);const D=this.overscaling<=16?15*Fn/(512*this.overscaling):0,F=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,W,Q,re,_e;this.e1=this.e2=-1,T&&(U=n[C-2],_e=n[A].sub(U)._unit()._perp());for(let be=A;be<C;be++){if(Q=be===C-1?T?n[A+1]:void 0:n[be+1],Q&&n[be].equals(Q))continue;_e&&(re=_e),U&&(W=U),U=n[be],_e=Q?Q.sub(U)._unit()._perp():re,re=re||_e;let Ze=re.add(_e);Ze.x===0&&Ze.y===0||Ze._unit();const Ae=re.x*_e.x+re.y*_e.y,Oe=Ze.x*_e.x+Ze.y*_e.y,Je=Oe!==0?1/Oe:1/0,_t=2*Math.sqrt(2-2*Oe),Mt=Oe<Db&&W&&Q,Kt=re.x*_e.y-re.y*_e.x>0;if(Mt&&be>A){const $t=U.dist(W);if($t>2*D){const Rt=U.sub(U.sub(W)._mult(D/$t)._round());this.updateDistance(W,Rt),this.addCurrentVertex(Rt,re,0,0,F),W=Rt}}const Ct=W&&Q;let Tt=Ct?f:T?"butt":_;if(Ct&&Tt==="round"&&(Je<x?Tt="miter":Je<=2&&(Tt="fakeround")),Tt==="miter"&&Je>w&&(Tt="bevel"),Tt==="bevel"&&(Je>2&&(Tt="flipbevel"),Je<w&&(Tt="miter")),W&&this.updateDistance(W,U),Tt==="miter")Ze._mult(Je),this.addCurrentVertex(U,Ze,0,0,F);else if(Tt==="flipbevel"){if(Je>100)Ze=_e.mult(-1);else{const $t=Je*re.add(_e).mag()/re.sub(_e).mag();Ze._perp()._mult($t*(Kt?-1:1))}this.addCurrentVertex(U,Ze,0,0,F),this.addCurrentVertex(U,Ze.mult(-1),0,0,F)}else if(Tt==="bevel"||Tt==="fakeround"){const $t=-Math.sqrt(Je*Je-1),Rt=Kt?$t:0,Pt=Kt?0:$t;if(W&&this.addCurrentVertex(U,re,Rt,Pt,F),Tt==="fakeround"){const tt=Math.round(180*_t/Math.PI/20);for(let Zt=1;Zt<tt;Zt++){let Ut=Zt/tt;if(Ut!==.5){const Ji=Ut-.5;Ut+=Ut*Ji*(Ut-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*Ji*Ji+(.848013+Ae*(.215638*Ae-1.06021)))}const ii=_e.sub(re)._mult(Ut)._add(re)._unit()._mult(Kt?-1:1);this.addHalfVertex(U,ii.x,ii.y,!1,Kt,0,F)}}Q&&this.addCurrentVertex(U,_e,-Rt,-Pt,F)}else if(Tt==="butt")this.addCurrentVertex(U,Ze,0,0,F);else if(Tt==="square"){const $t=W?1:-1;this.addCurrentVertex(U,Ze,$t,$t,F)}else Tt==="round"&&(W&&(this.addCurrentVertex(U,re,0,0,F),this.addCurrentVertex(U,re,1,1,F,!0)),Q&&(this.addCurrentVertex(U,_e,-1,-1,F,!0),this.addCurrentVertex(U,_e,0,0,F)));if(Mt&&be<C-1){const $t=U.dist(Q);if($t>2*D){const Rt=U.add(Q.sub(U)._mult(D/$t)._round());this.updateDistance(U,Rt),this.addCurrentVertex(Rt,_e,0,0,F),U=Rt}}}}addCurrentVertex(n,c,f,_,w,x=!1){const T=c.y*_-c.x,C=-c.y-c.x*_;this.addHalfVertex(n,c.x+c.y*f,c.y-c.x*f,x,!1,f,w),this.addHalfVertex(n,T,C,x,!0,-_,w),this.distance>Dm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,c,f,_,w,x))}addHalfVertex({x:n,y:c},f,_,w,x,T,C){const A=.5*(this.lineClips?this.scaledDistance*(Dm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(w?1:0),(c<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(T===0?0:T<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),C.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,c){this.distance+=n.dist(c),this.updateScaledDistance()}}let Rm,Fm;zt("LineBucket",zf,{omit:["layers","patternFeatures"]});var Bm={get paint(){return Fm=Fm||new b({"line-opacity":new Yt(Te.paint_line["line-opacity"]),"line-color":new Yt(Te.paint_line["line-color"]),"line-translate":new Ot(Te.paint_line["line-translate"]),"line-translate-anchor":new Ot(Te.paint_line["line-translate-anchor"]),"line-width":new Yt(Te.paint_line["line-width"]),"line-gap-width":new Yt(Te.paint_line["line-gap-width"]),"line-offset":new Yt(Te.paint_line["line-offset"]),"line-blur":new Yt(Te.paint_line["line-blur"]),"line-dasharray":new Rl(Te.paint_line["line-dasharray"]),"line-pattern":new Dl(Te.paint_line["line-pattern"]),"line-gradient":new fu(Te.paint_line["line-gradient"])})},get layout(){return Rm=Rm||new b({"line-cap":new Ot(Te.layout_line["line-cap"]),"line-join":new Yt(Te.layout_line["line-join"]),"line-miter-limit":new Ot(Te.layout_line["line-miter-limit"]),"line-round-limit":new Ot(Te.layout_line["line-round-limit"]),"line-sort-key":new Yt(Te.layout_line["line-sort-key"])})}};class Rb extends Yt{possiblyEvaluate(n,c){return c=new nn(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(n,c)}evaluate(n,c,f,_){return c=Y({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(n,c,f,_)}}let td;class Fb extends h{constructor(n){super(n,Bm),this.gradientVersion=0,td||(td=new Rb(Bm.paint.properties["line-width"].specification),td.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof As,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,c){super.recalculate(n,c),this.paint._values["line-floorwidth"]=td.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new zf(n)}queryRadius(n){const c=n,f=Om(_u("line-width",this,c),_u("line-gap-width",this,c)),_=_u("line-offset",this,c);return f/2+Math.abs(_)+Xh(this.paint.get("line-translate"))}queryIntersectsFeature(n,c,f,_,w,x,T){const C=Kh(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,T),A=T/2*Om(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),D=this.paint.get("line-offset").evaluate(c,f);return D&&(_=function(F,U){const W=[];for(let Q=0;Q<F.length;Q++){const re=F[Q],_e=[];for(let be=0;be<re.length;be++){const Ze=re[be-1],Ae=re[be],Oe=re[be+1],Je=be===0?new S(0,0):Ae.sub(Ze)._unit()._perp(),_t=be===re.length-1?new S(0,0):Oe.sub(Ae)._unit()._perp(),Mt=Je._add(_t)._unit(),Kt=Mt.x*_t.x+Mt.y*_t.y;Kt!==0&&Mt._mult(1/Kt),_e.push(Mt._mult(U)._add(Ae))}W.push(_e)}return W}(_,D*T)),function(F,U,W){for(let Q=0;Q<U.length;Q++){const re=U[Q];if(F.length>=3){for(let _e=0;_e<re.length;_e++)if($l(F,re[_e]))return!0}if(Z1(F,re,W))return!0}return!1}(C,_,A)}isTileClipped(){return!0}}function Om(s,n){return n>0?n+2*s:s}const Bb=I([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ob=I([{name:"a_projected_pos",components:3,type:"Float32"}],4);I([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Nb=I([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);I([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nm=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jb=I([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ub(s,n,c){return s.sections.forEach(f=>{f.text=function(_,w,x){const T=w.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?_=_.toLocaleUpperCase():T==="lowercase"&&(_=_.toLocaleLowerCase()),Ur.applyArabicShaping&&(_=Ur.applyArabicShaping(_)),_}(f.text,n,c)}),s}I([{name:"triangle",components:3,type:"Uint16"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),I([{type:"Float32",name:"offsetX"}]),I([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),I([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Su={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var jn=24,jm=Hi,Um=function(s,n,c,f,_){var w,x,T=8*_-f-1,C=(1<<T)-1,A=C>>1,D=-7,F=c?_-1:0,U=c?-1:1,W=s[n+F];for(F+=U,w=W&(1<<-D)-1,W>>=-D,D+=T;D>0;w=256*w+s[n+F],F+=U,D-=8);for(x=w&(1<<-D)-1,w>>=-D,D+=f;D>0;x=256*x+s[n+F],F+=U,D-=8);if(w===0)w=1-A;else{if(w===C)return x?NaN:1/0*(W?-1:1);x+=Math.pow(2,f),w-=A}return(W?-1:1)*x*Math.pow(2,w-f)},$m=function(s,n,c,f,_,w){var x,T,C,A=8*w-_-1,D=(1<<A)-1,F=D>>1,U=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=f?0:w-1,Q=f?1:-1,re=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,x=D):(x=Math.floor(Math.log(n)/Math.LN2),n*(C=Math.pow(2,-x))<1&&(x--,C*=2),(n+=x+F>=1?U/C:U*Math.pow(2,1-F))*C>=2&&(x++,C/=2),x+F>=D?(T=0,x=D):x+F>=1?(T=(n*C-1)*Math.pow(2,_),x+=F):(T=n*Math.pow(2,F-1)*Math.pow(2,_),x=0));_>=8;s[c+W]=255&T,W+=Q,T/=256,_-=8);for(x=x<<_|T,A+=_;A>0;s[c+W]=255&x,W+=Q,x/=256,A-=8);s[c+W-Q]|=128*re};function Hi(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Hi.Varint=0,Hi.Fixed64=1,Hi.Bytes=2,Hi.Fixed32=5;var Df=4294967296,Vm=1/Df,qm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function fs(s){return s.type===Hi.Bytes?s.readVarint()+s.pos:s.pos+1}function Gl(s,n,c){return c?4294967296*n+(s>>>0):4294967296*(n>>>0)+(s>>>0)}function Zm(s,n,c){var f=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));c.realloc(f);for(var _=c.pos-1;_>=s;_--)c.buf[_+f]=c.buf[_]}function $b(s,n){for(var c=0;c<s.length;c++)n.writeVarint(s[c])}function Vb(s,n){for(var c=0;c<s.length;c++)n.writeSVarint(s[c])}function qb(s,n){for(var c=0;c<s.length;c++)n.writeFloat(s[c])}function Zb(s,n){for(var c=0;c<s.length;c++)n.writeDouble(s[c])}function Gb(s,n){for(var c=0;c<s.length;c++)n.writeBoolean(s[c])}function Wb(s,n){for(var c=0;c<s.length;c++)n.writeFixed32(s[c])}function Hb(s,n){for(var c=0;c<s.length;c++)n.writeSFixed32(s[c])}function Xb(s,n){for(var c=0;c<s.length;c++)n.writeFixed64(s[c])}function Kb(s,n){for(var c=0;c<s.length;c++)n.writeSFixed64(s[c])}function id(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+16777216*s[n+3]}function Wl(s,n,c){s[c]=n,s[c+1]=n>>>8,s[c+2]=n>>>16,s[c+3]=n>>>24}function Gm(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+(s[n+3]<<24)}Hi.prototype={destroy:function(){this.buf=null},readFields:function(s,n,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),_=f>>3,w=this.pos;this.type=7&f,s(_,n,this),this.pos===w&&this.skip(f)}return n},readMessage:function(s,n){return this.readFields(s,n,this.readVarint()+this.pos)},readFixed32:function(){var s=id(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Gm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=id(this.buf,this.pos)+id(this.buf,this.pos+4)*Df;return this.pos+=8,s},readSFixed64:function(){var s=id(this.buf,this.pos)+Gm(this.buf,this.pos+4)*Df;return this.pos+=8,s},readFloat:function(){var s=Um(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Um(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var n,c,f=this.buf;return n=127&(c=f[this.pos++]),c<128?n:(n|=(127&(c=f[this.pos++]))<<7,c<128?n:(n|=(127&(c=f[this.pos++]))<<14,c<128?n:(n|=(127&(c=f[this.pos++]))<<21,c<128?n:function(_,w,x){var T,C,A=x.buf;if(T=(112&(C=A[x.pos++]))>>4,C<128||(T|=(127&(C=A[x.pos++]))<<3,C<128)||(T|=(127&(C=A[x.pos++]))<<10,C<128)||(T|=(127&(C=A[x.pos++]))<<17,C<128)||(T|=(127&(C=A[x.pos++]))<<24,C<128)||(T|=(1&(C=A[x.pos++]))<<31,C<128))return Gl(_,T,w);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(c=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,n=this.pos;return this.pos=s,s-n>=12&&qm?function(c,f,_){return qm.decode(c.subarray(f,_))}(this.buf,n,s):function(c,f,_){for(var w="",x=f;x<_;){var T,C,A,D=c[x],F=null,U=D>239?4:D>223?3:D>191?2:1;if(x+U>_)break;U===1?D<128&&(F=D):U===2?(192&(T=c[x+1]))==128&&(F=(31&D)<<6|63&T)<=127&&(F=null):U===3?(C=c[x+2],(192&(T=c[x+1]))==128&&(192&C)==128&&((F=(15&D)<<12|(63&T)<<6|63&C)<=2047||F>=55296&&F<=57343)&&(F=null)):U===4&&(C=c[x+2],A=c[x+3],(192&(T=c[x+1]))==128&&(192&C)==128&&(192&A)==128&&((F=(15&D)<<18|(63&T)<<12|(63&C)<<6|63&A)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,U=1):F>65535&&(F-=65536,w+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),w+=String.fromCharCode(F),x+=U}return w}(this.buf,n,s)},readBytes:function(){var s=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,s);return this.pos=s,n},readPackedVarint:function(s,n){if(this.type!==Hi.Bytes)return s.push(this.readVarint(n));var c=fs(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(n));return s},readPackedSVarint:function(s){if(this.type!==Hi.Bytes)return s.push(this.readSVarint());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Hi.Bytes)return s.push(this.readBoolean());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Hi.Bytes)return s.push(this.readFloat());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Hi.Bytes)return s.push(this.readDouble());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Hi.Bytes)return s.push(this.readFixed32());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Hi.Bytes)return s.push(this.readSFixed32());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Hi.Bytes)return s.push(this.readFixed64());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Hi.Bytes)return s.push(this.readSFixed64());var n=fs(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed64());return s},skip:function(s){var n=7&s;if(n===Hi.Varint)for(;this.buf[this.pos++]>127;);else if(n===Hi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Hi.Fixed32)this.pos+=4;else{if(n!==Hi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(s,n){this.writeVarint(s<<3|n)},realloc:function(s){for(var n=this.length||16;n<this.pos+s;)n*=2;if(n!==this.length){var c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Wl(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Wl(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Wl(this.buf,-1&s,this.pos),Wl(this.buf,Math.floor(s*Vm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Wl(this.buf,-1&s,this.pos),Wl(this.buf,Math.floor(s*Vm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(n,c){var f,_;if(n>=0?(f=n%4294967296|0,_=n/4294967296|0):(_=~(-n/4294967296),4294967295^(f=~(-n%4294967296))?f=f+1|0:(f=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(w,x,T){T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,T.buf[T.pos]=127&(w>>>=7)}(f,0,c),function(w,x){var T=(7&w)<<4;x.buf[x.pos++]|=T|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(_,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var n=this.pos;this.pos=function(f,_,w){for(var x,T,C=0;C<_.length;C++){if((x=_.charCodeAt(C))>55295&&x<57344){if(!T){x>56319||C+1===_.length?(f[w++]=239,f[w++]=191,f[w++]=189):T=x;continue}if(x<56320){f[w++]=239,f[w++]=191,f[w++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(f[w++]=239,f[w++]=191,f[w++]=189,T=null);x<128?f[w++]=x:(x<2048?f[w++]=x>>6|192:(x<65536?f[w++]=x>>12|224:(f[w++]=x>>18|240,f[w++]=x>>12&63|128),f[w++]=x>>6&63|128),f[w++]=63&x|128)}return w}(this.buf,s,this.pos);var c=this.pos-n;c>=128&&Zm(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),$m(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),$m(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var n=s.length;this.writeVarint(n),this.realloc(n);for(var c=0;c<n;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,n){this.pos++;var c=this.pos;s(n,this);var f=this.pos-c;f>=128&&Zm(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,n,c){this.writeTag(s,Hi.Bytes),this.writeRawMessage(n,c)},writePackedVarint:function(s,n){n.length&&this.writeMessage(s,$b,n)},writePackedSVarint:function(s,n){n.length&&this.writeMessage(s,Vb,n)},writePackedBoolean:function(s,n){n.length&&this.writeMessage(s,Gb,n)},writePackedFloat:function(s,n){n.length&&this.writeMessage(s,qb,n)},writePackedDouble:function(s,n){n.length&&this.writeMessage(s,Zb,n)},writePackedFixed32:function(s,n){n.length&&this.writeMessage(s,Wb,n)},writePackedSFixed32:function(s,n){n.length&&this.writeMessage(s,Hb,n)},writePackedFixed64:function(s,n){n.length&&this.writeMessage(s,Xb,n)},writePackedSFixed64:function(s,n){n.length&&this.writeMessage(s,Kb,n)},writeBytesField:function(s,n){this.writeTag(s,Hi.Bytes),this.writeBytes(n)},writeFixed32Field:function(s,n){this.writeTag(s,Hi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(s,n){this.writeTag(s,Hi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(s,n){this.writeTag(s,Hi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(s,n){this.writeTag(s,Hi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(s,n){this.writeTag(s,Hi.Varint),this.writeVarint(n)},writeSVarintField:function(s,n){this.writeTag(s,Hi.Varint),this.writeSVarint(n)},writeStringField:function(s,n){this.writeTag(s,Hi.Bytes),this.writeString(n)},writeFloatField:function(s,n){this.writeTag(s,Hi.Fixed32),this.writeFloat(n)},writeDoubleField:function(s,n){this.writeTag(s,Hi.Fixed64),this.writeDouble(n)},writeBooleanField:function(s,n){this.writeVarintField(s,!!n)}};var Rf=g(jm);const Ff=3;function Jb(s,n,c){s===1&&c.readMessage(Yb,n)}function Yb(s,n,c){if(s===3){const{id:f,bitmap:_,width:w,height:x,left:T,top:C,advance:A}=c.readMessage(Qb,{});n.push({id:f,bitmap:new yu({width:w+2*Ff,height:x+2*Ff},_),metrics:{width:w,height:x,left:T,top:C,advance:A}})}}function Qb(s,n,c){s===1?n.id=c.readVarint():s===2?n.bitmap=c.readBytes():s===3?n.width=c.readVarint():s===4?n.height=c.readVarint():s===5?n.left=c.readSVarint():s===6?n.top=c.readSVarint():s===7&&(n.advance=c.readVarint())}const Wm=Ff;function Hm(s){let n=0,c=0;for(const x of s)n+=x.w*x.h,c=Math.max(c,x.w);s.sort((x,T)=>T.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),c),h:1/0}];let _=0,w=0;for(const x of s)for(let T=f.length-1;T>=0;T--){const C=f[T];if(!(x.w>C.w||x.h>C.h)){if(x.x=C.x,x.y=C.y,w=Math.max(w,x.y+x.h),_=Math.max(_,x.x+x.w),x.w===C.w&&x.h===C.h){const A=f.pop();T<f.length&&(f[T]=A)}else x.h===C.h?(C.x+=x.w,C.w-=x.w):x.w===C.w?(C.y+=x.h,C.h-=x.h):(f.push({x:C.x+x.w,y:C.y,w:C.w-x.w,h:x.h}),C.y+=x.h,C.h-=x.h);break}}return{w:_,h:w,fill:n/(_*w)||0}}const Vr=1;class Bf{constructor(n,{pixelRatio:c,version:f,stretchX:_,stretchY:w,content:x,textFitWidth:T,textFitHeight:C}){this.paddedRect=n,this.pixelRatio=c,this.stretchX=_,this.stretchY=w,this.content=x,this.version=f,this.textFitWidth=T,this.textFitHeight=C}get tl(){return[this.paddedRect.x+Vr,this.paddedRect.y+Vr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vr,this.paddedRect.y+this.paddedRect.h-Vr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Vr)/this.pixelRatio,(this.paddedRect.h-2*Vr)/this.pixelRatio]}}class Xm{constructor(n,c){const f={},_={};this.haveRenderCallbacks=[];const w=[];this.addImages(n,f,w),this.addImages(c,_,w);const{w:x,h:T}=Hm(w),C=new ho({width:x||1,height:T||1});for(const A in n){const D=n[A],F=f[A].paddedRect;ho.copy(D.data,C,{x:0,y:0},{x:F.x+Vr,y:F.y+Vr},D.data)}for(const A in c){const D=c[A],F=_[A].paddedRect,U=F.x+Vr,W=F.y+Vr,Q=D.data.width,re=D.data.height;ho.copy(D.data,C,{x:0,y:0},{x:U,y:W},D.data),ho.copy(D.data,C,{x:0,y:re-1},{x:U,y:W-1},{width:Q,height:1}),ho.copy(D.data,C,{x:0,y:0},{x:U,y:W+re},{width:Q,height:1}),ho.copy(D.data,C,{x:Q-1,y:0},{x:U-1,y:W},{width:1,height:re}),ho.copy(D.data,C,{x:0,y:0},{x:U+Q,y:W},{width:1,height:re})}this.image=C,this.iconPositions=f,this.patternPositions=_}addImages(n,c,f){for(const _ in n){const w=n[_],x={x:0,y:0,w:w.data.width+2*Vr,h:w.data.height+2*Vr};f.push(x),c[_]=new Bf(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(n,c){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in n.updatedImages)this.patchUpdatedImage(this.iconPositions[f],n.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],n.getImage(f),c)}patchUpdatedImage(n,c,f){if(!n||!c||n.version===c.version)return;n.version=c.version;const[_,w]=n.tl;f.update(c.data,void 0,{x:_,y:w})}}var na;zt("ImagePosition",Bf),zt("ImageAtlas",Xm),d.ah=void 0,(na=d.ah||(d.ah={}))[na.none=0]="none",na[na.horizontal=1]="horizontal",na[na.vertical=2]="vertical",na[na.horizontalOnly=3]="horizontalOnly";const Tu=-17;class Iu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,c){const f=new Iu;return f.scale=n||1,f.fontStack=c,f}static forImage(n){const c=new Iu;return c.imageName=n,c}}class Hl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,c){const f=new Hl;for(let _=0;_<n.sections.length;_++){const w=n.sections[_];w.image?f.addImageSection(w):f.addTextSection(w,c)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let c="";for(let f=0;f<n.length;f++){const _=n.charCodeAt(f+1)||null,w=n.charCodeAt(f-1)||null;c+=_&&$h(_)&&!Su[n[f+1]]||w&&$h(w)&&!Su[n[f-1]]||!Su[n[f]]?n[f]:Su[n[f]]}return c}(this.text)}trim(){let n=0;for(let f=0;f<this.text.length&&rd[this.text.charCodeAt(f)];f++)n++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=n&&rd[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(n,c),this.sectionIndex=this.sectionIndex.slice(n,c)}substring(n,c){const f=new Hl;return f.text=this.text.substring(n,c),f.sectionIndex=this.sectionIndex.slice(n,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,c)=>Math.max(n,this.sections[c].scale),0)}addTextSection(n,c){this.text+=n.text,this.sections.push(Iu.forText(n.scale,n.fontStack||c));const f=this.sections.length-1;for(let _=0;_<n.text.length;++_)this.sectionIndex.push(f)}addImageSection(n){const c=n.image?n.image.name:"";if(c.length===0)return void Ge("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Iu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Ge("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function nd(s,n,c,f,_,w,x,T,C,A,D,F,U,W,Q){const re=Hl.fromFeature(s,_);let _e;F===d.ah.vertical&&re.verticalizePunctuation();const{processBidirectionalText:be,processStyledBidirectionalText:Ze}=Ur;if(be&&re.sections.length===1){_e=[];const Je=be(re.toString(),Of(re,A,w,n,f,W));for(const _t of Je){const Mt=new Hl;Mt.text=_t,Mt.sections=re.sections;for(let Kt=0;Kt<_t.length;Kt++)Mt.sectionIndex.push(0);_e.push(Mt)}}else if(Ze){_e=[];const Je=Ze(re.text,re.sectionIndex,Of(re,A,w,n,f,W));for(const _t of Je){const Mt=new Hl;Mt.text=_t[0],Mt.sectionIndex=_t[1],Mt.sections=re.sections,_e.push(Mt)}}else _e=function(Je,_t){const Mt=[],Kt=Je.text;let Ct=0;for(const Tt of _t)Mt.push(Je.substring(Ct,Tt)),Ct=Tt;return Ct<Kt.length&&Mt.push(Je.substring(Ct,Kt.length)),Mt}(re,Of(re,A,w,n,f,W));const Ae=[],Oe={positionedLines:Ae,text:re.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Je,_t,Mt,Kt,Ct,Tt,$t,Rt,Pt,tt,Zt,Ut){let ii=0,Ji=Tu,Xi=0,Gn=0;const To=Rt==="right"?1:Rt==="left"?0:.5;let ar=0;for(const Ln of Ct){Ln.trim();const Hn=Ln.getMaxScale(),_r=(Hn-1)*jn,lr={positionedGlyphs:[],lineOffset:0};Je.positionedLines[ar]=lr;const Lr=lr.positionedGlyphs;let cr=0;if(!Ln.length()){Ji+=Tt,++ar;continue}for(let qr=0;qr<Ln.length();qr++){const Pi=Ln.getSection(qr),Qi=Ln.getSectionIndex(qr),an=Ln.getCharCode(qr);let io=0,yn=null,Yl=null,Xo=null,Ko=jn;const Io=!(Pt===d.ah.horizontal||!Zt&&!hu(an)||Zt&&(rd[an]||(Wn=an,/\p{sc=Arab}/u.test(String.fromCodePoint(Wn)))));if(Pi.imageName){const mo=Kt[Pi.imageName];if(!mo)continue;Xo=Pi.imageName,Je.iconsInText=Je.iconsInText||!0,Yl=mo.paddedRect;const Yn=mo.displaySize;Pi.scale=Pi.scale*jn/Ut,yn={width:Yn[0],height:Yn[1],left:Vr,top:-Wm,advance:Io?Yn[1]:Yn[0]},io=_r+(jn-Yn[1]*Pi.scale),Ko=yn.advance;const ps=Io?Yn[0]*Pi.scale-jn*Hn:Yn[1]*Pi.scale-jn*Hn;ps>0&&ps>cr&&(cr=ps)}else{const mo=Mt[Pi.fontStack],Yn=mo&&mo[an];if(Yn&&Yn.rect)Yl=Yn.rect,yn=Yn.metrics;else{const ps=_t[Pi.fontStack],Pu=ps&&ps[an];if(!Pu)continue;yn=Pu.metrics}io=(Hn-Pi.scale)*jn}Io?(Je.verticalizable=!0,Lr.push({glyph:an,imageName:Xo,x:ii,y:Ji+io,vertical:Io,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Qi,metrics:yn,rect:Yl}),ii+=Ko*Pi.scale+tt):(Lr.push({glyph:an,imageName:Xo,x:ii,y:Ji+io,vertical:Io,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Qi,metrics:yn,rect:Yl}),ii+=yn.advance*Pi.scale+tt)}Lr.length!==0&&(Xi=Math.max(ii-tt,Xi),nv(Lr,0,Lr.length-1,To,cr)),ii=0;const po=Tt*Hn+cr;lr.lineOffset=Math.max(cr,_r),Ji+=po,Gn=Math.max(po,Gn),++ar}var Wn;const Ir=Ji-Tu,{horizontalAlign:Cr,verticalAlign:Er}=Nf($t);(function(Ln,Hn,_r,lr,Lr,cr,po,qr,Pi){const Qi=(Hn-_r)*Lr;let an=0;an=cr!==po?-qr*lr-Tu:(-lr*Pi+.5)*po;for(const io of Ln)for(const yn of io.positionedGlyphs)yn.x+=Qi,yn.y+=an})(Je.positionedLines,To,Cr,Er,Xi,Gn,Tt,Ir,Ct.length),Je.top+=-Er*Ir,Je.bottom=Je.top+Ir,Je.left+=-Cr*Xi,Je.right=Je.left+Xi}(Oe,n,c,f,_e,x,T,C,F,A,U,Q),!function(Je){for(const _t of Je)if(_t.positionedGlyphs.length!==0)return!1;return!0}(Ae)&&Oe}const rd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ev={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},tv={40:!0};function Km(s,n,c,f,_,w){if(n.imageName){const x=f[n.imageName];return x?x.displaySize[0]*n.scale*jn/w+_:0}{const x=c[n.fontStack],T=x&&x[s];return T?T.metrics.advance*n.scale+_:0}}function Jm(s,n,c,f){const _=Math.pow(s-n,2);return f?s<n?_/2:2*_:_+Math.abs(c)*c}function iv(s,n,c){let f=0;return s===10&&(f-=1e4),c&&(f+=150),s!==40&&s!==65288||(f+=50),n!==41&&n!==65289||(f+=50),f}function Ym(s,n,c,f,_,w){let x=null,T=Jm(n,c,_,w);for(const C of f){const A=Jm(n-C.x,c,_,w)+C.badness;A<=T&&(x=C,T=A)}return{index:s,x:n,priorBreak:x,badness:T}}function Qm(s){return s?Qm(s.priorBreak).concat(s.index):[]}function Of(s,n,c,f,_,w){if(!s)return[];const x=[],T=function(F,U,W,Q,re,_e){let be=0;for(let Ze=0;Ze<F.length();Ze++){const Ae=F.getSection(Ze);be+=Km(F.getCharCode(Ze),Ae,Q,re,U,_e)}return be/Math.max(1,Math.ceil(be/W))}(s,n,c,f,_,w),C=s.text.indexOf("​")>=0;let A=0;for(let F=0;F<s.length();F++){const U=s.getSection(F),W=s.getCharCode(F);if(rd[W]||(A+=Km(W,U,f,_,n,w)),F<s.length()-1){const Q=!((D=W)<11904)&&(!!Si["CJK Compatibility Forms"](D)||!!Si["CJK Compatibility"](D)||!!Si["CJK Strokes"](D)||!!Si["CJK Symbols and Punctuation"](D)||!!Si["Enclosed CJK Letters and Months"](D)||!!Si["Halfwidth and Fullwidth Forms"](D)||!!Si["Ideographic Description Characters"](D)||!!Si["Vertical Forms"](D)||Uh.test(String.fromCodePoint(D)));(ev[W]||Q||U.imageName||F!==s.length()-2&&tv[s.getCharCode(F+1)])&&x.push(Ym(F+1,A,T,x,iv(W,s.getCharCode(F+1),Q&&C),!1))}}var D;return Qm(Ym(s.length(),A,T,x,0,!0))}function Nf(s){let n=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:n,verticalAlign:c}}function nv(s,n,c,f,_){if(!f&&!_)return;const w=s[c],x=(s[c].x+w.metrics.advance*w.scale)*f;for(let T=n;T<=c;T++)s[T].x-=x,s[T].y+=_}function rv(s,n,c){const{horizontalAlign:f,verticalAlign:_}=Nf(c),w=n[0]-s.displaySize[0]*f,x=n[1]-s.displaySize[1]*_;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function e_(s){var n,c;let f=s.left,_=s.top,w=s.right-f,x=s.bottom-_;const T=(n=s.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",C=(c=s.image.textFitHeight)!==null&&c!==void 0?c:"stretchOrShrink",A=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(C==="proportional"){if(T==="stretchOnly"&&w/x<A||T==="proportional"){const D=Math.ceil(x*A);f*=D/w,w=D}}else if(T==="proportional"&&C==="stretchOnly"&&A!==0&&w/x>A){const D=Math.ceil(w/A);_*=D/x,x=D}return{x1:f,y1:_,x2:f+w,y2:_+x}}function t_(s,n,c,f,_,w){const x=s.image;let T;if(x.content){const _e=x.content,be=x.pixelRatio||1;T=[_e[0]/be,_e[1]/be,x.displaySize[0]-_e[2]/be,x.displaySize[1]-_e[3]/be]}const C=n.left*w,A=n.right*w;let D,F,U,W;c==="width"||c==="both"?(W=_[0]+C-f[3],F=_[0]+A+f[1]):(W=_[0]+(C+A-x.displaySize[0])/2,F=W+x.displaySize[0]);const Q=n.top*w,re=n.bottom*w;return c==="height"||c==="both"?(D=_[1]+Q-f[0],U=_[1]+re+f[2]):(D=_[1]+(Q+re-x.displaySize[1])/2,U=D+x.displaySize[1]),{image:x,top:D,right:F,bottom:U,left:W,collisionPadding:T}}const Cu=255,Ho=128,ra=Cu*Ho;function i_(s,n){const{expression:c}=n;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new nn(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=c;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<s+1;)x++;x=Math.min(f.length-1,x);const T=f[w],C=f[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:C,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:C,minSize:c.evaluate(new nn(T)),maxSize:c.evaluate(new nn(C)),interpolationType:_}}}function jf(s,n,c){let f="never";const _=s.get(n);return _?f=_:s.get(c)&&(f="always"),f}const ov=ia.VectorTileFeature.types,sv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function od(s,n,c,f,_,w,x,T,C,A,D,F,U){const W=T?Math.min(ra,Math.round(T[0])):0,Q=T?Math.min(ra,Math.round(T[1])):0;s.emplaceBack(n,c,Math.round(32*f),Math.round(32*_),w,x,(W<<1)+(C?1:0),Q,16*A,16*D,256*F,256*U)}function Uf(s,n,c){s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c)}function av(s){for(const n of s.sections)if(mf(n.text))return!0;return!1}class $f{constructor(n){this.layoutVertexArray=new Bl,this.indexArray=new uo,this.programConfigurations=n,this.segments=new Ti,this.dynamicLayoutVertexArray=new pu,this.opacityVertexArray=new eo,this.hasVisibleVertices=!1,this.placedSymbolArray=new rn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,c,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Bb.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Ob.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,sv,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}zt("SymbolBuffers",$f);class Vf{constructor(n,c,f){this.layoutVertexArray=new n,this.layoutAttributes=c,this.indexArray=new f,this.segments=new Ti,this.collisionVertexArray=new Go}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Nb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}zt("CollisionBuffers",Vf);class Xl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(x=>x.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xf([]),this.placementViewportMatrix=xf([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i_(this.zoom,c["text-size"]),this.iconSizeData=i_(this.zoom,c["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=jf(f,"text-overlap","text-allow-overlap")!=="never"||jf(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>d.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=n.sourceID}createArrays(){this.text=new $f(new qa(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new $f(new qa(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new on,this.lineVertexArray=new nr,this.symbolInstances=new xi,this.textAnchorOffsets=new sn}calculateGlyphDependencies(n,c,f,_,w){for(let x=0;x<n.length;x++)if(c[n.charCodeAt(x)]=!0,(f||_)&&w){const T=Su[n.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(n,c,f){const _=this.layers[0],w=_.layout,x=w.get("text-font"),T=w.get("text-field"),C=w.get("icon-image"),A=(T.value.kind!=="constant"||T.value.value instanceof Br&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,F=w.get("symbol-sort-key");if(this.features=[],!A&&!D)return;const U=c.iconDependencies,W=c.glyphDependencies,Q=c.availableImages,re=new nn(this.zoom);for(const{feature:_e,id:be,index:Ze,sourceLayerIndex:Ae}of n){const Oe=_._featureFilter.needGeometry,Je=Ga(_e,Oe);if(!_._featureFilter.filter(re,Je,f))continue;let _t,Mt;if(Oe||(Je.geometry=Za(_e)),A){const Ct=_.getValueAndResolveTokens("text-field",Je,f,Q),Tt=Br.factory(Ct),$t=this.hasRTLText=this.hasRTLText||av(Tt);(!$t||Ur.getRTLTextPluginStatus()==="unavailable"||$t&&Ur.isParsed())&&(_t=Ub(Tt,_,Je))}if(D){const Ct=_.getValueAndResolveTokens("icon-image",Je,f,Q);Mt=Ct instanceof Nr?Ct:Nr.fromString(Ct)}if(!_t&&!Mt)continue;const Kt=this.sortFeaturesByKey?F.evaluate(Je,{},f):void 0;if(this.features.push({id:be,text:_t,icon:Mt,index:Ze,sourceLayerIndex:Ae,geometry:Je.geometry,properties:_e.properties,type:ov[_e.type],sortKey:Kt}),Mt&&(U[Mt.name]=!0),_t){const Ct=x.evaluate(Je,{},f).join(","),Tt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const $t of _t.sections)if($t.image)U[$t.image.name]=!0;else{const Rt=cu(_t.toString()),Pt=$t.fontStack||Ct,tt=W[Pt]=W[Pt]||{};this.calculateGlyphDependencies($t.text,tt,Tt,this.allowVerticalPlacement,Rt)}}}w.get("symbol-placement")==="line"&&(this.features=function(_e){const be={},Ze={},Ae=[];let Oe=0;function Je(Ct){Ae.push(_e[Ct]),Oe++}function _t(Ct,Tt,$t){const Rt=Ze[Ct];return delete Ze[Ct],Ze[Tt]=Rt,Ae[Rt].geometry[0].pop(),Ae[Rt].geometry[0]=Ae[Rt].geometry[0].concat($t[0]),Rt}function Mt(Ct,Tt,$t){const Rt=be[Tt];return delete be[Tt],be[Ct]=Rt,Ae[Rt].geometry[0].shift(),Ae[Rt].geometry[0]=$t[0].concat(Ae[Rt].geometry[0]),Rt}function Kt(Ct,Tt,$t){const Rt=$t?Tt[0][Tt[0].length-1]:Tt[0][0];return`${Ct}:${Rt.x}:${Rt.y}`}for(let Ct=0;Ct<_e.length;Ct++){const Tt=_e[Ct],$t=Tt.geometry,Rt=Tt.text?Tt.text.toString():null;if(!Rt){Je(Ct);continue}const Pt=Kt(Rt,$t),tt=Kt(Rt,$t,!0);if(Pt in Ze&&tt in be&&Ze[Pt]!==be[tt]){const Zt=Mt(Pt,tt,$t),Ut=_t(Pt,tt,Ae[Zt].geometry);delete be[Pt],delete Ze[tt],Ze[Kt(Rt,Ae[Ut].geometry,!0)]=Ut,Ae[Zt].geometry=null}else Pt in Ze?_t(Pt,tt,$t):tt in be?Mt(Pt,tt,$t):(Je(Ct),be[Pt]=Oe-1,Ze[tt]=Oe-1)}return Ae.filter(Ct=>Ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,be)=>_e.sortKey-be.sortKey)}update(n,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(n,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,c){const f=this.lineVertexArray.length;if(n.segment!==void 0){let _=n.dist(c[n.segment+1]),w=n.dist(c[n.segment]);const x={};for(let T=n.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:_},T<c.length-1&&(_+=c[T+1].dist(c[T]));for(let T=n.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:w},T>0&&(w+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const C=x[T];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(n,c,f,_,w,x,T,C,A,D,F,U){const W=n.indexArray,Q=n.layoutVertexArray,re=n.segments.prepareSegment(4*c.length,Q,W,this.canOverlap?x.sortKey:void 0),_e=this.glyphOffsetArray.length,be=re.vertexLength,Ze=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,Ae=x.text&&x.text.sections;for(let Oe=0;Oe<c.length;Oe++){const{tl:Je,tr:_t,bl:Mt,br:Kt,tex:Ct,pixelOffsetTL:Tt,pixelOffsetBR:$t,minFontScaleX:Rt,minFontScaleY:Pt,glyphOffset:tt,isSDF:Zt,sectionIndex:Ut}=c[Oe],ii=re.vertexLength,Ji=tt[1];od(Q,C.x,C.y,Je.x,Ji+Je.y,Ct.x,Ct.y,f,Zt,Tt.x,Tt.y,Rt,Pt),od(Q,C.x,C.y,_t.x,Ji+_t.y,Ct.x+Ct.w,Ct.y,f,Zt,$t.x,Tt.y,Rt,Pt),od(Q,C.x,C.y,Mt.x,Ji+Mt.y,Ct.x,Ct.y+Ct.h,f,Zt,Tt.x,$t.y,Rt,Pt),od(Q,C.x,C.y,Kt.x,Ji+Kt.y,Ct.x+Ct.w,Ct.y+Ct.h,f,Zt,$t.x,$t.y,Rt,Pt),Uf(n.dynamicLayoutVertexArray,C,Ze),W.emplaceBack(ii,ii+1,ii+2),W.emplaceBack(ii+1,ii+2,ii+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),Oe!==c.length-1&&Ut===c[Oe+1].sectionIndex||n.programConfigurations.populatePaintArrays(Q.length,x,x.index,{},U,Ae&&Ae[Ut])}n.placedSymbolArray.emplaceBack(C.x,C.y,_e,this.glyphOffsetArray.length-_e,be,A,D,C.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],T,0,!1,0,F)}_addCollisionDebugVertex(n,c,f,_,w,x){return c.emplaceBack(0,0),n.emplaceBack(f.x,f.y,_,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(n,c,f,_,w,x,T){const C=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),A=C.vertexLength,D=w.layoutVertexArray,F=w.collisionVertexArray,U=T.anchorX,W=T.anchorY;this._addCollisionDebugVertex(D,F,x,U,W,new S(n,c)),this._addCollisionDebugVertex(D,F,x,U,W,new S(f,c)),this._addCollisionDebugVertex(D,F,x,U,W,new S(f,_)),this._addCollisionDebugVertex(D,F,x,U,W,new S(n,_)),C.vertexLength+=4;const Q=w.indexArray;Q.emplaceBack(A,A+1),Q.emplaceBack(A+1,A+2),Q.emplaceBack(A+2,A+3),Q.emplaceBack(A+3,A),C.primitiveLength+=4}addDebugCollisionBoxes(n,c,f,_){for(let w=n;w<c;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,_?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vf(to,Nm.members,Jn),this.iconCollisionBox=new Vf(to,Nm.members,Jn);for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(n,c,f,_,w,x,T,C,A){const D={};for(let F=c;F<f;F++){const U=n.get(F);D.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.textFeatureIndex=U.featureIndex;break}for(let F=_;F<w;F++){const U=n.get(F);D.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalTextFeatureIndex=U.featureIndex;break}for(let F=x;F<T;F++){const U=n.get(F);D.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.iconFeatureIndex=U.featureIndex;break}for(let F=C;F<A;F++){const U=n.get(F);D.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalIconFeatureIndex=U.featureIndex;break}return D}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,c){const f=n.placedSymbolArray.get(c),_=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<_;w+=4)n.indexArray.emplaceBack(w,w+1,w+2),n.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(n),f=Math.cos(n),_=[],w=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const C=this.symbolInstances.get(T);_.push(0|Math.round(c*C.anchorX+f*C.anchorY)),w.push(C.featureIndex)}return x.sort((T,C)=>_[T]-_[C]||w[C]-w[T]),x}addToSortKeyRanges(n,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,w,x)=>{_>=0&&x.indexOf(_)===w&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n_,r_;zt("SymbolBucket",Xl,{omit:["layers","collisionBoxArray","features","compareText"]}),Xl.MAX_GLYPHS=65535,Xl.addDynamicAttributes=Uf;var qf={get paint(){return r_=r_||new b({"icon-opacity":new Yt(Te.paint_symbol["icon-opacity"]),"icon-color":new Yt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Yt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Yt(Te.paint_symbol["text-opacity"]),"text-color":new Yt(Te.paint_symbol["text-color"],{runtimeType:In,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Yt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(Te.paint_symbol["text-halo-blur"]),"text-translate":new Ot(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(Te.paint_symbol["text-translate-anchor"])})},get layout(){return n_=n_||new b({"symbol-placement":new Ot(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ot(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ot(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ot(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Ot(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(Te.layout_symbol["icon-image"]),"icon-rotate":new Yt(Te.layout_symbol["icon-rotate"]),"icon-padding":new Yt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Yt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(Te.layout_symbol["text-field"]),"text-font":new Yt(Te.layout_symbol["text-font"]),"text-size":new Yt(Te.layout_symbol["text-size"]),"text-max-width":new Yt(Te.layout_symbol["text-max-width"]),"text-line-height":new Ot(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Yt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Yt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Yt(Te.layout_symbol["text-anchor"]),"text-max-angle":new Ot(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(Te.layout_symbol["text-rotate"]),"text-padding":new Ot(Te.layout_symbol["text-padding"]),"text-keep-upright":new Ot(Te.layout_symbol["text-keep-upright"]),"text-transform":new Yt(Te.layout_symbol["text-transform"]),"text-offset":new Yt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new Ot(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new Ot(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(Te.layout_symbol["text-optional"])})}};class o_{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Wr,this.defaultValue=n}evaluate(n){if(n.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(n.formattedSection))return c.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt("FormatSectionOverride",o_,{omit:["defaultValue"]});class sd extends h{constructor(n){super(n,qf)}recalculate(n,c){if(super.recalculate(n,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const w of f)_.indexOf(w)<0&&_.push(w);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,c,f,_){const w=this.layout.get(n).evaluate(c,{},f,_),x=this._unevaluatedLayout._values[n];return x.isDataDriven()||xl(x.value)||!w?w:function(T,C){return C.replace(/{([^{}]+)}/g,(A,D)=>T&&D in T?String(T[D]):"")}(c.properties,w)}createBucket(n){return new Xl(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of qf.paint.overridableProperties){if(!sd.hasPaintOverride(this.layout,n))continue;const c=this.paint.get(n),f=new o_(c),_=new wl(f,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new js("source",_):new Us("composite",_,c.value.zoomStops),this.paint._values[n]=new ko(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(n,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&sd.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,c){const f=n.get("text-field"),_=qf.paint.properties[c];let w=!1;const x=T=>{for(const C of T)if(_.overrides&&_.overrides.hasOverride(C))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Br)x(f.value.value.sections);else if(f.value.kind==="source"){const T=A=>{w||(A instanceof ro&&Rn(A.value)===Fr?x(A.value.sections):A instanceof dl?x(A.sections):A.eachChild(T))},C=f.value;C._styleExpression&&T(C._styleExpression.expression)}return w}}let s_;var lv={get paint(){return s_=s_||new b({"background-color":new Ot(Te.paint_background["background-color"]),"background-pattern":new Rl(Te.paint_background["background-pattern"]),"background-opacity":new Ot(Te.paint_background["background-opacity"])})}};class cv extends h{constructor(n){super(n,lv)}}let a_;var uv={get paint(){return a_=a_||new b({"raster-opacity":new Ot(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ot(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(Te.paint_raster["raster-saturation"]),"raster-contrast":new Ot(Te.paint_raster["raster-contrast"]),"raster-resampling":new Ot(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(Te.paint_raster["raster-fade-duration"])})}};class hv extends h{constructor(n){super(n,uv)}}class dv extends h{constructor(n){super(n,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class fv{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Zf=63710088e-1;class oa{constructor(n,c){if(isNaN(n)||isNaN(c))throw new Error(`Invalid LngLat object: (${n}, ${c})`);if(this.lng=+n,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oa(Ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const c=Math.PI/180,f=this.lat*c,_=n.lat*c,w=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((n.lng-this.lng)*c);return Zf*Math.acos(Math.min(w,1))}static convert(n){if(n instanceof oa)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new oa(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new oa(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l_=2*Math.PI*Zf;function c_(s){return l_*Math.cos(s*Math.PI/180)}function u_(s){return(180+s)/360}function h_(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function d_(s,n){return s/c_(n)}function Gf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Eu{constructor(n,c,f=0){this.x=+n,this.y=+c,this.z=+f}static fromLngLat(n,c=0){const f=oa.convert(n);return new Eu(u_(f.lng),h_(f.lat),d_(c,f.lat))}toLngLat(){return new oa(360*this.x-180,Gf(this.y))}toAltitude(){return this.z*c_(Gf(this.y))}meterInMercatorCoordinateUnits(){return 1/l_*(n=Gf(this.y),1/Math.cos(n*Math.PI/180));var n}}function f_(s,n,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[s*f-2*Math.PI*6378137/2,n*f-2*Math.PI*6378137/2]}class Wf{constructor(n,c,f){if(!function(_,w,x){return!(_<0||_>25||x<0||x>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))}(n,c,f))throw new Error(`x=${c}, y=${f}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=c,this.y=f,this.key=Lu(0,n,n,c,f)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,c,f){const _=(x=this.y,T=this.z,C=f_(256*(w=this.x),256*(x=Math.pow(2,T)-x-1),T),A=f_(256*(w+1),256*(x+1),T),C[0]+","+C[1]+","+A[0]+","+A[1]);var w,x,T,C,A;const D=function(F,U,W){let Q,re="";for(let _e=F;_e>0;_e--)Q=1<<_e-1,re+=(U&Q?1:0)+(W&Q?2:0);return re}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,_)}isChildOf(n){const c=this.z-n.z;return c>0&&n.x===this.x>>c&&n.y===this.y>>c}getTilePoint(n){const c=Math.pow(2,this.z);return new S((n.x*c-this.x)*Fn,(n.y*c-this.y)*Fn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p_{constructor(n,c){this.wrap=n,this.canonical=c,this.key=Lu(n,c.z,c.z,c.x,c.y)}}class fo{constructor(n,c,f,_,w){if(n<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${f}`);this.overscaledZ=n,this.wrap=c,this.canonical=new Wf(f,+_,+w),this.key=Lu(c,n,f,_,w)}clone(){return new fo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-n;return n>this.canonical.z?new fo(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fo(n,this.wrap,n,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(n,c){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-n;return n>this.canonical.z?Lu(this.wrap*+c,n,this.canonical.z,this.canonical.x,this.canonical.y):Lu(this.wrap*+c,n,n,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const c=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>c&&n.canonical.y===this.canonical.y>>c}children(n){if(this.overscaledZ>=n)return[new fo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new fo(c,this.wrap,c,f,_),new fo(c,this.wrap,c,f+1,_),new fo(c,this.wrap,c,f,_+1),new fo(c,this.wrap,c,f+1,_+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new fo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new fo(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Eu(n.x-this.wrap,n.y))}}function Lu(s,n,c,f,_){(s*=2)<0&&(s=-1*s-1);const w=1<<c;return(w*w*s+w*_+f).toString(36)+c.toString(36)+n.toString(36)}zt("CanonicalTileID",Wf),zt("OverscaledTileID",fo,{omit:["posMatrix"]});class m_{constructor(n,c,f,_=1,w=1,x=1,T=0){if(this.uid=n,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ge(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const C=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=w,this.blueFactor=x,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<C;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(C,A)]=this.data[this._idx(C-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,C)]=this.data[this._idx(A,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<C;A++)for(let D=0;D<C;D++){const F=this.get(A,D);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(n,c){const f=new Uint8Array(this.data.buffer),_=4*this._idx(n,c);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,c){if(n<-1||n>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(n+1)}unpack(n,c,f){return n*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new ho({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,c,f){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let _=c*this.dim,w=c*this.dim+this.dim,x=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:_=w-1;break;case 1:w=_+1}switch(f){case-1:x=T-1;break;case 1:T=x+1}const C=-c*this.dim,A=-f*this.dim;for(let D=x;D<T;D++)for(let F=_;F<w;F++)this.data[this._idx(F,D)]=n.data[this._idx(F+C,D+A)]}}zt("DEMData",m_);class __{constructor(n){this._stringToNumber={},this._numberToString=[];for(let c=0;c<n.length;c++){const f=n[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class g_{constructor(n,c,f,_,w){this.type="Feature",this._vectorTileFeature=n,n._z=c,n._x=f,n._y=_,this.properties=n.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(n[c]=this[c]);return n}}class y_{constructor(n,c){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Zs(Fn,16,0),this.grid3D=new Zs(Fn,16,0),this.featureIndexArray=new pr,this.promoteId=c}insert(n,c,f,_,w,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,w);const C=x?this.grid3D:this.grid;for(let A=0;A<c.length;A++){const D=c[A],F=[1/0,1/0,-1/0,-1/0];for(let U=0;U<D.length;U++){const W=D[U];F[0]=Math.min(F[0],W.x),F[1]=Math.min(F[1],W.y),F[2]=Math.max(F[2],W.x),F[3]=Math.max(F[3],W.y)}F[0]<Fn&&F[1]<Fn&&F[2]>=0&&F[3]>=0&&C.insert(T,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ia.VectorTile(new Rf(this.rawTileData)).layers,this.sourceLayerCoder=new __(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,c,f,_){this.loadVTLayers();const w=n.params||{},x=Fn/n.tileSize/n.scale,T=Hc(w.filter),C=n.queryGeometry,A=n.queryPadding*x,D=v_(C),F=this.grid.query(D.minX-A,D.minY-A,D.maxX+A,D.maxY+A),U=v_(n.cameraQueryGeometry),W=this.grid3D.query(U.minX-A,U.minY-A,U.maxX+A,U.maxY+A,(_e,be,Ze,Ae)=>function(Oe,Je,_t,Mt,Kt){for(const Tt of Oe)if(Je<=Tt.x&&_t<=Tt.y&&Mt>=Tt.x&&Kt>=Tt.y)return!0;const Ct=[new S(Je,_t),new S(Je,Kt),new S(Mt,Kt),new S(Mt,_t)];if(Oe.length>2){for(const Tt of Ct)if($l(Oe,Tt))return!0}for(let Tt=0;Tt<Oe.length-1;Tt++)if(W1(Oe[Tt],Oe[Tt+1],Ct))return!0;return!1}(n.cameraQueryGeometry,_e-A,be-A,Ze+A,Ae+A));for(const _e of W)F.push(_e);F.sort(pv);const Q={};let re;for(let _e=0;_e<F.length;_e++){const be=F[_e];if(be===re)continue;re=be;const Ze=this.featureIndexArray.get(be);let Ae=null;this.loadMatchingFeature(Q,Ze.bucketIndex,Ze.sourceLayerIndex,Ze.featureIndex,T,w.layers,w.availableImages,c,f,_,(Oe,Je,_t)=>(Ae||(Ae=Za(Oe)),Je.queryIntersectsFeature(C,Oe,_t,Ae,this.z,n.transform,x,n.pixelPosMatrix)))}return Q}loadMatchingFeature(n,c,f,_,w,x,T,C,A,D,F){const U=this.bucketLayerIDs[c];if(x&&!function(_e,be){for(let Ze=0;Ze<_e.length;Ze++)if(be.indexOf(_e[Ze])>=0)return!0;return!1}(x,U))return;const W=this.sourceLayerCoder.decode(f),Q=this.vtLayers[W].feature(_);if(w.needGeometry){const _e=Ga(Q,!0);if(!w.filter(new nn(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!w.filter(new nn(this.tileID.overscaledZ),Q))return;const re=this.getId(Q,W);for(let _e=0;_e<U.length;_e++){const be=U[_e];if(x&&x.indexOf(be)<0)continue;const Ze=C[be];if(!Ze)continue;let Ae={};re&&D&&(Ae=D.getState(Ze.sourceLayer||"_geojsonTileLayer",re));const Oe=Y({},A[be]);Oe.paint=b_(Oe.paint,Ze.paint,Q,Ae,T),Oe.layout=b_(Oe.layout,Ze.layout,Q,Ae,T);const Je=!F||F(Q,Ze,Ae);if(!Je)continue;const _t=new g_(Q,this.z,this.x,this.y,re);_t.layer=Oe;let Mt=n[be];Mt===void 0&&(Mt=n[be]=[]),Mt.push({featureIndex:_,feature:_t,intersectionZ:Je})}}lookupSymbolFeatures(n,c,f,_,w,x,T,C){const A={};this.loadVTLayers();const D=Hc(w);for(const F of n)this.loadMatchingFeature(A,f,_,F,D,x,T,C,c);return A}hasLayer(n){for(const c of this.bucketLayerIDs)for(const f of c)if(n===f)return!0;return!1}getId(n,c){let f=n.id;return this.promoteId&&(f=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function b_(s,n,c,f,_){return ue(s,(w,x)=>{const T=n instanceof Ua?n.get(x):null;return T&&T.evaluate?T.evaluate(c,f,_):T})}function v_(s){let n=1/0,c=1/0,f=-1/0,_=-1/0;for(const w of s)n=Math.min(n,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return{minX:n,minY:c,maxX:f,maxY:_}}function pv(s,n){return n-s}function w_(s,n,c,f,_){const w=[];for(let x=0;x<s.length;x++){const T=s[x];let C;for(let A=0;A<T.length-1;A++){let D=T[A],F=T[A+1];D.x<n&&F.x<n||(D.x<n?D=new S(n,D.y+(n-D.x)/(F.x-D.x)*(F.y-D.y))._round():F.x<n&&(F=new S(n,D.y+(n-D.x)/(F.x-D.x)*(F.y-D.y))._round()),D.y<c&&F.y<c||(D.y<c?D=new S(D.x+(c-D.y)/(F.y-D.y)*(F.x-D.x),c)._round():F.y<c&&(F=new S(D.x+(c-D.y)/(F.y-D.y)*(F.x-D.x),c)._round()),D.x>=f&&F.x>=f||(D.x>=f?D=new S(f,D.y+(f-D.x)/(F.x-D.x)*(F.y-D.y))._round():F.x>=f&&(F=new S(f,D.y+(f-D.x)/(F.x-D.x)*(F.y-D.y))._round()),D.y>=_&&F.y>=_||(D.y>=_?D=new S(D.x+(_-D.y)/(F.y-D.y)*(F.x-D.x),_)._round():F.y>=_&&(F=new S(D.x+(_-D.y)/(F.y-D.y)*(F.x-D.x),_)._round()),C&&D.equals(C[C.length-1])||(C=[D],w.push(C)),C.push(F)))))}}return w}zt("FeatureIndex",y_,{omit:["rawTileData","sourceLayerCoder"]});class sa extends S{constructor(n,c,f,_){super(n,c),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new sa(this.x,this.y,this.angle,this.segment)}}function x_(s,n,c,f,_){if(n.segment===void 0||c===0)return!0;let w=n,x=n.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=s[x].dist(w),w=s[x]}T+=s[x].dist(s[x+1]),x++;const C=[];let A=0;for(;T<c/2;){const D=s[x],F=s[x+1];if(!F)return!1;let U=s[x-1].angleTo(D)-D.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:U}),A+=U;T-C[0].distance>f;)A-=C.shift().angleDelta;if(A>_)return!1;x++,T+=D.dist(F)}return!0}function k_(s){let n=0;for(let c=0;c<s.length-1;c++)n+=s[c].dist(s[c+1]);return n}function S_(s,n,c){return s?.6*n*c:0}function T_(s,n){return Math.max(s?s.right-s.left:0,n?n.right-n.left:0)}function mv(s,n,c,f,_,w){const x=S_(c,_,w),T=T_(c,f)*w;let C=0;const A=k_(s)/2;for(let D=0;D<s.length-1;D++){const F=s[D],U=s[D+1],W=F.dist(U);if(C+W>A){const Q=(A-C)/W,re=xr.number(F.x,U.x,Q),_e=xr.number(F.y,U.y,Q),be=new sa(re,_e,U.angleTo(F),D);return be._round(),!x||x_(s,be,T,x,n)?be:void 0}C+=W}}function _v(s,n,c,f,_,w,x,T,C){const A=S_(f,w,x),D=T_(f,_),F=D*x,U=s[0].x===0||s[0].x===C||s[0].y===0||s[0].y===C;return n-F<n/4&&(n=F+n/4),I_(s,U?n/2*T%n:(D/2+2*w)*x*T%n,n,A,c,F,U,!1,C)}function I_(s,n,c,f,_,w,x,T,C){const A=w/2,D=k_(s);let F=0,U=n-c,W=[];for(let Q=0;Q<s.length-1;Q++){const re=s[Q],_e=s[Q+1],be=re.dist(_e),Ze=_e.angleTo(re);for(;U+c<F+be;){U+=c;const Ae=(U-F)/be,Oe=xr.number(re.x,_e.x,Ae),Je=xr.number(re.y,_e.y,Ae);if(Oe>=0&&Oe<C&&Je>=0&&Je<C&&U-A>=0&&U+A<=D){const _t=new sa(Oe,Je,Ze,Q);_t._round(),f&&!x_(s,_t,w,f,_)||W.push(_t)}}F+=be}return T||W.length||x||(W=I_(s,F/2,c,f,_,w,x,!0,C)),W}zt("Anchor",sa);const Kl=Vr;function C_(s,n,c,f){const _=[],w=s.image,x=w.pixelRatio,T=w.paddedRect.w-2*Kl,C=w.paddedRect.h-2*Kl;let A={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const D=w.stretchX||[[0,T]],F=w.stretchY||[[0,C]],U=(tt,Zt)=>tt+Zt[1]-Zt[0],W=D.reduce(U,0),Q=F.reduce(U,0),re=T-W,_e=C-Q;let be=0,Ze=W,Ae=0,Oe=Q,Je=0,_t=re,Mt=0,Kt=_e;if(w.content&&f){const tt=w.content,Zt=tt[2]-tt[0],Ut=tt[3]-tt[1];(w.textFitWidth||w.textFitHeight)&&(A=e_(s)),be=ad(D,0,tt[0]),Ae=ad(F,0,tt[1]),Ze=ad(D,tt[0],tt[2]),Oe=ad(F,tt[1],tt[3]),Je=tt[0]-be,Mt=tt[1]-Ae,_t=Zt-Ze,Kt=Ut-Oe}const Ct=A.x1,Tt=A.y1,$t=A.x2-Ct,Rt=A.y2-Tt,Pt=(tt,Zt,Ut,ii)=>{const Ji=ld(tt.stretch-be,Ze,$t,Ct),Xi=cd(tt.fixed-Je,_t,tt.stretch,W),Gn=ld(Zt.stretch-Ae,Oe,Rt,Tt),To=cd(Zt.fixed-Mt,Kt,Zt.stretch,Q),ar=ld(Ut.stretch-be,Ze,$t,Ct),Wn=cd(Ut.fixed-Je,_t,Ut.stretch,W),Ir=ld(ii.stretch-Ae,Oe,Rt,Tt),Cr=cd(ii.fixed-Mt,Kt,ii.stretch,Q),Er=new S(Ji,Gn),Ln=new S(ar,Gn),Hn=new S(ar,Ir),_r=new S(Ji,Ir),lr=new S(Xi/x,To/x),Lr=new S(Wn/x,Cr/x),cr=n*Math.PI/180;if(cr){const Pi=Math.sin(cr),Qi=Math.cos(cr),an=[Qi,-Pi,Pi,Qi];Er._matMult(an),Ln._matMult(an),_r._matMult(an),Hn._matMult(an)}const po=tt.stretch+tt.fixed,qr=Zt.stretch+Zt.fixed;return{tl:Er,tr:Ln,bl:_r,br:Hn,tex:{x:w.paddedRect.x+Kl+po,y:w.paddedRect.y+Kl+qr,w:Ut.stretch+Ut.fixed-po,h:ii.stretch+ii.fixed-qr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:Lr,minFontScaleX:_t/x/$t,minFontScaleY:Kt/x/Rt,isSDF:c}};if(f&&(w.stretchX||w.stretchY)){const tt=E_(D,re,W),Zt=E_(F,_e,Q);for(let Ut=0;Ut<tt.length-1;Ut++){const ii=tt[Ut],Ji=tt[Ut+1];for(let Xi=0;Xi<Zt.length-1;Xi++)_.push(Pt(ii,Zt[Xi],Ji,Zt[Xi+1]))}}else _.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:C+1}));return _}function ad(s,n,c){let f=0;for(const _ of s)f+=Math.max(n,Math.min(c,_[1]))-Math.max(n,Math.min(c,_[0]));return f}function E_(s,n,c){const f=[{fixed:-Kl,stretch:0}];for(const[_,w]of s){const x=f[f.length-1];f.push({fixed:_-x.stretch,stretch:x.stretch}),f.push({fixed:_-x.stretch,stretch:x.stretch+(w-_)})}return f.push({fixed:n+Kl,stretch:c}),f}function ld(s,n,c,f){return s/n*c+f}function cd(s,n,c,f){return s-n*c/f}class ud{constructor(n,c,f,_,w,x,T,C,A,D){var F;if(this.boxStartIndex=n.length,A){let U=x.top,W=x.bottom;const Q=x.collisionPadding;Q&&(U-=Q[1],W+=Q[3]);let re=W-U;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{const U=!((F=x.image)===null||F===void 0)&&F.content&&(x.image.textFitWidth||x.image.textFitHeight)?e_(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};U.y1=U.y1*T-C[0],U.y2=U.y2*T+C[2],U.x1=U.x1*T-C[3],U.x2=U.x2*T+C[1];const W=x.collisionPadding;if(W&&(U.x1-=W[0]*T,U.y1-=W[1]*T,U.x2+=W[2]*T,U.y2+=W[3]*T),D){const Q=new S(U.x1,U.y1),re=new S(U.x2,U.y1),_e=new S(U.x1,U.y2),be=new S(U.x2,U.y2),Ze=D*Math.PI/180;Q._rotate(Ze),re._rotate(Ze),_e._rotate(Ze),be._rotate(Ze),U.x1=Math.min(Q.x,re.x,_e.x,be.x),U.x2=Math.max(Q.x,re.x,_e.x,be.x),U.y1=Math.min(Q.y,re.y,_e.y,be.y),U.y2=Math.max(Q.y,re.y,_e.y,be.y)}n.emplaceBack(c.x,c.y,U.x1,U.y1,U.x2,U.y2,f,_,w)}this.boxEndIndex=n.length}}class gv{constructor(n=[],c=(f,_)=>f<_?-1:f>_?1:0){if(this.data=n,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:c,compare:f}=this,_=c[n];for(;n>0;){const w=n-1>>1,x=c[w];if(f(_,x)>=0)break;c[n]=x,n=w}c[n]=_}_down(n){const{data:c,compare:f}=this,_=this.length>>1,w=c[n];for(;n<_;){let x=1+(n<<1);const T=x+1;if(T<this.length&&f(c[T],c[x])<0&&(x=T),f(c[x],w)>=0)break;c[n]=c[x],n=x}c[n]=w}}function yv(s,n=1,c=!1){let f=1/0,_=1/0,w=-1/0,x=-1/0;const T=s[0];for(let W=0;W<T.length;W++){const Q=T[W];(!W||Q.x<f)&&(f=Q.x),(!W||Q.y<_)&&(_=Q.y),(!W||Q.x>w)&&(w=Q.x),(!W||Q.y>x)&&(x=Q.y)}const C=Math.min(w-f,x-_);let A=C/2;const D=new gv([],bv);if(C===0)return new S(f,_);for(let W=f;W<w;W+=C)for(let Q=_;Q<x;Q+=C)D.push(new Jl(W+A,Q+A,A,s));let F=function(W){let Q=0,re=0,_e=0;const be=W[0];for(let Ze=0,Ae=be.length,Oe=Ae-1;Ze<Ae;Oe=Ze++){const Je=be[Ze],_t=be[Oe],Mt=Je.x*_t.y-_t.x*Je.y;re+=(Je.x+_t.x)*Mt,_e+=(Je.y+_t.y)*Mt,Q+=3*Mt}return new Jl(re/Q,_e/Q,0,W)}(s),U=D.length;for(;D.length;){const W=D.pop();(W.d>F.d||!F.d)&&(F=W,c&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,U)),W.max-F.d<=n||(A=W.h/2,D.push(new Jl(W.p.x-A,W.p.y-A,A,s)),D.push(new Jl(W.p.x+A,W.p.y-A,A,s)),D.push(new Jl(W.p.x-A,W.p.y+A,A,s)),D.push(new Jl(W.p.x+A,W.p.y+A,A,s)),U+=4)}return c&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function bv(s,n){return n.max-s.max}function Jl(s,n,c,f){this.p=new S(s,n),this.h=c,this.d=function(_,w){let x=!1,T=1/0;for(let C=0;C<w.length;C++){const A=w[C];for(let D=0,F=A.length,U=F-1;D<F;U=D++){const W=A[D],Q=A[U];W.y>_.y!=Q.y>_.y&&_.x<(Q.x-W.x)*(_.y-W.y)/(Q.y-W.y)+W.x&&(x=!x),T=Math.min(T,hm(_,W,Q))}}return(x?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var sr;d.aq=void 0,(sr=d.aq||(d.aq={}))[sr.center=1]="center",sr[sr.left=2]="left",sr[sr.right=3]="right",sr[sr.top=4]="top",sr[sr.bottom=5]="bottom",sr[sr["top-left"]=6]="top-left",sr[sr["top-right"]=7]="top-right",sr[sr["bottom-left"]=8]="bottom-left",sr[sr["bottom-right"]=9]="bottom-right";const aa=7,Hf=Number.POSITIVE_INFINITY;function L_(s,n){return n[1]!==Hf?function(c,f,_){let w=0,x=0;switch(f=Math.abs(f),_=Math.abs(_),c){case"top-right":case"top-left":case"top":x=_-aa;break;case"bottom-right":case"bottom-left":case"bottom":x=-_+aa}switch(c){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(s,n[0],n[1]):function(c,f){let _=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(c){case"top-right":case"top-left":w=x-aa;break;case"bottom-right":case"bottom-left":w=-x+aa;break;case"bottom":w=-f+aa;break;case"top":w=f-aa}switch(c){case"top-right":case"bottom-right":_=-x;break;case"top-left":case"bottom-left":_=x;break;case"left":_=f;break;case"right":_=-f}return[_,w]}(s,n[0])}function M_(s,n,c){var f;const _=s.layout,w=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(n,{},c);if(w){const T=w.values,C=[];for(let A=0;A<T.length;A+=2){const D=C[A]=T[A],F=T[A+1].map(U=>U*jn);D.startsWith("top")?F[1]-=aa:D.startsWith("bottom")&&(F[1]+=aa),C[A+1]=F}return new Xr(C)}const x=_.get("text-variable-anchor");if(x){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(n,{},c)*jn,Hf]:_.get("text-offset").evaluate(n,{},c).map(A=>A*jn);const C=[];for(const A of x)C.push(A,L_(A,T));return new Xr(C)}return null}function Xf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vv(s,n,c,f,_,w,x,T,C,A,D){let F=w.textMaxSize.evaluate(n,{});F===void 0&&(F=x);const U=s.layers[0].layout,W=U.get("icon-offset").evaluate(n,{},D),Q=P_(c.horizontal),re=x/24,_e=s.tilePixelRatio*re,be=s.tilePixelRatio*F/24,Ze=s.tilePixelRatio*T,Ae=s.tilePixelRatio*U.get("symbol-spacing"),Oe=U.get("text-padding")*s.tilePixelRatio,Je=function(tt,Zt,Ut,ii=1){const Ji=tt.get("icon-padding").evaluate(Zt,{},Ut),Xi=Ji&&Ji.values;return[Xi[0]*ii,Xi[1]*ii,Xi[2]*ii,Xi[3]*ii]}(U,n,D,s.tilePixelRatio),_t=U.get("text-max-angle")/180*Math.PI,Mt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Kt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ct=U.get("symbol-placement"),Tt=Ae/2,$t=U.get("icon-text-fit");let Rt;f&&$t!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Rt=t_(f,c.vertical,$t,U.get("icon-text-fit-padding"),W,re)),Q&&(f=t_(f,Q,$t,U.get("icon-text-fit-padding"),W,re)));const Pt=(tt,Zt)=>{Zt.x<0||Zt.x>=Fn||Zt.y<0||Zt.y>=Fn||function(Ut,ii,Ji,Xi,Gn,To,ar,Wn,Ir,Cr,Er,Ln,Hn,_r,lr,Lr,cr,po,qr,Pi,Qi,an,io,yn,Yl){const Xo=Ut.addToLineVertexArray(ii,Ji);let Ko,Io,mo,Yn,ps=0,Pu=0,F_=0,B_=0,np=-1,rp=-1;const ms={};let O_=Ol("");if(Ut.allowVerticalPlacement&&Xi.vertical){const gr=Wn.layout.get("text-rotate").evaluate(Qi,{},yn)+90;mo=new ud(Ir,ii,Cr,Er,Ln,Xi.vertical,Hn,_r,lr,gr),ar&&(Yn=new ud(Ir,ii,Cr,Er,Ln,ar,cr,po,lr,gr))}if(Gn){const gr=Wn.layout.get("icon-rotate").evaluate(Qi,{}),_o=Wn.layout.get("icon-text-fit")!=="none",Ha=C_(Gn,gr,io,_o),Oo=ar?C_(ar,gr,io,_o):void 0;Io=new ud(Ir,ii,Cr,Er,Ln,Gn,cr,po,!1,gr),ps=4*Ha.length;const Xa=Ut.iconSizeData;let Jo=null;Xa.kind==="source"?(Jo=[Ho*Wn.layout.get("icon-size").evaluate(Qi,{})],Jo[0]>ra&&Ge(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Cu}. Reduce your "icon-size".`)):Xa.kind==="composite"&&(Jo=[Ho*an.compositeIconSizes[0].evaluate(Qi,{},yn),Ho*an.compositeIconSizes[1].evaluate(Qi,{},yn)],(Jo[0]>ra||Jo[1]>ra)&&Ge(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Cu}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Ha,Jo,Pi,qr,Qi,d.ah.none,ii,Xo.lineStartIndex,Xo.lineLength,-1,yn),np=Ut.icon.placedSymbolArray.length-1,Oo&&(Pu=4*Oo.length,Ut.addSymbols(Ut.icon,Oo,Jo,Pi,qr,Qi,d.ah.vertical,ii,Xo.lineStartIndex,Xo.lineLength,-1,yn),rp=Ut.icon.placedSymbolArray.length-1)}const N_=Object.keys(Xi.horizontal);for(const gr of N_){const _o=Xi.horizontal[gr];if(!Ko){O_=Ol(_o.text);const Oo=Wn.layout.get("text-rotate").evaluate(Qi,{},yn);Ko=new ud(Ir,ii,Cr,Er,Ln,_o,Hn,_r,lr,Oo)}const Ha=_o.positionedLines.length===1;if(F_+=A_(Ut,ii,_o,To,Wn,lr,Qi,Lr,Xo,Xi.vertical?d.ah.horizontal:d.ah.horizontalOnly,Ha?N_:[gr],ms,np,an,yn),Ha)break}Xi.vertical&&(B_+=A_(Ut,ii,Xi.vertical,To,Wn,lr,Qi,Lr,Xo,d.ah.vertical,["vertical"],ms,rp,an,yn));const kv=Ko?Ko.boxStartIndex:Ut.collisionBoxArray.length,Sv=Ko?Ko.boxEndIndex:Ut.collisionBoxArray.length,Tv=mo?mo.boxStartIndex:Ut.collisionBoxArray.length,Iv=mo?mo.boxEndIndex:Ut.collisionBoxArray.length,Cv=Io?Io.boxStartIndex:Ut.collisionBoxArray.length,Ev=Io?Io.boxEndIndex:Ut.collisionBoxArray.length,Lv=Yn?Yn.boxStartIndex:Ut.collisionBoxArray.length,Mv=Yn?Yn.boxEndIndex:Ut.collisionBoxArray.length;let Bo=-1;const dd=(gr,_o)=>gr&&gr.circleDiameter?Math.max(gr.circleDiameter,_o):_o;Bo=dd(Ko,Bo),Bo=dd(mo,Bo),Bo=dd(Io,Bo),Bo=dd(Yn,Bo);const j_=Bo>-1?1:0;j_&&(Bo*=Yl/jn),Ut.glyphOffsetArray.length>=Xl.MAX_GLYPHS&&Ge("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qi.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Qi.sortKey);const Av=M_(Wn,Qi,yn),[Pv,zv]=function(gr,_o){const Ha=gr.length,Oo=_o==null?void 0:_o.values;if((Oo==null?void 0:Oo.length)>0)for(let Xa=0;Xa<Oo.length;Xa+=2){const Jo=Oo[Xa+1];gr.emplaceBack(d.aq[Oo[Xa]],Jo[0],Jo[1])}return[Ha,gr.length]}(Ut.textAnchorOffsets,Av);Ut.symbolInstances.emplaceBack(ii.x,ii.y,ms.right>=0?ms.right:-1,ms.center>=0?ms.center:-1,ms.left>=0?ms.left:-1,ms.vertical||-1,np,rp,O_,kv,Sv,Tv,Iv,Cv,Ev,Lv,Mv,Cr,F_,B_,ps,Pu,j_,0,Hn,Bo,Pv,zv)}(s,Zt,tt,c,f,_,Rt,s.layers[0],s.collisionBoxArray,n.index,n.sourceLayerIndex,s.index,_e,[Oe,Oe,Oe,Oe],Mt,C,Ze,Je,Kt,W,n,w,A,D,x)};if(Ct==="line")for(const tt of w_(n.geometry,0,0,Fn,Fn)){const Zt=_v(tt,Ae,_t,c.vertical||Q,f,24,be,s.overscaling,Fn);for(const Ut of Zt)Q&&wv(s,Q.text,Tt,Ut)||Pt(tt,Ut)}else if(Ct==="line-center"){for(const tt of n.geometry)if(tt.length>1){const Zt=mv(tt,_t,c.vertical||Q,f,24,be);Zt&&Pt(tt,Zt)}}else if(n.type==="Polygon")for(const tt of pl(n.geometry,0)){const Zt=yv(tt,16);Pt(tt[0],new sa(Zt.x,Zt.y,0))}else if(n.type==="LineString")for(const tt of n.geometry)Pt(tt,new sa(tt[0].x,tt[0].y,0));else if(n.type==="Point")for(const tt of n.geometry)for(const Zt of tt)Pt([Zt],new sa(Zt.x,Zt.y,0))}function A_(s,n,c,f,_,w,x,T,C,A,D,F,U,W,Q){const re=function(Ze,Ae,Oe,Je,_t,Mt,Kt,Ct){const Tt=Je.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,$t=[];for(const Rt of Ae.positionedLines)for(const Pt of Rt.positionedGlyphs){if(!Pt.rect)continue;const tt=Pt.rect||{};let Zt=Wm+1,Ut=!0,ii=1,Ji=0;const Xi=(_t||Ct)&&Pt.vertical,Gn=Pt.metrics.advance*Pt.scale/2;if(Ct&&Ae.verticalizable&&(Ji=Rt.lineOffset/2-(Pt.imageName?-(jn-Pt.metrics.width*Pt.scale)/2:(Pt.scale-1)*jn)),Pt.imageName){const Pi=Kt[Pt.imageName];Ut=Pi.sdf,ii=Pi.pixelRatio,Zt=Vr/ii}const To=_t?[Pt.x+Gn,Pt.y]:[0,0];let ar=_t?[0,0]:[Pt.x+Gn+Oe[0],Pt.y+Oe[1]-Ji],Wn=[0,0];Xi&&(Wn=ar,ar=[0,0]);const Ir=Pt.metrics.isDoubleResolution?2:1,Cr=(Pt.metrics.left-Zt)*Pt.scale-Gn+ar[0],Er=(-Pt.metrics.top-Zt)*Pt.scale+ar[1],Ln=Cr+tt.w/Ir*Pt.scale/ii,Hn=Er+tt.h/Ir*Pt.scale/ii,_r=new S(Cr,Er),lr=new S(Ln,Er),Lr=new S(Cr,Hn),cr=new S(Ln,Hn);if(Xi){const Pi=new S(-Gn,Gn-Tu),Qi=-Math.PI/2,an=jn/2-Gn,io=new S(5-Tu-an,-(Pt.imageName?an:0)),yn=new S(...Wn);_r._rotateAround(Qi,Pi)._add(io)._add(yn),lr._rotateAround(Qi,Pi)._add(io)._add(yn),Lr._rotateAround(Qi,Pi)._add(io)._add(yn),cr._rotateAround(Qi,Pi)._add(io)._add(yn)}if(Tt){const Pi=Math.sin(Tt),Qi=Math.cos(Tt),an=[Qi,-Pi,Pi,Qi];_r._matMult(an),lr._matMult(an),Lr._matMult(an),cr._matMult(an)}const po=new S(0,0),qr=new S(0,0);$t.push({tl:_r,tr:lr,bl:Lr,br:cr,tex:tt,writingMode:Ae.writingMode,glyphOffset:To,sectionIndex:Pt.sectionIndex,isSDF:Ut,pixelOffsetTL:po,pixelOffsetBR:qr,minFontScaleX:0,minFontScaleY:0})}return $t}(0,c,T,_,w,x,f,s.allowVerticalPlacement),_e=s.textSizeData;let be=null;_e.kind==="source"?(be=[Ho*_.layout.get("text-size").evaluate(x,{})],be[0]>ra&&Ge(`${s.layerIds[0]}: Value for "text-size" is >= ${Cu}. Reduce your "text-size".`)):_e.kind==="composite"&&(be=[Ho*W.compositeTextSizes[0].evaluate(x,{},Q),Ho*W.compositeTextSizes[1].evaluate(x,{},Q)],(be[0]>ra||be[1]>ra)&&Ge(`${s.layerIds[0]}: Value for "text-size" is >= ${Cu}. Reduce your "text-size".`)),s.addSymbols(s.text,re,be,T,w,x,A,n,C.lineStartIndex,C.lineLength,U,Q);for(const Ze of D)F[Ze]=s.text.placedSymbolArray.length-1;return 4*re.length}function P_(s){for(const n in s)return s[n];return null}function wv(s,n,c,f){const _=s.compareText;if(n in _){const w=_[n];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<c)return!0}else _[n]=[];return _[n].push(f),!1}const z_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kf{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(n,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const w=z_[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new Kf(T,x,w,n)}constructor(n,c=64,f=Float64Array,_){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const w=z_.indexOf(this.ArrayType),x=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-T%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+C,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+C),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+C,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=n)}add(n,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=n,this.coords[this._pos++]=c,f}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Jf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,c,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:T}=this,C=[0,w.length-1,0],A=[];for(;C.length;){const D=C.pop()||0,F=C.pop()||0,U=C.pop()||0;if(F-U<=T){for(let _e=U;_e<=F;_e++){const be=x[2*_e],Ze=x[2*_e+1];be>=n&&be<=f&&Ze>=c&&Ze<=_&&A.push(w[_e])}continue}const W=U+F>>1,Q=x[2*W],re=x[2*W+1];Q>=n&&Q<=f&&re>=c&&re<=_&&A.push(w[W]),(D===0?n<=Q:c<=re)&&(C.push(U),C.push(W-1),C.push(1-D)),(D===0?f>=Q:_>=re)&&(C.push(W+1),C.push(F),C.push(1-D))}return A}within(n,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:w,nodeSize:x}=this,T=[0,_.length-1,0],C=[],A=f*f;for(;T.length;){const D=T.pop()||0,F=T.pop()||0,U=T.pop()||0;if(F-U<=x){for(let _e=U;_e<=F;_e++)R_(w[2*_e],w[2*_e+1],n,c)<=A&&C.push(_[_e]);continue}const W=U+F>>1,Q=w[2*W],re=w[2*W+1];R_(Q,re,n,c)<=A&&C.push(_[W]),(D===0?n-f<=Q:c-f<=re)&&(T.push(U),T.push(W-1),T.push(1-D)),(D===0?n+f>=Q:c+f>=re)&&(T.push(W+1),T.push(F),T.push(1-D))}return C}}function Jf(s,n,c,f,_,w){if(_-f<=c)return;const x=f+_>>1;D_(s,n,x,f,_,w),Jf(s,n,c,f,x-1,1-w),Jf(s,n,c,x+1,_,1-w)}function D_(s,n,c,f,_,w){for(;_>f;){if(_-f>600){const A=_-f+1,D=c-f+1,F=Math.log(A),U=.5*Math.exp(2*F/3),W=.5*Math.sqrt(F*U*(A-U)/A)*(D-A/2<0?-1:1);D_(s,n,c,Math.max(f,Math.floor(c-D*U/A+W)),Math.min(_,Math.floor(c+(A-D)*U/A+W)),w)}const x=n[2*c+w];let T=f,C=_;for(Mu(s,n,f,c),n[2*_+w]>x&&Mu(s,n,f,_);T<C;){for(Mu(s,n,T,C),T++,C--;n[2*T+w]<x;)T++;for(;n[2*C+w]>x;)C--}n[2*f+w]===x?Mu(s,n,f,C):(C++,Mu(s,n,C,_)),C<=c&&(f=C+1),c<=C&&(_=C-1)}}function Mu(s,n,c,f){Yf(s,c,f),Yf(n,2*c,2*f),Yf(n,2*c+1,2*f+1)}function Yf(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}function R_(s,n,c,f){const _=s-c,w=n-f;return _*_+w*w}var Qf;d.bg=void 0,(Qf=d.bg||(d.bg={})).create="create",Qf.load="load",Qf.fullLoad="fullLoad";let hd=null,Au=[];const ep=1e3/60,tp="loadTime",ip="fullLoadTime",xv={mark(s){performance.mark(s)},frame(s){const n=s;hd!=null&&Au.push(n-hd),hd=n},clearMetrics(){hd=null,Au=[],performance.clearMeasures(tp),performance.clearMeasures(ip);for(const s in d.bg)performance.clearMarks(d.bg[s])},getPerformanceMetrics(){performance.measure(tp,d.bg.create,d.bg.load),performance.measure(ip,d.bg.create,d.bg.fullLoad);const s=performance.getEntriesByName(tp)[0].duration,n=performance.getEntriesByName(ip)[0].duration,c=Au.length,f=1/(Au.reduce((w,x)=>w+x,0)/c/1e3),_=Au.filter(w=>w>ep).reduce((w,x)=>w+(x-ep)/ep,0);return{loadTime:s,fullLoadTime:n,fps:f,percentDroppedFrames:_/(c+_)*100,totalFrames:c}}};d.$=class extends O{},d.A=Vl,d.B=uf,d.C=function(s){if(rt==null){const n=s.navigator?s.navigator.userAgent:null;rt=!!s.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return rt},d.D=Ot,d.E=st,d.F=class{constructor(s,n){this.target=s,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new fv(()=>this.process()),this.subscription=function(c,f,_,w){return c.addEventListener(f,_,!1),{unsubscribe:()=>{c.removeEventListener(f,_,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=Pe(self)?s:window}registerMessageHandler(s,n){this.messageHandlers[s]=n}sendAsync(s,n){return new Promise((c,f)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:c,reject:f},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const T={id:_,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Gs(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const n=s.data,c=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(Pe(self)||n.mustQueue)return this.tasks[c]=n,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,n)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),n=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(s,n)}processTask(s,n){return a(this,void 0,void 0,function*(){if(n.type==="<response>"){const _=this.resolveRejects[s];return delete this.resolveRejects[s],_?void(n.error?_.reject(Ws(n.error)):_.resolve(Ws(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Ws(n.data),f=new AbortController;this.abortControllers[s]=f;try{const _=yield this.messageHandlers[n.type](n.sourceMapId,c,f);this.completeTask(s,null,_)}catch(_){this.completeTask(s,_)}})}completeTask(s,n,c){const f=[];delete this.abortControllers[s];const _={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?Gs(n):null,data:Gs(c,f)};this.target.postMessage(_,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.G=Ht,d.H=function(){var s=new Vl(16);return Vl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.I=Bf,d.J=function(s,n,c){var f,_,w,x,T,C,A,D,F,U,W,Q,re=c[0],_e=c[1],be=c[2];return n===s?(s[12]=n[0]*re+n[4]*_e+n[8]*be+n[12],s[13]=n[1]*re+n[5]*_e+n[9]*be+n[13],s[14]=n[2]*re+n[6]*_e+n[10]*be+n[14],s[15]=n[3]*re+n[7]*_e+n[11]*be+n[15]):(_=n[1],w=n[2],x=n[3],T=n[4],C=n[5],A=n[6],D=n[7],F=n[8],U=n[9],W=n[10],Q=n[11],s[0]=f=n[0],s[1]=_,s[2]=w,s[3]=x,s[4]=T,s[5]=C,s[6]=A,s[7]=D,s[8]=F,s[9]=U,s[10]=W,s[11]=Q,s[12]=f*re+T*_e+F*be+n[12],s[13]=_*re+C*_e+U*be+n[13],s[14]=w*re+A*_e+W*be+n[14],s[15]=x*re+D*_e+Q*be+n[15]),s},d.K=function(s,n,c){var f=c[0],_=c[1],w=c[2];return s[0]=n[0]*f,s[1]=n[1]*f,s[2]=n[2]*f,s[3]=n[3]*f,s[4]=n[4]*_,s[5]=n[5]*_,s[6]=n[6]*_,s[7]=n[7]*_,s[8]=n[8]*w,s[9]=n[9]*w,s[10]=n[10]*w,s[11]=n[11]*w,s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.L=mm,d.M=function(s,n){const c={};for(let f=0;f<n.length;f++){const _=n[f];_ in s&&(c[_]=s[_])}return c},d.N=oa,d.O=u_,d.P=S,d.Q=h_,d.R=ho,d.S=fo,d.T=zl,d.U=H,d.V=G,d.W=Ft,d.X=Fn,d.Y=I,d.Z=Eu,d._=a,d.a=Bt,d.a$=function(s,n){var c=s[0],f=s[1],_=s[2],w=s[3],x=s[4],T=s[5],C=s[6],A=s[7],D=s[8],F=s[9],U=s[10],W=s[11],Q=s[12],re=s[13],_e=s[14],be=s[15],Ze=n[0],Ae=n[1],Oe=n[2],Je=n[3],_t=n[4],Mt=n[5],Kt=n[6],Ct=n[7],Tt=n[8],$t=n[9],Rt=n[10],Pt=n[11],tt=n[12],Zt=n[13],Ut=n[14],ii=n[15];return Math.abs(c-Ze)<=Tr*Math.max(1,Math.abs(c),Math.abs(Ze))&&Math.abs(f-Ae)<=Tr*Math.max(1,Math.abs(f),Math.abs(Ae))&&Math.abs(_-Oe)<=Tr*Math.max(1,Math.abs(_),Math.abs(Oe))&&Math.abs(w-Je)<=Tr*Math.max(1,Math.abs(w),Math.abs(Je))&&Math.abs(x-_t)<=Tr*Math.max(1,Math.abs(x),Math.abs(_t))&&Math.abs(T-Mt)<=Tr*Math.max(1,Math.abs(T),Math.abs(Mt))&&Math.abs(C-Kt)<=Tr*Math.max(1,Math.abs(C),Math.abs(Kt))&&Math.abs(A-Ct)<=Tr*Math.max(1,Math.abs(A),Math.abs(Ct))&&Math.abs(D-Tt)<=Tr*Math.max(1,Math.abs(D),Math.abs(Tt))&&Math.abs(F-$t)<=Tr*Math.max(1,Math.abs(F),Math.abs($t))&&Math.abs(U-Rt)<=Tr*Math.max(1,Math.abs(U),Math.abs(Rt))&&Math.abs(W-Pt)<=Tr*Math.max(1,Math.abs(W),Math.abs(Pt))&&Math.abs(Q-tt)<=Tr*Math.max(1,Math.abs(Q),Math.abs(tt))&&Math.abs(re-Zt)<=Tr*Math.max(1,Math.abs(re),Math.abs(Zt))&&Math.abs(_e-Ut)<=Tr*Math.max(1,Math.abs(_e),Math.abs(Ut))&&Math.abs(be-ii)<=Tr*Math.max(1,Math.abs(be),Math.abs(ii))},d.a0=Ti,d.a1=Wf,d.a2=ct,d.a3=s=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(c=>{n.onloadstart=()=>{c(n)};for(const f of s){const _=window.document.createElement("source");Fi(f)||(n.crossOrigin="Anonymous"),_.src=f,n.appendChild(_)}})},d.a4=function(){return K++},d.a5=Lt,d.a6=Xl,d.a7=Hc,d.a8=Ga,d.a9=g_,d.aA=function(s){if(s.type==="custom")return new dv(s);switch(s.type){case"background":return new cv(s);case"circle":return new K1(s);case"fill":return new fb(s);case"fill-extrusion":return new Eb(s);case"heatmap":return new Y1(s);case"hillshade":return new eb(s);case"line":return new Fb(s);case"raster":return new hv(s);case"symbol":return new sd(s)}},d.aB=ce,d.aC=function(s,n){if(!s)return[{command:"setStyle",args:[n]}];let c=[];try{if(!Ce(s.version,n.version))return[{command:"setStyle",args:[n]}];Ce(s.center,n.center)||c.push({command:"setCenter",args:[n.center]}),Ce(s.zoom,n.zoom)||c.push({command:"setZoom",args:[n.zoom]}),Ce(s.bearing,n.bearing)||c.push({command:"setBearing",args:[n.bearing]}),Ce(s.pitch,n.pitch)||c.push({command:"setPitch",args:[n.pitch]}),Ce(s.sprite,n.sprite)||c.push({command:"setSprite",args:[n.sprite]}),Ce(s.glyphs,n.glyphs)||c.push({command:"setGlyphs",args:[n.glyphs]}),Ce(s.transition,n.transition)||c.push({command:"setTransition",args:[n.transition]}),Ce(s.light,n.light)||c.push({command:"setLight",args:[n.light]}),Ce(s.terrain,n.terrain)||c.push({command:"setTerrain",args:[n.terrain]}),Ce(s.sky,n.sky)||c.push({command:"setSky",args:[n.sky]}),Ce(s.projection,n.projection)||c.push({command:"setProjection",args:[n.projection]});const f={},_=[];(function(x,T,C,A){let D;for(D in T=T||{},x=x||{})Object.prototype.hasOwnProperty.call(x,D)&&(Object.prototype.hasOwnProperty.call(T,D)||vi(D,C,A));for(D in T)Object.prototype.hasOwnProperty.call(T,D)&&(Object.prototype.hasOwnProperty.call(x,D)?Ce(x[D],T[D])||(x[D].type==="geojson"&&T[D].type==="geojson"&&Ci(x,T,D)?nt(C,{command:"setGeoJSONSourceData",args:[D,T[D].data]}):ji(D,T,C,A)):Xt(D,T,C))})(s.sources,n.sources,_,f);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&f[x.source]?c.push({command:"removeLayer",args:[x.id]}):w.push(x)}),c=c.concat(_),function(x,T,C){T=T||[];const A=(x=x||[]).map(Bi),D=T.map(Bi),F=x.reduce(br,{}),U=T.reduce(br,{}),W=A.slice(),Q=Object.create(null);let re,_e,be,Ze,Ae;for(let Oe=0,Je=0;Oe<A.length;Oe++)re=A[Oe],Object.prototype.hasOwnProperty.call(U,re)?Je++:(nt(C,{command:"removeLayer",args:[re]}),W.splice(W.indexOf(re,Je),1));for(let Oe=0,Je=0;Oe<D.length;Oe++)re=D[D.length-1-Oe],W[W.length-1-Oe]!==re&&(Object.prototype.hasOwnProperty.call(F,re)?(nt(C,{command:"removeLayer",args:[re]}),W.splice(W.lastIndexOf(re,W.length-Je),1)):Je++,Ze=W[W.length-Oe],nt(C,{command:"addLayer",args:[U[re],Ze]}),W.splice(W.length-Oe,0,re),Q[re]=!0);for(let Oe=0;Oe<D.length;Oe++)if(re=D[Oe],_e=F[re],be=U[re],!Q[re]&&!Ce(_e,be))if(Ce(_e.source,be.source)&&Ce(_e["source-layer"],be["source-layer"])&&Ce(_e.type,be.type)){for(Ae in _i(_e.layout,be.layout,C,re,null,"setLayoutProperty"),_i(_e.paint,be.paint,C,re,null,"setPaintProperty"),Ce(_e.filter,be.filter)||nt(C,{command:"setFilter",args:[re,be.filter]}),Ce(_e.minzoom,be.minzoom)&&Ce(_e.maxzoom,be.maxzoom)||nt(C,{command:"setLayerZoomRange",args:[re,be.minzoom,be.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?_i(_e[Ae],be[Ae],C,re,Ae.slice(6),"setPaintProperty"):Ce(_e[Ae],be[Ae])||nt(C,{command:"setLayerProperty",args:[re,Ae,be[Ae]]}));for(Ae in be)Object.prototype.hasOwnProperty.call(be,Ae)&&!Object.prototype.hasOwnProperty.call(_e,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?_i(_e[Ae],be[Ae],C,re,Ae.slice(6),"setPaintProperty"):Ce(_e[Ae],be[Ae])||nt(C,{command:"setLayerProperty",args:[re,Ae,be[Ae]]}))}else nt(C,{command:"removeLayer",args:[re]}),Ze=W[W.lastIndexOf(re)+1],nt(C,{command:"addLayer",args:[be,Ze]})}(w,n.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[n]}]}return c},d.aD=function(s){const n=[],c=s.id;return c===void 0&&n.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&n.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&n.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),n},d.aE=function s(n,c){if(Array.isArray(n)){if(!Array.isArray(c)||n.length!==c.length)return!1;for(let f=0;f<n.length;f++)if(!s(n[f],c[f]))return!1;return!0}if(typeof n=="object"&&n!==null&&c!==null){if(typeof c!="object"||Object.keys(n).length!==Object.keys(c).length)return!1;for(const f in n)if(!s(n[f],c[f]))return!1;return!0}return n===c},d.aF=ue,d.aG=fe,d.aH=class extends Va{constructor(s,n){super(s,n),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.aI=Wh,d.aJ=class extends Va{constructor(s,n){super(s,n),this.current=$1}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let n=1;n<16;n++)if(s[n]!==this.current[n]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.aK=rm,d.aL=om,d.aM=Zi,d.aN=class extends Va{constructor(s,n){super(s,n),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.aO=class extends Va{constructor(s,n){super(s,n),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.aP=function(s,n,c,f,_,w,x){var T=1/(n-c),C=1/(f-_),A=1/(w-x);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*C,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*A,s[11]=0,s[12]=(n+c)*T,s[13]=(_+f)*C,s[14]=(x+w)*A,s[15]=1,s},d.aQ=X1,d.aR=class extends De{},d.aS=jb,d.aT=class extends He{},d.aU=Tf,d.aV=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},d.aW=vm,d.aX=rr,d.aY=uo,d.aZ=class extends Nt{},d.a_=function(s,n){return s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]&&s[3]===n[3]&&s[4]===n[4]&&s[5]===n[5]&&s[6]===n[6]&&s[7]===n[7]&&s[8]===n[8]&&s[9]===n[9]&&s[10]===n[10]&&s[11]===n[11]&&s[12]===n[12]&&s[13]===n[13]&&s[14]===n[14]&&s[15]===n[15]},d.aa=function(s){const n={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,_,w)=>{const x=_||w;return n[f]=!x||x.toLowerCase(),""}),n["max-age"]){const c=parseInt(n["max-age"],10);isNaN(c)?delete n["max-age"]:n["max-age"]=c}return n},d.ab=function(s,n){const c=[];for(const f in s)f in n||c.push(f);return c},d.ac=xe,d.ad=function(s,n,c){var f=Math.sin(c),_=Math.cos(c),w=n[0],x=n[1],T=n[2],C=n[3],A=n[4],D=n[5],F=n[6],U=n[7];return n!==s&&(s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[0]=w*_+A*f,s[1]=x*_+D*f,s[2]=T*_+F*f,s[3]=C*_+U*f,s[4]=A*_-w*f,s[5]=D*_-x*f,s[6]=F*_-T*f,s[7]=U*_-C*f,s},d.ae=function(s){var n=new Vl(16);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},d.af=Jh,d.ag=function(s,n){let c=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:_,minZoom:w,maxZoom:x}=s,T=_?xe(kr.interpolationFactor(_,n,w,x),0,1):0;s.kind==="camera"?f=xr.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(s,{uSize:n,uSizeT:c},{lowerSize:f,upperSize:_}){return s.kind==="source"?f/Ho:s.kind==="composite"?xr.number(f/Ho,_/Ho,c):n},d.aj=Uf,d.ak=function(s,n,c,f){const _=n.y-s.y,w=n.x-s.x,x=f.y-c.y,T=f.x-c.x,C=x*w-T*_;if(C===0)return null;const A=(T*(s.y-c.y)-x*(s.x-c.x))/C;return new S(s.x+A*w,s.y+A*_)},d.al=w_,d.am=cm,d.an=xf,d.ao=function(s){let n=1/0,c=1/0,f=-1/0,_=-1/0;for(const w of s)n=Math.min(n,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return[n,c,f,_]},d.ap=jn,d.ar=jf,d.as=function(s,n){var c=n[0],f=n[1],_=n[2],w=n[3],x=n[4],T=n[5],C=n[6],A=n[7],D=n[8],F=n[9],U=n[10],W=n[11],Q=n[12],re=n[13],_e=n[14],be=n[15],Ze=c*T-f*x,Ae=c*C-_*x,Oe=c*A-w*x,Je=f*C-_*T,_t=f*A-w*T,Mt=_*A-w*C,Kt=D*re-F*Q,Ct=D*_e-U*Q,Tt=D*be-W*Q,$t=F*_e-U*re,Rt=F*be-W*re,Pt=U*be-W*_e,tt=Ze*Pt-Ae*Rt+Oe*$t+Je*Tt-_t*Ct+Mt*Kt;return tt?(s[0]=(T*Pt-C*Rt+A*$t)*(tt=1/tt),s[1]=(_*Rt-f*Pt-w*$t)*tt,s[2]=(re*Mt-_e*_t+be*Je)*tt,s[3]=(U*_t-F*Mt-W*Je)*tt,s[4]=(C*Tt-x*Pt-A*Ct)*tt,s[5]=(c*Pt-_*Tt+w*Ct)*tt,s[6]=(_e*Oe-Q*Mt-be*Ae)*tt,s[7]=(D*Mt-U*Oe+W*Ae)*tt,s[8]=(x*Rt-T*Tt+A*Kt)*tt,s[9]=(f*Tt-c*Rt-w*Kt)*tt,s[10]=(Q*_t-re*Oe+be*Ze)*tt,s[11]=(F*Oe-D*_t-W*Ze)*tt,s[12]=(T*Ct-x*$t-C*Kt)*tt,s[13]=(c*$t-f*Ct+_*Kt)*tt,s[14]=(re*Ae-Q*Je-_e*Ze)*tt,s[15]=(D*Je-F*Ae+U*Ze)*tt,s):null},d.at=Xf,d.au=Nf,d.av=Kf,d.aw=function(){const s={},n=Te.$version;for(const c in Te.$root){const f=Te.$root[c];if(f.required){let _=null;_=c==="version"?n:f.type==="array"?[]:{},_!=null&&(s[c]=_)}}return s},d.ax=lu,d.ay=ai,d.az=function(s){s=s.slice();const n=Object.create(null);for(let c=0;c<s.length;c++)n[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=gt(s[c],n[s[c].ref]));return s},d.b=it,d.b0=function(s,n){return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.b1=function(s,n,c){return s[0]=n[0]*c[0],s[1]=n[1]*c[1],s[2]=n[2]*c[2],s[3]=n[3]*c[3],s},d.b2=function(s,n){return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]+s[3]*n[3]},d.b3=Ie,d.b4=p_,d.b5=d_,d.b6=function(s,n,c,f,_){var w,x=1/Math.tan(n/2);return s[0]=x/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,_!=null&&_!==1/0?(s[10]=(_+f)*(w=1/(f-_)),s[14]=2*_*f*w):(s[10]=-1,s[14]=-2*f),s},d.b7=function(s,n,c){var f=Math.sin(c),_=Math.cos(c),w=n[4],x=n[5],T=n[6],C=n[7],A=n[8],D=n[9],F=n[10],U=n[11];return n!==s&&(s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[4]=w*_+A*f,s[5]=x*_+D*f,s[6]=T*_+F*f,s[7]=C*_+U*f,s[8]=A*_-w*f,s[9]=D*_-x*f,s[10]=F*_-T*f,s[11]=U*_-C*f,s},d.b8=X,d.b9=le,d.bA=jm,d.bB=function(s){return s.message===et},d.bC=Ns,d.bD=Ur,d.ba=function(s){return s*Math.PI/180},d.bb=function(s,n){const{x:c,y:f}=Eu.fromLngLat(n);return!(s<0||s>25||f<0||f>=1||c<0||c>=1)},d.bc=function(s,n){return s[0]=n[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.bd=class extends R{},d.be=Zf,d.bf=xv,d.bh=li,d.bi=function(s,n){Bt.REGISTERED_PROTOCOLS[s]=n},d.bj=function(s){delete Bt.REGISTERED_PROTOCOLS[s]},d.bk=function(s,n){const c={};for(let _=0;_<s.length;_++){const w=n&&n[s[_].id]||Rh(s[_]);n&&(n[s[_].id]=w);let x=c[w];x||(x=c[w]=[]),x.push(s[_])}const f=[];for(const _ in c)f.push(c[_]);return f},d.bl=zt,d.bm=__,d.bn=y_,d.bo=Xm,d.bp=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Fn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const n=s.bucket.layers[0],c=n.layout,f=n._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new nn(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new nn(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new nn(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:D}=s.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new nn(A),s.canonical),f["text-size"].possiblyEvaluate(new nn(D),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:D}=s.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new nn(A),s.canonical),f["icon-size"].possiblyEvaluate(new nn(D),s.canonical)]}const w=c.get("text-line-height")*jn,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),C=c.get("text-size");for(const A of s.bucket.features){const D=c.get("text-font").evaluate(A,{},s.canonical).join(","),F=C.evaluate(A,{},s.canonical),U=_.layoutTextSize.evaluate(A,{},s.canonical),W=_.layoutIconSize.evaluate(A,{},s.canonical),Q={horizontal:{},vertical:void 0},re=A.text;let _e,be=[0,0];if(re){const Oe=re.toString(),Je=c.get("text-letter-spacing").evaluate(A,{},s.canonical)*jn,_t=hf(Oe)?Je:0,Mt=c.get("text-anchor").evaluate(A,{},s.canonical),Kt=M_(n,A,s.canonical);if(!Kt){const Rt=c.get("text-radial-offset").evaluate(A,{},s.canonical);be=Rt?L_(Mt,[Rt*jn,Hf]):c.get("text-offset").evaluate(A,{},s.canonical).map(Pt=>Pt*jn)}let Ct=x?"center":c.get("text-justify").evaluate(A,{},s.canonical);const Tt=c.get("symbol-placement")==="point"?c.get("text-max-width").evaluate(A,{},s.canonical)*jn:1/0,$t=()=>{s.bucket.allowVerticalPlacement&&cu(Oe)&&(Q.vertical=nd(re,s.glyphMap,s.glyphPositions,s.imagePositions,D,Tt,w,Mt,"left",_t,be,d.ah.vertical,!0,U,F))};if(!x&&Kt){const Rt=new Set;if(Ct==="auto")for(let tt=0;tt<Kt.values.length;tt+=2)Rt.add(Xf(Kt.values[tt]));else Rt.add(Ct);let Pt=!1;for(const tt of Rt)if(!Q.horizontal[tt])if(Pt)Q.horizontal[tt]=Q.horizontal[0];else{const Zt=nd(re,s.glyphMap,s.glyphPositions,s.imagePositions,D,Tt,w,"center",tt,_t,be,d.ah.horizontal,!1,U,F);Zt&&(Q.horizontal[tt]=Zt,Pt=Zt.positionedLines.length===1)}$t()}else{Ct==="auto"&&(Ct=Xf(Mt));const Rt=nd(re,s.glyphMap,s.glyphPositions,s.imagePositions,D,Tt,w,Mt,Ct,_t,be,d.ah.horizontal,!1,U,F);Rt&&(Q.horizontal[Ct]=Rt),$t(),cu(Oe)&&x&&T&&(Q.vertical=nd(re,s.glyphMap,s.glyphPositions,s.imagePositions,D,Tt,w,Mt,Ct,_t,be,d.ah.vertical,!1,U,F))}}let Ze=!1;if(A.icon&&A.icon.name){const Oe=s.imageMap[A.icon.name];Oe&&(_e=rv(s.imagePositions[A.icon.name],c.get("icon-offset").evaluate(A,{},s.canonical),c.get("icon-anchor").evaluate(A,{},s.canonical)),Ze=!!Oe.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Ze:s.bucket.sdfIcons!==Ze&&Ge("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Ae=P_(Q.horizontal)||Q.vertical;s.bucket.iconsInText=!!Ae&&Ae.iconsInText,(Ae||_e)&&vv(s.bucket,A,Q,_e,s.imageMap,_,U,W,be,Ze,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},d.bq=zf,d.br=Mf,d.bs=Pf,d.bt=ia,d.bu=Rf,d.bv=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},d.bw=function(s,n,c,f,_){return a(this,void 0,void 0,function*(){if(G())try{return yield Ft(s,n,c,f,_)}catch{}return function(w,x,T,C,A){const D=w.width,F=w.height;jt&&ut||(jt=new OffscreenCanvas(D,F),ut=jt.getContext("2d",{willReadFrequently:!0})),jt.width=D,jt.height=F,ut.drawImage(w,0,0,D,F);const U=ut.getImageData(x,T,C,A);return ut.clearRect(0,0,D,F),U.data}(s,n,c,f,_)})},d.bx=m_,d.by=g,d.bz=v,d.c=at,d.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(n)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=Y,d.f=s=>new Promise((n,c)=>{const f=new Image;f.onload=()=>{n(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Qe})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(_):Qe}),d.g=Dt,d.h=(s,n)=>ki(Y(s,{type:"json"}),n),d.i=Pe,d.j=qe,d.k=lt,d.l=(s,n)=>ki(Y(s,{type:"arrayBuffer"}),n),d.m=ki,d.n=function(s){return new Rf(s).readFields(Jb,[])},d.o=yu,d.p=Hm,d.q=b,d.r=cf,d.s=Fi,d.t=su,d.u=us,d.v=Te,d.w=Ge,d.x=function([s,n,c]){return n+=90,n*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(n)*Math.sin(c),y:s*Math.sin(n)*Math.sin(c),z:s*Math.cos(c)}},d.y=xr,d.z=nn}),l("worker",["./shared"],function(d){class a{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,q){for(const pe of Z){this._layerConfigs[pe.id]=pe;const Me=this._layers[pe.id]=d.aA(pe);Me._featureFilter=d.a7(Me.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of q)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const ne=d.bk(Object.values(this._layerConfigs),this.keyCache);for(const pe of ne){const Me=pe.map($e=>this._layers[$e.id]),ze=Me[0];if(ze.visibility==="none")continue;const Ve=ze.source||"";let j=this.familiesBySource[Ve];j||(j=this.familiesBySource[Ve]={});const Re=ze.sourceLayer||"_geojsonTileLayer";let Ke=j[Re];Ke||(Ke=j[Re]=[]),Ke.push(Me)}}}class g{constructor(Z){const q={},ne=[];for(const Ve in Z){const j=Z[Ve],Re=q[Ve]={};for(const Ke in j){const $e=j[+Ke];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Xe={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};ne.push(Xe),Re[Ke]={rect:Xe,metrics:$e.metrics}}}const{w:pe,h:Me}=d.p(ne),ze=new d.o({width:pe||1,height:Me||1});for(const Ve in Z){const j=Z[Ve];for(const Re in j){const Ke=j[+Re];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const $e=q[Ve][Re].rect;d.o.copy(Ke.bitmap,ze,{x:0,y:0},{x:$e.x+1,y:$e.y+1},Ke.bitmap)}}this.image=ze,this.positions=q}}d.bl("GlyphAtlas",g);class v{constructor(Z){this.tileID=new d.S(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[]}parse(Z,q,ne,pe){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new d.a5;const Me=new d.bm(Object.keys(Z.layers).sort()),ze=new d.bn(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Ve={},j={featureIndex:ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne},Re=q.familiesBySource[this.source];for(const mi in Re){const qi=Z.layers[mi];if(!qi)continue;qi.version===1&&d.w(`Vector tile source "${this.source}" layer "${mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const un=Me.encode(mi),Zn=[];for(let Kn=0;Kn<qi.length;Kn++){const fr=qi.feature(Kn),Es=ze.getId(fr,mi);Zn.push({feature:fr,id:Es,index:Kn,sourceLayerIndex:un})}for(const Kn of Re[mi]){const fr=Kn[0];fr.source!==this.source&&d.w(`layer.source = ${fr.source} does not equal this.source = ${this.source}`),fr.minzoom&&this.zoom<Math.floor(fr.minzoom)||fr.maxzoom&&this.zoom>=fr.maxzoom||fr.visibility!=="none"&&(k(Kn,this.zoom,ne),(Ve[fr.id]=fr.createBucket({index:ze.bucketLayerIDs.length,layers:Kn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:un,sourceID:this.source})).populate(Zn,j,this.tileID.canonical),ze.bucketLayerIDs.push(Kn.map(Es=>Es.id)))}}const Ke=d.aF(j.glyphDependencies,mi=>Object.keys(mi).map(Number));this.inFlightDependencies.forEach(mi=>mi==null?void 0:mi.abort()),this.inFlightDependencies=[];let $e=Promise.resolve({});if(Object.keys(Ke).length){const mi=new AbortController;this.inFlightDependencies.push(mi),$e=pe.sendAsync({type:"GG",data:{stacks:Ke,source:this.source,tileID:this.tileID,type:"glyphs"}},mi)}const Xe=Object.keys(j.iconDependencies);let mt=Promise.resolve({});if(Xe.length){const mi=new AbortController;this.inFlightDependencies.push(mi),mt=pe.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},mi)}const Et=Object.keys(j.patternDependencies);let pi=Promise.resolve({});if(Et.length){const mi=new AbortController;this.inFlightDependencies.push(mi),pi=pe.sendAsync({type:"GI",data:{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"}},mi)}const[Qt,hi,wi]=yield Promise.all([$e,mt,pi]),Dn=new g(Qt),gn=new d.bo(hi,wi);for(const mi in Ve){const qi=Ve[mi];qi instanceof d.a6?(k(qi.layers,this.zoom,ne),d.bp({bucket:qi,glyphMap:Qt,glyphPositions:Dn.positions,imageMap:hi,imagePositions:gn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):qi.hasPattern&&(qi instanceof d.bq||qi instanceof d.br||qi instanceof d.bs)&&(k(qi.layers,this.zoom,ne),qi.addFeatures(j,this.tileID.canonical,gn.patternPositions))}return this.status="done",{buckets:Object.values(Ve).filter(mi=>!mi.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dn.image,imageAtlas:gn,glyphMap:this.returnDependencies?Qt:null,iconMap:this.returnDependencies?hi:null,glyphPositions:this.returnDependencies?Dn.positions:null}})}}function k(ye,Z,q){const ne=new d.z(Z);for(const pe of ye)pe.recalculate(ne,q)}class S{constructor(Z,q,ne){this.actor=Z,this.layerIndex=q,this.availableImages=ne,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Z,q){return d._(this,void 0,void 0,function*(){const ne=yield d.l(Z.request,q);try{return{vectorTile:new d.bt.VectorTile(new d.bu(ne.data)),rawData:ne.data,cacheControl:ne.cacheControl,expires:ne.expires}}catch(pe){const Me=new Uint8Array(ne.data);let ze=`Unable to parse the tile at ${Z.request.url}, `;throw ze+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${pe.message}`,new Error(ze)}})}loadTile(Z){return d._(this,void 0,void 0,function*(){const q=Z.uid,ne=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new d.bv(Z.request),pe=new v(Z);this.loading[q]=pe;const Me=new AbortController;pe.abort=Me;try{const ze=yield this.loadVectorTile(Z,Me);if(delete this.loading[q],!ze)return null;const Ve=ze.rawData,j={};ze.expires&&(j.expires=ze.expires),ze.cacheControl&&(j.cacheControl=ze.cacheControl);const Re={};if(ne){const $e=ne.finish();$e&&(Re.resourceTiming=JSON.parse(JSON.stringify($e)))}pe.vectorTile=ze.vectorTile;const Ke=pe.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[q]=pe,this.fetching[q]={rawTileData:Ve,cacheControl:j,resourceTiming:Re};try{const $e=yield Ke;return d.e({rawTileData:Ve.slice(0)},$e,j,Re)}finally{delete this.fetching[q]}}catch(ze){throw delete this.loading[q],pe.status="done",this.loaded[q]=pe,ze}})}reloadTile(Z){return d._(this,void 0,void 0,function*(){const q=Z.uid;if(!this.loaded||!this.loaded[q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ne=this.loaded[q];if(ne.showCollisionBoxes=Z.showCollisionBoxes,ne.status==="parsing"){const pe=yield ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[q]){const{rawTileData:ze,cacheControl:Ve,resourceTiming:j}=this.fetching[q];delete this.fetching[q],Me=d.e({rawTileData:ze.slice(0)},pe,Ve,j)}else Me=pe;return Me}if(ne.status==="done"&&ne.vectorTile)return ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Z){return d._(this,void 0,void 0,function*(){const q=this.loading,ne=Z.uid;q&&q[ne]&&q[ne].abort&&(q[ne].abort.abort(),delete q[ne])})}removeTile(Z){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]})}}class E{constructor(){this.loaded={}}loadTile(Z){return d._(this,void 0,void 0,function*(){const{uid:q,encoding:ne,rawImageData:pe,redFactor:Me,greenFactor:ze,blueFactor:Ve,baseShift:j}=Z,Re=pe.width+2,Ke=pe.height+2,$e=d.b(pe)?new d.R({width:Re,height:Ke},yield d.bw(pe,-1,-1,Re,Ke)):pe,Xe=new d.bx(q,$e,ne,Me,ze,Ve,j);return this.loaded=this.loaded||{},this.loaded[q]=Xe,Xe})}removeTile(Z){const q=this.loaded,ne=Z.uid;q&&q[ne]&&delete q[ne]}}function P(ye,Z){if(ye.length!==0){z(ye[0],Z);for(var q=1;q<ye.length;q++)z(ye[q],!Z)}}function z(ye,Z){for(var q=0,ne=0,pe=0,Me=ye.length,ze=Me-1;pe<Me;ze=pe++){var Ve=(ye[pe][0]-ye[ze][0])*(ye[ze][1]+ye[pe][1]),j=q+Ve;ne+=Math.abs(q)>=Math.abs(Ve)?q-j+Ve:Ve-j+q,q=j}q+ne>=0!=!!Z&&ye.reverse()}var V=d.by(function ye(Z,q){var ne,pe=Z&&Z.type;if(pe==="FeatureCollection")for(ne=0;ne<Z.features.length;ne++)ye(Z.features[ne],q);else if(pe==="GeometryCollection")for(ne=0;ne<Z.geometries.length;ne++)ye(Z.geometries[ne],q);else if(pe==="Feature")ye(Z.geometry,q);else if(pe==="Polygon")P(Z.coordinates,q);else if(pe==="MultiPolygon")for(ne=0;ne<Z.coordinates.length;ne++)P(Z.coordinates[ne],q);return Z});const $=d.bt.VectorTileFeature.prototype.toGeoJSON;var H={exports:{}},G=d.bz,X=d.bt.VectorTileFeature,le=xe;function xe(ye,Z){this.options=Z||{},this.features=ye,this.length=ye.length}function Ie(ye,Z){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=Z||4096}xe.prototype.feature=function(ye){return new Ie(this.features[ye],this.options.extent)},Ie.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var Z=0;Z<ye.length;Z++){for(var q=ye[Z],ne=[],pe=0;pe<q.length;pe++)ne.push(new G(q[pe][0],q[pe][1]));this.geometry.push(ne)}return this.geometry},Ie.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,Z=1/0,q=-1/0,ne=1/0,pe=-1/0,Me=0;Me<ye.length;Me++)for(var ze=ye[Me],Ve=0;Ve<ze.length;Ve++){var j=ze[Ve];Z=Math.min(Z,j.x),q=Math.max(q,j.x),ne=Math.min(ne,j.y),pe=Math.max(pe,j.y)}return[Z,ne,q,pe]},Ie.prototype.toGeoJSON=X.prototype.toGeoJSON;var Y=d.bA,K=le;function ue(ye){var Z=new Y;return function(q,ne){for(var pe in q.layers)ne.writeMessage(3,fe,q.layers[pe])}(ye,Z),Z.finish()}function fe(ye,Z){var q;Z.writeVarintField(15,ye.version||1),Z.writeStringField(1,ye.name||""),Z.writeVarintField(5,ye.extent||4096);var ne={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<ye.length;q++)ne.feature=ye.feature(q),Z.writeMessage(2,ce,ne);var pe=ne.keys;for(q=0;q<pe.length;q++)Z.writeStringField(3,pe[q]);var Me=ne.values;for(q=0;q<Me.length;q++)Z.writeMessage(4,rt,Me[q])}function ce(ye,Z){var q=ye.feature;q.id!==void 0&&Z.writeVarintField(1,q.id),Z.writeMessage(2,ae,ye),Z.writeVarintField(3,q.type),Z.writeMessage(4,Pe,q)}function ae(ye,Z){var q=ye.feature,ne=ye.keys,pe=ye.values,Me=ye.keycache,ze=ye.valuecache;for(var Ve in q.properties){var j=q.properties[Ve],Re=Me[Ve];if(j!==null){Re===void 0&&(ne.push(Ve),Me[Ve]=Re=ne.length-1),Z.writeVarint(Re);var Ke=typeof j;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(j=JSON.stringify(j));var $e=Ke+":"+j,Xe=ze[$e];Xe===void 0&&(pe.push(j),ze[$e]=Xe=pe.length-1),Z.writeVarint(Xe)}}}function Ge(ye,Z){return(Z<<3)+(7&ye)}function Le(ye){return ye<<1^ye>>31}function Pe(ye,Z){for(var q=ye.loadGeometry(),ne=ye.type,pe=0,Me=0,ze=q.length,Ve=0;Ve<ze;Ve++){var j=q[Ve],Re=1;ne===1&&(Re=j.length),Z.writeVarint(Ge(1,Re));for(var Ke=ne===3?j.length-1:j.length,$e=0;$e<Ke;$e++){$e===1&&ne!==1&&Z.writeVarint(Ge(2,Ke-1));var Xe=j[$e].x-pe,mt=j[$e].y-Me;Z.writeVarint(Le(Xe)),Z.writeVarint(Le(mt)),pe+=Xe,Me+=mt}ne===3&&Z.writeVarint(Ge(7,1))}}function rt(ye,Z){var q=typeof ye;q==="string"?Z.writeStringField(1,ye):q==="boolean"?Z.writeBooleanField(7,ye):q==="number"&&(ye%1!=0?Z.writeDoubleField(3,ye):ye<0?Z.writeSVarintField(6,ye):Z.writeVarintField(5,ye))}H.exports=ue,H.exports.fromVectorTileJs=ue,H.exports.fromGeojsonVt=function(ye,Z){Z=Z||{};var q={};for(var ne in ye)q[ne]=new K(ye[ne].features,Z),q[ne].name=ne,q[ne].version=Z.version,q[ne].extent=Z.extent;return ue({layers:q})},H.exports.GeoJSONWrapper=K;var it=d.by(H.exports);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},Ft=Math.fround||(jt=new Float32Array(1),ye=>(jt[0]=+ye,jt[0]));var jt;const ut=3,et=5,at=6;class Bt{constructor(Z){this.options=Object.assign(Object.create(Qe),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:q,minZoom:ne,maxZoom:pe}=this.options;q&&console.time("total time");const Me=`prepare ${Z.length} points`;q&&console.time(Me),this.points=Z;const ze=[];for(let j=0;j<Z.length;j++){const Re=Z[j];if(!Re.geometry)continue;const[Ke,$e]=Re.geometry.coordinates,Xe=Ft(li(Ke)),mt=Ft(ai($e));ze.push(Xe,mt,1/0,j,-1,1),this.options.reduce&&ze.push(0)}let Ve=this.trees[pe+1]=this._createTree(ze);q&&console.timeEnd(Me);for(let j=pe;j>=ne;j--){const Re=+Date.now();Ve=this.trees[j]=this._createTree(this._cluster(Ve,j)),q&&console.log("z%d: %d clusters in %dms",j,Ve.numItems,+Date.now()-Re)}return q&&console.timeEnd("total time"),this}getClusters(Z,q){let ne=((Z[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,Z[1]));let Me=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ne=-180,Me=180;else if(ne>Me){const $e=this.getClusters([ne,pe,180,ze],q),Xe=this.getClusters([-180,pe,Me,ze],q);return $e.concat(Xe)}const Ve=this.trees[this._limitZoom(q)],j=Ve.range(li(ne),ai(ze),li(Me),ai(pe)),Re=Ve.data,Ke=[];for(const $e of j){const Xe=this.stride*$e;Ke.push(Re[Xe+et]>1?Dt(Re,Xe,this.clusterProps):this.points[Re[Xe+ut]])}return Ke}getChildren(Z){const q=this._getOriginId(Z),ne=this._getOriginZoom(Z),pe="No cluster with the specified id.",Me=this.trees[ne];if(!Me)throw new Error(pe);const ze=Me.data;if(q*this.stride>=ze.length)throw new Error(pe);const Ve=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),j=Me.within(ze[q*this.stride],ze[q*this.stride+1],Ve),Re=[];for(const Ke of j){const $e=Ke*this.stride;ze[$e+4]===Z&&Re.push(ze[$e+et]>1?Dt(ze,$e,this.clusterProps):this.points[ze[$e+ut]])}if(Re.length===0)throw new Error(pe);return Re}getLeaves(Z,q,ne){const pe=[];return this._appendLeaves(pe,Z,q=q||10,ne=ne||0,0),pe}getTile(Z,q,ne){const pe=this.trees[this._limitZoom(Z)],Me=Math.pow(2,Z),{extent:ze,radius:Ve}=this.options,j=Ve/ze,Re=(ne-j)/Me,Ke=(ne+1+j)/Me,$e={features:[]};return this._addTileFeatures(pe.range((q-j)/Me,Re,(q+1+j)/Me,Ke),pe.data,q,ne,Me,$e),q===0&&this._addTileFeatures(pe.range(1-j/Me,Re,1,Ke),pe.data,Me,ne,Me,$e),q===Me-1&&this._addTileFeatures(pe.range(0,Re,j/Me,Ke),pe.data,-1,ne,Me,$e),$e.features.length?$e:null}getClusterExpansionZoom(Z){let q=this._getOriginZoom(Z)-1;for(;q<=this.options.maxZoom;){const ne=this.getChildren(Z);if(q++,ne.length!==1)break;Z=ne[0].properties.cluster_id}return q}_appendLeaves(Z,q,ne,pe,Me){const ze=this.getChildren(q);for(const Ve of ze){const j=Ve.properties;if(j&&j.cluster?Me+j.point_count<=pe?Me+=j.point_count:Me=this._appendLeaves(Z,j.cluster_id,ne,pe,Me):Me<pe?Me++:Z.push(Ve),Z.length===ne)break}return Me}_createTree(Z){const q=new d.av(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<Z.length;ne+=this.stride)q.add(Z[ne],Z[ne+1]);return q.finish(),q.data=Z,q}_addTileFeatures(Z,q,ne,pe,Me,ze){for(const Ve of Z){const j=Ve*this.stride,Re=q[j+et]>1;let Ke,$e,Xe;if(Re)Ke=Ht(q,j,this.clusterProps),$e=q[j],Xe=q[j+1];else{const pi=this.points[q[j+ut]];Ke=pi.properties;const[Qt,hi]=pi.geometry.coordinates;$e=li(Qt),Xe=ai(hi)}const mt={type:1,geometry:[[Math.round(this.options.extent*($e*Me-ne)),Math.round(this.options.extent*(Xe*Me-pe))]],tags:Ke};let Et;Et=Re||this.options.generateId?q[j+ut]:this.points[q[j+ut]].id,Et!==void 0&&(mt.id=Et),ze.features.push(mt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,q){const{radius:ne,extent:pe,reduce:Me,minPoints:ze}=this.options,Ve=ne/(pe*Math.pow(2,q)),j=Z.data,Re=[],Ke=this.stride;for(let $e=0;$e<j.length;$e+=Ke){if(j[$e+2]<=q)continue;j[$e+2]=q;const Xe=j[$e],mt=j[$e+1],Et=Z.within(j[$e],j[$e+1],Ve),pi=j[$e+et];let Qt=pi;for(const hi of Et){const wi=hi*Ke;j[wi+2]>q&&(Qt+=j[wi+et])}if(Qt>pi&&Qt>=ze){let hi,wi=Xe*pi,Dn=mt*pi,gn=-1;const mi=(($e/Ke|0)<<5)+(q+1)+this.points.length;for(const qi of Et){const un=qi*Ke;if(j[un+2]<=q)continue;j[un+2]=q;const Zn=j[un+et];wi+=j[un]*Zn,Dn+=j[un+1]*Zn,j[un+4]=mi,Me&&(hi||(hi=this._map(j,$e,!0),gn=this.clusterProps.length,this.clusterProps.push(hi)),Me(hi,this._map(j,un)))}j[$e+4]=mi,Re.push(wi/Qt,Dn/Qt,1/0,mi,-1,Qt),Me&&Re.push(gn)}else{for(let hi=0;hi<Ke;hi++)Re.push(j[$e+hi]);if(Qt>1)for(const hi of Et){const wi=hi*Ke;if(!(j[wi+2]<=q)){j[wi+2]=q;for(let Dn=0;Dn<Ke;Dn++)Re.push(j[wi+Dn])}}}}return Re}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,q,ne){if(Z[q+et]>1){const ze=this.clusterProps[Z[q+at]];return ne?Object.assign({},ze):ze}const pe=this.points[Z[q+ut]].properties,Me=this.options.map(pe);return ne&&Me===pe?Object.assign({},Me):Me}}function Dt(ye,Z,q){return{type:"Feature",id:ye[Z+ut],properties:Ht(ye,Z,q),geometry:{type:"Point",coordinates:[(ne=ye[Z],360*(ne-.5)),ki(ye[Z+1])]}};var ne}function Ht(ye,Z,q){const ne=ye[Z+et],pe=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,Me=ye[Z+at],ze=Me===-1?{}:Object.assign({},q[Me]);return Object.assign(ze,{cluster:!0,cluster_id:ye[Z+ut],point_count:ne,point_count_abbreviated:pe})}function li(ye){return ye/360+.5}function ai(ye){const Z=Math.sin(ye*Math.PI/180),q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return q<0?0:q>1?1:q}function ki(ye){const Z=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Fi(ye,Z,q,ne){let pe=ne;const Me=Z+(q-Z>>1);let ze,Ve=q-Z;const j=ye[Z],Re=ye[Z+1],Ke=ye[q],$e=ye[q+1];for(let Xe=Z+3;Xe<q;Xe+=3){const mt=bi(ye[Xe],ye[Xe+1],j,Re,Ke,$e);if(mt>pe)ze=Xe,pe=mt;else if(mt===pe){const Et=Math.abs(Xe-Me);Et<Ve&&(ze=Xe,Ve=Et)}}pe>ne&&(ze-Z>3&&Fi(ye,Z,ze,ne),ye[ze+2]=pe,q-ze>3&&Fi(ye,ze,q,ne))}function bi(ye,Z,q,ne,pe,Me){let ze=pe-q,Ve=Me-ne;if(ze!==0||Ve!==0){const j=((ye-q)*ze+(Z-ne)*Ve)/(ze*ze+Ve*Ve);j>1?(q=pe,ne=Me):j>0&&(q+=ze*j,ne+=Ve*j)}return ze=ye-q,Ve=Z-ne,ze*ze+Ve*Ve}function di(ye,Z,q,ne){const pe={id:ye??null,type:Z,geometry:q,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")lt(pe,q);else if(Z==="Polygon")lt(pe,q[0]);else if(Z==="MultiLineString")for(const Me of q)lt(pe,Me);else if(Z==="MultiPolygon")for(const Me of q)lt(pe,Me[0]);return pe}function lt(ye,Z){for(let q=0;q<Z.length;q+=3)ye.minX=Math.min(ye.minX,Z[q]),ye.minY=Math.min(ye.minY,Z[q+1]),ye.maxX=Math.max(ye.maxX,Z[q]),ye.maxY=Math.max(ye.maxY,Z[q+1])}function qe(ye,Z,q,ne){if(!Z.geometry)return;const pe=Z.geometry.coordinates;if(pe&&pe.length===0)return;const Me=Z.geometry.type,ze=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2);let Ve=[],j=Z.id;if(q.promoteId?j=Z.properties[q.promoteId]:q.generateId&&(j=ne||0),Me==="Point")st(pe,Ve);else if(Me==="MultiPoint")for(const Re of pe)st(Re,Ve);else if(Me==="LineString")Te(pe,Ve,ze,!1);else if(Me==="MultiLineString"){if(q.lineMetrics){for(const Re of pe)Ve=[],Te(Re,Ve,ze,!1),ye.push(di(j,"LineString",Ve,Z.properties));return}pt(pe,Ve,ze,!1)}else if(Me==="Polygon")pt(pe,Ve,ze,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const Re of Z.geometry.geometries)qe(ye,{id:j,geometry:Re,properties:Z.properties},q,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Re of pe){const Ke=[];pt(Re,Ke,ze,!0),Ve.push(Ke)}}ye.push(di(j,Me,Ve,Z.properties))}function st(ye,Z){Z.push(gt(ye[0]),Ce(ye[1]),0)}function Te(ye,Z,q,ne){let pe,Me,ze=0;for(let j=0;j<ye.length;j++){const Re=gt(ye[j][0]),Ke=Ce(ye[j][1]);Z.push(Re,Ke,0),j>0&&(ze+=ne?(pe*Ke-Re*Me)/2:Math.sqrt(Math.pow(Re-pe,2)+Math.pow(Ke-Me,2))),pe=Re,Me=Ke}const Ve=Z.length-3;Z[2]=1,Fi(Z,0,Ve,q),Z[Ve+2]=1,Z.size=Math.abs(ze),Z.start=0,Z.end=Z.size}function pt(ye,Z,q,ne){for(let pe=0;pe<ye.length;pe++){const Me=[];Te(ye[pe],Me,q,ne),Z.push(Me)}}function gt(ye){return ye/360+.5}function Ce(ye){const Z=Math.sin(ye*Math.PI/180),q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return q<0?0:q>1?1:q}function nt(ye,Z,q,ne,pe,Me,ze,Ve){if(ne/=Z,Me>=(q/=Z)&&ze<ne)return ye;if(ze<q||Me>=ne)return null;const j=[];for(const Re of ye){const Ke=Re.geometry;let $e=Re.type;const Xe=pe===0?Re.minX:Re.minY,mt=pe===0?Re.maxX:Re.maxY;if(Xe>=q&&mt<ne){j.push(Re);continue}if(mt<q||Xe>=ne)continue;let Et=[];if($e==="Point"||$e==="MultiPoint")Xt(Ke,Et,q,ne,pe);else if($e==="LineString")vi(Ke,Et,q,ne,pe,!1,Ve.lineMetrics);else if($e==="MultiLineString")Ci(Ke,Et,q,ne,pe,!1);else if($e==="Polygon")Ci(Ke,Et,q,ne,pe,!0);else if($e==="MultiPolygon")for(const pi of Ke){const Qt=[];Ci(pi,Qt,q,ne,pe,!0),Qt.length&&Et.push(Qt)}if(Et.length){if(Ve.lineMetrics&&$e==="LineString"){for(const pi of Et)j.push(di(Re.id,$e,pi,Re.tags));continue}$e!=="LineString"&&$e!=="MultiLineString"||(Et.length===1?($e="LineString",Et=Et[0]):$e="MultiLineString"),$e!=="Point"&&$e!=="MultiPoint"||($e=Et.length===3?"Point":"MultiPoint"),j.push(di(Re.id,$e,Et,Re.tags))}}return j.length?j:null}function Xt(ye,Z,q,ne,pe){for(let Me=0;Me<ye.length;Me+=3){const ze=ye[Me+pe];ze>=q&&ze<=ne&&_i(Z,ye[Me],ye[Me+1],ye[Me+2])}}function vi(ye,Z,q,ne,pe,Me,ze){let Ve=ji(ye);const j=pe===0?Bi:br;let Re,Ke,$e=ye.start;for(let Qt=0;Qt<ye.length-3;Qt+=3){const hi=ye[Qt],wi=ye[Qt+1],Dn=ye[Qt+2],gn=ye[Qt+3],mi=ye[Qt+4],qi=pe===0?hi:wi,un=pe===0?gn:mi;let Zn=!1;ze&&(Re=Math.sqrt(Math.pow(hi-gn,2)+Math.pow(wi-mi,2))),qi<q?un>q&&(Ke=j(Ve,hi,wi,gn,mi,q),ze&&(Ve.start=$e+Re*Ke)):qi>ne?un<ne&&(Ke=j(Ve,hi,wi,gn,mi,ne),ze&&(Ve.start=$e+Re*Ke)):_i(Ve,hi,wi,Dn),un<q&&qi>=q&&(Ke=j(Ve,hi,wi,gn,mi,q),Zn=!0),un>ne&&qi<=ne&&(Ke=j(Ve,hi,wi,gn,mi,ne),Zn=!0),!Me&&Zn&&(ze&&(Ve.end=$e+Re*Ke),Z.push(Ve),Ve=ji(ye)),ze&&($e+=Re)}let Xe=ye.length-3;const mt=ye[Xe],Et=ye[Xe+1],pi=pe===0?mt:Et;pi>=q&&pi<=ne&&_i(Ve,mt,Et,ye[Xe+2]),Xe=Ve.length-3,Me&&Xe>=3&&(Ve[Xe]!==Ve[0]||Ve[Xe+1]!==Ve[1])&&_i(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&Z.push(Ve)}function ji(ye){const Z=[];return Z.size=ye.size,Z.start=ye.start,Z.end=ye.end,Z}function Ci(ye,Z,q,ne,pe,Me){for(const ze of ye)vi(ze,Z,q,ne,pe,Me,!1)}function _i(ye,Z,q,ne){ye.push(Z,q,ne)}function Bi(ye,Z,q,ne,pe,Me){const ze=(Me-Z)/(ne-Z);return _i(ye,Me,q+(pe-q)*ze,1),ze}function br(ye,Z,q,ne,pe,Me){const ze=(Me-q)/(pe-q);return _i(ye,Z+(ne-Z)*ze,Me,1),ze}function ct(ye,Z){const q=[];for(let ne=0;ne<ye.length;ne++){const pe=ye[ne],Me=pe.type;let ze;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")ze=tr(pe.geometry,Z);else if(Me==="MultiLineString"||Me==="Polygon"){ze=[];for(const Ve of pe.geometry)ze.push(tr(Ve,Z))}else if(Me==="MultiPolygon"){ze=[];for(const Ve of pe.geometry){const j=[];for(const Re of Ve)j.push(tr(Re,Z));ze.push(j)}}q.push(di(pe.id,Me,ze,pe.tags))}return q}function tr(ye,Z){const q=[];q.size=ye.size,ye.start!==void 0&&(q.start=ye.start,q.end=ye.end);for(let ne=0;ne<ye.length;ne+=3)q.push(ye[ne]+Z,ye[ne+1],ye[ne+2]);return q}function _n(ye,Z){if(ye.transformed)return ye;const q=1<<ye.z,ne=ye.x,pe=ye.y;for(const Me of ye.features){const ze=Me.geometry,Ve=Me.type;if(Me.geometry=[],Ve===1)for(let j=0;j<ze.length;j+=2)Me.geometry.push(qn(ze[j],ze[j+1],Z,q,ne,pe));else for(let j=0;j<ze.length;j++){const Re=[];for(let Ke=0;Ke<ze[j].length;Ke+=2)Re.push(qn(ze[j][Ke],ze[j][Ke+1],Z,q,ne,pe));Me.geometry.push(Re)}}return ye.transformed=!0,ye}function qn(ye,Z,q,ne,pe,Me){return[Math.round(q*(ye*ne-pe)),Math.round(q*(Z*ne-Me))]}function Wr(ye,Z,q,ne,pe){const Me=Z===pe.maxZoom?0:pe.tolerance/((1<<Z)*pe.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:q,y:ne,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ve of ye)bt(ze,Ve,Me,pe);return ze}function bt(ye,Z,q,ne){const pe=Z.geometry,Me=Z.type,ze=[];if(ye.minX=Math.min(ye.minX,Z.minX),ye.minY=Math.min(ye.minY,Z.minY),ye.maxX=Math.max(ye.maxX,Z.maxX),ye.maxY=Math.max(ye.maxY,Z.maxY),Me==="Point"||Me==="MultiPoint")for(let Ve=0;Ve<pe.length;Ve+=3)ze.push(pe[Ve],pe[Ve+1]),ye.numPoints++,ye.numSimplified++;else if(Me==="LineString")ci(ze,pe,ye,q,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let Ve=0;Ve<pe.length;Ve++)ci(ze,pe[Ve],ye,q,Me==="Polygon",Ve===0);else if(Me==="MultiPolygon")for(let Ve=0;Ve<pe.length;Ve++){const j=pe[Ve];for(let Re=0;Re<j.length;Re++)ci(ze,j[Re],ye,q,!0,Re===0)}if(ze.length){let Ve=Z.tags||null;if(Me==="LineString"&&ne.lineMetrics){Ve={};for(const Re in Z.tags)Ve[Re]=Z.tags[Re];Ve.mapbox_clip_start=pe.start/pe.size,Ve.mapbox_clip_end=pe.end/pe.size}const j={geometry:ze,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ve};Z.id!==null&&(j.id=Z.id),ye.features.push(j)}}function ci(ye,Z,q,ne,pe,Me){const ze=ne*ne;if(ne>0&&Z.size<(pe?ze:ne))return void(q.numPoints+=Z.length/3);const Ve=[];for(let j=0;j<Z.length;j+=3)(ne===0||Z[j+2]>ze)&&(q.numSimplified++,Ve.push(Z[j],Z[j+1])),q.numPoints++;pe&&function(j,Re){let Ke=0;for(let $e=0,Xe=j.length,mt=Xe-2;$e<Xe;mt=$e,$e+=2)Ke+=(j[$e]-j[mt])*(j[$e+1]+j[mt+1]);if(Ke>0===Re)for(let $e=0,Xe=j.length;$e<Xe/2;$e+=2){const mt=j[$e],Et=j[$e+1];j[$e]=j[Xe-2-$e],j[$e+1]=j[Xe-1-$e],j[Xe-2-$e]=mt,j[Xe-1-$e]=Et}}(Ve,Me),ye.push(Ve)}const Jt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class In{constructor(Z,q){const ne=(q=this.options=function(Me,ze){for(const Ve in ze)Me[Ve]=ze[Ve];return Me}(Object.create(Jt),q)).debug;if(ne&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let pe=function(Me,ze){const Ve=[];if(Me.type==="FeatureCollection")for(let j=0;j<Me.features.length;j++)qe(Ve,Me.features[j],ze,j);else qe(Ve,Me.type==="Feature"?Me:{geometry:Me},ze);return Ve}(Z,q);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=function(Me,ze){const Ve=ze.buffer/ze.extent;let j=Me;const Re=nt(Me,1,-1-Ve,Ve,0,-1,2,ze),Ke=nt(Me,1,1-Ve,2+Ve,0,-1,2,ze);return(Re||Ke)&&(j=nt(Me,1,-Ve,1+Ve,0,-1,2,ze)||[],Re&&(j=ct(Re,1).concat(j)),Ke&&(j=j.concat(ct(Ke,-1)))),j}(pe,q),pe.length&&this.splitTile(pe,0,0,0),ne&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,q,ne,pe,Me,ze,Ve){const j=[Z,q,ne,pe],Re=this.options,Ke=Re.debug;for(;j.length;){pe=j.pop(),ne=j.pop(),q=j.pop(),Z=j.pop();const $e=1<<q,Xe=Nn(q,ne,pe);let mt=this.tiles[Xe];if(!mt&&(Ke>1&&console.time("creation"),mt=this.tiles[Xe]=Wr(Z,q,ne,pe,Re),this.tileCoords.push({z:q,x:ne,y:pe}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,ne,pe,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));const Zn=`z${q}`;this.stats[Zn]=(this.stats[Zn]||0)+1,this.total++}if(mt.source=Z,Me==null){if(q===Re.indexMaxZoom||mt.numPoints<=Re.indexMaxPoints)continue}else{if(q===Re.maxZoom||q===Me)continue;if(Me!=null){const Zn=Me-q;if(ne!==ze>>Zn||pe!==Ve>>Zn)continue}}if(mt.source=null,Z.length===0)continue;Ke>1&&console.time("clipping");const Et=.5*Re.buffer/Re.extent,pi=.5-Et,Qt=.5+Et,hi=1+Et;let wi=null,Dn=null,gn=null,mi=null,qi=nt(Z,$e,ne-Et,ne+Qt,0,mt.minX,mt.maxX,Re),un=nt(Z,$e,ne+pi,ne+hi,0,mt.minX,mt.maxX,Re);Z=null,qi&&(wi=nt(qi,$e,pe-Et,pe+Qt,1,mt.minY,mt.maxY,Re),Dn=nt(qi,$e,pe+pi,pe+hi,1,mt.minY,mt.maxY,Re),qi=null),un&&(gn=nt(un,$e,pe-Et,pe+Qt,1,mt.minY,mt.maxY,Re),mi=nt(un,$e,pe+pi,pe+hi,1,mt.minY,mt.maxY,Re),un=null),Ke>1&&console.timeEnd("clipping"),j.push(wi||[],q+1,2*ne,2*pe),j.push(Dn||[],q+1,2*ne,2*pe+1),j.push(gn||[],q+1,2*ne+1,2*pe),j.push(mi||[],q+1,2*ne+1,2*pe+1)}}getTile(Z,q,ne){Z=+Z,q=+q,ne=+ne;const pe=this.options,{extent:Me,debug:ze}=pe;if(Z<0||Z>24)return null;const Ve=1<<Z,j=Nn(Z,q=q+Ve&Ve-1,ne);if(this.tiles[j])return _n(this.tiles[j],Me);ze>1&&console.log("drilling down to z%d-%d-%d",Z,q,ne);let Re,Ke=Z,$e=q,Xe=ne;for(;!Re&&Ke>0;)Ke--,$e>>=1,Xe>>=1,Re=this.tiles[Nn(Ke,$e,Xe)];return Re&&Re.source?(ze>1&&(console.log("found parent tile z%d-%d-%d",Ke,$e,Xe),console.time("drilling down")),this.splitTile(Re.source,Ke,$e,Xe,Z,q,ne),ze>1&&console.timeEnd("drilling down"),this.tiles[j]?_n(this.tiles[j],Me):null):null}}function Nn(ye,Z,q){return 32*((1<<ye)*q+Z)+ye}function ei(ye,Z){return Z?ye.properties[Z]:ye.id}function vr(ye,Z){if(ye==null)return!0;if(ye.type==="Feature")return ei(ye,Z)!=null;if(ye.type==="FeatureCollection"){const q=new Set;for(const ne of ye.features){const pe=ei(ne,Z);if(pe==null||q.has(pe))return!1;q.add(pe)}return!0}return!1}function Fr(ye,Z){const q=new Map;if(ye!=null)if(ye.type==="Feature")q.set(ei(ye,Z),ye);else for(const ne of ye.features)q.set(ei(ne,Z),ne);return q}class Hr extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Z,q){return d._(this,void 0,void 0,function*(){const ne=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const pe=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!pe)return null;const Me=new class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.X,this.length=Ve.length,this._features=Ve}feature(Ve){return new class{constructor(j){this._feature=j,this.extent=d.X,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(this._feature.type===1){const j=[];for(const Re of this._feature.geometry)j.push([new d.P(Re[0],Re[1])]);return j}{const j=[];for(const Re of this._feature.geometry){const Ke=[];for(const $e of Re)Ke.push(new d.P($e[0],$e[1]));j.push(Ke)}return j}}toGeoJSON(j,Re,Ke){return $.call(this,j,Re,Ke)}}(this._features[Ve])}}(pe.features);let ze=it(Me);return ze.byteOffset===0&&ze.byteLength===ze.buffer.byteLength||(ze=new Uint8Array(ze)),{vectorTile:Me,rawData:ze.buffer}})}loadData(Z){return d._(this,void 0,void 0,function*(){var q;(q=this._pendingRequest)===null||q===void 0||q.abort();const ne=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new d.bv(Z.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Z,this._pendingRequest),this._geoJSONIndex=Z.cluster?new Bt(function({superclusterOptions:ze,clusterProperties:Ve}){if(!Ve||!ze)return ze;const j={},Re={},Ke={accumulated:null,zoom:0},$e={properties:null},Xe=Object.keys(Ve);for(const mt of Xe){const[Et,pi]=Ve[mt],Qt=d.bC(pi),hi=d.bC(typeof Et=="string"?[Et,["accumulated"],["get",mt]]:Et);j[mt]=Qt.value,Re[mt]=hi.value}return ze.map=mt=>{$e.properties=mt;const Et={};for(const pi of Xe)Et[pi]=j[pi].evaluate(Ke,$e);return Et},ze.reduce=(mt,Et)=>{$e.properties=Et;for(const pi of Xe)Ke.accumulated=mt[pi],mt[pi]=Re[pi].evaluate(Ke,$e)},ze}(Z)).load((yield this._pendingData).features):(pe=yield this._pendingData,new In(pe,Z.geojsonVtOptions)),this.loaded={};const Me={};if(ne){const ze=ne.finish();ze&&(Me.resourceTiming={},Me.resourceTiming[Z.source]=JSON.parse(JSON.stringify(ze)))}return Me}catch(Me){if(delete this._pendingRequest,d.bB(Me))return{abandoned:!0};throw Me}var pe})}getData(){return d._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Z){const q=this.loaded;return q&&q[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadAndProcessGeoJSON(Z,q){return d._(this,void 0,void 0,function*(){let ne=yield this.loadGeoJSON(Z,q);if(delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(V(ne,!0),Z.filter){const pe=d.bC(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));ne={type:"FeatureCollection",features:ne.features.filter(ze=>pe.value.evaluate({zoom:0},ze))}}return ne})}loadGeoJSON(Z,q){return d._(this,void 0,void 0,function*(){const{promoteId:ne}=Z;if(Z.request){const pe=yield d.h(Z.request,q);return this._dataUpdateable=vr(pe.data,ne)?Fr(pe.data,ne):void 0,pe.data}if(typeof Z.data=="string")try{const pe=JSON.parse(Z.data);return this._dataUpdateable=vr(pe,ne)?Fr(pe,ne):void 0,pe}catch{throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`)}if(!Z.dataDiff)throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z.source}`);return function(pe,Me,ze){var Ve,j,Re,Ke;if(Me.removeAll&&pe.clear(),Me.remove)for(const $e of Me.remove)pe.delete($e);if(Me.add)for(const $e of Me.add){const Xe=ei($e,ze);Xe!=null&&pe.set(Xe,$e)}if(Me.update)for(const $e of Me.update){let Xe=pe.get($e.id);if(Xe==null)continue;const mt=!$e.removeAllProperties&&(((Ve=$e.removeProperties)===null||Ve===void 0?void 0:Ve.length)>0||((j=$e.addOrUpdateProperties)===null||j===void 0?void 0:j.length)>0);if(($e.newGeometry||$e.removeAllProperties||mt)&&(Xe=Object.assign({},Xe),pe.set($e.id,Xe),mt&&(Xe.properties=Object.assign({},Xe.properties))),$e.newGeometry&&(Xe.geometry=$e.newGeometry),$e.removeAllProperties)Xe.properties={};else if(((Re=$e.removeProperties)===null||Re===void 0?void 0:Re.length)>0)for(const Et of $e.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,Et)&&delete Xe.properties[Et];if(((Ke=$e.addOrUpdateProperties)===null||Ke===void 0?void 0:Ke.length)>0)for(const{key:Et,value:pi}of $e.addOrUpdateProperties)Xe.properties[Et]=pi}}(this._dataUpdateable,Z.dataDiff,ne),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Z){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}class wr{constructor(Z){this.self=Z,this.actor=new d.F(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(q,ne)=>{if(this.externalWorkerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.externalWorkerSourceTypes[q]=ne},this.self.addProtocol=d.bi,this.self.removeProtocol=d.bj,this.self.registerRTLTextPlugin=q=>{if(d.bD.isParsed())throw new Error("RTL text plugin already registered.");d.bD.setMethods(q)},this.actor.registerMessageHandler("LDT",(q,ne)=>this._getDEMWorkerSource(q,ne.source).loadTile(ne)),this.actor.registerMessageHandler("RDT",(q,ne)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(q,ne.source).removeTile(ne)})),this.actor.registerMessageHandler("GCEZ",(q,ne)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(q,ne.type,ne.source).getClusterExpansionZoom(ne)})),this.actor.registerMessageHandler("GCC",(q,ne)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(q,ne.type,ne.source).getClusterChildren(ne)})),this.actor.registerMessageHandler("GCL",(q,ne)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(q,ne.type,ne.source).getClusterLeaves(ne)})),this.actor.registerMessageHandler("LD",(q,ne)=>this._getWorkerSource(q,ne.type,ne.source).loadData(ne)),this.actor.registerMessageHandler("GD",(q,ne)=>this._getWorkerSource(q,ne.type,ne.source).getData()),this.actor.registerMessageHandler("LT",(q,ne)=>this._getWorkerSource(q,ne.type,ne.source).loadTile(ne)),this.actor.registerMessageHandler("RT",(q,ne)=>this._getWorkerSource(q,ne.type,ne.source).reloadTile(ne)),this.actor.registerMessageHandler("AT",(q,ne)=>this._getWorkerSource(q,ne.type,ne.source).abortTile(ne)),this.actor.registerMessageHandler("RMT",(q,ne)=>this._getWorkerSource(q,ne.type,ne.source).removeTile(ne)),this.actor.registerMessageHandler("RS",(q,ne)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[q]||!this.workerSources[q][ne.type]||!this.workerSources[q][ne.type][ne.source])return;const pe=this.workerSources[q][ne.type][ne.source];delete this.workerSources[q][ne.type][ne.source],pe.removeSource!==void 0&&pe.removeSource(ne)})),this.actor.registerMessageHandler("RM",q=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q]})),this.actor.registerMessageHandler("SR",(q,ne)=>d._(this,void 0,void 0,function*(){this.referrer=ne})),this.actor.registerMessageHandler("SRPS",(q,ne)=>this._syncRTLPluginState(q,ne)),this.actor.registerMessageHandler("IS",(q,ne)=>d._(this,void 0,void 0,function*(){this.self.importScripts(ne)})),this.actor.registerMessageHandler("SI",(q,ne)=>this._setImages(q,ne)),this.actor.registerMessageHandler("UL",(q,ne)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(q).update(ne.layers,ne.removedIds)})),this.actor.registerMessageHandler("SL",(q,ne)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(q).replace(ne)}))}_setImages(Z,q){return d._(this,void 0,void 0,function*(){this.availableImages[Z]=q;for(const ne in this.workerSources[Z]){const pe=this.workerSources[Z][ne];for(const Me in pe)pe[Me].availableImages=q}})}_syncRTLPluginState(Z,q){return d._(this,void 0,void 0,function*(){if(d.bD.isParsed())return d.bD.getState();if(q.pluginStatus!=="loading")return d.bD.setState(q),q;const ne=q.pluginURL;if(this.self.importScripts(ne),d.bD.isParsed()){const pe={pluginStatus:"loaded",pluginURL:ne};return d.bD.setState(pe),pe}throw d.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ne}`)})}_getAvailableImages(Z){let q=this.availableImages[Z];return q||(q=[]),q}_getLayerIndex(Z){let q=this.layerIndexes[Z];return q||(q=this.layerIndexes[Z]=new a),q}_getWorkerSource(Z,q,ne){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][q]||(this.workerSources[Z][q]={}),!this.workerSources[Z][q][ne]){const pe={sendAsync:(Me,ze)=>(Me.targetMapId=Z,this.actor.sendAsync(Me,ze))};switch(q){case"vector":this.workerSources[Z][q][ne]=new S(pe,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][q][ne]=new Hr(pe,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][q][ne]=new this.externalWorkerSourceTypes[q](pe,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][q][ne]}_getDEMWorkerSource(Z,q){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][q]||(this.demWorkerSources[Z][q]=new E),this.demWorkerSources[Z][q]}}return d.i(self)&&(self.worker=new wr(self)),wr}),l("index",["exports","./shared"],function(d,a){var g="4.7.0";let v,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:b=>new Promise((i,h)=>{const p=requestAnimationFrame(i);b.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(b,i=0){return this.getImageCanvasContext(b).getImageData(-i,-i,b.width+2*i,b.height+2*i)},getImageCanvasContext(b){const i=window.document.createElement("canvas"),h=i.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return i.width=b.width,i.height=b.height,h.drawImage(b,0,0,b.width,b.height),h},resolveURL:b=>(v||(v=document.createElement("a")),v.href=b,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class E{static testProp(i){if(!E.docStyle)return i[0];for(let h=0;h<i.length;h++)if(i[h]in E.docStyle)return i[h];return i[0]}static create(i,h,p){const m=window.document.createElement(i);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(i,h){return window.document.createElementNS(i,h)}static disableDrag(){E.docStyle&&E.selectProp&&(E.userSelect=E.docStyle[E.selectProp],E.docStyle[E.selectProp]="none")}static enableDrag(){E.docStyle&&E.selectProp&&(E.docStyle[E.selectProp]=E.userSelect)}static setTransform(i,h){i.style[E.transformProp]=h}static addEventListener(i,h,p,m={}){i.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(i,h,p,m={}){i.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",E.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",E.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",E.suppressClickInternal,!0)},0)}static getScale(i){const h=i.getBoundingClientRect();return{x:h.width/i.offsetWidth||1,y:h.height/i.offsetHeight||1,boundingClientRect:h}}static getPoint(i,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-i.clientLeft,(p.clientY-m.top)/h.y-i.clientTop)}static mousePos(i,h){const p=E.getScale(i);return E.getPoint(i,p,h)}static touchPos(i,h){const p=[],m=E.getScale(i);for(let y=0;y<h.length;y++)p.push(E.getPoint(i,m,h[y]));return p}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}E.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,E.selectProp=E.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),E.transformProp=E.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(b){!$&&V&&(H?G(b):z=b)}};let z,V,$=!1,H=!1;function G(b){const i=b.createTexture();b.bindTexture(b.TEXTURE_2D,i);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,V),b.isContextLost())return;P.supported=!0}catch{}b.deleteTexture(i),$=!0}var X;typeof document<"u"&&(V=document.createElement("img"),V.onload=()=>{z&&G(z),z=null,H=!0},V.onerror=()=>{$=!0,z=null},V.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(b){let i,h,p,m;b.resetRequestQueue=()=>{i=[],h=0,p=0,m={}},b.addThrottleControl=M=>{const R=p++;return m[R]=M,R},b.removeThrottleControl=M=>{delete m[M],I()},b.getImage=(M,R,O=!0)=>new Promise((N,J)=>{P.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),a.e(M,{type:"image"}),i.push({abortController:R,requestParameters:M,supportImageRefresh:O,state:"queued",onError:oe=>{J(oe)},onSuccess:oe=>{N(oe)}}),I()});const y=M=>a._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:R,supportImageRefresh:O,onError:N,onSuccess:J,abortController:oe}=M,he=O===!1&&!a.i(self)&&!a.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((ke,Ee)=>ke&&Ee==="accept",!0));h++;const ge=he?L(R,oe):a.m(R,oe);try{const ke=yield ge;delete M.abortController,M.state="completed",ke.data instanceof HTMLImageElement||a.b(ke.data)?J(ke):ke.data&&J({data:yield(ve=ke.data,typeof createImageBitmap=="function"?a.d(ve):a.f(ve)),cacheControl:ke.cacheControl,expires:ke.expires})}catch(ke){delete M.abortController,N(ke)}finally{h--,I()}var ve}),I=()=>{const M=(()=>{for(const R of Object.keys(m))if(m[R]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=h;R<M&&i.length>0;R++){const O=i.shift();O.abortController.signal.aborted?R--:y(O)}},L=(M,R)=>new Promise((O,N)=>{const J=new Image,oe=M.url,he=M.credentials;he&&he==="include"?J.crossOrigin="use-credentials":(he&&he==="same-origin"||!a.s(oe))&&(J.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{J.src="",N(a.c())}),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,O({data:J})},J.onerror=()=>{J.onerror=J.onload=null,R.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=oe})}(X||(X={})),X.resetRequestQueue();class le{constructor(i){this._transformRequestFn=i}transformRequest(i,h){return this._transformRequestFn&&this._transformRequestFn(i,h)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function xe(b){var i=new a.A(3);return i[0]=b[0],i[1]=b[1],i[2]=b[2],i}var Ie,Y=function(b,i,h){return b[0]=i[0]-h[0],b[1]=i[1]-h[1],b[2]=i[2]-h[2],b};Ie=new a.A(3),a.A!=Float32Array&&(Ie[0]=0,Ie[1]=0,Ie[2]=0);var K=function(b){var i=b[0],h=b[1];return i*i+h*h};function ue(b){const i=[];if(typeof b=="string")i.push({id:"default",url:b});else if(b&&b.length>0){const h=[];for(const{id:p,url:m}of b){const y=`${p}${m}`;h.indexOf(y)===-1&&(h.push(y),i.push({id:p,url:m}))}}return i}function fe(b,i,h){const p=b.split("?");return p[0]+=`${i}${h}`,p.join("?")}(function(){var b=new a.A(2);a.A!=Float32Array&&(b[0]=0,b[1]=0)})();class ce{constructor(i,h,p,m){this.context=i,this.format=p,this.texture=i.gl.createTexture(),this.update(h,m)}update(i,h,p){const{width:m,height:y}=i,I=!(this.size&&this.size[0]===m&&this.size[1]===y||p),{context:L}=this,{gl:M}=L;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),I)this.size=[m,y],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||a.b(i)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,i):M.texImage2D(M.TEXTURE_2D,0,this.format,m,y,0,this.format,M.UNSIGNED_BYTE,i.data);else{const{x:R,y:O}=p||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||a.b(i)?M.texSubImage2D(M.TEXTURE_2D,0,R,O,M.RGBA,M.UNSIGNED_BYTE,i):M.texSubImage2D(M.TEXTURE_2D,0,R,O,m,y,M.RGBA,M.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(i,h,p){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),p!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=y.LINEAR),i!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,p||i),this.filter=i),h!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,h),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function ae(b){const{userImage:i}=b;return!!(i&&i.render&&i.render())&&(b.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ge extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(i){const h=this.images[i];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(i,h){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,h){if(!i)return!0;let p=0;for(const m of i){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(i,h){if(!i)return!0;if(i.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,y=p&&p.height||h.data.height;return!(i[0]<0||m<i[0]||i[1]<0||y<i[1]||i[2]<0||m<i[2]||i[3]<0||y<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,h,p=!0){const m=this.getImage(i);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const y of i)this.images[y]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:h})})}_getImagesForIds(i){const h={};for(const p of i){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],p=this.getImage(i);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new a.I(m,p);this.patterns[i]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ce(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const y in this.patterns)i.push(this.patterns[y].bin);const{w:h,h:p}=a.p(i),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const y in this.patterns){const{bin:I}=this.patterns[y],L=I.x+1,M=I.y+1,R=this.getImage(y).data,O=R.width,N=R.height;a.R.copy(R,m,{x:0,y:0},{x:L,y:M},{width:O,height:N}),a.R.copy(R,m,{x:0,y:N-1},{x:L,y:M-1},{width:O,height:1}),a.R.copy(R,m,{x:0,y:0},{x:L,y:M+N},{width:O,height:1}),a.R.copy(R,m,{x:O-1,y:0},{x:L-1,y:M},{width:1,height:N}),a.R.copy(R,m,{x:0,y:0},{x:L+O,y:M},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ae(p)&&this.updateImage(h,p)}}}const Le=1e20;function Pe(b,i,h,p,m,y,I,L,M){for(let R=i;R<i+p;R++)rt(b,h*y+R,y,m,I,L,M);for(let R=h;R<h+m;R++)rt(b,R*y+i,1,p,I,L,M)}function rt(b,i,h,p,m,y,I){y[0]=0,I[0]=-Le,I[1]=Le,m[0]=b[i];for(let L=1,M=0,R=0;L<p;L++){m[L]=b[i+L*h];const O=L*L;do{const N=y[M];R=(m[L]-m[N]+O-N*N)/(L-N)/2}while(R<=I[M]&&--M>-1);M++,y[M]=L,I[M]=R,I[M+1]=Le}for(let L=0,M=0;L<p;L++){for(;I[M+1]<L;)M++;const R=y[M],O=L-R;b[i+L*h]=m[R]+O*O}}class it{constructor(i,h){this.requestManager=i,this.localIdeographFontFamily=h,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return a._(this,void 0,void 0,function*(){const h=[];for(const y in i)for(const I of i[y])h.push(this._getAndCacheGlyphsPromise(y,I));const p=yield Promise.all(h),m={};for(const{stack:y,id:I,glyph:L}of p)m[y]||(m[y]={}),m[y][I]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};return m})}_getAndCacheGlyphsPromise(i,h){return a._(this,void 0,void 0,function*(){let p=this.entries[i];p||(p=this.entries[i]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:i,id:h,glyph:m};if(m=this._tinySDF(p,i,h),m)return p.glyphs[h]=m,{stack:i,id:h,glyph:m};const y=Math.floor(h/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[y])return{stack:i,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[y]){const L=it.loadGlyphRange(i,y,this.url,this.requestManager);p.requests[y]=L}const I=yield p.requests[y];for(const L in I)this._doesCharSupportLocalGlyph(+L)||(p.glyphs[+L]=I[+L]);return p.ranges[y]=!0,{stack:i,id:h,glyph:I[h]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(i))}_tinySDF(i,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let y=i.tinySDF;if(!y){let L="400";/bold/i.test(h)?L="900":/medium/i.test(h)?L="500":/light/i.test(h)&&(L="200"),y=i.tinySDF=new it.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:L})}const I=y.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}it.loadGlyphRange=function(b,i,h,p){return a._(this,void 0,void 0,function*(){const m=256*i,y=m+255,I=p.transformRequest(h.replace("{fontstack}",b).replace("{range}",`${m}-${y}`),"Glyphs"),L=yield a.l(I,new AbortController);if(!L||!L.data)throw new Error(`Could not load glyph range. range: ${i}, ${m}-${y}`);const M={};for(const R of a.n(L.data))M[R.id]=R;return M})},it.TinySDF=class{constructor({fontSize:b=24,buffer:i=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:I="normal"}={}){this.buffer=i,this.cutoff=p,this.radius=h;const L=this.size=b+4*i,M=this._createCanvas(L),R=this.ctx=M.getContext("2d",{willReadFrequently:!0});R.font=`${I} ${y} ${b}px ${m}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(b){const i=document.createElement("canvas");return i.width=i.height=b,i}draw(b){const{width:i,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(b),I=Math.ceil(h),L=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),M=Math.min(this.size-this.buffer,I+Math.ceil(p)),R=L+2*this.buffer,O=M+2*this.buffer,N=Math.max(R*O,0),J=new Uint8ClampedArray(N),oe={data:J,width:R,height:O,glyphWidth:L,glyphHeight:M,glyphTop:I,glyphLeft:0,glyphAdvance:i};if(L===0||M===0)return oe;const{ctx:he,buffer:ge,gridInner:ve,gridOuter:ke}=this;he.clearRect(ge,ge,L,M),he.fillText(b,ge,ge+I);const Ee=he.getImageData(ge,ge,L,M);ke.fill(Le,0,N),ve.fill(0,0,N);for(let me=0;me<M;me++)for(let De=0;De<L;De++){const Be=Ee.data[4*(me*L+De)+3]/255;if(Be===0)continue;const He=(me+ge)*R+De+ge;if(Be===1)ke[He]=0,ve[He]=Le;else{const ot=.5-Be;ke[He]=ot>0?ot*ot:0,ve[He]=ot<0?ot*ot:0}}Pe(ke,0,0,R,O,R,this.f,this.v,this.z),Pe(ve,ge,ge,L,M,R,this.f,this.v,this.z);for(let me=0;me<N;me++){const De=Math.sqrt(ke[me])-Math.sqrt(ve[me]);J[me]=Math.round(255-255*(De/this.radius+this.cutoff))}return oe}};class Qe{constructor(){this.specification=a.v.light.position}possiblyEvaluate(i,h){return a.x(i.expression.evaluate(h))}interpolate(i,h,p){return{x:a.y.number(i.x,h.x,p),y:a.y.number(i.y,h.y,p),z:a.y.number(i.z,h.z,p)}}}let Ft;class jt extends a.E{constructor(i){super(),Ft=Ft||new a.q({anchor:new a.D(a.v.light.anchor),position:new Qe,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ft),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(a.r,i,h))for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p){return(!p||p.validate!==!1)&&a.t(this,i.call(a.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const ut=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class et extends a.E{constructor(i){super(),this._transitionable=new a.T(ut),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(i,h={}){if(!this._validate(a.B,i,h)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p={}){return(p==null?void 0:p.validate)!==!1&&a.t(this,i.call(a.u,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class at{constructor(i,h){this.width=i,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,h){const p=i.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(i,h)),this.dashEntry[p]}getDashRanges(i,h,p){const m=[];let y=i.length%2==1?-i[i.length-1]*p:0,I=i[0]*p,L=!0;m.push({left:y,right:I,isDash:L,zeroLength:i[0]===0});let M=i[0];for(let R=1;R<i.length;R++){L=!L;const O=i[R];y=M*p,M+=O,I=M*p,m.push({left:y,right:I,isDash:L,zeroLength:O===0})}return m}addRoundDash(i,h,p){const m=h/2;for(let y=-p;y<=p;y++){const I=this.width*(this.nextRow+p+y);let L=0,M=i[L];for(let R=0;R<this.width;R++){R/M.right>1&&(M=i[++L]);const O=Math.abs(R-M.left),N=Math.abs(R-M.right),J=Math.min(O,N);let oe;const he=y/p*(m+1);if(M.isDash){const ge=m-Math.abs(he);oe=Math.sqrt(J*J+ge*ge)}else oe=m-Math.sqrt(J*J+he*he);this.data[I+R]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(i){for(let L=i.length-1;L>=0;--L){const M=i[L],R=i[L+1];M.zeroLength?i.splice(L,1):R&&R.isDash===M.isDash&&(R.left=M.left,i.splice(L,1))}const h=i[0],p=i[i.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let y=0,I=i[y];for(let L=0;L<this.width;L++){L/I.right>1&&(I=i[++y]);const M=Math.abs(L-I.left),R=Math.abs(L-I.right),O=Math.min(M,R);this.data[m+L]=Math.max(0,Math.min(255,(I.isDash?O:-O)+128))}}addDash(i,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let y=0;for(let L=0;L<i.length;L++)y+=i[L];if(y!==0){const L=this.width/y,M=this.getDashRanges(i,this.width,L);h?this.addRoundDash(M,L,p):this.addRegularDash(M)}const I={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:y};return this.nextRow+=m,this.dirty=!0,I}bind(i){const h=i.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Bt="maplibre_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Bt]}numActive(){return Object.keys(this.active).length}}const Ht=Math.floor(S.hardwareConcurrency/2);let li,ai;function ki(){return li||(li=new Dt),li}Dt.workerCount=a.C(globalThis)?Math.max(Math.min(Ht,3),1):1;class Fi{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const y=new a.F(p[m],h);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:i,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,h){for(const p of this.actors)p.registerMessageHandler(i,h)}}function bi(){return ai||(ai=new Fi(ki(),a.G),ai.registerMessageHandler("GR",(b,i,h)=>a.m(i,h))),ai}function di(b,i){const h=a.H();return a.J(h,h,[1,1,0]),a.K(h,h,[.5*b.width,.5*b.height,1]),a.L(h,h,b.calculatePosMatrix(i.toUnwrapped()))}function lt(b,i,h,p,m,y){const I=function(N,J,oe){if(N)for(const he of N){const ge=J[he];if(ge&&ge.source===oe&&ge.type==="fill-extrusion")return!0}else for(const he in J){const ge=J[he];if(ge.source===oe&&ge.type==="fill-extrusion")return!0}return!1}(m&&m.layers,i,b.id),L=y.maxPitchScaleFactor(),M=b.tilesIn(p,L,I);M.sort(qe);const R=[];for(const N of M)R.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(i,h,b._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,y,L,di(b.transform,N.tileID))});const O=function(N){const J={},oe={};for(const he of N){const ge=he.queryResults,ve=he.wrappedTileID,ke=oe[ve]=oe[ve]||{};for(const Ee in ge){const me=ge[Ee],De=ke[Ee]=ke[Ee]||{},Be=J[Ee]=J[Ee]||[];for(const He of me)De[He.featureIndex]||(De[He.featureIndex]=!0,Be.push(He))}}return J}(R);for(const N in O)O[N].forEach(J=>{const oe=J.feature,he=b.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=he});return O}function qe(b,i){const h=b.tileID,p=i.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function st(b,i,h){return a._(this,void 0,void 0,function*(){let p=b;if(b.url?p=(yield a.h(i.transformRequest(b.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.M(a.e(p,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(y=>y.id)),m})}class Te{constructor(i,h){i&&(h?this.setSouthWest(i).setNorthEast(h):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof a.N?new a.N(i.lng,i.lat):a.N.convert(i),this}setSouthWest(i){return this._sw=i instanceof a.N?new a.N(i.lng,i.lat):a.N.convert(i),this}extend(i){const h=this._sw,p=this._ne;let m,y;if(i instanceof a.N)m=i,y=i;else{if(!(i instanceof Te))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Te.convert(i)):this.extend(a.N.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(a.N.convert(i)):this;if(m=i._sw,y=i._ne,!m||!y)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(y.lng,p.lng),p.lat=Math.max(y.lat,p.lat)):(this._sw=new a.N(m.lng,m.lat),this._ne=new a.N(y.lng,y.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:h,lat:p}=a.N.convert(i);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(i){return i instanceof Te?i:i&&new Te(i)}static fromLngLat(i,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*i.lat);return new Te(new a.N(i.lng-m,i.lat-p),new a.N(i.lng+m,i.lat+p))}adjustAntiMeridian(){const i=new a.N(this._sw.lng,this._sw.lat),h=new a.N(this._ne.lng,this._ne.lat);return new Te(i,i.lng>h.lng?new a.N(h.lng+360,h.lat):h)}}class pt{constructor(i,h,p){this.bounds=Te.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),p=Math.floor(a.O(this.bounds.getWest())*h),m=Math.floor(a.Q(this.bounds.getNorth())*h),y=Math.ceil(a.O(this.bounds.getEast())*h),I=Math.ceil(a.Q(this.bounds.getSouth())*h);return i.x>=p&&i.x<y&&i.y>=m&&i.y<I}}class gt extends a.E{constructor(i,h,p,m){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield st(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(a.e(this,i),i.bounds&&(this.tileBounds=new pt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new a.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((y,I)=>{i.reloadPromise={resolve:y,reject:I}})}else i.actor=this.dispatcher.getActor(),m="LT";i.abortController=new AbortController;try{const y=yield i.actor.sendAsync({type:m,data:p},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,y)}catch(y){if(delete i.abortController,i.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,h){if(h&&h.resourceTiming&&(i.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&i.setExpiryData(h),i.loadVectorData(h,this.map.painter),i.reloadPromise){const p=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(p.resolve).catch(p.reject)}}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ce extends a.E{constructor(i,h,p,m){super(),this.id=i,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.M(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield st(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(a.e(this,i),i.bounds&&(this.tileBounds=new pt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new a.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return a.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const p=yield X.getImage(this.map._requestManager.transformRequest(h,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&i.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,y=m.gl,I=p.data;i.texture=this.map.painter.getTileTexture(I.width),i.texture?i.texture.update(I,{useMipmap:!0}):(i.texture=new ce(m,I,y.RGBA,{useMipmap:!0}),i.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(p){if(delete i.abortController,i.aborted)i.state="unloaded";else if(p)throw i.state="errored",p}})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class nt extends Ce{constructor(i,h,p,m){super(i,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const m=yield X.getImage(p,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&i.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const I=a.b(y)&&a.U()?y:yield this.readImageNow(y),L={type:this.type,uid:i.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const M=yield i.actor.sendAsync({type:"LDT",data:L});i.dem=M,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(m){if(delete i.abortController,i.aborted)i.state="unloaded";else if(m)throw i.state="errored",m}})}readImageNow(i){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const h=i.width+2,p=i.height+2;try{return new a.R({width:h,height:p},yield a.W(i,-1,-1,h,p))}catch{}}return S.getImageData(i,1)})}_getNeighboringTiles(i){const h=i.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,y=h.x===0?i.wrap-1:i.wrap,I=(h.x+1+p)%p,L=h.x+1===p?i.wrap+1:i.wrap,M={};return M[new a.S(i.overscaledZ,y,h.z,m,h.y).key]={backfilled:!1},M[new a.S(i.overscaledZ,L,h.z,I,h.y).key]={backfilled:!1},h.y>0&&(M[new a.S(i.overscaledZ,y,h.z,m,h.y-1).key]={backfilled:!1},M[new a.S(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new a.S(i.overscaledZ,L,h.z,I,h.y-1).key]={backfilled:!1}),h.y+1<p&&(M[new a.S(i.overscaledZ,y,h.z,m,h.y+1).key]={backfilled:!1},M[new a.S(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new a.S(i.overscaledZ,L,h.z,I,h.y+1).key]={backfilled:!1}),M}unloadTile(i){return a._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Xt extends a.E{constructor(i,h,p,m){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const y=a.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*y,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*y,extent:a.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.X,radius:(h.clusterRadius||50)*y,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}getData(){return a._(this,void 0,void 0,function*(){const i=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:h,offset:p}})}_updateWorkerData(i){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);i?h.dataDiff=i:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(y,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.actor?"RT":"LT";i.actor=this.actor;const p={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var vi=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ji extends a.E{constructor(i,h,p,m){super(),this.id=i,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(i){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield X.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,i&&(this.coordinates=i),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const h=i.map(a.Z.fromLngLat);this.tileID=function(m){let y=1/0,I=1/0,L=-1/0,M=-1/0;for(const J of m)y=Math.min(y,J.x),I=Math.min(I,J.y),L=Math.max(L,J.x),M=Math.max(M,J.y);const R=Math.max(L-y,M-I),O=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),N=Math.pow(2,O);return new a.a1(O,Math.floor((y+L)/2*N),Math.floor((I+M)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,vi.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ce(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ci extends ji{constructor(i,h,p,m){super(i,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const h of i.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,vi.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ce(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class _i extends ji{constructor(i,h,p,m){super(i,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(I=>typeof I!="number"))||this.fire(new a.j(new a.a2(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${i}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${i}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,vi.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ce(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const I=this.tiles[y];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Bi={},br=b=>{switch(b){case"geojson":return Xt;case"image":return ji;case"raster":return Ce;case"raster-dem":return nt;case"vector":return gt;case"video":return Ci;case"canvas":return _i}return Bi[b]},ct="RTLPluginLoaded";class tr extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=bi()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let _n=null;function qn(){return _n||(_n=new tr),_n}class Wr{constructor(i,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=a.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const h=i+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,y){const I={};if(!y)return I;for(const L of m){const M=L.layerIds.map(R=>y.getLayer(R)).filter(Boolean);if(M.length!==0){L.layers=M,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(R=>M.filter(O=>O.id===R)[0]));for(const R of M)I[R.id]=L}}return I}(i.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a6){if(this.hasSymbolBuckets=!0,!p)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a6&&y.hasRTLText){this.hasRTLText=!0,qn().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(y))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(i)}const h=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ce(i,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ce(i,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,h,p,m,y,I,L,M,R,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:I,tileSize:this.tileSize,pixelPosMatrix:O,transform:M,params:L,queryPadding:this.queryPadding*R},i,h,p):{}}querySourceFeatures(i,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),y=h&&h.sourceLayer?h.sourceLayer:"",I=m._geojsonTileLayer||m[y];if(!I)return;const L=a.a7(h&&h.filter),{z:M,x:R,y:O}=this.tileID.canonical,N={z:M,x:R,y:O};for(let J=0;J<I.length;J++){const oe=I.feature(J);if(L.needGeometry){const ve=a.a8(oe,!0);if(!L.filter(new a.z(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!L.filter(new a.z(this.tileID.overscaledZ),oe))continue;const he=p.getId(oe,y),ge=new a.a9(oe,M,R,O,he);ge.tile=N,i.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const h=this.expirationTime;if(i.cacheControl){const p=a.aa(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const y=this.expirationTime-h;y?this.expirationTime=p+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const y=this.buckets[m],I=y.layers[0].sourceLayer||"_geojsonTileLayer",L=p[I],M=i[I];if(!L||!M||Object.keys(M).length===0)continue;y.update(M,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=h&&h.style&&h.style.getLayer(m);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=S.now()+i}setDependencies(i,h){const p={};for(const m of h)p[m]=!0;this.dependencies[i]=p}hasDependency(i,h){for(const p of i){const m=this.dependencies[p];if(m){for(const y of h)if(m[y])return!0}}return!1}}class bt{constructor(i,h){this.max=i,this.onRemove=h,this.reset()}reset(){for(const i in this.data)for(const h of this.data[i])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(i,h,p){const m=i.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:h,timeout:void 0};if(p!==void 0&&(y.timeout=setTimeout(()=>{this.remove(i,y)},p)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const h=this.data[i].shift();return h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),h.value}getByKey(i){const h=this.data[i];return h?h[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,h){if(!this.has(i))return this;const p=i.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),y=this.data[p][m];return this.data[p].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(y.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(i){const h=[];for(const p in this.data)for(const m of this.data[p])i(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class ci{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,h,p){const m=String(h);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},a.e(this.stateChanges[i][m],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const y in this.state[i])y!==m&&(this.deletedStates[i][y]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][m]===null){this.deletedStates[i][m]={};for(const y in this.state[i][m])p[y]||(this.deletedStates[i][m][y]=null)}else for(const y in p)this.deletedStates[i]&&this.deletedStates[i][m]&&this.deletedStates[i][m][y]===null&&delete this.deletedStates[i][m][y]}removeFeatureState(i,h,p){if(this.deletedStates[i]===null)return;const m=String(h);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&h!==void 0)this.deletedStates[i][m]!==null&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][p]=null);else if(h!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][m])for(p in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][p]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,h){const p=String(h),m=a.e({},(this.state[i]||{})[p],(this.stateChanges[i]||{})[p]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const y=this.deletedStates[i][h];if(y===null)return{};for(const I in y)delete m[I]}return m}initializeTileState(i,h){i.setFeatureState(this.state,h)}coalesceChanges(i,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const I in this.stateChanges[m])this.state[m][I]||(this.state[m][I]={}),a.e(this.state[m][I],this.stateChanges[m][I]),y[I]=this.state[m][I];p[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const I in this.state[m])y[I]={},this.state[m][I]={};else for(const I in this.deletedStates[m]){if(this.deletedStates[m][I]===null)this.state[m][I]={};else for(const L of Object.keys(this.deletedStates[m][I]))delete this.state[m][I][L];y[I]=this.state[m][I]}p[m]=p[m]||{},a.e(p[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in i)i[m].setFeatureState(p,h)}}class Jt extends a.E{constructor(i,h,p){super(),this.id=i,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,I,L)=>{const M=new(br(y.type))(m,y,I,L);if(M.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${M.id}`);return M})(i,h,p,this),this._tiles={},this._cache=new bt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ci,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,h,p)}catch(m){i.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new a.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(i),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(In).map(i=>i.key)}getRenderableIds(i){const h=[];for(const p in this._tiles)this._isIdRenderable(p,i)&&h.push(this._tiles[p]);return i?h.sort((p,m)=>{const y=p.tileID,I=m.tileID,L=new a.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),M=new a.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-I.overscaledZ||M.y-L.y||M.x-L.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(In).map(p=>p.key)}hasRenderableParent(i){const h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,i,h))})}_tileLoaded(i,h,p){i.timeAdded=S.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const y=h[m];if(i.neighboringTiles&&i.neighboringTiles[y]){const I=this.getTileByID(y);p(i,I),p(I,i)}}function p(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let I=y.tileID.canonical.x-m.tileID.canonical.x;const L=y.tileID.canonical.y-m.tileID.canonical.y,M=Math.pow(2,m.tileID.canonical.z),R=y.tileID.key;I===0&&L===0||Math.abs(L)>1||(Math.abs(I)>1&&(Math.abs(I+M)===1?I+=M:Math.abs(I-M)===1&&(I-=M)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,I,L),m.neighboringTiles&&m.neighboringTiles[R]&&(m.neighboringTiles[R].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,h,p,m){for(const y in this._tiles){let I=this._tiles[y];if(m[y]||!I.hasData()||I.tileID.overscaledZ<=h||I.tileID.overscaledZ>p)continue;let L=I.tileID;for(;I&&I.tileID.overscaledZ>h+1;){const R=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[R.key],I&&I.hasData()&&(L=R)}let M=L;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),i[M.key]){m[L.key]=L;break}}}findLoadedParent(i,h){if(i.key in this._loadedParentTiles){const p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=i.overscaledZ-1;p>=h;p--){const m=i.scaledTo(p),y=this._getLoadedTile(m);if(y)return y}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const h=Math.ceil(i.width/this._source.tileSize)+1,p=Math.ceil(i.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(i){const h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){const p={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+h),p[y.tileID.key]=y}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(i,h,p,m,y,I){const L={},M={},R=Object.keys(i),O=S.now();for(const N of R){const J=i[N],oe=this._tiles[N];if(!oe||oe.fadeEndTime!==0&&oe.fadeEndTime<=O)continue;const he=this.findLoadedParent(J,h),ge=this.findLoadedSibling(J),ve=he||ge||null;ve&&(this._addTile(ve.tileID),L[ve.tileID.key]=ve.tileID),M[N]=J}this._retainLoadedChildren(M,m,p,i);for(const N in L)i[N]||(this._coveredTiles[N]=!0,i[N]=L[N]);if(I){const N={},J={};for(const oe of y)this._tiles[oe.key].hasData()?N[oe.key]=oe:J[oe.key]=oe;for(const oe in J){const he=J[oe].children(this._source.maxzoom);this._tiles[he[0].key]&&this._tiles[he[1].key]&&this._tiles[he[2].key]&&this._tiles[he[3].key]&&(N[he[0].key]=i[he[0].key]=he[0],N[he[1].key]=i[he[1].key]=he[1],N[he[2].key]=i[he[2].key]=he[2],N[he[3].key]=i[he[3].key]=he[3],delete J[oe])}for(const oe in J){const he=J[oe],ge=this.findLoadedParent(he,this._source.minzoom),ve=this.findLoadedSibling(he),ke=ge||ve||null;if(ke){N[ke.tileID.key]=i[ke.tileID.key]=ke.tileID;for(const Ee in N)N[Ee].isChildOf(ke.tileID)&&delete N[Ee]}}for(const oe in this._tiles)N[oe]||(this._coveredTiles[oe]=!0)}}update(i,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=i,this.terrain=h,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new a.S(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(p=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(O=>this._source.hasTile(O)))):p=[];const m=i.coveringZoomLevel(this._source),y=Math.max(m-Jt.maxOverzooming,this._source.minzoom),I=Math.max(m+Jt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const O={};for(const N of p)if(N.canonical.z>this._source.minzoom){const J=N.scaledTo(N.canonical.z-1);O[J.key]=J;const oe=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));O[oe.key]=oe}p=p.concat(Object.values(O))}const L=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,L&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(p,m);Nn(this._source.type)&&this._updateCoveredAndRetainedTiles(M,y,I,m,p,h);for(const O in M)this._tiles[O].clearFadeHold();const R=a.ab(this._tiles,M);for(const O of R){const N=this._tiles[O];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(O)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,h){var p;const m={},y={},I=Math.max(h-Jt.maxOverzooming,this._source.minzoom),L=Math.max(h+Jt.maxUnderzooming,this._source.minzoom),M={};for(const R of i){const O=this._addTile(R);m[R.key]=R,O.hasData()||h<this._source.maxzoom&&(M[R.key]=R)}this._retainLoadedChildren(M,h,L,m);for(const R of i){let O=this._tiles[R.key];if(O.hasData())continue;if(h+1>this._source.maxzoom){const J=R.children(this._source.maxzoom)[0],oe=this.getTile(J);if(oe&&oe.hasData()){m[J.key]=J;continue}}else{const J=R.children(this._source.maxzoom);if(m[J[0].key]&&m[J[1].key]&&m[J[2].key]&&m[J[3].key])continue}let N=O.wasRequested();for(let J=R.overscaledZ-1;J>=I;--J){const oe=R.scaledTo(J);if(y[oe.key])break;if(y[oe.key]=!0,O=this.getTile(oe),!O&&N&&(O=this._addTile(oe)),O){const he=O.hasData();if((he||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||N)&&(m[oe.key]=oe),N=O.wasRequested(),he)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const h=[];let p,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(y),p)break;m=y}for(const y of h)this._loadedParentTiles[y]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const h=this._tiles[i].tileID,p=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=p}}_addTile(i){let h=this._tiles[i.key];if(h)return h;h=this._cache.getAndRemove(i),h&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));const p=h;return h||(h=new Wr(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,i.key,h.state)),h.uses++,this._tiles[i.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(i,h){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const p=h.getExpiryTimeout();p&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},p))}_removeTile(i){const h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(i){const h=i.sourceDataType;i.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,h,p){const m=[],y=this.transform;if(!y)return m;const I=p?y.getCameraQueryGeometry(i):i,L=i.map(he=>y.pointCoordinate(he,this.terrain)),M=I.map(he=>y.pointCoordinate(he,this.terrain)),R=this.getIds();let O=1/0,N=1/0,J=-1/0,oe=-1/0;for(const he of M)O=Math.min(O,he.x),N=Math.min(N,he.y),J=Math.max(J,he.x),oe=Math.max(oe,he.y);for(let he=0;he<R.length;he++){const ge=this._tiles[R[he]];if(ge.holdingForFade())continue;const ve=ge.tileID,ke=Math.pow(2,y.zoom-ge.tileID.overscaledZ),Ee=h*ge.queryPadding*a.X/ge.tileSize/ke,me=[ve.getTilePoint(new a.Z(O,N)),ve.getTilePoint(new a.Z(J,oe))];if(me[0].x-Ee<a.X&&me[0].y-Ee<a.X&&me[1].x+Ee>=0&&me[1].y+Ee>=0){const De=L.map(He=>ve.getTilePoint(He)),Be=M.map(He=>ve.getTilePoint(He));m.push({tile:ge,tileID:ve,queryGeometry:De,cameraQueryGeometry:Be,scale:ke})}}return m}getVisibleCoordinates(i){const h=this.getRenderableIds(i).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Nn(this._source.type)){const i=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=i)return!0}return!1}setFeatureState(i,h,p){this._state.updateState(i=i||"_geojsonTileLayer",h,p)}removeFeatureState(i,h,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,p)}getFeatureState(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)}setDependencies(i,h,p){const m=this._tiles[i];m&&m.setDependencies(h,p)}reloadTilesForDependencies(i,h){for(const p in this._tiles)this._tiles[p].hasDependency(i,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(i,h))}}function In(b,i){const h=Math.abs(2*b.wrap)-+(b.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return b.overscaledZ-i.overscaledZ||p-h||i.canonical.y-b.canonical.y||i.canonical.x-b.canonical.x}function Nn(b){return b==="raster"||b==="image"||b==="video"}Jt.maxOverzooming=10,Jt.maxUnderzooming=3;class ei{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.ac(i,0,1);let h=1,p=this._distances[h];const m=i*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const y=h-1,I=this._distances[y],L=p-I,M=L>0?(m-I)/L:0;return this.points[y].mult(1-M).add(this.points[h].mult(M))}}function vr(b,i){let h=!0;return b==="always"||b!=="never"&&i!=="never"||(h=!1),h}class Fr{constructor(i,h,p){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(h/p);for(let I=0;I<this.xCellCount*this.yCellCount;I++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,p,m,y){this._forEachCell(h,p,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(i,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(i,h,p,m,y,I){this.boxCells[y].push(I)}_insertCircleCell(i,h,p,m,y,I){this.circleCells[y].push(I)}_query(i,h,p,m,y,I,L){if(p<0||i>this.width||m<0||h>this.height)return[];const M=[];if(i<=0&&h<=0&&this.width<=p&&this.height<=m){if(y)return[{key:null,x1:i,y1:h,x2:p,y2:m}];for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],N=this.circles[3*R+1],J=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:O-J,y1:N-J,x2:O+J,y2:N+J})}}else this._forEachCell(i,h,p,m,this._queryCell,M,{hitTest:y,overlapMode:I,seenUids:{box:{},circle:{}}},L);return M}query(i,h,p,m){return this._query(i,h,p,m,!1,null)}hitTest(i,h,p,m,y,I){return this._query(i,h,p,m,!0,y,I).length>0}hitTestCircle(i,h,p,m,y){const I=i-p,L=i+p,M=h-p,R=h+p;if(L<0||I>this.width||R<0||M>this.height)return!1;const O=[];return this._forEachCell(I,M,L,R,this._queryCellCircle,O,{hitTest:!0,overlapMode:m,circle:{x:i,y:h,radius:p},seenUids:{box:{},circle:{}}},y),O.length>0}_queryCell(i,h,p,m,y,I,L,M){const{seenUids:R,hitTest:O,overlapMode:N}=L,J=this.boxCells[y];if(J!==null){const he=this.bboxes;for(const ge of J)if(!R.box[ge]){R.box[ge]=!0;const ve=4*ge,ke=this.boxKeys[ge];if(i<=he[ve+2]&&h<=he[ve+3]&&p>=he[ve+0]&&m>=he[ve+1]&&(!M||M(ke))&&(!O||!vr(N,ke.overlapMode))&&(I.push({key:ke,x1:he[ve],y1:he[ve+1],x2:he[ve+2],y2:he[ve+3]}),O))return!0}}const oe=this.circleCells[y];if(oe!==null){const he=this.circles;for(const ge of oe)if(!R.circle[ge]){R.circle[ge]=!0;const ve=3*ge,ke=this.circleKeys[ge];if(this._circleAndRectCollide(he[ve],he[ve+1],he[ve+2],i,h,p,m)&&(!M||M(ke))&&(!O||!vr(N,ke.overlapMode))){const Ee=he[ve],me=he[ve+1],De=he[ve+2];if(I.push({key:ke,x1:Ee-De,y1:me-De,x2:Ee+De,y2:me+De}),O)return!0}}}return!1}_queryCellCircle(i,h,p,m,y,I,L,M){const{circle:R,seenUids:O,overlapMode:N}=L,J=this.boxCells[y];if(J!==null){const he=this.bboxes;for(const ge of J)if(!O.box[ge]){O.box[ge]=!0;const ve=4*ge,ke=this.boxKeys[ge];if(this._circleAndRectCollide(R.x,R.y,R.radius,he[ve+0],he[ve+1],he[ve+2],he[ve+3])&&(!M||M(ke))&&!vr(N,ke.overlapMode))return I.push(!0),!0}}const oe=this.circleCells[y];if(oe!==null){const he=this.circles;for(const ge of oe)if(!O.circle[ge]){O.circle[ge]=!0;const ve=3*ge,ke=this.circleKeys[ge];if(this._circlesCollide(he[ve],he[ve+1],he[ve+2],R.x,R.y,R.radius)&&(!M||M(ke))&&!vr(N,ke.overlapMode))return I.push(!0),!0}}}_forEachCell(i,h,p,m,y,I,L,M){const R=this._convertToXCellCoord(i),O=this._convertToYCellCoord(h),N=this._convertToXCellCoord(p),J=this._convertToYCellCoord(m);for(let oe=R;oe<=N;oe++)for(let he=O;he<=J;he++)if(y.call(this,i,h,p,m,this.xCellCount*he+oe,I,L,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,p,m,y,I){const L=m-i,M=y-h,R=p+I;return R*R>L*L+M*M}_circleAndRectCollide(i,h,p,m,y,I,L){const M=(I-m)/2,R=Math.abs(i-(m+M));if(R>M+p)return!1;const O=(L-y)/2,N=Math.abs(h-(y+O));if(N>O+p)return!1;if(R<=M||N<=O)return!0;const J=R-M,oe=N-O;return J*J+oe*oe<=p*p}}function Hr(b,i,h,p,m){const y=a.H();return i?(a.K(y,y,[1/m,1/m,1]),h||a.ad(y,y,p.angle)):a.L(y,p.labelPlaneMatrix,b),y}function wr(b,i,h,p,m){if(i){const y=a.ae(b);return a.K(y,y,[m,m,1]),h||a.ad(y,y,-p.angle),y}return p.glCoordMatrix}function ye(b,i,h,p){let m;p?(m=[b,i,p(b,i),1],a.af(m,m,h)):(m=[b,i,0,1],pi(m,m,h));const y=m[3];return{point:new a.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Z(b,i){return .5+b/i*.5}function q(b,i){return b.x>=-i[0]&&b.x<=i[0]&&b.y>=-i[1]&&b.y<=i[1]}function ne(b,i,h,p,m,y,I,L,M,R,O,N,J,oe,he){const ge=p?b.textSizeData:b.iconSizeData,ve=a.ag(ge,h.transform.zoom),ke=[256/h.width*2+1,256/h.height*2+1],Ee=p?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;Ee.clear();const me=b.lineVertexArray,De=p?b.text.placedSymbolArray:b.icon.placedSymbolArray,Be=h.transform.width/h.transform.height;let He=!1;for(let ot=0;ot<De.length;ot++){const vt=De.get(ot);if(vt.hidden||vt.writingMode===a.ah.vertical&&!He){Et(vt.numGlyphs,Ee);continue}He=!1;const It=ye(vt.anchorX,vt.anchorY,i,he);if(!q(It.point,ke)){Et(vt.numGlyphs,Ee);continue}const At=Z(h.transform.cameraToCenterDistance,It.signedDistanceFromCamera),kt=a.ai(ge,ve,vt),xt=I?kt/At:kt*At,Nt={getElevation:he,labelPlaneMatrix:m,lineVertexArray:me,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:R,tileAnchorPoint:new a.P(vt.anchorX,vt.anchorY),unwrappedTileID:O,width:N,height:J,translation:oe},ri=ze(Nt,vt,xt,!1,L,i,y,b.glyphOffsetArray,Ee,Be,M);He=ri.useVertical,(ri.notEnoughRoom||He||ri.needsFlipping&&ze(Nt,vt,xt,!0,L,i,y,b.glyphOffsetArray,Ee,Be,M).notEnoughRoom)&&Et(vt.numGlyphs,Ee)}p?b.text.dynamicLayoutVertexBuffer.updateData(Ee):b.icon.dynamicLayoutVertexBuffer.updateData(Ee)}function pe(b,i,h,p,m,y,I,L){const M=y.glyphStartIndex+y.numGlyphs,R=y.lineStartIndex,O=y.lineStartIndex+y.lineLength,N=i.getoffsetX(y.glyphStartIndex),J=i.getoffsetX(M-1),oe=Xe(b*N,h,p,m,y.segment,R,O,L,I);if(!oe)return null;const he=Xe(b*J,h,p,m,y.segment,R,O,L,I);return he?L.projectionCache.anyProjectionOccluded?null:{first:oe,last:he}:null}function Me(b,i,h,p){return b===a.ah.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*p?{useVertical:!0}:(b===a.ah.vertical?i.y<h.y:i.x>h.x)?{needsFlipping:!0}:null}function ze(b,i,h,p,m,y,I,L,M,R,O){const N=h/24,J=i.lineOffsetX*N,oe=i.lineOffsetY*N;let he;if(i.numGlyphs>1){const ge=i.glyphStartIndex+i.numGlyphs,ve=i.lineStartIndex,ke=i.lineStartIndex+i.lineLength,Ee=pe(N,L,J,oe,p,i,O,b);if(!Ee)return{notEnoughRoom:!0};const me=ye(Ee.first.point.x,Ee.first.point.y,I,b.getElevation).point,De=ye(Ee.last.point.x,Ee.last.point.y,I,b.getElevation).point;if(m&&!p){const Be=Me(i.writingMode,me,De,R);if(Be)return Be}he=[Ee.first];for(let Be=i.glyphStartIndex+1;Be<ge-1;Be++)he.push(Xe(N*L.getoffsetX(Be),J,oe,p,i.segment,ve,ke,b,O));he.push(Ee.last)}else{if(m&&!p){const ve=ye(b.tileAnchorPoint.x,b.tileAnchorPoint.y,y,b.getElevation).point,ke=i.lineStartIndex+i.segment+1,Ee=new a.P(b.lineVertexArray.getx(ke),b.lineVertexArray.gety(ke)),me=ye(Ee.x,Ee.y,y,b.getElevation),De=me.signedDistanceFromCamera>0?me.point:function(He,ot,vt,It,At,kt){return Ve(He,ot,vt,1,At,kt)}(b.tileAnchorPoint,Ee,ve,0,y,b),Be=Me(i.writingMode,ve,De,R);if(Be)return Be}const ge=Xe(N*L.getoffsetX(i.glyphStartIndex),J,oe,p,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,b,O);if(!ge||b.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};he=[ge]}for(const ge of he)a.aj(M,ge.point,ge.angle);return{}}function Ve(b,i,h,p,m,y){const I=b.add(b.sub(i)._unit()),L=m!==void 0?ye(I.x,I.y,m,y.getElevation).point:Re(I.x,I.y,y).point,M=h.sub(L);return h.add(M._mult(p/M.mag()))}function j(b,i,h){const p=i.projectionCache;if(p.projections[b])return p.projections[b];const m=new a.P(i.lineVertexArray.getx(b),i.lineVertexArray.gety(b)),y=Re(m.x,m.y,i);if(y.signedDistanceFromCamera>0)return p.projections[b]=y.point,p.anyProjectionOccluded=p.anyProjectionOccluded||y.isOccluded,y.point;const I=b-h.direction;return function(L,M,R,O,N){return Ve(L,M,R,O,void 0,N)}(h.distanceFromAnchor===0?i.tileAnchorPoint:new a.P(i.lineVertexArray.getx(I),i.lineVertexArray.gety(I)),m,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,i)}function Re(b,i,h){const p=b+h.translation[0],m=i+h.translation[1];let y;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(y=h.projection.projectTileCoordinates(p,m,h.unwrappedTileID,h.getElevation),y.point.x=(.5*y.point.x+.5)*h.width,y.point.y=(.5*-y.point.y+.5)*h.height):(y=ye(p,m,h.labelPlaneMatrix,h.getElevation),y.isOccluded=!1),y}function Ke(b,i,h){return b._unit()._perp()._mult(i*h)}function $e(b,i,h,p,m,y,I,L,M){if(L.projectionCache.offsets[b])return L.projectionCache.offsets[b];const R=h.add(i);if(b+M.direction<p||b+M.direction>=m)return L.projectionCache.offsets[b]=R,R;const O=j(b+M.direction,L,M),N=Ke(O.sub(h),I,M.direction),J=h.add(N),oe=O.add(N);return L.projectionCache.offsets[b]=a.ak(y,R,J,oe)||R,L.projectionCache.offsets[b]}function Xe(b,i,h,p,m,y,I,L,M){const R=p?b-i:b+i;let O=R>0?1:-1,N=0;p&&(O*=-1,N=Math.PI),O<0&&(N+=Math.PI);let J,oe=O>0?y+m:y+m+1;L.projectionCache.cachedAnchorPoint?J=L.projectionCache.cachedAnchorPoint:(J=Re(L.tileAnchorPoint.x,L.tileAnchorPoint.y,L).point,L.projectionCache.cachedAnchorPoint=J);let he,ge,ve=J,ke=J,Ee=0,me=0;const De=Math.abs(R),Be=[];let He;for(;Ee+me<=De;){if(oe+=O,oe<y||oe>=I)return null;Ee+=me,ke=ve,ge=he;const It={absOffsetX:De,direction:O,distanceFromAnchor:Ee,previousVertex:ke};if(ve=j(oe,L,It),h===0)Be.push(ke),He=ve.sub(ke);else{let At;const kt=ve.sub(ke);At=kt.mag()===0?Ke(j(oe+O,L,It).sub(ve),h,O):Ke(kt,h,O),ge||(ge=ke.add(At)),he=$e(oe,At,ve,y,I,ge,h,L,It),Be.push(ge),He=he.sub(ge)}me=He.mag()}const ot=He._mult((De-Ee)/me)._add(ge||ke),vt=N+Math.atan2(ve.y-ke.y,ve.x-ke.x);return Be.push(ot),{point:ot,angle:M?vt:0,path:Be}}const mt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Et(b,i){for(let h=0;h<b;h++){const p=i.length;i.resize(p+4),i.float32.set(mt,3*p)}}function pi(b,i,h){const p=i[0],m=i[1];return b[0]=h[0]*p+h[4]*m+h[12],b[1]=h[1]*p+h[5]*m+h[13],b[3]=h[3]*p+h[7]*m+h[15],b}const Qt=100;class hi{constructor(i,h,p=new Fr(i.width+200,i.height+200,25),m=new Fr(i.width+200,i.height+200,25)){this.transform=i,this.mapProjection=h,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Qt,this.screenBottomBoundary=i.height+Qt,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,h,p,m,y,I,L,M,R,O,N){const J=i.anchorPointX+M[0],oe=i.anchorPointY+M[1],he=this.projectAndGetPerspectiveRatio(m,J,oe,y,O),ge=p*he.perspectiveRatio;let ve;if(I||L)ve=this._projectCollisionBox(i,ge,m,y,I,L,M,he,O,N);else{const Be=he.point.x+(N?N.x*ge:0),He=he.point.y+(N?N.y*ge:0);ve={allPointsOccluded:!1,box:[Be+i.x1*ge,He+i.y1*ge,Be+i.x2*ge,He+i.y2*ge]}}const[ke,Ee,me,De]=ve.box;return this.mapProjection.useSpecialProjectionForSymbols&&(I?ve.allPointsOccluded:this.mapProjection.isOccluded(J,oe,y))||he.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ke,Ee,me,De)||h!=="always"&&this.grid.hitTest(ke,Ee,me,De,h,R)?{box:[ke,Ee,me,De],placeable:!1,offscreen:!1}:{box:[ke,Ee,me,De],placeable:!0,offscreen:this.isOffscreen(ke,Ee,me,De)}}placeCollisionCircles(i,h,p,m,y,I,L,M,R,O,N,J,oe,he,ge,ve){const ke=[],Ee=new a.P(h.anchorX,h.anchorY),me=this.getPerspectiveRatio(I,Ee.x,Ee.y,L,ve),De=(N?y/me:y*me)/a.ap,Be={getElevation:ve,labelPlaneMatrix:M,lineVertexArray:p,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ee,unwrappedTileID:L,width:this.transform.width,height:this.transform.height,translation:ge},He=pe(De,m,h.lineOffsetX*De,h.lineOffsetY*De,!1,h,!1,Be);let ot=!1,vt=!1,It=!0;if(He){const At=.5*oe*me+he,kt=new a.P(-100,-100),xt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new ei,ri=He.first,St=He.last;let Lt=[];for(let fi=ri.path.length-1;fi>=1;fi--)Lt.push(ri.path[fi]);for(let fi=1;fi<St.path.length;fi++)Lt.push(St.path[fi]);const ti=2.5*At;if(R){const fi=this.projectPathToScreenSpace(Lt,Be,R);Lt=fi.some(xi=>xi.signedDistanceFromCamera<=0)?[]:fi.map(xi=>xi.point)}let rn=[];if(Lt.length>0){const fi=Lt[0].clone(),xi=Lt[0].clone();for(let on=1;on<Lt.length;on++)fi.x=Math.min(fi.x,Lt[on].x),fi.y=Math.min(fi.y,Lt[on].y),xi.x=Math.max(xi.x,Lt[on].x),xi.y=Math.max(xi.y,Lt[on].y);rn=fi.x>=kt.x&&xi.x<=xt.x&&fi.y>=kt.y&&xi.y<=xt.y?[Lt]:xi.x<kt.x||fi.x>xt.x||xi.y<kt.y||fi.y>xt.y?[]:a.al([Lt],kt.x,kt.y,xt.x,xt.y)}for(const fi of rn){Nt.reset(fi,.25*At);let xi=0;xi=Nt.length<=.5*At?1:Math.ceil(Nt.paddedLength/ti)+1;for(let on=0;on<xi;on++){const nr=on/Math.max(xi-1,1),co=Nt.lerp(nr),sn=co.x+Qt,Sr=co.y+Qt;ke.push(sn,Sr,At,0);const pr=sn-At,rr=Sr-At,mr=sn+At,So=Sr+At;if(It=It&&this.isOffscreen(pr,rr,mr,So),vt=vt||this.isInsideGrid(pr,rr,mr,So),i!=="always"&&this.grid.hitTestCircle(sn,Sr,At,i,J)&&(ot=!0,!O))return{circles:[],offscreen:!1,collisionDetected:ot}}}}return{circles:!O&&ot||!vt||me<this.perspectiveRatioCutoff?[]:ke,offscreen:It,collisionDetected:ot}}projectPathToScreenSpace(i,h,p){return i.map(m=>ye(m.x,m.y,p,h.getElevation))}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,y=-1/0,I=-1/0;for(const O of i){const N=new a.P(O.x+Qt,O.y+Qt);p=Math.min(p,N.x),m=Math.min(m,N.y),y=Math.max(y,N.x),I=Math.max(I,N.y),h.push(N)}const L=this.grid.query(p,m,y,I).concat(this.ignoredGrid.query(p,m,y,I)),M={},R={};for(const O of L){const N=O.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;const J=[new a.P(O.x1,O.y1),new a.P(O.x2,O.y1),new a.P(O.x2,O.y2),new a.P(O.x1,O.y2)];a.am(h,J)&&(M[N.bucketInstanceId][N.featureIndex]=!0,R[N.bucketInstanceId]===void 0&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(i,h,p,m,y,I){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:I,overlapMode:h},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,p,m,y,I){const L=p?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:y,collisionGroupID:I,overlapMode:h};for(let R=0;R<i.length;R+=4)L.insertCircle(M,i[R],i[R+1],i[R+2])}projectAndGetPerspectiveRatio(i,h,p,m,y){let I;y?(I=[h,p,y(h,p),1],a.af(I,I,i)):(I=[h,p,0,1],pi(I,I,i));const L=I[3];return{point:new a.P((I[0]/L+1)/2*this.transform.width+Qt,(-I[1]/L+1)/2*this.transform.height+Qt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/L*.5,isOccluded:!1,signedDistanceFromCamera:L}}getPerspectiveRatio(i,h,p,m,y){const I=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,p,m,y):ye(h,p,i,y);return .5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5}isOffscreen(i,h,p,m){return p<Qt||i>=this.screenRightBoundary||m<Qt||h>this.screenBottomBoundary}isInsideGrid(i,h,p,m){return p>=0&&i<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=a.an([]);return a.J(i,i,[-100,-100,0]),i}_projectCollisionBox(i,h,p,m,y,I,L,M,R,O){let N=new a.P(1,0),J=new a.P(0,1);const oe=new a.P(i.anchorPointX+L[0],i.anchorPointY+L[1]);if(I&&!y){const It=this.projectAndGetPerspectiveRatio(p,oe.x+1,oe.y,m,R).point.sub(M.point).unit(),At=Math.atan(It.y/It.x)+(It.x<0?Math.PI:0),kt=Math.sin(At),xt=Math.cos(At);N=new a.P(xt,kt),J=new a.P(-kt,xt)}else if(!I&&y){const It=-this.transform.angle,At=Math.sin(It),kt=Math.cos(It);N=new a.P(kt,At),J=new a.P(-At,kt)}let he=M.point,ge=h;if(y){he=oe;const It=this.transform.zoom-Math.floor(this.transform.zoom);ge=Math.pow(2,-It),ge*=this.mapProjection.getPitchedTextCorrection(this.transform,oe,m),O||(ge*=a.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}O&&(he=he.add(N.mult(O.x*ge)).add(J.mult(O.y*ge)));const ve=i.x1*ge,ke=i.x2*ge,Ee=(ve+ke)/2,me=i.y1*ge,De=i.y2*ge,Be=(me+De)/2,He=[{offsetX:ve,offsetY:me},{offsetX:Ee,offsetY:me},{offsetX:ke,offsetY:me},{offsetX:ke,offsetY:Be},{offsetX:ke,offsetY:De},{offsetX:Ee,offsetY:De},{offsetX:ve,offsetY:De},{offsetX:ve,offsetY:Be}];let ot=[];for(const{offsetX:It,offsetY:At}of He)ot.push(new a.P(he.x+N.x*It+J.x*At,he.y+N.y*It+J.y*At));let vt=!1;if(y){const It=ot.map(At=>this.projectAndGetPerspectiveRatio(p,At.x,At.y,m,R));vt=It.some(At=>!At.isOccluded),ot=It.map(At=>At.point)}else vt=!0;return{box:a.ao(ot),allPointsOccluded:!vt}}}function wi(b,i,h){return i*(a.X/(b.tileSize*Math.pow(2,h-b.tileID.overscaledZ)))}class Dn{constructor(i,h,p,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class gn{constructor(i,h,p,m,y){this.text=new Dn(i?i.text:null,h,p,y),this.icon=new Dn(i?i.icon:null,h,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class mi{constructor(i,h,p){this.text=i,this.icon=h,this.skipFade=p}}class qi{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class un{constructor(i,h,p,m,y){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=y}}class Zn{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[i]}}function Kn(b,i,h,p,m){const{horizontalAlign:y,verticalAlign:I}=a.au(b);return new a.P(-(y-.5)*i+p[0]*m,-(I-.5)*h+p[1]*m)}class fr{constructor(i,h,p,m,y,I){this.transform=i.clone(),this.terrain=p,this.collisionIndex=new hi(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Zn(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const h=this.terrain;return h?(p,m)=>h.getElevation(i,p,m):null}getBucketParts(i,h,p,m){const y=p.getBucket(h),I=p.latestFeatureIndex;if(!y||!I||h.id!==y.layerIds[0])return;const L=p.collisionBoxArray,M=y.layers[0].layout,R=y.layers[0].paint,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/a.X,J=p.tileID.toUnwrapped(),oe=this.transform.calculatePosMatrix(J),he=M.get("text-pitch-alignment")==="map",ge=M.get("text-rotation-alignment")==="map",ve=wi(p,1,this.transform.zoom),ke=this.collisionIndex.mapProjection.translatePosition(this.transform,p,R.get("text-translate"),R.get("text-translate-anchor")),Ee=this.collisionIndex.mapProjection.translatePosition(this.transform,p,R.get("icon-translate"),R.get("icon-translate-anchor")),me=Hr(oe,he,ge,this.transform,ve);let De=null;if(he){const He=wr(oe,he,ge,this.transform,ve);De=a.L([],this.transform.labelPlaneMatrix,He)}this.retainedQueryData[y.bucketInstanceId]=new un(y.bucketInstanceId,I,y.sourceLayerIndex,y.index,p.tileID);const Be={bucket:y,layout:M,translationText:ke,translationIcon:Ee,posMatrix:oe,unwrappedTileID:J,textLabelPlaneMatrix:me,labelToScreenMatrix:De,scale:O,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:a.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const He of y.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:vt,symbolInstanceEnd:It}=He;i.push({sortKey:ot,symbolInstanceStart:vt,symbolInstanceEnd:It,parameters:Be})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(i,h,p,m,y,I,L,M,R,O,N,J,oe,he,ge,ve,ke,Ee,me){const De=a.aq[i.textAnchor],Be=[i.textOffset0,i.textOffset1],He=Kn(De,p,m,Be,y),ot=this.collisionIndex.placeCollisionBox(h,J,M,R,O,L,I,ve,N.predicate,me,He);if((!Ee||this.collisionIndex.placeCollisionBox(Ee,J,M,R,O,L,I,ke,N.predicate,me,He).placeable)&&ot.placeable){let vt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID].text&&(vt=this.prevPlacement.variableOffsets[oe.crossTileID].anchor),oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[oe.crossTileID]={textOffset:Be,width:p,height:m,anchor:De,textBoxScale:y,prevAnchor:vt},this.markUsedJustification(he,De,oe,ge),he.allowVerticalPlacement&&(this.markUsedOrientation(he,ge,oe),this.placedOrientations[oe.crossTileID]=ge),{shift:He,placedGlyphBoxes:ot}}}placeLayerBucketPart(i,h,p){const{bucket:m,layout:y,translationText:I,translationIcon:L,posMatrix:M,unwrappedTileID:R,textLabelPlaneMatrix:O,labelToScreenMatrix:N,textPixelRatio:J,holdingForFade:oe,collisionBoxArray:he,partiallyEvaluatedTextSize:ge,collisionGroup:ve}=i.parameters,ke=y.get("text-optional"),Ee=y.get("icon-optional"),me=a.ar(y,"text-overlap","text-allow-overlap"),De=me==="always",Be=a.ar(y,"icon-overlap","icon-allow-overlap"),He=Be==="always",ot=y.get("text-rotation-alignment")==="map",vt=y.get("text-pitch-alignment")==="map",It=y.get("icon-text-fit")!=="none",At=y.get("symbol-z-order")==="viewport-y",kt=De&&(He||!m.hasIconData()||Ee),xt=He&&(De||!m.hasTextData()||ke);!m.collisionArrays&&he&&m.deserializeCollisionBoxes(he);const Nt=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),ri=(St,Lt,ti)=>{var rn,fi;if(h[St.crossTileID])return;if(oe)return void(this.placements[St.crossTileID]=new mi(!1,!1,!1));let xi=!1,on=!1,nr=!0,co=null,sn={box:null,placeable:!1,offscreen:null},Sr={box:null,placeable:!1,offscreen:null},pr=null,rr=null,mr=null,So=0,Ks=0,Fl=0;Lt.textFeatureIndex?So=Lt.textFeatureIndex:St.useRuntimeCollisionCircles&&(So=St.featureIndex),Lt.verticalTextFeatureIndex&&(Ks=Lt.verticalTextFeatureIndex);const Js=Lt.textBox;if(Js){const eo=Jn=>{let or=a.ah.horizontal;if(m.allowVerticalPlacement&&!Jn&&this.prevPlacement){const $r=this.prevPlacement.placedOrientations[St.crossTileID];$r&&(this.placedOrientations[St.crossTileID]=$r,or=$r,this.markUsedOrientation(m,or,St))}return or},to=(Jn,or)=>{if(m.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&Lt.verticalTextBox){for(const $r of m.writingModes)if($r===a.ah.vertical?(sn=or(),Sr=sn):sn=Jn(),sn&&sn.placeable)break}else sn=Jn()},Go=St.textAnchorOffsetStartIndex,uo=St.textAnchorOffsetEndIndex;if(uo===Go){const Jn=(or,$r)=>{const Ti=this.collisionIndex.placeCollisionBox(or,me,J,M,R,vt,ot,I,ve.predicate,Nt);return Ti&&Ti.placeable&&(this.markUsedOrientation(m,$r,St),this.placedOrientations[St.crossTileID]=$r),Ti};to(()=>Jn(Js,a.ah.horizontal),()=>{const or=Lt.verticalTextBox;return m.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&or?Jn(or,a.ah.vertical):{box:null,offscreen:null}}),eo(sn&&sn.placeable)}else{let Jn=a.aq[(fi=(rn=this.prevPlacement)===null||rn===void 0?void 0:rn.variableOffsets[St.crossTileID])===null||fi===void 0?void 0:fi.anchor];const or=(Ti,hs,Ys)=>{const Qs=Ti.x2-Ti.x1,qh=Ti.y2-Ti.y1,_f=St.textBoxScale,Zh=It&&Be==="never"?hs:null;let Wo=null,Gh=me==="never"?1:2,Ol="never";Jn&&Gh++;for(let $a=0;$a<Gh;$a++){for(let Nl=Go;Nl<uo;Nl++){const jl=m.textAnchorOffsets.get(Nl);if(Jn&&jl.textAnchor!==Jn)continue;const ea=this.attemptAnchorPlacement(jl,Ti,Qs,qh,_f,ot,vt,J,M,R,ve,Ol,St,m,Ys,I,L,Zh,Nt);if(ea&&(Wo=ea.placedGlyphBoxes,Wo&&Wo.placeable))return xi=!0,co=ea.shift,Wo}Jn?Jn=null:Ol=me}return p&&!Wo&&(Wo={box:this.collisionIndex.placeCollisionBox(Js,"always",J,M,R,vt,ot,I,ve.predicate,Nt,new a.P(0,0)).box,offscreen:!1,placeable:!1}),Wo};to(()=>or(Js,Lt.iconBox,a.ah.horizontal),()=>{const Ti=Lt.verticalTextBox;return m.allowVerticalPlacement&&(!sn||!sn.placeable)&&St.numVerticalGlyphVertices>0&&Ti?or(Ti,Lt.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),sn&&(xi=sn.placeable,nr=sn.offscreen);const $r=eo(sn&&sn.placeable);if(!xi&&this.prevPlacement){const Ti=this.prevPlacement.variableOffsets[St.crossTileID];Ti&&(this.variableOffsets[St.crossTileID]=Ti,this.markUsedJustification(m,Ti.anchor,St,$r))}}}if(pr=sn,xi=pr&&pr.placeable,nr=pr&&pr.offscreen,St.useRuntimeCollisionCircles){const eo=m.text.placedSymbolArray.get(St.centerJustifiedTextSymbolIndex),to=a.ai(m.textSizeData,ge,eo),Go=y.get("text-padding");rr=this.collisionIndex.placeCollisionCircles(me,eo,m.lineVertexArray,m.glyphOffsetArray,to,M,R,O,N,p,vt,ve.predicate,St.collisionCircleDiameter,Go,I,Nt),rr.circles.length&&rr.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),xi=De||rr.circles.length>0&&!rr.collisionDetected,nr=nr&&rr.offscreen}if(Lt.iconFeatureIndex&&(Fl=Lt.iconFeatureIndex),Lt.iconBox){const eo=to=>this.collisionIndex.placeCollisionBox(to,Be,J,M,R,vt,ot,L,ve.predicate,Nt,It&&co?co:void 0);Sr&&Sr.placeable&&Lt.verticalIconBox?(mr=eo(Lt.verticalIconBox),on=mr.placeable):(mr=eo(Lt.iconBox),on=mr.placeable),nr=nr&&mr.offscreen}const Qr=ke||St.numHorizontalGlyphVertices===0&&St.numVerticalGlyphVertices===0,Bl=Ee||St.numIconVertices===0;Qr||Bl?Bl?Qr||(on=on&&xi):xi=on&&xi:on=xi=on&&xi;const pu=on&&mr.placeable;if(xi&&pr.placeable&&this.collisionIndex.insertCollisionBox(pr.box,me,y.get("text-ignore-placement"),m.bucketInstanceId,Sr&&Sr.placeable&&Ks?Ks:So,ve.ID),pu&&this.collisionIndex.insertCollisionBox(mr.box,Be,y.get("icon-ignore-placement"),m.bucketInstanceId,Fl,ve.ID),rr&&xi&&this.collisionIndex.insertCollisionCircles(rr.circles,me,y.get("text-ignore-placement"),m.bucketInstanceId,So,ve.ID),p&&this.storeCollisionData(m.bucketInstanceId,ti,Lt,pr,mr,rr),St.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[St.crossTileID]=new mi(xi||kt,on||xt,nr||m.justReloaded),h[St.crossTileID]=!0};if(At){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const St=m.getSortedSymbolIndexes(this.transform.angle);for(let Lt=St.length-1;Lt>=0;--Lt){const ti=St[Lt];ri(m.symbolInstances.get(ti),m.collisionArrays[ti],ti)}}else for(let St=i.symbolInstanceStart;St<i.symbolInstanceEnd;St++)ri(m.symbolInstances.get(St),m.collisionArrays[St],St);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const St=this.collisionCircleArrays[m.bucketInstanceId];a.as(St.invProjMatrix,M),St.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(i,h,p,m,y,I){if(p.textBox||p.iconBox){let L,M;this.collisionBoxArrays.has(i)?L=this.collisionBoxArrays.get(i):(L=new Map,this.collisionBoxArrays.set(i,L)),L.has(h)?M=L.get(h):(M={text:null,icon:null},L.set(h,M)),p.textBox&&(M.text=m.box),p.iconBox&&(M.icon=y.box)}if(I){let L=this.collisionCircleArrays[i];L===void 0&&(L=this.collisionCircleArrays[i]=new qi);for(let M=0;M<I.circles.length;M+=4)L.circles.push(I.circles[M+0]),L.circles.push(I.circles[M+1]),L.circles.push(I.circles[M+2]),L.circles.push(I.collisionDetected?1:0)}}markUsedJustification(i,h,p,m){let y;y=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.at(h)];const I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const L of I)L>=0&&(i.text.placedSymbolArray.get(L).crossTileID=y>=0&&L!==y?0:p.crossTileID)}markUsedOrientation(i,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,y=h===a.ah.vertical?h:0,I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const L of I)i.text.placedSymbolArray.get(L).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(i):1,y=h?h.opacities:{},I=h?h.variableOffsets:{},L=h?h.placedOrientations:{};for(const M in this.placements){const R=this.placements[M],O=y[M];O?(this.opacities[M]=new gn(O,m,R.text,R.icon),p=p||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[M]=new gn(null,m,R.text,R.icon,R.skipFade),p=p||R.text||R.icon)}for(const M in y){const R=y[M];if(!this.opacities[M]){const O=new gn(R,m,!1,!1);O.isHidden()||(this.opacities[M]=O,p=p||R.text.placed||R.icon.placed)}}for(const M in I)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=I[M]);for(const M in L)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=L[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const p={};for(const m of h){const y=m.getBucket(i);y&&m.latestFeatureIndex&&i.id===y.layerIds[0]&&this.updateBucketOpacities(y,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(i,h,p,m){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const y=i.layers[0],I=y.layout,L=new gn(null,0,!1,!1,!0),M=I.get("text-allow-overlap"),R=I.get("icon-allow-overlap"),O=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=I.get("text-rotation-alignment")==="map",J=I.get("text-pitch-alignment")==="map",oe=I.get("icon-text-fit")!=="none",he=new gn(null,0,M&&(R||!i.hasIconData()||I.get("icon-optional")),R&&(M||!i.hasTextData()||I.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ge=(ke,Ee,me)=>{for(let De=0;De<Ee/4;De++)ke.opacityVertexArray.emplaceBack(me);ke.hasVisibleVertices=ke.hasVisibleVertices||me!==Ls},ve=this.collisionBoxArrays.get(i.bucketInstanceId);for(let ke=0;ke<i.symbolInstances.length;ke++){const Ee=i.symbolInstances.get(ke),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:De,crossTileID:Be}=Ee;let He=this.opacities[Be];p[Be]?He=L:He||(He=he,this.opacities[Be]=He),p[Be]=!0;const ot=Ee.numIconVertices>0,vt=this.placedOrientations[Ee.crossTileID],It=vt===a.ah.vertical,At=vt===a.ah.horizontal||vt===a.ah.horizontalOnly;if(me>0||De>0){const xt=Nr(He.text);ge(i.text,me,It?Ls:xt),ge(i.text,De,At?Ls:xt);const Nt=He.text.isHidden();[Ee.rightJustifiedTextSymbolIndex,Ee.centerJustifiedTextSymbolIndex,Ee.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(i.text.placedSymbolArray.get(Lt).hidden=Nt||It?1:0)}),Ee.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(Ee.verticalPlacedTextSymbolIndex).hidden=Nt||At?1:0);const ri=this.variableOffsets[Ee.crossTileID];ri&&this.markUsedJustification(i,ri.anchor,Ee,vt);const St=this.placedOrientations[Ee.crossTileID];St&&(this.markUsedJustification(i,"left",Ee,St),this.markUsedOrientation(i,St,Ee))}if(ot){const xt=Nr(He.icon),Nt=!(oe&&Ee.verticalPlacedIconSymbolIndex&&It);Ee.placedIconSymbolIndex>=0&&(ge(i.icon,Ee.numIconVertices,Nt?xt:Ls),i.icon.placedSymbolArray.get(Ee.placedIconSymbolIndex).hidden=He.icon.isHidden()),Ee.verticalPlacedIconSymbolIndex>=0&&(ge(i.icon,Ee.numVerticalIconVertices,Nt?Ls:xt),i.icon.placedSymbolArray.get(Ee.verticalPlacedIconSymbolIndex).hidden=He.icon.isHidden())}const kt=ve&&ve.has(ke)?ve.get(ke):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const xt=i.collisionArrays[ke];if(xt){let Nt=new a.P(0,0);if(xt.textBox||xt.verticalTextBox){let ri=!0;if(O){const St=this.variableOffsets[Be];St?(Nt=Kn(St.anchor,St.width,St.height,St.textOffset,St.textBoxScale),N&&Nt._rotate(J?this.transform.angle:-this.transform.angle)):ri=!1}if(xt.textBox||xt.verticalTextBox){let St;xt.textBox&&(St=It),xt.verticalTextBox&&(St=At),Es(i.textCollisionBox.collisionVertexArray,He.text.placed,!ri||St,kt.text,Nt.x,Nt.y)}}if(xt.iconBox||xt.verticalIconBox){const ri=!!(!At&&xt.verticalIconBox);let St;xt.iconBox&&(St=ri),xt.verticalIconBox&&(St=!ri),Es(i.iconCollisionBox.collisionVertexArray,He.icon.placed,St,kt.icon,oe?Nt.x:0,oe?Nt.y:0)}}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ke.invProjMatrix,i.placementViewportMatrix=ke.viewportMatrix,i.collisionCircleArray=ke.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Es(b,i,h,p,m,y){p&&p.length!==0||(p=[0,0,0,0]);const I=p[0]-Qt,L=p[1]-Qt,M=p[2]-Qt,R=p[3]-Qt;b.emplaceBack(i?1:0,h?1:0,m||0,y||0,I,L),b.emplaceBack(i?1:0,h?1:0,m||0,y||0,M,L),b.emplaceBack(i?1:0,h?1:0,m||0,y||0,M,R),b.emplaceBack(i?1:0,h?1:0,m||0,y||0,I,R)}const Zi=Math.pow(2,25),Tc=Math.pow(2,24),Ic=Math.pow(2,17),Br=Math.pow(2,16),Or=Math.pow(2,9),Vd=Math.pow(2,8),Xr=Math.pow(2,1);function Nr(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const i=b.placed?1:0,h=Math.floor(127*b.opacity);return h*Zi+i*Tc+h*Ic+i*Br+h*Or+i*Vd+h*Xr+i}const Ls=0;function Qo(){return{isOccluded:(b,i,h)=>!1,getPitchedTextCorrection:(b,i,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(b,i,h,p){throw new Error("Not implemented.")},translatePosition:(b,i,h,p)=>function(m,y,I,L,M=!1){if(!I[0]&&!I[1])return[0,0];const R=M?L==="map"?m.angle:0:L==="viewport"?-m.angle:0;if(R){const O=Math.sin(R),N=Math.cos(R);I=[I[0]*N-I[1]*O,I[0]*O+I[1]*N]}return[M?I[0]:wi(y,I[0],m.zoom),M?I[1]:wi(y,I[1],m.zoom)]}(b,i,h,p),getCircleRadiusCorrection:b=>1}}class Rn{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,p,m,y){const I=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(I,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((L,M)=>L.sortKey-M.sortKey));this._currentPartIndex<I.length;)if(h.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,y())return!0;return!1}}class Sa{constructor(i,h,p,m,y,I,L,M){this.placement=new fr(i,Qo(),h,I,L,M),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(i,h,p){const m=S.now(),y=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const I=h[i[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=L)&&(!I.maxzoom||I.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Rn(I)),this._inProgressLayer.continuePlacement(p[I.source],this.placement,this._showCollisionBoxes,I,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ro=512/a.X/2;class Pn{constructor(i,h,p){this.tileID=i,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let y=0;y<h.length;y++){const I=h.get(y),L=I.key,M=m.get(L);M?M.push(I):m.set(L,[I])}for(const[y,I]of m){const L={positions:I.map(M=>({x:Math.floor(M.anchorX*ro),y:Math.floor(M.anchorY*ro)})),crossTileIDs:I.map(M=>M.crossTileID)};if(L.positions.length>128){const M=new a.av(L.positions.length,16,Uint16Array);for(const{x:R,y:O}of L.positions)M.add(R,O);M.finish(),delete L.positions,L.index=M}this._symbolsByKey[y]=L}}getScaledCoordinates(i,h){const{x:p,y:m,z:y}=this.tileID.canonical,{x:I,y:L,z:M}=h.canonical,R=ro/Math.pow(2,M-y),O=(L*a.X+i.anchorY)*R,N=m*a.X*ro;return{x:Math.floor((I*a.X+i.anchorX)*R-p*a.X*ro),y:Math.floor(O-N)}}findMatches(i,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let y=0;y<i.length;y++){const I=i.get(y);if(I.crossTileID)continue;const L=this._symbolsByKey[I.key];if(!L)continue;const M=this.getScaledCoordinates(I,h);if(L.index){const R=L.index.range(M.x-m,M.y-m,M.x+m,M.y+m).sort();for(const O of R){const N=L.crossTileIDs[O];if(!p[N]){p[N]=!0,I.crossTileID=N;break}}}else if(L.positions)for(let R=0;R<L.positions.length;R++){const O=L.positions[R],N=L.crossTileIDs[R];if(Math.abs(O.x-M.x)<=m&&Math.abs(O.y-M.y)<=m&&!p[N]){p[N]=!0,I.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class ol{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],y={};for(const I in m){const L=m[I];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+h),y[L.tileID.key]=L}this.indexes[p]=y}this.lng=i}addBucket(i,h,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<h.symbolInstances.length;y++)h.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const m=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const I=this.indexes[y];if(Number(y)>i.overscaledZ)for(const L in I){const M=I[L];M.tileID.isChildOf(i)&&M.findMatches(h.symbolInstances,i,m)}else{const L=I[i.scaledTo(Number(y)).key];L&&L.findMatches(h.symbolInstances,i,m)}}for(let y=0;y<h.symbolInstances.length;y++){const I=h.symbolInstances.get(y);I.crossTileID||(I.crossTileID=p.generate(),m[I.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Pn(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[i][m]}removeStaleBuckets(i){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const y in m)i[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[y]),delete m[y],h=!0)}return h}}class Cc{constructor(){this.layerIndexes={},this.crossTileIDs=new ol,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,p){let m=this.layerIndexes[i.id];m===void 0&&(m=this.layerIndexes[i.id]=new oo);let y=!1;const I={};m.handleWrapJump(p);for(const L of h){const M=L.getBucket(i);M&&i.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(L.tileID,M,this.crossTileIDs)&&(y=!0),I[M.bucketInstanceId]=!0)}return m.removeStaleBuckets(I)&&(y=!0),y}pruneUnusedLayers(i){const h={};i.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const so=(b,i)=>a.t(b,i&&i.filter(h=>h.identifier!=="source.canvas")),qd=a.aw();class sl extends a.E{constructor(i,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=i,this.dispatcher=new Fi(ki(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new it(i._requestManager,h.localIdeographFontFamily),this.lineAtlas=new at(256,512),this.crossTileSymbolIndex=new Cc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),qn().on(ct,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const I in this._layers){const L=this._layers[I];L.source===y.id&&this._validateLayer(L)}})}loadURL(i,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;a.h(m,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,h,p)}).catch(I=>{this._loadStyleRequest=null,I&&!y.signal.aborted&&this.fire(new a.j(I))})}loadJSON(i,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(i,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(qd,{validate:!1})}_load(i,h,p){var m;const y=h.transformStyle?h.transformStyle(p,i):i;if(!h.validate||!so(this,a.u(y))){this._loaded=!0,this.stylesheet=y;for(const I in y.sources)this.addSource(I,y.sources[I],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new jt(this.stylesheet.light),this.sky=new et(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const i=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of i){const p=a.aA(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(i,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,I,L,M){return a._(this,void 0,void 0,function*(){const R=ue(y),O=L>1?"@2x":"",N={},J={};for(const{id:oe,url:he}of R){const ge=I.transformRequest(fe(he,O,".json"),"SpriteJSON");N[oe]=a.h(ge,M);const ve=I.transformRequest(fe(he,O,".png"),"SpriteImage");J[oe]=X.getImage(ve,M)}return yield Promise.all([...Object.values(N),...Object.values(J)]),function(oe,he){return a._(this,void 0,void 0,function*(){const ge={};for(const ve in oe){ge[ve]={};const ke=S.getImageCanvasContext((yield he[ve]).data),Ee=(yield oe[ve]).data;for(const me in Ee){const{width:De,height:Be,x:He,y:ot,sdf:vt,pixelRatio:It,stretchX:At,stretchY:kt,content:xt,textFitWidth:Nt,textFitHeight:ri}=Ee[me];ge[ve][me]={data:null,pixelRatio:It,sdf:vt,stretchX:At,stretchY:kt,content:xt,textFitWidth:Nt,textFitHeight:ri,spriteData:{width:De,height:Be,x:He,y:ot,context:ke}}}}return ge})}(N,J)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const I in y){this._spritesImagesIds[I]=[];const L=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(M=>!(M in y)):[];for(const M of L)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in y[I]){const R=I==="default"?M:`${I}:${M}`;this._spritesImagesIds[I].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,y[I][M],!1):this.imageManager.addImage(R,y[I][M]),h&&(this._changedImages[R]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(i){const h=this.sourceCaches[i.source];if(!h)return;const p=i.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,h=!1){const p=this._serializedAllLayers();if(!i||i.length===0)return Object.values(h?a.aB(p):p);const m=[];for(const y of i)if(p[y]){const I=h?a.aB(p[y]):p[y];m.push(I)}return m}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(i[p]=m.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const I in this._updatedSources){const L=this._updatedSources[I];if(L==="reload")this._reloadSource(I);else{if(L!=="clear")throw new Error(`Invalid action ${L}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];p[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(i,this._availableImages),!y.isHidden(i.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in p){const y=this.sourceCaches[m];!!p[m]!=!!y.used&&y.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(i),this.sky.recalculate(i),this.z=i.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,h={}){var p;this._checkLoaded();const m=this.serialize();if(i=h.transformStyle?h.transformStyle(m,i):i,((p=h.validate)===null||p===void 0||p)&&so(this,a.u(i)))return!1;(i=a.aB(i)).layers=a.az(i.layers);const y=a.aC(m,i),I=this._getOperationsToPerform(y);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const L of I.operations)L();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const h=[],p=[];for(const m of i)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":h.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(i,h){if(this.getImage(i))return this.fire(new a.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,h),this._afterImageUpdated(i)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new a.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,h,p={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.u.source,`sources.${i}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[i]=new Jt(i,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:i})),m.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===i)return this.fire(new a.j(new Error(`Source "${i}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,h){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const p=this.sourceCaches[i].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,h,p={}){this._checkLoaded();const m=i.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let y;if(i.type==="custom"){if(so(this,a.aD(i)))return;y=a.aA(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(m,i.source),i=a.aB(i),i=a.e(i,{source:m})),this._validate(a.u.layer,`layers.${m}`,i,{arrayIndex:-1},p))return;y=a.aA(i),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const I=h?this._order.indexOf(h):this._order.length;if(h&&I===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(I,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const L=this._removedLayers[m];delete this._removedLayers[m],L.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new a.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const p=this._order.indexOf(i);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${i}" before non-existing layer "${h}".`))):(this._order.splice(m,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${i}".`)));h.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,h,p){this._checkLoaded();const m=this.getLayer(i);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,h,p={}){this._checkLoaded();const m=this.getLayer(i);if(m){if(!a.aE(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.u.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aB(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return a.aB(this.getLayer(i).filter)}setLayoutProperty(i,h,p,m={}){this._checkLoaded();const y=this.getLayer(i);y?a.aE(y.getLayoutProperty(h),p)||(y.setLayoutProperty(h,p,m),this._updateLayer(y)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,h){const p=this.getLayer(i);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,h,p,m={}){this._checkLoaded();const y=this.getLayer(i);y?a.aE(y.getPaintProperty(h),p)||(y.setPaintProperty(h,p,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,h){return this.getLayer(i).getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const p=i.source,m=i.sourceLayer,y=this.sourceCaches[p];if(y===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const I=y.getSource().type;I==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||m?(i.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,i.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,h){this._checkLoaded();const p=i.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const y=m.getSource().type,I=y==="vector"?i.sourceLayer:void 0;y!=="vector"||I?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(I,i.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const h=i.source,p=i.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(i.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,i.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=a.aF(this.sourceCaches,y=>y.serialize()),h=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:i,layers:h,terrain:p},y=>y!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const h=I=>this._layers[I].type==="fill-extrusion",p={},m=[];for(let I=this._order.length-1;I>=0;I--){const L=this._order[I];if(h(L)){p[L]=I;for(const M of i){const R=M[L];if(R)for(const O of R)m.push(O)}}}m.sort((I,L)=>L.intersectionZ-I.intersectionZ);const y=[];for(let I=this._order.length-1;I>=0;I--){const L=this._order[I];if(h(L))for(let M=m.length-1;M>=0;M--){const R=m[M].feature;if(p[R.layer.id]<I)break;y.push(R),m.pop()}else for(const M of i){const R=M[L];if(R)for(const O of R)y.push(O.feature)}}return y}queryRenderedFeatures(i,h,p){h&&h.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const L of h.layers){const M=this._layers[L];if(!M)return this.fire(new a.j(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];m[M.source]=!0}}const y=[];h.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const L in this.sourceCaches)h.layers&&!m[L]||y.push(lt(this.sourceCaches[L],this._layers,I,i,h,p));return this.placement&&y.push(function(L,M,R,O,N,J,oe){const he={},ge=J.queryRenderedSymbols(O),ve=[];for(const ke of Object.keys(ge).map(Number))ve.push(oe[ke]);ve.sort(qe);for(const ke of ve){const Ee=ke.featureIndex.lookupSymbolFeatures(ge[ke.bucketInstanceId],M,ke.bucketIndex,ke.sourceLayerIndex,N.filter,N.layers,N.availableImages,L);for(const me in Ee){const De=he[me]=he[me]||[],Be=Ee[me];Be.sort((He,ot)=>{const vt=ke.featureSortOrder;if(vt){const It=vt.indexOf(He.featureIndex);return vt.indexOf(ot.featureIndex)-It}return ot.featureIndex-He.featureIndex});for(const He of Be)De.push(He)}}for(const ke in he)he[ke].forEach(Ee=>{const me=Ee.feature,De=R[L[ke].source].getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=De});return he}(this._layers,I,this.sourceCaches,i,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(i,h){h&&h.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[i];return p?function(m,y){const I=m.getRenderableIds().map(R=>m.getTileByID(R)),L=[],M={};for(let R=0;R<I.length;R++){const O=I[R],N=O.tileID.canonical.key;M[N]||(M[N]=!0,O.querySourceFeatures(L,y))}return L}(p,h):[]}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const I in i)if(!a.aE(i[I],p[I])){m=!0;break}if(!m)return;const y={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(y)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,h={}){const p=this.getSky();let m=!1;if(!i&&!p)return;if(i&&!p)m=!0;else if(!i&&p)m=!0;else for(const I in i)if(!a.aE(i[I],p[I])){m=!0;break}if(!m)return;const y={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,h),this.sky.updateTransitions(y)}_validate(i,h,p,m,y={}){return(!y||y.validate!==!1)&&so(this,i.call(a.u,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),qn().off(ct,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const h in this.sourceCaches)this.sourceCaches[h].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,h,p,m,y=!1){let I=!1,L=!1;const M={};for(const R of this._order){const O=this._layers[R];if(O.type!=="symbol")continue;if(!M[O.source]){const J=this.sourceCaches[O.source];M[O.source]=J.getRenderableIds(!0).map(oe=>J.getTileByID(oe)).sort((oe,he)=>he.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(he.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(O,M[O.source],i.center.lng);I=I||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),i.zoom))&&(this.pauseablePlacement=new Sa(i,this.map.terrain,this._order,y,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),L=!0),I&&this.pauseablePlacement.placement.setStale()),L||I)for(const R of this._order){const O=this._layers[R];O.type==="symbol"&&this.placement.updateLayerOpacities(O,M[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(i,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,h={}){this._checkLoaded(),i&&this._validate(a.u.glyphs,"glyphs",i,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,h,p={},m){this._checkLoaded();const y=[{id:i,url:h}],I=[...ue(this.stylesheet.sprite),...y];this._validate(a.u.sprite,"sprite",I,null,p)||(this.stylesheet.sprite=I,this._loadSprite(y,!0,m))}removeSprite(i){this._checkLoaded();const h=ue(this.stylesheet.sprite);if(h.find(p=>p.id===i)){if(this._spritesImagesIds[i])for(const p of this._spritesImagesIds[i])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===i),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return ue(this.stylesheet.sprite)}setSprite(i,h={},p){this._checkLoaded(),i&&this._validate(a.u.sprite,"sprite",i,null,h)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,p):(this._unloadSprite(),p&&p(null)))}}var es=a.Y([{name:"a_pos",type:"Int16",components:2}]);const qo={prelude:Oi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Oi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Oi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Oi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Oi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Oi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Oi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Oi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Oi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Oi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Oi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Oi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Oi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Oi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Oi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Oi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Oi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Oi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Oi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Oi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Oi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Oi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Oi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Oi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Oi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Oi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Oi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Oi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Oi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Oi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Oi(b,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=i.match(/attribute ([\w]+) ([\w]+)/g),m=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=y?y.concat(m):m,L={};return{fragmentSource:b=b.replace(h,(M,R,O,N,J)=>(L[J]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${J}
varying ${O} ${N} ${J};
#else
uniform ${O} ${N} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${O} ${N} ${J} = u_${J};
#endif
`)),vertexSource:i=i.replace(h,(M,R,O,N,J)=>{const oe=N==="float"?"vec2":"vec4",he=J.match(/color/)?"color":oe;return L[J]?R==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${O} ${oe} a_${J};
varying ${O} ${N} ${J};
#else
uniform ${O} ${N} u_${J};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${O} ${N} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${he}(a_${J}, u_${J}_t);
#else
    ${O} ${N} ${J} = u_${J};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${O} ${oe} a_${J};
#else
uniform ${O} ${N} u_${J};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${O} ${N} ${J} = a_${J};
#else
    ${O} ${N} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${O} ${N} ${J} = unpack_mix_${he}(a_${J}, u_${J}_t);
#else
    ${O} ${N} ${J} = u_${J};
#endif
`}),staticAttributes:p,staticUniforms:I}}class Ec{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,p,m,y,I,L,M,R){this.context=i;let O=this.boundPaintVertexBuffers.length!==m.length;for(let N=0;!O&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(O=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||O||this.boundIndexBuffer!==y||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==L||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==R?this.freshBind(h,p,m,y,I,L,M,R):(i.bindVertexArray.set(this.vao),L&&L.bind(),y&&y.dynamicDraw&&y.bind(),M&&M.bind(),R&&R.bind())}freshBind(i,h,p,m,y,I,L,M){const R=i.numAttributes,O=this.context,N=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=L,this.boundDynamicVertexBuffer3=M,h.enableAttributes(N,i);for(const J of p)J.enableAttributes(N,i);I&&I.enableAttributes(N,i),L&&L.enableAttributes(N,i),M&&M.enableAttributes(N,i),h.bind(),h.setVertexAttribPointers(N,i,y);for(const J of p)J.bind(),J.setVertexAttribPointers(N,i,y);I&&(I.bind(),I.setVertexAttribPointers(N,i,y)),m&&m.bind(),L&&(L.bind(),L.setVertexAttribPointers(N,i,y)),M&&(M.bind(),M.setVertexAttribPointers(N,i,y)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Lc=(b,i,h,p,m)=>({u_matrix:b,u_texture:0,u_ele_delta:i,u_fog_matrix:h,u_fog_color:p?p.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function Ms(b){const i=[];for(let h=0;h<b.length;h++){if(b[h]===null)continue;const p=b[h].split(" ");i.push(p.pop())}return i}class Mc{constructor(i,h,p,m,y,I){const L=i.gl;this.program=L.createProgram();const M=Ms(h.staticAttributes),R=p?p.getBinderAttributes():[],O=M.concat(R),N=qo.prelude.staticUniforms?Ms(qo.prelude.staticUniforms):[],J=h.staticUniforms?Ms(h.staticUniforms):[],oe=p?p.getBinderUniforms():[],he=N.concat(J).concat(oe),ge=[];for(const He of he)ge.indexOf(He)<0&&ge.push(He);const ve=p?p.defines():[];y&&ve.push("#define OVERDRAW_INSPECTOR;"),I&&ve.push("#define TERRAIN3D;");const ke=ve.concat(qo.prelude.fragmentSource,h.fragmentSource).join(`
`),Ee=ve.concat(qo.prelude.vertexSource,h.vertexSource).join(`
`),me=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(me,ke),L.compileShader(me),!L.getShaderParameter(me,L.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${L.getShaderInfoLog(me)}`);L.attachShader(this.program,me);const De=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(De,Ee),L.compileShader(De),!L.getShaderParameter(De,L.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${L.getShaderInfoLog(De)}`);L.attachShader(this.program,De),this.attributes={};const Be={};this.numAttributes=O.length;for(let He=0;He<this.numAttributes;He++)O[He]&&(L.bindAttribLocation(this.program,He,O[He]),this.attributes[O[He]]=He);if(L.linkProgram(this.program),!L.getProgramParameter(this.program,L.LINK_STATUS))throw new Error(`Program failed to link: ${L.getProgramInfoLog(this.program)}`);L.deleteShader(De),L.deleteShader(me);for(let He=0;He<ge.length;He++){const ot=ge[He];if(ot&&!Be[ot]){const vt=L.getUniformLocation(this.program,ot);vt&&(Be[ot]=vt)}}this.fixedUniforms=m(i,Be),this.terrainUniforms=((He,ot)=>({u_depth:new a.aH(He,ot.u_depth),u_terrain:new a.aH(He,ot.u_terrain),u_terrain_dim:new a.aI(He,ot.u_terrain_dim),u_terrain_matrix:new a.aJ(He,ot.u_terrain_matrix),u_terrain_unpack:new a.aK(He,ot.u_terrain_unpack),u_terrain_exaggeration:new a.aI(He,ot.u_terrain_exaggeration)}))(i,Be),this.binderUniforms=p?p.getUniforms(i,Be):[]}draw(i,h,p,m,y,I,L,M,R,O,N,J,oe,he,ge,ve,ke,Ee){const me=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(m),i.setColorMode(y),i.setCullFace(I),M){i.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,M.depthTexture),i.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,M.texture);for(const Be in this.terrainUniforms)this.terrainUniforms[Be].set(M[Be])}for(const Be in this.fixedUniforms)this.fixedUniforms[Be].set(L[Be]);ge&&ge.setUniforms(i,this.binderUniforms,oe,{zoom:he});let De=0;switch(h){case me.LINES:De=2;break;case me.TRIANGLES:De=3;break;case me.LINE_STRIP:De=1}for(const Be of J.get()){const He=Be.vaos||(Be.vaos={});(He[R]||(He[R]=new Ec)).bind(i,this,O,ge?ge.getPaintVertexBuffers():[],N,Be.vertexOffset,ve,ke,Ee),me.drawElements(h,Be.primitiveLength*De,me.UNSIGNED_SHORT,Be.primitiveOffset*De*2)}}}function al(b,i,h){const p=1/wi(h,1,i.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),y=h.tileSize*Math.pow(2,i.transform.tileZoom)/m,I=y*(h.tileID.canonical.x+h.tileID.wrap*m),L=y*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[I>>16,L>>16],u_pixel_coord_lower:[65535&I,65535&L]}}const Ta=(b,i,h,p)=>{const m=i.style.light,y=m.properties.get("position"),I=[y.x,y.y,y.z],L=function(){var R=new a.A(9);return a.A!=Float32Array&&(R[1]=0,R[2]=0,R[3]=0,R[5]=0,R[6]=0,R[7]=0),R[0]=1,R[4]=1,R[8]=1,R}();m.properties.get("anchor")==="viewport"&&function(R,O){var N=Math.sin(O),J=Math.cos(O);R[0]=J,R[1]=N,R[2]=0,R[3]=-N,R[4]=J,R[5]=0,R[6]=0,R[7]=0,R[8]=1}(L,-i.transform.angle),function(R,O,N){var J=O[0],oe=O[1],he=O[2];R[0]=J*N[0]+oe*N[3]+he*N[6],R[1]=J*N[1]+oe*N[4]+he*N[7],R[2]=J*N[2]+oe*N[5]+he*N[8]}(I,I,L);const M=m.properties.get("color");return{u_matrix:b,u_lightpos:I,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:p}},ll=(b,i,h,p,m,y,I)=>a.e(Ta(b,i,h,p),al(y,i,I),{u_height_factor:-Math.pow(2,m.overscaledZ)/I.tileSize/8}),As=b=>({u_matrix:b}),hh=(b,i,h,p)=>a.e(As(b),al(h,i,p)),Zd=(b,i)=>({u_matrix:b,u_world:i}),dh=(b,i,h,p,m)=>a.e(hh(b,i,h,p),{u_world:m}),Gd=(b,i,h,p)=>{const m=b.transform;let y,I;if(p.paint.get("circle-pitch-alignment")==="map"){const L=wi(h,1,m.zoom);y=!0,I=[L,L]}else y=!1,I=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(i.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:I}},ts=(b,i,h)=>({u_matrix:b,u_inv_matrix:i,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),Ia=(b,i,h=1)=>({u_matrix:b,u_color:i,u_overlay:0,u_overlay_scale:h}),xr=b=>({u_matrix:b}),kr=(b,i,h,p)=>({u_matrix:b,u_extrude_scale:wi(i,1,h),u_intensity:p}),cl=(b,i,h,p)=>{const m=a.H();a.aP(m,0,b.width,b.height,0,0,1);const y=b.context.gl;return{u_matrix:m,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:h,u_color_ramp:p,u_opacity:i.paint.get("heatmap-opacity")}};function ul(b,i){const h=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new a.Z(0,p/h).toLngLat().lat,new a.Z(0,(p+1)/h).toLngLat().lat]}const hl=(b,i,h,p)=>{const m=b.transform;return{u_matrix:mh(b,i,h,p),u_ratio:1/wi(i,1,m.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},fh=(b,i,h,p,m)=>a.e(hl(b,i,h,m),{u_image:0,u_image_height:p}),Ps=(b,i,h,p,m)=>{const y=b.transform,I=ph(i,y);return{u_matrix:mh(b,i,h,m),u_texsize:i.imageAtlasTexture.size,u_ratio:1/wi(i,1,y.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[I,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Wd=(b,i,h,p,m,y)=>{const I=b.lineAtlas,L=ph(i,b.transform),M=h.layout.get("line-cap")==="round",R=I.getDash(p.from,M),O=I.getDash(p.to,M),N=R.width*m.fromScale,J=O.width*m.toScale;return a.e(hl(b,i,h,y),{u_patternscale_a:[L/N,-R.height/2],u_patternscale_b:[L/J,-O.height/2],u_sdfgamma:I.width/(256*Math.min(N,J)*b.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:O.y,u_mix:m.t})};function ph(b,i){return 1/wi(b,1,i.tileZoom)}function mh(b,i,h,p){return b.translatePosMatrix(p?p.posMatrix:i.tileID.posMatrix,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Hd=(b,i,h,p,m)=>{return{u_matrix:b,u_tl_parent:i,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(I=m.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(y=m.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Xd(m.paint.get("raster-hue-rotate"))};var y,I};function Xd(b){b*=Math.PI/180;const i=Math.sin(b),h=Math.cos(b);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const _h=(b,i,h,p,m,y,I,L,M,R,O,N,J,oe)=>{const he=I.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:he.cameraToCenterDistance,u_pitch:he.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:he.width/he.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:M,u_coord_matrix:R,u_is_text:+N,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:y,u_texsize:J,u_texture:0,u_translation:O,u_pitched_scale:oe}},Ca=(b,i,h,p,m,y,I,L,M,R,O,N,J,oe,he)=>{const ge=I.transform;return a.e(_h(b,i,h,p,m,y,I,L,M,R,O,N,J,he),{u_gamma_scale:p?Math.cos(ge._pitch)*ge.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:+oe})},Ac=(b,i,h,p,m,y,I,L,M,R,O,N,J,oe)=>a.e(Ca(b,i,h,p,m,y,I,L,M,R,O,!0,N,!0,oe),{u_texsize_icon:J,u_texture_icon:1}),dl=(b,i,h)=>({u_matrix:b,u_opacity:i,u_color:h}),Pc=(b,i,h,p,m,y)=>a.e(function(I,L,M,R){const O=M.imageManager.getPattern(I.from.toString()),N=M.imageManager.getPattern(I.to.toString()),{width:J,height:oe}=M.imageManager.getPixelSize(),he=Math.pow(2,R.tileID.overscaledZ),ge=R.tileSize*Math.pow(2,M.transform.tileZoom)/he,ve=ge*(R.tileID.canonical.x+R.tileID.wrap*he),ke=ge*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[J,oe],u_mix:L.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/wi(R,1,M.transform.tileZoom),u_pixel_coord_upper:[ve>>16,ke>>16],u_pixel_coord_lower:[65535&ve,65535&ke]}}(p,y,h,m),{u_matrix:b,u_opacity:i}),zc={fillExtrusion:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_lightpos:new a.aN(b,i.u_lightpos),u_lightintensity:new a.aI(b,i.u_lightintensity),u_lightcolor:new a.aN(b,i.u_lightcolor),u_vertical_gradient:new a.aI(b,i.u_vertical_gradient),u_opacity:new a.aI(b,i.u_opacity)}),fillExtrusionPattern:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_lightpos:new a.aN(b,i.u_lightpos),u_lightintensity:new a.aI(b,i.u_lightintensity),u_lightcolor:new a.aN(b,i.u_lightcolor),u_vertical_gradient:new a.aI(b,i.u_vertical_gradient),u_height_factor:new a.aI(b,i.u_height_factor),u_image:new a.aH(b,i.u_image),u_texsize:new a.aO(b,i.u_texsize),u_pixel_coord_upper:new a.aO(b,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,i.u_pixel_coord_lower),u_scale:new a.aN(b,i.u_scale),u_fade:new a.aI(b,i.u_fade),u_opacity:new a.aI(b,i.u_opacity)}),fill:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix)}),fillPattern:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_image:new a.aH(b,i.u_image),u_texsize:new a.aO(b,i.u_texsize),u_pixel_coord_upper:new a.aO(b,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,i.u_pixel_coord_lower),u_scale:new a.aN(b,i.u_scale),u_fade:new a.aI(b,i.u_fade)}),fillOutline:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_world:new a.aO(b,i.u_world)}),fillOutlinePattern:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_world:new a.aO(b,i.u_world),u_image:new a.aH(b,i.u_image),u_texsize:new a.aO(b,i.u_texsize),u_pixel_coord_upper:new a.aO(b,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,i.u_pixel_coord_lower),u_scale:new a.aN(b,i.u_scale),u_fade:new a.aI(b,i.u_fade)}),circle:(b,i)=>({u_camera_to_center_distance:new a.aI(b,i.u_camera_to_center_distance),u_scale_with_map:new a.aH(b,i.u_scale_with_map),u_pitch_with_map:new a.aH(b,i.u_pitch_with_map),u_extrude_scale:new a.aO(b,i.u_extrude_scale),u_device_pixel_ratio:new a.aI(b,i.u_device_pixel_ratio),u_matrix:new a.aJ(b,i.u_matrix)}),collisionBox:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_pixel_extrude_scale:new a.aO(b,i.u_pixel_extrude_scale)}),collisionCircle:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_inv_matrix:new a.aJ(b,i.u_inv_matrix),u_camera_to_center_distance:new a.aI(b,i.u_camera_to_center_distance),u_viewport_size:new a.aO(b,i.u_viewport_size)}),debug:(b,i)=>({u_color:new a.aL(b,i.u_color),u_matrix:new a.aJ(b,i.u_matrix),u_overlay:new a.aH(b,i.u_overlay),u_overlay_scale:new a.aI(b,i.u_overlay_scale)}),clippingMask:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix)}),heatmap:(b,i)=>({u_extrude_scale:new a.aI(b,i.u_extrude_scale),u_intensity:new a.aI(b,i.u_intensity),u_matrix:new a.aJ(b,i.u_matrix)}),heatmapTexture:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_world:new a.aO(b,i.u_world),u_image:new a.aH(b,i.u_image),u_color_ramp:new a.aH(b,i.u_color_ramp),u_opacity:new a.aI(b,i.u_opacity)}),hillshade:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_image:new a.aH(b,i.u_image),u_latrange:new a.aO(b,i.u_latrange),u_light:new a.aO(b,i.u_light),u_shadow:new a.aL(b,i.u_shadow),u_highlight:new a.aL(b,i.u_highlight),u_accent:new a.aL(b,i.u_accent)}),hillshadePrepare:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_image:new a.aH(b,i.u_image),u_dimension:new a.aO(b,i.u_dimension),u_zoom:new a.aI(b,i.u_zoom),u_unpack:new a.aK(b,i.u_unpack)}),line:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_ratio:new a.aI(b,i.u_ratio),u_device_pixel_ratio:new a.aI(b,i.u_device_pixel_ratio),u_units_to_pixels:new a.aO(b,i.u_units_to_pixels)}),lineGradient:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_ratio:new a.aI(b,i.u_ratio),u_device_pixel_ratio:new a.aI(b,i.u_device_pixel_ratio),u_units_to_pixels:new a.aO(b,i.u_units_to_pixels),u_image:new a.aH(b,i.u_image),u_image_height:new a.aI(b,i.u_image_height)}),linePattern:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_texsize:new a.aO(b,i.u_texsize),u_ratio:new a.aI(b,i.u_ratio),u_device_pixel_ratio:new a.aI(b,i.u_device_pixel_ratio),u_image:new a.aH(b,i.u_image),u_units_to_pixels:new a.aO(b,i.u_units_to_pixels),u_scale:new a.aN(b,i.u_scale),u_fade:new a.aI(b,i.u_fade)}),lineSDF:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_ratio:new a.aI(b,i.u_ratio),u_device_pixel_ratio:new a.aI(b,i.u_device_pixel_ratio),u_units_to_pixels:new a.aO(b,i.u_units_to_pixels),u_patternscale_a:new a.aO(b,i.u_patternscale_a),u_patternscale_b:new a.aO(b,i.u_patternscale_b),u_sdfgamma:new a.aI(b,i.u_sdfgamma),u_image:new a.aH(b,i.u_image),u_tex_y_a:new a.aI(b,i.u_tex_y_a),u_tex_y_b:new a.aI(b,i.u_tex_y_b),u_mix:new a.aI(b,i.u_mix)}),raster:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_tl_parent:new a.aO(b,i.u_tl_parent),u_scale_parent:new a.aI(b,i.u_scale_parent),u_buffer_scale:new a.aI(b,i.u_buffer_scale),u_fade_t:new a.aI(b,i.u_fade_t),u_opacity:new a.aI(b,i.u_opacity),u_image0:new a.aH(b,i.u_image0),u_image1:new a.aH(b,i.u_image1),u_brightness_low:new a.aI(b,i.u_brightness_low),u_brightness_high:new a.aI(b,i.u_brightness_high),u_saturation_factor:new a.aI(b,i.u_saturation_factor),u_contrast_factor:new a.aI(b,i.u_contrast_factor),u_spin_weights:new a.aN(b,i.u_spin_weights)}),symbolIcon:(b,i)=>({u_is_size_zoom_constant:new a.aH(b,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(b,i.u_is_size_feature_constant),u_size_t:new a.aI(b,i.u_size_t),u_size:new a.aI(b,i.u_size),u_camera_to_center_distance:new a.aI(b,i.u_camera_to_center_distance),u_pitch:new a.aI(b,i.u_pitch),u_rotate_symbol:new a.aH(b,i.u_rotate_symbol),u_aspect_ratio:new a.aI(b,i.u_aspect_ratio),u_fade_change:new a.aI(b,i.u_fade_change),u_matrix:new a.aJ(b,i.u_matrix),u_label_plane_matrix:new a.aJ(b,i.u_label_plane_matrix),u_coord_matrix:new a.aJ(b,i.u_coord_matrix),u_is_text:new a.aH(b,i.u_is_text),u_pitch_with_map:new a.aH(b,i.u_pitch_with_map),u_is_along_line:new a.aH(b,i.u_is_along_line),u_is_variable_anchor:new a.aH(b,i.u_is_variable_anchor),u_texsize:new a.aO(b,i.u_texsize),u_texture:new a.aH(b,i.u_texture),u_translation:new a.aO(b,i.u_translation),u_pitched_scale:new a.aI(b,i.u_pitched_scale)}),symbolSDF:(b,i)=>({u_is_size_zoom_constant:new a.aH(b,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(b,i.u_is_size_feature_constant),u_size_t:new a.aI(b,i.u_size_t),u_size:new a.aI(b,i.u_size),u_camera_to_center_distance:new a.aI(b,i.u_camera_to_center_distance),u_pitch:new a.aI(b,i.u_pitch),u_rotate_symbol:new a.aH(b,i.u_rotate_symbol),u_aspect_ratio:new a.aI(b,i.u_aspect_ratio),u_fade_change:new a.aI(b,i.u_fade_change),u_matrix:new a.aJ(b,i.u_matrix),u_label_plane_matrix:new a.aJ(b,i.u_label_plane_matrix),u_coord_matrix:new a.aJ(b,i.u_coord_matrix),u_is_text:new a.aH(b,i.u_is_text),u_pitch_with_map:new a.aH(b,i.u_pitch_with_map),u_is_along_line:new a.aH(b,i.u_is_along_line),u_is_variable_anchor:new a.aH(b,i.u_is_variable_anchor),u_texsize:new a.aO(b,i.u_texsize),u_texture:new a.aH(b,i.u_texture),u_gamma_scale:new a.aI(b,i.u_gamma_scale),u_device_pixel_ratio:new a.aI(b,i.u_device_pixel_ratio),u_is_halo:new a.aH(b,i.u_is_halo),u_translation:new a.aO(b,i.u_translation),u_pitched_scale:new a.aI(b,i.u_pitched_scale)}),symbolTextAndIcon:(b,i)=>({u_is_size_zoom_constant:new a.aH(b,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(b,i.u_is_size_feature_constant),u_size_t:new a.aI(b,i.u_size_t),u_size:new a.aI(b,i.u_size),u_camera_to_center_distance:new a.aI(b,i.u_camera_to_center_distance),u_pitch:new a.aI(b,i.u_pitch),u_rotate_symbol:new a.aH(b,i.u_rotate_symbol),u_aspect_ratio:new a.aI(b,i.u_aspect_ratio),u_fade_change:new a.aI(b,i.u_fade_change),u_matrix:new a.aJ(b,i.u_matrix),u_label_plane_matrix:new a.aJ(b,i.u_label_plane_matrix),u_coord_matrix:new a.aJ(b,i.u_coord_matrix),u_is_text:new a.aH(b,i.u_is_text),u_pitch_with_map:new a.aH(b,i.u_pitch_with_map),u_is_along_line:new a.aH(b,i.u_is_along_line),u_is_variable_anchor:new a.aH(b,i.u_is_variable_anchor),u_texsize:new a.aO(b,i.u_texsize),u_texsize_icon:new a.aO(b,i.u_texsize_icon),u_texture:new a.aH(b,i.u_texture),u_texture_icon:new a.aH(b,i.u_texture_icon),u_gamma_scale:new a.aI(b,i.u_gamma_scale),u_device_pixel_ratio:new a.aI(b,i.u_device_pixel_ratio),u_is_halo:new a.aH(b,i.u_is_halo),u_translation:new a.aO(b,i.u_translation),u_pitched_scale:new a.aI(b,i.u_pitched_scale)}),background:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_opacity:new a.aI(b,i.u_opacity),u_color:new a.aL(b,i.u_color)}),backgroundPattern:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_opacity:new a.aI(b,i.u_opacity),u_image:new a.aH(b,i.u_image),u_pattern_tl_a:new a.aO(b,i.u_pattern_tl_a),u_pattern_br_a:new a.aO(b,i.u_pattern_br_a),u_pattern_tl_b:new a.aO(b,i.u_pattern_tl_b),u_pattern_br_b:new a.aO(b,i.u_pattern_br_b),u_texsize:new a.aO(b,i.u_texsize),u_mix:new a.aI(b,i.u_mix),u_pattern_size_a:new a.aO(b,i.u_pattern_size_a),u_pattern_size_b:new a.aO(b,i.u_pattern_size_b),u_scale_a:new a.aI(b,i.u_scale_a),u_scale_b:new a.aI(b,i.u_scale_b),u_pixel_coord_upper:new a.aO(b,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,i.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(b,i.u_tile_units_to_pixels)}),terrain:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_texture:new a.aH(b,i.u_texture),u_ele_delta:new a.aI(b,i.u_ele_delta),u_fog_matrix:new a.aJ(b,i.u_fog_matrix),u_fog_color:new a.aL(b,i.u_fog_color),u_fog_ground_blend:new a.aI(b,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(b,i.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(b,i.u_horizon_color),u_horizon_fog_blend:new a.aI(b,i.u_horizon_fog_blend)}),terrainDepth:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_ele_delta:new a.aI(b,i.u_ele_delta)}),terrainCoords:(b,i)=>({u_matrix:new a.aJ(b,i.u_matrix),u_texture:new a.aH(b,i.u_texture),u_terrain_coords_id:new a.aI(b,i.u_terrain_coords_id),u_ele_delta:new a.aI(b,i.u_ele_delta)}),sky:(b,i)=>({u_sky_color:new a.aL(b,i.u_sky_color),u_horizon_color:new a.aL(b,i.u_horizon_color),u_horizon:new a.aI(b,i.u_horizon),u_sky_horizon_blend:new a.aI(b,i.u_sky_horizon_blend)})};class wo{constructor(i,h,p){this.context=i;const m=i.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Kd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dc{constructor(i,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,h,p){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],I=h.attributes[y.name];I!==void 0&&i.vertexAttribPointer(I,y.components,i[Kd[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const is=new WeakMap;function Zo(b){var i;if(is.has(b))return is.get(b);{const h=(i=b.getParameter(b.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return is.set(b,h),h}}class Ui{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fl extends Ui{getDefault(){return a.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Jd extends Ui{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class zs extends Ui{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Yd extends Ui{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class gh extends Ui{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Qd extends Ui{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class yh extends Ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Rc extends Ui{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class bh extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class vh extends Ui{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class wh extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class xh extends Ui{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class ns extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class kh extends Ui{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class ef extends Ui{getDefault(){return a.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Sh extends Ui{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ea extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class tf extends Ui{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class pl extends Ui{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class nf extends Ui{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class rf extends Ui{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Th extends Ui{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ih extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ch extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Fc extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Eh extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ml extends Ui{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Do extends Ui{getDefault(){return null}set(i){var h;if(i===this.current&&!this.dirty)return;const p=this.gl;Zo(p)?p.bindVertexArray(i):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Bc extends Ui{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Oc extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Nc extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class _l extends Ui{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class jc extends _l{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class rs extends _l{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Uc extends _l{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class of{constructor(i,h,p,m,y){this.context=i,this.width=h,this.height=p;const I=i.gl,L=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new jc(i,L),m)this.depthAttachment=y?new Uc(i,L):new rs(i,L);else if(y)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class Cn{constructor(i,h,p){this.blendFunction=i,this.blendColor=h,this.mask=p}}Cn.Replace=[1,0],Cn.disabled=new Cn(Cn.Replace,a.aM.transparent,[!1,!1,!1,!1]),Cn.unblended=new Cn(Cn.Replace,a.aM.transparent,[!0,!0,!0,!0]),Cn.alphaBlended=new Cn([1,771],a.aM.transparent,[!0,!0,!0,!0]);class sf{constructor(i){var h,p;if(this.gl=i,this.clearColor=new fl(this),this.clearDepth=new Jd(this),this.clearStencil=new zs(this),this.colorMask=new Yd(this),this.depthMask=new gh(this),this.stencilMask=new Qd(this),this.stencilFunc=new yh(this),this.stencilOp=new Rc(this),this.stencilTest=new bh(this),this.depthRange=new vh(this),this.depthTest=new wh(this),this.depthFunc=new xh(this),this.blend=new ns(this),this.blendFunc=new kh(this),this.blendColor=new ef(this),this.blendEquation=new Sh(this),this.cullFace=new Ea(this),this.cullFaceSide=new tf(this),this.frontFace=new pl(this),this.program=new nf(this),this.activeTexture=new rf(this),this.viewport=new Th(this),this.bindFramebuffer=new Ih(this),this.bindRenderbuffer=new Ch(this),this.bindTexture=new Fc(this),this.bindVertexBuffer=new Eh(this),this.bindElementBuffer=new ml(this),this.bindVertexArray=new Do(this),this.pixelStoreUnpack=new Bc(this),this.pixelStoreUnpackPremultiplyAlpha=new Oc(this),this.pixelStoreUnpackFlipY=new Nc(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Zo(i)){this.HALF_FLOAT=i.HALF_FLOAT;const m=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=i.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=i.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const m=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new wo(this,i,h)}createVertexBuffer(i,h,p){return new Dc(this,i,h,p)}createRenderbuffer(i,h,p){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,i,h,p),this.bindRenderbuffer.set(null),y}createFramebuffer(i,h,p,m){return new of(this,i,h,p,m)}clear({color:i,depth:h,stencil:p}){const m=this.gl;let y=0;i&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(y)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.aE(i.blendFunction,Cn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Zo(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var h;return Zo(this.gl)?this.gl.deleteVertexArray(i):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class gi{constructor(i,h,p){this.func=i,this.mask=h,this.range=p}}gi.ReadOnly=!1,gi.ReadWrite=!0,gi.disabled=new gi(519,gi.ReadOnly,[0,1]);const gl=7680;class Yi{constructor(i,h,p,m,y,I){this.test=i,this.ref=h,this.mask=p,this.fail=m,this.depthFail=y,this.pass=I}}Yi.disabled=new Yi({func:519,mask:0},0,0,gl,gl,gl);class Wi{constructor(i,h,p){this.enable=i,this.mode=h,this.frontFace=p}}let os;function La(b,i,h,p,m){const y=b.context,I=y.gl,L=b.useProgram("collisionBox"),M=[];let R=0,O=0;for(let ke=0;ke<p.length;ke++){const Ee=p[ke],me=i.getTile(Ee).getBucket(h);if(!me)continue;const De=m?me.textCollisionBox:me.iconCollisionBox,Be=me.collisionCircleArray;if(Be.length>0){const He=a.H();a.aQ(He,me.placementInvProjMatrix,b.transform.glCoordMatrix),a.aQ(He,He,me.placementViewportMatrix),M.push({circleArray:Be,circleOffset:O,transform:Ee.posMatrix,invTransform:He,coord:Ee}),R+=Be.length/4,O=R}De&&L.draw(y,I.LINES,gi.disabled,Yi.disabled,b.colorModeForRenderPass(),Wi.disabled,{u_matrix:Ee.posMatrix,u_pixel_extrude_scale:[1/(N=b.transform).width,1/N.height]},b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ee),h.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,b.transform.zoom,null,null,De.collisionVertexBuffer)}var N;if(!m||!M.length)return;const J=b.useProgram("collisionCircle"),oe=new a.aR;oe.resize(4*R),oe._trim();let he=0;for(const ke of M)for(let Ee=0;Ee<ke.circleArray.length/4;Ee++){const me=4*Ee,De=ke.circleArray[me+0],Be=ke.circleArray[me+1],He=ke.circleArray[me+2],ot=ke.circleArray[me+3];oe.emplace(he++,De,Be,He,ot,0),oe.emplace(he++,De,Be,He,ot,1),oe.emplace(he++,De,Be,He,ot,2),oe.emplace(he++,De,Be,He,ot,3)}(!os||os.length<2*R)&&(os=function(ke){const Ee=2*ke,me=new a.aT;me.resize(Ee),me._trim();for(let De=0;De<Ee;De++){const Be=6*De;me.uint16[Be+0]=4*De+0,me.uint16[Be+1]=4*De+1,me.uint16[Be+2]=4*De+2,me.uint16[Be+3]=4*De+2,me.uint16[Be+4]=4*De+3,me.uint16[Be+5]=4*De+0}return me}(R));const ge=y.createIndexBuffer(os,!0),ve=y.createVertexBuffer(oe,a.aS.members,!0);for(const ke of M){const Ee=ts(ke.transform,ke.invTransform,b.transform);J.draw(y,I.TRIANGLES,gi.disabled,Yi.disabled,b.colorModeForRenderPass(),Wi.disabled,Ee,b.style.map.terrain&&b.style.map.terrain.getTerrainData(ke.coord),h.id,ve,ge,a.a0.simpleSegment(0,2*ke.circleOffset,ke.circleArray.length,ke.circleArray.length/2),null,b.transform.zoom,null,null,null)}ve.destroy(),ge.destroy()}Wi.disabled=new Wi(!1,1029,2305),Wi.backCCW=new Wi(!0,1029,2305);const Ma=a.an(new Float32Array(16));function $c(b,i,h,p,m,y){const{horizontalAlign:I,verticalAlign:L}=a.au(b);return new a.P((-(I-.5)*i/m+p[0])*y,(-(L-.5)*h/m+p[1])*y)}function ss(b,i,h,p,m,y){const I=i.tileAnchorPoint.add(new a.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let L=p.mult(y);h||(L=L.rotate(-m));const M=I.add(L);return ye(M.x,M.y,i.labelPlaneMatrix,i.getElevation).point}if(h){const L=Re(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(b),M=Math.atan(L.y/L.x)+(L.x<0?Math.PI:0);return b.add(p.rotate(M))}return b.add(p)}function Ds(b,i,h,p,m,y,I,L,M,R,O,N,J,oe){const he=b.text.placedSymbolArray,ge=b.text.dynamicLayoutVertexArray,ve=b.icon.dynamicLayoutVertexArray,ke={};ge.clear();for(let Ee=0;Ee<he.length;Ee++){const me=he.get(Ee),De=me.hidden||!me.crossTileID||b.allowVerticalPlacement&&!me.placedOrientation?null:p[me.crossTileID];if(De){const Be=new a.P(me.anchorX,me.anchorY),He={getElevation:oe,width:m.width,height:m.height,labelPlaneMatrix:y,lineVertexArray:null,pitchWithMap:h,projection:O,projectionCache:null,tileAnchorPoint:Be,translation:N,unwrappedTileID:J},ot=h?ye(Be.x,Be.y,I,oe):Re(Be.x,Be.y,He),vt=Z(m.cameraToCenterDistance,ot.signedDistanceFromCamera);let It=a.ai(b.textSizeData,M,me)*vt/a.ap;h&&(It*=b.tilePixelRatio/L);const{width:At,height:kt,anchor:xt,textOffset:Nt,textBoxScale:ri}=De,St=$c(xt,At,kt,Nt,ri,It),Lt=O.getPitchedTextCorrection(m,Be.add(new a.P(N[0],N[1])),J),ti=ss(ot.point,He,i,St,m.angle,Lt),rn=b.allowVerticalPlacement&&me.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let fi=0;fi<me.numGlyphs;fi++)a.aj(ge,ti,rn);R&&me.associatedIconIndex>=0&&(ke[me.associatedIconIndex]={shiftedAnchor:ti,angle:rn})}else Et(me.numGlyphs,ge)}if(R){ve.clear();const Ee=b.icon.placedSymbolArray;for(let me=0;me<Ee.length;me++){const De=Ee.get(me);if(De.hidden)Et(De.numGlyphs,ve);else{const Be=ke[me];if(Be)for(let He=0;He<De.numGlyphs;He++)a.aj(ve,Be.shiftedAnchor,Be.angle);else Et(De.numGlyphs,ve)}}b.icon.dynamicLayoutVertexBuffer.updateData(ve)}b.text.dynamicLayoutVertexBuffer.updateData(ge)}function Kr(b,i,h){return h.iconsInText&&i?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function Vc(b,i,h,p,m,y,I,L,M,R,O,N){const J=b.context,oe=J.gl,he=b.transform,ge=Qo(),ve=L==="map",ke=M==="map",Ee=L!=="viewport"&&h.layout.get("symbol-placement")!=="point",me=ve&&!ke&&!Ee,De=!ke&&Ee,Be=!h.layout.get("symbol-sort-key").isConstant();let He=!1;const ot=b.depthModeForSublayer(0,gi.ReadOnly),vt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),It=[],At=ge.getCircleRadiusCorrection(he);for(const kt of p){const xt=i.getTile(kt),Nt=xt.getBucket(h);if(!Nt)continue;const ri=m?Nt.text:Nt.icon;if(!ri||!ri.segments.get().length||!ri.hasVisibleVertices)continue;const St=ri.programConfigurations.get(h.id),Lt=m||Nt.sdfIcons,ti=m?Nt.textSizeData:Nt.iconSizeData,rn=ke||he.pitch!==0,fi=b.useProgram(Kr(Lt,m,Nt),St),xi=a.ag(ti,he.zoom),on=b.style.map.terrain&&b.style.map.terrain.getTerrainData(kt);let nr,co,sn,Sr,pr=[0,0],rr=null;if(m)co=xt.glyphAtlasTexture,sn=oe.LINEAR,nr=xt.glyphAtlasTexture.size,Nt.iconsInText&&(pr=xt.imageAtlasTexture.size,rr=xt.imageAtlasTexture,Sr=rn||b.options.rotating||b.options.zooming||ti.kind==="composite"||ti.kind==="camera"?oe.LINEAR:oe.NEAREST);else{const Ti=h.layout.get("icon-size").constantOr(0)!==1||Nt.iconsNeedLinear;co=xt.imageAtlasTexture,sn=Lt||b.options.rotating||b.options.zooming||Ti||rn?oe.LINEAR:oe.NEAREST,nr=xt.imageAtlasTexture.size}const mr=wi(xt,1,b.transform.zoom),So=De?kt.posMatrix:Ma,Ks=Hr(So,ke,ve,b.transform,mr),Fl=wr(So,ke,ve,b.transform,mr),Js=wr(kt.posMatrix,ke,ve,b.transform,mr),Qr=ge.translatePosition(b.transform,xt,y,I),Bl=vt&&Nt.hasTextData(),pu=h.layout.get("icon-text-fit")!=="none"&&Bl&&Nt.hasIconData();if(Ee){const Ti=b.style.map.terrain?(Ys,Qs)=>b.style.map.terrain.getElevation(kt,Ys,Qs):null,hs=h.layout.get("text-rotation-alignment")==="map";ne(Nt,kt.posMatrix,b,m,Ks,Js,ke,R,hs,ge,kt.toUnwrapped(),he.width,he.height,Qr,Ti)}const eo=kt.posMatrix,to=m&&vt||pu,Go=Ee||to?Ma:Ks,uo=Fl,Jn=Lt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=Lt?Nt.iconsInText?Ac(ti.kind,xi,me,ke,Ee,to,b,eo,Go,uo,Qr,nr,pr,At):Ca(ti.kind,xi,me,ke,Ee,to,b,eo,Go,uo,Qr,m,nr,!0,At):_h(ti.kind,xi,me,ke,Ee,to,b,eo,Go,uo,Qr,m,nr,At);const $r={program:fi,buffers:ri,uniformValues:or,atlasTexture:co,atlasTextureIcon:rr,atlasInterpolation:sn,atlasInterpolationIcon:Sr,isSDF:Lt,hasHalo:Jn};if(Be&&Nt.canOverlap){He=!0;const Ti=ri.segments.get();for(const hs of Ti)It.push({segments:new a.a0([hs]),sortKey:hs.sortKey,state:$r,terrainData:on})}else It.push({segments:ri.segments,sortKey:0,state:$r,terrainData:on})}He&&It.sort((kt,xt)=>kt.sortKey-xt.sortKey);for(const kt of It){const xt=kt.state;if(J.activeTexture.set(oe.TEXTURE0),xt.atlasTexture.bind(xt.atlasInterpolation,oe.CLAMP_TO_EDGE),xt.atlasTextureIcon&&(J.activeTexture.set(oe.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),xt.isSDF){const Nt=xt.uniformValues;xt.hasHalo&&(Nt.u_is_halo=1,qc(xt.buffers,kt.segments,h,b,xt.program,ot,O,N,Nt,kt.terrainData)),Nt.u_is_halo=0}qc(xt.buffers,kt.segments,h,b,xt.program,ot,O,N,xt.uniformValues,kt.terrainData)}}function qc(b,i,h,p,m,y,I,L,M,R){const O=p.context;m.draw(O,O.gl.TRIANGLES,y,I,L,Wi.disabled,M,R,h.id,b.layoutVertexBuffer,b.indexBuffer,i,h.paint,p.transform.zoom,b.programConfigurations.get(h.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Zc(b,i,h,p){const m=b.context,y=m.gl,I=Yi.disabled,L=new Cn([y.ONE,y.ONE],a.aM.transparent,[!0,!0,!0,!0]),M=i.getBucket(h);if(!M)return;const R=p.key;let O=h.heatmapFbos.get(R);O||(O=Aa(m,i.tileSize,i.tileSize),h.heatmapFbos.set(R,O)),m.bindFramebuffer.set(O.framebuffer),m.viewport.set([0,0,i.tileSize,i.tileSize]),m.clear({color:a.aM.transparent});const N=M.programConfigurations.get(h.id),J=b.useProgram("heatmap",N),oe=b.style.map.terrain.getTerrainData(p);J.draw(m,y.TRIANGLES,gi.disabled,I,L,Wi.disabled,kr(p.posMatrix,i,b.transform.zoom,h.paint.get("heatmap-intensity")),oe,h.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,h.paint,b.transform.zoom,N)}function as(b,i,h){const p=b.context,m=p.gl;p.setColorMode(b.colorModeForRenderPass());const y=Pa(p,i),I=h.key,L=i.heatmapFbos.get(I);L&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,L.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),y.bind(m.LINEAR,m.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(p,m.TRIANGLES,gi.disabled,Yi.disabled,b.colorModeForRenderPass(),Wi.disabled,cl(b,i,0,1),null,i.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,i.paint,b.transform.zoom),L.destroy(),i.heatmapFbos.delete(I))}function Aa(b,i,h){var p,m;const y=b.gl,I=y.createTexture();y.bindTexture(y.TEXTURE_2D,I),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const L=(p=b.HALF_FLOAT)!==null&&p!==void 0?p:y.UNSIGNED_BYTE,M=(m=b.RGBA16F)!==null&&m!==void 0?m:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,M,i,h,0,y.RGBA,L,null);const R=b.createFramebuffer(i,h,!1,!1);return R.colorAttachment.set(I),R}function Pa(b,i){return i.colorRampTexture||(i.colorRampTexture=new ce(b,i.colorRamp,b.gl.RGBA)),i.colorRampTexture}function Rs(b,i,h,p,m){if(!h||!p||!p.imageAtlas)return;const y=p.imageAtlas.patternPositions;let I=y[h.to.toString()],L=y[h.from.toString()];if(!I&&L&&(I=L),!L&&I&&(L=I),!I||!L){const M=m.getPaintProperty(i);I=y[M],L=y[M]}I&&L&&b.setConstantPatternPositions(I,L)}function za(b,i,h,p,m,y,I){const L=b.context.gl,M="fill-pattern",R=h.paint.get(M),O=R&&R.constantOr(1),N=h.getCrossfadeParameters();let J,oe,he,ge,ve;I?(oe=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=L.LINES):(oe=O?"fillPattern":"fill",J=L.TRIANGLES);const ke=R.constantOr(null);for(const Ee of p){const me=i.getTile(Ee);if(O&&!me.patternsLoaded())continue;const De=me.getBucket(h);if(!De)continue;const Be=De.programConfigurations.get(h.id),He=b.useProgram(oe,Be),ot=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ee);O&&(b.context.activeTexture.set(L.TEXTURE0),me.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Be.updatePaintBuffers(N)),Rs(Be,M,ke,me,h);const vt=ot?Ee:null,It=b.translatePosMatrix(vt?vt.posMatrix:Ee.posMatrix,me,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){ge=De.indexBuffer2,ve=De.segments2;const At=[L.drawingBufferWidth,L.drawingBufferHeight];he=oe==="fillOutlinePattern"&&O?dh(It,b,N,me,At):Zd(It,At)}else ge=De.indexBuffer,ve=De.segments,he=O?hh(It,b,N,me):As(It);He.draw(b.context,J,m,b.stencilModeForClipping(Ee),y,Wi.disabled,he,ot,h.id,De.layoutVertexBuffer,ge,ve,h.paint,b.transform.zoom,Be)}}function yl(b,i,h,p,m,y,I){const L=b.context,M=L.gl,R="fill-extrusion-pattern",O=h.paint.get(R),N=O.constantOr(1),J=h.getCrossfadeParameters(),oe=h.paint.get("fill-extrusion-opacity"),he=O.constantOr(null);for(const ge of p){const ve=i.getTile(ge),ke=ve.getBucket(h);if(!ke)continue;const Ee=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ge),me=ke.programConfigurations.get(h.id),De=b.useProgram(N?"fillExtrusionPattern":"fillExtrusion",me);N&&(b.context.activeTexture.set(M.TEXTURE0),ve.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),me.updatePaintBuffers(J)),Rs(me,R,he,ve,h);const Be=b.translatePosMatrix(ge.posMatrix,ve,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),ot=N?ll(Be,b,He,oe,ge,J,ve):Ta(Be,b,He,oe);De.draw(L,L.gl.TRIANGLES,m,y,I,Wi.backCCW,ot,Ee,h.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,h.paint,b.transform.zoom,me,b.style.map.terrain&&ke.centroidVertexBuffer)}}function Fs(b,i,h,p,m,y,I){const L=b.context,M=L.gl,R=h.fbo;if(!R)return;const O=b.useProgram("hillshade"),N=b.style.map.terrain&&b.style.map.terrain.getTerrainData(i);L.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),O.draw(L,M.TRIANGLES,m,y,I,Wi.disabled,((J,oe,he,ge)=>{const ve=he.paint.get("hillshade-shadow-color"),ke=he.paint.get("hillshade-highlight-color"),Ee=he.paint.get("hillshade-accent-color");let me=he.paint.get("hillshade-illumination-direction")*(Math.PI/180);he.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=J.transform.angle);const De=!J.options.moving;return{u_matrix:ge?ge.posMatrix:J.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),De),u_image:0,u_latrange:ul(0,oe.tileID),u_light:[he.paint.get("hillshade-exaggeration"),me],u_shadow:ve,u_highlight:ke,u_accent:Ee}})(b,h,p,N?i:null),N,p.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function Bs(b,i,h,p,m,y){const I=b.context,L=I.gl,M=i.dem;if(M&&M.data){const R=M.dim,O=M.stride,N=M.getPixels();if(I.activeTexture.set(L.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||b.getTileTexture(O),i.demTexture){const oe=i.demTexture;oe.update(N,{premultiply:!1}),oe.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else i.demTexture=new ce(I,N,L.RGBA,{premultiply:!1}),i.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);I.activeTexture.set(L.TEXTURE0);let J=i.fbo;if(!J){const oe=new ce(I,{width:R,height:R,data:null},L.RGBA);oe.bind(L.LINEAR,L.CLAMP_TO_EDGE),J=i.fbo=I.createFramebuffer(R,R,!0,!1),J.colorAttachment.set(oe.texture)}I.bindFramebuffer.set(J.framebuffer),I.viewport.set([0,0,R,R]),b.useProgram("hillshadePrepare").draw(I,L.TRIANGLES,p,m,y,Wi.disabled,((oe,he)=>{const ge=he.stride,ve=a.H();return a.aP(ve,0,a.X,-a.X,0,0,1),a.J(ve,ve,[0,-a.X,0]),{u_matrix:ve,u_image:1,u_dimension:[ge,ge],u_zoom:oe.overscaledZ,u_unpack:he.getUnpackVector()}})(i.tileID,M),null,h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Lh(b,i,h,p,m,y){const I=p.paint.get("raster-fade-duration");if(!y&&I>0){const L=S.now(),M=(L-b.timeAdded)/I,R=i?(L-i.timeAdded)/I:-1,O=h.getSource(),N=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),J=!i||Math.abs(i.tileID.overscaledZ-N)>Math.abs(b.tileID.overscaledZ-N),oe=J&&b.refreshedUponExpiration?1:a.ac(J?M:1-R,0,1);return b.refreshedUponExpiration&&M>=1&&(b.refreshedUponExpiration=!1),i?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}const Gc=new a.aM(1,0,0,1),Ai=new a.aM(0,1,0,1),bl=new a.aM(0,0,1,1),af=new a.aM(1,0,1,1),Mh=new a.aM(0,1,1,1);function Os(b,i,h,p){vl(b,0,i+h/2,b.transform.width,h,p)}function Ah(b,i,h,p){vl(b,i-h/2,0,h,b.transform.height,p)}function vl(b,i,h,p,m,y){const I=b.context,L=I.gl;L.enable(L.SCISSOR_TEST),L.scissor(i*b.pixelRatio,h*b.pixelRatio,p*b.pixelRatio,m*b.pixelRatio),I.clear({color:y}),L.disable(L.SCISSOR_TEST)}function Ph(b,i,h){const p=b.context,m=p.gl,y=h.posMatrix,I=b.useProgram("debug"),L=gi.disabled,M=Yi.disabled,R=b.colorModeForRenderPass(),O="$debug",N=b.style.map.terrain&&b.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const J=i.getTileByID(h.key).latestRawTileData,oe=Math.floor((J&&J.byteLength||0)/1024),he=i.getTile(h).tileSize,ge=512/Math.min(he,512)*(h.overscaledZ/b.transform.zoom)*.5;let ve=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ve+=` => ${h.overscaledZ}`),function(ke,Ee){ke.initDebugOverlayCanvas();const me=ke.debugOverlayCanvas,De=ke.context.gl,Be=ke.debugOverlayCanvas.getContext("2d");Be.clearRect(0,0,me.width,me.height),Be.shadowColor="white",Be.shadowBlur=2,Be.lineWidth=1.5,Be.strokeStyle="white",Be.textBaseline="top",Be.font="bold 36px Open Sans, sans-serif",Be.fillText(Ee,5,5),Be.strokeText(Ee,5,5),ke.debugOverlayTexture.update(me),ke.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(b,`${ve} ${oe}kB`),I.draw(p,m.TRIANGLES,L,M,Cn.alphaBlended,Wi.disabled,Ia(y,a.aM.transparent,ge),null,O,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),I.draw(p,m.LINE_STRIP,L,M,R,Wi.disabled,Ia(y,a.aM.red),N,O,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function zh(b,i,h){const p=b.context,m=p.gl,y=b.colorModeForRenderPass(),I=new gi(m.LEQUAL,gi.ReadWrite,b.depthRangeFor3D),L=b.useProgram("terrain"),M=i.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,b.width,b.height]);for(const R of h){const O=b.renderToTexture.getTexture(R),N=i.getTerrainData(R.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,O.texture);const J=b.transform.calculatePosMatrix(R.tileID.toUnwrapped()),oe=i.getMeshFrameDelta(b.transform.zoom),he=b.transform.calculateFogMatrix(R.tileID.toUnwrapped()),ge=Lc(J,oe,he,b.style.sky,b.transform.pitch);L.draw(p,m.TRIANGLES,I,Yi.disabled,y,Wi.backCCW,ge,N,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class wl{constructor(i,h,p){this.vertexBuffer=i,this.indexBuffer=h,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class xl{constructor(i,h){this.context=new sf(i),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Jt.maxUnderzooming+Jt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Cc}resize(i,h,p){if(this.width=Math.floor(i*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const i=this.context,h=new a.aX;h.emplaceBack(0,0),h.emplaceBack(a.X,0),h.emplaceBack(0,a.X),h.emplaceBack(a.X,a.X),this.tileExtentBuffer=i.createVertexBuffer(h,es.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const p=new a.aX;p.emplaceBack(0,0),p.emplaceBack(a.X,0),p.emplaceBack(0,a.X),p.emplaceBack(a.X,a.X),this.debugBuffer=i.createVertexBuffer(p,es.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const m=new a.$;m.emplaceBack(0,0,0,0),m.emplaceBack(a.X,0,a.X,0),m.emplaceBack(0,a.X,0,a.X),m.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=i.createVertexBuffer(m,vi.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const y=new a.aX;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,es.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const I=new a.aZ;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(I);const L=new a.aY;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(L);const M=this.context.gl;this.stencilClearMode=new Yi({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.H();a.aP(p,0,this.width,this.height,0,0,1),a.K(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,h.TRIANGLES,gi.disabled,this.stencilClearMode,Cn.disabled,Wi.disabled,xr(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,h){if(this.currentStencilSource===i.source||!i.isTileClipped()||!h||!h.length)return;this.currentStencilSource=i.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Cn.disabled),p.setDepthMode(gi.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const L=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);y.draw(p,m.TRIANGLES,gi.disabled,new Yi({func:m.ALWAYS,mask:0},L,255,m.KEEP,m.KEEP,m.REPLACE),Cn.disabled,Wi.disabled,xr(I.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new Yi({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){const h=this.context.gl;return new Yi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(i){const h=this.context.gl,p=i.sort((I,L)=>L.overscaledZ-I.overscaledZ),m=p[p.length-1].overscaledZ,y=p[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const I={};for(let L=0;L<y;L++)I[L+m]=new Yi({func:h.GEQUAL,mask:255},L+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=y,[I,p]}return[{[m]:Yi.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Cn([i.CONSTANT_COLOR,i.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Cn.unblended:Cn.alphaBlended}depthModeForSublayer(i,h,p){if(!this.opaquePassEnabledForLayer())return gi.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new gi(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,y={},I={},L={};for(const M in m){const R=m[M];R.used&&R.prepare(this.context),y[M]=R.getVisibleCoordinates(),I[M]=y[M].slice().reverse(),L[M]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<p.length;M++)if(this.style._layers[p[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of p){const R=this.style._layers[M];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const O=I[R.source];(R.type==="custom"||O.length)&&this.renderLayer(this,m[R.source],R,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,R){const O=M.context,N=O.gl,J=((ke,Ee,me)=>({u_sky_color:ke.properties.get("sky-color"),u_horizon_color:ke.properties.get("horizon-color"),u_horizon:(Ee.height/2+Ee.getHorizon())*me,u_sky_horizon_blend:ke.properties.get("sky-horizon-blend")*Ee.height/2*me}))(R,M.style.map.transform,M.pixelRatio),oe=new gi(N.LEQUAL,gi.ReadWrite,[0,1]),he=Yi.disabled,ge=M.colorModeForRenderPass(),ve=M.useProgram("sky");if(!R.mesh){const ke=new a.aX;ke.emplaceBack(-1,-1),ke.emplaceBack(1,-1),ke.emplaceBack(1,1),ke.emplaceBack(-1,1);const Ee=new a.aY;Ee.emplaceBack(0,1,2),Ee.emplaceBack(0,2,3),R.mesh=new wl(O.createVertexBuffer(ke,es.members),O.createIndexBuffer(Ee),a.a0.simpleSegment(0,0,ke.length,Ee.length))}ve.draw(O,N.TRIANGLES,oe,he,ge,Wi.disabled,J,void 0,"sky",R.mesh.vertexBuffer,R.mesh.indexBuffer,R.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[p[this.currentLayer]],R=m[M.source],O=y[M.source];this._renderTileClippingMasks(M,O),this.renderLayer(this,R,M,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const M=this.style._layers[p[this.currentLayer]],R=m[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const O=(M.type==="symbol"?L:I)[M.source];this._renderTileClippingMasks(M,y[M.source]),this.renderLayer(this,R,M,O)}if(this.options.showTileBoundaries){const M=function(R,O){let N=null;const J=Object.values(R._layers).flatMap(ve=>ve.source&&!ve.isHidden(O)?[R.sourceCaches[ve.source]]:[]),oe=J.filter(ve=>ve.getSource().type==="vector"),he=J.filter(ve=>ve.getSource().type!=="vector"),ge=ve=>{(!N||N.getSource().maxzoom<ve.getSource().maxzoom)&&(N=ve)};return oe.forEach(ve=>ge(ve)),N||he.forEach(ve=>ge(ve)),N}(this.style,this.transform.zoom);M&&function(R,O,N){for(let J=0;J<N.length;J++)Ph(R,O,N[J])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const R=M.transform.padding;Os(M,M.transform.height-(R.top||0),3,Gc),Os(M,R.bottom||0,3,Ai),Ah(M,R.left||0,3,bl),Ah(M,M.transform.width-(R.right||0),3,af);const O=M.transform.centerPoint;(function(N,J,oe,he){vl(N,J-1,oe-10,2,20,he),vl(N,J-10,oe-1,20,2,he)})(M,O.x,M.transform.height-O.y,Mh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=i?!a.a_(h,p):!a.a$(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.b0(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,I){const L=y.context,M=L.gl,R=Cn.unblended,O=new gi(M.LEQUAL,gi.ReadWrite,[0,1]),N=I.getTerrainMesh(),J=I.sourceCache.getRenderableTiles(),oe=y.useProgram("terrainDepth");L.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),L.clear({color:a.aM.transparent,depth:1});for(const he of J){const ge=I.getTerrainData(he.tileID),ve={u_matrix:y.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(y.transform.zoom)};oe.draw(L,M.TRIANGLES,O,Yi.disabled,R,Wi.backCCW,ve,ge,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,I){const L=y.context,M=L.gl,R=Cn.unblended,O=new gi(M.LEQUAL,gi.ReadWrite,[0,1]),N=I.getTerrainMesh(),J=I.getCoordsTexture(),oe=I.sourceCache.getRenderableTiles(),he=y.useProgram("terrainCoords");L.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),L.clear({color:a.aM.transparent,depth:1}),I.coordsIndex=[];for(const ge of oe){const ve=I.getTerrainData(ge.tileID);L.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,J.texture);const ke={u_matrix:y.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(y.transform.zoom)};he.draw(L,M.TRIANGLES,O,Yi.disabled,R,Wi.backCCW,ke,ve,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),I.coordsIndex.push(ge.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(i,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(y,I,L,M,R){if(y.renderPass!=="translucent")return;const O=Yi.disabled,N=y.colorModeForRenderPass();(L._unevaluatedLayout.hasValue("text-variable-anchor")||L._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(J,oe,he,ge,ve,ke,Ee,me,De){const Be=oe.transform,He=Qo(),ot=ve==="map",vt=ke==="map";for(const It of J){const At=ge.getTile(It),kt=At.getBucket(he);if(!kt||!kt.text||!kt.text.segments.get().length)continue;const xt=a.ag(kt.textSizeData,Be.zoom),Nt=wi(At,1,oe.transform.zoom),ri=Hr(It.posMatrix,vt,ot,oe.transform,Nt),St=he.layout.get("icon-text-fit")!=="none"&&kt.hasIconData();if(xt){const Lt=Math.pow(2,Be.zoom-At.tileID.overscaledZ),ti=oe.style.map.terrain?(fi,xi)=>oe.style.map.terrain.getElevation(It,fi,xi):null,rn=He.translatePosition(Be,At,Ee,me);Ds(kt,ot,vt,De,Be,ri,It.posMatrix,Lt,xt,St,He,rn,It.toUnwrapped(),ti)}}}(M,y,L,I,L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),R),L.paint.get("icon-opacity").constantOr(1)!==0&&Vc(y,I,L,M,!1,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),L.layout.get("icon-rotation-alignment"),L.layout.get("icon-pitch-alignment"),L.layout.get("icon-keep-upright"),O,N),L.paint.get("text-opacity").constantOr(1)!==0&&Vc(y,I,L,M,!0,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.layout.get("text-keep-upright"),O,N),I.map.showCollisionBoxes&&(La(y,I,L,M,!0),La(y,I,L,M,!1))})(i,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(y,I,L,M){if(y.renderPass!=="translucent")return;const R=L.paint.get("circle-opacity"),O=L.paint.get("circle-stroke-width"),N=L.paint.get("circle-stroke-opacity"),J=!L.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(O.constantOr(1)===0||N.constantOr(1)===0))return;const oe=y.context,he=oe.gl,ge=y.depthModeForSublayer(0,gi.ReadOnly),ve=Yi.disabled,ke=y.colorModeForRenderPass(),Ee=[];for(let me=0;me<M.length;me++){const De=M[me],Be=I.getTile(De),He=Be.getBucket(L);if(!He)continue;const ot=He.programConfigurations.get(L.id),vt=y.useProgram("circle",ot),It=He.layoutVertexBuffer,At=He.indexBuffer,kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(De),xt={programConfiguration:ot,program:vt,layoutVertexBuffer:It,indexBuffer:At,uniformValues:Gd(y,De,Be,L),terrainData:kt};if(J){const Nt=He.segments.get();for(const ri of Nt)Ee.push({segments:new a.a0([ri]),sortKey:ri.sortKey,state:xt})}else Ee.push({segments:He.segments,sortKey:0,state:xt})}J&&Ee.sort((me,De)=>me.sortKey-De.sortKey);for(const me of Ee){const{programConfiguration:De,program:Be,layoutVertexBuffer:He,indexBuffer:ot,uniformValues:vt,terrainData:It}=me.state;Be.draw(oe,he.TRIANGLES,ge,ve,ke,Wi.disabled,vt,It,L.id,He,ot,me.segments,L.paint,y.transform.zoom,De)}})(i,h,p,m);break;case"heatmap":(function(y,I,L,M){if(L.paint.get("heatmap-opacity")===0)return;const R=y.context;if(y.style.map.terrain){for(const O of M){const N=I.getTile(O);I.hasRenderableParent(O)||(y.renderPass==="offscreen"?Zc(y,N,L,O):y.renderPass==="translucent"&&as(y,L,O))}R.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(O,N,J,oe){const he=O.context,ge=he.gl,ve=Yi.disabled,ke=new Cn([ge.ONE,ge.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(Ee,me,De){const Be=Ee.gl;Ee.activeTexture.set(Be.TEXTURE1),Ee.viewport.set([0,0,me.width/4,me.height/4]);let He=De.heatmapFbos.get(a.aU);He?(Be.bindTexture(Be.TEXTURE_2D,He.colorAttachment.get()),Ee.bindFramebuffer.set(He.framebuffer)):(He=Aa(Ee,me.width/4,me.height/4),De.heatmapFbos.set(a.aU,He))})(he,O,J),he.clear({color:a.aM.transparent});for(let Ee=0;Ee<oe.length;Ee++){const me=oe[Ee];if(N.hasRenderableParent(me))continue;const De=N.getTile(me),Be=De.getBucket(J);if(!Be)continue;const He=Be.programConfigurations.get(J.id),ot=O.useProgram("heatmap",He),{zoom:vt}=O.transform;ot.draw(he,ge.TRIANGLES,gi.disabled,ve,ke,Wi.disabled,kr(me.posMatrix,De,vt,J.paint.get("heatmap-intensity")),null,J.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,J.paint,O.transform.zoom,He)}he.viewport.set([0,0,O.width,O.height])}(y,I,L,M):y.renderPass==="translucent"&&function(O,N){const J=O.context,oe=J.gl;J.setColorMode(O.colorModeForRenderPass());const he=N.heatmapFbos.get(a.aU);he&&(J.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,he.colorAttachment.get()),J.activeTexture.set(oe.TEXTURE1),Pa(J,N).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(J,oe.TRIANGLES,gi.disabled,Yi.disabled,O.colorModeForRenderPass(),Wi.disabled,cl(O,N,0,1),null,N.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,N.paint,O.transform.zoom))}(y,L)})(i,h,p,m);break;case"line":(function(y,I,L,M){if(y.renderPass!=="translucent")return;const R=L.paint.get("line-opacity"),O=L.paint.get("line-width");if(R.constantOr(1)===0||O.constantOr(1)===0)return;const N=y.depthModeForSublayer(0,gi.ReadOnly),J=y.colorModeForRenderPass(),oe=L.paint.get("line-dasharray"),he=L.paint.get("line-pattern"),ge=he.constantOr(1),ve=L.paint.get("line-gradient"),ke=L.getCrossfadeParameters(),Ee=ge?"linePattern":oe?"lineSDF":ve?"lineGradient":"line",me=y.context,De=me.gl;let Be=!0;for(const He of M){const ot=I.getTile(He);if(ge&&!ot.patternsLoaded())continue;const vt=ot.getBucket(L);if(!vt)continue;const It=vt.programConfigurations.get(L.id),At=y.context.program.get(),kt=y.useProgram(Ee,It),xt=Be||kt.program!==At,Nt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(He),ri=he.constantOr(null);if(ri&&ot.imageAtlas){const ti=ot.imageAtlas,rn=ti.patternPositions[ri.to.toString()],fi=ti.patternPositions[ri.from.toString()];rn&&fi&&It.setConstantPatternPositions(rn,fi)}const St=Nt?He:null,Lt=ge?Ps(y,ot,L,ke,St):oe?Wd(y,ot,L,oe,ke,St):ve?fh(y,ot,L,vt.lineClipsArray.length,St):hl(y,ot,L,St);if(ge)me.activeTexture.set(De.TEXTURE0),ot.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),It.updatePaintBuffers(ke);else if(oe&&(xt||y.lineAtlas.dirty))me.activeTexture.set(De.TEXTURE0),y.lineAtlas.bind(me);else if(ve){const ti=vt.gradients[L.id];let rn=ti.texture;if(L.gradientVersion!==ti.version){let fi=256;if(L.stepInterpolant){const xi=I.getSource().maxzoom,on=He.canonical.z===xi?Math.ceil(1<<y.transform.maxZoom-He.canonical.z):1;fi=a.ac(a.aV(vt.maxLineLength/a.X*1024*on),256,me.maxTextureSize)}ti.gradient=a.aW({expression:L.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:ti.gradient||void 0,clips:vt.lineClipsArray}),ti.texture?ti.texture.update(ti.gradient):ti.texture=new ce(me,ti.gradient,De.RGBA),ti.version=L.gradientVersion,rn=ti.texture}me.activeTexture.set(De.TEXTURE0),rn.bind(L.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}kt.draw(me,De.TRIANGLES,N,y.stencilModeForClipping(He),J,Wi.disabled,Lt,Nt,L.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,L.paint,y.transform.zoom,It,vt.layoutVertexBuffer2),Be=!1}})(i,h,p,m);break;case"fill":(function(y,I,L,M){const R=L.paint.get("fill-color"),O=L.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const N=y.colorModeForRenderPass(),J=L.paint.get("fill-pattern"),oe=y.opaquePassEnabledForLayer()&&!J.constantOr(1)&&R.constantOr(a.aM.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===oe){const he=y.depthModeForSublayer(1,y.renderPass==="opaque"?gi.ReadWrite:gi.ReadOnly);za(y,I,L,M,he,N,!1)}if(y.renderPass==="translucent"&&L.paint.get("fill-antialias")){const he=y.depthModeForSublayer(L.getPaintProperty("fill-outline-color")?2:0,gi.ReadOnly);za(y,I,L,M,he,N,!0)}})(i,h,p,m);break;case"fill-extrusion":(function(y,I,L,M){const R=L.paint.get("fill-extrusion-opacity");if(R!==0&&y.renderPass==="translucent"){const O=new gi(y.context.gl.LEQUAL,gi.ReadWrite,y.depthRangeFor3D);if(R!==1||L.paint.get("fill-extrusion-pattern").constantOr(1))yl(y,I,L,M,O,Yi.disabled,Cn.disabled),yl(y,I,L,M,O,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const N=y.colorModeForRenderPass();yl(y,I,L,M,O,Yi.disabled,N)}}})(i,h,p,m);break;case"hillshade":(function(y,I,L,M){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const R=y.context,O=y.depthModeForSublayer(0,gi.ReadOnly),N=y.colorModeForRenderPass(),[J,oe]=y.renderPass==="translucent"?y.stencilConfigForOverlap(M):[{},M];for(const he of oe){const ge=I.getTile(he);ge.needsHillshadePrepare!==void 0&&ge.needsHillshadePrepare&&y.renderPass==="offscreen"?Bs(y,ge,L,O,Yi.disabled,N):y.renderPass==="translucent"&&Fs(y,he,ge,L,O,J[he.overscaledZ],N)}R.viewport.set([0,0,y.width,y.height])})(i,h,p,m);break;case"raster":(function(y,I,L,M){if(y.renderPass!=="translucent"||L.paint.get("raster-opacity")===0||!M.length)return;const R=y.context,O=R.gl,N=I.getSource(),J=y.useProgram("raster"),oe=y.colorModeForRenderPass(),[he,ge]=N instanceof ji?[{},M]:y.stencilConfigForOverlap(M),ve=ge[ge.length-1].overscaledZ,ke=!y.options.moving;for(const Ee of ge){const me=y.depthModeForSublayer(Ee.overscaledZ-ve,L.paint.get("raster-opacity")===1?gi.ReadWrite:gi.ReadOnly,O.LESS),De=I.getTile(Ee);De.registerFadeDuration(L.paint.get("raster-fade-duration"));const Be=I.findLoadedParent(Ee,0),He=I.findLoadedSibling(Ee),ot=Lh(De,Be||He||null,I,L,y.transform,y.style.map.terrain);let vt,It;const At=L.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;R.activeTexture.set(O.TEXTURE0),De.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(O.TEXTURE1),Be?(Be.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),vt=Math.pow(2,Be.tileID.overscaledZ-De.tileID.overscaledZ),It=[De.tileID.canonical.x*vt%1,De.tileID.canonical.y*vt%1]):De.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),De.texture.useMipmap&&R.extTextureFilterAnisotropic&&y.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ee),xt=kt?Ee:null,Nt=xt?xt.posMatrix:y.transform.calculatePosMatrix(Ee.toUnwrapped(),ke),ri=Hd(Nt,It||[0,0],vt||1,ot,L);N instanceof ji?J.draw(R,O.TRIANGLES,me,Yi.disabled,oe,Wi.disabled,ri,kt,L.id,N.boundsBuffer,y.quadTriangleIndexBuffer,N.boundsSegments):J.draw(R,O.TRIANGLES,me,he[Ee.overscaledZ],oe,Wi.disabled,ri,kt,L.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(i,h,p,m);break;case"background":(function(y,I,L,M){const R=L.paint.get("background-color"),O=L.paint.get("background-opacity");if(O===0)return;const N=y.context,J=N.gl,oe=y.transform,he=oe.tileSize,ge=L.paint.get("background-pattern");if(y.isPatternMissing(ge))return;const ve=!ge&&R.a===1&&O===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ve)return;const ke=Yi.disabled,Ee=y.depthModeForSublayer(0,ve==="opaque"?gi.ReadWrite:gi.ReadOnly),me=y.colorModeForRenderPass(),De=y.useProgram(ge?"backgroundPattern":"background"),Be=M||oe.coveringTiles({tileSize:he,terrain:y.style.map.terrain});ge&&(N.activeTexture.set(J.TEXTURE0),y.imageManager.bind(y.context));const He=L.getCrossfadeParameters();for(const ot of Be){const vt=M?ot.posMatrix:y.transform.calculatePosMatrix(ot.toUnwrapped()),It=ge?Pc(vt,O,y,ge,{tileID:ot,tileSize:he},He):dl(vt,O,R),At=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ot);De.draw(N,J.TRIANGLES,Ee,ke,me,Wi.disabled,It,At,L.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(i,0,p,m);break;case"custom":(function(y,I,L){const M=y.context,R=L.implementation;if(y.renderPass==="offscreen"){const O=R.prerender;O&&(y.setCustomLayerDefaults(),M.setColorMode(y.colorModeForRenderPass()),O.call(R,M.gl,y.transform.customLayerMatrix()),M.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),M.setColorMode(y.colorModeForRenderPass()),M.setStencilMode(Yi.disabled);const O=R.renderingMode==="3d"?new gi(y.context.gl.LEQUAL,gi.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,gi.ReadOnly);M.setDepthMode(O),R.render(M.gl,y.transform.customLayerMatrix(),{farZ:y.transform.farZ,nearZ:y.transform.nearZ,fov:y.transform._fov,modelViewProjectionMatrix:y.transform.modelViewProjectionMatrix,projectionMatrix:y.transform.projectionMatrix}),M.setDirty(),y.setBaseState(),M.bindFramebuffer.set(null)}})(i,0,p)}}translatePosMatrix(i,h,p,m,y){if(!p[0]&&!p[1])return i;const I=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(I){const R=Math.sin(I),O=Math.cos(I);p=[p[0]*O-p[1]*R,p[0]*R+p[1]*O]}const L=[y?p[0]:wi(h,p[0],this.transform.zoom),y?p[1]:wi(h,p[1],this.transform.zoom),0],M=new Float32Array(16);return a.J(M,i,L),M}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),p=this.imageManager.getPattern(i.to.toString());return!h||!p}useProgram(i,h){this.cache=this.cache||{};const p=i+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Mc(this.context,qo[i],h,zc[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:h}=this.context.gl;return this.width!==i||this.height!==h}}class Ns{constructor(i,h){this.points=i,this.planes=h}static fromInvProjectionMatrix(i,h,p){const m=Math.pow(2,p),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const M=1/(L=a.af([],L,i))[3]/h*m;return a.b1(L,L,[M,M,1/L[3],M])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const M=function(J,oe){var he=oe[0],ge=oe[1],ve=oe[2],ke=he*he+ge*ge+ve*ve;return ke>0&&(ke=1/Math.sqrt(ke)),J[0]=oe[0]*ke,J[1]=oe[1]*ke,J[2]=oe[2]*ke,J}([],function(J,oe,he){var ge=oe[0],ve=oe[1],ke=oe[2],Ee=he[0],me=he[1],De=he[2];return J[0]=ve*De-ke*me,J[1]=ke*Ee-ge*De,J[2]=ge*me-ve*Ee,J}([],Y([],y[L[0]],y[L[1]]),Y([],y[L[2]],y[L[1]]))),R=-((O=M)[0]*(N=y[L[1]])[0]+O[1]*N[1]+O[2]*N[2]);var O,N;return M.concat(R)});return new Ns(y,I)}}class js{constructor(i,h){this.min=i,this.max=h,this.center=function(p,m,y){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,y){return p[0]=m[0]+y[0],p[1]=m[1]+y[1],p[2]=m[2]+y[2],p}([],this.min,this.max))}quadrant(i){const h=[i%2==0,i<2],p=xe(this.min),m=xe(this.max);for(let y=0;y<h.length;y++)p[y]=h[y]?this.min[y]:this.center[y],m[y]=h[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new js(p,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<i.planes.length;m++){const y=i.planes[m];let I=0;for(let L=0;L<h.length;L++)a.b2(y,h[L])>=0&&I++;if(I===0)return 0;I!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let L=0;L<i.points.length;L++){const M=i.points[L][m]-this.min[m];y=Math.min(y,M),I=Math.max(I,M)}if(I<0||y>this.max[m]-this.min[m])return 0}return 1}}class Us{constructor(i=0,h=0,p=0,m=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=p,this.right=m}interpolate(i,h,p){return h.top!=null&&i.top!=null&&(this.top=a.y.number(i.top,h.top,p)),h.bottom!=null&&i.bottom!=null&&(this.bottom=a.y.number(i.bottom,h.bottom,p)),h.left!=null&&i.left!=null&&(this.left=a.y.number(i.left,h.left,p)),h.right!=null&&i.right!=null&&(this.right=a.y.number(i.right,h.right,p)),this}getCenter(i,h){const p=a.ac((this.left+i-this.right)/2,0,i),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Us(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Wc=85.051129;class $s{constructor(i,h,p,m,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=i||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Us,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new $s(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.lngRange=i.lngRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const h=-a.b3(i,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,y){var I=m[0],L=m[1],M=m[2],R=m[3],O=Math.sin(y),N=Math.cos(y);p[0]=I*N+M*O,p[1]=L*N+R*O,p[2]=I*-O+M*N,p[3]=L*-O+R*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const h=a.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const h=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,p){this._unmodified=!1,this._edgeInsets.interpolate(i,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const h=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(i){const h=[new a.b4(0,i)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),y=this.pointCoordinate(new a.P(this.width,this.height)),I=this.pointCoordinate(new a.P(0,this.height)),L=Math.floor(Math.min(p.x,m.x,y.x,I.x)),M=Math.floor(Math.max(p.x,m.x,y.x,I.x)),R=1;for(let O=L-R;O<=M+R;O++)O!==0&&h.push(new a.b4(O,i))}return h}coveringTiles(i){var h,p;let m=this.coveringZoomLevel(i);const y=m;if(i.minzoom!==void 0&&m<i.minzoom)return[];i.maxzoom!==void 0&&m>i.maxzoom&&(m=i.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),L=a.Z.fromLngLat(this.center),M=Math.pow(2,m),R=[M*I.x,M*I.y,0],O=[M*L.x,M*L.y,0],N=Ns.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let J=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(J=m);const oe=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,he=me=>({aabb:new js([me*M,0,0],[(me+1)*M,M,0]),zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),ge=[],ve=[],ke=m,Ee=i.reparseOverscaled?y:m;if(this._renderWorldCopies)for(let me=1;me<=3;me++)ge.push(he(-me)),ge.push(he(me));for(ge.push(he(0));ge.length>0;){const me=ge.pop(),De=me.x,Be=me.y;let He=me.fullyVisible;if(!He){const kt=me.aabb.intersects(N);if(kt===0)continue;He=kt===2}const ot=i.terrain?R:O,vt=me.aabb.distanceX(ot),It=me.aabb.distanceY(ot),At=Math.max(Math.abs(vt),Math.abs(It));if(me.zoom===ke||At>oe+(1<<ke-me.zoom)-2&&me.zoom>=J){const kt=ke-me.zoom,xt=R[0]-.5-(De<<kt),Nt=R[1]-.5-(Be<<kt);ve.push({tileID:new a.S(me.zoom===ke?Ee:me.zoom,me.wrap,me.zoom,De,Be),distanceSq:K([O[0]-.5-De,O[1]-.5-Be]),tileDistanceToCamera:Math.sqrt(xt*xt+Nt*Nt)})}else for(let kt=0;kt<4;kt++){const xt=(De<<1)+kt%2,Nt=(Be<<1)+(kt>>1),ri=me.zoom+1;let St=me.aabb.quadrant(kt);if(i.terrain){const Lt=new a.S(ri,me.wrap,ri,xt,Nt),ti=i.terrain.getMinMaxElevation(Lt),rn=(h=ti.minElevation)!==null&&h!==void 0?h:this.elevation,fi=(p=ti.maxElevation)!==null&&p!==void 0?p:this.elevation;St=new js([St.min[0],St.min[1],rn],[St.max[0],St.max[1],fi])}ge.push({aabb:St,zoom:ri,x:xt,y:Nt,wrap:me.wrap,fullyVisible:He})}}return ve.sort((me,De)=>me.distanceSq-De.distanceSq).map(me=>me.tileID)}resize(i,h){this.width=i,this.height=h,this.pixelsToGLUnits=[2/i,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const h=a.ac(i.lat,-85.051129,Wc);return new a.P(a.O(i.lng)*this.worldSize,a.Q(h)*this.worldSize)}unproject(i){return new a.Z(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,i),y=i.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-y))return;const I=p+h-y,L=Math.cos(this._pitch)*this.cameraToCenterDistance/I/a.b5(1,m.lat),M=this.scaleZoom(L/this.tileSize);this._elevation=y,this._center=m,this.zoom=M}setLocationAtPoint(i,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i),I=new a.Z(y.x-(p.x-m.x),y.y-(p.y-m.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,h){return h?this.coordinatePoint(this.locationCoordinate(i),h.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,h){return this.coordinateLocation(this.pointCoordinate(i,h))}locationCoordinate(i){return a.Z.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,h){if(h){const J=h.pointCoordinate(i);if(J!=null)return J}const p=[i.x,i.y,0,1],m=[i.x,i.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const y=p[3],I=m[3],L=p[1]/y,M=m[1]/I,R=p[2]/y,O=m[2]/I,N=R===O?0:(0-R)/(O-R);return new a.Z(a.y.number(p[0]/y,m[0]/I,N)/this.worldSize,a.y.number(L,M,N)/this.worldSize)}coordinatePoint(i,h=0,p=this.pixelMatrix){const m=[i.x*this.worldSize,i.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new Te().extend(this.pointLocation(new a.P(0,i))).extend(this.pointLocation(new a.P(this.width,i))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Wc])}calculateTileMatrix(i){const h=i.canonical,p=this.worldSize/this.zoomScale(h.z),m=h.x+Math.pow(2,h.z)*i.wrap,y=a.an(new Float64Array(16));return a.J(y,y,[m*p,h.y*p,0]),a.K(y,y,[p/a.X,p/a.X,1]),y}calculatePosMatrix(i,h=!1){const p=i.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const y=this.calculateTileMatrix(i);return a.L(y,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,y),m[p]=new Float32Array(y),m[p]}calculateFogMatrix(i){const h=i.key,p=this._fogMatrixCache;if(p[h])return p[h];const m=this.calculateTileMatrix(i);return a.L(m,this.fogMatrix,m),p[h]=new Float32Array(m),p[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.N(i.lng,i.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const me=179.9999999999;m=[-me,me]}const y=this.tileSize*this.zoomScale(p.zoom);let I=0,L=y,M=0,R=y,O=0,N=0;const{x:J,y:oe}=this.size;if(this.latRange){const me=this.latRange;I=a.Q(me[1])*y,L=a.Q(me[0])*y,L-I<oe&&(O=oe/(L-I))}m&&(M=a.b3(a.O(m[0])*y,0,y),R=a.b3(a.O(m[1])*y,0,y),R<M&&(R+=y),R-M<J&&(N=J/(R-M)));const{x:he,y:ge}=this.project.call({worldSize:y},i);let ve,ke;const Ee=Math.max(N||0,O||0);if(Ee){const me=new a.P(N?(R+M)/2:he,O?(L+I)/2:ge);return p.center=this.unproject.call({worldSize:y},me).wrap(),p.zoom+=this.scaleZoom(Ee),p}if(this.latRange){const me=oe/2;ge-me<I&&(ke=I+me),ge+me>L&&(ke=L-me)}if(m){const me=(M+R)/2;let De=he;this._renderWorldCopies&&(De=a.b3(he,me-y/2,me+y/2));const Be=J/2;De-Be<M&&(ve=M+Be),De+Be>R&&(ve=R-Be)}if(ve!==void 0||ke!==void 0){const me=new a.P(ve??he,ke??ge);p.center=this.unproject.call({worldSize:y},me).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.K(m,m,[this.width/2,-this.height/2,1]),a.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.K(m,m,[1,-1,1]),a.J(m,m,[-1,-1,0]),a.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this.minElevationForCurrentTile),L=y-I*this._pixelPerMeter/Math.cos(this._pitch),M=I<0?L:y,R=Math.PI/2+this._pitch,O=this._fov*(.5+i.y/this.height),N=Math.sin(O)*M/Math.sin(a.ac(Math.PI-R-O,.01,Math.PI-.01)),J=this.getHorizon(),oe=2*Math.atan(J/this.cameraToCenterDistance)*(.5+i.y/(2*J)),he=Math.sin(oe)*M/Math.sin(a.ac(Math.PI-R-oe,.01,Math.PI-.01)),ge=Math.min(N,he);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*ge+M),this.nearZ=this.height/50,m=new Float64Array(16),a.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-i.x/this.width,m[9]=2*i.y/this.height,this.projectionMatrix=a.ae(m),a.K(m,m,[1,-1,1]),a.J(m,m,[0,0,-this.cameraToCenterDistance]),a.b7(m,m,this._pitch),a.ad(m,m,this.angle),a.J(m,m,[-h,-p,0]),this.mercatorMatrix=a.K([],m,[this.worldSize,this.worldSize,this.worldSize]),a.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,m),a.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=a.as([],m),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,y,this.farZ),this.fogMatrix[8]=2*-i.x/this.width,this.fogMatrix[9]=2*i.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-h,-p,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,m);const ve=this.width%2/2,ke=this.height%2/2,Ee=Math.cos(this.angle),me=Math.sin(this.angle),De=h-Math.round(h)+Ee*ve+me*ke,Be=p-Math.round(p)+Ee*ke+me*ve,He=new Float64Array(m);if(a.J(He,He,[De>.5?De-1:De,Be>.5?Be-1:Be,0]),this.alignedModelViewProjectionMatrix=He,m=a.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new a.P(0,0)),h=[i.x*this.worldSize,i.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,i))}getCameraQueryGeometry(i){const h=this.getCameraPoint();if(i.length===1)return[i[0],h];{let p=h.x,m=h.y,y=h.x,I=h.y;for(const L of i)p=Math.min(p,L.x),m=Math.min(m,L.y),y=Math.max(y,L.x),I=Math.max(I,L.y);return[new a.P(p,m),new a.P(y,m),new a.P(y,I),new a.P(p,I),new a.P(p,m)]}}lngLatToCameraDepth(i,h){const p=this.locationCoordinate(i),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function Da(b,i){let h,p=!1,m=null,y=null;const I=()=>{m=null,p&&(b.apply(y,h),m=setTimeout(I,i),p=!1)};return(...L)=>(p=!0,y=this,h=L,m||I(),m)}class kl{constructor(i){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const p=h.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let y=window.location.hash.replace(m,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let I=window.location.href.replace(/(#.+)?$/,y);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Da(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),I=Math.round(h.lng*y)/y,L=Math.round(h.lat*y)/y,M=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=i?`/${I}/${L}/${p}`:`${p}/${L}/${I}`,(M||R)&&(O+="/"+Math.round(10*M)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const N=this._hashName;let J=!1;const oe=window.location.hash.slice(1).split("&").map(he=>{const ge=he.split("=")[0];return ge===N?(J=!0,`${ge}=${O}`):he}).filter(he=>he);return J||oe.push(`${N}=${O}`),`#${oe.join("&")}`}return`#${O}`}}const Sl={linearity:.3,easing:a.b8(0,0,.3,1)},Hc=a.e({deceleration:2500,maxSpeed:1400},Sl),lf=a.e({deceleration:20,maxSpeed:1400},Sl),Dh=a.e({deceleration:1e3,maxSpeed:360},Sl),Tl=a.e({deceleration:1e3,maxSpeed:90},Sl);class Xc{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=S.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)h.zoom+=y.zoomDelta||0,h.bearing+=y.bearingDelta||0,h.pitch+=y.pitchDelta||0,y.panDelta&&h.pan._add(y.panDelta),y.around&&(h.around=y.around),y.pinchAround&&(h.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const y=Fa(h.pan.mag(),p,a.e({},Hc,i||{}));m.offset=h.pan.mult(y.amount/h.pan.mag()),m.center=this._map.transform.center,Ra(m,y)}if(h.zoom){const y=Fa(h.zoom,p,lf);m.zoom=this._map.transform.zoom+y.amount,Ra(m,y)}if(h.bearing){const y=Fa(h.bearing,p,Dh);m.bearing=this._map.transform.bearing+a.ac(y.amount,-179,179),Ra(m,y)}if(h.pitch){const y=Fa(h.pitch,p,Tl);m.pitch=this._map.transform.pitch+y.amount,Ra(m,y)}if(m.zoom||m.bearing){const y=h.pinchAround===void 0?h.around:h.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function Ra(b,i){(!b.duration||b.duration<i.duration)&&(b.duration=i.duration,b.easing=i.easing)}function Fa(b,i,h){const{maxSpeed:p,linearity:m,deceleration:y}=h,I=a.ac(b*m/(i/1e3),-p,p),L=Math.abs(I)/(y*m);return{easing:h.easing,duration:1e3*L,amount:I*(L/2)}}class ir extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p,m={}){const y=E.mousePos(h.getCanvas(),p),I=h.unproject(y);super(i,a.e({point:y,lngLat:I,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class ls extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){const m=i==="touchend"?p.changedTouches:p.touches,y=E.touchPos(h.getCanvasContainer(),m),I=y.map(M=>h.unproject(M)),L=y.reduce((M,R,O,N)=>M.add(R.div(N.length)),new a.P(0,0));super(i,{points:y,point:L,lngLats:I,lngLat:h.unproject(L),originalEvent:p}),this._defaultPrevented=!1}}class Rh extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class Fh{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Rh(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new ir(i.type,this._map,i))}mouseup(i){this._map.fire(new ir(i.type,this._map,i))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new ir(i.type,this._map,i))}dblclick(i){return this._firePreventable(new ir(i.type,this._map,i))}mouseover(i){this._map.fire(new ir(i.type,this._map,i))}mouseout(i){this._map.fire(new ir(i.type,this._map,i))}touchstart(i){return this._firePreventable(new ls(i.type,this._map,i))}touchmove(i){this._map.fire(new ls(i.type,this._map,i))}touchend(i){this._map.fire(new ls(i.type,this._map,i))}touchcancel(i){this._map.fire(new ls(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class En{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new ir(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new ir(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ao{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(a.P.convert(i),this._map.terrain)}}class jr{constructor(i,h){this._map=i,this._tr=new ao(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&i.button===0&&(E.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=E.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const y=Math.min(m.x,p.x),I=Math.max(m.x,p.x),L=Math.min(m.y,p.y),M=Math.max(m.y,p.y);E.setTransform(this._box,`translate(${y}px,${L}px)`),this._box.style.width=I-y+"px",this._box.style.height=M-L+"px"}mouseupWindow(i,h){if(!this._active||i.button!==0)return;const p=this._startPos,m=h;if(this.reset(),E.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(E.remove(this._box),this._box=null),E.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new a.k(i,{originalEvent:h}))}}function Ba(b,i){if(b.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${i.length}`);const h={};for(let p=0;p<b.length;p++)h[b[p].identifier]=i[p];return h}class Kc{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const y=new a.P(0,0);for(const I of m)y._add(I);return y.div(m.length)}(h),this.touches=Ba(p,h)))}touchmove(i,h,p){if(this.aborted||!this.centroid)return;const m=Ba(p,h);for(const y in this.touches){const I=m[y];(!I||I.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(i,h,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Il{constructor(i){this.singleTap=new Kc(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,h,p){this.singleTap.touchstart(i,h,p)}touchmove(i,h,p){this.singleTap.touchmove(i,h,p)}touchend(i,h,p){const m=this.singleTap.touchend(i,h,p);if(m){const y=i.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(m)<30;if(y&&I||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Vs{constructor(i){this._tr=new ao(i),this._zoomIn=new Il({numTouches:1,numTaps:2}),this._zoomOut=new Il({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,p){this._zoomIn.touchstart(i,h,p),this._zoomOut.touchstart(i,h,p)}touchmove(i,h,p){this._zoomIn.touchmove(i,h,p),this._zoomOut.touchmove(i,h,p)}touchend(i,h,p){const m=this._zoomIn.touchend(i,h,p),y=this._zoomOut.touchend(i,h,p),I=this._tr;return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(m)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ro{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const h=this._moveFunction(...i);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(i,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&E.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jc={0:1,2:2};class Cl{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const h=E.mouseButton(i);this._eventButton=h}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(h,p){const m=Jc[p];return h.buttons===void 0||(h.buttons&m)!==m}(i,this._eventButton)}isValidEndEvent(i){return E.mouseButton(i)===this._eventButton}}class Yc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const El=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=i=>{i.preventDefault()}},Qc=({enable:b,clickTolerance:i,bearingDegreesPerPixelMoved:h=.8})=>{const p=new Cl({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Ro({clickTolerance:i,move:(m,y)=>({bearingDelta:(y.x-m.x)*h}),moveStateManager:p,enable:b,assignEvents:El})},eu=({enable:b,clickTolerance:i,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new Cl({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Ro({clickTolerance:i,move:(m,y)=>({pitchDelta:(y.y-m.y)*h}),moveStateManager:p,enable:b,assignEvents:El})};class cs{constructor(i,h){this._clickTolerance=i.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,h,p){return this._calculateTransform(i,h,p)}touchmove(i,h,p){if(this._active){if(!this._shouldBePrevented(p.length))return i.preventDefault(),this._calculateTransform(i,h,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,h,p){this._calculateTransform(i,h,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,p){p.length>0&&(this._active=!0);const m=Ba(p,h),y=new a.P(0,0),I=new a.P(0,0);let L=0;for(const R in m){const O=m[R],N=this._touches[R];N&&(y._add(O),I._add(O.sub(N)),L++,m[R]=O)}if(this._touches=m,this._shouldBePrevented(L)||!I.mag())return;const M=I.div(L);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(L),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ll{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,p){if(!this._firstTwoTouches)return;i.preventDefault();const[m,y]=this._firstTwoTouches,I=Oa(p,h,m),L=Oa(p,h,y);if(!I||!L)return;const M=this._aroundCenter?null:I.add(L).div(2);return this._move([I,L],M,i)}touchend(i,h,p){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,I=Oa(p,h,m),L=Oa(p,h,y);I&&L||(this._active&&E.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Oa(b,i,h){for(let p=0;p<b.length;p++)if(b[p].identifier===h)return i[p]}function tu(b,i){return Math.log(b/i)/Math.LN2}class iu extends Ll{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(tu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tu(this._distance,p),pinchAround:h}}}function nu(b,i){return 180*b.angleWith(i)/Math.PI}class ru extends Ll{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h,p){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nu(this._vector,m),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,p=nu(i,this._startVector);return Math.abs(p)<h}}function Ml(b){return Math.abs(b.y)>Math.abs(b.x)}class qs extends Ll{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,h,p){super.touchstart(i,h,p),this._currentTouchCount=p.length}_start(i){this._lastPoints=i,Ml(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=i[0].sub(this._lastPoints[0]),y=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,p.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(i,h,p){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,y=h.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const I=i.y>0==h.y>0;return Ml(i)&&Ml(h)&&I}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class Jr{constructor(i){this._tr=new ao(i);const h=Bh;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,p=0,m=0,y=0,I=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),I=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:L=>{const M=this._tr;L.easeTo({duration:300,easeId:"keyboardHandler",easing:xo,zoom:h?Math.round(M.zoom)+h*(i.shiftKey?2:1):M.zoom,bearing:M.bearing+p*this._bearingStep,pitch:M.pitch+m*this._pitchStep,offset:[-y*this._panStep,-I*this._panStep],center:M.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xo(b){return b*(2-b)}const ou=4.000244140625;class lo{constructor(i,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=i,this._tr=new ao(i),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let h=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%ou==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=E.mousePos(this._map.getCanvas(),i),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.N.convert(this._aroundCenter?p.center:p.unproject(h)):a.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>ou?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&R!==0&&(R=1/R);const O=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(O*R))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,p=this._startZoom,m=this._easing;let y,I=!1;const L=S.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&L){const M=Math.min(L/200,1),R=m(M);y=a.y.number(p,h,R),M<1?this._frameId||(this._frameId=!0):I=!0}else y=h,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:y-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=a.b9;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,y=p.easing(m+.01)-p.easing(m),I=.27/Math.sqrt(y*y+1e-4)*.01,L=Math.sqrt(.0729-I*I);h=a.b8(I,L,.25,1)}return this._prevEase={start:S.now(),duration:i,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class us{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cf{constructor(i){this._tr=new ao(i),this.reset()}reset(){this._active=!1}dblclick(i,h){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uf{constructor(){this._tap=new Il({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],y=i.timeStamp-this._tapTime<500,I=this._tapPoint.dist(m)<30;y&&I?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(i,h,p)}touchmove(i,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,h,p)}touchend(i,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(i,h,p);m&&(this._tapTime=i.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oh{constructor(i,h,p){this._el=i,this._mousePan=h,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nh{constructor(i,h,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class su{constructor(i,h,p,m){this._el=i,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Zs{constructor(i,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=E.create("div","maplibregl-cooperative-gesture-screen",i);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=p,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(E.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,h){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:i,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Yr=b=>b.zoom||b.drag||b.pitch||b.rotate;class zt extends a.k{}function Al(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class au{constructor(i,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=m.type==="renderFrame"?void 0:m,L={needsRenderFrame:!1},M={},R={},O=m.touches,N=O?this._getMapTouches(O):void 0,J=N?E.touchPos(this._map.getCanvas(),N):E.mousePos(this._map.getCanvas(),m);for(const{handlerName:ge,handler:ve,allowed:ke}of this._handlers){if(!ve.isEnabled())continue;let Ee;this._blockedByActive(R,ke,ge)?ve.reset():ve[y||m.type]&&(Ee=ve[y||m.type](m,J,N),this.mergeHandlerResult(L,M,Ee,ge,I),Ee&&Ee.needsRenderFrame&&this._triggerRenderFrame()),(Ee||ve.isActive())&&(R[ge]=ve)}const oe={};for(const ge in this._previousActiveHandlers)R[ge]||(oe[ge]=I);this._previousActiveHandlers=R,(Object.keys(oe).length||Al(L))&&(this._changes.push([L,M,oe]),this._triggerRenderFrame()),(Object.keys(R).length||Al(L))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:he}=L;he&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],he(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xc(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,I]of this._listeners)E.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[i,h,p]of this._listeners)E.removeEventListener(i,h,i===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Fh(h,i));const m=h.boxZoom=new jr(h,i);this._add("boxZoom",m),i.interactive&&i.boxZoom&&m.enable();const y=h.cooperativeGestures=new Zs(h,i.cooperativeGestures);this._add("cooperativeGestures",y),i.cooperativeGestures&&y.enable();const I=new Vs(h),L=new cf(h);h.doubleClickZoom=new us(L,I),this._add("tapZoom",I),this._add("clickZoom",L),i.interactive&&i.doubleClickZoom&&h.doubleClickZoom.enable();const M=new uf;this._add("tapDragZoom",M);const R=h.touchPitch=new qs(h);this._add("touchPitch",R),i.interactive&&i.touchPitch&&h.touchPitch.enable(i.touchPitch);const O=Qc(i),N=eu(i);h.dragRotate=new Nh(i,O,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]),i.interactive&&i.dragRotate&&h.dragRotate.enable();const J=(({enable:Ee,clickTolerance:me})=>{const De=new Cl({checkCorrectEvent:Be=>E.mouseButton(Be)===0&&!Be.ctrlKey});return new Ro({clickTolerance:me,move:(Be,He)=>({around:He,panDelta:He.sub(Be)}),activateOnStart:!0,moveStateManager:De,enable:Ee,assignEvents:El})})(i),oe=new cs(i,h);h.dragPan=new Oh(p,J,oe),this._add("mousePan",J),this._add("touchPan",oe,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&h.dragPan.enable(i.dragPan);const he=new ru,ge=new iu;h.touchZoomRotate=new su(p,ge,he,M),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",ge,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&h.touchZoomRotate.enable(i.touchZoomRotate);const ve=h.scrollZoom=new lo(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ve,["mousePan"]),i.interactive&&i.scrollZoom&&h.scrollZoom.enable(i.scrollZoom);const ke=h.keyboard=new Jr(h);this._add("keyboard",ke),i.interactive&&i.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new En(h))}_add(i,h,p){this._handlers.push({handlerName:i,handler:h,allowed:p}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yr(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,p){for(const m in i)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(i){const h=[];for(const p of i)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(i,h,p,m,y){if(!p)return;a.e(i,p);const I={handlerName:m,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(h.zoom=I),p.panDelta!==void 0&&(h.drag=I),p.pitchDelta!==void 0&&(h.pitch=I),p.bearingDelta!==void 0&&(h.rotate=I)}_applyChanges(){const i={},h={},p={};for(const[m,y,I]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(i.around=m.around),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),a.e(h,y),a.e(p,I);this._updateMapTransform(i,h,p),this._changes=[]}_updateMapTransform(i,h,p){const m=this._map,y=m._getTransformForUpdate(),I=m.terrain;if(!(Al(i)||I&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:L,zoomDelta:M,bearingDelta:R,pitchDelta:O,around:N,pinchAround:J}=i;J!==void 0&&(N=J),m._stop(!0),N=N||m.transform.centerPoint;const oe=y.pointLocation(L?N.sub(L):N);R&&(y.bearing+=R),O&&(y.pitch+=O),M&&(y.zoom+=M),I?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(L)):y.setLocationAtPoint(oe,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(oe,N)):y.setLocationAtPoint(oe,N),m._applyUpdatedTransform(y),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,p,!0)}_fireEvents(i,h,p){const m=Yr(this._eventsInProgress),y=Yr(i),I={};for(const N in i){const{originalEvent:J}=i[N];this._eventsInProgress[N]||(I[`${N}start`]=J),this._eventsInProgress[N]=i[N]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const N in I)this._fireEvent(N,I[N]);y&&this._fireEvent("move",y.originalEvent);for(const N in i){const{originalEvent:J}=i[N];this._fireEvent(N,J)}const L={};let M;for(const N in this._eventsInProgress){const{handlerName:J,originalEvent:oe}=this._eventsInProgress[N];this._handlersById[J].isActive()||(delete this._eventsInProgress[N],M=h[J]||oe,L[`${N}end`]=M)}for(const N in L)this._fireEvent(N,L[N]);const R=Yr(this._eventsInProgress),O=(m||y)&&!R;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();N.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(N)}if(p&&O){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=oe=>oe!==0&&-this._bearingSnap<oe&&oe<this._bearingSnap;!N||!N.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:M})),J(this._map.getBearing())&&this._map.resetNorth()):(J(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new a.k(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new zt("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class jh extends a.E{constructor(i,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}panBy(i,h,p){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,a.e({offset:i},h),p)}panTo(i,h,p){return this.easeTo(a.e({center:i},h),p)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,p){return this.easeTo(a.e({zoom:i},h),p)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,p){return this.easeTo(a.e({bearing:i},h),p)}resetNorth(i,h){return this.rotateTo(0,a.e({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}cameraForBounds(i,h){i=Te.convert(i).adjustAntiMeridian();const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,h)}_cameraForBoxAndBearing(i,h,p,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const kt=m.padding;m.padding={top:kt,bottom:kt,right:kt,left:kt}}m.padding=a.e(y,m.padding);const I=this.transform,L=I.padding,M=new Te(i,h),R=I.project(M.getNorthWest()),O=I.project(M.getNorthEast()),N=I.project(M.getSouthEast()),J=I.project(M.getSouthWest()),oe=a.ba(-p),he=R.rotate(oe),ge=O.rotate(oe),ve=N.rotate(oe),ke=J.rotate(oe),Ee=new a.P(Math.max(he.x,ge.x,ke.x,ve.x),Math.max(he.y,ge.y,ke.y,ve.y)),me=new a.P(Math.min(he.x,ge.x,ke.x,ve.x),Math.min(he.y,ge.y,ke.y,ve.y)),De=Ee.sub(me),Be=(I.width-(L.left+L.right+m.padding.left+m.padding.right))/De.x,He=(I.height-(L.top+L.bottom+m.padding.top+m.padding.bottom))/De.y;if(He<0||Be<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(I.scaleZoom(I.scale*Math.min(Be,He)),m.maxZoom),vt=a.P.convert(m.offset),It=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.ba(p)),At=vt.add(It).mult(I.scale/I.zoomScale(ot));return{center:I.unproject(R.add(N).div(2).sub(At)),zoom:ot,bearing:p}}fitBounds(i,h,p){return this._fitInternal(this.cameraForBounds(i,h),h,p)}fitScreenCoordinates(i,h,p,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(i)),this.transform.pointLocation(a.P.convert(h)),p,m),m,y)}_fitInternal(i,h,p){return i?(delete(h=a.e(i,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(i,h){this.stop();const p=this._getTransformForUpdate();let m=!1,y=!1,I=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(m=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=a.N.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(y=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(I=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),y&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),I&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(i,h,p,m=0){const y=a.Z.fromLngLat(i,h),I=a.Z.fromLngLat(p,m),L=I.x-y.x,M=I.y-y.y,R=I.z-y.z,O=Math.hypot(L,M,R);if(O===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(L,M),J=this.transform.scaleZoom(this.transform.cameraToCenterDistance/O/this.transform.tileSize),oe=180*Math.atan2(L,-M)/Math.PI;let he=180*Math.acos(N/O)/Math.PI;return he=R<0?90-he:90+he,{center:I.toLngLat(),zoom:J,pitch:he,bearing:oe}}easeTo(i,h){var p;this._stop(!1,i.easeId),((i=a.e({offset:[0,0],duration:500,easing:a.b9},i)).animate===!1||!i.essential&&S.prefersReducedMotion)&&(i.duration=0);const m=this._getTransformForUpdate(),y=m.zoom,I=m.bearing,L=m.pitch,M=m.padding,R="bearing"in i?this._normalizeBearing(i.bearing,I):I,O="pitch"in i?+i.pitch:L,N="padding"in i?i.padding:m.padding,J=a.P.convert(i.offset);let oe=m.centerPoint.add(J);const he=m.pointLocation(oe),{center:ge,zoom:ve}=m.getConstrained(a.N.convert(i.center||he),(p=i.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(ge,m);const ke=m.project(he),Ee=m.project(ge).sub(ke),me=m.zoomScale(ve-y);let De,Be;i.around&&(De=a.N.convert(i.around),Be=m.locationPoint(De));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==y,this._rotating=this._rotating||I!==R,this._pitching=this._pitching||O!==L,this._padding=!m.isPaddingEqual(N),this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,He),this.terrain&&this._prepareElevation(ge),this._ease(ot=>{if(this._zooming&&(m.zoom=a.y.number(y,ve,ot)),this._rotating&&(m.bearing=a.y.number(I,R,ot)),this._pitching&&(m.pitch=a.y.number(L,O,ot)),this._padding&&(m.interpolatePadding(M,N,ot),oe=m.centerPoint.add(J)),this.terrain&&!i.freezeElevation&&this._updateElevation(ot),De)m.setLocationAtPoint(De,Be);else{const vt=m.zoomScale(m.zoom-y),It=ve>y?Math.min(2,me):Math.max(.5,me),At=Math.pow(It,1-ot),kt=m.unproject(ke.add(Ee.mult(ot*At)).mult(vt));m.setLocationAtPoint(m.renderWorldCopies?kt.wrap():kt,oe)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},ot=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h,ot)},i),this}_prepareEase(i,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",i)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(p-(h-(p*i+this._elevationStart))/(1-i)),this._elevationTarget=h}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){const h=i.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(h.lngLat,i.zoom);if(h.altitude<p){const m=this.calculateCameraOptionsFromTo(h.lngLat,p,i.center,i.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(i){const h=[];if(this.terrain&&h.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&h.push(m=>this.transformCameraUpdate(m)),!h.length)return;const p=i.clone();for(const m of h){const y=p.clone(),{center:I,zoom:L,pitch:M,bearing:R,elevation:O}=m(y);I&&(y.center=I),L!==void 0&&(y.zoom=L),M!==void 0&&(y.pitch=M),R!==void 0&&(y.bearing=R),O!==void 0&&(y.elevation=O),p.apply(y)}this.transform.apply(p)}_fireMoveEvents(i){this.fire(new a.k("move",i)),this._zooming&&this.fire(new a.k("zoom",i)),this._rotating&&this.fire(new a.k("rotate",i)),this._pitching&&this.fire(new a.k("pitch",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",i)),m&&this.fire(new a.k("rotateend",i)),y&&this.fire(new a.k("pitchend",i)),this.fire(new a.k("moveend",i))}flyTo(i,h){var p;if(!i.essential&&S.prefersReducedMotion){const Lt=a.M(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,h)}this.stop(),i=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},i);const m=this._getTransformForUpdate(),y=m.zoom,I=m.bearing,L=m.pitch,M=m.padding,R="bearing"in i?this._normalizeBearing(i.bearing,I):I,O="pitch"in i?+i.pitch:L,N="padding"in i?i.padding:m.padding,J=a.P.convert(i.offset);let oe=m.centerPoint.add(J);const he=m.pointLocation(oe),{center:ge,zoom:ve}=m.getConstrained(a.N.convert(i.center||he),(p=i.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(ge,m);const ke=m.zoomScale(ve-y),Ee=m.project(he),me=m.project(ge).sub(Ee);let De=i.curve;const Be=Math.max(m.width,m.height),He=Be/ke,ot=me.mag();if("minZoom"in i){const Lt=a.ac(Math.min(i.minZoom,y,ve),m.minZoom,m.maxZoom),ti=Be/m.zoomScale(Lt-y);De=Math.sqrt(ti/ot*2)}const vt=De*De;function It(Lt){const ti=(He*He-Be*Be+(Lt?-1:1)*vt*vt*ot*ot)/(2*(Lt?He:Be)*vt*ot);return Math.log(Math.sqrt(ti*ti+1)-ti)}function At(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function kt(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const xt=It(!1);let Nt=function(Lt){return kt(xt)/kt(xt+De*Lt)},ri=function(Lt){return Be*((kt(xt)*(At(ti=xt+De*Lt)/kt(ti))-At(xt))/vt)/ot;var ti},St=(It(!0)-xt)/De;if(Math.abs(ot)<1e-6||!isFinite(St)){if(Math.abs(Be-He)<1e-6)return this.easeTo(i,h);const Lt=He<Be?-1:1;St=Math.abs(Math.log(He/Be))/De,ri=()=>0,Nt=ti=>Math.exp(Lt*De*ti)}return i.duration="duration"in i?+i.duration:1e3*St/("screenSpeed"in i?+i.screenSpeed/De:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=I!==R,this._pitching=O!==L,this._padding=!m.isPaddingEqual(N),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ge),this._ease(Lt=>{const ti=Lt*St,rn=1/Nt(ti);m.zoom=Lt===1?ve:y+m.scaleZoom(rn),this._rotating&&(m.bearing=a.y.number(I,R,Lt)),this._pitching&&(m.pitch=a.y.number(L,O,Lt)),this._padding&&(m.interpolatePadding(M,N,Lt),oe=m.centerPoint.add(J)),this.terrain&&!i.freezeElevation&&this._updateElevation(Lt);const fi=Lt===1?ge:m.unproject(Ee.add(me.mult(ri(ti))).mult(rn));m.setLocationAtPoint(m.renderWorldCopies?fi.wrap():fi,oe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,h)}return i||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(i,h,p){p.animate===!1||p.duration===0?(i(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,h){i=a.b3(i,-180,180);const p=Math.abs(i-h);return Math.abs(i-360-h)<p&&(i-=360),Math.abs(i+360-h)<p&&(i+=360),i}_normalizeCenter(i,h){if(!h.renderWorldCopies||h.lngRange)return;const p=i.lng-h.center.lng;i.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const Gs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ws{constructor(i=Gs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=E.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=E.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){E.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const p=this._map._getUIString(`AttributionControl.${h}`);i.title=p,i.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const y=h[m];if(y.used||y.usedForTerrain){const I=y.getSource();I.attribution&&i.indexOf(I.attribution)<0&&i.push(I.attribution)}}i=i.filter(m=>String(m).trim()),i.sort((m,y)=>m.length-y.length),i=i.filter((m,y)=>{for(let I=y+1;I<i.length;I++)if(i[I].indexOf(m)>=0)return!1;return!0});const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class lu{constructor(i={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=E.create("div","maplibregl-ctrl");const h=E.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){E.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Si{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===i)return void(m.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var cu=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class hf extends a.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,h){this.sourceCache.update(i,h),this._renderableTilesKeys=[];const p={};for(const m of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aP(m.posMatrix,0,a.X,0,a.X,0,1),this._tiles[m.key]=new Wr(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(i){for(const h in this._tiles){const p=this._tiles[h];(!i||p.tileID.equals(i)||p.tileID.isChildOf(i)||i.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16),a.aP(y.posMatrix,0,a.X,0,a.X,0,1),h[p]=y}else if(m.canonical.isChildOf(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const I=m.canonical.z-i.canonical.z,L=m.canonical.x-(m.canonical.x>>I<<I),M=m.canonical.y-(m.canonical.y>>I<<I),R=a.X>>I;a.aP(y.posMatrix,0,R,0,R,0,1),a.J(y.posMatrix,y.posMatrix,[-L*R,-M*R,0]),h[p]=y}else if(i.canonical.isChildOf(m.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const I=i.canonical.z-m.canonical.z,L=i.canonical.x-(i.canonical.x>>I<<I),M=i.canonical.y-(i.canonical.y>>I<<I),R=a.X>>I;a.aP(y.posMatrix,0,a.X,0,a.X,0,1),a.J(y.posMatrix,y.posMatrix,[L*R,M*R,0]),a.K(y.posMatrix,y.posMatrix,[1/2**I,1/2**I,0]),h[p]=y}}return h}getSourceTile(i,h){const p=this.sourceCache._source;let m=i.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!y||!y.dem)&&h)for(;m>=p.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(i.scaledTo(m--).key);return y}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=i)}}class uu{constructor(i,h,p){this.painter=i,this.sourceCache=new hf(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,h,p,m=a.X){var y;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const I=this.getTerrainData(i),L=(y=I.tile)===null||y===void 0?void 0:y.dem;if(!L)return 0;const M=function(he,ge,ve){var ke=ge[0],Ee=ge[1];return he[0]=ve[0]*ke+ve[4]*Ee+ve[12],he[1]=ve[1]*ke+ve[5]*Ee+ve[13],he}([],[h/m*a.X,p/m*a.X],I.u_terrain_matrix),R=[M[0]*L.dim,M[1]*L.dim],O=Math.floor(R[0]),N=Math.floor(R[1]),J=R[0]-O,oe=R[1]-N;return L.get(O,N)*(1-J)*(1-oe)+L.get(O+1,N)*J*(1-oe)+L.get(O,N+1)*(1-J)*oe+L.get(O+1,N+1)*J*oe}getElevationForLngLatZoom(i,h){if(!a.bb(h,i.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(i,h);return this.getElevation(p,m%a.X,y%a.X,a.X)}getElevation(i,h,p,m=a.X){return this.getDEMElevation(i,h,p,m)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const m=this.painter.context,y=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ce(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ce(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(i,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ce(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+i.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=i.canonical.z-h.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=m?y=i.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=i.canonical.x-(i.canonical.x>>y<<y),L=i.canonical.y-(i.canonical.y>>y<<y),M=a.bc(new Float64Array(16),[1/(a.X<<y),1/(a.X<<y),0]);a.J(M,M,[I*a.X,L*a.X,0]),this._demMatrixCache[i.key]={matrix:M,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(i){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ce(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ce(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,I=0;y<this._coordsTextureSize;y++)for(let L=0;L<this._coordsTextureSize;L++,I+=4)h[I+0]=255&L,h[I+1]=255&y,h[I+2]=L>>8<<4|y>>8,h[I+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new ce(i,p,i.gl.RGBA,{premultiply:!1});return m.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,y=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),L=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(y,L-I-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const M=h[0]+(h[2]>>4<<8),R=h[1]+((15&h[2])<<8),O=this.coordsIndex[255-h[3]],N=O&&this.sourceCache.getTileByID(O);if(!N)return null;const J=this._coordsTextureSize,oe=(1<<N.tileID.canonical.z)*J;return new a.Z((N.tileID.canonical.x*J+M)/oe+N.tileID.wrap,(N.tileID.canonical.y*J+R)/oe,this.getElevation(N.tileID,M,R,J))}depthAtPoint(i){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,h=new a.bd,p=new a.aY,m=this.meshSize,y=a.X/m,I=m*m;for(let N=0;N<=m;N++)for(let J=0;J<=m;J++)h.emplaceBack(J*y,N*y,0);for(let N=0;N<I;N+=m+1)for(let J=0;J<m;J++)p.emplaceBack(J+N,m+J+N+1,m+J+N+2),p.emplaceBack(J+N,m+J+N+2,J+N+1);const L=h.length,M=L+2*(m+1);for(const N of[0,1])for(let J=0;J<=m;J++)for(const oe of[0,1])h.emplaceBack(J*y,N*a.X,oe);for(let N=0;N<2*m;N+=2)p.emplaceBack(M+N,M+N+1,M+N+3),p.emplaceBack(M+N,M+N+3,M+N+2),p.emplaceBack(L+N,L+N+3,L+N+1),p.emplaceBack(L+N,L+N+2,L+N+3);const R=h.length,O=R+2*(m+1);for(const N of[0,1])for(let J=0;J<=m;J++)for(const oe of[0,1])h.emplaceBack(N*a.X,J*y,oe);for(let N=0;N<2*m;N+=2)p.emplaceBack(R+N,R+N+1,R+N+3),p.emplaceBack(R+N,R+N+3,R+N+2),p.emplaceBack(O+N,O+N+3,O+N+1),p.emplaceBack(O+N,O+N+2,O+N+3);return this._mesh=new wl(i.createVertexBuffer(h,cu.members),i.createIndexBuffer(p),a.a0.simpleSegment(0,0,h.length,p.length)),this._mesh}getMeshFrameDelta(i){return 2*Math.PI*a.be/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(i,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(i){const h=this.getTerrainData(i).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(i,h){const p=a.Z.fromLngLat(i.wrap()),m=(1<<h)*a.X,y=p.x*m,I=p.y*m,L=Math.floor(y/a.X),M=Math.floor(I/a.X);return{tileID:new a.S(h,0,h,L,M),mercatorX:y,mercatorY:I}}}class df{constructor(i,h,p){this._context=i,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ce(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:i,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>i.id!==h),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Hs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Uh{constructor(i,h){this.painter=i,this.terrain=h,this.pool=new df(i.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(p=>!i._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in i.sourceCaches){this._coordsDescendingInv[p]={};const m=i.sourceCaches[p].getVisibleCoordinates();for(const y of m){const I=this.terrain.sourceCache.getTerrainCoords(y);for(const L in I)this._coordsDescendingInv[p][L]||(this._coordsDescendingInv[p][L]=[]),this._coordsDescendingInv[p][L].push(I[L])}}this._coordsDescendingInvStr={};for(const p of i._order){const m=i._layers[p],y=m.source;if(Hs[m.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const I in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][I]=this._coordsDescendingInv[y][I].map(L=>L.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[m][p.tileID.key];y&&y!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const h=i.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Hs[h]&&(this._prevType&&Hs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(i.id),!m))return!0;if(Hs[this._prevType]||Hs[h]&&m){this._prevType=h;const y=this._stacks.length-1,I=this._stacks[y]||[];for(const L of this._renderableTiles){if(this.pool.isFull()&&(zh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(L),L.rtt[y]){const R=this.pool.getObjectForId(L.rtt[y].id);if(R.stamp===L.rtt[y].stamp){this.pool.useObject(R);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),L.rtt[y]={id:M.id,stamp:M.stamp},p.context.bindFramebuffer.set(M.fbo.framebuffer),p.context.clear({color:a.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let R=0;R<I.length;R++){const O=p.style._layers[I[R]],N=O.source?this._coordsDescendingInv[O.source][L.tileID.key]:[L.tileID];p.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),p._renderTileClippingMasks(O,N),p.renderLayer(p,p.style.sourceCaches[O.source],O,N),O.source&&(L.rttCoords[O.source]=this._coordsDescendingInvStr[O.source][L.tileID.key])}}return zh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Hs[h]}return!1}}const hu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$h=g,ff={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Gs,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},du=b=>{b.touchstart=b.dragStart,b.touchmoveWindow=b.dragMove,b.touchend=b.dragEnd},pf={showCompass:!0,showZoom:!0,visualizePitch:!1};class mf{constructor(i,h,p=!1){this.mousedown=I=>{this.startMouse(a.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),E.mousePos(this.element,I)),E.addEventListener(window,"mousemove",this.mousemove),E.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,E.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=E.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),E.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=E.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=i.dragRotate._mouseRotate.getClickTolerance(),y=i.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Qc({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:L,bearingDegreesPerPixelMoved:M=.8})=>{const R=new Yc;return new Ro({clickTolerance:L,move:(O,N)=>({bearingDelta:(N.x-O.x)*M}),moveStateManager:R,enable:I,assignEvents:du})})({clickTolerance:m,enable:!0}),this.map=i,p&&(this.mousePitch=eu({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:L,pitchDegreesPerPixelMoved:M=-.5})=>{const R=new Yc;return new Ro({clickTolerance:L,move:(O,N)=>({pitchDelta:(N.y-O.y)*M}),moveStateManager:R,enable:I,assignEvents:du})})({clickTolerance:y,enable:!0})),E.addEventListener(h,"mousedown",this.mousedown),E.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),E.addEventListener(h,"touchcancel",this.reset)}startMouse(i,h){this.mouseRotate.dragStart(i,h),this.mousePitch&&this.mousePitch.dragStart(i,h),E.disableDrag()}startTouch(i,h){this.touchRotate.dragStart(i,h),this.touchPitch&&this.touchPitch.dragStart(i,h),E.disableDrag()}moveMouse(i,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(i,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(i,h)||{};y&&p.setPitch(p.getPitch()+y)}}moveTouch(i,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(i,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(i,h)||{};y&&p.setPitch(p.getPitch()+y)}}off(){const i=this.element;E.removeEventListener(i,"mousedown",this.mousedown),E.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend),E.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){E.enableDrag(),E.removeEventListener(window,"mousemove",this.mousemove),E.removeEventListener(window,"mouseup",this.mouseup),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend)}}let Ur;function nn(b,i,h){const p=new a.N(b.lng,b.lat);if(b=new a.N(b.lng,b.lat),i){const m=new a.N(b.lng-360,b.lat),y=new a.N(b.lng+360,b.lat),I=h.locationPoint(b).distSqr(i);h.locationPoint(m).distSqr(i)<I?b=m:h.locationPoint(y).distSqr(i)<I&&(b=y)}for(;Math.abs(b.lng-h.center.lng)>180;){const m=h.locationPoint(b);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;b.lng>h.center.lng?b.lng-=360:b.lng+=360}return b.lng!==p.lng&&h.locationPoint(b).y>h.height/2-h.getHorizon()?b:p}const Xs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pl(b,i,h){const p=b.classList;for(const m in Xs)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${i}`)}class zl extends a.E{constructor(i){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?nn(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),E.setTransform(this._element,`${Xs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${y}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=E.create("div");const h=E.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const y=E.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const I=E.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const L=E.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ke of M){const Ee=E.createNS("http://www.w3.org/2000/svg","ellipse");Ee.setAttributeNS(null,"opacity","0.04"),Ee.setAttributeNS(null,"cx","10.5"),Ee.setAttributeNS(null,"cy","5.80029008"),Ee.setAttributeNS(null,"rx",ke.rx),Ee.setAttributeNS(null,"ry",ke.ry),L.appendChild(Ee)}const R=E.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const O=E.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(O);const N=E.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const J=E.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(J);const oe=E.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),oe.setAttributeNS(null,"fill","#FFFFFF");const he=E.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=E.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const ve=E.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#FFFFFF"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962"),he.appendChild(ge),he.appendChild(ve),I.appendChild(L),I.appendChild(R),I.appendChild(N),I.appendChild(oe),I.appendChild(he),h.appendChild(I),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Pl(this._element,this._anchor,"marker"),i&&i.className)for(const h of i.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),E.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.N.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,y=m.terrain.depthAtPoint(this._pos),I=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,I)-y<.006)return void(this._element.style.opacity=this._opacity);const L=-this._offset.y/m.transform._pixelPerMeter,M=Math.sin(m.getPitch()*Math.PI/180)*L,R=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),O=m.transform.lngLatToCameraDepth(this._lngLat,I+M)-R>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,h){return i===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Vh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Na=0,ja=!1;const ko={maxWidth:100,unit:"metric"};function Ua(b,i,h){const p=h&&h.maxWidth||100,m=b._container.clientHeight/2,y=b.unproject([0,m]),I=b.unproject([p,m]),L=y.distanceTo(I);if(h&&h.unit==="imperial"){const M=3.2808*L;M>5280?Ot(i,p,M/5280,b._getUIString("ScaleControl.Miles")):Ot(i,p,M,b._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ot(i,p,L/1852,b._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Ot(i,p,L/1e3,b._getUIString("ScaleControl.Kilometers")):Ot(i,p,L,b._getUIString("ScaleControl.Meters"))}function Ot(b,i,h,p){const m=function(y){const I=Math.pow(10,`${Math.floor(y)}`.length-1);let L=y/I;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(M){const R=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*R)/R}(L),I*L}(h);b.style.width=i*(m/h)+"px",b.innerHTML=`${m}&nbsp;${p}`}const Yt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Dl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Rl(b){if(b){if(typeof b=="number"){const i=Math.round(Math.abs(b)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,b),"top-left":new a.P(i,i),"top-right":new a.P(-i,i),bottom:new a.P(0,-b),"bottom-left":new a.P(i,-i),"bottom-right":new a.P(-i,-i),left:new a.P(b,0),right:new a.P(-b,0)}}if(b instanceof a.P||Array.isArray(b)){const i=a.P.convert(b);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:a.P.convert(b.center||[0,0]),top:a.P.convert(b.top||[0,0]),"top-left":a.P.convert(b["top-left"]||[0,0]),"top-right":a.P.convert(b["top-right"]||[0,0]),bottom:a.P.convert(b.bottom||[0,0]),"bottom-left":a.P.convert(b["bottom-left"]||[0,0]),"bottom-right":a.P.convert(b["bottom-right"]||[0,0]),left:a.P.convert(b.left||[0,0]),right:a.P.convert(b.right||[0,0])}}return Rl(new a.P(0,0))}const fu=g;d.AJAXError=a.bh,d.Evented=a.E,d.LngLat=a.N,d.MercatorCoordinate=a.Z,d.Point=a.P,d.addProtocol=a.bi,d.config=a.a,d.removeProtocol=a.bj,d.AttributionControl=Ws,d.BoxZoomHandler=jr,d.CanvasSource=_i,d.CooperativeGesturesHandler=Zs,d.DoubleClickZoomHandler=us,d.DragPanHandler=Oh,d.DragRotateHandler=Nh,d.EdgeInsets=Us,d.FullscreenControl=class extends a.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var i;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=h==null?void 0:h.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){E.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=E.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);E.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Xt,d.GeolocateControl=class extends a.E{constructor(b){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const h=new a.N(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,m=this._map.getBearing(),y=a.e({bearing:m},this.options.fitBoundsOptions),I=Te.fromLngLat(h,p);this._map.fitBounds(I,y,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const h=new a.N(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&ja)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=E.create("button","maplibregl-ctrl-geolocate",this._container),E.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new zl({element:this._dotElement}),this._circleElement=E.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},Vh,b)}onAdd(b){return this._map=b,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(i=!1){if(Ur!==void 0&&!i)return Ur;if(window.navigator.permissions===void 0)return Ur=!!window.navigator.geolocation,Ur;try{Ur=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ur=!!window.navigator.geolocation}return Ur})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),E.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Na=0,ja=!1}_isOutOfMapMaxBounds(b){const i=this._map.getMaxBounds(),h=b.coords;return i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),i=b.getSouthEast(),h=b.getNorthEast(),p=i.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Na--,ja=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Na++,Na>1?(b={maximumAge:6e5,timeout:0},ja=!0):(b=this.options.positionOptions,ja=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=kl,d.ImageSource=ji,d.KeyboardHandler=Jr,d.LngLatBounds=Te,d.LogoControl=lu,d.Map=class extends jh{constructor(b){a.bf.mark(a.bg.create);const i=Object.assign(Object.assign({},ff),b);if(i.minZoom!=null&&i.maxZoom!=null&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(i.minPitch!=null&&i.maxPitch!=null&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(i.minPitch!=null&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(i.maxPitch!=null&&i.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new $s(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies),{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Si,this._controls=[],this._mapId=a.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=i.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=i.preserveDrawingBuffer===!0,this._antialias=i.antialias===!0,this._trackResize=i.trackResize===!0,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=i.refreshExpiredTiles===!0,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=i.crossSourceCollisions===!0,this._collectResourceTiming=i.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},hu),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this.transformCameraUpdate=i.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=i.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=X.addThrottleControl(()=>this.isMoving()),this._requestManager=new le(i.transformRequest),typeof i.container=="string"){if(this._container=document.getElementById(i.container),!this._container)throw new Error(`Container '${i.container}' not found.`)}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const p=Da(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{h?p(m):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new au(this,i),this._hash=i.hash&&new kl(typeof i.hash=="string"&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,a.e({},i.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new Ws(typeof i.attributionControl=="boolean"?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new lu,i.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new a.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new a.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new a.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(b,i){if(i===void 0&&(i=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=b.onAdd(this);this._controls.push(b);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(b);return i>-1&&this._controls.splice(i,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}calculateCameraOptionsFromTo(b,i,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,i,h,p)}resize(b){var i;const h=this._containerDimensions(),p=h[0],m=h[1],y=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,y),this.painter.resize(p,m,y),this.painter.overLimit()){const L=this.painter.context.gl;this._maxCanvasSize=[L.drawingBufferWidth,L.drawingBufferHeight];const M=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,M),this.painter.resize(p,m,M)}this.transform.resize(p,m),(i=this._requestedCameraState)===null||i===void 0||i.resize(p,m);const I=!this._moving;return I&&(this.stop(),this.fire(new a.k("movestart",b)).fire(new a.k("move",b))),this.fire(new a.k("resize",b)),I&&this.fire(new a.k("moveend",b)),this}_getClampedPixelRatio(b,i){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),y=b*m,I=i*m;return Math.min(y>h?h/y:1,I>p?p/I:1)*m}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(Te.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(a.N.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.pointLocation(a.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,i,h){if(b==="mouseenter"||b==="mouseover"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:y=>{const I=i.filter(M=>this.getLayer(M)),L=I.length!==0?this.queryRenderedFeatures(y.point,{layers:I}):[];L.length?p||(p=!0,h.call(this,new ir(b,this,y.originalEvent,{features:L}))):p=!1},mouseout:()=>{p=!1}}}}if(b==="mouseleave"||b==="mouseout"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:I=>{const L=i.filter(M=>this.getLayer(M));(L.length!==0?this.queryRenderedFeatures(I.point,{layers:L}):[]).length?p=!0:p&&(p=!1,h.call(this,new ir(b,this,I.originalEvent)))},mouseout:I=>{p&&(p=!1,h.call(this,new ir(b,this,I.originalEvent)))}}}}{const p=m=>{const y=i.filter(L=>this.getLayer(L)),I=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];I.length&&(m.features=I,h.call(this,m),delete m.features)};return{layers:i,listener:h,delegates:{[b]:p}}}}_saveDelegatedListener(b,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(i)}_removeDelegatedListener(b,i,h){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const p=this._delegatedListeners[b];for(let m=0;m<p.length;m++){const y=p[m];if(y.listener===h&&y.layers.length===i.length&&y.layers.every(I=>i.includes(I))){for(const I in y.delegates)this.off(I,y.delegates[I]);return void p.splice(m,1)}}}on(b,i,h){if(h===void 0)return super.on(b,i);const p=this._createDelegatedListener(b,typeof i=="string"?[i]:i,h);this._saveDelegatedListener(b,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(b,i,h){if(h===void 0)return super.once(b,i);const p=typeof i=="string"?[i]:i,m=this._createDelegatedListener(b,p,h);for(const y in m.delegates){const I=m.delegates[y];m.delegates[y]=(...L)=>{this._removeDelegatedListener(b,p,h),I(...L)}}this._saveDelegatedListener(b,m);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(b,i,h){return h===void 0?super.off(b,i):(this._removeDelegatedListener(b,typeof i=="string"?[i]:i,h),this)}queryRenderedFeatures(b,i){if(!this.style)return[];let h;const p=b instanceof a.P||Array.isArray(b),m=p?b:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(p?{}:b)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const y=a.P.convert(m[0]),I=a.P.convert(m[1]);h=[y,new a.P(I.x,y.y),I,new a.P(y.x,I.y),y]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(b,i){return this.style.querySourceFeatures(b,i)}setStyle(b,i){return(i=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(b,i))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const i=this._locale[b];if(i==null)throw new Error(`Missing UI string '${b}'`);return i}_updateStyle(b,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(b,i));const h=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new sl(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,i,h):this.style.loadJSON(b,i,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new sl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,i){if(typeof b=="string"){const h=this._requestManager.transformRequest(b,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,i)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof b=="object"&&this._updateDiff(b,i)}_updateDiff(b,i){try{this.style.setState(b,i)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(b,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(b,i){return this._lazyInitEmptyStyle(),this.style.addSource(b,i),this._update(!0)}isSourceLoaded(b){const i=this.style&&this.style.sourceCaches[b];if(i!==void 0)return i.loaded();this.fire(new a.j(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const i=this.style.sourceCaches[b.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&i.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===b.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new uu(this.painter,i,b),this.painter.renderToTexture=new Uh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==b.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:b})),this}getTerrain(){var b,i;return(i=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const i in b){const h=b[i]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,i,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:y,stretchY:I,content:L,textFitWidth:M,textFitHeight:R}=h;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||a.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:N,data:J}=i,oe=i;return this.style.addImage(b,{data:new a.R({width:O,height:N},new Uint8Array(J)),pixelRatio:p,stretchX:y,stretchY:I,content:L,textFitWidth:M,textFitHeight:R,sdf:m,version:0,userImage:oe}),oe.onAdd&&oe.onAdd(this,b),this}}{const{width:O,height:N,data:J}=S.getImageData(i);this.style.addImage(b,{data:new a.R({width:O,height:N},J),pixelRatio:p,stretchX:y,stretchY:I,content:L,textFitWidth:M,textFitHeight:R,sdf:m,version:0})}}updateImage(b,i){const h=this.style.getImage(b);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||a.b(i)?S.getImageData(i):i,{width:m,height:y,data:I}=p;if(m===void 0||y===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||y!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const L=!(i instanceof HTMLImageElement||a.b(i));return h.data.replace(I,L),this.style.updateImage(b,h),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return X.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,i){return this._lazyInitEmptyStyle(),this.style.addLayer(b,i),this._update(!0)}moveLayer(b,i){return this.style.moveLayer(b,i),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,i,h){return this.style.setLayerZoomRange(b,i,h),this._update(!0)}setFilter(b,i,h={}){return this.style.setFilter(b,i,h),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,i,h,p={}){return this.style.setPaintProperty(b,i,h,p),this._update(!0)}getPaintProperty(b,i){return this.style.getPaintProperty(b,i)}setLayoutProperty(b,i,h,p={}){return this.style.setLayoutProperty(b,i,h,p),this._update(!0)}getLayoutProperty(b,i){return this.style.getLayoutProperty(b,i)}setGlyphs(b,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,i,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,i,h,p=>{p||this._update(!0)}),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,i,h=>{h||this._update(!0)}),this}setLight(b,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(b){return this._lazyInitEmptyStyle(),this.style.setSky(b),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,i){return this.style.setFeatureState(b,i),this._update()}removeFeatureState(b,i){return this.style.removeFeatureState(b,i),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,i=0;return this._container&&(b=this._container.clientWidth||400,i=this._container.clientHeight||300),[b,i]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const i=this._canvasContainer=E.create("div","maplibregl-canvas-container",b);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=E.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=E.create("div","maplibregl-control-container",b),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{y[I]=E.create("div",`maplibregl-ctrl-${I} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,i,h){this._canvas.width=Math.floor(h*b),this._canvas.height=Math.floor(h*i),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const b={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{i={requestedAttributes:b},p&&(i.statusMessage=p.statusMessage,i.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b);if(!h){const p="Failed to initialize WebGL";throw i?(i.message=p,new Error(JSON.stringify(i))):new Error(p)}this.painter=new xl(h,this.transform),P.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,y=S.now();this.style.zoomHistory.update(m,y);const I=new a.z(m,{now:y,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=I.crossFadingFactor();L===1&&L===this._crossFadingFactor||(h=!0,this._crossFadingFactor=L),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),X.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),E.remove(this._canvasContainer),E.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(b=>{a.bf.frame(b),this._frameRequest=null,this._render(b)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return $h}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=ir,d.MapTouchEvent=ls,d.MapWheelEvent=Rh,d.Marker=zl,d.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const i=this._map.getZoom(),h=i===this._map.getMaxZoom(),p=i===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);i.title=p,i.setAttribute("aria-label",p)},this.options=a.e({},pf,b),this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),E.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),E.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=E.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){E.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,i){const h=E.create("button",b,this._container);return h.type="button",h.addEventListener("click",i),h}},d.Popup=class extends a.E{constructor(b){super(),this.remove=()=>(this._content&&E.remove(this._content),this._container&&(E.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=E.create("div","maplibregl-popup",this._map.getContainer()),this._tip=E.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const L of this.options.className.split(" "))this._container.classList.add(L);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?nn(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!i)return;const p=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const y=Rl(this.options.offset);if(!m){const L=this._container.offsetWidth,M=this._container.offsetHeight;let R;R=p.y+y.bottom.y<M?["top"]:p.y>this._map.transform.height-M?["bottom"]:[],p.x<L/2?R.push("left"):p.x>this._map.transform.width-L/2&&R.push("right"),m=R.length===0?"bottom":R.join("-")}let I=p.add(y[m]);this.options.subpixelPositioning||(I=I.round()),E.setTransform(this._container,`${Xs[m]} translate(${I.x}px,${I.y}px)`),Pl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Yt),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=a.N.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const i=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=b;p=h.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=E.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=E.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(Dl);b&&b.focus()}},d.RasterDEMTileSource=nt,d.RasterTileSource=Ce,d.ScaleControl=class{constructor(b){this._onMove=()=>{Ua(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,Ua(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ko),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){E.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=lo,d.Style=sl,d.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=E.create("button","maplibregl-ctrl-terrain",this._container),E.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){E.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=qs,d.TwoFingersTouchRotateHandler=ru,d.TwoFingersTouchZoomHandler=iu,d.TwoFingersTouchZoomRotateHandler=su,d.VectorTileSource=gt,d.VideoSource=Ci,d.addSourceType=(b,i)=>a._(void 0,void 0,void 0,function*(){if(br(b))throw new Error(`A source type called "${b}" already exists.`);((h,p)=>{Bi[h]=p})(b,i)}),d.clearPrewarmedResources=function(){const b=li;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(Bt),li=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return qn().getRTLTextPluginStatus()},d.getVersion=function(){return fu},d.getWorkerCount=function(){return Dt.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(b){return bi().broadcast("IS",b)},d.prewarm=function(){ki().acquire(Bt)},d.setMaxParallelImageRequests=function(b){a.a.MAX_PARALLEL_IMAGE_REQUESTS=b},d.setRTLTextPlugin=function(b,i){return qn().setRTLTextPlugin(b,i)},d.setWorkerCount=function(b){Dt.workerCount=b},d.setWorkerUrl=function(b){a.a.WORKER_URL=b}});var u=t;return u})})(X0);var Up=X0.exports;const Pr=Jv(Up),Yv=Fv({__proto__:null,default:Pr},[Up]);var Qv=Object.defineProperty,J0=r=>{throw TypeError(r)},ew=(r,e,t)=>e in r?Qv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,go=(r,e,t)=>ew(r,typeof e!="symbol"?e+"":e,t),Y0=(r,e,t)=>e.has(r)||J0("Cannot "+t),Qn=(r,e,t)=>(Y0(r,e,"read from private field"),t?t.call(r):e.get(r)),V_=(r,e,t)=>e.has(r)?J0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),q_=(r,e,t,o)=>(Y0(r,e,"write to private field"),o?o.call(r,t):e.set(r,t),t);function kn(){}function tw(r,e){for(const t in e)r[t]=e[t];return r}function Q0(r){return r()}function Z_(){return Object.create(null)}function Cs(r){r.forEach(Q0)}function e1(r){return typeof r=="function"}function va(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let pd;function Rr(r,e){return r===e?!0:(pd||(pd=document.createElement("a")),pd.href=e,r===pd.href)}function iw(r){return Object.keys(r).length===0}function nw(r,e,t,o){if(r){const l=t1(r,e,t,o);return r[0](l)}}function t1(r,e,t,o){return r[1]&&o?tw(t.ctx.slice(),r[1](o(e))):t.ctx}function rw(r,e,t,o){if(r[2]&&o){const l=r[2](o(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function ow(r,e,t,o,l,u){if(l){const d=t1(e,t,o,u);r.p(d,l)}}function sw(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let o=0;o<t;o++)e[o]=-1;return e}return-1}function G_(r){return r??""}function Ni(r,e){r.appendChild(e)}function Mn(r,e,t){r.insertBefore(e,t||null)}function Sn(r){r.parentNode&&r.parentNode.removeChild(r)}function ln(r){return document.createElement(r)}function Vo(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function ma(r){return document.createTextNode(r)}function bo(){return ma(" ")}function aw(){return ma("")}function Gr(r,e,t,o){return r.addEventListener(e,t,o),()=>r.removeEventListener(e,t,o)}function lw(r){return function(e){return e.preventDefault(),r.call(this,e)}}function ht(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function cw(r){return Array.from(r.childNodes)}function eh(r,e){e=""+e,r.data!==e&&(r.data=e)}function W_(r,e){r.value=e??""}function Ao(r,e,t){r.classList.toggle(e,!!t)}function uw(r,e,{bubbles:t=!1,cancelable:o=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:o})}let th;function Wu(r){th=r}function i1(){if(!th)throw new Error("Function called outside component initialization");return th}function hw(r){i1().$$.on_destroy.push(r)}function dw(){const r=i1();return(e,t,{cancelable:o=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=uw(e,t,{cancelable:o});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function H_(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(o=>o.call(this,e))}const sc=[],yp=[];let hc=[];const X_=[],fw=Promise.resolve();let bp=!1;function pw(){bp||(bp=!0,fw.then(n1))}function vp(r){hc.push(r)}const ap=new Set;let ec=0;function n1(){if(ec!==0)return;const r=th;do{try{for(;ec<sc.length;){const e=sc[ec];ec++,Wu(e),mw(e.$$)}}catch(e){throw sc.length=0,ec=0,e}for(Wu(null),sc.length=0,ec=0;yp.length;)yp.pop()();for(let e=0;e<hc.length;e+=1){const t=hc[e];ap.has(t)||(ap.add(t),t())}hc.length=0}while(sc.length);for(;X_.length;)X_.pop()();bp=!1,ap.clear(),Wu(r)}function mw(r){if(r.fragment!==null){r.update(),Cs(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(vp)}}function _w(r){const e=[],t=[];hc.forEach(o=>r.indexOf(o)===-1?e.push(o):t.push(o)),t.forEach(o=>o()),hc=e}const wd=new Set;let Qa;function xd(){Qa={r:0,c:[],p:Qa}}function kd(){Qa.r||Cs(Qa.c),Qa=Qa.p}function Un(r,e){r&&r.i&&(wd.delete(r),r.i(e))}function ur(r,e,t,o){if(r&&r.o){if(wd.has(r))return;wd.add(r),Qa.c.push(()=>{wd.delete(r),o&&(t&&r.d(1),o())}),r.o(e)}else o&&o()}function K_(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function gw(r,e){ur(r,1,1,()=>{e.delete(r.key)})}function yw(r,e,t,o,l,u,d,a,g,v,k,S){let E=r.length,P=u.length,z=E;const V={};for(;z--;)V[r[z].key]=z;const $=[],H=new Map,G=new Map,X=[];for(z=P;z--;){const Y=S(l,u,z),K=t(Y);let ue=d.get(K);ue?X.push(()=>ue.p(Y,e)):(ue=v(K,Y),ue.c()),H.set(K,$[z]=ue),K in V&&G.set(K,Math.abs(z-V[K]))}const le=new Set,xe=new Set;function Ie(Y){Un(Y,1),Y.m(a,k),d.set(Y.key,Y),k=Y.first,P--}for(;E&&P;){const Y=$[P-1],K=r[E-1],ue=Y.key,fe=K.key;Y===K?(k=Y.first,E--,P--):H.has(fe)?!d.has(ue)||le.has(ue)?Ie(Y):xe.has(fe)?E--:G.get(ue)>G.get(fe)?(xe.add(ue),Ie(Y)):(le.add(fe),E--):(g(K,d),E--)}for(;E--;){const Y=r[E];H.has(Y.key)||g(Y,d)}for(;P;)Ie($[P-1]);return Cs(X),$}function _a(r){r&&r.c()}function Ts(r,e,t){const{fragment:o,after_update:l}=r.$$;o&&o.m(e,t),vp(()=>{const u=r.$$.on_mount.map(Q0).filter(e1);r.$$.on_destroy?r.$$.on_destroy.push(...u):Cs(u),r.$$.on_mount=[]}),l.forEach(vp)}function Is(r,e){const t=r.$$;t.fragment!==null&&(_w(t.after_update),Cs(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function bw(r,e){r.$$.dirty[0]===-1&&(sc.push(r),pw(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function wa(r,e,t,o,l,u,d=null,a=[-1]){const g=th;Wu(r);const v=r.$$={fragment:null,ctx:[],props:u,update:kn,not_equal:l,bound:Z_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:Z_(),dirty:a,skip_bound:!1,root:e.target||g.$$.root};d&&d(v.root);let k=!1;if(v.ctx=t?t(r,e.props||{},(S,E,...P)=>{const z=P.length?P[0]:E;return v.ctx&&l(v.ctx[S],v.ctx[S]=z)&&(!v.skip_bound&&v.bound[S]&&v.bound[S](z),k&&bw(r,S)),E}):[],v.update(),k=!0,Cs(v.before_update),v.fragment=o?o(v.ctx):!1,e.target){if(e.hydrate){const S=cw(e.target);v.fragment&&v.fragment.l(S),S.forEach(Sn)}else v.fragment&&v.fragment.c();e.intro&&Un(r.$$.fragment),Ts(r,e.target,e.anchor),n1()}Wu(g)}class xa{constructor(){go(this,"$$"),go(this,"$$set")}$destroy(){Is(this,1),this.$destroy=kn}$on(e,t){if(!e1(t))return kn;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(t),()=>{const l=o.indexOf(t);l!==-1&&o.splice(l,1)}}$set(e){this.$$set&&!iw(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const vw="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(vw);function ww(r){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ht(e,"viewBox","0 0 14 14"),ht(e,"width","13"),ht(e,"height","13"),ht(e,"class","svelte-en2qvf")},m(o,l){Mn(o,e,l),Ni(e,t)},p:kn,i:kn,o:kn,d(o){o&&Sn(e)}}}class r1 extends xa{constructor(e){super(),wa(this,e,null,ww,va,{})}}function xw(r){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ht(e,"viewBox","0 0 30 30"),ht(e,"fill","none"),ht(e,"xmlns","http://www.w3.org/2000/svg"),ht(e,"class","svelte-d2loi5")},m(o,l){Mn(o,e,l),Ni(e,t)},p:kn,i:kn,o:kn,d(o){o&&Sn(e)}}}class o1 extends xa{constructor(e){super(),wa(this,e,null,xw,va,{})}}function kw(r){let e,t;return{c(){e=ln("img"),Rr(e.src,t=r[3]+"area.svg")||ht(e,"src",t),ht(e,"alt",r[6]),ht(e,"class","svelte-ltkwvy")},m(o,l){Mn(o,e,l)},p(o,l){l&8&&!Rr(e.src,t=o[3]+"area.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",o[6])},d(o){o&&Sn(e)}}}function Sw(r){let e,t;return{c(){e=ln("img"),Rr(e.src,t=r[3]+"reverse.svg")||ht(e,"src",t),ht(e,"alt",r[6]),ht(e,"class","svelte-ltkwvy")},m(o,l){Mn(o,e,l)},p(o,l){l&8&&!Rr(e.src,t=o[3]+"reverse.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",o[6])},d(o){o&&Sn(e)}}}function Tw(r){let e,t;return{c(){e=ln("img"),Rr(e.src,t=r[3]+"poi.svg")||ht(e,"src",t),ht(e,"alt",r[6]),ht(e,"class","svelte-ltkwvy")},m(o,l){Mn(o,e,l)},p(o,l){l&8&&!Rr(e.src,t=o[3]+"poi.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",o[6])},d(o){o&&Sn(e)}}}function Iw(r){let e,t;return{c(){e=ln("img"),Rr(e.src,t=r[3]+"postal_code.svg")||ht(e,"src",t),ht(e,"alt",r[6]),ht(e,"class","svelte-ltkwvy")},m(o,l){Mn(o,e,l)},p(o,l){l&8&&!Rr(e.src,t=o[3]+"postal_code.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",o[6])},d(o){o&&Sn(e)}}}function Cw(r){let e,t;return{c(){e=ln("img"),Rr(e.src,t=r[3]+"street.svg")||ht(e,"src",t),ht(e,"alt",r[6]),ht(e,"class","svelte-ltkwvy")},m(o,l){Mn(o,e,l)},p(o,l){l&8&&!Rr(e.src,t=o[3]+"street.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",o[6])},d(o){o&&Sn(e)}}}function Ew(r){let e,t;return{c(){e=ln("img"),Rr(e.src,t=r[3]+"road.svg")||ht(e,"src",t),ht(e,"alt",r[6]),ht(e,"class","svelte-ltkwvy")},m(o,l){Mn(o,e,l)},p(o,l){l&8&&!Rr(e.src,t=o[3]+"road.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",o[6])},d(o){o&&Sn(e)}}}function Lw(r){let e,t;return{c(){e=ln("img"),Rr(e.src,t=r[3]+"housenumber.svg")||ht(e,"src",t),ht(e,"alt",r[6]),ht(e,"class","svelte-ltkwvy")},m(o,l){Mn(o,e,l)},p(o,l){l&8&&!Rr(e.src,t=o[3]+"housenumber.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",o[6])},d(o){o&&Sn(e)}}}function Mw(r){let e,t,o,l;return{c(){e=ln("img"),Rr(e.src,t=r[5])||ht(e,"src",t),ht(e,"alt",r[4]),ht(e,"class","svelte-ltkwvy")},m(u,d){Mn(u,e,d),o||(l=Gr(e,"error",r[14]),o=!0)},p(u,d){d&32&&!Rr(e.src,t=u[5])&&ht(e,"src",t),d&16&&ht(e,"alt",u[4])},d(u){u&&Sn(e),o=!1,l()}}}function J_(r){let e,t;return{c(){e=ln("span"),t=ma(r[6]),ht(e,"class","secondary svelte-ltkwvy")},m(o,l){Mn(o,e,l),Ni(e,t)},p(o,l){l&64&&eh(t,o[6])},d(o){o&&Sn(e)}}}function Aw(r){let e,t,o,l,u,d,a,g,v,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,E,P=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],z,V,$=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",H,G,X;function le(K,ue){return ue&1&&(t=null),ue&1&&(o=null),ue&1&&(l=null),ue&1&&(u=null),K[5]?Mw:K[0].address?Lw:(t==null&&(t=!!K[0].id.startsWith("road.")),t?Ew:(o==null&&(o=!!K[0].id.startsWith("address.")),o?Cw:(l==null&&(l=!!K[0].id.startsWith("postal_code.")),l?Iw:(u==null&&(u=!!K[0].id.startsWith("poi.")),u?Tw:K[7]?Sw:kw))))}let xe=le(r,-1),Ie=xe(r),Y=P&&J_(r);return{c(){e=ln("li"),Ie.c(),d=bo(),a=ln("span"),g=ln("span"),v=ln("span"),S=ma(k),E=bo(),Y&&Y.c(),z=bo(),V=ln("span"),H=ma($),ht(v,"class","primary svelte-ltkwvy"),ht(g,"class","svelte-ltkwvy"),ht(V,"class","line2 svelte-ltkwvy"),ht(a,"class","texts svelte-ltkwvy"),ht(e,"tabindex","0"),ht(e,"data-selected",r[1]),ht(e,"class","svelte-ltkwvy"),Ao(e,"selected",r[1])},m(K,ue){Mn(K,e,ue),Ie.m(e,null),Ni(e,d),Ni(e,a),Ni(a,g),Ni(g,v),Ni(v,S),Ni(g,E),Y&&Y.m(g,null),Ni(a,z),Ni(a,V),Ni(V,H),G||(X=[Gr(e,"mouseenter",r[12]),Gr(e,"focus",r[13])],G=!0)},p(K,[ue]){xe===(xe=le(K,ue))&&Ie?Ie.p(K,ue):(Ie.d(1),Ie=xe(K),Ie&&(Ie.c(),Ie.m(e,d))),ue&1&&k!==(k=(K[7]?K[0].place_name:K[0].place_name.replace(/,.*/,""))+"")&&eh(S,k),ue&37&&(P=K[2]==="always"||K[2]!=="never"&&!K[0].address&&!K[0].id.startsWith("road.")&&!K[0].id.startsWith("address.")&&!K[0].id.startsWith("postal_code.")&&(!K[0].id.startsWith("poi.")||!K[5])&&!K[7]),P?Y?Y.p(K,ue):(Y=J_(K),Y.c(),Y.m(g,null)):Y&&(Y.d(1),Y=null),ue&1&&$!==($=(K[7]?"":K[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&eh(H,$),ue&2&&ht(e,"data-selected",K[1]),ue&2&&Ao(e,"selected",K[1])},i:kn,o:kn,d(K){K&&Sn(e),Ie.d(),Y&&Y.d(),G=!1,Cs(X)}}}function Pw(r,e,t){var o;let l,u,{feature:d}=e,{selected:a=!1}=e,{showPlaceType:g}=e,{missingIconsCache:v}=e,{iconsBaseUrl:k}=e;const S=(o=d.properties)==null?void 0:o.categories;let E,P,z=0,V=d.place_type[0]==="reverse";function $(){P&&v.add(P),t(10,z++,z)}function H(le){H_.call(this,r,le)}function G(le){H_.call(this,r,le)}const X=()=>$();return r.$$set=le=>{"feature"in le&&t(0,d=le.feature),"selected"in le&&t(1,a=le.selected),"showPlaceType"in le&&t(2,g=le.showPlaceType),"missingIconsCache"in le&&t(9,v=le.missingIconsCache),"iconsBaseUrl"in le&&t(3,k=le.iconsBaseUrl)},r.$$.update=()=>{var le,xe,Ie,Y;if(r.$$.dirty&3640)do t(11,l--,l),t(4,E=S==null?void 0:S[l]),t(5,P=E?k+E.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!P||v.has(P)));r.$$.dirty&1&&t(6,u=((xe=(le=d.properties)==null?void 0:le.categories)==null?void 0:xe.join(", "))??((Y=(Ie=d.properties)==null?void 0:Ie.place_type_name)==null?void 0:Y[0])??d.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[d,a,g,k,E,P,u,V,$,v,z,l,H,G,X]}class zw extends xa{constructor(e){super(),wa(this,e,Pw,Aw,va,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Dw(r){let e;return{c(){e=ln("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ht(e,"class","svelte-7cmwmc")},m(t,o){Mn(t,e,o)},p:kn,i:kn,o:kn,d(t){t&&Sn(e)}}}class Rw extends xa{constructor(e){super(),wa(this,e,null,Dw,va,{})}}function Fw(r){let e,t,o;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"stroke-width","4"),ht(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ht(t,"class","svelte-gzo3ar"),ht(e,"width",o=r[0]==="list"?20:void 0),ht(e,"viewBox","0 0 70 85"),ht(e,"fill","none"),ht(e,"class","svelte-gzo3ar"),Ao(e,"in-map",r[0]!=="list"),Ao(e,"list-icon",r[0]==="list")},m(l,u){Mn(l,e,u),Ni(e,t)},p(l,[u]){u&1&&o!==(o=l[0]==="list"?20:void 0)&&ht(e,"width",o),u&1&&Ao(e,"in-map",l[0]!=="list"),u&1&&Ao(e,"list-icon",l[0]==="list")},i:kn,o:kn,d(l){l&&Sn(e)}}}function Bw(r,e,t){let{displayIn:o}=e;return r.$$set=l=>{"displayIn"in l&&t(0,o=l.displayIn)},[o]}class Ow extends xa{constructor(e){super(),wa(this,e,Bw,Fw,va,{displayIn:0})}}function Nw(r){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ht(e,"viewBox","0 0 60.006 21.412"),ht(e,"width","14"),ht(e,"height","20"),ht(e,"class","svelte-en2qvf")},m(o,l){Mn(o,e,l),Ni(e,t)},p:kn,i:kn,o:kn,d(o){o&&Sn(e)}}}class jw extends xa{constructor(e){super(),wa(this,e,null,Nw,va,{})}}function Uw(r){let e,t,o;return{c(){e=Vo("svg"),t=Vo("circle"),o=Vo("path"),ht(t,"cx","4.789"),ht(t,"cy","4.787"),ht(t,"r","3.85"),ht(t,"class","svelte-1aq105l"),ht(o,"d","M12.063 12.063 7.635 7.635"),ht(o,"class","svelte-1aq105l"),ht(e,"xmlns","http://www.w3.org/2000/svg"),ht(e,"width","13"),ht(e,"height","13"),ht(e,"viewBox","0 0 13 13"),ht(e,"class","svelte-1aq105l")},m(l,u){Mn(l,e,u),Ni(e,t),Ni(e,o)},p:kn,i:kn,o:kn,d(l){l&&Sn(e)}}}class $w extends xa{constructor(e){super(),wa(this,e,null,Uw,va,{})}}function Vw(r,e,t){const o=e[1],l=e[0],u=o-l;return r===o&&t?r:((r-l)%u+u)%u+l}function Ed(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Du;async function qw(r,e,t){const o=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(o&&(l.minZoom!=null&&l.minZoom>o[0]||l.maxZoom!=null&&l.maxZoom<o[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Du&&l.cachedLocationExpiry&&Du.time+l.cachedLocationExpiry>Date.now()){if(!Du.coords)break e;return Du.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(g=>{d([g.coords.longitude,g.coords.latitude].map(v=>v.toFixed(6)).join(","))},g=>{a(g)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Du={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(o&&l.type==="map-center")return o[1].toFixed(6)+","+o[2].toFixed(6)}}const Zw=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Y_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Q_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,eg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,tg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,ig=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function Gw(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),o=Number(e[1]),l=Math.abs(t),u=Math.abs(o),d=t>0?"N":"S",a=o>0?"E":"W";let g;r=="DD"&&(g=`${l}° ${d}, ${u}° ${a}`);const v=Math.floor(l),k=Math.floor(u),S=(l-v)*60,E=(u-k)*60;if(r=="DM"){let P=ng(S,3).toFixed(3).padStart(6,"0"),z=ng(E,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&z.endsWith(".000")&&(P=P.replace(/\.000$/,""),z=z.replace(/\.000$/,"")),g=`${v}° ${P}' ${d}, ${k}° ${z}' ${a}`}if(r=="DMS"){const P=Math.floor(S),z=Math.floor(E);let V=((S-P)*60).toFixed(1).padStart(4,"0"),$=((E-z)*60).toFixed(1).padStart(4,"0");const H=P.toString().padStart(2,"0"),G=z.toString().padStart(2,"0");V.endsWith(".0")&&$.endsWith(".0")&&(V=V.replace(/\.0$/,""),$=$.replace(/\.0$/,"")),g=`${v}° ${H}' ${V}" ${d}, ${k}° ${G}' ${$}" ${a}`}return g}else throw new Error("no decimal coordinates to convert")}function ng(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function $p(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,o=null,l="",u="",d=null,a=[],g=!1;if(Zw.test(r))throw new Error("invalid coordinate value");if(Y_.test(r))if(a=Y_.exec(r),g=Ru(a),g)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),o=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(o*=-1),d="DM";else throw new Error("invalid coordinate format");else if(Q_.test(r))if(a=Q_.exec(r),g=Ru(a),g){if(t=a[2],o=a[6],t.includes(",")&&(t=t.replace(",",".")),o.includes(",")&&(o=o.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(o))==Number(o))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(eg.test(r))if(a=eg.exec(r),g=Ru(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),o=Math.abs(parseInt(a[9])),a[11]&&(o+=a[11]/60),a[13]&&(o+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(o=-1*o),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(tg.test(r))if(a=tg.exec(r),g=Ru(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12]/60),a[14]&&(o+=a[14]/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(ig.test(r)){if(a=ig.exec(r),g=Ru(a),a.filter(v=>v).length<=5)throw new Error("invalid coordinates format");if(g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12].replace(",",".")/60),a[14]&&(o+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(g){if(Math.abs(o)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),o.toString().includes(",")&&(o=o.replace(",","."));let v=/S|SOUTH/i;v.test(l)&&t>0&&(t=-1*t),v=/W|WEST/i,v.test(u)&&o>0&&(o=-1*o);const k=a[0].trim();let S,E;const P=/[,/;\u0020]/g,z=k.match(P);if(z==null){const H=Math.floor(r.length/2);S=k.substring(0,H).trim(),E=k.substring(H).trim()}else{let H;z.length%2==1?H=Math.floor(z.length/2):H=z.length/2-1;let G=0;if(H==0)G=k.indexOf(z[0]),S=k.substring(0,G).trim(),E=k.substring(G+1).trim();else{let X=0,le=0;for(;X<=H;)G=k.indexOf(z[X],le),le=G+1,X++;S=k.substring(0,G).trim(),E=k.substring(G+1).trim()}}const V=S.split(".");if(V.length==2&&V[1]==0&&V[1].length!=2)throw new Error("invalid coordinates format");const $=E.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),o=Number(Number(o).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:t,decimalLongitude:o,decimalCoordinates:`${t},${o}`,originalFormat:d,closeEnough:Ww,toCoordinateFormat:Gw})}else throw new Error("coordinates pattern match failed")}function Ru(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,o=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],g=t.test(d)&&t.test(a),v=o.test(d)&&o.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(g||v||k)continue;return!1}}return!0}function rg(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function Ww(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return rg(this.decimalLatitude,Number(e[0]))&&rg(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Hw=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});$p.to=Hw;const Xw=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Kw={decimalLatitude:40.123,decimalLongitude:-74.123},Jw=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],Yw=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Qw(){const r=[];return Xw.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...Kw})}),[...r,...Jw,...Yw]}const ex=Qw();$p.formats=ex.map(r=>r.verbatimCoordinates);const tx=$p;function og(r,e,t){const o=r.slice();return o[84]=e[t],o[86]=t,o}function sg(r){let e,t;return e=new Rw({}),{c(){_a(e.$$.fragment)},m(o,l){Ts(e,o,l),t=!0},i(o){t||(Un(e.$$.fragment,o),t=!0)},o(o){ur(e.$$.fragment,o),t=!1},d(o){Is(e,o)}}}function ag(r){let e,t,o,l,u;return t=new jw({}),{c(){e=ln("button"),_a(t.$$.fragment),ht(e,"type","button"),ht(e,"title",r[9]),ht(e,"class","svelte-bz0zu3"),Ao(e,"active",r[0])},m(d,a){Mn(d,e,a),Ts(t,e,null),o=!0,l||(u=Gr(e,"click",r[69]),l=!0)},p(d,a){(!o||a[0]&512)&&ht(e,"title",d[9]),(!o||a[0]&1)&&Ao(e,"active",d[0])},i(d){o||(Un(t.$$.fragment,d),o=!0)},o(d){ur(t.$$.fragment,d),o=!1},d(d){d&&Sn(e),Is(t),l=!1,u()}}}function ix(r){let e,t=[],o=new Map,l,u,d,a=K_(r[14]);const g=v=>v[84].id+(v[84].address?","+v[84].address:"");for(let v=0;v<a.length;v+=1){let k=og(r,a,v),S=g(k);o.set(S,t[v]=lg(S,k))}return{c(){e=ln("ul");for(let v=0;v<t.length;v+=1)t[v].c();ht(e,"class","options svelte-bz0zu3")},m(v,k){Mn(v,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Gr(e,"mouseleave",r[73]),Gr(e,"blur",r[74])],u=!0)},p(v,k){k[0]&17880064&&(a=K_(v[14]),xd(),t=yw(t,k,g,1,v,a,o,e,gw,lg,null,og),kd())},i(v){if(!l){for(let k=0;k<a.length;k+=1)Un(t[k]);l=!0}},o(v){for(let k=0;k<t.length;k+=1)ur(t[k]);l=!1},d(v){v&&Sn(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,Cs(d)}}}function nx(r){let e,t,o,l,u,d;return t=new o1({}),{c(){e=ln("div"),_a(t.$$.fragment),o=bo(),l=ln("div"),u=ma(r[7]),ht(l,"class","svelte-bz0zu3"),ht(e,"class","no-results svelte-bz0zu3")},m(a,g){Mn(a,e,g),Ts(t,e,null),Ni(e,o),Ni(e,l),Ni(l,u),d=!0},p(a,g){(!d||g[0]&128)&&eh(u,a[7])},i(a){d||(Un(t.$$.fragment,a),d=!0)},o(a){ur(t.$$.fragment,a),d=!1},d(a){a&&Sn(e),Is(t)}}}function rx(r){let e="",t;return{c(){t=ma(e)},m(o,l){Mn(o,t,l)},p:kn,i:kn,o:kn,d(o){o&&Sn(t)}}}function ox(r){let e,t,o,l,u,d,a,g,v,k,S;return t=new o1({}),g=new r1({}),{c(){e=ln("div"),_a(t.$$.fragment),o=bo(),l=ln("div"),u=ma(r[6]),d=bo(),a=ln("button"),_a(g.$$.fragment),ht(l,"class","svelte-bz0zu3"),ht(a,"class","svelte-bz0zu3"),ht(e,"class","error svelte-bz0zu3")},m(E,P){Mn(E,e,P),Ts(t,e,null),Ni(e,o),Ni(e,l),Ni(l,u),Ni(e,d),Ni(e,a),Ts(g,a,null),v=!0,k||(S=Gr(a,"click",r[70]),k=!0)},p(E,P){(!v||P[0]&64)&&eh(u,E[6])},i(E){v||(Un(t.$$.fragment,E),Un(g.$$.fragment,E),v=!0)},o(E){ur(t.$$.fragment,E),ur(g.$$.fragment,E),v=!1},d(E){E&&Sn(e),Is(t),Is(g),k=!1,S()}}}function lg(r,e){let t,o,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return o=new zw({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),o.$on("mouseenter",u),o.$on("focus",d),{key:r,first:null,c(){t=aw(),_a(o.$$.fragment),this.first=t},m(a,g){Mn(a,t,g),Ts(o,a,g),l=!0},p(a,g){e=a;const v={};g[0]&16384&&(v.feature=e[84]),g[0]&1024&&(v.showPlaceType=e[10]),g[0]&49152&&(v.selected=e[15]===e[86]),g[0]&4096&&(v.iconsBaseUrl=e[12]),o.$set(v)},i(a){l||(Un(o.$$.fragment,a),l=!0)},o(a){ur(o.$$.fragment,a),l=!1},d(a){a&&Sn(t),Is(o,a)}}}function sx(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie=!1;u=new $w({}),S=new r1({});let Y=r[19]&&sg(),K=r[5]==="button"&&ag(r);const ue=r[61].default,fe=nw(ue,r,r[60],null),ce=[ox,rx,nx,ix],ae=[];function Ge(Le,Pe){var rt,it;return Le[18]?0:Le[16]?((rt=Le[14])==null?void 0:rt.length)===0?2:Le[16]&&(it=Le[14])!=null&&it.length?3:-1:1}return~($=Ge(r))&&(H=ae[$]=ce[$](r)),{c(){e=bo(),t=ln("form"),o=ln("div"),l=ln("button"),_a(u.$$.fragment),d=bo(),a=ln("input"),g=bo(),v=ln("div"),k=ln("button"),_a(S.$$.fragment),E=bo(),Y&&Y.c(),P=bo(),K&&K.c(),z=bo(),fe&&fe.c(),V=bo(),H&&H.c(),ht(l,"class","search-button svelte-bz0zu3"),ht(l,"type","button"),ht(a,"placeholder",r[8]),ht(a,"aria-label",r[8]),ht(a,"class","svelte-bz0zu3"),ht(k,"type","button"),ht(k,"title",r[3]),ht(k,"class","svelte-bz0zu3"),ht(v,"class","clear-button-container svelte-bz0zu3"),Ao(v,"displayable",r[1]!==""),ht(o,"class","input-group svelte-bz0zu3"),ht(t,"tabindex","0"),ht(t,"class",G=G_(r[2])+" svelte-bz0zu3"),Ao(t,"can-collapse",r[4]&&r[1]==="")},m(Le,Pe){Mn(Le,e,Pe),Mn(Le,t,Pe),Ni(t,o),Ni(o,l),Ts(u,l,null),Ni(o,d),Ni(o,a),r[63](a),W_(a,r[1]),Ni(o,g),Ni(o,v),Ni(v,k),Ts(S,k,null),Ni(v,E),Y&&Y.m(v,null),Ni(o,P),K&&K.m(o,null),Ni(o,z),fe&&fe.m(o,null),Ni(t,V),~$&&ae[$].m(t,null),X=!0,le||(xe=[Gr(l,"click",r[62]),Gr(a,"input",r[64]),Gr(a,"focus",r[65]),Gr(a,"blur",r[66]),Gr(a,"keydown",r[22]),Gr(a,"input",r[67]),Gr(k,"click",r[68]),Gr(t,"submit",lw(r[21]))],le=!0)},p(Le,Pe){(!X||Pe[0]&256)&&ht(a,"placeholder",Le[8]),(!X||Pe[0]&256)&&ht(a,"aria-label",Le[8]),Pe[0]&2&&a.value!==Le[1]&&W_(a,Le[1]),(!X||Pe[0]&8)&&ht(k,"title",Le[3]),Le[19]?Y?Pe[0]&524288&&Un(Y,1):(Y=sg(),Y.c(),Un(Y,1),Y.m(v,null)):Y&&(xd(),ur(Y,1,1,()=>{Y=null}),kd()),(!X||Pe[0]&2)&&Ao(v,"displayable",Le[1]!==""),Le[5]==="button"?K?(K.p(Le,Pe),Pe[0]&32&&Un(K,1)):(K=ag(Le),K.c(),Un(K,1),K.m(o,z)):K&&(xd(),ur(K,1,1,()=>{K=null}),kd()),fe&&fe.p&&(!X||Pe[1]&536870912)&&ow(fe,ue,Le,Le[60],X?rw(ue,Le[60],Pe,null):sw(Le[60]),null);let rt=$;$=Ge(Le),$===rt?~$&&ae[$].p(Le,Pe):(H&&(xd(),ur(ae[rt],1,1,()=>{ae[rt]=null}),kd()),~$?(H=ae[$],H?H.p(Le,Pe):(H=ae[$]=ce[$](Le),H.c()),Un(H,1),H.m(t,null)):H=null),(!X||Pe[0]&4&&G!==(G=G_(Le[2])+" svelte-bz0zu3"))&&ht(t,"class",G),(!X||Pe[0]&22)&&Ao(t,"can-collapse",Le[4]&&Le[1]==="")},i(Le){X||(Un(Ie),Un(u.$$.fragment,Le),Un(S.$$.fragment,Le),Un(Y),Un(K),Un(fe,Le),Un(H),X=!0)},o(Le){ur(Ie),ur(u.$$.fragment,Le),ur(S.$$.fragment,Le),ur(Y),ur(K),ur(fe,Le),ur(H),X=!1},d(Le){Le&&(Sn(e),Sn(t)),Is(u),r[63](null),Is(S),Y&&Y.d(),K&&K.d(),fe&&fe.d(Le),~$&&ae[$].d(),le=!1,Cs(xe)}}}function ax(r,e,t){let o,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:g=void 0}=e,{apiKey:v}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:E=!1}=e,{collapsed:P=!1}=e,{country:z=void 0}=e,{debounceSearch:V=200}=e,{enableReverse:$="never"}=e,{errorMessage:H="Something went wrong…"}=e,{filter:G=()=>!0}=e,{flyTo:X=!0}=e,{fuzzyMatch:le=!0}=e,{language:xe=void 0}=e,{limit:Ie=void 0}=e,{mapController:Y=void 0}=e,{minLength:K=2}=e,{noResultsMessage:ue="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:fe="Search"}=e,{proximity:ce=[{type:"server-geolocation"}]}=e,{reverseActive:ae=$==="always"}=e,{reverseButtonTitle:Ge="toggle reverse geocoding"}=e,{searchValue:Le=""}=e,{pickedResultStyle:Pe="full-geometry"}=e,{showPlaceType:rt="if-needed"}=e,{showResultsWhileTyping:it=!0}=e,{selectFirst:Qe=!0}=e,{flyToSelected:Ft=!1}=e,{markerOnSelected:jt=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:et=!1}=e,{excludeTypes:at=!1}=e,{zoom:Bt=a}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ht={}}=e,{iconsBaseUrl:li="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:ai=()=>{}}=e;function ki(){Ce.focus()}function Fi(){Ce.blur()}function bi(j,Re=!0,Ke=!1){t(1,Le=j),Re?(t(15,nt=-1),tr()):(In(!Ke,Ke),setTimeout(()=>{Ce.focus(),Ce.select()}))}function di(){t(14,st=void 0),t(56,pt=void 0),t(15,nt=-1)}function lt(){t(55,Te=[]),t(56,pt=void 0)}let qe=!1,st,Te,pt,gt="",Ce,nt=-1,Xt,vi=[],ji,Ci,_i,Bi;const br=new Set,ct=dw();hw(()=>{Y&&(Y.setEventHandler(void 0),Y.indicateReverse(!1),Y.setSelectedMarker(-1),Y.setFeatures(void 0,void 0,!1))});function tr(j){if(Ci&&(clearTimeout(Ci),Ci=void 0),nt>-1&&st)t(56,pt=st[nt]),t(1,Le=pt.place_type[0]==="reverse"?pt.place_name:pt.place_name.replace(/,.*/,"")),t(18,Xt=void 0),t(55,Te=void 0),t(15,nt=-1);else if(Le){const Re=j||!_n(Le);qn(Le,{exact:!0}).then(()=>{t(55,Te=st),t(56,pt=void 0),Re&&Wr()}).catch(Ke=>t(18,Xt=Ke))}}function _n(j){try{return tx(j,6)}catch{return!1}}async function qn(j,{byId:Re=!1,exact:Ke=!1}={}){t(18,Xt=void 0),ji==null||ji.abort();const $e=new AbortController;t(19,ji=$e);try{const Xe=_n(j),mt=new URLSearchParams;if(xe!==void 0&&mt.set("language",Array.isArray(xe)?xe.join(","):xe??""),ut&&mt.set("types",ut.join(",")),at&&mt.set("excludeTypes",String(at)),k&&mt.set("bbox",k.map(hi=>hi.toFixed(6)).join(",")),z&&mt.set("country",Array.isArray(z)?z.join(","):z),!Re&&!Xe){const hi=await qw(Y,ce,$e);hi&&mt.set("proximity",hi),(Ke||!it)&&mt.set("autocomplete","false"),mt.set("fuzzyMatch",String(le))}Ie!==void 0&&(et||!Xe||(ut==null?void 0:ut.length)===1)&&mt.set("limit",String(Ie)),mt.set("key",v),ai(mt);const Et=Dt+"/"+encodeURIComponent(Xe?Xe.decimalLongitude+","+Xe.decimalLatitude:j)+".json?"+mt.toString();if(Et===gt){Re?(t(14,st=void 0),t(56,pt=vi[0])):t(14,st=vi);return}gt=Et;const pi=await fetch(Et,{signal:$e.signal,...Ht});if(!pi.ok)throw new Error(await pi.text());const Qt=await pi.json();ct("response",{url:Et,featureCollection:Qt}),Re?(t(14,st=void 0),t(56,pt=Qt.features[0]),vi=[pt]):(t(14,st=Qt.features.filter(G)),Xe&&st.unshift({type:"Feature",properties:{},id:"reverse_"+Xe.decimalLongitude+"_"+Xe.decimalLatitude,text:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_name:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_type:["reverse"],center:[Xe.decimalLongitude,Xe.decimalLatitude],bbox:[Xe.decimalLongitude,Xe.decimalLatitude,Xe.decimalLongitude,Xe.decimalLatitude],geometry:{type:"Point",coordinates:[Xe.decimalLongitude,Xe.decimalLatitude]}}),vi=st,Xe&&Ce.focus())}catch(Xe){if(Xe&&typeof Xe=="object"&&"name"in Xe&&Xe.name==="AbortError")return;throw Xe}finally{$e===ji&&t(19,ji=void 0)}}function Wr(){var j;if(!(Te!=null&&Te.length)||!X)return;const Re=[180,90,-180,-90],Ke=!Te.some(Xe=>!Xe.matching_text);let $e;for(const Xe of Te){const mt=bt(Xe);if($e=$e===void 0?mt:mt===void 0?$e:Math.max($e,mt),Ke||!Xe.matching_text)for(const Et of[0,1,2,3])Re[Et]=Math[Et<2?"min":"max"](Re[Et],((j=Xe.bbox)==null?void 0:j[Et])??Xe.center[Et%2])}Y&&Te.length>0&&(pt&&Re[0]===Re[2]&&Re[1]===Re[3]?Y.flyTo(pt.center,bt(pt)):Y.fitBounds(Ed(Re),50,$e))}function bt(j){var Re;if(!j.bbox||j.bbox[0]!==j.bbox[2]&&j.bbox[1]!==j.bbox[3])return;const Ke=j.id.replace(/\..*/,"");return(Array.isArray((Re=j.properties)==null?void 0:Re.categories)?j.properties.categories.reduce(($e,Xe)=>{const mt=Bt[Ke+"."+Xe];return $e===void 0?mt:mt===void 0?$e:Math.max($e,mt)},void 0):void 0)??Bt[Ke]}function ci(j){t(0,ae=$==="always"),t(14,st=void 0),t(56,pt=void 0),t(15,nt=-1),bi(j[1].toFixed(6)+", "+Vw(j[0],[-180,180],!0).toFixed(6),!1,!0)}function Jt(j){if(!st)return;let Re=j.key==="ArrowDown"?1:j.key==="ArrowUp"?-1:0;Re&&(nt===(Qe?0:-1)&&Re===-1&&t(15,nt=st.length),t(15,nt+=Re),nt>=st.length&&t(15,nt=-1),nt<0&&Qe&&t(15,nt=0),j.preventDefault())}function In(j=!0,Re=!1){if(t(18,Xt=void 0),it||Re){if(Ci&&clearTimeout(Ci),Le.length<K)return;const Ke=Le;Ci=window.setTimeout(()=>{qn(Ke).catch($e=>t(18,Xt=$e))},j?V:0)}else t(14,st=void 0),t(18,Xt=void 0)}function Nn(j){t(56,pt=j),t(1,Le=j.place_name),t(15,nt=-1)}const ei=()=>Ce.focus();function vr(j){yp[j?"unshift":"push"](()=>{Ce=j,t(17,Ce)})}function Fr(){Le=this.value,t(1,Le),t(13,qe),t(28,E)}const Hr=()=>t(13,qe=!0),wr=()=>t(13,qe=!1),ye=()=>In(),Z=()=>{t(1,Le=""),Ce.focus()},q=()=>t(0,ae=!ae),ne=()=>t(18,Xt=void 0),pe=j=>t(15,nt=j),Me=j=>Nn(j),ze=()=>{Qe||t(15,nt=-1)},Ve=()=>{};return r.$$set=j=>{"class"in j&&t(2,g=j.class),"apiKey"in j&&t(26,v=j.apiKey),"bbox"in j&&t(27,k=j.bbox),"clearButtonTitle"in j&&t(3,S=j.clearButtonTitle),"clearOnBlur"in j&&t(28,E=j.clearOnBlur),"collapsed"in j&&t(4,P=j.collapsed),"country"in j&&t(29,z=j.country),"debounceSearch"in j&&t(30,V=j.debounceSearch),"enableReverse"in j&&t(5,$=j.enableReverse),"errorMessage"in j&&t(6,H=j.errorMessage),"filter"in j&&t(31,G=j.filter),"flyTo"in j&&t(32,X=j.flyTo),"fuzzyMatch"in j&&t(33,le=j.fuzzyMatch),"language"in j&&t(34,xe=j.language),"limit"in j&&t(35,Ie=j.limit),"mapController"in j&&t(36,Y=j.mapController),"minLength"in j&&t(37,K=j.minLength),"noResultsMessage"in j&&t(7,ue=j.noResultsMessage),"placeholder"in j&&t(8,fe=j.placeholder),"proximity"in j&&t(38,ce=j.proximity),"reverseActive"in j&&t(0,ae=j.reverseActive),"reverseButtonTitle"in j&&t(9,Ge=j.reverseButtonTitle),"searchValue"in j&&t(1,Le=j.searchValue),"pickedResultStyle"in j&&t(39,Pe=j.pickedResultStyle),"showPlaceType"in j&&t(10,rt=j.showPlaceType),"showResultsWhileTyping"in j&&t(40,it=j.showResultsWhileTyping),"selectFirst"in j&&t(11,Qe=j.selectFirst),"flyToSelected"in j&&t(41,Ft=j.flyToSelected),"markerOnSelected"in j&&t(42,jt=j.markerOnSelected),"types"in j&&t(43,ut=j.types),"exhaustiveReverseGeocoding"in j&&t(44,et=j.exhaustiveReverseGeocoding),"excludeTypes"in j&&t(45,at=j.excludeTypes),"zoom"in j&&t(46,Bt=j.zoom),"apiUrl"in j&&t(47,Dt=j.apiUrl),"fetchParameters"in j&&t(48,Ht=j.fetchParameters),"iconsBaseUrl"in j&&t(12,li=j.iconsBaseUrl),"adjustUrlQuery"in j&&t(49,ai=j.adjustUrlQuery),"$$scope"in j&&t(60,d=j.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=$==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,_i=qe),E&&!qe&&t(1,Le="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Le.length<K&&(t(56,pt=void 0),t(14,st=void 0),t(18,Xt=void 0),t(55,Te=st)),r.$$.dirty[1]&33554688&&Pe!=="marker-only"&&pt&&!pt.address&&pt.geometry.type==="Point"&&pt.place_type[0]!=="reverse"&&qn(pt.id,{byId:!0}).catch(j=>t(18,Xt=j)),r.$$.dirty[1]&100663330&&(Y&&pt&&pt.id!==Bi&&X&&(!pt.bbox||pt.bbox[0]===pt.bbox[2]&&pt.bbox[1]===pt.bbox[3]?Y.flyTo(pt.center,bt(pt)):Y.fitBounds(Ed(pt.bbox),50,bt(pt)),t(14,st=void 0),t(55,Te=void 0),t(15,nt=-1)),t(57,Bi=pt==null?void 0:pt.id)),r.$$.dirty[0]&18432&&Qe&&st!=null&&st.length&&t(15,nt=0),r.$$.dirty[0]&2&&t(15,nt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Te!==st&&t(55,Te=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&Y&&Y.setEventHandler(j=>{switch(j.type){case"mapClick":ae&&ci(j.coordinates);break;case"markerClick":{const Re=st==null?void 0:st.find(Ke=>Ke.id===j.id);Re&&Nn(Re)}break;case"markerMouseEnter":Te&&t(15,nt=_i?(st==null?void 0:st.findIndex(Re=>Re.id===j.id))??-1:-1);break;case"markerMouseLeave":Te&&t(15,nt=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=st==null?void 0:st[nt]),r.$$.dirty[1]&134218786&&Y&&l&&X&&Ft&&Y.flyTo(l.center,bt(l)),r.$$.dirty[1]&256&&t(59,o=Pe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(jt||Y==null||Y.setFeatures(void 0,void 0,o)),r.$$.dirty[1]&419432480&&Y&&jt&&!Te&&(Y.setFeatures(l?[l]:void 0,void 0,o),Y.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&Y&&Y.setFeatures(Te,pt,o),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Te&&Y&&Y.setSelectedMarker(nt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&Y){const j=_n(Le);Y.setReverseMarker(j?[j.decimalLongitude,j.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&ct("select",{feature:l}),r.$$.dirty[1]&33554432&&ct("pick",{feature:pt}),r.$$.dirty[0]&81920&&ct("optionsvisibilitychange",{optionsVisible:_i&&!!st}),r.$$.dirty[0]&16384&&ct("featureslisted",{features:st}),r.$$.dirty[1]&16777216&&ct("featuresmarked",{features:Te}),r.$$.dirty[0]&1&&ct("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&ct("querychange",{query:Le}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&Y&&Y.indicateReverse(ae)},[ae,Le,g,S,P,$,H,ue,fe,Ge,rt,Qe,li,qe,st,nt,_i,Ce,Xt,ji,br,tr,Jt,In,Nn,a,v,k,E,z,V,G,X,le,xe,Ie,Y,K,ce,Pe,it,Ft,jt,ut,et,at,Bt,Dt,Ht,ai,ki,Fi,bi,di,lt,Te,pt,Bi,l,o,d,u,ei,vr,Fr,Hr,wr,ye,Z,q,ne,pe,Me,ze,Ve]}let lx=class extends xa{constructor(r){super(),wa(this,r,ax,sx,va,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function ih(r,e,t={}){const o={type:"Feature"};return(t.id===0||t.id)&&(o.id=t.id),t.bbox&&(o.bbox=t.bbox),o.properties=e||{},o.geometry=r,o}function Vp(r,e,t={}){for(const o of r){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ih({type:"Polygon",coordinates:r},e,t)}function nh(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function s1(r,e,t={}){return ih({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function cx(r,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},o,l,u,d;return d={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function a(v){return function(k){return g([v,k])}}function g(v){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,l&&(u=v[0]&2?l.return:v[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,v[1])).done)return u;switch(l=0,u&&(v=[v[0]&2,u.value]),v[0]){case 0:case 1:u=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,l=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!u||v[1]>u[0]&&v[1]<u[3])){t.label=v[1];break}if(v[0]===6&&t.label<u[1]){t.label=u[1],u=v;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(v);break}u[2]&&t.ops.pop(),t.trys.pop();continue}v=e.call(r,t)}catch(k){v=[6,k],l=0}finally{o=u=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}var ga=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ux(r,e){return r>e?1:r<e?-1:0}function ca(r,e,t){for(var o=new ga(null,null),l=o,u=o;;){var d=t(r,e.key);if(d<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=o.right,e.right=o.left,e}function lp(r,e,t,o){var l=new ga(r,e);if(t===null)return l.left=l.right=null,l;t=ca(r,t,o);var u=o(r,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function cg(r,e,t){var o=null,l=null;if(e){e=ca(r,e,t);var u=t(e.key,r);u===0?(o=e.left,l=e.right):u<0?(l=e.right,e.right=null,o=e):(o=e.left,e.left=null,l=e)}return{left:o,right:l}}function hx(r,e,t){return e===null?r:(r===null||(e=ca(r.key,e,t),e.left=r),e)}function wp(r,e,t,o,l){if(r){o(""+e+(t?"└── ":"├── ")+l(r)+`
`);var u=e+(t?"    ":"│   ");r.left&&wp(r.left,u,!1,o,l),r.right&&wp(r.right,u,!0,o,l)}}var qp=function(){function r(e){e===void 0&&(e=ux),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=lp(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var o=new ga(e,t);this._root===null&&(o.left=o.right=null,this._size++,this._root=o);var l=this._comparator,u=ca(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(o.left=u.left,o.right=u,u.left=null):d>0&&(o.right=u.right,o.left=u,u.right=null),this._size++,this._root=o),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,o){var l;if(t===null)return null;t=ca(e,t,o);var u=o(e,t.key);return u===0?(t.left===null?l=t.right:(l=ca(e,t.left,o),l.right=t.right),this._size--,l):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ca(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,o=this._comparator;t;){var l=o(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ca(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,o=this._comparator;t;){var l=o(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var o=this._root,l=[],u=!1;!u;)o!==null?(l.push(o),o=o.left):l.length!==0?(o=l.pop(),e.call(t,o),o=o.right):u=!0;return this},r.prototype.range=function(e,t,o,l){for(var u=[],d=this._comparator,a=this._root,g;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),g=d(a.key,t),g>0)break;if(d(a.key,e)>=0&&o.call(l,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var o=t.key;return e.push(o)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var o=t.data;return e.push(o)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,o=!1,l=0,u=[];!o;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else o=!0;return null},r.prototype.next=function(e){var t=this._root,o=null;if(e.right){for(o=e.right;o.left;)o=o.left;return o}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(o=t,t=t.left):t=t.right}return o},r.prototype.prev=function(e){var t=this._root,o=null;if(e.left!==null){for(o=e.left;o.right;)o=o.right;return o}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(o=t,t=t.right)}return o},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return fx(this._root)},r.prototype.load=function(e,t,o){t===void 0&&(t=[]),o===void 0&&(o=!1);var l=e.length,u=this._comparator;if(o&&Sp(e,t,0,l-1,u),this._root===null)this._root=xp(e,t,0,l),this._size=l;else{var d=px(this.toList(),dx(e,t),u);l=this._size+l,this._root=kp({head:d},0,l)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(o){return String(o.key)});var t=[];return wp(this._root,"",!0,function(o){return t.push(o)},e),t.join("")},r.prototype.update=function(e,t,o){var l=this._comparator,u=cg(e,this._root,l),d=u.left,a=u.right;l(e,t)<0?a=lp(t,o,a,l):d=lp(t,o,d,l),this._root=hx(d,a,l)},r.prototype.split=function(e){return cg(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,o;return cx(this,function(l){switch(l.label){case 0:e=this._root,t=[],o=!1,l.label=1;case 1:return o?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:o=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function xp(r,e,t,o){var l=o-t;if(l>0){var u=t+Math.floor(l/2),d=r[u],a=e[u],g=new ga(d,a);return g.left=xp(r,e,t,u),g.right=xp(r,e,u+1,o),g}return null}function dx(r,e){for(var t=new ga(null,null),o=t,l=0;l<r.length;l++)o=o.next=new ga(r[l],e[l]);return o.next=null,t.next}function fx(r){for(var e=r,t=[],o=!1,l=new ga(null,null),u=l;!o;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):o=!0;return u.next=null,l.next}function kp(r,e,t){var o=t-e;if(o>0){var l=e+Math.floor(o/2),u=kp(r,e,l),d=r.head;return d.left=u,r.head=r.head.next,d.right=kp(r,l+1,t),d}return null}function px(r,e,t){for(var o=new ga(null,null),l=o,u=r,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),o.next}function Sp(r,e,t,o,l){if(!(t>=o)){for(var u=r[t+o>>1],d=t-1,a=o+1;;){do d++;while(l(r[d],u)<0);do a--;while(l(r[a],u)>0);if(d>=a)break;var g=r[d];r[d]=r[a],r[a]=g,g=e[d],e[d]=e[a],e[a]=g}Sp(r,e,t,a,l),Sp(r,e,a+1,o,l)}}const Ss=11102230246251565e-32,Mr=134217729,mx=(3+8*Ss)*Ss;function cp(r,e,t,o,l){let u,d,a,g,v=e[0],k=o[0],S=0,E=0;k>v==k>-v?(u=v,v=e[++S]):(u=k,k=o[++E]);let P=0;if(S<r&&E<t)for(k>v==k>-v?(d=v+u,a=u-(d-v),v=e[++S]):(d=k+u,a=u-(d-k),k=o[++E]),u=d,a!==0&&(l[P++]=a);S<r&&E<t;)k>v==k>-v?(d=u+v,g=d-u,a=u-(d-g)+(v-g),v=e[++S]):(d=u+k,g=d-u,a=u-(d-g)+(k-g),k=o[++E]),u=d,a!==0&&(l[P++]=a);for(;S<r;)d=u+v,g=d-u,a=u-(d-g)+(v-g),v=e[++S],u=d,a!==0&&(l[P++]=a);for(;E<t;)d=u+k,g=d-u,a=u-(d-g)+(k-g),k=o[++E],u=d,a!==0&&(l[P++]=a);return(u!==0||P===0)&&(l[P++]=u),P}function _x(r,e){let t=e[0];for(let o=1;o<r;o++)t+=e[o];return t}function ch(r){return new Float64Array(r)}const gx=(3+16*Ss)*Ss,yx=(2+12*Ss)*Ss,bx=(9+64*Ss)*Ss*Ss,tc=ch(4),ug=ch(8),hg=ch(12),dg=ch(16),Zr=ch(4);function vx(r,e,t,o,l,u,d){let a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie,Y,K;const ue=r-l,fe=t-l,ce=e-u,ae=o-u;le=ue*ae,E=Mr*ue,P=E-(E-ue),z=ue-P,E=Mr*ae,V=E-(E-ae),$=ae-V,xe=z*$-(le-P*V-z*V-P*$),Ie=ce*fe,E=Mr*ce,P=E-(E-ce),z=ce-P,E=Mr*fe,V=E-(E-fe),$=fe-V,Y=z*$-(Ie-P*V-z*V-P*$),H=xe-Y,S=xe-H,tc[0]=xe-(H+S)+(S-Y),G=le+H,S=G-le,X=le-(G-S)+(H-S),H=X-Ie,S=X-H,tc[1]=X-(H+S)+(S-Ie),K=G+H,S=K-G,tc[2]=G-(K-S)+(H-S),tc[3]=K;let Ge=_x(4,tc),Le=yx*d;if(Ge>=Le||-Ge>=Le||(S=r-ue,a=r-(ue+S)+(S-l),S=t-fe,v=t-(fe+S)+(S-l),S=e-ce,g=e-(ce+S)+(S-u),S=o-ae,k=o-(ae+S)+(S-u),a===0&&g===0&&v===0&&k===0)||(Le=bx*d+mx*Math.abs(Ge),Ge+=ue*k+ae*a-(ce*v+fe*g),Ge>=Le||-Ge>=Le))return Ge;le=a*ae,E=Mr*a,P=E-(E-a),z=a-P,E=Mr*ae,V=E-(E-ae),$=ae-V,xe=z*$-(le-P*V-z*V-P*$),Ie=g*fe,E=Mr*g,P=E-(E-g),z=g-P,E=Mr*fe,V=E-(E-fe),$=fe-V,Y=z*$-(Ie-P*V-z*V-P*$),H=xe-Y,S=xe-H,Zr[0]=xe-(H+S)+(S-Y),G=le+H,S=G-le,X=le-(G-S)+(H-S),H=X-Ie,S=X-H,Zr[1]=X-(H+S)+(S-Ie),K=G+H,S=K-G,Zr[2]=G-(K-S)+(H-S),Zr[3]=K;const Pe=cp(4,tc,4,Zr,ug);le=ue*k,E=Mr*ue,P=E-(E-ue),z=ue-P,E=Mr*k,V=E-(E-k),$=k-V,xe=z*$-(le-P*V-z*V-P*$),Ie=ce*v,E=Mr*ce,P=E-(E-ce),z=ce-P,E=Mr*v,V=E-(E-v),$=v-V,Y=z*$-(Ie-P*V-z*V-P*$),H=xe-Y,S=xe-H,Zr[0]=xe-(H+S)+(S-Y),G=le+H,S=G-le,X=le-(G-S)+(H-S),H=X-Ie,S=X-H,Zr[1]=X-(H+S)+(S-Ie),K=G+H,S=K-G,Zr[2]=G-(K-S)+(H-S),Zr[3]=K;const rt=cp(Pe,ug,4,Zr,hg);le=a*k,E=Mr*a,P=E-(E-a),z=a-P,E=Mr*k,V=E-(E-k),$=k-V,xe=z*$-(le-P*V-z*V-P*$),Ie=g*v,E=Mr*g,P=E-(E-g),z=g-P,E=Mr*v,V=E-(E-v),$=v-V,Y=z*$-(Ie-P*V-z*V-P*$),H=xe-Y,S=xe-H,Zr[0]=xe-(H+S)+(S-Y),G=le+H,S=G-le,X=le-(G-S)+(H-S),H=X-Ie,S=X-H,Zr[1]=X-(H+S)+(S-Ie),K=G+H,S=K-G,Zr[2]=G-(K-S)+(H-S),Zr[3]=K;const it=cp(rt,hg,4,Zr,dg);return dg[it-1]}function wx(r,e,t,o,l,u){const d=(e-u)*(t-l),a=(r-l)*(o-u),g=d-a,v=Math.abs(d+a);return Math.abs(g)>=gx*v?g:-vx(r,e,t,o,l,u,v)}const Fu=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,Tp=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,o=r.ur.x<e.ur.x?r.ur.x:e.ur.x,l=r.ll.y<e.ll.y?e.ll.y:r.ll.y,u=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:o,y:u}}};let ua=Number.EPSILON;ua===void 0&&(ua=Math.pow(2,-52));const xx=ua*ua,fg=(r,e)=>{if(-ua<r&&r<ua&&-ua<e&&e<ua)return 0;const t=r-e;return t*t<xx*r*e?0:r<e?-1:1};class kx{constructor(){this.reset()}reset(){this.xRounder=new pg,this.yRounder=new pg}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class pg{constructor(){this.tree=new qp,this.round(0)}round(e){const t=this.tree.add(e),o=this.tree.prev(t);if(o!==null&&fg(t.key,o.key)===0)return this.tree.remove(e),o.key;const l=this.tree.next(t);return l!==null&&fg(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const rh=new kx,Sd=(r,e)=>r.x*e.y-r.y*e.x,a1=(r,e)=>r.x*e.x+r.y*e.y,mg=(r,e,t)=>{const o=wx(r.x,r.y,e.x,e.y,t.x,t.y);return o>0?-1:o<0?1:0},Ld=r=>Math.sqrt(a1(r,r)),Sx=(r,e,t)=>{const o={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return Sd(l,o)/Ld(l)/Ld(o)},Tx=(r,e,t)=>{const o={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return a1(l,o)/Ld(l)/Ld(o)},_g=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},gg=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},Ix=(r,e,t,o)=>{if(e.x===0)return gg(t,o,r.x);if(o.x===0)return gg(r,e,t.x);if(e.y===0)return _g(t,o,r.y);if(o.y===0)return _g(r,e,t.y);const l=Sd(e,o);if(l==0)return null;const u={x:t.x-r.x,y:t.y-r.y},d=Sd(u,e)/l,a=Sd(u,o)/l,g=r.x+a*e.x,v=t.x+d*o.x,k=r.y+a*e.y,S=t.y+d*o.y,E=(g+v)/2,P=(k+S)/2;return{x:E,y:P}};class Lo{static compare(e,t){const o=Lo.comparePoints(e.point,t.point);return o!==0?o:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:pa.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let o=0,l=t.length;o<l;o++){const u=t[o];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const o=this.point.events[t];if(o.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&o.otherSE.point.events===u.otherSE.point.events&&o.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,o=this.point.events.length;t<o;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,o=l=>{const u=l.otherSE;t.set(l,{sine:Sx(this.point,e.point,u.point),cosine:Tx(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||o(l),t.has(u)||o(u);const{sine:d,cosine:a}=t.get(l),{sine:g,cosine:v}=t.get(u);return d>=0&&g>=0?a<v?1:a>v?-1:0:d<0&&g<0?a<v?-1:a>v?1:0:g<d?-1:g>d?1:0}}}let Cx=0;class pa{static compare(e,t){const o=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<o)return 1;if(u<l)return-1;const a=e.leftSE.point.y,g=t.leftSE.point.y,v=e.rightSE.point.y,k=t.rightSE.point.y;if(o<l){if(g<a&&g<v)return 1;if(g>a&&g>v)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const E=t.comparePoint(e.rightSE.point);return E!==0?E:-1}if(o>l){if(a<g&&a<k)return-1;if(a>g&&a>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const E=e.comparePoint(t.rightSE.point);return E<0?1:E>0?-1:1}if(a<g)return-1;if(a>g)return 1;if(u<d){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>d){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==d){const S=v-a,E=u-o,P=k-g,z=d-l;if(S>E&&P<z)return 1;if(S<E&&P>z)return-1}return u>d?1:u<d||v<k?-1:v>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,o,l){this.id=++Cx,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=o,this.windings=l}static fromRing(e,t,o){let l,u,d;const a=Lo.comparePoints(e,t);if(a<0)l=e,u=t,d=1;else if(a>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const g=new Lo(l,!0),v=new Lo(u,!1);return new pa(g,v,[o],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,o=this.rightSE.point,l=this.vector();if(t.x===o.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const a=(e.x-t.x)/l.x,g=t.y+a*l.y;return e.y===g?0:e.y<g?-1:1}getIntersection(e){const t=this.bbox(),o=e.bbox(),l=Tp(t,o);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,a=e.leftSE.point,g=e.rightSE.point,v=Fu(t,a)&&this.comparePoint(a)===0,k=Fu(o,u)&&e.comparePoint(u)===0,S=Fu(t,g)&&this.comparePoint(g)===0,E=Fu(o,d)&&e.comparePoint(d)===0;if(k&&v)return E&&!S?d:!E&&S?g:null;if(k)return S&&u.x===g.x&&u.y===g.y?null:u;if(v)return E&&d.x===a.x&&d.y===a.y?null:a;if(E&&S)return null;if(E)return d;if(S)return g;const P=Ix(u,this.vector(),a,e.vector());return P===null||!Fu(l,P)?null:rh.round(P.x,P.y)}split(e){const t=[],o=e.events!==void 0,l=new Lo(e,!0),u=new Lo(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new pa(l,d,this.rings.slice(),this.windings.slice());return Lo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Lo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,o=this.windings.length;t<o;t++)this.windings[t]*=-1}consume(e){let t=this,o=e;for(;t.consumedBy;)t=t.consumedBy;for(;o.consumedBy;)o=o.consumedBy;const l=pa.compare(t,o);if(l!==0){if(l>0){const u=t;t=o,o=u}if(t.prev===o){const u=t;t=o,o=u}for(let u=0,d=o.rings.length;u<d;u++){const a=o.rings[u],g=o.windings[u],v=t.rings.indexOf(a);v===-1?(t.rings.push(a),t.windings.push(g)):t.windings[v]+=g}o.rings=null,o.windings=null,o.consumedBy=t,o.leftSE.consumedBy=t.leftSE,o.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,o=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,g=this.rings.length;a<g;a++){const v=this.rings[a],k=this.windings[a],S=t.indexOf(v);S===-1?(t.push(v),o.push(k)):o[S]+=k}const u=[],d=[];for(let a=0,g=t.length;a<g;a++){if(o[a]===0)continue;const v=t[a],k=v.poly;if(d.indexOf(k)===-1)if(v.isExterior)u.push(k);else{d.indexOf(k)===-1&&d.push(k);const S=u.indexOf(v.poly);S!==-1&&u.splice(S,1)}}for(let a=0,g=u.length;a<g;a++){const v=u[a].multiPoly;l.indexOf(v)===-1&&l.push(v)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Uo.type){case"union":{const o=e.length===0,l=t.length===0;this._isInResult=o!==l;break}case"intersection":{let o,l;e.length<t.length?(o=e.length,l=t.length):(o=t.length,l=e.length),this._isInResult=l===Uo.numMultiPolys&&o<l;break}case"xor":{const o=Math.abs(e.length-t.length);this._isInResult=o%2===1;break}case"difference":{const o=l=>l.length===1&&l[0].isSubject;this._isInResult=o(e)!==o(t);break}default:throw new Error(`Unrecognized operation type found ${Uo.type}`)}return this._isInResult}}class yg{constructor(e,t,o){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=o,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=rh.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,a=e.length;d<a;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let g=rh.round(e[d][0],e[d][1]);g.x===u.x&&g.y===u.y||(this.segments.push(pa.fromRing(u,g,this)),g.x<this.bbox.ll.x&&(this.bbox.ll.x=g.x),g.y<this.bbox.ll.y&&(this.bbox.ll.y=g.y),g.x>this.bbox.ur.x&&(this.bbox.ur.x=g.x),g.y>this.bbox.ur.y&&(this.bbox.ur.y=g.y),u=g)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(pa.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,o=this.segments.length;t<o;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class Ex{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new yg(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let o=1,l=e.length;o<l;o++){const u=new yg(e[o],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,o=this.interiorRings.length;t<o;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class bg{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let o=0,l=e.length;o<l;o++){const u=new Ex(e[o],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,o=this.polys.length;t<o;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class Md{static factory(e){const t=[];for(let o=0,l=e.length;o<l;o++){const u=e[o];if(!u.isInResult()||u.ringOut)continue;let d=null,a=u.leftSE,g=u.rightSE;const v=[a],k=a.point,S=[];for(;d=a,a=g,v.push(a),a.point!==k;)for(;;){const E=a.getAvailableLinkedEvents();if(E.length===0){const V=v[0].point,$=v[v.length-1].point;throw new Error(`Unable to complete output ring starting at [${V.x}, ${V.y}]. Last matching segment found ends at [${$.x}, ${$.y}].`)}if(E.length===1){g=E[0].otherSE;break}let P=null;for(let V=0,$=S.length;V<$;V++)if(S[V].point===a.point){P=V;break}if(P!==null){const V=S.splice(P)[0],$=v.splice(V.index);$.unshift($[0].otherSE),t.push(new Md($.reverse()));continue}S.push({index:v.length,point:a.point});const z=a.getLeftmostComparator(d);g=E.sort(z)[0].otherSE;break}t.push(new Md(v))}return t}constructor(e){this.events=e;for(let t=0,o=e.length;t<o;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let v=1,k=this.events.length-1;v<k;v++){const S=this.events[v].point,E=this.events[v+1].point;mg(S,e,E)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const o=t[0],l=t[1];mg(o,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,g=[];for(let v=d;v!=a;v+=u)g.push([t[v].x,t[v].y]);return g}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];Lo.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),o=t?t.prevInResult():null;for(;;){if(!t)return null;if(!o)return t.ringOut;if(o.ringOut!==t.ringOut)return o.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=o.prevInResult(),o=t?t.prevInResult():null}}}class vg{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,o=this.interiorRings.length;t<o;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class Lx{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,o=this.polys.length;t<o;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let o=0,l=e.length;o<l;o++){const u=e[o];if(!u.poly)if(u.isExteriorRing())t.push(new vg(u));else{const d=u.enclosingRing();d.poly||t.push(new vg(d)),d.poly.addInterior(u)}}return t}}class Mx{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pa.compare;this.queue=e,this.tree=new qp(t),this.segments=[]}process(e){const t=e.segment,o=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),o;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,a,g;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;g===void 0;)d=this.tree.next(d),d===null?g=null:d.key.consumedBy===void 0&&(g=d.key);if(e.isLeft){let v=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(v=S),!a.isAnEndpoint(S))){const E=this._splitSafely(a,S);for(let P=0,z=E.length;P<z;P++)o.push(E[P])}}let k=null;if(g){const S=g.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!g.isAnEndpoint(S))){const E=this._splitSafely(g,S);for(let P=0,z=E.length;P<z;P++)o.push(E[P])}}if(v!==null||k!==null){let S=null;v===null?S=k:k===null?S=v:S=Lo.comparePoints(v,k)<=0?v:k,this.queue.remove(t.rightSE),o.push(t.rightSE);const E=t.split(S);for(let P=0,z=E.length;P<z;P++)o.push(E[P])}o.length>0?(this.tree.remove(t),o.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&g){const v=a.getIntersection(g);if(v!==null){if(!a.isAnEndpoint(v)){const k=this._splitSafely(a,v);for(let S=0,E=k.length;S<E;S++)o.push(k[S])}if(!g.isAnEndpoint(v)){const k=this._splitSafely(g,v);for(let S=0,E=k.length;S<E;S++)o.push(k[S])}}}this.tree.remove(t)}return o}_splitSafely(e,t){this.tree.remove(e);const o=e.rightSE;this.queue.remove(o);const l=e.split(t);return l.push(o),e.consumedBy===void 0&&this.tree.add(e),l}}const wg=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ax=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Px{run(e,t,o){Uo.type=e,rh.reset();const l=[new bg(t,!0)];for(let k=0,S=o.length;k<S;k++)l.push(new bg(o[k],!1));if(Uo.numMultiPolys=l.length,Uo.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)Tp(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if(Uo.type==="intersection")for(let k=0,S=l.length;k<S;k++){const E=l[k];for(let P=k+1,z=l.length;P<z;P++)if(Tp(E.bbox,l[P].bbox)===null)return[]}const u=new qp(Lo.compare);for(let k=0,S=l.length;k<S;k++){const E=l[k].getSweepEvents();for(let P=0,z=E.length;P<z;P++)if(u.insert(E[P]),u.size>wg)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new Mx(u);let a=u.size,g=u.pop();for(;g;){const k=g.key;if(u.size===a){const E=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${E.id} [${E.leftSE.point.x}, ${E.leftSE.point.y}] -> [${E.rightSE.point.x}, ${E.rightSE.point.y}] from queue.`)}if(u.size>wg)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>Ax)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=d.process(k);for(let E=0,P=S.length;E<P;E++){const z=S[E];z.consumedBy===void 0&&u.insert(z)}a=u.size,g=u.pop()}rh.reset();const v=Md.factory(d.segments);return new Lx(v).getGeom()}}const Uo=new Px,zx=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return Uo.run("union",r,t)},Dx=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return Uo.run("intersection",r,t)},Rx=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return Uo.run("xor",r,t)},Fx=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return Uo.run("difference",r,t)};var l1={union:zx,intersection:Dx,xor:Rx,difference:Fx};function c1(r,e,t){if(r!==null)for(var o,l,u,d,a,g,v,k=0,S=0,E,P=r.type,z=P==="FeatureCollection",V=P==="Feature",$=z?r.features.length:1,H=0;H<$;H++){v=z?r.features[H].geometry:V?r.geometry:r,E=v?v.type==="GeometryCollection":!1,a=E?v.geometries.length:1;for(var G=0;G<a;G++){var X=0,le=0;if(d=E?v.geometries[G]:v,d!==null){g=d.coordinates;var xe=d.type;switch(k=0,xe){case null:break;case"Point":if(e(g,S,H,X,le)===!1)return!1;S++,X++;break;case"LineString":case"MultiPoint":for(o=0;o<g.length;o++){if(e(g[o],S,H,X,le)===!1)return!1;S++,xe==="MultiPoint"&&X++}xe==="LineString"&&X++;break;case"Polygon":case"MultiLineString":for(o=0;o<g.length;o++){for(l=0;l<g[o].length-k;l++){if(e(g[o][l],S,H,X,le)===!1)return!1;S++}xe==="MultiLineString"&&X++,xe==="Polygon"&&le++}xe==="Polygon"&&X++;break;case"MultiPolygon":for(o=0;o<g.length;o++){for(le=0,l=0;l<g[o].length;l++){for(u=0;u<g[o][l].length-k;u++){if(e(g[o][l][u],S,H,X,le)===!1)return!1;S++}le++}X++}break;case"GeometryCollection":for(o=0;o<d.geometries.length;o++)if(c1(d.geometries[o],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Zp(r,e){var t,o,l,u,d,a,g,v,k,S,E=0,P=r.type==="FeatureCollection",z=r.type==="Feature",V=P?r.features.length:1;for(t=0;t<V;t++){for(a=P?r.features[t].geometry:z?r.geometry:r,v=P?r.features[t].properties:z?r.properties:{},k=P?r.features[t].bbox:z?r.bbox:void 0,S=P?r.features[t].id:z?r.id:void 0,g=a?a.type==="GeometryCollection":!1,d=g?a.geometries.length:1,l=0;l<d;l++){if(u=g?a.geometries[l]:a,u===null){if(e(null,E,v,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,E,v,k,S)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<u.geometries.length;o++)if(e(u.geometries[o],E,v,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function Bx(r,e){Zp(r,function(t,o,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(ih(t,l,{bbox:u,id:d}),o,0)===!1?!1:void 0}var g;switch(a){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var k=t.coordinates[v],S={type:g,coordinates:k};if(e(ih(S,l),o,v)===!1)return!1}})}function Ox(r,e={}){const t=[];if(Zp(r,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const o=l1.union(t[0],...t.slice(1));return o.length===0?null:o.length===1?Vp(o[0],e.properties):s1(o,e.properties)}var u1=Ox;function Nx(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return c1(r,o=>{t[0]>o[0]&&(t[0]=o[0]),t[1]>o[1]&&(t[1]=o[1]),t[2]<o[0]&&(t[2]=o[0]),t[3]<o[1]&&(t[3]=o[1])}),t}var xg=Nx;function jx(r){const e=[];if(Zp(r,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},o=l1.difference(e[0],...e.slice(1));return o.length===0?null:o.length===1?Vp(o[0],t):s1(o,t)}var Ux=jx;function $x(r){if(!r)throw new Error("geojson is required");var e=[];return Bx(r,function(t){e.push(t)}),nh(e)}var Vx=$x;function kg(r,e){const t=Ux(nh([Vp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const o=Ed(xg(r)),l=(o[2]-o[0])/360/1e3,u=o[0]<-180,d=o[2]>180,a=Vx(r);if(a.features.length>1&&(u||d))for(const g of a.features){const v=Ed(xg(g));if(d&&v[0]<-180+l)for(const k of g.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&v[2]>180-l)for(const k of g.geometry.coordinates)for(const S of k)S[0]-=360-l}e(nh([a.features.length<2?r:u1(a)??r,t]))}const Sg={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},md="mtlr-gc-full-geom",Tg="mtlr-gc-full-geom-fill",Ig="mtlr-gc-full-geom-line";function h1(r,e,t=!0,o=!0,l={},u={},d=Sg){let a;const g=[];let v,k,S;function E(){if(!r.loaded){r.once("load",E);return}const $=d?d===!0?Sg:d:void 0;if(!($!=null&&$.fill)&&!($!=null&&$.line))return;const H=r.getSource(md);if(H)H.setData(S??nh([]));else if(S)r.addSource(md,{type:"geojson",data:S});else return;!r.getLayer(Tg)&&$!=null&&$.fill&&r.addLayer({...$==null?void 0:$.fill,id:Tg,type:"fill",source:md}),!r.getLayer(Ig)&&$!=null&&$.line&&r.addLayer({...$==null?void 0:$.line,id:Ig,type:"line",source:md})}function P($){S=$,E()}r.on("styledata",()=>{setTimeout(()=>{S&&E()})});const z=$=>{a==null||a({type:"mapClick",coordinates:[$.lngLat.lng,$.lngLat.lat]})};function V($=!1){if(!e)throw new Error;const H=document.createElement("div");return $&&H.classList.add("marker-interactive"),new Ow({props:{displayIn:"maplibre"},target:H}),new e.Marker({element:H,offset:[1,-13]})}return{setEventHandler($){$?(a=$,r.on("click",z)):(a=void 0,r.off("click",z))},flyTo($,H){r.flyTo({center:$,...H?{zoom:H}:{},...l})},fitBounds($,H,G){r.fitBounds([[$[0],$[1]],[$[2],$[3]]],{padding:H,...G?{maxZoom:G}:{},...u})},indicateReverse($){r.getCanvasContainer().style.cursor=$?"crosshair":""},setReverseMarker($){!e||!t||(k?$?k.setLngLat($):(k.remove(),k=void 0):$&&(t instanceof Function?k=t(r)??void 0:(k=(typeof t=="object"?new e.Marker(t):V()).setLngLat($).addTo(r),k.getElement().classList.add("marker-reverse"))))},setFeatures($,H,G){for(const X of g)X.remove();if(g.length=0,P(void 0),!!e){if(H){let X=!1;if(H.geometry.type==="GeometryCollection"){const le=H.geometry.geometries.filter(xe=>xe.type==="Polygon"||xe.type==="MultiPolygon");e:if(le.length>0){const xe=u1(nh(le.map(Ie=>ih(Ie))));if(!xe)break e;kg({...H,geometry:xe.geometry},P),X=!0}else{const xe=H.geometry.geometries.filter(Ie=>Ie.type==="LineString"||Ie.type==="MultiLineString");xe.length>0&&(P({...H,geometry:{type:"GeometryCollection",geometries:xe}}),X=!0)}}if(!X){if(H.geometry.type==="Polygon"||H.geometry.type==="MultiPolygon")kg(H,P);else if(H.geometry.type==="LineString"||H.geometry.type==="MultiLineString"){P(H);return}}if(!G&&H.geometry.type!=="Point")return;if(t instanceof Function){const le=t(r,H);le&&g.push(le)}else t&&g.push(typeof t=="object"?new e.Marker(t):V().setLngLat(H.center).addTo(r))}if(o)for(const X of $??[]){if(X===H)continue;let le;if(o instanceof Function){if(le=o(r,X),!le)continue}else le=(typeof o=="object"?new e.Marker(o):V(!0)).setLngLat(X.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(X.place_type[0]==="reverse"?X.place_name:X.place_name.replace(/,.*/,""))).addTo(r);const xe=le.getElement();xe.addEventListener("click",Ie=>{Ie.stopPropagation(),a==null||a({type:"markerClick",id:X.id})}),xe.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:X.id}),le.togglePopup()}),xe.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:X.id}),le.togglePopup()}),g.push(le)}}},setSelectedMarker($){v&&v.getElement().classList.toggle("marker-selected",!1),v=$>-1?g[$]:void 0,v==null||v.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const $=r.getCenter();return[r.getZoom(),$.lng,$.lat]}}}function qx(r,e,t){var o,l;class u{constructor($,H){go(this,"type"),go(this,"target"),this.type=H,this.target=$}}class d extends u{constructor($,H){super($,"select"),go(this,"feature"),Object.assign(this,H)}}class a extends u{constructor($,H){super($,"featureslisted"),go(this,"features"),this.features=H}}class g extends u{constructor($,H){super($,"featuresmarked"),go(this,"features"),this.features=H}}class v extends u{constructor($,H){super($,"optionsvisibilitychange"),go(this,"optionsVisible"),this.optionsVisible=H}}class k extends u{constructor($,H){super($,"pick"),go(this,"feature"),this.feature=H}}class S extends u{constructor($,H){super($,"querychange"),go(this,"query"),this.query=H}}class E extends u{constructor($,H,G){super($,"response"),go(this,"url"),go(this,"featureCollection"),this.url=H,this.featureCollection=G}}class P extends u{constructor($,H){super($,"reversetoggle"),go(this,"reverse"),this.reverse=H}}class z extends r{constructor($={}){super(),V_(this,o),V_(this,l),q_(this,l,$)}onAddInt($){const H=document.createElement("div");H.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:G,showResultMarkers:X,flyTo:le,fullGeometryStyle:xe,...Ie}=Qn(this,l),Y=typeof le=="boolean"?{}:le,K={mapController:h1($,e,G,X,Y,Y,xe),flyTo:le===void 0?!0:!!le,apiKey:"",...t==null?void 0:t($,H),...Ie};if(!K.apiKey)throw new Error("no apiKey provided");return q_(this,o,new lx({target:H,props:K})),Qn(this,o).$on("select",ue=>{this.fire(new d(this,ue.detail))}),Qn(this,o).$on("pick",ue=>{this.fire(new k(this,ue.detail.feature))}),Qn(this,o).$on("featureslisted",ue=>{this.fire(new a(this,ue.detail.features))}),Qn(this,o).$on("featuresmarked",ue=>{this.fire(new g(this,ue.detail.features))}),Qn(this,o).$on("response",ue=>{this.fire(new E(this,ue.detail.url,ue.detail.featureCollection))}),Qn(this,o).$on("optionsvisibilitychange",ue=>{this.fire(new v(this,ue.detail.optionsVisible))}),Qn(this,o).$on("reversetoggle",ue=>{this.fire(new P(this,ue.detail.reverse))}),Qn(this,o).$on("querychange",ue=>{this.fire(new S(this,ue.detail.query))}),H}on($,H){return super.on($,H)}once($,H){return super.once($,H)}off($,H){return super.off($,H)}listens($){return super.listens($)}setOptions($){var H;Object.assign(Qn(this,l),$);const{marker:G,showResultMarkers:X,flyTo:le,fullGeometryStyle:xe,...Ie}=Qn(this,l);(H=Qn(this,o))==null||H.$set(Ie)}setQuery($,H=!0){var G;(G=Qn(this,o))==null||G.setQuery($,H)}clearMap(){var $;($=Qn(this,o))==null||$.clearMap()}clearList(){var $;($=Qn(this,o))==null||$.clearList()}setReverseMode($){var H;(H=Qn(this,o))==null||H.$set({reverseActive:$})}focus(){var $;($=Qn(this,o))==null||$.focus()}blur(){var $;($=Qn(this,o))==null||$.blur()}onRemove(){var $;($=Qn(this,o))==null||$.$destroy()}}return o=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:z,events:{SelectEvent:d,FeaturesListedEvent:a,FeaturesMarkedEvent:g,OptionsVisibilityChangeEvent:v,PickEvent:k,QueryChangeEvent:S,ResponseEvent:E,ReverseToggleEvent:P}}}const{MapLibreBasedGeocodingControl:cC,events:ka}=qx(Up.Evented,Yv);ka.SelectEvent;ka.FeaturesListedEvent;ka.FeaturesMarkedEvent;ka.OptionsVisibilityChangeEvent;ka.PickEvent;ka.QueryChangeEvent;ka.ResponseEvent;ka.ReverseToggleEvent;function Zx(r){let e,t;return{c(){e=ks("svg"),t=ks("path"),Fe(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Fe(e,"viewBox","0 0 14 14"),Fe(e,"width","13"),Fe(e,"height","13"),Fe(e,"class","svelte-en2qvf")},m(o,l){te(o,e,l),B(e,t)},p:We,i:We,o:We,d(o){o&&ee(e)}}}class d1 extends Wt{constructor(e){super(),Gt(this,e,null,Zx,Vt,{})}}function Gx(r){let e,t;return{c(){e=ks("svg"),t=ks("path"),Fe(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Fe(e,"viewBox","0 0 30 30"),Fe(e,"fill","none"),Fe(e,"xmlns","http://www.w3.org/2000/svg"),Fe(e,"class","svelte-d2loi5")},m(o,l){te(o,e,l),B(e,t)},p:We,i:We,o:We,d(o){o&&ee(e)}}}class f1 extends Wt{constructor(e){super(),Gt(this,e,null,Gx,Vt,{})}}function Wx(r){let e,t;return{c(){e=ie("img"),zr(e.src,t=r[3]+"area.svg")||Fe(e,"src",t),Fe(e,"alt",r[6]),Fe(e,"class","svelte-ltkwvy")},m(o,l){te(o,e,l)},p(o,l){l&8&&!zr(e.src,t=o[3]+"area.svg")&&Fe(e,"src",t),l&64&&Fe(e,"alt",o[6])},d(o){o&&ee(e)}}}function Hx(r){let e,t;return{c(){e=ie("img"),zr(e.src,t=r[3]+"reverse.svg")||Fe(e,"src",t),Fe(e,"alt",r[6]),Fe(e,"class","svelte-ltkwvy")},m(o,l){te(o,e,l)},p(o,l){l&8&&!zr(e.src,t=o[3]+"reverse.svg")&&Fe(e,"src",t),l&64&&Fe(e,"alt",o[6])},d(o){o&&ee(e)}}}function Xx(r){let e,t;return{c(){e=ie("img"),zr(e.src,t=r[3]+"poi.svg")||Fe(e,"src",t),Fe(e,"alt",r[6]),Fe(e,"class","svelte-ltkwvy")},m(o,l){te(o,e,l)},p(o,l){l&8&&!zr(e.src,t=o[3]+"poi.svg")&&Fe(e,"src",t),l&64&&Fe(e,"alt",o[6])},d(o){o&&ee(e)}}}function Kx(r){let e,t;return{c(){e=ie("img"),zr(e.src,t=r[3]+"postal_code.svg")||Fe(e,"src",t),Fe(e,"alt",r[6]),Fe(e,"class","svelte-ltkwvy")},m(o,l){te(o,e,l)},p(o,l){l&8&&!zr(e.src,t=o[3]+"postal_code.svg")&&Fe(e,"src",t),l&64&&Fe(e,"alt",o[6])},d(o){o&&ee(e)}}}function Jx(r){let e,t;return{c(){e=ie("img"),zr(e.src,t=r[3]+"street.svg")||Fe(e,"src",t),Fe(e,"alt",r[6]),Fe(e,"class","svelte-ltkwvy")},m(o,l){te(o,e,l)},p(o,l){l&8&&!zr(e.src,t=o[3]+"street.svg")&&Fe(e,"src",t),l&64&&Fe(e,"alt",o[6])},d(o){o&&ee(e)}}}function Yx(r){let e,t;return{c(){e=ie("img"),zr(e.src,t=r[3]+"road.svg")||Fe(e,"src",t),Fe(e,"alt",r[6]),Fe(e,"class","svelte-ltkwvy")},m(o,l){te(o,e,l)},p(o,l){l&8&&!zr(e.src,t=o[3]+"road.svg")&&Fe(e,"src",t),l&64&&Fe(e,"alt",o[6])},d(o){o&&ee(e)}}}function Qx(r){let e,t;return{c(){e=ie("img"),zr(e.src,t=r[3]+"housenumber.svg")||Fe(e,"src",t),Fe(e,"alt",r[6]),Fe(e,"class","svelte-ltkwvy")},m(o,l){te(o,e,l)},p(o,l){l&8&&!zr(e.src,t=o[3]+"housenumber.svg")&&Fe(e,"src",t),l&64&&Fe(e,"alt",o[6])},d(o){o&&ee(e)}}}function e2(r){let e,t,o,l;return{c(){e=ie("img"),zr(e.src,t=r[5])||Fe(e,"src",t),Fe(e,"alt",r[4]),Fe(e,"class","svelte-ltkwvy")},m(u,d){te(u,e,d),o||(l=wt(e,"error",r[14]),o=!0)},p(u,d){d&32&&!zr(e.src,t=u[5])&&Fe(e,"src",t),d&16&&Fe(e,"alt",u[4])},d(u){u&&ee(e),o=!1,l()}}}function Cg(r){let e,t;return{c(){e=ie("span"),t=we(r[6]),Fe(e,"class","secondary svelte-ltkwvy")},m(o,l){te(o,e,l),B(e,t)},p(o,l){l&64&&dt(t,o[6])},d(o){o&&ee(e)}}}function t2(r){let e,t,o,l,u,d,a,g,v,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,E,P=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],z,V,$=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",H,G,X;function le(K,ue){return ue&1&&(t=null),ue&1&&(o=null),ue&1&&(l=null),ue&1&&(u=null),K[5]?e2:K[0].address?Qx:(t==null&&(t=!!K[0].id.startsWith("road.")),t?Yx:(o==null&&(o=!!K[0].id.startsWith("address.")),o?Jx:(l==null&&(l=!!K[0].id.startsWith("postal_code.")),l?Kx:(u==null&&(u=!!K[0].id.startsWith("poi.")),u?Xx:K[7]?Hx:Wx))))}let xe=le(r,-1),Ie=xe(r),Y=P&&Cg(r);return{c(){e=ie("li"),Ie.c(),d=Se(),a=ie("span"),g=ie("span"),v=ie("span"),S=we(k),E=Se(),Y&&Y.c(),z=Se(),V=ie("span"),H=we($),Fe(v,"class","primary svelte-ltkwvy"),Fe(g,"class","svelte-ltkwvy"),Fe(V,"class","line2 svelte-ltkwvy"),Fe(a,"class","texts svelte-ltkwvy"),Fe(e,"tabindex","0"),Fe(e,"data-selected",r[1]),Fe(e,"class","svelte-ltkwvy"),dr(e,"selected",r[1])},m(K,ue){te(K,e,ue),Ie.m(e,null),B(e,d),B(e,a),B(a,g),B(g,v),B(v,S),B(g,E),Y&&Y.m(g,null),B(a,z),B(a,V),B(V,H),G||(X=[wt(e,"mouseenter",r[12]),wt(e,"focus",r[13])],G=!0)},p(K,[ue]){xe===(xe=le(K,ue))&&Ie?Ie.p(K,ue):(Ie.d(1),Ie=xe(K),Ie&&(Ie.c(),Ie.m(e,d))),ue&1&&k!==(k=(K[7]?K[0].place_name:K[0].place_name.replace(/,.*/,""))+"")&&dt(S,k),ue&37&&(P=K[2]==="always"||K[2]!=="never"&&!K[0].address&&!K[0].id.startsWith("road.")&&!K[0].id.startsWith("address.")&&!K[0].id.startsWith("postal_code.")&&(!K[0].id.startsWith("poi.")||!K[5])&&!K[7]),P?Y?Y.p(K,ue):(Y=Cg(K),Y.c(),Y.m(g,null)):Y&&(Y.d(1),Y=null),ue&1&&$!==($=(K[7]?"":K[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&dt(H,$),ue&2&&Fe(e,"data-selected",K[1]),ue&2&&dr(e,"selected",K[1])},i:We,o:We,d(K){K&&ee(e),Ie.d(),Y&&Y.d(),G=!1,cn(X)}}}function i2(r,e,t){var X;let o,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:a}=e,{missingIconsCache:g}=e,{iconsBaseUrl:v}=e;const k=(X=u.properties)==null?void 0:X.categories;let S,E,P=0,z=u.place_type[0]==="reverse";function V(){E&&g.add(E),t(10,P++,P)}function $(le){On.call(this,r,le)}function H(le){On.call(this,r,le)}const G=()=>V();return r.$$set=le=>{"feature"in le&&t(0,u=le.feature),"selected"in le&&t(1,d=le.selected),"showPlaceType"in le&&t(2,a=le.showPlaceType),"missingIconsCache"in le&&t(9,g=le.missingIconsCache),"iconsBaseUrl"in le&&t(3,v=le.iconsBaseUrl)},r.$$.update=()=>{var le,xe,Ie,Y;if(r.$$.dirty&3640)do t(11,o--,o),t(4,S=k==null?void 0:k[o]),t(5,E=S?v+S.replace(/ /g,"_")+".svg":void 0);while(o>-1&&(!E||g.has(E)));r.$$.dirty&1&&t(6,l=((xe=(le=u.properties)==null?void 0:le.categories)==null?void 0:xe.join(", "))??((Y=(Ie=u.properties)==null?void 0:Ie.place_type_name)==null?void 0:Y[0])??u.place_type[0])},t(11,o=(k==null?void 0:k.length)??0),[u,d,a,v,S,E,l,z,V,g,P,o,$,H,G]}class n2 extends Wt{constructor(e){super(),Gt(this,e,i2,t2,Vt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function r2(r){let e;return{c(){e=ie("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Fe(e,"class","svelte-7cmwmc")},m(t,o){te(t,e,o)},p:We,i:We,o:We,d(t){t&&ee(e)}}}class o2 extends Wt{constructor(e){super(),Gt(this,e,null,r2,Vt,{})}}function s2(r){let e,t;return{c(){e=ks("svg"),t=ks("path"),Fe(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Fe(e,"viewBox","0 0 60.006 21.412"),Fe(e,"width","14"),Fe(e,"height","20"),Fe(e,"class","svelte-en2qvf")},m(o,l){te(o,e,l),B(e,t)},p:We,i:We,o:We,d(o){o&&ee(e)}}}class a2 extends Wt{constructor(e){super(),Gt(this,e,null,s2,Vt,{})}}function l2(r){let e,t,o;return{c(){e=ks("svg"),t=ks("circle"),o=ks("path"),Fe(t,"cx","4.789"),Fe(t,"cy","4.787"),Fe(t,"r","3.85"),Fe(t,"class","svelte-1aq105l"),Fe(o,"d","M12.063 12.063 7.635 7.635"),Fe(o,"class","svelte-1aq105l"),Fe(e,"xmlns","http://www.w3.org/2000/svg"),Fe(e,"width","13"),Fe(e,"height","13"),Fe(e,"viewBox","0 0 13 13"),Fe(e,"class","svelte-1aq105l")},m(l,u){te(l,e,u),B(e,t),B(e,o)},p:We,i:We,o:We,d(l){l&&ee(e)}}}class c2 extends Wt{constructor(e){super(),Gt(this,e,null,l2,Vt,{})}}function u2(r,e,t){const o=e[1],l=e[0],u=o-l;return r===o&&t?r:((r-l)%u+u)%u+l}function Eg(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Bu;async function h2(r,e,t){const o=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(o&&(l.minZoom!=null&&l.minZoom>o[0]||l.maxZoom!=null&&l.maxZoom<o[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Bu&&l.cachedLocationExpiry&&Bu.time+l.cachedLocationExpiry>Date.now()){if(!Bu.coords)break e;return Bu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(g=>{d([g.coords.longitude,g.coords.latitude].map(v=>v.toFixed(6)).join(","))},g=>{a(g)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Bu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(o&&l.type==="map-center")return o[1].toFixed(6)+","+o[2].toFixed(6)}}const d2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Lg=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Mg=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,Ag=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Pg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,zg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function f2(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),o=Number(e[1]),l=Math.abs(t),u=Math.abs(o),d=t>0?"N":"S",a=o>0?"E":"W";let g;r=="DD"&&(g=`${l}° ${d}, ${u}° ${a}`);const v=Math.floor(l),k=Math.floor(u),S=(l-v)*60,E=(u-k)*60;if(r=="DM"){let P=Dg(S,3).toFixed(3).padStart(6,"0"),z=Dg(E,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&z.endsWith(".000")&&(P=P.replace(/\.000$/,""),z=z.replace(/\.000$/,"")),g=`${v}° ${P}' ${d}, ${k}° ${z}' ${a}`}if(r=="DMS"){const P=Math.floor(S),z=Math.floor(E);let V=((S-P)*60).toFixed(1).padStart(4,"0"),$=((E-z)*60).toFixed(1).padStart(4,"0");const H=P.toString().padStart(2,"0"),G=z.toString().padStart(2,"0");V.endsWith(".0")&&$.endsWith(".0")&&(V=V.replace(/\.0$/,""),$=$.replace(/\.0$/,"")),g=`${v}° ${H}' ${V}" ${d}, ${k}° ${G}' ${$}" ${a}`}return g}else throw new Error("no decimal coordinates to convert")}function Dg(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Gp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,o=null,l="",u="",d=null,a=[],g=!1;if(d2.test(r))throw new Error("invalid coordinate value");if(Lg.test(r))if(a=Lg.exec(r),g=Ou(a),g)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),o=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(o*=-1),d="DM";else throw new Error("invalid coordinate format");else if(Mg.test(r))if(a=Mg.exec(r),g=Ou(a),g){if(t=a[2],o=a[6],t.includes(",")&&(t=t.replace(",",".")),o.includes(",")&&(o=o.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(o))==Number(o))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(Ag.test(r))if(a=Ag.exec(r),g=Ou(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),o=Math.abs(parseInt(a[9])),a[11]&&(o+=a[11]/60),a[13]&&(o+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(o=-1*o),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(Pg.test(r))if(a=Pg.exec(r),g=Ou(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12]/60),a[14]&&(o+=a[14]/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(zg.test(r)){if(a=zg.exec(r),g=Ou(a),a.filter(v=>v).length<=5)throw new Error("invalid coordinates format");if(g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12].replace(",",".")/60),a[14]&&(o+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(g){if(Math.abs(o)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),o.toString().includes(",")&&(o=o.replace(",","."));let v=/S|SOUTH/i;v.test(l)&&t>0&&(t=-1*t),v=/W|WEST/i,v.test(u)&&o>0&&(o=-1*o);const k=a[0].trim();let S,E;const P=/[,/;\u0020]/g,z=k.match(P);if(z==null){const H=Math.floor(r.length/2);S=k.substring(0,H).trim(),E=k.substring(H).trim()}else{let H;z.length%2==1?H=Math.floor(z.length/2):H=z.length/2-1;let G=0;if(H==0)G=k.indexOf(z[0]),S=k.substring(0,G).trim(),E=k.substring(G+1).trim();else{let X=0,le=0;for(;X<=H;)G=k.indexOf(z[X],le),le=G+1,X++;S=k.substring(0,G).trim(),E=k.substring(G+1).trim()}}const V=S.split(".");if(V.length==2&&V[1]==0&&V[1].length!=2)throw new Error("invalid coordinates format");const $=E.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),o=Number(Number(o).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:t,decimalLongitude:o,decimalCoordinates:`${t},${o}`,originalFormat:d,closeEnough:p2,toCoordinateFormat:f2})}else throw new Error("coordinates pattern match failed")}function Ou(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,o=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],g=t.test(d)&&t.test(a),v=o.test(d)&&o.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(g||v||k)continue;return!1}}return!0}function Rg(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function p2(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return Rg(this.decimalLatitude,Number(e[0]))&&Rg(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const m2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Gp.to=m2;const _2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],g2={decimalLatitude:40.123,decimalLongitude:-74.123},y2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],b2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function v2(){const r=[];return _2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...g2})}),[...r,...y2,...b2]}const w2=v2();Gp.formats=w2.map(r=>r.verbatimCoordinates);const x2=Gp;function Fg(r,e,t){const o=r.slice();return o[84]=e[t],o[86]=t,o}function Bg(r){let e,t;return e=new o2({}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function Og(r){let e,t,o,l,u;return t=new a2({}),{c(){e=ie("button"),Ue(t.$$.fragment),Fe(e,"type","button"),Fe(e,"title",r[9]),Fe(e,"class","svelte-bz0zu3"),dr(e,"active",r[0])},m(d,a){te(d,e,a),Ne(t,e,null),o=!0,l||(u=wt(e,"click",r[69]),l=!0)},p(d,a){(!o||a[0]&512)&&Fe(e,"title",d[9]),(!o||a[0]&1)&&dr(e,"active",d[0])},i(d){o||(se(t.$$.fragment,d),o=!0)},o(d){de(t.$$.fragment,d),o=!1},d(d){d&&ee(e),je(t),l=!1,u()}}}function k2(r){let e,t=[],o=new Map,l,u,d,a=yi(r[14]);const g=v=>v[84].id+(v[84].address?","+v[84].address:"");for(let v=0;v<a.length;v+=1){let k=Fg(r,a,v),S=g(k);o.set(S,t[v]=Ng(S,k))}return{c(){e=ie("ul");for(let v=0;v<t.length;v+=1)t[v].c();Fe(e,"class","options svelte-bz0zu3")},m(v,k){te(v,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[wt(e,"mouseleave",r[73]),wt(e,"blur",r[74])],u=!0)},p(v,k){k[0]&17880064&&(a=yi(v[14]),Li(),t=Gv(t,k,g,1,v,a,o,e,Zv,Ng,null,Fg),Mi())},i(v){if(!l){for(let k=0;k<a.length;k+=1)se(t[k]);l=!0}},o(v){for(let k=0;k<t.length;k+=1)de(t[k]);l=!1},d(v){v&&ee(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,cn(d)}}}function S2(r){let e,t,o,l,u,d;return t=new f1({}),{c(){e=ie("div"),Ue(t.$$.fragment),o=Se(),l=ie("div"),u=we(r[7]),Fe(l,"class","svelte-bz0zu3"),Fe(e,"class","no-results svelte-bz0zu3")},m(a,g){te(a,e,g),Ne(t,e,null),B(e,o),B(e,l),B(l,u),d=!0},p(a,g){(!d||g[0]&128)&&dt(u,a[7])},i(a){d||(se(t.$$.fragment,a),d=!0)},o(a){de(t.$$.fragment,a),d=!1},d(a){a&&ee(e),je(t)}}}function T2(r){let e="",t;return{c(){t=we(e)},m(o,l){te(o,t,l)},p:We,i:We,o:We,d(o){o&&ee(t)}}}function I2(r){let e,t,o,l,u,d,a,g,v,k,S;return t=new f1({}),g=new d1({}),{c(){e=ie("div"),Ue(t.$$.fragment),o=Se(),l=ie("div"),u=we(r[6]),d=Se(),a=ie("button"),Ue(g.$$.fragment),Fe(l,"class","svelte-bz0zu3"),Fe(a,"class","svelte-bz0zu3"),Fe(e,"class","error svelte-bz0zu3")},m(E,P){te(E,e,P),Ne(t,e,null),B(e,o),B(e,l),B(l,u),B(e,d),B(e,a),Ne(g,a,null),v=!0,k||(S=wt(a,"click",r[70]),k=!0)},p(E,P){(!v||P[0]&64)&&dt(u,E[6])},i(E){v||(se(t.$$.fragment,E),se(g.$$.fragment,E),v=!0)},o(E){de(t.$$.fragment,E),de(g.$$.fragment,E),v=!1},d(E){E&&ee(e),je(t),je(g),k=!1,S()}}}function Ng(r,e){let t,o,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return o=new n2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),o.$on("mouseenter",u),o.$on("focus",d),{key:r,first:null,c(){t=tn(),Ue(o.$$.fragment),this.first=t},m(a,g){te(a,t,g),Ne(o,a,g),l=!0},p(a,g){e=a;const v={};g[0]&16384&&(v.feature=e[84]),g[0]&1024&&(v.showPlaceType=e[10]),g[0]&49152&&(v.selected=e[15]===e[86]),g[0]&4096&&(v.iconsBaseUrl=e[12]),o.$set(v)},i(a){l||(se(o.$$.fragment,a),l=!0)},o(a){de(o.$$.fragment,a),l=!1},d(a){a&&ee(t),je(o,a)}}}function C2(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie=!1;u=new c2({}),S=new d1({});let Y=r[19]&&Bg(),K=r[5]==="button"&&Og(r);const ue=r[61].default,fe=bn(ue,r,r[60],null),ce=[I2,T2,S2,k2],ae=[];function Ge(Le,Pe){var rt,it;return Le[18]?0:Le[16]?((rt=Le[14])==null?void 0:rt.length)===0?2:Le[16]&&((it=Le[14])!=null&&it.length)?3:-1:1}return~($=Ge(r))&&(H=ae[$]=ce[$](r)),{c(){e=Se(),t=ie("form"),o=ie("div"),l=ie("button"),Ue(u.$$.fragment),d=Se(),a=ie("input"),g=Se(),v=ie("div"),k=ie("button"),Ue(S.$$.fragment),E=Se(),Y&&Y.c(),P=Se(),K&&K.c(),z=Se(),fe&&fe.c(),V=Se(),H&&H.c(),Fe(l,"class","search-button svelte-bz0zu3"),Fe(l,"type","button"),Fe(a,"placeholder",r[8]),Fe(a,"aria-label",r[8]),Fe(a,"class","svelte-bz0zu3"),Fe(k,"type","button"),Fe(k,"title",r[3]),Fe(k,"class","svelte-bz0zu3"),Fe(v,"class","clear-button-container svelte-bz0zu3"),dr(v,"displayable",r[1]!==""),Fe(o,"class","input-group svelte-bz0zu3"),Fe(t,"tabindex","0"),Fe(t,"class",G=Cd(r[2])+" svelte-bz0zu3"),dr(t,"can-collapse",r[4]&&r[1]==="")},m(Le,Pe){te(Le,e,Pe),te(Le,t,Pe),B(t,o),B(o,l),Ne(u,l,null),B(o,d),B(o,a),r[63](a),Gi(a,r[1]),B(o,g),B(o,v),B(v,k),Ne(S,k,null),B(v,E),Y&&Y.m(v,null),B(o,P),K&&K.m(o,null),B(o,z),fe&&fe.m(o,null),B(t,V),~$&&ae[$].m(t,null),X=!0,le||(xe=[wt(l,"click",r[62]),wt(a,"input",r[64]),wt(a,"focus",r[65]),wt(a,"blur",r[66]),wt(a,"keydown",r[22]),wt(a,"input",r[67]),wt(k,"click",r[68]),wt(t,"submit",lh(r[21]))],le=!0)},p(Le,Pe){(!X||Pe[0]&256)&&Fe(a,"placeholder",Le[8]),(!X||Pe[0]&256)&&Fe(a,"aria-label",Le[8]),Pe[0]&2&&a.value!==Le[1]&&Gi(a,Le[1]),(!X||Pe[0]&8)&&Fe(k,"title",Le[3]),Le[19]?Y?Pe[0]&524288&&se(Y,1):(Y=Bg(),Y.c(),se(Y,1),Y.m(v,null)):Y&&(Li(),de(Y,1,1,()=>{Y=null}),Mi()),(!X||Pe[0]&2)&&dr(v,"displayable",Le[1]!==""),Le[5]==="button"?K?(K.p(Le,Pe),Pe[0]&32&&se(K,1)):(K=Og(Le),K.c(),se(K,1),K.m(o,z)):K&&(Li(),de(K,1,1,()=>{K=null}),Mi()),fe&&fe.p&&(!X||Pe[1]&536870912)&&wn(fe,ue,Le,Le[60],X?vn(ue,Le[60],Pe,null):xn(Le[60]),null);let rt=$;$=Ge(Le),$===rt?~$&&ae[$].p(Le,Pe):(H&&(Li(),de(ae[rt],1,1,()=>{ae[rt]=null}),Mi()),~$?(H=ae[$],H?H.p(Le,Pe):(H=ae[$]=ce[$](Le),H.c()),se(H,1),H.m(t,null)):H=null),(!X||Pe[0]&4&&G!==(G=Cd(Le[2])+" svelte-bz0zu3"))&&Fe(t,"class",G),(!X||Pe[0]&22)&&dr(t,"can-collapse",Le[4]&&Le[1]==="")},i(Le){X||(se(Ie),se(u.$$.fragment,Le),se(S.$$.fragment,Le),se(Y),se(K),se(fe,Le),se(H),X=!0)},o(Le){de(Ie),de(u.$$.fragment,Le),de(S.$$.fragment,Le),de(Y),de(K),de(fe,Le),de(H),X=!1},d(Le){Le&&(ee(e),ee(t)),je(u),r[63](null),je(S),Y&&Y.d(),K&&K.d(),fe&&fe.d(Le),~$&&ae[$].d(),le=!1,cn(xe)}}}function E2(r,e,t){let o,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:g=void 0}=e,{apiKey:v}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:E=!1}=e,{collapsed:P=!1}=e,{country:z=void 0}=e,{debounceSearch:V=200}=e,{enableReverse:$="never"}=e,{errorMessage:H="Something went wrong…"}=e,{filter:G=()=>!0}=e,{flyTo:X=!0}=e,{fuzzyMatch:le=!0}=e,{language:xe=void 0}=e,{limit:Ie=void 0}=e,{mapController:Y=void 0}=e,{minLength:K=2}=e,{noResultsMessage:ue="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:fe="Search"}=e,{proximity:ce=[{type:"server-geolocation"}]}=e,{reverseActive:ae=$==="always"}=e,{reverseButtonTitle:Ge="toggle reverse geocoding"}=e,{searchValue:Le=""}=e,{pickedResultStyle:Pe="full-geometry"}=e,{showPlaceType:rt="if-needed"}=e,{showResultsWhileTyping:it=!0}=e,{selectFirst:Qe=!0}=e,{flyToSelected:Ft=!1}=e,{markerOnSelected:jt=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:et=!1}=e,{excludeTypes:at=!1}=e,{zoom:Bt=a}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ht={}}=e,{iconsBaseUrl:li="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:ai=()=>{}}=e;function ki(){Ce.focus()}function Fi(){Ce.blur()}function bi(j,Re=!0,Ke=!1){t(1,Le=j),Re?(t(15,nt=-1),tr()):(In(!Ke,Ke),setTimeout(()=>{Ce.focus(),Ce.select()}))}function di(){t(14,st=void 0),t(56,pt=void 0),t(15,nt=-1)}function lt(){t(55,Te=[]),t(56,pt=void 0)}let qe=!1,st,Te,pt,gt="",Ce,nt=-1,Xt,vi=[],ji,Ci,_i,Bi;const br=new Set,ct=bc();Po(()=>{Y&&(Y.setEventHandler(void 0),Y.indicateReverse(!1),Y.setSelectedMarker(-1),Y.setFeatures(void 0,void 0,!1))});function tr(j){if(Ci&&(clearTimeout(Ci),Ci=void 0),nt>-1&&st)t(56,pt=st[nt]),t(1,Le=pt.place_type[0]==="reverse"?pt.place_name:pt.place_name.replace(/,.*/,"")),t(18,Xt=void 0),t(55,Te=void 0),t(15,nt=-1);else if(Le){const Re=j||!_n(Le);qn(Le,{exact:!0}).then(()=>{t(55,Te=st),t(56,pt=void 0),Re&&Wr()}).catch(Ke=>t(18,Xt=Ke))}}function _n(j){try{return x2(j,6)}catch{return!1}}async function qn(j,{byId:Re=!1,exact:Ke=!1}={}){t(18,Xt=void 0),ji==null||ji.abort();const $e=new AbortController;t(19,ji=$e);try{const Xe=_n(j),mt=new URLSearchParams;if(xe!==void 0&&mt.set("language",Array.isArray(xe)?xe.join(","):xe??""),ut&&mt.set("types",ut.join(",")),at&&mt.set("excludeTypes",String(at)),k&&mt.set("bbox",k.map(hi=>hi.toFixed(6)).join(",")),z&&mt.set("country",Array.isArray(z)?z.join(","):z),!Re&&!Xe){const hi=await h2(Y,ce,$e);hi&&mt.set("proximity",hi),(Ke||!it)&&mt.set("autocomplete","false"),mt.set("fuzzyMatch",String(le))}Ie!==void 0&&(et||!Xe||(ut==null?void 0:ut.length)===1)&&mt.set("limit",String(Ie)),mt.set("key",v),ai(mt);const Et=Dt+"/"+encodeURIComponent(Xe?Xe.decimalLongitude+","+Xe.decimalLatitude:j)+".json?"+mt.toString();if(Et===gt){Re?(t(14,st=void 0),t(56,pt=vi[0])):t(14,st=vi);return}gt=Et;const pi=await fetch(Et,{signal:$e.signal,...Ht});if(!pi.ok)throw new Error(await pi.text());const Qt=await pi.json();ct("response",{url:Et,featureCollection:Qt}),Re?(t(14,st=void 0),t(56,pt=Qt.features[0]),vi=[pt]):(t(14,st=Qt.features.filter(G)),Xe&&st.unshift({type:"Feature",properties:{},id:"reverse_"+Xe.decimalLongitude+"_"+Xe.decimalLatitude,text:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_name:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_type:["reverse"],center:[Xe.decimalLongitude,Xe.decimalLatitude],bbox:[Xe.decimalLongitude,Xe.decimalLatitude,Xe.decimalLongitude,Xe.decimalLatitude],geometry:{type:"Point",coordinates:[Xe.decimalLongitude,Xe.decimalLatitude]}}),vi=st,Xe&&Ce.focus())}catch(Xe){if(Xe&&typeof Xe=="object"&&"name"in Xe&&Xe.name==="AbortError")return;throw Xe}finally{$e===ji&&t(19,ji=void 0)}}function Wr(){var $e;if(!(Te!=null&&Te.length)||!X)return;const j=[180,90,-180,-90],Re=!Te.some(Xe=>!Xe.matching_text);let Ke;for(const Xe of Te){const mt=bt(Xe);if(Ke=Ke===void 0?mt:mt===void 0?Ke:Math.max(Ke,mt),Re||!Xe.matching_text)for(const Et of[0,1,2,3])j[Et]=Math[Et<2?"min":"max"](j[Et],(($e=Xe.bbox)==null?void 0:$e[Et])??Xe.center[Et%2])}Y&&Te.length>0&&(pt&&j[0]===j[2]&&j[1]===j[3]?Y.flyTo(pt.center,bt(pt)):Y.fitBounds(Eg(j),50,Ke))}function bt(j){var Ke;if(!j.bbox||j.bbox[0]!==j.bbox[2]&&j.bbox[1]!==j.bbox[3])return;const Re=j.id.replace(/\..*/,"");return(Array.isArray((Ke=j.properties)==null?void 0:Ke.categories)?j.properties.categories.reduce(($e,Xe)=>{const mt=Bt[Re+"."+Xe];return $e===void 0?mt:mt===void 0?$e:Math.max($e,mt)},void 0):void 0)??Bt[Re]}function ci(j){t(0,ae=$==="always"),t(14,st=void 0),t(56,pt=void 0),t(15,nt=-1),bi(j[1].toFixed(6)+", "+u2(j[0],[-180,180],!0).toFixed(6),!1,!0)}function Jt(j){if(!st)return;let Re=j.key==="ArrowDown"?1:j.key==="ArrowUp"?-1:0;Re&&(nt===(Qe?0:-1)&&Re===-1&&t(15,nt=st.length),t(15,nt+=Re),nt>=st.length&&t(15,nt=-1),nt<0&&Qe&&t(15,nt=0),j.preventDefault())}function In(j=!0,Re=!1){if(t(18,Xt=void 0),it||Re){if(Ci&&clearTimeout(Ci),Le.length<K)return;const Ke=Le;Ci=window.setTimeout(()=>{qn(Ke).catch($e=>t(18,Xt=$e))},j?V:0)}else t(14,st=void 0),t(18,Xt=void 0)}function Nn(j){t(56,pt=j),t(1,Le=j.place_name),t(15,nt=-1)}const ei=()=>Ce.focus();function vr(j){oi[j?"unshift":"push"](()=>{Ce=j,t(17,Ce)})}function Fr(){Le=this.value,t(1,Le),t(13,qe),t(28,E)}const Hr=()=>t(13,qe=!0),wr=()=>t(13,qe=!1),ye=()=>In(),Z=()=>{t(1,Le=""),Ce.focus()},q=()=>t(0,ae=!ae),ne=()=>t(18,Xt=void 0),pe=j=>t(15,nt=j),Me=j=>Nn(j),ze=()=>{Qe||t(15,nt=-1)},Ve=()=>{};return r.$$set=j=>{"class"in j&&t(2,g=j.class),"apiKey"in j&&t(26,v=j.apiKey),"bbox"in j&&t(27,k=j.bbox),"clearButtonTitle"in j&&t(3,S=j.clearButtonTitle),"clearOnBlur"in j&&t(28,E=j.clearOnBlur),"collapsed"in j&&t(4,P=j.collapsed),"country"in j&&t(29,z=j.country),"debounceSearch"in j&&t(30,V=j.debounceSearch),"enableReverse"in j&&t(5,$=j.enableReverse),"errorMessage"in j&&t(6,H=j.errorMessage),"filter"in j&&t(31,G=j.filter),"flyTo"in j&&t(32,X=j.flyTo),"fuzzyMatch"in j&&t(33,le=j.fuzzyMatch),"language"in j&&t(34,xe=j.language),"limit"in j&&t(35,Ie=j.limit),"mapController"in j&&t(36,Y=j.mapController),"minLength"in j&&t(37,K=j.minLength),"noResultsMessage"in j&&t(7,ue=j.noResultsMessage),"placeholder"in j&&t(8,fe=j.placeholder),"proximity"in j&&t(38,ce=j.proximity),"reverseActive"in j&&t(0,ae=j.reverseActive),"reverseButtonTitle"in j&&t(9,Ge=j.reverseButtonTitle),"searchValue"in j&&t(1,Le=j.searchValue),"pickedResultStyle"in j&&t(39,Pe=j.pickedResultStyle),"showPlaceType"in j&&t(10,rt=j.showPlaceType),"showResultsWhileTyping"in j&&t(40,it=j.showResultsWhileTyping),"selectFirst"in j&&t(11,Qe=j.selectFirst),"flyToSelected"in j&&t(41,Ft=j.flyToSelected),"markerOnSelected"in j&&t(42,jt=j.markerOnSelected),"types"in j&&t(43,ut=j.types),"exhaustiveReverseGeocoding"in j&&t(44,et=j.exhaustiveReverseGeocoding),"excludeTypes"in j&&t(45,at=j.excludeTypes),"zoom"in j&&t(46,Bt=j.zoom),"apiUrl"in j&&t(47,Dt=j.apiUrl),"fetchParameters"in j&&t(48,Ht=j.fetchParameters),"iconsBaseUrl"in j&&t(12,li=j.iconsBaseUrl),"adjustUrlQuery"in j&&t(49,ai=j.adjustUrlQuery),"$$scope"in j&&t(60,d=j.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=$==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,_i=qe),E&&!qe&&t(1,Le="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Le.length<K&&(t(56,pt=void 0),t(14,st=void 0),t(18,Xt=void 0),t(55,Te=st)),r.$$.dirty[1]&33554688&&Pe!=="marker-only"&&pt&&!pt.address&&pt.geometry.type==="Point"&&pt.place_type[0]!=="reverse"&&qn(pt.id,{byId:!0}).catch(j=>t(18,Xt=j)),r.$$.dirty[1]&100663330&&(Y&&pt&&pt.id!==Bi&&X&&(!pt.bbox||pt.bbox[0]===pt.bbox[2]&&pt.bbox[1]===pt.bbox[3]?Y.flyTo(pt.center,bt(pt)):Y.fitBounds(Eg(pt.bbox),50,bt(pt)),t(14,st=void 0),t(55,Te=void 0),t(15,nt=-1)),t(57,Bi=pt==null?void 0:pt.id)),r.$$.dirty[0]&18432&&Qe&&st!=null&&st.length&&t(15,nt=0),r.$$.dirty[0]&2&&t(15,nt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Te!==st&&t(55,Te=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&Y&&Y.setEventHandler(j=>{switch(j.type){case"mapClick":ae&&ci(j.coordinates);break;case"markerClick":{const Re=st==null?void 0:st.find(Ke=>Ke.id===j.id);Re&&Nn(Re)}break;case"markerMouseEnter":Te&&t(15,nt=_i?(st==null?void 0:st.findIndex(Re=>Re.id===j.id))??-1:-1);break;case"markerMouseLeave":Te&&t(15,nt=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=st==null?void 0:st[nt]),r.$$.dirty[1]&134218786&&Y&&l&&X&&Ft&&Y.flyTo(l.center,bt(l)),r.$$.dirty[1]&256&&t(59,o=Pe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(jt||Y==null||Y.setFeatures(void 0,void 0,o)),r.$$.dirty[1]&419432480&&Y&&jt&&!Te&&(Y.setFeatures(l?[l]:void 0,void 0,o),Y.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&Y&&Y.setFeatures(Te,pt,o),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Te&&Y&&Y.setSelectedMarker(nt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&Y){const j=_n(Le);Y.setReverseMarker(j?[j.decimalLongitude,j.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&ct("select",{feature:l}),r.$$.dirty[1]&33554432&&ct("pick",{feature:pt}),r.$$.dirty[0]&81920&&ct("optionsvisibilitychange",{optionsVisible:_i&&!!st}),r.$$.dirty[0]&16384&&ct("featureslisted",{features:st}),r.$$.dirty[1]&16777216&&ct("featuresmarked",{features:Te}),r.$$.dirty[0]&1&&ct("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&ct("querychange",{query:Le}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&Y&&Y.indicateReverse(ae)},[ae,Le,g,S,P,$,H,ue,fe,Ge,rt,Qe,li,qe,st,nt,_i,Ce,Xt,ji,br,tr,Jt,In,Nn,a,v,k,E,z,V,G,X,le,xe,Ie,Y,K,ce,Pe,it,Ft,jt,ut,et,at,Bt,Dt,Ht,ai,ki,Fi,bi,di,lt,Te,pt,Bi,l,o,d,u,ei,vr,Fr,Hr,wr,ye,Z,q,ne,pe,Me,ze,Ve]}class L2 extends Wt{constructor(e){super(),Gt(this,e,E2,C2,Vt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function jg(r){let e,t,o;return t=new L2({props:{mapController:r[2],apiKey:r[0],country:r[1],proximity:[{type:"map-center"}]}}),{c(){e=ie("div"),Ue(t.$$.fragment),Fe(e,"class","svelte-ixhnie")},m(l,u){te(l,e,u),Ne(t,e,null),o=!0},p(l,u){const d={};u&4&&(d.mapController=l[2]),u&1&&(d.apiKey=l[0]),u&2&&(d.country=l[1]),t.$set(d)},i(l){o||(se(t.$$.fragment,l),o=!0)},o(l){de(t.$$.fragment,l),o=!1},d(l){l&&ee(e),je(t)}}}function M2(r){let e,t,o=r[2]&&jg(r);return{c(){o&&o.c(),e=tn()},m(l,u){o&&o.m(l,u),te(l,e,u),t=!0},p(l,[u]){l[2]?o?(o.p(l,u),u&4&&se(o,1)):(o=jg(l),o.c(),se(o,1),o.m(e.parentNode,e)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d(l)}}}function A2(r,e,t){let o,{apiKey:l}=e,{map:u}=e,{country:d}=e;function a(g){return g?h1(g,Pr,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=g=>{"apiKey"in g&&t(0,l=g.apiKey),"map"in g&&t(3,u=g.map),"country"in g&&t(1,d=g.country)},r.$$.update=()=>{r.$$.dirty&8&&t(2,o=a(u))},[l,d,o,u]}class P2 extends Wt{constructor(e){super(),Gt(this,e,A2,M2,Vt,{apiKey:0,map:3,country:1})}}const ic=[];function up(r,e){return{subscribe:Ei(r,e).subscribe}}function Ei(r,e=We){let t;const o=new Set;function l(a){if(Vt(r,a)&&(r=a,t)){const g=!ic.length;for(const v of o)v[1](),ic.push(v,r);if(g){for(let v=0;v<ic.length;v+=2)ic[v][0](ic[v+1]);ic.length=0}}}function u(a){l(a(r))}function d(a,g=We){const v=[a,g];return o.add(v),o.size===1&&(t=e(l,u)||We),a(r),()=>{o.delete(v),o.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}const z2=Symbol.for("svelte-maplibre");function D2(){return G0(z2)}function R2(r){return"layerType"in r&&r.layerType==="deckgl"}var oh=F2;function F2(r){var e,t,o;if(r){if(Array.isArray(r)){for(e=[],t=r.length,o=0;o<t;o++){var l=r[o];l!=null&&e.push(l)}return e}if(typeof r=="object"){e={};var u=Object.keys(r);for(t=u.length,o=0;o<t;o++){var d=u[o],a=r[d];a!=null&&(e[d]=a)}return e}}}var nc=Wp;function Wp(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?Ug(r,e):{}.toString.call(r)=="[object Set]"?Ug(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?O2(r,e):B2(r,e)}function B2(r,e){return r.toString()===e.toString()}function Ug(r,e){var t=r.length;if(t!=e.length)return!1;for(var o=0;o<t;o++)if(!Wp(r[o],e[o]))return!1;return!0}function O2(r,e){var t=Object.keys(r),o=t.length;if(o!=Object.keys(e).length)return!1;for(var l=0;l<o;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Wp(r[u],e[u])))return!1}return!0}const N2=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),$g=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function Vg(r){let e,t,o=(r[4]||r[3]instanceof Pr.Marker)&&qg(r);return{c(){e=ie("div"),o&&o.c()},m(l,u){te(l,e,u),o&&o.m(e,null),r[32](e),t=!0},p(l,u){l[4]||l[3]instanceof Pr.Marker?o?(o.p(l,u),u[0]&24&&se(o,1)):(o=qg(l),o.c(),se(o,1),o.m(e,null)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d(),r[32](null)}}}function qg(r){let e;const t=r[30].default,o=bn(t,r,r[29],$g);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u[0]&536870933)&&wn(o,t,l,l[29],e?vn(t,l[29],u,N2):xn(l[29]),$g)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function j2(r){let e,t,o=r[9].default&&Vg(r);return{c(){o&&o.c(),e=tn()},m(l,u){o&&o.m(l,u),te(l,e,u),t=!0},p(l,u){l[9].default?o?(o.p(l,u),u[0]&512&&se(o,1)):(o=Vg(l),o.c(),se(o,1),o.m(e.parentNode,e)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d(l)}}}function U2(r,e,t){let o,l,u,d,a,g,{$$slots:v={},$$scope:k}=e;const S=Nv(v);let{closeButton:E=void 0}=e,{closeOnClickOutside:P=!0}=e,{closeOnClickInside:z=!1}=e,{closeOnMove:V=!1}=e,{openOn:$="click"}=e,{openIfTopMost:H=!0}=e,{focusAfterOpen:G=!0}=e,{anchor:X=void 0}=e,{offset:le=void 0}=e,{popupClass:xe=void 0}=e,{maxWidth:Ie=void 0}=e,{lngLat:Y=void 0}=e,{html:K=void 0}=e,{open:ue=!1}=e;const fe=bc(),{map:ce,popupTarget:ae,layerEvent:Ge,layer:Le,eventTopMost:Pe}=D2();yt(r,ce,qe=>t(2,u=qe)),yt(r,ae,qe=>t(3,a=qe)),yt(r,Ge,qe=>t(28,d=qe)),yt(r,Le,qe=>t(35,g=qe));const rt=["click","dblclick","contextmenu"];let it,Qe=!1,Ft;function jt(){if(!it)return;let qe=it.getElement();!qe||qe===Ft||(Ft=qe,$==="hover"&&(Ft.style.pointerEvents="none"),Ft.addEventListener("mouseenter",()=>{t(24,Qe=!0)},{passive:!0}),Ft.addEventListener("mouseleave",()=>{t(24,Qe=!1)},{passive:!0}),Ft.addEventListener("click",()=>{z&&t(0,ue=!1)},{passive:!0}))}yc(()=>{if(u)return u.on("click",Fi),u.on("contextmenu",Fi),typeof a=="string"&&(u.on("click",a,Bt),u.on("dblclick",a,Bt),u.on("contextmenu",a,Bt),u.on("mousemove",a,ki),u.on("mouseleave",a,ai),u.on("touchstart",a,Ht),u.on("touchend",a,li)),()=>{u!=null&&u.loaded()&&(it==null||it.remove(),u.off("click",Fi),u.off("contextmenu",Fi),a instanceof Pr.Marker?a.getPopup()===it&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Bt),u.off("dblclick",a,Bt),u.off("contextmenu",a,Bt),u.off("mousemove",a,ki),u.off("mouseleave",a,ai),u.off("touchstart",a,Ht),u.off("touchend",a,li)))}});function ut(qe){return H?!("marker"in qe)&&!R2(qe)&&Pe(qe)!==g:!1}let et=null,at="normal";function Bt(qe){qe.type===$&&(ut(qe)||("layerType"in qe?qe.layerType==="deckgl"?(t(10,Y=qe.coordinate),t(4,et=qe.object?[qe.object]:null)):(t(10,Y=qe.lngLat),t(4,et=qe.features??[])):(t(10,Y=qe.lngLat),t(4,et=qe.features??[])),setTimeout(()=>t(0,ue=!0))))}let Dt=null;function Ht(qe){Dt=qe.point}function li(qe){if(!Dt||$!=="hover")return;let st=Dt.dist(qe.point);Dt=null,st<3&&(t(10,Y=qe.lngLat),t(4,et=qe.features??[]),it.isOpen()?t(25,at="justOpened"):(t(25,at="opening"),t(0,ue=!0)))}function ai(qe){$!=="hover"||Dt||at!=="normal"||(t(0,ue=!1),t(4,et=null))}function ki(qe){if(!($!=="hover"||Dt||at!=="normal")){if(ut(qe)){t(0,ue=!1),t(4,et=null);return}t(0,ue=!0),t(4,et=qe.features??[]),t(10,Y=qe.lngLat)}}function Fi(qe){if(at==="justOpened"){t(25,at="normal");return}if(!P)return;let st=[Ft,a instanceof Pr.Marker?a==null?void 0:a.getElement():null];ue&&it.isOpen()&&!st.some(Te=>Te==null?void 0:Te.contains(qe.originalEvent.target))&&(qe.type==="contextmenu"&&$==="contextmenu"||qe.type!=="contextmenu")&&t(0,ue=!1)}Po(()=>{u&&(it!=null&&it.isOpen())&&it.remove()});let bi;const di=()=>t(0,ue=!1);function lt(qe){oi[qe?"unshift":"push"](()=>{bi=qe,t(1,bi)})}return r.$$set=qe=>{"closeButton"in qe&&t(11,E=qe.closeButton),"closeOnClickOutside"in qe&&t(12,P=qe.closeOnClickOutside),"closeOnClickInside"in qe&&t(13,z=qe.closeOnClickInside),"closeOnMove"in qe&&t(14,V=qe.closeOnMove),"openOn"in qe&&t(15,$=qe.openOn),"openIfTopMost"in qe&&t(16,H=qe.openIfTopMost),"focusAfterOpen"in qe&&t(17,G=qe.focusAfterOpen),"anchor"in qe&&t(18,X=qe.anchor),"offset"in qe&&t(19,le=qe.offset),"popupClass"in qe&&t(20,xe=qe.popupClass),"maxWidth"in qe&&t(21,Ie=qe.maxWidth),"lngLat"in qe&&t(10,Y=qe.lngLat),"html"in qe&&t(22,K=qe.html),"open"in qe&&t(0,ue=qe.open),"$$scope"in qe&&t(29,k=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,o=E??(!P&&!z)),r.$$.dirty[0]&146685952&&(it||(t(23,it=new Pr.Popup({closeButton:o,closeOnClick:!1,closeOnMove:V,focusAfterOpen:G,maxWidth:Ie,className:xe,anchor:X,offset:le})),Ft=it.getElement(),it.on("open",()=>{t(0,ue=!0),jt(),fe("open",it)}),it.on("close",()=>{t(0,ue=!1),fe("close",it)}),it.on("hover",()=>{fe("hover",it)}))),r.$$.dirty[0]&8421384&&it&&a instanceof Pr.Marker&&($==="click"?a.setPopup(it):a.getPopup()===it&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&rt.includes($)&&(d==null?void 0:d.type)===$&&(Bt(d),si(Ge,d=null,d)),r.$$.dirty[0]&268468224&&t(26,l=$==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),r.$$.dirty[0]&352354304&&$==="hover"&&Ge&&(l&&d&&(d.layerType==="deckgl"?(t(10,Y=d.coordinate),t(4,et=d.object?[d.object]:null)):(t(10,Y=d.lngLat),t(4,et=d.features??[]))),t(0,ue=(l||Qe)??!1)),r.$$.dirty[0]&12582914&&(bi?it.setDOMContent(bi):K&&it.setHTML(K)),r.$$.dirty[0]&8389632&&Y&&it.setLngLat(Y),r.$$.dirty[0]&41943045&&u){let qe=it.isOpen();ue&&!qe?(it.addTo(u),at==="opening"&&t(25,at="justOpened")):!ue&&qe&&it.remove()}},[ue,bi,u,a,et,ce,ae,Ge,Le,S,Y,E,P,z,V,$,H,G,X,le,xe,Ie,K,it,Qe,at,l,o,d,k,v,di,lt]}class $2 extends Wt{constructor(e){super(),Gt(this,e,U2,j2,Vt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var dc=Math.pow,Ar=(r,e,t)=>new Promise((o,l)=>{var u=g=>{try{a(t.next(g))}catch(v){l(v)}},d=g=>{try{a(t.throw(g))}catch(v){l(v)}},a=g=>g.done?o(g.value):Promise.resolve(g.value).then(u,d);a((t=t.apply(r,e)).next())}),vo=Uint8Array,lc=Uint16Array,V2=Int32Array,p1=new vo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),m1=new vo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),q2=new vo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_1=function(r,e){for(var t=new lc(31),o=0;o<31;++o)t[o]=e+=1<<r[o-1];for(var l=new V2(t[30]),o=1;o<30;++o)for(var u=t[o];u<t[o+1];++u)l[u]=u-t[o]<<5|o;return{b:t,r:l}},g1=_1(p1,2),y1=g1.b,Z2=g1.r;y1[28]=258,Z2[258]=28;var G2=_1(m1,0),W2=G2.b,Ip=new lc(32768);for(Ki=0;Ki<32768;++Ki)_s=(Ki&43690)>>1|(Ki&21845)<<1,_s=(_s&52428)>>2|(_s&13107)<<2,_s=(_s&61680)>>4|(_s&3855)<<4,Ip[Ki]=((_s&65280)>>8|(_s&255)<<8)>>1;var _s,Ki,Hu=function(r,e,t){for(var o=r.length,l=0,u=new lc(e);l<o;++l)r[l]&&++u[r[l]-1];var d=new lc(e);for(l=1;l<e;++l)d[l]=d[l-1]+u[l-1]<<1;var a;if(t){a=new lc(1<<e);var g=15-e;for(l=0;l<o;++l)if(r[l])for(var v=l<<4|r[l],k=e-r[l],S=d[r[l]-1]++<<k,E=S|(1<<k)-1;S<=E;++S)a[Ip[S]>>g]=v}else for(a=new lc(o),l=0;l<o;++l)r[l]&&(a[l]=Ip[d[r[l]-1]++]>>15-r[l]);return a},uh=new vo(288);for(Ki=0;Ki<144;++Ki)uh[Ki]=8;var Ki;for(Ki=144;Ki<256;++Ki)uh[Ki]=9;var Ki;for(Ki=256;Ki<280;++Ki)uh[Ki]=7;var Ki;for(Ki=280;Ki<288;++Ki)uh[Ki]=8;var Ki,b1=new vo(32);for(Ki=0;Ki<32;++Ki)b1[Ki]=5;var Ki,H2=Hu(uh,9,1),X2=Hu(b1,5,1),hp=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},No=function(r,e,t){var o=e/8|0;return(r[o]|r[o+1]<<8)>>(e&7)&t},dp=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},K2=function(r){return(r+7)/8|0},J2=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var o=new vo(t-e);return o.set(r.subarray(e,t)),o},Y2=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yo=function(r,e,t){var o=new Error(e||Y2[r]);if(o.code=r,Error.captureStackTrace&&Error.captureStackTrace(o,yo),!t)throw o;return o},Hp=function(r,e,t,o){var l=r.length,u=o?o.length:0;if(!l||e.f&&!e.l)return t||new vo(0);var d=!t||e.i!=2,a=e.i;t||(t=new vo(l*3));var g=function(Fi){var bi=t.length;if(Fi>bi){var di=new vo(Math.max(bi*2,Fi));di.set(t),t=di}},v=e.f||0,k=e.p||0,S=e.b||0,E=e.l,P=e.d,z=e.m,V=e.n,$=l*8;do{if(!E){v=No(r,k,1);var H=No(r,k+1,3);if(k+=3,H)if(H==1)E=H2,P=X2,z=9,V=5;else if(H==2){var xe=No(r,k,31)+257,Ie=No(r,k+10,15)+4,Y=xe+No(r,k+5,31)+1;k+=14;for(var K=new vo(Y),ue=new vo(19),fe=0;fe<Ie;++fe)ue[q2[fe]]=No(r,k+fe*3,7);k+=Ie*3;for(var ce=hp(ue),ae=(1<<ce)-1,Ge=Hu(ue,ce,1),fe=0;fe<Y;){var Le=Ge[No(r,k,ae)];k+=Le&15;var G=Le>>4;if(G<16)K[fe++]=G;else{var Pe=0,rt=0;for(G==16?(rt=3+No(r,k,3),k+=2,Pe=K[fe-1]):G==17?(rt=3+No(r,k,7),k+=3):G==18&&(rt=11+No(r,k,127),k+=7);rt--;)K[fe++]=Pe}}var it=K.subarray(0,xe),Qe=K.subarray(xe);z=hp(it),V=hp(Qe),E=Hu(it,z,1),P=Hu(Qe,V,1)}else yo(1);else{var G=K2(k)+4,X=r[G-4]|r[G-3]<<8,le=G+X;if(le>l){a&&yo(0);break}d&&g(S+X),t.set(r.subarray(G,le),S),e.b=S+=X,e.p=k=le*8,e.f=v;continue}if(k>$){a&&yo(0);break}}d&&g(S+131072);for(var Ft=(1<<z)-1,jt=(1<<V)-1,ut=k;;ut=k){var Pe=E[dp(r,k)&Ft],et=Pe>>4;if(k+=Pe&15,k>$){a&&yo(0);break}if(Pe||yo(2),et<256)t[S++]=et;else if(et==256){ut=k,E=null;break}else{var at=et-254;if(et>264){var fe=et-257,Bt=p1[fe];at=No(r,k,(1<<Bt)-1)+y1[fe],k+=Bt}var Dt=P[dp(r,k)&jt],Ht=Dt>>4;Dt||yo(3),k+=Dt&15;var Qe=W2[Ht];if(Ht>3){var Bt=m1[Ht];Qe+=dp(r,k)&(1<<Bt)-1,k+=Bt}if(k>$){a&&yo(0);break}d&&g(S+131072);var li=S+at;if(S<Qe){var ai=u-Qe,ki=Math.min(Qe,li);for(ai+S<0&&yo(3);S<ki;++S)t[S]=o[ai+S]}for(;S<li;S+=4)t[S]=t[S-Qe],t[S+1]=t[S+1-Qe],t[S+2]=t[S+2-Qe],t[S+3]=t[S+3-Qe];S=li}}e.l=E,e.p=ut,e.b=S,e.f=v,E&&(v=1,e.m=z,e.d=P,e.n=V)}while(!v);return S==t.length?t:J2(t,0,S)},Q2=new vo(0),e3=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&yo(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var o=(e>>3&1)+(e>>4&1);o>0;o-=!r[t++]);return t+(e&2)},t3=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},i3=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&yo(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&yo(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function n3(r,e){return Hp(r,{i:2},e&&e.out,e&&e.dictionary)}function r3(r,e){var t=e3(r);return t+8>r.length&&yo(6,"invalid gzip data"),Hp(r.subarray(t,-8),{i:2},e&&e.out||new vo(t3(r)),e&&e.dictionary)}function o3(r,e){return Hp(r.subarray(i3(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Cp(r,e){return r[0]==31&&r[1]==139&&r[2]==8?r3(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?n3(r,e):o3(r,e)}var s3=typeof TextDecoder<"u"&&new TextDecoder,a3=0;try{s3.decode(Q2,{stream:!0}),a3=1}catch{}var v1=(r,e)=>r*dc(2,e),Nu=(r,e)=>Math.floor(r/dc(2,e)),Ad=(r,e)=>v1(r.getUint16(e+1,!0),8)+r.getUint8(e),w1=(r,e)=>v1(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),l3=(r,e,t,o,l)=>{if(r!==o.getUint8(l))return r-o.getUint8(l);const u=Ad(o,l+1);if(e!==u)return e-u;const d=Ad(o,l+4);return t!==d?t-d:0},c3=(r,e,t,o)=>{const l=x1(r,e|128,t,o);return l?{z:e,x:t,y:o,offset:l[0],length:l[1],isDir:!0}:null},Zg=(r,e,t,o)=>{const l=x1(r,e,t,o);return l?{z:e,x:t,y:o,offset:l[0],length:l[1],isDir:!1}:null},x1=(r,e,t,o)=>{let l=0,u=r.byteLength/17-1;for(;l<=u;){const d=u+l>>1,a=l3(e,t,o,r,d*17);if(a>0)l=d+1;else if(a<0)u=d-1;else return[w1(r,d*17+7),r.getUint32(d*17+13,!0)]}return null},u3=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,k1=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Ad(r,e*17+1),y:Ad(r,e*17+4),offset:w1(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},Gg=r=>{const e=[],t=new DataView(r);for(let o=0;o<t.byteLength/17;o++)e.push(k1(t,o));return h3(e)},h3=r=>{r.sort(u3);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let o=0;o<r.length;o++){const l=r[o];let u=l.z;l.isDir&&(u=u|128),t[o*17]=u,t[o*17+1]=l.x&255,t[o*17+2]=l.x>>8&255,t[o*17+3]=l.x>>16&255,t[o*17+4]=l.y&255,t[o*17+5]=l.y>>8&255,t[o*17+6]=l.y>>16&255,t[o*17+7]=l.offset&255,t[o*17+8]=Nu(l.offset,8)&255,t[o*17+9]=Nu(l.offset,16)&255,t[o*17+10]=Nu(l.offset,24)&255,t[o*17+11]=Nu(l.offset,32)&255,t[o*17+12]=Nu(l.offset,48)&255,t[o*17+13]=l.length&255,t[o*17+14]=l.length>>8&255,t[o*17+15]=l.length>>16&255,t[o*17+16]=l.length>>24&255}return e},d3=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,o=k1(r,t-1);if(o.isDir){const l=o.z,u=e.z-l,d=Math.trunc(e.x/(1<<u)),a=Math.trunc(e.y/(1<<u));return{z:l,x:d,y:a}}return null};function f3(r){return Ar(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),o=t.getUint32(4,!0),l=t.getUint16(8,!0),u=new TextDecoder("utf-8"),d=JSON.parse(u.decode(new DataView(e.data,10,o)));let a=0;d.compression==="gzip"&&(a=2);let g=0;"minzoom"in d&&(g=+d.minzoom);let v=0;"maxzoom"in d&&(v=+d.maxzoom);let k=0,S=0,E=0,P=-180,z=-85,V=180,$=85;if(d.bounds){const G=d.bounds.split(",");P=+G[0],z=+G[1],V=+G[2],$=+G[3]}if(d.center){const G=d.center.split(",");k=+G[0],S=+G[1],E=+G[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+o,rootDirectoryLength:l*17,jsonMetadataOffset:10,jsonMetadataLength:o,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:g,maxZoom:v,minLon:P,minLat:z,maxLon:V,maxLat:$,centerZoom:E,centerLon:k,centerLat:S,etag:e.etag}})}function p3(r,e,t,o,l,u,d){return Ar(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=Gg(a));const g=Zg(new DataView(a),o,l,u);if(g){let S=(yield e.getBytes(g.offset,g.length,d)).data;const E=new DataView(S);return E.getUint8(0)===31&&E.getUint8(1)===139&&(S=Cp(new Uint8Array(S))),{data:S}}const v=d3(new DataView(a),{z:o,x:l,y:u});if(v){const k=c3(new DataView(a),v.z,v.x,v.y);if(k){let S=yield t.getArrayBuffer(e,k.offset,k.length,r);r.specVersion===1&&(S=Gg(S));const E=Zg(new DataView(S),o,l,u);if(E){let z=(yield e.getBytes(E.offset,E.length,d)).data;const V=new DataView(z);return V.getUint8(0)===31&&V.getUint8(1)===139&&(z=Cp(new Uint8Array(z))),{data:z}}}}})}var S1={getHeader:f3,getZxy:p3},m3=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const o=new AbortController;return r(e,o).then(l=>t(void 0,l.data,l.cacheControl||"",l.expires||""),l=>t(l)).catch(l=>t(l)),{cancel:()=>o.abort()}},_3=class{constructor(){this.tilev4=(r,e)=>Ar(this,null,function*(){if(r.type==="json"){const S=r.url.substr(10);let E=this.tiles.get(S);E||(E=new Wg(S),this.tiles.set(S,E));const P=yield E.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:P.minZoom,maxzoom:P.maxZoom,bounds:[P.minLon,P.minLat,P.maxLon,P.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),o=r.url.match(t);if(!o)throw new Error("Invalid PMTiles protocol URL");const l=o[1];let u=this.tiles.get(l);u||(u=new Wg(l),this.tiles.set(l,u));const d=o[2],a=o[3],g=o[4],v=yield u.getHeader(),k=yield u==null?void 0:u.getZxy(+d,+a,+g,e.signal);return k?{data:new Uint8Array(k.data),cacheControl:k.cacheControl,expires:k.expires}:v.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=m3(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function rc(r,e){return(e>>>0)*4294967296+(r>>>0)}function g3(r,e){const t=e.buf;let o=t[e.pos++],l=(o&112)>>4;if(o<128||(o=t[e.pos++],l|=(o&127)<<3,o<128)||(o=t[e.pos++],l|=(o&127)<<10,o<128)||(o=t[e.pos++],l|=(o&127)<<17,o<128)||(o=t[e.pos++],l|=(o&127)<<24,o<128)||(o=t[e.pos++],l|=(o&1)<<31,o<128))return rc(r,l);throw new Error("Expected varint not more than 10 bytes")}function ju(r){const e=r.buf;let t=e[r.pos++],o=t&127;return t<128||(t=e[r.pos++],o|=(t&127)<<7,t<128)||(t=e[r.pos++],o|=(t&127)<<14,t<128)||(t=e[r.pos++],o|=(t&127)<<21,t<128)?o:(t=e[r.pos],o|=(t&15)<<28,g3(o,r))}function y3(r,e,t,o){if(o===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const l=e[0];e[0]=e[1],e[1]=l}}var b3=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function v3(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>dc(2,r)-1||t>dc(2,r)-1)throw Error("tile x/y outside zoom level bounds");const o=b3[r],l=dc(2,r);let u=0,d=0,a=0;const g=[e,t];let v=l/2;for(;v>0;)u=(g[0]&v)>0?1:0,d=(g[1]&v)>0?1:0,a+=v*v*(3*u^d),y3(v,g,u,d),v=v/2;return o+a}function T1(r,e){return Ar(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Cp(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const o=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(o).arrayBuffer()}throw Error("Compression method not supported")})}var w3=127;function x3(r,e){let t=0,o=r.length-1;for(;t<=o;){const l=o+t>>1,u=e-r[l].tileId;if(u>0)t=l+1;else if(u<0)o=l-1;else return r[l]}return o>=0&&(r[o].runLength===0||e-r[o].tileId<r[o].runLength)?r[o]:null}var k3=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,o){return Ar(this,null,function*(){let l,u;t?u=t:(l=new AbortController,u=l.signal);const d=new Headers(this.customHeaders);d.set("range",`bytes=${r}-${r+e-1}`);let a;this.mustReload&&(a="reload");let g=yield fetch(this.url,{signal:u,cache:a,headers:d});if(r===0&&g.status===416){const E=g.headers.get("Content-Range");if(!E||!E.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const P=+E.substr(8);g=yield fetch(this.url,{signal:u,cache:"reload",headers:{range:`bytes=0-${P-1}`}})}let v=g.headers.get("Etag");if(v!=null&&v.startsWith("W/")&&(v=null),g.status===416||o&&v&&v!==o)throw this.mustReload=!0,new Ep(`Server returned non-matching ETag ${o} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(g.status>=300)throw Error(`Bad response code: ${g.status}`);const k=g.headers.get("Content-Length");if(g.status===200&&(!k||+k>e))throw l&&l.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield g.arrayBuffer(),etag:v||void 0,cacheControl:g.headers.get("Cache-Control")||void 0,expires:g.headers.get("Expires")||void 0}})}};function jo(r,e){const t=r.getUint32(e+4,!0),o=r.getUint32(e+0,!0);return t*dc(2,32)+o}function S3(r,e){const t=new DataView(r),o=t.getUint8(7);if(o>3)throw Error(`Archive is spec version ${o} but this library supports up to spec version 3`);return{specVersion:o,rootDirectoryOffset:jo(t,8),rootDirectoryLength:jo(t,16),jsonMetadataOffset:jo(t,24),jsonMetadataLength:jo(t,32),leafDirectoryOffset:jo(t,40),leafDirectoryLength:jo(t,48),tileDataOffset:jo(t,56),tileDataLength:jo(t,64),numAddressedTiles:jo(t,72),numTileEntries:jo(t,80),numTileContents:jo(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function I1(r){const e={buf:new Uint8Array(r),pos:0},t=ju(e),o=[];let l=0;for(let u=0;u<t;u++){const d=ju(e);o.push({tileId:l+d,offset:0,length:0,runLength:1}),l+=d}for(let u=0;u<t;u++)o[u].runLength=ju(e);for(let u=0;u<t;u++)o[u].length=ju(e);for(let u=0;u<t;u++){const d=ju(e);d===0&&u>0?o[u].offset=o[u-1].offset+o[u-1].length:o[u].offset=d-1}return o}function T3(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Ep=class extends Error{};function I3(r,e){return Ar(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(T3(t.data)<3)return[yield S1.getHeader(r)];const l=t.data.slice(0,w3),u=S3(l,t.etag),d=t.data.slice(u.rootDirectoryOffset,u.rootDirectoryOffset+u.rootDirectoryLength),a=`${r.getKey()}|${u.etag||""}|${u.rootDirectoryOffset}|${u.rootDirectoryLength}`,g=I1(yield e(d,u.internalCompression));return[u,[a,g.length,g]]})}function C3(r,e,t,o,l){return Ar(this,null,function*(){const u=yield r.getBytes(t,o,void 0,l.etag),d=yield e(u.data,l.internalCompression),a=I1(d);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var E3=class{constructor(r=100,e=!0,t=T1){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Ar(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const o=new Promise((l,u)=>{I3(r,this.decompress).then(d=>{d[1]&&this.cache.set(d[1][0],{lastUsed:this.counter++,data:Promise.resolve(d[1][2])}),l(d[0]),this.prune()}).catch(d=>{u(d)})});return this.cache.set(e,{lastUsed:this.counter++,data:o}),o})}getDirectory(r,e,t,o){return Ar(this,null,function*(){const l=`${r.getKey()}|${o.etag||""}|${e}|${t}`,u=this.cache.get(l);if(u)return u.lastUsed=this.counter++,yield u.data;const d=new Promise((a,g)=>{C3(r,this.decompress,e,t,o).then(v=>{a(v),this.prune()}).catch(v=>{g(v)})});return this.cache.set(l,{lastUsed:this.counter++,data:d}),d})}getArrayBuffer(r,e,t,o){return Ar(this,null,function*(){const l=`${r.getKey()}|${o.etag||""}|${e}|${t}`,u=this.cache.get(l);if(u)return u.lastUsed=this.counter++,yield u.data;const d=new Promise((a,g)=>{r.getBytes(e,t,void 0,o.etag).then(v=>{a(v.data),this.cache.has(l),this.prune()}).catch(v=>{g(v)})});return this.cache.set(l,{lastUsed:this.counter++,data:d}),d})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,o)=>{t.lastUsed<r&&(r=t.lastUsed,e=o)}),e&&this.cache.delete(e)}}invalidate(r){return Ar(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((o,l)=>{this.getHeader(r).then(u=>{o(),this.invalidations.delete(e)}).catch(u=>{l(u)})});this.invalidations.set(e,t)})}},Wg=class{constructor(r,e,t){typeof r=="string"?this.source=new k3(r):this.source=r,t?this.decompress=t:this.decompress=T1,e?this.cache=e:this.cache=new E3}getHeader(){return Ar(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,o){return Ar(this,null,function*(){const l=v3(r,e,t),u=yield this.cache.getHeader(this.source);if(u.specVersion<3)return S1.getZxy(u,this.source,this.cache,r,e,t,o);if(r<u.minZoom||r>u.maxZoom)return;let d=u.rootDirectoryOffset,a=u.rootDirectoryLength;for(let g=0;g<=3;g++){const v=yield this.cache.getDirectory(this.source,d,a,u),k=x3(v,l);if(k){if(k.runLength>0){const S=yield this.source.getBytes(u.tileDataOffset+k.offset,k.length,o,u.etag);return{data:yield this.decompress(S.data,u.tileCompression),cacheControl:S.cacheControl,expires:S.expires}}d=u.leafDirectoryOffset+k.offset,a=k.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,o){return Ar(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,o)}catch(l){if(l instanceof Ep)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,o);throw l}})}getMetadataAttempt(){return Ar(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),o=new TextDecoder("utf-8");return JSON.parse(o.decode(t))})}getMetadata(){return Ar(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof Ep)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};const L3=r=>({props:r&8}),Hg=r=>({props:P3(r[3])});function M3(r){let e;const t=r[1].default,o=bn(t,r,r[2],Hg);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u&12)&&wn(o,t,l,l[2],e?vn(t,l[2],u,L3):xn(l[2]),Hg)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function A3(r){let e,t;return e=new $2({props:{openOn:r[0],$$slots:{default:[M3,({features:o})=>({3:o}),({features:o})=>o?8:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,[l]){const u={};l&1&&(u.openOn=o[0]),l&12&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function P3(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function z3(r,e,t){let{$$slots:o={},$$scope:l}=e,{openOn:u="hover"}=e;return r.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,o,l]}class yr extends Wt{constructor(e){super(),Gt(this,e,z3,A3,Vt,{openOn:0})}}function Yo(r,e,t){let o=["match",r];for(let[l,u]of Object.entries(e))o.push(l),o.push(u);return o.push(t),o}function ha(r,e,t){let o=["step",r];for(let l=1;l<e.length;l++)o.push(t[l-1]),o.push(e[l]);return o.push(t[t.length-1]),o}function fc(){return{type:"FeatureCollection",features:[]}}let D3=Date.now();function vc(r){return`${r}-${D3++}`}const Xp=Symbol.for("svelte-maplibre");function wc(){return G0(Xp)}function R3(r){let e=new WeakMap;return t=>{var d;let o=e.get(t.originalEvent);if(o!==void 0)return o;let u=(d=t.target.queryRenderedFeatures(t.point).find(a=>{var g;return(g=r.get(a.layer.id))==null?void 0:g.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function F3(){let r=new Map;return Z0(Xp,{map:Ei(null),source:up(null),layer:up(null),popupTarget:up(null),cluster:Ei(),loadedImages:Ei(new Set),minzoom:Ei(0),maxzoom:Ei(24),layerEvent:Ei(null),layerInfo:r,eventTopMost:R3(r),markerClickManager:new N3})}function Xg(r){return{subscribe:r.subscribe}}function Kp({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:o=!1}){let l=wc(),u=Ei(null),d=Xg(u),a={...l,[r]:Xg(u)};if(e&&(a.popupTarget=d),o){let g=Ei(null);a.layerEvent=g,l.layerEvent=g}return t&&(a.cluster=Ei()),Z0(Xp,a),{...l,self:u}}function C1(){return Kp({key:"source",setCluster:!0})}function B3(r=!0){return Kp({key:"layer",setPopupTarget:r,setMouseEvent:r})}function O3(){return Kp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class N3{constructor(){zu(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Kg(r){let e;return t=>{if(t)for(let o in t){let l=e==null?void 0:e[o],u=t[o];l!==u&&r(o,u,l)}else if(e)for(let o in e)r(o,void 0,e[o]);e=t}}function j3(r,...e){let t=[r];for(let o of e)if(o)Array.isArray(o)&&o[0]===r?t.push(...o.slice(1)):t.push(o);else continue;if(t.length!==1)return t.length===2?t[1]:t}function U3(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Vn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}function Jg(r){let e=r[0],t,o,l=Yg(r);return{c(){l.c(),t=tn()},m(u,d){l.m(u,d),te(u,t,d),o=!0},p(u,d){d[0]&1&&Vt(e,e=u[0])?(Li(),de(l,1,1,We),Mi(),l=Yg(u),l.c(),se(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){o||(se(l),o=!0)},o(u){de(l),o=!1},d(u){u&&ee(t),l.d(u)}}}function Yg(r){let e;const t=r[36].default,o=bn(t,r,r[35],null);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u[1]&16)&&wn(o,t,l,l[35],e?vn(t,l[35],u,null):xn(l[35]),null)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function $3(r){let e,t,o=r[0]&&Jg(r);return{c(){o&&o.c(),e=tn()},m(l,u){o&&o.m(l,u),te(l,e,u),t=!0},p(l,u){l[0]?o?(o.p(l,u),u[0]&1&&se(o,1)):(o=Jg(l),o.c(),se(o,1),o.m(e.parentNode,e)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d(l)}}}function V3(r,e,t){let o,l,u,d,a,g,v,k,S,E,P,z,{$$slots:V={},$$scope:$}=e,{id:H=vc("layer")}=e,{source:G=void 0}=e,{sourceLayer:X=void 0}=e,{beforeId:le=void 0}=e,{beforeLayerType:xe=void 0}=e,{type:Ie}=e,{paint:Y=void 0}=e,{layout:K=void 0}=e,{filter:ue=void 0}=e,{applyToClusters:fe=void 0}=e,{minzoom:ce=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Ge=!1}=e,{hovered:Le=null}=e,{interactive:Pe=!0}=e,{hoverCursor:rt=void 0}=e,{eventsIfTopMost:it=!1}=e;const Qe=bc(),{map:Ft,source:jt,self:ut,minzoom:et,maxzoom:at,eventTopMost:Bt,layerInfo:Dt}=B3();yt(r,Ft,lt=>t(31,S=lt)),yt(r,jt,lt=>t(32,E=lt)),yt(r,ut,lt=>t(0,k=lt)),yt(r,et,lt=>t(34,z=lt)),yt(r,at,lt=>t(33,P=lt)),Po(()=>{k&&S&&(Dt.delete(k),S==null||S.removeLayer(k))});let Ht;function li(lt){var pt,gt;if(!Pe||!k||!S||it&&Bt(lt)!==k)return;let qe=lt.features??[],st=(gt=(pt=qe[0])==null?void 0:pt.properties)==null?void 0:gt.cluster_id,Te={event:lt,map:S,clusterId:st,layer:k,source:a,features:qe};Qe(lt.type,Te)}function ai(lt){var pt,gt;if(!Pe||!k||!S||it&&Bt(lt)!==k)return;rt&&(S.getCanvas().style.cursor=rt);let qe=lt.features??[];t(6,Le=qe[0]??null);let st=(gt=(pt=qe[0])==null?void 0:pt.properties)==null?void 0:gt.cluster_id;Qe("mouseenter",{event:lt,map:S,clusterId:st,layer:k,source:a,features:qe})}function ki(lt){var pt,gt,Ce;if(!Pe||!S)return;if(it&&Bt(lt)!==k){t(6,Le=null),Ge&&Ht!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:X,id:Ht},{hover:!1}),Ht=void 0);return}S.getCanvas().style.cursor=rt;let qe=lt.features??[],st=(gt=(pt=qe[0])==null?void 0:pt.properties)==null?void 0:gt.cluster_id,Te=(Ce=qe[0])==null?void 0:Ce.id;Te!==Ht&&(Ge&&(Ht!==void 0&&(S==null||S.setFeatureState({source:a,id:Ht,sourceLayer:X},{hover:!1})),S==null||S.setFeatureState({source:a,id:Te,sourceLayer:X},{hover:!0})),Ht=Te,t(6,Le=qe[0]??null)),Qe("mousemove",{event:lt,map:S,clusterId:st,layer:k,source:a,features:qe})}function Fi(lt){if(!(!Pe||!k||!S)){if(rt&&(S.getCanvas().style.cursor=""),t(6,Le=null),Ge&&Ht!==void 0){const qe={source:a,id:Ht,sourceLayer:X};S==null||S.setFeatureState(qe,{hover:!1}),Ht=void 0}Qe("mouseleave",{map:S,layer:k,source:a})}}let bi=!0;function di(lt){S&&(S.off("click",lt,li),S.off("dblclick",lt,li),S.off("contextmenu",lt,li),S.off("mouseenter",lt,ai),S.off("mousemove",lt,ki),S.off("mouseleave",lt,Fi))}return Po(()=>{S&&k&&di(k)}),r.$$set=lt=>{"id"in lt&&t(7,H=lt.id),"source"in lt&&t(8,G=lt.source),"sourceLayer"in lt&&t(9,X=lt.sourceLayer),"beforeId"in lt&&t(10,le=lt.beforeId),"beforeLayerType"in lt&&t(11,xe=lt.beforeLayerType),"type"in lt&&t(12,Ie=lt.type),"paint"in lt&&t(13,Y=lt.paint),"layout"in lt&&t(14,K=lt.layout),"filter"in lt&&t(15,ue=lt.filter),"applyToClusters"in lt&&t(16,fe=lt.applyToClusters),"minzoom"in lt&&t(17,ce=lt.minzoom),"maxzoom"in lt&&t(18,ae=lt.maxzoom),"manageHoverState"in lt&&t(19,Ge=lt.manageHoverState),"hovered"in lt&&t(6,Le=lt.hovered),"interactive"in lt&&t(20,Pe=lt.interactive),"hoverCursor"in lt&&t(21,rt=lt.hoverCursor),"eventsIfTopMost"in lt&&t(22,it=lt.eventsIfTopMost),"$$scope"in lt&&t(35,$=lt.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,o=U3(fe)),r.$$.dirty[0]&1073774592&&t(24,l=j3("all",o,ue)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=ce??z),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,d=ae??P),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=G||E),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&k!==H&&a){k&&(di(k),Dt.delete(k));let lt=le;if(!le&&xe){let qe=S.getStyle().layers,st=typeof xe=="function"?xe:pt=>pt.type===xe,Te=qe==null?void 0:qe.find(st);Te&&(lt=Te.id)}si(ut,k=H,k),S.addLayer(oh({id:k,type:Ie,source:a,"source-layer":X,filter:l,paint:Y,layout:K,minzoom:u,maxzoom:d}),lt),t(23,bi=!0),S.on("click",k,li),S.on("dblclick",k,li),S.on("contextmenu",k,li),S.on("mouseenter",k,ai),S.on("mousemove",k,ki),S.on("mouseleave",k,Fi)}r.$$.dirty[0]&1048577&&k&&Dt.set(k,{interactive:Pe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,g=k?Kg((lt,qe)=>S==null?void 0:S.setPaintProperty(k,lt,qe)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,v=k?Kg((lt,qe)=>S==null?void 0:S.setLayoutProperty(k,lt,qe)):void 0),r.$$.dirty[0]&268443648&&(g==null||g(Y)),r.$$.dirty[0]&134234112&&(v==null||v(K)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(bi?t(23,bi=!1):S==null||S.setFilter(k,l))},[k,Ft,jt,ut,et,at,Le,H,G,X,le,xe,Ie,Y,K,ue,fe,ce,ae,Ge,Pe,rt,it,bi,l,d,u,v,g,a,o,S,E,P,z,$,V]}class Jp extends Wt{constructor(e){super(),Gt(this,e,V3,$3,Vt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function q3(r){let e;const t=r[16].default,o=bn(t,r,r[24],null);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u&16777216)&&wn(o,t,l,l[24],e?vn(t,l[24],u,null):xn(l[24]),null)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function Z3(r){let e,t,o;function l(d){r[17](d)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[q3]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Jp({props:u}),oi.push(()=>Vi(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ue(e.$$.fragment)},m(d,a){Ne(e,d,a),o=!0},p(d,[a]){const g={};a&2&&(g.id=d[1]),a&4&&(g.source=d[2]),a&8&&(g.sourceLayer=d[3]),a&16&&(g.beforeId=d[4]),a&32&&(g.beforeLayerType=d[5]),a&64&&(g.paint=d[6]),a&128&&(g.layout=d[7]),a&256&&(g.filter=d[8]),a&512&&(g.applyToClusters=d[9]),a&1024&&(g.minzoom=d[10]),a&2048&&(g.maxzoom=d[11]),a&4096&&(g.hoverCursor=d[12]),a&8192&&(g.manageHoverState=d[13]),a&16384&&(g.eventsIfTopMost=d[14]),a&32768&&(g.interactive=d[15]),a&16777216&&(g.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,g.hovered=d[0],$i(()=>t=!1)),e.$set(g)},i(d){o||(se(e.$$.fragment,d),o=!0)},o(d){de(e.$$.fragment,d),o=!1},d(d){je(e,d)}}}function G3(r,e,t){let{$$slots:o={},$$scope:l}=e,{id:u=vc("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:V=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:H=!1}=e,{hovered:G=null}=e,{eventsIfTopMost:X=!1}=e,{interactive:le=!0}=e;function xe(ae){G=ae,t(0,G)}function Ie(ae){On.call(this,r,ae)}function Y(ae){On.call(this,r,ae)}function K(ae){On.call(this,r,ae)}function ue(ae){On.call(this,r,ae)}function fe(ae){On.call(this,r,ae)}function ce(ae){On.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,u=ae.id),"source"in ae&&t(2,d=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,g=ae.beforeId),"beforeLayerType"in ae&&t(5,v=ae.beforeLayerType),"paint"in ae&&t(6,k=ae.paint),"layout"in ae&&t(7,S=ae.layout),"filter"in ae&&t(8,E=ae.filter),"applyToClusters"in ae&&t(9,P=ae.applyToClusters),"minzoom"in ae&&t(10,z=ae.minzoom),"maxzoom"in ae&&t(11,V=ae.maxzoom),"hoverCursor"in ae&&t(12,$=ae.hoverCursor),"manageHoverState"in ae&&t(13,H=ae.manageHoverState),"hovered"in ae&&t(0,G=ae.hovered),"eventsIfTopMost"in ae&&t(14,X=ae.eventsIfTopMost),"interactive"in ae&&t(15,le=ae.interactive),"$$scope"in ae&&t(24,l=ae.$$scope)},[G,u,d,a,g,v,k,S,E,P,z,V,$,H,X,le,o,xe,Ie,Y,K,ue,fe,ce,l]}class Yp extends Wt{constructor(e){super(),Gt(this,e,G3,Z3,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function W3(r){let e;const t=r[15].default,o=bn(t,r,r[23],null);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u&8388608)&&wn(o,t,l,l[23],e?vn(t,l[23],u,null):xn(l[23]),null)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function H3(r){let e,t,o;function l(d){r[16](d)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[W3]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Jp({props:u}),oi.push(()=>Vi(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ue(e.$$.fragment)},m(d,a){Ne(e,d,a),o=!0},p(d,[a]){const g={};a&2&&(g.id=d[1]),a&4&&(g.source=d[2]),a&8&&(g.sourceLayer=d[3]),a&16&&(g.beforeId=d[4]),a&32&&(g.beforeLayerType=d[5]),a&64&&(g.paint=d[6]),a&128&&(g.layout=d[7]),a&256&&(g.filter=d[8]),a&512&&(g.minzoom=d[9]),a&1024&&(g.maxzoom=d[10]),a&2048&&(g.hoverCursor=d[11]),a&4096&&(g.manageHoverState=d[12]),a&8192&&(g.eventsIfTopMost=d[13]),a&16384&&(g.interactive=d[14]),a&8388608&&(g.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,g.hovered=d[0],$i(()=>t=!1)),e.$set(g)},i(d){o||(se(e.$$.fragment,d),o=!0)},o(d){de(e.$$.fragment,d),o=!1},d(d){je(e,d)}}}function X3(r,e,t){let{$$slots:o={},$$scope:l}=e,{id:u=vc("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:V=void 0}=e,{manageHoverState:$=!1}=e,{hovered:H=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:X=!0}=e;function le(ce){H=ce,t(0,H)}function xe(ce){On.call(this,r,ce)}function Ie(ce){On.call(this,r,ce)}function Y(ce){On.call(this,r,ce)}function K(ce){On.call(this,r,ce)}function ue(ce){On.call(this,r,ce)}function fe(ce){On.call(this,r,ce)}return r.$$set=ce=>{"id"in ce&&t(1,u=ce.id),"source"in ce&&t(2,d=ce.source),"sourceLayer"in ce&&t(3,a=ce.sourceLayer),"beforeId"in ce&&t(4,g=ce.beforeId),"beforeLayerType"in ce&&t(5,v=ce.beforeLayerType),"paint"in ce&&t(6,k=ce.paint),"layout"in ce&&t(7,S=ce.layout),"filter"in ce&&t(8,E=ce.filter),"minzoom"in ce&&t(9,P=ce.minzoom),"maxzoom"in ce&&t(10,z=ce.maxzoom),"hoverCursor"in ce&&t(11,V=ce.hoverCursor),"manageHoverState"in ce&&t(12,$=ce.manageHoverState),"hovered"in ce&&t(0,H=ce.hovered),"eventsIfTopMost"in ce&&t(13,G=ce.eventsIfTopMost),"interactive"in ce&&t(14,X=ce.interactive),"$$scope"in ce&&t(23,l=ce.$$scope)},[H,u,d,a,g,v,k,S,E,P,z,V,$,G,X,o,le,xe,Ie,Y,K,ue,fe,l]}class xc extends Wt{constructor(e){super(),Gt(this,e,X3,H3,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function K3(r,e,t){let o;const{map:l}=wc();yt(r,l,g=>t(4,o=g));let{position:u="top-left"}=e,{container:d=void 0}=e,a=null;return Po(()=>{o!=null&&o.loaded()&&a&&o.removeControl(a)}),r.$$set=g=>{"position"in g&&t(1,u=g.position),"container"in g&&t(2,d=g.container)},r.$$.update=()=>{if(r.$$.dirty&30&&o&&!a){let g;typeof d=="string"?g=document.querySelector(d)??void 0:g=d,t(3,a=new Pr.FullscreenControl({container:g})),o.addControl(a,u)}},[l,u,d,a,o]}class J3 extends Wt{constructor(e){super(),Gt(this,e,K3,null,Vt,{position:1,container:2})}}function E1(r,e,t,o,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const d=()=>{o(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):d())};a()}else d()}function L1(r,e,t){$v().then(()=>{let o=Yu(r);if(!o)return;o.getSource(e)===t&&o.removeSource(e)})}function Qg(r){let e=r[0],t,o,l=ey(r);return{c(){l.c(),t=tn()},m(u,d){l.m(u,d),te(u,t,d),o=!0},p(u,d){d&1&&Vt(e,e=u[0])?(Li(),de(l,1,1,We),Mi(),l=ey(u),l.c(),se(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){o||(se(l),o=!0)},o(u){de(l),o=!1},d(u){u&&ee(t),l.d(u)}}}function ey(r){let e;const t=r[19].default,o=bn(t,r,r[18],null);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u&262144)&&wn(o,t,l,l[18],e?vn(t,l[18],u,null):xn(l[18]),null)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function Y3(r){let e,t,o=r[0]&&Qg(r);return{c(){o&&o.c(),e=tn()},m(l,u){o&&o.m(l,u),te(l,e,u),t=!0},p(l,[u]){l[0]?o?(o.p(l,u),u&1&&se(o,1)):(o=Qg(l),o.c(),se(o,1),o.m(e.parentNode,e)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d(l)}}}function Q3(r,e,t){let o,l,u,{$$slots:d={},$$scope:a}=e,{id:g=vc("geojson")}=e,{data:v}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:E=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:z=void 0}=e,{maxzoom:V=void 0}=e,{attribution:$=void 0}=e,{buffer:H=void 0}=e,{tolerance:G=void 0}=e;const{map:X,cluster:le,self:xe}=C1();yt(r,X,K=>t(17,l=K)),yt(r,le,K=>t(20,u=K)),yt(r,xe,K=>t(0,o=K));let Ie,Y=!0;return Po(()=>{o&&Ie&&l&&(L1(X,o,Ie),si(xe,o=null,o),t(15,Ie=void 0))}),r.$$set=K=>{"id"in K&&t(4,g=K.id),"data"in K&&t(5,v=K.data),"generateId"in K&&t(6,k=K.generateId),"promoteId"in K&&t(7,S=K.promoteId),"filter"in K&&t(8,E=K.filter),"lineMetrics"in K&&t(9,P=K.lineMetrics),"cluster"in K&&t(10,z=K.cluster),"maxzoom"in K&&t(11,V=K.maxzoom),"attribution"in K&&t(12,$=K.attribution),"buffer"in K&&t(13,H=K.buffer),"tolerance"in K&&t(14,G=K.tolerance),"$$scope"in K&&t(18,a=K.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&si(le,u=z,u),r.$$.dirty&196593&&l&&o!==g&&(si(xe,o=g,o),E1(l,o,oh({type:"geojson",data:v,filter:E,lineMetrics:P,generateId:k,promoteId:S,cluster:!!z,clusterMinPoints:z==null?void 0:z.minPoints,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius,clusterProperties:z==null?void 0:z.properties,maxzoom:V,attribution:$,buffer:H,tolerance:G}),K=>l&&K===o,()=>{o&&(t(15,Ie=l==null?void 0:l.getSource(o)),t(16,Y=!0))})),r.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,Ie=l==null?void 0:l.getSource(g))})),r.$$.dirty&98336&&Ie&&(Y?t(16,Y=!1):Ie.setData(v)),r.$$.dirty&33792&&(Ie==null||Ie.setClusterOptions(oh({cluster:!!z,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius})))},[o,X,le,xe,g,v,k,S,E,P,z,V,$,H,G,Ie,Y,l,a,d]}class Tn extends Wt{constructor(e){super(),Gt(this,e,Q3,Y3,Vt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function e4(r,e,t){let o;const{map:l}=wc();yt(r,l,E=>t(8,o=E));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:g=!1}=e,{showAccuracyCircle:v=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return Po(()=>{o!=null&&o.loaded()&&S&&o.removeControl(S)}),r.$$set=E=>{"position"in E&&t(2,u=E.position),"positionOptions"in E&&t(3,d=E.positionOptions),"fitBoundsOptions"in E&&t(4,a=E.fitBoundsOptions),"trackUserLocation"in E&&t(5,g=E.trackUserLocation),"showAccuracyCircle"in E&&t(6,v=E.showAccuracyCircle),"showUserLocation"in E&&t(7,k=E.showUserLocation),"control"in E&&t(1,S=E.control)},r.$$.update=()=>{r.$$.dirty&510&&o&&!S&&(t(1,S=new Pr.GeolocateControl({positionOptions:d,fitBoundsOptions:a,trackUserLocation:g,showAccuracyCircle:v,showUserLocation:k})),o.addControl(S,u))},[l,S,u,d,a,g,v,k,o]}class t4 extends Wt{constructor(e){super(),Gt(this,e,e4,null,Vt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function i4(r){let e;const t=r[15].default,o=bn(t,r,r[23],null);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u&8388608)&&wn(o,t,l,l[23],e?vn(t,l[23],u,null):xn(l[23]),null)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function n4(r){let e,t,o;function l(d){r[16](d)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[i4]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Jp({props:u}),oi.push(()=>Vi(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ue(e.$$.fragment)},m(d,a){Ne(e,d,a),o=!0},p(d,[a]){const g={};a&2&&(g.id=d[1]),a&4&&(g.source=d[2]),a&8&&(g.sourceLayer=d[3]),a&16&&(g.beforeId=d[4]),a&32&&(g.beforeLayerType=d[5]),a&64&&(g.paint=d[6]),a&128&&(g.layout=d[7]),a&256&&(g.filter=d[8]),a&512&&(g.minzoom=d[9]),a&1024&&(g.maxzoom=d[10]),a&2048&&(g.hoverCursor=d[11]),a&4096&&(g.manageHoverState=d[12]),a&8192&&(g.eventsIfTopMost=d[13]),a&16384&&(g.interactive=d[14]),a&8388608&&(g.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,g.hovered=d[0],$i(()=>t=!1)),e.$set(g)},i(d){o||(se(e.$$.fragment,d),o=!0)},o(d){de(e.$$.fragment,d),o=!1},d(d){je(e,d)}}}function r4(r,e,t){let{$$slots:o={},$$scope:l}=e,{id:u=vc("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:V=void 0}=e,{manageHoverState:$=!1}=e,{hovered:H=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:X=!0}=e;function le(ce){H=ce,t(0,H)}function xe(ce){On.call(this,r,ce)}function Ie(ce){On.call(this,r,ce)}function Y(ce){On.call(this,r,ce)}function K(ce){On.call(this,r,ce)}function ue(ce){On.call(this,r,ce)}function fe(ce){On.call(this,r,ce)}return r.$$set=ce=>{"id"in ce&&t(1,u=ce.id),"source"in ce&&t(2,d=ce.source),"sourceLayer"in ce&&t(3,a=ce.sourceLayer),"beforeId"in ce&&t(4,g=ce.beforeId),"beforeLayerType"in ce&&t(5,v=ce.beforeLayerType),"paint"in ce&&t(6,k=ce.paint),"layout"in ce&&t(7,S=ce.layout),"filter"in ce&&t(8,E=ce.filter),"minzoom"in ce&&t(9,P=ce.minzoom),"maxzoom"in ce&&t(10,z=ce.maxzoom),"hoverCursor"in ce&&t(11,V=ce.hoverCursor),"manageHoverState"in ce&&t(12,$=ce.manageHoverState),"hovered"in ce&&t(0,H=ce.hovered),"eventsIfTopMost"in ce&&t(13,G=ce.eventsIfTopMost),"interactive"in ce&&t(14,X=ce.interactive),"$$scope"in ce&&t(23,l=ce.$$scope)},[H,u,d,a,g,v,k,S,E,P,z,V,$,G,X,o,le,xe,Ie,Y,K,ue,fe,l]}class mn extends Wt{constructor(e){super(),Gt(this,e,r4,n4,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function o4(r,e,t){let o;const l=bc();let{layer:u=void 0}=e;const{map:d}=wc();yt(r,d,k=>t(2,o=k));function a(k){l(k.type,{...k,map:d})}const g=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],v=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Po(()=>{if(o)if(u)for(const k of g)o.off(k,u,a);else for(const k of v)o.off(k,a)}),r.$$set=k=>{"layer"in k&&t(1,u=k.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&o)if(u)for(const k of g)o.on(k,u,a);else for(const k of v)o.on(k,a)},[d,u,o]}class M1 extends Wt{constructor(e){super(),Gt(this,e,o4,null,Vt,{layer:1})}}function s4(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,o=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,o),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,a=`${t}/${u}/${d}`,g=r.getBearing(),v=r.getPitch();return(g||v)&&(a+=`/${Math.round(g*10)/10}`),v&&(a+=`/${Math.round(v)}`),`#${a}`}function a4(r){return r.replace("#","").split("/").map(parseFloat)}function l4(r,e,t){let o;const{map:l}=wc();yt(r,l,k=>t(6,o=k));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:a=!0}=e,{visualizePitch:g=!1}=e,v=null;return Po(()=>{o!=null&&o.loaded()&&v&&o.removeControl(v)}),r.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,d=k.showCompass),"showZoom"in k&&t(3,a=k.showZoom),"visualizePitch"in k&&t(4,g=k.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&o&&!v&&(t(5,v=new Pr.NavigationControl({showCompass:d,showZoom:a,visualizePitch:g})),o.addControl(v,u))},[l,u,d,a,g,v,o]}class c4 extends Wt{constructor(e){super(),Gt(this,e,l4,null,Vt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function u4(r,e,t){let o;const{map:l}=wc();yt(r,l,v=>t(5,o=v));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:a="metric"}=e,g=null;return Po(()=>{o!=null&&o.loaded()&&g&&o.removeControl(g)}),r.$$set=v=>{"position"in v&&t(1,u=v.position),"maxWidth"in v&&t(2,d=v.maxWidth),"unit"in v&&t(3,a=v.unit)},r.$$.update=()=>{r.$$.dirty&62&&o&&!g&&(t(4,g=new Pr.ScaleControl({maxWidth:d,unit:a})),o.addControl(g,u))},[l,u,d,a,g,o]}class h4 extends Wt{constructor(e){super(),Gt(this,e,u4,null,Vt,{position:1,maxWidth:2,unit:3})}}const{window:d4}=q0,f4=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),ty=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function iy(r){let e,t,o=r[3]&&ny(r);const l=r[46].default,u=bn(l,r,r[45],ty);return{c(){o&&o.c(),e=Se(),u&&u.c()},m(d,a){o&&o.m(d,a),te(d,e,a),u&&u.m(d,a),t=!0},p(d,a){d[3]?o?(o.p(d,a),a[0]&8&&se(o,1)):(o=ny(d),o.c(),se(o,1),o.m(e.parentNode,e)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&wn(u,l,d,d[45],t?vn(l,d[45],a,f4):xn(d[45]),ty)},i(d){t||(se(o),se(u,d),t=!0)},o(d){de(o),de(u,d),t=!1},d(d){d&&ee(e),o&&o.d(d),u&&u.d(d)}}}function ny(r){let e,t,o,l,u,d,a,g;return e=new c4({props:{position:r[7]}}),o=new t4({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),u=new J3({props:{position:r[7]}}),a=new h4({props:{position:r[7]}}),{c(){Ue(e.$$.fragment),t=Se(),Ue(o.$$.fragment),l=Se(),Ue(u.$$.fragment),d=Se(),Ue(a.$$.fragment)},m(v,k){Ne(e,v,k),te(v,t,k),Ne(o,v,k),te(v,l,k),Ne(u,v,k),te(v,d,k),Ne(a,v,k),g=!0},p(v,k){const S={};k[0]&128&&(S.position=v[7]),e.$set(S);const E={};k[0]&128&&(E.position=v[7]),o.$set(E);const P={};k[0]&128&&(P.position=v[7]),u.$set(P);const z={};k[0]&128&&(z.position=v[7]),a.$set(z)},i(v){g||(se(e.$$.fragment,v),se(o.$$.fragment,v),se(u.$$.fragment,v),se(a.$$.fragment,v),g=!0)},o(v){de(e.$$.fragment,v),de(o.$$.fragment,v),de(u.$$.fragment,v),de(a.$$.fragment,v),g=!1},d(v){v&&(ee(t),ee(l),ee(d)),je(e,v),je(o,v),je(u,v),je(a,v)}}}function p4(r){let e,t,o,l,u,d=r[4]&&r[0]&&iy(r);return{c(){e=ie("div"),d&&d.c(),Fe(e,"class",t=Cd(r[2])+" svelte-p00lfq"),Fe(e,"data-testid","map-container"),dr(e,"expand-map",!r[2])},m(a,g){te(a,e,g),d&&d.m(e,null),r[47](e),o=!0,l||(u=[wt(d4,"hashchange",r[11]),mp(r[10].call(null,e))],l=!0)},p(a,g){a[4]&&a[0]?d?(d.p(a,g),g[0]&17&&se(d,1)):(d=iy(a),d.c(),se(d,1),d.m(e,null)):d&&(Li(),de(d,1,1,()=>{d=null}),Mi()),(!o||g[0]&4&&t!==(t=Cd(a[2])+" svelte-p00lfq"))&&Fe(e,"class",t),(!o||g[0]&4)&&dr(e,"expand-map",!a[2])},i(a){o||(se(d),o=!0)},o(a){de(d),o=!1},d(a){a&&ee(e),d&&d.d(),r[47](null),l=!1,cn(u)}}}function m4(r,e,t){let o,l,u,d,{$$slots:a={},$$scope:g}=e,{map:v=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:E}=e,{diffStyleUpdates:P=!1}=e,{center:z=void 0}=e,{zoom:V=void 0}=e,{pitch:$=0}=e,{bearing:H=0}=e,{bounds:G=void 0}=e,{hash:X=!1}=e,{updateHash:le=Ce=>{window.history.replaceState(window.history.state,"",Ce)}}=e,{loaded:xe=!1}=e,{minZoom:Ie=0}=e,{maxZoom:Y=22}=e,{minPitch:K=0}=e,{maxPitch:ue=60}=e,{renderWorldCopies:fe=void 0}=e,{dragPan:ce=void 0}=e,{dragRotate:ae=void 0}=e,{pitchWithRotate:Ge=void 0}=e,{antialias:Le=void 0}=e,{zoomOnDoubleClick:Pe=!0}=e,{locale:rt=void 0}=e,{interactive:it=!0}=e,{attributionControl:Qe=!0}=e,{cooperativeGestures:Ft=!1}=e,{preserveDrawingBuffer:jt=!1}=e,{maxBounds:ut=void 0}=e,{images:et=[]}=e,{standardControls:at=!1}=e,{filterLayers:Bt=void 0}=e,{transformRequest:Dt=void 0}=e;const Ht=bc(),{map:li,loadedImages:ai}=F3();yt(r,li,Ce=>t(4,u=Ce)),yt(r,ai,Ce=>t(5,d=Ce));let ki=new Set;async function Fi(Ce,nt=!1){if(u&&!(!u.loaded()&&!nt))if("url"in Ce){ki.add(Ce.id);try{let Xt=await u.loadImage(Ce.url);u==null||u.addImage(Ce.id,Xt.data,Ce.options),d.add(Ce.id),ai.set(d)}catch(Xt){Ht("error",Xt)}finally{ki.delete(Ce.id)}}else u.addImage(Ce.id,Ce.data,Ce.options),d.add(Ce.id),ai.set(d)}let bi,di,lt,qe;function st(Ce){return pt(),si(li,u=new Pr.Map(oh({container:Ce,style:E,locale:rt,center:z,zoom:V,pitch:$,bearing:H,minZoom:Ie,maxZoom:Y,minPitch:K,maxPitch:ue,renderWorldCopies:fe,dragPan:ce,dragRotate:ae,pitchWithRotate:Ge,antialias:Le,interactive:it,preserveDrawingBuffer:jt,maxBounds:ut,bounds:G,attributionControl:Qe,transformRequest:Dt,cooperativeGestures:Ft})),u),u.on("load",nt=>{nt.target.getContainer().setAttribute("data-testid","map"),nt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,xe=!0),Ht("load",u)}),u.on("error",nt=>Ht("error",{...nt,map:u})),u.on("movestart",nt=>Ht("movestart",{...nt,map:u})),u.on("moveend",nt=>{if(t(12,z=nt.target.getCenter()),t(13,V=nt.target.getZoom()),t(14,$=nt.target.getPitch()),t(15,H=nt.target.getBearing()),t(16,G=nt.target.getBounds()),Ht("moveend",{...nt,map:u}),X){let Xt=new URL(window.location.href.replace(/(#.+)?$/,s4(u)));le(Xt)}}),u.on("click",nt=>Ht("click",{...nt,map:u})),u.on("dblclick",nt=>Ht("dblclick",{...nt,map:u})),u.on("contextmenu",nt=>Ht("contextmenu",{...nt,map:u})),u.on("zoomstart",nt=>Ht("zoomstart",{...nt,map:u})),u.on("zoom",nt=>{Ht("zoom",{...nt,map:u})}),u.on("zoomend",nt=>{Ht("zoomend",{...nt,map:u})}),u.on("style.load",()=>{if(u){const nt=u.getStyle();if(t(42,bi=nt.layers.map(Xt=>Xt.id)),t(43,di=Object.keys(nt.sources)),qe)for(const[Xt,vi]of Object.entries(qe))u.addSource(Xt,vi);if(lt)for(const Xt of lt)u.addLayer(Xt);for(const Xt of et)Fi(Xt,!0)}}),u.on("styledata",nt=>{if(u&&Bt){const Xt=u.getStyle().layers;if(Xt)for(let vi of Xt)Bt(vi)||u.setLayoutProperty(vi.id,"visibility","none")}Ht("styledata",{...nt,map:u})}),{destroy(){t(0,xe=!1),u==null||u.remove(),si(li,u=null,u)}}}let Te=E;function pt(){if(X){let Ce=a4(window.location.hash);Ce.length>=3&&(t(13,V=Ce[0]),t(12,z=[Ce[2],Ce[1]])),Ce.length==5&&(t(15,H=Ce[3]),t(14,$=Ce[4]))}}function gt(Ce){oi[Ce?"unshift":"push"](()=>{k=Ce,t(1,k)})}return r.$$set=Ce=>{"map"in Ce&&t(17,v=Ce.map),"mapContainer"in Ce&&t(1,k=Ce.mapContainer),"class"in Ce&&t(2,S=Ce.class),"style"in Ce&&t(18,E=Ce.style),"diffStyleUpdates"in Ce&&t(19,P=Ce.diffStyleUpdates),"center"in Ce&&t(12,z=Ce.center),"zoom"in Ce&&t(13,V=Ce.zoom),"pitch"in Ce&&t(14,$=Ce.pitch),"bearing"in Ce&&t(15,H=Ce.bearing),"bounds"in Ce&&t(16,G=Ce.bounds),"hash"in Ce&&t(20,X=Ce.hash),"updateHash"in Ce&&t(21,le=Ce.updateHash),"loaded"in Ce&&t(0,xe=Ce.loaded),"minZoom"in Ce&&t(22,Ie=Ce.minZoom),"maxZoom"in Ce&&t(23,Y=Ce.maxZoom),"minPitch"in Ce&&t(24,K=Ce.minPitch),"maxPitch"in Ce&&t(25,ue=Ce.maxPitch),"renderWorldCopies"in Ce&&t(26,fe=Ce.renderWorldCopies),"dragPan"in Ce&&t(27,ce=Ce.dragPan),"dragRotate"in Ce&&t(28,ae=Ce.dragRotate),"pitchWithRotate"in Ce&&t(29,Ge=Ce.pitchWithRotate),"antialias"in Ce&&t(30,Le=Ce.antialias),"zoomOnDoubleClick"in Ce&&t(31,Pe=Ce.zoomOnDoubleClick),"locale"in Ce&&t(32,rt=Ce.locale),"interactive"in Ce&&t(33,it=Ce.interactive),"attributionControl"in Ce&&t(34,Qe=Ce.attributionControl),"cooperativeGestures"in Ce&&t(35,Ft=Ce.cooperativeGestures),"preserveDrawingBuffer"in Ce&&t(36,jt=Ce.preserveDrawingBuffer),"maxBounds"in Ce&&t(37,ut=Ce.maxBounds),"images"in Ce&&t(38,et=Ce.images),"standardControls"in Ce&&t(3,at=Ce.standardControls),"filterLayers"in Ce&&t(39,Bt=Ce.filterLayers),"transformRequest"in Ce&&t(40,Dt=Ce.transformRequest),"$$scope"in Ce&&t(45,g=Ce.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,o=typeof at=="boolean"?void 0:at),r.$$.dirty[0]&16&&t(17,v=u),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&u&&!nc(E,Te)){const Ce=u.getStyle();if(bi&&(lt=Ce.layers.filter(nt=>!bi.includes(nt.id))),di){const nt=Object.keys(Ce.sources).filter(Xt=>!di.includes(Xt));qe={};for(const Xt of nt)qe[Xt]=Ce.sources[Xt]}t(44,Te=E),u.setStyle(E,{diff:P}),si(ai,d=new Set,d),t(41,ki=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&xe&&u!=null&&u.loaded())for(let Ce of et)!d.has(Ce.id)&&!ki.has(Ce.id)&&!u.hasImage(Ce.id)&&Fi(Ce);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,l=et.every(Ce=>d.has(Ce.id))),r.$$.dirty[0]&61456&&u){let Ce={};z!=null&&!nc(z,u==null?void 0:u.getCenter())&&(Ce.center=z),V!=null&&!nc(V,u==null?void 0:u.getZoom())&&(Ce.zoom=V),H!=null&&!nc(H,u==null?void 0:u.getBearing())&&(Ce.bearing=H),$!=null&&!nc($,u==null?void 0:u.getPitch())&&(Ce.pitch=$),Object.keys(Ce).length&&u.easeTo(Ce)}r.$$.dirty[0]&65552&&G&&!nc(G,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(G)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(Pe?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[xe,k,S,at,u,d,l,o,li,ai,st,pt,z,V,$,H,G,v,E,P,X,le,Ie,Y,K,ue,fe,ce,ae,Ge,Le,Pe,rt,it,Qe,Ft,jt,ut,et,Bt,Dt,ki,bi,di,Te,g,a,gt]}class _4 extends Wt{constructor(e){super(),Gt(this,e,m4,p4,Vt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const g4=r=>({marker:r&8}),ry=r=>({marker:r[3]});function y4(r){let e,t,o,l,u,d,a;const g=r[19].default,v=bn(g,r,r[18],ry);return{c(){e=ie("div"),v&&v.c(),Fe(e,"tabindex",t=r[1]?0:void 0),Fe(e,"role",o=r[1]?"button":void 0),ui(e,"z-index",r[2])},m(k,S){te(k,e,S),v&&v.m(e,null),u=!0,d||(a=[mp(r[7].call(null,e)),mp(l=b4.call(null,e,r[0])),wt(e,"click",op(r[20])),wt(e,"dblclick",op(r[21])),wt(e,"contextmenu",op(lh(r[22]))),wt(e,"mouseenter",r[23]),wt(e,"mouseleave",r[24]),wt(e,"mousemove",r[25]),wt(e,"keydown",r[8])],d=!0)},p(k,[S]){v&&v.p&&(!u||S&262152)&&wn(v,g,k,k[18],u?vn(g,k[18],S,g4):xn(k[18]),ry),(!u||S&2&&t!==(t=k[1]?0:void 0))&&Fe(e,"tabindex",t),(!u||S&2&&o!==(o=k[1]?"button":void 0))&&Fe(e,"role",o),l&&tl(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&ui(e,"z-index",k[2])},i(k){u||(se(v,k),u=!0)},o(k){de(v,k),u=!1},d(k){k&&ee(e),v&&v.d(k),d=!1,cn(a)}}}function b4(r,e){const t=r.className;function o(l){l?r.className=`${t} ${l}`:r.className=t}return o(e),{update:o}}function v4(r,e,t){let o,l,u,{$$slots:d={},$$scope:a}=e,{marker:g=void 0}=e,{lngLat:v}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:E=!1}=e,{draggable:P=!1}=e,{feature:z=null}=e,{offset:V=void 0}=e,{zIndex:$=void 0}=e,{rotation:H=0}=e,{opacity:G=1}=e;const X=bc(),{map:le,layerEvent:xe,self:Ie,markerClickManager:Y}=O3();yt(r,le,Qe=>t(27,u=Qe)),yt(r,xe,Qe=>t(26,o=Qe)),yt(r,Ie,Qe=>t(3,l=Qe));function K(Qe){si(Ie,l=new Pr.Marker({element:Qe,rotation:H,draggable:P,offset:V,opacity:G.toString()}).setLngLat(v).addTo(u),l),t(11,g=l);const Ft=()=>ce("dragstart"),jt=()=>{ue(),ce("drag")},ut=()=>{ue(),ce("dragend")};return P&&(l.on("dragstart",Ft),l.on("drag",jt),l.on("dragend",ut)),{destroy(){P&&(l==null||l.off("dragstart",Ft),l==null||l.off("drag",jt),l==null||l.off("dragend",ut)),t(11,g=void 0),l==null||l.remove()}}}function ue(){let Qe=l==null?void 0:l.getLngLat();Qe&&(Array.isArray(v)?t(10,v=[Qe.lng,Qe.lat]):v&&"lon"in v?t(10,v={lon:Qe.lng,lat:Qe.lat}):t(10,v=Qe))}function fe(Qe){Qe.key===" "&&(Qe.preventDefault(),Qe.stopPropagation(),ce("click"))}function ce(Qe){if(!S)return;let Ft=l==null?void 0:l.getLngLat();if(!Ft)return;const jt=[Ft.lng,Ft.lat];let ut={map:u,marker:l,lngLat:jt,features:[{type:"Feature",properties:(z==null?void 0:z.properties)??{},geometry:{type:"Point",coordinates:jt}}]};(Qe==="click"||Qe==="contextmenu")&&Y.handleClick(ut),si(xe,o={...ut,layerType:"marker",type:Qe},o),X(Qe,ut)}const ae=()=>ce("click"),Ge=()=>ce("dblclick"),Le=()=>{ce("contextmenu")},Pe=()=>{ce("mouseenter")},rt=()=>{ce("mouseleave")},it=()=>ce("mousemove");return r.$$set=Qe=>{"marker"in Qe&&t(11,g=Qe.marker),"lngLat"in Qe&&t(10,v=Qe.lngLat),"class"in Qe&&t(0,k=Qe.class),"interactive"in Qe&&t(12,S=Qe.interactive),"asButton"in Qe&&t(1,E=Qe.asButton),"draggable"in Qe&&t(13,P=Qe.draggable),"feature"in Qe&&t(14,z=Qe.feature),"offset"in Qe&&t(15,V=Qe.offset),"zIndex"in Qe&&t(2,$=Qe.zIndex),"rotation"in Qe&&t(16,H=Qe.rotation),"opacity"in Qe&&t(17,G=Qe.opacity),"$$scope"in Qe&&t(18,a=Qe.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(v)),r.$$.dirty&32776&&(l==null||l.setOffset(V??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(H)),r.$$.dirty&131080&&(l==null||l.setOpacity(G.toString()))},[k,E,$,l,le,xe,Ie,K,fe,ce,v,g,S,P,z,V,H,G,a,d,ae,Ge,Le,Pe,rt,it]}class Pd extends Wt{constructor(e){super(),Gt(this,e,v4,y4,Vt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function oy(r){let e=r[0],t,o,l=sy(r);return{c(){l.c(),t=tn()},m(u,d){l.m(u,d),te(u,t,d),o=!0},p(u,d){d&1&&Vt(e,e=u[0])?(Li(),de(l,1,1,We),Mi(),l=sy(u),l.c(),se(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){o||(se(l),o=!0)},o(u){de(l),o=!1},d(u){u&&ee(t),l.d(u)}}}function sy(r){let e;const t=r[15].default,o=bn(t,r,r[14],null);return{c(){o&&o.c()},m(l,u){o&&o.m(l,u),e=!0},p(l,u){o&&o.p&&(!e||u&16384)&&wn(o,t,l,l[14],e?vn(t,l[14],u,null):xn(l[14]),null)},i(l){e||(se(o,l),e=!0)},o(l){de(o,l),e=!1},d(l){o&&o.d(l)}}}function w4(r){let e,t,o=r[0]&&oy(r);return{c(){o&&o.c(),e=tn()},m(l,u){o&&o.m(l,u),te(l,e,u),t=!0},p(l,[u]){l[0]?o?(o.p(l,u),u&1&&se(o,1)):(o=oy(l),o.c(),se(o,1),o.m(e.parentNode,e)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d(l)}}}function x4(r,e,t){let o,l,{$$slots:u={},$$scope:d}=e,{id:a=vc("vector")}=e,{url:g=null}=e,{tiles:v=null}=e,{promoteId:k=null}=e,{bounds:S=null}=e,{scheme:E=null}=e,{attribution:P=null}=e,{minzoom:z=null}=e,{maxzoom:V=null}=e,{volatile:$=null}=e;if(g&&g.includes("pmtiles://")&&!Pr.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let le=new _3;Pr.addProtocol("pmtiles",le.tile)}const{map:H,self:G}=C1();yt(r,H,le=>t(13,l=le)),yt(r,G,le=>t(0,o=le));let X;return Po(()=>{o&&l&&(L1(H,o,X),si(G,o=null,o),X=void 0)}),r.$$set=le=>{"id"in le&&t(3,a=le.id),"url"in le&&t(4,g=le.url),"tiles"in le&&t(5,v=le.tiles),"promoteId"in le&&t(6,k=le.promoteId),"bounds"in le&&t(7,S=le.bounds),"scheme"in le&&t(8,E=le.scheme),"attribution"in le&&t(9,P=le.attribution),"minzoom"in le&&t(10,z=le.minzoom),"maxzoom"in le&&t(11,V=le.maxzoom),"volatile"in le&&t(12,$=le.volatile),"$$scope"in le&&t(14,d=le.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&l&&o!==a&&(si(G,o=a,o),E1(l,o,oh({type:"vector",url:g,tiles:v,promoteId:k,bounds:S,scheme:E,attribution:P,minzoom:z,maxzoom:V,volatile:$}),le=>l&&le===o,()=>{o&&(X=l==null?void 0:l.getSource(o))})),r.$$.dirty&8200&&(l==null||l.on("style.load",()=>{X=l==null?void 0:l.getSource(a)}))},[o,H,G,a,g,v,k,S,E,P,z,V,$,l,d,u]}class kc extends Wt{constructor(e){super(),Gt(this,e,x4,w4,Vt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const k4=r=>({}),ay=r=>({}),S4=r=>({}),ly=r=>({}),T4=r=>({}),cy=r=>({}),I4=r=>({}),uy=r=>({});function C4(r){let e,t,o,l,u,d,a,g,v;const k=r[1].top,S=bn(k,r,r[0],uy),E=r[1].left,P=bn(E,r,r[0],cy),z=r[1].main,V=bn(z,r,r[0],ly),$=r[1].right,H=bn($,r,r[0],ay);return{c(){e=ie("div"),S&&S.c(),t=Se(),o=ie("div"),l=ie("div"),P&&P.c(),u=Se(),d=ie("div"),V&&V.c(),a=Se(),g=ie("div"),H&&H.c(),Fe(e,"class","top svelte-11kzs8g"),Fe(l,"class","left svelte-11kzs8g"),Fe(d,"class","main svelte-11kzs8g"),Fe(g,"class","right svelte-11kzs8g"),Fe(o,"class","main-row svelte-11kzs8g")},m(G,X){te(G,e,X),S&&S.m(e,null),te(G,t,X),te(G,o,X),B(o,l),P&&P.m(l,null),B(o,u),B(o,d),V&&V.m(d,null),B(o,a),B(o,g),H&&H.m(g,null),v=!0},p(G,[X]){S&&S.p&&(!v||X&1)&&wn(S,k,G,G[0],v?vn(k,G[0],X,I4):xn(G[0]),uy),P&&P.p&&(!v||X&1)&&wn(P,E,G,G[0],v?vn(E,G[0],X,T4):xn(G[0]),cy),V&&V.p&&(!v||X&1)&&wn(V,z,G,G[0],v?vn(z,G[0],X,S4):xn(G[0]),ly),H&&H.p&&(!v||X&1)&&wn(H,$,G,G[0],v?vn($,G[0],X,k4):xn(G[0]),ay)},i(G){v||(se(S,G),se(P,G),se(V,G),se(H,G),v=!0)},o(G){de(S,G),de(P,G),de(V,G),de(H,G),v=!1},d(G){G&&(ee(e),ee(t),ee(o)),S&&S.d(G),P&&P.d(G),V&&V.d(G),H&&H.d(G)}}}function E4(r,e,t){let{$$slots:o={},$$scope:l}=e;return r.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,o]}class L4 extends Wt{constructor(e){super(),Gt(this,e,E4,C4,Vt,{})}}const M4=r=>({}),hy=r=>({}),A4=r=>({}),dy=r=>({}),P4=r=>({}),fy=r=>({});function z4(r){let e,t,o,l,u,d;const a=r[4].left,g=bn(a,r,r[3],fy),v=r[4].map,k=bn(v,r,r[3],dy),S=r[4].right,E=bn(S,r,r[3],hy);return{c(){e=ie("div"),g&&g.c(),t=Se(),o=ie("div"),k&&k.c(),l=Se(),u=ie("div"),E&&E.c()},m(P,z){te(P,e,z),g&&g.m(e,null),r[5](e),te(P,t,z),te(P,o,z),k&&k.m(o,null),r[6](o),te(P,l,z),te(P,u,z),E&&E.m(u,null),r[7](u),d=!0},p(P,[z]){g&&g.p&&(!d||z&8)&&wn(g,a,P,P[3],d?vn(a,P[3],z,P4):xn(P[3]),fy),k&&k.p&&(!d||z&8)&&wn(k,v,P,P[3],d?vn(v,P[3],z,A4):xn(P[3]),dy),E&&E.p&&(!d||z&8)&&wn(E,S,P,P[3],d?vn(S,P[3],z,M4):xn(P[3]),hy)},i(P){d||(se(g,P),se(k,P),se(E,P),d=!0)},o(P){de(g,P),de(k,P),de(E,P),d=!1},d(P){P&&(ee(e),ee(t),ee(o),ee(l),ee(u)),g&&g.d(P),r[5](null),k&&k.d(P),r[6](null),E&&E.d(P),r[7](null)}}}function D4(r,e,t){let o,l,u;yt(r,Lp,S=>t(0,o=S)),yt(r,Ap,S=>t(1,l=S)),yt(r,Mp,S=>t(2,u=S));let{$$slots:d={},$$scope:a}=e;function g(S){oi[S?"unshift":"push"](()=>{o=S,Lp.set(o)})}function v(S){oi[S?"unshift":"push"](()=>{l=S,Ap.set(l)})}function k(S){oi[S?"unshift":"push"](()=>{u=S,Mp.set(u)})}return r.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[o,l,u,a,d,g,v,k]}class Sc extends Wt{constructor(e){super(),Gt(this,e,D4,z4,Vt,{})}}let Lp=Ei(null),Mp=Ei(null),Ap=Ei(null);const R4="/npw/assets/help-d011708a.svg";function py(r){let e,t;return{c(){e=ie("div"),t=we(r[0]),Fe(e,"class","svelte-1uuov7f")},m(o,l){te(o,e,l),B(e,t)},p(o,l){l&1&&dt(t,o[0])},d(o){o&&ee(e)}}}function F4(r){let e,t=r[0]&&py(r);return{c(){t&&t.c(),e=tn()},m(o,l){t&&t.m(o,l),te(o,e,l)},p(o,[l]){o[0]?t?t.p(o,l):(t=py(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:We,o:We,d(o){o&&ee(e),t&&t.d(o)}}}function B4(r,e,t){let{loading:o}=e;return r.$$set=l=>{"loading"in l&&t(0,o=l.loading)},[o]}class O4 extends Wt{constructor(e){super(),Gt(this,e,B4,F4,Vt,{loading:0})}}const N4=r=>({dialog:r&1}),my=r=>({dialog:r[0]});function j4(r){let e,t,o,l,u;const d=r[4].default,a=bn(d,r,r[3],my);return{c(){e=ie("dialog"),t=ie("article"),a&&a.c(),e.open=!0},m(g,v){te(g,e,v),B(e,t),a&&a.m(t,null),r[6](e),o=!0,l||(u=[wt(window,"click",r[1]),wt(window,"keydown",r[2]),wt(e,"close",r[5])],l=!0)},p(g,[v]){a&&a.p&&(!o||v&9)&&wn(a,d,g,g[3],o?vn(d,g[3],v,N4):xn(g[3]),my)},i(g){o||(se(a,g),o=!0)},o(g){de(a,g),o=!1},d(g){g&&ee(e),a&&a.d(g),r[6](null),l=!1,cn(u)}}}function U4(r,e,t){let{$$slots:o={},$$scope:l}=e,u;function d(k){u.open&&k.target==u&&u.close()}function a(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function g(k){On.call(this,r,k)}function v(k){oi[k?"unshift":"push"](()=>{u=k,t(0,u)})}return r.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,d,a,l,o,g,v]}class A1 extends Wt{constructor(e){super(),Gt(this,e,U4,j4,Vt,{})}}function _y(r,e,t){const o=r.slice();return o[1]=e[t][0],o[2]=e[t][1],o}function gy(r){let e,t,o=r[1]+"",l,u,d,a=r[2]+"",g,v;return{c(){e=ie("tr"),t=ie("td"),l=we(o),u=Se(),d=ie("td"),g=we(a),v=Se()},m(k,S){te(k,e,S),B(e,t),B(t,l),B(e,u),B(e,d),B(d,g),B(e,v)},p(k,S){S&1&&o!==(o=k[1]+"")&&dt(l,o),S&1&&a!==(a=k[2]+"")&&dt(g,a)},d(k){k&&ee(e)}}}function $4(r){let e,t,o=yi(Object.entries(r[0])),l=[];for(let u=0;u<o.length;u+=1)l[u]=gy(_y(r,o,u));return{c(){e=ie("table"),t=ie("tbody");for(let u=0;u<l.length;u+=1)l[u].c();Fe(e,"class","svelte-lh2o9l")},m(u,d){te(u,e,d),B(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[d]){if(d&1){o=yi(Object.entries(u[0]));let a;for(a=0;a<o.length;a+=1){const g=_y(u,o,a);l[a]?l[a].p(g,d):(l[a]=gy(g),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=o.length}},i:We,o:We,d(u){u&&ee(e),$n(l,u)}}}function V4(r,e,t){let{properties:o}=e;return r.$$set=l=>{"properties"in l&&t(0,o=l.properties)},[o]}class q4 extends Wt{constructor(e){super(),Gt(this,e,V4,$4,Vt,{properties:0})}}function yy(r,e,t){const o=r.slice();return o[3]=e[t],o}function by(r,e,t){const o=r.slice();return o[6]=e[t],o}function vy(r){let e,t;return{c(){e=ie("span"),t=we(` 
    `),ui(e,"background",r[6]),ui(e,"width","100%"),ui(e,"border","1px solid black")},m(o,l){te(o,e,l),B(e,t)},p(o,l){l&1&&ui(e,"background",o[6])},d(o){o&&ee(e)}}}function Z4(r){let e,t=r[3]+"",o;return{c(){e=ie("span"),o=we(t)},m(l,u){te(l,e,u),B(e,o)},p(l,u){u&2&&t!==(t=l[3]+"")&&dt(o,t)},d(l){l&&ee(e)}}}function G4(r){let e,t=r[3].toFixed(r[2])+"",o;return{c(){e=ie("span"),o=we(t)},m(l,u){te(l,e,u),B(e,o)},p(l,u){u&6&&t!==(t=l[3].toFixed(l[2])+"")&&dt(o,t)},d(l){l&&ee(e)}}}function wy(r){let e;function t(u,d){return u[2]>0?G4:Z4}let o=t(r),l=o(r);return{c(){l.c(),e=tn()},m(u,d){l.m(u,d),te(u,e,d)},p(u,d){o===(o=t(u))&&l?l.p(u,d):(l.d(1),l=o(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&ee(e),l.d(u)}}}function W4(r){let e,t,o,l=yi(r[0]),u=[];for(let g=0;g<l.length;g+=1)u[g]=vy(by(r,l,g));let d=yi(r[1]),a=[];for(let g=0;g<d.length;g+=1)a[g]=wy(yy(r,d,g));return{c(){e=ie("div");for(let g=0;g<u.length;g+=1)u[g].c();t=Se(),o=ie("div");for(let g=0;g<a.length;g+=1)a[g].c();ui(e,"display","flex"),ui(o,"display","flex"),ui(o,"justify-content","space-between")},m(g,v){te(g,e,v);for(let k=0;k<u.length;k+=1)u[k]&&u[k].m(e,null);te(g,t,v),te(g,o,v);for(let k=0;k<a.length;k+=1)a[k]&&a[k].m(o,null)},p(g,[v]){if(v&1){l=yi(g[0]);let k;for(k=0;k<l.length;k+=1){const S=by(g,l,k);u[k]?u[k].p(S,v):(u[k]=vy(S),u[k].c(),u[k].m(e,null))}for(;k<u.length;k+=1)u[k].d(1);u.length=l.length}if(v&6){d=yi(g[1]);let k;for(k=0;k<d.length;k+=1){const S=yy(g,d,k);a[k]?a[k].p(S,v):(a[k]=wy(S),a[k].c(),a[k].m(o,null))}for(;k<a.length;k+=1)a[k].d(1);a.length=d.length}},i:We,o:We,d(g){g&&(ee(e),ee(t),ee(o)),$n(u,g),$n(a,g)}}}function H4(r,e,t){let{colorScale:o}=e,{limits:l}=e,{decimalPlaces:u=0}=e;return r.$$set=d=>{"colorScale"in d&&t(0,o=d.colorScale),"limits"in d&&t(1,l=d.limits),"decimalPlaces"in d&&t(2,u=d.decimalPlaces)},[o,l,u]}class Qp extends Wt{constructor(e){super(),Gt(this,e,H4,W4,Vt,{colorScale:0,limits:1,decimalPlaces:2})}}function zo(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}function xy(r){let e,t;return e=new A1({props:{$$slots:{default:[X4]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function X4(r){let e,t,o;const l=r[1].default,u=bn(l,r,r[4],null);return{c(){e=ie("h2"),e.textContent="Help",t=Se(),u&&u.c()},m(d,a){te(d,e,a),te(d,t,a),u&&u.m(d,a),o=!0},p(d,a){u&&u.p&&(!o||a&16)&&wn(u,l,d,d[4],o?vn(l,d[4],a,null):xn(d[4]),null)},i(d){o||(se(u,d),o=!0)},o(d){de(u,d),o=!1},d(d){d&&(ee(e),ee(t)),u&&u.d(d)}}}function K4(r){let e,t,o,l,u,d,a=r[0]&&xy(r);return{c(){e=ie("button"),e.innerHTML=`<img src="${R4}" title="Help" alt="Help"/>`,t=Se(),a&&a.c(),o=tn(),Fe(e,"class","svelte-gb6dzm")},m(g,v){te(g,e,v),te(g,t,v),a&&a.m(g,v),te(g,o,v),l=!0,u||(d=wt(e,"click",r[2]),u=!0)},p(g,[v]){g[0]?a?(a.p(g,v),v&1&&se(a,1)):(a=xy(g),a.c(),se(a,1),a.m(o.parentNode,o)):a&&(Li(),de(a,1,1,()=>{a=null}),Mi())},i(g){l||(se(a),l=!0)},o(g){de(a),l=!1},d(g){g&&(ee(e),ee(t),ee(o)),a&&a.d(g),u=!1,d()}}}function J4(r,e,t){let{$$slots:o={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),a=()=>t(0,u=!1);return r.$$set=g=>{"$$scope"in g&&t(4,l=g.$$scope)},[u,o,d,a,l]}class P1 extends Wt{constructor(e){super(),Gt(this,e,J4,K4,Vt,{})}}function ky(r,e,t){const o=r.slice();return o[1]=e[t][0],o[2]=e[t][1],o}function Sy(r){let e,t,o,l=r[1]+"",u,d;return{c(){e=ie("li"),t=ie("span"),o=Se(),u=we(l),d=Se(),Fe(t,"class","svelte-kzgqtg"),ui(t,"background",r[2])},m(a,g){te(a,e,g),B(e,t),B(e,o),B(e,u),B(e,d)},p(a,g){g&1&&ui(t,"background",a[2]),g&1&&l!==(l=a[1]+"")&&dt(u,l)},d(a){a&&ee(e)}}}function Y4(r){let e,t=yi(Object.entries(r[0])),o=[];for(let l=0;l<t.length;l+=1)o[l]=Sy(ky(r,t,l));return{c(){e=ie("ul");for(let l=0;l<o.length;l+=1)o[l].c()},m(l,u){te(l,e,u);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(e,null)},p(l,[u]){if(u&1){t=yi(Object.entries(l[0]));let d;for(d=0;d<t.length;d+=1){const a=ky(l,t,d);o[d]?o[d].p(a,u):(o[d]=Sy(a),o[d].c(),o[d].m(e,null))}for(;d<o.length;d+=1)o[d].d(1);o.length=t.length}},i:We,o:We,d(l){l&&ee(e),$n(o,l)}}}function Q4(r,e,t){let{colors:o}=e;return r.$$set=l=>{"colors"in l&&t(0,o=l.colors)},[o]}class nl extends Wt{constructor(e){super(),Gt(this,e,Q4,Y4,Vt,{colors:0})}}let Ye;const gs=new Array(128).fill(void 0);gs.push(void 0,null,!0,!1);function ni(r){return gs[r]}let Xu=gs.length;function ek(r){r<132||(gs[r]=Xu,Xu=r)}function dn(r){const e=ni(r);return ek(r),e}const z1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&z1.decode();let $u=null;function pc(){return($u===null||$u.byteLength===0)&&($u=new Uint8Array(Ye.memory.buffer)),$u}function fn(r,e){return r=r>>>0,z1.decode(pc().subarray(r,r+e))}function en(r){Xu===gs.length&&gs.push(gs.length+1);const e=Xu;return Xu=gs[e],gs[e]=r,e}let $o=0;const Td=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},tk=typeof Td.encodeInto=="function"?function(r,e){return Td.encodeInto(r,e)}:function(r,e){const t=Td.encode(r);return e.set(t),{read:r.length,written:t.length}};function el(r,e,t){if(t===void 0){const a=Td.encode(r),g=e(a.length,1)>>>0;return pc().subarray(g,g+a.length).set(a),$o=a.length,g}let o=r.length,l=e(o,1)>>>0;const u=pc();let d=0;for(;d<o;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==o){d!==0&&(r=r.slice(d)),l=t(l,o,o=d+r.length*3,1)>>>0;const a=pc().subarray(l+d,l+o),g=tk(r,a);d+=g.written,l=t(l,o,d,1)>>>0}return $o=d,l}function Ja(r){return r==null}let Ka=null;function ft(){return(Ka===null||Ka.buffer.detached===!0||Ka.buffer.detached===void 0&&Ka.buffer!==Ye.memory.buffer)&&(Ka=new DataView(Ye.memory.buffer)),Ka}function Pp(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=Pp(r[0]));for(let d=1;d<l;d++)u+=", "+Pp(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let o;if(t.length>1)o=t[1];else return toString.call(r);if(o=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:o}function ik(r,e){const t=e(r.length*1,1)>>>0;return pc().set(r,t/1),$o=r.length,t}let Vu=null;function nk(){return(Vu===null||Vu.byteLength===0)&&(Vu=new Float64Array(Ye.memory.buffer)),Vu}function rk(r,e){return r=r>>>0,nk().subarray(r/8,r/8+e)}function ok(r,e){return r=r>>>0,pc().subarray(r/1,r/1+e)}function la(r,e){try{return r.apply(this,e)}catch(t){Ye.__wbindgen_exn_store(en(t))}}const Ty=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>Ye.__wbg_mapmodel_free(r>>>0,1));class sk{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ty.unregister(this),e}free(){const e=this.__destroy_into_raw();Ye.__wbg_mapmodel_free(e,0)}constructor(e){try{const u=Ye.__wbindgen_add_to_stack_pointer(-16),d=ik(e,Ye.__wbindgen_malloc),a=$o;Ye.mapmodel_new(u,d,a);var t=ft().getInt32(u+4*0,!0),o=ft().getInt32(u+4*1,!0),l=ft().getInt32(u+4*2,!0);if(l)throw dn(o);return this.__wbg_ptr=t>>>0,Ty.register(this,this.__wbg_ptr,this),this}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderDebug(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getInvertedBoundary(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getInvertedBoundary(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getBounds(){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getBounds(l,this.__wbg_ptr);var e=ft().getInt32(l+4*0,!0),t=ft().getInt32(l+4*1,!0),o=rk(e,t).slice();return Ye.__wbindgen_free(e,t*8,8),o}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_toRouteSnapper(l,this.__wbg_ptr);var e=ft().getInt32(l+4*0,!0),t=ft().getInt32(l+4*1,!0),o=ok(e,t).slice();return Ye.__wbindgen_free(e,t*1,1),o}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,t){try{const u=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_setRoute(u,this.__wbg_ptr,!Ja(e),Ja(e)?0:e,en(t));var o=ft().getInt32(u+4*0,!0),l=ft().getInt32(u+4*1,!0);if(l)throw dn(o)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_deleteRoute(l,this.__wbg_ptr,e);var t=ft().getInt32(l+4*0,!0),o=ft().getInt32(l+4*1,!0);if(o)throw dn(t)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){Ye.mapmodel_clearAllRoutes(this.__wbg_ptr)}autosplitRoute(e){let t,o;try{const k=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_autosplitRoute(k,this.__wbg_ptr,en(e));var l=ft().getInt32(k+4*0,!0),u=ft().getInt32(k+4*1,!0),d=ft().getInt32(k+4*2,!0),a=ft().getInt32(k+4*3,!0),g=l,v=u;if(a)throw g=0,v=0,dn(d);return t=g,o=v,fn(g,v)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(t,o,1)}}renderRoutes(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderRoutes(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}evaluateRoute(e){let t,o;try{const k=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_evaluateRoute(k,this.__wbg_ptr,en(e));var l=ft().getInt32(k+4*0,!0),u=ft().getInt32(k+4*1,!0),d=ft().getInt32(k+4*2,!0),a=ft().getInt32(k+4*3,!0),g=l,v=u;if(a)throw g=0,v=0,dn(d);return t=g,o=v,fn(g,v)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(t,o,1)}}debugReachablePath(e,t){let o,l;try{const S=Ye.__wbindgen_add_to_stack_pointer(-16),E=el(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),P=$o;Ye.mapmodel_debugReachablePath(S,this.__wbg_ptr,E,P,t);var u=ft().getInt32(S+4*0,!0),d=ft().getInt32(S+4*1,!0),a=ft().getInt32(S+4*2,!0),g=ft().getInt32(S+4*3,!0),v=u,k=d;if(g)throw v=0,k=0,dn(a);return o=v,l=k,fn(v,k)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(o,l,1)}}debugUnreachablePath(e,t){let o,l;try{const S=Ye.__wbindgen_add_to_stack_pointer(-16),E=el(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),P=$o;Ye.mapmodel_debugUnreachablePath(S,this.__wbg_ptr,E,P,t);var u=ft().getInt32(S+4*0,!0),d=ft().getInt32(S+4*1,!0),a=ft().getInt32(S+4*2,!0),g=ft().getInt32(S+4*3,!0),v=u,k=d;if(g)throw v=0,k=0,dn(a);return o=v,l=k,fn(v,k)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(o,l,1)}}evaluateOD(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_evaluateOD(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}recalculateStats(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_recalculateStats(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_toSavefile(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16),u=el(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),d=$o;Ye.mapmodel_loadSavefile(l,this.__wbg_ptr,u,d);var t=ft().getInt32(l+4*0,!0),o=ft().getInt32(l+4*1,!0);if(o)throw dn(t)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_meshDensity(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}classifyExistingNetwork(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_classifyExistingNetwork(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}importExistingRoutes(){return Ye.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return Ye.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getSchools(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getGPHospitals(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getGPHospitals(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getTownCentres(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getTownCentres(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getDataZones(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getDataZones(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderReachableNetwork(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderReachableNetwork(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderLevelOfService(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderLevelOfService(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderCoreNetwork(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderCoreNetwork(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderPrecalculatedFlows(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderPrecalculatedFlows(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getMajorJunctions(){let e,t;try{const v=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getMajorJunctions(v,this.__wbg_ptr);var o=ft().getInt32(v+4*0,!0),l=ft().getInt32(v+4*1,!0),u=ft().getInt32(v+4*2,!0),d=ft().getInt32(v+4*3,!0),a=o,g=l;if(d)throw a=0,g=0,dn(u);return e=a,t=g,fn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}}async function ak(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(o){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function lk(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){dn(e)},r.wbg.__wbindgen_string_new=function(e,t){const o=fn(e,t);return en(o)},r.wbg.__wbindgen_string_get=function(e,t){const o=ni(t),l=typeof o=="string"?o:void 0;var u=Ja(l)?0:el(l,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),d=$o;ft().setInt32(e+4*1,d,!0),ft().setInt32(e+4*0,u,!0)},r.wbg.__wbindgen_number_get=function(e,t){const o=ni(t),l=typeof o=="number"?o:void 0;ft().setFloat64(e+8*1,Ja(l)?0:l,!0),ft().setInt32(e+4*0,!Ja(l),!0)},r.wbg.__wbindgen_error_new=function(e,t){const o=new Error(fn(e,t));return en(o)},r.wbg.__wbindgen_boolean_get=function(e){const t=ni(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof ni(e)=="bigint"},r.wbg.__wbindgen_is_object=function(e){const t=ni(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return ni(e)in ni(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return en(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return ni(e)===ni(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return en(t)},r.wbg.__wbindgen_is_string=function(e){return typeof ni(e)=="string"},r.wbg.__wbindgen_is_undefined=function(e){return ni(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return ni(e)==ni(t)},r.wbg.__wbindgen_as_number=function(e){return+ni(e)},r.wbg.__wbg_String_b9412f8799faab3e=function(e,t){const o=String(ni(t)),l=el(o,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=$o;ft().setInt32(e+4*1,u,!0),ft().setInt32(e+4*0,l,!0)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=ni(e);return en(t)},r.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,t){const o=ni(e)[ni(t)];return en(o)},r.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(ni(e))},r.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(ni(e))},r.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(ni(e))},r.wbg.__wbg_log_b103404cc5920657=function(e){console.log(ni(e))},r.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(ni(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return en(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const o=ni(t).stack,l=el(o,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=$o;ft().setInt32(e+4*1,u,!0),ft().setInt32(e+4*0,l,!0)},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let o,l;try{o=e,l=t,console.error(fn(e,t))}finally{Ye.__wbindgen_free(o,l,1)}},r.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const t=ni(e).performance;return en(t)},r.wbg.__wbg_now_abd80e969af37148=function(e){return ni(e).now()},r.wbg.__wbg_get_3baa728f9d58d3f6=function(e,t){const o=ni(e)[t>>>0];return en(o)},r.wbg.__wbg_length_ae22078168b726f5=function(e){return ni(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof ni(e)=="function"},r.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,t){const o=new Function(fn(e,t));return en(o)},r.wbg.__wbg_next_de3e9db4440638b2=function(e){const t=ni(e).next;return en(t)},r.wbg.__wbg_next_f9cb570345655b9a=function(){return la(function(e){const t=ni(e).next();return en(t)},arguments)},r.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return ni(e).done},r.wbg.__wbg_value_6d39332ab4788d86=function(e){const t=ni(e).value;return en(t)},r.wbg.__wbg_iterator_888179a48810a9fe=function(){return en(Symbol.iterator)},r.wbg.__wbg_get_224d16597dbbfd96=function(){return la(function(e,t){const o=Reflect.get(ni(e),ni(t));return en(o)},arguments)},r.wbg.__wbg_call_1084a111329e68ce=function(){return la(function(e,t){const o=ni(e).call(ni(t));return en(o)},arguments)},r.wbg.__wbg_self_3093d5d1f7bcb682=function(){return la(function(){const e=self.self;return en(e)},arguments)},r.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return la(function(){const e=window.window;return en(e)},arguments)},r.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return la(function(){const e=globalThis.globalThis;return en(e)},arguments)},r.wbg.__wbg_global_e5a3fe56f8be9485=function(){return la(function(){const e=global.global;return en(e)},arguments)},r.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(ni(e))},r.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let t;try{t=ni(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_call_89af060b4e1523f2=function(){return la(function(e,t,o){const l=ni(e).call(ni(t),ni(o));return en(l)},arguments)},r.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let t;try{t=ni(e)instanceof Map}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(ni(e))},r.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const t=Object.entries(ni(e));return en(t)},r.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const t=ni(e).buffer;return en(t)},r.wbg.__wbg_new_ea1883e1e5e86686=function(e){const t=new Uint8Array(ni(e));return en(t)},r.wbg.__wbg_set_d1e79e2388520f18=function(e,t,o){ni(e).set(ni(t),o>>>0)},r.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return ni(e).length},r.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let t;try{t=ni(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const o=ni(t),l=typeof o=="bigint"?o:void 0;ft().setBigInt64(e+8*1,Ja(l)?BigInt(0):l,!0),ft().setInt32(e+4*0,!Ja(l),!0)},r.wbg.__wbindgen_debug_string=function(e,t){const o=Pp(ni(t)),l=el(o,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=$o;ft().setInt32(e+4*1,u,!0),ft().setInt32(e+4*0,l,!0)},r.wbg.__wbindgen_throw=function(e,t){throw new Error(fn(e,t))},r.wbg.__wbindgen_memory=function(){const e=Ye.memory;return en(e)},r}function ck(r,e){return Ye=r.exports,D1.__wbindgen_wasm_module=e,Ka=null,Vu=null,$u=null,Ye}async function D1(r){if(Ye!==void 0)return Ye;typeof r<"u"&&Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof r>"u"&&(r=new URL("backend_bg.wasm",self.location));const e=lk();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:o}=await ak(await r,e);return ck(t,o)}class uk{constructor(){zu(this,"inner");this.inner=null}async loadFile(e){await D1(),this.inner=new sk(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,t){this.checkReady(),this.inner.setRoute(e??void 0,t)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}autosplitRoute(e){return this.checkReady(),JSON.parse(this.inner.autosplitRoute(e))}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,t))}debugUnreachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,t))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let R1="MZEJTanw3WpxRvt7qDfo",zd=Ei(""),hn=Ei({kind:"main"}),ys=Ei("Primary"),F1=Ei(null),sh=Ei(0),An=Ei(null),da=Ei(null),il=Ei(null),zp=Ei("infra_type"),em=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],mc=Object.fromEntries(em.map(([r,e,t])=>[r,[e,t]]));async function ah(){let r=Yu(An),e=Yu(zd);if(!r||!e)return;let t=await r.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,t)}let Dp=Ei(!0);function rl(r){return Yu(Dp)?`https://assets.od2net.org/tmp_npt_editor/${r}`:r}let Iy=Ei(null);function Ri(r){return{id:r,beforeId:hk(r)}}function hk(r){let e=Yu(F1);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,o=!1;for(let l=Ey.length-1;l>=0;l--){let u=Ey[l];if(u==r){o=!0;break}e.getLayer(u)&&(t=u)}if(!o)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Cy=r=>r;const Ey=[Cy("Ferry line"),"all-population","all-population-outline","simd","simd-outline","urban-areas","main-mode","cn-debug","cn","existing-infra-debug","existing-infra","traffic-debug","traffic","gradients","npt-coverage","los-debug","los","rnet","reachability","debug-reachability-town_centres","debug-reachability-schools","debug-reachability-gp_hospitals","gp-hospitals","schools","town-centres","major-junctions","snapper-lines","snapper-preview","edit-current-routes","edit-route-sections","eval-od-mode","debug-mode","mesh-density","mesh-density-outline","eval-current-routes","eval-route-breakdown","eval-car-route",Cy("Road labels"),"fade-study-area"];function dk(r){let e,t,o,l,u,d,a,g;return{c(){e=ie("div"),t=ie("h2"),t.textContent="Debug network mode",o=Se(),l=ie("button"),l.textContent="Back",u=Se(),d=ie("p"),d.textContent="Hover to see a segment's properties, and click to open OSM",Fe(e,"slot","left")},m(v,k){te(v,e,k),B(e,t),B(e,o),B(e,l),B(e,u),B(e,d),a||(g=wt(l,"click",r[3]),a=!0)},p:We,d(v){v&&ee(e),a=!1,g()}}}function fk(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function pk(r){let e,t;return e=new Tn({props:{data:r[4],generateId:!0,$$slots:{default:[gk]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&1&&(u.data=o[4]),l&64&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function mk(r){let e,t;return e=new q4({props:{properties:r[5]}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&32&&(u.properties=o[5]),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function _k(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[mk,({props:o})=>({5:o}),({props:o})=>o?32:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function gk(r){let e,t;const o=[Ri("debug-mode"),{paint:{"line-width":Vn(5,7),"line-color":"black"}},{manageHoverState:!0},{hoverCursor:"pointer"},{eventsIfTopMost:!0}];let l={$$slots:{default:[_k]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),e.$on("click",r[2]),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};d&64&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function yk(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function bk(r){let e,t,o,l={ctx:r,current:null,token:null,hasCatch:!1,pending:yk,then:pk,catch:fk,value:4,blocks:[,,,]};return Dr(t=zo(r[0]).renderDebug(),l),{c(){e=ie("div"),l.block.c(),Fe(e,"slot","map")},m(u,d){te(u,e,d),l.block.m(e,l.anchor=null),l.mount=()=>e,l.anchor=null,o=!0},p(u,d){r=u,l.ctx=r,d&1&&t!==(t=zo(r[0]).renderDebug())&&Dr(t,l)||ba(l,r,d)},i(u){o||(se(l.block),o=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];de(a)}o=!1},d(u){u&&ee(e),l.block.d(),l.token=null,l=null}}}function vk(r){let e,t;return e=new Sc({props:{$$slots:{map:[bk],left:[dk]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,[l]){const u={};l&67&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function wk(r,e,t){let o,l;return yt(r,An,a=>t(0,o=a)),yt(r,hn,a=>t(1,l=a)),[o,l,a=>window.open(zo(a.detail.features[0].properties).way,"_blank"),()=>si(hn,l={kind:"main"},l)]}class xk extends Wt{constructor(e){super(),Gt(this,e,wk,vk,Vt,{})}}function kk(r){let e,t,o,l,u,d;return{c(){e=ie("div"),t=ie("h2"),t.textContent="Debug mesh density mode",o=Se(),l=ie("button"),l.textContent="Back",Fe(e,"slot","left")},m(a,g){te(a,e,g),B(e,t),B(e,o),B(e,l),u||(d=wt(l,"click",r[2]),u=!0)},p:We,d(a){a&&ee(e),u=!1,d()}}}function Sk(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function Tk(r){let e,t;return e=new Tn({props:{data:r[3],generateId:!0,$$slots:{default:[Ik]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&1&&(u.data=o[3]),l&16&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function Ik(r){let e,t,o,l;const u=[Ri("mesh-density"),{paint:{"fill-color":"grey","fill-opacity":Vn(.5,1)}},{manageHoverState:!0}];let d={};for(let v=0;v<u.length;v+=1)d=Di(d,u[v]);e=new xc({props:d});const a=[Ri("mesh-density-outline"),{paint:{"line-color":"black"}}];let g={};for(let v=0;v<a.length;v+=1)g=Di(g,a[v]);return o=new mn({props:g}),{c(){Ue(e.$$.fragment),t=Se(),Ue(o.$$.fragment)},m(v,k){Ne(e,v,k),te(v,t,k),Ne(o,v,k),l=!0},p(v,k){const S={};e.$set(S);const E={};o.$set(E)},i(v){l||(se(e.$$.fragment,v),se(o.$$.fragment,v),l=!0)},o(v){de(e.$$.fragment,v),de(o.$$.fragment,v),l=!1},d(v){v&&ee(t),je(e,v),je(o,v)}}}function Ck(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function Ek(r){let e,t,o,l={ctx:r,current:null,token:null,hasCatch:!1,pending:Ck,then:Tk,catch:Sk,value:3,blocks:[,,,]};return Dr(t=zo(r[0]).meshDensity(),l),{c(){e=ie("div"),l.block.c(),Fe(e,"slot","map")},m(u,d){te(u,e,d),l.block.m(e,l.anchor=null),l.mount=()=>e,l.anchor=null,o=!0},p(u,d){r=u,l.ctx=r,d&1&&t!==(t=zo(r[0]).meshDensity())&&Dr(t,l)||ba(l,r,d)},i(u){o||(se(l.block),o=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];de(a)}o=!1},d(u){u&&ee(e),l.block.d(),l.token=null,l=null}}}function Lk(r){let e,t;return e=new Sc({props:{$$slots:{map:[Ek],left:[kk]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,[l]){const u={};l&19&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function Mk(r,e,t){let o,l;return yt(r,An,d=>t(0,o=d)),yt(r,hn,d=>t(1,l=d)),[o,l,()=>si(hn,l={kind:"main"},l)]}class Ak extends Wt{constructor(e){super(),Gt(this,e,Mk,Lk,Vt,{})}}let B1=Ei(new Map),Rp=Ei(!0),Dd=Ei(!1),Rd=Ei(!1),Fd=Ei(!1),Bd=Ei(!1),Od=Ei(!1),cc=Ei(!1),Fp=Ei(!0),Ly=Ei(!1);function Pk(r){let e,t,o,l;const u=r[1].default,d=bn(u,r,r[0],null);return{c(){e=ie("a"),d&&d.c(),Fe(e,"href","#")},m(a,g){te(a,e,g),d&&d.m(e,null),t=!0,o||(l=wt(e,"click",lh(r[2])),o=!0)},p(a,[g]){d&&d.p&&(!t||g&1)&&wn(d,u,a,a[0],t?vn(u,a[0],g,null):xn(a[0]),null)},i(a){t||(se(d,a),t=!0)},o(a){de(d,a),t=!1},d(a){a&&ee(e),d&&d.d(a),o=!1,l()}}}function zk(r,e,t){let{$$slots:o={},$$scope:l}=e;function u(d){On.call(this,r,d)}return r.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,o,u]}class Dk extends Wt{constructor(e){super(),Gt(this,e,zk,Pk,Vt,{})}}let er={Primary:"#c00000",Secondary:"#e97132",LocalAccess:"#ffc000",LongDistance:"#4ea72e"},tm={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},O1={"<= 3%":"#59ee19","3 - 5%":"#37a009","5 - 7%":"#FFC300","7 - 10%":"#C70039","> 10%":"#581845"},ya=Yo(["get","infra_type"],Object.fromEntries(em.map(r=>[r[0],r[2]])),"red"),Bp=Yo(["get","tier"],er,"cyan"),Op=Yo(["get","los"],tm,"black"),My=Yo(["get","gradient_group"],O1,"black");function Ay(r){let e,t,o,l,u=`2px solid ${er.Primary}`;return{c(){e=ie("details"),t=ie("summary"),t.textContent="Primary Route Reference Layers",o=Se(),l=ie("div"),e.open=!0,ui(e,"border",u)},m(d,a){te(d,e,a),B(e,t),B(e,o),B(e,l),r[8](l)},p:We,d(d){d&&ee(e),r[8](null)}}}function Py(r){let e,t,o,l,u=`2px solid ${er.Secondary}`;return{c(){e=ie("details"),t=ie("summary"),t.textContent="Secondary Route Reference Layers",o=Se(),l=ie("div"),e.open=!0,ui(e,"border",u)},m(d,a){te(d,e,a),B(e,t),B(e,o),B(e,l),r[9](l)},p:We,d(d){d&&ee(e),r[9](null)}}}function zy(r){let e,t,o,l,u=`2px solid ${er.LocalAccess}`;return{c(){e=ie("details"),t=ie("summary"),t.textContent="Local Access Route Reference Layers",o=Se(),l=ie("div"),e.open=!0,ui(e,"border",u)},m(d,a){te(d,e,a),B(e,t),B(e,o),B(e,l),r[10](l)},p:We,d(d){d&&ee(e),r[10](null)}}}function Dy(r){let e,t,o,l,u=`2px solid ${er.LongDistance}`;return{c(){e=ie("details"),t=ie("summary"),t.textContent="Long Disance Route Reference Layers",o=Se(),l=ie("div"),e.open=!0,ui(e,"border",u)},m(d,a){te(d,e,a),B(e,t),B(e,o),B(e,l),r[11](l)},p:We,d(d){d&&ee(e),r[11](null)}}}function Rk(r){let e,t,o,l,u,d,a,g,v,k=r[5]=="Primary"&&Ay(r),S=r[5]=="Secondary"&&Py(r),E=r[5]=="LocalAccess"&&zy(r),P=r[5]=="LongDistance"&&Dy(r);return{c(){e=ie("details"),t=ie("summary"),t.textContent="Basic Reference Layers",o=Se(),l=ie("div"),u=Se(),k&&k.c(),d=Se(),S&&S.c(),a=Se(),E&&E.c(),g=Se(),P&&P.c(),v=tn(),e.open=!0,ui(e,"border","2px solid black")},m(z,V){te(z,e,V),B(e,t),B(e,o),B(e,l),r[7](l),te(z,u,V),k&&k.m(z,V),te(z,d,V),S&&S.m(z,V),te(z,a,V),E&&E.m(z,V),te(z,g,V),P&&P.m(z,V),te(z,v,V)},p(z,[V]){z[5]=="Primary"?k?k.p(z,V):(k=Ay(z),k.c(),k.m(d.parentNode,d)):k&&(k.d(1),k=null),z[5]=="Secondary"?S?S.p(z,V):(S=Py(z),S.c(),S.m(a.parentNode,a)):S&&(S.d(1),S=null),z[5]=="LocalAccess"?E?E.p(z,V):(E=zy(z),E.c(),E.m(g.parentNode,g)):E&&(E.d(1),E=null),z[5]=="LongDistance"?P?P.p(z,V):(P=Dy(z),P.c(),P.m(v.parentNode,v)):P&&(P.d(1),P=null)},i:We,o:We,d(z){z&&(ee(e),ee(u),ee(d),ee(a),ee(g),ee(v)),r[7](null),k&&k.d(z),S&&S.d(z),E&&E.d(z),P&&P.d(z)}}}function Uu(r,e,t){if(r){r.innerHTML="";for(let o of t){let l=e.get(o);l&&r.appendChild(l)}}}function Fk(r,e,t){let o,l;yt(r,B1,V=>t(6,o=V)),yt(r,ys,V=>t(5,l=V));let u=null,d=null,a=null,g=null,v=null;function k(V){oi[V?"unshift":"push"](()=>{u=V,t(0,u)})}function S(V){oi[V?"unshift":"push"](()=>{d=V,t(1,d)})}function E(V){oi[V?"unshift":"push"](()=>{a=V,t(2,a)})}function P(V){oi[V?"unshift":"push"](()=>{g=V,t(3,g)})}function z(V){oi[V?"unshift":"push"](()=>{v=V,t(4,v)})}return r.$$.update=()=>{r.$$.dirty&65&&Uu(u,o,["Route network","SIMD","Population","Core network","Existing network","Level of Service","Estimated traffic volume","Gradient","Reachable network"]),r.$$.dirty&66&&Uu(d,o,["High NPT route coverage"]),r.$$.dirty&68&&Uu(a,o,["Town centres"]),r.$$.dirty&72&&Uu(g,o,["Schools","GPs and hospitals"]),r.$$.dirty&80&&Uu(v,o,["Urban areas"])},[u,d,a,g,v,l,o,k,S,E,P,z]}class Bk extends Wt{constructor(e){super(),Gt(this,e,Fk,Rk,Vt,{})}}function Ok(r){let e,t,o,l,u,d=Math.round(r[2]*100)+"",a,g,v,k,S,E,P;return{c(){e=ie("p"),t=ie("a"),o=we(r[1]),l=we(`
  :
  `),u=ie("b"),a=we(d),g=we("%"),v=Se(),k=ie("progress"),Fe(t,"href","#"),k.value=S=r[2]*100,Fe(k,"max","100")},m(z,V){te(z,e,V),B(e,t),B(t,o),B(e,l),B(e,u),B(u,a),B(u,g),B(e,v),B(e,k),E||(P=wt(t,"click",lh(r[3])),E=!0)},p(z,[V]){V&2&&dt(o,z[1]),V&4&&d!==(d=Math.round(z[2]*100)+"")&&dt(a,d),V&4&&S!==(S=z[2]*100)&&(k.value=S)},i:We,o:We,d(z){z&&ee(e),E=!1,P()}}}function Nk(r,e,t){let{label:o}=e,{showLayer:l}=e,{pct:u}=e;const d=()=>t(0,l=!0);return r.$$set=a=>{"label"in a&&t(1,o=a.label),"showLayer"in a&&t(0,l=a.showLayer),"pct"in a&&t(2,u=a.pct)},[l,o,u,d]}class bs extends Wt{constructor(e){super(),Gt(this,e,Nk,Ok,Vt,{label:1,showLayer:0,pct:2})}}function Ry(r,e,t){const o=r.slice();return o[22]=e[t][0],o[23]=e[t][1],o}function Fy(r,e,t){const o=r.slice();return o[22]=e[t][0],o[23]=e[t][1],o}function By(r){let e,t,o,l=`2px solid ${er.Primary}`,u,d,a,g,v,k,S,E,P=r[0].average_weighted_directness.toFixed(1)+"",z,V,$,H,G,X,le,xe,Ie,Y,K,ue,fe,ce,ae;function Ge(et){r[11](et)}let Le={label:"High cycling flow coverage",pct:_c(r[0].covered_flow_quintile_sums[0],r[0].total_flow_quintile_sums[0])};r[1]!==void 0&&(Le.showLayer=r[1]),t=new bs({props:Le}),oi.push(()=>Vi(t,"showLayer",Ge));let Pe=(r[2]=="Secondary"||r[2]=="LocalAccess"||r[2]=="LongDistance")&&Oy(r),rt=(r[2]=="LocalAccess"||r[2]=="LongDistance")&&Ny(r),it=r[2]=="LongDistance"&&jy(r),Qe=yi(Object.entries(r[0].od_percents_infra_type).toSorted(Vy)),Ft=[];for(let et=0;et<Qe.length;et+=1)Ft[et]=Uy(Fy(r,Qe,et));let jt=yi(Object.entries(r[0].od_percents_los).toSorted(qy)),ut=[];for(let et=0;et<jt.length;et+=1)ut[et]=$y(Ry(r,jt,et));return{c(){e=ie("div"),Ue(t.$$.fragment),u=Se(),Pe&&Pe.c(),d=Se(),rt&&rt.c(),a=Se(),it&&it.c(),g=Se(),v=ie("div"),k=ie("p"),S=ie("a"),S.textContent="Average weighted directness",E=we(`
      : `),z=we(P),V=we("x"),$=Se(),H=ie("details"),G=ie("summary"),G.textContent="Percent of demand by infrastructure type",X=Se(),le=ie("ul");for(let et=0;et<Ft.length;et+=1)Ft[et].c();xe=Se(),Ie=ie("details"),Y=ie("summary"),Y.textContent="Percent of demand by level of service:",K=Se(),ue=ie("ul");for(let et=0;et<ut.length;et+=1)ut[et].c();ui(e,"border",l),Fe(S,"href","#"),ui(v,"margin-top","4px"),ui(v,"border","2px solid black")},m(et,at){te(et,e,at),Ne(t,e,null),te(et,u,at),Pe&&Pe.m(et,at),te(et,d,at),rt&&rt.m(et,at),te(et,a,at),it&&it.m(et,at),te(et,g,at),te(et,v,at),B(v,k),B(k,S),B(k,E),B(k,z),B(k,V),B(v,$),B(v,H),B(H,G),B(H,X),B(H,le);for(let Bt=0;Bt<Ft.length;Bt+=1)Ft[Bt]&&Ft[Bt].m(le,null);B(v,xe),B(v,Ie),B(Ie,Y),B(Ie,K),B(Ie,ue);for(let Bt=0;Bt<ut.length;Bt+=1)ut[Bt]&&ut[Bt].m(ue,null);fe=!0,ce||(ae=wt(S,"click",lh(r[20])),ce=!0)},p(et,at){const Bt={};if(at&1&&(Bt.pct=_c(et[0].covered_flow_quintile_sums[0],et[0].total_flow_quintile_sums[0])),!o&&at&2&&(o=!0,Bt.showLayer=et[1],$i(()=>o=!1)),t.$set(Bt),et[2]=="Secondary"||et[2]=="LocalAccess"||et[2]=="LongDistance"?Pe?(Pe.p(et,at),at&4&&se(Pe,1)):(Pe=Oy(et),Pe.c(),se(Pe,1),Pe.m(d.parentNode,d)):Pe&&(Li(),de(Pe,1,1,()=>{Pe=null}),Mi()),et[2]=="LocalAccess"||et[2]=="LongDistance"?rt?(rt.p(et,at),at&4&&se(rt,1)):(rt=Ny(et),rt.c(),se(rt,1),rt.m(a.parentNode,a)):rt&&(Li(),de(rt,1,1,()=>{rt=null}),Mi()),et[2]=="LongDistance"?it?(it.p(et,at),at&4&&se(it,1)):(it=jy(et),it.c(),se(it,1),it.m(g.parentNode,g)):it&&(Li(),de(it,1,1,()=>{it=null}),Mi()),(!fe||at&1)&&P!==(P=et[0].average_weighted_directness.toFixed(1)+"")&&dt(z,P),at&1){Qe=yi(Object.entries(et[0].od_percents_infra_type).toSorted(Vy));let Dt;for(Dt=0;Dt<Qe.length;Dt+=1){const Ht=Fy(et,Qe,Dt);Ft[Dt]?Ft[Dt].p(Ht,at):(Ft[Dt]=Uy(Ht),Ft[Dt].c(),Ft[Dt].m(le,null))}for(;Dt<Ft.length;Dt+=1)Ft[Dt].d(1);Ft.length=Qe.length}if(at&1){jt=yi(Object.entries(et[0].od_percents_los).toSorted(qy));let Dt;for(Dt=0;Dt<jt.length;Dt+=1){const Ht=Ry(et,jt,Dt);ut[Dt]?ut[Dt].p(Ht,at):(ut[Dt]=$y(Ht),ut[Dt].c(),ut[Dt].m(ue,null))}for(;Dt<ut.length;Dt+=1)ut[Dt].d(1);ut.length=jt.length}},i(et){fe||(se(t.$$.fragment,et),se(Pe),se(rt),se(it),fe=!0)},o(et){de(t.$$.fragment,et),de(Pe),de(rt),de(it),fe=!1},d(et){et&&(ee(e),ee(u),ee(d),ee(a),ee(g),ee(v)),je(t),Pe&&Pe.d(et),rt&&rt.d(et),it&&it.d(et),$n(Ft,et),$n(ut,et),ce=!1,ae()}}}function Oy(r){let e,t,o,l,u,d,a=`2px solid ${er.Secondary}`,g;function v(P){r[12](P)}let k={label:"Medium cycling flow coverage",pct:_c(r[0].covered_flow_quintile_sums[1],r[0].total_flow_quintile_sums[1])};r[1]!==void 0&&(k.showLayer=r[1]),t=new bs({props:k}),oi.push(()=>Vi(t,"showLayer",v));function S(P){r[13](P)}let E={label:"Town centres",pct:r[0].percent_reachable_town_centres};return r[3]!==void 0&&(E.showLayer=r[3]),u=new bs({props:E}),oi.push(()=>Vi(u,"showLayer",S)),{c(){e=ie("div"),Ue(t.$$.fragment),l=Se(),Ue(u.$$.fragment),ui(e,"margin-top","4px"),ui(e,"border",a)},m(P,z){te(P,e,z),Ne(t,e,null),B(e,l),Ne(u,e,null),g=!0},p(P,z){const V={};z&1&&(V.pct=_c(P[0].covered_flow_quintile_sums[1],P[0].total_flow_quintile_sums[1])),!o&&z&2&&(o=!0,V.showLayer=P[1],$i(()=>o=!1)),t.$set(V);const $={};z&1&&($.pct=P[0].percent_reachable_town_centres),!d&&z&8&&(d=!0,$.showLayer=P[3],$i(()=>d=!1)),u.$set($)},i(P){g||(se(t.$$.fragment,P),se(u.$$.fragment,P),g=!0)},o(P){de(t.$$.fragment,P),de(u.$$.fragment,P),g=!1},d(P){P&&ee(e),je(t),je(u)}}}function Ny(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$=`2px solid ${er.LocalAccess}`,H;function G(ae){r[14](ae)}let X={label:"Low cycling flow coverage",pct:_c(r[0].covered_flow_quintile_sums[2],r[0].total_flow_quintile_sums[2])};r[1]!==void 0&&(X.showLayer=r[1]),t=new bs({props:X}),oi.push(()=>Vi(t,"showLayer",G));function le(ae){r[15](ae)}let xe={label:"Schools",pct:r[0].percent_reachable_schools};r[4]!==void 0&&(xe.showLayer=r[4]),u=new bs({props:xe}),oi.push(()=>Vi(u,"showLayer",le));function Ie(ae){r[16](ae)}let Y={label:"GPs and hospitals",pct:r[0].percent_reachable_gp_hospitals};r[5]!==void 0&&(Y.showLayer=r[5]),g=new bs({props:Y}),oi.push(()=>Vi(g,"showLayer",Ie));function K(ae){r[17](ae)}let ue={label:"Deprived population coverage",pct:r[0].percent_reachable_imd_population};r[6]!==void 0&&(ue.showLayer=r[6]),S=new bs({props:ue}),oi.push(()=>Vi(S,"showLayer",K));function fe(ae){r[18](ae)}let ce={label:"Population coverage",pct:r[0].percent_reachable_population};return r[7]!==void 0&&(ce.showLayer=r[7]),z=new bs({props:ce}),oi.push(()=>Vi(z,"showLayer",fe)),{c(){e=ie("div"),Ue(t.$$.fragment),l=Se(),Ue(u.$$.fragment),a=Se(),Ue(g.$$.fragment),k=Se(),Ue(S.$$.fragment),P=Se(),Ue(z.$$.fragment),ui(e,"margin-top","4px"),ui(e,"border",$)},m(ae,Ge){te(ae,e,Ge),Ne(t,e,null),B(e,l),Ne(u,e,null),B(e,a),Ne(g,e,null),B(e,k),Ne(S,e,null),B(e,P),Ne(z,e,null),H=!0},p(ae,Ge){const Le={};Ge&1&&(Le.pct=_c(ae[0].covered_flow_quintile_sums[2],ae[0].total_flow_quintile_sums[2])),!o&&Ge&2&&(o=!0,Le.showLayer=ae[1],$i(()=>o=!1)),t.$set(Le);const Pe={};Ge&1&&(Pe.pct=ae[0].percent_reachable_schools),!d&&Ge&16&&(d=!0,Pe.showLayer=ae[4],$i(()=>d=!1)),u.$set(Pe);const rt={};Ge&1&&(rt.pct=ae[0].percent_reachable_gp_hospitals),!v&&Ge&32&&(v=!0,rt.showLayer=ae[5],$i(()=>v=!1)),g.$set(rt);const it={};Ge&1&&(it.pct=ae[0].percent_reachable_imd_population),!E&&Ge&64&&(E=!0,it.showLayer=ae[6],$i(()=>E=!1)),S.$set(it);const Qe={};Ge&1&&(Qe.pct=ae[0].percent_reachable_population),!V&&Ge&128&&(V=!0,Qe.showLayer=ae[7],$i(()=>V=!1)),z.$set(Qe)},i(ae){H||(se(t.$$.fragment,ae),se(u.$$.fragment,ae),se(g.$$.fragment,ae),se(S.$$.fragment,ae),se(z.$$.fragment,ae),H=!0)},o(ae){de(t.$$.fragment,ae),de(u.$$.fragment,ae),de(g.$$.fragment,ae),de(S.$$.fragment,ae),de(z.$$.fragment,ae),H=!1},d(ae){ae&&ee(e),je(t),je(u),je(g),je(S),je(z)}}}function jy(r){let e,t,o,l=`2px solid ${er.LongDistance}`,u;function d(g){r[19](g)}let a={label:"Reachable settlements (TODO)",pct:0};return r[8]!==void 0&&(a.showLayer=r[8]),t=new bs({props:a}),oi.push(()=>Vi(t,"showLayer",d)),{c(){e=ie("div"),Ue(t.$$.fragment),ui(e,"margin-top","4px"),ui(e,"border",l)},m(g,v){te(g,e,v),Ne(t,e,null),u=!0},p(g,v){const k={};!o&&v&256&&(o=!0,k.showLayer=g[8],$i(()=>o=!1)),t.$set(k)},i(g){u||(se(t.$$.fragment,g),u=!0)},o(g){de(t.$$.fragment,g),u=!1},d(g){g&&ee(e),je(t)}}}function Uy(r){let e,t=r[22]+"",o,l,u=Math.round(r[23]*100)+"",d,a;return{c(){e=ie("li"),o=we(t),l=we(": "),d=we(u),a=we("%")},m(g,v){te(g,e,v),B(e,o),B(e,l),B(e,d),B(e,a)},p(g,v){v&1&&t!==(t=g[22]+"")&&dt(o,t),v&1&&u!==(u=Math.round(g[23]*100)+"")&&dt(d,u)},d(g){g&&ee(e)}}}function $y(r){let e,t=r[22]+"",o,l,u=Math.round(r[23]*100)+"",d,a;return{c(){e=ie("li"),o=we(t),l=we(": "),d=we(u),a=we("%")},m(g,v){te(g,e,v),B(e,o),B(e,l),B(e,d),B(e,a)},p(g,v){v&1&&t!==(t=g[22]+"")&&dt(o,t),v&1&&u!==(u=Math.round(g[23]*100)+"")&&dt(d,u)},d(g){g&&ee(e)}}}function jk(r){let e,t,o,l,u,d,a=r[0]&&By(r);return{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),a&&a.c(),o=tn()},m(g,v){te(g,e,v),te(g,t,v),a&&a.m(g,v),te(g,o,v),l=!0,u||(d=wt(e,"click",r[10]),u=!0)},p(g,[v]){g[0]?a?(a.p(g,v),v&1&&se(a,1)):(a=By(g),a.c(),se(a,1),a.m(o.parentNode,o)):a&&(Li(),de(a,1,1,()=>{a=null}),Mi())},i(g){l||(se(a),l=!0)},o(g){de(a),l=!1},d(g){g&&(ee(e),ee(t),ee(o)),a&&a.d(g),u=!1,d()}}}function _c(r,e){return e==0?0:r/e}const Vy=(r,e)=>e[1]-r[1],qy=(r,e)=>e[1]-r[1];function Uk(r,e,t){let o,l,u,d,a,g,v,k,S,E,P;yt(r,Iy,ue=>t(0,o=ue)),yt(r,An,ue=>t(21,l=ue)),yt(r,cc,ue=>t(1,u=ue)),yt(r,ys,ue=>t(2,d=ue)),yt(r,Fd,ue=>t(3,a=ue)),yt(r,Dd,ue=>t(4,g=ue)),yt(r,Rd,ue=>t(5,v=ue)),yt(r,Bd,ue=>t(6,k=ue)),yt(r,Od,ue=>t(7,S=ue)),yt(r,Ly,ue=>t(8,E=ue)),yt(r,hn,ue=>t(9,P=ue));async function z(){si(Iy,o=await l.recalculateStats(),o)}yc(async()=>{o==null&&await z()});function V(ue){u=ue,cc.set(u)}function $(ue){u=ue,cc.set(u)}function H(ue){a=ue,Fd.set(a)}function G(ue){u=ue,cc.set(u)}function X(ue){g=ue,Dd.set(g)}function le(ue){v=ue,Rd.set(v)}function xe(ue){k=ue,Bd.set(k)}function Ie(ue){S=ue,Od.set(S)}function Y(ue){E=ue,Ly.set(E)}return[o,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie,Y,()=>si(hn,P={kind:"evaluate-route",prevMode:{kind:"main"},browse:zo(o).worst_directness_routes},P)]}class $k extends Wt{constructor(e){super(),Gt(this,e,Uk,jk,Vt,{})}}function Zy(r,e,t){const o=r.slice();return o[4]=e[t],o}function Gy(r){let e,t=r[4]+"",o;return{c(){e=ie("option"),o=we(t),e.__value=r[4],Gi(e,e.__value)},m(l,u){te(l,e,u),B(e,o)},p:We,d(l){l&&ee(e)}}}function Vk(r){let e,t,o,l,u,d=yi(r[1]),a=[];for(let g=0;g<d.length;g+=1)a[g]=Gy(Zy(r,d,g));return{c(){e=ie("label"),t=we(`Area:
  `),o=ie("select");for(let g=0;g<a.length;g+=1)a[g].c();r[0]===void 0&&Mo(()=>r[3].call(o))},m(g,v){te(g,e,v),B(e,t),B(e,o);for(let k=0;k<a.length;k+=1)a[k]&&a[k].m(o,null);hr(o,r[0],!0),l||(u=[wt(o,"change",r[3]),wt(o,"change",r[2])],l=!0)},p(g,[v]){if(v&2){d=yi(g[1]);let k;for(k=0;k<d.length;k+=1){const S=Zy(g,d,k);a[k]?a[k].p(S,v):(a[k]=Gy(S),a[k].c(),a[k].m(o,null))}for(;k<a.length;k+=1)a[k].d(1);a.length=d.length}v&3&&hr(o,g[0])},i:We,o:We,d(g){g&&ee(e),$n(a,g),l=!1,cn(u)}}}function qk(r,e,t){let{area:o}=e,l=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];l.sort();function u(){window.location.href=`index.html?boundary=${o}`}function d(){o=ws(this),t(0,o),t(1,l)}return r.$$set=a=>{"area"in a&&t(0,o=a.area)},[o,l,u,d]}class Zk extends Wt{constructor(e){super(),Gt(this,e,qk,Vk,Vt,{area:0})}}const{window:Gk}=q0;function Wy(r,e,t){const o=r.slice();return o[22]=e[t],o}function Hy(r){let e,t,o=yi(r[0].features),l=[];for(let d=0;d<o.length;d+=1)l[d]=Xy(Wy(r,o,d));const u=d=>de(l[d],1,1,()=>{l[d]=null});return{c(){e=ie("ol");for(let d=0;d<l.length;d+=1)l[d].c()},m(d,a){te(d,e,a);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(e,null);t=!0},p(d,a){if(a&257){o=yi(d[0].features);let g;for(g=0;g<o.length;g+=1){const v=Wy(d,o,g);l[g]?(l[g].p(v,a),se(l[g],1)):(l[g]=Xy(v),l[g].c(),se(l[g],1),l[g].m(e,null))}for(Li(),g=o.length;g<l.length;g+=1)u(g);Mi()}},i(d){if(!t){for(let a=0;a<o.length;a+=1)se(l[a]);t=!0}},o(d){l=l.filter(Boolean);for(let a=0;a<l.length;a+=1)de(l[a]);t=!1},d(d){d&&ee(e),$n(l,d)}}}function Wk(r){var a,g;let e=(((a=r[22].properties)==null?void 0:a.name)||`Untitled route ${r[22].id}`)+"",t,o,l=((g=r[22].properties)==null?void 0:g.infra_type)+"",u,d;return{c(){t=we(e),o=we(" ("),u=we(l),d=we(")")},m(v,k){te(v,t,k),te(v,o,k),te(v,u,k),te(v,d,k)},p(v,k){var S,E;k&1&&e!==(e=(((S=v[22].properties)==null?void 0:S.name)||`Untitled route ${v[22].id}`)+"")&&dt(t,e),k&1&&l!==(l=((E=v[22].properties)==null?void 0:E.infra_type)+"")&&dt(u,l)},d(v){v&&(ee(t),ee(o),ee(u),ee(d))}}}function Xy(r){let e,t,o,l;function u(){return r[18](r[22])}return t=new Dk({props:{$$slots:{default:[Wk]},$$scope:{ctx:r}}}),t.$on("click",u),{c(){e=ie("li"),Ue(t.$$.fragment),o=Se()},m(d,a){te(d,e,a),Ne(t,e,null),B(e,o),l=!0},p(d,a){r=d;const g={};a&33554433&&(g.$$scope={dirty:a,ctx:r}),t.$set(g)},i(d){l||(se(t.$$.fragment,d),l=!0)},o(d){de(t.$$.fragment,d),l=!1},d(d){d&&ee(e),je(t)}}}function Hk(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie,Y,K,ue,fe,ce,ae;t=new Zk({props:{area:r[5]}});let Ge=r[0]&&Hy(r);return ue=new Bk({}),{c(){e=ie("div"),Ue(t.$$.fragment),o=Se(),l=ie("div"),u=ie("button"),u.innerHTML=`Draw new <u>r</u>
        oute line`,d=Se(),a=ie("button"),a.textContent="Clear all",g=Se(),v=ie("label"),k=ie("input"),S=we(`
      Show current network`),E=Se(),P=ie("details"),z=ie("summary"),z.textContent="Current network routes",V=Se(),$=ie("label"),H=we(`Show routes by:
        `),G=ie("select"),X=ie("option"),X.textContent="Infrastructure type",le=ie("option"),le.textContent="Tier",xe=Se(),Ge&&Ge.c(),Ie=Se(),Y=ie("hr"),K=Se(),Ue(ue.$$.fragment),Fe(a,"class","secondary"),Fe(k,"type","checkbox"),X.__value="infra_type",Gi(X,X.__value),le.__value="tier",Gi(le,le.__value),r[3]===void 0&&Mo(()=>r[17].call(G)),Fe(e,"slot","left")},m(Le,Pe){te(Le,e,Pe),Ne(t,e,null),B(e,o),B(e,l),B(l,u),B(l,d),B(l,a),B(e,g),B(e,v),B(v,k),k.checked=r[4],B(v,S),B(e,E),B(e,P),B(P,z),B(P,V),B(P,$),B($,H),B($,G),B(G,X),B(G,le),hr(G,r[3],!0),B(P,xe),Ge&&Ge.m(P,null),B(e,Ie),B(e,Y),B(e,K),Ne(ue,e,null),fe=!0,ce||(ae=[wt(u,"click",r[15]),wt(a,"click",r[9]),wt(k,"change",r[16]),wt(G,"change",r[17])],ce=!0)},p(Le,Pe){const rt={};Pe&32&&(rt.area=Le[5]),t.$set(rt),Pe&16&&(k.checked=Le[4]),Pe&8&&hr(G,Le[3]),Le[0]?Ge?(Ge.p(Le,Pe),Pe&1&&se(Ge,1)):(Ge=Hy(Le),Ge.c(),se(Ge,1),Ge.m(P,null)):Ge&&(Li(),de(Ge,1,1,()=>{Ge=null}),Mi())},i(Le){fe||(se(t.$$.fragment,Le),se(Ge),se(ue.$$.fragment,Le),fe=!0)},o(Le){de(t.$$.fragment,Le),de(Ge),de(ue.$$.fragment,Le),fe=!1},d(Le){Le&&ee(e),je(t),Ge&&Ge.d(),je(ue),ce=!1,cn(ae)}}}function Ky(r){let e,t;return e=new Tn({props:{data:r[0],$$slots:{default:[Jk]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&1&&(u.data=o[0]),l&33554460&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function Xk(r){let e=(r[21].name||"Untitled")+"",t,o,l=mc[r[21].infra_type][0]+"",u,d,a=r[21].tier+"",g,v;return{c(){t=we(e),o=we(" ("),u=we(l),d=we(`,
            `),g=we(a),v=we(")")},m(k,S){te(k,t,S),te(k,o,S),te(k,u,S),te(k,d,S),te(k,g,S),te(k,v,S)},p(k,S){S&2097152&&e!==(e=(k[21].name||"Untitled")+"")&&dt(t,e),S&2097152&&l!==(l=mc[k[21].infra_type][0]+"")&&dt(u,l),S&2097152&&a!==(a=k[21].tier+"")&&dt(g,a)},d(k){k&&(ee(t),ee(o),ee(u),ee(d),ee(g),ee(v))}}}function Kk(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[Xk,({props:o})=>({21:o}),({props:o})=>o?2097152:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&35651584&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function Jk(r){let e,t;const o=[Ri("main-mode"),{paint:{"line-width":["case",["==",["get","tier"],r[2]],Vn(5,7),Vn(3,5)],"line-color":r[3]=="infra_type"?ya:Bp}},{layout:{visibility:r[4]?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[Kk]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),e.$on("click",r[7]),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&28?pn(o,[o[0],d&12&&{paint:{"line-width":["case",["==",["get","tier"],u[2]],Vn(5,7),Vn(3,5)],"line-color":u[3]=="infra_type"?ya:Bp}},d&16&&{layout:{visibility:u[4]?"visible":"none"}},o[3],o[4]]):{};d&33554432&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function Yk(r){let e,t,o=r[0]&&Ky(r);return{c(){e=ie("div"),o&&o.c(),Fe(e,"slot","map")},m(l,u){te(l,e,u),o&&o.m(e,null),t=!0},p(l,u){l[0]?o?(o.p(l,u),u&1&&se(o,1)):(o=Ky(l),o.c(),se(o,1),o.m(e,null)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d()}}}function Qk(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H;return t=new $k({}),{c(){e=ie("div"),Ue(t.$$.fragment),o=Se(),l=ie("div"),u=ie("button"),u.textContent="Evaluate a route",d=Se(),a=ie("div"),g=ie("button"),g.textContent="Evaluate OD",v=Se(),k=ie("div"),S=ie("button"),S.textContent="Debug network",E=Se(),P=ie("div"),z=ie("button"),z.textContent="Debug mesh density",Fe(u,"class","secondary"),Fe(g,"class","secondary"),Fe(S,"class","secondary"),Fe(z,"class","secondary"),Fe(e,"slot","right")},m(G,X){te(G,e,X),Ne(t,e,null),B(e,o),B(e,l),B(l,u),B(e,d),B(e,a),B(a,g),B(e,v),B(e,k),B(k,S),B(e,E),B(e,P),B(P,z),V=!0,$||(H=[wt(u,"click",r[11]),wt(g,"click",r[12]),wt(S,"click",r[13]),wt(z,"click",r[14])],$=!0)},p:We,i(G){V||(se(t.$$.fragment,G),V=!0)},o(G){de(t.$$.fragment,G),V=!1},d(G){G&&ee(e),je(t),$=!1,cn(H)}}}function eS(r){let e,t,o,l;return e=new Sc({props:{$$slots:{right:[Qk],map:[Yk],left:[Hk]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0,o||(l=wt(Gk,"keydown",r[6]),o=!0)},p(u,[d]){const a={};d&33554495&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u),o=!1,l()}}}function tS(r,e,t){let o,l,u,d,a,g,v;yt(r,An,K=>t(19,o=K)),yt(r,hn,K=>t(1,l=K)),yt(r,sh,K=>t(10,u=K)),yt(r,ys,K=>t(2,d=K)),yt(r,zp,K=>t(3,a=K)),yt(r,Rp,K=>t(4,g=K)),yt(r,zd,K=>t(5,v=K));let k=null;yc(S);async function S(){t(0,k=await o.renderRoutes())}function E(K){K.key=="r"&&(K.preventDefault(),si(hn,l={kind:"edit-route",id:null},l))}function P(K){si(hn,l={kind:"edit-route",id:K.detail.features[0].id},l)}function z(K){si(hn,l={kind:"edit-route",id:K},l)}async function V(){window.confirm("Clear everything? You can't undo this")&&(await(o==null?void 0:o.clearAllRoutes()),await ah(),await S())}const $=()=>si(hn,l={kind:"evaluate-route",prevMode:{kind:"main"},browse:[]},l),H=()=>si(hn,l={kind:"evaluate-od"},l),G=()=>si(hn,l={kind:"debug-network"},l),X=()=>si(hn,l={kind:"debug-mesh-density"},l),le=()=>si(hn,l={kind:"edit-route",id:null},l);function xe(){g=this.checked,Rp.set(g)}function Ie(){a=ws(this),zp.set(a)}const Y=K=>z(K.id);return r.$$.update=()=>{r.$$.dirty&1024&&u>0&&S()},[k,l,d,a,g,v,E,P,z,V,u,$,H,G,X,le,xe,Ie,Y]}class iS extends Wt{constructor(e){super(),Gt(this,e,tS,eS,Vt,{})}}function Jy(r,e,t){const o=r.slice();return o[2]=e[t][0],o[3]=e[t][1],o}function nS(r,e,t){const o=r.slice();return o[1]=e[t][0],o[2]=e[t][1],o[3]=e[t][2],o}function rS(r){let e,t=yi(Object.entries(er)),o=[];for(let l=0;l<t.length;l+=1)o[l]=Yy(Jy(r,t,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=tn()},m(l,u){for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(l,u);te(l,e,u)},p(l,u){if(u&0){t=yi(Object.entries(er));let d;for(d=0;d<t.length;d+=1){const a=Jy(l,t,d);o[d]?o[d].p(a,u):(o[d]=Yy(a),o[d].c(),o[d].m(e.parentNode,e))}for(;d<o.length;d+=1)o[d].d(1);o.length=t.length}},d(l){l&&ee(e),$n(o,l)}}}function oS(r){let e,t=yi(em),o=[];for(let l=0;l<t.length;l+=1)o[l]=sS(nS(r,t,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=tn()},m(l,u){for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(l,u);te(l,e,u)},p:We,d(l){l&&ee(e),$n(o,l)}}}function Yy(r){let e,t,o;return{c(){e=ie("span"),e.textContent=`${r[2]}`,t=Se(),o=ie("br"),ui(e,"color",r[3])},m(l,u){te(l,e,u),te(l,t,u),te(l,o,u)},p:We,d(l){l&&(ee(e),ee(t),ee(o))}}}function sS(r){let e,t,o;return{c(){e=ie("span"),e.textContent=`${r[2]}`,t=Se(),o=ie("br"),ui(e,"color",r[3])},m(l,u){te(l,e,u),te(l,t,u),te(l,o,u)},p:We,d(l){l&&(ee(e),ee(t),ee(o))}}}function aS(r){let e,t,o,l;function u(g,v){return g[0]=="infra_type"?oS:rS}let d=u(r),a=d(r);return{c(){e=ie("div"),t=ie("details"),o=ie("summary"),o.textContent="Legend",l=Se(),a.c(),Fe(e,"class","svelte-1oq1sox")},m(g,v){te(g,e,v),B(e,t),B(t,o),B(t,l),a.m(t,null)},p(g,[v]){d===(d=u(g))&&a?a.p(g,v):(a.d(1),a=d(g),a&&(a.c(),a.m(t,null)))},i:We,o:We,d(g){g&&ee(e),a.d()}}}function lS(r,e,t){let o;return yt(r,zp,l=>t(0,o=l)),[o]}class cS extends Wt{constructor(e){super(),Gt(this,e,lS,aS,Vt,{})}}let qt;const N1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&N1.decode();let qu=null;function Ku(){return(qu===null||qu.byteLength===0)&&(qu=new Uint8Array(qt.memory.buffer)),qu}function Eo(r,e){return r=r>>>0,N1.decode(Ku().subarray(r,r+e))}const vs=new Array(128).fill(void 0);vs.push(void 0,null,!0,!1);let Ju=vs.length;function Bn(r){Ju===vs.length&&vs.push(vs.length+1);const e=Ju;return Ju=vs[e],vs[e]=r,e}function Ii(r){return vs[r]}function uS(r){r<132||(vs[r]=Ju,Ju=r)}function ac(r){const e=Ii(r);return uS(r),e}function fp(r){return r==null}let Zu=null;function hS(){return(Zu===null||Zu.byteLength===0)&&(Zu=new Float64Array(qt.memory.buffer)),Zu}let Gu=null;function zi(){return(Gu===null||Gu.byteLength===0)&&(Gu=new Int32Array(qt.memory.buffer)),Gu}let fa=0;const Id=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},dS=typeof Id.encodeInto=="function"?function(r,e){return Id.encodeInto(r,e)}:function(r,e){const t=Id.encode(r);return e.set(t),{read:r.length,written:t.length}};function _d(r,e,t){if(t===void 0){const a=Id.encode(r),g=e(a.length,1)>>>0;return Ku().subarray(g,g+a.length).set(a),fa=a.length,g}let o=r.length,l=e(o,1)>>>0;const u=Ku();let d=0;for(;d<o;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==o){d!==0&&(r=r.slice(d)),l=t(l,o,o=d+r.length*3,1)>>>0;const a=Ku().subarray(l+d,l+o),g=dS(r,a);d+=g.written}return fa=d,l}function Np(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=Np(r[0]));for(let d=1;d<l;d++)u+=", "+Np(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let o;if(t.length>1)o=t[1];else return toString.call(r);if(o=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:o}function fS(r,e){const t=e(r.length*1,1)>>>0;return Ku().set(r,t/1),fa=r.length,t}function pp(r,e){try{return r.apply(this,e)}catch(t){qt.__wbindgen_exn_store(Bn(t))}}class Nd{static __wrap(e){e=e>>>0;const t=Object.create(Nd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();qt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=qt.__wbindgen_add_to_stack_pointer(-16),d=fS(e,qt.__wbindgen_malloc),a=fa;qt.jsroutesnapper_new(u,d,a);var t=zi()[u/4+0],o=zi()[u/4+1],l=zi()[u/4+2];if(l)throw ac(o);return Nd.__wrap(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){qt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Bn(e))}setAreaMode(){qt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var o=zi()[u/4+0],l=zi()[u/4+1];return e=o,t=l,Eo(o,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const o=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_toFinalFeature(o,this.__wbg_ptr);var e=zi()[o/4+0],t=zi()[o/4+1];let l;return e!==0&&(l=Eo(e,t).slice(),qt.__wbindgen_free(e,t*1)),l}finally{qt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var o=zi()[u/4+0],l=zi()[u/4+1];return e=o,t=l,Eo(o,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toggleSnapMode(){qt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,o){return qt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,o)!==0}onClick(){qt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return qt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return qt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){qt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_editExisting(l,this.__wbg_ptr,Bn(e));var t=zi()[l/4+0],o=zi()[l/4+1];if(o)throw ac(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var o=zi()[u/4+0],l=zi()[u/4+1];return e=o,t=l,Eo(o,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var o=zi()[u/4+0],l=zi()[u/4+1];return e=o,t=l,Eo(o,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,o;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Bn(e));var l=zi()[k/4+0],u=zi()[k/4+1],d=zi()[k/4+2],a=zi()[k/4+3],g=l,v=u;if(a)throw g=0,v=0,ac(d);return t=g,o=v,Eo(g,v)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,o,1)}}addSnappedWaypoint(e,t){qt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){qt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,o;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Bn(e));var l=zi()[k/4+0],u=zi()[k/4+1],d=zi()[k/4+2],a=zi()[k/4+3],g=l,v=u;if(a)throw g=0,v=0,ac(d);return t=g,o=v,Eo(g,v)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,o,1)}}getExtraNodes(e,t){let o,l;try{const S=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Bn(e),Bn(t));var u=zi()[S/4+0],d=zi()[S/4+1],a=zi()[S/4+2],g=zi()[S/4+3],v=u,k=d;if(g)throw v=0,k=0,ac(a);return o=v,l=k,Eo(v,k)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(o,l,1)}}}async function pS(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(o){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function mS(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const o=Eo(e,t);return Bn(o)},r.wbg.__wbindgen_object_drop_ref=function(e){ac(e)},r.wbg.__wbindgen_error_new=function(e,t){const o=new Error(Eo(e,t));return Bn(o)},r.wbg.__wbindgen_number_get=function(e,t){const o=Ii(t),l=typeof o=="number"?o:void 0;hS()[e/8+1]=fp(l)?0:l,zi()[e/4+0]=!fp(l)},r.wbg.__wbindgen_is_object=function(e){const t=Ii(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Ii(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Ii(e)in Ii(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Ii(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ii(e)==Ii(t)},r.wbg.__wbindgen_string_get=function(e,t){const o=Ii(t),l=typeof o=="string"?o:void 0;var u=fp(l)?0:_d(l,qt.__wbindgen_malloc,qt.__wbindgen_realloc),d=fa;zi()[e/4+1]=d,zi()[e/4+0]=u},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const o=String(Ii(t)),l=_d(o,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=fa;zi()[e/4+1]=u,zi()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Ii(e);return Bn(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const o=Ii(e)[Ii(t)];return Bn(o)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Bn(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const o=Ii(t).stack,l=_d(o,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=fa;zi()[e/4+1]=u,zi()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let o,l;try{o=e,l=t,console.error(Eo(e,t))}finally{qt.__wbindgen_free(o,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ii(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ii(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ii(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ii(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ii(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const o=Ii(e)[t>>>0];return Bn(o)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ii(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ii(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ii(e).next;return Bn(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return pp(function(e){const t=Ii(e).next();return Bn(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ii(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ii(e).value;return Bn(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Bn(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return pp(function(e,t){const o=Reflect.get(Ii(e),Ii(t));return Bn(o)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return pp(function(e,t){const o=Ii(e).call(Ii(t));return Bn(o)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ii(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ii(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ii(e).buffer;return Bn(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ii(e));return Bn(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,o){Ii(e).set(Ii(t),o>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ii(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ii(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const o=Np(Ii(t)),l=_d(o,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=fa;zi()[e/4+1]=u,zi()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Eo(e,t))},r.wbg.__wbindgen_memory=function(){const e=qt.memory;return Bn(e)},r}function _S(r,e){return qt=r.exports,j1.__wbindgen_wasm_module=e,Zu=null,Gu=null,qu=null,qt}async function j1(r){if(qt!==void 0)return qt;typeof r>"u"&&(r="/npw/assets/route_snapper_bg.wasm");const e=mS();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:o}=await pS(await r,e);return _S(t,o)}const gS=30;class yS{constructor(e,t,o,l,u){this.onMouseMove=d=>{if(!this.active)return;const a=[d.point.x-gS,d.point.y],g=this.map.unproject(d.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,g)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Nd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=o,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}let jd=Ei(null);const Co=Ei([]);const bS=r=>({}),Qy=r=>({}),vS=r=>({}),e0=r=>({});function t0(r,e,t){const o=r.slice();return o[51]=e[t],o[52]=e,o[53]=t,o}function i0(r,e,t){const o=r.slice();return o[54]=e[t],o[55]=e,o[56]=t,o}const wS=r=>({}),n0=r=>({});function xS(r){let e;return{c(){e=ie("h2"),e.textContent="Drawing a new route"},m(t,o){te(t,e,o)},d(t){t&&ee(e)}}}function kS(r){let e;return{c(){e=ie("h2"),e.textContent="Editing a route"},m(t,o){te(t,e,o)},d(t){t&&ee(e)}}}function SS(r){let e,t=r[11].length+"",o,l;return{c(){e=we("Undo ("),o=we(t),l=we(")")},m(u,d){te(u,e,d),te(u,o,d),te(u,l,d)},p(u,d){d[0]&2048&&t!==(t=u[11].length+"")&&dt(o,t)},d(u){u&&(ee(e),ee(o),ee(l))}}}function TS(r){let e;return{c(){e=we("Undo")},m(t,o){te(t,e,o)},p:We,d(t){t&&ee(e)}}}function IS(r){let e,t,o,l,u;return{c(){e=ie("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,t=Se(),o=ie("p"),o.textContent="Keyboard shortcuts:",l=Se(),u=ie("ul"),u.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(d,a){te(d,e,a),te(d,t,a),te(d,o,a),te(d,l,a),te(d,u,a)},p:We,d(d){d&&(ee(e),ee(t),ee(o),ee(l),ee(u))}}}function CS(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie,Y,K,ue,fe,ce,ae,Ge,Le,Pe,rt,it,Qe,Ft,jt,ut,et,at,Bt,Dt,Ht,li,ai,ki,Fi,bi,di,lt,qe,st,Te;function pt(_i,Bi){return _i[3]?kS:xS}let gt=pt(r),Ce=gt(r);function nt(_i,Bi){return _i[11].length==0?TS:SS}let Xt=nt(r),vi=Xt(r);z=new P1({props:{$$slots:{default:[IS]},$$scope:{ctx:r}}});const ji=r[29]["extra-left"],Ci=bn(ji,r,r[46],Qy);return lt=$_(r[40][0]),qe=$_(r[40][1]),{c(){e=ie("div"),Ce.c(),t=Se(),o=ie("button"),l=we("Finish"),d=Se(),a=ie("button"),vi.c(),v=Se(),k=ie("button"),k.textContent="Delete",S=Se(),E=ie("button"),E.textContent="Cancel",P=Se(),Ue(z.$$.fragment),V=Se(),$=ie("fieldset"),H=ie("label"),G=ie("input"),X=we(`
        Snap to roads`),le=Se(),xe=ie("label"),Ie=ie("input"),Y=we(`
        Draw anywhere`),K=Se(),ue=ie("fieldset"),fe=ie("label"),ce=ie("input"),ae=we(`
        Extend from start (
        `),Ge=ie("b"),Ge.textContent="1",Le=we(`
        )`),Pe=Se(),rt=ie("label"),it=ie("input"),Qe=we(`
        Extend from end (
        `),Ft=ie("b"),Ft.textContent="2",jt=we(`
        )`),ut=Se(),et=ie("label"),at=ie("input"),Bt=we(`
        Adjust middle points (
        `),Dt=ie("b"),Dt.textContent="3",Ht=we(`
        )`),li=Se(),ai=ie("label"),ki=ie("input"),Fi=we(`
      Show major junctions`),bi=Se(),Ci&&Ci.c(),o.disabled=u=r[8].length<2,Fe(a,"class","secondary"),a.disabled=g=r[11].length==0,Fe(k,"class","secondary"),Fe(E,"class","secondary"),Fe(G,"type","radio"),G.__value="snap",Gi(G,G.__value),Fe(Ie,"type","radio"),Ie.__value="free",Gi(Ie,Ie.__value),Fe(ce,"type","radio"),ce.__value="append-start",Gi(ce,ce.__value),Fe(it,"type","radio"),it.__value="append-end",Gi(it,it.__value),Fe(at,"type","radio"),at.__value="adjust",Gi(at,at.__value),Fe(ki,"type","checkbox"),Fe(e,"slot","left"),lt.p(ce,it,at),qe.p(G,Ie)},m(_i,Bi){te(_i,e,Bi),Ce.m(e,null),B(e,t),B(e,o),B(o,l),B(e,d),B(e,a),vi.m(a,null),B(e,v),B(e,k),B(e,S),B(e,E),B(e,P),Ne(z,e,null),B(e,V),B(e,$),B($,H),B(H,G),G.checked=G.__value===r[10],B(H,X),B($,le),B($,xe),B(xe,Ie),Ie.checked=Ie.__value===r[10],B(xe,Y),B(e,K),B(e,ue),B(ue,fe),B(fe,ce),ce.checked=ce.__value===r[4],B(fe,ae),B(fe,Ge),B(fe,Le),B(ue,Pe),B(ue,rt),B(rt,it),it.checked=it.__value===r[4],B(rt,Qe),B(rt,Ft),B(rt,jt),B(ue,ut),B(ue,et),B(et,at),at.checked=at.__value===r[4],B(et,Bt),B(et,Dt),B(et,Ht),B(e,li),B(e,ai),B(ai,ki),ki.checked=r[14],B(ai,Fi),B(e,bi),Ci&&Ci.m(e,null),di=!0,st||(Te=[wt(o,"click",function(){tl(r[0])&&r[0].apply(this,arguments)}),wt(a,"click",r[15]),wt(k,"click",function(){tl(r[2])&&r[2].apply(this,arguments)}),wt(E,"click",function(){tl(r[1])&&r[1].apply(this,arguments)}),wt(G,"change",r[39]),wt(G,"change",r[16]),wt(Ie,"change",r[41]),wt(Ie,"change",r[16]),wt(ce,"change",r[42]),wt(it,"change",r[43]),wt(at,"change",r[44]),wt(ki,"change",r[45])],st=!0)},p(_i,Bi){r=_i,gt!==(gt=pt(r))&&(Ce.d(1),Ce=gt(r),Ce&&(Ce.c(),Ce.m(e,t))),(!di||Bi[0]&256&&u!==(u=r[8].length<2))&&(o.disabled=u),Xt===(Xt=nt(r))&&vi?vi.p(r,Bi):(vi.d(1),vi=Xt(r),vi&&(vi.c(),vi.m(a,null))),(!di||Bi[0]&2048&&g!==(g=r[11].length==0))&&(a.disabled=g);const br={};Bi[1]&32768&&(br.$$scope={dirty:Bi,ctx:r}),z.$set(br),Bi[0]&1024&&(G.checked=G.__value===r[10]),Bi[0]&1024&&(Ie.checked=Ie.__value===r[10]),Bi[0]&16&&(ce.checked=ce.__value===r[4]),Bi[0]&16&&(it.checked=it.__value===r[4]),Bi[0]&16&&(at.checked=at.__value===r[4]),Bi[0]&16384&&(ki.checked=r[14]),Ci&&Ci.p&&(!di||Bi[1]&32768)&&wn(Ci,ji,r,r[46],di?vn(ji,r[46],Bi,bS):xn(r[46]),Qy)},i(_i){di||(se(z.$$.fragment,_i),se(Ci,_i),di=!0)},o(_i){de(z.$$.fragment,_i),de(Ci,_i),di=!1},d(_i){_i&&ee(e),Ce.d(),vi.d(),je(z),Ci&&Ci.d(_i),lt.r(),qe.r(),st=!1,cn(Te)}}}function ES(r){let e;return{c(){e=ie("span"),Fe(e,"class","dot svelte-1cj4rwq"),dr(e,"snapped-node",r[54].snapped),dr(e,"free-node",!r[54].snapped),dr(e,"hide",r[7])},m(t,o){te(t,e,o)},p(t,o){o[0]&4096&&dr(e,"snapped-node",t[54].snapped),o[0]&4096&&dr(e,"free-node",!t[54].snapped),o[0]&128&&dr(e,"hide",t[7])},d(t){t&&ee(e)}}}function r0(r){let e,t,o;function l(g){r[30](g,r[54])}function u(){return r[31](r[54])}function d(){return r[32](r[54])}let a={draggable:!0,zIndex:0,$$slots:{default:[ES]},$$scope:{ctx:r}};return r[54].point!==void 0&&(a.lngLat=r[54].point),e=new Pd({props:a}),oi.push(()=>Vi(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",r[24]),{c(){Ue(e.$$.fragment)},m(g,v){Ne(e,g,v),o=!0},p(g,v){r=g;const k={};v[0]&4224|v[1]&32768&&(k.$$scope={dirty:v,ctx:r}),!t&&v[0]&4096&&(t=!0,k.lngLat=r[54].point,$i(()=>t=!1)),e.$set(k)},i(g){o||(se(e.$$.fragment,g),o=!0)},o(g){de(e.$$.fragment,g),o=!1},d(g){je(e,g)}}}function LS(r){let e;return{c(){e=ie("span"),e.textContent=`${r[53]+1}`,Fe(e,"class","dot svelte-1cj4rwq"),dr(e,"snapped",r[51].snapped)},m(t,o){te(t,e,o)},p(t,o){o[0]&256&&dr(e,"snapped",t[51].snapped)},d(t){t&&ee(e)}}}function o0(r){let e,t,o;function l(g){r[33](g,r[51])}function u(){return r[34](r[53])}function d(){return r[35](r[53])}let a={draggable:!0,zIndex:1,$$slots:{default:[LS]},$$scope:{ctx:r}};return r[51].point!==void 0&&(a.lngLat=r[51].point),e=new Pd({props:a}),oi.push(()=>Vi(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",r[36]),e.$on("mouseleave",r[37]),e.$on("dragstart",r[26]),e.$on("dragend",r[38]),{c(){Ue(e.$$.fragment)},m(g,v){Ne(e,g,v),o=!0},p(g,v){r=g;const k={};v[0]&256|v[1]&32768&&(k.$$scope={dirty:v,ctx:r}),!t&&v[0]&256&&(t=!0,k.lngLat=r[51].point,$i(()=>t=!1)),e.$set(k)},i(g){o||(se(e.$$.fragment,g),o=!0)},o(g){de(e.$$.fragment,g),o=!1},d(g){je(e,g)}}}function MS(r){let e,t;const o=[Ri("snapper-lines"),{paint:{"line-color":"black","line-width":10}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function AS(r){let e,t;const o=[Ri("snapper-preview"),{paint:{"line-color":"black","line-width":3}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function PS(r){let e,t,o,l,u,d,a,g,v,k;t=new M1({}),t.$on("click",r[17]),t.$on("mousemove",r[18]);let S=yi(r[12]),E=[];for(let X=0;X<S.length;X+=1)E[X]=r0(i0(r,S,X));const P=X=>de(E[X],1,1,()=>{E[X]=null});let z=yi(r[8]),V=[];for(let X=0;X<z.length;X+=1)V[X]=o0(t0(r,z,X));const $=X=>de(V[X],1,1,()=>{V[X]=null});d=new Tn({props:{data:r[21](r[9],r[8]),generateId:!0,$$slots:{default:[MS]},$$scope:{ctx:r}}}),g=new Tn({props:{data:r[13],$$slots:{default:[AS]},$$scope:{ctx:r}}});const H=r[29]["extra-map"],G=bn(H,r,r[46],e0);return{c(){e=ie("div"),Ue(t.$$.fragment),o=Se();for(let X=0;X<E.length;X+=1)E[X].c();l=Se();for(let X=0;X<V.length;X+=1)V[X].c();u=Se(),Ue(d.$$.fragment),a=Se(),Ue(g.$$.fragment),v=Se(),G&&G.c(),Fe(e,"slot","map")},m(X,le){te(X,e,le),Ne(t,e,null),B(e,o);for(let xe=0;xe<E.length;xe+=1)E[xe]&&E[xe].m(e,null);B(e,l);for(let xe=0;xe<V.length;xe+=1)V[xe]&&V[xe].m(e,null);B(e,u),Ne(d,e,null),B(e,a),Ne(g,e,null),B(e,v),G&&G.m(e,null),k=!0},p(X,le){if(le[0]&29364352){S=yi(X[12]);let Y;for(Y=0;Y<S.length;Y+=1){const K=i0(X,S,Y);E[Y]?(E[Y].p(K,le),se(E[Y],1)):(E[Y]=r0(K),E[Y].c(),se(E[Y],1),E[Y].m(e,l))}for(Li(),Y=S.length;Y<E.length;Y+=1)P(Y);Mi()}if(le[0]&68682080){z=yi(X[8]);let Y;for(Y=0;Y<z.length;Y+=1){const K=t0(X,z,Y);V[Y]?(V[Y].p(K,le),se(V[Y],1)):(V[Y]=o0(K),V[Y].c(),se(V[Y],1),V[Y].m(e,u))}for(Li(),Y=z.length;Y<V.length;Y+=1)$(Y);Mi()}const xe={};le[0]&768&&(xe.data=X[21](X[9],X[8])),le[1]&32768&&(xe.$$scope={dirty:le,ctx:X}),d.$set(xe);const Ie={};le[0]&8192&&(Ie.data=X[13]),le[1]&32768&&(Ie.$$scope={dirty:le,ctx:X}),g.$set(Ie),G&&G.p&&(!k||le[1]&32768)&&wn(G,H,X,X[46],k?vn(H,X[46],le,vS):xn(X[46]),e0)},i(X){if(!k){se(t.$$.fragment,X);for(let le=0;le<S.length;le+=1)se(E[le]);for(let le=0;le<z.length;le+=1)se(V[le]);se(d.$$.fragment,X),se(g.$$.fragment,X),se(G,X),k=!0}},o(X){de(t.$$.fragment,X),E=E.filter(Boolean);for(let le=0;le<E.length;le+=1)de(E[le]);V=V.filter(Boolean);for(let le=0;le<V.length;le+=1)de(V[le]);de(d.$$.fragment,X),de(g.$$.fragment,X),de(G,X),k=!1},d(X){X&&ee(e),je(t),$n(E,X),$n(V,X),je(d),je(g),G&&G.d(X)}}}function zS(r){let e,t;const o=r[29]["extra-right"],l=bn(o,r,r[46],n0);return{c(){e=ie("div"),l&&l.c(),Fe(e,"slot","right")},m(u,d){te(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&32768)&&wn(l,o,u,u[46],t?vn(o,u[46],d,wS):xn(u[46]),n0)},i(u){t||(se(l,u),t=!0)},o(u){de(l,u),t=!1},d(u){u&&ee(e),l&&l.d(u)}}}function DS(r){let e,t,o,l;return e=new Sc({props:{$$slots:{right:[zS],map:[PS],left:[CS]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0,o||(l=wt(window,"keydown",r[25]),o=!0)},p(u,d){const a={};d[0]&32767|d[1]&32768&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u),o=!1,l()}}}function RS(r,e,t){let o,l,u,d;yt(r,Co,gt=>t(8,l=gt)),yt(r,jd,gt=>t(9,u=gt)),yt(r,Fp,gt=>t(14,d=gt));let{$$slots:a={},$$scope:g}=e,{map:v}=e,{finish:k}=e,{cancel:S}=e,{deleteRoute:E}=e,{editingExisting:P}=e;Po(()=>{si(Co,l=[],l),u==null||u.stop(),v.getCanvas().style.cursor="inherit"});let z=P?"adjust":"append-end",V="snap",$=[],H=[],G=null,X=!1,le=!1,xe=!1;function Ie(gt){let Ce=gt.length==0?"crosshair":"inherit";v.getCanvas().style.cursor=Ce}function Y(){let gt=$.pop();t(11,$),gt&&si(Co,l=gt,l)}function K(){$.length==100&&$.shift(),t(11,$=[...$,JSON.parse(JSON.stringify(l))])}function ue(){t(10,V=V=="snap"?"free":"snap"),G&&t(28,G.snapped=V=="snap",G)}function fe(gt){K(),Co.update(Ce=>(z=="append-start"?Ce.splice(0,0,{point:gt.detail.lngLat.toArray(),snapped:V=="snap"}):z=="append-end"&&Ce.push({point:gt.detail.lngLat.toArray(),snapped:V=="snap"}),Ce))}function ce(gt){t(28,G={point:gt.detail.lngLat.toArray(),snapped:V=="snap"})}function ae(gt){K(),Co.update(Ce=>(Ce[gt].snapped=!Ce[gt].snapped,Ce))}function Ge(gt){K(),Co.update(Ce=>(Ce.splice(gt,1),Ce)),t(5,X=!1)}function Le(gt,Ce){try{if(gt)return JSON.parse(gt.inner.calculateRoute(Ce))}catch{}return fc()}function Pe(gt,Ce,nt,Xt,vi){if(vi)return fc();try{if(gt&&Ce.length>0&&Xt){if(nt=="append-start")return JSON.parse(gt.inner.calculateRoute([Xt,Ce[0]]));if(nt=="append-end")return JSON.parse(gt.inner.calculateRoute([Ce[Ce.length-1],Xt]))}}catch{}return fc()}function rt(gt,Ce,nt,Xt){if(Xt)return;if(!gt||nt!="adjust"){t(12,H=[]);return}let vi=[],ji=1;for(let Ci=0;Ci<Ce.length-1;Ci++){let _i=JSON.parse(gt.inner.getExtraNodes(Ce[Ci],Ce[Ci+1]));for(let[Bi,br,ct]of _i)vi.push({point:[Bi,br],snapped:ct,insertIdx:ji});ji++}t(12,H=vi)}function it(gt){K(),Co.update(Ce=>(Ce.splice(gt.insertIdx,0,{point:gt.point,snapped:gt.snapped}),Ce)),t(7,xe=!0)}function Qe(gt){Co.update(Ce=>(Ce[gt.insertIdx].point=gt.point,Ce))}function Ft(){t(7,xe=!1)}function jt(gt){let Ce=gt.target.tagName,nt=Ce=="INPUT"||Ce=="TEXTAREA";gt.key==="Enter"&&!nt?(gt.stopPropagation(),l.length>=2&&k()):gt.key==="Escape"?(gt.stopPropagation(),S()):gt.key=="s"&&!nt?ue():gt.key=="1"&&!nt?t(4,z="append-start"):gt.key=="2"&&!nt?t(4,z="append-end"):gt.key=="3"&&!nt?t(4,z="adjust"):gt.key=="z"&&gt.ctrlKey&&(gt.stopPropagation(),Y())}function ut(){K(),t(6,le=!0)}const et=[[],[]];function at(gt,Ce){r.$$.not_equal(Ce.point,gt)&&(Ce.point=gt,t(12,H))}const Bt=gt=>it(gt),Dt=gt=>Qe(gt);function Ht(gt,Ce){r.$$.not_equal(Ce.point,gt)&&(Ce.point=gt,Co.set(l))}const li=gt=>ae(gt),ai=gt=>Ge(gt),ki=()=>t(5,X=!0),Fi=()=>t(5,X=!1),bi=()=>t(6,le=!1);function di(){V=this.__value,t(10,V)}function lt(){V=this.__value,t(10,V)}function qe(){z=this.__value,t(4,z)}function st(){z=this.__value,t(4,z)}function Te(){z=this.__value,t(4,z)}function pt(){d=this.checked,Fp.set(d)}return r.$$set=gt=>{"map"in gt&&t(27,v=gt.map),"finish"in gt&&t(0,k=gt.finish),"cancel"in gt&&t(1,S=gt.cancel),"deleteRoute"in gt&&t(2,E=gt.deleteRoute),"editingExisting"in gt&&t(3,P=gt.editingExisting),"$$scope"in gt&&t(46,g=gt.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&912&&rt(u,l,z,xe),r.$$.dirty[0]&268436336&&t(13,o=Pe(u,l,z,G,X||le)),r.$$.dirty[0]&256&&Ie(l)},[k,S,E,P,z,X,le,xe,l,u,V,$,H,o,d,Y,ue,fe,ce,ae,Ge,Le,it,Qe,Ft,jt,ut,v,G,a,at,Bt,Dt,Ht,li,ai,ki,Fi,bi,di,et,lt,qe,st,Te,pt,g]}class FS extends Wt{constructor(e){super(),Gt(this,e,RS,DS,Vt,{map:27,finish:0,cancel:1,deleteRoute:2,editingExisting:3},null,[-1,-1])}}function s0(r,e,t){const o=r.slice();return o[23]=e[t],o}function BS(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z;return{c(){e=ie("div"),t=ie("label"),o=we(`Tier:
      `),l=ie("select"),u=ie("option"),u.textContent="Primary routes",d=ie("option"),d.textContent="Secondary routes",a=ie("option"),a.textContent="Local access routes",g=ie("option"),g.textContent="Long distance routes",v=Se(),k=ie("button"),S=we("Evaluate this route"),u.__value="Primary",Gi(u,u.__value),d.__value="Secondary",Gi(d,d.__value),a.__value="LocalAccess",Gi(a,a.__value),g.__value="LongDistance",Gi(g,g.__value),r[5]===void 0&&Mo(()=>r[14].call(l)),Fe(k,"class","secondary"),k.disabled=E=r[2].length<2,Fe(e,"slot","extra-left")},m(V,$){te(V,e,$),B(e,t),B(t,o),B(t,l),B(l,u),B(l,d),B(l,a),B(l,g),hr(l,r[5],!0),B(e,v),B(e,k),B(k,S),P||(z=[wt(l,"change",r[14]),wt(k,"click",r[11])],P=!0)},p(V,$){$&32&&hr(l,V[5]),$&4&&E!==(E=V[2].length<2)&&(k.disabled=E)},d(V){V&&ee(e),P=!1,cn(z)}}}function a0(r){let e,t;return e=new Tn({props:{data:r[6],$$slots:{default:[OS]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&64&&(u.data=o[6]),l&134217730&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function OS(r){let e,t;const o=[Ri("edit-current-routes"),{filter:r[1]==null?void 0:["!=",["id"],r[1]]},{paint:{"line-width":5,"line-color":ya,"line-opacity":.5}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&2?pn(o,[o[0],{filter:u[1]==null?void 0:["!=",["id"],u[1]]},o[2]]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function NS(r){let e,t,o=r[26].infra_type+"",l;return{c(){e=ie("p"),t=we("This section will be "),l=we(o)},m(u,d){te(u,e,d),B(e,t),B(e,l)},p(u,d){d&67108864&&o!==(o=u[26].infra_type+"")&&dt(l,o)},d(u){u&&ee(e)}}}function jS(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[NS,({props:o})=>({26:o}),({props:o})=>o?67108864:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&201326592&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function US(r){let e,t;const o=[Ri("edit-route-sections"),{filter:["==",["get","kind"],"new"]},{paint:{"line-width":3,"line-color":ya}}];let l={$$slots:{default:[jS]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};d&134217728&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function $S(r){let e,t,o,l,u=r[6]&&a0(r);return o=new Tn({props:{data:r[7],$$slots:{default:[US]},$$scope:{ctx:r}}}),{c(){e=ie("span"),u&&u.c(),t=Se(),Ue(o.$$.fragment),Fe(e,"slot","extra-map")},m(d,a){te(d,e,a),u&&u.m(e,null),B(e,t),Ne(o,e,null),l=!0},p(d,a){d[6]?u?(u.p(d,a),a&64&&se(u,1)):(u=a0(d),u.c(),se(u,1),u.m(e,t)):u&&(Li(),de(u,1,1,()=>{u=null}),Mi());const g={};a&128&&(g.data=d[7]),a&134217728&&(g.$$scope={dirty:a,ctx:d}),o.$set(g)},i(d){l||(se(u),se(o.$$.fragment,d),l=!0)},o(d){de(u),de(o.$$.fragment,d),l=!1},d(d){d&&ee(e),u&&u.d(),je(o)}}}function l0(r){let e,t,o,l=yi(r[7].features),u=[];for(let d=0;d<l.length;d+=1)u[d]=c0(s0(r,l,d));return{c(){e=ie("p"),e.textContent="The route you've drawn has been split into sections:",t=Se(),o=ie("ol");for(let d=0;d<u.length;d+=1)u[d].c()},m(d,a){te(d,e,a),te(d,t,a),te(d,o,a);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(o,null)},p(d,a){if(a&128){l=yi(d[7].features);let g;for(g=0;g<l.length;g+=1){const v=s0(d,l,g);u[g]?u[g].p(v,a):(u[g]=c0(v),u[g].c(),u[g].m(o,null))}for(;g<u.length;g+=1)u[g].d(1);u.length=l.length}},d(d){d&&(ee(e),ee(t),ee(o)),$n(u,d)}}}function VS(r){let e;return{c(){e=ie("li"),e.textContent="An existing section from another route"},m(t,o){te(t,e,o)},p:We,d(t){t&&ee(e)}}}function qS(r){let e,t,o=zo(r[23].properties).infra_type+"",l,u;return{c(){e=ie("li"),t=we("A section where "),l=we(o),u=we(` is most appropriate
            `)},m(d,a){te(d,e,a),B(e,t),B(e,l),B(e,u)},p(d,a){a&128&&o!==(o=zo(d[23].properties).infra_type+"")&&dt(l,o)},d(d){d&&ee(e)}}}function c0(r){let e,t;function o(d,a){return a&128&&(e=null),e==null&&(e=zo(d[23].properties).kind=="new"),e?qS:VS}let l=o(r,-1),u=l(r);return{c(){u.c(),t=tn()},m(d,a){u.m(d,a),te(d,t,a)},p(d,a){l===(l=o(d,a))&&u?u.p(d,a):(u.d(1),u=l(d),u&&(u.c(),u.m(t.parentNode,t)))},d(d){d&&ee(t),u.d(d)}}}function ZS(r){let e,t,o,l,u,d,a,g,v,k,S,E=r[7].features.length>0&&l0(r);return{c(){e=ie("div"),t=ie("label"),o=we(`Name:
      `),l=ie("input"),u=Se(),d=ie("label"),a=we(`Notes:
      `),g=ie("textarea"),v=Se(),E&&E.c(),Fe(l,"type","text"),Fe(g,"rows","5"),Fe(e,"slot","extra-right")},m(P,z){te(P,e,z),B(e,t),B(t,o),B(t,l),Gi(l,r[3]),B(e,u),B(e,d),B(d,a),B(d,g),Gi(g,r[4]),B(e,v),E&&E.m(e,null),k||(S=[wt(l,"input",r[12]),wt(g,"input",r[13])],k=!0)},p(P,z){z&8&&l.value!==P[3]&&Gi(l,P[3]),z&16&&Gi(g,P[4]),P[7].features.length>0?E?E.p(P,z):(E=l0(P),E.c(),E.m(e,null)):E&&(E.d(1),E=null)},d(P){P&&ee(e),E&&E.d(),k=!1,cn(S)}}}function GS(r){let e,t;return e=new FS({props:{map:r[0],finish:r[9],cancel:r[10],deleteRoute:r[8],editingExisting:r[1]!=null,$$slots:{"extra-right":[ZS],"extra-map":[$S],"extra-left":[BS]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,[l]){const u={};l&1&&(u.map=o[0]),l&2&&(u.editingExisting=o[1]!=null),l&134217982&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function WS(r,e,t){let o,l,u,d,a,g,v;yt(r,An,fe=>t(16,o=fe)),yt(r,jd,fe=>t(17,l=fe)),yt(r,hn,fe=>t(18,u=fe)),yt(r,il,fe=>t(19,d=fe)),yt(r,da,fe=>t(20,a=fe)),yt(r,Co,fe=>t(2,g=fe)),yt(r,ys,fe=>t(21,v=fe));let{map:k}=e,{id:S}=e,E="",P="",z="Unknown",V=v,$=null,H=fc();yc(async()=>{if(t(6,$=await o.renderRoutes()),si(Co,g=[],g),S!=null){let fe=$.features.find(ce=>ce.id==S);t(3,E=fe.properties.name),t(4,P=fe.properties.notes),z=fe.properties.infra_type,t(5,V=fe.properties.tier),si(Co,g=fe.properties.waypoints.map(ce=>({point:[ce.lon,ce.lat],snapped:ce.snapped})),g)}});async function G(){S&&(await o.deleteRoute(S),await ah()),si(hn,u={kind:"main"},u)}async function X(){try{let fe=JSON.parse(l.inner.calculateRoute(g));if(!fe){window.alert("No route drawn");return}await o.setRoute(S,{feature:fe,name:E,notes:P,full_path:fe.properties.full_path,infra_type:z,tier:V}),await ah(),si(hn,u={kind:"main"},u)}catch(fe){window.alert(fe)}}function le(){si(hn,u={kind:"main"},u)}function xe(){let fe=JSON.parse(l.inner.calculateRoute(g)),ce=fe.geometry.coordinates[0],ae=fe.geometry.coordinates[fe.geometry.coordinates.length-1];si(da,a={lng:ce[0],lat:ce[1]},a),si(il,d={lng:ae[0],lat:ae[1]},d),si(hn,u={kind:"evaluate-route",prevMode:{kind:"edit-route",id:S},browse:[]},u)}async function Ie(fe){try{let ce=JSON.parse(l.inner.calculateRoute(fe));t(7,H=await o.autosplitRoute(ce.properties.full_path))}catch{t(7,H=fc())}}function Y(){E=this.value,t(3,E)}function K(){P=this.value,t(4,P)}function ue(){V=ws(this),t(5,V)}return r.$$set=fe=>{"map"in fe&&t(0,k=fe.map),"id"in fe&&t(1,S=fe.id)},r.$$.update=()=>{r.$$.dirty&4&&Ie(g)},[k,S,g,E,P,V,$,H,G,X,le,xe,Y,K,ue]}class HS extends Wt{constructor(e){super(),Gt(this,e,WS,GS,Vt,{map:0,id:1})}}function u0(r,e,t){const o=r.slice();return o[3]=e[t],o}function h0(r){let e,t,o,l=r[3].infra_type+"",u,d,a=r[3].name+"",g,v,k;return{c(){e=ie("li"),t=ie("a"),o=we("["),u=we(l),d=we("] "),g=we(a),k=Se(),Fe(t,"href",v=r[3].way),Fe(t,"target","_blank")},m(S,E){te(S,e,E),B(e,t),B(t,o),B(t,u),B(t,d),B(t,g),B(e,k)},p(S,E){E&1&&l!==(l=S[3].infra_type+"")&&dt(u,l),E&1&&a!==(a=S[3].name+"")&&dt(g,a),E&1&&v!==(v=S[3].way)&&Fe(t,"href",v)},d(S){S&&ee(e)}}}function XS(r){let e,t,o,l=(r[0].route_length/r[0].direct_length).toFixed(1)+"",u,d,a,g,v,k,S=(r[0].route_length/r[0].car_length).toFixed(1)+"",E,P,z,V,$,H,G,X,le,xe=gd(r[0],r[1])+"",Ie,Y,K,ue,fe,ce=yd(r[0],r[1])+"",ae,Ge,Le,Pe,rt,it=gd(r[0],r[2])+"",Qe,Ft,jt,ut,et,at=yd(r[0],r[2])+"",Bt,Dt,Ht,li,ai,ki,Fi,bi,di=yi(r[0].directions),lt=[];for(let qe=0;qe<di.length;qe+=1)lt[qe]=h0(u0(r,di,qe));return{c(){e=ie("p"),t=we("Detour factor: "),o=ie("b"),u=we(l),d=we("x"),a=we(`
  longer than straight line`),g=Se(),v=ie("p"),k=ie("b"),E=we(S),P=we("x"),z=we(`
  longer than the driving route (in
  `),V=ie("span"),V.textContent="red",$=we(`
  )`),H=Se(),G=ie("hr"),X=Se(),le=ie("p"),Ie=we(xe),Y=we(" changes in infrastructure type"),K=Se(),ue=ie("p"),fe=we("By length: "),ae=we(ce),Ge=Se(),Le=ie("hr"),Pe=Se(),rt=ie("p"),Qe=we(it),Ft=we(" changes in level of service"),jt=Se(),ut=ie("p"),et=we("By length: "),Bt=we(at),Dt=Se(),Ht=ie("hr"),li=Se(),ai=ie("details"),ki=ie("summary"),ki.textContent="Route directions",Fi=Se(),bi=ie("ol");for(let qe=0;qe<lt.length;qe+=1)lt[qe].c();ui(V,"color","red")},m(qe,st){te(qe,e,st),B(e,t),B(e,o),B(o,u),B(o,d),B(e,a),te(qe,g,st),te(qe,v,st),B(v,k),B(k,E),B(k,P),B(v,z),B(v,V),B(v,$),te(qe,H,st),te(qe,G,st),te(qe,X,st),te(qe,le,st),B(le,Ie),B(le,Y),te(qe,K,st),te(qe,ue,st),B(ue,fe),B(ue,ae),te(qe,Ge,st),te(qe,Le,st),te(qe,Pe,st),te(qe,rt,st),B(rt,Qe),B(rt,Ft),te(qe,jt,st),te(qe,ut,st),B(ut,et),B(ut,Bt),te(qe,Dt,st),te(qe,Ht,st),te(qe,li,st),te(qe,ai,st),B(ai,ki),B(ai,Fi),B(ai,bi);for(let Te=0;Te<lt.length;Te+=1)lt[Te]&&lt[Te].m(bi,null)},p(qe,[st]){if(st&1&&l!==(l=(qe[0].route_length/qe[0].direct_length).toFixed(1)+"")&&dt(u,l),st&1&&S!==(S=(qe[0].route_length/qe[0].car_length).toFixed(1)+"")&&dt(E,S),st&1&&xe!==(xe=gd(qe[0],qe[1])+"")&&dt(Ie,xe),st&1&&ce!==(ce=yd(qe[0],qe[1])+"")&&dt(ae,ce),st&1&&it!==(it=gd(qe[0],qe[2])+"")&&dt(Qe,it),st&1&&at!==(at=yd(qe[0],qe[2])+"")&&dt(Bt,at),st&1){di=yi(qe[0].directions);let Te;for(Te=0;Te<di.length;Te+=1){const pt=u0(qe,di,Te);lt[Te]?lt[Te].p(pt,st):(lt[Te]=h0(pt),lt[Te].c(),lt[Te].m(bi,null))}for(;Te<lt.length;Te+=1)lt[Te].d(1);lt.length=di.length}},i:We,o:We,d(qe){qe&&(ee(e),ee(g),ee(v),ee(H),ee(G),ee(X),ee(le),ee(K),ee(ue),ee(Ge),ee(Le),ee(Pe),ee(rt),ee(jt),ee(ut),ee(Dt),ee(Ht),ee(li),ee(ai)),$n(lt,qe)}}}function gd(r,e){let t=0;for(let o=0;o<r.directions.length-1;o++){let l=e(r.directions[o]),u=e(r.directions[o+1]);l!=u&&t++}return t}function yd(r,e){let t={};for(let u of r.directions){let d=e(u);Object.hasOwn(t,d)||(t[d]=0),t[d]+=u.length}let o=0;for(let u of Object.values(t))o+=u;let l=[];for(let[u,d]of Object.entries(t).toSorted((a,g)=>g[1]-a[1])){let a=Math.round(d/o*100);l.push(`${a}% ${u}`)}return l.join(", ")}function KS(r,e,t){let{gj:o}=e,l=d=>d.infra_type,u=d=>d.los;return r.$$set=d=>{"gj"in d&&t(0,o=d.gj)},[o,l,u]}class JS extends Wt{constructor(e){super(),Gt(this,e,KS,XS,Vt,{gj:0})}}function d0(r){let e,t;return{c(){e=ie("p"),t=we(r[7])},m(o,l){te(o,e,l),B(e,t)},p(o,l){l&128&&dt(t,o[7])},d(o){o&&ee(e)}}}function YS(r){let e,t;return e=new nl({props:{colors:O1}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function QS(r){let e,t;return e=new nl({props:{colors:tm}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function f0(r){let e,t;return e=new JS({props:{gj:r[6]}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&64&&(u.gj=o[6]),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function e5(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie,Y=r[7]&&d0(r);const K=[QS,YS],ue=[];function fe(ae,Ge){return ae[3]=="los"?0:ae[3]=="gradient"?1:-1}~(H=fe(r))&&(G=ue[H]=K[H](r));let ce=r[6]&&f0(r);return{c(){e=ie("div"),t=ie("h2"),t.textContent="Evaluate a route mode",o=Se(),l=ie("button"),l.textContent="Back",u=Se(),d=ie("p"),d.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,a=Se(),Y&&Y.c(),g=Se(),v=ie("label"),k=we(`Show details along route
      `),S=ie("select"),E=ie("option"),E.textContent="Just show route",P=ie("option"),P.textContent="Level of service",z=ie("option"),z.textContent="Infrastructure type",V=ie("option"),V.textContent="Gradient",$=Se(),G&&G.c(),X=Se(),ce&&ce.c(),E.__value="",Gi(E,E.__value),P.__value="los",Gi(P,P.__value),z.__value="infra_type",Gi(z,z.__value),V.__value="gradient",Gi(V,V.__value),r[3]===void 0&&Mo(()=>r[18].call(S)),Fe(e,"slot","left")},m(ae,Ge){te(ae,e,Ge),B(e,t),B(e,o),B(e,l),B(e,u),B(e,d),B(e,a),Y&&Y.m(e,null),B(e,g),B(e,v),B(v,k),B(v,S),B(S,E),B(S,P),B(S,z),B(S,V),hr(S,r[3],!0),B(e,$),~H&&ue[H].m(e,null),B(e,X),ce&&ce.m(e,null),le=!0,xe||(Ie=[wt(l,"click",r[17]),wt(S,"change",r[18])],xe=!0)},p(ae,Ge){ae[7]?Y?Y.p(ae,Ge):(Y=d0(ae),Y.c(),Y.m(e,g)):Y&&(Y.d(1),Y=null),Ge&8&&hr(S,ae[3]);let Le=H;H=fe(ae),H!==Le&&(G&&(Li(),de(ue[Le],1,1,()=>{ue[Le]=null}),Mi()),~H?(G=ue[H],G||(G=ue[H]=K[H](ae),G.c()),se(G,1),G.m(e,X)):G=null),ae[6]?ce?(ce.p(ae,Ge),Ge&64&&se(ce,1)):(ce=f0(ae),ce.c(),se(ce,1),ce.m(e,null)):ce&&(Li(),de(ce,1,1,()=>{ce=null}),Mi())},i(ae){le||(se(G),se(ce),le=!0)},o(ae){de(G),de(ce),le=!1},d(ae){ae&&ee(e),Y&&Y.d(),~H&&ue[H].d(),ce&&ce.d(),xe=!1,cn(Ie)}}}function t5(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function i5(r){let e,t;return e=new Tn({props:{data:r[21],$$slots:{default:[n5]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&512&&(u.data=o[21]),l&4195328&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function n5(r){let e,t;const o=[Ri("eval-current-routes"),{paint:{"line-width":5,"line-color":ya}},{layout:{visibility:r[10]?"visible":"none"}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&1024?pn(o,[o[0],o[1],{layout:{visibility:u[10]?"visible":"none"}}]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function r5(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function p0(r){let e,t,o,l,u,d;function a(S){r[15](S)}let g={draggable:!0,$$slots:{default:[o5]},$$scope:{ctx:r}};r[5]!==void 0&&(g.lngLat=r[5]),e=new Pd({props:g}),oi.push(()=>Vi(e,"lngLat",a));function v(S){r[16](S)}let k={draggable:!0,$$slots:{default:[s5]},$$scope:{ctx:r}};return r[4]!==void 0&&(k.lngLat=r[4]),l=new Pd({props:k}),oi.push(()=>Vi(l,"lngLat",v)),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment)},m(S,E){Ne(e,S,E),te(S,o,E),Ne(l,S,E),d=!0},p(S,E){const P={};E&4194304&&(P.$$scope={dirty:E,ctx:S}),!t&&E&32&&(t=!0,P.lngLat=S[5],$i(()=>t=!1)),e.$set(P);const z={};E&4194304&&(z.$$scope={dirty:E,ctx:S}),!u&&E&16&&(u=!0,z.lngLat=S[4],$i(()=>u=!1)),l.$set(z)},i(S){d||(se(e.$$.fragment,S),se(l.$$.fragment,S),d=!0)},o(S){de(e.$$.fragment,S),de(l.$$.fragment,S),d=!1},d(S){S&&ee(o),je(e,S),je(l,S)}}}function o5(r){let e;return{c(){e=ie("span"),e.textContent="A",Fe(e,"class","dot svelte-1ej0v4r")},m(t,o){te(t,e,o)},p:We,d(t){t&&ee(e)}}}function s5(r){let e;return{c(){e=ie("span"),e.textContent="B",Fe(e,"class","dot svelte-1ej0v4r")},m(t,o){te(t,e,o)},p:We,d(t){t&&ee(e)}}}function m0(r){let e,t;return e=new Tn({props:{data:r[6],generateId:!0,$$slots:{default:[a5]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&64&&(u.data=o[6]),l&4194312&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function a5(r){let e,t,o,l;const u=[Ri("eval-route-breakdown"),{filter:["!",["has","car_route"]]},{paint:{"line-width":20,"line-color":{"":"cyan",los:Op,infra_type:ya,gradient:My}[r[3]],"line-opacity":Vn(.5,1)}},{manageHoverState:!0}];let d={};for(let v=0;v<u.length;v+=1)d=Di(d,u[v]);e=new mn({props:d});const a=[Ri("eval-car-route"),{filter:["has","car_route"]},{paint:{"line-width":10,"line-color":"red","line-opacity":Vn(.5,1)}},{manageHoverState:!0}];let g={};for(let v=0;v<a.length;v+=1)g=Di(g,a[v]);return o=new mn({props:g}),{c(){Ue(e.$$.fragment),t=Se(),Ue(o.$$.fragment)},m(v,k){Ne(e,v,k),te(v,t,k),Ne(o,v,k),l=!0},p(v,k){const S=k&8?pn(u,[u[0],u[1],{paint:{"line-width":20,"line-color":{"":"cyan",los:Op,infra_type:ya,gradient:My}[v[3]],"line-opacity":Vn(.5,1)}},u[3]]):{};e.$set(S);const E={};o.$set(E)},i(v){l||(se(e.$$.fragment,v),se(o.$$.fragment,v),l=!0)},o(v){de(e.$$.fragment,v),de(o.$$.fragment,v),l=!1},d(v){v&&ee(t),je(e,v),je(o,v)}}}function l5(r){let e,t,o,l,u,d,a;t=new M1({}),t.$on("contextmenu",r[11]);let g={ctx:r,current:null,token:null,hasCatch:!1,pending:r5,then:i5,catch:t5,value:21,blocks:[,,,]};Dr(l=zo(r[9]).renderRoutes(),g);let v=r[5]&&r[4]&&p0(r),k=r[6]&&m0(r);return{c(){e=ie("div"),Ue(t.$$.fragment),o=Se(),g.block.c(),u=Se(),v&&v.c(),d=Se(),k&&k.c(),Fe(e,"slot","map")},m(S,E){te(S,e,E),Ne(t,e,null),B(e,o),g.block.m(e,g.anchor=null),g.mount=()=>e,g.anchor=u,B(e,u),v&&v.m(e,null),B(e,d),k&&k.m(e,null),a=!0},p(S,E){r=S,g.ctx=r,E&512&&l!==(l=zo(r[9]).renderRoutes())&&Dr(l,g)||ba(g,r,E),r[5]&&r[4]?v?(v.p(r,E),E&48&&se(v,1)):(v=p0(r),v.c(),se(v,1),v.m(e,d)):v&&(Li(),de(v,1,1,()=>{v=null}),Mi()),r[6]?k?(k.p(r,E),E&64&&se(k,1)):(k=m0(r),k.c(),se(k,1),k.m(e,null)):k&&(Li(),de(k,1,1,()=>{k=null}),Mi())},i(S){a||(se(t.$$.fragment,S),se(g.block),se(v),se(k),a=!0)},o(S){de(t.$$.fragment,S);for(let E=0;E<3;E+=1){const P=g.blocks[E];de(P)}de(v),de(k),a=!1},d(S){S&&ee(e),je(t),g.block.d(),g.token=null,g=null,v&&v.d(),k&&k.d()}}}function _0(r){let e,t,o,l,u,d,a,g=r[2]+1+"",v,k,S=r[1].length+"",E,P,z,V,$,H,G;return{c(){e=ie("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",t=Se(),o=ie("div"),l=ie("button"),u=we("Previous"),a=Se(),v=we(g),k=we(" / "),E=we(S),P=Se(),z=ie("button"),V=we("Next"),Fe(l,"class","secondary"),l.disabled=d=r[2]==0,Fe(z,"class","secondary"),z.disabled=$=r[2]==r[1].length-1},m(X,le){te(X,e,le),te(X,t,le),te(X,o,le),B(o,l),B(l,u),B(o,a),B(o,v),B(o,k),B(o,E),B(o,P),B(o,z),B(z,V),H||(G=[wt(l,"click",r[13]),wt(z,"click",r[14])],H=!0)},p(X,le){le&4&&d!==(d=X[2]==0)&&(l.disabled=d),le&4&&g!==(g=X[2]+1+"")&&dt(v,g),le&2&&S!==(S=X[1].length+"")&&dt(E,S),le&6&&$!==($=X[2]==X[1].length-1)&&(z.disabled=$)},d(X){X&&(ee(e),ee(t),ee(o)),H=!1,cn(G)}}}function c5(r){let e,t=r[1].length>0&&_0(r);return{c(){e=ie("div"),t&&t.c(),Fe(e,"slot","right")},m(o,l){te(o,e,l),t&&t.m(e,null)},p(o,l){o[1].length>0?t?t.p(o,l):(t=_0(o),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},d(o){o&&ee(e),t&&t.d()}}}function u5(r){let e,t,o,l;return e=new Sc({props:{$$slots:{right:[c5],map:[l5],left:[e5]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0,o||(l=wt(window,"keydown",r[12]),o=!0)},p(u,[d]){const a={};d&4196351&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u),o=!1,l()}}}function h5(r,e,t){let o,l,u,d,a;yt(r,hn,K=>t(8,o=K)),yt(r,il,K=>t(4,l=K)),yt(r,da,K=>t(5,u=K)),yt(r,An,K=>t(9,d=K)),yt(r,Rp,K=>t(10,a=K));let{prevMode:g}=e,{browse:v}=e,k=0,S=null,E="",P="los";async function z(K,ue,fe=""){try{t(6,S=await d.evaluateRoute({start:K,end:[ue.lng,ue.lat],breakdown:fe})),t(7,E="")}catch(ce){t(6,S=null),t(7,E=ce.toString())}}function V(K){si(da,u=K.detail.lngLat,u)}async function $(K){if(v.length==0)return;let ue=v[K];si(da,u={lng:ue[0].x,lat:ue[0].y},u),si(il,l={lng:ue[1].x,lat:ue[1].y},l),z(u,l,P)}function H(K){K.key==="Escape"&&(K.stopPropagation(),si(hn,o={kind:"main"},o))}const G=()=>t(2,k--,k),X=()=>t(2,k++,k);function le(K){u=K,da.set(u)}function xe(K){l=K,il.set(l)}const Ie=()=>si(hn,o=g,o);function Y(){P=ws(this),t(3,P)}return r.$$set=K=>{"prevMode"in K&&t(0,g=K.prevMode),"browse"in K&&t(1,v=K.browse)},r.$$.update=()=>{r.$$.dirty&56&&z(u,l,P),r.$$.dirty&4&&$(k)},[g,v,k,P,l,u,S,E,o,d,a,V,H,G,X,le,xe,Ie,Y]}class d5 extends Wt{constructor(e){super(),Gt(this,e,h5,u5,Vt,{prevMode:0,browse:1})}}function Xn(r,e){return e==0?"0%":`${Math.round(r/e*100)}%`}function Ud(r){return r.reduce((e,t)=>e+t,0)}function $d(r){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]]]}function im(r){return["step",["get",r],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function U1(){return["step",["abs",["get","gradient"]],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}function g0(r,e,t){const o=r.slice();return o[5]=e[t][0],o[6]=e[t][1],o}function y0(r){let e,t=r[0].succeeded.toLocaleString()+"",o,l,u=r[0].failed.toLocaleString()+"",d,a,g,v,k,S=r[0].max_count.toLocaleString()+"",E,P,z,V,$,H,G,X=(100*r[0].percent_off_network).toFixed(1)+"",le,xe,Ie,Y=yi(Object.entries(r[0].percent_on_network)),K=[];for(let ue=0;ue<Y.length;ue+=1)K[ue]=b0(g0(r,Y,ue));return{c(){e=ie("p"),o=we(t),l=we(" routes succeeded, "),d=we(u),a=we(`
        failed`),g=Se(),v=ie("p"),k=we("Highest count on any one road is "),E=we(S),P=Se(),z=ie("p"),z.textContent="Percent of demand by infrastructure type:",V=Se(),$=ie("ul"),H=ie("li"),G=we("Off the network: "),le=we(X),xe=we("%"),Ie=Se();for(let ue=0;ue<K.length;ue+=1)K[ue].c()},m(ue,fe){te(ue,e,fe),B(e,o),B(e,l),B(e,d),B(e,a),te(ue,g,fe),te(ue,v,fe),B(v,k),B(v,E),te(ue,P,fe),te(ue,z,fe),te(ue,V,fe),te(ue,$,fe),B($,H),B(H,G),B(H,le),B(H,xe),B($,Ie);for(let ce=0;ce<K.length;ce+=1)K[ce]&&K[ce].m($,null)},p(ue,fe){if(fe&1&&t!==(t=ue[0].succeeded.toLocaleString()+"")&&dt(o,t),fe&1&&u!==(u=ue[0].failed.toLocaleString()+"")&&dt(d,u),fe&1&&S!==(S=ue[0].max_count.toLocaleString()+"")&&dt(E,S),fe&1&&X!==(X=(100*ue[0].percent_off_network).toFixed(1)+"")&&dt(le,X),fe&1){Y=yi(Object.entries(ue[0].percent_on_network));let ce;for(ce=0;ce<Y.length;ce+=1){const ae=g0(ue,Y,ce);K[ce]?K[ce].p(ae,fe):(K[ce]=b0(ae),K[ce].c(),K[ce].m($,null))}for(;ce<K.length;ce+=1)K[ce].d(1);K.length=Y.length}},d(ue){ue&&(ee(e),ee(g),ee(v),ee(P),ee(z),ee(V),ee($)),$n(K,ue)}}}function b0(r){let e,t=r[5]+"",o,l,u=(100*r[6]).toFixed(1)+"",d,a;return{c(){e=ie("li"),o=we(t),l=we(": "),d=we(u),a=we("%")},m(g,v){te(g,e,v),B(e,o),B(e,l),B(e,d),B(e,a)},p(g,v){v&1&&t!==(t=g[5]+"")&&dt(o,t),v&1&&u!==(u=(100*g[6]).toFixed(1)+"")&&dt(d,u)},d(g){g&&ee(e)}}}function f5(r){let e,t,o,l,u,d,a,g=r[0]&&y0(r);return{c(){e=ie("div"),t=ie("h2"),t.textContent="Evaluate OD mode",o=Se(),l=ie("button"),l.textContent="Back",u=Se(),g&&g.c(),Fe(e,"slot","left")},m(v,k){te(v,e,k),B(e,t),B(e,o),B(e,l),B(e,u),g&&g.m(e,null),d||(a=wt(l,"click",r[2]),d=!0)},p(v,k){v[0]?g?g.p(v,k):(g=y0(v),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d(v){v&&ee(e),g&&g.d(),d=!1,a()}}}function v0(r){let e,t;return e=new Tn({props:{data:r[0],generateId:!0,$$slots:{default:[_5]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&1&&(u.data=o[0]),l&512&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function p5(r){let e=r[4].count+"",t,o,l=r[4].infra_type+"",u;return{c(){t=we(e),o=we(" on "),u=we(l)},m(d,a){te(d,t,a),te(d,o,a),te(d,u,a)},p(d,a){a&16&&e!==(e=d[4].count+"")&&dt(t,e),a&16&&l!==(l=d[4].infra_type+"")&&dt(u,l)},d(d){d&&(ee(t),ee(o),ee(u))}}}function m5(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[p5,({props:o})=>({4:o}),({props:o})=>o?16:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&528&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function _5(r){let e,t;const o=[Ri("eval-od-mode"),{paint:{"line-width":$d("count"),"line-color":im("count")}},{manageHoverState:!0},{eventsIfTopMost:!0}];let l={$$slots:{default:[m5]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};d&512&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function g5(r){let e,t,o=r[0]&&v0(r);return{c(){e=ie("div"),o&&o.c(),Fe(e,"slot","map")},m(l,u){te(l,e,u),o&&o.m(e,null),t=!0},p(l,u){l[0]?o?(o.p(l,u),u&1&&se(o,1)):(o=v0(l),o.c(),se(o,1),o.m(e,null)):o&&(Li(),de(o,1,1,()=>{o=null}),Mi())},i(l){t||(se(o),t=!0)},o(l){de(o),t=!1},d(l){l&&ee(e),o&&o.d()}}}function y5(r){let e,t;return e=new Sc({props:{$$slots:{map:[g5],left:[f5]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,[l]){const u={};l&515&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function b5(r,e,t){let o,l;yt(r,An,a=>t(3,o=a)),yt(r,hn,a=>t(1,l=a));let u=null;return yc(async()=>{t(0,u=await o.evaluateOD())}),[u,l,()=>si(hn,l={kind:"main"},l)]}class v5 extends Wt{constructor(e){super(),Gt(this,e,b5,y5,Vt,{})}}function w5(r){let e;return{c(){e=ie("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(t,o){te(t,e,o)},d(t){t&&ee(e)}}}function x5(r){let e;return{c(){e=ie("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(t,o){te(t,e,o)},d(t){t&&ee(e)}}}function k5(r){let e;return{c(){e=ie("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(t,o){te(t,e,o)},d(t){t&&ee(e)}}}function S5(r){let e;return{c(){e=ie("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(t,o){te(t,e,o)},d(t){t&&ee(e)}}}function T5(r){let e;function t(u,d){if(u[0]=="Primary")return S5;if(u[0]=="Secondary")return k5;if(u[0]=="LocalAccess")return x5;if(u[0]=="LongDistance")return w5}let o=t(r),l=o&&o(r);return{c(){l&&l.c(),e=tn()},m(u,d){l&&l.m(u,d),te(u,e,d)},p(u,d){o!==(o=t(u))&&(l&&l.d(1),l=o&&o(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&ee(e),l&&l.d(u)}}}function I5(r){let e,t,o,l,u,d,a,g,v,k,S,E,P;return k=new P1({props:{$$slots:{default:[T5]},$$scope:{ctx:r}}}),{c(){e=ie("div"),t=ie("button"),t.textContent="Primary routes",o=Se(),l=ie("button"),l.textContent="Secondary routes",u=Se(),d=ie("button"),d.textContent="Local access routes",a=Se(),g=ie("button"),g.textContent="Long distance routes",v=Se(),Ue(k.$$.fragment),Fe(t,"class","svelte-gv50c1"),ui(t,"background",r[0]=="Primary"?er.Primary:"grey"),Fe(l,"class","svelte-gv50c1"),ui(l,"background",r[0]=="Secondary"?er.Secondary:"grey"),Fe(d,"class","svelte-gv50c1"),ui(d,"background",r[0]=="LocalAccess"?er.LocalAccess:"grey"),Fe(g,"class","svelte-gv50c1"),ui(g,"background",r[0]=="LongDistance"?er.LongDistance:"grey"),Fe(e,"class","svelte-gv50c1")},m(z,V){te(z,e,V),B(e,t),B(e,o),B(e,l),B(e,u),B(e,d),B(e,a),B(e,g),B(e,v),Ne(k,e,null),S=!0,E||(P=[wt(t,"click",r[1]),wt(l,"click",r[2]),wt(d,"click",r[3]),wt(g,"click",r[4])],E=!0)},p(z,[V]){V&1&&ui(t,"background",z[0]=="Primary"?er.Primary:"grey"),V&1&&ui(l,"background",z[0]=="Secondary"?er.Secondary:"grey"),V&1&&ui(d,"background",z[0]=="LocalAccess"?er.LocalAccess:"grey"),V&1&&ui(g,"background",z[0]=="LongDistance"?er.LongDistance:"grey");const $={};V&33&&($.$$scope={dirty:V,ctx:z}),k.$set($)},i(z){S||(se(k.$$.fragment,z),S=!0)},o(z){de(k.$$.fragment,z),S=!1},d(z){z&&ee(e),je(k),E=!1,cn(P)}}}function C5(r,e,t){let o;return yt(r,ys,g=>t(0,o=g)),[o,()=>si(ys,o="Primary",o),()=>si(ys,o="Secondary",o),()=>si(ys,o="LocalAccess",o),()=>si(ys,o="LongDistance",o)]}class E5 extends Wt{constructor(e){super(),Gt(this,e,C5,I5,Vt,{})}}function L5(r){let e,t,o,l,u,d,a,g,v,k;const S=r[4].default,E=bn(S,r,r[3],null);return{c(){e=ie("div"),t=ie("label"),o=ie("input"),l=Se(),u=we(r[1]),d=Se(),a=ie("div"),E&&E.c(),Fe(o,"type","checkbox"),ui(a,"display",r[0]?"block":"none"),ui(a,"border","1px solid black"),ui(a,"padding","4px"),ui(a,"background","#fffff2")},m(P,z){te(P,e,z),B(e,t),B(t,o),o.checked=r[0],B(t,l),B(t,u),B(e,d),B(e,a),E&&E.m(a,null),r[6](e),g=!0,v||(k=wt(o,"change",r[5]),v=!0)},p(P,[z]){z&1&&(o.checked=P[0]),(!g||z&2)&&dt(u,P[1]),E&&E.p&&(!g||z&8)&&wn(E,S,P,P[3],g?vn(S,P[3],z,null):xn(P[3]),null),z&1&&ui(a,"display",P[0]?"block":"none")},i(P){g||(se(E,P),g=!0)},o(P){de(E,P),g=!1},d(P){P&&ee(e),E&&E.d(P),r[6](null),v=!1,k()}}}function M5(r,e,t){let{$$slots:o={},$$scope:l}=e,{name:u}=e,{show:d}=e,a=null;function g(){d=this.checked,t(0,d)}function v(k){oi[k?"unshift":"push"](()=>{a=k,t(2,a)})}return r.$$set=k=>{"name"in k&&t(1,u=k.name),"show"in k&&t(0,d=k.show),"$$scope"in k&&t(3,l=k.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&a&&B1.update(k=>(k.set(u,a),k))},[d,u,a,l,o,g,v]}class no extends Wt{constructor(e){super(),Gt(this,e,M5,L5,Vt,{name:1,show:0})}}function A5(r){let e,t,o,l,u,d,a,g,v,k,S;return{c(){e=ie("button"),e.textContent="Import existing routes",t=Se(),o=ie("label"),l=ie("input"),u=we(`
    Show osmactive data`),d=Se(),a=ie("label"),g=ie("input"),v=we(`
    Show calculated data`),Fe(e,"class","outline"),Fe(l,"type","checkbox"),Fe(g,"type","checkbox")},m(E,P){te(E,e,P),te(E,t,P),te(E,o,P),B(o,l),l.checked=r[3],B(o,u),te(E,d,P),te(E,a,P),B(a,g),g.checked=r[4],B(a,v),k||(S=[wt(e,"click",r[7]),wt(l,"change",r[8]),wt(g,"change",r[9])],k=!0)},p(E,P){P&8&&(l.checked=E[3]),P&16&&(g.checked=E[4])},d(E){E&&(ee(e),ee(t),ee(o),ee(d),ee(a)),k=!1,cn(S)}}}function w0(r){let e,t;return e=new A1({props:{$$slots:{default:[P5]},$$scope:{ctx:r}}}),e.$on("close",r[12]),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&131076&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function P5(r){let e,t,o,l,u,d,a,g,v;return{c(){e=ie("h2"),e.textContent="Import existing routes from OpenStreetMap",t=Se(),o=ie("p"),l=we(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),u=ie("button"),u.textContent="Import existing routes",d=Se(),a=ie("button"),a.textContent="Cancel",Fe(a,"class","secondary")},m(k,S){te(k,e,S),te(k,t,S),te(k,o,S),B(o,l),B(o,u),B(o,d),B(o,a),g||(v=[wt(u,"click",r[6]),wt(a,"click",r[11])],g=!0)},p:We,d(k){k&&(ee(e),ee(t),ee(o)),g=!1,cn(v)}}}function z5(r){let e,t=r[16]["Infrastructure type"]+"",o;return{c(){e=we("osmactive: "),o=we(t)},m(l,u){te(l,e,u),te(l,o,u)},p(l,u){u&65536&&t!==(t=l[16]["Infrastructure type"]+"")&&dt(o,t)},d(l){l&&(ee(e),ee(o))}}}function D5(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[z5,({props:o})=>({16:o}),({props:o})=>o?65536:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&196608&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function R5(r){let e,t;const o=[Ri("existing-infra-debug"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Yo(["get","Infrastructure type"],{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#FF0000"},"cyan"),"line-width":3}},{layout:{visibility:r[0]&&r[3]?"visible":"none"}}];let l={$$slots:{default:[D5]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&9?pn(o,[o[0],o[1],o[2],o[3],{layout:{visibility:u[0]&&u[3]?"visible":"none"}}]):{};d&131072&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function x0(r){let e,t,o,l={ctx:r,current:null,token:null,hasCatch:!1,pending:U5,then:B5,catch:F5,value:15,blocks:[,,,]};return Dr(t=r[5].classifyExistingNetwork(),l),{c(){e=tn(),l.block.c()},m(u,d){te(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,o=!0},p(u,d){r=u,l.ctx=r,d&32&&t!==(t=r[5].classifyExistingNetwork())&&Dr(t,l)||ba(l,r,d)},i(u){o||(se(l.block),o=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];de(a)}o=!1},d(u){u&&ee(e),l.block.d(u),l.token=null,l=null}}}function F5(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function B5(r){let e,t;return e=new Tn({props:{data:r[15],generateId:!0,$$slots:{default:[j5]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&32&&(u.data=o[15]),l&131089&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function O5(r){let e=mc[r[16].infra_type][0]+"",t;return{c(){t=we(e)},m(o,l){te(o,t,l)},p(o,l){l&65536&&e!==(e=mc[o[16].infra_type][0]+"")&&dt(t,e)},d(o){o&&ee(t)}}}function N5(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[O5,({props:o})=>({16:o}),({props:o})=>o?65536:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&196608&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function j5(r){let e,t;const o=[Ri("existing-infra"),{layout:{visibility:r[0]&&r[4]?"visible":"none"}},{paint:{"line-width":Vn(5,7),"line-color":ya,"line-opacity":.8}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[N5]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),e.$on("click",r[13]),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&17?pn(o,[o[0],{layout:{visibility:u[0]&&u[4]?"visible":"none"}},o[2],o[3],o[4]]):{};d&131072&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function U5(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function $5(r){let e,t,o,l,u,d,a,g;function v(P){r[10](P)}let k={name:"Existing network",$$slots:{default:[A5]},$$scope:{ctx:r}};r[0]!==void 0&&(k.show=r[0]),e=new no({props:k}),oi.push(()=>Vi(e,"show",v));let S=r[2]&&w0(r);u=new kc({props:{url:`pmtiles://${rl("cbd.pmtiles")}`,$$slots:{default:[R5]},$$scope:{ctx:r}}});let E=r[5]&&r[1]&&x0(r);return{c(){Ue(e.$$.fragment),o=Se(),S&&S.c(),l=Se(),Ue(u.$$.fragment),d=Se(),E&&E.c(),a=tn()},m(P,z){Ne(e,P,z),te(P,o,z),S&&S.m(P,z),te(P,l,z),Ne(u,P,z),te(P,d,z),E&&E.m(P,z),te(P,a,z),g=!0},p(P,[z]){const V={};z&131100&&(V.$$scope={dirty:z,ctx:P}),!t&&z&1&&(t=!0,V.show=P[0],$i(()=>t=!1)),e.$set(V),P[2]?S?(S.p(P,z),z&4&&se(S,1)):(S=w0(P),S.c(),se(S,1),S.m(l.parentNode,l)):S&&(Li(),de(S,1,1,()=>{S=null}),Mi());const $={};z&131081&&($.$$scope={dirty:z,ctx:P}),u.$set($),P[5]&&P[1]?E?(E.p(P,z),z&34&&se(E,1)):(E=x0(P),E.c(),se(E,1),E.m(a.parentNode,a)):E&&(Li(),de(E,1,1,()=>{E=null}),Mi())},i(P){g||(se(e.$$.fragment,P),se(S),se(u.$$.fragment,P),se(E),g=!0)},o(P){de(e.$$.fragment,P),de(S),de(u.$$.fragment,P),de(E),g=!1},d(P){P&&(ee(o),ee(l),ee(d),ee(a)),je(e,P),S&&S.d(P),je(u,P),E&&E.d(P)}}}function V5(r,e,t){let o,l;yt(r,sh,G=>t(14,o=G)),yt(r,An,G=>t(5,l=G));let u=!1,d=!1,a=!1;async function g(){if(t(2,a=!1),l){let G=l.importExistingRoutes(),X=G==1?"route segment":"route segments";await ah(),si(sh,o+=1,o),window.alert(`Imported ${G} ${X}`),t(0,u=!1)}}let v=!0,k=!0;const S=()=>t(2,a=!0);function E(){v=this.checked,t(3,v)}function P(){k=this.checked,t(4,k)}function z(G){u=G,t(0,u)}const V=()=>t(2,a=!1),$=()=>t(2,a=!1),H=G=>window.open(zo(G.detail.features[0].properties).way,"_blank");return r.$$.update=()=>{r.$$.dirty&1&&u&&t(1,d=!0)},[u,d,a,v,k,l,g,S,E,P,z,V,$,H]}class q5 extends Wt{constructor(e){super(),Gt(this,e,V5,$5,Vt,{})}}function k0(r,e,t){const o=r.slice();return o[17]=e[t][0],o[18]=e[t][1],o}function S0(r,e,t){const o=r.slice();return o[17]=e[t][0],o[18]=e[t][1],o}function T0(r,e,t){const o=r.slice();return o[17]=e[t][0],o[18]=e[t][1],o}function I0(r,e,t){const o=r.slice();return o[17]=e[t][0],o[18]=e[t][1],o}function C0(r,e,t){const o=r.slice();return o[17]=e[t][0],o[18]=e[t][1],o}function E0(r,e,t){const o=r.slice();return o[17]=e[t][0],o[18]=e[t][1],o}function L0(r){let e,t=r[18]+"",o;return{c(){e=ie("option"),o=we(t),e.__value=r[17],Gi(e,e.__value)},m(l,u){te(l,e,u),B(e,o)},p:We,d(l){l&&ee(e)}}}function M0(r){let e,t=r[18]+"",o;return{c(){e=ie("option"),o=we(t),e.__value=r[17],Gi(e,e.__value)},m(l,u){te(l,e,u),B(e,o)},p:We,d(l){l&&ee(e)}}}function A0(r){let e,t=r[18]+"",o;return{c(){e=ie("option"),o=we(t),e.__value=r[17],Gi(e,e.__value)},m(l,u){te(l,e,u),B(e,o)},p:We,d(l){l&&ee(e)}}}function P0(r){let e,t=r[18]+"",o;return{c(){e=ie("option"),o=we(t),e.__value=r[17],Gi(e,e.__value)},m(l,u){te(l,e,u),B(e,o)},p:We,d(l){l&&ee(e)}}}function Z5(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G=yi(r[7]),X=[];for(let fe=0;fe<G.length;fe+=1)X[fe]=L0(E0(r,G,fe));let le=yi(r[8]),xe=[];for(let fe=0;fe<le.length;fe+=1)xe[fe]=M0(C0(r,le,fe));let Ie=yi(r[9]),Y=[];for(let fe=0;fe<Ie.length;fe+=1)Y[fe]=A0(I0(r,Ie,fe));let K=yi(r[10]),ue=[];for(let fe=0;fe<K.length;fe+=1)ue[fe]=P0(T0(r,K,fe));return{c(){e=ie("label"),t=we(`Trip purpose:
    `),o=ie("select");for(let fe=0;fe<X.length;fe+=1)X[fe].c();l=Se(),u=ie("label"),d=we(`Scenario:
    `),a=ie("select");for(let fe=0;fe<xe.length;fe+=1)xe[fe].c();g=Se(),v=ie("label"),k=we(`Network type:
    `),S=ie("select");for(let fe=0;fe<Y.length;fe+=1)Y[fe].c();E=Se(),P=ie("label"),z=we(`Color by:
    `),V=ie("select");for(let fe=0;fe<ue.length;fe+=1)ue[fe].c();r[0]===void 0&&Mo(()=>r[11].call(o)),r[1]===void 0&&Mo(()=>r[12].call(a)),r[2]===void 0&&Mo(()=>r[13].call(S)),r[3]===void 0&&Mo(()=>r[14].call(V))},m(fe,ce){te(fe,e,ce),B(e,t),B(e,o);for(let ae=0;ae<X.length;ae+=1)X[ae]&&X[ae].m(o,null);hr(o,r[0],!0),te(fe,l,ce),te(fe,u,ce),B(u,d),B(u,a);for(let ae=0;ae<xe.length;ae+=1)xe[ae]&&xe[ae].m(a,null);hr(a,r[1],!0),te(fe,g,ce),te(fe,v,ce),B(v,k),B(v,S);for(let ae=0;ae<Y.length;ae+=1)Y[ae]&&Y[ae].m(S,null);hr(S,r[2],!0),te(fe,E,ce),te(fe,P,ce),B(P,z),B(P,V);for(let ae=0;ae<ue.length;ae+=1)ue[ae]&&ue[ae].m(V,null);hr(V,r[3],!0),$||(H=[wt(o,"change",r[11]),wt(a,"change",r[12]),wt(S,"change",r[13]),wt(V,"change",r[14])],$=!0)},p(fe,ce){if(ce[0]&128){G=yi(fe[7]);let ae;for(ae=0;ae<G.length;ae+=1){const Ge=E0(fe,G,ae);X[ae]?X[ae].p(Ge,ce):(X[ae]=L0(Ge),X[ae].c(),X[ae].m(o,null))}for(;ae<X.length;ae+=1)X[ae].d(1);X.length=G.length}if(ce[0]&129&&hr(o,fe[0]),ce[0]&256){le=yi(fe[8]);let ae;for(ae=0;ae<le.length;ae+=1){const Ge=C0(fe,le,ae);xe[ae]?xe[ae].p(Ge,ce):(xe[ae]=M0(Ge),xe[ae].c(),xe[ae].m(a,null))}for(;ae<xe.length;ae+=1)xe[ae].d(1);xe.length=le.length}if(ce[0]&258&&hr(a,fe[1]),ce[0]&512){Ie=yi(fe[9]);let ae;for(ae=0;ae<Ie.length;ae+=1){const Ge=I0(fe,Ie,ae);Y[ae]?Y[ae].p(Ge,ce):(Y[ae]=A0(Ge),Y[ae].c(),Y[ae].m(S,null))}for(;ae<Y.length;ae+=1)Y[ae].d(1);Y.length=Ie.length}if(ce[0]&516&&hr(S,fe[2]),ce[0]&1024){K=yi(fe[10]);let ae;for(ae=0;ae<K.length;ae+=1){const Ge=T0(fe,K,ae);ue[ae]?ue[ae].p(Ge,ce):(ue[ae]=P0(Ge),ue[ae].c(),ue[ae].m(V,null))}for(;ae<ue.length;ae+=1)ue[ae].d(1);ue.length=K.length}ce[0]&1032&&hr(V,fe[3])},d(fe){fe&&(ee(e),ee(l),ee(u),ee(g),ee(v),ee(E),ee(P)),$n(X,fe),$n(xe,fe),$n(Y,fe),$n(ue,fe),$=!1,cn(H)}}}function z0(r){let e,t,o,l,u=r[16][`${r[17]}_fastest_bicycle`].toLocaleString()+"",d,a,g,v=r[16][`${r[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",k,S,E,P=r[16][`${r[17]}_fastest_bicycle_ebike`].toLocaleString()+"",z,V;return{c(){e=ie("tr"),t=ie("th"),t.textContent=`${r[18]}`,o=Se(),l=ie("td"),d=we(u),a=Se(),g=ie("td"),k=we(v),S=Se(),E=ie("td"),z=we(P),V=Se()},m($,H){te($,e,H),B(e,t),B(e,o),B(e,l),B(l,d),B(e,a),B(e,g),B(g,k),B(e,S),B(e,E),B(E,z),B(e,V)},p($,H){H[0]&65536&&u!==(u=$[16][`${$[17]}_fastest_bicycle`].toLocaleString()+"")&&dt(d,u),H[0]&65536&&v!==(v=$[16][`${$[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&dt(k,v),H[0]&65536&&P!==(P=$[16][`${$[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&dt(z,P)},d($){$&&ee(e)}}}function D0(r){let e,t,o,l,u=r[16][`${r[17]}_quietest_bicycle`].toLocaleString()+"",d,a,g,v=r[16][`${r[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",k,S,E,P=r[16][`${r[17]}_quietest_bicycle_ebike`].toLocaleString()+"",z,V;return{c(){e=ie("tr"),t=ie("th"),t.textContent=`${r[18]}`,o=Se(),l=ie("td"),d=we(u),a=Se(),g=ie("td"),k=we(v),S=Se(),E=ie("td"),z=we(P),V=Se()},m($,H){te($,e,H),B(e,t),B(e,o),B(e,l),B(l,d),B(e,a),B(e,g),B(g,k),B(e,S),B(e,E),B(E,z),B(e,V)},p($,H){H[0]&65536&&u!==(u=$[16][`${$[17]}_quietest_bicycle`].toLocaleString()+"")&&dt(d,u),H[0]&65536&&v!==(v=$[16][`${$[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&dt(k,v),H[0]&65536&&P!==(P=$[16][`${$[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&dt(z,P)},d($){$&&ee(e)}}}function G5(r){let e,t,o,l=r[16][r[4]].toLocaleString()+"",u,d,a,g,v=r[16].gradient+"",k,S,E,P,z,V=r[16].quietness+"",$,H,G,X,le,xe,Ie,Y,K,ue,fe,ce,ae,Ge,Le,Pe,rt,it=yi(r[7]),Qe=[];for(let ut=0;ut<it.length;ut+=1)Qe[ut]=z0(S0(r,it,ut));let Ft=yi(r[7]),jt=[];for(let ut=0;ut<Ft.length;ut+=1)jt[ut]=D0(k0(r,Ft,ut));return{c(){e=ie("div"),t=ie("p"),o=we("Cyclists: "),u=we(l),d=Se(),a=ie("p"),g=we("Gradient: "),k=we(v),S=we("%"),E=Se(),P=ie("p"),z=we("Cycle-friendliness: "),$=we(V),H=we("%"),G=Se(),X=ie("details"),le=ie("summary"),le.textContent="All network details",xe=Se(),Ie=ie("p"),Ie.textContent="Fast/Direct network",Y=Se(),K=ie("table"),ue=ie("tr"),ue.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",fe=Se();for(let ut=0;ut<Qe.length;ut+=1)Qe[ut].c();ce=Se(),ae=ie("p"),ae.textContent="Quiet/Indirect network",Ge=Se(),Le=ie("table"),Pe=ie("tr"),Pe.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",rt=Se();for(let ut=0;ut<jt.length;ut+=1)jt[ut].c();ui(e,"max-width","30vw"),ui(e,"max-height","60vh"),ui(e,"overflow","auto")},m(ut,et){te(ut,e,et),B(e,t),B(t,o),B(t,u),B(e,d),B(e,a),B(a,g),B(a,k),B(a,S),B(e,E),B(e,P),B(P,z),B(P,$),B(P,H),B(e,G),B(e,X),B(X,le),B(X,xe),B(X,Ie),B(X,Y),B(X,K),B(K,ue),B(K,fe);for(let at=0;at<Qe.length;at+=1)Qe[at]&&Qe[at].m(K,null);B(X,ce),B(X,ae),B(X,Ge),B(X,Le),B(Le,Pe),B(Le,rt);for(let at=0;at<jt.length;at+=1)jt[at]&&jt[at].m(Le,null)},p(ut,et){if(et[0]&65552&&l!==(l=ut[16][ut[4]].toLocaleString()+"")&&dt(u,l),et[0]&65536&&v!==(v=ut[16].gradient+"")&&dt(k,v),et[0]&65536&&V!==(V=ut[16].quietness+"")&&dt($,V),et[0]&65664){it=yi(ut[7]);let at;for(at=0;at<it.length;at+=1){const Bt=S0(ut,it,at);Qe[at]?Qe[at].p(Bt,et):(Qe[at]=z0(Bt),Qe[at].c(),Qe[at].m(K,null))}for(;at<Qe.length;at+=1)Qe[at].d(1);Qe.length=it.length}if(et[0]&65664){Ft=yi(ut[7]);let at;for(at=0;at<Ft.length;at+=1){const Bt=k0(ut,Ft,at);jt[at]?jt[at].p(Bt,et):(jt[at]=D0(Bt),jt[at].c(),jt[at].m(Le,null))}for(;at<jt.length;at+=1)jt[at].d(1);jt.length=Ft.length}},d(ut){ut&&ee(e),$n(Qe,ut),$n(jt,ut)}}}function W5(r){let e,t;return e=new yr({props:{openOn:"click",$$slots:{default:[G5,({props:o})=>({16:o}),({props:o})=>[o?65536:0]]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l[0]&65552|l[1]&1&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function H5(r){let e,t;const o=[Ri("rnet"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":$d(r[4])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let l={$$slots:{default:[W5]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d[0]&112?pn(o,[o[0],o[1],d[0]&80&&{paint:{"line-color":u[6],"line-width":$d(u[4])}},d[0]&32&&{layout:{visibility:u[5]?"visible":"none"}},o[4]]):{};d[0]&16|d[1]&1&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function X5(r){let e,t,o,l,u;function d(g){r[15](g)}let a={name:"Route network",$$slots:{default:[Z5]},$$scope:{ctx:r}};return r[5]!==void 0&&(a.show=r[5]),e=new no({props:a}),oi.push(()=>Vi(e,"show",d)),l=new kc({props:{url:`pmtiles://${rl("route_network.pmtiles")}`,$$slots:{default:[H5]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment)},m(g,v){Ne(e,g,v),te(g,o,v),Ne(l,g,v),u=!0},p(g,v){const k={};v[0]&15|v[1]&1&&(k.$$scope={dirty:v,ctx:g}),!t&&v[0]&32&&(t=!0,k.show=g[5],$i(()=>t=!1)),e.$set(k);const S={};v[0]&112|v[1]&1&&(S.$$scope={dirty:v,ctx:g}),l.$set(S)},i(g){u||(se(e.$$.fragment,g),se(l.$$.fragment,g),u=!0)},o(g){de(e.$$.fragment,g),de(l.$$.fragment,g),u=!1},d(g){g&&ee(o),je(e,g),je(l,g)}}}function K5(r,e,t){let o,l,u=!1,d="all",a="bicycle_go_dutch",g="fastest",v="flow",k=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],S=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],E=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],P=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function z(){d=ws(this),t(0,d),t(7,k)}function V(){a=ws(this),t(1,a),t(8,S)}function $(){g=ws(this),t(2,g),t(9,E)}function H(){v=ws(this),t(3,v),t(10,P)}function G(X){u=X,t(5,u)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,o=`${d}_${g}_${a}`),r.$$.dirty[0]&24&&t(6,l={none:"#304ce7",flow:im(o),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:U1}[v])},[d,a,g,v,o,u,l,k,S,E,P,z,V,$,H,G]}class J5 extends Wt{constructor(e){super(),Gt(this,e,K5,X5,Vt,{},null,[-1,-1])}}function Y5(r){let e,t,o,l,u,d,a,g,v,k,S;return{c(){e=ie("button"),e.textContent="Import core network",t=Se(),o=ie("label"),l=ie("input"),u=we(`
    Show actual core network`),d=Se(),a=ie("label"),g=ie("input"),v=we(`
    Show map-matched core network`),Fe(e,"class","outline"),Fe(l,"type","checkbox"),Fe(g,"type","checkbox")},m(E,P){te(E,e,P),te(E,t,P),te(E,o,P),B(o,l),l.checked=r[2],B(o,u),te(E,d,P),te(E,a,P),B(a,g),g.checked=r[3],B(a,v),k||(S=[wt(e,"click",r[5]),wt(l,"change",r[6]),wt(g,"change",r[7])],k=!0)},p(E,P){P&4&&(l.checked=E[2]),P&8&&(g.checked=E[3])},d(E){E&&(ee(e),ee(t),ee(o),ee(d),ee(a)),k=!1,cn(S)}}}function Q5(r){let e,t=r[11].all_fastest_bicycle_go_dutch+"",o;return{c(){e=we("Go Dutch value "),o=we(t)},m(l,u){te(l,e,u),te(l,o,u)},p(l,u){u&2048&&t!==(t=l[11].all_fastest_bicycle_go_dutch+"")&&dt(o,t)},d(l){l&&(ee(e),ee(o))}}}function eT(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[Q5,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function tT(r){let e,t;const o=[Ri("cn-debug"),{sourceLayer:"coherent_networks"},{paint:{"line-color":Yo(["get","road_function"],{Primary:"#c00000",Secondary:"#e97132","Local Access":"#ffc000","Long Distance":"#4ea72e"},"cyan"),"line-width":2}},{layout:{visibility:r[0]&&r[2]?"visible":"none"}}];let l={$$slots:{default:[eT]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&5?pn(o,[o[0],o[1],o[2],{layout:{visibility:u[0]&&u[2]?"visible":"none"}}]):{};d&4096&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function R0(r){let e,t,o,l={ctx:r,current:null,token:null,hasCatch:!1,pending:oT,then:nT,catch:iT,value:10,blocks:[,,,]};return Dr(t=r[4].renderCoreNetwork(),l),{c(){e=tn(),l.block.c()},m(u,d){te(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,o=!0},p(u,d){r=u,l.ctx=r,d&16&&t!==(t=r[4].renderCoreNetwork())&&Dr(t,l)||ba(l,r,d)},i(u){o||(se(l.block),o=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];de(a)}o=!1},d(u){u&&ee(e),l.block.d(u),l.token=null,l=null}}}function iT(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function nT(r){let e,t;return e=new Tn({props:{data:r[10],generateId:!0,$$slots:{default:[rT]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&16&&(u.data=o[10]),l&4105&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function rT(r){let e,t;const o=[Ri("cn"),{paint:{"line-color":Bp,"line-width":10,"line-opacity":.5}},{layout:{visibility:r[0]&&r[3]?"visible":"none"}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&9?pn(o,[o[0],o[1],{layout:{visibility:u[0]&&u[3]?"visible":"none"}}]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function oT(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function sT(r){let e,t,o,l,u,d,a;function g(S){r[8](S)}let v={name:"Core network",$$slots:{default:[Y5]},$$scope:{ctx:r}};r[0]!==void 0&&(v.show=r[0]),e=new no({props:v}),oi.push(()=>Vi(e,"show",g)),l=new kc({props:{url:`pmtiles://${rl("core_network.pmtiles")}`,$$slots:{default:[tT]},$$scope:{ctx:r}}});let k=r[4]&&r[1]&&R0(r);return{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment),u=Se(),k&&k.c(),d=tn()},m(S,E){Ne(e,S,E),te(S,o,E),Ne(l,S,E),te(S,u,E),k&&k.m(S,E),te(S,d,E),a=!0},p(S,[E]){const P={};E&4108&&(P.$$scope={dirty:E,ctx:S}),!t&&E&1&&(t=!0,P.show=S[0],$i(()=>t=!1)),e.$set(P);const z={};E&4101&&(z.$$scope={dirty:E,ctx:S}),l.$set(z),S[4]&&S[1]?k?(k.p(S,E),E&18&&se(k,1)):(k=R0(S),k.c(),se(k,1),k.m(d.parentNode,d)):k&&(Li(),de(k,1,1,()=>{k=null}),Mi())},i(S){a||(se(e.$$.fragment,S),se(l.$$.fragment,S),se(k),a=!0)},o(S){de(e.$$.fragment,S),de(l.$$.fragment,S),de(k),a=!1},d(S){S&&(ee(o),ee(u),ee(d)),je(e,S),je(l,S),k&&k.d(S)}}}function aT(r,e,t){let o,l;yt(r,sh,P=>t(9,o=P)),yt(r,An,P=>t(4,l=P));let u=!1,d=!1,a=!0,g=!0;async function v(){if(l){let P=l.importCoreNetwork(),z=P==1?"route segment":"route segments";await ah(),si(sh,o+=1,o),window.alert(`Imported ${P} ${z}`)}}function k(){a=this.checked,t(2,a)}function S(){g=this.checked,t(3,g)}function E(P){u=P,t(0,u)}return r.$$.update=()=>{r.$$.dirty&1&&u&&t(1,d=!0)},[u,d,a,g,l,v,k,S,E]}class lT extends Wt{constructor(e){super(),Gt(this,e,aT,sT,Vt,{})}}function cT(r){let e,t;const o=[Ri("debug-reachability-"+r[0]),{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&1?pn(o,[Wv(Ri("debug-reachability-"+u[0])),o[1]]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function uT(r){let e,t;return e=new Tn({props:{data:r[1],generateId:!0,$$slots:{default:[cT]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,[l]){const u={};l&2&&(u.data=o[1]),l&33&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function hT(r,e,t){let o;yt(r,An,g=>t(3,o=g));let{kind:l}=e,{hovered:u}=e,d={type:"FeatureCollection",features:[]};async function a(g){o&&g?g.properties.reachable?t(1,d=await o.debugReachablePath(l,g.properties.idx)):t(1,d=await o.debugUnreachablePath(l,g.properties.idx)):t(1,d={type:"FeatureCollection",features:[]})}return r.$$set=g=>{"kind"in g&&t(0,l=g.kind),"hovered"in g&&t(2,u=g.hovered)},r.$$.update=()=>{r.$$.dirty&4&&a(u)},[l,d,u]}class nm extends Wt{constructor(e){super(),Gt(this,e,hT,uT,Vt,{kind:0,hovered:2})}}function dT(r){let e,t,o,l=r[3].toLocaleString()+"",u,d,a=r[0].features.length.toLocaleString()+"",g,v,k=Xn(r[3],r[0].features.length)+"",S,E,P,z,V,$,H;return z=new nl({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),o=ie("p"),u=we(l),d=we(" / "),g=we(a),v=we(" ("),S=we(k),E=we(") reachable"),P=Se(),Ue(z.$$.fragment),Fe(e,"class","outline")},m(G,X){te(G,e,X),te(G,t,X),te(G,o,X),B(o,u),B(o,d),B(o,g),B(o,v),B(o,S),B(o,E),te(G,P,X),Ne(z,G,X),V=!0,$||(H=wt(e,"click",r[4]),$=!0)},p(G,X){(!V||X&8)&&l!==(l=G[3].toLocaleString()+"")&&dt(u,l),(!V||X&1)&&a!==(a=G[0].features.length.toLocaleString()+"")&&dt(g,a),(!V||X&9)&&k!==(k=Xn(G[3],G[0].features.length)+"")&&dt(S,k)},i(G){V||(se(z.$$.fragment,G),V=!0)},o(G){de(z.$$.fragment,G),V=!1},d(G){G&&(ee(e),ee(t),ee(o),ee(P)),je(z,G),$=!1,H()}}}function fT(r){let e=r[8].name+"",t,o,l=r[8].kind+"",u,d,a=r[8].pupils+"",g,v,k=r[8].reachable?"is":"is not",S,E;return{c(){t=we(e),o=we(" is a "),u=we(l),d=we(" school with "),g=we(a),v=we(" pupils. It "),S=we(k),E=we(" reachable.")},m(P,z){te(P,t,z),te(P,o,z),te(P,u,z),te(P,d,z),te(P,g,z),te(P,v,z),te(P,S,z),te(P,E,z)},p(P,z){z&256&&e!==(e=P[8].name+"")&&dt(t,e),z&256&&l!==(l=P[8].kind+"")&&dt(u,l),z&256&&a!==(a=P[8].pupils+"")&&dt(g,a),z&256&&k!==(k=P[8].reachable?"is":"is not")&&dt(S,k)},d(P){P&&(ee(t),ee(o),ee(u),ee(d),ee(g),ee(v),ee(S),ee(E))}}}function pT(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[fT,({props:o})=>({8:o}),({props:o})=>o?256:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function mT(r){let e,t,o;const l=[Ri("schools"),{manageHoverState:!0},{paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Vn(5,8)}},{layout:{visibility:r[1]?"visible":"none"}}];function u(a){r[6](a)}let d={$$slots:{default:[pT]},$$scope:{ctx:r}};for(let a=0;a<l.length;a+=1)d=Di(d,l[a]);return r[2]!==void 0&&(d.hovered=r[2]),e=new Yp({props:d}),oi.push(()=>Vi(e,"hovered",u)),{c(){Ue(e.$$.fragment)},m(a,g){Ne(e,a,g),o=!0},p(a,g){const v=g&2?pn(l,[l[0],l[1],l[2],{layout:{visibility:a[1]?"visible":"none"}}]):{};g&512&&(v.$$scope={dirty:g,ctx:a}),!t&&g&4&&(t=!0,v.hovered=a[2],$i(()=>t=!1)),e.$set(v)},i(a){o||(se(e.$$.fragment,a),o=!0)},o(a){de(e.$$.fragment,a),o=!1},d(a){je(e,a)}}}function _T(r){let e,t,o,l,u,d,a;function g(k){r[5](k)}let v={name:"Schools",$$slots:{default:[dT]},$$scope:{ctx:r}};return r[1]!==void 0&&(v.show=r[1]),e=new no({props:v}),oi.push(()=>Vi(e,"show",g)),l=new Tn({props:{data:r[0],generateId:!0,$$slots:{default:[mT]},$$scope:{ctx:r}}}),d=new nm({props:{kind:"schools",hovered:r[2]}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment),u=Se(),Ue(d.$$.fragment)},m(k,S){Ne(e,k,S),te(k,o,S),Ne(l,k,S),te(k,u,S),Ne(d,k,S),a=!0},p(k,[S]){const E={};S&521&&(E.$$scope={dirty:S,ctx:k}),!t&&S&2&&(t=!0,E.show=k[1],$i(()=>t=!1)),e.$set(E);const P={};S&1&&(P.data=k[0]),S&518&&(P.$$scope={dirty:S,ctx:k}),l.$set(P);const z={};S&4&&(z.hovered=k[2]),d.$set(z)},i(k){a||(se(e.$$.fragment,k),se(l.$$.fragment,k),se(d.$$.fragment,k),a=!0)},o(k){de(e.$$.fragment,k),de(l.$$.fragment,k),de(d.$$.fragment,k),a=!1},d(k){k&&(ee(o),ee(u)),je(e,k),je(l,k),je(d,k)}}}function gT(r,e,t){let o,l,u;yt(r,Dd,S=>t(1,l=S)),yt(r,An,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},a;async function g(){u&&t(0,d=await u.getSchools())}function v(S){l=S,Dd.set(l)}function k(S){a=S,t(2,a)}return r.$$.update=()=>{r.$$.dirty&3&&l&&d.features.length==0&&g(),r.$$.dirty&1&&t(3,o=d.features.filter(S=>S.properties.reachable).length)},[d,l,a,o,g,v,k]}class yT extends Wt{constructor(e){super(),Gt(this,e,gT,_T,Vt,{})}}function bT(r){let e,t,o,l=r[3].toLocaleString()+"",u,d,a=r[0].features.length.toLocaleString()+"",g,v,k=Xn(r[3],r[0].features.length)+"",S,E,P,z,V,$,H;return z=new nl({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),o=ie("p"),u=we(l),d=we(" / "),g=we(a),v=we(" ("),S=we(k),E=we(") reachable"),P=Se(),Ue(z.$$.fragment),Fe(e,"class","outline")},m(G,X){te(G,e,X),te(G,t,X),te(G,o,X),B(o,u),B(o,d),B(o,g),B(o,v),B(o,S),B(o,E),te(G,P,X),Ne(z,G,X),V=!0,$||(H=wt(e,"click",r[4]),$=!0)},p(G,X){(!V||X&8)&&l!==(l=G[3].toLocaleString()+"")&&dt(u,l),(!V||X&1)&&a!==(a=G[0].features.length.toLocaleString()+"")&&dt(g,a),(!V||X&9)&&k!==(k=Xn(G[3],G[0].features.length)+"")&&dt(S,k)},i(G){V||(se(z.$$.fragment,G),V=!0)},o(G){de(z.$$.fragment,G),V=!1},d(G){G&&(ee(e),ee(t),ee(o),ee(P)),je(z,G),$=!1,H()}}}function vT(r){let e,t=(r[8].name||"")+"",o,l,u=r[8].reachable?"is":"is not",d,a;return{c(){e=we("Town centre "),o=we(t),l=Se(),d=we(u),a=we(" reachable.")},m(g,v){te(g,e,v),te(g,o,v),te(g,l,v),te(g,d,v),te(g,a,v)},p(g,v){v&256&&t!==(t=(g[8].name||"")+"")&&dt(o,t),v&256&&u!==(u=g[8].reachable?"is":"is not")&&dt(d,u)},d(g){g&&(ee(e),ee(o),ee(l),ee(d),ee(a))}}}function wT(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[vT,({props:o})=>({8:o}),({props:o})=>o?256:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function xT(r){let e,t,o;const l=[Ri("town-centres"),{manageHoverState:!0},{paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":Vn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];function u(a){r[6](a)}let d={$$slots:{default:[wT]},$$scope:{ctx:r}};for(let a=0;a<l.length;a+=1)d=Di(d,l[a]);return r[2]!==void 0&&(d.hovered=r[2]),e=new xc({props:d}),oi.push(()=>Vi(e,"hovered",u)),{c(){Ue(e.$$.fragment)},m(a,g){Ne(e,a,g),o=!0},p(a,g){const v=g&2?pn(l,[l[0],l[1],l[2],{layout:{visibility:a[1]?"visible":"none"}}]):{};g&512&&(v.$$scope={dirty:g,ctx:a}),!t&&g&4&&(t=!0,v.hovered=a[2],$i(()=>t=!1)),e.$set(v)},i(a){o||(se(e.$$.fragment,a),o=!0)},o(a){de(e.$$.fragment,a),o=!1},d(a){je(e,a)}}}function kT(r){let e,t,o,l,u,d,a;function g(k){r[5](k)}let v={name:"Town centres",$$slots:{default:[bT]},$$scope:{ctx:r}};return r[1]!==void 0&&(v.show=r[1]),e=new no({props:v}),oi.push(()=>Vi(e,"show",g)),l=new Tn({props:{data:r[0],generateId:!0,$$slots:{default:[xT]},$$scope:{ctx:r}}}),d=new nm({props:{kind:"town_centres",hovered:r[2]}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment),u=Se(),Ue(d.$$.fragment)},m(k,S){Ne(e,k,S),te(k,o,S),Ne(l,k,S),te(k,u,S),Ne(d,k,S),a=!0},p(k,[S]){const E={};S&521&&(E.$$scope={dirty:S,ctx:k}),!t&&S&2&&(t=!0,E.show=k[1],$i(()=>t=!1)),e.$set(E);const P={};S&1&&(P.data=k[0]),S&518&&(P.$$scope={dirty:S,ctx:k}),l.$set(P);const z={};S&4&&(z.hovered=k[2]),d.$set(z)},i(k){a||(se(e.$$.fragment,k),se(l.$$.fragment,k),se(d.$$.fragment,k),a=!0)},o(k){de(e.$$.fragment,k),de(l.$$.fragment,k),de(d.$$.fragment,k),a=!1},d(k){k&&(ee(o),ee(u)),je(e,k),je(l,k),je(d,k)}}}function ST(r,e,t){let o,l,u;yt(r,Fd,S=>t(1,l=S)),yt(r,An,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},a;async function g(){u&&t(0,d=await u.getTownCentres())}function v(S){l=S,Fd.set(l)}function k(S){a=S,t(2,a)}return r.$$.update=()=>{r.$$.dirty&3&&l&&d.features.length==0&&g(),r.$$.dirty&1&&t(3,o=d.features.filter(S=>S.properties.reachable).length)},[d,l,a,o,g,v,k]}class TT extends Wt{constructor(e){super(),Gt(this,e,ST,kT,Vt,{})}}function IT(r){let e,t,o,l=r[3].toLocaleString()+"",u,d,a=r[0].features.length.toLocaleString()+"",g,v,k=Xn(r[3],r[0].features.length)+"",S,E,P,z,V,$,H;return z=new nl({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),o=ie("p"),u=we(l),d=we(" / "),g=we(a),v=we(" ("),S=we(k),E=we(") reachable"),P=Se(),Ue(z.$$.fragment),Fe(e,"class","outline")},m(G,X){te(G,e,X),te(G,t,X),te(G,o,X),B(o,u),B(o,d),B(o,g),B(o,v),B(o,S),B(o,E),te(G,P,X),Ne(z,G,X),V=!0,$||(H=wt(e,"click",r[4]),$=!0)},p(G,X){(!V||X&8)&&l!==(l=G[3].toLocaleString()+"")&&dt(u,l),(!V||X&1)&&a!==(a=G[0].features.length.toLocaleString()+"")&&dt(g,a),(!V||X&9)&&k!==(k=Xn(G[3],G[0].features.length)+"")&&dt(S,k)},i(G){V||(se(z.$$.fragment,G),V=!0)},o(G){de(z.$$.fragment,G),V=!1},d(G){G&&(ee(e),ee(t),ee(o),ee(P)),je(z,G),$=!1,H()}}}function CT(r){let e=r[8].name+"",t,o,l=r[8].kind+"",u,d,a=r[8].reachable?"is":"is not",g,v;return{c(){t=we(e),o=we(" is a "),u=we(l),d=we(". It "),g=we(a),v=we(" reachable.")},m(k,S){te(k,t,S),te(k,o,S),te(k,u,S),te(k,d,S),te(k,g,S),te(k,v,S)},p(k,S){S&256&&e!==(e=k[8].name+"")&&dt(t,e),S&256&&l!==(l=k[8].kind+"")&&dt(u,l),S&256&&a!==(a=k[8].reachable?"is":"is not")&&dt(g,a)},d(k){k&&(ee(t),ee(o),ee(u),ee(d),ee(g),ee(v))}}}function ET(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[CT,({props:o})=>({8:o}),({props:o})=>o?256:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function LT(r){let e,t,o;const l=[Ri("gp-hospitals"),{manageHoverState:!0},{paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Vn(5,8)}},{layout:{visibility:r[1]?"visible":"none"}}];function u(a){r[6](a)}let d={$$slots:{default:[ET]},$$scope:{ctx:r}};for(let a=0;a<l.length;a+=1)d=Di(d,l[a]);return r[2]!==void 0&&(d.hovered=r[2]),e=new Yp({props:d}),oi.push(()=>Vi(e,"hovered",u)),{c(){Ue(e.$$.fragment)},m(a,g){Ne(e,a,g),o=!0},p(a,g){const v=g&2?pn(l,[l[0],l[1],l[2],{layout:{visibility:a[1]?"visible":"none"}}]):{};g&512&&(v.$$scope={dirty:g,ctx:a}),!t&&g&4&&(t=!0,v.hovered=a[2],$i(()=>t=!1)),e.$set(v)},i(a){o||(se(e.$$.fragment,a),o=!0)},o(a){de(e.$$.fragment,a),o=!1},d(a){je(e,a)}}}function MT(r){let e,t,o,l,u,d,a;function g(k){r[5](k)}let v={name:"GPs and hospitals",$$slots:{default:[IT]},$$scope:{ctx:r}};return r[1]!==void 0&&(v.show=r[1]),e=new no({props:v}),oi.push(()=>Vi(e,"show",g)),l=new Tn({props:{data:r[0],generateId:!0,$$slots:{default:[LT]},$$scope:{ctx:r}}}),d=new nm({props:{kind:"gp_hospitals",hovered:r[2]}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment),u=Se(),Ue(d.$$.fragment)},m(k,S){Ne(e,k,S),te(k,o,S),Ne(l,k,S),te(k,u,S),Ne(d,k,S),a=!0},p(k,[S]){const E={};S&521&&(E.$$scope={dirty:S,ctx:k}),!t&&S&2&&(t=!0,E.show=k[1],$i(()=>t=!1)),e.$set(E);const P={};S&1&&(P.data=k[0]),S&518&&(P.$$scope={dirty:S,ctx:k}),l.$set(P);const z={};S&4&&(z.hovered=k[2]),d.$set(z)},i(k){a||(se(e.$$.fragment,k),se(l.$$.fragment,k),se(d.$$.fragment,k),a=!0)},o(k){de(e.$$.fragment,k),de(l.$$.fragment,k),de(d.$$.fragment,k),a=!1},d(k){k&&(ee(o),ee(u)),je(e,k),je(l,k),je(d,k)}}}function AT(r,e,t){let o,l,u;yt(r,Rd,S=>t(1,l=S)),yt(r,An,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},a;async function g(){u&&t(0,d=await u.getGpHospitals())}function v(S){l=S,Rd.set(l)}function k(S){a=S,t(2,a)}return r.$$.update=()=>{r.$$.dirty&3&&l&&d.features.length==0&&g(),r.$$.dirty&1&&t(3,o=d.features.filter(S=>S.properties.reachable).length)},[d,l,a,o,g,v,k]}class PT extends Wt{constructor(e){super(),Gt(this,e,AT,MT,Vt,{})}}function zT(r){let e,t;const o=[Ri("urban-areas"),{sourceLayer:"urban_areas"},{manageHoverState:!0},{paint:{"fill-color":"black","fill-opacity":Vn(1,.5)}},{layout:{visibility:r[0]?"visible":"none"}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new xc({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&1?pn(o,[o[0],o[1],o[2],o[3],{layout:{visibility:u[0]?"visible":"none"}}]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function DT(r){let e,t,o,l,u;function d(g){r[1](g)}let a={name:"Urban areas"};return r[0]!==void 0&&(a.show=r[0]),e=new no({props:a}),oi.push(()=>Vi(e,"show",d)),l=new kc({props:{url:`pmtiles://${rl("urban_areas.pmtiles")}`,$$slots:{default:[zT]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment)},m(g,v){Ne(e,g,v),te(g,o,v),Ne(l,g,v),u=!0},p(g,[v]){const k={};!t&&v&1&&(t=!0,k.show=g[0],$i(()=>t=!1)),e.$set(k);const S={};v&5&&(S.$$scope={dirty:v,ctx:g}),l.$set(S)},i(g){u||(se(e.$$.fragment,g),se(l.$$.fragment,g),u=!0)},o(g){de(e.$$.fragment,g),de(l.$$.fragment,g),u=!1},d(g){g&&ee(o),je(e,g),je(l,g)}}}function RT(r,e,t){let o=!1;function l(u){o=u,t(0,o)}return[o,l]}class FT extends Wt{constructor(e){super(),Gt(this,e,RT,DT,Vt,{})}}function BT(r){let e,t,o,l,u,d;return o=new nl({props:{colors:r[3]}}),{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),Ue(o.$$.fragment),Fe(e,"class","outline")},m(a,g){te(a,e,g),te(a,t,g),Ne(o,a,g),l=!0,u||(d=wt(e,"click",r[2]),u=!0)},p:We,i(a){l||(se(o.$$.fragment,a),l=!0)},o(a){de(o.$$.fragment,a),l=!1},d(a){a&&(ee(e),ee(t)),je(o,a),u=!1,d()}}}function OT(r){let e,t;const o=[Ri("reachability"),{layout:{visibility:r[0]?"visible":"none"}},{paint:{"line-width":Vn(5,7),"line-color":Yo(["get","kind"],r[3],"black"),"line-opacity":.8}},{manageHoverState:!0}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&9?pn(o,[o[0],d&1&&{layout:{visibility:u[0]?"visible":"none"}},d&8&&{paint:{"line-width":Vn(5,7),"line-color":Yo(["get","kind"],u[3],"black"),"line-opacity":.8}},o[3]]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function NT(r){let e,t,o,l,u;function d(g){r[4](g)}let a={name:"Reachable network",$$slots:{default:[BT]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new no({props:a}),oi.push(()=>Vi(e,"show",d)),l=new Tn({props:{data:r[1],generateId:!0,$$slots:{default:[OT]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment)},m(g,v){Ne(e,g,v),te(g,o,v),Ne(l,g,v),u=!0},p(g,[v]){const k={};v&64&&(k.$$scope={dirty:v,ctx:g}),!t&&v&1&&(t=!0,k.show=g[0],$i(()=>t=!1)),e.$set(k);const S={};v&2&&(S.data=g[1]),v&65&&(S.$$scope={dirty:v,ctx:g}),l.$set(S)},i(g){u||(se(e.$$.fragment,g),se(l.$$.fragment,g),u=!0)},o(g){de(e.$$.fragment,g),de(l.$$.fragment,g),u=!1},d(g){g&&ee(o),je(e,g),je(l,g)}}}function jT(r,e,t){let o;yt(r,An,v=>t(5,o=v));let l=!1,u={type:"FeatureCollection",features:[]};async function d(){t(1,u=await o.renderReachableNetwork())}let a={network:"green",reachable:"purple",severance:"red"};function g(v){l=v,t(0,l)}return r.$$.update=()=>{r.$$.dirty&3&&l&&u.features.length==0&&d()},[l,u,d,a,g]}class UT extends Wt{constructor(e){super(),Gt(this,e,jT,NT,Vt,{})}}function $T(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z;return S=new nl({props:{colors:tm}}),{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),o=ie("label"),l=ie("input"),u=we(`
    Show original data`),d=Se(),a=ie("label"),g=ie("input"),v=we(`
    Show current derived data`),k=Se(),Ue(S.$$.fragment),Fe(e,"class","outline"),Fe(l,"type","checkbox"),Fe(g,"type","checkbox")},m(V,$){te(V,e,$),te(V,t,$),te(V,o,$),B(o,l),l.checked=r[3],B(o,u),te(V,d,$),te(V,a,$),B(a,g),g.checked=r[2],B(a,v),te(V,k,$),Ne(S,V,$),E=!0,P||(z=[wt(e,"click",r[4]),wt(l,"change",r[5]),wt(g,"change",r[6])],P=!0)},p(V,$){$&8&&(l.checked=V[3]),$&4&&(g.checked=V[2])},i(V){E||(se(S.$$.fragment,V),E=!0)},o(V){de(S.$$.fragment,V),E=!1},d(V){V&&(ee(e),ee(t),ee(o),ee(d),ee(a),ee(k)),je(S,V),P=!1,cn(z)}}}function VT(r){let e,t;const o=[Ri("los-debug"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Yo(["get","Level of Service"],{High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},"cyan"),"line-width":10}},{layout:{visibility:r[1]&&r[3]?"visible":"none"}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&10?pn(o,[o[0],o[1],o[2],{layout:{visibility:u[1]&&u[3]?"visible":"none"}}]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function qT(r){let e,t,o,l,u,d=r[9].los+"",a,g,v,k,S,E,P=mc[r[9].infra_type][0]+"",z,V,$,H,G,X,le=r[9].speed+"",xe,Ie,Y,K,ue,fe,ce=r[9].traffic.toLocaleString()+"",ae;return{c(){e=ie("table"),t=ie("tr"),o=ie("th"),o.textContent="Level of Service",l=Se(),u=ie("td"),a=we(d),g=Se(),v=ie("tr"),k=ie("th"),k.textContent="Infrastructure type",S=Se(),E=ie("td"),z=we(P),V=Se(),$=ie("tr"),H=ie("th"),H.textContent="Speed (mph)",G=Se(),X=ie("td"),xe=we(le),Ie=Se(),Y=ie("tr"),K=ie("th"),K.textContent="Estimated daily traffic volume",ue=Se(),fe=ie("td"),ae=we(ce)},m(Ge,Le){te(Ge,e,Le),B(e,t),B(t,o),B(t,l),B(t,u),B(u,a),B(e,g),B(e,v),B(v,k),B(v,S),B(v,E),B(E,z),B(e,V),B(e,$),B($,H),B($,G),B($,X),B(X,xe),B(e,Ie),B(e,Y),B(Y,K),B(Y,ue),B(Y,fe),B(fe,ae)},p(Ge,Le){Le&512&&d!==(d=Ge[9].los+"")&&dt(a,d),Le&512&&P!==(P=mc[Ge[9].infra_type][0]+"")&&dt(z,P),Le&512&&le!==(le=Ge[9].speed+"")&&dt(xe,le),Le&512&&ce!==(ce=Ge[9].traffic.toLocaleString()+"")&&dt(ae,ce)},d(Ge){Ge&&ee(e)}}}function ZT(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[qT,({props:o})=>({9:o}),({props:o})=>o?512:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&1536&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function GT(r){let e,t;const o=[Ri("los"),{layout:{visibility:r[1]&&r[2]?"visible":"none"}},{paint:{"line-width":Vn(5,7),"line-color":Op,"line-opacity":.8}},{manageHoverState:!0}];let l={$$slots:{default:[ZT]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&6?pn(o,[o[0],{layout:{visibility:u[1]&&u[2]?"visible":"none"}},o[2],o[3]]):{};d&1024&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function WT(r){let e,t,o,l,u,d,a;function g(k){r[7](k)}let v={name:"Level of Service",$$slots:{default:[$T]},$$scope:{ctx:r}};return r[1]!==void 0&&(v.show=r[1]),e=new no({props:v}),oi.push(()=>Vi(e,"show",g)),l=new kc({props:{url:`pmtiles://${rl("cbd.pmtiles")}`,$$slots:{default:[VT]},$$scope:{ctx:r}}}),d=new Tn({props:{data:r[0],generateId:!0,$$slots:{default:[GT]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment),u=Se(),Ue(d.$$.fragment)},m(k,S){Ne(e,k,S),te(k,o,S),Ne(l,k,S),te(k,u,S),Ne(d,k,S),a=!0},p(k,[S]){const E={};S&1036&&(E.$$scope={dirty:S,ctx:k}),!t&&S&2&&(t=!0,E.show=k[1],$i(()=>t=!1)),e.$set(E);const P={};S&1034&&(P.$$scope={dirty:S,ctx:k}),l.$set(P);const z={};S&1&&(z.data=k[0]),S&1030&&(z.$$scope={dirty:S,ctx:k}),d.$set(z)},i(k){a||(se(e.$$.fragment,k),se(l.$$.fragment,k),se(d.$$.fragment,k),a=!0)},o(k){de(e.$$.fragment,k),de(l.$$.fragment,k),de(d.$$.fragment,k),a=!1},d(k){k&&(ee(o),ee(u)),je(e,k),je(l,k),je(d,k)}}}function HT(r,e,t){let o;yt(r,An,E=>t(8,o=E));let l={type:"FeatureCollection",features:[]},u=!1,d=!1,a=!0;async function g(){o&&t(0,l=await o.renderLevelOfService())}function v(){d=this.checked,t(3,d)}function k(){a=this.checked,t(2,a)}function S(E){u=E,t(1,u)}return r.$$.update=()=>{r.$$.dirty&7&&u&&a&&l.features.length==0&&g()},[l,u,a,d,g,v,k,S]}class XT extends Wt{constructor(e){super(),Gt(this,e,HT,WT,Vt,{})}}function KT(r){let e,t,o,l,u,d,a,g,v,k,S,E;return e=new Qp({props:{colorScale:r[5],limits:r[6]}}),{c(){Ue(e.$$.fragment),t=Se(),o=ie("label"),l=ie("input"),u=we(`
    Show actual data`),d=Se(),a=ie("label"),g=ie("input"),v=we(`
    Show map-matched data`),Fe(l,"type","checkbox"),Fe(g,"type","checkbox")},m(P,z){Ne(e,P,z),te(P,t,z),te(P,o,z),B(o,l),l.checked=r[2],B(o,u),te(P,d,z),te(P,a,z),B(a,g),g.checked=r[3],B(a,v),k=!0,S||(E=[wt(l,"change",r[7]),wt(g,"change",r[8])],S=!0)},p(P,z){z&4&&(l.checked=P[2]),z&8&&(g.checked=P[3])},i(P){k||(se(e.$$.fragment,P),k=!0)},o(P){de(e.$$.fragment,P),k=!1},d(P){P&&(ee(t),ee(o),ee(d),ee(a)),je(e,P),S=!1,cn(E)}}}function JT(r){let e,t;const o=[Ri("traffic-debug"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Yo(["get","Traffic volume category"],{"0 to 1999":"#27918d","2000 to 3999":"#ffaa33","4000+":"#440154"},"cyan"),"line-width":5}},{layout:{visibility:r[0]&&r[2]?"visible":"none"}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&5?pn(o,[o[0],o[1],o[2],o[3],{layout:{visibility:u[0]&&u[2]?"visible":"none"}}]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function F0(r){let e,t,o,l={ctx:r,current:null,token:null,hasCatch:!1,pending:nI,then:QT,catch:YT,value:10,blocks:[,,,]};return Dr(t=r[4].renderLevelOfService(),l),{c(){e=tn(),l.block.c()},m(u,d){te(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,o=!0},p(u,d){r=u,l.ctx=r,d&16&&t!==(t=r[4].renderLevelOfService())&&Dr(t,l)||ba(l,r,d)},i(u){o||(se(l.block),o=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];de(a)}o=!1},d(u){u&&ee(e),l.block.d(u),l.token=null,l=null}}}function YT(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function QT(r){let e,t;return e=new Tn({props:{data:r[10],generateId:!0,$$slots:{default:[iI]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&16&&(u.data=o[10]),l&4105&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function eI(r){let e,t=r[11].traffic.toLocaleString()+"",o;return{c(){e=ie("p"),o=we(t)},m(l,u){te(l,e,u),B(e,o)},p(l,u){u&2048&&t!==(t=l[11].traffic.toLocaleString()+"")&&dt(o,t)},d(l){l&&ee(e)}}}function tI(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[eI,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function iI(r){let e,t;const o=[Ri("traffic"),{layout:{visibility:r[0]&&r[3]?"visible":"none"}},{paint:{"line-width":ha(["get","traffic"],r[6],[1,2,3]),"line-color":ha(["get","traffic"],r[6],r[5]),"line-opacity":.8}},{manageHoverState:!0}];let l={$$slots:{default:[tI]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&105?pn(o,[o[0],d&9&&{layout:{visibility:u[0]&&u[3]?"visible":"none"}},d&96&&{paint:{"line-width":ha(["get","traffic"],u[6],[1,2,3]),"line-color":ha(["get","traffic"],u[6],u[5]),"line-opacity":.8}},o[3]]):{};d&4096&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function nI(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function rI(r){let e,t,o,l,u,d,a;function g(S){r[9](S)}let v={name:"Estimated traffic volume",$$slots:{default:[KT]},$$scope:{ctx:r}};r[0]!==void 0&&(v.show=r[0]),e=new no({props:v}),oi.push(()=>Vi(e,"show",g)),l=new kc({props:{url:`pmtiles://${rl("cbd.pmtiles")}`,$$slots:{default:[JT]},$$scope:{ctx:r}}});let k=r[4]&&r[1]&&F0(r);return{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment),u=Se(),k&&k.c(),d=tn()},m(S,E){Ne(e,S,E),te(S,o,E),Ne(l,S,E),te(S,u,E),k&&k.m(S,E),te(S,d,E),a=!0},p(S,[E]){const P={};E&4108&&(P.$$scope={dirty:E,ctx:S}),!t&&E&1&&(t=!0,P.show=S[0],$i(()=>t=!1)),e.$set(P);const z={};E&4101&&(z.$$scope={dirty:E,ctx:S}),l.$set(z),S[4]&&S[1]?k?(k.p(S,E),E&18&&se(k,1)):(k=F0(S),k.c(),se(k,1),k.m(d.parentNode,d)):k&&(Li(),de(k,1,1,()=>{k=null}),Mi())},i(S){a||(se(e.$$.fragment,S),se(l.$$.fragment,S),se(k),a=!0)},o(S){de(e.$$.fragment,S),de(l.$$.fragment,S),de(k),a=!1},d(S){S&&(ee(o),ee(u),ee(d)),je(e,S),je(l,S),k&&k.d(S)}}}function oI(r,e,t){let o;yt(r,An,P=>t(4,o=P));let l=!1,u=!1,d=["#27918d","#ffaa33","#440154"],a=[0,2e3,4e3,1e4],g=!0,v=!0;function k(){g=this.checked,t(2,g)}function S(){v=this.checked,t(3,v)}function E(P){l=P,t(0,l)}return r.$$.update=()=>{r.$$.dirty&1&&l&&t(1,u=!0)},[l,u,g,v,o,d,a,k,S,E]}class sI extends Wt{constructor(e){super(),Gt(this,e,oI,rI,Vt,{})}}function B0(r){let e,t,o,l={ctx:r,current:null,token:null,hasCatch:!1,pending:dI,then:lI,catch:aI,value:4,blocks:[,,,]};return Dr(t=r[2].renderLevelOfService(),l),{c(){e=tn(),l.block.c()},m(u,d){te(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,o=!0},p(u,d){r=u,l.ctx=r,d&4&&t!==(t=r[2].renderLevelOfService())&&Dr(t,l)||ba(l,r,d)},i(u){o||(se(l.block),o=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];de(a)}o=!1},d(u){u&&ee(e),l.block.d(u),l.token=null,l=null}}}function aI(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function lI(r){let e,t;return e=new Tn({props:{data:r[4],generateId:!0,$$slots:{default:[hI]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&4&&(u.data=o[4]),l&65&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function cI(r){let e,t=r[5].gradient.toFixed(1)+"",o,l;return{c(){e=ie("p"),o=we(t),l=we("%")},m(u,d){te(u,e,d),B(e,o),B(e,l)},p(u,d){d&32&&t!==(t=u[5].gradient.toFixed(1)+"")&&dt(o,t)},d(u){u&&ee(e)}}}function uI(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[cI,({props:o})=>({5:o}),({props:o})=>o?32:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function hI(r){let e,t;const o=[Ri("gradients"),{layout:{visibility:r[0]?"visible":"none"}},{paint:{"line-width":Vn(3,5),"line-color":U1()}},{manageHoverState:!0}];let l={$$slots:{default:[uI]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&1?pn(o,[o[0],{layout:{visibility:u[0]?"visible":"none"}},o[2],o[3]]):{};d&64&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function dI(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function fI(r){let e,t,o,l,u;function d(v){r[3](v)}let a={name:"Gradient"};r[0]!==void 0&&(a.show=r[0]),e=new no({props:a}),oi.push(()=>Vi(e,"show",d));let g=r[2]&&r[1]&&B0(r);return{c(){Ue(e.$$.fragment),o=Se(),g&&g.c(),l=tn()},m(v,k){Ne(e,v,k),te(v,o,k),g&&g.m(v,k),te(v,l,k),u=!0},p(v,[k]){const S={};!t&&k&1&&(t=!0,S.show=v[0],$i(()=>t=!1)),e.$set(S),v[2]&&v[1]?g?(g.p(v,k),k&6&&se(g,1)):(g=B0(v),g.c(),se(g,1),g.m(l.parentNode,l)):g&&(Li(),de(g,1,1,()=>{g=null}),Mi())},i(v){u||(se(e.$$.fragment,v),se(g),u=!0)},o(v){de(e.$$.fragment,v),de(g),u=!1},d(v){v&&(ee(o),ee(l)),je(e,v),g&&g.d(v)}}}function pI(r,e,t){let o;yt(r,An,a=>t(2,o=a));let l=!1,u=!1;function d(a){l=a,t(0,l)}return r.$$.update=()=>{r.$$.dirty&1&&l&&t(1,u=!0)},[l,u,o,d]}class mI extends Wt{constructor(e){super(),Gt(this,e,pI,fI,Vt,{})}}function _I(r){let e,t,o,l,u,d=r[3].toLocaleString()+"",a,g,v=r[0].features.length.toLocaleString()+"",k,S,E=r[2].toLocaleString()+"",P,z,V=r[4].toLocaleString()+"",$,H,G=Xn(r[2],r[4])+"",X,le,xe,Ie,Y,K,ue,fe,ce;return Ie=new Qp({props:{colorScale:r[6],limits:r[7]}}),{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),o=ie("p"),o.textContent="Only the top 20%ile most deprived zones are shown",l=Se(),u=ie("p"),a=we(d),g=we(" / "),k=we(v),S=we(` zones
    reachable. That's `),P=we(E),z=we(" / "),$=we(V),H=we(`
    (`),X=we(G),le=we(") of the population."),xe=Se(),Ue(Ie.$$.fragment),Y=Se(),K=ie("p"),K.textContent=`Darker colours are more deprived. Zones with a red outline are not reachable
    by the current network.`,Fe(e,"class","outline")},m(ae,Ge){te(ae,e,Ge),te(ae,t,Ge),te(ae,o,Ge),te(ae,l,Ge),te(ae,u,Ge),B(u,a),B(u,g),B(u,k),B(u,S),B(u,P),B(u,z),B(u,$),B(u,H),B(u,X),B(u,le),te(ae,xe,Ge),Ne(Ie,ae,Ge),te(ae,Y,Ge),te(ae,K,Ge),ue=!0,fe||(ce=wt(e,"click",r[5]),fe=!0)},p(ae,Ge){(!ue||Ge&8)&&d!==(d=ae[3].toLocaleString()+"")&&dt(a,d),(!ue||Ge&1)&&v!==(v=ae[0].features.length.toLocaleString()+"")&&dt(k,v),(!ue||Ge&4)&&E!==(E=ae[2].toLocaleString()+"")&&dt(P,E),(!ue||Ge&16)&&V!==(V=ae[4].toLocaleString()+"")&&dt($,V),(!ue||Ge&20)&&G!==(G=Xn(ae[2],ae[4])+"")&&dt(X,G)},i(ae){ue||(se(Ie.$$.fragment,ae),ue=!0)},o(ae){de(Ie.$$.fragment,ae),ue=!1},d(ae){ae&&(ee(e),ee(t),ee(o),ee(l),ee(u),ee(xe),ee(Y),ee(K)),je(Ie,ae),fe=!1,ce()}}}function gI(r){let e,t,o=r[10].id+"",l,u,d=r[10].reachable?"is":"is not",a,g,v=r[10].population.toLocaleString()+"",k,S,E=r[10].imd_rank+"",P,z,V=r[10].imd_percentile+"",$,H;return{c(){e=ie("p"),t=we("Data zone "),l=we(o),u=Se(),a=we(d),g=we(" reachable. It has "),k=we(v),S=we(`
        people, and a SIMD rank of `),P=we(E),z=we(", putting it in the "),$=we(V),H=we(`
        percentile.`)},m(G,X){te(G,e,X),B(e,t),B(e,l),B(e,u),B(e,a),B(e,g),B(e,k),B(e,S),B(e,P),B(e,z),B(e,$),B(e,H)},p(G,X){X&1024&&o!==(o=G[10].id+"")&&dt(l,o),X&1024&&d!==(d=G[10].reachable?"is":"is not")&&dt(a,d),X&1024&&v!==(v=G[10].population.toLocaleString()+"")&&dt(k,v),X&1024&&E!==(E=G[10].imd_rank+"")&&dt(P,E),X&1024&&V!==(V=G[10].imd_percentile+"")&&dt($,V)},d(G){G&&ee(e)}}}function yI(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[gI,({props:o})=>({10:o}),({props:o})=>o?1024:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&3072&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function bI(r){let e,t,o,l;const u=[Ri("simd"),{manageHoverState:!0},{paint:{"fill-color":ha(["get","imd_percentile"],r[7],r[6]),"fill-opacity":Vn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let d={$$slots:{default:[yI]},$$scope:{ctx:r}};for(let v=0;v<u.length;v+=1)d=Di(d,u[v]);e=new xc({props:d});const a=[Ri("simd-outline"),{filter:["!",["get","reachable"]]},{paint:{"line-color":"red","line-width":3}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let v=0;v<a.length;v+=1)g=Di(g,a[v]);return o=new mn({props:g}),{c(){Ue(e.$$.fragment),t=Se(),Ue(o.$$.fragment)},m(v,k){Ne(e,v,k),te(v,t,k),Ne(o,v,k),l=!0},p(v,k){const S=k&194?pn(u,[u[0],u[1],k&192&&{paint:{"fill-color":ha(["get","imd_percentile"],v[7],v[6]),"fill-opacity":Vn(.7,.9)}},k&2&&{layout:{visibility:v[1]?"visible":"none"}}]):{};k&2048&&(S.$$scope={dirty:k,ctx:v}),e.$set(S);const E=k&2?pn(a,[a[0],a[1],a[2],{layout:{visibility:v[1]?"visible":"none"}}]):{};o.$set(E)},i(v){l||(se(e.$$.fragment,v),se(o.$$.fragment,v),l=!0)},o(v){de(e.$$.fragment,v),de(o.$$.fragment,v),l=!1},d(v){v&&ee(t),je(e,v),je(o,v)}}}function vI(r){let e,t,o,l,u;function d(g){r[8](g)}let a={name:"SIMD",$$slots:{default:[_I]},$$scope:{ctx:r}};return r[1]!==void 0&&(a.show=r[1]),e=new no({props:a}),oi.push(()=>Vi(e,"show",d)),l=new Tn({props:{data:r[0],generateId:!0,$$slots:{default:[bI]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment)},m(g,v){Ne(e,g,v),te(g,o,v),Ne(l,g,v),u=!0},p(g,[v]){const k={};v&2077&&(k.$$scope={dirty:v,ctx:g}),!t&&v&2&&(t=!0,k.show=g[1],$i(()=>t=!1)),e.$set(k);const S={};v&1&&(S.data=g[0]),v&2050&&(S.$$scope={dirty:v,ctx:g}),l.$set(S)},i(g){u||(se(e.$$.fragment,g),se(l.$$.fragment,g),u=!0)},o(g){de(e.$$.fragment,g),de(l.$$.fragment,g),u=!1},d(g){g&&ee(o),je(e,g),je(l,g)}}}function wI(r,e,t){let o,l,u,d,a;yt(r,Bd,P=>t(1,d=P)),yt(r,An,P=>t(9,a=P));let g={type:"FeatureCollection",features:[]};async function v(){if(a){let P=await a.getDataZones();P.features=P.features.filter(z=>z.properties.imd_percentile<=20),t(0,g=P)}}let k=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],S=[0,4,8,12,16,20];function E(P){d=P,Bd.set(d)}return r.$$.update=()=>{r.$$.dirty&3&&d&&g.features.length==0&&v(),r.$$.dirty&1&&t(4,o=Ud(g.features.map(P=>P.properties.population))),r.$$.dirty&1&&t(3,l=g.features.filter(P=>P.properties.reachable).length),r.$$.dirty&1&&t(2,u=Ud(g.features.filter(P=>P.properties.reachable).map(P=>P.properties.population)))},[g,d,u,l,o,v,k,S,E]}class xI extends Wt{constructor(e){super(),Gt(this,e,wI,vI,Vt,{})}}function kI(r){let e,t,o,l=r[3].toLocaleString()+"",u,d,a=r[0].features.length.toLocaleString()+"",g,v,k=r[2].toLocaleString()+"",S,E,P=r[4].toLocaleString()+"",z,V,$=Xn(r[2],r[4])+"",H,G,X,le,xe,Ie,Y,K,ue;return le=new Qp({props:{colorScale:r[6],limits:r[7]}}),{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),o=ie("p"),u=we(l),d=we(" / "),g=we(a),v=we(` zones
    reachable. That's `),S=we(k),E=we(" / "),z=we(P),V=we(`
    (`),H=we($),G=we(") of the population."),X=Se(),Ue(le.$$.fragment),xe=Se(),Ie=ie("p"),Ie.textContent=`Darker colours are denser. Zones with a red outline are not reachable by the
    current network. Only the top 3 densest quintiles are shown.`,Fe(e,"class","outline")},m(fe,ce){te(fe,e,ce),te(fe,t,ce),te(fe,o,ce),B(o,u),B(o,d),B(o,g),B(o,v),B(o,S),B(o,E),B(o,z),B(o,V),B(o,H),B(o,G),te(fe,X,ce),Ne(le,fe,ce),te(fe,xe,ce),te(fe,Ie,ce),Y=!0,K||(ue=wt(e,"click",r[5]),K=!0)},p(fe,ce){(!Y||ce&8)&&l!==(l=fe[3].toLocaleString()+"")&&dt(u,l),(!Y||ce&1)&&a!==(a=fe[0].features.length.toLocaleString()+"")&&dt(g,a),(!Y||ce&4)&&k!==(k=fe[2].toLocaleString()+"")&&dt(S,k),(!Y||ce&16)&&P!==(P=fe[4].toLocaleString()+"")&&dt(z,P),(!Y||ce&20)&&$!==($=Xn(fe[2],fe[4])+"")&&dt(H,$)},i(fe){Y||(se(le.$$.fragment,fe),Y=!0)},o(fe){de(le.$$.fragment,fe),Y=!1},d(fe){fe&&(ee(e),ee(t),ee(o),ee(X),ee(xe),ee(Ie)),je(le,fe),K=!1,ue()}}}function SI(r){let e,t,o=r[11].id+"",l,u,d=r[11].reachable?"is":"is not",a,g,v=r[11].population.toLocaleString()+"",k,S,E=Math.round(r[11].population/r[11].area_km2).toLocaleString()+"",P,z,V=r[11].density_quintile+"",$,H;return{c(){e=ie("p"),t=we("Data zone "),l=we(o),u=Se(),a=we(d),g=we(" reachable. It has "),k=we(v),S=we(`
        people, with a density of `),P=we(E),z=we(" people per square kilometer, putting it in quintile "),$=we(V),H=we(`
        for this study area.`),ui(e,"max-width","30vw")},m(G,X){te(G,e,X),B(e,t),B(e,l),B(e,u),B(e,a),B(e,g),B(e,k),B(e,S),B(e,P),B(e,z),B(e,$),B(e,H)},p(G,X){X&2048&&o!==(o=G[11].id+"")&&dt(l,o),X&2048&&d!==(d=G[11].reachable?"is":"is not")&&dt(a,d),X&2048&&v!==(v=G[11].population.toLocaleString()+"")&&dt(k,v),X&2048&&E!==(E=Math.round(G[11].population/G[11].area_km2).toLocaleString()+"")&&dt(P,E),X&2048&&V!==(V=G[11].density_quintile+"")&&dt($,V)},d(G){G&&ee(e)}}}function TI(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[SI,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function II(r){let e,t,o,l;const u=[Ri("all-population"),{manageHoverState:!0},{paint:{"fill-color":ha(["get","density_quintile"],r[7],r[6]),"fill-opacity":r[8]}},{layout:{visibility:r[1]?"visible":"none"}}];let d={$$slots:{default:[TI]},$$scope:{ctx:r}};for(let v=0;v<u.length;v+=1)d=Di(d,u[v]);e=new xc({props:d});const a=[Ri("all-population-outline"),{filter:["!",["get","reachable"]]},{paint:{"line-color":"red","line-width":3}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let v=0;v<a.length;v+=1)g=Di(g,a[v]);return o=new mn({props:g}),{c(){Ue(e.$$.fragment),t=Se(),Ue(o.$$.fragment)},m(v,k){Ne(e,v,k),te(v,t,k),Ne(o,v,k),l=!0},p(v,k){const S=k&450?pn(u,[u[0],u[1],k&448&&{paint:{"fill-color":ha(["get","density_quintile"],v[7],v[6]),"fill-opacity":v[8]}},k&2&&{layout:{visibility:v[1]?"visible":"none"}}]):{};k&4096&&(S.$$scope={dirty:k,ctx:v}),e.$set(S);const E=k&2?pn(a,[a[0],a[1],a[2],{layout:{visibility:v[1]?"visible":"none"}}]):{};o.$set(E)},i(v){l||(se(e.$$.fragment,v),se(o.$$.fragment,v),l=!0)},o(v){de(e.$$.fragment,v),de(o.$$.fragment,v),l=!1},d(v){v&&ee(t),je(e,v),je(o,v)}}}function CI(r){let e,t,o,l,u;function d(g){r[9](g)}let a={name:"Population",$$slots:{default:[kI]},$$scope:{ctx:r}};return r[1]!==void 0&&(a.show=r[1]),e=new no({props:a}),oi.push(()=>Vi(e,"show",d)),l=new Tn({props:{data:r[0],generateId:!0,$$slots:{default:[II]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment)},m(g,v){Ne(e,g,v),te(g,o,v),Ne(l,g,v),u=!0},p(g,[v]){const k={};v&4125&&(k.$$scope={dirty:v,ctx:g}),!t&&v&2&&(t=!0,k.show=g[1],$i(()=>t=!1)),e.$set(k);const S={};v&1&&(S.data=g[0]),v&4098&&(S.$$scope={dirty:v,ctx:g}),l.$set(S)},i(g){u||(se(e.$$.fragment,g),se(l.$$.fragment,g),u=!0)},o(g){de(e.$$.fragment,g),de(l.$$.fragment,g),u=!1},d(g){g&&ee(o),je(e,g),je(l,g)}}}function EI(r,e,t){let o,l,u,d,a;yt(r,Od,z=>t(1,d=z)),yt(r,An,z=>t(10,a=z));let g={type:"FeatureCollection",features:[]};async function v(){a&&t(0,g=await a.getDataZones())}let k=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],S=[0,1,2,3,4,5],E=Vn(["case",["<",["get","density_quintile"],4],.5,0],.9);function P(z){d=z,Od.set(d)}return r.$$.update=()=>{r.$$.dirty&3&&d&&g.features.length==0&&v(),r.$$.dirty&1&&t(4,o=Ud(g.features.map(z=>z.properties.population))),r.$$.dirty&1&&t(3,l=g.features.filter(z=>z.properties.reachable).length),r.$$.dirty&1&&t(2,u=Ud(g.features.filter(z=>z.properties.reachable).map(z=>z.properties.population)))},[g,d,u,l,o,v,k,S,E,P]}class LI extends Wt{constructor(e){super(),Gt(this,e,EI,CI,Vt,{})}}function O0(r){let e,t,o,l,u,d=Xn(r[0].covered_quintile_sums[0],r[0].total_quintile_sums[0])+"",a,g,v,k,S=Xn(r[0].covered_quintile_sums[1],r[0].total_quintile_sums[1])+"",E,P,z,V,$=Xn(r[0].covered_quintile_sums[2],r[0].total_quintile_sums[2])+"",H,G,X,le,xe=Xn(r[0].covered_quintile_sums[3],r[0].total_quintile_sums[3])+"",Ie,Y,K,ue,fe=Xn(r[0].covered_quintile_sums[4],r[0].total_quintile_sums[4])+"",ce;return{c(){e=ie("p"),e.textContent="Flow covered by current edits",t=Se(),o=ie("ul"),l=ie("li"),u=we("Quintile 1: "),a=we(d),g=Se(),v=ie("li"),k=we("Quintile 2: "),E=we(S),P=Se(),z=ie("li"),V=we("Quintile 3: "),H=we($),G=Se(),X=ie("li"),le=we("Quintile 4: "),Ie=we(xe),Y=Se(),K=ie("li"),ue=we("Quintile 5: "),ce=we(fe)},m(ae,Ge){te(ae,e,Ge),te(ae,t,Ge),te(ae,o,Ge),B(o,l),B(l,u),B(l,a),B(o,g),B(o,v),B(v,k),B(v,E),B(o,P),B(o,z),B(z,V),B(z,H),B(o,G),B(o,X),B(X,le),B(X,Ie),B(o,Y),B(o,K),B(K,ue),B(K,ce)},p(ae,Ge){Ge&1&&d!==(d=Xn(ae[0].covered_quintile_sums[0],ae[0].total_quintile_sums[0])+"")&&dt(a,d),Ge&1&&S!==(S=Xn(ae[0].covered_quintile_sums[1],ae[0].total_quintile_sums[1])+"")&&dt(E,S),Ge&1&&$!==($=Xn(ae[0].covered_quintile_sums[2],ae[0].total_quintile_sums[2])+"")&&dt(H,$),Ge&1&&xe!==(xe=Xn(ae[0].covered_quintile_sums[3],ae[0].total_quintile_sums[3])+"")&&dt(Ie,xe),Ge&1&&fe!==(fe=Xn(ae[0].covered_quintile_sums[4],ae[0].total_quintile_sums[4])+"")&&dt(ce,fe)},d(ae){ae&&(ee(e),ee(t),ee(o))}}}function MI(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le=r[0].total_quintile_sums.length>0&&O0(r);return{c(){e=ie("button"),e.textContent="Recalculate",t=Se(),o=ie("label"),l=ie("input"),u=we(`
    Only show routes covered by current edits`),d=Se(),a=ie("label"),g=we(`Only show quintile:
    `),v=ie("select"),k=ie("option"),k.textContent="Show all",S=ie("option"),S.textContent="1",E=ie("option"),E.textContent="2",P=ie("option"),P.textContent="3",z=ie("option"),z.textContent="4",V=ie("option"),V.textContent="5",$=Se(),le&&le.c(),H=tn(),Fe(e,"class","outline"),Fe(l,"type","checkbox"),k.__value="",Gi(k,k.__value),S.__value="1",Gi(S,S.__value),E.__value="2",Gi(E,E.__value),P.__value="3",Gi(P,P.__value),z.__value="4",Gi(z,z.__value),V.__value="5",Gi(V,V.__value),r[3]===void 0&&Mo(()=>r[6].call(v))},m(xe,Ie){te(xe,e,Ie),te(xe,t,Ie),te(xe,o,Ie),B(o,l),l.checked=r[2],B(o,u),te(xe,d,Ie),te(xe,a,Ie),B(a,g),B(a,v),B(v,k),B(v,S),B(v,E),B(v,P),B(v,z),B(v,V),hr(v,r[3],!0),te(xe,$,Ie),le&&le.m(xe,Ie),te(xe,H,Ie),G||(X=[wt(e,"click",r[4]),wt(l,"change",r[5]),wt(v,"change",r[6])],G=!0)},p(xe,Ie){Ie&4&&(l.checked=xe[2]),Ie&8&&hr(v,xe[3]),xe[0].total_quintile_sums.length>0?le?le.p(xe,Ie):(le=O0(xe),le.c(),le.m(H.parentNode,H)):le&&(le.d(1),le=null)},d(xe){xe&&(ee(e),ee(t),ee(o),ee(d),ee(a),ee($),ee(H)),le&&le.d(xe),G=!1,cn(X)}}}function AI(r){let e,t=r[9].flow.toLocaleString()+"",o,l,u=r[9].quintile+"",d,a,g=r[9].covered+"",v;return{c(){e=we("Flow "),o=we(t),l=we(" is in quintile "),d=we(u),a=we(`,
      covered `),v=we(g)},m(k,S){te(k,e,S),te(k,o,S),te(k,l,S),te(k,d,S),te(k,a,S),te(k,v,S)},p(k,S){S&512&&t!==(t=k[9].flow.toLocaleString()+"")&&dt(o,t),S&512&&u!==(u=k[9].quintile+"")&&dt(d,u),S&512&&g!==(g=k[9].covered+"")&&dt(v,g)},d(k){k&&(ee(e),ee(o),ee(l),ee(d),ee(a),ee(v))}}}function PI(r){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[AI,({props:o})=>({9:o}),({props:o})=>o?512:0]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&1536&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function zI(r){let e,t;const o=[Ri("npt-coverage"),{layout:{visibility:r[1]?"visible":"none"}},{filter:N0(r[2],r[3])},{paint:{"line-width":$d("flow"),"line-color":im("flow")}}];let l={$$slots:{default:[PI]},$$scope:{ctx:r}};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new mn({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&14?pn(o,[o[0],d&2&&{layout:{visibility:u[1]?"visible":"none"}},d&12&&{filter:N0(u[2],u[3])},o[3]]):{};d&1024&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function DI(r){let e,t,o,l,u;function d(g){r[7](g)}let a={name:"High NPT route coverage",$$slots:{default:[MI]},$$scope:{ctx:r}};return r[1]!==void 0&&(a.show=r[1]),e=new no({props:a}),oi.push(()=>Vi(e,"show",d)),l=new Tn({props:{data:r[0],$$slots:{default:[zI]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment),o=Se(),Ue(l.$$.fragment)},m(g,v){Ne(e,g,v),te(g,o,v),Ne(l,g,v),u=!0},p(g,[v]){const k={};v&1037&&(k.$$scope={dirty:v,ctx:g}),!t&&v&2&&(t=!0,k.show=g[1],$i(()=>t=!1)),e.$set(k);const S={};v&1&&(S.data=g[0]),v&1038&&(S.$$scope={dirty:v,ctx:g}),l.$set(S)},i(g){u||(se(e.$$.fragment,g),se(l.$$.fragment,g),u=!0)},o(g){de(e.$$.fragment,g),de(l.$$.fragment,g),u=!1},d(g){g&&ee(o),je(e,g),je(l,g)}}}function N0(r,e){let t=["all"];return r&&t.push(["get","covered"]),e.length>0&&t.push(["==",["get","quintile"],parseInt(e)]),t}function RI(r,e,t){let o,l;yt(r,cc,E=>t(1,o=E)),yt(r,An,E=>t(8,l=E));let u=!1,d="",a={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function g(){l&&t(0,a=await l.renderPrecalculatedFlows())}function v(){u=this.checked,t(2,u)}function k(){d=ws(this),t(3,d)}function S(E){o=E,cc.set(o)}return r.$$.update=()=>{r.$$.dirty&3&&o&&a.features.length==0&&g()},[a,o,u,d,g,v,k,S]}class FI extends Wt{constructor(e){super(),Gt(this,e,RI,DI,Vt,{})}}function BI(r){let e,t;const o=[Ri("major-junctions"),{paint:{"circle-color":"purple","circle-radius":5}},{layout:{visibility:r[1]&&r[2].kind=="edit-route"?"visible":"none"}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new Yp({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a=d&6?pn(o,[o[0],o[1],{layout:{visibility:u[1]&&u[2].kind=="edit-route"?"visible":"none"}}]):{};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function OI(r){let e,t;return e=new Tn({props:{data:r[0],$$slots:{default:[BI]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,[l]){const u={};l&1&&(u.data=o[0]),l&38&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function NI(r,e,t){let o,l,u;yt(r,Fp,g=>t(1,o=g)),yt(r,An,g=>t(3,l=g)),yt(r,hn,g=>t(2,u=g));let d={type:"FeatureCollection",features:[]};async function a(){l&&t(0,d=await l.getMajorJunctions())}return r.$$.update=()=>{r.$$.dirty&3&&o&&d.features.length==0&&a()},[d,o,u]}class jI extends Wt{constructor(e){super(),Gt(this,e,NI,OI,Vt,{})}}function UI(r){let e,t,o,l,u,d,a,g,v,k,S,E,P,z,V,$,H,G,X,le,xe,Ie,Y,K,ue,fe,ce,ae,Ge,Le;return e=new q5({}),o=new J5({}),u=new FI({}),a=new lT({}),v=new yT({}),S=new TT({}),P=new PT({}),V=new FT({}),H=new XT({}),X=new sI({}),xe=new mI({}),Y=new UT({}),ue=new xI({}),ce=new LI({}),Ge=new jI({}),{c(){Ue(e.$$.fragment),t=Se(),Ue(o.$$.fragment),l=Se(),Ue(u.$$.fragment),d=Se(),Ue(a.$$.fragment),g=Se(),Ue(v.$$.fragment),k=Se(),Ue(S.$$.fragment),E=Se(),Ue(P.$$.fragment),z=Se(),Ue(V.$$.fragment),$=Se(),Ue(H.$$.fragment),G=Se(),Ue(X.$$.fragment),le=Se(),Ue(xe.$$.fragment),Ie=Se(),Ue(Y.$$.fragment),K=Se(),Ue(ue.$$.fragment),fe=Se(),Ue(ce.$$.fragment),ae=Se(),Ue(Ge.$$.fragment)},m(Pe,rt){Ne(e,Pe,rt),te(Pe,t,rt),Ne(o,Pe,rt),te(Pe,l,rt),Ne(u,Pe,rt),te(Pe,d,rt),Ne(a,Pe,rt),te(Pe,g,rt),Ne(v,Pe,rt),te(Pe,k,rt),Ne(S,Pe,rt),te(Pe,E,rt),Ne(P,Pe,rt),te(Pe,z,rt),Ne(V,Pe,rt),te(Pe,$,rt),Ne(H,Pe,rt),te(Pe,G,rt),Ne(X,Pe,rt),te(Pe,le,rt),Ne(xe,Pe,rt),te(Pe,Ie,rt),Ne(Y,Pe,rt),te(Pe,K,rt),Ne(ue,Pe,rt),te(Pe,fe,rt),Ne(ce,Pe,rt),te(Pe,ae,rt),Ne(Ge,Pe,rt),Le=!0},p:We,i(Pe){Le||(se(e.$$.fragment,Pe),se(o.$$.fragment,Pe),se(u.$$.fragment,Pe),se(a.$$.fragment,Pe),se(v.$$.fragment,Pe),se(S.$$.fragment,Pe),se(P.$$.fragment,Pe),se(V.$$.fragment,Pe),se(H.$$.fragment,Pe),se(X.$$.fragment,Pe),se(xe.$$.fragment,Pe),se(Y.$$.fragment,Pe),se(ue.$$.fragment,Pe),se(ce.$$.fragment,Pe),se(Ge.$$.fragment,Pe),Le=!0)},o(Pe){de(e.$$.fragment,Pe),de(o.$$.fragment,Pe),de(u.$$.fragment,Pe),de(a.$$.fragment,Pe),de(v.$$.fragment,Pe),de(S.$$.fragment,Pe),de(P.$$.fragment,Pe),de(V.$$.fragment,Pe),de(H.$$.fragment,Pe),de(X.$$.fragment,Pe),de(xe.$$.fragment,Pe),de(Y.$$.fragment,Pe),de(ue.$$.fragment,Pe),de(ce.$$.fragment,Pe),de(Ge.$$.fragment,Pe),Le=!1},d(Pe){Pe&&(ee(t),ee(l),ee(d),ee(g),ee(k),ee(E),ee(z),ee($),ee(G),ee(le),ee(Ie),ee(K),ee(fe),ee(ae)),je(e,Pe),je(o,Pe),je(u,Pe),je(a,Pe),je(v,Pe),je(S,Pe),je(P,Pe),je(V,Pe),je(H,Pe),je(X,Pe),je(xe,Pe),je(Y,Pe),je(ue,Pe),je(ce,Pe),je(Ge,Pe)}}}class $I extends Wt{constructor(e){super(),Gt(this,e,null,UI,Vt,{})}}function VI(r){let e,t,o;return t=new E5({}),{c(){e=ie("div"),Ue(t.$$.fragment),Fe(e,"slot","top")},m(l,u){te(l,e,u),Ne(t,e,null),o=!0},p:We,i(l){o||(se(t.$$.fragment,l),o=!0)},o(l){de(t.$$.fragment,l),o=!1},d(l){l&&ee(e),je(t)}}}function qI(r){let e,t;return{c(){e=ie("div"),t=ie("div"),Fe(e,"slot","left")},m(o,l){te(o,e,l),B(e,t),r[15](t)},p:We,d(o){o&&ee(e),r[15](null)}}}function ZI(r){let e,t;return e=new P2({props:{map:r[0],apiKey:R1,country:"gb"}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&1&&(u.map=o[0]),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function j0(r){let e,t,o,l,u,d,a,g,v={ctx:r,current:null,token:null,hasCatch:!1,pending:XI,then:WI,catch:GI,value:21,blocks:[,,,]};Dr(e=r[5].getInvertedBoundary(),v),o=new $I({});const k=[tC,eC,QI,YI,JI,KI],S=[];function E(P,z){return P[7].kind=="main"?0:P[7].kind=="edit-route"&&P[0]?1:P[7].kind=="evaluate-route"?2:P[7].kind=="evaluate-od"?3:P[7].kind=="debug-network"?4:P[7].kind=="debug-mesh-density"?5:-1}return~(u=E(r))&&(d=S[u]=k[u](r)),{c(){v.block.c(),t=Se(),Ue(o.$$.fragment),l=Se(),d&&d.c(),a=tn()},m(P,z){v.block.m(P,v.anchor=z),v.mount=()=>t.parentNode,v.anchor=t,te(P,t,z),Ne(o,P,z),te(P,l,z),~u&&S[u].m(P,z),te(P,a,z),g=!0},p(P,z){r=P,v.ctx=r,z&32&&e!==(e=r[5].getInvertedBoundary())&&Dr(e,v)||ba(v,r,z);let V=u;u=E(r),u===V?~u&&S[u].p(r,z):(d&&(Li(),de(S[V],1,1,()=>{S[V]=null}),Mi()),~u?(d=S[u],d?d.p(r,z):(d=S[u]=k[u](r),d.c()),se(d,1),d.m(a.parentNode,a)):d=null)},i(P){g||(se(v.block),se(o.$$.fragment,P),se(d),g=!0)},o(P){for(let z=0;z<3;z+=1){const V=v.blocks[z];de(V)}de(o.$$.fragment,P),de(d),g=!1},d(P){P&&(ee(t),ee(l),ee(a)),v.block.d(P),v.token=null,v=null,je(o,P),~u&&S[u].d(P)}}}function GI(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function WI(r){let e,t;return e=new Tn({props:{data:r[21],$$slots:{default:[HI]},$$scope:{ctx:r}}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&32&&(u.data=o[21]),l&4194304&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function HI(r){let e,t;const o=[Ri("fade-study-area"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<o.length;u+=1)l=Di(l,o[u]);return e=new xc({props:l}),{c(){Ue(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(se(e.$$.fragment,u),t=!0)},o(u){de(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function XI(r){return{c:We,m:We,p:We,i:We,o:We,d:We}}function KI(r){let e,t;return e=new Ak({}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p:We,i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function JI(r){let e,t;return e=new xk({}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p:We,i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function YI(r){let e,t;return e=new v5({}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p:We,i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function QI(r){let e,t;return e=new d5({props:{prevMode:r[7].prevMode,browse:r[7].browse}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&128&&(u.prevMode=o[7].prevMode),l&128&&(u.browse=o[7].browse),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function eC(r){let e,t;return e=new HS({props:{id:r[7].id,map:r[0]}}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p(o,l){const u={};l&128&&(u.id=o[7].id),l&1&&(u.map=o[0]),e.$set(u)},i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function tC(r){let e,t;return e=new iS({}),{c(){Ue(e.$$.fragment)},m(o,l){Ne(e,o,l),t=!0},p:We,i(o){t||(se(e.$$.fragment,o),t=!0)},o(o){de(e.$$.fragment,o),t=!1},d(o){je(e,o)}}}function iC(r){let e,t,o,l,u,d,a,g=ZI(r);t=new cS({});let v=r[5]&&j0(r);return{c(){g&&g.c(),e=Se(),Ue(t.$$.fragment),o=Se(),l=ie("div"),u=Se(),v&&v.c(),d=tn()},m(k,S){g&&g.m(k,S),te(k,e,S),Ne(t,k,S),te(k,o,S),te(k,l,S),r[12](l),te(k,u,S),v&&v.m(k,S),te(k,d,S),a=!0},p(k,S){g.p(k,S),k[5]?v?(v.p(k,S),S&32&&se(v,1)):(v=j0(k),v.c(),se(v,1),v.m(d.parentNode,d)):v&&(Li(),de(v,1,1,()=>{v=null}),Mi())},i(k){a||(se(g),se(t.$$.fragment,k),se(v),a=!0)},o(k){de(g),de(t.$$.fragment,k),de(v),a=!1},d(k){k&&(ee(e),ee(o),ee(l),ee(u),ee(d)),g&&g.d(k),je(t,k),r[12](null),v&&v.d(k)}}}function nC(r){let e,t,o,l;function u(a){r[13](a)}let d={style:`https://api.maptiler.com/maps/streets-v2/style.json?key=${R1}`,standardControls:!0,$$slots:{default:[iC]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.map=r[0]),t=new _4({props:d}),oi.push(()=>Vi(t,"map",u)),t.$on("error",r[14]),{c(){e=ie("div"),Ue(t.$$.fragment),Fe(e,"slot","main"),ui(e,"position","relative"),ui(e,"width","100%"),ui(e,"height","100%")},m(a,g){te(a,e,g),Ne(t,e,null),l=!0},p(a,g){const v={};g&4194469&&(v.$$scope={dirty:g,ctx:a}),!o&&g&1&&(o=!0,v.map=a[0],$i(()=>o=!1)),t.$set(v)},i(a){l||(se(t.$$.fragment,a),l=!0)},o(a){de(t.$$.fragment,a),l=!1},d(a){a&&ee(e),je(t)}}}function rC(r){let e,t;return{c(){e=ie("div"),t=ie("div"),Fe(e,"slot","right")},m(o,l){te(o,e,l),B(e,t),r[11](t)},p:We,d(o){o&&ee(e),r[11](null)}}}function oC(r){let e,t,o,l,u,d;return document.title=e="Network Planning Workspace - "+r[6],o=new O4({props:{loading:r[4]}}),u=new L4({props:{$$slots:{right:[rC],main:[nC],left:[qI],top:[VI]},$$scope:{ctx:r}}}),{c(){t=Se(),Ue(o.$$.fragment),l=Se(),Ue(u.$$.fragment)},m(a,g){te(a,t,g),Ne(o,a,g),te(a,l,g),Ne(u,a,g),d=!0},p(a,[g]){(!d||g&64)&&e!==(e="Network Planning Workspace - "+a[6])&&(document.title=e);const v={};g&16&&(v.loading=a[4]),o.$set(v);const k={};g&4194479&&(k.$$scope={dirty:g,ctx:a}),u.$set(k)},i(a){d||(se(o.$$.fragment,a),se(u.$$.fragment,a),d=!0)},o(a){de(o.$$.fragment,a),de(u.$$.fragment,a),d=!1},d(a){a&&(ee(t),ee(l)),je(o,a),je(u,a)}}}function bd(r,e,t){return e+r*(t-e)}function sC(r,e,t){let o,l,u,d,a,g,v,k,S,E;yt(r,Mp,K=>t(8,o=K)),yt(r,Ap,K=>t(9,l=K)),yt(r,Lp,K=>t(10,u=K)),yt(r,An,K=>t(5,d=K)),yt(r,jd,K=>t(16,a=K)),yt(r,il,K=>t(17,g=K)),yt(r,da,K=>t(18,v=K)),yt(r,zd,K=>t(6,k=K)),yt(r,Dp,K=>t(19,S=K)),yt(r,hn,K=>t(7,E=K));let P="",z;yc(async()=>{await j1();let K=new URLSearchParams(window.location.search);si(zd,k=K.get("boundary")||"LAD_City of Edinburgh",k),t(4,P=`Loading ${k}`);let ue=new uk,fe=await fetch(`areas/${k}.bin`);fe.ok?(console.log("Using locally hosted files"),si(Dp,S=!1,S)):(console.log("Using remote hosted files"),fe=await fetch(rl(`areas/${k}.bin`)));let ce=await fe.arrayBuffer();try{await ue.loadFile(new Uint8Array(ce))}catch(Le){window.alert(`Couldn't load: ${Le}`)}let ae=window.localStorage.getItem(`tmp-npt-editor/${k}`);if(ae)try{await ue.loadSavefile(ae)}catch(Le){window.alert(`Couldn't restore saved state: ${Le}`)}t(4,P="");let Ge=await ue.getBounds();si(da,v={lng:bd(.4,Ge[0],Ge[2]),lat:bd(.4,Ge[1],Ge[3])},v),si(il,g={lng:bd(.6,Ge[0],Ge[2]),lat:bd(.6,Ge[1],Ge[3])},g),si(jd,a=new yS(z,ue.toRouteSnapper(),Ei(fc()),Ei(!0),Ei(0)),a),An.set(ue),await V()});async function V(){z&&d&&z.fitBounds(await d.getBounds(),{animate:!1})}let $,H,G;function X(K){oi[K?"unshift":"push"](()=>{G=K,t(3,G),t(8,o)})}function le(K){oi[K?"unshift":"push"](()=>{H=K,t(2,H),t(9,l)})}function xe(K){z=K,t(0,z)}const Ie=K=>{console.log(K.detail.error)};function Y(K){oi[K?"unshift":"push"](()=>{$=K,t(1,$),t(10,u)})}return r.$$.update=()=>{r.$$.dirty&1&&z&&F1.set(z),r.$$.dirty&1026&&$&&u&&(t(1,$.innerHTML="",$),$.appendChild(u)),r.$$.dirty&516&&H&&l&&(t(2,H.innerHTML="",H),H.appendChild(l)),r.$$.dirty&264&&G&&o&&(t(3,G.innerHTML="",G),G.appendChild(o))},[z,$,H,G,P,d,k,E,o,l,u,X,le,xe,Ie,Y]}class aC extends Wt{constructor(e){super(),Gt(this,e,sC,oC,Vt,{})}}new aC({target:document.getElementById("app")});
