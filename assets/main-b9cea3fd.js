var Wb=Object.defineProperty;var Kb=(s,e,n)=>e in s?Wb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var lh=(s,e,n)=>(Kb(s,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function n(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerPolicy&&(h.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?h.credentials="include":a.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(a){if(a.ep)return;a.ep=!0;const h=n(a);fetch(a.href,h)}})();function tt(){}function $b(s,e){for(const n in e)s[n]=e[n];return s}function Yb(s){return!!s&&(typeof s=="object"||typeof s=="function")&&typeof s.then=="function"}function W0(s){return s()}function jg(){return Object.create(null)}function Ki(s){s.forEach(W0)}function iu(s){return typeof s=="function"}function an(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}let gf;function Yr(s,e){return s===e?!0:(gf||(gf=document.createElement("a")),gf.href=e,s===gf.href)}function Jb(s){return Object.keys(s).length===0}function K0(s,...e){if(s==null){for(const r of e)r(void 0);return tt}const n=s.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Df(s){let e;return K0(s,n=>e=n)(),e}function Ft(s,e,n){s.$$.on_destroy.push(K0(e,n))}function Zi(s,e,n,r){if(s){const a=$0(s,e,n,r);return s[0](a)}}function $0(s,e,n,r){return s[1]&&r?$b(n.ctx.slice(),s[1](r(e))):n.ctx}function Hi(s,e,n,r){if(s[2]&&r){const a=s[2](r(n));if(e.dirty===void 0)return a;if(typeof a=="object"){const h=[],m=Math.max(e.dirty.length,a.length);for(let l=0;l<m;l+=1)h[l]=e.dirty[l]|a[l];return h}return e.dirty|a}return e.dirty}function Xi(s,e,n,r,a,h){if(a){const m=$0(e,n,r,h);s.p(m,a)}}function Wi(s){if(s.ctx.length>32){const e=[],n=s.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function Qb(s){const e={};for(const n in s)e[n]=!0;return e}function Nf(s){return s??""}function Nn(s,e,n){return s.set(n),e}function dp(s){return s&&iu(s.destroy)?s.destroy:tt}const Y0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Z(s,e){s.appendChild(e)}function ae(s,e,n){s.insertBefore(e,n||null)}function oe(s){s.parentNode&&s.parentNode.removeChild(s)}function Er(s,e){for(let n=0;n<s.length;n+=1)s[n]&&s[n].d(e)}function ue(s){return document.createElement(s)}function Da(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Fe(s){return document.createTextNode(s)}function Oe(){return Fe(" ")}function ni(){return Fe("")}function Rt(s,e,n,r){return s.addEventListener(e,n,r),()=>s.removeEventListener(e,n,r)}function Nh(s){return function(e){return e.preventDefault(),s.call(this,e)}}function tp(s){return function(e){return e.stopPropagation(),s.call(this,e)}}function Ze(s,e,n){n==null?s.removeAttribute(e):s.getAttribute(e)!==n&&s.setAttribute(e,n)}function qg(s){let e;return{p(...n){e=n,e.forEach(r=>s.push(r))},r(){e.forEach(n=>s.splice(s.indexOf(n),1))}}}function ex(s){return Array.from(s.childNodes)}function Lt(s,e){e=""+e,s.data!==e&&(s.data=e)}function qi(s,e){s.value=e??""}function Pn(s,e,n,r){n==null?s.style.removeProperty(e):s.style.setProperty(e,n,r?"important":"")}function Us(s,e,n){for(let r=0;r<s.options.length;r+=1){const a=s.options[r];if(a.__value===e){a.selected=!0;return}}(!n||e!==void 0)&&(s.selectedIndex=-1)}function eu(s){const e=s.querySelector(":checked");return e&&e.__value}function Sr(s,e,n){s.classList.toggle(e,!!n)}function tx(s,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(s,{detail:e,bubbles:n,cancelable:r})}let Th;function Pa(s){Th=s}function uc(){if(!Th)throw new Error("Function called outside component initialization");return Th}function cc(s){uc().$$.on_mount.push(s)}function vo(s){uc().$$.on_destroy.push(s)}function hc(){const s=uc();return(e,n,{cancelable:r=!1}={})=>{const a=s.$$.callbacks[e];if(a){const h=tx(e,n,{cancelable:r});return a.slice().forEach(m=>{m.call(s,h)}),!h.defaultPrevented}return!0}}function J0(s,e){return uc().$$.context.set(s,e),e}function Q0(s){return uc().$$.context.get(s)}function ur(s,e){const n=s.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Wu=[],Kn=[];let ec=[];const pp=[],ev=Promise.resolve();let mp=!1;function tv(){mp||(mp=!0,ev.then(Up))}function nx(){return tv(),ev}function ra(s){ec.push(s)}function mr(s){pp.push(s)}const np=new Set;let qu=0;function Up(){if(qu!==0)return;const s=Th;do{try{for(;qu<Wu.length;){const e=Wu[qu];qu++,Pa(e),ix(e.$$)}}catch(e){throw Wu.length=0,qu=0,e}for(Pa(null),Wu.length=0,qu=0;Kn.length;)Kn.pop()();for(let e=0;e<ec.length;e+=1){const n=ec[e];np.has(n)||(np.add(n),n())}ec.length=0}while(Wu.length);for(;pp.length;)pp.pop()();mp=!1,np.clear(),Pa(s)}function ix(s){if(s.fragment!==null){s.update(),Ki(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(ra)}}function rx(s){const e=[],n=[];ec.forEach(r=>s.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),ec=e}const Af=new Set;let tu;function zn(){tu={r:0,c:[],p:tu}}function Fn(){tu.r||Ki(tu.c),tu=tu.p}function _e(s,e){s&&s.i&&(Af.delete(s),s.i(e))}function Ie(s,e,n,r){if(s&&s.o){if(Af.has(s))return;Af.add(s),tu.c.push(()=>{Af.delete(s),r&&(n&&s.d(1),r())}),s.o(e)}else r&&r()}function ms(s,e){const n=e.token={};function r(a,h,m,l){if(e.token!==n)return;e.resolved=l;let x=e.ctx;m!==void 0&&(x=x.slice(),x[m]=l);const S=a&&(e.current=a)(x);let T=!1;e.block&&(e.blocks?e.blocks.forEach((C,N)=>{N!==h&&C&&(zn(),Ie(C,1,1,()=>{e.blocks[N]===C&&(e.blocks[N]=null)}),Fn())}):e.block.d(1),S.c(),_e(S,1),S.m(e.mount(),e.anchor),T=!0),e.block=S,e.blocks&&(e.blocks[h]=S),T&&Up()}if(Yb(s)){const a=uc();if(s.then(h=>{Pa(a),r(e.then,1,e.value,h),Pa(null)},h=>{if(Pa(a),r(e.catch,2,e.error,h),Pa(null),!e.hasCatch)throw h}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,s),!0;e.resolved=s}}function wl(s,e,n){const r=e.slice(),{resolved:a}=s;s.current===s.then&&(r[s.value]=a),s.current===s.catch&&(r[s.error]=a),s.block.p(r,n)}function qn(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function sx(s,e){Ie(s,1,1,()=>{e.delete(s.key)})}function ox(s,e,n,r,a,h,m,l,x,S,T,C){let N=s.length,B=h.length,U=N;const ee={};for(;U--;)ee[s[U].key]=U;const ie=[],se=new Map,Q=new Map,K=[];for(U=B;U--;){const he=C(a,h,U),xe=n(he);let be=m.get(xe);be?r&&K.push(()=>be.p(he,e)):(be=S(xe,he),be.c()),se.set(xe,ie[U]=be),xe in ee&&Q.set(xe,Math.abs(U-ee[xe]))}const pe=new Set,ve=new Set;function De(he){_e(he,1),he.m(l,T),m.set(he.key,he),T=he.first,B--}for(;N&&B;){const he=ie[B-1],xe=s[N-1],be=he.key,Ce=xe.key;he===xe?(T=he.first,N--,B--):se.has(Ce)?!m.has(be)||pe.has(be)?De(he):ve.has(Ce)?N--:Q.get(be)>Q.get(Ce)?(ve.add(be),De(he)):(pe.add(Ce),N--):(x(xe,m),N--)}for(;N--;){const he=s[N];se.has(he.key)||x(he,m)}for(;B;)De(ie[B-1]);return Ki(K),ie}function gr(s,e,n){const r=s.$$.props[e];r!==void 0&&(s.$$.bound[r]=n,n(s.$$.ctx[r]))}function ot(s){s&&s.c()}function it(s,e,n){const{fragment:r,after_update:a}=s.$$;r&&r.m(e,n),ra(()=>{const h=s.$$.on_mount.map(W0).filter(iu);s.$$.on_destroy?s.$$.on_destroy.push(...h):Ki(h),s.$$.on_mount=[]}),a.forEach(ra)}function rt(s,e){const n=s.$$;n.fragment!==null&&(rx(n.after_update),Ki(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ax(s,e){s.$$.dirty[0]===-1&&(Wu.push(s),tv(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function hn(s,e,n,r,a,h,m=null,l=[-1]){const x=Th;Pa(s);const S=s.$$={fragment:null,ctx:[],props:h,update:tt,not_equal:a,bound:jg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:jg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let T=!1;if(S.ctx=n?n(s,e.props||{},(C,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[C],S.ctx[C]=U)&&(!S.skip_bound&&S.bound[C]&&S.bound[C](U),T&&ax(s,C)),N}):[],S.update(),T=!0,Ki(S.before_update),S.fragment=r?r(S.ctx):!1,e.target){if(e.hydrate){const C=ex(e.target);S.fragment&&S.fragment.l(C),C.forEach(oe)}else S.fragment&&S.fragment.c();e.intro&&_e(s.$$.fragment),it(s,e.target,e.anchor),Up()}Pa(x)}class fn{constructor(){lh(this,"$$");lh(this,"$$set")}$destroy(){rt(this,1),this.$destroy=tt}$on(e,n){if(!iu(n))return tt;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const a=r.indexOf(n);a!==-1&&r.splice(a,1)}}$set(e){this.$$set&&!Jb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const lx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(lx);var ux=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cx(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var nv={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(s,e){(function(n,r){s.exports=r()})(ux,function(){var n={},r={};function a(m,l,x){if(r[m]=x,m==="index"){var S="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",T={};return r.shared(T),r.index(n,T),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),n}}a("shared",["exports"],function(m){function l(o,i,u,g){return new(u||(u=Promise))(function(v,E){function A(F){try{P(g.next(F))}catch(j){E(j)}}function M(F){try{P(g.throw(F))}catch(j){E(j)}}function P(F){var j;F.done?v(F.value):(j=F.value,j instanceof u?j:new u(function(G){G(j)})).then(A,M)}P((g=g.apply(o,i||[])).next())})}function x(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}typeof SuppressedError=="function"&&SuppressedError;var S=T;function T(o,i){this.x=o,this.y=i}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,u=o.y-this.y;return i*i+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),u=Math.sin(o),g=u*this.x+i*this.y;return this.x=i*this.x-u*this.y,this.y=g,this},_rotateAround:function(o,i){var u=Math.cos(o),g=Math.sin(o),v=i.y+g*(this.x-i.x)+u*(this.y-i.y);return this.x=i.x+u*(this.x-i.x)-g*(this.y-i.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(o){return o instanceof T?o:Array.isArray(o)?new T(o[0],o[1]):o};var C=x(S),N=B;function B(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}B.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var A=0,M=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?A=u:M=u,u=.5*(M-A)+A;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var U=x(N);let ee,ie;function se(){return ee==null&&(ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ee}function Q(){if(ie==null&&(ie=!1,se())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let g=0;g<5*5;g++){const v=4*g;i.fillStyle=`rgb(${v},${v+1},${v+2})`,i.fillRect(g%5,Math.floor(g/5),1,1)}const u=i.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&u[g]!==g){ie=!0;break}}}return ie||!1}function K(o,i,u,g){const v=new U(o,i,u,g);return E=>v.solve(E)}const pe=K(.25,.1,.25,1);function ve(o,i,u){return Math.min(u,Math.max(i,o))}function De(o,i,u){const g=u-i,v=((o-i)%g+g)%g+i;return v===i?u:v}function he(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}let xe=1;function be(o,i,u){const g={};for(const v in o)g[v]=i.call(this,o[v],v,o);return g}function Ce(o,i,u){const g={};for(const v in o)i.call(this,o[v],v,o)&&(g[v]=o[v]);return g}function we(o){return Array.isArray(o)?o.map(we):typeof o=="object"&&o?be(o,we):o}const ye={};function Ue(o){ye[o]||(typeof console<"u"&&console.warn(o),ye[o]=!0)}function qe(o,i,u){return(u.y-o.y)*(i.x-o.x)>(i.y-o.y)*(u.x-o.x)}function pt(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let St=null;function dt(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Bt(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(o,{timestamp:0});try{const A=E==null?void 0:E.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const M=A.startsWith("BGR"),P=new Uint8ClampedArray(g*v*4);if(yield E.copyTo(P,function(F,j,G,W,te){const re=4*Math.max(-j,0),de=(Math.max(0,G)-G)*W*4+re,Te=4*W,Pe=Math.max(0,j),nt=Math.max(0,G);return{rect:{x:Pe,y:nt,width:Math.min(F.width,j+W)-Pe,height:Math.min(F.height,G+te)-nt},layout:[{offset:de,stride:Te}]}}(o,i,u,g,v)),M)for(let F=0;F<P.length;F+=4){const j=P[F];P[F]=P[F+2],P[F+2]=j}return P}finally{E.close()}})}let vt,wt;const ft="AbortError";function xt(){return new Error(ft)}const It={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Yt(o){return It.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const pn="global-dispatcher";class Dn extends Error{constructor(i,u,g,v){super(`AJAXError: ${u} (${i}): ${g}`),this.status=i,this.statusText=u,this.url=g,this.body=v}}const We=()=>pt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Xn=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const g=Yt(o.url);if(g)return g(o,i);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:pn},i)}if(!(/^file:/.test(u=o.url)||/^file:/.test(We())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,v){return l(this,void 0,void 0,function*(){const E=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:We(),signal:v.signal});g.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");const A=yield fetch(E);if(!A.ok){const F=yield A.blob();throw new Dn(A.status,A.statusText,g.url,F)}let M;M=g.type==="arrayBuffer"||g.type==="image"?A.arrayBuffer():g.type==="json"?A.json():A.text();const P=yield M;if(v.signal.aborted)throw xt();return{data:P,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}})}(o,i);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:pn},i)}var u;return function(g,v){return new Promise((E,A)=>{var M;const P=new XMLHttpRequest;P.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(P.responseType="arraybuffer");for(const F in g.headers)P.setRequestHeader(F,g.headers[F]);g.type==="json"&&(P.responseType="text",!((M=g.headers)===null||M===void 0)&&M.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=g.credentials==="include",P.onerror=()=>{A(new Error(P.statusText))},P.onload=()=>{if(!v.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let F=P.response;if(g.type==="json")try{F=JSON.parse(P.response)}catch(j){return void A(j)}E({data:F,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const F=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});A(new Dn(P.status,P.statusText,g.url,F))}},v.signal.addEventListener("abort",()=>{P.abort(),A(xt())}),P.send(g.body)})}(o,i)};function dn(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const i=new URL(o),u=window.location;return i.protocol===u.protocol&&i.host===u.host}function Ot(o,i,u){u[o]&&u[o].indexOf(i)!==-1||(u[o]=u[o]||[],u[o].push(i))}function Se(o,i,u){if(u&&u[o]){const g=u[o].indexOf(i);g!==-1&&u[o].splice(g,1)}}class lt{constructor(i,u={}){he(this,u),this.type=i}}class Ye extends lt{constructor(i,u={}){super("error",he({error:i},u))}}class Ct{on(i,u){return this._listeners=this._listeners||{},Ot(i,u,this._listeners),this}off(i,u){return Se(i,u,this._listeners),Se(i,u,this._oneTimeListeners),this}once(i,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ot(i,u,this._oneTimeListeners),this):new Promise(g=>this.once(i,g))}fire(i,u){typeof i=="string"&&(i=new lt(i,u||{}));const g=i.type;if(this.listens(g)){i.target=this;const v=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const M of v)M.call(this,i);const E=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const M of E)Se(g,M,this._oneTimeListeners),M.call(this,i);const A=this._eventedParent;A&&(he(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(i))}else i instanceof Ye&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,u){return this._eventedParent=i,this._eventedParentData=u,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const kt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qt(o,i){const u={};for(const g in o)g!=="ref"&&(u[g]=o[g]);return kt.forEach(g=>{g in i&&(u[g]=i[g])}),u}function Ee(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let u=0;u<o.length;u++)if(!Ee(o[u],i[u]))return!1;return!0}if(typeof o=="object"&&o!==null&&i!==null){if(typeof i!="object"||Object.keys(o).length!==Object.keys(i).length)return!1;for(const u in o)if(!Ee(o[u],i[u]))return!1;return!0}return o===i}function Gt(o,i){o.push(i)}function _n(o,i,u){Gt(u,{command:"addSource",args:[o,i[o]]})}function Jn(o,i,u){Gt(i,{command:"removeSource",args:[o]}),u[o]=!0}function $i(o,i,u,g){Jn(o,u,g),_n(o,i,u)}function xn(o,i,u){let g;for(g in o[u])if(Object.prototype.hasOwnProperty.call(o[u],g)&&g!=="data"&&!Ee(o[u][g],i[u][g]))return!1;for(g in i[u])if(Object.prototype.hasOwnProperty.call(i[u],g)&&g!=="data"&&!Ee(o[u][g],i[u][g]))return!1;return!0}function Vi(o,i,u,g,v,E){o=o||{},i=i||{};for(const A in o)Object.prototype.hasOwnProperty.call(o,A)&&(Ee(o[A],i[A])||u.push({command:E,args:[g,A,i[A],v]}));for(const A in i)Object.prototype.hasOwnProperty.call(i,A)&&!Object.prototype.hasOwnProperty.call(o,A)&&(Ee(o[A],i[A])||u.push({command:E,args:[g,A,i[A],v]}))}function Yi(o){return o.id}function Jr(o,i){return o[i.id]=i,o}class ct{constructor(i,u,g,v){this.message=(i?`${i}: `:"")+g,v&&(this.identifier=v),u!=null&&u.__line__&&(this.line=u.__line__)}}function yr(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}class kn extends Error{constructor(i,u){super(u),this.message=u,this.key=i}}class mn{constructor(i,u=[]){this.parent=i,this.bindings={};for(const[g,v]of u)this.bindings[g]=v}concat(i){return new mn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Ls={kind:"null"},Mt={kind:"number"},Cn={kind:"string"},At={kind:"boolean"},vr={kind:"color"},Gr={kind:"object"},wn={kind:"value"},Li={kind:"collator"},Ar={kind:"formatted"},Ji={kind:"padding"},Zr={kind:"resolvedImage"},Me={kind:"variableAnchorOffsetCollection"};function J(o,i){return{kind:"array",itemType:o,N:i}}function Y(o){if(o.kind==="array"){const i=Y(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const ce=[Ls,Mt,Cn,At,vr,Ar,Gr,J(wn),Ji,Zr,Me];function le(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!le(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const u of ce)if(!le(u,i))return null}}return`Expected ${Y(o)} but found ${Y(i)} instead.`}function fe(o,i){return i.some(u=>u.kind===o.kind)}function je(o,i){return i.some(u=>u==="null"?o===null:u==="array"?Array.isArray(o):u==="object"?o&&!Array.isArray(o)&&typeof o=="object":u===typeof o)}function Xe(o,i){return o.kind==="array"&&i.kind==="array"?o.itemType.kind===i.itemType.kind&&typeof o.N=="number":o.kind===i.kind}const Re=.96422,et=.82521,gt=4/29,at=6/29,Dt=3*at*at,en=at*at*at,ln=Math.PI/180,Vn=180/Math.PI;function Ln(o){return(o%=360)<0&&(o+=360),o}function Mn([o,i,u,g]){let v,E;const A=wi((.2225045*(o=Bn(o))+.7168786*(i=Bn(i))+.0606169*(u=Bn(u)))/1);o===i&&i===u?v=E=A:(v=wi((.4360747*o+.3850649*i+.1430804*u)/Re),E=wi((.0139322*o+.0971045*i+.7141733*u)/et));const M=116*A-16;return[M<0?0:M,500*(v-A),200*(A-E),g]}function Bn(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function wi(o){return o>en?Math.pow(o,1/3):o/Dt+gt}function ui([o,i,u,g]){let v=(o+16)/116,E=isNaN(i)?v:v+i/500,A=isNaN(u)?v:v-u/200;return v=1*ii(v),E=Re*ii(E),A=et*ii(A),[Tn(3.1338561*E-1.6168667*v-.4906146*A),Tn(-.9787684*E+1.9161415*v+.033454*A),Tn(.0719453*E-.2289914*v+1.4052427*A),g]}function Tn(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function ii(o){return o>at?o*o*o:Dt*(o-gt)}function hi(o){return parseInt(o.padEnd(2,o),16)/255}function Mi(o,i){return Wn(i?o/100:o,0,1)}function Wn(o,i,u){return Math.min(Math.max(i,o),u)}function Tr(o){return!o.some(Number.isNaN)}const Do={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qn{constructor(i,u,g,v=1,E=!0){this.r=i,this.g=u,this.b=g,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[i,u,g,v]))}static parse(i){if(i instanceof Qn)return i;if(typeof i!="string")return;const u=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Do[g];if(v){const[A,M,P]=v;return[A/255,M/255,P/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const A=g.length<6?1:2;let M=1;return[hi(g.slice(M,M+=A)),hi(g.slice(M,M+=A)),hi(g.slice(M,M+=A)),hi(g.slice(M,M+A)||"ff")]}if(g.startsWith("rgb")){const A=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[M,P,F,j,G,W,te,re,de,Te,Pe,nt]=A,Ge=[j||" ",te||" ",Te].join("");if(Ge==="  "||Ge==="  /"||Ge===",,"||Ge===",,,"){const Qe=[F,W,de].join(""),ht=Qe==="%%%"?100:Qe===""?255:0;if(ht){const Et=[Wn(+P/ht,0,1),Wn(+G/ht,0,1),Wn(+re/ht,0,1),Pe?Mi(+Pe,nt):1];if(Tr(Et))return Et}}return}}const E=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,M,P,F,j,G,W,te,re]=E,de=[P||" ",j||" ",W].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const Te=[+M,Wn(+F,0,100),Wn(+G,0,100),te?Mi(+te,re):1];if(Tr(Te))return function([Pe,nt,Ge,Qe]){function ht(Et){const Kt=(Et+Pe/30)%12,yn=nt*Math.min(Ge,1-Ge);return Ge-yn*Math.max(-1,Math.min(Kt-3,9-Kt,1))}return Pe=Ln(Pe),nt/=100,Ge/=100,[ht(0),ht(8),ht(4),Qe]}(Te)}}}(i);return u?new Qn(...u,!1):void 0}get rgb(){const{r:i,g:u,b:g,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[i/E,u/E,g/E,v])}get hcl(){return this.overwriteGetter("hcl",function(i){const[u,g,v,E]=Mn(i),A=Math.sqrt(g*g+v*v);return[Math.round(1e4*A)?Ln(Math.atan2(v,g)*Vn):NaN,A,u,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Mn(this.rgb))}overwriteGetter(i,u){return Object.defineProperty(this,i,{value:u}),u}toString(){const[i,u,g,v]=this.rgb;return`rgba(${[i,u,g].map(E=>Math.round(255*E)).join(",")},${v})`}}Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1);class bo{constructor(i,u,g){this.sensitivity=i?u?"variant":"case":u?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,u){return this.collator.compare(i,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(i,u,g,v,E){this.text=i,this.image=u,this.scale=g,this.fontStack=v,this.textColor=E}}class Cr{constructor(i){this.sections=i}static fromString(i){return new Cr([new aa(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Cr?i:Cr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Nr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Nr)return i;if(typeof i=="number")return new Nr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const u of i)if(typeof u!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Nr(i)}}toString(){return JSON.stringify(this.values)}}const yc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ri{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Ri)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let u=0;u<i.length;u+=2){const g=i[u],v=i[u+1];if(typeof g!="string"||!yc.has(g)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Ri(i)}}toString(){return JSON.stringify(this.values)}}class or{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new or({name:i,available:!1}):null}}function no(o,i,u,g){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof u=="number"&&u>=0&&u<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[o,i,u,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[o,i,u,g]:[o,i,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qr(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Qn||o instanceof bo||o instanceof Cr||o instanceof Nr||o instanceof Ri||o instanceof or)return!0;if(Array.isArray(o)){for(const i of o)if(!Qr(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!Qr(o[i]))return!1;return!0}return!1}function Pi(o){if(o===null)return Ls;if(typeof o=="string")return Cn;if(typeof o=="boolean")return At;if(typeof o=="number")return Mt;if(o instanceof Qn)return vr;if(o instanceof bo)return Li;if(o instanceof Cr)return Ar;if(o instanceof Nr)return Ji;if(o instanceof Ri)return Me;if(o instanceof or)return Zr;if(Array.isArray(o)){const i=o.length;let u;for(const g of o){const v=Pi(g);if(u){if(u===v)continue;u=wn;break}u=v}return J(u||wn,i)}return Gr}function la(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof Qn||o instanceof Cr||o instanceof Nr||o instanceof Ri||o instanceof or?o.toString():JSON.stringify(o)}class gs{constructor(i,u){this.type=i,this.value=u}static parse(i,u){if(i.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Qr(i[1]))return u.error("invalid value");const g=i[1];let v=Pi(g);const E=u.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new gs(v,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fi{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ua={string:Cn,number:Mt,boolean:At,object:Gr};class es{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");let g,v=1;const E=i[0];if(E==="array"){let M,P;if(i.length>2){const F=i[1];if(typeof F!="string"||!(F in ua)||F==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=ua[F],v++}else M=wn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return u.error('The length argument to "array" must be a positive integer literal',2);P=i[2],v++}g=J(M,P)}else{if(!ua[E])throw new Error(`Types doesn't contain name = ${E}`);g=ua[E]}const A=[];for(;v<i.length;v++){const M=u.parse(i[v],v,wn);if(!M)return null;A.push(M)}return new es(g,A)}evaluate(i){for(let u=0;u<this.args.length;u++){const g=this.args[u].evaluate(i);if(!le(this.type,Pi(g)))return g;if(u===this.args.length-1)throw new Fi(`Expected value to be of type ${Y(this.type)}, but found ${Y(Pi(g))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const No={"to-boolean":At,"to-color":vr,"to-number":Mt,"to-string":Cn};class Qi{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[0];if(!No[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&i.length!==2)return u.error("Expected one argument.");const v=No[g],E=[];for(let A=1;A<i.length;A++){const M=u.parse(i[A],A,wn);if(!M)return null;E.push(M)}return new Qi(v,E)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let u,g;for(const v of this.args){if(u=v.evaluate(i),g=null,u instanceof Qn)return u;if(typeof u=="string"){const E=i.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(g=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:no(u[0],u[1],u[2],u[3]),!g))return new Qn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Fi(g||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const g of this.args){u=g.evaluate(i);const v=Nr.parse(u);if(v)return v}throw new Fi(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const g of this.args){u=g.evaluate(i);const v=Ri.parse(u);if(v)return v}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const g of this.args){if(u=g.evaluate(i),u===null)return 0;const v=Number(u);if(!isNaN(v))return v}throw new Fi(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Cr.fromString(la(this.args[0].evaluate(i)));case"resolvedImage":return or.fromString(la(this.args[0].evaluate(i)));default:return la(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const io=["Unknown","Point","LineString","Polygon"];class ca{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let u=this._parseColorCache[i];return u||(u=this._parseColorCache[i]=Qn.parse(i)),u}}class ts{constructor(i,u,g=[],v,E=new mn,A=[]){this.registry=i,this.path=g,this.key=g.map(M=>`[${M}]`).join(""),this.scope=E,this.errors=A,this.expectedType=v,this._isConstant=u}parse(i,u,g,v,E={}){return u?this.concat(u,g,v)._parse(i,E):this._parse(i,E)}_parse(i,u){function g(v,E,A){return A==="assert"?new es(E,[v]):A==="coerce"?new Qi(E,[v]):v}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=i[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let A=E.parse(i,this);if(!A)return null;if(this.expectedType){const M=this.expectedType,P=A.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||P.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(M.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(M,P))return null}else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"assert")}if(!(A instanceof gs)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const M=new ca;try{A=new gs(A.type,A.evaluate(M))}catch(P){return this.error(P.message),null}}return A}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,u,g){const v=typeof i=="number"?this.path.concat(i):this.path,E=g?this.scope.concat(g):this.scope;return new ts(this.registry,this._isConstant,v,u||null,E,this.errors)}error(i,...u){const g=`${this.key}${u.map(v=>`[${v}]`).join("")}`;this.errors.push(new kn(g,i))}checkSubtype(i,u){const g=le(i,u);return g&&this.error(g),g}}class ro{constructor(i,u){this.type=u.type,this.bindings=[].concat(i),this.result=u}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const u of this.bindings)i(u[1]);i(this.result)}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const g=[];for(let E=1;E<i.length-1;E+=2){const A=i[E];if(typeof A!="string")return u.error(`Expected string, but found ${typeof A} instead.`,E);if(/[^a-zA-Z0-9_]/.test(A))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const M=u.parse(i[E+1],E+1);if(!M)return null;g.push([A,M])}const v=u.parse(i[i.length-1],i.length-1,u.expectedType,g);return v?new ro(g,v):null}outputDefined(){return this.result.outputDefined()}}class ei{constructor(i,u){this.type=u.type,this.name=i,this.boundExpression=u}static parse(i,u){if(i.length!==2||typeof i[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const g=i[1];return u.scope.has(g)?new ei(g,u.scope.get(g)):u.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Il{constructor(i,u,g){this.type=i,this.index=u,this.input=g}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,Mt),v=u.parse(i[2],2,J(u.expectedType||wn));return g&&v?new Il(v.type.itemType,g,v):null}evaluate(i){const u=this.index.evaluate(i),g=this.input.evaluate(i);if(u<0)throw new Fi(`Array index out of bounds: ${u} < 0.`);if(u>=g.length)throw new Fi(`Array index out of bounds: ${u} > ${g.length-1}.`);if(u!==Math.floor(u))throw new Fi(`Array index must be an integer, but found ${u} instead.`);return g[u]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Sl{constructor(i,u){this.type=At,this.needle=i,this.haystack=u}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,wn),v=u.parse(i[2],2,wn);return g&&v?fe(g.type,[At,Cn,Mt,Ls,wn])?new Sl(g,v):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(g.type)} instead`):null}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!g)return!1;if(!je(u,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Pi(u))} instead.`);if(!je(g,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${Y(Pi(g))} instead.`);return g.indexOf(u)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class xo{constructor(i,u,g){this.type=Mt,this.needle=i,this.haystack=u,this.fromIndex=g}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,wn),v=u.parse(i[2],2,wn);if(!g||!v)return null;if(!fe(g.type,[At,Cn,Mt,Ls,wn]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,Mt);return E?new xo(g,v,E):null}return new xo(g,v)}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!je(u,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Pi(u))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(i)),je(g,["string"])){const E=g.indexOf(u,v);return E===-1?-1:[...g.slice(0,E)].length}if(je(g,["array"]))return g.indexOf(u,v);throw new Fi(`Expected second argument to be of type array or string, but found ${Y(Pi(g))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class wo{constructor(i,u,g,v,E,A){this.inputType=i,this.type=u,this.input=g,this.cases=v,this.outputs=E,this.otherwise=A}static parse(i,u){if(i.length<5)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return u.error("Expected an even number of arguments.");let g,v;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);const E={},A=[];for(let F=2;F<i.length-1;F+=2){let j=i[F];const G=i[F+1];Array.isArray(j)||(j=[j]);const W=u.concat(F);if(j.length===0)return W.error("Expected at least one branch label.");for(const re of j){if(typeof re!="number"&&typeof re!="string")return W.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return W.error("Numeric branch labels must be integer values.");if(g){if(W.checkSubtype(g,Pi(re)))return null}else g=Pi(re);if(E[String(re)]!==void 0)return W.error("Branch labels must be unique.");E[String(re)]=A.length}const te=u.parse(G,F,v);if(!te)return null;v=v||te.type,A.push(te)}const M=u.parse(i[1],1,wn);if(!M)return null;const P=u.parse(i[i.length-1],i.length-1,v);return P?M.type.kind!=="value"&&u.concat(1).checkSubtype(g,M.type)?null:new wo(g,v,M,E,A,P):null}evaluate(i){const u=this.input.evaluate(i);return(Pi(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(i,u,g){this.type=i,this.branches=u,this.otherwise=g}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return u.error("Expected an odd number of arguments.");let g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v=[];for(let A=1;A<i.length-1;A+=2){const M=u.parse(i[A],A,At);if(!M)return null;const P=u.parse(i[A+1],A+1,g);if(!P)return null;v.push([M,P]),g=g||P.type}const E=u.parse(i[i.length-1],i.length-1,g);if(!E)return null;if(!g)throw new Error("Can't infer output type");return new ha(g,v,E)}evaluate(i){for(const[u,g]of this.branches)if(u.evaluate(i))return g.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[u,g]of this.branches)i(u),i(g);i(this.otherwise)}outputDefined(){return this.branches.every(([i,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(i,u,g,v){this.type=i,this.input=u,this.beginIndex=g,this.endIndex=v}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,wn),v=u.parse(i[2],2,Mt);if(!g||!v)return null;if(!fe(g.type,[J(wn),Cn,wn]))return u.error(`Expected first argument to be of type array or string, but found ${Y(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,Mt);return E?new fa(g.type,g,v,E):null}return new fa(g.type,g,v)}evaluate(i){const u=this.input.evaluate(i),g=this.beginIndex.evaluate(i);let v;if(this.endIndex&&(v=this.endIndex.evaluate(i)),je(u,["string"]))return[...u].slice(g,v).join("");if(je(u,["array"]))return u.slice(g,v);throw new Fi(`Expected first argument to be of type array or string, but found ${Y(Pi(u))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function da(o,i){const u=o.length-1;let g,v,E=0,A=u,M=0;for(;E<=A;)if(M=Math.floor((E+A)/2),g=o[M],v=o[M+1],g<=i){if(M===u||i<v)return M;E=M+1}else{if(!(g>i))throw new Fi("Input is not a number.");A=M-1}return 0}class zo{constructor(i,u,g){this.type=i,this.input=u,this.labels=[],this.outputs=[];for(const[v,E]of g)this.labels.push(v),this.outputs.push(E)}static parse(i,u){if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");const g=u.parse(i[1],1,Mt);if(!g)return null;const v=[];let E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(let A=1;A<i.length;A+=2){const M=A===1?-1/0:i[A],P=i[A+1],F=A,j=A+1;if(typeof M!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=M)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const G=u.parse(P,j,E);if(!G)return null;E=E||G.type,v.push([M,G])}return new zo(E,g,v)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;return v>=u[E-1]?g[E-1].evaluate(i):g[da(u,v)].evaluate(i)}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function za(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ki=so;function so(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}so.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var A=0,M=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?A=u:M=u,u=.5*(M-A)+A;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var vc=za(ki);function qs(o,i,u){return o+u*(i-o)}function br(o,i,u){return o.map((g,v)=>qs(g,i[v],u))}const bi={number:qs,color:function(o,i,u,g="rgb"){switch(g){case"rgb":{const[v,E,A,M]=br(o.rgb,i.rgb,u);return new Qn(v,E,A,M,!1)}case"hcl":{const[v,E,A,M]=o.hcl,[P,F,j,G]=i.hcl;let W,te;if(isNaN(v)||isNaN(P))isNaN(v)?isNaN(P)?W=NaN:(W=P,A!==1&&A!==0||(te=F)):(W=v,j!==1&&j!==0||(te=E));else{let nt=P-v;P>v&&nt>180?nt-=360:P<v&&v-P>180&&(nt+=360),W=v+u*nt}const[re,de,Te,Pe]=function([nt,Ge,Qe,ht]){return nt=isNaN(nt)?0:nt*ln,ui([Qe,Math.cos(nt)*Ge,Math.sin(nt)*Ge,ht])}([W,te??qs(E,F,u),qs(A,j,u),qs(M,G,u)]);return new Qn(re,de,Te,Pe,!1)}case"lab":{const[v,E,A,M]=ui(br(o.lab,i.lab,u));return new Qn(v,E,A,M,!1)}}},array:br,padding:function(o,i,u){return new Nr(br(o.values,i.values,u))},variableAnchorOffsetCollection:function(o,i,u){const g=o.values,v=i.values;if(g.length!==v.length)throw new Fi(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${i.toString()}`);const E=[];for(let A=0;A<g.length;A+=2){if(g[A]!==v[A])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${g[A]}, to[${A}]: ${v[A]}`);E.push(g[A]);const[M,P]=g[A+1],[F,j]=v[A+1];E.push([qs(M,F,u),qs(P,j,u)])}return new Ri(E)}};class cr{constructor(i,u,g,v,E){this.type=i,this.operator=u,this.interpolation=g,this.input=v,this.labels=[],this.outputs=[];for(const[A,M]of E)this.labels.push(A),this.outputs.push(M)}static interpolationFactor(i,u,g,v){let E=0;if(i.name==="exponential")E=Fa(u,i.base,g,v);else if(i.name==="linear")E=Fa(u,1,g,v);else if(i.name==="cubic-bezier"){const A=i.controlPoints;E=new vc(A[0],A[1],A[2],A[3]).solve(Fa(u,1,g,v))}return E}static parse(i,u){let[g,v,E,...A]=i;if(!Array.isArray(v)||v.length===0)return u.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const F=v[1];if(typeof F!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:F}}else{if(v[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const F=v.slice(1);if(F.length!==4||F.some(j=>typeof j!="number"||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:F}}}if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,Mt),!E)return null;const M=[];let P=null;g==="interpolate-hcl"||g==="interpolate-lab"?P=vr:u.expectedType&&u.expectedType.kind!=="value"&&(P=u.expectedType);for(let F=0;F<A.length;F+=2){const j=A[F],G=A[F+1],W=F+3,te=F+4;if(typeof j!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(M.length&&M[M.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const re=u.parse(G,te,P);if(!re)return null;P=P||re.type,M.push([j,re])}return Xe(P,Mt)||Xe(P,vr)||Xe(P,Ji)||Xe(P,Me)||Xe(P,J(Mt))?new cr(P,g,v,E,M):u.error(`Type ${Y(P)} is not interpolatable.`)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;if(v>=u[E-1])return g[E-1].evaluate(i);const A=da(u,v),M=cr.interpolationFactor(this.interpolation,v,u[A],u[A+1]),P=g[A].evaluate(i),F=g[A+1].evaluate(i);switch(this.operator){case"interpolate":return bi[this.type.kind](P,F,M);case"interpolate-hcl":return bi.color(P,F,M,"hcl");case"interpolate-lab":return bi.color(P,F,M,"lab")}}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Fa(o,i,u,g){const v=g-u,E=o-u;return v===0?0:i===1?E/v:(Math.pow(i,E)-1)/(Math.pow(i,v)-1)}class Oa{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expectected at least one argument.");let g=null;const v=u.expectedType;v&&v.kind!=="value"&&(g=v);const E=[];for(const M of i.slice(1)){const P=u.parse(M,1+E.length,g,void 0,{typeAnnotation:"omit"});if(!P)return null;g=g||P.type,E.push(P)}if(!g)throw new Error("No output type");const A=v&&E.some(M=>le(v,M.type));return new Oa(A?wn:g,E)}evaluate(i){let u,g=null,v=0;for(const E of this.args)if(v++,g=E.evaluate(i),g&&g instanceof or&&!g.available&&(u||(u=g.name),g=null,v===this.args.length&&(g=u)),g!==null)break;return g}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function pa(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function ma(o,i,u,g){return g.compare(i,u)===0}function Fo(o,i,u){const g=o!=="=="&&o!=="!=";return class iv{constructor(E,A,M){this.type=At,this.lhs=E,this.rhs=A,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}static parse(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");const M=E[0];let P=A.parse(E[1],1,wn);if(!P)return null;if(!pa(M,P.type))return A.concat(1).error(`"${M}" comparisons are not supported for type '${Y(P.type)}'.`);let F=A.parse(E[2],2,wn);if(!F)return null;if(!pa(M,F.type))return A.concat(2).error(`"${M}" comparisons are not supported for type '${Y(F.type)}'.`);if(P.type.kind!==F.type.kind&&P.type.kind!=="value"&&F.type.kind!=="value")return A.error(`Cannot compare types '${Y(P.type)}' and '${Y(F.type)}'.`);g&&(P.type.kind==="value"&&F.type.kind!=="value"?P=new es(F.type,[P]):P.type.kind!=="value"&&F.type.kind==="value"&&(F=new es(P.type,[F])));let j=null;if(E.length===4){if(P.type.kind!=="string"&&F.type.kind!=="string"&&P.type.kind!=="value"&&F.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(j=A.parse(E[3],3,Li),!j)return null}return new iv(P,F,j)}evaluate(E){const A=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(g&&this.hasUntypedArgument){const P=Pi(A),F=Pi(M);if(P.kind!==F.kind||P.kind!=="string"&&P.kind!=="number")throw new Fi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${P.kind}, ${F.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const P=Pi(A),F=Pi(M);if(P.kind!=="string"||F.kind!=="string")return i(E,A,M)}return this.collator?u(E,A,M,this.collator.evaluate(E)):i(E,A,M)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const au=Fo("==",function(o,i,u){return i===u},ma),ri=Fo("!=",function(o,i,u){return i!==u},function(o,i,u,g){return!ma(0,i,u,g)}),_s=Fo("<",function(o,i,u){return i<u},function(o,i,u,g){return g.compare(i,u)<0}),El=Fo(">",function(o,i,u){return i>u},function(o,i,u,g){return g.compare(i,u)>0}),lu=Fo("<=",function(o,i,u){return i<=u},function(o,i,u,g){return g.compare(i,u)<=0}),Oo=Fo(">=",function(o,i,u){return i>=u},function(o,i,u,g){return g.compare(i,u)>=0});class Bo{constructor(i,u,g){this.type=Li,this.locale=g,this.caseSensitive=i,this.diacriticSensitive=u}static parse(i,u){if(i.length!==2)return u.error("Expected one argument.");const g=i[1];if(typeof g!="object"||Array.isArray(g))return u.error("Collator options argument must be an object.");const v=u.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,At);if(!v)return null;const E=u.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,At);if(!E)return null;let A=null;return g.locale&&(A=u.parse(g.locale,1,Cn),!A)?null:new Bo(v,E,A)}evaluate(i){return new bo(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class hr{constructor(i,u,g,v,E){this.type=Cn,this.number=i,this.locale=u,this.currency=g,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(i,u){if(i.length!==3)return u.error("Expected two arguments.");const g=u.parse(i[1],1,Mt);if(!g)return null;const v=i[2];if(typeof v!="object"||Array.isArray(v))return u.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=u.parse(v.locale,1,Cn),!E))return null;let A=null;if(v.currency&&(A=u.parse(v.currency,1,Cn),!A))return null;let M=null;if(v["min-fraction-digits"]&&(M=u.parse(v["min-fraction-digits"],1,Mt),!M))return null;let P=null;return v["max-fraction-digits"]&&(P=u.parse(v["max-fraction-digits"],1,Mt),!P)?null:new hr(g,E,A,M,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class ga{constructor(i){this.type=Ar,this.sections=i}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[1];if(!Array.isArray(g)&&typeof g=="object")return u.error("First argument must be an image or text section.");const v=[];let E=!1;for(let A=1;A<=i.length-1;++A){const M=i[A];if(E&&typeof M=="object"&&!Array.isArray(M)){E=!1;let P=null;if(M["font-scale"]&&(P=u.parse(M["font-scale"],1,Mt),!P))return null;let F=null;if(M["text-font"]&&(F=u.parse(M["text-font"],1,J(Cn)),!F))return null;let j=null;if(M["text-color"]&&(j=u.parse(M["text-color"],1,vr),!j))return null;const G=v[v.length-1];G.scale=P,G.font=F,G.textColor=j}else{const P=u.parse(i[A],1,wn);if(!P)return null;const F=P.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:P,scale:null,font:null,textColor:null})}}return new ga(v)}evaluate(i){return new Cr(this.sections.map(u=>{const g=u.content.evaluate(i);return Pi(g)===Zr?new aa("",g,null,null,null):new aa(la(g),null,u.scale?u.scale.evaluate(i):null,u.font?u.font.evaluate(i).join(","):null,u.textColor?u.textColor.evaluate(i):null)}))}eachChild(i){for(const u of this.sections)i(u.content),u.scale&&i(u.scale),u.font&&i(u.font),u.textColor&&i(u.textColor)}outputDefined(){return!1}}class _a{constructor(i){this.type=Zr,this.input=i}static parse(i,u){if(i.length!==2)return u.error("Expected two arguments.");const g=u.parse(i[1],1,Cn);return g?new _a(g):u.error("No image name provided.")}evaluate(i){const u=this.input.evaluate(i),g=or.fromString(u);return g&&i.availableImages&&(g.available=i.availableImages.indexOf(u)>-1),g}eachChild(i){i(this.input)}outputDefined(){return!1}}class Ba{constructor(i){this.type=Mt,this.input=i}static parse(i,u){if(i.length!==2)return u.error(`Expected 1 argument, but found ${i.length-1} instead.`);const g=u.parse(i[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Y(g.type)} instead.`):new Ba(g):null}evaluate(i){const u=this.input.evaluate(i);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new Fi(`Expected value to be of type string or array, but found ${Y(Pi(u))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const ys=8192;function bc(o,i){const u=(180+o[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,v=Math.pow(2,i.z);return[Math.round(u*v*ys),Math.round(g*v*ys)]}function Ua(o,i){const u=Math.pow(2,i.z);return[(v=(o[0]/ys+i.x)/u,360*v-180),(g=(o[1]/ys+i.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,v}function Lr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function vs(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function si(o,i,u){const g=o[0]-i[0],v=o[1]-i[1],E=o[0]-u[0],A=o[1]-u[1];return g*A-E*v==0&&g*E<=0&&v*A<=0}function Mr(o,i,u,g){return(v=[g[0]-u[0],g[1]-u[1]])[0]*(E=[i[0]-o[0],i[1]-o[1]])[1]-v[1]*E[0]!=0&&!(!uu(o,i,u,g)||!uu(u,g,o,i));var v,E}function Uo(o,i,u){for(const g of u)for(let v=0;v<g.length-1;++v)if(Mr(o,i,g[v],g[v+1]))return!0;return!1}function jo(o,i,u=!1){let g=!1;for(const M of i)for(let P=0;P<M.length-1;P++){if(si(o,M[P],M[P+1]))return u;(E=M[P])[1]>(v=o)[1]!=(A=M[P+1])[1]>v[1]&&v[0]<(A[0]-E[0])*(v[1]-E[1])/(A[1]-E[1])+E[0]&&(g=!g)}var v,E,A;return g}function qo(o,i){for(const u of i)if(jo(o,u))return!0;return!1}function Al(o,i){for(const u of o)if(!jo(u,i))return!1;for(let u=0;u<o.length-1;++u)if(Uo(o[u],o[u+1],i))return!1;return!0}function Vo(o,i){for(const u of i)if(Al(o,u))return!0;return!1}function uu(o,i,u,g){const v=g[0]-u[0],E=g[1]-u[1],A=(o[0]-u[0])*E-v*(o[1]-u[1]),M=(i[0]-u[0])*E-v*(i[1]-u[1]);return A>0&&M<0||A<0&&M>0}function ns(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=[];for(let A=0;A<o[v].length;A++){const M=bc(o[v][A],u);Lr(i,M),E.push(M)}g.push(E)}return g}function Tl(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=ns(o[v],i,u);g.push(E)}return g}function cu(o,i,u,g){if(o[0]<u[0]||o[0]>u[2]){const v=.5*g;let E=o[0]-u[0]>v?-g:u[0]-o[0]>v?g:0;E===0&&(E=o[0]-u[2]>v?-g:u[2]-o[0]>v?g:0),o[0]+=E}Lr(i,o)}function hu(o,i,u,g){const v=Math.pow(2,g.z)*ys,E=[g.x*ys,g.y*ys],A=[];for(const M of o)for(const P of M){const F=[P.x+E[0],P.y+E[1]];cu(F,i,u,v),A.push(F)}return A}function fu(o,i,u,g){const v=Math.pow(2,g.z)*ys,E=[g.x*ys,g.y*ys],A=[];for(const P of o){const F=[];for(const j of P){const G=[j.x+E[0],j.y+E[1]];Lr(i,G),F.push(G)}A.push(F)}if(i[2]-i[0]<=v/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of A)for(const F of P)cu(F,i,u,v)}var M;return A}class ko{constructor(i,u){this.type=At,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Qr(i[1])){const g=i[1];if(g.type==="FeatureCollection"){const v=[];for(const E of g.features){const{type:A,coordinates:M}=E.geometry;A==="Polygon"&&v.push(M),A==="MultiPolygon"&&v.push(...M)}if(v.length)return new ko(g,{type:"MultiPolygon",coordinates:v})}else if(g.type==="Feature"){const v=g.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ko(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new ko(g,g)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(g.type==="Polygon"){const M=ns(g.coordinates,E,A),P=hu(u.geometry(),v,E,A);if(!vs(v,E))return!1;for(const F of P)if(!jo(F,M))return!1}if(g.type==="MultiPolygon"){const M=Tl(g.coordinates,E,A),P=hu(u.geometry(),v,E,A);if(!vs(v,E))return!1;for(const F of P)if(!qo(F,M))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(g.type==="Polygon"){const M=ns(g.coordinates,E,A),P=fu(u.geometry(),v,E,A);if(!vs(v,E))return!1;for(const F of P)if(!Al(F,M))return!1}if(g.type==="MultiPolygon"){const M=Tl(g.coordinates,E,A),P=fu(u.geometry(),v,E,A);if(!vs(v,E))return!1;for(const F of P)if(!Vo(F,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let du=class{constructor(o=[],i=(u,g)=>u<g?-1:u>g?1:0){if(this.data=o,this.length=this.data.length,this.compare=i,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:i,compare:u}=this,g=i[o];for(;o>0;){const v=o-1>>1,E=i[v];if(u(g,E)>=0)break;i[o]=E,o=v}i[o]=g}_down(o){const{data:i,compare:u}=this,g=this.length>>1,v=i[o];for(;o<g;){let E=1+(o<<1);const A=E+1;if(A<this.length&&u(i[A],i[E])<0&&(E=A),u(i[E],v)>=0)break;i[o]=i[E],o=E}i[o]=v}};function xc(o,i,u,g,v){pu(o,i,u,g||o.length-1,v||Hr)}function pu(o,i,u,g,v){for(;g>u;){if(g-u>600){var E=g-u+1,A=i-u+1,M=Math.log(E),P=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*P*(E-P)/E)*(A-E/2<0?-1:1);pu(o,i,Math.max(u,Math.floor(i-A*P/E+F)),Math.min(g,Math.floor(i+(E-A)*P/E+F)),v)}var j=o[i],G=u,W=g;for(bs(o,u,i),v(o[g],j)>0&&bs(o,u,g);G<W;){for(bs(o,G,W),G++,W--;v(o[G],j)<0;)G++;for(;v(o[W],j)>0;)W--}v(o[u],j)===0?bs(o,u,W):bs(o,++W,g),W<=i&&(u=W+1),i<=W&&(g=W-1)}}function bs(o,i,u){var g=o[i];o[i]=o[u],o[u]=g}function Hr(o,i){return o<i?-1:o>i?1:0}function ja(o,i){if(o.length<=1)return[o];const u=[];let g,v;for(const E of o){const A=wc(E);A!==0&&(E.area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(g&&u.push(g),g=[E]):g.push(E))}if(g&&u.push(g),i>1)for(let E=0;E<u.length;E++)u[E].length<=i||(xc(u[E],i,1,u[E].length-1,mu),u[E]=u[E].slice(0,i));return u}function mu(o,i){return i.area-o.area}function wc(o){let i=0;for(let u,g,v=0,E=o.length,A=E-1;v<E;A=v++)u=o[v],g=o[A],i+=(g.x-u.x)*(u.y+g.y);return i}const qa=1/298.257223563,Cl=qa*(2-qa),Va=Math.PI/180;class Ga{constructor(i){const u=6378.137*Va*1e3,g=Math.cos(i*Va),v=1/(1-Cl*(1-g*g)),E=Math.sqrt(v);this.kx=u*E*g,this.ky=u*E*v*(1-Cl)}distance(i,u){const g=this.wrap(i[0]-u[0])*this.kx,v=(i[1]-u[1])*this.ky;return Math.sqrt(g*g+v*v)}pointOnLine(i,u){let g,v,E,A,M=1/0;for(let P=0;P<i.length-1;P++){let F=i[P][0],j=i[P][1],G=this.wrap(i[P+1][0]-F)*this.kx,W=(i[P+1][1]-j)*this.ky,te=0;G===0&&W===0||(te=(this.wrap(u[0]-F)*this.kx*G+(u[1]-j)*this.ky*W)/(G*G+W*W),te>1?(F=i[P+1][0],j=i[P+1][1]):te>0&&(F+=G/this.kx*te,j+=W/this.ky*te)),G=this.wrap(u[0]-F)*this.kx,W=(u[1]-j)*this.ky;const re=G*G+W*W;re<M&&(M=re,g=F,v=j,E=P,A=te)}return{point:[g,v],index:E,t:Math.max(0,Math.min(1,A))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function is(o,i){return i[0]-o[0]}function ya(o){return o[1]-o[0]+1}function Oi(o,i){return o[1]>=o[0]&&o[1]<i}function Io(o,i){if(o[0]>o[1])return[null,null];const u=ya(o);if(i){if(u===2)return[o,null];const v=Math.floor(u/2);return[[o[0],o[0]+v],[o[0]+v,o[1]]]}if(u===1)return[o,null];const g=Math.floor(u/2)-1;return[[o[0],o[0]+g],[o[0]+g+1,o[1]]]}function Ll(o,i){if(!Oi(i,o.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let g=i[0];g<=i[1];++g)Lr(u,o[g]);return u}function Za(o){const i=[1/0,1/0,-1/0,-1/0];for(const u of o)for(const g of u)Lr(i,g);return i}function va(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function Ha(o,i,u){if(!va(o)||!va(i))return NaN;let g=0,v=0;return o[2]<i[0]&&(g=i[0]-o[2]),o[0]>i[2]&&(g=o[0]-i[2]),o[1]>i[3]&&(v=o[1]-i[3]),o[3]<i[1]&&(v=i[1]-o[3]),u.distance([0,0],[g,v])}function Vs(o,i,u){const g=u.pointOnLine(i,o);return u.distance(o,g.point)}function Ml(o,i,u,g,v){const E=Math.min(Vs(o,[u,g],v),Vs(i,[u,g],v)),A=Math.min(Vs(u,[o,i],v),Vs(g,[o,i],v));return Math.min(E,A)}function kc(o,i,u,g,v){if(!Oi(i,o.length)||!Oi(g,u.length))return 1/0;let E=1/0;for(let A=i[0];A<i[1];++A){const M=o[A],P=o[A+1];for(let F=g[0];F<g[1];++F){const j=u[F],G=u[F+1];if(Mr(M,P,j,G))return 0;E=Math.min(E,Ml(M,P,j,G,v))}}return E}function Di(o,i,u,g,v){if(!Oi(i,o.length)||!Oi(g,u.length))return NaN;let E=1/0;for(let A=i[0];A<=i[1];++A)for(let M=g[0];M<=g[1];++M)if(E=Math.min(E,v.distance(o[A],u[M])),E===0)return E;return E}function Ic(o,i,u){if(jo(o,i,!0))return 0;let g=1/0;for(const v of i){const E=v[0],A=v[v.length-1];if(E!==A&&(g=Math.min(g,Vs(o,[A,E],u)),g===0))return g;const M=u.pointOnLine(v,o);if(g=Math.min(g,u.distance(o,M.point)),g===0)return g}return g}function Un(o,i,u,g){if(!Oi(i,o.length))return NaN;for(let E=i[0];E<=i[1];++E)if(jo(o[E],u,!0))return 0;let v=1/0;for(let E=i[0];E<i[1];++E){const A=o[E],M=o[E+1];for(const P of u)for(let F=0,j=P.length,G=j-1;F<j;G=F++){const W=P[G],te=P[F];if(Mr(A,M,W,te))return 0;v=Math.min(v,Ml(A,M,W,te,g))}}return v}function Xa(o,i){for(const u of o)for(const g of u)if(jo(g,i,!0))return!0;return!1}function pi(o,i,u,g=1/0){const v=Za(o),E=Za(i);if(g!==1/0&&Ha(v,E,u)>=g)return g;if(vs(v,E)){if(Xa(o,i))return 0}else if(Xa(i,o))return 0;let A=1/0;for(const M of o)for(let P=0,F=M.length,j=F-1;P<F;j=P++){const G=M[j],W=M[P];for(const te of i)for(let re=0,de=te.length,Te=de-1;re<de;Te=re++){const Pe=te[Te],nt=te[re];if(Mr(G,W,Pe,nt))return 0;A=Math.min(A,Ml(G,W,Pe,nt,u))}}return A}function ci(o,i,u,g,v,E){if(!E)return;const A=Ha(Ll(g,E),v,u);A<i&&o.push([A,E,[0,0]])}function oo(o,i,u,g,v,E,A){if(!E||!A)return;const M=Ha(Ll(g,E),Ll(v,A),u);M<i&&o.push([M,E,A])}function ba(o,i,u,g,v=1/0){let E=Math.min(g.distance(o[0],u[0][0]),v);if(E===0)return E;const A=new du([[0,[0,o.length-1],[0,0]]],is),M=Za(u);for(;A.length>0;){const P=A.pop();if(P[0]>=E)continue;const F=P[1],j=i?50:100;if(ya(F)<=j){if(!Oi(F,o.length))return NaN;if(i){const G=Un(o,F,u,g);if(isNaN(G)||G===0)return G;E=Math.min(E,G)}else for(let G=F[0];G<=F[1];++G){const W=Ic(o[G],u,g);if(E=Math.min(E,W),E===0)return 0}}else{const G=Io(F,i);ci(A,E,g,o,M,G[0]),ci(A,E,g,o,M,G[1])}}return E}function Go(o,i,u,g,v,E=1/0){let A=Math.min(E,v.distance(o[0],u[0]));if(A===0)return A;const M=new du([[0,[0,o.length-1],[0,u.length-1]]],is);for(;M.length>0;){const P=M.pop();if(P[0]>=A)continue;const F=P[1],j=P[2],G=i?50:100,W=g?50:100;if(ya(F)<=G&&ya(j)<=W){if(!Oi(F,o.length)&&Oi(j,u.length))return NaN;let te;if(i&&g)te=kc(o,F,u,j,v),A=Math.min(A,te);else if(i&&!g){const re=o.slice(F[0],F[1]+1);for(let de=j[0];de<=j[1];++de)if(te=Vs(u[de],re,v),A=Math.min(A,te),A===0)return A}else if(!i&&g){const re=u.slice(j[0],j[1]+1);for(let de=F[0];de<=F[1];++de)if(te=Vs(o[de],re,v),A=Math.min(A,te),A===0)return A}else te=Di(o,F,u,j,v),A=Math.min(A,te)}else{const te=Io(F,i),re=Io(j,g);oo(M,A,v,o,u,te[0],re[0]),oo(M,A,v,o,u,te[0],re[1]),oo(M,A,v,o,u,te[1],re[0]),oo(M,A,v,o,u,te[1],re[1])}}return A}function Rl(o){return o.type==="MultiPolygon"?o.coordinates.map(i=>({type:"Polygon",coordinates:i})):o.type==="MultiLineString"?o.coordinates.map(i=>({type:"LineString",coordinates:i})):o.type==="MultiPoint"?o.coordinates.map(i=>({type:"Point",coordinates:i})):[o]}class So{constructor(i,u){this.type=Mt,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Qr(i[1])){const g=i[1];if(g.type==="FeatureCollection")return new So(g,g.features.map(v=>Rl(v.geometry)).flat());if(g.type==="Feature")return new So(g,Rl(g.geometry));if("type"in g&&"coordinates"in g)return new So(g,Rl(g))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=u.geometry(),E=v.flat().map(P=>Ua([P.x,P.y],u.canonical));if(v.length===0)return NaN;const A=new Ga(E[0][1]);let M=1/0;for(const P of g){switch(P.type){case"Point":M=Math.min(M,Go(E,!1,[P.coordinates],!1,A,M));break;case"LineString":M=Math.min(M,Go(E,!1,P.coordinates,!0,A,M));break;case"Polygon":M=Math.min(M,ba(E,!1,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=u.geometry(),E=v.flat().map(P=>Ua([P.x,P.y],u.canonical));if(v.length===0)return NaN;const A=new Ga(E[0][1]);let M=1/0;for(const P of g){switch(P.type){case"Point":M=Math.min(M,Go(E,!0,[P.coordinates],!1,A,M));break;case"LineString":M=Math.min(M,Go(E,!0,P.coordinates,!0,A,M));break;case"Polygon":M=Math.min(M,ba(E,!0,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="Polygon")return function(u,g){const v=u.geometry();if(v.length===0||v[0].length===0)return NaN;const E=ja(v,0).map(P=>P.map(F=>F.map(j=>Ua([j.x,j.y],u.canonical)))),A=new Ga(E[0][0][0][1]);let M=1/0;for(const P of g)for(const F of E){switch(P.type){case"Point":M=Math.min(M,ba([P.coordinates],!1,F,A,M));break;case"LineString":M=Math.min(M,ba(P.coordinates,!0,F,A,M));break;case"Polygon":M=Math.min(M,pi(F,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Zo={"==":au,"!=":ri,">":El,"<":_s,">=":Oo,"<=":lu,array:es,at:Il,boolean:es,case:ha,coalesce:Oa,collator:Bo,format:ga,image:_a,in:Sl,"index-of":xo,interpolate:cr,"interpolate-hcl":cr,"interpolate-lab":cr,length:Ba,let:ro,literal:gs,match:wo,number:es,"number-format":hr,object:es,slice:fa,step:zo,string:es,"to-boolean":Qi,"to-color":Qi,"to-number":Qi,"to-string":Qi,var:ei,within:ko,distance:So};class rs{constructor(i,u,g,v){this.name=i,this.type=u,this._evaluate=g,this.args=v}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,u){const g=i[0],v=rs.definitions[g];if(!v)return u.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,A=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=A.filter(([F])=>!Array.isArray(F)||F.length===i.length-1);let P=null;for(const[F,j]of M){P=new ts(u.registry,Ho,u.path,null,u.scope);const G=[];let W=!1;for(let te=1;te<i.length;te++){const re=i[te],de=Array.isArray(F)?F[te-1]:F.type,Te=P.parse(re,1+G.length,de);if(!Te){W=!0;break}G.push(Te)}if(!W)if(Array.isArray(F)&&F.length!==G.length)P.error(`Expected ${F.length} arguments, but found ${G.length} instead.`);else{for(let te=0;te<G.length;te++){const re=Array.isArray(F)?F[te]:F.type,de=G[te];P.concat(te+1).checkSubtype(re,de.type)}if(P.errors.length===0)return new rs(g,E,j,G)}}if(M.length===1)u.errors.push(...P.errors);else{const F=(M.length?M:A).map(([G])=>{return W=G,Array.isArray(W)?`(${W.map(Y).join(", ")})`:`(${Y(W.type)}...)`;var W}).join(" | "),j=[];for(let G=1;G<i.length;G++){const W=u.parse(i[G],1+j.length);if(!W)return null;j.push(Y(W.type))}u.error(`Expected arguments of type ${F}, but found (${j.join(", ")}) instead.`)}return null}static register(i,u){rs.definitions=u;for(const g in u)i[g]=rs}}function Pl(o,[i,u,g,v]){i=i.evaluate(o),u=u.evaluate(o),g=g.evaluate(o);const E=v?v.evaluate(o):1,A=no(i,u,g,E);if(A)throw new Fi(A);return new Qn(i/255,u/255,g/255,E,!1)}function Dl(o,i){return o in i}function Nl(o,i){const u=i[o];return u===void 0?null:u}function ao(o){return{type:o}}function Ho(o){if(o instanceof ei)return Ho(o.boundExpression);if(o instanceof rs&&o.name==="error"||o instanceof Bo||o instanceof ko||o instanceof So)return!1;const i=o instanceof Qi||o instanceof es;let u=!0;return o.eachChild(g=>{u=i?u&&Ho(g):u&&g instanceof gs}),!!u&&Xo(o)&&Ko(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xo(o){if(o instanceof rs&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ko||o instanceof So)return!1;let i=!0;return o.eachChild(u=>{i&&!Xo(u)&&(i=!1)}),i}function Wo(o){if(o instanceof rs&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(u=>{i&&!Wo(u)&&(i=!1)}),i}function Ko(o,i){if(o instanceof rs&&i.indexOf(o.name)>=0)return!1;let u=!0;return o.eachChild(g=>{u&&!Ko(g,i)&&(u=!1)}),u}function $o(o){return{result:"success",value:o}}function Yo(o){return{result:"error",value:o}}function Eo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function zl(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Fl(o){return!!o.expression&&o.expression.interpolated}function $n(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Gs(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Sc(o){return o}function Ol(o,i){const u=i.type==="color",g=o.stops&&typeof o.stops[0][0]=="object",v=g||!(g||o.property!==void 0),E=o.type||(Fl(i)?"exponential":"interval");if(u||i.type==="padding"){const j=u?Qn.parse:Nr.parse;(o=yr({},o)).stops&&(o.stops=o.stops.map(G=>[G[0],j(G[1])])),o.default=j(o.default?o.default:i.default)}if(o.colorSpace&&(A=o.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var A;let M,P,F;if(E==="exponential")M=c;else if(E==="interval")M=I;else if(E==="categorical"){M=xs,P=Object.create(null);for(const j of o.stops)P[j[0]]=j[1];F=typeof o.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);M=d}if(g){const j={},G=[];for(let re=0;re<o.stops.length;re++){const de=o.stops[re],Te=de[0].zoom;j[Te]===void 0&&(j[Te]={zoom:Te,type:o.type,property:o.property,default:o.default,stops:[]},G.push(Te)),j[Te].stops.push([de[0].value,de[1]])}const W=[];for(const re of G)W.push([j[re].zoom,Ol(j[re],i)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:cr.interpolationFactor.bind(void 0,te),zoomStops:W.map(re=>re[0]),evaluate:({zoom:re},de)=>c({stops:W,base:o.base},i,re).evaluate(re,de)}}if(v){const j=E==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:cr.interpolationFactor.bind(void 0,j),zoomStops:o.stops.map(G=>G[0]),evaluate:({zoom:G})=>M(o,i,G,P,F)}}return{kind:"source",evaluate(j,G){const W=G&&G.properties?G.properties[o.property]:void 0;return W===void 0?fr(o.default,i.default):M(o,i,W,P,F)}}}function fr(o,i,u){return o!==void 0?o:i!==void 0?i:u!==void 0?u:void 0}function xs(o,i,u,g,v){return fr(typeof u===v?g[u]:void 0,o.default,i.default)}function I(o,i,u){if($n(u)!=="number")return fr(o.default,i.default);const g=o.stops.length;if(g===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[g-1][0])return o.stops[g-1][1];const v=da(o.stops.map(E=>E[0]),u);return o.stops[v][1]}function c(o,i,u){const g=o.base!==void 0?o.base:1;if($n(u)!=="number")return fr(o.default,i.default);const v=o.stops.length;if(v===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[v-1][0])return o.stops[v-1][1];const E=da(o.stops.map(j=>j[0]),u),A=function(j,G,W,te){const re=te-W,de=j-W;return re===0?0:G===1?de/re:(Math.pow(G,de)-1)/(Math.pow(G,re)-1)}(u,g,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],P=o.stops[E+1][1],F=bi[i.type]||Sc;return typeof M.evaluate=="function"?{evaluate(...j){const G=M.evaluate.apply(void 0,j),W=P.evaluate.apply(void 0,j);if(G!==void 0&&W!==void 0)return F(G,W,A,o.colorSpace)}}:F(M,P,A,o.colorSpace)}function d(o,i,u){switch(i.type){case"color":u=Qn.parse(u);break;case"formatted":u=Cr.fromString(u.toString());break;case"resolvedImage":u=or.fromString(u.toString());break;case"padding":u=Nr.parse(u);break;default:$n(u)===i.type||i.type==="enum"&&i.values[u]||(u=void 0)}return fr(u,o.default,i.default)}rs.register(Zo,{error:[{kind:"error"},[Cn],(o,[i])=>{throw new Fi(i.evaluate(o))}],typeof:[Cn,[wn],(o,[i])=>Y(Pi(i.evaluate(o)))],"to-rgba":[J(Mt,4),[vr],(o,[i])=>{const[u,g,v,E]=i.evaluate(o).rgb;return[255*u,255*g,255*v,E]}],rgb:[vr,[Mt,Mt,Mt],Pl],rgba:[vr,[Mt,Mt,Mt,Mt],Pl],has:{type:At,overloads:[[[Cn],(o,[i])=>Dl(i.evaluate(o),o.properties())],[[Cn,Gr],(o,[i,u])=>Dl(i.evaluate(o),u.evaluate(o))]]},get:{type:wn,overloads:[[[Cn],(o,[i])=>Nl(i.evaluate(o),o.properties())],[[Cn,Gr],(o,[i,u])=>Nl(i.evaluate(o),u.evaluate(o))]]},"feature-state":[wn,[Cn],(o,[i])=>Nl(i.evaluate(o),o.featureState||{})],properties:[Gr,[],o=>o.properties()],"geometry-type":[Cn,[],o=>o.geometryType()],id:[wn,[],o=>o.id()],zoom:[Mt,[],o=>o.globals.zoom],"heatmap-density":[Mt,[],o=>o.globals.heatmapDensity||0],"line-progress":[Mt,[],o=>o.globals.lineProgress||0],accumulated:[wn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Mt,ao(Mt),(o,i)=>{let u=0;for(const g of i)u+=g.evaluate(o);return u}],"*":[Mt,ao(Mt),(o,i)=>{let u=1;for(const g of i)u*=g.evaluate(o);return u}],"-":{type:Mt,overloads:[[[Mt,Mt],(o,[i,u])=>i.evaluate(o)-u.evaluate(o)],[[Mt],(o,[i])=>-i.evaluate(o)]]},"/":[Mt,[Mt,Mt],(o,[i,u])=>i.evaluate(o)/u.evaluate(o)],"%":[Mt,[Mt,Mt],(o,[i,u])=>i.evaluate(o)%u.evaluate(o)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(o,[i,u])=>Math.pow(i.evaluate(o),u.evaluate(o))],sqrt:[Mt,[Mt],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[Mt,[Mt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[Mt,[Mt],(o,[i])=>Math.log(i.evaluate(o))],log2:[Mt,[Mt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[Mt,[Mt],(o,[i])=>Math.sin(i.evaluate(o))],cos:[Mt,[Mt],(o,[i])=>Math.cos(i.evaluate(o))],tan:[Mt,[Mt],(o,[i])=>Math.tan(i.evaluate(o))],asin:[Mt,[Mt],(o,[i])=>Math.asin(i.evaluate(o))],acos:[Mt,[Mt],(o,[i])=>Math.acos(i.evaluate(o))],atan:[Mt,[Mt],(o,[i])=>Math.atan(i.evaluate(o))],min:[Mt,ao(Mt),(o,i)=>Math.min(...i.map(u=>u.evaluate(o)))],max:[Mt,ao(Mt),(o,i)=>Math.max(...i.map(u=>u.evaluate(o)))],abs:[Mt,[Mt],(o,[i])=>Math.abs(i.evaluate(o))],round:[Mt,[Mt],(o,[i])=>{const u=i.evaluate(o);return u<0?-Math.round(-u):Math.round(u)}],floor:[Mt,[Mt],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[Mt,[Mt],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[At,[Cn,wn],(o,[i,u])=>o.properties()[i.value]===u.value],"filter-id-==":[At,[wn],(o,[i])=>o.id()===i.value],"filter-type-==":[At,[Cn],(o,[i])=>o.geometryType()===i.value],"filter-<":[At,[Cn,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<v}],"filter-id-<":[At,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<g}],"filter->":[At,[Cn,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>v}],"filter-id->":[At,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>g}],"filter-<=":[At,[Cn,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<=v}],"filter-id-<=":[At,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<=g}],"filter->=":[At,[Cn,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>=v}],"filter-id->=":[At,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>=g}],"filter-has":[At,[wn],(o,[i])=>i.value in o.properties()],"filter-has-id":[At,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[At,[J(Cn)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[At,[J(wn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[At,[Cn,J(wn)],(o,[i,u])=>u.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[At,[Cn,J(wn)],(o,[i,u])=>function(g,v,E,A){for(;E<=A;){const M=E+A>>1;if(v[M]===g)return!0;v[M]>g?A=M-1:E=M+1}return!1}(o.properties()[i.value],u.value,0,u.value.length-1)],all:{type:At,overloads:[[[At,At],(o,[i,u])=>i.evaluate(o)&&u.evaluate(o)],[ao(At),(o,i)=>{for(const u of i)if(!u.evaluate(o))return!1;return!0}]]},any:{type:At,overloads:[[[At,At],(o,[i,u])=>i.evaluate(o)||u.evaluate(o)],[ao(At),(o,i)=>{for(const u of i)if(u.evaluate(o))return!0;return!1}]]},"!":[At,[At],(o,[i])=>!i.evaluate(o)],"is-supported-script":[At,[Cn],(o,[i])=>{const u=o.globals&&o.globals.isSupportedScript;return!u||u(i.evaluate(o))}],upcase:[Cn,[Cn],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[Cn,[Cn],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[Cn,ao(wn),(o,i)=>i.map(u=>la(u.evaluate(o))).join("")],"resolved-locale":[Cn,[Li],(o,[i])=>i.evaluate(o).resolvedLocale()]});class p{constructor(i,u){var g;this.expression=i,this._warningHistory={},this._evaluator=new ca,this._defaultValue=u?(g=u).type==="color"&&Gs(g.default)?new Qn(0,0,0,0):g.type==="color"?Qn.parse(g.default)||null:g.type==="padding"?Nr.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?Ri.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._evaluator.globals=i,this._evaluator.feature=u,this._evaluator.featureState=g,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(i,u,g,v,E,A){this._evaluator.globals=i,this._evaluator.feature=u||null,this._evaluator.featureState=g||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function b(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Zo}function L(o,i){const u=new ts(Zo,Ho,[],i?function(v){const E={color:vr,string:Cn,number:Mt,enum:Cn,boolean:At,formatted:Ar,padding:Ji,resolvedImage:Zr,variableAnchorOffsetCollection:Me};return v.type==="array"?J(E[v.value]||wn,v.length):E[v.type]}(i):void 0),g=u.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?$o(new p(g,i)):Yo(u.errors)}class O{constructor(i,u){this.kind=i,this._styleExpression=u,this.isStateDependent=i!=="constant"&&!Wo(u.expression)}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,A)}evaluate(i,u,g,v,E,A){return this._styleExpression.evaluate(i,u,g,v,E,A)}}class V{constructor(i,u,g,v){this.kind=i,this.zoomStops=g,this._styleExpression=u,this.isStateDependent=i!=="camera"&&!Wo(u.expression),this.interpolationType=v}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,A)}evaluate(i,u,g,v,E,A){return this._styleExpression.evaluate(i,u,g,v,E,A)}interpolationFactor(i,u,g){return this.interpolationType?cr.interpolationFactor(this.interpolationType,i,u,g):0}}function $(o,i){const u=L(o,i);if(u.result==="error")return u;const g=u.value.expression,v=Xo(g);if(!v&&!Eo(i))return Yo([new kn("","data expressions not supported")]);const E=Ko(g,["zoom"]);if(!E&&!zl(i))return Yo([new kn("","zoom expressions not supported")]);const A=Be(g);return A||E?A instanceof kn?Yo([A]):A instanceof cr&&!Fl(i)?Yo([new kn("",'"interpolate" expressions cannot be used with this property')]):$o(A?new V(v?"camera":"composite",u.value,A.labels,A instanceof cr?A.interpolation:void 0):new O(v?"constant":"source",u.value)):Yo([new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class me{constructor(i,u){this._parameters=i,this._specification=u,yr(this,Ol(this._parameters,this._specification))}static deserialize(i){return new me(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Be(o){let i=null;if(o instanceof ro)i=Be(o.result);else if(o instanceof Oa){for(const u of o.args)if(i=Be(u),i)break}else(o instanceof zo||o instanceof cr)&&o.input instanceof rs&&o.input.name==="zoom"&&(i=o);return i instanceof kn||o.eachChild(u=>{const g=Be(u);g instanceof kn?i=g:!i&&g?i=new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&g&&i!==g&&(i=new kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Ke(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!Ke(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const mt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zt(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Ke(o)||(o=bn(o));const i=L(o,mt);if(i.result==="error")throw new Error(i.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,g,v)=>i.value.evaluate(u,g,{},v),needGeometry:gn(o)}}function Nt(o,i){return o<i?-1:o>i?1:0}function gn(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let i=1;i<o.length;i++)if(gn(o[i]))return!0;return!1}function bn(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?Rn(o[1],o[2],"=="):i==="!="?li(Rn(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Rn(o[1],o[2],i):i==="any"?(u=o.slice(1),["any"].concat(u.map(bn))):i==="all"?["all"].concat(o.slice(1).map(bn)):i==="none"?["all"].concat(o.slice(1).map(bn).map(li)):i==="in"?ti(o[1],o.slice(2)):i==="!in"?li(ti(o[1],o.slice(2))):i==="has"?mi(o[1]):i!=="!has"||li(mi(o[1]));var u}function Rn(o,i,u){switch(o){case"$type":return[`filter-type-${u}`,i];case"$id":return[`filter-id-${u}`,i];default:return[`filter-${u}`,o,i]}}function ti(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(u=>typeof u!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Nt)]]:["filter-in-small",o,["literal",i]]}}function mi(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function li(o){return["!",o]}function er(o){const i=typeof o;if(i==="number"||i==="boolean"||i==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let v="[";for(const E of o)v+=`${er(E)},`;return`${v}]`}const u=Object.keys(o).sort();let g="{";for(let v=0;v<u.length;v++)g+=`${JSON.stringify(u[v])}:${er(o[u[v]])},`;return`${g}}`}function ss(o){let i="";for(const u of kt)i+=`/${er(o[u])}`;return i}function Ms(o){const i=o.value;return i?[new ct(o.key,i,"constants have been deprecated as of v8")]:[]}function fi(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Rr(o){if(Array.isArray(o))return o.map(Rr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const u in o)i[u]=Rr(o[u]);return i}return fi(o)}function dr(o){const i=o.key,u=o.value,g=o.valueSpec||{},v=o.objectElementValidators||{},E=o.style,A=o.styleSpec,M=o.validateSpec;let P=[];const F=$n(u);if(F!=="object")return[new ct(i,u,`object expected, ${F} found`)];for(const j in u){const G=j.split(".")[0],W=g[G]||g["*"];let te;if(v[G])te=v[G];else if(g[G])te=M;else if(v["*"])te=v["*"];else{if(!g["*"]){P.push(new ct(i,u[j],`unknown property "${j}"`));continue}te=M}P=P.concat(te({key:(i&&`${i}.`)+j,value:u[j],valueSpec:W,style:E,styleSpec:A,object:u,objectKey:j,validateSpec:M},u))}for(const j in g)v[j]||g[j].required&&g[j].default===void 0&&u[j]===void 0&&P.push(new ct(i,u,`missing required property "${j}"`));return P}function Rs(o){const i=o.value,u=o.valueSpec,g=o.style,v=o.styleSpec,E=o.key,A=o.arrayElementValidator||o.validateSpec;if($n(i)!=="array")return[new ct(E,i,`array expected, ${$n(i)} found`)];if(u.length&&i.length!==u.length)return[new ct(E,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new ct(E,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let M={type:u.value,values:u.values};v.$version<7&&(M.function=u.function),$n(u.value)==="object"&&(M=u.value);let P=[];for(let F=0;F<i.length;F++)P=P.concat(A({array:i,arrayIndex:F,value:i[F],valueSpec:M,validateSpec:o.validateSpec,style:g,styleSpec:v,key:`${E}[${F}]`}));return P}function Wa(o){const i=o.key,u=o.value,g=o.valueSpec;let v=$n(u);return v==="number"&&u!=u&&(v="NaN"),v!=="number"?[new ct(i,u,`number expected, ${v} found`)]:"minimum"in g&&u<g.minimum?[new ct(i,u,`${u} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&u>g.maximum?[new ct(i,u,`${u} is greater than the maximum value ${g.maximum}`)]:[]}function xa(o){const i=o.valueSpec,u=fi(o.value.type);let g,v,E,A={};const M=u!=="categorical"&&o.value.property===void 0,P=!M,F=$n(o.value.stops)==="array"&&$n(o.value.stops[0])==="array"&&$n(o.value.stops[0][0])==="object",j=dr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(te){if(u==="identity")return[new ct(te.key,te.value,'identity function may not have a "stops" property')];let re=[];const de=te.value;return re=re.concat(Rs({key:te.key,value:de,valueSpec:te.valueSpec,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:G})),$n(de)==="array"&&de.length===0&&re.push(new ct(te.key,de,"array must have at least one stop")),re},default:function(te){return te.validateSpec({key:te.key,value:te.value,valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec})}}});return u==="identity"&&M&&j.push(new ct(o.key,o.value,'missing required property "property"')),u==="identity"||o.value.stops||j.push(new ct(o.key,o.value,'missing required property "stops"')),u==="exponential"&&o.valueSpec.expression&&!Fl(o.valueSpec)&&j.push(new ct(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(P&&!Eo(o.valueSpec)?j.push(new ct(o.key,o.value,"property functions not supported")):M&&!zl(o.valueSpec)&&j.push(new ct(o.key,o.value,"zoom functions not supported"))),u!=="categorical"&&!F||o.value.property!==void 0||j.push(new ct(o.key,o.value,'"property" property is required')),j;function G(te){let re=[];const de=te.value,Te=te.key;if($n(de)!=="array")return[new ct(Te,de,`array expected, ${$n(de)} found`)];if(de.length!==2)return[new ct(Te,de,`array length 2 expected, length ${de.length} found`)];if(F){if($n(de[0])!=="object")return[new ct(Te,de,`object expected, ${$n(de[0])} found`)];if(de[0].zoom===void 0)return[new ct(Te,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new ct(Te,de,"object stop key must have value")];if(E&&E>fi(de[0].zoom))return[new ct(Te,de[0].zoom,"stop zoom values must appear in ascending order")];fi(de[0].zoom)!==E&&(E=fi(de[0].zoom),v=void 0,A={}),re=re.concat(dr({key:`${Te}[0]`,value:de[0],valueSpec:{zoom:{}},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:Wa,value:W}}))}else re=re.concat(W({key:`${Te}[0]`,value:de[0],valueSpec:{},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec},de));return b(Rr(de[1]))?re.concat([new ct(`${Te}[1]`,de[1],"expressions are not allowed in function stops.")]):re.concat(te.validateSpec({key:`${Te}[1]`,value:de[1],valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec}))}function W(te,re){const de=$n(te.value),Te=fi(te.value),Pe=te.value!==null?te.value:re;if(g){if(de!==g)return[new ct(te.key,Pe,`${de} stop domain type must match previous stop domain type ${g}`)]}else g=de;if(de!=="number"&&de!=="string"&&de!=="boolean")return[new ct(te.key,Pe,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&u!=="categorical"){let nt=`number expected, ${de} found`;return Eo(i)&&u===void 0&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(te.key,Pe,nt)]}return u!=="categorical"||de!=="number"||isFinite(Te)&&Math.floor(Te)===Te?u!=="categorical"&&de==="number"&&v!==void 0&&Te<v?[new ct(te.key,Pe,"stop domain values must appear in ascending order")]:(v=Te,u==="categorical"&&Te in A?[new ct(te.key,Pe,"stop domain values must be unique")]:(A[Te]=!0,[])):[new ct(te.key,Pe,`integer expected, found ${Te}`)]}}function lo(o){const i=(o.expressionContext==="property"?$:L)(Rr(o.value),o.valueSpec);if(i.result==="error")return i.value.map(g=>new ct(`${o.key}${g.key}`,o.value,g.message));const u=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!u.outputDefined())return[new ct(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Wo(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Wo(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Ko(u,["zoom","feature-state"]))return[new ct(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Xo(u))return[new ct(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ws(o){const i=o.key,u=o.value,g=o.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(fi(u))===-1&&v.push(new ct(i,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(fi(u))===-1&&v.push(new ct(i,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Ec(o){return Ke(Rr(o.value))?lo(yr({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):gu(o)}function gu(o){const i=o.value,u=o.key;if($n(i)!=="array")return[new ct(u,i,`array expected, ${$n(i)} found`)];const g=o.styleSpec;let v,E=[];if(i.length<1)return[new ct(u,i,"filter array must have at least 1 element")];switch(E=E.concat(ws({key:`${u}[0]`,value:i[0],valueSpec:g.filter_operator,style:o.style,styleSpec:o.styleSpec})),fi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&fi(i[1])==="$type"&&E.push(new ct(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&E.push(new ct(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=$n(i[1]),v!=="string"&&E.push(new ct(`${u}[1]`,i[1],`string expected, ${v} found`)));for(let A=2;A<i.length;A++)v=$n(i[A]),fi(i[1])==="$type"?E=E.concat(ws({key:`${u}[${A}]`,value:i[A],valueSpec:g.geometry_type,style:o.style,styleSpec:o.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new ct(`${u}[${A}]`,i[A],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let A=1;A<i.length;A++)E=E.concat(gu({key:`${u}[${A}]`,value:i[A],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":v=$n(i[1]),i.length!==2?E.push(new ct(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new ct(`${u}[1]`,i[1],`string expected, ${v} found`))}return E}function Ac(o,i){const u=o.key,g=o.validateSpec,v=o.style,E=o.styleSpec,A=o.value,M=o.objectKey,P=E[`${i}_${o.layerType}`];if(!P)return[];const F=M.match(/^(.*)-transition$/);if(i==="paint"&&F&&P[F[1]]&&P[F[1]].transition)return g({key:u,value:A,valueSpec:E.transition,style:v,styleSpec:E});const j=o.valueSpec||P[M];if(!j)return[new ct(u,A,`unknown property "${M}"`)];let G;if($n(A)==="string"&&Eo(j)&&!j.tokens&&(G=/^{([^}]+)}$/.exec(A)))return[new ct(u,A,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const W=[];return o.layerType==="symbol"&&(M==="text-field"&&v&&!v.glyphs&&W.push(new ct(u,A,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Gs(Rr(A))&&fi(A.type)==="identity"&&W.push(new ct(u,A,'"text-font" does not support identity functions'))),W.concat(g({key:o.key,value:A,valueSpec:j,style:v,styleSpec:E,expressionContext:"property",propertyType:i,propertyKey:M}))}function _u(o){return Ac(o,"paint")}function Tc(o){return Ac(o,"layout")}function Cc(o){let i=[];const u=o.value,g=o.key,v=o.style,E=o.styleSpec;u.type||u.ref||i.push(new ct(g,u,'either "type" or "ref" is required'));let A=fi(u.type);const M=fi(u.ref);if(u.id){const P=fi(u.id);for(let F=0;F<o.arrayIndex;F++){const j=v.layers[F];fi(j.id)===P&&i.push(new ct(g,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let P;["type","source","source-layer","filter","layout"].forEach(F=>{F in u&&i.push(new ct(g,u[F],`"${F}" is prohibited for ref layers`))}),v.layers.forEach(F=>{fi(F.id)===M&&(P=F)}),P?P.ref?i.push(new ct(g,u.ref,"ref cannot reference another ref layer")):A=fi(P.type):i.push(new ct(g,u.ref,`ref layer "${M}" not found`))}else if(A!=="background")if(u.source){const P=v.sources&&v.sources[u.source],F=P&&fi(P.type);P?F==="vector"&&A==="raster"?i.push(new ct(g,u.source,`layer "${u.id}" requires a raster source`)):F!=="raster-dem"&&A==="hillshade"?i.push(new ct(g,u.source,`layer "${u.id}" requires a raster-dem source`)):F==="raster"&&A!=="raster"?i.push(new ct(g,u.source,`layer "${u.id}" requires a vector source`)):F!=="vector"||u["source-layer"]?F==="raster-dem"&&A!=="hillshade"?i.push(new ct(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!u.paint||!u.paint["line-gradient"]||F==="geojson"&&P.lineMetrics||i.push(new ct(g,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ct(g,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new ct(g,u.source,`source "${u.source}" not found`))}else i.push(new ct(g,u,'missing required property "source"'));return i=i.concat(dr({key:g,value:u,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${g}.type`,value:u.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:u,objectKey:"type"}),filter:Ec,layout:P=>dr({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":F=>Tc(yr({layerType:A},F))}}),paint:P=>dr({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":F=>_u(yr({layerType:A},F))}})}})),i}function wa(o){const i=o.value,u=o.key,g=$n(i);return g!=="string"?[new ct(u,i,`string expected, ${g} found`)]:[]}const yu={promoteId:function({key:o,value:i}){if($n(i)==="string")return wa({key:o,value:i});{const u=[];for(const g in i)u.push(...wa({key:`${o}.${g}`,value:i[g]}));return u}}};function Bl(o){const i=o.value,u=o.key,g=o.styleSpec,v=o.style,E=o.validateSpec;if(!i.type)return[new ct(u,i,'"type" is required')];const A=fi(i.type);let M;switch(A){case"vector":case"raster":return M=dr({key:u,value:i,valueSpec:g[`source_${A.replace("-","_")}`],style:o.style,styleSpec:g,objectElementValidators:yu,validateSpec:E}),M;case"raster-dem":return M=function(P){var F;const j=(F=P.sourceName)!==null&&F!==void 0?F:"",G=P.value,W=P.styleSpec,te=W.source_raster_dem,re=P.style;let de=[];const Te=$n(G);if(G===void 0)return de;if(Te!=="object")return de.push(new ct("source_raster_dem",G,`object expected, ${Te} found`)),de;const Pe=fi(G.encoding)==="custom",nt=["redFactor","greenFactor","blueFactor","baseShift"],Ge=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Qe in G)!Pe&&nt.includes(Qe)?de.push(new ct(Qe,G[Qe],`In "${j}": "${Qe}" is only valid when "encoding" is set to "custom". ${Ge} encoding found`)):te[Qe]?de=de.concat(P.validateSpec({key:Qe,value:G[Qe],valueSpec:te[Qe],validateSpec:P.validateSpec,style:re,styleSpec:W})):de.push(new ct(Qe,G[Qe],`unknown property "${Qe}"`));return de}({sourceName:u,value:i,style:o.style,styleSpec:g,validateSpec:E}),M;case"geojson":if(M=dr({key:u,value:i,valueSpec:g.source_geojson,style:v,styleSpec:g,validateSpec:E,objectElementValidators:yu}),i.cluster)for(const P in i.clusterProperties){const[F,j]=i.clusterProperties[P],G=typeof F=="string"?[F,["accumulated"],["get",P]]:F;M.push(...lo({key:`${u}.${P}.map`,value:j,validateSpec:E,expressionContext:"cluster-map"})),M.push(...lo({key:`${u}.${P}.reduce`,value:G,validateSpec:E,expressionContext:"cluster-reduce"}))}return M;case"video":return dr({key:u,value:i,valueSpec:g.source_video,style:v,validateSpec:E,styleSpec:g});case"image":return dr({key:u,value:i,valueSpec:g.source_image,style:v,validateSpec:E,styleSpec:g});case"canvas":return[new ct(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ws({key:`${u}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:E,styleSpec:g})}}function Lc(o){const i=o.value,u=o.styleSpec,g=u.light,v=o.style;let E=[];const A=$n(i);if(i===void 0)return E;if(A!=="object")return E=E.concat([new ct("light",i,`object expected, ${A} found`)]),E;for(const M in i){const P=M.match(/^(.*)-transition$/);E=E.concat(P&&g[P[1]]&&g[P[1]].transition?o.validateSpec({key:M,value:i[M],valueSpec:u.transition,validateSpec:o.validateSpec,style:v,styleSpec:u}):g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)])}return E}function Mc(o){const i=o.value,u=o.styleSpec,g=u.sky,v=o.style,E=$n(i);if(i===void 0)return[];if(E!=="object")return[new ct("sky",i,`object expected, ${E} found`)];let A=[];for(const M in i)A=A.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)]);return A}function Rc(o){const i=o.value,u=o.styleSpec,g=u.terrain,v=o.style;let E=[];const A=$n(i);if(i===void 0)return E;if(A!=="object")return E=E.concat([new ct("terrain",i,`object expected, ${A} found`)]),E;for(const M in i)E=E.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)]);return E}function Pc(o){let i=[];const u=o.value,g=o.key;if(Array.isArray(u)){const v=[],E=[];for(const A in u)u[A].id&&v.includes(u[A].id)&&i.push(new ct(g,u,`all the sprites' ids must be unique, but ${u[A].id} is duplicated`)),v.push(u[A].id),u[A].url&&E.includes(u[A].url)&&i.push(new ct(g,u,`all the sprites' URLs must be unique, but ${u[A].url} is duplicated`)),E.push(u[A].url),i=i.concat(dr({key:`${g}[${A}]`,value:u[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return i}return wa({key:g,value:u})}const vu={"*":()=>[],array:Rs,boolean:function(o){const i=o.value,u=o.key,g=$n(i);return g!=="boolean"?[new ct(u,i,`boolean expected, ${g} found`)]:[]},number:Wa,color:function(o){const i=o.key,u=o.value,g=$n(u);return g!=="string"?[new ct(i,u,`color expected, ${g} found`)]:Qn.parse(String(u))?[]:[new ct(i,u,`color expected, "${u}" found`)]},constants:Ms,enum:ws,filter:Ec,function:xa,layer:Cc,object:dr,source:Bl,light:Lc,sky:Mc,terrain:Rc,projection:function(o){const i=o.value,u=o.styleSpec,g=u.projection,v=o.style,E=$n(i);if(i===void 0)return[];if(E!=="object")return[new ct("projection",i,`object expected, ${E} found`)];let A=[];for(const M in i)A=A.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)]);return A},string:wa,formatted:function(o){return wa(o).length===0?[]:lo(o)},resolvedImage:function(o){return wa(o).length===0?[]:lo(o)},padding:function(o){const i=o.key,u=o.value;if($n(u)==="array"){if(u.length<1||u.length>4)return[new ct(i,u,`padding requires 1 to 4 values; ${u.length} values found`)];const g={type:"number"};let v=[];for(let E=0;E<u.length;E++)v=v.concat(o.validateSpec({key:`${i}[${E}]`,value:u[E],validateSpec:o.validateSpec,valueSpec:g}));return v}return Wa({key:i,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const i=o.key,u=o.value,g=$n(u),v=o.styleSpec;if(g!=="array"||u.length<1||u.length%2!=0)return[new ct(i,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let A=0;A<u.length;A+=2)E=E.concat(ws({key:`${i}[${A}]`,value:u[A],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(Rs({key:`${i}[${A+1}]`,value:u[A+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:v}));return E},sprite:Pc};function Ka(o){const i=o.value,u=o.valueSpec,g=o.styleSpec;return o.validateSpec=Ka,u.expression&&Gs(fi(i))?xa(o):u.expression&&b(Rr(i))?lo(o):u.type&&vu[u.type]?vu[u.type](o):dr(yr({},o,{valueSpec:u.type?g[u.type]:u}))}function Bh(o){const i=o.value,u=o.key,g=wa(o);return g.length||(i.indexOf("{fontstack}")===-1&&g.push(new ct(u,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&g.push(new ct(u,i,'"glyphs" url must include a "{range}" token'))),g}function Ps(o,i=$e){let u=[];return u=u.concat(Ka({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,validateSpec:Ka,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),o.constants&&(u=u.concat(Ms({key:"constants",value:o.constants,style:o,styleSpec:i,validateSpec:Ka}))),Dc(u)}function uo(o){return function(i){return o({...i,validateSpec:Ka})}}function Dc(o){return[].concat(o).sort((i,u)=>i.line-u.line)}function Zs(o){return function(...i){return Dc(o.apply(this,i))}}Ps.source=Zs(uo(Bl)),Ps.sprite=Zs(uo(Pc)),Ps.glyphs=Zs(uo(Bh)),Ps.light=Zs(uo(Lc)),Ps.sky=Zs(uo(Mc)),Ps.terrain=Zs(uo(Rc)),Ps.layer=Zs(uo(Cc)),Ps.filter=Zs(uo(Ec)),Ps.paintProperty=Zs(uo(_u)),Ps.layoutProperty=Zs(uo(Tc));const ka=Ps,sd=ka.light,od=ka.sky,Uh=ka.paintProperty,jh=ka.layoutProperty;function Nc(o,i){let u=!1;if(i&&i.length)for(const g of i)o.fire(new Ye(new Error(g.message))),u=!0;return u}class $a{constructor(i,u,g){const v=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const A=new Int32Array(this.arrayBuffer);i=A[0],this.d=(u=A[1])+2*(g=A[2]);for(let P=0;P<this.d*this.d;P++){const F=A[3+P],j=A[3+P+1];v.push(F===j?null:A.subarray(F,j))}const M=A[3+v.length+1];this.keys=A.subarray(A[3+v.length],M),this.bboxes=A.subarray(M),this.insert=this._insertReadonly}else{this.d=u+2*g;for(let A=0;A<this.d*this.d;A++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=g,this.scale=u/i,this.uid=0;const E=g/u*i;this.min=-E,this.max=i+E}insert(i,u,g,v,E){this._forEachCell(u,g,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,u,g,v,E,A){this.cells[E].push(A)}query(i,u,g,v,E){const A=this.min,M=this.max;if(i<=A&&u<=A&&M<=g&&M<=v&&!E)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(i,u,g,v,this._queryCell,P,{},E),P}}_queryCell(i,u,g,v,E,A,M,P){const F=this.cells[E];if(F!==null){const j=this.keys,G=this.bboxes;for(let W=0;W<F.length;W++){const te=F[W];if(M[te]===void 0){const re=4*te;(P?P(G[re+0],G[re+1],G[re+2],G[re+3]):i<=G[re+2]&&u<=G[re+3]&&g>=G[re+0]&&v>=G[re+1])?(M[te]=!0,A.push(j[te])):M[te]=!1}}}}_forEachCell(i,u,g,v,E,A,M,P){const F=this._convertToCellCoord(i),j=this._convertToCellCoord(u),G=this._convertToCellCoord(g),W=this._convertToCellCoord(v);for(let te=F;te<=G;te++)for(let re=j;re<=W;re++){const de=this.d*re+te;if((!P||P(this._convertFromCellCoord(te),this._convertFromCellCoord(re),this._convertFromCellCoord(te+1),this._convertFromCellCoord(re+1)))&&E.call(this,i,u,g,v,de,A,M,P))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,u=3+this.cells.length+1+1;let g=0;for(let A=0;A<this.cells.length;A++)g+=this.cells[A].length;const v=new Int32Array(u+g+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=u;for(let A=0;A<i.length;A++){const M=i[A];v[3+A]=E,v.set(M,E),E+=M.length}return v[3+i.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+i.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(i,u){const g=i.toArrayBuffer();return u&&u.push(g),{buffer:g}}static deserialize(i){return new $a(i.buffer)}}const Ds={};function Qt(o,i,u={}){if(Ds[o])throw new Error(`${o} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),Ds[o]={klass:i,omit:u.omit||[],shallow:u.shallow||[]}}Qt("Object",Object),Qt("TransferableGridIndex",$a),Qt("Color",Qn),Qt("Error",Error),Qt("AJAXError",Dn),Qt("ResolvedImage",or),Qt("StylePropertyFunction",me),Qt("StyleExpression",p,{omit:["_evaluator"]}),Qt("ZoomDependentExpression",V),Qt("ZoomConstantExpression",O),Qt("CompoundExpression",rs,{omit:["_evaluate"]});for(const o in Zo)Zo[o]._classRegistryKey||Qt(`Expression_${o}`,Zo[o]);function bu(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function zc(o){return o.$name||o.constructor._classRegistryKey}function qh(o){return!function(i){if(i===null||typeof i!="object")return!1;const u=zc(i);return!(!u||u==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||bu(o)||dt(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Ya(o,i){if(qh(o))return(bu(o)||dt(o))&&i&&i.push(o),ArrayBuffer.isView(o)&&i&&i.push(o.buffer),o instanceof ImageData&&i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const E=[];for(const A of o)E.push(Ya(A,i));return E}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const u=zc(o);if(!u)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Ds[u])throw new Error(`${u} is not registered.`);const{klass:g}=Ds[u],v=g.serialize?g.serialize(o,i):{};if(g.serialize){if(i&&v===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in o){if(!o.hasOwnProperty(E)||Ds[u].omit.indexOf(E)>=0)continue;const A=o[E];v[E]=Ds[u].shallow.indexOf(E)>=0?A:Ya(A,i)}o instanceof Error&&(v.message=o.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(v.$name=u),v}function Ja(o){if(qh(o))return o;if(Array.isArray(o))return o.map(Ja);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const i=zc(o)||"Object";if(!Ds[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:u}=Ds[i];if(!u)throw new Error(`can't deserialize unregistered class ${i}`);if(u.deserialize)return u.deserialize(o);const g=Object.create(u.prototype);for(const v of Object.keys(o)){if(v==="$name")continue;const E=o[v];g[v]=Ds[i].shallow.indexOf(v)>=0?E:Ja(E)}return g}class Fc{constructor(){this.first=!0}update(i,u){const g=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=u),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=g,!0))}}const Gn={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Oc(o){for(const i of o)if(Uc(i.charCodeAt(0)))return!0;return!1}function ad(o){for(const i of o)if(!Qa(i.charCodeAt(0)))return!1;return!0}function Bc(o){const i=o.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(i.join("|"),"u")}const ld=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qa(o){return!ld.test(String.fromCodePoint(o))}const Vh=Bc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Uc(o){return!(o!==746&&o!==747&&(o<4352||!(Gn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Gn["CJK Compatibility"](o)||Gn["CJK Strokes"](o)||!(!Gn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Gn["Enclosed CJK Letters and Months"](o)||Gn["Ideographic Description Characters"](o)||Gn.Kanbun(o)||Gn.Katakana(o)&&o!==12540||!(!Gn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Gn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Gn["Vertical Forms"](o)||Gn["Yijing Hexagram Symbols"](o)||/\p{sc=Cans}/u.test(String.fromCodePoint(o))||/\p{sc=Hang}/u.test(String.fromCodePoint(o))||Vh.test(String.fromCodePoint(o)))))}function Gh(o){return!(Uc(o)||function(i){return!!(Gn["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Gn["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Gn["Letterlike Symbols"](i)||Gn["Number Forms"](i)||Gn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Gn["Control Pictures"](i)&&i!==9251||Gn["Optical Character Recognition"](i)||Gn["Enclosed Alphanumerics"](i)||Gn["Geometric Shapes"](i)||Gn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Gn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Gn["CJK Symbols and Punctuation"](i)||Gn.Katakana(i)||Gn["Private Use Area"](i)||Gn["CJK Compatibility Forms"](i)||Gn["Small Form Variants"](i)||Gn["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}const ud=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function jc(o){return ud.test(String.fromCodePoint(o))}function cd(o,i){return!(!i&&jc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Gn.Khmer(o))}function hd(o){for(const i of o)if(jc(i.charCodeAt(0)))return!0;return!1}const ks=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ii{constructor(i,u){this.zoom=i,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fc,this.transition={})}isSupportedScript(i){return function(u,g){for(const v of u)if(!cd(v.charCodeAt(0),g))return!1;return!0}(i,ks.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,u=i-Math.floor(i),g=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*u}}}class el{constructor(i,u){this.property=i,this.value=u,this.expression=function(g,v){if(Gs(g))return new me(g,v);if(b(g)){const E=$(g,v);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));return E.value}{let E=g;return v.type==="color"&&typeof g=="string"?E=Qn.parse(g):v.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(g)&&(E=Ri.parse(g)):E=Nr.parse(g),{kind:"constant",evaluate:()=>E}}}(u===void 0?i.specification.default:u,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,u,g){return this.property.possiblyEvaluate(this,i,u,g)}}class xu{constructor(i){this.property=i,this.value=new el(i,void 0)}transitioned(i,u){return new Zh(this.property,this.value,u,he({},i.transition,this.transition),i.now)}untransitioned(){return new Zh(this.property,this.value,null,{},0)}}class wu{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return we(this._values[i].value.value)}setValue(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new xu(this._values[i].property)),this._values[i].value=new el(this._values[i].property,u===null?void 0:we(u))}getTransition(i){return we(this._values[i].transition)}setTransition(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new xu(this._values[i].property)),this._values[i].transition=we(u)||void 0}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g);const v=this.getTransition(u);v!==void 0&&(i[`${u}-transition`]=v)}return i}transitioned(i,u){const g=new Ul(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].transitioned(i,u._values[v]);return g}untransitioned(){const i=new Ul(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].untransitioned();return i}}class Zh{constructor(i,u,g,v,E){this.property=i,this.value=u,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,i.specification.transition&&(v.delay||v.duration)&&(this.prior=g)}possiblyEvaluate(i,u,g){const v=i.now||0,E=this.value.possiblyEvaluate(i,u,g),A=this.prior;if(A){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return A.possiblyEvaluate(i,u,g);{const M=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(i,u,g),E,function(P){if(P<=0)return 0;if(P>=1)return 1;const F=P*P,j=F*P;return 4*(P<.5?j:3*(P-F)+j-.75)}(M))}}return E}}class Ul{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,u,g){const v=new ql(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class jl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return we(this._values[i].value)}setValue(i,u){this._values[i]=new el(this._values[i].property,u===null?void 0:we(u))}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g)}return i}possiblyEvaluate(i,u,g){const v=new ql(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}}class co{constructor(i,u,g){this.property=i,this.value=u,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,u,g,v){return this.property.evaluate(this.value,this.parameters,i,u,g,v)}}class ql{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class nn{constructor(i){this.specification=i}possiblyEvaluate(i,u){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(u)}interpolate(i,u,g){const v=bi[this.specification.type];return v?v(i,u,g):i}}class vn{constructor(i,u){this.specification=i,this.overrides=u}possiblyEvaluate(i,u,g,v){return new co(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(u,null,{},g,v)}:i.expression,u)}interpolate(i,u,g){if(i.value.kind!=="constant"||u.value.kind!=="constant")return i;if(i.value.value===void 0||u.value.value===void 0)return new co(this,{kind:"constant",value:void 0},i.parameters);const v=bi[this.specification.type];if(v){const E=v(i.value.value,u.value.value,g);return new co(this,{kind:"constant",value:E},i.parameters)}return i}evaluate(i,u,g,v,E,A){return i.kind==="constant"?i.value:i.evaluate(u,g,v,E,A)}}class ku extends vn{possiblyEvaluate(i,u,g,v){if(i.value===void 0)return new co(this,{kind:"constant",value:void 0},u);if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v),A=i.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,M=this._calculate(A,A,A,u);return new co(this,{kind:"constant",value:M},u)}if(i.expression.kind==="camera"){const E=this._calculate(i.expression.evaluate({zoom:u.zoom-1}),i.expression.evaluate({zoom:u.zoom}),i.expression.evaluate({zoom:u.zoom+1}),u);return new co(this,{kind:"constant",value:E},u)}return new co(this,i.expression,u)}evaluate(i,u,g,v,E,A){if(i.kind==="source"){const M=i.evaluate(u,g,v,E,A);return this._calculate(M,M,M,u)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(u.zoom)-1},g,v),i.evaluate({zoom:Math.floor(u.zoom)},g,v),i.evaluate({zoom:Math.floor(u.zoom)+1},g,v),u):i.value}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class Iu{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){if(i.value!==void 0){if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v);return this._calculate(E,E,E,u)}return this._calculate(i.expression.evaluate(new Ii(Math.floor(u.zoom-1),u)),i.expression.evaluate(new Ii(Math.floor(u.zoom),u)),i.expression.evaluate(new Ii(Math.floor(u.zoom+1),u)),u)}}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class qc{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){return!!i.expression.evaluate(u,null,{},g,v)}interpolate(){return!1}}class k{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in i){const g=i[u];g.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new el(g,void 0),E=this.defaultTransitionablePropertyValues[u]=new xu(g);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate({})}}}Qt("DataDrivenProperty",vn),Qt("DataConstantProperty",nn),Qt("CrossFadedDataDrivenProperty",ku),Qt("CrossFadedProperty",Iu),Qt("ColorRampProperty",qc);const t="-transition";class f extends Ct{constructor(i,u){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),u.layout&&(this._unevaluatedLayout=new jl(u.layout)),u.paint)){this._transitionablePaint=new wu(u.paint);for(const g in i.paint)this.setPaintProperty(g,i.paint[g],{validate:!1});for(const g in i.layout)this.setLayoutProperty(g,i.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ql(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,u,g={}){u!=null&&this._validate(jh,`layers.${this.id}.layout.${i}`,i,u,g)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,u):this.visibility=u)}getPaintProperty(i){return i.endsWith(t)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,u,g={}){if(u!=null&&this._validate(Uh,`layers.${this.id}.paint.${i}`,i,u,g))return!1;if(i.endsWith(t))return this._transitionablePaint.setTransition(i.slice(0,-11),u||void 0),!1;{const v=this._transitionablePaint._values[i],E=v.property.specification["property-type"]==="cross-faded-data-driven",A=v.value.isDataDriven(),M=v.value;this._transitionablePaint.setValue(i,u),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||A||E||this._handleOverridablePaintPropertyUpdate(i,M,P)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,u,g){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,u){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,u)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Ce(i,(u,g)=>!(u===void 0||g==="layout"&&!Object.keys(u).length||g==="paint"&&!Object.keys(u).length))}_validate(i,u,g,v,E={}){return(!E||E.validate!==!1)&&Nc(this,i.call(ka,{key:u,layerType:this.type,objectKey:g,value:v,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const u=this.paint.get(i);if(u instanceof co&&Eo(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const _={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class y{constructor(i,u){this._structArray=i,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class w{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,u){return i._trim(),u&&(i.isTransferred=!0,u.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const u=Object.create(this.prototype);return u.arrayBuffer=i.arrayBuffer,u.length=i.length,u.capacity=i.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function R(o,i=1){let u=0,g=0;return{members:o.map(v=>{const E=_[v.type].BYTES_PER_ELEMENT,A=u=D(u,Math.max(i,E)),M=v.components||1;return g=Math.max(g,E),u+=E*M,{name:v.name,type:v.type,components:M,offset:A}}),size:D(u,Math.max(g,i)),alignment:i}}function D(o,i){return Math.ceil(o/i)*i}class z extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.int16[v+0]=u,this.int16[v+1]=g,i}}z.prototype.bytesPerElement=4,Qt("StructArrayLayout2i4",z);class q extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.int16[E+0]=u,this.int16[E+1]=g,this.int16[E+2]=v,i}}q.prototype.bytesPerElement=6,Qt("StructArrayLayout3i6",q);class H extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const A=4*i;return this.int16[A+0]=u,this.int16[A+1]=g,this.int16[A+2]=v,this.int16[A+3]=E,i}}H.prototype.bytesPerElement=8,Qt("StructArrayLayout4i8",H);class X extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=6*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.int16[P+2]=v,this.int16[P+3]=E,this.int16[P+4]=A,this.int16[P+5]=M,i}}X.prototype.bytesPerElement=12,Qt("StructArrayLayout2i4i12",X);class ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=4*i,F=8*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.uint8[F+4]=v,this.uint8[F+5]=E,this.uint8[F+6]=A,this.uint8[F+7]=M,i}}ne.prototype.bytesPerElement=8,Qt("StructArrayLayout2i4ub8",ne);class ge extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.float32[v+0]=u,this.float32[v+1]=g,i}}ge.prototype.bytesPerElement=8,Qt("StructArrayLayout2f8",ge);class ke extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j){const G=this.length;return this.resize(G+1),this.emplace(G,i,u,g,v,E,A,M,P,F,j)}emplace(i,u,g,v,E,A,M,P,F,j,G){const W=10*i;return this.uint16[W+0]=u,this.uint16[W+1]=g,this.uint16[W+2]=v,this.uint16[W+3]=E,this.uint16[W+4]=A,this.uint16[W+5]=M,this.uint16[W+6]=P,this.uint16[W+7]=F,this.uint16[W+8]=j,this.uint16[W+9]=G,i}}ke.prototype.bytesPerElement=20,Qt("StructArrayLayout10ui20",ke);class Le extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,G,W){const te=this.length;return this.resize(te+1),this.emplace(te,i,u,g,v,E,A,M,P,F,j,G,W)}emplace(i,u,g,v,E,A,M,P,F,j,G,W,te){const re=12*i;return this.int16[re+0]=u,this.int16[re+1]=g,this.int16[re+2]=v,this.int16[re+3]=E,this.uint16[re+4]=A,this.uint16[re+5]=M,this.uint16[re+6]=P,this.uint16[re+7]=F,this.int16[re+8]=j,this.int16[re+9]=G,this.int16[re+10]=W,this.int16[re+11]=te,i}}Le.prototype.bytesPerElement=24,Qt("StructArrayLayout4i4ui4i24",Le);class Ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.float32[E+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}Ne.prototype.bytesPerElement=12,Qt("StructArrayLayout3f12",Ne);class ze extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint32[1*i+0]=u,i}}ze.prototype.bytesPerElement=4,Qt("StructArrayLayout1ul4",ze);class Ve extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F){const j=this.length;return this.resize(j+1),this.emplace(j,i,u,g,v,E,A,M,P,F)}emplace(i,u,g,v,E,A,M,P,F,j){const G=10*i,W=5*i;return this.int16[G+0]=u,this.int16[G+1]=g,this.int16[G+2]=v,this.int16[G+3]=E,this.int16[G+4]=A,this.int16[G+5]=M,this.uint32[W+3]=P,this.uint16[G+8]=F,this.uint16[G+9]=j,i}}Ve.prototype.bytesPerElement=20,Qt("StructArrayLayout6i1ul2ui20",Ve);class Ae extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=6*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.int16[P+2]=v,this.int16[P+3]=E,this.int16[P+4]=A,this.int16[P+5]=M,i}}Ae.prototype.bytesPerElement=12,Qt("StructArrayLayout2i2i2i12",Ae);class He extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,g,v,E)}emplace(i,u,g,v,E,A){const M=4*i,P=8*i;return this.float32[M+0]=u,this.float32[M+1]=g,this.float32[M+2]=v,this.int16[P+6]=E,this.int16[P+7]=A,i}}He.prototype.bytesPerElement=16,Qt("StructArrayLayout2f1f2i16",He);class Je extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=16*i,F=4*i,j=8*i;return this.uint8[P+0]=u,this.uint8[P+1]=g,this.float32[F+1]=v,this.float32[F+2]=E,this.int16[j+6]=A,this.int16[j+7]=M,i}}Je.prototype.bytesPerElement=16,Qt("StructArrayLayout2ub2f2i16",Je);class st extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[E+0]=u,this.uint16[E+1]=g,this.uint16[E+2]=v,i}}st.prototype.bytesPerElement=6,Qt("StructArrayLayout3ui6",st);class bt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Te,Pe){const nt=this.length;return this.resize(nt+1),this.emplace(nt,i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Te,Pe)}emplace(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Te,Pe,nt){const Ge=24*i,Qe=12*i,ht=48*i;return this.int16[Ge+0]=u,this.int16[Ge+1]=g,this.uint16[Ge+2]=v,this.uint16[Ge+3]=E,this.uint32[Qe+2]=A,this.uint32[Qe+3]=M,this.uint32[Qe+4]=P,this.uint16[Ge+10]=F,this.uint16[Ge+11]=j,this.uint16[Ge+12]=G,this.float32[Qe+7]=W,this.float32[Qe+8]=te,this.uint8[ht+36]=re,this.uint8[ht+37]=de,this.uint8[ht+38]=Te,this.uint32[Qe+10]=Pe,this.int16[Ge+22]=nt,i}}bt.prototype.bytesPerElement=48,Qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bt);class Pt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Te,Pe,nt,Ge,Qe,ht,Et,Kt,yn,Xt,Zt,on,tn){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Te,Pe,nt,Ge,Qe,ht,Et,Kt,yn,Xt,Zt,on,tn)}emplace(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Te,Pe,nt,Ge,Qe,ht,Et,Kt,yn,Xt,Zt,on,tn,Jt){const yt=32*i,cn=16*i;return this.int16[yt+0]=u,this.int16[yt+1]=g,this.int16[yt+2]=v,this.int16[yt+3]=E,this.int16[yt+4]=A,this.int16[yt+5]=M,this.int16[yt+6]=P,this.int16[yt+7]=F,this.uint16[yt+8]=j,this.uint16[yt+9]=G,this.uint16[yt+10]=W,this.uint16[yt+11]=te,this.uint16[yt+12]=re,this.uint16[yt+13]=de,this.uint16[yt+14]=Te,this.uint16[yt+15]=Pe,this.uint16[yt+16]=nt,this.uint16[yt+17]=Ge,this.uint16[yt+18]=Qe,this.uint16[yt+19]=ht,this.uint16[yt+20]=Et,this.uint16[yt+21]=Kt,this.uint16[yt+22]=yn,this.uint32[cn+12]=Xt,this.float32[cn+13]=Zt,this.float32[cn+14]=on,this.uint16[yt+30]=tn,this.uint16[yt+31]=Jt,i}}Pt.prototype.bytesPerElement=64,Qt("StructArrayLayout8i15ui1ul2f2ui64",Pt);class Ht extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.float32[1*i+0]=u,i}}Ht.prototype.bytesPerElement=4,Qt("StructArrayLayout1f4",Ht);class $t extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[6*i+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}$t.prototype.bytesPerElement=12,Qt("StructArrayLayout1ui2f12",$t);class jt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=4*i;return this.uint32[2*i+0]=u,this.uint16[E+2]=g,this.uint16[E+3]=v,i}}jt.prototype.bytesPerElement=8,Qt("StructArrayLayout1ul2ui8",jt);class Ut extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.uint16[v+0]=u,this.uint16[v+1]=g,i}}Ut.prototype.bytesPerElement=4,Qt("StructArrayLayout2ui4",Ut);class rn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint16[1*i+0]=u,i}}rn.prototype.bytesPerElement=2,Qt("StructArrayLayout1ui2",rn);class An extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const A=4*i;return this.float32[A+0]=u,this.float32[A+1]=g,this.float32[A+2]=v,this.float32[A+3]=E,i}}An.prototype.bytesPerElement=16,Qt("StructArrayLayout4f16",An);class Vt extends y{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}Vt.prototype.size=20;class Wt extends Ve{get(i){return new Vt(this,i)}}Qt("CollisionBoxArray",Wt);class In extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}In.prototype.size=48;class Si extends bt{get(i){return new In(this,i)}}Qt("PlacedSymbolArray",Si);class On extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}On.prototype.size=64;class jn extends Pt{get(i){return new On(this,i)}}Qt("SymbolInstanceArray",jn);class Ei extends Ht{getoffsetX(i){return this.float32[1*i+0]}}Qt("GlyphOffsetArray",Ei);class zr extends q{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Qt("SymbolLineVertexArray",zr);class Hs extends y{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Hs.prototype.size=12;class Ai extends $t{get(i){return new Hs(this,i)}}Qt("TextAnchorOffsetArray",Ai);class os extends y{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}os.prototype.size=8;class Xr extends jt{get(i){return new os(this,i)}}Qt("FeatureIndexArray",Xr);class Fr extends z{}class Wr extends z{}class ho extends z{}class tl extends X{}class Su extends ne{}class nl extends ge{}class Ns extends ke{}class Eu extends Le{}class Vc extends Ne{}class zs extends ze{}class Fs extends Ae{}class Jo extends Je{}class Xs extends st{}class Pr extends Ut{}const Or=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:Is}=Or;class Zn{constructor(i=[]){this.segments=i}prepareSegment(i,u,g,v){let E=this.segments[this.segments.length-1];return i>Zn.MAX_VERTEX_ARRAY_LENGTH&&Ue(`Max vertices per segment is ${Zn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!E||E.vertexLength+i>Zn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v)&&(E={vertexOffset:u.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0},v!==void 0&&(E.sortKey=v),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const i of this.segments)for(const u in i.vaos)i.vaos[u].destroy()}static simpleSegment(i,u,g,v){return new Zn([{vertexOffset:i,primitiveOffset:u,vertexLength:g,primitiveLength:v,vaos:{},sortKey:0}])}}function Ia(o,i){return 256*(o=ve(Math.floor(o),0,255))+ve(Math.floor(i),0,255)}Zn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt("SegmentVector",Zn);const il=R([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rl={exports:{}},Hh={exports:{}};Hh.exports=function(o,i){var u,g,v,E,A,M,P,F;for(g=o.length-(u=3&o.length),v=i,A=3432918353,M=461845907,F=0;F<g;)P=255&o.charCodeAt(F)|(255&o.charCodeAt(++F))<<8|(255&o.charCodeAt(++F))<<16|(255&o.charCodeAt(++F))<<24,++F,v=27492+(65535&(E=5*(65535&(v=(v^=P=(65535&(P=(P=(65535&P)*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(P=0,u){case 3:P^=(255&o.charCodeAt(F+2))<<16;case 2:P^=(255&o.charCodeAt(F+1))<<8;case 1:v^=P=(65535&(P=(P=(65535&(P^=255&o.charCodeAt(F)))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var fd=Hh.exports,Xh={exports:{}};Xh.exports=function(o,i){for(var u,g=o.length,v=i^g,E=0;g>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(u>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),g-=4,++E;switch(g){case 3:v^=(255&o.charCodeAt(E+2))<<16;case 2:v^=(255&o.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var Qo=fd,Wh=Xh.exports;rl.exports=Qo,rl.exports.murmur3=Qo,rl.exports.murmur2=Wh;var Au=x(rl.exports);class Vl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,u,g,v){this.ids.push(Tu(i)),this.positions.push(u,g,v)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Tu(i);let g=0,v=this.ids.length-1;for(;g<v;){const A=g+v>>1;this.ids[A]>=u?v=A:g=A+1}const E=[];for(;this.ids[g]===u;)E.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return E}static serialize(i,u){const g=new Float64Array(i.ids),v=new Uint32Array(i.positions);return Cu(g,v,0,g.length-1),u&&u.push(g.buffer,v.buffer),{ids:g,positions:v}}static deserialize(i){const u=new Vl;return u.ids=i.ids,u.positions=i.positions,u.indexed=!0,u}}function Tu(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Au(String(o))}function Cu(o,i,u,g){for(;u<g;){const v=o[u+g>>1];let E=u-1,A=g+1;for(;;){do E++;while(o[E]<v);do A--;while(o[A]>v);if(E>=A)break;sl(o,E,A),sl(i,3*E,3*A),sl(i,3*E+1,3*A+1),sl(i,3*E+2,3*A+2)}A-u<g-A?(Cu(o,i,u,A),u=A+1):(Cu(o,i,A+1,g),g=A)}}function sl(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}Qt("FeaturePositionMap",Vl);class Gl{constructor(i,u){this.gl=i.gl,this.location=u}}class Kh extends Gl{constructor(i,u){super(i,u),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class rm extends Gl{constructor(i,u){super(i,u),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class sm extends Gl{constructor(i,u){super(i,u),this.current=Qn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const n1=new Float32Array(16);function dd(o){return[Ia(255*o.r,255*o.g),Ia(255*o.b,255*o.a)]}class Gc{constructor(i,u,g){this.value=i,this.uniformNames=u.map(v=>`u_${v}`),this.type=g}setUniform(i,u,g){i.set(g.constantOr(this.value))}getBinding(i,u,g){return this.type==="color"?new sm(i,u):new Kh(i,u)}}class Lu{constructor(i,u){this.uniformNames=u.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=i.tlbr}setUniform(i,u,g,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&i.set(E)}getBinding(i,u,g){return g.substr(0,9)==="u_pattern"?new rm(i,u):new Kh(i,u)}}class Sa{constructor(i,u,g,v){this.expression=i,this.type=g,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,u,g,v,E){const A=this.paintVertexArray.length,M=this.expression.evaluate(new Ii(0),u,{},v,[],E);this.paintVertexArray.resize(i),this._setPaintValue(A,i,M)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:0},g,v);this._setPaintValue(i,u,E)}_setPaintValue(i,u,g){if(this.type==="color"){const v=dd(g);for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=i;v<u;v++)this.paintVertexArray.emplace(v,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ao{constructor(i,u,g,v,E,A){this.expression=i,this.uniformNames=u.map(M=>`u_${M}_t`),this.type=g,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(M=>({name:`a_${M}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new A}populatePaintArray(i,u,g,v,E){const A=this.expression.evaluate(new Ii(this.zoom),u,{},v,[],E),M=this.expression.evaluate(new Ii(this.zoom+1),u,{},v,[],E),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,A,M)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:this.zoom},g,v),A=this.expression.evaluate({zoom:this.zoom+1},g,v);this._setPaintValue(i,u,E,A)}_setPaintValue(i,u,g,v){if(this.type==="color"){const E=dd(g),A=dd(v);for(let M=i;M<u;M++)this.paintVertexArray.emplace(M,E[0],E[1],A[0],A[1])}else{for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,g,v);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(v))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,u){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=ve(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(v)}getBinding(i,u,g){return new Kh(i,u)}}class ol{constructor(i,u,g,v,E,A){this.expression=i,this.type=u,this.useIntegerZoom=g,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(i,u,g){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(v,i,u.patterns&&u.patterns[this.layerId],g)}updatePaintArray(i,u,g,v,E){this._setPaintValues(i,u,g.patterns&&g.patterns[this.layerId],E)}_setPaintValues(i,u,g,v){if(!v||!g)return;const{min:E,mid:A,max:M}=g,P=v[E],F=v[A],j=v[M];if(P&&F&&j)for(let G=i;G<u;G++)this.zoomInPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],F.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],F.pixelRatio,j.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,il.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,il.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class om{constructor(i,u,g){this.binders={},this._buffers=[];const v=[];for(const E in i.paint._values){if(!g(E))continue;const A=i.paint.get(E);if(!(A instanceof co&&Eo(A.property.specification)))continue;const M=i1(E,i.type),P=A.value,F=A.property.specification.type,j=A.property.useIntegerZoom,G=A.property.specification["property-type"],W=G==="cross-faded"||G==="cross-faded-data-driven";if(P.kind==="constant")this.binders[E]=W?new Lu(P.value,M):new Gc(P.value,M,F),v.push(`/u_${E}`);else if(P.kind==="source"||W){const te=am(E,F,"source");this.binders[E]=W?new ol(P,F,j,u,te,i.id):new Sa(P,M,F,te),v.push(`/a_${E}`)}else{const te=am(E,F,"composite");this.binders[E]=new Ao(P,M,F,j,u,te),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(i){const u=this.binders[i];return u instanceof Sa||u instanceof Ao?u.maxValue:0}populatePaintArrays(i,u,g,v,E){for(const A in this.binders){const M=this.binders[A];(M instanceof Sa||M instanceof Ao||M instanceof ol)&&M.populatePaintArray(i,u,g,v,E)}}setConstantPatternPositions(i,u){for(const g in this.binders){const v=this.binders[g];v instanceof Lu&&v.setConstantPatternPositions(i,u)}}updatePaintArrays(i,u,g,v,E){let A=!1;for(const M in i){const P=u.getPositions(M);for(const F of P){const j=g.feature(F.index);for(const G in this.binders){const W=this.binders[G];if((W instanceof Sa||W instanceof Ao||W instanceof ol)&&W.expression.isStateDependent===!0){const te=v.paint.get(G);W.expression=te.value,W.updatePaintArray(F.start,F.end,j,i[M],E),A=!0}}}}return A}defines(){const i=[];for(const u in this.binders){const g=this.binders[u];(g instanceof Gc||g instanceof Lu)&&i.push(...g.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return i}getBinderAttributes(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Sa||g instanceof Ao)for(let v=0;v<g.paintVertexAttributes.length;v++)i.push(g.paintVertexAttributes[v].name);else if(g instanceof ol)for(let v=0;v<il.members.length;v++)i.push(il.members[v].name)}return i}getBinderUniforms(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Gc||g instanceof Lu||g instanceof Ao)for(const v of g.uniformNames)i.push(v)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,u){const g=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof Gc||E instanceof Lu||E instanceof Ao){for(const A of E.uniformNames)if(u[A]){const M=E.getBinding(i,u[A],A);g.push({name:A,property:v,binding:M})}}}return g}setUniforms(i,u,g,v){for(const{name:E,property:A,binding:M}of u)this.binders[A].setUniform(M,v,g.get(A),E)}updatePaintBuffers(i){this._buffers=[];for(const u in this.binders){const g=this.binders[u];if(i&&g instanceof ol){const v=i.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(g instanceof Sa||g instanceof Ao)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(i){for(const u in this.binders){const g=this.binders[u];(g instanceof Sa||g instanceof Ao||g instanceof ol)&&g.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const u=this.binders[i];(u instanceof Sa||u instanceof Ao||u instanceof ol)&&u.destroy()}}}class Zl{constructor(i,u,g=()=>!0){this.programConfigurations={};for(const v of i)this.programConfigurations[v.id]=new om(v,u,g);this.needsUpload=!1,this._featureMap=new Vl,this._bufferOffset=0}populatePaintArrays(i,u,g,v,E,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,u,v,E,A);u.id!==void 0&&this._featureMap.add(u.id,g,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,u,g,v){for(const E of g)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,u,E,v)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function i1(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function am(o,i,u){const g={color:{source:ge,composite:An},number:{source:Ht,composite:ge}},v=function(E){return{"line-pattern":{source:Ns,composite:Ns},"fill-pattern":{source:Ns,composite:Ns},"fill-extrusion-pattern":{source:Ns,composite:Ns}}[E]}(o);return v&&v[u]||g[i][u]}Qt("ConstantBinder",Gc),Qt("CrossFadedConstantBinder",Lu),Qt("SourceExpressionBinder",Sa),Qt("CrossFadedCompositeBinder",ol),Qt("CompositeExpressionBinder",Ao),Qt("ProgramConfiguration",om,{omit:["_buffers"]}),Qt("ProgramConfigurationSet",Zl);const ar=8192,pd=Math.pow(2,14)-1,lm=-pd-1;function Hl(o){const i=ar/o.extent,u=o.loadGeometry();for(let g=0;g<u.length;g++){const v=u[g];for(let E=0;E<v.length;E++){const A=v[E],M=Math.round(A.x*i),P=Math.round(A.y*i);A.x=ve(M,lm,pd),A.y=ve(P,lm,pd),(M<A.x||M>A.x+1||P<A.y||P>A.y+1)&&Ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Xl(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Hl(o):[]}}function $h(o,i,u,g,v){o.emplaceBack(2*i+(g+1)/2,2*u+(v+1)/2)}class md{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Wr,this.indexArray=new Xs,this.segments=new Zn,this.programConfigurations=new Zl(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){const v=this.layers[0],E=[];let A=null,M=!1;v.type==="circle"&&(A=v.layout.get("circle-sort-key"),M=!A.isConstant());for(const{feature:P,id:F,index:j,sourceLayerIndex:G}of i){const W=this.layers[0]._featureFilter.needGeometry,te=Xl(P,W);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),te,g))continue;const re=M?A.evaluate(te,{},g):void 0,de={id:F,properties:P.properties,type:P.type,sourceLayerIndex:G,index:j,geometry:W?te.geometry:Hl(P),patterns:{},sortKey:re};E.push(de)}M&&E.sort((P,F)=>P.sortKey-F.sortKey);for(const P of E){const{geometry:F,index:j,sourceLayerIndex:G}=P,W=i[j].feature;this.addFeature(P,F,j,g),u.featureIndex.insert(W,F,j,G,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Is),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,u,g,v){for(const E of u)for(const A of E){const M=A.x,P=A.y;if(M<0||M>=ar||P<0||P>=ar)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),j=F.vertexLength;$h(this.layoutVertexArray,M,P,-1,-1),$h(this.layoutVertexArray,M,P,1,-1),$h(this.layoutVertexArray,M,P,1,1),$h(this.layoutVertexArray,M,P,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,{},v)}}function um(o,i){for(let u=0;u<o.length;u++)if(Mu(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(Mu(o,i[u]))return!0;return!!gd(o,i)}function r1(o,i,u){return!!Mu(o,i)||!!_d(i,o,u)}function cm(o,i){if(o.length===1)return fm(i,o[0]);for(let u=0;u<i.length;u++){const g=i[u];for(let v=0;v<g.length;v++)if(Mu(o,g[v]))return!0}for(let u=0;u<o.length;u++)if(fm(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(gd(o,i[u]))return!0;return!1}function s1(o,i,u){if(o.length>1){if(gd(o,i))return!0;for(let g=0;g<i.length;g++)if(_d(i[g],o,u))return!0}for(let g=0;g<o.length;g++)if(_d(o[g],i,u))return!0;return!1}function gd(o,i){if(o.length===0||i.length===0)return!1;for(let u=0;u<o.length-1;u++){const g=o[u],v=o[u+1];for(let E=0;E<i.length-1;E++)if(o1(g,v,i[E],i[E+1]))return!0}return!1}function o1(o,i,u,g){return qe(o,u,g)!==qe(i,u,g)&&qe(o,i,u)!==qe(o,i,g)}function _d(o,i,u){const g=u*u;if(i.length===1)return o.distSqr(i[0])<g;for(let v=1;v<i.length;v++)if(hm(o,i[v-1],i[v])<g)return!0;return!1}function hm(o,i,u){const g=i.distSqr(u);if(g===0)return o.distSqr(i);const v=((o.x-i.x)*(u.x-i.x)+(o.y-i.y)*(u.y-i.y))/g;return o.distSqr(v<0?i:v>1?u:u.sub(i)._mult(v)._add(i))}function fm(o,i){let u,g,v,E=!1;for(let A=0;A<o.length;A++){u=o[A];for(let M=0,P=u.length-1;M<u.length;P=M++)g=u[M],v=u[P],g.y>i.y!=v.y>i.y&&i.x<(v.x-g.x)*(i.y-g.y)/(v.y-g.y)+g.x&&(E=!E)}return E}function Mu(o,i){let u=!1;for(let g=0,v=o.length-1;g<o.length;v=g++){const E=o[g],A=o[v];E.y>i.y!=A.y>i.y&&i.x<(A.x-E.x)*(i.y-E.y)/(A.y-E.y)+E.x&&(u=!u)}return u}function a1(o,i,u){const g=u[0],v=u[2];if(o.x<g.x&&i.x<g.x||o.x>v.x&&i.x>v.x||o.y<g.y&&i.y<g.y||o.y>v.y&&i.y>v.y)return!1;const E=qe(o,i,u[0]);return E!==qe(o,i,u[1])||E!==qe(o,i,u[2])||E!==qe(o,i,u[3])}function Zc(o,i,u){const g=i.paint.get(o).value;return g.kind==="constant"?g.value:u.programConfigurations.get(i.id).getMaxValue(o)}function Yh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Jh(o,i,u,g,v){if(!i[0]&&!i[1])return o;const E=C.convert(i)._mult(v);u==="viewport"&&E._rotate(-g);const A=[];for(let M=0;M<o.length;M++)A.push(o[M].sub(E));return A}let dm,pm;Qt("CircleBucket",md,{omit:["layers"]});var l1={get paint(){return pm=pm||new k({"circle-radius":new vn($e.paint_circle["circle-radius"]),"circle-color":new vn($e.paint_circle["circle-color"]),"circle-blur":new vn($e.paint_circle["circle-blur"]),"circle-opacity":new vn($e.paint_circle["circle-opacity"]),"circle-translate":new nn($e.paint_circle["circle-translate"]),"circle-translate-anchor":new nn($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nn($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nn($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vn($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vn($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vn($e.paint_circle["circle-stroke-opacity"])})},get layout(){return dm=dm||new k({"circle-sort-key":new vn($e.layout_circle["circle-sort-key"])})}},as=1e-6,Ru=typeof Float32Array<"u"?Float32Array:Array;function yd(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function mm(o,i,u){var g=i[0],v=i[1],E=i[2],A=i[3],M=i[4],P=i[5],F=i[6],j=i[7],G=i[8],W=i[9],te=i[10],re=i[11],de=i[12],Te=i[13],Pe=i[14],nt=i[15],Ge=u[0],Qe=u[1],ht=u[2],Et=u[3];return o[0]=Ge*g+Qe*M+ht*G+Et*de,o[1]=Ge*v+Qe*P+ht*W+Et*Te,o[2]=Ge*E+Qe*F+ht*te+Et*Pe,o[3]=Ge*A+Qe*j+ht*re+Et*nt,o[4]=(Ge=u[4])*g+(Qe=u[5])*M+(ht=u[6])*G+(Et=u[7])*de,o[5]=Ge*v+Qe*P+ht*W+Et*Te,o[6]=Ge*E+Qe*F+ht*te+Et*Pe,o[7]=Ge*A+Qe*j+ht*re+Et*nt,o[8]=(Ge=u[8])*g+(Qe=u[9])*M+(ht=u[10])*G+(Et=u[11])*de,o[9]=Ge*v+Qe*P+ht*W+Et*Te,o[10]=Ge*E+Qe*F+ht*te+Et*Pe,o[11]=Ge*A+Qe*j+ht*re+Et*nt,o[12]=(Ge=u[12])*g+(Qe=u[13])*M+(ht=u[14])*G+(Et=u[15])*de,o[13]=Ge*v+Qe*P+ht*W+Et*Te,o[14]=Ge*E+Qe*F+ht*te+Et*Pe,o[15]=Ge*A+Qe*j+ht*re+Et*nt,o}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var Hc,u1=mm;function Qh(o,i,u){var g=i[0],v=i[1],E=i[2],A=i[3];return o[0]=u[0]*g+u[4]*v+u[8]*E+u[12]*A,o[1]=u[1]*g+u[5]*v+u[9]*E+u[13]*A,o[2]=u[2]*g+u[6]*v+u[10]*E+u[14]*A,o[3]=u[3]*g+u[7]*v+u[11]*E+u[15]*A,o}Hc=new Ru(4),Ru!=Float32Array&&(Hc[0]=0,Hc[1]=0,Hc[2]=0,Hc[3]=0);class c1 extends f{constructor(i){super(i,l1)}createBucket(i){return new md(i)}queryRadius(i){const u=i;return Zc("circle-radius",this,u)+Zc("circle-stroke-width",this,u)+Yh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M,P){const F=Jh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,M),j=this.paint.get("circle-radius").evaluate(u,g)+this.paint.get("circle-stroke-width").evaluate(u,g),G=this.paint.get("circle-pitch-alignment")==="map",W=G?F:function(re,de){return re.map(Te=>gm(Te,de))}(F,P),te=G?j*M:j;for(const re of v)for(const de of re){const Te=G?de:gm(de,P);let Pe=te;const nt=Qh([],[de.x,de.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=nt[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=A.cameraToCenterDistance/nt[3]),r1(W,Te,Pe))return!0}return!1}}function gm(o,i){const u=Qh([],[o.x,o.y,0,1],i);return new C(u[0]/u[3],u[1]/u[3])}class _m extends md{}let ym;Qt("HeatmapBucket",_m,{omit:["layers"]});var h1={get paint(){return ym=ym||new k({"heatmap-radius":new vn($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vn($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nn($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qc($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nn($e.paint_heatmap["heatmap-opacity"])})}};function vd(o,{width:i,height:u},g,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==i*u*g)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${i*u*g}`)}else v=new Uint8Array(i*u*g);return o.width=i,o.height=u,o.data=v,o}function vm(o,{width:i,height:u},g){if(i===o.width&&u===o.height)return;const v=vd({},{width:i,height:u},g);bd(o,v,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,u)},g),o.width=i,o.height=u,o.data=v.data}function bd(o,i,u,g,v,E){if(v.width===0||v.height===0)return i;if(v.width>o.width||v.height>o.height||u.x>o.width-v.width||u.y>o.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>i.width||v.height>i.height||g.x>i.width-v.width||g.y>i.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const A=o.data,M=i.data;if(A===M)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<v.height;P++){const F=((u.y+P)*o.width+u.x)*E,j=((g.y+P)*i.width+g.x)*E;for(let G=0;G<v.width*E;G++)M[j+G]=A[F+G]}return i}class Xc{constructor(i,u){vd(this,i,1,u)}resize(i){vm(this,i,1)}clone(){return new Xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){bd(i,u,g,v,E,1)}}class Ws{constructor(i,u){vd(this,i,4,u)}resize(i){vm(this,i,4)}replace(i,u){u?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){bd(i,u,g,v,E,4)}}function bm(o){const i={},u=o.resolution||256,g=o.clips?o.clips.length:1,v=o.image||new Ws({width:u,height:g});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const E=(A,M,P)=>{i[o.evaluationKey]=P;const F=o.expression.evaluate(i);v.data[A+M+0]=Math.floor(255*F.r/F.a),v.data[A+M+1]=Math.floor(255*F.g/F.a),v.data[A+M+2]=Math.floor(255*F.b/F.a),v.data[A+M+3]=Math.floor(255*F.a)};if(o.clips)for(let A=0,M=0;A<g;++A,M+=4*u)for(let P=0,F=0;P<u;P++,F+=4){const j=P/(u-1),{start:G,end:W}=o.clips[A];E(M,F,G*(1-j)+W*j)}else for(let A=0,M=0;A<u;A++,M+=4)E(0,M,A/(u-1));return v}Qt("AlphaImage",Xc),Qt("RGBAImage",Ws);const xd="big-fb";class f1 extends f{createBucket(i){return new _m(i)}constructor(i){super(i,h1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xd)&&this.heatmapFbos.delete(xd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xm;var d1={get paint(){return xm=xm||new k({"hillshade-illumination-direction":new nn($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nn($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nn($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nn($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nn($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nn($e.paint_hillshade["hillshade-accent-color"])})}};class p1 extends f{constructor(i){super(i,d1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const m1=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:g1}=m1;function wm(o,i,u=2){const g=i&&i.length,v=g?i[0]*u:o.length;let E=km(o,0,v,u,!0);const A=[];if(!E||E.next===E.prev)return A;let M,P,F;if(g&&(E=function(j,G,W,te){const re=[];for(let de=0,Te=G.length;de<Te;de++){const Pe=km(j,G[de]*te,de<Te-1?G[de+1]*te:j.length,te,!1);Pe===Pe.next&&(Pe.steiner=!0),re.push(I1(Pe))}re.sort(x1);for(let de=0;de<re.length;de++)W=w1(re[de],W);return W}(o,i,E,u)),o.length>80*u){M=1/0,P=1/0;let j=-1/0,G=-1/0;for(let W=u;W<v;W+=u){const te=o[W],re=o[W+1];te<M&&(M=te),re<P&&(P=re),te>j&&(j=te),re>G&&(G=re)}F=Math.max(j-M,G-P),F=F!==0?32767/F:0}return Wc(E,A,u,M,P,F,0),A}function km(o,i,u,g,v){let E;if(v===function(A,M,P,F){let j=0;for(let G=M,W=P-F;G<P;G+=F)j+=(A[W]-A[G])*(A[G+1]+A[W+1]),W=G;return j}(o,i,u,g)>0)for(let A=i;A<u;A+=g)E=Em(A/g|0,o[A],o[A+1],E);else for(let A=u-g;A>=i;A-=g)E=Em(A/g|0,o[A],o[A+1],E);return E&&ef(E,E.next)&&($c(E),E=E.next),E}function Wl(o,i){if(!o)return o;i||(i=o);let u,g=o;do if(u=!1,g.steiner||!ef(g,g.next)&&tr(g.prev,g,g.next)!==0)g=g.next;else{if($c(g),g=i=g.prev,g===g.next)break;u=!0}while(u||g!==i);return i}function Wc(o,i,u,g,v,E,A){if(!o)return;!A&&E&&function(P,F,j,G){let W=P;do W.z===0&&(W.z=wd(W.x,W.y,F,j,G)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==P);W.prevZ.nextZ=null,W.prevZ=null,function(te){let re,de=1;do{let Te,Pe=te;te=null;let nt=null;for(re=0;Pe;){re++;let Ge=Pe,Qe=0;for(let Et=0;Et<de&&(Qe++,Ge=Ge.nextZ,Ge);Et++);let ht=de;for(;Qe>0||ht>0&&Ge;)Qe!==0&&(ht===0||!Ge||Pe.z<=Ge.z)?(Te=Pe,Pe=Pe.nextZ,Qe--):(Te=Ge,Ge=Ge.nextZ,ht--),nt?nt.nextZ=Te:te=Te,Te.prevZ=nt,nt=Te;Pe=Ge}nt.nextZ=null,de*=2}while(re>1)}(W)}(o,g,v,E);let M=o;for(;o.prev!==o.next;){const P=o.prev,F=o.next;if(E?y1(o,g,v,E):_1(o))i.push(P.i,o.i,F.i),$c(o),o=F.next,M=F.next;else if((o=F)===M){A?A===1?Wc(o=v1(Wl(o),i),i,u,g,v,E,2):A===2&&b1(o,i,u,g,v,E):Wc(Wl(o),i,u,g,v,E,1);break}}}function _1(o){const i=o.prev,u=o,g=o.next;if(tr(i,u,g)>=0)return!1;const v=i.x,E=u.x,A=g.x,M=i.y,P=u.y,F=g.y,j=v<E?v<A?v:A:E<A?E:A,G=M<P?M<F?M:F:P<F?P:F,W=v>E?v>A?v:A:E>A?E:A,te=M>P?M>F?M:F:P>F?P:F;let re=g.next;for(;re!==i;){if(re.x>=j&&re.x<=W&&re.y>=G&&re.y<=te&&Pu(v,M,E,P,A,F,re.x,re.y)&&tr(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function y1(o,i,u,g){const v=o.prev,E=o,A=o.next;if(tr(v,E,A)>=0)return!1;const M=v.x,P=E.x,F=A.x,j=v.y,G=E.y,W=A.y,te=M<P?M<F?M:F:P<F?P:F,re=j<G?j<W?j:W:G<W?G:W,de=M>P?M>F?M:F:P>F?P:F,Te=j>G?j>W?j:W:G>W?G:W,Pe=wd(te,re,i,u,g),nt=wd(de,Te,i,u,g);let Ge=o.prevZ,Qe=o.nextZ;for(;Ge&&Ge.z>=Pe&&Qe&&Qe.z<=nt;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=re&&Ge.y<=Te&&Ge!==v&&Ge!==A&&Pu(M,j,P,G,F,W,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0||(Ge=Ge.prevZ,Qe.x>=te&&Qe.x<=de&&Qe.y>=re&&Qe.y<=Te&&Qe!==v&&Qe!==A&&Pu(M,j,P,G,F,W,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0))return!1;Qe=Qe.nextZ}for(;Ge&&Ge.z>=Pe;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=re&&Ge.y<=Te&&Ge!==v&&Ge!==A&&Pu(M,j,P,G,F,W,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.prevZ}for(;Qe&&Qe.z<=nt;){if(Qe.x>=te&&Qe.x<=de&&Qe.y>=re&&Qe.y<=Te&&Qe!==v&&Qe!==A&&Pu(M,j,P,G,F,W,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.nextZ}return!0}function v1(o,i){let u=o;do{const g=u.prev,v=u.next.next;!ef(g,v)&&Im(g,u,u.next,v)&&Kc(g,v)&&Kc(v,g)&&(i.push(g.i,u.i,v.i),$c(u),$c(u.next),u=o=v),u=u.next}while(u!==o);return Wl(u)}function b1(o,i,u,g,v,E){let A=o;do{let M=A.next.next;for(;M!==A.prev;){if(A.i!==M.i&&S1(A,M)){let P=Sm(A,M);return A=Wl(A,A.next),P=Wl(P,P.next),Wc(A,i,u,g,v,E,0),void Wc(P,i,u,g,v,E,0)}M=M.next}A=A.next}while(A!==o)}function x1(o,i){return o.x-i.x}function w1(o,i){const u=function(v,E){let A=E;const M=v.x,P=v.y;let F,j=-1/0;do{if(P<=A.y&&P>=A.next.y&&A.next.y!==A.y){const de=A.x+(P-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(de<=M&&de>j&&(j=de,F=A.x<A.next.x?A:A.next,de===M))return F}A=A.next}while(A!==E);if(!F)return null;const G=F,W=F.x,te=F.y;let re=1/0;A=F;do{if(M>=A.x&&A.x>=W&&M!==A.x&&Pu(P<te?M:j,P,W,te,P<te?j:M,P,A.x,A.y)){const de=Math.abs(P-A.y)/(M-A.x);Kc(A,v)&&(de<re||de===re&&(A.x>F.x||A.x===F.x&&k1(F,A)))&&(F=A,re=de)}A=A.next}while(A!==G);return F}(o,i);if(!u)return i;const g=Sm(u,o);return Wl(g,g.next),Wl(u,u.next)}function k1(o,i){return tr(o.prev,o,i.prev)<0&&tr(i.next,o,o.next)<0}function wd(o,i,u,g,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*v|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-g)*v|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function I1(o){let i=o,u=o;do(i.x<u.x||i.x===u.x&&i.y<u.y)&&(u=i),i=i.next;while(i!==o);return u}function Pu(o,i,u,g,v,E,A,M){return(v-A)*(i-M)>=(o-A)*(E-M)&&(o-A)*(g-M)>=(u-A)*(i-M)&&(u-A)*(E-M)>=(v-A)*(g-M)}function S1(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(u,g){let v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==g.i&&v.next.i!==g.i&&Im(v,v.next,u,g))return!0;v=v.next}while(v!==u);return!1}(o,i)&&(Kc(o,i)&&Kc(i,o)&&function(u,g){let v=u,E=!1;const A=(u.x+g.x)/2,M=(u.y+g.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&A<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==u);return E}(o,i)&&(tr(o.prev,o,i.prev)||tr(o,i.prev,i))||ef(o,i)&&tr(o.prev,o,o.next)>0&&tr(i.prev,i,i.next)>0)}function tr(o,i,u){return(i.y-o.y)*(u.x-i.x)-(i.x-o.x)*(u.y-i.y)}function ef(o,i){return o.x===i.x&&o.y===i.y}function Im(o,i,u,g){const v=nf(tr(o,i,u)),E=nf(tr(o,i,g)),A=nf(tr(u,g,o)),M=nf(tr(u,g,i));return v!==E&&A!==M||!(v!==0||!tf(o,u,i))||!(E!==0||!tf(o,g,i))||!(A!==0||!tf(u,o,g))||!(M!==0||!tf(u,i,g))}function tf(o,i,u){return i.x<=Math.max(o.x,u.x)&&i.x>=Math.min(o.x,u.x)&&i.y<=Math.max(o.y,u.y)&&i.y>=Math.min(o.y,u.y)}function nf(o){return o>0?1:o<0?-1:0}function Kc(o,i){return tr(o.prev,o,o.next)<0?tr(o,i,o.next)>=0&&tr(o,o.prev,i)>=0:tr(o,i,o.prev)<0||tr(o,o.next,i)<0}function Sm(o,i){const u=kd(o.i,o.x,o.y),g=kd(i.i,i.x,i.y),v=o.next,E=i.prev;return o.next=i,i.prev=o,u.next=v,v.prev=u,g.next=u,u.prev=g,E.next=g,g.prev=E,g}function Em(o,i,u,g){const v=kd(o,i,u);return g?(v.next=g.next,v.prev=g,g.next.prev=v,g.next=v):(v.prev=v,v.next=v),v}function $c(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function kd(o,i,u){return{i:o,x:i,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Id(o,i,u){const g=u.patternDependencies;let v=!1;for(const E of i){const A=E.paint.get(`${o}-pattern`);A.isConstant()||(v=!0);const M=A.constantOr(null);M&&(v=!0,g[M.to]=!0,g[M.from]=!0)}return v}function Sd(o,i,u,g,v){const E=v.patternDependencies;for(const A of i){const M=A.paint.get(`${o}-pattern`).value;if(M.kind!=="constant"){let P=M.evaluate({zoom:g-1},u,{},v.availableImages),F=M.evaluate({zoom:g},u,{},v.availableImages),j=M.evaluate({zoom:g+1},u,{},v.availableImages);P=P&&P.name?P.name:P,F=F&&F.name?F.name:F,j=j&&j.name?j.name:j,E[P]=!0,E[F]=!0,E[j]=!0,u.patterns[A.id]={min:P,mid:F,max:j}}}return u}class Ed{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ho,this.indexArray=new Xs,this.indexArray2=new Pr,this.programConfigurations=new Zl(i.layers,i.zoom),this.segments=new Zn,this.segments2=new Zn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Id("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),A=[];for(const{feature:M,id:P,index:F,sourceLayerIndex:j}of i){const G=this.layers[0]._featureFilter.needGeometry,W=Xl(M,G);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),W,g))continue;const te=E?v.evaluate(W,{},g,u.availableImages):void 0,re={id:P,properties:M.properties,type:M.type,sourceLayerIndex:j,index:F,geometry:G?W.geometry:Hl(M),patterns:{},sortKey:te};A.push(re)}E&&A.sort((M,P)=>M.sortKey-P.sortKey);for(const M of A){const{geometry:P,index:F,sourceLayerIndex:j}=M;if(this.hasPattern){const G=Sd("fill",this.layers,M,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(M,P,F,g,{});u.featureIndex.insert(i[F].feature,P,F,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,g1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,u,g,v,E){for(const A of ja(u,500)){let M=0;for(const te of A)M+=te.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),F=P.vertexLength,j=[],G=[];for(const te of A){if(te.length===0)continue;te!==A[0]&&G.push(j.length/2);const re=this.segments2.prepareSegment(te.length,this.layoutVertexArray,this.indexArray2),de=re.vertexLength;this.layoutVertexArray.emplaceBack(te[0].x,te[0].y),this.indexArray2.emplaceBack(de+te.length-1,de),j.push(te[0].x),j.push(te[0].y);for(let Te=1;Te<te.length;Te++)this.layoutVertexArray.emplaceBack(te[Te].x,te[Te].y),this.indexArray2.emplaceBack(de+Te-1,de+Te),j.push(te[Te].x),j.push(te[Te].y);re.vertexLength+=te.length,re.primitiveLength+=te.length}const W=wm(j,G);for(let te=0;te<W.length;te+=3)this.indexArray.emplaceBack(F+W[te],F+W[te+1],F+W[te+2]);P.vertexLength+=M,P.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}let Am,Tm;Qt("FillBucket",Ed,{omit:["layers","patternFeatures"]});var E1={get paint(){return Tm=Tm||new k({"fill-antialias":new nn($e.paint_fill["fill-antialias"]),"fill-opacity":new vn($e.paint_fill["fill-opacity"]),"fill-color":new vn($e.paint_fill["fill-color"]),"fill-outline-color":new vn($e.paint_fill["fill-outline-color"]),"fill-translate":new nn($e.paint_fill["fill-translate"]),"fill-translate-anchor":new nn($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new ku($e.paint_fill["fill-pattern"])})},get layout(){return Am=Am||new k({"fill-sort-key":new vn($e.layout_fill["fill-sort-key"])})}};class A1 extends f{constructor(i){super(i,E1)}recalculate(i,u){super.recalculate(i,u);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Ed(i)}queryRadius(){return Yh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M){return cm(Jh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,M),v)}isTileClipped(){return!0}}const T1=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),C1=R([{name:"a_centroid",components:2,type:"Int16"}],4),{members:L1}=T1;var al={},M1=S,Cm=Du;function Du(o,i,u,g,v){this.properties={},this.extent=u,this.type=0,this._pbf=o,this._geometry=-1,this._keys=g,this._values=v,o.readFields(R1,this,i)}function R1(o,i,u){o==1?i.id=u.readVarint():o==2?function(g,v){for(var E=g.readVarint()+g.pos;g.pos<E;){var A=v._keys[g.readVarint()],M=v._values[g.readVarint()];v.properties[A]=M}}(u,i):o==3?i.type=u.readVarint():o==4&&(i._geometry=u.pos)}function P1(o){for(var i,u,g=0,v=0,E=o.length,A=E-1;v<E;A=v++)g+=((u=o[A]).x-(i=o[v]).x)*(i.y+u.y);return g}Du.types=["Unknown","Point","LineString","Polygon"],Du.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,u=o.readVarint()+o.pos,g=1,v=0,E=0,A=0,M=[];o.pos<u;){if(v<=0){var P=o.readVarint();g=7&P,v=P>>3}if(v--,g===1||g===2)E+=o.readSVarint(),A+=o.readSVarint(),g===1&&(i&&M.push(i),i=[]),i.push(new M1(E,A));else{if(g!==7)throw new Error("unknown command "+g);i&&i.push(i[0].clone())}}return i&&M.push(i),M},Du.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,u=1,g=0,v=0,E=0,A=1/0,M=-1/0,P=1/0,F=-1/0;o.pos<i;){if(g<=0){var j=o.readVarint();u=7&j,g=j>>3}if(g--,u===1||u===2)(v+=o.readSVarint())<A&&(A=v),v>M&&(M=v),(E+=o.readSVarint())<P&&(P=E),E>F&&(F=E);else if(u!==7)throw new Error("unknown command "+u)}return[A,P,M,F]},Du.prototype.toGeoJSON=function(o,i,u){var g,v,E=this.extent*Math.pow(2,u),A=this.extent*o,M=this.extent*i,P=this.loadGeometry(),F=Du.types[this.type];function j(te){for(var re=0;re<te.length;re++){var de=te[re];te[re]=[360*(de.x+A)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(g=0;g<P.length;g++)G[g]=P[g][0];j(P=G);break;case 2:for(g=0;g<P.length;g++)j(P[g]);break;case 3:for(P=function(te){var re=te.length;if(re<=1)return[te];for(var de,Te,Pe=[],nt=0;nt<re;nt++){var Ge=P1(te[nt]);Ge!==0&&(Te===void 0&&(Te=Ge<0),Te===Ge<0?(de&&Pe.push(de),de=[te[nt]]):de.push(te[nt]))}return de&&Pe.push(de),Pe}(P),g=0;g<P.length;g++)for(v=0;v<P[g].length;v++)j(P[g][v])}P.length===1?P=P[0]:F="Multi"+F;var W={type:"Feature",geometry:{type:F,coordinates:P},properties:this.properties};return"id"in this&&(W.id=this.id),W};var D1=Cm,Lm=Mm;function Mm(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(N1,this,i),this.length=this._features.length}function N1(o,i,u){o===15?i.version=u.readVarint():o===1?i.name=u.readString():o===5?i.extent=u.readVarint():o===2?i._features.push(u.pos):o===3?i._keys.push(u.readString()):o===4&&i._values.push(function(g){for(var v=null,E=g.readVarint()+g.pos;g.pos<E;){var A=g.readVarint()>>3;v=A===1?g.readString():A===2?g.readFloat():A===3?g.readDouble():A===4?g.readVarint64():A===5?g.readVarint():A===6?g.readSVarint():A===7?g.readBoolean():null}return v}(u))}Mm.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new D1(this._pbf,i,this.extent,this._keys,this._values)};var z1=Lm;function F1(o,i,u){if(o===3){var g=new z1(u,u.readVarint()+u.pos);g.length&&(i[g.name]=g)}}al.VectorTile=function(o,i){this.layers=o.readFields(F1,{},i)},al.VectorTileFeature=Cm,al.VectorTileLayer=Lm;const O1=al.VectorTileFeature.types,Ad=Math.pow(2,13);function Yc(o,i,u,g,v,E,A,M){o.emplaceBack(i,u,2*Math.floor(g*Ad)+A,v*Ad*2,E*Ad*2,Math.round(M))}class Td{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new tl,this.centroidVertexArray=new Fr,this.indexArray=new Xs,this.programConfigurations=new Zl(i.layers,i.zoom),this.segments=new Zn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.features=[],this.hasPattern=Id("fill-extrusion",this.layers,u);for(const{feature:v,id:E,index:A,sourceLayerIndex:M}of i){const P=this.layers[0]._featureFilter.needGeometry,F=Xl(v,P);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),F,g))continue;const j={id:E,sourceLayerIndex:M,index:A,geometry:P?F.geometry:Hl(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Sd("fill-extrusion",this.layers,j,this.zoom,u)):this.addFeature(j,j.geometry,A,g,{}),u.featureIndex.insert(v,j.geometry,A,M,this.index,!0)}}addFeatures(i,u,g){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,u,g)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,L1),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,C1.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,u,g,v,E){for(const A of ja(u,500)){const M={x:0,y:0,vertexCount:0};let P=0;for(const re of A)P+=re.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const re of A){if(re.length===0||U1(re))continue;let de=0;for(let Te=0;Te<re.length;Te++){const Pe=re[Te];if(Te>=1){const nt=re[Te-1];if(!B1(Pe,nt)){F.vertexLength+4>Zn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ge=Pe.sub(nt)._perp()._unit(),Qe=nt.dist(Pe);de+Qe>32768&&(de=0),Yc(this.layoutVertexArray,Pe.x,Pe.y,Ge.x,Ge.y,0,0,de),Yc(this.layoutVertexArray,Pe.x,Pe.y,Ge.x,Ge.y,0,1,de),M.x+=2*Pe.x,M.y+=2*Pe.y,M.vertexCount+=2,de+=Qe,Yc(this.layoutVertexArray,nt.x,nt.y,Ge.x,Ge.y,0,0,de),Yc(this.layoutVertexArray,nt.x,nt.y,Ge.x,Ge.y,0,1,de),M.x+=2*nt.x,M.y+=2*nt.y,M.vertexCount+=2;const ht=F.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+P>Zn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),O1[i.type]!=="Polygon")continue;const j=[],G=[],W=F.vertexLength;for(const re of A)if(re.length!==0){re!==A[0]&&G.push(j.length/2);for(let de=0;de<re.length;de++){const Te=re[de];Yc(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),M.x+=Te.x,M.y+=Te.y,M.vertexCount+=1,j.push(Te.x),j.push(Te.y)}}const te=wm(j,G);for(let re=0;re<te.length;re+=3)this.indexArray.emplaceBack(W+te[re],W+te[re+2],W+te[re+1]);F.primitiveLength+=te.length/3,F.vertexLength+=P;for(let re=0;re<M.vertexCount;re++){const de=Math.floor(M.x/M.vertexCount),Te=Math.floor(M.y/M.vertexCount);this.centroidVertexArray.emplaceBack(de,Te)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}function B1(o,i){return o.x===i.x&&(o.x<0||o.x>ar)||o.y===i.y&&(o.y<0||o.y>ar)}function U1(o){return o.every(i=>i.x<0)||o.every(i=>i.x>ar)||o.every(i=>i.y<0)||o.every(i=>i.y>ar)}let Rm;Qt("FillExtrusionBucket",Td,{omit:["layers","features"]});var j1={get paint(){return Rm=Rm||new k({"fill-extrusion-opacity":new nn($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vn($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nn($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nn($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ku($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vn($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vn($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nn($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class q1 extends f{constructor(i){super(i,j1)}createBucket(i){return new Td(i)}queryRadius(){return Yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,u,g,v,E,A,M,P){const F=Jh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,M),j=this.paint.get("fill-extrusion-height").evaluate(u,g),G=this.paint.get("fill-extrusion-base").evaluate(u,g),W=function(re,de,Te,Pe){const nt=[];for(const Ge of re){const Qe=[Ge.x,Ge.y,0,1];Qh(Qe,Qe,de),nt.push(new C(Qe[0]/Qe[3],Qe[1]/Qe[3]))}return nt}(F,P),te=function(re,de,Te,Pe){const nt=[],Ge=[],Qe=Pe[8]*de,ht=Pe[9]*de,Et=Pe[10]*de,Kt=Pe[11]*de,yn=Pe[8]*Te,Xt=Pe[9]*Te,Zt=Pe[10]*Te,on=Pe[11]*Te;for(const tn of re){const Jt=[],yt=[];for(const cn of tn){const sn=cn.x,Sn=cn.y,vi=Pe[0]*sn+Pe[4]*Sn+Pe[12],_i=Pe[1]*sn+Pe[5]*Sn+Pe[13],xr=Pe[2]*sn+Pe[6]*Sn+Pe[14],fo=Pe[3]*sn+Pe[7]*Sn+Pe[15],Ur=xr+Et,wr=fo+Kt,ls=vi+yn,us=_i+Xt,cs=xr+Zt,Gi=fo+on,kr=new C((vi+Qe)/wr,(_i+ht)/wr);kr.z=Ur/wr,Jt.push(kr);const Kr=new C(ls/Gi,us/Gi);Kr.z=cs/Gi,yt.push(Kr)}nt.push(Jt),Ge.push(yt)}return[nt,Ge]}(v,G,j,P);return function(re,de,Te){let Pe=1/0;cm(Te,de)&&(Pe=Pm(Te,de[0]));for(let nt=0;nt<de.length;nt++){const Ge=de[nt],Qe=re[nt];for(let ht=0;ht<Ge.length-1;ht++){const Et=Ge[ht],Kt=[Et,Ge[ht+1],Qe[ht+1],Qe[ht],Et];um(Te,Kt)&&(Pe=Math.min(Pe,Pm(Te,Kt)))}}return Pe!==1/0&&Pe}(te[0],te[1],W)}}function Jc(o,i){return o.x*i.x+o.y*i.y}function Pm(o,i){if(o.length===1){let u=0;const g=i[u++];let v;for(;!v||g.equals(v);)if(v=i[u++],!v)return 1/0;for(;u<i.length;u++){const E=i[u],A=o[0],M=v.sub(g),P=E.sub(g),F=A.sub(g),j=Jc(M,M),G=Jc(M,P),W=Jc(P,P),te=Jc(F,M),re=Jc(F,P),de=j*W-G*G,Te=(W*te-G*re)/de,Pe=(j*re-G*te)/de,nt=g.z*(1-Te-Pe)+v.z*Te+E.z*Pe;if(isFinite(nt))return nt}return 1/0}{let u=1/0;for(const g of i)u=Math.min(u,g.z);return u}}const V1=R([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:G1}=V1,Z1=R([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:H1}=Z1,X1=al.VectorTileFeature.types,W1=Math.cos(Math.PI/180*37.5),Dm=Math.pow(2,14)/.5;class Cd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Su,this.layoutVertexArray2=new nl,this.indexArray=new Xs,this.programConfigurations=new Zl(i.layers,i.zoom),this.segments=new Zn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Id("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),A=[];for(const{feature:M,id:P,index:F,sourceLayerIndex:j}of i){const G=this.layers[0]._featureFilter.needGeometry,W=Xl(M,G);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),W,g))continue;const te=E?v.evaluate(W,{},g):void 0,re={id:P,properties:M.properties,type:M.type,sourceLayerIndex:j,index:F,geometry:G?W.geometry:Hl(M),patterns:{},sortKey:te};A.push(re)}E&&A.sort((M,P)=>M.sortKey-P.sortKey);for(const M of A){const{geometry:P,index:F,sourceLayerIndex:j}=M;if(this.hasPattern){const G=Sd("line",this.layers,M,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(M,P,F,g,{});u.featureIndex.insert(i[F].feature,P,F,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,H1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,G1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,u,g,v,E){const A=this.layers[0].layout,M=A.get("line-join").evaluate(i,{}),P=A.get("line-cap"),F=A.get("line-miter-limit"),j=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const G of u)this.addLine(G,i,M,P,F,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}addLine(i,u,g,v,E,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<i.length-1;Pe++)this.totalDistance+=i[Pe].dist(i[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=X1[u.type]==="Polygon";let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let F=0;for(;F<P-1&&i[F].equals(i[F+1]);)F++;if(P<(M?3:2))return;g==="bevel"&&(E=1.05);const j=this.overscaling<=16?15*ar/(512*this.overscaling):0,G=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let W,te,re,de,Te;this.e1=this.e2=-1,M&&(W=i[P-2],Te=i[F].sub(W)._unit()._perp());for(let Pe=F;Pe<P;Pe++){if(re=Pe===P-1?M?i[F+1]:void 0:i[Pe+1],re&&i[Pe].equals(re))continue;Te&&(de=Te),W&&(te=W),W=i[Pe],Te=re?re.sub(W)._unit()._perp():de,de=de||Te;let nt=de.add(Te);nt.x===0&&nt.y===0||nt._unit();const Ge=de.x*Te.x+de.y*Te.y,Qe=nt.x*Te.x+nt.y*Te.y,ht=Qe!==0?1/Qe:1/0,Et=2*Math.sqrt(2-2*Qe),Kt=Qe<W1&&te&&re,yn=de.x*Te.y-de.y*Te.x>0;if(Kt&&Pe>F){const on=W.dist(te);if(on>2*j){const tn=W.sub(W.sub(te)._mult(j/on)._round());this.updateDistance(te,tn),this.addCurrentVertex(tn,de,0,0,G),te=tn}}const Xt=te&&re;let Zt=Xt?g:M?"butt":v;if(Xt&&Zt==="round"&&(ht<A?Zt="miter":ht<=2&&(Zt="fakeround")),Zt==="miter"&&ht>E&&(Zt="bevel"),Zt==="bevel"&&(ht>2&&(Zt="flipbevel"),ht<E&&(Zt="miter")),te&&this.updateDistance(te,W),Zt==="miter")nt._mult(ht),this.addCurrentVertex(W,nt,0,0,G);else if(Zt==="flipbevel"){if(ht>100)nt=Te.mult(-1);else{const on=ht*de.add(Te).mag()/de.sub(Te).mag();nt._perp()._mult(on*(yn?-1:1))}this.addCurrentVertex(W,nt,0,0,G),this.addCurrentVertex(W,nt.mult(-1),0,0,G)}else if(Zt==="bevel"||Zt==="fakeround"){const on=-Math.sqrt(ht*ht-1),tn=yn?on:0,Jt=yn?0:on;if(te&&this.addCurrentVertex(W,de,tn,Jt,G),Zt==="fakeround"){const yt=Math.round(180*Et/Math.PI/20);for(let cn=1;cn<yt;cn++){let sn=cn/yt;if(sn!==.5){const vi=sn-.5;sn+=sn*vi*(sn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*vi*vi+(.848013+Ge*(.215638*Ge-1.06021)))}const Sn=Te.sub(de)._mult(sn)._add(de)._unit()._mult(yn?-1:1);this.addHalfVertex(W,Sn.x,Sn.y,!1,yn,0,G)}}re&&this.addCurrentVertex(W,Te,-tn,-Jt,G)}else if(Zt==="butt")this.addCurrentVertex(W,nt,0,0,G);else if(Zt==="square"){const on=te?1:-1;this.addCurrentVertex(W,nt,on,on,G)}else Zt==="round"&&(te&&(this.addCurrentVertex(W,de,0,0,G),this.addCurrentVertex(W,de,1,1,G,!0)),re&&(this.addCurrentVertex(W,Te,-1,-1,G,!0),this.addCurrentVertex(W,Te,0,0,G)));if(Kt&&Pe<P-1){const on=W.dist(re);if(on>2*j){const tn=W.add(re.sub(W)._mult(j/on)._round());this.updateDistance(W,tn),this.addCurrentVertex(tn,Te,0,0,G),W=tn}}}}addCurrentVertex(i,u,g,v,E,A=!1){const M=u.y*v-u.x,P=-u.y-u.x*v;this.addHalfVertex(i,u.x+u.y*g,u.y-u.x*g,A,!1,g,E),this.addHalfVertex(i,M,P,A,!0,-v,E),this.distance>Dm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,u,g,v,E,A))}addHalfVertex({x:i,y:u},g,v,E,A,M,P){const F=.5*(this.lineClips?this.scaledDistance*(Dm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(E?1:0),(u<<1)+(A?1:0),Math.round(63*g)+128,Math.round(63*v)+128,1+(M===0?0:M<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),P.primitiveLength++),A?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,u){this.distance+=i.dist(u),this.updateScaledDistance()}}let Nm,zm;Qt("LineBucket",Cd,{omit:["layers","patternFeatures"]});var Fm={get paint(){return zm=zm||new k({"line-opacity":new vn($e.paint_line["line-opacity"]),"line-color":new vn($e.paint_line["line-color"]),"line-translate":new nn($e.paint_line["line-translate"]),"line-translate-anchor":new nn($e.paint_line["line-translate-anchor"]),"line-width":new vn($e.paint_line["line-width"]),"line-gap-width":new vn($e.paint_line["line-gap-width"]),"line-offset":new vn($e.paint_line["line-offset"]),"line-blur":new vn($e.paint_line["line-blur"]),"line-dasharray":new Iu($e.paint_line["line-dasharray"]),"line-pattern":new ku($e.paint_line["line-pattern"]),"line-gradient":new qc($e.paint_line["line-gradient"])})},get layout(){return Nm=Nm||new k({"line-cap":new nn($e.layout_line["line-cap"]),"line-join":new vn($e.layout_line["line-join"]),"line-miter-limit":new nn($e.layout_line["line-miter-limit"]),"line-round-limit":new nn($e.layout_line["line-round-limit"]),"line-sort-key":new vn($e.layout_line["line-sort-key"])})}};class K1 extends vn{possiblyEvaluate(i,u){return u=new Ii(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(i,u)}evaluate(i,u,g,v){return u=he({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(i,u,g,v)}}let rf;class $1 extends f{constructor(i){super(i,Fm),this.gradientVersion=0,rf||(rf=new K1(Fm.paint.properties["line-width"].specification),rf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof zo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,u){super.recalculate(i,u),this.paint._values["line-floorwidth"]=rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Cd(i)}queryRadius(i){const u=i,g=Om(Zc("line-width",this,u),Zc("line-gap-width",this,u)),v=Zc("line-offset",this,u);return g/2+Math.abs(v)+Yh(this.paint.get("line-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M){const P=Jh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,M),F=M/2*Om(this.paint.get("line-width").evaluate(u,g),this.paint.get("line-gap-width").evaluate(u,g)),j=this.paint.get("line-offset").evaluate(u,g);return j&&(v=function(G,W){const te=[];for(let re=0;re<G.length;re++){const de=G[re],Te=[];for(let Pe=0;Pe<de.length;Pe++){const nt=de[Pe-1],Ge=de[Pe],Qe=de[Pe+1],ht=Pe===0?new C(0,0):Ge.sub(nt)._unit()._perp(),Et=Pe===de.length-1?new C(0,0):Qe.sub(Ge)._unit()._perp(),Kt=ht._add(Et)._unit(),yn=Kt.x*Et.x+Kt.y*Et.y;yn!==0&&Kt._mult(1/yn),Te.push(Kt._mult(W)._add(Ge))}te.push(Te)}return te}(v,j*M)),function(G,W,te){for(let re=0;re<W.length;re++){const de=W[re];if(G.length>=3){for(let Te=0;Te<de.length;Te++)if(Mu(G,de[Te]))return!0}if(s1(G,de,te))return!0}return!1}(P,v,F)}isTileClipped(){return!0}}function Om(o,i){return i>0?i+2*o:o}const Y1=R([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),J1=R([{name:"a_projected_pos",components:3,type:"Float32"}],4);R([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Q1=R([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);R([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bm=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eb=R([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function tb(o,i,u){return o.sections.forEach(g=>{g.text=function(v,E,A){const M=E.layout.get("text-transform").evaluate(A,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),ks.applyArabicShaping&&(v=ks.applyArabicShaping(v)),v}(g.text,i,u)}),o}R([{name:"triangle",components:3,type:"Uint16"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),R([{type:"Float32",name:"offsetX"}]),R([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),R([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var pr=24,Um=gi,jm=function(o,i,u,g,v){var E,A,M=8*v-g-1,P=(1<<M)-1,F=P>>1,j=-7,G=u?v-1:0,W=u?-1:1,te=o[i+G];for(G+=W,E=te&(1<<-j)-1,te>>=-j,j+=M;j>0;E=256*E+o[i+G],G+=W,j-=8);for(A=E&(1<<-j)-1,E>>=-j,j+=g;j>0;A=256*A+o[i+G],G+=W,j-=8);if(E===0)E=1-F;else{if(E===P)return A?NaN:1/0*(te?-1:1);A+=Math.pow(2,g),E-=F}return(te?-1:1)*A*Math.pow(2,E-g)},qm=function(o,i,u,g,v,E){var A,M,P,F=8*E-v-1,j=(1<<F)-1,G=j>>1,W=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=g?0:E-1,re=g?1:-1,de=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,A=j):(A=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-A))<1&&(A--,P*=2),(i+=A+G>=1?W/P:W*Math.pow(2,1-G))*P>=2&&(A++,P/=2),A+G>=j?(M=0,A=j):A+G>=1?(M=(i*P-1)*Math.pow(2,v),A+=G):(M=i*Math.pow(2,G-1)*Math.pow(2,v),A=0));v>=8;o[u+te]=255&M,te+=re,M/=256,v-=8);for(A=A<<v|M,F+=v;F>0;o[u+te]=255&A,te+=re,A/=256,F-=8);o[u+te-re]|=128*de};function gi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}gi.Varint=0,gi.Fixed64=1,gi.Bytes=2,gi.Fixed32=5;var Ld=4294967296,Vm=1/Ld,Gm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ea(o){return o.type===gi.Bytes?o.readVarint()+o.pos:o.pos+1}function Nu(o,i,u){return u?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function Zm(o,i,u){var g=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));u.realloc(g);for(var v=u.pos-1;v>=o;v--)u.buf[v+g]=u.buf[v]}function nb(o,i){for(var u=0;u<o.length;u++)i.writeVarint(o[u])}function ib(o,i){for(var u=0;u<o.length;u++)i.writeSVarint(o[u])}function rb(o,i){for(var u=0;u<o.length;u++)i.writeFloat(o[u])}function sb(o,i){for(var u=0;u<o.length;u++)i.writeDouble(o[u])}function ob(o,i){for(var u=0;u<o.length;u++)i.writeBoolean(o[u])}function ab(o,i){for(var u=0;u<o.length;u++)i.writeFixed32(o[u])}function lb(o,i){for(var u=0;u<o.length;u++)i.writeSFixed32(o[u])}function ub(o,i){for(var u=0;u<o.length;u++)i.writeFixed64(o[u])}function cb(o,i){for(var u=0;u<o.length;u++)i.writeSFixed64(o[u])}function sf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function zu(o,i,u){o[u]=i,o[u+1]=i>>>8,o[u+2]=i>>>16,o[u+3]=i>>>24}function Hm(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}gi.prototype={destroy:function(){this.buf=null},readFields:function(o,i,u){for(u=u||this.length;this.pos<u;){var g=this.readVarint(),v=g>>3,E=this.pos;this.type=7&g,o(v,i,this),this.pos===E&&this.skip(g)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=sf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Hm(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=sf(this.buf,this.pos)+sf(this.buf,this.pos+4)*Ld;return this.pos+=8,o},readSFixed64:function(){var o=sf(this.buf,this.pos)+Hm(this.buf,this.pos+4)*Ld;return this.pos+=8,o},readFloat:function(){var o=jm(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=jm(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,u,g=this.buf;return i=127&(u=g[this.pos++]),u<128?i:(i|=(127&(u=g[this.pos++]))<<7,u<128?i:(i|=(127&(u=g[this.pos++]))<<14,u<128?i:(i|=(127&(u=g[this.pos++]))<<21,u<128?i:function(v,E,A){var M,P,F=A.buf;if(M=(112&(P=F[A.pos++]))>>4,P<128||(M|=(127&(P=F[A.pos++]))<<3,P<128)||(M|=(127&(P=F[A.pos++]))<<10,P<128)||(M|=(127&(P=F[A.pos++]))<<17,P<128)||(M|=(127&(P=F[A.pos++]))<<24,P<128)||(M|=(1&(P=F[A.pos++]))<<31,P<128))return Nu(v,M,E);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(u=g[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&Gm?function(u,g,v){return Gm.decode(u.subarray(g,v))}(this.buf,i,o):function(u,g,v){for(var E="",A=g;A<v;){var M,P,F,j=u[A],G=null,W=j>239?4:j>223?3:j>191?2:1;if(A+W>v)break;W===1?j<128&&(G=j):W===2?(192&(M=u[A+1]))==128&&(G=(31&j)<<6|63&M)<=127&&(G=null):W===3?(P=u[A+2],(192&(M=u[A+1]))==128&&(192&P)==128&&((G=(15&j)<<12|(63&M)<<6|63&P)<=2047||G>=55296&&G<=57343)&&(G=null)):W===4&&(P=u[A+2],F=u[A+3],(192&(M=u[A+1]))==128&&(192&P)==128&&(192&F)==128&&((G=(15&j)<<18|(63&M)<<12|(63&P)<<6|63&F)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,W=1):G>65535&&(G-=65536,E+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),E+=String.fromCharCode(G),A+=W}return E}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==gi.Bytes)return o.push(this.readVarint(i));var u=Ea(this);for(o=o||[];this.pos<u;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==gi.Bytes)return o.push(this.readSVarint());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==gi.Bytes)return o.push(this.readBoolean());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==gi.Bytes)return o.push(this.readFloat());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==gi.Bytes)return o.push(this.readDouble());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==gi.Bytes)return o.push(this.readFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==gi.Bytes)return o.push(this.readSFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==gi.Bytes)return o.push(this.readFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==gi.Bytes)return o.push(this.readSFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===gi.Varint)for(;this.buf[this.pos++]>127;);else if(i===gi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===gi.Fixed32)this.pos+=4;else{if(i!==gi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var u=new Uint8Array(i);u.set(this.buf),this.buf=u,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),zu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),zu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),zu(this.buf,-1&o,this.pos),zu(this.buf,Math.floor(o*Vm),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),zu(this.buf,-1&o,this.pos),zu(this.buf,Math.floor(o*Vm),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,u){var g,v;if(i>=0?(g=i%4294967296|0,v=i/4294967296|0):(v=~(-i/4294967296),4294967295^(g=~(-i%4294967296))?g=g+1|0:(g=0,v=v+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(E,A,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(g,0,u),function(E,A){var M=(7&E)<<4;A.buf[A.pos++]|=M|((E>>>=3)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E)))))}(v,u)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(g,v,E){for(var A,M,P=0;P<v.length;P++){if((A=v.charCodeAt(P))>55295&&A<57344){if(!M){A>56319||P+1===v.length?(g[E++]=239,g[E++]=191,g[E++]=189):M=A;continue}if(A<56320){g[E++]=239,g[E++]=191,g[E++]=189,M=A;continue}A=M-55296<<10|A-56320|65536,M=null}else M&&(g[E++]=239,g[E++]=191,g[E++]=189,M=null);A<128?g[E++]=A:(A<2048?g[E++]=A>>6|192:(A<65536?g[E++]=A>>12|224:(g[E++]=A>>18|240,g[E++]=A>>12&63|128),g[E++]=A>>6&63|128),g[E++]=63&A|128)}return E}(this.buf,o,this.pos);var u=this.pos-i;u>=128&&Zm(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u},writeFloat:function(o){this.realloc(4),qm(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),qm(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var u=0;u<i;u++)this.buf[this.pos++]=o[u]},writeRawMessage:function(o,i){this.pos++;var u=this.pos;o(i,this);var g=this.pos-u;g>=128&&Zm(u,g,this),this.pos=u-1,this.writeVarint(g),this.pos+=g},writeMessage:function(o,i,u){this.writeTag(o,gi.Bytes),this.writeRawMessage(i,u)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,nb,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,ib,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,ob,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,rb,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,sb,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,ab,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,lb,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,ub,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,cb,i)},writeBytesField:function(o,i){this.writeTag(o,gi.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,gi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,gi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,gi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,gi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,gi.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,gi.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,gi.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,gi.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,gi.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var Md=x(Um);const Rd=3;function hb(o,i,u){o===1&&u.readMessage(fb,i)}function fb(o,i,u){if(o===3){const{id:g,bitmap:v,width:E,height:A,left:M,top:P,advance:F}=u.readMessage(db,{});i.push({id:g,bitmap:new Xc({width:E+2*Rd,height:A+2*Rd},v),metrics:{width:E,height:A,left:M,top:P,advance:F}})}}function db(o,i,u){o===1?i.id=u.readVarint():o===2?i.bitmap=u.readBytes():o===3?i.width=u.readVarint():o===4?i.height=u.readVarint():o===5?i.left=u.readSVarint():o===6?i.top=u.readSVarint():o===7&&(i.advance=u.readVarint())}const Xm=Rd;function Wm(o){let i=0,u=0;for(const A of o)i+=A.w*A.h,u=Math.max(u,A.w);o.sort((A,M)=>M.h-A.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),u),h:1/0}];let v=0,E=0;for(const A of o)for(let M=g.length-1;M>=0;M--){const P=g[M];if(!(A.w>P.w||A.h>P.h)){if(A.x=P.x,A.y=P.y,E=Math.max(E,A.y+A.h),v=Math.max(v,A.x+A.w),A.w===P.w&&A.h===P.h){const F=g.pop();M<g.length&&(g[M]=F)}else A.h===P.h?(P.x+=A.w,P.w-=A.w):A.w===P.w?(P.y+=A.h,P.h-=A.h):(g.push({x:P.x+A.w,y:P.y,w:P.w-A.w,h:A.h}),P.y+=A.h,P.h-=A.h);break}}return{w:v,h:E,fill:i/(v*E)||0}}const Ss=1;class Pd{constructor(i,{pixelRatio:u,version:g,stretchX:v,stretchY:E,content:A,textFitWidth:M,textFitHeight:P}){this.paddedRect=i,this.pixelRatio=u,this.stretchX=v,this.stretchY=E,this.content=A,this.version=g,this.textFitWidth=M,this.textFitHeight=P}get tl(){return[this.paddedRect.x+Ss,this.paddedRect.y+Ss]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ss,this.paddedRect.y+this.paddedRect.h-Ss]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ss)/this.pixelRatio,(this.paddedRect.h-2*Ss)/this.pixelRatio]}}class Km{constructor(i,u){const g={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(i,g,E),this.addImages(u,v,E);const{w:A,h:M}=Wm(E),P=new Ws({width:A||1,height:M||1});for(const F in i){const j=i[F],G=g[F].paddedRect;Ws.copy(j.data,P,{x:0,y:0},{x:G.x+Ss,y:G.y+Ss},j.data)}for(const F in u){const j=u[F],G=v[F].paddedRect,W=G.x+Ss,te=G.y+Ss,re=j.data.width,de=j.data.height;Ws.copy(j.data,P,{x:0,y:0},{x:W,y:te},j.data),Ws.copy(j.data,P,{x:0,y:de-1},{x:W,y:te-1},{width:re,height:1}),Ws.copy(j.data,P,{x:0,y:0},{x:W,y:te+de},{width:re,height:1}),Ws.copy(j.data,P,{x:re-1,y:0},{x:W-1,y:te},{width:1,height:de}),Ws.copy(j.data,P,{x:0,y:0},{x:W+re,y:te},{width:1,height:de})}this.image=P,this.iconPositions=g,this.patternPositions=v}addImages(i,u,g){for(const v in i){const E=i[v],A={x:0,y:0,w:E.data.width+2*Ss,h:E.data.height+2*Ss};g.push(A),u[v]=new Pd(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(i,u){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in i.updatedImages)this.patchUpdatedImage(this.iconPositions[g],i.getImage(g),u),this.patchUpdatedImage(this.patternPositions[g],i.getImage(g),u)}patchUpdatedImage(i,u,g){if(!i||!u||i.version===u.version)return;i.version=u.version;const[v,E]=i.tl;g.update(u.data,void 0,{x:v,y:E})}}var ll;Qt("ImagePosition",Pd),Qt("ImageAtlas",Km),m.ah=void 0,(ll=m.ah||(m.ah={}))[ll.none=0]="none",ll[ll.horizontal=1]="horizontal",ll[ll.vertical=2]="vertical",ll[ll.horizontalOnly=3]="horizontalOnly";const eh=-17;class th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,u){const g=new th;return g.scale=i||1,g.fontStack=u,g}static forImage(i){const u=new th;return u.imageName=i,u}}class Fu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,u){const g=new Fu;for(let v=0;v<i.sections.length;v++){const E=i.sections[v];E.image?g.addImageSection(E):g.addTextSection(E,u)}return g}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let u="";for(let g=0;g<i.length;g++){const v=i.charCodeAt(g+1)||null,E=i.charCodeAt(g-1)||null;u+=v&&Gh(v)&&!Qc[i[g+1]]||E&&Gh(E)&&!Qc[i[g-1]]||!Qc[i[g]]?i[g]:Qc[i[g]]}return u}(this.text)}trim(){let i=0;for(let g=0;g<this.text.length&&af[this.text.charCodeAt(g)];g++)i++;let u=this.text.length;for(let g=this.text.length-1;g>=0&&g>=i&&af[this.text.charCodeAt(g)];g--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)}substring(i,u){const g=new Fu;return g.text=this.text.substring(i,u),g.sectionIndex=this.sectionIndex.slice(i,u),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,u)=>Math.max(i,this.sections[u].scale),0)}addTextSection(i,u){this.text+=i.text,this.sections.push(th.forText(i.scale,i.fontStack||u));const g=this.sections.length-1;for(let v=0;v<i.text.length;++v)this.sectionIndex.push(g)}addImageSection(i){const u=i.image?i.image.name:"";if(u.length===0)return void Ue("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(th.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ue("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function of(o,i,u,g,v,E,A,M,P,F,j,G,W,te,re){const de=Fu.fromFeature(o,v);let Te;G===m.ah.vertical&&de.verticalizePunctuation();const{processBidirectionalText:Pe,processStyledBidirectionalText:nt}=ks;if(Pe&&de.sections.length===1){Te=[];const ht=Pe(de.toString(),Dd(de,F,E,i,g,te));for(const Et of ht){const Kt=new Fu;Kt.text=Et,Kt.sections=de.sections;for(let yn=0;yn<Et.length;yn++)Kt.sectionIndex.push(0);Te.push(Kt)}}else if(nt){Te=[];const ht=nt(de.text,de.sectionIndex,Dd(de,F,E,i,g,te));for(const Et of ht){const Kt=new Fu;Kt.text=Et[0],Kt.sectionIndex=Et[1],Kt.sections=de.sections,Te.push(Kt)}}else Te=function(ht,Et){const Kt=[],yn=ht.text;let Xt=0;for(const Zt of Et)Kt.push(ht.substring(Xt,Zt)),Xt=Zt;return Xt<yn.length&&Kt.push(ht.substring(Xt,yn.length)),Kt}(de,Dd(de,F,E,i,g,te));const Ge=[],Qe={positionedLines:Ge,text:de.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(ht,Et,Kt,yn,Xt,Zt,on,tn,Jt,yt,cn,sn){let Sn=0,vi=eh,_i=0,xr=0;const fo=tn==="right"?1:tn==="left"?0:.5;let Ur=0;for(const Gi of Xt){Gi.trim();const kr=Gi.getMaxScale(),Kr=(kr-1)*pr,jr={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Ur]=jr;const hs=jr.positionedGlyphs;let qr=0;if(!Gi.length()){vi+=Zt,++Ur;continue}for(let Es=0;Es<Gi.length();Es++){const oi=Gi.getSection(Es),xi=Gi.getSectionIndex(Es),Ti=Gi.getCharCode(Es);let Os=0,Bi=null,ju=null,ta=null,na=pr;const po=!(Jt===m.ah.horizontal||!cn&&!Uc(Ti)||cn&&(af[Ti]||(wr=Ti,/\p{sc=Arab}/u.test(String.fromCodePoint(wr)))));if(oi.imageName){const Ys=yn[oi.imageName];if(!Ys)continue;ta=oi.imageName,ht.iconsInText=ht.iconsInText||!0,ju=Ys.paddedRect;const Dr=Ys.displaySize;oi.scale=oi.scale*pr/sn,Bi={width:Dr[0],height:Dr[1],left:Ss,top:-Xm,advance:po?Dr[1]:Dr[0]},Os=Kr+(pr-Dr[1]*oi.scale),na=Bi.advance;const Aa=po?Dr[0]*oi.scale-pr*kr:Dr[1]*oi.scale-pr*kr;Aa>0&&Aa>qr&&(qr=Aa)}else{const Ys=Kt[oi.fontStack],Dr=Ys&&Ys[Ti];if(Dr&&Dr.rect)ju=Dr.rect,Bi=Dr.metrics;else{const Aa=Et[oi.fontStack],ah=Aa&&Aa[Ti];if(!ah)continue;Bi=ah.metrics}Os=(kr-oi.scale)*pr}po?(ht.verticalizable=!0,hs.push({glyph:Ti,imageName:ta,x:Sn,y:vi+Os,vertical:po,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:xi,metrics:Bi,rect:ju}),Sn+=na*oi.scale+yt):(hs.push({glyph:Ti,imageName:ta,x:Sn,y:vi+Os,vertical:po,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:xi,metrics:Bi,rect:ju}),Sn+=Bi.advance*oi.scale+yt)}hs.length!==0&&(_i=Math.max(Sn-yt,_i),_b(hs,0,hs.length-1,fo,qr)),Sn=0;const $s=Zt*kr+qr;jr.lineOffset=Math.max(qr,Kr),vi+=$s,xr=Math.max($s,xr),++Ur}var wr;const ls=vi-eh,{horizontalAlign:us,verticalAlign:cs}=Nd(on);(function(Gi,kr,Kr,jr,hs,qr,$s,Es,oi){const xi=(kr-Kr)*hs;let Ti=0;Ti=qr!==$s?-Es*jr-eh:(-jr*oi+.5)*$s;for(const Os of Gi)for(const Bi of Os.positionedGlyphs)Bi.x+=xi,Bi.y+=Ti})(ht.positionedLines,fo,us,cs,_i,xr,Zt,ls,Xt.length),ht.top+=-cs*ls,ht.bottom=ht.top+ls,ht.left+=-us*_i,ht.right=ht.left+_i}(Qe,i,u,g,Te,A,M,P,G,F,W,re),!function(ht){for(const Et of ht)if(Et.positionedGlyphs.length!==0)return!1;return!0}(Ge)&&Qe}const af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},mb={40:!0};function $m(o,i,u,g,v,E){if(i.imageName){const A=g[i.imageName];return A?A.displaySize[0]*i.scale*pr/E+v:0}{const A=u[i.fontStack],M=A&&A[o];return M?M.metrics.advance*i.scale+v:0}}function Ym(o,i,u,g){const v=Math.pow(o-i,2);return g?o<i?v/2:2*v:v+Math.abs(u)*u}function gb(o,i,u){let g=0;return o===10&&(g-=1e4),u&&(g+=150),o!==40&&o!==65288||(g+=50),i!==41&&i!==65289||(g+=50),g}function Jm(o,i,u,g,v,E){let A=null,M=Ym(i,u,v,E);for(const P of g){const F=Ym(i-P.x,u,v,E)+P.badness;F<=M&&(A=P,M=F)}return{index:o,x:i,priorBreak:A,badness:M}}function Qm(o){return o?Qm(o.priorBreak).concat(o.index):[]}function Dd(o,i,u,g,v,E){if(!o)return[];const A=[],M=function(G,W,te,re,de,Te){let Pe=0;for(let nt=0;nt<G.length();nt++){const Ge=G.getSection(nt);Pe+=$m(G.getCharCode(nt),Ge,re,de,W,Te)}return Pe/Math.max(1,Math.ceil(Pe/te))}(o,i,u,g,v,E),P=o.text.indexOf("")>=0;let F=0;for(let G=0;G<o.length();G++){const W=o.getSection(G),te=o.getCharCode(G);if(af[te]||(F+=$m(te,W,g,v,i,E)),G<o.length()-1){const re=!((j=te)<11904)&&(!!Gn["CJK Compatibility Forms"](j)||!!Gn["CJK Compatibility"](j)||!!Gn["CJK Strokes"](j)||!!Gn["CJK Symbols and Punctuation"](j)||!!Gn["Enclosed CJK Letters and Months"](j)||!!Gn["Halfwidth and Fullwidth Forms"](j)||!!Gn["Ideographic Description Characters"](j)||!!Gn["Vertical Forms"](j)||Vh.test(String.fromCodePoint(j)));(pb[te]||re||W.imageName||G!==o.length()-2&&mb[o.getCharCode(G+1)])&&A.push(Jm(G+1,F,M,A,gb(te,o.getCharCode(G+1),re&&P),!1))}}var j;return Qm(Jm(o.length(),F,M,A,0,!0))}function Nd(o){let i=.5,u=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:i,verticalAlign:u}}function _b(o,i,u,g,v){if(!g&&!v)return;const E=o[u],A=(o[u].x+E.metrics.advance*E.scale)*g;for(let M=i;M<=u;M++)o[M].x-=A,o[M].y+=v}function yb(o,i,u){const{horizontalAlign:g,verticalAlign:v}=Nd(u),E=i[0]-o.displaySize[0]*g,A=i[1]-o.displaySize[1]*v;return{image:o,top:A,bottom:A+o.displaySize[1],left:E,right:E+o.displaySize[0]}}function eg(o){var i,u;let g=o.left,v=o.top,E=o.right-g,A=o.bottom-v;const M=(i=o.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",P=(u=o.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",F=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(P==="proportional"){if(M==="stretchOnly"&&E/A<F||M==="proportional"){const j=Math.ceil(A*F);g*=j/E,E=j}}else if(M==="proportional"&&P==="stretchOnly"&&F!==0&&E/A>F){const j=Math.ceil(E/F);v*=j/A,A=j}return{x1:g,y1:v,x2:g+E,y2:v+A}}function tg(o,i,u,g,v,E){const A=o.image;let M;if(A.content){const Te=A.content,Pe=A.pixelRatio||1;M=[Te[0]/Pe,Te[1]/Pe,A.displaySize[0]-Te[2]/Pe,A.displaySize[1]-Te[3]/Pe]}const P=i.left*E,F=i.right*E;let j,G,W,te;u==="width"||u==="both"?(te=v[0]+P-g[3],G=v[0]+F+g[1]):(te=v[0]+(P+F-A.displaySize[0])/2,G=te+A.displaySize[0]);const re=i.top*E,de=i.bottom*E;return u==="height"||u==="both"?(j=v[1]+re-g[0],W=v[1]+de+g[2]):(j=v[1]+(re+de-A.displaySize[1])/2,W=j+A.displaySize[1]),{image:A,top:j,right:G,bottom:W,left:te,collisionPadding:M}}const nh=255,ea=128,ul=nh*ea;function ng(o,i){const{expression:u}=i;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ii(o+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:v}=u;let E=0;for(;E<g.length&&g[E]<=o;)E++;E=Math.max(0,E-1);let A=E;for(;A<g.length&&g[A]<o+1;)A++;A=Math.min(g.length-1,A);const M=g[E],P=g[A];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:P,minSize:u.evaluate(new Ii(M)),maxSize:u.evaluate(new Ii(P)),interpolationType:v}}}function zd(o,i,u){let g="never";const v=o.get(i);return v?g=v:o.get(u)&&(g="always"),g}const vb=al.VectorTileFeature.types,bb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lf(o,i,u,g,v,E,A,M,P,F,j,G,W){const te=M?Math.min(ul,Math.round(M[0])):0,re=M?Math.min(ul,Math.round(M[1])):0;o.emplaceBack(i,u,Math.round(32*g),Math.round(32*v),E,A,(te<<1)+(P?1:0),re,16*F,16*j,256*G,256*W)}function Fd(o,i,u){o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u)}function xb(o){for(const i of o.sections)if(hd(i.text))return!0;return!1}class Od{constructor(i){this.layoutVertexArray=new Eu,this.indexArray=new Xs,this.programConfigurations=i,this.segments=new Zn,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new zs,this.hasVisibleVertices=!1,this.placedSymbolArray=new Si}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,u,g,v){this.isEmpty()||(g&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Y1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,J1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,bb,!0),this.opacityVertexBuffer.itemSize=1),(g||v)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qt("SymbolBuffers",Od);class Bd{constructor(i,u,g){this.layoutVertexArray=new i,this.layoutAttributes=u,this.indexArray=new g,this.segments=new Zn,this.collisionVertexArray=new Jo}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Q1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Qt("CollisionBuffers",Bd);class Ou{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(A=>A.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yd([]),this.placementViewportMatrix=yd([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ng(this.zoom,u["text-size"]),this.iconSizeData=ng(this.zoom,u["icon-size"]);const g=this.layers[0].layout,v=g.get("symbol-sort-key"),E=g.get("symbol-z-order");this.canOverlap=zd(g,"text-overlap","text-allow-overlap")!=="never"||zd(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(A=>m.ah[A])),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.sourceID=i.sourceID}createArrays(){this.text=new Od(new Zl(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Od(new Zl(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Ei,this.lineVertexArray=new zr,this.symbolInstances=new jn,this.textAnchorOffsets=new Ai}calculateGlyphDependencies(i,u,g,v,E){for(let A=0;A<i.length;A++)if(u[i.charCodeAt(A)]=!0,(g||v)&&E){const M=Qc[i.charAt(A)];M&&(u[M.charCodeAt(0)]=!0)}}populate(i,u,g){const v=this.layers[0],E=v.layout,A=E.get("text-font"),M=E.get("text-field"),P=E.get("icon-image"),F=(M.value.kind!=="constant"||M.value.value instanceof Cr&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),j=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,G=E.get("symbol-sort-key");if(this.features=[],!F&&!j)return;const W=u.iconDependencies,te=u.glyphDependencies,re=u.availableImages,de=new Ii(this.zoom);for(const{feature:Te,id:Pe,index:nt,sourceLayerIndex:Ge}of i){const Qe=v._featureFilter.needGeometry,ht=Xl(Te,Qe);if(!v._featureFilter.filter(de,ht,g))continue;let Et,Kt;if(Qe||(ht.geometry=Hl(Te)),F){const Xt=v.getValueAndResolveTokens("text-field",ht,g,re),Zt=Cr.factory(Xt),on=this.hasRTLText=this.hasRTLText||xb(Zt);(!on||ks.getRTLTextPluginStatus()==="unavailable"||on&&ks.isParsed())&&(Et=tb(Zt,v,ht))}if(j){const Xt=v.getValueAndResolveTokens("icon-image",ht,g,re);Kt=Xt instanceof or?Xt:or.fromString(Xt)}if(!Et&&!Kt)continue;const yn=this.sortFeaturesByKey?G.evaluate(ht,{},g):void 0;if(this.features.push({id:Pe,text:Et,icon:Kt,index:nt,sourceLayerIndex:Ge,geometry:ht.geometry,properties:Te.properties,type:vb[Te.type],sortKey:yn}),Kt&&(W[Kt.name]=!0),Et){const Xt=A.evaluate(ht,{},g).join(","),Zt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const on of Et.sections)if(on.image)W[on.image.name]=!0;else{const tn=Oc(Et.toString()),Jt=on.fontStack||Xt,yt=te[Jt]=te[Jt]||{};this.calculateGlyphDependencies(on.text,yt,Zt,this.allowVerticalPlacement,tn)}}}E.get("symbol-placement")==="line"&&(this.features=function(Te){const Pe={},nt={},Ge=[];let Qe=0;function ht(Xt){Ge.push(Te[Xt]),Qe++}function Et(Xt,Zt,on){const tn=nt[Xt];return delete nt[Xt],nt[Zt]=tn,Ge[tn].geometry[0].pop(),Ge[tn].geometry[0]=Ge[tn].geometry[0].concat(on[0]),tn}function Kt(Xt,Zt,on){const tn=Pe[Zt];return delete Pe[Zt],Pe[Xt]=tn,Ge[tn].geometry[0].shift(),Ge[tn].geometry[0]=on[0].concat(Ge[tn].geometry[0]),tn}function yn(Xt,Zt,on){const tn=on?Zt[0][Zt[0].length-1]:Zt[0][0];return`${Xt}:${tn.x}:${tn.y}`}for(let Xt=0;Xt<Te.length;Xt++){const Zt=Te[Xt],on=Zt.geometry,tn=Zt.text?Zt.text.toString():null;if(!tn){ht(Xt);continue}const Jt=yn(tn,on),yt=yn(tn,on,!0);if(Jt in nt&&yt in Pe&&nt[Jt]!==Pe[yt]){const cn=Kt(Jt,yt,on),sn=Et(Jt,yt,Ge[cn].geometry);delete Pe[Jt],delete nt[yt],nt[yn(tn,Ge[sn].geometry,!0)]=sn,Ge[cn].geometry=null}else Jt in nt?Et(Jt,yt,on):yt in Pe?Kt(Jt,yt,on):(ht(Xt),Pe[Jt]=Qe-1,nt[yt]=Qe-1)}return Ge.filter(Xt=>Xt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Pe)=>Te.sortKey-Pe.sortKey)}update(i,u,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,u,this.layers,g),this.icon.programConfigurations.updatePaintArrays(i,u,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,u){const g=this.lineVertexArray.length;if(i.segment!==void 0){let v=i.dist(u[i.segment+1]),E=i.dist(u[i.segment]);const A={};for(let M=i.segment+1;M<u.length;M++)A[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:v},M<u.length-1&&(v+=u[M+1].dist(u[M]));for(let M=i.segment||0;M>=0;M--)A[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:E},M>0&&(E+=u[M-1].dist(u[M]));for(let M=0;M<u.length;M++){const P=A[M];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(i,u,g,v,E,A,M,P,F,j,G,W){const te=i.indexArray,re=i.layoutVertexArray,de=i.segments.prepareSegment(4*u.length,re,te,this.canOverlap?A.sortKey:void 0),Te=this.glyphOffsetArray.length,Pe=de.vertexLength,nt=this.allowVerticalPlacement&&M===m.ah.vertical?Math.PI/2:0,Ge=A.text&&A.text.sections;for(let Qe=0;Qe<u.length;Qe++){const{tl:ht,tr:Et,bl:Kt,br:yn,tex:Xt,pixelOffsetTL:Zt,pixelOffsetBR:on,minFontScaleX:tn,minFontScaleY:Jt,glyphOffset:yt,isSDF:cn,sectionIndex:sn}=u[Qe],Sn=de.vertexLength,vi=yt[1];lf(re,P.x,P.y,ht.x,vi+ht.y,Xt.x,Xt.y,g,cn,Zt.x,Zt.y,tn,Jt),lf(re,P.x,P.y,Et.x,vi+Et.y,Xt.x+Xt.w,Xt.y,g,cn,on.x,Zt.y,tn,Jt),lf(re,P.x,P.y,Kt.x,vi+Kt.y,Xt.x,Xt.y+Xt.h,g,cn,Zt.x,on.y,tn,Jt),lf(re,P.x,P.y,yn.x,vi+yn.y,Xt.x+Xt.w,Xt.y+Xt.h,g,cn,on.x,on.y,tn,Jt),Fd(i.dynamicLayoutVertexArray,P,nt),te.emplaceBack(Sn,Sn+1,Sn+2),te.emplaceBack(Sn+1,Sn+2,Sn+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),Qe!==u.length-1&&sn===u[Qe+1].sectionIndex||i.programConfigurations.populatePaintArrays(re.length,A,A.index,{},W,Ge&&Ge[sn])}i.placedSymbolArray.emplaceBack(P.x,P.y,Te,this.glyphOffsetArray.length-Te,Pe,F,j,P.segment,g?g[0]:0,g?g[1]:0,v[0],v[1],M,0,!1,0,G)}_addCollisionDebugVertex(i,u,g,v,E,A){return u.emplaceBack(0,0),i.emplaceBack(g.x,g.y,v,E,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(i,u,g,v,E,A,M){const P=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=P.vertexLength,j=E.layoutVertexArray,G=E.collisionVertexArray,W=M.anchorX,te=M.anchorY;this._addCollisionDebugVertex(j,G,A,W,te,new C(i,u)),this._addCollisionDebugVertex(j,G,A,W,te,new C(g,u)),this._addCollisionDebugVertex(j,G,A,W,te,new C(g,v)),this._addCollisionDebugVertex(j,G,A,W,te,new C(i,v)),P.vertexLength+=4;const re=E.indexArray;re.emplaceBack(F,F+1),re.emplaceBack(F+1,F+2),re.emplaceBack(F+2,F+3),re.emplaceBack(F+3,F),P.primitiveLength+=4}addDebugCollisionBoxes(i,u,g,v){for(let E=i;E<u;E++){const A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bd(Fs,Bm.members,Pr),this.iconCollisionBox=new Bd(Fs,Bm.members,Pr);for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(i,u,g,v,E,A,M,P,F){const j={};for(let G=u;G<g;G++){const W=i.get(G);j.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.textFeatureIndex=W.featureIndex;break}for(let G=v;G<E;G++){const W=i.get(G);j.verticalTextBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.verticalTextFeatureIndex=W.featureIndex;break}for(let G=A;G<M;G++){const W=i.get(G);j.iconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.iconFeatureIndex=W.featureIndex;break}for(let G=P;G<F;G++){const W=i.get(G);j.verticalIconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.verticalIconFeatureIndex=W.featureIndex;break}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const g=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,u){const g=i.placedSymbolArray.get(u),v=g.vertexStartIndex+4*g.numGlyphs;for(let E=g.vertexStartIndex;E<v;E+=4)i.indexArray.emplaceBack(E,E+1,E+2),i.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(i),g=Math.cos(i),v=[],E=[],A=[];for(let M=0;M<this.symbolInstances.length;++M){A.push(M);const P=this.symbolInstances.get(M);v.push(0|Math.round(u*P.anchorX+g*P.anchorY)),E.push(P.featureIndex)}return A.sort((M,P)=>v[M]-v[P]||E[P]-E[M]),A}addToSortKeyRanges(i,u){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===u?g.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const g=this.symbolInstances.get(u);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((v,E,A)=>{v>=0&&A.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ig,rg;Qt("SymbolBucket",Ou,{omit:["layers","collisionBoxArray","features","compareText"]}),Ou.MAX_GLYPHS=65535,Ou.addDynamicAttributes=Fd;var Ud={get paint(){return rg=rg||new k({"icon-opacity":new vn($e.paint_symbol["icon-opacity"]),"icon-color":new vn($e.paint_symbol["icon-color"]),"icon-halo-color":new vn($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new vn($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vn($e.paint_symbol["icon-halo-blur"]),"icon-translate":new nn($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new nn($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new vn($e.paint_symbol["text-opacity"]),"text-color":new vn($e.paint_symbol["text-color"],{runtimeType:vr,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new vn($e.paint_symbol["text-halo-color"]),"text-halo-width":new vn($e.paint_symbol["text-halo-width"]),"text-halo-blur":new vn($e.paint_symbol["text-halo-blur"]),"text-translate":new nn($e.paint_symbol["text-translate"]),"text-translate-anchor":new nn($e.paint_symbol["text-translate-anchor"])})},get layout(){return ig=ig||new k({"symbol-placement":new nn($e.layout_symbol["symbol-placement"]),"symbol-spacing":new nn($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nn($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vn($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nn($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nn($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nn($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nn($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new nn($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nn($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new vn($e.layout_symbol["icon-size"]),"icon-text-fit":new nn($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nn($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new vn($e.layout_symbol["icon-image"]),"icon-rotate":new vn($e.layout_symbol["icon-rotate"]),"icon-padding":new vn($e.layout_symbol["icon-padding"]),"icon-keep-upright":new nn($e.layout_symbol["icon-keep-upright"]),"icon-offset":new vn($e.layout_symbol["icon-offset"]),"icon-anchor":new vn($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nn($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nn($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nn($e.layout_symbol["text-rotation-alignment"]),"text-field":new vn($e.layout_symbol["text-field"]),"text-font":new vn($e.layout_symbol["text-font"]),"text-size":new vn($e.layout_symbol["text-size"]),"text-max-width":new vn($e.layout_symbol["text-max-width"]),"text-line-height":new nn($e.layout_symbol["text-line-height"]),"text-letter-spacing":new vn($e.layout_symbol["text-letter-spacing"]),"text-justify":new vn($e.layout_symbol["text-justify"]),"text-radial-offset":new vn($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nn($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new vn($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new vn($e.layout_symbol["text-anchor"]),"text-max-angle":new nn($e.layout_symbol["text-max-angle"]),"text-writing-mode":new nn($e.layout_symbol["text-writing-mode"]),"text-rotate":new vn($e.layout_symbol["text-rotate"]),"text-padding":new nn($e.layout_symbol["text-padding"]),"text-keep-upright":new nn($e.layout_symbol["text-keep-upright"]),"text-transform":new vn($e.layout_symbol["text-transform"]),"text-offset":new vn($e.layout_symbol["text-offset"]),"text-allow-overlap":new nn($e.layout_symbol["text-allow-overlap"]),"text-overlap":new nn($e.layout_symbol["text-overlap"]),"text-ignore-placement":new nn($e.layout_symbol["text-ignore-placement"]),"text-optional":new nn($e.layout_symbol["text-optional"])})}};class sg{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Ls,this.defaultValue=i}evaluate(i){if(i.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(i.formattedSection))return u.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt("FormatSectionOverride",sg,{omit:["defaultValue"]});class uf extends f{constructor(i){super(i,Ud)}recalculate(i,u){if(super.recalculate(i,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const v=[];for(const E of g)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,u,g,v){const E=this.layout.get(i).evaluate(u,{},g,v),A=this._unevaluatedLayout._values[i];return A.isDataDriven()||b(A.value)||!E?E:function(M,P){return P.replace(/{([^{}]+)}/g,(F,j)=>M&&j in M?String(M[j]):"")}(u.properties,E)}createBucket(i){return new Ou(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Ud.paint.overridableProperties){if(!uf.hasPaintOverride(this.layout,i))continue;const u=this.paint.get(i),g=new sg(u),v=new p(g,u.property.specification);let E=null;E=u.value.kind==="constant"||u.value.kind==="source"?new O("source",v):new V("composite",v,u.value.zoomStops),this.paint._values[i]=new co(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(i,u,g){return!(!this.layout||u.isDataDriven()||g.isDataDriven())&&uf.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,u){const g=i.get("text-field"),v=Ud.paint.properties[u];let E=!1;const A=M=>{for(const P of M)if(v.overrides&&v.overrides.hasOverride(P))return void(E=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Cr)A(g.value.value.sections);else if(g.value.kind==="source"){const M=F=>{E||(F instanceof gs&&Pi(F.value)===Ar?A(F.value.sections):F instanceof ga?A(F.sections):F.eachChild(M))},P=g.value;P._styleExpression&&M(P._styleExpression.expression)}return E}}let og;var wb={get paint(){return og=og||new k({"background-color":new nn($e.paint_background["background-color"]),"background-pattern":new Iu($e.paint_background["background-pattern"]),"background-opacity":new nn($e.paint_background["background-opacity"])})}};class kb extends f{constructor(i){super(i,wb)}}let ag;var Ib={get paint(){return ag=ag||new k({"raster-opacity":new nn($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new nn($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nn($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nn($e.paint_raster["raster-brightness-max"]),"raster-saturation":new nn($e.paint_raster["raster-saturation"]),"raster-contrast":new nn($e.paint_raster["raster-contrast"]),"raster-resampling":new nn($e.paint_raster["raster-resampling"]),"raster-fade-duration":new nn($e.paint_raster["raster-fade-duration"])})}};class Sb extends f{constructor(i){super(i,Ib)}}class Eb extends f{constructor(i){super(i,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ab{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const jd=63710088e-1;class cl{constructor(i,u){if(isNaN(i)||isNaN(u))throw new Error(`Invalid LngLat object: (${i}, ${u})`);if(this.lng=+i,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cl(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const u=Math.PI/180,g=this.lat*u,v=i.lat*u,E=Math.sin(g)*Math.sin(v)+Math.cos(g)*Math.cos(v)*Math.cos((i.lng-this.lng)*u);return jd*Math.acos(Math.min(E,1))}static convert(i){if(i instanceof cl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new cl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new cl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lg=2*Math.PI*jd;function ug(o){return lg*Math.cos(o*Math.PI/180)}function cg(o){return(180+o)/360}function hg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function fg(o,i){return o/ug(i)}function qd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class ih{constructor(i,u,g=0){this.x=+i,this.y=+u,this.z=+g}static fromLngLat(i,u=0){const g=cl.convert(i);return new ih(cg(g.lng),hg(g.lat),fg(u,g.lat))}toLngLat(){return new cl(360*this.x-180,qd(this.y))}toAltitude(){return this.z*ug(qd(this.y))}meterInMercatorCoordinateUnits(){return 1/lg*(i=qd(this.y),1/Math.cos(i*Math.PI/180));var i}}function dg(o,i,u){var g=2*Math.PI*6378137/256/Math.pow(2,u);return[o*g-2*Math.PI*6378137/2,i*g-2*Math.PI*6378137/2]}class Vd{constructor(i,u,g){if(!function(v,E,A){return!(v<0||v>25||A<0||A>=Math.pow(2,v)||E<0||E>=Math.pow(2,v))}(i,u,g))throw new Error(`x=${u}, y=${g}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=u,this.y=g,this.key=rh(0,i,i,u,g)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,u,g){const v=(A=this.y,M=this.z,P=dg(256*(E=this.x),256*(A=Math.pow(2,M)-A-1),M),F=dg(256*(E+1),256*(A+1),M),P[0]+","+P[1]+","+F[0]+","+F[1]);var E,A,M,P,F;const j=function(G,W,te){let re,de="";for(let Te=G;Te>0;Te--)re=1<<Te-1,de+=(W&re?1:0)+(te&re?2:0);return de}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,v)}isChildOf(i){const u=this.z-i.z;return u>0&&i.x===this.x>>u&&i.y===this.y>>u}getTilePoint(i){const u=Math.pow(2,this.z);return new C((i.x*u-this.x)*ar,(i.y*u-this.y)*ar)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pg{constructor(i,u){this.wrap=i,this.canonical=u,this.key=rh(i,u.z,u.z,u.x,u.y)}}class Ks{constructor(i,u,g,v,E){if(i<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${g}`);this.overscaledZ=i,this.wrap=u,this.canonical=new Vd(g,+v,+E),this.key=rh(u,i,g,v,E)}clone(){return new Ks(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-i;return i>this.canonical.z?new Ks(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ks(i,this.wrap,i,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(i,u){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-i;return i>this.canonical.z?rh(this.wrap*+u,i,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+u,i,i,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const u=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>u&&i.canonical.y===this.canonical.y>>u}children(i){if(this.overscaledZ>=i)return[new Ks(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,g=2*this.canonical.x,v=2*this.canonical.y;return[new Ks(u,this.wrap,u,g,v),new Ks(u,this.wrap,u,g+1,v),new Ks(u,this.wrap,u,g,v+1),new Ks(u,this.wrap,u,g+1,v+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Ks(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Ks(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new ih(i.x-this.wrap,i.y))}}function rh(o,i,u,g,v){(o*=2)<0&&(o=-1*o-1);const E=1<<u;return(E*E*o+E*v+g).toString(36)+u.toString(36)+i.toString(36)}Qt("CanonicalTileID",Vd),Qt("OverscaledTileID",Ks,{omit:["posMatrix"]});class mg{constructor(i,u,g,v=1,E=1,A=1,M=0){if(this.uid=i,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void Ue(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const P=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=A,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<P;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(P,F)]=this.data[this._idx(P-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,P)]=this.data[this._idx(F,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<P;F++)for(let j=0;j<P;j++){const G=this.get(F,j);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(i,u){const g=new Uint8Array(this.data.buffer),v=4*this._idx(i,u);return this.unpack(g[v],g[v+1],g[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,u){if(i<-1||i>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(i+1)}unpack(i,u,g){return i*this.redFactor+u*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,u,g){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let v=u*this.dim,E=u*this.dim+this.dim,A=g*this.dim,M=g*this.dim+this.dim;switch(u){case-1:v=E-1;break;case 1:E=v+1}switch(g){case-1:A=M-1;break;case 1:M=A+1}const P=-u*this.dim,F=-g*this.dim;for(let j=A;j<M;j++)for(let G=v;G<E;G++)this.data[this._idx(G,j)]=i.data[this._idx(G+P,j+F)]}}Qt("DEMData",mg);class gg{constructor(i){this._stringToNumber={},this._numberToString=[];for(let u=0;u<i.length;u++){const g=i[u];this._stringToNumber[g]=u,this._numberToString[u]=g}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class _g{constructor(i,u,g,v,E){this.type="Feature",this._vectorTileFeature=i,i._z=u,i._x=g,i._y=v,this.properties=i.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(i[u]=this[u]);return i}}class yg{constructor(i,u){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new $a(ar,16,0),this.grid3D=new $a(ar,16,0),this.featureIndexArray=new Xr,this.promoteId=u}insert(i,u,g,v,E,A){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,v,E);const P=A?this.grid3D:this.grid;for(let F=0;F<u.length;F++){const j=u[F],G=[1/0,1/0,-1/0,-1/0];for(let W=0;W<j.length;W++){const te=j[W];G[0]=Math.min(G[0],te.x),G[1]=Math.min(G[1],te.y),G[2]=Math.max(G[2],te.x),G[3]=Math.max(G[3],te.y)}G[0]<ar&&G[1]<ar&&G[2]>=0&&G[3]>=0&&P.insert(M,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new al.VectorTile(new Md(this.rawTileData)).layers,this.sourceLayerCoder=new gg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,u,g,v){this.loadVTLayers();const E=i.params||{},A=ar/i.tileSize/i.scale,M=zt(E.filter),P=i.queryGeometry,F=i.queryPadding*A,j=bg(P),G=this.grid.query(j.minX-F,j.minY-F,j.maxX+F,j.maxY+F),W=bg(i.cameraQueryGeometry),te=this.grid3D.query(W.minX-F,W.minY-F,W.maxX+F,W.maxY+F,(Te,Pe,nt,Ge)=>function(Qe,ht,Et,Kt,yn){for(const Zt of Qe)if(ht<=Zt.x&&Et<=Zt.y&&Kt>=Zt.x&&yn>=Zt.y)return!0;const Xt=[new C(ht,Et),new C(ht,yn),new C(Kt,yn),new C(Kt,Et)];if(Qe.length>2){for(const Zt of Xt)if(Mu(Qe,Zt))return!0}for(let Zt=0;Zt<Qe.length-1;Zt++)if(a1(Qe[Zt],Qe[Zt+1],Xt))return!0;return!1}(i.cameraQueryGeometry,Te-F,Pe-F,nt+F,Ge+F));for(const Te of te)G.push(Te);G.sort(Tb);const re={};let de;for(let Te=0;Te<G.length;Te++){const Pe=G[Te];if(Pe===de)continue;de=Pe;const nt=this.featureIndexArray.get(Pe);let Ge=null;this.loadMatchingFeature(re,nt.bucketIndex,nt.sourceLayerIndex,nt.featureIndex,M,E.layers,E.availableImages,u,g,v,(Qe,ht,Et)=>(Ge||(Ge=Hl(Qe)),ht.queryIntersectsFeature(P,Qe,Et,Ge,this.z,i.transform,A,i.pixelPosMatrix)))}return re}loadMatchingFeature(i,u,g,v,E,A,M,P,F,j,G){const W=this.bucketLayerIDs[u];if(A&&!function(Te,Pe){for(let nt=0;nt<Te.length;nt++)if(Pe.indexOf(Te[nt])>=0)return!0;return!1}(A,W))return;const te=this.sourceLayerCoder.decode(g),re=this.vtLayers[te].feature(v);if(E.needGeometry){const Te=Xl(re,!0);if(!E.filter(new Ii(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!E.filter(new Ii(this.tileID.overscaledZ),re))return;const de=this.getId(re,te);for(let Te=0;Te<W.length;Te++){const Pe=W[Te];if(A&&A.indexOf(Pe)<0)continue;const nt=P[Pe];if(!nt)continue;let Ge={};de&&j&&(Ge=j.getState(nt.sourceLayer||"_geojsonTileLayer",de));const Qe=he({},F[Pe]);Qe.paint=vg(Qe.paint,nt.paint,re,Ge,M),Qe.layout=vg(Qe.layout,nt.layout,re,Ge,M);const ht=!G||G(re,nt,Ge);if(!ht)continue;const Et=new _g(re,this.z,this.x,this.y,de);Et.layer=Qe;let Kt=i[Pe];Kt===void 0&&(Kt=i[Pe]=[]),Kt.push({featureIndex:v,feature:Et,intersectionZ:ht})}}lookupSymbolFeatures(i,u,g,v,E,A,M,P){const F={};this.loadVTLayers();const j=zt(E);for(const G of i)this.loadMatchingFeature(F,g,v,G,j,A,M,P,u);return F}hasLayer(i){for(const u of this.bucketLayerIDs)for(const g of u)if(i===g)return!0;return!1}getId(i,u){let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof g=="boolean"&&(g=Number(g))),g}}function vg(o,i,u,g,v){return be(o,(E,A)=>{const M=i instanceof ql?i.get(A):null;return M&&M.evaluate?M.evaluate(u,g,v):M})}function bg(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return{minX:i,minY:u,maxX:g,maxY:v}}function Tb(o,i){return i-o}function xg(o,i,u,g,v){const E=[];for(let A=0;A<o.length;A++){const M=o[A];let P;for(let F=0;F<M.length-1;F++){let j=M[F],G=M[F+1];j.x<i&&G.x<i||(j.x<i?j=new C(i,j.y+(i-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<i&&(G=new C(i,j.y+(i-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<u&&G.y<u||(j.y<u?j=new C(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round():G.y<u&&(G=new C(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round()),j.x>=g&&G.x>=g||(j.x>=g?j=new C(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=g&&(G=new C(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=v&&G.y>=v||(j.y>=v?j=new C(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round():G.y>=v&&(G=new C(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round()),P&&j.equals(P[P.length-1])||(P=[j],E.push(P)),P.push(G)))))}}return E}Qt("FeatureIndex",yg,{omit:["rawTileData","sourceLayerCoder"]});class hl extends C{constructor(i,u,g,v){super(i,u),this.angle=g,v!==void 0&&(this.segment=v)}clone(){return new hl(this.x,this.y,this.angle,this.segment)}}function wg(o,i,u,g,v){if(i.segment===void 0||u===0)return!0;let E=i,A=i.segment+1,M=0;for(;M>-u/2;){if(A--,A<0)return!1;M-=o[A].dist(E),E=o[A]}M+=o[A].dist(o[A+1]),A++;const P=[];let F=0;for(;M<u/2;){const j=o[A],G=o[A+1];if(!G)return!1;let W=o[A-1].angleTo(j)-j.angleTo(G);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:W}),F+=W;M-P[0].distance>g;)F-=P.shift().angleDelta;if(F>v)return!1;A++,M+=j.dist(G)}return!0}function kg(o){let i=0;for(let u=0;u<o.length-1;u++)i+=o[u].dist(o[u+1]);return i}function Ig(o,i,u){return o?.6*i*u:0}function Sg(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function Cb(o,i,u,g,v,E){const A=Ig(u,v,E),M=Sg(u,g)*E;let P=0;const F=kg(o)/2;for(let j=0;j<o.length-1;j++){const G=o[j],W=o[j+1],te=G.dist(W);if(P+te>F){const re=(F-P)/te,de=bi.number(G.x,W.x,re),Te=bi.number(G.y,W.y,re),Pe=new hl(de,Te,W.angleTo(G),j);return Pe._round(),!A||wg(o,Pe,M,A,i)?Pe:void 0}P+=te}}function Lb(o,i,u,g,v,E,A,M,P){const F=Ig(g,E,A),j=Sg(g,v),G=j*A,W=o[0].x===0||o[0].x===P||o[0].y===0||o[0].y===P;return i-G<i/4&&(i=G+i/4),Eg(o,W?i/2*M%i:(j/2+2*E)*A*M%i,i,F,u,G,W,!1,P)}function Eg(o,i,u,g,v,E,A,M,P){const F=E/2,j=kg(o);let G=0,W=i-u,te=[];for(let re=0;re<o.length-1;re++){const de=o[re],Te=o[re+1],Pe=de.dist(Te),nt=Te.angleTo(de);for(;W+u<G+Pe;){W+=u;const Ge=(W-G)/Pe,Qe=bi.number(de.x,Te.x,Ge),ht=bi.number(de.y,Te.y,Ge);if(Qe>=0&&Qe<P&&ht>=0&&ht<P&&W-F>=0&&W+F<=j){const Et=new hl(Qe,ht,nt,re);Et._round(),g&&!wg(o,Et,E,g,v)||te.push(Et)}}G+=Pe}return M||te.length||A||(te=Eg(o,G/2,u,g,v,E,A,!0,P)),te}Qt("Anchor",hl);const Bu=Ss;function Ag(o,i,u,g){const v=[],E=o.image,A=E.pixelRatio,M=E.paddedRect.w-2*Bu,P=E.paddedRect.h-2*Bu;let F={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const j=E.stretchX||[[0,M]],G=E.stretchY||[[0,P]],W=(yt,cn)=>yt+cn[1]-cn[0],te=j.reduce(W,0),re=G.reduce(W,0),de=M-te,Te=P-re;let Pe=0,nt=te,Ge=0,Qe=re,ht=0,Et=de,Kt=0,yn=Te;if(E.content&&g){const yt=E.content,cn=yt[2]-yt[0],sn=yt[3]-yt[1];(E.textFitWidth||E.textFitHeight)&&(F=eg(o)),Pe=cf(j,0,yt[0]),Ge=cf(G,0,yt[1]),nt=cf(j,yt[0],yt[2]),Qe=cf(G,yt[1],yt[3]),ht=yt[0]-Pe,Kt=yt[1]-Ge,Et=cn-nt,yn=sn-Qe}const Xt=F.x1,Zt=F.y1,on=F.x2-Xt,tn=F.y2-Zt,Jt=(yt,cn,sn,Sn)=>{const vi=hf(yt.stretch-Pe,nt,on,Xt),_i=ff(yt.fixed-ht,Et,yt.stretch,te),xr=hf(cn.stretch-Ge,Qe,tn,Zt),fo=ff(cn.fixed-Kt,yn,cn.stretch,re),Ur=hf(sn.stretch-Pe,nt,on,Xt),wr=ff(sn.fixed-ht,Et,sn.stretch,te),ls=hf(Sn.stretch-Ge,Qe,tn,Zt),us=ff(Sn.fixed-Kt,yn,Sn.stretch,re),cs=new C(vi,xr),Gi=new C(Ur,xr),kr=new C(Ur,ls),Kr=new C(vi,ls),jr=new C(_i/A,fo/A),hs=new C(wr/A,us/A),qr=i*Math.PI/180;if(qr){const oi=Math.sin(qr),xi=Math.cos(qr),Ti=[xi,-oi,oi,xi];cs._matMult(Ti),Gi._matMult(Ti),Kr._matMult(Ti),kr._matMult(Ti)}const $s=yt.stretch+yt.fixed,Es=cn.stretch+cn.fixed;return{tl:cs,tr:Gi,bl:Kr,br:kr,tex:{x:E.paddedRect.x+Bu+$s,y:E.paddedRect.y+Bu+Es,w:sn.stretch+sn.fixed-$s,h:Sn.stretch+Sn.fixed-Es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jr,pixelOffsetBR:hs,minFontScaleX:Et/A/on,minFontScaleY:yn/A/tn,isSDF:u}};if(g&&(E.stretchX||E.stretchY)){const yt=Tg(j,de,te),cn=Tg(G,Te,re);for(let sn=0;sn<yt.length-1;sn++){const Sn=yt[sn],vi=yt[sn+1];for(let _i=0;_i<cn.length-1;_i++)v.push(Jt(Sn,cn[_i],vi,cn[_i+1]))}}else v.push(Jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return v}function cf(o,i,u){let g=0;for(const v of o)g+=Math.max(i,Math.min(u,v[1]))-Math.max(i,Math.min(u,v[0]));return g}function Tg(o,i,u){const g=[{fixed:-Bu,stretch:0}];for(const[v,E]of o){const A=g[g.length-1];g.push({fixed:v-A.stretch,stretch:A.stretch}),g.push({fixed:v-A.stretch,stretch:A.stretch+(E-v)})}return g.push({fixed:i+Bu,stretch:u}),g}function hf(o,i,u,g){return o/i*u+g}function ff(o,i,u,g){return o-i*u/g}class df{constructor(i,u,g,v,E,A,M,P,F,j){var G;if(this.boxStartIndex=i.length,F){let W=A.top,te=A.bottom;const re=A.collisionPadding;re&&(W-=re[1],te+=re[3]);let de=te-W;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{const W=!((G=A.image)===null||G===void 0)&&G.content&&(A.image.textFitWidth||A.image.textFitHeight)?eg(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};W.y1=W.y1*M-P[0],W.y2=W.y2*M+P[2],W.x1=W.x1*M-P[3],W.x2=W.x2*M+P[1];const te=A.collisionPadding;if(te&&(W.x1-=te[0]*M,W.y1-=te[1]*M,W.x2+=te[2]*M,W.y2+=te[3]*M),j){const re=new C(W.x1,W.y1),de=new C(W.x2,W.y1),Te=new C(W.x1,W.y2),Pe=new C(W.x2,W.y2),nt=j*Math.PI/180;re._rotate(nt),de._rotate(nt),Te._rotate(nt),Pe._rotate(nt),W.x1=Math.min(re.x,de.x,Te.x,Pe.x),W.x2=Math.max(re.x,de.x,Te.x,Pe.x),W.y1=Math.min(re.y,de.y,Te.y,Pe.y),W.y2=Math.max(re.y,de.y,Te.y,Pe.y)}i.emplaceBack(u.x,u.y,W.x1,W.y1,W.x2,W.y2,g,v,E)}this.boxEndIndex=i.length}}class Mb{constructor(i=[],u=(g,v)=>g<v?-1:g>v?1:0){if(this.data=i,this.length=this.data.length,this.compare=u,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:u,compare:g}=this,v=u[i];for(;i>0;){const E=i-1>>1,A=u[E];if(g(v,A)>=0)break;u[i]=A,i=E}u[i]=v}_down(i){const{data:u,compare:g}=this,v=this.length>>1,E=u[i];for(;i<v;){let A=1+(i<<1);const M=A+1;if(M<this.length&&g(u[M],u[A])<0&&(A=M),g(u[A],E)>=0)break;u[i]=u[A],i=A}u[i]=E}}function Rb(o,i=1,u=!1){let g=1/0,v=1/0,E=-1/0,A=-1/0;const M=o[0];for(let te=0;te<M.length;te++){const re=M[te];(!te||re.x<g)&&(g=re.x),(!te||re.y<v)&&(v=re.y),(!te||re.x>E)&&(E=re.x),(!te||re.y>A)&&(A=re.y)}const P=Math.min(E-g,A-v);let F=P/2;const j=new Mb([],Pb);if(P===0)return new C(g,v);for(let te=g;te<E;te+=P)for(let re=v;re<A;re+=P)j.push(new Uu(te+F,re+F,F,o));let G=function(te){let re=0,de=0,Te=0;const Pe=te[0];for(let nt=0,Ge=Pe.length,Qe=Ge-1;nt<Ge;Qe=nt++){const ht=Pe[nt],Et=Pe[Qe],Kt=ht.x*Et.y-Et.x*ht.y;de+=(ht.x+Et.x)*Kt,Te+=(ht.y+Et.y)*Kt,re+=3*Kt}return new Uu(de/re,Te/re,0,te)}(o),W=j.length;for(;j.length;){const te=j.pop();(te.d>G.d||!G.d)&&(G=te,u&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,W)),te.max-G.d<=i||(F=te.h/2,j.push(new Uu(te.p.x-F,te.p.y-F,F,o)),j.push(new Uu(te.p.x+F,te.p.y-F,F,o)),j.push(new Uu(te.p.x-F,te.p.y+F,F,o)),j.push(new Uu(te.p.x+F,te.p.y+F,F,o)),W+=4)}return u&&(console.log(`num probes: ${W}`),console.log(`best distance: ${G.d}`)),G.p}function Pb(o,i){return i.max-o.max}function Uu(o,i,u,g){this.p=new C(o,i),this.h=u,this.d=function(v,E){let A=!1,M=1/0;for(let P=0;P<E.length;P++){const F=E[P];for(let j=0,G=F.length,W=G-1;j<G;W=j++){const te=F[j],re=F[W];te.y>v.y!=re.y>v.y&&v.x<(re.x-te.x)*(v.y-te.y)/(re.y-te.y)+te.x&&(A=!A),M=Math.min(M,hm(v,te,re))}}return(A?1:-1)*Math.sqrt(M)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var Br;m.aq=void 0,(Br=m.aq||(m.aq={}))[Br.center=1]="center",Br[Br.left=2]="left",Br[Br.right=3]="right",Br[Br.top=4]="top",Br[Br.bottom=5]="bottom",Br[Br["top-left"]=6]="top-left",Br[Br["top-right"]=7]="top-right",Br[Br["bottom-left"]=8]="bottom-left",Br[Br["bottom-right"]=9]="bottom-right";const fl=7,Gd=Number.POSITIVE_INFINITY;function Cg(o,i){return i[1]!==Gd?function(u,g,v){let E=0,A=0;switch(g=Math.abs(g),v=Math.abs(v),u){case"top-right":case"top-left":case"top":A=v-fl;break;case"bottom-right":case"bottom-left":case"bottom":A=-v+fl}switch(u){case"top-right":case"bottom-right":case"right":E=-g;break;case"top-left":case"bottom-left":case"left":E=g}return[E,A]}(o,i[0],i[1]):function(u,g){let v=0,E=0;g<0&&(g=0);const A=g/Math.SQRT2;switch(u){case"top-right":case"top-left":E=A-fl;break;case"bottom-right":case"bottom-left":E=-A+fl;break;case"bottom":E=-g+fl;break;case"top":E=g-fl}switch(u){case"top-right":case"bottom-right":v=-A;break;case"top-left":case"bottom-left":v=A;break;case"left":v=g;break;case"right":v=-g}return[v,E]}(o,i[0])}function Lg(o,i,u){var g;const v=o.layout,E=(g=v.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(i,{},u);if(E){const M=E.values,P=[];for(let F=0;F<M.length;F+=2){const j=P[F]=M[F],G=M[F+1].map(W=>W*pr);j.startsWith("top")?G[1]-=fl:j.startsWith("bottom")&&(G[1]+=fl),P[F+1]=G}return new Ri(P)}const A=v.get("text-variable-anchor");if(A){let M;M=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(i,{},u)*pr,Gd]:v.get("text-offset").evaluate(i,{},u).map(F=>F*pr);const P=[];for(const F of A)P.push(F,Cg(F,M));return new Ri(P)}return null}function Zd(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Db(o,i,u,g,v,E,A,M,P,F,j){let G=E.textMaxSize.evaluate(i,{});G===void 0&&(G=A);const W=o.layers[0].layout,te=W.get("icon-offset").evaluate(i,{},j),re=Rg(u.horizontal),de=A/24,Te=o.tilePixelRatio*de,Pe=o.tilePixelRatio*G/24,nt=o.tilePixelRatio*M,Ge=o.tilePixelRatio*W.get("symbol-spacing"),Qe=W.get("text-padding")*o.tilePixelRatio,ht=function(yt,cn,sn,Sn=1){const vi=yt.get("icon-padding").evaluate(cn,{},sn),_i=vi&&vi.values;return[_i[0]*Sn,_i[1]*Sn,_i[2]*Sn,_i[3]*Sn]}(W,i,j,o.tilePixelRatio),Et=W.get("text-max-angle")/180*Math.PI,Kt=W.get("text-rotation-alignment")!=="viewport"&&W.get("symbol-placement")!=="point",yn=W.get("icon-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",Xt=W.get("symbol-placement"),Zt=Ge/2,on=W.get("icon-text-fit");let tn;g&&on!=="none"&&(o.allowVerticalPlacement&&u.vertical&&(tn=tg(g,u.vertical,on,W.get("icon-text-fit-padding"),te,de)),re&&(g=tg(g,re,on,W.get("icon-text-fit-padding"),te,de)));const Jt=(yt,cn)=>{cn.x<0||cn.x>=ar||cn.y<0||cn.y>=ar||function(sn,Sn,vi,_i,xr,fo,Ur,wr,ls,us,cs,Gi,kr,Kr,jr,hs,qr,$s,Es,oi,xi,Ti,Os,Bi,ju){const ta=sn.addToLineVertexArray(Sn,vi);let na,po,Ys,Dr,Aa=0,ah=0,zg=0,Fg=0,Qd=-1,ep=-1;const Ta={};let Og=Au("");if(sn.allowVerticalPlacement&&_i.vertical){const $r=wr.layout.get("text-rotate").evaluate(xi,{},Bi)+90;Ys=new df(ls,Sn,us,cs,Gi,_i.vertical,kr,Kr,jr,$r),Ur&&(Dr=new df(ls,Sn,us,cs,Gi,Ur,qr,$s,jr,$r))}if(xr){const $r=wr.layout.get("icon-rotate").evaluate(xi,{}),Js=wr.layout.get("icon-text-fit")!=="none",Kl=Ag(xr,$r,Os,Js),Co=Ur?Ag(Ur,$r,Os,Js):void 0;po=new df(ls,Sn,us,cs,Gi,xr,qr,$s,!1,$r),Aa=4*Kl.length;const $l=sn.iconSizeData;let ia=null;$l.kind==="source"?(ia=[ea*wr.layout.get("icon-size").evaluate(xi,{})],ia[0]>ul&&Ue(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)):$l.kind==="composite"&&(ia=[ea*Ti.compositeIconSizes[0].evaluate(xi,{},Bi),ea*Ti.compositeIconSizes[1].evaluate(xi,{},Bi)],(ia[0]>ul||ia[1]>ul)&&Ue(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)),sn.addSymbols(sn.icon,Kl,ia,oi,Es,xi,m.ah.none,Sn,ta.lineStartIndex,ta.lineLength,-1,Bi),Qd=sn.icon.placedSymbolArray.length-1,Co&&(ah=4*Co.length,sn.addSymbols(sn.icon,Co,ia,oi,Es,xi,m.ah.vertical,Sn,ta.lineStartIndex,ta.lineLength,-1,Bi),ep=sn.icon.placedSymbolArray.length-1)}const Bg=Object.keys(_i.horizontal);for(const $r of Bg){const Js=_i.horizontal[$r];if(!na){Og=Au(Js.text);const Co=wr.layout.get("text-rotate").evaluate(xi,{},Bi);na=new df(ls,Sn,us,cs,Gi,Js,kr,Kr,jr,Co)}const Kl=Js.positionedLines.length===1;if(zg+=Mg(sn,Sn,Js,fo,wr,jr,xi,hs,ta,_i.vertical?m.ah.horizontal:m.ah.horizontalOnly,Kl?Bg:[$r],Ta,Qd,Ti,Bi),Kl)break}_i.vertical&&(Fg+=Mg(sn,Sn,_i.vertical,fo,wr,jr,xi,hs,ta,m.ah.vertical,["vertical"],Ta,ep,Ti,Bi));const Fb=na?na.boxStartIndex:sn.collisionBoxArray.length,Ob=na?na.boxEndIndex:sn.collisionBoxArray.length,Bb=Ys?Ys.boxStartIndex:sn.collisionBoxArray.length,Ub=Ys?Ys.boxEndIndex:sn.collisionBoxArray.length,jb=po?po.boxStartIndex:sn.collisionBoxArray.length,qb=po?po.boxEndIndex:sn.collisionBoxArray.length,Vb=Dr?Dr.boxStartIndex:sn.collisionBoxArray.length,Gb=Dr?Dr.boxEndIndex:sn.collisionBoxArray.length;let To=-1;const mf=($r,Js)=>$r&&$r.circleDiameter?Math.max($r.circleDiameter,Js):Js;To=mf(na,To),To=mf(Ys,To),To=mf(po,To),To=mf(Dr,To);const Ug=To>-1?1:0;Ug&&(To*=ju/pr),sn.glyphOffsetArray.length>=Ou.MAX_GLYPHS&&Ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&sn.addToSortKeyRanges(sn.symbolInstances.length,xi.sortKey);const Zb=Lg(wr,xi,Bi),[Hb,Xb]=function($r,Js){const Kl=$r.length,Co=Js==null?void 0:Js.values;if((Co==null?void 0:Co.length)>0)for(let $l=0;$l<Co.length;$l+=2){const ia=Co[$l+1];$r.emplaceBack(m.aq[Co[$l]],ia[0],ia[1])}return[Kl,$r.length]}(sn.textAnchorOffsets,Zb);sn.symbolInstances.emplaceBack(Sn.x,Sn.y,Ta.right>=0?Ta.right:-1,Ta.center>=0?Ta.center:-1,Ta.left>=0?Ta.left:-1,Ta.vertical||-1,Qd,ep,Og,Fb,Ob,Bb,Ub,jb,qb,Vb,Gb,us,zg,Fg,Aa,ah,Ug,0,kr,To,Hb,Xb)}(o,cn,yt,u,g,v,tn,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,Te,[Qe,Qe,Qe,Qe],Kt,P,nt,ht,yn,te,i,E,F,j,A)};if(Xt==="line")for(const yt of xg(i.geometry,0,0,ar,ar)){const cn=Lb(yt,Ge,Et,u.vertical||re,g,24,Pe,o.overscaling,ar);for(const sn of cn)re&&Nb(o,re.text,Zt,sn)||Jt(yt,sn)}else if(Xt==="line-center"){for(const yt of i.geometry)if(yt.length>1){const cn=Cb(yt,Et,u.vertical||re,g,24,Pe);cn&&Jt(yt,cn)}}else if(i.type==="Polygon")for(const yt of ja(i.geometry,0)){const cn=Rb(yt,16);Jt(yt[0],new hl(cn.x,cn.y,0))}else if(i.type==="LineString")for(const yt of i.geometry)Jt(yt,new hl(yt[0].x,yt[0].y,0));else if(i.type==="Point")for(const yt of i.geometry)for(const cn of yt)Jt([cn],new hl(cn.x,cn.y,0))}function Mg(o,i,u,g,v,E,A,M,P,F,j,G,W,te,re){const de=function(nt,Ge,Qe,ht,Et,Kt,yn,Xt){const Zt=ht.layout.get("text-rotate").evaluate(Kt,{})*Math.PI/180,on=[];for(const tn of Ge.positionedLines)for(const Jt of tn.positionedGlyphs){if(!Jt.rect)continue;const yt=Jt.rect||{};let cn=Xm+1,sn=!0,Sn=1,vi=0;const _i=(Et||Xt)&&Jt.vertical,xr=Jt.metrics.advance*Jt.scale/2;if(Xt&&Ge.verticalizable&&(vi=tn.lineOffset/2-(Jt.imageName?-(pr-Jt.metrics.width*Jt.scale)/2:(Jt.scale-1)*pr)),Jt.imageName){const oi=yn[Jt.imageName];sn=oi.sdf,Sn=oi.pixelRatio,cn=Ss/Sn}const fo=Et?[Jt.x+xr,Jt.y]:[0,0];let Ur=Et?[0,0]:[Jt.x+xr+Qe[0],Jt.y+Qe[1]-vi],wr=[0,0];_i&&(wr=Ur,Ur=[0,0]);const ls=Jt.metrics.isDoubleResolution?2:1,us=(Jt.metrics.left-cn)*Jt.scale-xr+Ur[0],cs=(-Jt.metrics.top-cn)*Jt.scale+Ur[1],Gi=us+yt.w/ls*Jt.scale/Sn,kr=cs+yt.h/ls*Jt.scale/Sn,Kr=new C(us,cs),jr=new C(Gi,cs),hs=new C(us,kr),qr=new C(Gi,kr);if(_i){const oi=new C(-xr,xr-eh),xi=-Math.PI/2,Ti=pr/2-xr,Os=new C(5-eh-Ti,-(Jt.imageName?Ti:0)),Bi=new C(...wr);Kr._rotateAround(xi,oi)._add(Os)._add(Bi),jr._rotateAround(xi,oi)._add(Os)._add(Bi),hs._rotateAround(xi,oi)._add(Os)._add(Bi),qr._rotateAround(xi,oi)._add(Os)._add(Bi)}if(Zt){const oi=Math.sin(Zt),xi=Math.cos(Zt),Ti=[xi,-oi,oi,xi];Kr._matMult(Ti),jr._matMult(Ti),hs._matMult(Ti),qr._matMult(Ti)}const $s=new C(0,0),Es=new C(0,0);on.push({tl:Kr,tr:jr,bl:hs,br:qr,tex:yt,writingMode:Ge.writingMode,glyphOffset:fo,sectionIndex:Jt.sectionIndex,isSDF:sn,pixelOffsetTL:$s,pixelOffsetBR:Es,minFontScaleX:0,minFontScaleY:0})}return on}(0,u,M,v,E,A,g,o.allowVerticalPlacement),Te=o.textSizeData;let Pe=null;Te.kind==="source"?(Pe=[ea*v.layout.get("text-size").evaluate(A,{})],Pe[0]>ul&&Ue(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)):Te.kind==="composite"&&(Pe=[ea*te.compositeTextSizes[0].evaluate(A,{},re),ea*te.compositeTextSizes[1].evaluate(A,{},re)],(Pe[0]>ul||Pe[1]>ul)&&Ue(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)),o.addSymbols(o.text,de,Pe,M,E,A,F,i,P.lineStartIndex,P.lineLength,W,re);for(const nt of j)G[nt]=o.text.placedSymbolArray.length-1;return 4*de.length}function Rg(o){for(const i in o)return o[i];return null}function Nb(o,i,u,g){const v=o.compareText;if(i in v){const E=v[i];for(let A=E.length-1;A>=0;A--)if(g.dist(E[A])<u)return!0}else v[i]=[];return v[i].push(g),!1}const Pg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,g]=new Uint8Array(i,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=g>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=Pg[15&g];if(!E)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(i,2,1),[M]=new Uint32Array(i,4,1);return new Hd(M,A,E,i)}constructor(i,u=64,g=Float64Array,v){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=g,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const E=Pg.indexOf(this.ArrayType),A=2*i*this.ArrayType.BYTES_PER_ELEMENT,M=i*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-M%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${g}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+P,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+A+M+P),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+P,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=i)}add(i,u){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=i,this.coords[this._pos++]=u,g}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Xd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,u,g,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:A,nodeSize:M}=this,P=[0,E.length-1,0],F=[];for(;P.length;){const j=P.pop()||0,G=P.pop()||0,W=P.pop()||0;if(G-W<=M){for(let Te=W;Te<=G;Te++){const Pe=A[2*Te],nt=A[2*Te+1];Pe>=i&&Pe<=g&&nt>=u&&nt<=v&&F.push(E[Te])}continue}const te=W+G>>1,re=A[2*te],de=A[2*te+1];re>=i&&re<=g&&de>=u&&de<=v&&F.push(E[te]),(j===0?i<=re:u<=de)&&(P.push(W),P.push(te-1),P.push(1-j)),(j===0?g>=re:v>=de)&&(P.push(te+1),P.push(G),P.push(1-j))}return F}within(i,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:A}=this,M=[0,v.length-1,0],P=[],F=g*g;for(;M.length;){const j=M.pop()||0,G=M.pop()||0,W=M.pop()||0;if(G-W<=A){for(let Te=W;Te<=G;Te++)Ng(E[2*Te],E[2*Te+1],i,u)<=F&&P.push(v[Te]);continue}const te=W+G>>1,re=E[2*te],de=E[2*te+1];Ng(re,de,i,u)<=F&&P.push(v[te]),(j===0?i-g<=re:u-g<=de)&&(M.push(W),M.push(te-1),M.push(1-j)),(j===0?i+g>=re:u+g>=de)&&(M.push(te+1),M.push(G),M.push(1-j))}return P}}function Xd(o,i,u,g,v,E){if(v-g<=u)return;const A=g+v>>1;Dg(o,i,A,g,v,E),Xd(o,i,u,g,A-1,1-E),Xd(o,i,u,A+1,v,1-E)}function Dg(o,i,u,g,v,E){for(;v>g;){if(v-g>600){const F=v-g+1,j=u-g+1,G=Math.log(F),W=.5*Math.exp(2*G/3),te=.5*Math.sqrt(G*W*(F-W)/F)*(j-F/2<0?-1:1);Dg(o,i,u,Math.max(g,Math.floor(u-j*W/F+te)),Math.min(v,Math.floor(u+(F-j)*W/F+te)),E)}const A=i[2*u+E];let M=g,P=v;for(sh(o,i,g,u),i[2*v+E]>A&&sh(o,i,g,v);M<P;){for(sh(o,i,M,P),M++,P--;i[2*M+E]<A;)M++;for(;i[2*P+E]>A;)P--}i[2*g+E]===A?sh(o,i,g,P):(P++,sh(o,i,P,v)),P<=u&&(g=P+1),u<=P&&(v=P-1)}}function sh(o,i,u,g){Wd(o,u,g),Wd(i,2*u,2*g),Wd(i,2*u+1,2*g+1)}function Wd(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}function Ng(o,i,u,g){const v=o-u,E=i-g;return v*v+E*E}var Kd;m.bg=void 0,(Kd=m.bg||(m.bg={})).create="create",Kd.load="load",Kd.fullLoad="fullLoad";let pf=null,oh=[];const $d=1e3/60,Yd="loadTime",Jd="fullLoadTime",zb={mark(o){performance.mark(o)},frame(o){const i=o;pf!=null&&oh.push(i-pf),pf=i},clearMetrics(){pf=null,oh=[],performance.clearMeasures(Yd),performance.clearMeasures(Jd);for(const o in m.bg)performance.clearMarks(m.bg[o])},getPerformanceMetrics(){performance.measure(Yd,m.bg.create,m.bg.load),performance.measure(Jd,m.bg.create,m.bg.fullLoad);const o=performance.getEntriesByName(Yd)[0].duration,i=performance.getEntriesByName(Jd)[0].duration,u=oh.length,g=1/(oh.reduce((E,A)=>E+A,0)/u/1e3),v=oh.filter(E=>E>$d).reduce((E,A)=>E+(A-$d)/$d,0);return{loadTime:o,fullLoadTime:i,fps:g,percentDroppedFrames:v/(u+v)*100,totalFrames:u}}};m.$=class extends H{},m.A=Ru,m.B=od,m.C=function(o){if(St==null){const i=o.navigator?o.navigator.userAgent:null;St=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return St},m.D=nn,m.E=Ct,m.F=class{constructor(o,i){this.target=o,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ab(()=>this.process()),this.subscription=function(u,g,v,E){return u.addEventListener(g,v,!1),{unsubscribe:()=>{u.removeEventListener(g,v,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=pt(self)?o:window}registerMessageHandler(o,i){this.messageHandlers[o]=i}sendAsync(o,i){return new Promise((u,g)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:u,reject:g},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const M={id:v,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const E=[],A=Object.assign(Object.assign({},o),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Ya(o.data,E)});this.target.postMessage(A,{transfer:E})})}receive(o){const i=o.data,u=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[u];const g=this.abortControllers[u];return delete this.abortControllers[u],void(g&&g.abort())}if(pt(self)||i.mustQueue)return this.tasks[u]=i,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,i)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){return l(this,void 0,void 0,function*(){if(i.type==="<response>"){const v=this.resolveRejects[o];return delete this.resolveRejects[o],v?void(i.error?v.reject(Ja(i.error)):v.resolve(Ja(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=Ja(i.data),g=new AbortController;this.abortControllers[o]=g;try{const v=yield this.messageHandlers[i.type](i.sourceMapId,u,g);this.completeTask(o,null,v)}catch(v){this.completeTask(o,v)}})}completeTask(o,i,u){const g=[];delete this.abortControllers[o];const v={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Ya(i):null,data:Ya(u,g)};this.target.postMessage(v,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.G=pn,m.H=function(){var o=new Ru(16);return Ru!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},m.I=Pd,m.J=function(o,i,u){var g,v,E,A,M,P,F,j,G,W,te,re,de=u[0],Te=u[1],Pe=u[2];return i===o?(o[12]=i[0]*de+i[4]*Te+i[8]*Pe+i[12],o[13]=i[1]*de+i[5]*Te+i[9]*Pe+i[13],o[14]=i[2]*de+i[6]*Te+i[10]*Pe+i[14],o[15]=i[3]*de+i[7]*Te+i[11]*Pe+i[15]):(v=i[1],E=i[2],A=i[3],M=i[4],P=i[5],F=i[6],j=i[7],G=i[8],W=i[9],te=i[10],re=i[11],o[0]=g=i[0],o[1]=v,o[2]=E,o[3]=A,o[4]=M,o[5]=P,o[6]=F,o[7]=j,o[8]=G,o[9]=W,o[10]=te,o[11]=re,o[12]=g*de+M*Te+G*Pe+i[12],o[13]=v*de+P*Te+W*Pe+i[13],o[14]=E*de+F*Te+te*Pe+i[14],o[15]=A*de+j*Te+re*Pe+i[15]),o},m.K=function(o,i,u){var g=u[0],v=u[1],E=u[2];return o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o[3]=i[3]*g,o[4]=i[4]*v,o[5]=i[5]*v,o[6]=i[6]*v,o[7]=i[7]*v,o[8]=i[8]*E,o[9]=i[9]*E,o[10]=i[10]*E,o[11]=i[11]*E,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.L=mm,m.M=function(o,i){const u={};for(let g=0;g<i.length;g++){const v=i[g];v in o&&(u[v]=o[v])}return u},m.N=cl,m.O=cg,m.P=C,m.Q=hg,m.R=Ws,m.S=Ks,m.T=wu,m.U=se,m.V=Q,m.W=Bt,m.X=ar,m.Y=R,m.Z=ih,m._=l,m.a=It,m.a$=function(o,i){var u=o[0],g=o[1],v=o[2],E=o[3],A=o[4],M=o[5],P=o[6],F=o[7],j=o[8],G=o[9],W=o[10],te=o[11],re=o[12],de=o[13],Te=o[14],Pe=o[15],nt=i[0],Ge=i[1],Qe=i[2],ht=i[3],Et=i[4],Kt=i[5],yn=i[6],Xt=i[7],Zt=i[8],on=i[9],tn=i[10],Jt=i[11],yt=i[12],cn=i[13],sn=i[14],Sn=i[15];return Math.abs(u-nt)<=as*Math.max(1,Math.abs(u),Math.abs(nt))&&Math.abs(g-Ge)<=as*Math.max(1,Math.abs(g),Math.abs(Ge))&&Math.abs(v-Qe)<=as*Math.max(1,Math.abs(v),Math.abs(Qe))&&Math.abs(E-ht)<=as*Math.max(1,Math.abs(E),Math.abs(ht))&&Math.abs(A-Et)<=as*Math.max(1,Math.abs(A),Math.abs(Et))&&Math.abs(M-Kt)<=as*Math.max(1,Math.abs(M),Math.abs(Kt))&&Math.abs(P-yn)<=as*Math.max(1,Math.abs(P),Math.abs(yn))&&Math.abs(F-Xt)<=as*Math.max(1,Math.abs(F),Math.abs(Xt))&&Math.abs(j-Zt)<=as*Math.max(1,Math.abs(j),Math.abs(Zt))&&Math.abs(G-on)<=as*Math.max(1,Math.abs(G),Math.abs(on))&&Math.abs(W-tn)<=as*Math.max(1,Math.abs(W),Math.abs(tn))&&Math.abs(te-Jt)<=as*Math.max(1,Math.abs(te),Math.abs(Jt))&&Math.abs(re-yt)<=as*Math.max(1,Math.abs(re),Math.abs(yt))&&Math.abs(de-cn)<=as*Math.max(1,Math.abs(de),Math.abs(cn))&&Math.abs(Te-sn)<=as*Math.max(1,Math.abs(Te),Math.abs(sn))&&Math.abs(Pe-Sn)<=as*Math.max(1,Math.abs(Pe),Math.abs(Sn))},m.a0=Zn,m.a1=Vd,m.a2=ct,m.a3=o=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(u=>{i.onloadstart=()=>{u(i)};for(const g of o){const v=window.document.createElement("source");dn(g)||(i.crossOrigin="Anonymous"),v.src=g,i.appendChild(v)}})},m.a4=function(){return xe++},m.a5=Wt,m.a6=Ou,m.a7=zt,m.a8=Xl,m.a9=_g,m.aA=function(o){if(o.type==="custom")return new Eb(o);switch(o.type){case"background":return new kb(o);case"circle":return new c1(o);case"fill":return new A1(o);case"fill-extrusion":return new q1(o);case"heatmap":return new f1(o);case"hillshade":return new p1(o);case"line":return new $1(o);case"raster":return new Sb(o);case"symbol":return new uf(o)}},m.aB=we,m.aC=function(o,i){if(!o)return[{command:"setStyle",args:[i]}];let u=[];try{if(!Ee(o.version,i.version))return[{command:"setStyle",args:[i]}];Ee(o.center,i.center)||u.push({command:"setCenter",args:[i.center]}),Ee(o.zoom,i.zoom)||u.push({command:"setZoom",args:[i.zoom]}),Ee(o.bearing,i.bearing)||u.push({command:"setBearing",args:[i.bearing]}),Ee(o.pitch,i.pitch)||u.push({command:"setPitch",args:[i.pitch]}),Ee(o.sprite,i.sprite)||u.push({command:"setSprite",args:[i.sprite]}),Ee(o.glyphs,i.glyphs)||u.push({command:"setGlyphs",args:[i.glyphs]}),Ee(o.transition,i.transition)||u.push({command:"setTransition",args:[i.transition]}),Ee(o.light,i.light)||u.push({command:"setLight",args:[i.light]}),Ee(o.terrain,i.terrain)||u.push({command:"setTerrain",args:[i.terrain]}),Ee(o.sky,i.sky)||u.push({command:"setSky",args:[i.sky]}),Ee(o.projection,i.projection)||u.push({command:"setProjection",args:[i.projection]});const g={},v=[];(function(A,M,P,F){let j;for(j in M=M||{},A=A||{})Object.prototype.hasOwnProperty.call(A,j)&&(Object.prototype.hasOwnProperty.call(M,j)||Jn(j,P,F));for(j in M)Object.prototype.hasOwnProperty.call(M,j)&&(Object.prototype.hasOwnProperty.call(A,j)?Ee(A[j],M[j])||(A[j].type==="geojson"&&M[j].type==="geojson"&&xn(A,M,j)?Gt(P,{command:"setGeoJSONSourceData",args:[j,M[j].data]}):$i(j,M,P,F)):_n(j,M,P))})(o.sources,i.sources,v,g);const E=[];o.layers&&o.layers.forEach(A=>{"source"in A&&g[A.source]?u.push({command:"removeLayer",args:[A.id]}):E.push(A)}),u=u.concat(v),function(A,M,P){M=M||[];const F=(A=A||[]).map(Yi),j=M.map(Yi),G=A.reduce(Jr,{}),W=M.reduce(Jr,{}),te=F.slice(),re=Object.create(null);let de,Te,Pe,nt,Ge;for(let Qe=0,ht=0;Qe<F.length;Qe++)de=F[Qe],Object.prototype.hasOwnProperty.call(W,de)?ht++:(Gt(P,{command:"removeLayer",args:[de]}),te.splice(te.indexOf(de,ht),1));for(let Qe=0,ht=0;Qe<j.length;Qe++)de=j[j.length-1-Qe],te[te.length-1-Qe]!==de&&(Object.prototype.hasOwnProperty.call(G,de)?(Gt(P,{command:"removeLayer",args:[de]}),te.splice(te.lastIndexOf(de,te.length-ht),1)):ht++,nt=te[te.length-Qe],Gt(P,{command:"addLayer",args:[W[de],nt]}),te.splice(te.length-Qe,0,de),re[de]=!0);for(let Qe=0;Qe<j.length;Qe++)if(de=j[Qe],Te=G[de],Pe=W[de],!re[de]&&!Ee(Te,Pe))if(Ee(Te.source,Pe.source)&&Ee(Te["source-layer"],Pe["source-layer"])&&Ee(Te.type,Pe.type)){for(Ge in Vi(Te.layout,Pe.layout,P,de,null,"setLayoutProperty"),Vi(Te.paint,Pe.paint,P,de,null,"setPaintProperty"),Ee(Te.filter,Pe.filter)||Gt(P,{command:"setFilter",args:[de,Pe.filter]}),Ee(Te.minzoom,Pe.minzoom)&&Ee(Te.maxzoom,Pe.maxzoom)||Gt(P,{command:"setLayerZoomRange",args:[de,Pe.minzoom,Pe.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?Vi(Te[Ge],Pe[Ge],P,de,Ge.slice(6),"setPaintProperty"):Ee(Te[Ge],Pe[Ge])||Gt(P,{command:"setLayerProperty",args:[de,Ge,Pe[Ge]]}));for(Ge in Pe)Object.prototype.hasOwnProperty.call(Pe,Ge)&&!Object.prototype.hasOwnProperty.call(Te,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?Vi(Te[Ge],Pe[Ge],P,de,Ge.slice(6),"setPaintProperty"):Ee(Te[Ge],Pe[Ge])||Gt(P,{command:"setLayerProperty",args:[de,Ge,Pe[Ge]]}))}else Gt(P,{command:"removeLayer",args:[de]}),nt=te[te.lastIndexOf(de)+1],Gt(P,{command:"addLayer",args:[Pe,nt]})}(E,i.layers,u)}catch(g){console.warn("Unable to compute style diff:",g),u=[{command:"setStyle",args:[i]}]}return u},m.aD=function(o){const i=[],u=o.id;return u===void 0&&i.push({message:`layers.${u}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${u}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),i},m.aE=function o(i,u){if(Array.isArray(i)){if(!Array.isArray(u)||i.length!==u.length)return!1;for(let g=0;g<i.length;g++)if(!o(i[g],u[g]))return!1;return!0}if(typeof i=="object"&&i!==null&&u!==null){if(typeof u!="object"||Object.keys(i).length!==Object.keys(u).length)return!1;for(const g in i)if(!o(i[g],u[g]))return!1;return!0}return i===u},m.aF=be,m.aG=Ce,m.aH=class extends Gl{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},m.aI=Kh,m.aJ=class extends Gl{constructor(o,i){super(o,i),this.current=n1}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},m.aK=rm,m.aL=sm,m.aM=Qn,m.aN=class extends Gl{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},m.aO=class extends Gl{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},m.aP=function(o,i,u,g,v,E,A){var M=1/(i-u),P=1/(g-v),F=1/(E-A);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*P,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*F,o[11]=0,o[12]=(i+u)*M,o[13]=(v+g)*P,o[14]=(A+E)*F,o[15]=1,o},m.aQ=u1,m.aR=class extends He{},m.aS=eb,m.aT=class extends st{},m.aU=xd,m.aV=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},m.aW=bm,m.aX=Fr,m.aY=Xs,m.aZ=class extends rn{},m.a_=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},m.aa=function(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,g,v,E)=>{const A=v||E;return i[g]=!A||A.toLowerCase(),""}),i["max-age"]){const u=parseInt(i["max-age"],10);isNaN(u)?delete i["max-age"]:i["max-age"]=u}return i},m.ab=function(o,i){const u=[];for(const g in o)g in i||u.push(g);return u},m.ac=ve,m.ad=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[0],A=i[1],M=i[2],P=i[3],F=i[4],j=i[5],G=i[6],W=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=E*v+F*g,o[1]=A*v+j*g,o[2]=M*v+G*g,o[3]=P*v+W*g,o[4]=F*v-E*g,o[5]=j*v-A*g,o[6]=G*v-M*g,o[7]=W*v-P*g,o},m.ae=function(o){var i=new Ru(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},m.af=Qh,m.ag=function(o,i){let u=0,g=0;if(o.kind==="constant")g=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:A}=o,M=v?ve(cr.interpolationFactor(v,i,E,A),0,1):0;o.kind==="camera"?g=bi.number(o.minSize,o.maxSize,M):u=M}return{uSizeT:u,uSize:g}},m.ai=function(o,{uSize:i,uSizeT:u},{lowerSize:g,upperSize:v}){return o.kind==="source"?g/ea:o.kind==="composite"?bi.number(g/ea,v/ea,u):i},m.aj=Fd,m.ak=function(o,i,u,g){const v=i.y-o.y,E=i.x-o.x,A=g.y-u.y,M=g.x-u.x,P=A*E-M*v;if(P===0)return null;const F=(M*(o.y-u.y)-A*(o.x-u.x))/P;return new C(o.x+F*E,o.y+F*v)},m.al=xg,m.am=um,m.an=yd,m.ao=function(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return[i,u,g,v]},m.ap=pr,m.ar=zd,m.as=function(o,i){var u=i[0],g=i[1],v=i[2],E=i[3],A=i[4],M=i[5],P=i[6],F=i[7],j=i[8],G=i[9],W=i[10],te=i[11],re=i[12],de=i[13],Te=i[14],Pe=i[15],nt=u*M-g*A,Ge=u*P-v*A,Qe=u*F-E*A,ht=g*P-v*M,Et=g*F-E*M,Kt=v*F-E*P,yn=j*de-G*re,Xt=j*Te-W*re,Zt=j*Pe-te*re,on=G*Te-W*de,tn=G*Pe-te*de,Jt=W*Pe-te*Te,yt=nt*Jt-Ge*tn+Qe*on+ht*Zt-Et*Xt+Kt*yn;return yt?(o[0]=(M*Jt-P*tn+F*on)*(yt=1/yt),o[1]=(v*tn-g*Jt-E*on)*yt,o[2]=(de*Kt-Te*Et+Pe*ht)*yt,o[3]=(W*Et-G*Kt-te*ht)*yt,o[4]=(P*Zt-A*Jt-F*Xt)*yt,o[5]=(u*Jt-v*Zt+E*Xt)*yt,o[6]=(Te*Qe-re*Kt-Pe*Ge)*yt,o[7]=(j*Kt-W*Qe+te*Ge)*yt,o[8]=(A*tn-M*Zt+F*yn)*yt,o[9]=(g*Zt-u*tn-E*yn)*yt,o[10]=(re*Et-de*Qe+Pe*nt)*yt,o[11]=(G*Qe-j*Et-te*nt)*yt,o[12]=(M*Xt-A*on-P*yn)*yt,o[13]=(u*on-g*Xt+v*yn)*yt,o[14]=(de*Ge-re*ht-Te*nt)*yt,o[15]=(j*ht-G*Ge+W*nt)*yt,o):null},m.at=Zd,m.au=Nd,m.av=Hd,m.aw=function(){const o={},i=$e.$version;for(const u in $e.$root){const g=$e.$root[u];if(g.required){let v=null;v=u==="version"?i:g.type==="array"?[]:{},v!=null&&(o[u]=v)}}return o},m.ax=Fc,m.ay=We,m.az=function(o){o=o.slice();const i=Object.create(null);for(let u=0;u<o.length;u++)i[o[u].id]=o[u];for(let u=0;u<o.length;u++)"ref"in o[u]&&(o[u]=qt(o[u],i[o[u].ref]));return o},m.b=dt,m.b0=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.b1=function(o,i,u){return o[0]=i[0]*u[0],o[1]=i[1]*u[1],o[2]=i[2]*u[2],o[3]=i[3]*u[3],o},m.b2=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},m.b3=De,m.b4=pg,m.b5=fg,m.b6=function(o,i,u,g,v){var E,A=1/Math.tan(i/2);return o[0]=A/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=A,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,v!=null&&v!==1/0?(o[10]=(v+g)*(E=1/(g-v)),o[14]=2*v*g*E):(o[10]=-1,o[14]=-2*g),o},m.b7=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[4],A=i[5],M=i[6],P=i[7],F=i[8],j=i[9],G=i[10],W=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=E*v+F*g,o[5]=A*v+j*g,o[6]=M*v+G*g,o[7]=P*v+W*g,o[8]=F*v-E*g,o[9]=j*v-A*g,o[10]=G*v-M*g,o[11]=W*v-P*g,o},m.b8=K,m.b9=pe,m.bA=Um,m.bB=function(o){return o.message===ft},m.bC=L,m.bD=ks,m.ba=function(o){return o*Math.PI/180},m.bb=function(o,i){const{x:u,y:g}=ih.fromLngLat(i);return!(o<0||o>25||g<0||g>=1||u<0||u>=1)},m.bc=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},m.bd=class extends q{},m.be=jd,m.bf=zb,m.bh=Dn,m.bi=function(o,i){It.REGISTERED_PROTOCOLS[o]=i},m.bj=function(o){delete It.REGISTERED_PROTOCOLS[o]},m.bk=function(o,i){const u={};for(let v=0;v<o.length;v++){const E=i&&i[o[v].id]||ss(o[v]);i&&(i[o[v].id]=E);let A=u[E];A||(A=u[E]=[]),A.push(o[v])}const g=[];for(const v in u)g.push(u[v]);return g},m.bl=Qt,m.bm=gg,m.bn=yg,m.bo=Km,m.bp=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ar/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const i=o.bucket.layers[0],u=i.layout,g=i._unevaluatedLayout._values,v={layoutIconSize:g["icon-size"].possiblyEvaluate(new Ii(o.bucket.zoom+1),o.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new Ii(o.bucket.zoom+1),o.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new Ii(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=o.bucket.textSizeData;v.compositeTextSizes=[g["text-size"].possiblyEvaluate(new Ii(F),o.canonical),g["text-size"].possiblyEvaluate(new Ii(j),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=o.bucket.iconSizeData;v.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new Ii(F),o.canonical),g["icon-size"].possiblyEvaluate(new Ii(j),o.canonical)]}const E=u.get("text-line-height")*pr,A=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",M=u.get("text-keep-upright"),P=u.get("text-size");for(const F of o.bucket.features){const j=u.get("text-font").evaluate(F,{},o.canonical).join(","),G=P.evaluate(F,{},o.canonical),W=v.layoutTextSize.evaluate(F,{},o.canonical),te=v.layoutIconSize.evaluate(F,{},o.canonical),re={horizontal:{},vertical:void 0},de=F.text;let Te,Pe=[0,0];if(de){const Qe=de.toString(),ht=u.get("text-letter-spacing").evaluate(F,{},o.canonical)*pr,Et=ad(Qe)?ht:0,Kt=u.get("text-anchor").evaluate(F,{},o.canonical),yn=Lg(i,F,o.canonical);if(!yn){const tn=u.get("text-radial-offset").evaluate(F,{},o.canonical);Pe=tn?Cg(Kt,[tn*pr,Gd]):u.get("text-offset").evaluate(F,{},o.canonical).map(Jt=>Jt*pr)}let Xt=A?"center":u.get("text-justify").evaluate(F,{},o.canonical);const Zt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(F,{},o.canonical)*pr:1/0,on=()=>{o.bucket.allowVerticalPlacement&&Oc(Qe)&&(re.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,Kt,"left",Et,Pe,m.ah.vertical,!0,W,G))};if(!A&&yn){const tn=new Set;if(Xt==="auto")for(let yt=0;yt<yn.values.length;yt+=2)tn.add(Zd(yn.values[yt]));else tn.add(Xt);let Jt=!1;for(const yt of tn)if(!re.horizontal[yt])if(Jt)re.horizontal[yt]=re.horizontal[0];else{const cn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,"center",yt,Et,Pe,m.ah.horizontal,!1,W,G);cn&&(re.horizontal[yt]=cn,Jt=cn.positionedLines.length===1)}on()}else{Xt==="auto"&&(Xt=Zd(Kt));const tn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,Kt,Xt,Et,Pe,m.ah.horizontal,!1,W,G);tn&&(re.horizontal[Xt]=tn),on(),Oc(Qe)&&A&&M&&(re.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,Kt,Xt,Et,Pe,m.ah.vertical,!1,W,G))}}let nt=!1;if(F.icon&&F.icon.name){const Qe=o.imageMap[F.icon.name];Qe&&(Te=yb(o.imagePositions[F.icon.name],u.get("icon-offset").evaluate(F,{},o.canonical),u.get("icon-anchor").evaluate(F,{},o.canonical)),nt=!!Qe.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=nt:o.bucket.sdfIcons!==nt&&Ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==o.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const Ge=Rg(re.horizontal)||re.vertical;o.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||Te)&&Db(o.bucket,F,re,Te,o.imageMap,v,W,te,Pe,nt,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},m.bq=Cd,m.br=Ed,m.bs=Td,m.bt=al,m.bu=Md,m.bv=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},m.bw=function(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(Q())try{return yield Bt(o,i,u,g,v)}catch{}return function(E,A,M,P,F){const j=E.width,G=E.height;vt&&wt||(vt=new OffscreenCanvas(j,G),wt=vt.getContext("2d",{willReadFrequently:!0})),vt.width=j,vt.height=G,wt.drawImage(E,0,0,j,G);const W=wt.getImageData(A,M,P,F);return wt.clearRect(0,0,j,G),W.data}(o,i,u,g,v)})},m.bx=mg,m.by=x,m.bz=S,m.c=xt,m.d=o=>l(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(i)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=he,m.f=o=>new Promise((i,u)=>{const g=new Image;g.onload=()=>{i(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=ut})},g.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(o)],{type:"image/png"});g.src=o.byteLength?URL.createObjectURL(v):ut}),m.g=Yt,m.h=(o,i)=>Xn(he(o,{type:"json"}),i),m.i=pt,m.j=Ye,m.k=lt,m.l=(o,i)=>Xn(he(o,{type:"arrayBuffer"}),i),m.m=Xn,m.n=function(o){return new Md(o).readFields(hb,[])},m.o=Xc,m.p=Wm,m.q=k,m.r=sd,m.s=dn,m.t=Nc,m.u=ka,m.v=$e,m.w=Ue,m.x=function([o,i,u]){return i+=90,i*=Math.PI/180,u*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(u),y:o*Math.sin(i)*Math.sin(u),z:o*Math.cos(u)}},m.y=bi,m.z=Ii}),a("worker",["./shared"],function(m){class l{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,Y){for(const le of J){this._layerConfigs[le.id]=le;const fe=this._layers[le.id]=m.aA(le);fe._featureFilter=m.a7(fe.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of Y)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const ce=m.bk(Object.values(this._layerConfigs),this.keyCache);for(const le of ce){const fe=le.map(at=>this._layers[at.id]),je=fe[0];if(je.visibility==="none")continue;const Xe=je.source||"";let Re=this.familiesBySource[Xe];Re||(Re=this.familiesBySource[Xe]={});const et=je.sourceLayer||"_geojsonTileLayer";let gt=Re[et];gt||(gt=Re[et]=[]),gt.push(fe)}}}class x{constructor(J){const Y={},ce=[];for(const Xe in J){const Re=J[Xe],et=Y[Xe]={};for(const gt in Re){const at=Re[+gt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Dt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};ce.push(Dt),et[gt]={rect:Dt,metrics:at.metrics}}}const{w:le,h:fe}=m.p(ce),je=new m.o({width:le||1,height:fe||1});for(const Xe in J){const Re=J[Xe];for(const et in Re){const gt=Re[+et];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const at=Y[Xe][et].rect;m.o.copy(gt.bitmap,je,{x:0,y:0},{x:at.x+1,y:at.y+1},gt.bitmap)}}this.image=je,this.positions=Y}}m.bl("GlyphAtlas",x);class S{constructor(J){this.tileID=new m.S(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[]}parse(J,Y,ce,le){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new m.a5;const fe=new m.bm(Object.keys(J.layers).sort()),je=new m.bn(this.tileID,this.promoteId);je.bucketLayerIDs=[];const Xe={},Re={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce},et=Y.familiesBySource[this.source];for(const Tn in et){const ii=J.layers[Tn];if(!ii)continue;ii.version===1&&m.w(`Vector tile source "${this.source}" layer "${Tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const hi=fe.encode(Tn),Mi=[];for(let Wn=0;Wn<ii.length;Wn++){const Tr=ii.feature(Wn),Do=je.getId(Tr,Tn);Mi.push({feature:Tr,id:Do,index:Wn,sourceLayerIndex:hi})}for(const Wn of et[Tn]){const Tr=Wn[0];Tr.source!==this.source&&m.w(`layer.source = ${Tr.source} does not equal this.source = ${this.source}`),Tr.minzoom&&this.zoom<Math.floor(Tr.minzoom)||Tr.maxzoom&&this.zoom>=Tr.maxzoom||Tr.visibility!=="none"&&(T(Wn,this.zoom,ce),(Xe[Tr.id]=Tr.createBucket({index:je.bucketLayerIDs.length,layers:Wn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hi,sourceID:this.source})).populate(Mi,Re,this.tileID.canonical),je.bucketLayerIDs.push(Wn.map(Do=>Do.id)))}}const gt=m.aF(Re.glyphDependencies,Tn=>Object.keys(Tn).map(Number));this.inFlightDependencies.forEach(Tn=>Tn==null?void 0:Tn.abort()),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(gt).length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),at=le.sendAsync({type:"GG",data:{stacks:gt,source:this.source,tileID:this.tileID,type:"glyphs"}},Tn)}const Dt=Object.keys(Re.iconDependencies);let en=Promise.resolve({});if(Dt.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),en=le.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"icons"}},Tn)}const ln=Object.keys(Re.patternDependencies);let Vn=Promise.resolve({});if(ln.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),Vn=le.sendAsync({type:"GI",data:{icons:ln,source:this.source,tileID:this.tileID,type:"patterns"}},Tn)}const[Ln,Mn,Bn]=yield Promise.all([at,en,Vn]),wi=new x(Ln),ui=new m.bo(Mn,Bn);for(const Tn in Xe){const ii=Xe[Tn];ii instanceof m.a6?(T(ii.layers,this.zoom,ce),m.bp({bucket:ii,glyphMap:Ln,glyphPositions:wi.positions,imageMap:Mn,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ii.hasPattern&&(ii instanceof m.bq||ii instanceof m.br||ii instanceof m.bs)&&(T(ii.layers,this.zoom,ce),ii.addFeatures(Re,this.tileID.canonical,ui.patternPositions))}return this.status="done",{buckets:Object.values(Xe).filter(Tn=>!Tn.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wi.image,imageAtlas:ui,glyphMap:this.returnDependencies?Ln:null,iconMap:this.returnDependencies?Mn:null,glyphPositions:this.returnDependencies?wi.positions:null}})}}function T(Me,J,Y){const ce=new m.z(J);for(const le of Me)le.recalculate(ce,Y)}class C{constructor(J,Y,ce){this.actor=J,this.layerIndex=Y,this.availableImages=ce,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,Y){return m._(this,void 0,void 0,function*(){const ce=yield m.l(J.request,Y);try{return{vectorTile:new m.bt.VectorTile(new m.bu(ce.data)),rawData:ce.data,cacheControl:ce.cacheControl,expires:ce.expires}}catch(le){const fe=new Uint8Array(ce.data);let je=`Unable to parse the tile at ${J.request.url}, `;throw je+=fe[0]===31&&fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.message}`,new Error(je)}})}loadTile(J){return m._(this,void 0,void 0,function*(){const Y=J.uid,ce=!!(J&&J.request&&J.request.collectResourceTiming)&&new m.bv(J.request),le=new S(J);this.loading[Y]=le;const fe=new AbortController;le.abort=fe;try{const je=yield this.loadVectorTile(J,fe);if(delete this.loading[Y],!je)return null;const Xe=je.rawData,Re={};je.expires&&(Re.expires=je.expires),je.cacheControl&&(Re.cacheControl=je.cacheControl);const et={};if(ce){const at=ce.finish();at&&(et.resourceTiming=JSON.parse(JSON.stringify(at)))}le.vectorTile=je.vectorTile;const gt=le.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Y]=le,this.fetching[Y]={rawTileData:Xe,cacheControl:Re,resourceTiming:et};try{const at=yield gt;return m.e({rawTileData:Xe.slice(0)},at,Re,et)}finally{delete this.fetching[Y]}}catch(je){throw delete this.loading[Y],le.status="done",this.loaded[Y]=le,je}})}reloadTile(J){return m._(this,void 0,void 0,function*(){const Y=J.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ce=this.loaded[Y];if(ce.showCollisionBoxes=J.showCollisionBoxes,ce.status==="parsing"){const le=yield ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor);let fe;if(this.fetching[Y]){const{rawTileData:je,cacheControl:Xe,resourceTiming:Re}=this.fetching[Y];delete this.fetching[Y],fe=m.e({rawTileData:je.slice(0)},le,Xe,Re)}else fe=le;return fe}if(ce.status==="done"&&ce.vectorTile)return ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(J){return m._(this,void 0,void 0,function*(){const Y=this.loading,ce=J.uid;Y&&Y[ce]&&Y[ce].abort&&(Y[ce].abort.abort(),delete Y[ce])})}removeTile(J){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class N{constructor(){this.loaded={}}loadTile(J){return m._(this,void 0,void 0,function*(){const{uid:Y,encoding:ce,rawImageData:le,redFactor:fe,greenFactor:je,blueFactor:Xe,baseShift:Re}=J,et=le.width+2,gt=le.height+2,at=m.b(le)?new m.R({width:et,height:gt},yield m.bw(le,-1,-1,et,gt)):le,Dt=new m.bx(Y,at,ce,fe,je,Xe,Re);return this.loaded=this.loaded||{},this.loaded[Y]=Dt,Dt})}removeTile(J){const Y=this.loaded,ce=J.uid;Y&&Y[ce]&&delete Y[ce]}}function B(Me,J){if(Me.length!==0){U(Me[0],J);for(var Y=1;Y<Me.length;Y++)U(Me[Y],!J)}}function U(Me,J){for(var Y=0,ce=0,le=0,fe=Me.length,je=fe-1;le<fe;je=le++){var Xe=(Me[le][0]-Me[je][0])*(Me[je][1]+Me[le][1]),Re=Y+Xe;ce+=Math.abs(Y)>=Math.abs(Xe)?Y-Re+Xe:Xe-Re+Y,Y=Re}Y+ce>=0!=!!J&&Me.reverse()}var ee=m.by(function Me(J,Y){var ce,le=J&&J.type;if(le==="FeatureCollection")for(ce=0;ce<J.features.length;ce++)Me(J.features[ce],Y);else if(le==="GeometryCollection")for(ce=0;ce<J.geometries.length;ce++)Me(J.geometries[ce],Y);else if(le==="Feature")Me(J.geometry,Y);else if(le==="Polygon")B(J.coordinates,Y);else if(le==="MultiPolygon")for(ce=0;ce<J.coordinates.length;ce++)B(J.coordinates[ce],Y);return J});const ie=m.bt.VectorTileFeature.prototype.toGeoJSON;var se={exports:{}},Q=m.bz,K=m.bt.VectorTileFeature,pe=ve;function ve(Me,J){this.options=J||{},this.features=Me,this.length=Me.length}function De(Me,J){this.id=typeof Me.id=="number"?Me.id:void 0,this.type=Me.type,this.rawGeometry=Me.type===1?[Me.geometry]:Me.geometry,this.properties=Me.tags,this.extent=J||4096}ve.prototype.feature=function(Me){return new De(this.features[Me],this.options.extent)},De.prototype.loadGeometry=function(){var Me=this.rawGeometry;this.geometry=[];for(var J=0;J<Me.length;J++){for(var Y=Me[J],ce=[],le=0;le<Y.length;le++)ce.push(new Q(Y[le][0],Y[le][1]));this.geometry.push(ce)}return this.geometry},De.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Me=this.geometry,J=1/0,Y=-1/0,ce=1/0,le=-1/0,fe=0;fe<Me.length;fe++)for(var je=Me[fe],Xe=0;Xe<je.length;Xe++){var Re=je[Xe];J=Math.min(J,Re.x),Y=Math.max(Y,Re.x),ce=Math.min(ce,Re.y),le=Math.max(le,Re.y)}return[J,ce,Y,le]},De.prototype.toGeoJSON=K.prototype.toGeoJSON;var he=m.bA,xe=pe;function be(Me){var J=new he;return function(Y,ce){for(var le in Y.layers)ce.writeMessage(3,Ce,Y.layers[le])}(Me,J),J.finish()}function Ce(Me,J){var Y;J.writeVarintField(15,Me.version||1),J.writeStringField(1,Me.name||""),J.writeVarintField(5,Me.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<Me.length;Y++)ce.feature=Me.feature(Y),J.writeMessage(2,we,ce);var le=ce.keys;for(Y=0;Y<le.length;Y++)J.writeStringField(3,le[Y]);var fe=ce.values;for(Y=0;Y<fe.length;Y++)J.writeMessage(4,St,fe[Y])}function we(Me,J){var Y=Me.feature;Y.id!==void 0&&J.writeVarintField(1,Y.id),J.writeMessage(2,ye,Me),J.writeVarintField(3,Y.type),J.writeMessage(4,pt,Y)}function ye(Me,J){var Y=Me.feature,ce=Me.keys,le=Me.values,fe=Me.keycache,je=Me.valuecache;for(var Xe in Y.properties){var Re=Y.properties[Xe],et=fe[Xe];if(Re!==null){et===void 0&&(ce.push(Xe),fe[Xe]=et=ce.length-1),J.writeVarint(et);var gt=typeof Re;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(Re=JSON.stringify(Re));var at=gt+":"+Re,Dt=je[at];Dt===void 0&&(le.push(Re),je[at]=Dt=le.length-1),J.writeVarint(Dt)}}}function Ue(Me,J){return(J<<3)+(7&Me)}function qe(Me){return Me<<1^Me>>31}function pt(Me,J){for(var Y=Me.loadGeometry(),ce=Me.type,le=0,fe=0,je=Y.length,Xe=0;Xe<je;Xe++){var Re=Y[Xe],et=1;ce===1&&(et=Re.length),J.writeVarint(Ue(1,et));for(var gt=ce===3?Re.length-1:Re.length,at=0;at<gt;at++){at===1&&ce!==1&&J.writeVarint(Ue(2,gt-1));var Dt=Re[at].x-le,en=Re[at].y-fe;J.writeVarint(qe(Dt)),J.writeVarint(qe(en)),le+=Dt,fe+=en}ce===3&&J.writeVarint(Ue(7,1))}}function St(Me,J){var Y=typeof Me;Y==="string"?J.writeStringField(1,Me):Y==="boolean"?J.writeBooleanField(7,Me):Y==="number"&&(Me%1!=0?J.writeDoubleField(3,Me):Me<0?J.writeSVarintField(6,Me):J.writeVarintField(5,Me))}se.exports=be,se.exports.fromVectorTileJs=be,se.exports.fromGeojsonVt=function(Me,J){J=J||{};var Y={};for(var ce in Me)Y[ce]=new xe(Me[ce].features,J),Y[ce].name=ce,Y[ce].version=J.version,Y[ce].extent=J.extent;return be({layers:Y})},se.exports.GeoJSONWrapper=xe;var dt=m.by(se.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Me=>Me},Bt=Math.fround||(vt=new Float32Array(1),Me=>(vt[0]=+Me,vt[0]));var vt;const wt=3,ft=5,xt=6;class It{constructor(J){this.options=Object.assign(Object.create(ut),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:Y,minZoom:ce,maxZoom:le}=this.options;Y&&console.time("total time");const fe=`prepare ${J.length} points`;Y&&console.time(fe),this.points=J;const je=[];for(let Re=0;Re<J.length;Re++){const et=J[Re];if(!et.geometry)continue;const[gt,at]=et.geometry.coordinates,Dt=Bt(Dn(gt)),en=Bt(We(at));je.push(Dt,en,1/0,Re,-1,1),this.options.reduce&&je.push(0)}let Xe=this.trees[le+1]=this._createTree(je);Y&&console.timeEnd(fe);for(let Re=le;Re>=ce;Re--){const et=+Date.now();Xe=this.trees[Re]=this._createTree(this._cluster(Xe,Re)),Y&&console.log("z%d: %d clusters in %dms",Re,Xe.numItems,+Date.now()-et)}return Y&&console.timeEnd("total time"),this}getClusters(J,Y){let ce=((J[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,J[1]));let fe=J[2]===180?180:((J[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)ce=-180,fe=180;else if(ce>fe){const at=this.getClusters([ce,le,180,je],Y),Dt=this.getClusters([-180,le,fe,je],Y);return at.concat(Dt)}const Xe=this.trees[this._limitZoom(Y)],Re=Xe.range(Dn(ce),We(je),Dn(fe),We(le)),et=Xe.data,gt=[];for(const at of Re){const Dt=this.stride*at;gt.push(et[Dt+ft]>1?Yt(et,Dt,this.clusterProps):this.points[et[Dt+wt]])}return gt}getChildren(J){const Y=this._getOriginId(J),ce=this._getOriginZoom(J),le="No cluster with the specified id.",fe=this.trees[ce];if(!fe)throw new Error(le);const je=fe.data;if(Y*this.stride>=je.length)throw new Error(le);const Xe=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Re=fe.within(je[Y*this.stride],je[Y*this.stride+1],Xe),et=[];for(const gt of Re){const at=gt*this.stride;je[at+4]===J&&et.push(je[at+ft]>1?Yt(je,at,this.clusterProps):this.points[je[at+wt]])}if(et.length===0)throw new Error(le);return et}getLeaves(J,Y,ce){const le=[];return this._appendLeaves(le,J,Y=Y||10,ce=ce||0,0),le}getTile(J,Y,ce){const le=this.trees[this._limitZoom(J)],fe=Math.pow(2,J),{extent:je,radius:Xe}=this.options,Re=Xe/je,et=(ce-Re)/fe,gt=(ce+1+Re)/fe,at={features:[]};return this._addTileFeatures(le.range((Y-Re)/fe,et,(Y+1+Re)/fe,gt),le.data,Y,ce,fe,at),Y===0&&this._addTileFeatures(le.range(1-Re/fe,et,1,gt),le.data,fe,ce,fe,at),Y===fe-1&&this._addTileFeatures(le.range(0,et,Re/fe,gt),le.data,-1,ce,fe,at),at.features.length?at:null}getClusterExpansionZoom(J){let Y=this._getOriginZoom(J)-1;for(;Y<=this.options.maxZoom;){const ce=this.getChildren(J);if(Y++,ce.length!==1)break;J=ce[0].properties.cluster_id}return Y}_appendLeaves(J,Y,ce,le,fe){const je=this.getChildren(Y);for(const Xe of je){const Re=Xe.properties;if(Re&&Re.cluster?fe+Re.point_count<=le?fe+=Re.point_count:fe=this._appendLeaves(J,Re.cluster_id,ce,le,fe):fe<le?fe++:J.push(Xe),J.length===ce)break}return fe}_createTree(J){const Y=new m.av(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<J.length;ce+=this.stride)Y.add(J[ce],J[ce+1]);return Y.finish(),Y.data=J,Y}_addTileFeatures(J,Y,ce,le,fe,je){for(const Xe of J){const Re=Xe*this.stride,et=Y[Re+ft]>1;let gt,at,Dt;if(et)gt=pn(Y,Re,this.clusterProps),at=Y[Re],Dt=Y[Re+1];else{const Vn=this.points[Y[Re+wt]];gt=Vn.properties;const[Ln,Mn]=Vn.geometry.coordinates;at=Dn(Ln),Dt=We(Mn)}const en={type:1,geometry:[[Math.round(this.options.extent*(at*fe-ce)),Math.round(this.options.extent*(Dt*fe-le))]],tags:gt};let ln;ln=et||this.options.generateId?Y[Re+wt]:this.points[Y[Re+wt]].id,ln!==void 0&&(en.id=ln),je.features.push(en)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,Y){const{radius:ce,extent:le,reduce:fe,minPoints:je}=this.options,Xe=ce/(le*Math.pow(2,Y)),Re=J.data,et=[],gt=this.stride;for(let at=0;at<Re.length;at+=gt){if(Re[at+2]<=Y)continue;Re[at+2]=Y;const Dt=Re[at],en=Re[at+1],ln=J.within(Re[at],Re[at+1],Xe),Vn=Re[at+ft];let Ln=Vn;for(const Mn of ln){const Bn=Mn*gt;Re[Bn+2]>Y&&(Ln+=Re[Bn+ft])}if(Ln>Vn&&Ln>=je){let Mn,Bn=Dt*Vn,wi=en*Vn,ui=-1;const Tn=((at/gt|0)<<5)+(Y+1)+this.points.length;for(const ii of ln){const hi=ii*gt;if(Re[hi+2]<=Y)continue;Re[hi+2]=Y;const Mi=Re[hi+ft];Bn+=Re[hi]*Mi,wi+=Re[hi+1]*Mi,Re[hi+4]=Tn,fe&&(Mn||(Mn=this._map(Re,at,!0),ui=this.clusterProps.length,this.clusterProps.push(Mn)),fe(Mn,this._map(Re,hi)))}Re[at+4]=Tn,et.push(Bn/Ln,wi/Ln,1/0,Tn,-1,Ln),fe&&et.push(ui)}else{for(let Mn=0;Mn<gt;Mn++)et.push(Re[at+Mn]);if(Ln>1)for(const Mn of ln){const Bn=Mn*gt;if(!(Re[Bn+2]<=Y)){Re[Bn+2]=Y;for(let wi=0;wi<gt;wi++)et.push(Re[Bn+wi])}}}}return et}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,Y,ce){if(J[Y+ft]>1){const je=this.clusterProps[J[Y+xt]];return ce?Object.assign({},je):je}const le=this.points[J[Y+wt]].properties,fe=this.options.map(le);return ce&&fe===le?Object.assign({},fe):fe}}function Yt(Me,J,Y){return{type:"Feature",id:Me[J+wt],properties:pn(Me,J,Y),geometry:{type:"Point",coordinates:[(ce=Me[J],360*(ce-.5)),Xn(Me[J+1])]}};var ce}function pn(Me,J,Y){const ce=Me[J+ft],le=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,fe=Me[J+xt],je=fe===-1?{}:Object.assign({},Y[fe]);return Object.assign(je,{cluster:!0,cluster_id:Me[J+wt],point_count:ce,point_count_abbreviated:le})}function Dn(Me){return Me/360+.5}function We(Me){const J=Math.sin(Me*Math.PI/180),Y=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Y<0?0:Y>1?1:Y}function Xn(Me){const J=(180-360*Me)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function dn(Me,J,Y,ce){let le=ce;const fe=J+(Y-J>>1);let je,Xe=Y-J;const Re=Me[J],et=Me[J+1],gt=Me[Y],at=Me[Y+1];for(let Dt=J+3;Dt<Y;Dt+=3){const en=Ot(Me[Dt],Me[Dt+1],Re,et,gt,at);if(en>le)je=Dt,le=en;else if(en===le){const ln=Math.abs(Dt-fe);ln<Xe&&(je=Dt,Xe=ln)}}le>ce&&(je-J>3&&dn(Me,J,je,ce),Me[je+2]=le,Y-je>3&&dn(Me,je,Y,ce))}function Ot(Me,J,Y,ce,le,fe){let je=le-Y,Xe=fe-ce;if(je!==0||Xe!==0){const Re=((Me-Y)*je+(J-ce)*Xe)/(je*je+Xe*Xe);Re>1?(Y=le,ce=fe):Re>0&&(Y+=je*Re,ce+=Xe*Re)}return je=Me-Y,Xe=J-ce,je*je+Xe*Xe}function Se(Me,J,Y,ce){const le={id:Me??null,type:J,geometry:Y,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")lt(le,Y);else if(J==="Polygon")lt(le,Y[0]);else if(J==="MultiLineString")for(const fe of Y)lt(le,fe);else if(J==="MultiPolygon")for(const fe of Y)lt(le,fe[0]);return le}function lt(Me,J){for(let Y=0;Y<J.length;Y+=3)Me.minX=Math.min(Me.minX,J[Y]),Me.minY=Math.min(Me.minY,J[Y+1]),Me.maxX=Math.max(Me.maxX,J[Y]),Me.maxY=Math.max(Me.maxY,J[Y+1])}function Ye(Me,J,Y,ce){if(!J.geometry)return;const le=J.geometry.coordinates;if(le&&le.length===0)return;const fe=J.geometry.type,je=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let Xe=[],Re=J.id;if(Y.promoteId?Re=J.properties[Y.promoteId]:Y.generateId&&(Re=ce||0),fe==="Point")Ct(le,Xe);else if(fe==="MultiPoint")for(const et of le)Ct(et,Xe);else if(fe==="LineString")$e(le,Xe,je,!1);else if(fe==="MultiLineString"){if(Y.lineMetrics){for(const et of le)Xe=[],$e(et,Xe,je,!1),Me.push(Se(Re,"LineString",Xe,J.properties));return}kt(le,Xe,je,!1)}else if(fe==="Polygon")kt(le,Xe,je,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const et of J.geometry.geometries)Ye(Me,{id:Re,geometry:et,properties:J.properties},Y,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const et of le){const gt=[];kt(et,gt,je,!0),Xe.push(gt)}}Me.push(Se(Re,fe,Xe,J.properties))}function Ct(Me,J){J.push(qt(Me[0]),Ee(Me[1]),0)}function $e(Me,J,Y,ce){let le,fe,je=0;for(let Re=0;Re<Me.length;Re++){const et=qt(Me[Re][0]),gt=Ee(Me[Re][1]);J.push(et,gt,0),Re>0&&(je+=ce?(le*gt-et*fe)/2:Math.sqrt(Math.pow(et-le,2)+Math.pow(gt-fe,2))),le=et,fe=gt}const Xe=J.length-3;J[2]=1,dn(J,0,Xe,Y),J[Xe+2]=1,J.size=Math.abs(je),J.start=0,J.end=J.size}function kt(Me,J,Y,ce){for(let le=0;le<Me.length;le++){const fe=[];$e(Me[le],fe,Y,ce),J.push(fe)}}function qt(Me){return Me/360+.5}function Ee(Me){const J=Math.sin(Me*Math.PI/180),Y=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Y<0?0:Y>1?1:Y}function Gt(Me,J,Y,ce,le,fe,je,Xe){if(ce/=J,fe>=(Y/=J)&&je<ce)return Me;if(je<Y||fe>=ce)return null;const Re=[];for(const et of Me){const gt=et.geometry;let at=et.type;const Dt=le===0?et.minX:et.minY,en=le===0?et.maxX:et.maxY;if(Dt>=Y&&en<ce){Re.push(et);continue}if(en<Y||Dt>=ce)continue;let ln=[];if(at==="Point"||at==="MultiPoint")_n(gt,ln,Y,ce,le);else if(at==="LineString")Jn(gt,ln,Y,ce,le,!1,Xe.lineMetrics);else if(at==="MultiLineString")xn(gt,ln,Y,ce,le,!1);else if(at==="Polygon")xn(gt,ln,Y,ce,le,!0);else if(at==="MultiPolygon")for(const Vn of gt){const Ln=[];xn(Vn,Ln,Y,ce,le,!0),Ln.length&&ln.push(Ln)}if(ln.length){if(Xe.lineMetrics&&at==="LineString"){for(const Vn of ln)Re.push(Se(et.id,at,Vn,et.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(ln.length===1?(at="LineString",ln=ln[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=ln.length===3?"Point":"MultiPoint"),Re.push(Se(et.id,at,ln,et.tags))}}return Re.length?Re:null}function _n(Me,J,Y,ce,le){for(let fe=0;fe<Me.length;fe+=3){const je=Me[fe+le];je>=Y&&je<=ce&&Vi(J,Me[fe],Me[fe+1],Me[fe+2])}}function Jn(Me,J,Y,ce,le,fe,je){let Xe=$i(Me);const Re=le===0?Yi:Jr;let et,gt,at=Me.start;for(let Ln=0;Ln<Me.length-3;Ln+=3){const Mn=Me[Ln],Bn=Me[Ln+1],wi=Me[Ln+2],ui=Me[Ln+3],Tn=Me[Ln+4],ii=le===0?Mn:Bn,hi=le===0?ui:Tn;let Mi=!1;je&&(et=Math.sqrt(Math.pow(Mn-ui,2)+Math.pow(Bn-Tn,2))),ii<Y?hi>Y&&(gt=Re(Xe,Mn,Bn,ui,Tn,Y),je&&(Xe.start=at+et*gt)):ii>ce?hi<ce&&(gt=Re(Xe,Mn,Bn,ui,Tn,ce),je&&(Xe.start=at+et*gt)):Vi(Xe,Mn,Bn,wi),hi<Y&&ii>=Y&&(gt=Re(Xe,Mn,Bn,ui,Tn,Y),Mi=!0),hi>ce&&ii<=ce&&(gt=Re(Xe,Mn,Bn,ui,Tn,ce),Mi=!0),!fe&&Mi&&(je&&(Xe.end=at+et*gt),J.push(Xe),Xe=$i(Me)),je&&(at+=et)}let Dt=Me.length-3;const en=Me[Dt],ln=Me[Dt+1],Vn=le===0?en:ln;Vn>=Y&&Vn<=ce&&Vi(Xe,en,ln,Me[Dt+2]),Dt=Xe.length-3,fe&&Dt>=3&&(Xe[Dt]!==Xe[0]||Xe[Dt+1]!==Xe[1])&&Vi(Xe,Xe[0],Xe[1],Xe[2]),Xe.length&&J.push(Xe)}function $i(Me){const J=[];return J.size=Me.size,J.start=Me.start,J.end=Me.end,J}function xn(Me,J,Y,ce,le,fe){for(const je of Me)Jn(je,J,Y,ce,le,fe,!1)}function Vi(Me,J,Y,ce){Me.push(J,Y,ce)}function Yi(Me,J,Y,ce,le,fe){const je=(fe-J)/(ce-J);return Vi(Me,fe,Y+(le-Y)*je,1),je}function Jr(Me,J,Y,ce,le,fe){const je=(fe-Y)/(le-Y);return Vi(Me,J+(ce-J)*je,fe,1),je}function ct(Me,J){const Y=[];for(let ce=0;ce<Me.length;ce++){const le=Me[ce],fe=le.type;let je;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")je=yr(le.geometry,J);else if(fe==="MultiLineString"||fe==="Polygon"){je=[];for(const Xe of le.geometry)je.push(yr(Xe,J))}else if(fe==="MultiPolygon"){je=[];for(const Xe of le.geometry){const Re=[];for(const et of Xe)Re.push(yr(et,J));je.push(Re)}}Y.push(Se(le.id,fe,je,le.tags))}return Y}function yr(Me,J){const Y=[];Y.size=Me.size,Me.start!==void 0&&(Y.start=Me.start,Y.end=Me.end);for(let ce=0;ce<Me.length;ce+=3)Y.push(Me[ce]+J,Me[ce+1],Me[ce+2]);return Y}function kn(Me,J){if(Me.transformed)return Me;const Y=1<<Me.z,ce=Me.x,le=Me.y;for(const fe of Me.features){const je=fe.geometry,Xe=fe.type;if(fe.geometry=[],Xe===1)for(let Re=0;Re<je.length;Re+=2)fe.geometry.push(mn(je[Re],je[Re+1],J,Y,ce,le));else for(let Re=0;Re<je.length;Re++){const et=[];for(let gt=0;gt<je[Re].length;gt+=2)et.push(mn(je[Re][gt],je[Re][gt+1],J,Y,ce,le));fe.geometry.push(et)}}return Me.transformed=!0,Me}function mn(Me,J,Y,ce,le,fe){return[Math.round(Y*(Me*ce-le)),Math.round(Y*(J*ce-fe))]}function Ls(Me,J,Y,ce,le){const fe=J===le.maxZoom?0:le.tolerance/((1<<J)*le.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Me.length,source:null,x:Y,y:ce,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Xe of Me)Mt(je,Xe,fe,le);return je}function Mt(Me,J,Y,ce){const le=J.geometry,fe=J.type,je=[];if(Me.minX=Math.min(Me.minX,J.minX),Me.minY=Math.min(Me.minY,J.minY),Me.maxX=Math.max(Me.maxX,J.maxX),Me.maxY=Math.max(Me.maxY,J.maxY),fe==="Point"||fe==="MultiPoint")for(let Xe=0;Xe<le.length;Xe+=3)je.push(le[Xe],le[Xe+1]),Me.numPoints++,Me.numSimplified++;else if(fe==="LineString")Cn(je,le,Me,Y,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Xe=0;Xe<le.length;Xe++)Cn(je,le[Xe],Me,Y,fe==="Polygon",Xe===0);else if(fe==="MultiPolygon")for(let Xe=0;Xe<le.length;Xe++){const Re=le[Xe];for(let et=0;et<Re.length;et++)Cn(je,Re[et],Me,Y,!0,et===0)}if(je.length){let Xe=J.tags||null;if(fe==="LineString"&&ce.lineMetrics){Xe={};for(const et in J.tags)Xe[et]=J.tags[et];Xe.mapbox_clip_start=le.start/le.size,Xe.mapbox_clip_end=le.end/le.size}const Re={geometry:je,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Xe};J.id!==null&&(Re.id=J.id),Me.features.push(Re)}}function Cn(Me,J,Y,ce,le,fe){const je=ce*ce;if(ce>0&&J.size<(le?je:ce))return void(Y.numPoints+=J.length/3);const Xe=[];for(let Re=0;Re<J.length;Re+=3)(ce===0||J[Re+2]>je)&&(Y.numSimplified++,Xe.push(J[Re],J[Re+1])),Y.numPoints++;le&&function(Re,et){let gt=0;for(let at=0,Dt=Re.length,en=Dt-2;at<Dt;en=at,at+=2)gt+=(Re[at]-Re[en])*(Re[at+1]+Re[en+1]);if(gt>0===et)for(let at=0,Dt=Re.length;at<Dt/2;at+=2){const en=Re[at],ln=Re[at+1];Re[at]=Re[Dt-2-at],Re[at+1]=Re[Dt-1-at],Re[Dt-2-at]=en,Re[Dt-1-at]=ln}}(Xe,fe),Me.push(Xe)}const At={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class vr{constructor(J,Y){const ce=(Y=this.options=function(fe,je){for(const Xe in je)fe[Xe]=je[Xe];return fe}(Object.create(At),Y)).debug;if(ce&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let le=function(fe,je){const Xe=[];if(fe.type==="FeatureCollection")for(let Re=0;Re<fe.features.length;Re++)Ye(Xe,fe.features[Re],je,Re);else Ye(Xe,fe.type==="Feature"?fe:{geometry:fe},je);return Xe}(J,Y);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(fe,je){const Xe=je.buffer/je.extent;let Re=fe;const et=Gt(fe,1,-1-Xe,Xe,0,-1,2,je),gt=Gt(fe,1,1-Xe,2+Xe,0,-1,2,je);return(et||gt)&&(Re=Gt(fe,1,-Xe,1+Xe,0,-1,2,je)||[],et&&(Re=ct(et,1).concat(Re)),gt&&(Re=Re.concat(ct(gt,-1)))),Re}(le,Y),le.length&&this.splitTile(le,0,0,0),ce&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,Y,ce,le,fe,je,Xe){const Re=[J,Y,ce,le],et=this.options,gt=et.debug;for(;Re.length;){le=Re.pop(),ce=Re.pop(),Y=Re.pop(),J=Re.pop();const at=1<<Y,Dt=Gr(Y,ce,le);let en=this.tiles[Dt];if(!en&&(gt>1&&console.time("creation"),en=this.tiles[Dt]=Ls(J,Y,ce,le,et),this.tileCoords.push({z:Y,x:ce,y:le}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,ce,le,en.numFeatures,en.numPoints,en.numSimplified),console.timeEnd("creation"));const Mi=`z${Y}`;this.stats[Mi]=(this.stats[Mi]||0)+1,this.total++}if(en.source=J,fe==null){if(Y===et.indexMaxZoom||en.numPoints<=et.indexMaxPoints)continue}else{if(Y===et.maxZoom||Y===fe)continue;if(fe!=null){const Mi=fe-Y;if(ce!==je>>Mi||le!==Xe>>Mi)continue}}if(en.source=null,J.length===0)continue;gt>1&&console.time("clipping");const ln=.5*et.buffer/et.extent,Vn=.5-ln,Ln=.5+ln,Mn=1+ln;let Bn=null,wi=null,ui=null,Tn=null,ii=Gt(J,at,ce-ln,ce+Ln,0,en.minX,en.maxX,et),hi=Gt(J,at,ce+Vn,ce+Mn,0,en.minX,en.maxX,et);J=null,ii&&(Bn=Gt(ii,at,le-ln,le+Ln,1,en.minY,en.maxY,et),wi=Gt(ii,at,le+Vn,le+Mn,1,en.minY,en.maxY,et),ii=null),hi&&(ui=Gt(hi,at,le-ln,le+Ln,1,en.minY,en.maxY,et),Tn=Gt(hi,at,le+Vn,le+Mn,1,en.minY,en.maxY,et),hi=null),gt>1&&console.timeEnd("clipping"),Re.push(Bn||[],Y+1,2*ce,2*le),Re.push(wi||[],Y+1,2*ce,2*le+1),Re.push(ui||[],Y+1,2*ce+1,2*le),Re.push(Tn||[],Y+1,2*ce+1,2*le+1)}}getTile(J,Y,ce){J=+J,Y=+Y,ce=+ce;const le=this.options,{extent:fe,debug:je}=le;if(J<0||J>24)return null;const Xe=1<<J,Re=Gr(J,Y=Y+Xe&Xe-1,ce);if(this.tiles[Re])return kn(this.tiles[Re],fe);je>1&&console.log("drilling down to z%d-%d-%d",J,Y,ce);let et,gt=J,at=Y,Dt=ce;for(;!et&&gt>0;)gt--,at>>=1,Dt>>=1,et=this.tiles[Gr(gt,at,Dt)];return et&&et.source?(je>1&&(console.log("found parent tile z%d-%d-%d",gt,at,Dt),console.time("drilling down")),this.splitTile(et.source,gt,at,Dt,J,Y,ce),je>1&&console.timeEnd("drilling down"),this.tiles[Re]?kn(this.tiles[Re],fe):null):null}}function Gr(Me,J,Y){return 32*((1<<Me)*Y+J)+Me}function wn(Me,J){return J?Me.properties[J]:Me.id}function Li(Me,J){if(Me==null)return!0;if(Me.type==="Feature")return wn(Me,J)!=null;if(Me.type==="FeatureCollection"){const Y=new Set;for(const ce of Me.features){const le=wn(ce,J);if(le==null||Y.has(le))return!1;Y.add(le)}return!0}return!1}function Ar(Me,J){const Y=new Map;if(Me!=null)if(Me.type==="Feature")Y.set(wn(Me,J),Me);else for(const ce of Me.features)Y.set(wn(ce,J),ce);return Y}class Ji extends C{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,Y){return m._(this,void 0,void 0,function*(){const ce=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!le)return null;const fe=new class{constructor(Xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.X,this.length=Xe.length,this._features=Xe}feature(Xe){return new class{constructor(Re){this._feature=Re,this.extent=m.X,this.type=Re.type,this.properties=Re.tags,"id"in Re&&!isNaN(Re.id)&&(this.id=parseInt(Re.id,10))}loadGeometry(){if(this._feature.type===1){const Re=[];for(const et of this._feature.geometry)Re.push([new m.P(et[0],et[1])]);return Re}{const Re=[];for(const et of this._feature.geometry){const gt=[];for(const at of et)gt.push(new m.P(at[0],at[1]));Re.push(gt)}return Re}}toGeoJSON(Re,et,gt){return ie.call(this,Re,et,gt)}}(this._features[Xe])}}(le.features);let je=dt(fe);return je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),{vectorTile:fe,rawData:je.buffer}})}loadData(J){return m._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const ce=!!(J&&J.request&&J.request.collectResourceTiming)&&new m.bv(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest),this._geoJSONIndex=J.cluster?new It(function({superclusterOptions:je,clusterProperties:Xe}){if(!Xe||!je)return je;const Re={},et={},gt={accumulated:null,zoom:0},at={properties:null},Dt=Object.keys(Xe);for(const en of Dt){const[ln,Vn]=Xe[en],Ln=m.bC(Vn),Mn=m.bC(typeof ln=="string"?[ln,["accumulated"],["get",en]]:ln);Re[en]=Ln.value,et[en]=Mn.value}return je.map=en=>{at.properties=en;const ln={};for(const Vn of Dt)ln[Vn]=Re[Vn].evaluate(gt,at);return ln},je.reduce=(en,ln)=>{at.properties=ln;for(const Vn of Dt)gt.accumulated=en[Vn],en[Vn]=et[Vn].evaluate(gt,at)},je}(J)).load((yield this._pendingData).features):(le=yield this._pendingData,new vr(le,J.geojsonVtOptions)),this.loaded={};const fe={};if(ce){const je=ce.finish();je&&(fe.resourceTiming={},fe.resourceTiming[J.source]=JSON.parse(JSON.stringify(je)))}return fe}catch(fe){if(delete this._pendingRequest,m.bB(fe))return{abandoned:!0};throw fe}var le})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){const Y=this.loaded;return Y&&Y[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,Y){return m._(this,void 0,void 0,function*(){let ce=yield this.loadGeoJSON(J,Y);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(ee(ce,!0),J.filter){const le=m.bC(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(je=>`${je.key}: ${je.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(je=>le.value.evaluate({zoom:0},je))}}return ce})}loadGeoJSON(J,Y){return m._(this,void 0,void 0,function*(){const{promoteId:ce}=J;if(J.request){const le=yield m.h(J.request,Y);return this._dataUpdateable=Li(le.data,ce)?Ar(le.data,ce):void 0,le.data}if(typeof J.data=="string")try{const le=JSON.parse(J.data);return this._dataUpdateable=Li(le,ce)?Ar(le,ce):void 0,le}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return function(le,fe,je){var Xe,Re,et,gt;if(fe.removeAll&&le.clear(),fe.remove)for(const at of fe.remove)le.delete(at);if(fe.add)for(const at of fe.add){const Dt=wn(at,je);Dt!=null&&le.set(Dt,at)}if(fe.update)for(const at of fe.update){let Dt=le.get(at.id);if(Dt==null)continue;const en=!at.removeAllProperties&&(((Xe=at.removeProperties)===null||Xe===void 0?void 0:Xe.length)>0||((Re=at.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0);if((at.newGeometry||at.removeAllProperties||en)&&(Dt=Object.assign({},Dt),le.set(at.id,Dt),en&&(Dt.properties=Object.assign({},Dt.properties))),at.newGeometry&&(Dt.geometry=at.newGeometry),at.removeAllProperties)Dt.properties={};else if(((et=at.removeProperties)===null||et===void 0?void 0:et.length)>0)for(const ln of at.removeProperties)Object.prototype.hasOwnProperty.call(Dt.properties,ln)&&delete Dt.properties[ln];if(((gt=at.addOrUpdateProperties)===null||gt===void 0?void 0:gt.length)>0)for(const{key:ln,value:Vn}of at.addOrUpdateProperties)Dt.properties[ln]=Vn}}(this._dataUpdateable,J.dataDiff,ce),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(J){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class Zr{constructor(J){this.self=J,this.actor=new m.F(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,ce)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=ce},this.self.addProtocol=m.bi,this.self.removeProtocol=m.bj,this.self.registerRTLTextPlugin=Y=>{if(m.bD.isParsed())throw new Error("RTL text plugin already registered.");m.bD.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,ce)=>this._getDEMWorkerSource(Y,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RDT",(Y,ce)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,ce.source).removeTile(ce)})),this.actor.registerMessageHandler("GCEZ",(Y,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ce.type,ce.source).getClusterExpansionZoom(ce)})),this.actor.registerMessageHandler("GCC",(Y,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ce.type,ce.source).getClusterChildren(ce)})),this.actor.registerMessageHandler("GCL",(Y,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ce.type,ce.source).getClusterLeaves(ce)})),this.actor.registerMessageHandler("LD",(Y,ce)=>this._getWorkerSource(Y,ce.type,ce.source).loadData(ce)),this.actor.registerMessageHandler("GD",(Y,ce)=>this._getWorkerSource(Y,ce.type,ce.source).getData()),this.actor.registerMessageHandler("LT",(Y,ce)=>this._getWorkerSource(Y,ce.type,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RT",(Y,ce)=>this._getWorkerSource(Y,ce.type,ce.source).reloadTile(ce)),this.actor.registerMessageHandler("AT",(Y,ce)=>this._getWorkerSource(Y,ce.type,ce.source).abortTile(ce)),this.actor.registerMessageHandler("RMT",(Y,ce)=>this._getWorkerSource(Y,ce.type,ce.source).removeTile(ce)),this.actor.registerMessageHandler("RS",(Y,ce)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][ce.type]||!this.workerSources[Y][ce.type][ce.source])return;const le=this.workerSources[Y][ce.type][ce.source];delete this.workerSources[Y][ce.type][ce.source],le.removeSource!==void 0&&le.removeSource(ce)})),this.actor.registerMessageHandler("RM",Y=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,ce)=>m._(this,void 0,void 0,function*(){this.referrer=ce})),this.actor.registerMessageHandler("SRPS",(Y,ce)=>this._syncRTLPluginState(Y,ce)),this.actor.registerMessageHandler("IS",(Y,ce)=>m._(this,void 0,void 0,function*(){this.self.importScripts(ce)})),this.actor.registerMessageHandler("SI",(Y,ce)=>this._setImages(Y,ce)),this.actor.registerMessageHandler("UL",(Y,ce)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(ce.layers,ce.removedIds)})),this.actor.registerMessageHandler("SL",(Y,ce)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(ce)}))}_setImages(J,Y){return m._(this,void 0,void 0,function*(){this.availableImages[J]=Y;for(const ce in this.workerSources[J]){const le=this.workerSources[J][ce];for(const fe in le)le[fe].availableImages=Y}})}_syncRTLPluginState(J,Y){return m._(this,void 0,void 0,function*(){if(m.bD.isParsed())return m.bD.getState();if(Y.pluginStatus!=="loading")return m.bD.setState(Y),Y;const ce=Y.pluginURL;if(this.self.importScripts(ce),m.bD.isParsed()){const le={pluginStatus:"loaded",pluginURL:ce};return m.bD.setState(le),le}throw m.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ce}`)})}_getAvailableImages(J){let Y=this.availableImages[J];return Y||(Y=[]),Y}_getLayerIndex(J){let Y=this.layerIndexes[J];return Y||(Y=this.layerIndexes[J]=new l),Y}_getWorkerSource(J,Y,ce){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Y]||(this.workerSources[J][Y]={}),!this.workerSources[J][Y][ce]){const le={sendAsync:(fe,je)=>(fe.targetMapId=J,this.actor.sendAsync(fe,je))};switch(Y){case"vector":this.workerSources[J][Y][ce]=new C(le,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][Y][ce]=new Ji(le,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][Y][ce]=new this.externalWorkerSourceTypes[Y](le,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][Y][ce]}_getDEMWorkerSource(J,Y){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][Y]||(this.demWorkerSources[J][Y]=new N),this.demWorkerSources[J][Y]}}return m.i(self)&&(self.worker=new Zr(self)),Zr}),a("index",["exports","./shared"],function(m,l){var x="4.7.0";let S,T;const C={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:k=>new Promise((t,f)=>{const _=requestAnimationFrame(t);k.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),f(l.c())})}),getImageData(k,t=0){return this.getImageCanvasContext(k).getImageData(-t,-t,k.width+2*t,k.height+2*t)},getImageCanvasContext(k){const t=window.document.createElement("canvas"),f=t.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return t.width=k.width,t.height=k.height,f.drawImage(k,0,0,k.width,k.height),f},resolveURL:k=>(S||(S=document.createElement("a")),S.href=k,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class N{static testProp(t){if(!N.docStyle)return t[0];for(let f=0;f<t.length;f++)if(t[f]in N.docStyle)return t[f];return t[0]}static create(t,f,_){const y=window.document.createElement(t);return f!==void 0&&(y.className=f),_&&_.appendChild(y),y}static createNS(t,f){return window.document.createElementNS(t,f)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(t,f){t.style[N.transformProp]=f}static addEventListener(t,f,_,y={}){t.addEventListener(f,_,"passive"in y?y:y.capture)}static removeEventListener(t,f,_,y={}){t.removeEventListener(f,_,"passive"in y?y:y.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(t){const f=t.getBoundingClientRect();return{x:f.width/t.offsetWidth||1,y:f.height/t.offsetHeight||1,boundingClientRect:f}}static getPoint(t,f,_){const y=f.boundingClientRect;return new l.P((_.clientX-y.left)/f.x-t.clientLeft,(_.clientY-y.top)/f.y-t.clientTop)}static mousePos(t,f){const _=N.getScale(t);return N.getPoint(t,_,f)}static touchPos(t,f){const _=[],y=N.getScale(t);for(let w=0;w<f.length;w++)_.push(N.getPoint(t,y,f[w]));return _}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(k){!ie&&ee&&(se?Q(k):U=k)}};let U,ee,ie=!1,se=!1;function Q(k){const t=k.createTexture();k.bindTexture(k.TEXTURE_2D,t);try{if(k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,ee),k.isContextLost())return;B.supported=!0}catch{}k.deleteTexture(t),ie=!0}var K;typeof document<"u"&&(ee=document.createElement("img"),ee.onload=()=>{U&&Q(U),U=null,se=!0},ee.onerror=()=>{ie=!0,U=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(k){let t,f,_,y;k.resetRequestQueue=()=>{t=[],f=0,_=0,y={}},k.addThrottleControl=z=>{const q=_++;return y[q]=z,q},k.removeThrottleControl=z=>{delete y[z],R()},k.getImage=(z,q,H=!0)=>new Promise((X,ne)=>{B.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),l.e(z,{type:"image"}),t.push({abortController:q,requestParameters:z,supportImageRefresh:H,state:"queued",onError:ge=>{ne(ge)},onSuccess:ge=>{X(ge)}}),R()});const w=z=>l._(this,void 0,void 0,function*(){z.state="running";const{requestParameters:q,supportImageRefresh:H,onError:X,onSuccess:ne,abortController:ge}=z,ke=H===!1&&!l.i(self)&&!l.g(q.url)&&(!q.headers||Object.keys(q.headers).reduce((ze,Ve)=>ze&&Ve==="accept",!0));f++;const Le=ke?D(q,ge):l.m(q,ge);try{const ze=yield Le;delete z.abortController,z.state="completed",ze.data instanceof HTMLImageElement||l.b(ze.data)?ne(ze):ze.data&&ne({data:yield(Ne=ze.data,typeof createImageBitmap=="function"?l.d(Ne):l.f(Ne)),cacheControl:ze.cacheControl,expires:ze.expires})}catch(ze){delete z.abortController,X(ze)}finally{f--,R()}var Ne}),R=()=>{const z=(()=>{for(const q of Object.keys(y))if(y[q]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let q=f;q<z&&t.length>0;q++){const H=t.shift();H.abortController.signal.aborted?q--:w(H)}},D=(z,q)=>new Promise((H,X)=>{const ne=new Image,ge=z.url,ke=z.credentials;ke&&ke==="include"?ne.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!l.s(ge))&&(ne.crossOrigin="anonymous"),q.signal.addEventListener("abort",()=>{ne.src="",X(l.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,H({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,q.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=ge})}(K||(K={})),K.resetRequestQueue();class pe{constructor(t){this._transformRequestFn=t}transformRequest(t,f){return this._transformRequestFn&&this._transformRequestFn(t,f)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ve(k){var t=new l.A(3);return t[0]=k[0],t[1]=k[1],t[2]=k[2],t}var De,he=function(k,t,f){return k[0]=t[0]-f[0],k[1]=t[1]-f[1],k[2]=t[2]-f[2],k};De=new l.A(3),l.A!=Float32Array&&(De[0]=0,De[1]=0,De[2]=0);var xe=function(k){var t=k[0],f=k[1];return t*t+f*f};function be(k){const t=[];if(typeof k=="string")t.push({id:"default",url:k});else if(k&&k.length>0){const f=[];for(const{id:_,url:y}of k){const w=`${_}${y}`;f.indexOf(w)===-1&&(f.push(w),t.push({id:_,url:y}))}}return t}function Ce(k,t,f){const _=k.split("?");return _[0]+=`${t}${f}`,_.join("?")}(function(){var k=new l.A(2);l.A!=Float32Array&&(k[0]=0,k[1]=0)})();class we{constructor(t,f,_,y){this.context=t,this.format=_,this.texture=t.gl.createTexture(),this.update(f,y)}update(t,f,_){const{width:y,height:w}=t,R=!(this.size&&this.size[0]===y&&this.size[1]===w||_),{context:D}=this,{gl:z}=D;if(this.useMipmap=!!(f&&f.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!f||f.premultiply!==!1)),R)this.size=[y,w],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,t):z.texImage2D(z.TEXTURE_2D,0,this.format,y,w,0,this.format,z.UNSIGNED_BYTE,t.data);else{const{x:q,y:H}=_||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texSubImage2D(z.TEXTURE_2D,0,q,H,z.RGBA,z.UNSIGNED_BYTE,t):z.texSubImage2D(z.TEXTURE_2D,0,q,H,y,w,z.RGBA,z.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(t,f,_){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),_!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=w.LINEAR),t!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,t),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,_||t),this.filter=t),f!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,f),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ye(k){const{userImage:t}=k;return!!(t&&t.render&&t.render())&&(k.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ue extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:f,promiseResolve:_}of this.requestors)_(this._getImagesForIds(f));this.requestors=[]}}getImage(t){const f=this.images[t];if(f&&!f.data&&f.spriteData){const _=f.spriteData;f.data=new l.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),f.spriteData=null}return f}addImage(t,f){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,f)&&(this.images[t]=f)}_validate(t,f){let _=!0;const y=f.data||f.spriteData;return this._validateStretch(f.stretchX,y&&y.width)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,y&&y.height)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "content" value`))),_=!1),_}_validateStretch(t,f){if(!t)return!0;let _=0;for(const y of t){if(y[0]<_||y[1]<y[0]||f<y[1])return!1;_=y[1]}return!0}_validateContent(t,f){if(!t)return!0;if(t.length!==4)return!1;const _=f.spriteData,y=_&&_.width||f.data.width,w=_&&_.height||f.data.height;return!(t[0]<0||y<t[0]||t[1]<0||w<t[1]||t[2]<0||y<t[2]||t[3]<0||w<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,f,_=!0){const y=this.getImage(t);if(_&&(y.data.width!==f.data.width||y.data.height!==f.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=y.version+1,this.images[t]=f,this.updatedImages[t]=!0}removeImage(t){const f=this.images[t];delete this.images[t],delete this.patterns[t],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((f,_)=>{let y=!0;if(!this.isLoaded())for(const w of t)this.images[w]||(y=!1);this.isLoaded()||y?f(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:f})})}_getImagesForIds(t){const f={};for(const _ of t){let y=this.getImage(_);y||(this.fire(new l.k("styleimagemissing",{id:_})),y=this.getImage(_)),y?f[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:l.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:t,height:f}=this.atlasImage;return{width:t,height:f}}getPattern(t){const f=this.patterns[t],_=this.getImage(t);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new l.I(y,_);this.patterns[t]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const f=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(t,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const w in this.patterns)t.push(this.patterns[w].bin);const{w:f,h:_}=l.p(t),y=this.atlasImage;y.resize({width:f||1,height:_||1});for(const w in this.patterns){const{bin:R}=this.patterns[w],D=R.x+1,z=R.y+1,q=this.getImage(w).data,H=q.width,X=q.height;l.R.copy(q,y,{x:0,y:0},{x:D,y:z},{width:H,height:X}),l.R.copy(q,y,{x:0,y:X-1},{x:D,y:z-1},{width:H,height:1}),l.R.copy(q,y,{x:0,y:0},{x:D,y:z+X},{width:H,height:1}),l.R.copy(q,y,{x:H-1,y:0},{x:D-1,y:z},{width:1,height:X}),l.R.copy(q,y,{x:0,y:0},{x:D+H,y:z},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const f of t){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.getImage(f);_||l.w(`Image with ID: "${f}" was not found`),ye(_)&&this.updateImage(f,_)}}}const qe=1e20;function pt(k,t,f,_,y,w,R,D,z){for(let q=t;q<t+_;q++)St(k,f*w+q,w,y,R,D,z);for(let q=f;q<f+y;q++)St(k,q*w+t,1,_,R,D,z)}function St(k,t,f,_,y,w,R){w[0]=0,R[0]=-qe,R[1]=qe,y[0]=k[t];for(let D=1,z=0,q=0;D<_;D++){y[D]=k[t+D*f];const H=D*D;do{const X=w[z];q=(y[D]-y[X]+H-X*X)/(D-X)/2}while(q<=R[z]&&--z>-1);z++,w[z]=D,R[z]=q,R[z+1]=qe}for(let D=0,z=0;D<_;D++){for(;R[z+1]<D;)z++;const q=w[z],H=D-q;k[t+D*f]=y[q]+H*H}}class dt{constructor(t,f){this.requestManager=t,this.localIdeographFontFamily=f,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,function*(){const f=[];for(const w in t)for(const R of t[w])f.push(this._getAndCacheGlyphsPromise(w,R));const _=yield Promise.all(f),y={};for(const{stack:w,id:R,glyph:D}of _)y[w]||(y[w]={}),y[w][R]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return y})}_getAndCacheGlyphsPromise(t,f){return l._(this,void 0,void 0,function*(){let _=this.entries[t];_||(_=this.entries[t]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[f];if(y!==void 0)return{stack:t,id:f,glyph:y};if(y=this._tinySDF(_,t,f),y)return _.glyphs[f]=y,{stack:t,id:f,glyph:y};const w=Math.floor(f/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[w])return{stack:t,id:f,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[w]){const D=dt.loadGlyphRange(t,w,this.url,this.requestManager);_.requests[w]=D}const R=yield _.requests[w];for(const D in R)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=R[+D]);return _.ranges[w]=!0,{stack:t,id:f,glyph:R[f]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(t))}_tinySDF(t,f,_){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(_))return;let w=t.tinySDF;if(!w){let D="400";/bold/i.test(f)?D="900":/medium/i.test(f)?D="500":/light/i.test(f)&&(D="200"),w=t.tinySDF=new dt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:D})}const R=w.draw(String.fromCharCode(_));return{id:_,bitmap:new l.o({width:R.width||60,height:R.height||60},R.data),metrics:{width:R.glyphWidth/2||24,height:R.glyphHeight/2||24,left:R.glyphLeft/2+.5||0,top:R.glyphTop/2-27.5||-8,advance:R.glyphAdvance/2||24,isDoubleResolution:!0}}}}dt.loadGlyphRange=function(k,t,f,_){return l._(this,void 0,void 0,function*(){const y=256*t,w=y+255,R=_.transformRequest(f.replace("{fontstack}",k).replace("{range}",`${y}-${w}`),"Glyphs"),D=yield l.l(R,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${t}, ${y}-${w}`);const z={};for(const q of l.n(D.data))z[q.id]=q;return z})},dt.TinySDF=class{constructor({fontSize:k=24,buffer:t=3,radius:f=8,cutoff:_=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:R="normal"}={}){this.buffer=t,this.cutoff=_,this.radius=f;const D=this.size=k+4*t,z=this._createCanvas(D),q=this.ctx=z.getContext("2d",{willReadFrequently:!0});q.font=`${R} ${w} ${k}px ${y}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(k){const t=document.createElement("canvas");return t.width=t.height=k,t}draw(k){const{width:t,actualBoundingBoxAscent:f,actualBoundingBoxDescent:_,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(k),R=Math.ceil(f),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),z=Math.min(this.size-this.buffer,R+Math.ceil(_)),q=D+2*this.buffer,H=z+2*this.buffer,X=Math.max(q*H,0),ne=new Uint8ClampedArray(X),ge={data:ne,width:q,height:H,glyphWidth:D,glyphHeight:z,glyphTop:R,glyphLeft:0,glyphAdvance:t};if(D===0||z===0)return ge;const{ctx:ke,buffer:Le,gridInner:Ne,gridOuter:ze}=this;ke.clearRect(Le,Le,D,z),ke.fillText(k,Le,Le+R);const Ve=ke.getImageData(Le,Le,D,z);ze.fill(qe,0,X),Ne.fill(0,0,X);for(let Ae=0;Ae<z;Ae++)for(let He=0;He<D;He++){const Je=Ve.data[4*(Ae*D+He)+3]/255;if(Je===0)continue;const st=(Ae+Le)*q+He+Le;if(Je===1)ze[st]=0,Ne[st]=qe;else{const bt=.5-Je;ze[st]=bt>0?bt*bt:0,Ne[st]=bt<0?bt*bt:0}}pt(ze,0,0,q,H,q,this.f,this.v,this.z),pt(Ne,Le,Le,D,z,q,this.f,this.v,this.z);for(let Ae=0;Ae<X;Ae++){const He=Math.sqrt(ze[Ae])-Math.sqrt(Ne[Ae]);ne[Ae]=Math.round(255-255*(He/this.radius+this.cutoff))}return ge}};class ut{constructor(){this.specification=l.v.light.position}possiblyEvaluate(t,f){return l.x(t.expression.evaluate(f))}interpolate(t,f,_){return{x:l.y.number(t.x,f.x,_),y:l.y.number(t.y,f.y,_),z:l.y.number(t.z,f.z,_)}}}let Bt;class vt extends l.E{constructor(t){super(),Bt=Bt||new l.q({anchor:new l.D(l.v.light.anchor),position:new ut,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Bt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,f={}){if(!this._validate(l.r,t,f))for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,f,_){return(!_||_.validate!==!1)&&l.t(this,t.call(l.u,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const wt=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class ft extends l.E{constructor(t){super(),this._transitionable=new l.T(wt),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(t,f={}){if(!this._validate(l.B,t,f)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,f,_={}){return(_==null?void 0:_.validate)!==!1&&l.t(this,t.call(l.u,l.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class xt{constructor(t,f){this.width=t,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,f){const _=t.join(",")+String(f);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(t,f)),this.dashEntry[_]}getDashRanges(t,f,_){const y=[];let w=t.length%2==1?-t[t.length-1]*_:0,R=t[0]*_,D=!0;y.push({left:w,right:R,isDash:D,zeroLength:t[0]===0});let z=t[0];for(let q=1;q<t.length;q++){D=!D;const H=t[q];w=z*_,z+=H,R=z*_,y.push({left:w,right:R,isDash:D,zeroLength:H===0})}return y}addRoundDash(t,f,_){const y=f/2;for(let w=-_;w<=_;w++){const R=this.width*(this.nextRow+_+w);let D=0,z=t[D];for(let q=0;q<this.width;q++){q/z.right>1&&(z=t[++D]);const H=Math.abs(q-z.left),X=Math.abs(q-z.right),ne=Math.min(H,X);let ge;const ke=w/_*(y+1);if(z.isDash){const Le=y-Math.abs(ke);ge=Math.sqrt(ne*ne+Le*Le)}else ge=y-Math.sqrt(ne*ne+ke*ke);this.data[R+q]=Math.max(0,Math.min(255,ge+128))}}}addRegularDash(t){for(let D=t.length-1;D>=0;--D){const z=t[D],q=t[D+1];z.zeroLength?t.splice(D,1):q&&q.isDash===z.isDash&&(q.left=z.left,t.splice(D,1))}const f=t[0],_=t[t.length-1];f.isDash===_.isDash&&(f.left=_.left-this.width,_.right=f.right+this.width);const y=this.width*this.nextRow;let w=0,R=t[w];for(let D=0;D<this.width;D++){D/R.right>1&&(R=t[++w]);const z=Math.abs(D-R.left),q=Math.abs(D-R.right),H=Math.min(z,q);this.data[y+D]=Math.max(0,Math.min(255,(R.isDash?H:-H)+128))}}addDash(t,f){const _=f?7:0,y=2*_+1;if(this.nextRow+y>this.height)return l.w("LineAtlas out of space"),null;let w=0;for(let D=0;D<t.length;D++)w+=t[D];if(w!==0){const D=this.width/w,z=this.getDashRanges(t,this.width,D);f?this.addRoundDash(z,D,_):this.addRegularDash(z)}const R={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:w};return this.nextRow+=y,this.dirty=!0,R}bind(t){const f=t.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const It="maplibre_preloaded_worker_pool";class Yt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Yt.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}const pn=Math.floor(C.hardwareConcurrency/2);let Dn,We;function Xn(){return Dn||(Dn=new Yt),Dn}Yt.workerCount=l.C(globalThis)?Math.max(Math.min(pn,3),1):1;class dn{constructor(t,f){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=f;const _=this.workerPool.acquire(f);for(let y=0;y<_.length;y++){const w=new l.F(_[y],f);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,f){const _=[];for(const y of this.actors)_.push(y.sendAsync({type:t,data:f}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,f){for(const _ of this.actors)_.registerMessageHandler(t,f)}}function Ot(){return We||(We=new dn(Xn(),l.G),We.registerMessageHandler("GR",(k,t,f)=>l.m(t,f))),We}function Se(k,t){const f=l.H();return l.J(f,f,[1,1,0]),l.K(f,f,[.5*k.width,.5*k.height,1]),l.L(f,f,k.calculatePosMatrix(t.toUnwrapped()))}function lt(k,t,f,_,y,w){const R=function(X,ne,ge){if(X)for(const ke of X){const Le=ne[ke];if(Le&&Le.source===ge&&Le.type==="fill-extrusion")return!0}else for(const ke in ne){const Le=ne[ke];if(Le.source===ge&&Le.type==="fill-extrusion")return!0}return!1}(y&&y.layers,t,k.id),D=w.maxPitchScaleFactor(),z=k.tilesIn(_,D,R);z.sort(Ye);const q=[];for(const X of z)q.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(t,f,k._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,y,w,D,Se(k.transform,X.tileID))});const H=function(X){const ne={},ge={};for(const ke of X){const Le=ke.queryResults,Ne=ke.wrappedTileID,ze=ge[Ne]=ge[Ne]||{};for(const Ve in Le){const Ae=Le[Ve],He=ze[Ve]=ze[Ve]||{},Je=ne[Ve]=ne[Ve]||[];for(const st of Ae)He[st.featureIndex]||(He[st.featureIndex]=!0,Je.push(st))}}return ne}(q);for(const X in H)H[X].forEach(ne=>{const ge=ne.feature,ke=k.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ke});return H}function Ye(k,t){const f=k.tileID,_=t.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function Ct(k,t,f){return l._(this,void 0,void 0,function*(){let _=k;if(k.url?_=(yield l.h(t.transformRequest(k.url,"Source"),f)).data:yield C.frameAsync(f),!_)return null;const y=l.M(l.e(_,k),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(y.vectorLayerIds=_.vector_layers.map(w=>w.id)),y})}class $e{constructor(t,f){t&&(f?this.setSouthWest(t).setNorthEast(f):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}extend(t){const f=this._sw,_=this._ne;let y,w;if(t instanceof l.N)y=t,w=t;else{if(!(t instanceof $e))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend($e.convert(t)):this.extend(l.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.N.convert(t)):this;if(y=t._sw,w=t._ne,!y||!w)return this}return f||_?(f.lng=Math.min(y.lng,f.lng),f.lat=Math.min(y.lat,f.lat),_.lng=Math.max(w.lng,_.lng),_.lat=Math.max(w.lat,_.lat)):(this._sw=new l.N(y.lng,y.lat),this._ne=new l.N(w.lng,w.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:f,lat:_}=l.N.convert(t);let y=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&y}static convert(t){return t instanceof $e?t:t&&new $e(t)}static fromLngLat(t,f=0){const _=360*f/40075017,y=_/Math.cos(Math.PI/180*t.lat);return new $e(new l.N(t.lng-y,t.lat-_),new l.N(t.lng+y,t.lat+_))}adjustAntiMeridian(){const t=new l.N(this._sw.lng,this._sw.lat),f=new l.N(this._ne.lng,this._ne.lat);return new $e(t,t.lng>f.lng?new l.N(f.lng+360,f.lat):f)}}class kt{constructor(t,f,_){this.bounds=$e.convert(this.validateBounds(t)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const f=Math.pow(2,t.z),_=Math.floor(l.O(this.bounds.getWest())*f),y=Math.floor(l.Q(this.bounds.getNorth())*f),w=Math.ceil(l.O(this.bounds.getEast())*f),R=Math.ceil(l.Q(this.bounds.getSouth())*f);return t.x>=_&&t.x<w&&t.y>=y&&t.y<R}}class qt extends l.E{constructor(t,f,_,y){if(super(),this.id=t,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(f,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ct(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new kt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((w,R)=>{t.reloadPromise={resolve:w,reject:R}})}else t.actor=this.dispatcher.getActor(),y="LT";t.abortController=new AbortController;try{const w=yield t.actor.sendAsync({type:y,data:_},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,w)}catch(w){if(delete t.abortController,t.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,f){if(f&&f.resourceTiming&&(t.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&t.setExpiryData(f),t.loadVectorData(f,this.map.painter),t.reloadPromise){const _=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(_.resolve).catch(_.reject)}}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ee extends l.E{constructor(t,f,_,y){super(),this.id=t,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},f),l.e(this,l.M(f,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ct(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(l.e(this,t),t.bounds&&(this.tileBounds=new kt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const _=yield K.getImage(this.map._requestManager.transformRequest(f,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&t.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const y=this.map.painter.context,w=y.gl,R=_.data;t.texture=this.map.painter.getTileTexture(R.width),t.texture?t.texture.update(R,{useMipmap:!0}):(t.texture=new we(y,R,w.RGBA,{useMipmap:!0}),t.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(_){if(delete t.abortController,t.aborted)t.state="unloaded";else if(_)throw t.state="errored",_}})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Gt extends Ee{constructor(t,f,_,y){super(t,f,_,y),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(f,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const y=yield K.getImage(_,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&t.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const R=l.b(w)&&l.U()?w:yield this.readImageNow(w),D={type:this.type,uid:t.uid,source:this.id,rawImageData:R,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const z=yield t.actor.sendAsync({type:"LDT",data:D});t.dem=z,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(y){if(delete t.abortController,t.aborted)t.state="unloaded";else if(y)throw t.state="errored",y}})}readImageNow(t){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const f=t.width+2,_=t.height+2;try{return new l.R({width:f,height:_},yield l.W(t,-1,-1,f,_))}catch{}}return C.getImageData(t,1)})}_getNeighboringTiles(t){const f=t.canonical,_=Math.pow(2,f.z),y=(f.x-1+_)%_,w=f.x===0?t.wrap-1:t.wrap,R=(f.x+1+_)%_,D=f.x+1===_?t.wrap+1:t.wrap,z={};return z[new l.S(t.overscaledZ,w,f.z,y,f.y).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,f.z,R,f.y).key]={backfilled:!1},f.y>0&&(z[new l.S(t.overscaledZ,w,f.z,y,f.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,f.z,R,f.y-1).key]={backfilled:!1}),f.y+1<_&&(z[new l.S(t.overscaledZ,w,f.z,y,f.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,f.z,R,f.y+1).key]={backfilled:!1}),z}unloadTile(t){return l._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class _n extends l.E{constructor(t,f,_,y){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(y),this._data=f.data,this._options=l.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const w=l.X/this.tileSize;f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*w,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*w,extent:l.X,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:l.X,radius:(f.clusterRadius||50)*w,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return l._(this,void 0,void 0,function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,f,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:f,offset:_}})}_updateWorkerData(t){return l._(this,void 0,void 0,function*(){const f=l.e({type:this.type},this.workerOptions);t?f.dataDiff=t:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(C.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let y=null;_.resourceTiming&&_.resourceTiming[this.id]&&(y=_.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(w,{resourceTiming:y}),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.actor?"RT":"LT";t.actor=this.actor;const _={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const y=yield this.actor.sendAsync({type:f,data:_},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(y,this.map.painter,f==="RT")})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Jn=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $i extends l.E{constructor(t,f,_,y){super(),this.id=t,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=f}load(t){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield K.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,t&&(this.coordinates=t),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new l.j(f))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const f=t.map(l.Z.fromLngLat);this.tileID=function(y){let w=1/0,R=1/0,D=-1/0,z=-1/0;for(const ne of y)w=Math.min(w,ne.x),R=Math.min(R,ne.y),D=Math.max(D,ne.x),z=Math.max(z,ne.y);const q=Math.max(D-w,z-R),H=Math.max(0,Math.floor(-Math.log(q)/Math.LN2)),X=Math.pow(2,H);return new l.a1(H,Math.floor((w+D)/2*X),Math.floor((R+z)/2*X))}(f),this.minzoom=this.maxzoom=this.tileID.z;const _=f.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,l.X,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,l.X),this._boundsArray.emplaceBack(_[2].x,_[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,f=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Jn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(t,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class xn extends $i{constructor(t,f,_,y){super(t,f,_,y),this.roundZoom=!0,this.type="video",this.options=f}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const f of t.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield l.a3(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new l.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const f=this.video.seekable;t<f.start(0)||t>f.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,f=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Jn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new we(t,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Vi extends $i{constructor(t,f,_,y){super(t,f,_,y),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(R=>typeof R!="number"))||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,_=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Jn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(f,this.canvas,_.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const R=this.tiles[w];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,y=!0)}y&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Yi={},Jr=k=>{switch(k){case"geojson":return _n;case"image":return $i;case"raster":return Ee;case"raster-dem":return Gt;case"vector":return qt;case"video":return xn;case"canvas":return Vi}return Yi[k]},ct="RTLPluginLoaded";class yr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ot()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,function*(f,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=C.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let kn=null;function mn(){return kn||(kn=new yr),kn}class Ls{constructor(t,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.a4(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const f=t+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,f,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(y,w){const R={};if(!w)return R;for(const D of y){const z=D.layerIds.map(q=>w.getLayer(q)).filter(Boolean);if(z.length!==0){D.layers=z,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(q=>z.filter(H=>H.id===q)[0]));for(const q of z)R[q.id]=D}}return R}(t.buckets,f.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6){if(this.hasSymbolBuckets=!0,!_)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6&&w.hasRTLText){this.hasRTLText=!0,mn().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(y).queryRadius(w))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(t)}const f=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(t,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(t,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,f,_,y,w,R,D,z,q,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:R,tileSize:this.tileSize,pixelPosMatrix:H,transform:z,params:D,queryPadding:this.queryPadding*q},t,f,_):{}}querySourceFeatures(t,f){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const y=_.loadVTLayers(),w=f&&f.sourceLayer?f.sourceLayer:"",R=y._geojsonTileLayer||y[w];if(!R)return;const D=l.a7(f&&f.filter),{z,x:q,y:H}=this.tileID.canonical,X={z,x:q,y:H};for(let ne=0;ne<R.length;ne++){const ge=R.feature(ne);if(D.needGeometry){const Ne=l.a8(ge,!0);if(!D.filter(new l.z(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!D.filter(new l.z(this.tileID.overscaledZ),ge))continue;const ke=_.getId(ge,w),Le=new l.a9(ge,z,q,H,ke);Le.tile=X,t.push(Le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const f=this.expirationTime;if(t.cacheControl){const _=l.aa(t.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const _=Date.now();let y=!1;if(this.expirationTime>_)y=!1;else if(f)if(this.expirationTime<f)y=!0;else{const w=this.expirationTime-f;w?this.expirationTime=_+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!f.style.hasLayer(y))continue;const w=this.buckets[y],R=w.layers[0].sourceLayer||"_geojsonTileLayer",D=_[R],z=t[R];if(!D||!z||Object.keys(z).length===0)continue;w.update(z,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const q=f&&f.style&&f.style.getLayer(y);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<C.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=C.now()+t}setDependencies(t,f){const _={};for(const y of f)_[y]=!0;this.dependencies[t]=_}hasDependency(t,f){for(const _ of t){const y=this.dependencies[_];if(y){for(const w of f)if(y[w])return!0}}return!1}}class Mt{constructor(t,f){this.max=t,this.onRemove=f,this.reset()}reset(){for(const t in this.data)for(const f of this.data[t])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(t,f,_){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:f,timeout:void 0};if(_!==void 0&&(w.timeout=setTimeout(()=>{this.remove(t,w)},_)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const f=this.data[t].shift();return f.timeout&&clearTimeout(f.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),f.value}getByKey(t){const f=this.data[t];return f?f[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,f){if(!this.has(t))return this;const _=t.wrapped().key,y=f===void 0?0:this.data[_].indexOf(f),w=this.data[_][y];return this.data[_].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(w.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(t){const f=[];for(const _ in this.data)for(const y of this.data[_])t(y.value)||f.push(y);for(const _ of f)this.remove(_.value.tileID,_)}}class Cn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,f,_){const y=String(f);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},l.e(this.stateChanges[t][y],_),this.deletedStates[t]===null){this.deletedStates[t]={};for(const w in this.state[t])w!==y&&(this.deletedStates[t][w]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const w in this.state[t][y])_[w]||(this.deletedStates[t][y][w]=null)}else for(const w in _)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][w]===null&&delete this.deletedStates[t][y][w]}removeFeatureState(t,f,_){if(this.deletedStates[t]===null)return;const y=String(f);if(this.deletedStates[t]=this.deletedStates[t]||{},_&&f!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][_]=null);else if(f!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(_ in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][_]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,f){const _=String(f),y=l.e({},(this.state[t]||{})[_],(this.stateChanges[t]||{})[_]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const w=this.deletedStates[t][f];if(w===null)return{};for(const R in w)delete y[R]}return y}initializeTileState(t,f){t.setFeatureState(this.state,f)}coalesceChanges(t,f){const _={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const R in this.stateChanges[y])this.state[y][R]||(this.state[y][R]={}),l.e(this.state[y][R],this.stateChanges[y][R]),w[R]=this.state[y][R];_[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const R in this.state[y])w[R]={},this.state[y][R]={};else for(const R in this.deletedStates[y]){if(this.deletedStates[y][R]===null)this.state[y][R]={};else for(const D of Object.keys(this.deletedStates[y][R]))delete this.state[y][R][D];w[R]=this.state[y][R]}_[y]=_[y]||{},l.e(_[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const y in t)t[y].setFeatureState(_,f)}}class At extends l.E{constructor(t,f,_){super(),this.id=t,this.dispatcher=_,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,w,R,D)=>{const z=new(Jr(w.type))(y,w,R,D);if(z.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${z.id}`);return z})(t,f,_,this),this._tiles={},this._cache=new Mt(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Cn,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const f=this._tiles[t];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,f,_){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,f,_)}catch(y){t.state="errored",y.status!==404?this._source.fire(new l.j(y,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const _=this._tiles[f];_.upload(t),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(vr).map(t=>t.key)}getRenderableIds(t){const f=[];for(const _ in this._tiles)this._isIdRenderable(_,t)&&f.push(this._tiles[_]);return t?f.sort((_,y)=>{const w=_.tileID,R=y.tileID,D=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),z=new l.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-R.overscaledZ||z.y-D.y||z.x-D.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(vr).map(_=>_.key)}hasRenderableParent(t){const f=this.findLoadedParent(t,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(t,f){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(f||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,f){return l._(this,void 0,void 0,function*(){const _=this._tiles[t];_&&(_.state!=="loading"&&(_.state=f),yield this._loadTile(_,t,f))})}_tileLoaded(t,f,_){t.timeAdded=C.now(),_==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(f,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const f=this.getRenderableIds();for(let y=0;y<f.length;y++){const w=f[y];if(t.neighboringTiles&&t.neighboringTiles[w]){const R=this.getTileByID(w);_(t,R),_(R,t)}}function _(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let R=w.tileID.canonical.x-y.tileID.canonical.x;const D=w.tileID.canonical.y-y.tileID.canonical.y,z=Math.pow(2,y.tileID.canonical.z),q=w.tileID.key;R===0&&D===0||Math.abs(D)>1||(Math.abs(R)>1&&(Math.abs(R+z)===1?R+=z:Math.abs(R-z)===1&&(R-=z)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,R,D),y.neighboringTiles&&y.neighboringTiles[q]&&(y.neighboringTiles[q].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,f,_,y){for(const w in this._tiles){let R=this._tiles[w];if(y[w]||!R.hasData()||R.tileID.overscaledZ<=f||R.tileID.overscaledZ>_)continue;let D=R.tileID;for(;R&&R.tileID.overscaledZ>f+1;){const q=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[q.key],R&&R.hasData()&&(D=q)}let z=D;for(;z.overscaledZ>f;)if(z=z.scaledTo(z.overscaledZ-1),t[z.key]){y[D.key]=D;break}}}findLoadedParent(t,f){if(t.key in this._loadedParentTiles){const _=this._loadedParentTiles[t.key];return _&&_.tileID.overscaledZ>=f?_:null}for(let _=t.overscaledZ-1;_>=f;_--){const y=t.scaledTo(_),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const f=this._tiles[t.key];return f&&f.hasData()?f:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const f=Math.ceil(t.width/this._source.tileSize)+1,_=Math.ceil(t.height/this._source.tileSize)+1,y=Math.floor(f*_*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(t){const f=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,f){const _={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+f),_[w.tileID.key]=w}this._tiles=_;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(t,f,_,y,w,R){const D={},z={},q=Object.keys(t),H=C.now();for(const X of q){const ne=t[X],ge=this._tiles[X];if(!ge||ge.fadeEndTime!==0&&ge.fadeEndTime<=H)continue;const ke=this.findLoadedParent(ne,f),Le=this.findLoadedSibling(ne),Ne=ke||Le||null;Ne&&(this._addTile(Ne.tileID),D[Ne.tileID.key]=Ne.tileID),z[X]=ne}this._retainLoadedChildren(z,y,_,t);for(const X in D)t[X]||(this._coveredTiles[X]=!0,t[X]=D[X]);if(R){const X={},ne={};for(const ge of w)this._tiles[ge.key].hasData()?X[ge.key]=ge:ne[ge.key]=ge;for(const ge in ne){const ke=ne[ge].children(this._source.maxzoom);this._tiles[ke[0].key]&&this._tiles[ke[1].key]&&this._tiles[ke[2].key]&&this._tiles[ke[3].key]&&(X[ke[0].key]=t[ke[0].key]=ke[0],X[ke[1].key]=t[ke[1].key]=ke[1],X[ke[2].key]=t[ke[2].key]=ke[2],X[ke[3].key]=t[ke[3].key]=ke[3],delete ne[ge])}for(const ge in ne){const ke=ne[ge],Le=this.findLoadedParent(ke,this._source.minzoom),Ne=this.findLoadedSibling(ke),ze=Le||Ne||null;if(ze){X[ze.tileID.key]=t[ze.tileID.key]=ze.tileID;for(const Ve in X)X[Ve].isChildOf(ze.tileID)&&delete X[Ve]}}for(const ge in this._tiles)X[ge]||(this._coveredTiles[ge]=!0)}}update(t,f){if(!this._sourceLoaded||this._paused)return;let _;this.transform=t,this.terrain=f,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new l.S(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y)):(_=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(_=_.filter(H=>this._source.hasTile(H)))):_=[];const y=t.coveringZoomLevel(this._source),w=Math.max(y-At.maxOverzooming,this._source.minzoom),R=Math.max(y+At.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const H={};for(const X of _)if(X.canonical.z>this._source.minzoom){const ne=X.scaledTo(X.canonical.z-1);H[ne.key]=ne;const ge=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));H[ge.key]=ge}_=_.concat(Object.values(H))}const D=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const z=this._updateRetainedTiles(_,y);Gr(this._source.type)&&this._updateCoveredAndRetainedTiles(z,w,R,y,_,f);for(const H in z)this._tiles[H].clearFadeHold();const q=l.ab(this._tiles,z);for(const H of q){const X=this._tiles[H];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(H)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,f){var _;const y={},w={},R=Math.max(f-At.maxOverzooming,this._source.minzoom),D=Math.max(f+At.maxUnderzooming,this._source.minzoom),z={};for(const q of t){const H=this._addTile(q);y[q.key]=q,H.hasData()||f<this._source.maxzoom&&(z[q.key]=q)}this._retainLoadedChildren(z,f,D,y);for(const q of t){let H=this._tiles[q.key];if(H.hasData())continue;if(f+1>this._source.maxzoom){const ne=q.children(this._source.maxzoom)[0],ge=this.getTile(ne);if(ge&&ge.hasData()){y[ne.key]=ne;continue}}else{const ne=q.children(this._source.maxzoom);if(y[ne[0].key]&&y[ne[1].key]&&y[ne[2].key]&&y[ne[3].key])continue}let X=H.wasRequested();for(let ne=q.overscaledZ-1;ne>=R;--ne){const ge=q.scaledTo(ne);if(w[ge.key])break;if(w[ge.key]=!0,H=this.getTile(ge),!H&&X&&(H=this._addTile(ge)),H){const ke=H.hasData();if((ke||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||X)&&(y[ge.key]=ge),X=H.wasRequested(),ke)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const f=[];let _,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){_=this._loadedParentTiles[y.key];break}f.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(_=this._getLoadedTile(w),_)break;y=w}for(const w of f)this._loadedParentTiles[w]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const f=this._tiles[t].tileID,_=this._getLoadedTile(f);this._loadedSiblingTiles[f.key]=_}}_addTile(t){let f=this._tiles[t.key];if(f)return f;f=this._cache.getAndRemove(t),f&&(this._setTileReloadTimer(t.key,f),f.tileID=t,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,f)));const _=f;return f||(f=new Ls(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(f,t.key,f.state)),f.uses++,this._tiles[t.key]=f,_||this._source.fire(new l.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(t,f){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const _=f.getExpiryTimeout();_&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},_))}_removeTile(t){const f=this._tiles[t];f&&(f.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(t){const f=t.sourceDataType;t.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,f,_){const y=[],w=this.transform;if(!w)return y;const R=_?w.getCameraQueryGeometry(t):t,D=t.map(ke=>w.pointCoordinate(ke,this.terrain)),z=R.map(ke=>w.pointCoordinate(ke,this.terrain)),q=this.getIds();let H=1/0,X=1/0,ne=-1/0,ge=-1/0;for(const ke of z)H=Math.min(H,ke.x),X=Math.min(X,ke.y),ne=Math.max(ne,ke.x),ge=Math.max(ge,ke.y);for(let ke=0;ke<q.length;ke++){const Le=this._tiles[q[ke]];if(Le.holdingForFade())continue;const Ne=Le.tileID,ze=Math.pow(2,w.zoom-Le.tileID.overscaledZ),Ve=f*Le.queryPadding*l.X/Le.tileSize/ze,Ae=[Ne.getTilePoint(new l.Z(H,X)),Ne.getTilePoint(new l.Z(ne,ge))];if(Ae[0].x-Ve<l.X&&Ae[0].y-Ve<l.X&&Ae[1].x+Ve>=0&&Ae[1].y+Ve>=0){const He=D.map(st=>Ne.getTilePoint(st)),Je=z.map(st=>Ne.getTilePoint(st));y.push({tile:Le,tileID:Ne,queryGeometry:He,cameraQueryGeometry:Je,scale:ze})}}return y}getVisibleCoordinates(t){const f=this.getRenderableIds(t).map(_=>this._tiles[_].tileID);for(const _ of f)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(Gr(this._source.type)){const t=C.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=t)return!0}return!1}setFeatureState(t,f,_){this._state.updateState(t=t||"_geojsonTileLayer",f,_)}removeFeatureState(t,f,_){this._state.removeFeatureState(t=t||"_geojsonTileLayer",f,_)}getFeatureState(t,f){return this._state.getState(t=t||"_geojsonTileLayer",f)}setDependencies(t,f,_){const y=this._tiles[t];y&&y.setDependencies(f,_)}reloadTilesForDependencies(t,f){for(const _ in this._tiles)this._tiles[_].hasDependency(t,f)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(t,f))}}function vr(k,t){const f=Math.abs(2*k.wrap)-+(k.wrap<0),_=Math.abs(2*t.wrap)-+(t.wrap<0);return k.overscaledZ-t.overscaledZ||_-f||t.canonical.y-k.canonical.y||t.canonical.x-k.canonical.x}function Gr(k){return k==="raster"||k==="image"||k==="video"}At.maxOverzooming=10,At.maxUnderzooming=3;class wn{constructor(t,f){this.reset(t,f)}reset(t,f){this.points=t||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.ac(t,0,1);let f=1,_=this._distances[f];const y=t*this.paddedLength+this.padding;for(;_<y&&f<this._distances.length;)_=this._distances[++f];const w=f-1,R=this._distances[w],D=_-R,z=D>0?(y-R)/D:0;return this.points[w].mult(1-z).add(this.points[f].mult(z))}}function Li(k,t){let f=!0;return k==="always"||k!=="never"&&t!=="never"||(f=!1),f}class Ar{constructor(t,f,_){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(t/_),this.yCellCount=Math.ceil(f/_);for(let R=0;R<this.xCellCount*this.yCellCount;R++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=f,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,f,_,y,w){this._forEachCell(f,_,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(t,f,_,y){this._forEachCell(f-y,_-y,f+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(f),this.circles.push(_),this.circles.push(y)}_insertBoxCell(t,f,_,y,w,R){this.boxCells[w].push(R)}_insertCircleCell(t,f,_,y,w,R){this.circleCells[w].push(R)}_query(t,f,_,y,w,R,D){if(_<0||t>this.width||y<0||f>this.height)return[];const z=[];if(t<=0&&f<=0&&this.width<=_&&this.height<=y){if(w)return[{key:null,x1:t,y1:f,x2:_,y2:y}];for(let q=0;q<this.boxKeys.length;q++)z.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const H=this.circles[3*q],X=this.circles[3*q+1],ne=this.circles[3*q+2];z.push({key:this.circleKeys[q],x1:H-ne,y1:X-ne,x2:H+ne,y2:X+ne})}}else this._forEachCell(t,f,_,y,this._queryCell,z,{hitTest:w,overlapMode:R,seenUids:{box:{},circle:{}}},D);return z}query(t,f,_,y){return this._query(t,f,_,y,!1,null)}hitTest(t,f,_,y,w,R){return this._query(t,f,_,y,!0,w,R).length>0}hitTestCircle(t,f,_,y,w){const R=t-_,D=t+_,z=f-_,q=f+_;if(D<0||R>this.width||q<0||z>this.height)return!1;const H=[];return this._forEachCell(R,z,D,q,this._queryCellCircle,H,{hitTest:!0,overlapMode:y,circle:{x:t,y:f,radius:_},seenUids:{box:{},circle:{}}},w),H.length>0}_queryCell(t,f,_,y,w,R,D,z){const{seenUids:q,hitTest:H,overlapMode:X}=D,ne=this.boxCells[w];if(ne!==null){const ke=this.bboxes;for(const Le of ne)if(!q.box[Le]){q.box[Le]=!0;const Ne=4*Le,ze=this.boxKeys[Le];if(t<=ke[Ne+2]&&f<=ke[Ne+3]&&_>=ke[Ne+0]&&y>=ke[Ne+1]&&(!z||z(ze))&&(!H||!Li(X,ze.overlapMode))&&(R.push({key:ze,x1:ke[Ne],y1:ke[Ne+1],x2:ke[Ne+2],y2:ke[Ne+3]}),H))return!0}}const ge=this.circleCells[w];if(ge!==null){const ke=this.circles;for(const Le of ge)if(!q.circle[Le]){q.circle[Le]=!0;const Ne=3*Le,ze=this.circleKeys[Le];if(this._circleAndRectCollide(ke[Ne],ke[Ne+1],ke[Ne+2],t,f,_,y)&&(!z||z(ze))&&(!H||!Li(X,ze.overlapMode))){const Ve=ke[Ne],Ae=ke[Ne+1],He=ke[Ne+2];if(R.push({key:ze,x1:Ve-He,y1:Ae-He,x2:Ve+He,y2:Ae+He}),H)return!0}}}return!1}_queryCellCircle(t,f,_,y,w,R,D,z){const{circle:q,seenUids:H,overlapMode:X}=D,ne=this.boxCells[w];if(ne!==null){const ke=this.bboxes;for(const Le of ne)if(!H.box[Le]){H.box[Le]=!0;const Ne=4*Le,ze=this.boxKeys[Le];if(this._circleAndRectCollide(q.x,q.y,q.radius,ke[Ne+0],ke[Ne+1],ke[Ne+2],ke[Ne+3])&&(!z||z(ze))&&!Li(X,ze.overlapMode))return R.push(!0),!0}}const ge=this.circleCells[w];if(ge!==null){const ke=this.circles;for(const Le of ge)if(!H.circle[Le]){H.circle[Le]=!0;const Ne=3*Le,ze=this.circleKeys[Le];if(this._circlesCollide(ke[Ne],ke[Ne+1],ke[Ne+2],q.x,q.y,q.radius)&&(!z||z(ze))&&!Li(X,ze.overlapMode))return R.push(!0),!0}}}_forEachCell(t,f,_,y,w,R,D,z){const q=this._convertToXCellCoord(t),H=this._convertToYCellCoord(f),X=this._convertToXCellCoord(_),ne=this._convertToYCellCoord(y);for(let ge=q;ge<=X;ge++)for(let ke=H;ke<=ne;ke++)if(w.call(this,t,f,_,y,this.xCellCount*ke+ge,R,D,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,f,_,y,w,R){const D=y-t,z=w-f,q=_+R;return q*q>D*D+z*z}_circleAndRectCollide(t,f,_,y,w,R,D){const z=(R-y)/2,q=Math.abs(t-(y+z));if(q>z+_)return!1;const H=(D-w)/2,X=Math.abs(f-(w+H));if(X>H+_)return!1;if(q<=z||X<=H)return!0;const ne=q-z,ge=X-H;return ne*ne+ge*ge<=_*_}}function Ji(k,t,f,_,y){const w=l.H();return t?(l.K(w,w,[1/y,1/y,1]),f||l.ad(w,w,_.angle)):l.L(w,_.labelPlaneMatrix,k),w}function Zr(k,t,f,_,y){if(t){const w=l.ae(k);return l.K(w,w,[y,y,1]),f||l.ad(w,w,-_.angle),w}return _.glCoordMatrix}function Me(k,t,f,_){let y;_?(y=[k,t,_(k,t),1],l.af(y,y,f)):(y=[k,t,0,1],Vn(y,y,f));const w=y[3];return{point:new l.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function J(k,t){return .5+k/t*.5}function Y(k,t){return k.x>=-t[0]&&k.x<=t[0]&&k.y>=-t[1]&&k.y<=t[1]}function ce(k,t,f,_,y,w,R,D,z,q,H,X,ne,ge,ke){const Le=_?k.textSizeData:k.iconSizeData,Ne=l.ag(Le,f.transform.zoom),ze=[256/f.width*2+1,256/f.height*2+1],Ve=_?k.text.dynamicLayoutVertexArray:k.icon.dynamicLayoutVertexArray;Ve.clear();const Ae=k.lineVertexArray,He=_?k.text.placedSymbolArray:k.icon.placedSymbolArray,Je=f.transform.width/f.transform.height;let st=!1;for(let bt=0;bt<He.length;bt++){const Pt=He.get(bt);if(Pt.hidden||Pt.writingMode===l.ah.vertical&&!st){ln(Pt.numGlyphs,Ve);continue}st=!1;const Ht=Me(Pt.anchorX,Pt.anchorY,t,ke);if(!Y(Ht.point,ze)){ln(Pt.numGlyphs,Ve);continue}const $t=J(f.transform.cameraToCenterDistance,Ht.signedDistanceFromCamera),jt=l.ai(Le,Ne,Pt),Ut=R?jt/$t:jt*$t,rn={getElevation:ke,labelPlaneMatrix:y,lineVertexArray:Ae,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:q,tileAnchorPoint:new l.P(Pt.anchorX,Pt.anchorY),unwrappedTileID:H,width:X,height:ne,translation:ge},An=je(rn,Pt,Ut,!1,D,t,w,k.glyphOffsetArray,Ve,Je,z);st=An.useVertical,(An.notEnoughRoom||st||An.needsFlipping&&je(rn,Pt,Ut,!0,D,t,w,k.glyphOffsetArray,Ve,Je,z).notEnoughRoom)&&ln(Pt.numGlyphs,Ve)}_?k.text.dynamicLayoutVertexBuffer.updateData(Ve):k.icon.dynamicLayoutVertexBuffer.updateData(Ve)}function le(k,t,f,_,y,w,R,D){const z=w.glyphStartIndex+w.numGlyphs,q=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,X=t.getoffsetX(w.glyphStartIndex),ne=t.getoffsetX(z-1),ge=Dt(k*X,f,_,y,w.segment,q,H,D,R);if(!ge)return null;const ke=Dt(k*ne,f,_,y,w.segment,q,H,D,R);return ke?D.projectionCache.anyProjectionOccluded?null:{first:ge,last:ke}:null}function fe(k,t,f,_){return k===l.ah.horizontal&&Math.abs(f.y-t.y)>Math.abs(f.x-t.x)*_?{useVertical:!0}:(k===l.ah.vertical?t.y<f.y:t.x>f.x)?{needsFlipping:!0}:null}function je(k,t,f,_,y,w,R,D,z,q,H){const X=f/24,ne=t.lineOffsetX*X,ge=t.lineOffsetY*X;let ke;if(t.numGlyphs>1){const Le=t.glyphStartIndex+t.numGlyphs,Ne=t.lineStartIndex,ze=t.lineStartIndex+t.lineLength,Ve=le(X,D,ne,ge,_,t,H,k);if(!Ve)return{notEnoughRoom:!0};const Ae=Me(Ve.first.point.x,Ve.first.point.y,R,k.getElevation).point,He=Me(Ve.last.point.x,Ve.last.point.y,R,k.getElevation).point;if(y&&!_){const Je=fe(t.writingMode,Ae,He,q);if(Je)return Je}ke=[Ve.first];for(let Je=t.glyphStartIndex+1;Je<Le-1;Je++)ke.push(Dt(X*D.getoffsetX(Je),ne,ge,_,t.segment,Ne,ze,k,H));ke.push(Ve.last)}else{if(y&&!_){const Ne=Me(k.tileAnchorPoint.x,k.tileAnchorPoint.y,w,k.getElevation).point,ze=t.lineStartIndex+t.segment+1,Ve=new l.P(k.lineVertexArray.getx(ze),k.lineVertexArray.gety(ze)),Ae=Me(Ve.x,Ve.y,w,k.getElevation),He=Ae.signedDistanceFromCamera>0?Ae.point:function(st,bt,Pt,Ht,$t,jt){return Xe(st,bt,Pt,1,$t,jt)}(k.tileAnchorPoint,Ve,Ne,0,w,k),Je=fe(t.writingMode,Ne,He,q);if(Je)return Je}const Le=Dt(X*D.getoffsetX(t.glyphStartIndex),ne,ge,_,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,k,H);if(!Le||k.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ke=[Le]}for(const Le of ke)l.aj(z,Le.point,Le.angle);return{}}function Xe(k,t,f,_,y,w){const R=k.add(k.sub(t)._unit()),D=y!==void 0?Me(R.x,R.y,y,w.getElevation).point:et(R.x,R.y,w).point,z=f.sub(D);return f.add(z._mult(_/z.mag()))}function Re(k,t,f){const _=t.projectionCache;if(_.projections[k])return _.projections[k];const y=new l.P(t.lineVertexArray.getx(k),t.lineVertexArray.gety(k)),w=et(y.x,y.y,t);if(w.signedDistanceFromCamera>0)return _.projections[k]=w.point,_.anyProjectionOccluded=_.anyProjectionOccluded||w.isOccluded,w.point;const R=k-f.direction;return function(D,z,q,H,X){return Xe(D,z,q,H,void 0,X)}(f.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(R),t.lineVertexArray.gety(R)),y,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,t)}function et(k,t,f){const _=k+f.translation[0],y=t+f.translation[1];let w;return!f.pitchWithMap&&f.projection.useSpecialProjectionForSymbols?(w=f.projection.projectTileCoordinates(_,y,f.unwrappedTileID,f.getElevation),w.point.x=(.5*w.point.x+.5)*f.width,w.point.y=(.5*-w.point.y+.5)*f.height):(w=Me(_,y,f.labelPlaneMatrix,f.getElevation),w.isOccluded=!1),w}function gt(k,t,f){return k._unit()._perp()._mult(t*f)}function at(k,t,f,_,y,w,R,D,z){if(D.projectionCache.offsets[k])return D.projectionCache.offsets[k];const q=f.add(t);if(k+z.direction<_||k+z.direction>=y)return D.projectionCache.offsets[k]=q,q;const H=Re(k+z.direction,D,z),X=gt(H.sub(f),R,z.direction),ne=f.add(X),ge=H.add(X);return D.projectionCache.offsets[k]=l.ak(w,q,ne,ge)||q,D.projectionCache.offsets[k]}function Dt(k,t,f,_,y,w,R,D,z){const q=_?k-t:k+t;let H=q>0?1:-1,X=0;_&&(H*=-1,X=Math.PI),H<0&&(X+=Math.PI);let ne,ge=H>0?w+y:w+y+1;D.projectionCache.cachedAnchorPoint?ne=D.projectionCache.cachedAnchorPoint:(ne=et(D.tileAnchorPoint.x,D.tileAnchorPoint.y,D).point,D.projectionCache.cachedAnchorPoint=ne);let ke,Le,Ne=ne,ze=ne,Ve=0,Ae=0;const He=Math.abs(q),Je=[];let st;for(;Ve+Ae<=He;){if(ge+=H,ge<w||ge>=R)return null;Ve+=Ae,ze=Ne,Le=ke;const Ht={absOffsetX:He,direction:H,distanceFromAnchor:Ve,previousVertex:ze};if(Ne=Re(ge,D,Ht),f===0)Je.push(ze),st=Ne.sub(ze);else{let $t;const jt=Ne.sub(ze);$t=jt.mag()===0?gt(Re(ge+H,D,Ht).sub(Ne),f,H):gt(jt,f,H),Le||(Le=ze.add($t)),ke=at(ge,$t,Ne,w,R,Le,f,D,Ht),Je.push(Le),st=ke.sub(Le)}Ae=st.mag()}const bt=st._mult((He-Ve)/Ae)._add(Le||ze),Pt=X+Math.atan2(Ne.y-ze.y,Ne.x-ze.x);return Je.push(bt),{point:bt,angle:z?Pt:0,path:Je}}const en=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ln(k,t){for(let f=0;f<k;f++){const _=t.length;t.resize(_+4),t.float32.set(en,3*_)}}function Vn(k,t,f){const _=t[0],y=t[1];return k[0]=f[0]*_+f[4]*y+f[12],k[1]=f[1]*_+f[5]*y+f[13],k[3]=f[3]*_+f[7]*y+f[15],k}const Ln=100;class Mn{constructor(t,f,_=new Ar(t.width+200,t.height+200,25),y=new Ar(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=f,this.grid=_,this.ignoredGrid=y,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ln,this.screenBottomBoundary=t.height+Ln,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,f,_,y,w,R,D,z,q,H,X){const ne=t.anchorPointX+z[0],ge=t.anchorPointY+z[1],ke=this.projectAndGetPerspectiveRatio(y,ne,ge,w,H),Le=_*ke.perspectiveRatio;let Ne;if(R||D)Ne=this._projectCollisionBox(t,Le,y,w,R,D,z,ke,H,X);else{const Je=ke.point.x+(X?X.x*Le:0),st=ke.point.y+(X?X.y*Le:0);Ne={allPointsOccluded:!1,box:[Je+t.x1*Le,st+t.y1*Le,Je+t.x2*Le,st+t.y2*Le]}}const[ze,Ve,Ae,He]=Ne.box;return this.mapProjection.useSpecialProjectionForSymbols&&(R?Ne.allPointsOccluded:this.mapProjection.isOccluded(ne,ge,w))||ke.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ze,Ve,Ae,He)||f!=="always"&&this.grid.hitTest(ze,Ve,Ae,He,f,q)?{box:[ze,Ve,Ae,He],placeable:!1,offscreen:!1}:{box:[ze,Ve,Ae,He],placeable:!0,offscreen:this.isOffscreen(ze,Ve,Ae,He)}}placeCollisionCircles(t,f,_,y,w,R,D,z,q,H,X,ne,ge,ke,Le,Ne){const ze=[],Ve=new l.P(f.anchorX,f.anchorY),Ae=this.getPerspectiveRatio(R,Ve.x,Ve.y,D,Ne),He=(X?w/Ae:w*Ae)/l.ap,Je={getElevation:Ne,labelPlaneMatrix:z,lineVertexArray:_,pitchWithMap:X,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ve,unwrappedTileID:D,width:this.transform.width,height:this.transform.height,translation:Le},st=le(He,y,f.lineOffsetX*He,f.lineOffsetY*He,!1,f,!1,Je);let bt=!1,Pt=!1,Ht=!0;if(st){const $t=.5*ge*Ae+ke,jt=new l.P(-100,-100),Ut=new l.P(this.screenRightBoundary,this.screenBottomBoundary),rn=new wn,An=st.first,Vt=st.last;let Wt=[];for(let On=An.path.length-1;On>=1;On--)Wt.push(An.path[On]);for(let On=1;On<Vt.path.length;On++)Wt.push(Vt.path[On]);const In=2.5*$t;if(q){const On=this.projectPathToScreenSpace(Wt,Je,q);Wt=On.some(jn=>jn.signedDistanceFromCamera<=0)?[]:On.map(jn=>jn.point)}let Si=[];if(Wt.length>0){const On=Wt[0].clone(),jn=Wt[0].clone();for(let Ei=1;Ei<Wt.length;Ei++)On.x=Math.min(On.x,Wt[Ei].x),On.y=Math.min(On.y,Wt[Ei].y),jn.x=Math.max(jn.x,Wt[Ei].x),jn.y=Math.max(jn.y,Wt[Ei].y);Si=On.x>=jt.x&&jn.x<=Ut.x&&On.y>=jt.y&&jn.y<=Ut.y?[Wt]:jn.x<jt.x||On.x>Ut.x||jn.y<jt.y||On.y>Ut.y?[]:l.al([Wt],jt.x,jt.y,Ut.x,Ut.y)}for(const On of Si){rn.reset(On,.25*$t);let jn=0;jn=rn.length<=.5*$t?1:Math.ceil(rn.paddedLength/In)+1;for(let Ei=0;Ei<jn;Ei++){const zr=Ei/Math.max(jn-1,1),Hs=rn.lerp(zr),Ai=Hs.x+Ln,os=Hs.y+Ln;ze.push(Ai,os,$t,0);const Xr=Ai-$t,Fr=os-$t,Wr=Ai+$t,ho=os+$t;if(Ht=Ht&&this.isOffscreen(Xr,Fr,Wr,ho),Pt=Pt||this.isInsideGrid(Xr,Fr,Wr,ho),t!=="always"&&this.grid.hitTestCircle(Ai,os,$t,t,ne)&&(bt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:bt}}}}return{circles:!H&&bt||!Pt||Ae<this.perspectiveRatioCutoff?[]:ze,offscreen:Ht,collisionDetected:bt}}projectPathToScreenSpace(t,f,_){return t.map(y=>Me(y.x,y.y,_,f.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,y=1/0,w=-1/0,R=-1/0;for(const H of t){const X=new l.P(H.x+Ln,H.y+Ln);_=Math.min(_,X.x),y=Math.min(y,X.y),w=Math.max(w,X.x),R=Math.max(R,X.y),f.push(X)}const D=this.grid.query(_,y,w,R).concat(this.ignoredGrid.query(_,y,w,R)),z={},q={};for(const H of D){const X=H.key;if(z[X.bucketInstanceId]===void 0&&(z[X.bucketInstanceId]={}),z[X.bucketInstanceId][X.featureIndex])continue;const ne=[new l.P(H.x1,H.y1),new l.P(H.x2,H.y1),new l.P(H.x2,H.y2),new l.P(H.x1,H.y2)];l.am(f,ne)&&(z[X.bucketInstanceId][X.featureIndex]=!0,q[X.bucketInstanceId]===void 0&&(q[X.bucketInstanceId]=[]),q[X.bucketInstanceId].push(X.featureIndex))}return q}insertCollisionBox(t,f,_,y,w,R){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:R,overlapMode:f},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,f,_,y,w,R){const D=_?this.ignoredGrid:this.grid,z={bucketInstanceId:y,featureIndex:w,collisionGroupID:R,overlapMode:f};for(let q=0;q<t.length;q+=4)D.insertCircle(z,t[q],t[q+1],t[q+2])}projectAndGetPerspectiveRatio(t,f,_,y,w){let R;w?(R=[f,_,w(f,_),1],l.af(R,R,t)):(R=[f,_,0,1],Vn(R,R,t));const D=R[3];return{point:new l.P((R[0]/D+1)/2*this.transform.width+Ln,(-R[1]/D+1)/2*this.transform.height+Ln),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D*.5,isOccluded:!1,signedDistanceFromCamera:D}}getPerspectiveRatio(t,f,_,y,w){const R=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(f,_,y,w):Me(f,_,t,w);return .5+this.transform.cameraToCenterDistance/R.signedDistanceFromCamera*.5}isOffscreen(t,f,_,y){return _<Ln||t>=this.screenRightBoundary||y<Ln||f>this.screenBottomBoundary}isInsideGrid(t,f,_,y){return _>=0&&t<this.gridRightBoundary&&y>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const t=l.an([]);return l.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,f,_,y,w,R,D,z,q,H){let X=new l.P(1,0),ne=new l.P(0,1);const ge=new l.P(t.anchorPointX+D[0],t.anchorPointY+D[1]);if(R&&!w){const Ht=this.projectAndGetPerspectiveRatio(_,ge.x+1,ge.y,y,q).point.sub(z.point).unit(),$t=Math.atan(Ht.y/Ht.x)+(Ht.x<0?Math.PI:0),jt=Math.sin($t),Ut=Math.cos($t);X=new l.P(Ut,jt),ne=new l.P(-jt,Ut)}else if(!R&&w){const Ht=-this.transform.angle,$t=Math.sin(Ht),jt=Math.cos(Ht);X=new l.P(jt,$t),ne=new l.P(-$t,jt)}let ke=z.point,Le=f;if(w){ke=ge;const Ht=this.transform.zoom-Math.floor(this.transform.zoom);Le=Math.pow(2,-Ht),Le*=this.mapProjection.getPitchedTextCorrection(this.transform,ge,y),H||(Le*=l.ac(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}H&&(ke=ke.add(X.mult(H.x*Le)).add(ne.mult(H.y*Le)));const Ne=t.x1*Le,ze=t.x2*Le,Ve=(Ne+ze)/2,Ae=t.y1*Le,He=t.y2*Le,Je=(Ae+He)/2,st=[{offsetX:Ne,offsetY:Ae},{offsetX:Ve,offsetY:Ae},{offsetX:ze,offsetY:Ae},{offsetX:ze,offsetY:Je},{offsetX:ze,offsetY:He},{offsetX:Ve,offsetY:He},{offsetX:Ne,offsetY:He},{offsetX:Ne,offsetY:Je}];let bt=[];for(const{offsetX:Ht,offsetY:$t}of st)bt.push(new l.P(ke.x+X.x*Ht+ne.x*$t,ke.y+X.y*Ht+ne.y*$t));let Pt=!1;if(w){const Ht=bt.map($t=>this.projectAndGetPerspectiveRatio(_,$t.x,$t.y,y,q));Pt=Ht.some($t=>!$t.isOccluded),bt=Ht.map($t=>$t.point)}else Pt=!0;return{box:l.ao(bt),allPointsOccluded:!Pt}}}function Bn(k,t,f){return t*(l.X/(k.tileSize*Math.pow(2,f-k.tileID.overscaledZ)))}class wi{constructor(t,f,_,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?f:-f))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class ui{constructor(t,f,_,y,w){this.text=new wi(t?t.text:null,f,_,w),this.icon=new wi(t?t.icon:null,f,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Tn{constructor(t,f,_){this.text=t,this.icon=f,this.skipFade=_}}class ii{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class hi{constructor(t,f,_,y,w){this.bucketInstanceId=t,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=w}}class Mi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const f=++this.maxGroupID;this.collisionGroups[t]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[t]}}function Wn(k,t,f,_,y){const{horizontalAlign:w,verticalAlign:R}=l.au(k);return new l.P(-(w-.5)*t+_[0]*y,-(R-.5)*f+_[1]*y)}class Tr{constructor(t,f,_,y,w,R){this.transform=t.clone(),this.terrain=_,this.collisionIndex=new Mn(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Mi(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=R,R&&(R.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const f=this.terrain;return f?(_,y)=>f.getElevation(t,_,y):null}getBucketParts(t,f,_,y){const w=_.getBucket(f),R=_.latestFeatureIndex;if(!w||!R||f.id!==w.layerIds[0])return;const D=_.collisionBoxArray,z=w.layers[0].layout,q=w.layers[0].paint,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/l.X,ne=_.tileID.toUnwrapped(),ge=this.transform.calculatePosMatrix(ne),ke=z.get("text-pitch-alignment")==="map",Le=z.get("text-rotation-alignment")==="map",Ne=Bn(_,1,this.transform.zoom),ze=this.collisionIndex.mapProjection.translatePosition(this.transform,_,q.get("text-translate"),q.get("text-translate-anchor")),Ve=this.collisionIndex.mapProjection.translatePosition(this.transform,_,q.get("icon-translate"),q.get("icon-translate-anchor")),Ae=Ji(ge,ke,Le,this.transform,Ne);let He=null;if(ke){const st=Zr(ge,ke,Le,this.transform,Ne);He=l.L([],this.transform.labelPlaneMatrix,st)}this.retainedQueryData[w.bucketInstanceId]=new hi(w.bucketInstanceId,R,w.sourceLayerIndex,w.index,_.tileID);const Je={bucket:w,layout:z,translationText:ze,translationIcon:Ve,posMatrix:ge,unwrappedTileID:ne,textLabelPlaneMatrix:Ae,labelToScreenMatrix:He,scale:H,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:l.ag(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const st of w.sortKeyRanges){const{sortKey:bt,symbolInstanceStart:Pt,symbolInstanceEnd:Ht}=st;t.push({sortKey:bt,symbolInstanceStart:Pt,symbolInstanceEnd:Ht,parameters:Je})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Je})}attemptAnchorPlacement(t,f,_,y,w,R,D,z,q,H,X,ne,ge,ke,Le,Ne,ze,Ve,Ae){const He=l.aq[t.textAnchor],Je=[t.textOffset0,t.textOffset1],st=Wn(He,_,y,Je,w),bt=this.collisionIndex.placeCollisionBox(f,ne,z,q,H,D,R,Ne,X.predicate,Ae,st);if((!Ve||this.collisionIndex.placeCollisionBox(Ve,ne,z,q,H,D,R,ze,X.predicate,Ae,st).placeable)&&bt.placeable){let Pt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(Pt=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ge.crossTileID]={textOffset:Je,width:_,height:y,anchor:He,textBoxScale:w,prevAnchor:Pt},this.markUsedJustification(ke,He,ge,Le),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Le,ge),this.placedOrientations[ge.crossTileID]=Le),{shift:st,placedGlyphBoxes:bt}}}placeLayerBucketPart(t,f,_){const{bucket:y,layout:w,translationText:R,translationIcon:D,posMatrix:z,unwrappedTileID:q,textLabelPlaneMatrix:H,labelToScreenMatrix:X,textPixelRatio:ne,holdingForFade:ge,collisionBoxArray:ke,partiallyEvaluatedTextSize:Le,collisionGroup:Ne}=t.parameters,ze=w.get("text-optional"),Ve=w.get("icon-optional"),Ae=l.ar(w,"text-overlap","text-allow-overlap"),He=Ae==="always",Je=l.ar(w,"icon-overlap","icon-allow-overlap"),st=Je==="always",bt=w.get("text-rotation-alignment")==="map",Pt=w.get("text-pitch-alignment")==="map",Ht=w.get("icon-text-fit")!=="none",$t=w.get("symbol-z-order")==="viewport-y",jt=He&&(st||!y.hasIconData()||Ve),Ut=st&&(He||!y.hasTextData()||ze);!y.collisionArrays&&ke&&y.deserializeCollisionBoxes(ke);const rn=this._getTerrainElevationFunc(this.retainedQueryData[y.bucketInstanceId].tileID),An=(Vt,Wt,In)=>{var Si,On;if(f[Vt.crossTileID])return;if(ge)return void(this.placements[Vt.crossTileID]=new Tn(!1,!1,!1));let jn=!1,Ei=!1,zr=!0,Hs=null,Ai={box:null,placeable:!1,offscreen:null},os={box:null,placeable:!1,offscreen:null},Xr=null,Fr=null,Wr=null,ho=0,tl=0,Su=0;Wt.textFeatureIndex?ho=Wt.textFeatureIndex:Vt.useRuntimeCollisionCircles&&(ho=Vt.featureIndex),Wt.verticalTextFeatureIndex&&(tl=Wt.verticalTextFeatureIndex);const nl=Wt.textBox;if(nl){const zs=Pr=>{let Or=l.ah.horizontal;if(y.allowVerticalPlacement&&!Pr&&this.prevPlacement){const Is=this.prevPlacement.placedOrientations[Vt.crossTileID];Is&&(this.placedOrientations[Vt.crossTileID]=Is,Or=Is,this.markUsedOrientation(y,Or,Vt))}return Or},Fs=(Pr,Or)=>{if(y.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&Wt.verticalTextBox){for(const Is of y.writingModes)if(Is===l.ah.vertical?(Ai=Or(),os=Ai):Ai=Pr(),Ai&&Ai.placeable)break}else Ai=Pr()},Jo=Vt.textAnchorOffsetStartIndex,Xs=Vt.textAnchorOffsetEndIndex;if(Xs===Jo){const Pr=(Or,Is)=>{const Zn=this.collisionIndex.placeCollisionBox(Or,Ae,ne,z,q,Pt,bt,R,Ne.predicate,rn);return Zn&&Zn.placeable&&(this.markUsedOrientation(y,Is,Vt),this.placedOrientations[Vt.crossTileID]=Is),Zn};Fs(()=>Pr(nl,l.ah.horizontal),()=>{const Or=Wt.verticalTextBox;return y.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&Or?Pr(Or,l.ah.vertical):{box:null,offscreen:null}}),zs(Ai&&Ai.placeable)}else{let Pr=l.aq[(On=(Si=this.prevPlacement)===null||Si===void 0?void 0:Si.variableOffsets[Vt.crossTileID])===null||On===void 0?void 0:On.anchor];const Or=(Zn,Ia,il)=>{const rl=Zn.x2-Zn.x1,Hh=Zn.y2-Zn.y1,fd=Vt.textBoxScale,Xh=Ht&&Je==="never"?Ia:null;let Qo=null,Wh=Ae==="never"?1:2,Au="never";Pr&&Wh++;for(let Vl=0;Vl<Wh;Vl++){for(let Tu=Jo;Tu<Xs;Tu++){const Cu=y.textAnchorOffsets.get(Tu);if(Pr&&Cu.textAnchor!==Pr)continue;const sl=this.attemptAnchorPlacement(Cu,Zn,rl,Hh,fd,bt,Pt,ne,z,q,Ne,Au,Vt,y,il,R,D,Xh,rn);if(sl&&(Qo=sl.placedGlyphBoxes,Qo&&Qo.placeable))return jn=!0,Hs=sl.shift,Qo}Pr?Pr=null:Au=Ae}return _&&!Qo&&(Qo={box:this.collisionIndex.placeCollisionBox(nl,"always",ne,z,q,Pt,bt,R,Ne.predicate,rn,new l.P(0,0)).box,offscreen:!1,placeable:!1}),Qo};Fs(()=>Or(nl,Wt.iconBox,l.ah.horizontal),()=>{const Zn=Wt.verticalTextBox;return y.allowVerticalPlacement&&(!Ai||!Ai.placeable)&&Vt.numVerticalGlyphVertices>0&&Zn?Or(Zn,Wt.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ai&&(jn=Ai.placeable,zr=Ai.offscreen);const Is=zs(Ai&&Ai.placeable);if(!jn&&this.prevPlacement){const Zn=this.prevPlacement.variableOffsets[Vt.crossTileID];Zn&&(this.variableOffsets[Vt.crossTileID]=Zn,this.markUsedJustification(y,Zn.anchor,Vt,Is))}}}if(Xr=Ai,jn=Xr&&Xr.placeable,zr=Xr&&Xr.offscreen,Vt.useRuntimeCollisionCircles){const zs=y.text.placedSymbolArray.get(Vt.centerJustifiedTextSymbolIndex),Fs=l.ai(y.textSizeData,Le,zs),Jo=w.get("text-padding");Fr=this.collisionIndex.placeCollisionCircles(Ae,zs,y.lineVertexArray,y.glyphOffsetArray,Fs,z,q,H,X,_,Pt,Ne.predicate,Vt.collisionCircleDiameter,Jo,R,rn),Fr.circles.length&&Fr.collisionDetected&&!_&&l.w("Collisions detected, but collision boxes are not shown"),jn=He||Fr.circles.length>0&&!Fr.collisionDetected,zr=zr&&Fr.offscreen}if(Wt.iconFeatureIndex&&(Su=Wt.iconFeatureIndex),Wt.iconBox){const zs=Fs=>this.collisionIndex.placeCollisionBox(Fs,Je,ne,z,q,Pt,bt,D,Ne.predicate,rn,Ht&&Hs?Hs:void 0);os&&os.placeable&&Wt.verticalIconBox?(Wr=zs(Wt.verticalIconBox),Ei=Wr.placeable):(Wr=zs(Wt.iconBox),Ei=Wr.placeable),zr=zr&&Wr.offscreen}const Ns=ze||Vt.numHorizontalGlyphVertices===0&&Vt.numVerticalGlyphVertices===0,Eu=Ve||Vt.numIconVertices===0;Ns||Eu?Eu?Ns||(Ei=Ei&&jn):jn=Ei&&jn:Ei=jn=Ei&&jn;const Vc=Ei&&Wr.placeable;if(jn&&Xr.placeable&&this.collisionIndex.insertCollisionBox(Xr.box,Ae,w.get("text-ignore-placement"),y.bucketInstanceId,os&&os.placeable&&tl?tl:ho,Ne.ID),Vc&&this.collisionIndex.insertCollisionBox(Wr.box,Je,w.get("icon-ignore-placement"),y.bucketInstanceId,Su,Ne.ID),Fr&&jn&&this.collisionIndex.insertCollisionCircles(Fr.circles,Ae,w.get("text-ignore-placement"),y.bucketInstanceId,ho,Ne.ID),_&&this.storeCollisionData(y.bucketInstanceId,In,Wt,Xr,Wr,Fr),Vt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Vt.crossTileID]=new Tn(jn||jt,Ei||Ut,zr||y.justReloaded),f[Vt.crossTileID]=!0};if($t){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Vt=y.getSortedSymbolIndexes(this.transform.angle);for(let Wt=Vt.length-1;Wt>=0;--Wt){const In=Vt[Wt];An(y.symbolInstances.get(In),y.collisionArrays[In],In)}}else for(let Vt=t.symbolInstanceStart;Vt<t.symbolInstanceEnd;Vt++)An(y.symbolInstances.get(Vt),y.collisionArrays[Vt],Vt);if(_&&y.bucketInstanceId in this.collisionCircleArrays){const Vt=this.collisionCircleArrays[y.bucketInstanceId];l.as(Vt.invProjMatrix,z),Vt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}storeCollisionData(t,f,_,y,w,R){if(_.textBox||_.iconBox){let D,z;this.collisionBoxArrays.has(t)?D=this.collisionBoxArrays.get(t):(D=new Map,this.collisionBoxArrays.set(t,D)),D.has(f)?z=D.get(f):(z={text:null,icon:null},D.set(f,z)),_.textBox&&(z.text=y.box),_.iconBox&&(z.icon=w.box)}if(R){let D=this.collisionCircleArrays[t];D===void 0&&(D=this.collisionCircleArrays[t]=new ii);for(let z=0;z<R.circles.length;z+=4)D.circles.push(R.circles[z+0]),D.circles.push(R.circles[z+1]),D.circles.push(R.circles[z+2]),D.circles.push(R.collisionDetected?1:0)}}markUsedJustification(t,f,_,y){let w;w=y===l.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.at(f)];const R=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const D of R)D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=w>=0&&D!==w?0:_.crossTileID)}markUsedOrientation(t,f,_){const y=f===l.ah.horizontal||f===l.ah.horizontalOnly?f:0,w=f===l.ah.vertical?f:0,R=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const D of R)t.text.placedSymbolArray.get(D).placedOrientation=y;_.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const y=f?f.symbolFadeChange(t):1,w=f?f.opacities:{},R=f?f.variableOffsets:{},D=f?f.placedOrientations:{};for(const z in this.placements){const q=this.placements[z],H=w[z];H?(this.opacities[z]=new ui(H,y,q.text,q.icon),_=_||q.text!==H.text.placed||q.icon!==H.icon.placed):(this.opacities[z]=new ui(null,y,q.text,q.icon,q.skipFade),_=_||q.text||q.icon)}for(const z in w){const q=w[z];if(!this.opacities[z]){const H=new ui(q,y,!1,!1);H.isHidden()||(this.opacities[z]=H,_=_||q.text.placed||q.icon.placed)}}for(const z in R)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=R[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:t)}updateLayerOpacities(t,f){const _={};for(const y of f){const w=y.getBucket(t);w&&y.latestFeatureIndex&&t.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,_,y.collisionBoxArray)}}updateBucketOpacities(t,f,_,y){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const w=t.layers[0],R=w.layout,D=new ui(null,0,!1,!1,!0),z=R.get("text-allow-overlap"),q=R.get("icon-allow-overlap"),H=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=R.get("text-rotation-alignment")==="map",ne=R.get("text-pitch-alignment")==="map",ge=R.get("icon-text-fit")!=="none",ke=new ui(null,0,z&&(q||!t.hasIconData()||R.get("icon-optional")),q&&(z||!t.hasTextData()||R.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Le=(ze,Ve,Ae)=>{for(let He=0;He<Ve/4;He++)ze.opacityVertexArray.emplaceBack(Ae);ze.hasVisibleVertices=ze.hasVisibleVertices||Ae!==no},Ne=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ze=0;ze<t.symbolInstances.length;ze++){const Ve=t.symbolInstances.get(ze),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:He,crossTileID:Je}=Ve;let st=this.opacities[Je];_[Je]?st=D:st||(st=ke,this.opacities[Je]=st),_[Je]=!0;const bt=Ve.numIconVertices>0,Pt=this.placedOrientations[Ve.crossTileID],Ht=Pt===l.ah.vertical,$t=Pt===l.ah.horizontal||Pt===l.ah.horizontalOnly;if(Ae>0||He>0){const Ut=or(st.text);Le(t.text,Ae,Ht?no:Ut),Le(t.text,He,$t?no:Ut);const rn=st.text.isHidden();[Ve.rightJustifiedTextSymbolIndex,Ve.centerJustifiedTextSymbolIndex,Ve.leftJustifiedTextSymbolIndex].forEach(Wt=>{Wt>=0&&(t.text.placedSymbolArray.get(Wt).hidden=rn||Ht?1:0)}),Ve.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Ve.verticalPlacedTextSymbolIndex).hidden=rn||$t?1:0);const An=this.variableOffsets[Ve.crossTileID];An&&this.markUsedJustification(t,An.anchor,Ve,Pt);const Vt=this.placedOrientations[Ve.crossTileID];Vt&&(this.markUsedJustification(t,"left",Ve,Vt),this.markUsedOrientation(t,Vt,Ve))}if(bt){const Ut=or(st.icon),rn=!(ge&&Ve.verticalPlacedIconSymbolIndex&&Ht);Ve.placedIconSymbolIndex>=0&&(Le(t.icon,Ve.numIconVertices,rn?Ut:no),t.icon.placedSymbolArray.get(Ve.placedIconSymbolIndex).hidden=st.icon.isHidden()),Ve.verticalPlacedIconSymbolIndex>=0&&(Le(t.icon,Ve.numVerticalIconVertices,rn?no:Ut),t.icon.placedSymbolArray.get(Ve.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}const jt=Ne&&Ne.has(ze)?Ne.get(ze):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ut=t.collisionArrays[ze];if(Ut){let rn=new l.P(0,0);if(Ut.textBox||Ut.verticalTextBox){let An=!0;if(H){const Vt=this.variableOffsets[Je];Vt?(rn=Wn(Vt.anchor,Vt.width,Vt.height,Vt.textOffset,Vt.textBoxScale),X&&rn._rotate(ne?this.transform.angle:-this.transform.angle)):An=!1}if(Ut.textBox||Ut.verticalTextBox){let Vt;Ut.textBox&&(Vt=Ht),Ut.verticalTextBox&&(Vt=$t),Do(t.textCollisionBox.collisionVertexArray,st.text.placed,!An||Vt,jt.text,rn.x,rn.y)}}if(Ut.iconBox||Ut.verticalIconBox){const An=!!(!$t&&Ut.verticalIconBox);let Vt;Ut.iconBox&&(Vt=An),Ut.verticalIconBox&&(Vt=!An),Do(t.iconCollisionBox.collisionVertexArray,st.icon.placed,Vt,jt.icon,ge?rn.x:0,ge?rn.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ze.invProjMatrix,t.placementViewportMatrix=ze.viewportMatrix,t.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>t}setStale(){this.stale=!0}}function Do(k,t,f,_,y,w){_&&_.length!==0||(_=[0,0,0,0]);const R=_[0]-Ln,D=_[1]-Ln,z=_[2]-Ln,q=_[3]-Ln;k.emplaceBack(t?1:0,f?1:0,y||0,w||0,R,D),k.emplaceBack(t?1:0,f?1:0,y||0,w||0,z,D),k.emplaceBack(t?1:0,f?1:0,y||0,w||0,z,q),k.emplaceBack(t?1:0,f?1:0,y||0,w||0,R,q)}const Qn=Math.pow(2,25),bo=Math.pow(2,24),aa=Math.pow(2,17),Cr=Math.pow(2,16),Nr=Math.pow(2,9),yc=Math.pow(2,8),Ri=Math.pow(2,1);function or(k){if(k.opacity===0&&!k.placed)return 0;if(k.opacity===1&&k.placed)return 4294967295;const t=k.placed?1:0,f=Math.floor(127*k.opacity);return f*Qn+t*bo+f*aa+t*Cr+f*Nr+t*yc+f*Ri+t}const no=0;function Qr(){return{isOccluded:(k,t,f)=>!1,getPitchedTextCorrection:(k,t,f)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(k,t,f,_){throw new Error("Not implemented.")},translatePosition:(k,t,f,_)=>function(y,w,R,D,z=!1){if(!R[0]&&!R[1])return[0,0];const q=z?D==="map"?y.angle:0:D==="viewport"?-y.angle:0;if(q){const H=Math.sin(q),X=Math.cos(q);R=[R[0]*X-R[1]*H,R[0]*H+R[1]*X]}return[z?R[0]:Bn(w,R[0],y.zoom),z?R[1]:Bn(w,R[1],y.zoom)]}(k,t,f,_),getCircleRadiusCorrection:k=>1}}class Pi{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,f,_,y,w){const R=this._bucketParts;for(;this._currentTileIndex<t.length;)if(f.getBucketParts(R,y,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((D,z)=>D.sortKey-z.sortKey));this._currentPartIndex<R.length;)if(f.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,w())return!0;return!1}}class la{constructor(t,f,_,y,w,R,D,z){this.placement=new Tr(t,Qr(),f,R,D,z),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(t,f,_){const y=C.now(),w=()=>!this._forceFullPlacement&&C.now()-y>2;for(;this._currentPlacementIndex>=0;){const R=f[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=D)&&(!R.maxzoom||R.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Pi(R)),this._inProgressLayer.continuePlacement(_[R.source],this.placement,this._showCollisionBoxes,R,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const gs=512/l.X/2;class Fi{constructor(t,f,_){this.tileID=t,this.bucketInstanceId=_,this._symbolsByKey={};const y=new Map;for(let w=0;w<f.length;w++){const R=f.get(w),D=R.key,z=y.get(D);z?z.push(R):y.set(D,[R])}for(const[w,R]of y){const D={positions:R.map(z=>({x:Math.floor(z.anchorX*gs),y:Math.floor(z.anchorY*gs)})),crossTileIDs:R.map(z=>z.crossTileID)};if(D.positions.length>128){const z=new l.av(D.positions.length,16,Uint16Array);for(const{x:q,y:H}of D.positions)z.add(q,H);z.finish(),delete D.positions,D.index=z}this._symbolsByKey[w]=D}}getScaledCoordinates(t,f){const{x:_,y,z:w}=this.tileID.canonical,{x:R,y:D,z}=f.canonical,q=gs/Math.pow(2,z-w),H=(D*l.X+t.anchorY)*q,X=y*l.X*gs;return{x:Math.floor((R*l.X+t.anchorX)*q-_*l.X*gs),y:Math.floor(H-X)}}findMatches(t,f,_){const y=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let w=0;w<t.length;w++){const R=t.get(w);if(R.crossTileID)continue;const D=this._symbolsByKey[R.key];if(!D)continue;const z=this.getScaledCoordinates(R,f);if(D.index){const q=D.index.range(z.x-y,z.y-y,z.x+y,z.y+y).sort();for(const H of q){const X=D.crossTileIDs[H];if(!_[X]){_[X]=!0,R.crossTileID=X;break}}}else if(D.positions)for(let q=0;q<D.positions.length;q++){const H=D.positions[q],X=D.crossTileIDs[q];if(Math.abs(H.x-z.x)<=y&&Math.abs(H.y-z.y)<=y&&!_[X]){_[X]=!0,R.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class es{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const f=Math.round((t-this.lng)/360);if(f!==0)for(const _ in this.indexes){const y=this.indexes[_],w={};for(const R in y){const D=y[R];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+f),w[D.tileID.key]=D}this.indexes[_]=w}this.lng=t}addBucket(t,f,_){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let w=0;w<f.symbolInstances.length;w++)f.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const y=this.usedCrossTileIDs[t.overscaledZ];for(const w in this.indexes){const R=this.indexes[w];if(Number(w)>t.overscaledZ)for(const D in R){const z=R[D];z.tileID.isChildOf(t)&&z.findMatches(f.symbolInstances,t,y)}else{const D=R[t.scaledTo(Number(w)).key];D&&D.findMatches(f.symbolInstances,t,y)}}for(let w=0;w<f.symbolInstances.length;w++){const R=f.symbolInstances.get(w);R.crossTileID||(R.crossTileID=_.generate(),y[R.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fi(t,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(t,f){for(const _ of f.getCrossTileIDsLists())for(const y of _)delete this.usedCrossTileIDs[t][y]}removeStaleBuckets(t){let f=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const w in y)t[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[w]),delete y[w],f=!0)}return f}}class No{constructor(){this.layerIndexes={},this.crossTileIDs=new ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,f,_){let y=this.layerIndexes[t.id];y===void 0&&(y=this.layerIndexes[t.id]=new es);let w=!1;const R={};y.handleWrapJump(_);for(const D of f){const z=D.getBucket(t);z&&t.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(D.tileID,z,this.crossTileIDs)&&(w=!0),R[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(R)&&(w=!0),w}pruneUnusedLayers(t){const f={};t.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Qi=(k,t)=>l.t(k,t&&t.filter(f=>f.identifier!=="source.canvas")),io=l.aw();class ca extends l.E{constructor(t,f={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const y=this.sourceCaches[_].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[_].reload()}},this.map=t,this.dispatcher=new dn(Xn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,y)=>this.getGlyphs(_,y)),this.dispatcher.registerMessageHandler("GI",(_,y)=>this.getImages(_,y)),this.imageManager=new Ue,this.imageManager.setEventedParent(this),this.glyphManager=new dt(t._requestManager,f.localIdeographFontFamily),this.lineAtlas=new xt(256,512),this.crossTileSymbolIndex=new No,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),mn().on(ct,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.sourceCaches[_.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const R in this._layers){const D=this._layers[R];D.source===w.id&&this._validateLayer(D)}})}loadURL(t,f={},_){this.fire(new l.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const y=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;l.h(y,this._loadStyleRequest).then(R=>{this._loadStyleRequest=null,this._load(R.data,f,_)}).catch(R=>{this._loadStyleRequest=null,R&&!w.signal.aborted&&this.fire(new l.j(R))})}loadJSON(t,f={},_){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(t,f,_)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(io,{validate:!1})}_load(t,f,_){var y;const w=f.transformStyle?f.transformStyle(_,t):t;if(!f.validate||!Qi(this,l.u(w))){this._loaded=!0,this.stylesheet=w;for(const R in w.sources)this.addSource(R,w.sources[R],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new vt(this.stylesheet.light),this.sky=new ft(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const t=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of t){const _=l.aA(f);_.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=_}}_loadSprite(t,f=!1,_=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,R,D,z){return l._(this,void 0,void 0,function*(){const q=be(w),H=D>1?"@2x":"",X={},ne={};for(const{id:ge,url:ke}of q){const Le=R.transformRequest(Ce(ke,H,".json"),"SpriteJSON");X[ge]=l.h(Le,z);const Ne=R.transformRequest(Ce(ke,H,".png"),"SpriteImage");ne[ge]=K.getImage(Ne,z)}return yield Promise.all([...Object.values(X),...Object.values(ne)]),function(ge,ke){return l._(this,void 0,void 0,function*(){const Le={};for(const Ne in ge){Le[Ne]={};const ze=C.getImageCanvasContext((yield ke[Ne]).data),Ve=(yield ge[Ne]).data;for(const Ae in Ve){const{width:He,height:Je,x:st,y:bt,sdf:Pt,pixelRatio:Ht,stretchX:$t,stretchY:jt,content:Ut,textFitWidth:rn,textFitHeight:An}=Ve[Ae];Le[Ne][Ae]={data:null,pixelRatio:Ht,sdf:Pt,stretchX:$t,stretchY:jt,content:Ut,textFitWidth:rn,textFitHeight:An,spriteData:{width:He,height:Je,x:st,y:bt,context:ze}}}}return Le})}(X,ne)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const R in w){this._spritesImagesIds[R]=[];const D=this._spritesImagesIds[R]?this._spritesImagesIds[R].filter(z=>!(z in w)):[];for(const z of D)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in w[R]){const q=R==="default"?z:`${R}:${z}`;this._spritesImagesIds[R].push(q),q in this.imageManager.images?this.imageManager.updateImage(q,w[R][z],!1):this.imageManager.addImage(q,w[R][z]),f&&(this._changedImages[q]=!0)}}}).catch(w=>{this._spriteRequest=null,y=w,this.fire(new l.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),_&&_(y)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(t){const f=this.sourceCaches[t.source];if(!f)return;const _=t.sourceLayer;if(!_)return;const y=f.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(_)===-1)&&this.fire(new l.j(new Error(`Source layer "${_}" does not exist on source "${y.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,f=!1){const _=this._serializedAllLayers();if(!t||t.length===0)return Object.values(f?l.aB(_):_);const y=[];for(const w of t)if(_[w]){const R=f?l.aB(_[w]):_[w];y.push(R)}return y}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const f=Object.keys(this._layers);for(const _ of f){const y=this._layers[_];y.type!=="custom"&&(t[_]=y.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const f=this._changed;if(f){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const R in this._updatedSources){const D=this._updatedSources[R];if(D==="reload")this._reloadSource(R);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(R)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const _={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];_[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(t,this._availableImages),!w.isHidden(t.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in _){const w=this.sourceCaches[y];!!_[y]!=!!w.used&&w.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,f&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,f={}){var _;this._checkLoaded();const y=this.serialize();if(t=f.transformStyle?f.transformStyle(y,t):t,((_=f.validate)===null||_===void 0||_)&&Qi(this,l.u(t)))return!1;(t=l.aB(t)).layers=l.az(t.layers);const w=l.aC(y,t),R=this._getOperationsToPerform(w);if(R.unimplemented.length>0)throw new Error(`Unimplemented: ${R.unimplemented.join(", ")}.`);if(R.operations.length===0)return!1;for(const D of R.operations)D();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const f=[],_=[];for(const y of t)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":f.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":f.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,y.args));break;case"setSky":f.push(()=>this.setSky.apply(this,y.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setTransition":f.push(()=>{});break;default:_.push(y.command)}return{operations:f,unimplemented:_}}addImage(t,f){if(this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,f),this._afterImageUpdated(t)}updateImage(t,f){this.imageManager.updateImage(t,f)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,f,_={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(l.u.source,`sources.${t}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const y=this.sourceCaches[t]=new At(t,f,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:t})),y.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new l.j(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));const f=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],f.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,f){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const _=this.sourceCaches[t].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(f),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,f,_={}){this._checkLoaded();const y=t.id;if(this.getLayer(y))return void this.fire(new l.j(new Error(`Layer "${y}" already exists on this map.`)));let w;if(t.type==="custom"){if(Qi(this,l.aD(t)))return;w=l.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(y,t.source),t=l.aB(t),t=l.e(t,{source:y})),this._validate(l.u.layer,`layers.${y}`,t,{arrayIndex:-1},_))return;w=l.aA(t),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const R=f?this._order.indexOf(f):this._order.length;if(f&&R===-1)this.fire(new l.j(new Error(`Cannot add layer "${y}" before non-existing layer "${f}".`)));else{if(this._order.splice(R,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const D=this._removedLayers[y];delete this._removedLayers[y],D.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(t,f){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===f)return;const _=this._order.indexOf(t);this._order.splice(_,1);const y=f?this._order.indexOf(f):this._order.length;f&&y===-1?this.fire(new l.j(new Error(`Cannot move layer "${t}" before non-existing layer "${f}".`))):(this._order.splice(y,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const f=this._layers[t];if(!f)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${t}".`)));f.setEventedParent(null);const _=this._order.indexOf(t);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=f,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],f.onRemove&&f.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,f,_){this._checkLoaded();const y=this.getLayer(t);y?y.minzoom===f&&y.maxzoom===_||(f!=null&&(y.minzoom=f),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,f,_={}){this._checkLoaded();const y=this.getLayer(t);if(y){if(!l.aE(y.filter,f))return f==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(l.u.filter,`layers.${y.id}.filter`,f,null,_)||(y.filter=l.aB(f),this._updateLayer(y)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.aB(this.getLayer(t).filter)}setLayoutProperty(t,f,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getLayoutProperty(f),_)||(w.setLayoutProperty(f,_,y),this._updateLayer(w)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,f){const _=this.getLayer(t);if(_)return _.getLayoutProperty(f);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,f,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getPaintProperty(f),_)||(w.setPaintProperty(f,_,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,f){return this.getLayer(t).getPaintProperty(f)}setFeatureState(t,f){this._checkLoaded();const _=t.source,y=t.sourceLayer,w=this.sourceCaches[_];if(w===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const R=w.getSource().type;R==="geojson"&&y?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||y?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,t.id,f)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,f){this._checkLoaded();const _=t.source,y=this.sourceCaches[_];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const w=y.getSource().type,R=w==="vector"?t.sourceLayer:void 0;w!=="vector"||R?f&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(R,t.id,f):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const f=t.source,_=t.sourceLayer,y=this.sourceCaches[f];if(y!==void 0)return y.getSource().type!=="vector"||_?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(_,t.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.aF(this.sourceCaches,w=>w.serialize()),f=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,y=this.stylesheet;return l.aG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:t,layers:f,terrain:_},w=>w!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const f=R=>this._layers[R].type==="fill-extrusion",_={},y=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(f(D)){_[D]=R;for(const z of t){const q=z[D];if(q)for(const H of q)y.push(H)}}}y.sort((R,D)=>D.intersectionZ-R.intersectionZ);const w=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(f(D))for(let z=y.length-1;z>=0;z--){const q=y[z].feature;if(_[q.layer.id]<R)break;w.push(q),y.pop()}else for(const z of t){const q=z[D];if(q)for(const H of q)w.push(H.feature)}}return w}queryRenderedFeatures(t,f,_){f&&f.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",f.filter,null,f);const y={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const D of f.layers){const z=this._layers[D];if(!z)return this.fire(new l.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const w=[];f.availableImages=this._availableImages;const R=this._serializedAllLayers();for(const D in this.sourceCaches)f.layers&&!y[D]||w.push(lt(this.sourceCaches[D],this._layers,R,t,f,_));return this.placement&&w.push(function(D,z,q,H,X,ne,ge){const ke={},Le=ne.queryRenderedSymbols(H),Ne=[];for(const ze of Object.keys(Le).map(Number))Ne.push(ge[ze]);Ne.sort(Ye);for(const ze of Ne){const Ve=ze.featureIndex.lookupSymbolFeatures(Le[ze.bucketInstanceId],z,ze.bucketIndex,ze.sourceLayerIndex,X.filter,X.layers,X.availableImages,D);for(const Ae in Ve){const He=ke[Ae]=ke[Ae]||[],Je=Ve[Ae];Je.sort((st,bt)=>{const Pt=ze.featureSortOrder;if(Pt){const Ht=Pt.indexOf(st.featureIndex);return Pt.indexOf(bt.featureIndex)-Ht}return bt.featureIndex-st.featureIndex});for(const st of Je)He.push(st)}}for(const ze in ke)ke[ze].forEach(Ve=>{const Ae=Ve.feature,He=q[D[ze].source].getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=He});return ke}(this._layers,R,this.sourceCaches,t,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(t,f){f&&f.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",f.filter,null,f);const _=this.sourceCaches[t];return _?function(y,w){const R=y.getRenderableIds().map(q=>y.getTileByID(q)),D=[],z={};for(let q=0;q<R.length;q++){const H=R[q],X=H.tileID.canonical.key;z[X]||(z[X]=!0,H.querySourceFeatures(D,w))}return D}(_,f):[]}getLight(){return this.light.getLight()}setLight(t,f={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const R in t)if(!l.aE(t[R],_[R])){y=!0;break}if(!y)return;const w={now:C.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,f),this.light.updateTransitions(w)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,f={}){const _=this.getSky();let y=!1;if(!t&&!_)return;if(t&&!_)y=!0;else if(!t&&_)y=!0;else for(const R in t)if(!l.aE(t[R],_[R])){y=!0;break}if(!y)return;const w={now:C.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,f),this.sky.updateTransitions(w)}_validate(t,f,_,y,w={}){return(!w||w.validate!==!1)&&Qi(this,t.call(l.u,l.e({key:f,style:this.serialize(),value:_,styleSpec:l.v},y)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),mn().off(ct,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const _=this.sourceCaches[f];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const f in this.sourceCaches)this.sourceCaches[f].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,f,_,y,w=!1){let R=!1,D=!1;const z={};for(const q of this._order){const H=this._layers[q];if(H.type!=="symbol")continue;if(!z[H.source]){const ne=this.sourceCaches[H.source];z[H.source]=ne.getRenderableIds(!0).map(ge=>ne.getTileByID(ge)).sort((ge,ke)=>ke.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(ke.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(H,z[H.source],t.center.lng);R=R||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(C.now(),t.zoom))&&(this.pauseablePlacement=new la(t,this.map.terrain,this._order,w,f,_,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(C.now()),D=!0),R&&this.pauseablePlacement.placement.setStale()),D||R)for(const q of this._order){const H=this._layers[q];H.type==="symbol"&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(C.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,f){return l._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,f.icons),_})}getGlyphs(t,f){return l._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(f.stacks),y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,f={}){this._checkLoaded(),t&&this._validate(l.u.glyphs,"glyphs",t,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,f,_={},y){this._checkLoaded();const w=[{id:t,url:f}],R=[...be(this.stylesheet.sprite),...w];this._validate(l.u.sprite,"sprite",R,null,_)||(this.stylesheet.sprite=R,this._loadSprite(w,!0,y))}removeSprite(t){this._checkLoaded();const f=be(this.stylesheet.sprite);if(f.find(_=>_.id===t)){if(this._spritesImagesIds[t])for(const _ of this._spritesImagesIds[t])this.imageManager.removeImage(_),this._changedImages[_]=!0;f.splice(f.findIndex(_=>_.id===t),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return be(this.stylesheet.sprite)}setSprite(t,f={},_){this._checkLoaded(),t&&this._validate(l.u.sprite,"sprite",t,null,f)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,_):(this._unloadSprite(),_&&_(null)))}}var ts=l.Y([{name:"a_pos",type:"Int16",components:2}]);const ro={prelude:ei(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ei(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ei(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ei(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ei("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ei(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ei(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ei("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ei("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ei(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ei(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ei(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ei(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ei(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ei(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ei(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ei(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ei(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ei(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ei(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ei("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ei("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ei("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ei("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ei(k,t){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=t.match(/attribute ([\w]+) ([\w]+)/g),y=k.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=w?w.concat(y):y,D={};return{fragmentSource:k=k.replace(f,(z,q,H,X,ne)=>(D[ne]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${H} ${X} ${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = u_${ne};
#endif
`)),vertexSource:t=t.replace(f,(z,q,H,X,ne)=>{const ge=X==="float"?"vec2":"vec4",ke=ne.match(/color/)?"color":ge;return D[ne]?q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${ge} a_${ne};
varying ${H} ${X} ${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${ke}(a_${ne}, u_${ne}_t);
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${ge} a_${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = a_${ne};
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = unpack_mix_${ke}(a_${ne}, u_${ne}_t);
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`}),staticAttributes:_,staticUniforms:R}}class Il{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,f,_,y,w,R,D,z,q){this.context=t;let H=this.boundPaintVertexBuffers.length!==y.length;for(let X=0;!H&&X<y.length;X++)this.boundPaintVertexBuffers[X]!==y[X]&&(H=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==R||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==q?this.freshBind(f,_,y,w,R,D,z,q):(t.bindVertexArray.set(this.vao),D&&D.bind(),w&&w.dynamicDraw&&w.bind(),z&&z.bind(),q&&q.bind())}freshBind(t,f,_,y,w,R,D,z){const q=t.numAttributes,H=this.context,X=H.gl;this.vao&&this.destroy(),this.vao=H.createVertexArray(),H.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=z,f.enableAttributes(X,t);for(const ne of _)ne.enableAttributes(X,t);R&&R.enableAttributes(X,t),D&&D.enableAttributes(X,t),z&&z.enableAttributes(X,t),f.bind(),f.setVertexAttribPointers(X,t,w);for(const ne of _)ne.bind(),ne.setVertexAttribPointers(X,t,w);R&&(R.bind(),R.setVertexAttribPointers(X,t,w)),y&&y.bind(),D&&(D.bind(),D.setVertexAttribPointers(X,t,w)),z&&(z.bind(),z.setVertexAttribPointers(X,t,w)),H.currentNumAttributes=q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Sl=(k,t,f,_,y)=>({u_matrix:k,u_texture:0,u_ele_delta:t,u_fog_matrix:f,u_fog_color:_?_.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:_?_.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?_.calculateFogBlendOpacity(y):0,u_horizon_color:_?_.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:_?_.properties.get("horizon-fog-blend"):1});function xo(k){const t=[];for(let f=0;f<k.length;f++){if(k[f]===null)continue;const _=k[f].split(" ");t.push(_.pop())}return t}class wo{constructor(t,f,_,y,w,R){const D=t.gl;this.program=D.createProgram();const z=xo(f.staticAttributes),q=_?_.getBinderAttributes():[],H=z.concat(q),X=ro.prelude.staticUniforms?xo(ro.prelude.staticUniforms):[],ne=f.staticUniforms?xo(f.staticUniforms):[],ge=_?_.getBinderUniforms():[],ke=X.concat(ne).concat(ge),Le=[];for(const st of ke)Le.indexOf(st)<0&&Le.push(st);const Ne=_?_.defines():[];w&&Ne.push("#define OVERDRAW_INSPECTOR;"),R&&Ne.push("#define TERRAIN3D;");const ze=Ne.concat(ro.prelude.fragmentSource,f.fragmentSource).join(`
`),Ve=Ne.concat(ro.prelude.vertexSource,f.vertexSource).join(`
`),Ae=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ae,ze),D.compileShader(Ae),!D.getShaderParameter(Ae,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Ae)}`);D.attachShader(this.program,Ae);const He=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(He,Ve),D.compileShader(He),!D.getShaderParameter(He,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(He)}`);D.attachShader(this.program,He),this.attributes={};const Je={};this.numAttributes=H.length;for(let st=0;st<this.numAttributes;st++)H[st]&&(D.bindAttribLocation(this.program,st,H[st]),this.attributes[H[st]]=st);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(He),D.deleteShader(Ae);for(let st=0;st<Le.length;st++){const bt=Le[st];if(bt&&!Je[bt]){const Pt=D.getUniformLocation(this.program,bt);Pt&&(Je[bt]=Pt)}}this.fixedUniforms=y(t,Je),this.terrainUniforms=((st,bt)=>({u_depth:new l.aH(st,bt.u_depth),u_terrain:new l.aH(st,bt.u_terrain),u_terrain_dim:new l.aI(st,bt.u_terrain_dim),u_terrain_matrix:new l.aJ(st,bt.u_terrain_matrix),u_terrain_unpack:new l.aK(st,bt.u_terrain_unpack),u_terrain_exaggeration:new l.aI(st,bt.u_terrain_exaggeration)}))(t,Je),this.binderUniforms=_?_.getUniforms(t,Je):[]}draw(t,f,_,y,w,R,D,z,q,H,X,ne,ge,ke,Le,Ne,ze,Ve){const Ae=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(_),t.setStencilMode(y),t.setColorMode(w),t.setCullFace(R),z){t.activeTexture.set(Ae.TEXTURE2),Ae.bindTexture(Ae.TEXTURE_2D,z.depthTexture),t.activeTexture.set(Ae.TEXTURE3),Ae.bindTexture(Ae.TEXTURE_2D,z.texture);for(const Je in this.terrainUniforms)this.terrainUniforms[Je].set(z[Je])}for(const Je in this.fixedUniforms)this.fixedUniforms[Je].set(D[Je]);Le&&Le.setUniforms(t,this.binderUniforms,ge,{zoom:ke});let He=0;switch(f){case Ae.LINES:He=2;break;case Ae.TRIANGLES:He=3;break;case Ae.LINE_STRIP:He=1}for(const Je of ne.get()){const st=Je.vaos||(Je.vaos={});(st[q]||(st[q]=new Il)).bind(t,this,H,Le?Le.getPaintVertexBuffers():[],X,Je.vertexOffset,Ne,ze,Ve),Ae.drawElements(f,Je.primitiveLength*He,Ae.UNSIGNED_SHORT,Je.primitiveOffset*He*2)}}}function ha(k,t,f){const _=1/Bn(f,1,t.transform.tileZoom),y=Math.pow(2,f.tileID.overscaledZ),w=f.tileSize*Math.pow(2,t.transform.tileZoom)/y,R=w*(f.tileID.canonical.x+f.tileID.wrap*y),D=w*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[_,k.fromScale,k.toScale],u_fade:k.t,u_pixel_coord_upper:[R>>16,D>>16],u_pixel_coord_lower:[65535&R,65535&D]}}const fa=(k,t,f,_)=>{const y=t.style.light,w=y.properties.get("position"),R=[w.x,w.y,w.z],D=function(){var q=new l.A(9);return l.A!=Float32Array&&(q[1]=0,q[2]=0,q[3]=0,q[5]=0,q[6]=0,q[7]=0),q[0]=1,q[4]=1,q[8]=1,q}();y.properties.get("anchor")==="viewport"&&function(q,H){var X=Math.sin(H),ne=Math.cos(H);q[0]=ne,q[1]=X,q[2]=0,q[3]=-X,q[4]=ne,q[5]=0,q[6]=0,q[7]=0,q[8]=1}(D,-t.transform.angle),function(q,H,X){var ne=H[0],ge=H[1],ke=H[2];q[0]=ne*X[0]+ge*X[3]+ke*X[6],q[1]=ne*X[1]+ge*X[4]+ke*X[7],q[2]=ne*X[2]+ge*X[5]+ke*X[8]}(R,R,D);const z=y.properties.get("color");return{u_matrix:k,u_lightpos:R,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+f,u_opacity:_}},da=(k,t,f,_,y,w,R)=>l.e(fa(k,t,f,_),ha(w,t,R),{u_height_factor:-Math.pow(2,y.overscaledZ)/R.tileSize/8}),zo=k=>({u_matrix:k}),za=(k,t,f,_)=>l.e(zo(k),ha(f,t,_)),ki=(k,t)=>({u_matrix:k,u_world:t}),so=(k,t,f,_,y)=>l.e(za(k,t,f,_),{u_world:y}),vc=(k,t,f,_)=>{const y=k.transform;let w,R;if(_.paint.get("circle-pitch-alignment")==="map"){const D=Bn(f,1,y.zoom);w=!0,R=[D,D]}else w=!1,R=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:k.translatePosMatrix(t.posMatrix,f,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:k.pixelRatio,u_extrude_scale:R}},qs=(k,t,f)=>({u_matrix:k,u_inv_matrix:t,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),br=(k,t,f=1)=>({u_matrix:k,u_color:t,u_overlay:0,u_overlay_scale:f}),bi=k=>({u_matrix:k}),cr=(k,t,f,_)=>({u_matrix:k,u_extrude_scale:Bn(t,1,f),u_intensity:_}),Fa=(k,t,f,_)=>{const y=l.H();l.aP(y,0,k.width,k.height,0,0,1);const w=k.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:f,u_color_ramp:_,u_opacity:t.paint.get("heatmap-opacity")}};function Oa(k,t){const f=Math.pow(2,t.canonical.z),_=t.canonical.y;return[new l.Z(0,_/f).toLngLat().lat,new l.Z(0,(_+1)/f).toLngLat().lat]}const pa=(k,t,f,_)=>{const y=k.transform;return{u_matrix:_s(k,t,f,_),u_ratio:1/Bn(t,1,y.zoom),u_device_pixel_ratio:k.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ma=(k,t,f,_,y)=>l.e(pa(k,t,f,y),{u_image:0,u_image_height:_}),Fo=(k,t,f,_,y)=>{const w=k.transform,R=ri(t,w);return{u_matrix:_s(k,t,f,y),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Bn(t,1,w.zoom),u_device_pixel_ratio:k.pixelRatio,u_image:0,u_scale:[R,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},au=(k,t,f,_,y,w)=>{const R=k.lineAtlas,D=ri(t,k.transform),z=f.layout.get("line-cap")==="round",q=R.getDash(_.from,z),H=R.getDash(_.to,z),X=q.width*y.fromScale,ne=H.width*y.toScale;return l.e(pa(k,t,f,w),{u_patternscale_a:[D/X,-q.height/2],u_patternscale_b:[D/ne,-H.height/2],u_sdfgamma:R.width/(256*Math.min(X,ne)*k.pixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:H.y,u_mix:y.t})};function ri(k,t){return 1/Bn(k,1,t.tileZoom)}function _s(k,t,f,_){return k.translatePosMatrix(_?_.posMatrix:t.tileID.posMatrix,t,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const El=(k,t,f,_,y)=>{return{u_matrix:k,u_tl_parent:t,u_scale_parent:f,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(R=y.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:lu(y.paint.get("raster-hue-rotate"))};var w,R};function lu(k){k*=Math.PI/180;const t=Math.sin(k),f=Math.cos(k);return[(2*f+1)/3,(-Math.sqrt(3)*t-f+1)/3,(Math.sqrt(3)*t-f+1)/3]}const Oo=(k,t,f,_,y,w,R,D,z,q,H,X,ne,ge)=>{const ke=R.transform;return{u_is_size_zoom_constant:+(k==="constant"||k==="source"),u_is_size_feature_constant:+(k==="constant"||k==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ke.cameraToCenterDistance,u_pitch:ke.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:ke.width/ke.height,u_fade_change:R.options.fadeDuration?R.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:z,u_coord_matrix:q,u_is_text:+X,u_pitch_with_map:+_,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:ge}},Bo=(k,t,f,_,y,w,R,D,z,q,H,X,ne,ge,ke)=>{const Le=R.transform;return l.e(Oo(k,t,f,_,y,w,R,D,z,q,H,X,ne,ke),{u_gamma_scale:_?Math.cos(Le._pitch)*Le.cameraToCenterDistance:1,u_device_pixel_ratio:R.pixelRatio,u_is_halo:+ge})},hr=(k,t,f,_,y,w,R,D,z,q,H,X,ne,ge)=>l.e(Bo(k,t,f,_,y,w,R,D,z,q,H,!0,X,!0,ge),{u_texsize_icon:ne,u_texture_icon:1}),ga=(k,t,f)=>({u_matrix:k,u_opacity:t,u_color:f}),_a=(k,t,f,_,y,w)=>l.e(function(R,D,z,q){const H=z.imageManager.getPattern(R.from.toString()),X=z.imageManager.getPattern(R.to.toString()),{width:ne,height:ge}=z.imageManager.getPixelSize(),ke=Math.pow(2,q.tileID.overscaledZ),Le=q.tileSize*Math.pow(2,z.transform.tileZoom)/ke,Ne=Le*(q.tileID.canonical.x+q.tileID.wrap*ke),ze=Le*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[ne,ge],u_mix:D.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Bn(q,1,z.transform.tileZoom),u_pixel_coord_upper:[Ne>>16,ze>>16],u_pixel_coord_lower:[65535&Ne,65535&ze]}}(_,w,f,y),{u_matrix:k,u_opacity:t}),Ba={fillExtrusion:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_opacity:new l.aI(k,t.u_opacity)}),fillExtrusionPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_height_factor:new l.aI(k,t.u_height_factor),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade),u_opacity:new l.aI(k,t.u_opacity)}),fill:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),fillPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),fillOutline:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world)}),fillOutlinePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),circle:(k,t)=>({u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_scale_with_map:new l.aH(k,t.u_scale_with_map),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_extrude_scale:new l.aO(k,t.u_extrude_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_matrix:new l.aJ(k,t.u_matrix)}),collisionBox:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_pixel_extrude_scale:new l.aO(k,t.u_pixel_extrude_scale)}),collisionCircle:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_inv_matrix:new l.aJ(k,t.u_inv_matrix),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_viewport_size:new l.aO(k,t.u_viewport_size)}),debug:(k,t)=>({u_color:new l.aL(k,t.u_color),u_matrix:new l.aJ(k,t.u_matrix),u_overlay:new l.aH(k,t.u_overlay),u_overlay_scale:new l.aI(k,t.u_overlay_scale)}),clippingMask:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),heatmap:(k,t)=>({u_extrude_scale:new l.aI(k,t.u_extrude_scale),u_intensity:new l.aI(k,t.u_intensity),u_matrix:new l.aJ(k,t.u_matrix)}),heatmapTexture:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_color_ramp:new l.aH(k,t.u_color_ramp),u_opacity:new l.aI(k,t.u_opacity)}),hillshade:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_latrange:new l.aO(k,t.u_latrange),u_light:new l.aO(k,t.u_light),u_shadow:new l.aL(k,t.u_shadow),u_highlight:new l.aL(k,t.u_highlight),u_accent:new l.aL(k,t.u_accent)}),hillshadePrepare:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_dimension:new l.aO(k,t.u_dimension),u_zoom:new l.aI(k,t.u_zoom),u_unpack:new l.aK(k,t.u_unpack)}),line:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels)}),lineGradient:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_image:new l.aH(k,t.u_image),u_image_height:new l.aI(k,t.u_image_height)}),linePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texsize:new l.aO(k,t.u_texsize),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_image:new l.aH(k,t.u_image),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),lineSDF:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_patternscale_a:new l.aO(k,t.u_patternscale_a),u_patternscale_b:new l.aO(k,t.u_patternscale_b),u_sdfgamma:new l.aI(k,t.u_sdfgamma),u_image:new l.aH(k,t.u_image),u_tex_y_a:new l.aI(k,t.u_tex_y_a),u_tex_y_b:new l.aI(k,t.u_tex_y_b),u_mix:new l.aI(k,t.u_mix)}),raster:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_tl_parent:new l.aO(k,t.u_tl_parent),u_scale_parent:new l.aI(k,t.u_scale_parent),u_buffer_scale:new l.aI(k,t.u_buffer_scale),u_fade_t:new l.aI(k,t.u_fade_t),u_opacity:new l.aI(k,t.u_opacity),u_image0:new l.aH(k,t.u_image0),u_image1:new l.aH(k,t.u_image1),u_brightness_low:new l.aI(k,t.u_brightness_low),u_brightness_high:new l.aI(k,t.u_brightness_high),u_saturation_factor:new l.aI(k,t.u_saturation_factor),u_contrast_factor:new l.aI(k,t.u_contrast_factor),u_spin_weights:new l.aN(k,t.u_spin_weights)}),symbolIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolSDF:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolTextAndIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texsize_icon:new l.aO(k,t.u_texsize_icon),u_texture:new l.aH(k,t.u_texture),u_texture_icon:new l.aH(k,t.u_texture_icon),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),background:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_color:new l.aL(k,t.u_color)}),backgroundPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_image:new l.aH(k,t.u_image),u_pattern_tl_a:new l.aO(k,t.u_pattern_tl_a),u_pattern_br_a:new l.aO(k,t.u_pattern_br_a),u_pattern_tl_b:new l.aO(k,t.u_pattern_tl_b),u_pattern_br_b:new l.aO(k,t.u_pattern_br_b),u_texsize:new l.aO(k,t.u_texsize),u_mix:new l.aI(k,t.u_mix),u_pattern_size_a:new l.aO(k,t.u_pattern_size_a),u_pattern_size_b:new l.aO(k,t.u_pattern_size_b),u_scale_a:new l.aI(k,t.u_scale_a),u_scale_b:new l.aI(k,t.u_scale_b),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(k,t.u_tile_units_to_pixels)}),terrain:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_ele_delta:new l.aI(k,t.u_ele_delta),u_fog_matrix:new l.aJ(k,t.u_fog_matrix),u_fog_color:new l.aL(k,t.u_fog_color),u_fog_ground_blend:new l.aI(k,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(k,t.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon_fog_blend:new l.aI(k,t.u_horizon_fog_blend)}),terrainDepth:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ele_delta:new l.aI(k,t.u_ele_delta)}),terrainCoords:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_terrain_coords_id:new l.aI(k,t.u_terrain_coords_id),u_ele_delta:new l.aI(k,t.u_ele_delta)}),sky:(k,t)=>({u_sky_color:new l.aL(k,t.u_sky_color),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon:new l.aI(k,t.u_horizon),u_sky_horizon_blend:new l.aI(k,t.u_sky_horizon_blend)})};class ys{constructor(t,f,_){this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ua{constructor(t,f,_,y){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=y,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,f){for(let _=0;_<this.attributes.length;_++){const y=f.attributes[this.attributes[_].name];y!==void 0&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,f,_){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],R=f.attributes[w.name];R!==void 0&&t.vertexAttribPointer(R,w.components,t[bc[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr=new WeakMap;function vs(k){var t;if(Lr.has(k))return Lr.get(k);{const f=(t=k.getParameter(k.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Lr.set(k,f),f}}class si{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mr extends si{getDefault(){return l.aM.transparent}set(t){const f=this.current;(t.r!==f.r||t.g!==f.g||t.b!==f.b||t.a!==f.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Uo extends si{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class jo extends si{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qo extends si{getDefault(){return[!0,!0,!0,!0]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||t[2]!==f[2]||t[3]!==f[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Al extends si{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Vo extends si{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class uu extends si{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const f=this.current;(t.func!==f.func||t.ref!==f.ref||t.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ns extends si{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||t[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Tl extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=t,this.dirty=!1}}class cu extends si{getDefault(){return[0,1]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class hu extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=t,this.dirty=!1}}class fu extends si{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ko extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.BLEND):f.disable(f.BLEND),this.current=t,this.dirty=!1}}class du extends si{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class xc extends si{getDefault(){return l.aM.transparent}set(t){const f=this.current;(t.r!==f.r||t.g!==f.g||t.b!==f.b||t.a!==f.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class pu extends si{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class bs extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=t,this.dirty=!1}}class Hr extends si{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ja extends si{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class mu extends si{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class wc extends si{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class qa extends si{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||t[2]!==f[2]||t[3]!==f[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Va extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ga extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class is extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ya extends si{getDefault(){return null}set(t){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Oi extends si{getDefault(){return null}set(t){var f;if(t===this.current&&!this.dirty)return;const _=this.gl;vs(_)?_.bindVertexArray(t):(f=_.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Io extends si{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ll extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Za extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class va extends si{constructor(t,f){super(t),this.context=t,this.parent=f}getDefault(){return null}}class Ha extends va{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Vs extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ml extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kc{constructor(t,f,_,y,w){this.context=t,this.width=f,this.height=_;const R=t.gl,D=this.framebuffer=R.createFramebuffer();if(this.colorAttachment=new Ha(t,D),y)this.depthAttachment=w?new Ml(t,D):new Vs(t,D);else if(w)throw new Error("Stencil cannot be set without depth");if(R.checkFramebufferStatus(R.FRAMEBUFFER)!==R.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,f=this.colorAttachment.get();if(f&&t.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&t.deleteRenderbuffer(_)}t.deleteFramebuffer(this.framebuffer)}}class Di{constructor(t,f,_){this.blendFunction=t,this.blendColor=f,this.mask=_}}Di.Replace=[1,0],Di.disabled=new Di(Di.Replace,l.aM.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,l.aM.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,771],l.aM.transparent,[!0,!0,!0,!0]);class Ic{constructor(t){var f,_;if(this.gl=t,this.clearColor=new Mr(this),this.clearDepth=new Uo(this),this.clearStencil=new jo(this),this.colorMask=new qo(this),this.depthMask=new Al(this),this.stencilMask=new Vo(this),this.stencilFunc=new uu(this),this.stencilOp=new ns(this),this.stencilTest=new Tl(this),this.depthRange=new cu(this),this.depthTest=new hu(this),this.depthFunc=new fu(this),this.blend=new ko(this),this.blendFunc=new du(this),this.blendColor=new xc(this),this.blendEquation=new pu(this),this.cullFace=new bs(this),this.cullFaceSide=new Hr(this),this.frontFace=new ja(this),this.program=new mu(this),this.activeTexture=new wc(this),this.viewport=new qa(this),this.bindFramebuffer=new Cl(this),this.bindRenderbuffer=new Va(this),this.bindTexture=new Ga(this),this.bindVertexBuffer=new is(this),this.bindElementBuffer=new ya(this),this.bindVertexArray=new Oi(this),this.pixelStoreUnpack=new Io(this),this.pixelStoreUnpackPremultiplyAlpha=new Ll(this),this.pixelStoreUnpackFlipY=new Za(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),vs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const y=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=t.RGBA16F)!==null&&f!==void 0?f:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(_=t.RGB16F)!==null&&_!==void 0?_:y==null?void 0:y.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const y=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,f){return new ys(this,t,f)}createVertexBuffer(t,f,_){return new Ua(this,t,f,_)}createRenderbuffer(t,f,_){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,t,f,_),this.bindRenderbuffer.set(null),w}createFramebuffer(t,f,_,y){return new kc(this,t,f,_,y)}clear({color:t,depth:f,stencil:_}){const y=this.gl;let w=0;t&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.aE(t.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return vs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var f;return vs(this.gl)?this.gl.deleteVertexArray(t):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Un{constructor(t,f,_){this.func=t,this.mask=f,this.range=_}}Un.ReadOnly=!1,Un.ReadWrite=!0,Un.disabled=new Un(519,Un.ReadOnly,[0,1]);const Xa=7680;class pi{constructor(t,f,_,y,w,R){this.test=t,this.ref=f,this.mask=_,this.fail=y,this.depthFail=w,this.pass=R}}pi.disabled=new pi({func:519,mask:0},0,0,Xa,Xa,Xa);class ci{constructor(t,f,_){this.enable=t,this.mode=f,this.frontFace=_}}let oo;function ba(k,t,f,_,y){const w=k.context,R=w.gl,D=k.useProgram("collisionBox"),z=[];let q=0,H=0;for(let ze=0;ze<_.length;ze++){const Ve=_[ze],Ae=t.getTile(Ve).getBucket(f);if(!Ae)continue;const He=y?Ae.textCollisionBox:Ae.iconCollisionBox,Je=Ae.collisionCircleArray;if(Je.length>0){const st=l.H();l.aQ(st,Ae.placementInvProjMatrix,k.transform.glCoordMatrix),l.aQ(st,st,Ae.placementViewportMatrix),z.push({circleArray:Je,circleOffset:H,transform:Ve.posMatrix,invTransform:st,coord:Ve}),q+=Je.length/4,H=q}He&&D.draw(w,R.LINES,Un.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,{u_matrix:Ve.posMatrix,u_pixel_extrude_scale:[1/(X=k.transform).width,1/X.height]},k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ve),f.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,k.transform.zoom,null,null,He.collisionVertexBuffer)}var X;if(!y||!z.length)return;const ne=k.useProgram("collisionCircle"),ge=new l.aR;ge.resize(4*q),ge._trim();let ke=0;for(const ze of z)for(let Ve=0;Ve<ze.circleArray.length/4;Ve++){const Ae=4*Ve,He=ze.circleArray[Ae+0],Je=ze.circleArray[Ae+1],st=ze.circleArray[Ae+2],bt=ze.circleArray[Ae+3];ge.emplace(ke++,He,Je,st,bt,0),ge.emplace(ke++,He,Je,st,bt,1),ge.emplace(ke++,He,Je,st,bt,2),ge.emplace(ke++,He,Je,st,bt,3)}(!oo||oo.length<2*q)&&(oo=function(ze){const Ve=2*ze,Ae=new l.aT;Ae.resize(Ve),Ae._trim();for(let He=0;He<Ve;He++){const Je=6*He;Ae.uint16[Je+0]=4*He+0,Ae.uint16[Je+1]=4*He+1,Ae.uint16[Je+2]=4*He+2,Ae.uint16[Je+3]=4*He+2,Ae.uint16[Je+4]=4*He+3,Ae.uint16[Je+5]=4*He+0}return Ae}(q));const Le=w.createIndexBuffer(oo,!0),Ne=w.createVertexBuffer(ge,l.aS.members,!0);for(const ze of z){const Ve=qs(ze.transform,ze.invTransform,k.transform);ne.draw(w,R.TRIANGLES,Un.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,Ve,k.style.map.terrain&&k.style.map.terrain.getTerrainData(ze.coord),f.id,Ne,Le,l.a0.simpleSegment(0,2*ze.circleOffset,ze.circleArray.length,ze.circleArray.length/2),null,k.transform.zoom,null,null,null)}Ne.destroy(),Le.destroy()}ci.disabled=new ci(!1,1029,2305),ci.backCCW=new ci(!0,1029,2305);const Go=l.an(new Float32Array(16));function Rl(k,t,f,_,y,w){const{horizontalAlign:R,verticalAlign:D}=l.au(k);return new l.P((-(R-.5)*t/y+_[0])*w,(-(D-.5)*f/y+_[1])*w)}function So(k,t,f,_,y,w){const R=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let D=_.mult(w);f||(D=D.rotate(-y));const z=R.add(D);return Me(z.x,z.y,t.labelPlaneMatrix,t.getElevation).point}if(f){const D=et(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(k),z=Math.atan(D.y/D.x)+(D.x<0?Math.PI:0);return k.add(_.rotate(z))}return k.add(_)}function Zo(k,t,f,_,y,w,R,D,z,q,H,X,ne,ge){const ke=k.text.placedSymbolArray,Le=k.text.dynamicLayoutVertexArray,Ne=k.icon.dynamicLayoutVertexArray,ze={};Le.clear();for(let Ve=0;Ve<ke.length;Ve++){const Ae=ke.get(Ve),He=Ae.hidden||!Ae.crossTileID||k.allowVerticalPlacement&&!Ae.placedOrientation?null:_[Ae.crossTileID];if(He){const Je=new l.P(Ae.anchorX,Ae.anchorY),st={getElevation:ge,width:y.width,height:y.height,labelPlaneMatrix:w,lineVertexArray:null,pitchWithMap:f,projection:H,projectionCache:null,tileAnchorPoint:Je,translation:X,unwrappedTileID:ne},bt=f?Me(Je.x,Je.y,R,ge):et(Je.x,Je.y,st),Pt=J(y.cameraToCenterDistance,bt.signedDistanceFromCamera);let Ht=l.ai(k.textSizeData,z,Ae)*Pt/l.ap;f&&(Ht*=k.tilePixelRatio/D);const{width:$t,height:jt,anchor:Ut,textOffset:rn,textBoxScale:An}=He,Vt=Rl(Ut,$t,jt,rn,An,Ht),Wt=H.getPitchedTextCorrection(y,Je.add(new l.P(X[0],X[1])),ne),In=So(bt.point,st,t,Vt,y.angle,Wt),Si=k.allowVerticalPlacement&&Ae.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let On=0;On<Ae.numGlyphs;On++)l.aj(Le,In,Si);q&&Ae.associatedIconIndex>=0&&(ze[Ae.associatedIconIndex]={shiftedAnchor:In,angle:Si})}else ln(Ae.numGlyphs,Le)}if(q){Ne.clear();const Ve=k.icon.placedSymbolArray;for(let Ae=0;Ae<Ve.length;Ae++){const He=Ve.get(Ae);if(He.hidden)ln(He.numGlyphs,Ne);else{const Je=ze[Ae];if(Je)for(let st=0;st<He.numGlyphs;st++)l.aj(Ne,Je.shiftedAnchor,Je.angle);else ln(He.numGlyphs,Ne)}}k.icon.dynamicLayoutVertexBuffer.updateData(Ne)}k.text.dynamicLayoutVertexBuffer.updateData(Le)}function rs(k,t,f){return f.iconsInText&&t?"symbolTextAndIcon":k?"symbolSDF":"symbolIcon"}function Pl(k,t,f,_,y,w,R,D,z,q,H,X){const ne=k.context,ge=ne.gl,ke=k.transform,Le=Qr(),Ne=D==="map",ze=z==="map",Ve=D!=="viewport"&&f.layout.get("symbol-placement")!=="point",Ae=Ne&&!ze&&!Ve,He=!ze&&Ve,Je=!f.layout.get("symbol-sort-key").isConstant();let st=!1;const bt=k.depthModeForSublayer(0,Un.ReadOnly),Pt=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ht=[],$t=Le.getCircleRadiusCorrection(ke);for(const jt of _){const Ut=t.getTile(jt),rn=Ut.getBucket(f);if(!rn)continue;const An=y?rn.text:rn.icon;if(!An||!An.segments.get().length||!An.hasVisibleVertices)continue;const Vt=An.programConfigurations.get(f.id),Wt=y||rn.sdfIcons,In=y?rn.textSizeData:rn.iconSizeData,Si=ze||ke.pitch!==0,On=k.useProgram(rs(Wt,y,rn),Vt),jn=l.ag(In,ke.zoom),Ei=k.style.map.terrain&&k.style.map.terrain.getTerrainData(jt);let zr,Hs,Ai,os,Xr=[0,0],Fr=null;if(y)Hs=Ut.glyphAtlasTexture,Ai=ge.LINEAR,zr=Ut.glyphAtlasTexture.size,rn.iconsInText&&(Xr=Ut.imageAtlasTexture.size,Fr=Ut.imageAtlasTexture,os=Si||k.options.rotating||k.options.zooming||In.kind==="composite"||In.kind==="camera"?ge.LINEAR:ge.NEAREST);else{const Zn=f.layout.get("icon-size").constantOr(0)!==1||rn.iconsNeedLinear;Hs=Ut.imageAtlasTexture,Ai=Wt||k.options.rotating||k.options.zooming||Zn||Si?ge.LINEAR:ge.NEAREST,zr=Ut.imageAtlasTexture.size}const Wr=Bn(Ut,1,k.transform.zoom),ho=He?jt.posMatrix:Go,tl=Ji(ho,ze,Ne,k.transform,Wr),Su=Zr(ho,ze,Ne,k.transform,Wr),nl=Zr(jt.posMatrix,ze,Ne,k.transform,Wr),Ns=Le.translatePosition(k.transform,Ut,w,R),Eu=Pt&&rn.hasTextData(),Vc=f.layout.get("icon-text-fit")!=="none"&&Eu&&rn.hasIconData();if(Ve){const Zn=k.style.map.terrain?(il,rl)=>k.style.map.terrain.getElevation(jt,il,rl):null,Ia=f.layout.get("text-rotation-alignment")==="map";ce(rn,jt.posMatrix,k,y,tl,nl,ze,q,Ia,Le,jt.toUnwrapped(),ke.width,ke.height,Ns,Zn)}const zs=jt.posMatrix,Fs=y&&Pt||Vc,Jo=Ve||Fs?Go:tl,Xs=Su,Pr=Wt&&f.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Or;Or=Wt?rn.iconsInText?hr(In.kind,jn,Ae,ze,Ve,Fs,k,zs,Jo,Xs,Ns,zr,Xr,$t):Bo(In.kind,jn,Ae,ze,Ve,Fs,k,zs,Jo,Xs,Ns,y,zr,!0,$t):Oo(In.kind,jn,Ae,ze,Ve,Fs,k,zs,Jo,Xs,Ns,y,zr,$t);const Is={program:On,buffers:An,uniformValues:Or,atlasTexture:Hs,atlasTextureIcon:Fr,atlasInterpolation:Ai,atlasInterpolationIcon:os,isSDF:Wt,hasHalo:Pr};if(Je&&rn.canOverlap){st=!0;const Zn=An.segments.get();for(const Ia of Zn)Ht.push({segments:new l.a0([Ia]),sortKey:Ia.sortKey,state:Is,terrainData:Ei})}else Ht.push({segments:An.segments,sortKey:0,state:Is,terrainData:Ei})}st&&Ht.sort((jt,Ut)=>jt.sortKey-Ut.sortKey);for(const jt of Ht){const Ut=jt.state;if(ne.activeTexture.set(ge.TEXTURE0),Ut.atlasTexture.bind(Ut.atlasInterpolation,ge.CLAMP_TO_EDGE),Ut.atlasTextureIcon&&(ne.activeTexture.set(ge.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,ge.CLAMP_TO_EDGE)),Ut.isSDF){const rn=Ut.uniformValues;Ut.hasHalo&&(rn.u_is_halo=1,Dl(Ut.buffers,jt.segments,f,k,Ut.program,bt,H,X,rn,jt.terrainData)),rn.u_is_halo=0}Dl(Ut.buffers,jt.segments,f,k,Ut.program,bt,H,X,Ut.uniformValues,jt.terrainData)}}function Dl(k,t,f,_,y,w,R,D,z,q){const H=_.context;y.draw(H,H.gl.TRIANGLES,w,R,D,ci.disabled,z,q,f.id,k.layoutVertexBuffer,k.indexBuffer,t,f.paint,_.transform.zoom,k.programConfigurations.get(f.id),k.dynamicLayoutVertexBuffer,k.opacityVertexBuffer)}function Nl(k,t,f,_){const y=k.context,w=y.gl,R=pi.disabled,D=new Di([w.ONE,w.ONE],l.aM.transparent,[!0,!0,!0,!0]),z=t.getBucket(f);if(!z)return;const q=_.key;let H=f.heatmapFbos.get(q);H||(H=Ho(y,t.tileSize,t.tileSize),f.heatmapFbos.set(q,H)),y.bindFramebuffer.set(H.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:l.aM.transparent});const X=z.programConfigurations.get(f.id),ne=k.useProgram("heatmap",X),ge=k.style.map.terrain.getTerrainData(_);ne.draw(y,w.TRIANGLES,Un.disabled,R,D,ci.disabled,cr(_.posMatrix,t,k.transform.zoom,f.paint.get("heatmap-intensity")),ge,f.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,f.paint,k.transform.zoom,X)}function ao(k,t,f){const _=k.context,y=_.gl;_.setColorMode(k.colorModeForRenderPass());const w=Xo(_,t),R=f.key,D=t.heatmapFbos.get(R);D&&(_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,D.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1),w.bind(y.LINEAR,y.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(_,y.TRIANGLES,Un.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,Fa(k,t,0,1),null,t.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments,t.paint,k.transform.zoom),D.destroy(),t.heatmapFbos.delete(R))}function Ho(k,t,f){var _,y;const w=k.gl,R=w.createTexture();w.bindTexture(w.TEXTURE_2D,R),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const D=(_=k.HALF_FLOAT)!==null&&_!==void 0?_:w.UNSIGNED_BYTE,z=(y=k.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,z,t,f,0,w.RGBA,D,null);const q=k.createFramebuffer(t,f,!1,!1);return q.colorAttachment.set(R),q}function Xo(k,t){return t.colorRampTexture||(t.colorRampTexture=new we(k,t.colorRamp,k.gl.RGBA)),t.colorRampTexture}function Wo(k,t,f,_,y){if(!f||!_||!_.imageAtlas)return;const w=_.imageAtlas.patternPositions;let R=w[f.to.toString()],D=w[f.from.toString()];if(!R&&D&&(R=D),!D&&R&&(D=R),!R||!D){const z=y.getPaintProperty(t);R=w[z],D=w[z]}R&&D&&k.setConstantPatternPositions(R,D)}function Ko(k,t,f,_,y,w,R){const D=k.context.gl,z="fill-pattern",q=f.paint.get(z),H=q&&q.constantOr(1),X=f.getCrossfadeParameters();let ne,ge,ke,Le,Ne;R?(ge=H&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=D.LINES):(ge=H?"fillPattern":"fill",ne=D.TRIANGLES);const ze=q.constantOr(null);for(const Ve of _){const Ae=t.getTile(Ve);if(H&&!Ae.patternsLoaded())continue;const He=Ae.getBucket(f);if(!He)continue;const Je=He.programConfigurations.get(f.id),st=k.useProgram(ge,Je),bt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ve);H&&(k.context.activeTexture.set(D.TEXTURE0),Ae.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Je.updatePaintBuffers(X)),Wo(Je,z,ze,Ae,f);const Pt=bt?Ve:null,Ht=k.translatePosMatrix(Pt?Pt.posMatrix:Ve.posMatrix,Ae,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){Le=He.indexBuffer2,Ne=He.segments2;const $t=[D.drawingBufferWidth,D.drawingBufferHeight];ke=ge==="fillOutlinePattern"&&H?so(Ht,k,X,Ae,$t):ki(Ht,$t)}else Le=He.indexBuffer,Ne=He.segments,ke=H?za(Ht,k,X,Ae):zo(Ht);st.draw(k.context,ne,y,k.stencilModeForClipping(Ve),w,ci.disabled,ke,bt,f.id,He.layoutVertexBuffer,Le,Ne,f.paint,k.transform.zoom,Je)}}function $o(k,t,f,_,y,w,R){const D=k.context,z=D.gl,q="fill-extrusion-pattern",H=f.paint.get(q),X=H.constantOr(1),ne=f.getCrossfadeParameters(),ge=f.paint.get("fill-extrusion-opacity"),ke=H.constantOr(null);for(const Le of _){const Ne=t.getTile(Le),ze=Ne.getBucket(f);if(!ze)continue;const Ve=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Le),Ae=ze.programConfigurations.get(f.id),He=k.useProgram(X?"fillExtrusionPattern":"fillExtrusion",Ae);X&&(k.context.activeTexture.set(z.TEXTURE0),Ne.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ae.updatePaintBuffers(ne)),Wo(Ae,q,ke,Ne,f);const Je=k.translatePosMatrix(Le.posMatrix,Ne,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),st=f.paint.get("fill-extrusion-vertical-gradient"),bt=X?da(Je,k,st,ge,Le,ne,Ne):fa(Je,k,st,ge);He.draw(D,D.gl.TRIANGLES,y,w,R,ci.backCCW,bt,Ve,f.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,f.paint,k.transform.zoom,Ae,k.style.map.terrain&&ze.centroidVertexBuffer)}}function Yo(k,t,f,_,y,w,R){const D=k.context,z=D.gl,q=f.fbo;if(!q)return;const H=k.useProgram("hillshade"),X=k.style.map.terrain&&k.style.map.terrain.getTerrainData(t);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,q.colorAttachment.get()),H.draw(D,z.TRIANGLES,y,w,R,ci.disabled,((ne,ge,ke,Le)=>{const Ne=ke.paint.get("hillshade-shadow-color"),ze=ke.paint.get("hillshade-highlight-color"),Ve=ke.paint.get("hillshade-accent-color");let Ae=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ae-=ne.transform.angle);const He=!ne.options.moving;return{u_matrix:Le?Le.posMatrix:ne.transform.calculatePosMatrix(ge.tileID.toUnwrapped(),He),u_image:0,u_latrange:Oa(0,ge.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Ae],u_shadow:Ne,u_highlight:ze,u_accent:Ve}})(k,f,_,X?t:null),X,_.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}function Eo(k,t,f,_,y,w){const R=k.context,D=R.gl,z=t.dem;if(z&&z.data){const q=z.dim,H=z.stride,X=z.getPixels();if(R.activeTexture.set(D.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||k.getTileTexture(H),t.demTexture){const ge=t.demTexture;ge.update(X,{premultiply:!1}),ge.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else t.demTexture=new we(R,X,D.RGBA,{premultiply:!1}),t.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);R.activeTexture.set(D.TEXTURE0);let ne=t.fbo;if(!ne){const ge=new we(R,{width:q,height:q,data:null},D.RGBA);ge.bind(D.LINEAR,D.CLAMP_TO_EDGE),ne=t.fbo=R.createFramebuffer(q,q,!0,!1),ne.colorAttachment.set(ge.texture)}R.bindFramebuffer.set(ne.framebuffer),R.viewport.set([0,0,q,q]),k.useProgram("hillshadePrepare").draw(R,D.TRIANGLES,_,y,w,ci.disabled,((ge,ke)=>{const Le=ke.stride,Ne=l.H();return l.aP(Ne,0,l.X,-l.X,0,0,1),l.J(Ne,Ne,[0,-l.X,0]),{u_matrix:Ne,u_image:1,u_dimension:[Le,Le],u_zoom:ge.overscaledZ,u_unpack:ke.getUnpackVector()}})(t.tileID,z),null,f.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function zl(k,t,f,_,y,w){const R=_.paint.get("raster-fade-duration");if(!w&&R>0){const D=C.now(),z=(D-k.timeAdded)/R,q=t?(D-t.timeAdded)/R:-1,H=f.getSource(),X=y.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ne=!t||Math.abs(t.tileID.overscaledZ-X)>Math.abs(k.tileID.overscaledZ-X),ge=ne&&k.refreshedUponExpiration?1:l.ac(ne?z:1-q,0,1);return k.refreshedUponExpiration&&z>=1&&(k.refreshedUponExpiration=!1),t?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}const Fl=new l.aM(1,0,0,1),$n=new l.aM(0,1,0,1),Gs=new l.aM(0,0,1,1),Sc=new l.aM(1,0,1,1),Ol=new l.aM(0,1,1,1);function fr(k,t,f,_){I(k,0,t+f/2,k.transform.width,f,_)}function xs(k,t,f,_){I(k,t-f/2,0,f,k.transform.height,_)}function I(k,t,f,_,y,w){const R=k.context,D=R.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*k.pixelRatio,f*k.pixelRatio,_*k.pixelRatio,y*k.pixelRatio),R.clear({color:w}),D.disable(D.SCISSOR_TEST)}function c(k,t,f){const _=k.context,y=_.gl,w=f.posMatrix,R=k.useProgram("debug"),D=Un.disabled,z=pi.disabled,q=k.colorModeForRenderPass(),H="$debug",X=k.style.map.terrain&&k.style.map.terrain.getTerrainData(f);_.activeTexture.set(y.TEXTURE0);const ne=t.getTileByID(f.key).latestRawTileData,ge=Math.floor((ne&&ne.byteLength||0)/1024),ke=t.getTile(f).tileSize,Le=512/Math.min(ke,512)*(f.overscaledZ/k.transform.zoom)*.5;let Ne=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ne+=` => ${f.overscaledZ}`),function(ze,Ve){ze.initDebugOverlayCanvas();const Ae=ze.debugOverlayCanvas,He=ze.context.gl,Je=ze.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Ae.width,Ae.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Ve,5,5),Je.strokeText(Ve,5,5),ze.debugOverlayTexture.update(Ae),ze.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(k,`${Ne} ${ge}kB`),R.draw(_,y.TRIANGLES,D,z,Di.alphaBlended,ci.disabled,br(w,l.aM.transparent,Le),null,H,k.debugBuffer,k.quadTriangleIndexBuffer,k.debugSegments),R.draw(_,y.LINE_STRIP,D,z,q,ci.disabled,br(w,l.aM.red),X,H,k.debugBuffer,k.tileBorderIndexBuffer,k.debugSegments)}function d(k,t,f){const _=k.context,y=_.gl,w=k.colorModeForRenderPass(),R=new Un(y.LEQUAL,Un.ReadWrite,k.depthRangeFor3D),D=k.useProgram("terrain"),z=t.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,k.width,k.height]);for(const q of f){const H=k.renderToTexture.getTexture(q),X=t.getTerrainData(q.tileID);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,H.texture);const ne=k.transform.calculatePosMatrix(q.tileID.toUnwrapped()),ge=t.getMeshFrameDelta(k.transform.zoom),ke=k.transform.calculateFogMatrix(q.tileID.toUnwrapped()),Le=Sl(ne,ge,ke,k.style.sky,k.transform.pitch);D.draw(_,y.TRIANGLES,R,pi.disabled,w,ci.backCCW,Le,X,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}class p{constructor(t,f,_){this.vertexBuffer=t,this.indexBuffer=f,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class b{constructor(t,f){this.context=new Ic(t),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=At.maxUnderzooming+At.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new No}resize(t,f,_){if(this.width=Math.floor(t*_),this.height=Math.floor(f*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const t=this.context,f=new l.aX;f.emplaceBack(0,0),f.emplaceBack(l.X,0),f.emplaceBack(0,l.X),f.emplaceBack(l.X,l.X),this.tileExtentBuffer=t.createVertexBuffer(f,ts.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const _=new l.aX;_.emplaceBack(0,0),_.emplaceBack(l.X,0),_.emplaceBack(0,l.X),_.emplaceBack(l.X,l.X),this.debugBuffer=t.createVertexBuffer(_,ts.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const y=new l.$;y.emplaceBack(0,0,0,0),y.emplaceBack(l.X,0,l.X,0),y.emplaceBack(0,l.X,0,l.X),y.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=t.createVertexBuffer(y,Jn.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const w=new l.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,ts.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const R=new l.aZ;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(R);const D=new l.aY;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const z=this.context.gl;this.stencilClearMode=new pi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const t=this.context,f=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=l.H();l.aP(_,0,this.width,this.height,0,0,1),l.K(_,_,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,f.TRIANGLES,Un.disabled,this.stencilClearMode,Di.disabled,ci.disabled,bi(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,f){if(this.currentStencilSource===t.source||!t.isTileClipped()||!f||!f.length)return;this.currentStencilSource=t.source;const _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(Di.disabled),_.setDepthMode(Un.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of f){const D=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R);w.draw(_,y.TRIANGLES,Un.disabled,new pi({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),Di.disabled,ci.disabled,bi(R.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,f=this.context.gl;return new pi({func:f.NOTEQUAL,mask:255},t,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(t){const f=this.context.gl;return new pi({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(t){const f=this.context.gl,_=t.sort((R,D)=>D.overscaledZ-R.overscaledZ),y=_[_.length-1].overscaledZ,w=_[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const R={};for(let D=0;D<w;D++)R[D+y]=new pi({func:f.GEQUAL,mask:255},D+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=w,[R,_]}return[{[y]:pi.disabled},_]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Di([t.CONSTANT_COLOR,t.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Di.unblended:Di.alphaBlended}depthModeForSublayer(t,f,_){if(!this.opaquePassEnabledForLayer())return Un.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Un(_||this.context.gl.LEQUAL,f,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,f){this.style=t,this.options=f,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(C.now()),this.imageManager.beginFrame();const _=this.style._order,y=this.style.sourceCaches,w={},R={},D={};for(const z in y){const q=y[z];q.used&&q.prepare(this.context),w[z]=q.getVisibleCoordinates(),R[z]=w[z].slice().reverse(),D[z]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of _){const q=this.style._layers[z];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const H=R[q.source];(q.type==="custom"||H.length)&&this.renderLayer(this,y[q.source],q,H)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,q){const H=z.context,X=H.gl,ne=((ze,Ve,Ae)=>({u_sky_color:ze.properties.get("sky-color"),u_horizon_color:ze.properties.get("horizon-color"),u_horizon:(Ve.height/2+Ve.getHorizon())*Ae,u_sky_horizon_blend:ze.properties.get("sky-horizon-blend")*Ve.height/2*Ae}))(q,z.style.map.transform,z.pixelRatio),ge=new Un(X.LEQUAL,Un.ReadWrite,[0,1]),ke=pi.disabled,Le=z.colorModeForRenderPass(),Ne=z.useProgram("sky");if(!q.mesh){const ze=new l.aX;ze.emplaceBack(-1,-1),ze.emplaceBack(1,-1),ze.emplaceBack(1,1),ze.emplaceBack(-1,1);const Ve=new l.aY;Ve.emplaceBack(0,1,2),Ve.emplaceBack(0,2,3),q.mesh=new p(H.createVertexBuffer(ze,ts.members),H.createIndexBuffer(Ve),l.a0.simpleSegment(0,0,ze.length,Ve.length))}Ne.draw(H,X.TRIANGLES,ge,ke,Le,ci.disabled,ne,void 0,"sky",q.mesh.vertexBuffer,q.mesh.indexBuffer,q.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],q=y[z.source],H=w[z.source];this._renderTileClippingMasks(z,H),this.renderLayer(this,q,z,H)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],q=y[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z))continue;const H=(z.type==="symbol"?D:R)[z.source];this._renderTileClippingMasks(z,w[z.source]),this.renderLayer(this,q,z,H)}if(this.options.showTileBoundaries){const z=function(q,H){let X=null;const ne=Object.values(q._layers).flatMap(Ne=>Ne.source&&!Ne.isHidden(H)?[q.sourceCaches[Ne.source]]:[]),ge=ne.filter(Ne=>Ne.getSource().type==="vector"),ke=ne.filter(Ne=>Ne.getSource().type!=="vector"),Le=Ne=>{(!X||X.getSource().maxzoom<Ne.getSource().maxzoom)&&(X=Ne)};return ge.forEach(Ne=>Le(Ne)),X||ke.forEach(Ne=>Le(Ne)),X}(this.style,this.transform.zoom);z&&function(q,H,X){for(let ne=0;ne<X.length;ne++)c(q,H,X[ne])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const q=z.transform.padding;fr(z,z.transform.height-(q.top||0),3,Fl),fr(z,q.bottom||0,3,$n),xs(z,q.left||0,3,Gs),xs(z,z.transform.width-(q.right||0),3,Sc);const H=z.transform.centerPoint;(function(X,ne,ge,ke){I(X,ne-1,ge-10,2,20,ke),I(X,ne-10,ge-1,20,2,ke)})(z,H.x,z.transform.height-H.y,Ol)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=t?!l.a_(f,_):!l.a$(f,_)),y||(y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),y&&(l.b0(f,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,R){const D=w.context,z=D.gl,q=Di.unblended,H=new Un(z.LEQUAL,Un.ReadWrite,[0,1]),X=R.getTerrainMesh(),ne=R.sourceCache.getRenderableTiles(),ge=w.useProgram("terrainDepth");D.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1});for(const ke of ne){const Le=R.getTerrainData(ke.tileID),Ne={u_matrix:w.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(w.transform.zoom)};ge.draw(D,z.TRIANGLES,H,pi.disabled,q,ci.backCCW,Ne,Le,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,R){const D=w.context,z=D.gl,q=Di.unblended,H=new Un(z.LEQUAL,Un.ReadWrite,[0,1]),X=R.getTerrainMesh(),ne=R.getCoordsTexture(),ge=R.sourceCache.getRenderableTiles(),ke=w.useProgram("terrainCoords");D.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1}),R.coordsIndex=[];for(const Le of ge){const Ne=R.getTerrainData(Le.tileID);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ne.texture);const ze={u_matrix:w.transform.calculatePosMatrix(Le.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(w.transform.zoom)};ke.draw(D,z.TRIANGLES,H,pi.disabled,q,ci.backCCW,ze,Ne,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),R.coordsIndex.push(Le.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(t,f,_,y){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(y||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(w,R,D,z,q){if(w.renderPass!=="translucent")return;const H=pi.disabled,X=w.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,ge,ke,Le,Ne,ze,Ve,Ae,He){const Je=ge.transform,st=Qr(),bt=Ne==="map",Pt=ze==="map";for(const Ht of ne){const $t=Le.getTile(Ht),jt=$t.getBucket(ke);if(!jt||!jt.text||!jt.text.segments.get().length)continue;const Ut=l.ag(jt.textSizeData,Je.zoom),rn=Bn($t,1,ge.transform.zoom),An=Ji(Ht.posMatrix,Pt,bt,ge.transform,rn),Vt=ke.layout.get("icon-text-fit")!=="none"&&jt.hasIconData();if(Ut){const Wt=Math.pow(2,Je.zoom-$t.tileID.overscaledZ),In=ge.style.map.terrain?(On,jn)=>ge.style.map.terrain.getElevation(Ht,On,jn):null,Si=st.translatePosition(Je,$t,Ve,Ae);Zo(jt,bt,Pt,He,Je,An,Ht.posMatrix,Wt,Ut,Vt,st,Si,Ht.toUnwrapped(),In)}}}(z,w,D,R,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),q),D.paint.get("icon-opacity").constantOr(1)!==0&&Pl(w,R,D,z,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),H,X),D.paint.get("text-opacity").constantOr(1)!==0&&Pl(w,R,D,z,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),H,X),R.map.showCollisionBoxes&&(ba(w,R,D,z,!0),ba(w,R,D,z,!1))})(t,f,_,y,this.style.placement.variableOffsets);break;case"circle":(function(w,R,D,z){if(w.renderPass!=="translucent")return;const q=D.paint.get("circle-opacity"),H=D.paint.get("circle-stroke-width"),X=D.paint.get("circle-stroke-opacity"),ne=!D.layout.get("circle-sort-key").isConstant();if(q.constantOr(1)===0&&(H.constantOr(1)===0||X.constantOr(1)===0))return;const ge=w.context,ke=ge.gl,Le=w.depthModeForSublayer(0,Un.ReadOnly),Ne=pi.disabled,ze=w.colorModeForRenderPass(),Ve=[];for(let Ae=0;Ae<z.length;Ae++){const He=z[Ae],Je=R.getTile(He),st=Je.getBucket(D);if(!st)continue;const bt=st.programConfigurations.get(D.id),Pt=w.useProgram("circle",bt),Ht=st.layoutVertexBuffer,$t=st.indexBuffer,jt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(He),Ut={programConfiguration:bt,program:Pt,layoutVertexBuffer:Ht,indexBuffer:$t,uniformValues:vc(w,He,Je,D),terrainData:jt};if(ne){const rn=st.segments.get();for(const An of rn)Ve.push({segments:new l.a0([An]),sortKey:An.sortKey,state:Ut})}else Ve.push({segments:st.segments,sortKey:0,state:Ut})}ne&&Ve.sort((Ae,He)=>Ae.sortKey-He.sortKey);for(const Ae of Ve){const{programConfiguration:He,program:Je,layoutVertexBuffer:st,indexBuffer:bt,uniformValues:Pt,terrainData:Ht}=Ae.state;Je.draw(ge,ke.TRIANGLES,Le,Ne,ze,ci.disabled,Pt,Ht,D.id,st,bt,Ae.segments,D.paint,w.transform.zoom,He)}})(t,f,_,y);break;case"heatmap":(function(w,R,D,z){if(D.paint.get("heatmap-opacity")===0)return;const q=w.context;if(w.style.map.terrain){for(const H of z){const X=R.getTile(H);R.hasRenderableParent(H)||(w.renderPass==="offscreen"?Nl(w,X,D,H):w.renderPass==="translucent"&&ao(w,D,H))}q.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(H,X,ne,ge){const ke=H.context,Le=ke.gl,Ne=pi.disabled,ze=new Di([Le.ONE,Le.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(Ve,Ae,He){const Je=Ve.gl;Ve.activeTexture.set(Je.TEXTURE1),Ve.viewport.set([0,0,Ae.width/4,Ae.height/4]);let st=He.heatmapFbos.get(l.aU);st?(Je.bindTexture(Je.TEXTURE_2D,st.colorAttachment.get()),Ve.bindFramebuffer.set(st.framebuffer)):(st=Ho(Ve,Ae.width/4,Ae.height/4),He.heatmapFbos.set(l.aU,st))})(ke,H,ne),ke.clear({color:l.aM.transparent});for(let Ve=0;Ve<ge.length;Ve++){const Ae=ge[Ve];if(X.hasRenderableParent(Ae))continue;const He=X.getTile(Ae),Je=He.getBucket(ne);if(!Je)continue;const st=Je.programConfigurations.get(ne.id),bt=H.useProgram("heatmap",st),{zoom:Pt}=H.transform;bt.draw(ke,Le.TRIANGLES,Un.disabled,Ne,ze,ci.disabled,cr(Ae.posMatrix,He,Pt,ne.paint.get("heatmap-intensity")),null,ne.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,ne.paint,H.transform.zoom,st)}ke.viewport.set([0,0,H.width,H.height])}(w,R,D,z):w.renderPass==="translucent"&&function(H,X){const ne=H.context,ge=ne.gl;ne.setColorMode(H.colorModeForRenderPass());const ke=X.heatmapFbos.get(l.aU);ke&&(ne.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,ke.colorAttachment.get()),ne.activeTexture.set(ge.TEXTURE1),Xo(ne,X).bind(ge.LINEAR,ge.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(ne,ge.TRIANGLES,Un.disabled,pi.disabled,H.colorModeForRenderPass(),ci.disabled,Fa(H,X,0,1),null,X.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,X.paint,H.transform.zoom))}(w,D)})(t,f,_,y);break;case"line":(function(w,R,D,z){if(w.renderPass!=="translucent")return;const q=D.paint.get("line-opacity"),H=D.paint.get("line-width");if(q.constantOr(1)===0||H.constantOr(1)===0)return;const X=w.depthModeForSublayer(0,Un.ReadOnly),ne=w.colorModeForRenderPass(),ge=D.paint.get("line-dasharray"),ke=D.paint.get("line-pattern"),Le=ke.constantOr(1),Ne=D.paint.get("line-gradient"),ze=D.getCrossfadeParameters(),Ve=Le?"linePattern":ge?"lineSDF":Ne?"lineGradient":"line",Ae=w.context,He=Ae.gl;let Je=!0;for(const st of z){const bt=R.getTile(st);if(Le&&!bt.patternsLoaded())continue;const Pt=bt.getBucket(D);if(!Pt)continue;const Ht=Pt.programConfigurations.get(D.id),$t=w.context.program.get(),jt=w.useProgram(Ve,Ht),Ut=Je||jt.program!==$t,rn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(st),An=ke.constantOr(null);if(An&&bt.imageAtlas){const In=bt.imageAtlas,Si=In.patternPositions[An.to.toString()],On=In.patternPositions[An.from.toString()];Si&&On&&Ht.setConstantPatternPositions(Si,On)}const Vt=rn?st:null,Wt=Le?Fo(w,bt,D,ze,Vt):ge?au(w,bt,D,ge,ze,Vt):Ne?ma(w,bt,D,Pt.lineClipsArray.length,Vt):pa(w,bt,D,Vt);if(Le)Ae.activeTexture.set(He.TEXTURE0),bt.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),Ht.updatePaintBuffers(ze);else if(ge&&(Ut||w.lineAtlas.dirty))Ae.activeTexture.set(He.TEXTURE0),w.lineAtlas.bind(Ae);else if(Ne){const In=Pt.gradients[D.id];let Si=In.texture;if(D.gradientVersion!==In.version){let On=256;if(D.stepInterpolant){const jn=R.getSource().maxzoom,Ei=st.canonical.z===jn?Math.ceil(1<<w.transform.maxZoom-st.canonical.z):1;On=l.ac(l.aV(Pt.maxLineLength/l.X*1024*Ei),256,Ae.maxTextureSize)}In.gradient=l.aW({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:On,image:In.gradient||void 0,clips:Pt.lineClipsArray}),In.texture?In.texture.update(In.gradient):In.texture=new we(Ae,In.gradient,He.RGBA),In.version=D.gradientVersion,Si=In.texture}Ae.activeTexture.set(He.TEXTURE0),Si.bind(D.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}jt.draw(Ae,He.TRIANGLES,X,w.stencilModeForClipping(st),ne,ci.disabled,Wt,rn,D.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,D.paint,w.transform.zoom,Ht,Pt.layoutVertexBuffer2),Je=!1}})(t,f,_,y);break;case"fill":(function(w,R,D,z){const q=D.paint.get("fill-color"),H=D.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const X=w.colorModeForRenderPass(),ne=D.paint.get("fill-pattern"),ge=w.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&q.constantOr(l.aM.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===ge){const ke=w.depthModeForSublayer(1,w.renderPass==="opaque"?Un.ReadWrite:Un.ReadOnly);Ko(w,R,D,z,ke,X,!1)}if(w.renderPass==="translucent"&&D.paint.get("fill-antialias")){const ke=w.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,Un.ReadOnly);Ko(w,R,D,z,ke,X,!0)}})(t,f,_,y);break;case"fill-extrusion":(function(w,R,D,z){const q=D.paint.get("fill-extrusion-opacity");if(q!==0&&w.renderPass==="translucent"){const H=new Un(w.context.gl.LEQUAL,Un.ReadWrite,w.depthRangeFor3D);if(q!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))$o(w,R,D,z,H,pi.disabled,Di.disabled),$o(w,R,D,z,H,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const X=w.colorModeForRenderPass();$o(w,R,D,z,H,pi.disabled,X)}}})(t,f,_,y);break;case"hillshade":(function(w,R,D,z){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const q=w.context,H=w.depthModeForSublayer(0,Un.ReadOnly),X=w.colorModeForRenderPass(),[ne,ge]=w.renderPass==="translucent"?w.stencilConfigForOverlap(z):[{},z];for(const ke of ge){const Le=R.getTile(ke);Le.needsHillshadePrepare!==void 0&&Le.needsHillshadePrepare&&w.renderPass==="offscreen"?Eo(w,Le,D,H,pi.disabled,X):w.renderPass==="translucent"&&Yo(w,ke,Le,D,H,ne[ke.overscaledZ],X)}q.viewport.set([0,0,w.width,w.height])})(t,f,_,y);break;case"raster":(function(w,R,D,z){if(w.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!z.length)return;const q=w.context,H=q.gl,X=R.getSource(),ne=w.useProgram("raster"),ge=w.colorModeForRenderPass(),[ke,Le]=X instanceof $i?[{},z]:w.stencilConfigForOverlap(z),Ne=Le[Le.length-1].overscaledZ,ze=!w.options.moving;for(const Ve of Le){const Ae=w.depthModeForSublayer(Ve.overscaledZ-Ne,D.paint.get("raster-opacity")===1?Un.ReadWrite:Un.ReadOnly,H.LESS),He=R.getTile(Ve);He.registerFadeDuration(D.paint.get("raster-fade-duration"));const Je=R.findLoadedParent(Ve,0),st=R.findLoadedSibling(Ve),bt=zl(He,Je||st||null,R,D,w.transform,w.style.map.terrain);let Pt,Ht;const $t=D.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;q.activeTexture.set(H.TEXTURE0),He.texture.bind($t,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(H.TEXTURE1),Je?(Je.texture.bind($t,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Pt=Math.pow(2,Je.tileID.overscaledZ-He.tileID.overscaledZ),Ht=[He.tileID.canonical.x*Pt%1,He.tileID.canonical.y*Pt%1]):He.texture.bind($t,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),He.texture.useMipmap&&q.extTextureFilterAnisotropic&&w.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const jt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),Ut=jt?Ve:null,rn=Ut?Ut.posMatrix:w.transform.calculatePosMatrix(Ve.toUnwrapped(),ze),An=El(rn,Ht||[0,0],Pt||1,bt,D);X instanceof $i?ne.draw(q,H.TRIANGLES,Ae,pi.disabled,ge,ci.disabled,An,jt,D.id,X.boundsBuffer,w.quadTriangleIndexBuffer,X.boundsSegments):ne.draw(q,H.TRIANGLES,Ae,ke[Ve.overscaledZ],ge,ci.disabled,An,jt,D.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(t,f,_,y);break;case"background":(function(w,R,D,z){const q=D.paint.get("background-color"),H=D.paint.get("background-opacity");if(H===0)return;const X=w.context,ne=X.gl,ge=w.transform,ke=ge.tileSize,Le=D.paint.get("background-pattern");if(w.isPatternMissing(Le))return;const Ne=!Le&&q.a===1&&H===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Ne)return;const ze=pi.disabled,Ve=w.depthModeForSublayer(0,Ne==="opaque"?Un.ReadWrite:Un.ReadOnly),Ae=w.colorModeForRenderPass(),He=w.useProgram(Le?"backgroundPattern":"background"),Je=z||ge.coveringTiles({tileSize:ke,terrain:w.style.map.terrain});Le&&(X.activeTexture.set(ne.TEXTURE0),w.imageManager.bind(w.context));const st=D.getCrossfadeParameters();for(const bt of Je){const Pt=z?bt.posMatrix:w.transform.calculatePosMatrix(bt.toUnwrapped()),Ht=Le?_a(Pt,H,w,Le,{tileID:bt,tileSize:ke},st):ga(Pt,H,q),$t=w.style.map.terrain&&w.style.map.terrain.getTerrainData(bt);He.draw(X,ne.TRIANGLES,Ve,ze,Ae,ci.disabled,Ht,$t,D.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(t,0,_,y);break;case"custom":(function(w,R,D){const z=w.context,q=D.implementation;if(w.renderPass==="offscreen"){const H=q.prerender;H&&(w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),H.call(q,z.gl,w.transform.customLayerMatrix()),z.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),z.setStencilMode(pi.disabled);const H=q.renderingMode==="3d"?new Un(w.context.gl.LEQUAL,Un.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,Un.ReadOnly);z.setDepthMode(H),q.render(z.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),z.setDirty(),w.setBaseState(),z.bindFramebuffer.set(null)}})(t,0,_)}}translatePosMatrix(t,f,_,y,w){if(!_[0]&&!_[1])return t;const R=w?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(R){const q=Math.sin(R),H=Math.cos(R);_=[_[0]*H-_[1]*q,_[0]*q+_[1]*H]}const D=[w?_[0]:Bn(f,_[0],this.transform.zoom),w?_[1]:Bn(f,_[1],this.transform.zoom),0],z=new Float32Array(16);return l.J(z,t,D),z}saveTileTexture(t){const f=this._tileTextures[t.size[0]];f?f.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const f=this._tileTextures[t];return f&&f.length>0?f.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const f=this.imageManager.getPattern(t.from.toString()),_=this.imageManager.getPattern(t.to.toString());return!f||!_}useProgram(t,f){this.cache=this.cache||{};const _=t+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new wo(this.context,ro[t],f,Ba[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:f}=this.context.gl;return this.width!==t||this.height!==f}}class L{constructor(t,f){this.points=t,this.planes=f}static fromInvProjectionMatrix(t,f,_){const y=Math.pow(2,_),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const z=1/(D=l.af([],D,t))[3]/f*y;return l.b1(D,D,[z,z,1/D[3],z])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const z=function(ne,ge){var ke=ge[0],Le=ge[1],Ne=ge[2],ze=ke*ke+Le*Le+Ne*Ne;return ze>0&&(ze=1/Math.sqrt(ze)),ne[0]=ge[0]*ze,ne[1]=ge[1]*ze,ne[2]=ge[2]*ze,ne}([],function(ne,ge,ke){var Le=ge[0],Ne=ge[1],ze=ge[2],Ve=ke[0],Ae=ke[1],He=ke[2];return ne[0]=Ne*He-ze*Ae,ne[1]=ze*Ve-Le*He,ne[2]=Le*Ae-Ne*Ve,ne}([],he([],w[D[0]],w[D[1]]),he([],w[D[2]],w[D[1]]))),q=-((H=z)[0]*(X=w[D[1]])[0]+H[1]*X[1]+H[2]*X[2]);var H,X;return z.concat(q)});return new L(w,R)}}class O{constructor(t,f){this.min=t,this.max=f,this.center=function(_,y,w){return _[0]=.5*y[0],_[1]=.5*y[1],_[2]=.5*y[2],_}([],function(_,y,w){return _[0]=y[0]+w[0],_[1]=y[1]+w[1],_[2]=y[2]+w[2],_}([],this.min,this.max))}quadrant(t){const f=[t%2==0,t<2],_=ve(this.min),y=ve(this.max);for(let w=0;w<f.length;w++)_[w]=f[w]?this.min[w]:this.center[w],y[w]=f[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new O(_,y)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let y=0;y<t.planes.length;y++){const w=t.planes[y];let R=0;for(let D=0;D<f.length;D++)l.b2(w,f[D])>=0&&R++;if(R===0)return 0;R!==f.length&&(_=!1)}if(_)return 2;for(let y=0;y<3;y++){let w=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let D=0;D<t.points.length;D++){const z=t.points[D][y]-this.min[y];w=Math.min(w,z),R=Math.max(R,z)}if(R<0||w>this.max[y]-this.min[y])return 0}return 1}}class V{constructor(t=0,f=0,_=0,y=0){if(isNaN(t)||t<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=f,this.left=_,this.right=y}interpolate(t,f,_){return f.top!=null&&t.top!=null&&(this.top=l.y.number(t.top,f.top,_)),f.bottom!=null&&t.bottom!=null&&(this.bottom=l.y.number(t.bottom,f.bottom,_)),f.left!=null&&t.left!=null&&(this.left=l.y.number(t.left,f.left,_)),f.right!=null&&t.right!=null&&(this.right=l.y.number(t.right,f.right,_)),this}getCenter(t,f){const _=l.ac((this.left+t-this.right)/2,0,t),y=l.ac((this.top+f-this.bottom)/2,0,f);return new l.P(_,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new V(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const $=85.051129;class me{constructor(t,f,_,y,w){this.tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=t||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new V,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new me(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const f=-l.b3(t,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var _=new l.A(4);return l.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,y,w){var R=y[0],D=y[1],z=y[2],q=y[3],H=Math.sin(w),X=Math.cos(w);_[0]=R*X+z*H,_[1]=D*X+q*H,_[2]=R*-H+z*X,_[3]=D*-H+q*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const f=l.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const f=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,f,_){this._unmodified=!1,this._edgeInsets.interpolate(t,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const f=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(t){const f=[new l.b4(0,t)];if(this._renderWorldCopies){const _=this.pointCoordinate(new l.P(0,0)),y=this.pointCoordinate(new l.P(this.width,0)),w=this.pointCoordinate(new l.P(this.width,this.height)),R=this.pointCoordinate(new l.P(0,this.height)),D=Math.floor(Math.min(_.x,y.x,w.x,R.x)),z=Math.floor(Math.max(_.x,y.x,w.x,R.x)),q=1;for(let H=D-q;H<=z+q;H++)H!==0&&f.push(new l.b4(H,t))}return f}coveringTiles(t){var f,_;let y=this.coveringZoomLevel(t);const w=y;if(t.minzoom!==void 0&&y<t.minzoom)return[];t.maxzoom!==void 0&&y>t.maxzoom&&(y=t.maxzoom);const R=this.pointCoordinate(this.getCameraPoint()),D=l.Z.fromLngLat(this.center),z=Math.pow(2,y),q=[z*R.x,z*R.y,0],H=[z*D.x,z*D.y,0],X=L.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,y);let ne=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=y);const ge=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,ke=Ae=>({aabb:new O([Ae*z,0,0],[(Ae+1)*z,z,0]),zoom:0,x:0,y:0,wrap:Ae,fullyVisible:!1}),Le=[],Ne=[],ze=y,Ve=t.reparseOverscaled?w:y;if(this._renderWorldCopies)for(let Ae=1;Ae<=3;Ae++)Le.push(ke(-Ae)),Le.push(ke(Ae));for(Le.push(ke(0));Le.length>0;){const Ae=Le.pop(),He=Ae.x,Je=Ae.y;let st=Ae.fullyVisible;if(!st){const jt=Ae.aabb.intersects(X);if(jt===0)continue;st=jt===2}const bt=t.terrain?q:H,Pt=Ae.aabb.distanceX(bt),Ht=Ae.aabb.distanceY(bt),$t=Math.max(Math.abs(Pt),Math.abs(Ht));if(Ae.zoom===ze||$t>ge+(1<<ze-Ae.zoom)-2&&Ae.zoom>=ne){const jt=ze-Ae.zoom,Ut=q[0]-.5-(He<<jt),rn=q[1]-.5-(Je<<jt);Ne.push({tileID:new l.S(Ae.zoom===ze?Ve:Ae.zoom,Ae.wrap,Ae.zoom,He,Je),distanceSq:xe([H[0]-.5-He,H[1]-.5-Je]),tileDistanceToCamera:Math.sqrt(Ut*Ut+rn*rn)})}else for(let jt=0;jt<4;jt++){const Ut=(He<<1)+jt%2,rn=(Je<<1)+(jt>>1),An=Ae.zoom+1;let Vt=Ae.aabb.quadrant(jt);if(t.terrain){const Wt=new l.S(An,Ae.wrap,An,Ut,rn),In=t.terrain.getMinMaxElevation(Wt),Si=(f=In.minElevation)!==null&&f!==void 0?f:this.elevation,On=(_=In.maxElevation)!==null&&_!==void 0?_:this.elevation;Vt=new O([Vt.min[0],Vt.min[1],Si],[Vt.max[0],Vt.max[1],On])}Le.push({aabb:Vt,zoom:An,x:Ut,y:rn,wrap:Ae.wrap,fullyVisible:st})}}return Ne.sort((Ae,He)=>Ae.distanceSq-He.distanceSq).map(Ae=>Ae.tileID)}resize(t,f){this.width=t,this.height=f,this.pixelsToGLUnits=[2/t,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const f=l.ac(t.lat,-85.051129,$);return new l.P(l.O(t.lng)*this.worldSize,l.Q(f)*this.worldSize)}unproject(t){return new l.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const f=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,y=this.pointLocation(this.centerPoint,t),w=t.getElevationForLngLatZoom(y,this.tileZoom);if(!(this.elevation-w))return;const R=_+f-w,D=Math.cos(this._pitch)*this.cameraToCenterDistance/R/l.b5(1,y.lat),z=this.scaleZoom(D/this.tileSize);this._elevation=w,this._center=y,this.zoom=z}setLocationAtPoint(t,f){const _=this.pointCoordinate(f),y=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(t),R=new l.Z(w.x-(_.x-y.x),w.y-(_.y-y.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,f){return f?this.coordinatePoint(this.locationCoordinate(t),f.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,f){return this.coordinateLocation(this.pointCoordinate(t,f))}locationCoordinate(t){return l.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,f){if(f){const ne=f.pointCoordinate(t);if(ne!=null)return ne}const _=[t.x,t.y,0,1],y=[t.x,t.y,1,1];l.af(_,_,this.pixelMatrixInverse),l.af(y,y,this.pixelMatrixInverse);const w=_[3],R=y[3],D=_[1]/w,z=y[1]/R,q=_[2]/w,H=y[2]/R,X=q===H?0:(0-q)/(H-q);return new l.Z(l.y.number(_[0]/w,y[0]/R,X)/this.worldSize,l.y.number(D,z,X)/this.worldSize)}coordinatePoint(t,f=0,_=this.pixelMatrix){const y=[t.x*this.worldSize,t.y*this.worldSize,f,1];return l.af(y,y,_),new l.P(y[0]/y[3],y[1]/y[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new $e().extend(this.pointLocation(new l.P(0,t))).extend(this.pointLocation(new l.P(this.width,t))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new $e([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,$])}calculateTileMatrix(t){const f=t.canonical,_=this.worldSize/this.zoomScale(f.z),y=f.x+Math.pow(2,f.z)*t.wrap,w=l.an(new Float64Array(16));return l.J(w,w,[y*_,f.y*_,0]),l.K(w,w,[_/l.X,_/l.X,1]),w}calculatePosMatrix(t,f=!1){const _=t.key,y=f?this._alignedPosMatrixCache:this._posMatrixCache;if(y[_])return y[_];const w=this.calculateTileMatrix(t);return l.L(w,f?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,w),y[_]=new Float32Array(w),y[_]}calculateFogMatrix(t){const f=t.key,_=this._fogMatrixCache;if(_[f])return _[f];const y=this.calculateTileMatrix(t);return l.L(y,this.fogMatrix,y),_[f]=new Float32Array(y),_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,f){f=l.ac(+f,this.minZoom,this.maxZoom);const _={center:new l.N(t.lng,t.lat),zoom:f};let y=this.lngRange;if(!this._renderWorldCopies&&y===null){const Ae=179.9999999999;y=[-Ae,Ae]}const w=this.tileSize*this.zoomScale(_.zoom);let R=0,D=w,z=0,q=w,H=0,X=0;const{x:ne,y:ge}=this.size;if(this.latRange){const Ae=this.latRange;R=l.Q(Ae[1])*w,D=l.Q(Ae[0])*w,D-R<ge&&(H=ge/(D-R))}y&&(z=l.b3(l.O(y[0])*w,0,w),q=l.b3(l.O(y[1])*w,0,w),q<z&&(q+=w),q-z<ne&&(X=ne/(q-z)));const{x:ke,y:Le}=this.project.call({worldSize:w},t);let Ne,ze;const Ve=Math.max(X||0,H||0);if(Ve){const Ae=new l.P(X?(q+z)/2:ke,H?(D+R)/2:Le);return _.center=this.unproject.call({worldSize:w},Ae).wrap(),_.zoom+=this.scaleZoom(Ve),_}if(this.latRange){const Ae=ge/2;Le-Ae<R&&(ze=R+Ae),Le+Ae>D&&(ze=D-Ae)}if(y){const Ae=(z+q)/2;let He=ke;this._renderWorldCopies&&(He=l.b3(ke,Ae-w/2,Ae+w/2));const Je=ne/2;He-Je<z&&(Ne=z+Je),He+Je>q&&(Ne=q-Je)}if(Ne!==void 0||ze!==void 0){const Ae=new l.P(Ne??ke,ze??Le);_.center=this.unproject.call({worldSize:w},Ae).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:f,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=_,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,f=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let y=l.an(new Float64Array(16));l.K(y,y,[this.width/2,-this.height/2,1]),l.J(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=l.an(new Float64Array(16)),l.K(y,y,[1,-1,1]),l.J(y,y,[-1,-1,0]),l.K(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),R=Math.min(this.elevation,this.minElevationForCurrentTile),D=w-R*this._pixelPerMeter/Math.cos(this._pitch),z=R<0?D:w,q=Math.PI/2+this._pitch,H=this._fov*(.5+t.y/this.height),X=Math.sin(H)*z/Math.sin(l.ac(Math.PI-q-H,.01,Math.PI-.01)),ne=this.getHorizon(),ge=2*Math.atan(ne/this.cameraToCenterDistance)*(.5+t.y/(2*ne)),ke=Math.sin(ge)*z/Math.sin(l.ac(Math.PI-q-ge,.01,Math.PI-.01)),Le=Math.min(X,ke);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Le+z),this.nearZ=this.height/50,y=new Float64Array(16),l.b6(y,this._fov,this.width/this.height,this.nearZ,this.farZ),y[8]=2*-t.x/this.width,y[9]=2*t.y/this.height,this.projectionMatrix=l.ae(y),l.K(y,y,[1,-1,1]),l.J(y,y,[0,0,-this.cameraToCenterDistance]),l.b7(y,y,this._pitch),l.ad(y,y,this.angle),l.J(y,y,[-f,-_,0]),this.mercatorMatrix=l.K([],y,[this.worldSize,this.worldSize,this.worldSize]),l.K(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,y),l.J(y,y,[0,0,-this.elevation]),this.modelViewProjectionMatrix=y,this.invModelViewProjectionMatrix=l.as([],y),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,w,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-f,-_,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,y);const Ne=this.width%2/2,ze=this.height%2/2,Ve=Math.cos(this.angle),Ae=Math.sin(this.angle),He=f-Math.round(f)+Ve*Ne+Ae*ze,Je=_-Math.round(_)+Ve*ze+Ae*Ne,st=new Float64Array(y);if(l.J(st,st,[He>.5?He-1:He,Je>.5?Je-1:Je,0]),this.alignedModelViewProjectionMatrix=st,y=l.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.P(0,0)),f=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,t))}getCameraQueryGeometry(t){const f=this.getCameraPoint();if(t.length===1)return[t[0],f];{let _=f.x,y=f.y,w=f.x,R=f.y;for(const D of t)_=Math.min(_,D.x),y=Math.min(y,D.y),w=Math.max(w,D.x),R=Math.max(R,D.y);return[new l.P(_,y),new l.P(w,y),new l.P(w,R),new l.P(_,R),new l.P(_,y)]}}lngLatToCameraDepth(t,f){const _=this.locationCoordinate(t),y=[_.x*this.worldSize,_.y*this.worldSize,f,1];return l.af(y,y,this.modelViewProjectionMatrix),y[2]/y[3]}}function Be(k,t){let f,_=!1,y=null,w=null;const R=()=>{y=null,_&&(k.apply(w,f),y=setTimeout(R,t),_=!1)};return(...D)=>(_=!0,w=this,f=D,y||R(),y)}class Ke{constructor(t){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let _;return f.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(_=y)}),(_&&_[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const _=f.join("/");let y=_;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${_}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let R=window.location.href.replace(/(#.+)?$/,w);R=R.replace("&&","&"),window.history.replaceState(window.history.state,null,R)},this._updateHash=Be(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const f=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),R=Math.round(f.lng*w)/w,D=Math.round(f.lat*w)/w,z=this._map.getBearing(),q=this._map.getPitch();let H="";if(H+=t?`/${R}/${D}/${_}`:`${_}/${D}/${R}`,(z||q)&&(H+="/"+Math.round(10*z)/10),q&&(H+=`/${Math.round(q)}`),this._hashName){const X=this._hashName;let ne=!1;const ge=window.location.hash.slice(1).split("&").map(ke=>{const Le=ke.split("=")[0];return Le===X?(ne=!0,`${Le}=${H}`):ke}).filter(ke=>ke);return ne||ge.push(`${X}=${H}`),`#${ge.join("&")}`}return`#${H}`}}const mt={linearity:.3,easing:l.b8(0,0,.3,1)},zt=l.e({deceleration:2500,maxSpeed:1400},mt),Nt=l.e({deceleration:20,maxSpeed:1400},mt),gn=l.e({deceleration:1e3,maxSpeed:360},mt),bn=l.e({deceleration:1e3,maxSpeed:90},mt);class Rn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:C.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,f=C.now();for(;t.length>0&&f-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)f.zoom+=w.zoomDelta||0,f.bearing+=w.bearingDelta||0,f.pitch+=w.pitchDelta||0,w.panDelta&&f.pan._add(w.panDelta),w.around&&(f.around=w.around),w.pinchAround&&(f.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(f.pan.mag()){const w=mi(f.pan.mag(),_,l.e({},zt,t||{}));y.offset=f.pan.mult(w.amount/f.pan.mag()),y.center=this._map.transform.center,ti(y,w)}if(f.zoom){const w=mi(f.zoom,_,Nt);y.zoom=this._map.transform.zoom+w.amount,ti(y,w)}if(f.bearing){const w=mi(f.bearing,_,gn);y.bearing=this._map.transform.bearing+l.ac(w.amount,-179,179),ti(y,w)}if(f.pitch){const w=mi(f.pitch,_,bn);y.pitch=this._map.transform.pitch+w.amount,ti(y,w)}if(y.zoom||y.bearing){const w=f.pinchAround===void 0?f.around:f.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),l.e(y,{noMoveStart:!0})}}function ti(k,t){(!k.duration||k.duration<t.duration)&&(k.duration=t.duration,k.easing=t.easing)}function mi(k,t,f){const{maxSpeed:_,linearity:y,deceleration:w}=f,R=l.ac(k*y/(t/1e3),-_,_),D=Math.abs(R)/(w*y);return{easing:f.easing,duration:1e3*D,amount:R*(D/2)}}class li extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,f,_,y={}){const w=N.mousePos(f.getCanvas(),_),R=f.unproject(w);super(t,l.e({point:w,lngLat:R,originalEvent:_},y)),this._defaultPrevented=!1,this.target=f}}class er extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,f,_){const y=t==="touchend"?_.changedTouches:_.touches,w=N.touchPos(f.getCanvasContainer(),y),R=w.map(z=>f.unproject(z)),D=w.reduce((z,q,H,X)=>z.add(q.div(X.length)),new l.P(0,0));super(t,{points:w,point:D,lngLats:R,lngLat:f.unproject(D),originalEvent:_}),this._defaultPrevented=!1}}class ss extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,f,_){super(t,{originalEvent:_}),this._defaultPrevented=!1}}class Ms{constructor(t,f){this._map=t,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ss(t.type,this._map,t))}mousedown(t,f){return this._mousedownPos=f,this._firePreventable(new li(t.type,this._map,t))}mouseup(t){this._map.fire(new li(t.type,this._map,t))}click(t,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new li(t.type,this._map,t))}dblclick(t){return this._firePreventable(new li(t.type,this._map,t))}mouseover(t){this._map.fire(new li(t.type,this._map,t))}mouseout(t){this._map.fire(new li(t.type,this._map,t))}touchstart(t){return this._firePreventable(new er(t.type,this._map,t))}touchmove(t){this._map.fire(new er(t.type,this._map,t))}touchend(t){this._map.fire(new er(t.type,this._map,t))}touchcancel(t){this._map.fire(new er(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new li(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new li(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.P.convert(t),this._map.terrain)}}class dr{constructor(t,f){this._map=t,this._tr=new Rr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,f){this.isEnabled()&&t.shiftKey&&t.button===0&&(N.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(t,f){if(!this._active)return;const _=f;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=_,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(y.x,_.x),R=Math.max(y.x,_.x),D=Math.min(y.y,_.y),z=Math.max(y.y,_.y);N.setTransform(this._box,`translate(${w}px,${D}px)`),this._box.style.width=R-w+"px",this._box.style.height=z-D+"px"}mouseupWindow(t,f){if(!this._active||t.button!==0)return;const _=this._startPos,y=f;if(this.reset(),N.suppressClick(),_.x!==y.x||_.y!==y.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:t})),{cameraAnimation:w=>w.fitScreenCoordinates(_,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,f){return this._map.fire(new l.k(t,{originalEvent:f}))}}function Rs(k,t){if(k.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${k.length}, points ${t.length}`);const f={};for(let _=0;_<k.length;_++)f[k[_].identifier]=t[_];return f}class Wa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const w=new l.P(0,0);for(const R of y)w._add(R);return w.div(y.length)}(f),this.touches=Rs(_,f)))}touchmove(t,f,_){if(this.aborted||!this.centroid)return;const y=Rs(_,f);for(const w in this.touches){const R=y[w];(!R||R.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(t,f,_){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class xa{constructor(t){this.singleTap=new Wa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,f,_){this.singleTap.touchstart(t,f,_)}touchmove(t,f,_){this.singleTap.touchmove(t,f,_)}touchend(t,f,_){const y=this.singleTap.touchend(t,f,_);if(y){const w=t.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(y)<30;if(w&&R||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class lo{constructor(t){this._tr=new Rr(t),this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,f,_){this._zoomIn.touchstart(t,f,_),this._zoomOut.touchstart(t,f,_)}touchmove(t,f,_){this._zoomIn.touchmove(t,f,_),this._zoomOut.touchmove(t,f,_)}touchend(t,f,_){const y=this._zoomIn.touchend(t,f,_),w=this._zoomOut.touchend(t,f,_),R=this._tr;return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:R.zoom+1,around:R.unproject(y)},{originalEvent:t})}):w?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:R.zoom-1,around:R.unproject(w)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ws{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const f=this._moveFunction(...t);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(t,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,f){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const y=f.length?f[0]:f;return!this._moved&&y.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(_,y))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&N.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ec={0:1,2:2};class gu{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const f=N.mouseButton(t);this._eventButton=f}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(f,_){const y=Ec[_];return f.buttons===void 0||(f.buttons&y)!==y}(t,this._eventButton)}isValidEndEvent(t){return N.mouseButton(t)===this._eventButton}}class Ac{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const _u=k=>{k.mousedown=k.dragStart,k.mousemoveWindow=k.dragMove,k.mouseup=k.dragEnd,k.contextmenu=t=>{t.preventDefault()}},Tc=({enable:k,clickTolerance:t,bearingDegreesPerPixelMoved:f=.8})=>{const _=new gu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ws({clickTolerance:t,move:(y,w)=>({bearingDelta:(w.x-y.x)*f}),moveStateManager:_,enable:k,assignEvents:_u})},Cc=({enable:k,clickTolerance:t,pitchDegreesPerPixelMoved:f=-.5})=>{const _=new gu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ws({clickTolerance:t,move:(y,w)=>({pitchDelta:(w.y-y.y)*f}),moveStateManager:_,enable:k,assignEvents:_u})};class wa{constructor(t,f){this._clickTolerance=t.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,f,_){return this._calculateTransform(t,f,_)}touchmove(t,f,_){if(this._active){if(!this._shouldBePrevented(_.length))return t.preventDefault(),this._calculateTransform(t,f,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,f,_){this._calculateTransform(t,f,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,f,_){_.length>0&&(this._active=!0);const y=Rs(_,f),w=new l.P(0,0),R=new l.P(0,0);let D=0;for(const q in y){const H=y[q],X=this._touches[q];X&&(w._add(H),R._add(H.sub(X)),D++,y[q]=H)}if(this._touches=y,this._shouldBePrevented(D)||!R.mag())return;const z=R.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(D),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(t,f,_){if(!this._firstTwoTouches)return;t.preventDefault();const[y,w]=this._firstTwoTouches,R=Bl(_,f,y),D=Bl(_,f,w);if(!R||!D)return;const z=this._aroundCenter?null:R.add(D).div(2);return this._move([R,D],z,t)}touchend(t,f,_){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,R=Bl(_,f,y),D=Bl(_,f,w);R&&D||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Bl(k,t,f){for(let _=0;_<k.length;_++)if(k[_].identifier===f)return t[_]}function Lc(k,t){return Math.log(k/t)/Math.LN2}class Mc extends yu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,f){const _=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Lc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lc(this._distance,_),pinchAround:f}}}function Rc(k,t){return 180*k.angleWith(t)/Math.PI}class Pc extends yu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,f,_){const y=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rc(this._vector,y),pinchAround:f}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const f=25/(Math.PI*this._minDiameter)*360,_=Rc(t,this._startVector);return Math.abs(_)<f}}function vu(k){return Math.abs(k.y)>Math.abs(k.x)}class Ka extends yu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,f,_){super.touchstart(t,f,_),this._currentTouchCount=_.length}_start(t){this._lastPoints=t,vu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,f,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=t[0].sub(this._lastPoints[0]),w=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,_.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(t,f,_){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,w=f.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const R=t.y>0==f.y>0;return vu(t)&&vu(f)&&R}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class Ps{constructor(t){this._tr=new Rr(t);const f=Bh;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let f=0,_=0,y=0,w=0,R=0;switch(t.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:t.shiftKey?_=-1:(t.preventDefault(),w=-1);break;case 39:t.shiftKey?_=1:(t.preventDefault(),w=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),R=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:D=>{const z=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:f?Math.round(z.zoom)+f*(t.shiftKey?2:1):z.zoom,bearing:z.bearing+_*this._bearingStep,pitch:z.pitch+y*this._pitchStep,offset:[-w*this._panStep,-R*this._panStep],center:z.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(k){return k*(2-k)}const Dc=4.000244140625;class Zs{constructor(t,f){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=t,this._tr=new Rr(t),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let f=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const _=C.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%Dc==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),t.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=t,this._delta-=f,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=N.mousePos(this._map.getCanvas(),t),_=this._tr;this._around=f.y>_.transform.height/2-_.transform.getHorizon()?l.N.convert(this._aroundCenter?_.center:_.unproject(f)):l.N.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Dc?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&q!==0&&(q=1/q);const H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*q))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,_=this._startZoom,y=this._easing;let w,R=!1;const D=C.now()-this._lastWheelEventTime;if(this._type==="wheel"&&_&&y&&D){const z=Math.min(D/200,1),q=y(z);w=l.y.number(_,f,q),z<1?this._frameId||(this._frameId=!0):R=!0}else w=f,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:w-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let f=l.b9;if(this._prevEase){const _=this._prevEase,y=(C.now()-_.start)/_.duration,w=_.easing(y+.01)-_.easing(y),R=.27/Math.sqrt(w*w+1e-4)*.01,D=Math.sqrt(.0729-R*R);f=l.b8(R,D,.25,1)}return this._prevEase={start:C.now(),duration:t,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ka{constructor(t,f){this._clickZoom=t,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sd{constructor(t){this._tr=new Rr(t),this.reset()}reset(){this._active=!1}dblclick(t,f){return t.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class od{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,f,_){if(!this._swipePoint)if(this._tapTime){const y=f[0],w=t.timeStamp-this._tapTime<500,R=this._tapPoint.dist(y)<30;w&&R?_.length>0&&(this._swipePoint=y,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(t,f,_)}touchmove(t,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=f[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(t,f,_)}touchend(t,f,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const y=this._tap.touchend(t,f,_);y&&(this._tapTime=t.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(t,f,_){this._el=t,this._mousePan=f,this._touchPan=_}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jh{constructor(t,f,_){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nc{constructor(t,f,_,y){this._el=t,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $a{constructor(t,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",t);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=f,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=_,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,f){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:t,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ds=k=>k.zoom||k.drag||k.pitch||k.rotate;class Qt extends l.k{}function bu(k){return k.panDelta&&k.panDelta.mag()||k.zoomDelta||k.bearingDelta||k.pitchDelta}class zc{constructor(t,f){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const R=y.type==="renderFrame"?void 0:y,D={needsRenderFrame:!1},z={},q={},H=y.touches,X=H?this._getMapTouches(H):void 0,ne=X?N.touchPos(this._map.getCanvas(),X):N.mousePos(this._map.getCanvas(),y);for(const{handlerName:Le,handler:Ne,allowed:ze}of this._handlers){if(!Ne.isEnabled())continue;let Ve;this._blockedByActive(q,ze,Le)?Ne.reset():Ne[w||y.type]&&(Ve=Ne[w||y.type](y,ne,X),this.mergeHandlerResult(D,z,Ve,Le,R),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||Ne.isActive())&&(q[Le]=Ne)}const ge={};for(const Le in this._previousActiveHandlers)q[Le]||(ge[Le]=R);this._previousActiveHandlers=q,(Object.keys(ge).length||bu(D))&&(this._changes.push([D,z,ge]),this._triggerRenderFrame()),(Object.keys(q).length||bu(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=D;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rn(t),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,R]of this._listeners)N.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[t,f,_]of this._listeners)N.removeEventListener(t,f,t===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(t){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new Ms(f,t));const y=f.boxZoom=new dr(f,t);this._add("boxZoom",y),t.interactive&&t.boxZoom&&y.enable();const w=f.cooperativeGestures=new $a(f,t.cooperativeGestures);this._add("cooperativeGestures",w),t.cooperativeGestures&&w.enable();const R=new lo(f),D=new sd(f);f.doubleClickZoom=new ka(D,R),this._add("tapZoom",R),this._add("clickZoom",D),t.interactive&&t.doubleClickZoom&&f.doubleClickZoom.enable();const z=new od;this._add("tapDragZoom",z);const q=f.touchPitch=new Ka(f);this._add("touchPitch",q),t.interactive&&t.touchPitch&&f.touchPitch.enable(t.touchPitch);const H=Tc(t),X=Cc(t);f.dragRotate=new jh(t,H,X),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]),t.interactive&&t.dragRotate&&f.dragRotate.enable();const ne=(({enable:Ve,clickTolerance:Ae})=>{const He=new gu({checkCorrectEvent:Je=>N.mouseButton(Je)===0&&!Je.ctrlKey});return new ws({clickTolerance:Ae,move:(Je,st)=>({around:st,panDelta:st.sub(Je)}),activateOnStart:!0,moveStateManager:He,enable:Ve,assignEvents:_u})})(t),ge=new wa(t,f);f.dragPan=new Uh(_,ne,ge),this._add("mousePan",ne),this._add("touchPan",ge,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&f.dragPan.enable(t.dragPan);const ke=new Pc,Le=new Mc;f.touchZoomRotate=new Nc(_,Le,ke,z),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&f.touchZoomRotate.enable(t.touchZoomRotate);const Ne=f.scrollZoom=new Zs(f,()=>this._triggerRenderFrame());this._add("scrollZoom",Ne,["mousePan"]),t.interactive&&t.scrollZoom&&f.scrollZoom.enable(t.scrollZoom);const ze=f.keyboard=new Ps(f);this._add("keyboard",ze),t.interactive&&t.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new fi(f))}_add(t,f,_){this._handlers.push({handlerName:t,handler:f,allowed:_}),this._handlersById[t]=f}stop(t){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ds(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,f,_){for(const y in t)if(y!==_&&(!f||f.indexOf(y)<0))return!0;return!1}_getMapTouches(t){const f=[];for(const _ of t)this._el.contains(_.target)&&f.push(_);return f}mergeHandlerResult(t,f,_,y,w){if(!_)return;l.e(t,_);const R={handlerName:y,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(f.zoom=R),_.panDelta!==void 0&&(f.drag=R),_.pitchDelta!==void 0&&(f.pitch=R),_.bearingDelta!==void 0&&(f.rotate=R)}_applyChanges(){const t={},f={},_={};for(const[y,w,R]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),l.e(f,w),l.e(_,R);this._updateMapTransform(t,f,_),this._changes=[]}_updateMapTransform(t,f,_){const y=this._map,w=y._getTransformForUpdate(),R=y.terrain;if(!(bu(t)||R&&this._terrainMovement))return this._fireEvents(f,_,!0);let{panDelta:D,zoomDelta:z,bearingDelta:q,pitchDelta:H,around:X,pinchAround:ne}=t;ne!==void 0&&(X=ne),y._stop(!0),X=X||y.transform.centerPoint;const ge=w.pointLocation(D?X.sub(D):X);q&&(w.bearing+=q),H&&(w.pitch+=H),z&&(w.zoom+=z),R?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(D)):w.setLocationAtPoint(ge,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(ge,X)):w.setLocationAtPoint(ge,X),y._applyUpdatedTransform(w),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(f,_,!0)}_fireEvents(t,f,_){const y=Ds(this._eventsInProgress),w=Ds(t),R={};for(const X in t){const{originalEvent:ne}=t[X];this._eventsInProgress[X]||(R[`${X}start`]=ne),this._eventsInProgress[X]=t[X]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const X in R)this._fireEvent(X,R[X]);w&&this._fireEvent("move",w.originalEvent);for(const X in t){const{originalEvent:ne}=t[X];this._fireEvent(X,ne)}const D={};let z;for(const X in this._eventsInProgress){const{handlerName:ne,originalEvent:ge}=this._eventsInProgress[X];this._handlersById[ne].isActive()||(delete this._eventsInProgress[X],z=f[ne]||ge,D[`${X}end`]=z)}for(const X in D)this._fireEvent(X,D[X]);const q=Ds(this._eventsInProgress),H=(y||w)&&!q;if(H&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();X.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(X)}if(_&&H){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=ge=>ge!==0&&-this._bearingSnap<ge&&ge<this._bearingSnap;!X||!X.essential&&C.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:z})),ne(this._map.getBearing())&&this._map.resetNorth()):(ne(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(t,f){this._map.fire(new l.k(t,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Qt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class qh extends l.E{constructor(t,f){super(),this._renderFrameCallback=()=>{const _=Math.min((C.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,f){return this.jumpTo({center:t},f)}panBy(t,f,_){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},f),_)}panTo(t,f,_){return this.easeTo(l.e({center:t},f),_)}getZoom(){return this.transform.zoom}setZoom(t,f){return this.jumpTo({zoom:t},f),this}zoomTo(t,f,_){return this.easeTo(l.e({zoom:t},f),_)}zoomIn(t,f){return this.zoomTo(this.getZoom()+1,t,f),this}zoomOut(t,f){return this.zoomTo(this.getZoom()-1,t,f),this}getBearing(){return this.transform.bearing}setBearing(t,f){return this.jumpTo({bearing:t},f),this}getPadding(){return this.transform.padding}setPadding(t,f){return this.jumpTo({padding:t},f),this}rotateTo(t,f,_){return this.easeTo(l.e({bearing:t},f),_)}resetNorth(t,f){return this.rotateTo(0,l.e({duration:1e3},t),f),this}resetNorthPitch(t,f){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},t),f),this}snapToNorth(t,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,f):this}getPitch(){return this.transform.pitch}setPitch(t,f){return this.jumpTo({pitch:t},f),this}cameraForBounds(t,f){t=$e.convert(t).adjustAntiMeridian();const _=f&&f.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),_,f)}_cameraForBoxAndBearing(t,f,_,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=l.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const jt=y.padding;y.padding={top:jt,bottom:jt,right:jt,left:jt}}y.padding=l.e(w,y.padding);const R=this.transform,D=R.padding,z=new $e(t,f),q=R.project(z.getNorthWest()),H=R.project(z.getNorthEast()),X=R.project(z.getSouthEast()),ne=R.project(z.getSouthWest()),ge=l.ba(-_),ke=q.rotate(ge),Le=H.rotate(ge),Ne=X.rotate(ge),ze=ne.rotate(ge),Ve=new l.P(Math.max(ke.x,Le.x,ze.x,Ne.x),Math.max(ke.y,Le.y,ze.y,Ne.y)),Ae=new l.P(Math.min(ke.x,Le.x,ze.x,Ne.x),Math.min(ke.y,Le.y,ze.y,Ne.y)),He=Ve.sub(Ae),Je=(R.width-(D.left+D.right+y.padding.left+y.padding.right))/He.x,st=(R.height-(D.top+D.bottom+y.padding.top+y.padding.bottom))/He.y;if(st<0||Je<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(R.scaleZoom(R.scale*Math.min(Je,st)),y.maxZoom),Pt=l.P.convert(y.offset),Ht=new l.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(l.ba(_)),$t=Pt.add(Ht).mult(R.scale/R.zoomScale(bt));return{center:R.unproject(q.add(X).div(2).sub($t)),zoom:bt,bearing:_}}fitBounds(t,f,_){return this._fitInternal(this.cameraForBounds(t,f),f,_)}fitScreenCoordinates(t,f,_,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(t)),this.transform.pointLocation(l.P.convert(f)),_,y),y,w)}_fitInternal(t,f,_){return t?(delete(f=l.e(t,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(t,f){this.stop();const _=this._getTransformForUpdate();let y=!1,w=!1,R=!1;return"zoom"in t&&_.zoom!==+t.zoom&&(y=!0,_.zoom=+t.zoom),t.center!==void 0&&(_.center=l.N.convert(t.center)),"bearing"in t&&_.bearing!==+t.bearing&&(w=!0,_.bearing=+t.bearing),"pitch"in t&&_.pitch!==+t.pitch&&(R=!0,_.pitch=+t.pitch),t.padding==null||_.isPaddingEqual(t.padding)||(_.padding=t.padding),this._applyUpdatedTransform(_),this.fire(new l.k("movestart",f)).fire(new l.k("move",f)),y&&this.fire(new l.k("zoomstart",f)).fire(new l.k("zoom",f)).fire(new l.k("zoomend",f)),w&&this.fire(new l.k("rotatestart",f)).fire(new l.k("rotate",f)).fire(new l.k("rotateend",f)),R&&this.fire(new l.k("pitchstart",f)).fire(new l.k("pitch",f)).fire(new l.k("pitchend",f)),this.fire(new l.k("moveend",f))}calculateCameraOptionsFromTo(t,f,_,y=0){const w=l.Z.fromLngLat(t,f),R=l.Z.fromLngLat(_,y),D=R.x-w.x,z=R.y-w.y,q=R.z-w.z,H=Math.hypot(D,z,q);if(H===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(D,z),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/H/this.transform.tileSize),ge=180*Math.atan2(D,-z)/Math.PI;let ke=180*Math.acos(X/H)/Math.PI;return ke=q<0?90-ke:90+ke,{center:R.toLngLat(),zoom:ne,pitch:ke,bearing:ge}}easeTo(t,f){var _;this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.b9},t)).animate===!1||!t.essential&&C.prefersReducedMotion)&&(t.duration=0);const y=this._getTransformForUpdate(),w=y.zoom,R=y.bearing,D=y.pitch,z=y.padding,q="bearing"in t?this._normalizeBearing(t.bearing,R):R,H="pitch"in t?+t.pitch:D,X="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let ge=y.centerPoint.add(ne);const ke=y.pointLocation(ge),{center:Le,zoom:Ne}=y.getConstrained(l.N.convert(t.center||ke),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Le,y);const ze=y.project(ke),Ve=y.project(Le).sub(ze),Ae=y.zoomScale(Ne-w);let He,Je;t.around&&(He=l.N.convert(t.around),Je=y.locationPoint(He));const st={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ne!==w,this._rotating=this._rotating||R!==q,this._pitching=this._pitching||H!==D,this._padding=!y.isPaddingEqual(X),this._easeId=t.easeId,this._prepareEase(f,t.noMoveStart,st),this.terrain&&this._prepareElevation(Le),this._ease(bt=>{if(this._zooming&&(y.zoom=l.y.number(w,Ne,bt)),this._rotating&&(y.bearing=l.y.number(R,q,bt)),this._pitching&&(y.pitch=l.y.number(D,H,bt)),this._padding&&(y.interpolatePadding(z,X,bt),ge=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(bt),He)y.setLocationAtPoint(He,Je);else{const Pt=y.zoomScale(y.zoom-w),Ht=Ne>w?Math.min(2,Ae):Math.max(.5,Ae),$t=Math.pow(Ht,1-bt),jt=y.unproject(ze.add(Ve.mult(bt*$t)).mult(Pt));y.setLocationAtPoint(y.renderWorldCopies?jt.wrap():jt,ge)}this._applyUpdatedTransform(y),this._fireMoveEvents(f)},bt=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(f,bt)},t),this}_prepareEase(t,f,_={}){this._moving=!0,f||_.moving||this.fire(new l.k("movestart",t)),this._zooming&&!_.zooming&&this.fire(new l.k("zoomstart",t)),this._rotating&&!_.rotating&&this.fire(new l.k("rotatestart",t)),this._pitching&&!_.pitching&&this.fire(new l.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&f!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(_-(f-(_*t+this._elevationStart))/(1-t)),this._elevationTarget=f}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const f=t.getCameraPosition(),_=this.terrain.getElevationForLngLatZoom(f.lngLat,t.zoom);if(f.altitude<_){const y=this.calculateCameraOptionsFromTo(f.lngLat,_,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const f=[];if(this.terrain&&f.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&f.push(y=>this.transformCameraUpdate(y)),!f.length)return;const _=t.clone();for(const y of f){const w=_.clone(),{center:R,zoom:D,pitch:z,bearing:q,elevation:H}=y(w);R&&(w.center=R),D!==void 0&&(w.zoom=D),z!==void 0&&(w.pitch=z),q!==void 0&&(w.bearing=q),H!==void 0&&(w.elevation=H),_.apply(w)}this.transform.apply(_)}_fireMoveEvents(t){this.fire(new l.k("move",t)),this._zooming&&this.fire(new l.k("zoom",t)),this._rotating&&this.fire(new l.k("rotate",t)),this._pitching&&this.fire(new l.k("pitch",t))}_afterEase(t,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const _=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new l.k("zoomend",t)),y&&this.fire(new l.k("rotateend",t)),w&&this.fire(new l.k("pitchend",t)),this.fire(new l.k("moveend",t))}flyTo(t,f){var _;if(!t.essential&&C.prefersReducedMotion){const Wt=l.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Wt,f)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},t);const y=this._getTransformForUpdate(),w=y.zoom,R=y.bearing,D=y.pitch,z=y.padding,q="bearing"in t?this._normalizeBearing(t.bearing,R):R,H="pitch"in t?+t.pitch:D,X="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let ge=y.centerPoint.add(ne);const ke=y.pointLocation(ge),{center:Le,zoom:Ne}=y.getConstrained(l.N.convert(t.center||ke),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Le,y);const ze=y.zoomScale(Ne-w),Ve=y.project(ke),Ae=y.project(Le).sub(Ve);let He=t.curve;const Je=Math.max(y.width,y.height),st=Je/ze,bt=Ae.mag();if("minZoom"in t){const Wt=l.ac(Math.min(t.minZoom,w,Ne),y.minZoom,y.maxZoom),In=Je/y.zoomScale(Wt-w);He=Math.sqrt(In/bt*2)}const Pt=He*He;function Ht(Wt){const In=(st*st-Je*Je+(Wt?-1:1)*Pt*Pt*bt*bt)/(2*(Wt?st:Je)*Pt*bt);return Math.log(Math.sqrt(In*In+1)-In)}function $t(Wt){return(Math.exp(Wt)-Math.exp(-Wt))/2}function jt(Wt){return(Math.exp(Wt)+Math.exp(-Wt))/2}const Ut=Ht(!1);let rn=function(Wt){return jt(Ut)/jt(Ut+He*Wt)},An=function(Wt){return Je*((jt(Ut)*($t(In=Ut+He*Wt)/jt(In))-$t(Ut))/Pt)/bt;var In},Vt=(Ht(!0)-Ut)/He;if(Math.abs(bt)<1e-6||!isFinite(Vt)){if(Math.abs(Je-st)<1e-6)return this.easeTo(t,f);const Wt=st<Je?-1:1;Vt=Math.abs(Math.log(st/Je))/He,An=()=>0,rn=In=>Math.exp(Wt*He*In)}return t.duration="duration"in t?+t.duration:1e3*Vt/("screenSpeed"in t?+t.screenSpeed/He:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=R!==q,this._pitching=H!==D,this._padding=!y.isPaddingEqual(X),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Le),this._ease(Wt=>{const In=Wt*Vt,Si=1/rn(In);y.zoom=Wt===1?Ne:w+y.scaleZoom(Si),this._rotating&&(y.bearing=l.y.number(R,q,Wt)),this._pitching&&(y.pitch=l.y.number(D,H,Wt)),this._padding&&(y.interpolatePadding(z,X,Wt),ge=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(Wt);const On=Wt===1?Le:y.unproject(Ve.add(Ae.mult(An(In))).mult(Si));y.setLocationAtPoint(y.renderWorldCopies?On.wrap():On,ge),this._applyUpdatedTransform(y),this._fireMoveEvents(f)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,f){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,f)}return t||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(t,f,_){_.animate===!1||_.duration===0?(t(1),f()):(this._easeStart=C.now(),this._easeOptions=_,this._onEaseFrame=t,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,f){t=l.b3(t,-180,180);const _=Math.abs(t-f);return Math.abs(t-360-f)<_&&(t-=360),Math.abs(t+360-f)<_&&(t+=360),t}_normalizeCenter(t,f){if(!f.renderWorldCopies||f.lngRange)return;const _=t.lng-f.center.lng;t.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ya={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ja{constructor(t=Ya){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,f){const _=this._map._getUIString(`AttributionControl.${f}`);t.title=_,t.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const f=this._map.style.sourceCaches;for(const y in f){const w=f[y];if(w.used||w.usedForTerrain){const R=w.getSource();R.attribution&&t.indexOf(R.attribution)<0&&t.push(R.attribution)}}t=t.filter(y=>String(y).trim()),t.sort((y,w)=>y.length-w.length),t=t.filter((y,w)=>{for(let R=w+1;R<t.length;R++)if(t[R].indexOf(y)>=0)return!1;return!0});const _=t.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,t.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fc{constructor(t={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const _=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const f=N.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Gn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const f=++this._id;return this._queue.push({callback:t,id:f,cancelled:!1}),f}remove(t){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const y of _)if(y.id===t)return void(y.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Oc=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ad extends l.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,f){this.sourceCache.update(t,f),this._renderableTilesKeys=[];const _={};for(const y of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))_[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),l.aP(y.posMatrix,0,l.X,0,l.X,0,1),this._tiles[y.key]=new Ls(y,this.tileSize));for(const y in this._tiles)_[y]||delete this._tiles[y]}freeRtt(t){for(const f in this._tiles){const _=this._tiles[f];(!t||_.tileID.equals(t)||_.tileID.isChildOf(t)||t.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const f={};for(const _ of this._renderableTilesKeys){const y=this._tiles[_].tileID;if(y.canonical.equals(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16),l.aP(w.posMatrix,0,l.X,0,l.X,0,1),f[_]=w}else if(y.canonical.isChildOf(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const R=y.canonical.z-t.canonical.z,D=y.canonical.x-(y.canonical.x>>R<<R),z=y.canonical.y-(y.canonical.y>>R<<R),q=l.X>>R;l.aP(w.posMatrix,0,q,0,q,0,1),l.J(w.posMatrix,w.posMatrix,[-D*q,-z*q,0]),f[_]=w}else if(t.canonical.isChildOf(y.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const R=t.canonical.z-y.canonical.z,D=t.canonical.x-(t.canonical.x>>R<<R),z=t.canonical.y-(t.canonical.y>>R<<R),q=l.X>>R;l.aP(w.posMatrix,0,l.X,0,l.X,0,1),l.J(w.posMatrix,w.posMatrix,[D*q,z*q,0]),l.K(w.posMatrix,w.posMatrix,[1/2**R,1/2**R,0]),f[_]=w}}return f}getSourceTile(t,f){const _=this.sourceCache._source;let y=t.overscaledZ-this.deltaZoom;if(y>_.maxzoom&&(y=_.maxzoom),y<_.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!w||!w.dem)&&f)for(;y>=_.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(t.scaledTo(y--).key);return w}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=t)}}class Bc{constructor(t,f,_){this.painter=t,this.sourceCache=new ad(f),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,f,_,y=l.X){var w;if(!(f>=0&&f<y&&_>=0&&_<y))return 0;const R=this.getTerrainData(t),D=(w=R.tile)===null||w===void 0?void 0:w.dem;if(!D)return 0;const z=function(ke,Le,Ne){var ze=Le[0],Ve=Le[1];return ke[0]=Ne[0]*ze+Ne[4]*Ve+Ne[12],ke[1]=Ne[1]*ze+Ne[5]*Ve+Ne[13],ke}([],[f/y*l.X,_/y*l.X],R.u_terrain_matrix),q=[z[0]*D.dim,z[1]*D.dim],H=Math.floor(q[0]),X=Math.floor(q[1]),ne=q[0]-H,ge=q[1]-X;return D.get(H,X)*(1-ne)*(1-ge)+D.get(H+1,X)*ne*(1-ge)+D.get(H,X+1)*(1-ne)*ge+D.get(H+1,X+1)*ne*ge}getElevationForLngLatZoom(t,f){if(!l.bb(f,t.wrap()))return 0;const{tileID:_,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(t,f);return this.getElevation(_,y%l.X,w%l.X,l.X)}getElevation(t,f,_,y=l.X){return this.getDEMElevation(t,f,_,y)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const y=this.painter.context,w=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(y,new l.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const f=this.sourceCache.getSourceTile(t,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const y=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new we(y,f.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),f.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const _=f&&f+f.tileID.key+t.key;if(_&&!this._demMatrixCache[_]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=t.canonical.z-f.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=y?w=t.canonical.z-y:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const R=t.canonical.x-(t.canonical.x>>w<<w),D=t.canonical.y-(t.canonical.y>>w<<w),z=l.bc(new Float64Array(16),[1/(l.X<<w),1/(l.X<<w),0]);l.J(z,z,[R*l.X,D*l.X,0]),this._demMatrixCache[t.key]={matrix:z,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(t){const f=this.painter,_=f.width/devicePixelRatio,y=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(f.context,{width:_,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(f.context,{width:_,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(_,y,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,_,y))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,R=0;w<this._coordsTextureSize;w++)for(let D=0;D<this._coordsTextureSize;D++,R+=4)f[R+0]=255&D,f[R+1]=255&w,f[R+2]=D>>8<<4|w>>8,f[R+3]=0;const _=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),y=new we(t,_,t.gl.RGBA,{premultiply:!1});return y.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),_=this.painter.context,y=_.gl,w=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),R=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,D-R-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null);const z=f[0]+(f[2]>>4<<8),q=f[1]+((15&f[2])<<8),H=this.coordsIndex[255-f[3]],X=H&&this.sourceCache.getTileByID(H);if(!X)return null;const ne=this._coordsTextureSize,ge=(1<<X.tileID.canonical.z)*ne;return new l.Z((X.tileID.canonical.x*ne+z)/ge+X.tileID.wrap,(X.tileID.canonical.y*ne+q)/ge,this.getElevation(X.tileID,z,q,ne))}depthAtPoint(t){const f=new Uint8Array(4),_=this.painter.context,y=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,f=new l.bd,_=new l.aY,y=this.meshSize,w=l.X/y,R=y*y;for(let X=0;X<=y;X++)for(let ne=0;ne<=y;ne++)f.emplaceBack(ne*w,X*w,0);for(let X=0;X<R;X+=y+1)for(let ne=0;ne<y;ne++)_.emplaceBack(ne+X,y+ne+X+1,y+ne+X+2),_.emplaceBack(ne+X,y+ne+X+2,ne+X+1);const D=f.length,z=D+2*(y+1);for(const X of[0,1])for(let ne=0;ne<=y;ne++)for(const ge of[0,1])f.emplaceBack(ne*w,X*l.X,ge);for(let X=0;X<2*y;X+=2)_.emplaceBack(z+X,z+X+1,z+X+3),_.emplaceBack(z+X,z+X+3,z+X+2),_.emplaceBack(D+X,D+X+3,D+X+1),_.emplaceBack(D+X,D+X+2,D+X+3);const q=f.length,H=q+2*(y+1);for(const X of[0,1])for(let ne=0;ne<=y;ne++)for(const ge of[0,1])f.emplaceBack(X*l.X,ne*w,ge);for(let X=0;X<2*y;X+=2)_.emplaceBack(q+X,q+X+1,q+X+3),_.emplaceBack(q+X,q+X+3,q+X+2),_.emplaceBack(H+X,H+X+3,H+X+1),_.emplaceBack(H+X,H+X+2,H+X+3);return this._mesh=new p(t.createVertexBuffer(f,Oc.members),t.createIndexBuffer(_),l.a0.simpleSegment(0,0,f.length,_.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,f){var _;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(t,f);return(_=this.getMinMaxElevation(y).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(t){const f=this.getTerrainData(t).tile,_={minElevation:null,maxElevation:null};return f&&f.dem&&(_.minElevation=f.dem.min*this.exaggeration,_.maxElevation=f.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(t,f){const _=l.Z.fromLngLat(t.wrap()),y=(1<<f)*l.X,w=_.x*y,R=_.y*y,D=Math.floor(w/l.X),z=Math.floor(R/l.X);return{tileID:new l.S(f,0,f,D,z),mercatorX:w,mercatorY:R}}}class ld{constructor(t,f,_){this._context=t,this._size=f,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new we(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(_.texture),{id:t,fbo:f,texture:_,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>t.id!==f),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Qa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Vh{constructor(t,f){this.painter=t,this.terrain=f,this.pool=new ld(t.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(_=>!t._layers[_].isHidden(f)),this._coordsDescendingInv={};for(const _ in t.sourceCaches){this._coordsDescendingInv[_]={};const y=t.sourceCaches[_].getVisibleCoordinates();for(const w of y){const R=this.terrain.sourceCache.getTerrainCoords(w);for(const D in R)this._coordsDescendingInv[_][D]||(this._coordsDescendingInv[_][D]=[]),this._coordsDescendingInv[_][D].push(R[D])}}this._coordsDescendingInvStr={};for(const _ of t._order){const y=t._layers[_],w=y.source;if(Qa[y.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const R in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][R]=this._coordsDescendingInv[w][R].map(D=>D.key).sort().join()}}for(const _ of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[y][_.tileID.key];w&&w!==_.rttCoords[y]&&(_.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const f=t.type,_=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Qa[f]&&(this._prevType&&Qa[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!y))return!0;if(Qa[this._prevType]||Qa[f]&&y){this._prevType=f;const w=this._stacks.length-1,R=this._stacks[w]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[w]){const q=this.pool.getObjectForId(D.rtt[w].id);if(q.stamp===D.rtt[w].stamp){this.pool.useObject(q);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),D.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:l.aM.transparent,stencil:0}),_.currentStencilSource=void 0;for(let q=0;q<R.length;q++){const H=_.style._layers[R[q]],X=H.source?this._coordsDescendingInv[H.source][D.tileID.key]:[D.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(H,X),_.renderLayer(_,_.style.sourceCaches[H.source],H,X),H.source&&(D.rttCoords[H.source]=this._coordsDescendingInvStr[H.source][D.tileID.key])}}return d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Qa[f]}return!1}}const Uc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=x,ud={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ya,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},jc=k=>{k.touchstart=k.dragStart,k.touchmoveWindow=k.dragMove,k.touchend=k.dragEnd},cd={showCompass:!0,showZoom:!0,visualizePitch:!1};class hd{constructor(t,f,_=!1){this.mousedown=R=>{this.startMouse(l.e({},R,{ctrlKey:!0,preventDefault:()=>R.preventDefault()}),N.mousePos(this.element,R)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=R=>{this.moveMouse(R,N.mousePos(this.element,R))},this.mouseup=R=>{this.mouseRotate.dragEnd(R),this.mousePitch&&this.mousePitch.dragEnd(R),this.offTemp()},this.touchstart=R=>{R.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,R.targetTouches)[0],this.startTouch(R,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=R=>{R.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,R.targetTouches)[0],this.moveTouch(R,this._lastPos))},this.touchend=R=>{R.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=t.dragRotate._mouseRotate.getClickTolerance(),w=t.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=Tc({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:R,clickTolerance:D,bearingDegreesPerPixelMoved:z=.8})=>{const q=new Ac;return new ws({clickTolerance:D,move:(H,X)=>({bearingDelta:(X.x-H.x)*z}),moveStateManager:q,enable:R,assignEvents:jc})})({clickTolerance:y,enable:!0}),this.map=t,_&&(this.mousePitch=Cc({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:R,clickTolerance:D,pitchDegreesPerPixelMoved:z=-.5})=>{const q=new Ac;return new ws({clickTolerance:D,move:(H,X)=>({pitchDelta:(X.y-H.y)*z}),moveStateManager:q,enable:R,assignEvents:jc})})({clickTolerance:w,enable:!0})),N.addEventListener(f,"mousedown",this.mousedown),N.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(f,"touchcancel",this.reset)}startMouse(t,f){this.mouseRotate.dragStart(t,f),this.mousePitch&&this.mousePitch.dragStart(t,f),N.disableDrag()}startTouch(t,f){this.touchRotate.dragStart(t,f),this.touchPitch&&this.touchPitch.dragStart(t,f),N.disableDrag()}moveMouse(t,f){const _=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(t,f)||{};if(y&&_.setBearing(_.getBearing()+y),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(t,f)||{};w&&_.setPitch(_.getPitch()+w)}}moveTouch(t,f){const _=this.map,{bearingDelta:y}=this.touchRotate.dragMove(t,f)||{};if(y&&_.setBearing(_.getBearing()+y),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(t,f)||{};w&&_.setPitch(_.getPitch()+w)}}off(){const t=this.element;N.removeEventListener(t,"mousedown",this.mousedown),N.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let ks;function Ii(k,t,f){const _=new l.N(k.lng,k.lat);if(k=new l.N(k.lng,k.lat),t){const y=new l.N(k.lng-360,k.lat),w=new l.N(k.lng+360,k.lat),R=f.locationPoint(k).distSqr(t);f.locationPoint(y).distSqr(t)<R?k=y:f.locationPoint(w).distSqr(t)<R&&(k=w)}for(;Math.abs(k.lng-f.center.lng)>180;){const y=f.locationPoint(k);if(y.x>=0&&y.y>=0&&y.x<=f.width&&y.y<=f.height)break;k.lng>f.center.lng?k.lng-=360:k.lng+=360}return k.lng!==_.lng&&f.locationPoint(k).y>f.height/2-f.getHorizon()?k:_}const el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xu(k,t,f){const _=k.classList;for(const y in el)_.remove(`maplibregl-${f}-anchor-${y}`);_.add(`maplibregl-${f}-anchor-${t}`)}class wu extends l.E{constructor(t){if(super(),this._onKeyPress=f=>{const _=f.code,y=f.charCode||f.keyCode;_!=="Space"&&_!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=f=>{const _=f.originalEvent.target,y=this._element;this._popup&&(_===y||y.contains(_))&&this.togglePopup()},this._update=f=>{var _;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ii(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let R="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?R="rotateX(0deg)":this._pitchAlignment==="map"&&(R=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${el[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${R} ${w}`),C.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const f=N.createNS("http://www.w3.org/2000/svg","svg"),_=41,y=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${y}px`),f.setAttributeNS(null,"viewBox",`0 0 ${y} ${_}`);const w=N.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const R=N.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const D=N.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ze of z){const Ve=N.createNS("http://www.w3.org/2000/svg","ellipse");Ve.setAttributeNS(null,"opacity","0.04"),Ve.setAttributeNS(null,"cx","10.5"),Ve.setAttributeNS(null,"cy","5.80029008"),Ve.setAttributeNS(null,"rx",ze.rx),Ve.setAttributeNS(null,"ry",ze.ry),D.appendChild(Ve)}const q=N.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const H=N.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(H);const X=N.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const ne=N.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(ne);const ge=N.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");const ke=N.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Le=N.createNS("http://www.w3.org/2000/svg","circle");Le.setAttributeNS(null,"fill","#000000"),Le.setAttributeNS(null,"opacity","0.25"),Le.setAttributeNS(null,"cx","5.5"),Le.setAttributeNS(null,"cy","5.5"),Le.setAttributeNS(null,"r","5.4999962");const Ne=N.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Le),ke.appendChild(Ne),R.appendChild(D),R.appendChild(q),R.appendChild(X),R.appendChild(ge),R.appendChild(ke),f.appendChild(R),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(f),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),xu(this._element,this._anchor,"marker"),t&&t.className)for(const f of t.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var f,_;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),R=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,R)-w<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/y.transform._pixelPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*D,q=y.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),H=y.transform.lngLatToCameraDepth(this._lngLat,R+z)-q>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,f){return t===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const Zh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ul=0,jl=!1;const co={maxWidth:100,unit:"metric"};function ql(k,t,f){const _=f&&f.maxWidth||100,y=k._container.clientHeight/2,w=k.unproject([0,y]),R=k.unproject([_,y]),D=w.distanceTo(R);if(f&&f.unit==="imperial"){const z=3.2808*D;z>5280?nn(t,_,z/5280,k._getUIString("ScaleControl.Miles")):nn(t,_,z,k._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?nn(t,_,D/1852,k._getUIString("ScaleControl.NauticalMiles")):D>=1e3?nn(t,_,D/1e3,k._getUIString("ScaleControl.Kilometers")):nn(t,_,D,k._getUIString("ScaleControl.Meters"))}function nn(k,t,f,_){const y=function(w){const R=Math.pow(10,`${Math.floor(w)}`.length-1);let D=w/R;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(z){const q=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*q)/q}(D),R*D}(f);k.style.width=t*(y/f)+"px",k.innerHTML=`${y}&nbsp;${_}`}const vn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ku=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Iu(k){if(k){if(typeof k=="number"){const t=Math.round(Math.abs(k)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,k),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-k),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(k,0),right:new l.P(-k,0)}}if(k instanceof l.P||Array.isArray(k)){const t=l.P.convert(k);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(k.center||[0,0]),top:l.P.convert(k.top||[0,0]),"top-left":l.P.convert(k["top-left"]||[0,0]),"top-right":l.P.convert(k["top-right"]||[0,0]),bottom:l.P.convert(k.bottom||[0,0]),"bottom-left":l.P.convert(k["bottom-left"]||[0,0]),"bottom-right":l.P.convert(k["bottom-right"]||[0,0]),left:l.P.convert(k.left||[0,0]),right:l.P.convert(k.right||[0,0])}}return Iu(new l.P(0,0))}const qc=x;m.AJAXError=l.bh,m.Evented=l.E,m.LngLat=l.N,m.MercatorCoordinate=l.Z,m.Point=l.P,m.addProtocol=l.bi,m.config=l.a,m.removeProtocol=l.bj,m.AttributionControl=Ja,m.BoxZoomHandler=dr,m.CanvasSource=Vi,m.CooperativeGesturesHandler=$a,m.DoubleClickZoomHandler=ka,m.DragPanHandler=Uh,m.DragRotateHandler=jh,m.EdgeInsets=V,m.FullscreenControl=class extends l.E{constructor(k={}){super(),this._onFullscreenChange=()=>{var t;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=f==null?void 0:f.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,k&&k.container&&(k.container instanceof HTMLElement?this._container=k.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(k){return this._map=k,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const k=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",k).setAttribute("aria-hidden","true"),k.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const k=this._getTitle();this._fullscreenButton.setAttribute("aria-label",k),this._fullscreenButton.title=k}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=_n,m.GeolocateControl=class extends l.E{constructor(k){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const f=new l.N(t.coords.longitude,t.coords.latitude),_=t.coords.accuracy,y=this._map.getBearing(),w=l.e({bearing:y},this.options.fitBoundsOptions),R=$e.fromLngLat(f,_);this._map.fitBounds(R,w,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const f=new l.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&jl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new wu({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Zh,k)}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(t=!1){if(ks!==void 0&&!t)return ks;if(window.navigator.permissions===void 0)return ks=!!window.navigator.geolocation,ks;try{ks=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ks=!!window.navigator.geolocation}return ks})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ul=0,jl=!1}_isOutOfMapMaxBounds(k){const t=this._map.getMaxBounds(),f=k.coords;return t&&(f.longitude<t.getWest()||f.longitude>t.getEast()||f.latitude<t.getSouth()||f.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const k=this._map.getBounds(),t=k.getSouthEast(),f=k.getNorthEast(),_=t.distanceTo(f),y=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ul--,jl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let k;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ul++,Ul>1?(k={maximumAge:6e5,timeout:0},jl=!0):(k=this.options.positionOptions,jl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,k)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=Ke,m.ImageSource=$i,m.KeyboardHandler=Ps,m.LngLatBounds=$e,m.LogoControl=Fc,m.Map=class extends qh{constructor(k){l.bf.mark(l.bg.create);const t=Object.assign(Object.assign({},ud),k);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new me(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Gn,this._controls=[],this._mapId=l.a4(),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Uc),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=K.addThrottleControl(()=>this.isMoving()),this._requestManager=new pe(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const _=Be(y=>{this._trackResize&&!this._removed&&(this.resize(y),this.redraw())},50);this._resizeObserver=new ResizeObserver(y=>{f?_(y):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,t),this._hash=t.hash&&new Ke(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,l.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Ja(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Fc,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new l.k(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new l.k(`${f.dataType}dataloading`,f))}),this.on("dataabort",f=>{this.fire(new l.k("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(k,t){if(t===void 0&&(t=k.getDefaultPosition?k.getDefaultPosition():"top-right"),!k||!k.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=k.onAdd(this);this._controls.push(k);const _=this._controlPositions[t];return t.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(k){if(!k||!k.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(k);return t>-1&&this._controls.splice(t,1),k.onRemove(this),this}hasControl(k){return this._controls.indexOf(k)>-1}calculateCameraOptionsFromTo(k,t,f,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(k,t,f,_)}resize(k){var t;const f=this._containerDimensions(),_=f[0],y=f[1],w=this._getClampedPixelRatio(_,y);if(this._resizeCanvas(_,y,w),this.painter.resize(_,y,w),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const z=this._getClampedPixelRatio(_,y);this._resizeCanvas(_,y,z),this.painter.resize(_,y,z)}this.transform.resize(_,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(_,y);const R=!this._moving;return R&&(this.stop(),this.fire(new l.k("movestart",k)).fire(new l.k("move",k))),this.fire(new l.k("resize",k)),R&&this.fire(new l.k("moveend",k)),this}_getClampedPixelRatio(k,t){const{0:f,1:_}=this._maxCanvasSize,y=this.getPixelRatio(),w=k*y,R=t*y;return Math.min(w>f?f/w:1,R>_?_/R:1)*y}getPixelRatio(){var k;return(k=this._overridePixelRatio)!==null&&k!==void 0?k:devicePixelRatio}setPixelRatio(k){this._overridePixelRatio=k,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(k){return this.transform.setMaxBounds($e.convert(k)),this._update()}setMinZoom(k){if((k=k??-2)>=-2&&k<=this.transform.maxZoom)return this.transform.minZoom=k,this._update(),this.getZoom()<k&&this.setZoom(k),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(k){if((k=k??22)>=this.transform.minZoom)return this.transform.maxZoom=k,this._update(),this.getZoom()>k&&this.setZoom(k),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(k){if((k=k??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(k>=0&&k<=this.transform.maxPitch)return this.transform.minPitch=k,this._update(),this.getPitch()<k&&this.setPitch(k),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(k){if((k=k??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(k>=this.transform.minPitch)return this.transform.maxPitch=k,this._update(),this.getPitch()>k&&this.setPitch(k),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(k){return this.transform.renderWorldCopies=k,this._update()}project(k){return this.transform.locationPoint(l.N.convert(k),this.style&&this.terrain)}unproject(k){return this.transform.pointLocation(l.P.convert(k),this.terrain)}isMoving(){var k;return this._moving||((k=this.handlers)===null||k===void 0?void 0:k.isMoving())}isZooming(){var k;return this._zooming||((k=this.handlers)===null||k===void 0?void 0:k.isZooming())}isRotating(){var k;return this._rotating||((k=this.handlers)===null||k===void 0?void 0:k.isRotating())}_createDelegatedListener(k,t,f){if(k==="mouseenter"||k==="mouseover"){let _=!1;return{layers:t,listener:f,delegates:{mousemove:w=>{const R=t.filter(z=>this.getLayer(z)),D=R.length!==0?this.queryRenderedFeatures(w.point,{layers:R}):[];D.length?_||(_=!0,f.call(this,new li(k,this,w.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(k==="mouseleave"||k==="mouseout"){let _=!1;return{layers:t,listener:f,delegates:{mousemove:R=>{const D=t.filter(z=>this.getLayer(z));(D.length!==0?this.queryRenderedFeatures(R.point,{layers:D}):[]).length?_=!0:_&&(_=!1,f.call(this,new li(k,this,R.originalEvent)))},mouseout:R=>{_&&(_=!1,f.call(this,new li(k,this,R.originalEvent)))}}}}{const _=y=>{const w=t.filter(D=>this.getLayer(D)),R=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];R.length&&(y.features=R,f.call(this,y),delete y.features)};return{layers:t,listener:f,delegates:{[k]:_}}}}_saveDelegatedListener(k,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[k]=this._delegatedListeners[k]||[],this._delegatedListeners[k].push(t)}_removeDelegatedListener(k,t,f){if(!this._delegatedListeners||!this._delegatedListeners[k])return;const _=this._delegatedListeners[k];for(let y=0;y<_.length;y++){const w=_[y];if(w.listener===f&&w.layers.length===t.length&&w.layers.every(R=>t.includes(R))){for(const R in w.delegates)this.off(R,w.delegates[R]);return void _.splice(y,1)}}}on(k,t,f){if(f===void 0)return super.on(k,t);const _=this._createDelegatedListener(k,typeof t=="string"?[t]:t,f);this._saveDelegatedListener(k,_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(k,t,f){if(f===void 0)return super.once(k,t);const _=typeof t=="string"?[t]:t,y=this._createDelegatedListener(k,_,f);for(const w in y.delegates){const R=y.delegates[w];y.delegates[w]=(...D)=>{this._removeDelegatedListener(k,_,f),R(...D)}}this._saveDelegatedListener(k,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(k,t,f){return f===void 0?super.off(k,t):(this._removeDelegatedListener(k,typeof t=="string"?[t]:t,f),this)}queryRenderedFeatures(k,t){if(!this.style)return[];let f;const _=k instanceof l.P||Array.isArray(k),y=_?k:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(_?{}:k)||{},y instanceof l.P||typeof y[0]=="number")f=[l.P.convert(y)];else{const w=l.P.convert(y[0]),R=l.P.convert(y[1]);f=[w,new l.P(R.x,w.y),R,new l.P(w.x,R.y),w]}return this.style.queryRenderedFeatures(f,t,this.transform)}querySourceFeatures(k,t){return this.style.querySourceFeatures(k,t)}setStyle(k,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&k?(this._diffStyle(k,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(k,t))}setTransformRequest(k){return this._requestManager.setTransformRequest(k),this}_getUIString(k){const t=this._locale[k];if(t==null)throw new Error(`Missing UI string '${k}'`);return t}_updateStyle(k,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(k,t));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!k)),k?(this.style=new ca(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof k=="string"?this.style.loadURL(k,t,f):this.style.loadJSON(k,t,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(k,t){if(typeof k=="string"){const f=this._requestManager.transformRequest(k,"Style");l.h(f,new AbortController).then(_=>{this._updateDiff(_.data,t)}).catch(_=>{_&&this.fire(new l.j(_))})}else typeof k=="object"&&this._updateDiff(k,t)}_updateDiff(k,t){try{this.style.setState(k,t)&&this._update(!0)}catch(f){l.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(k,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(k,t){return this._lazyInitEmptyStyle(),this.style.addSource(k,t),this._update(!0)}isSourceLoaded(k){const t=this.style&&this.style.sourceCaches[k];if(t!==void 0)return t.loaded();this.fire(new l.j(new Error(`There is no source with ID '${k}'`)))}setTerrain(k){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),k){const t=this.style.sourceCaches[k.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${k.source}`);this.terrain===null&&t.reload();for(const f in this.style._layers){const _=this.style._layers[f];_.type==="hillshade"&&_.source===k.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bc(this.painter,t,k),this.painter.renderToTexture=new Vh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==k.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:k})),this}getTerrain(){var k,t;return(t=(k=this.terrain)===null||k===void 0?void 0:k.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const k=this.style&&this.style.sourceCaches;for(const t in k){const f=k[t]._tiles;for(const _ in f){const y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(k){return this.style.removeSource(k),this._update(!0)}getSource(k){return this.style.getSource(k)}addImage(k,t,f={}){const{pixelRatio:_=1,sdf:y=!1,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q}=f;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:X,data:ne}=t,ge=t;return this.style.addImage(k,{data:new l.R({width:H,height:X},new Uint8Array(ne)),pixelRatio:_,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q,sdf:y,version:0,userImage:ge}),ge.onAdd&&ge.onAdd(this,k),this}}{const{width:H,height:X,data:ne}=C.getImageData(t);this.style.addImage(k,{data:new l.R({width:H,height:X},ne),pixelRatio:_,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q,sdf:y,version:0})}}updateImage(k,t){const f=this.style.getImage(k);if(!f)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||l.b(t)?C.getImageData(t):t,{width:y,height:w,data:R}=_;if(y===void 0||w===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==f.data.width||w!==f.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(t instanceof HTMLImageElement||l.b(t));return f.data.replace(R,D),this.style.updateImage(k,f),this}getImage(k){return this.style.getImage(k)}hasImage(k){return k?!!this.style.getImage(k):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(k){this.style.removeImage(k)}loadImage(k){return K.getImage(this._requestManager.transformRequest(k,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(k,t){return this._lazyInitEmptyStyle(),this.style.addLayer(k,t),this._update(!0)}moveLayer(k,t){return this.style.moveLayer(k,t),this._update(!0)}removeLayer(k){return this.style.removeLayer(k),this._update(!0)}getLayer(k){return this.style.getLayer(k)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(k,t,f){return this.style.setLayerZoomRange(k,t,f),this._update(!0)}setFilter(k,t,f={}){return this.style.setFilter(k,t,f),this._update(!0)}getFilter(k){return this.style.getFilter(k)}setPaintProperty(k,t,f,_={}){return this.style.setPaintProperty(k,t,f,_),this._update(!0)}getPaintProperty(k,t){return this.style.getPaintProperty(k,t)}setLayoutProperty(k,t,f,_={}){return this.style.setLayoutProperty(k,t,f,_),this._update(!0)}getLayoutProperty(k,t){return this.style.getLayoutProperty(k,t)}setGlyphs(k,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(k,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(k,t,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(k,t,f,_=>{_||this._update(!0)}),this}removeSprite(k){return this._lazyInitEmptyStyle(),this.style.removeSprite(k),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(k,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(k,t,f=>{f||this._update(!0)}),this}setLight(k,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(k,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(k){return this._lazyInitEmptyStyle(),this.style.setSky(k),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(k,t){return this.style.setFeatureState(k,t),this._update()}removeFeatureState(k,t){return this.style.removeFeatureState(k,t),this._update()}getFeatureState(k){return this.style.getFeatureState(k)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let k=0,t=0;return this._container&&(k=this._container.clientWidth||400,t=this._container.clientHeight||300),[k,t]}_setupContainer(){const k=this._container;k.classList.add("maplibregl-map");const t=this._canvasContainer=N.create("div","maplibregl-canvas-container",k);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),_=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],_);const y=this._controlContainer=N.create("div","maplibregl-control-container",k),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(R=>{w[R]=N.create("div",`maplibregl-ctrl-${R} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(k,t,f){this._canvas.width=Math.floor(f*k),this._canvas.height=Math.floor(f*t),this._canvas.style.width=`${k}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const k={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{t={requestedAttributes:k},_&&(t.statusMessage=_.statusMessage,t.type=_.type)},{once:!0});const f=this._canvas.getContext("webgl2",k)||this._canvas.getContext("webgl",k);if(!f){const _="Failed to initialize WebGL";throw t?(t.message=_,new Error(JSON.stringify(t))):new Error(_)}this.painter=new b(f,this.transform),B.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(k){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||k,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(k){return this._update(),this._renderTaskQueue.add(k)}_cancelRenderFrame(k){this._renderTaskQueue.remove(k)}_render(k){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(k),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,w=C.now();this.style.zoomHistory.update(y,w);const R=new l.z(y,{now:w,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=R.crossFadingFactor();D===1&&D===this._crossFadingFactor||(f=!0,this._crossFadingFactor=D),this.style.update(R)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var k;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),K.removeThrottleControl(this._imageQueueHandle),(k=this._resizeObserver)===null||k===void 0||k.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(k=>{l.bf.frame(k),this._frameRequest=null,this._render(k)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(k){this._showTileBoundaries!==k&&(this._showTileBoundaries=k,this._update())}get showPadding(){return!!this._showPadding}set showPadding(k){this._showPadding!==k&&(this._showPadding=k,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(k){this._showCollisionBoxes!==k&&(this._showCollisionBoxes=k,k?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(k){this._showOverdrawInspector!==k&&(this._showOverdrawInspector=k,this._update())}get repaint(){return!!this._repaint}set repaint(k){this._repaint!==k&&(this._repaint=k,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(k){this._vertices=k,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=li,m.MapTouchEvent=er,m.MapWheelEvent=ss,m.Marker=wu,m.NavigationControl=class{constructor(k){this._updateZoomButtons=()=>{const t=this._map.getZoom(),f=t===this._map.getMaxZoom(),_=t===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,f)=>{const _=this._map._getUIString(`NavigationControl.${f}`);t.title=_,t.setAttribute("aria-label",_)},this.options=l.e({},cd,k),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(k){return this._map=k,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(k,t){const f=N.create("button",k,this._container);return f.type="button",f.addEventListener("click",t),f}},m.Popup=class extends l.E{constructor(k){super(),this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ii(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!t)return;const _=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let y=this.options.anchor;const w=Iu(this.options.offset);if(!y){const D=this._container.offsetWidth,z=this._container.offsetHeight;let q;q=_.y+w.bottom.y<z?["top"]:_.y>this._map.transform.height-z?["bottom"]:[],_.x<D/2?q.push("left"):_.x>this._map.transform.width-D/2&&q.push("right"),y=q.length===0?"bottom":q.join("-")}let R=_.add(w[y]);this.options.subpixelPositioning||(R=R.round()),N.setTransform(this._container,`${el[y]} translate(${R.x}px,${R.y}px)`),xu(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(vn),k)}addTo(k){return this._map&&this.remove(),this._map=k,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(k){return this._lngLat=l.N.convert(k),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(k){return this.setDOMContent(document.createTextNode(k))}setHTML(k){const t=document.createDocumentFragment(),f=document.createElement("body");let _;for(f.innerHTML=k;_=f.firstChild,_;)t.appendChild(_);return this.setDOMContent(t)}getMaxWidth(){var k;return(k=this._container)===null||k===void 0?void 0:k.style.maxWidth}setMaxWidth(k){return this.options.maxWidth=k,this._update(),this}setDOMContent(k){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(k),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(k){return this._container&&this._container.classList.add(k),this}removeClassName(k){return this._container&&this._container.classList.remove(k),this}setOffset(k){return this.options.offset=k,this._update(),this}toggleClassName(k){if(this._container)return this._container.classList.toggle(k)}setSubpixelPositioning(k){this.options.subpixelPositioning=k}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const k=this._container.querySelector(ku);k&&k.focus()}},m.RasterDEMTileSource=Gt,m.RasterTileSource=Ee,m.ScaleControl=class{constructor(k){this._onMove=()=>{ql(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ql(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},co),k)}getDefaultPosition(){return"bottom-left"}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",k.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Zs,m.Style=ca,m.TerrainControl=class{constructor(k){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=k}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Ka,m.TwoFingersTouchRotateHandler=Pc,m.TwoFingersTouchZoomHandler=Mc,m.TwoFingersTouchZoomRotateHandler=Nc,m.VectorTileSource=qt,m.VideoSource=xn,m.addSourceType=(k,t)=>l._(void 0,void 0,void 0,function*(){if(Jr(k))throw new Error(`A source type called "${k}" already exists.`);((f,_)=>{Yi[f]=_})(k,t)}),m.clearPrewarmedResources=function(){const k=Dn;k&&(k.isPreloaded()&&k.numActive()===1?(k.release(It),Dn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return mn().getRTLTextPluginStatus()},m.getVersion=function(){return qc},m.getWorkerCount=function(){return Yt.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(k){return Ot().broadcast("IS",k)},m.prewarm=function(){Xn().acquire(It)},m.setMaxParallelImageRequests=function(k){l.a.MAX_PARALLEL_IMAGE_REQUESTS=k},m.setRTLTextPlugin=function(k,t){return mn().setRTLTextPlugin(k,t)},m.setWorkerCount=function(k){Yt.workerCount=k},m.setWorkerUrl=function(k){l.a.WORKER_URL=k}});var h=n;return h})})(nv);var hx=nv.exports;const Ts=cx(hx);var fx=Object.defineProperty,dx=(s,e,n)=>e in s?fx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Vg=(s,e,n)=>dx(s,typeof e!="symbol"?e+"":e,n);function Ch(){}function rv(s){return s()}function Gg(){return Object.create(null)}function nd(s){s.forEach(rv)}function sv(s){return typeof s=="function"}function px(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function mx(s){return Object.keys(s).length===0}function gx(s,e){s.appendChild(e)}function _x(s,e,n){s.insertBefore(e,n||null)}function ov(s){s.parentNode&&s.parentNode.removeChild(s)}function Zg(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function dl(s,e,n){n==null?s.removeAttribute(e):s.getAttribute(e)!==n&&s.setAttribute(e,n)}function yx(s){return Array.from(s.childNodes)}function _f(s,e,n){s.classList.toggle(e,!!n)}let jp;function wh(s){jp=s}const Ku=[],Hg=[];let tc=[];const Xg=[],vx=Promise.resolve();let gp=!1;function bx(){gp||(gp=!0,vx.then(av))}function _p(s){tc.push(s)}const ip=new Set;let Vu=0;function av(){if(Vu!==0)return;const s=jp;do{try{for(;Vu<Ku.length;){const e=Ku[Vu];Vu++,wh(e),xx(e.$$)}}catch(e){throw Ku.length=0,Vu=0,e}for(wh(null),Ku.length=0,Vu=0;Hg.length;)Hg.pop()();for(let e=0;e<tc.length;e+=1){const n=tc[e];ip.has(n)||(ip.add(n),n())}tc.length=0}while(Ku.length);for(;Xg.length;)Xg.pop()();gp=!1,ip.clear(),wh(s)}function xx(s){if(s.fragment!==null){s.update(),nd(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(_p)}}function wx(s){const e=[],n=[];tc.forEach(r=>s.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),tc=e}const kx=new Set;function Ix(s,e){s&&s.i&&(kx.delete(s),s.i(e))}function Sx(s,e,n){const{fragment:r,after_update:a}=s.$$;r&&r.m(e,n),_p(()=>{const h=s.$$.on_mount.map(rv).filter(sv);s.$$.on_destroy?s.$$.on_destroy.push(...h):nd(h),s.$$.on_mount=[]}),a.forEach(_p)}function Ex(s,e){const n=s.$$;n.fragment!==null&&(wx(n.after_update),nd(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ax(s,e){s.$$.dirty[0]===-1&&(Ku.push(s),bx(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function Tx(s,e,n,r,a,h,m=null,l=[-1]){const x=jp;wh(s);const S=s.$$={fragment:null,ctx:[],props:h,update:Ch,not_equal:a,bound:Gg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:Gg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let T=!1;if(S.ctx=n?n(s,e.props||{},(C,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[C],S.ctx[C]=U)&&(!S.skip_bound&&S.bound[C]&&S.bound[C](U),T&&Ax(s,C)),N}):[],S.update(),T=!0,nd(S.before_update),S.fragment=r?r(S.ctx):!1,e.target){if(e.hydrate){const C=yx(e.target);S.fragment&&S.fragment.l(C),C.forEach(ov)}else S.fragment&&S.fragment.c();e.intro&&Ix(s.$$.fragment),Sx(s,e.target,e.anchor),av()}wh(x)}class Cx{constructor(){Vg(this,"$$"),Vg(this,"$$set")}$destroy(){Ex(this,1),this.$destroy=Ch}$on(e,n){if(!sv(n))return Ch;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const a=r.indexOf(n);a!==-1&&r.splice(a,1)}}$set(e){this.$$set&&!mx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Lx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Lx);function Mx(s){let e,n,r;return{c(){e=Zg("svg"),n=Zg("path"),dl(n,"stroke-width","4"),dl(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),dl(n,"class","svelte-gzo3ar"),dl(e,"width",r=s[0]==="list"?20:void 0),dl(e,"viewBox","0 0 70 85"),dl(e,"fill","none"),dl(e,"class","svelte-gzo3ar"),_f(e,"in-map",s[0]!=="list"),_f(e,"list-icon",s[0]==="list")},m(a,h){_x(a,e,h),gx(e,n)},p(a,[h]){h&1&&r!==(r=a[0]==="list"?20:void 0)&&dl(e,"width",r),h&1&&_f(e,"in-map",a[0]!=="list"),h&1&&_f(e,"list-icon",a[0]==="list")},i:Ch,o:Ch,d(a){a&&ov(e)}}}function Rx(s,e,n){let{displayIn:r}=e;return s.$$set=a=>{"displayIn"in a&&n(0,r=a.displayIn)},[r]}class Px extends Cx{constructor(e){super(),Tx(this,e,Rx,Mx,px,{displayIn:0})}}const Dx=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Nx={decimalLatitude:40.123,decimalLongitude:-74.123},zx=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Fx=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Ox(){const s=[];return Dx.forEach(e=>{e.decimalLatitude?s.push(e):s.push({...e,...Nx})}),[...s,...zx,...Fx]}const Bx=Ox();Bx.map(s=>s.verbatimCoordinates);var Bs=63710088e-1,lv={centimeters:Bs*100,centimetres:Bs*100,degrees:360/(2*Math.PI),feet:Bs*3.28084,inches:Bs*39.37,kilometers:Bs/1e3,kilometres:Bs/1e3,meters:Bs,metres:Bs,miles:Bs/1609.344,millimeters:Bs*1e3,millimetres:Bs*1e3,nauticalmiles:Bs/1852,radians:1,yards:Bs*1.0936};function zh(s,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=s,r}function Ux(s,e,n={}){if(!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wg(s[0])||!Wg(s[1]))throw new Error("coordinates must contain numbers");return zh({type:"Point",coordinates:s},e,n)}function qp(s,e,n={}){for(const r of s){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<r[r.length-1].length;a++)if(r[r.length-1][a]!==r[0][a])throw new Error("First and last Position are not equivalent.")}return zh({type:"Polygon",coordinates:s},e,n)}function ru(s,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=s,n}function uv(s,e,n={}){return zh({type:"MultiPolygon",coordinates:s},e,n)}function jx(s,e="kilometers"){const n=lv[e];if(!n)throw new Error(e+" units is invalid");return s*n}function qx(s,e="kilometers"){const n=lv[e];if(!n)throw new Error(e+" units is invalid");return s/n}function Wg(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Vx(s,e){var n={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},r,a,h,m;return m={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function l(S){return function(T){return x([S,T])}}function x(S){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(h=S[0]&2?a.return:S[0]?a.throw||((h=a.return)&&h.call(a),0):a.next)&&!(h=h.call(a,S[1])).done)return h;switch(a=0,h&&(S=[S[0]&2,h.value]),S[0]){case 0:case 1:h=S;break;case 4:return n.label++,{value:S[1],done:!1};case 5:n.label++,a=S[1],S=[0];continue;case 7:S=n.ops.pop(),n.trys.pop();continue;default:if(h=n.trys,!(h=h.length>0&&h[h.length-1])&&(S[0]===6||S[0]===2)){n=0;continue}if(S[0]===3&&(!h||S[1]>h[0]&&S[1]<h[3])){n.label=S[1];break}if(S[0]===6&&n.label<h[1]){n.label=h[1],h=S;break}if(h&&n.label<h[2]){n.label=h[2],n.ops.push(S);break}h[2]&&n.ops.pop(),n.trys.pop();continue}S=e.call(s,n)}catch(T){S=[6,T],a=0}finally{r=h=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}}var bl=function(){function s(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return s}();function Gx(s,e){return s>e?1:s<e?-1:0}function gl(s,e,n){for(var r=new bl(null,null),a=r,h=r;;){var m=n(s,e.key);if(m<0){if(e.left===null)break;if(n(s,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}h.left=e,h=e,e=e.left}else if(m>0){if(e.right===null)break;if(n(s,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}a.right=e,a=e,e=e.right}else break}return a.right=e.left,h.left=e.right,e.left=r.right,e.right=r.left,e}function rp(s,e,n,r){var a=new bl(s,e);if(n===null)return a.left=a.right=null,a;n=gl(s,n,r);var h=r(s,n.key);return h<0?(a.left=n.left,a.right=n,n.left=null):h>=0&&(a.right=n.right,a.left=n,n.right=null),a}function Kg(s,e,n){var r=null,a=null;if(e){e=gl(s,e,n);var h=n(e.key,s);h===0?(r=e.left,a=e.right):h<0?(a=e.right,e.right=null,r=e):(r=e.left,e.left=null,a=e)}return{left:r,right:a}}function Zx(s,e,n){return e===null?s:(s===null||(e=gl(s.key,e,n),e.left=s),e)}function yp(s,e,n,r,a){if(s){r(""+e+(n?" ":" ")+a(s)+`
`);var h=e+(n?"    ":"   ");s.left&&yp(s.left,h,!1,r,a),s.right&&yp(s.right,h,!0,r,a)}}var Vp=function(){function s(e){e===void 0&&(e=Gx),this._root=null,this._size=0,this._comparator=e}return s.prototype.insert=function(e,n){return this._size++,this._root=rp(e,n,this._root,this._comparator)},s.prototype.add=function(e,n){var r=new bl(e,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var a=this._comparator,h=gl(e,this._root,a),m=a(e,h.key);return m===0?this._root=h:(m<0?(r.left=h.left,r.right=h,h.left=null):m>0&&(r.right=h.right,r.left=h,h.right=null),this._size++,this._root=r),this._root},s.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},s.prototype._remove=function(e,n,r){var a;if(n===null)return null;n=gl(e,n,r);var h=r(e,n.key);return h===0?(n.left===null?a=n.right:(a=gl(e,n.left,r),a.right=n.right),this._size--,a):n},s.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=gl(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},s.prototype.findStatic=function(e){for(var n=this._root,r=this._comparator;n;){var a=r(e,n.key);if(a===0)return n;a<0?n=n.left:n=n.right}return null},s.prototype.find=function(e){return this._root&&(this._root=gl(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},s.prototype.contains=function(e){for(var n=this._root,r=this._comparator;n;){var a=r(e,n.key);if(a===0)return!0;a<0?n=n.left:n=n.right}return!1},s.prototype.forEach=function(e,n){for(var r=this._root,a=[],h=!1;!h;)r!==null?(a.push(r),r=r.left):a.length!==0?(r=a.pop(),e.call(n,r),r=r.right):h=!0;return this},s.prototype.range=function(e,n,r,a){for(var h=[],m=this._comparator,l=this._root,x;h.length!==0||l;)if(l)h.push(l),l=l.left;else{if(l=h.pop(),x=m(l.key,n),x>0)break;if(m(l.key,e)>=0&&r.call(a,l))return this;l=l.right}return this},s.prototype.keys=function(){var e=[];return this.forEach(function(n){var r=n.key;return e.push(r)}),e},s.prototype.values=function(){var e=[];return this.forEach(function(n){var r=n.data;return e.push(r)}),e},s.prototype.min=function(){return this._root?this.minNode(this._root).key:null},s.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},s.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},s.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},s.prototype.at=function(e){for(var n=this._root,r=!1,a=0,h=[];!r;)if(n)h.push(n),n=n.left;else if(h.length>0){if(n=h.pop(),a===e)return n;a++,n=n.right}else r=!0;return null},s.prototype.next=function(e){var n=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var a=this._comparator;n;){var h=a(e.key,n.key);if(h===0)break;h<0?(r=n,n=n.left):n=n.right}return r},s.prototype.prev=function(e){var n=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var a=this._comparator;n;){var h=a(e.key,n.key);if(h===0)break;h<0?n=n.left:(r=n,n=n.right)}return r},s.prototype.clear=function(){return this._root=null,this._size=0,this},s.prototype.toList=function(){return Xx(this._root)},s.prototype.load=function(e,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var a=e.length,h=this._comparator;if(r&&xp(e,n,0,a-1,h),this._root===null)this._root=vp(e,n,0,a),this._size=a;else{var m=Wx(this.toList(),Hx(e,n),h);a=this._size+a,this._root=bp({head:m},0,a)}return this},s.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(s.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),s.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var n=[];return yp(this._root,"",!0,function(r){return n.push(r)},e),n.join("")},s.prototype.update=function(e,n,r){var a=this._comparator,h=Kg(e,this._root,a),m=h.left,l=h.right;a(e,n)<0?l=rp(n,r,l,a):m=rp(n,r,m,a),this._root=Zx(m,l,a)},s.prototype.split=function(e){return Kg(e,this._root,this._comparator)},s.prototype[Symbol.iterator]=function(){var e,n,r;return Vx(this,function(a){switch(a.label){case 0:e=this._root,n=[],r=!1,a.label=1;case 1:return r?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return a.sent(),e=e.right,[3,5];case 4:r=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},s}();function vp(s,e,n,r){var a=r-n;if(a>0){var h=n+Math.floor(a/2),m=s[h],l=e[h],x=new bl(m,l);return x.left=vp(s,e,n,h),x.right=vp(s,e,h+1,r),x}return null}function Hx(s,e){for(var n=new bl(null,null),r=n,a=0;a<s.length;a++)r=r.next=new bl(s[a],e[a]);return r.next=null,n.next}function Xx(s){for(var e=s,n=[],r=!1,a=new bl(null,null),h=a;!r;)e?(n.push(e),e=e.left):n.length>0?(e=h=h.next=n.pop(),e=e.right):r=!0;return h.next=null,a.next}function bp(s,e,n){var r=n-e;if(r>0){var a=e+Math.floor(r/2),h=bp(s,e,a),m=s.head;return m.left=h,s.head=s.head.next,m.right=bp(s,a+1,n),m}return null}function Wx(s,e,n){for(var r=new bl(null,null),a=r,h=s,m=e;h!==null&&m!==null;)n(h.key,m.key)<0?(a.next=h,h=h.next):(a.next=m,m=m.next),a=a.next;return h!==null?a.next=h:m!==null&&(a.next=m),r.next}function xp(s,e,n,r,a){if(!(n>=r)){for(var h=s[n+r>>1],m=n-1,l=r+1;;){do m++;while(a(s[m],h)<0);do l--;while(a(s[l],h)>0);if(m>=l)break;var x=s[m];s[m]=s[l],s[l]=x,x=e[m],e[m]=e[l],e[l]=x}xp(s,e,n,l,a),xp(s,e,l+1,r,a)}}const Na=11102230246251565e-32,fs=134217729,Kx=(3+8*Na)*Na;function sp(s,e,n,r,a){let h,m,l,x,S=e[0],T=r[0],C=0,N=0;T>S==T>-S?(h=S,S=e[++C]):(h=T,T=r[++N]);let B=0;if(C<s&&N<n)for(T>S==T>-S?(m=S+h,l=h-(m-S),S=e[++C]):(m=T+h,l=h-(m-T),T=r[++N]),h=m,l!==0&&(a[B++]=l);C<s&&N<n;)T>S==T>-S?(m=h+S,x=m-h,l=h-(m-x)+(S-x),S=e[++C]):(m=h+T,x=m-h,l=h-(m-x)+(T-x),T=r[++N]),h=m,l!==0&&(a[B++]=l);for(;C<s;)m=h+S,x=m-h,l=h-(m-x)+(S-x),S=e[++C],h=m,l!==0&&(a[B++]=l);for(;N<n;)m=h+T,x=m-h,l=h-(m-x)+(T-x),T=r[++N],h=m,l!==0&&(a[B++]=l);return(h!==0||B===0)&&(a[B++]=h),B}function $x(s,e){let n=e[0];for(let r=1;r<s;r++)n+=e[r];return n}function Fh(s){return new Float64Array(s)}const Yx=(3+16*Na)*Na,Jx=(2+12*Na)*Na,Qx=(9+64*Na)*Na*Na,Gu=Fh(4),$g=Fh(8),Yg=Fh(12),Jg=Fh(16),As=Fh(4);function ew(s,e,n,r,a,h,m){let l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe,ve,De,he,xe;const be=s-a,Ce=n-a,we=e-h,ye=r-h;pe=be*ye,N=fs*be,B=N-(N-be),U=be-B,N=fs*ye,ee=N-(N-ye),ie=ye-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=we*Ce,N=fs*we,B=N-(N-we),U=we-B,N=fs*Ce,ee=N-(N-Ce),ie=Ce-ee,he=U*ie-(De-B*ee-U*ee-B*ie),se=ve-he,C=ve-se,Gu[0]=ve-(se+C)+(C-he),Q=pe+se,C=Q-pe,K=pe-(Q-C)+(se-C),se=K-De,C=K-se,Gu[1]=K-(se+C)+(C-De),xe=Q+se,C=xe-Q,Gu[2]=Q-(xe-C)+(se-C),Gu[3]=xe;let Ue=$x(4,Gu),qe=Jx*m;if(Ue>=qe||-Ue>=qe||(C=s-be,l=s-(be+C)+(C-a),C=n-Ce,S=n-(Ce+C)+(C-a),C=e-we,x=e-(we+C)+(C-h),C=r-ye,T=r-(ye+C)+(C-h),l===0&&x===0&&S===0&&T===0)||(qe=Qx*m+Kx*Math.abs(Ue),Ue+=be*T+ye*l-(we*S+Ce*x),Ue>=qe||-Ue>=qe))return Ue;pe=l*ye,N=fs*l,B=N-(N-l),U=l-B,N=fs*ye,ee=N-(N-ye),ie=ye-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=x*Ce,N=fs*x,B=N-(N-x),U=x-B,N=fs*Ce,ee=N-(N-Ce),ie=Ce-ee,he=U*ie-(De-B*ee-U*ee-B*ie),se=ve-he,C=ve-se,As[0]=ve-(se+C)+(C-he),Q=pe+se,C=Q-pe,K=pe-(Q-C)+(se-C),se=K-De,C=K-se,As[1]=K-(se+C)+(C-De),xe=Q+se,C=xe-Q,As[2]=Q-(xe-C)+(se-C),As[3]=xe;const pt=sp(4,Gu,4,As,$g);pe=be*T,N=fs*be,B=N-(N-be),U=be-B,N=fs*T,ee=N-(N-T),ie=T-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=we*S,N=fs*we,B=N-(N-we),U=we-B,N=fs*S,ee=N-(N-S),ie=S-ee,he=U*ie-(De-B*ee-U*ee-B*ie),se=ve-he,C=ve-se,As[0]=ve-(se+C)+(C-he),Q=pe+se,C=Q-pe,K=pe-(Q-C)+(se-C),se=K-De,C=K-se,As[1]=K-(se+C)+(C-De),xe=Q+se,C=xe-Q,As[2]=Q-(xe-C)+(se-C),As[3]=xe;const St=sp(pt,$g,4,As,Yg);pe=l*T,N=fs*l,B=N-(N-l),U=l-B,N=fs*T,ee=N-(N-T),ie=T-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=x*S,N=fs*x,B=N-(N-x),U=x-B,N=fs*S,ee=N-(N-S),ie=S-ee,he=U*ie-(De-B*ee-U*ee-B*ie),se=ve-he,C=ve-se,As[0]=ve-(se+C)+(C-he),Q=pe+se,C=Q-pe,K=pe-(Q-C)+(se-C),se=K-De,C=K-se,As[1]=K-(se+C)+(C-De),xe=Q+se,C=xe-Q,As[2]=Q-(xe-C)+(se-C),As[3]=xe;const dt=sp(St,Yg,4,As,Jg);return Jg[dt-1]}function tw(s,e,n,r,a,h){const m=(e-h)*(n-a),l=(s-a)*(r-h),x=m-l,S=Math.abs(m+l);return Math.abs(x)>=Yx*S?x:-ew(s,e,n,r,a,h,S)}const uh=(s,e)=>s.ll.x<=e.x&&e.x<=s.ur.x&&s.ll.y<=e.y&&e.y<=s.ur.y,wp=(s,e)=>{if(e.ur.x<s.ll.x||s.ur.x<e.ll.x||e.ur.y<s.ll.y||s.ur.y<e.ll.y)return null;const n=s.ll.x<e.ll.x?e.ll.x:s.ll.x,r=s.ur.x<e.ur.x?s.ur.x:e.ur.x,a=s.ll.y<e.ll.y?e.ll.y:s.ll.y,h=s.ur.y<e.ur.y?s.ur.y:e.ur.y;return{ll:{x:n,y:a},ur:{x:r,y:h}}};let _l=Number.EPSILON;_l===void 0&&(_l=Math.pow(2,-52));const nw=_l*_l,Qg=(s,e)=>{if(-_l<s&&s<_l&&-_l<e&&e<_l)return 0;const n=s-e;return n*n<nw*s*e?0:s<e?-1:1};class iw{constructor(){this.reset()}reset(){this.xRounder=new e_,this.yRounder=new e_}round(e,n){return{x:this.xRounder.round(e),y:this.yRounder.round(n)}}}class e_{constructor(){this.tree=new Vp,this.round(0)}round(e){const n=this.tree.add(e),r=this.tree.prev(n);if(r!==null&&Qg(n.key,r.key)===0)return this.tree.remove(e),r.key;const a=this.tree.next(n);return a!==null&&Qg(n.key,a.key)===0?(this.tree.remove(e),a.key):e}}const Lh=new iw,Tf=(s,e)=>s.x*e.y-s.y*e.x,cv=(s,e)=>s.x*e.x+s.y*e.y,t_=(s,e,n)=>{const r=tw(s.x,s.y,e.x,e.y,n.x,n.y);return r>0?-1:r<0?1:0},zf=s=>Math.sqrt(cv(s,s)),rw=(s,e,n)=>{const r={x:e.x-s.x,y:e.y-s.y},a={x:n.x-s.x,y:n.y-s.y};return Tf(a,r)/zf(a)/zf(r)},sw=(s,e,n)=>{const r={x:e.x-s.x,y:e.y-s.y},a={x:n.x-s.x,y:n.y-s.y};return cv(a,r)/zf(a)/zf(r)},n_=(s,e,n)=>e.y===0?null:{x:s.x+e.x/e.y*(n-s.y),y:n},i_=(s,e,n)=>e.x===0?null:{x:n,y:s.y+e.y/e.x*(n-s.x)},ow=(s,e,n,r)=>{if(e.x===0)return i_(n,r,s.x);if(r.x===0)return i_(s,e,n.x);if(e.y===0)return n_(n,r,s.y);if(r.y===0)return n_(s,e,n.y);const a=Tf(e,r);if(a==0)return null;const h={x:n.x-s.x,y:n.y-s.y},m=Tf(h,e)/a,l=Tf(h,r)/a,x=s.x+l*e.x,S=n.x+m*r.x,T=s.y+l*e.y,C=n.y+m*r.y,N=(x+S)/2,B=(T+C)/2;return{x:N,y:B}};class yo{static compare(e,n){const r=yo.comparePoints(e.point,n.point);return r!==0?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:vl.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0}constructor(e,n){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let r=0,a=n.length;r<a;r++){const h=n[r];this.point.events.push(h),h.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const r=this.point.events[n];if(r.segment.consumedBy===void 0)for(let a=n+1;a<e;a++){const h=this.point.events[a];h.consumedBy===void 0&&r.otherSE.point.events===h.otherSE.point.events&&r.segment.consume(h.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,r=this.point.events.length;n<r;n++){const a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&e.push(a)}return e}getLeftmostComparator(e){const n=new Map,r=a=>{const h=a.otherSE;n.set(a,{sine:rw(this.point,e.point,h.point),cosine:sw(this.point,e.point,h.point)})};return(a,h)=>{n.has(a)||r(a),n.has(h)||r(h);const{sine:m,cosine:l}=n.get(a),{sine:x,cosine:S}=n.get(h);return m>=0&&x>=0?l<S?1:l>S?-1:0:m<0&&x<0?l<S?-1:l>S?1:0:x<m?-1:x>m?1:0}}}let aw=0;class vl{static compare(e,n){const r=e.leftSE.point.x,a=n.leftSE.point.x,h=e.rightSE.point.x,m=n.rightSE.point.x;if(m<r)return 1;if(h<a)return-1;const l=e.leftSE.point.y,x=n.leftSE.point.y,S=e.rightSE.point.y,T=n.rightSE.point.y;if(r<a){if(x<l&&x<S)return 1;if(x>l&&x>S)return-1;const C=e.comparePoint(n.leftSE.point);if(C<0)return 1;if(C>0)return-1;const N=n.comparePoint(e.rightSE.point);return N!==0?N:-1}if(r>a){if(l<x&&l<T)return-1;if(l>x&&l>T)return 1;const C=n.comparePoint(e.leftSE.point);if(C!==0)return C;const N=e.comparePoint(n.rightSE.point);return N<0?1:N>0?-1:1}if(l<x)return-1;if(l>x)return 1;if(h<m){const C=n.comparePoint(e.rightSE.point);if(C!==0)return C}if(h>m){const C=e.comparePoint(n.rightSE.point);if(C<0)return 1;if(C>0)return-1}if(h!==m){const C=S-l,N=h-r,B=T-x,U=m-a;if(C>N&&B<U)return 1;if(C<N&&B>U)return-1}return h>m?1:h<m||S<T?-1:S>T?1:e.id<n.id?-1:e.id>n.id?1:0}constructor(e,n,r,a){this.id=++aw,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=a}static fromRing(e,n,r){let a,h,m;const l=yo.comparePoints(e,n);if(l<0)a=e,h=n,m=1;else if(l>0)a=n,h=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const x=new yo(a,!0),S=new yo(h,!1);return new vl(x,S,[r],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<n?e:n},ur:{x:this.rightSE.point.x,y:e>n?e:n}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const n=this.leftSE.point,r=this.rightSE.point,a=this.vector();if(n.x===r.x)return e.x===n.x?0:e.x<n.x?1:-1;const h=(e.y-n.y)/a.y,m=n.x+h*a.x;if(e.x===m)return 0;const l=(e.x-n.x)/a.x,x=n.y+l*a.y;return e.y===x?0:e.y<x?-1:1}getIntersection(e){const n=this.bbox(),r=e.bbox(),a=wp(n,r);if(a===null)return null;const h=this.leftSE.point,m=this.rightSE.point,l=e.leftSE.point,x=e.rightSE.point,S=uh(n,l)&&this.comparePoint(l)===0,T=uh(r,h)&&e.comparePoint(h)===0,C=uh(n,x)&&this.comparePoint(x)===0,N=uh(r,m)&&e.comparePoint(m)===0;if(T&&S)return N&&!C?m:!N&&C?x:null;if(T)return C&&h.x===x.x&&h.y===x.y?null:h;if(S)return N&&m.x===l.x&&m.y===l.y?null:l;if(N&&C)return null;if(N)return m;if(C)return x;const B=ow(h,this.vector(),l,e.vector());return B===null||!uh(a,B)?null:Lh.round(B.x,B.y)}split(e){const n=[],r=e.events!==void 0,a=new yo(e,!0),h=new yo(e,!1),m=this.rightSE;this.replaceRightSE(h),n.push(h),n.push(a);const l=new vl(a,m,this.rings.slice(),this.windings.slice());return yo.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),yo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(a.checkForConsuming(),h.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}consume(e){let n=this,r=e;for(;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const a=vl.compare(n,r);if(a!==0){if(a>0){const h=n;n=r,r=h}if(n.prev===r){const h=n;n=r,r=h}for(let h=0,m=r.rings.length;h<m;h++){const l=r.rings[h],x=r.windings[h],S=n.rings.indexOf(l);S===-1?(n.rings.push(l),n.windings.push(x)):n.windings[S]+=x}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,r=this._afterState.windings,a=this._afterState.multiPolys;for(let l=0,x=this.rings.length;l<x;l++){const S=this.rings[l],T=this.windings[l],C=n.indexOf(S);C===-1?(n.push(S),r.push(T)):r[C]+=T}const h=[],m=[];for(let l=0,x=n.length;l<x;l++){if(r[l]===0)continue;const S=n[l],T=S.poly;if(m.indexOf(T)===-1)if(S.isExterior)h.push(T);else{m.indexOf(T)===-1&&m.push(T);const C=h.indexOf(S.poly);C!==-1&&h.splice(C,1)}}for(let l=0,x=h.length;l<x;l++){const S=h[l].multiPoly;a.indexOf(S)===-1&&a.push(S)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ro.type){case"union":{const r=e.length===0,a=n.length===0;this._isInResult=r!==a;break}case"intersection":{let r,a;e.length<n.length?(r=e.length,a=n.length):(r=n.length,a=e.length),this._isInResult=a===Ro.numMultiPolys&&r<a;break}case"xor":{const r=Math.abs(e.length-n.length);this._isInResult=r%2===1;break}case"difference":{const r=a=>a.length===1&&a[0].isSubject;this._isInResult=r(e)!==r(n);break}default:throw new Error(`Unrecognized operation type found ${Ro.type}`)}return this._isInResult}}class r_{constructor(e,n,r){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=Lh.round(e[0][0],e[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let h=a;for(let m=1,l=e.length;m<l;m++){if(typeof e[m][0]!="number"||typeof e[m][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let x=Lh.round(e[m][0],e[m][1]);x.x===h.x&&x.y===h.y||(this.segments.push(vl.fromRing(h,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),h=x)}(a.x!==h.x||a.y!==h.y)&&this.segments.push(vl.fromRing(h,a,this))}getSweepEvents(){const e=[];for(let n=0,r=this.segments.length;n<r;n++){const a=this.segments[n];e.push(a.leftSE),e.push(a.rightSE)}return e}}class lw{constructor(e,n){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new r_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,a=e.length;r<a;r++){const h=new r_(e[r],this,!1);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.interiorRings.push(h)}this.multiPoly=n}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let n=0,r=this.interiorRings.length;n<r;n++){const a=this.interiorRings[n].getSweepEvents();for(let h=0,m=a.length;h<m;h++)e.push(a[h])}return e}}class s_{constructor(e,n){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let r=0,a=e.length;r<a;r++){const h=new lw(e[r],this);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.polys.push(h)}this.isSubject=n}getSweepEvents(){const e=[];for(let n=0,r=this.polys.length;n<r;n++){const a=this.polys[n].getSweepEvents();for(let h=0,m=a.length;h<m;h++)e.push(a[h])}return e}}class Ff{static factory(e){const n=[];for(let r=0,a=e.length;r<a;r++){const h=e[r];if(!h.isInResult()||h.ringOut)continue;let m=null,l=h.leftSE,x=h.rightSE;const S=[l],T=l.point,C=[];for(;m=l,l=x,S.push(l),l.point!==T;)for(;;){const N=l.getAvailableLinkedEvents();if(N.length===0){const ee=S[0].point,ie=S[S.length-1].point;throw new Error(`Unable to complete output ring starting at [${ee.x}, ${ee.y}]. Last matching segment found ends at [${ie.x}, ${ie.y}].`)}if(N.length===1){x=N[0].otherSE;break}let B=null;for(let ee=0,ie=C.length;ee<ie;ee++)if(C[ee].point===l.point){B=ee;break}if(B!==null){const ee=C.splice(B)[0],ie=S.splice(ee.index);ie.unshift(ie[0].otherSE),n.push(new Ff(ie.reverse()));continue}C.push({index:S.length,point:l.point});const U=l.getLeftmostComparator(m);x=N.sort(U)[0].otherSE;break}n.push(new Ff(S))}return n}constructor(e){this.events=e;for(let n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const n=[e];for(let S=1,T=this.events.length-1;S<T;S++){const C=this.events[S].point,N=this.events[S+1].point;t_(C,e,N)!==0&&(n.push(C),e=C)}if(n.length===1)return null;const r=n[0],a=n[1];t_(r,e,a)===0&&n.shift(),n.push(n[0]);const h=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,l=this.isExteriorRing()?n.length:-1,x=[];for(let S=m;S!=l;S+=h)x.push([n[S].x,n[S].y]);return x}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let a=1,h=this.events.length;a<h;a++){const m=this.events[a];yo.compare(e,m)>0&&(e=m)}let n=e.segment.prevInResult(),r=n?n.prevInResult():null;for(;;){if(!n)return null;if(!r)return n.ringOut;if(r.ringOut!==n.ringOut)return r.ringOut.enclosingRing()!==n.ringOut?n.ringOut:n.ringOut.enclosingRing();n=r.prevInResult(),r=n?n.prevInResult():null}}}class o_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let n=0,r=this.interiorRings.length;n<r;n++){const a=this.interiorRings[n].getGeom();a!==null&&e.push(a)}return e}}let uw=class{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let n=0,r=this.polys.length;n<r;n++){const a=this.polys[n].getGeom();a!==null&&e.push(a)}return e}_composePolys(e){const n=[];for(let r=0,a=e.length;r<a;r++){const h=e[r];if(!h.poly)if(h.isExteriorRing())n.push(new o_(h));else{const m=h.enclosingRing();m.poly||n.push(new o_(m)),m.poly.addInterior(h)}}return n}};class cw{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vl.compare;this.queue=e,this.tree=new Vp(n),this.segments=[]}process(e){const n=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(n),r;const a=e.isLeft?this.tree.add(n):this.tree.find(n);if(!a)throw new Error(`Unable to find segment #${n.id} [${n.leftSE.point.x}, ${n.leftSE.point.y}] -> [${n.rightSE.point.x}, ${n.rightSE.point.y}] in SweepLine tree.`);let h=a,m=a,l,x;for(;l===void 0;)h=this.tree.prev(h),h===null?l=null:h.key.consumedBy===void 0&&(l=h.key);for(;x===void 0;)m=this.tree.next(m),m===null?x=null:m.key.consumedBy===void 0&&(x=m.key);if(e.isLeft){let S=null;if(l){const C=l.getIntersection(n);if(C!==null&&(n.isAnEndpoint(C)||(S=C),!l.isAnEndpoint(C))){const N=this._splitSafely(l,C);for(let B=0,U=N.length;B<U;B++)r.push(N[B])}}let T=null;if(x){const C=x.getIntersection(n);if(C!==null&&(n.isAnEndpoint(C)||(T=C),!x.isAnEndpoint(C))){const N=this._splitSafely(x,C);for(let B=0,U=N.length;B<U;B++)r.push(N[B])}}if(S!==null||T!==null){let C=null;S===null?C=T:T===null?C=S:C=yo.comparePoints(S,T)<=0?S:T,this.queue.remove(n.rightSE),r.push(n.rightSE);const N=n.split(C);for(let B=0,U=N.length;B<U;B++)r.push(N[B])}r.length>0?(this.tree.remove(n),r.push(e)):(this.segments.push(n),n.prev=l)}else{if(l&&x){const S=l.getIntersection(x);if(S!==null){if(!l.isAnEndpoint(S)){const T=this._splitSafely(l,S);for(let C=0,N=T.length;C<N;C++)r.push(T[C])}if(!x.isAnEndpoint(S)){const T=this._splitSafely(x,S);for(let C=0,N=T.length;C<N;C++)r.push(T[C])}}}this.tree.remove(n)}return r}_splitSafely(e,n){this.tree.remove(e);const r=e.rightSE;this.queue.remove(r);const a=e.split(n);return a.push(r),e.consumedBy===void 0&&this.tree.add(e),a}}const a_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,hw=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class fw{run(e,n,r){Ro.type=e,Lh.reset();const a=[new s_(n,!0)];for(let T=0,C=r.length;T<C;T++)a.push(new s_(r[T],!1));if(Ro.numMultiPolys=a.length,Ro.type==="difference"){const T=a[0];let C=1;for(;C<a.length;)wp(a[C].bbox,T.bbox)!==null?C++:a.splice(C,1)}if(Ro.type==="intersection")for(let T=0,C=a.length;T<C;T++){const N=a[T];for(let B=T+1,U=a.length;B<U;B++)if(wp(N.bbox,a[B].bbox)===null)return[]}const h=new Vp(yo.compare);for(let T=0,C=a.length;T<C;T++){const N=a[T].getSweepEvents();for(let B=0,U=N.length;B<U;B++)if(h.insert(N[B]),h.size>a_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const m=new cw(h);let l=h.size,x=h.pop();for(;x;){const T=x.key;if(h.size===l){const N=T.segment;throw new Error(`Unable to pop() ${T.isLeft?"left":"right"} SweepEvent [${T.point.x}, ${T.point.y}] from segment #${N.id} [${N.leftSE.point.x}, ${N.leftSE.point.y}] -> [${N.rightSE.point.x}, ${N.rightSE.point.y}] from queue.`)}if(h.size>a_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(m.segments.length>hw)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const C=m.process(T);for(let N=0,B=C.length;N<B;N++){const U=C[N];U.consumedBy===void 0&&h.insert(U)}l=h.size,x=h.pop()}Lh.reset();const S=Ff.factory(m.segments);return new uw(S).getGeom()}}const Ro=new fw,dw=function(s){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ro.run("union",s,n)},pw=function(s){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ro.run("intersection",s,n)},mw=function(s){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ro.run("xor",s,n)},gw=function(s){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ro.run("difference",s,n)};var hv={union:dw,intersection:pw,xor:mw,difference:gw};function fv(s,e,n){if(s!==null)for(var r,a,h,m,l,x,S,T=0,C=0,N,B=s.type,U=B==="FeatureCollection",ee=B==="Feature",ie=U?s.features.length:1,se=0;se<ie;se++){S=U?s.features[se].geometry:ee?s.geometry:s,N=S?S.type==="GeometryCollection":!1,l=N?S.geometries.length:1;for(var Q=0;Q<l;Q++){var K=0,pe=0;if(m=N?S.geometries[Q]:S,m!==null){x=m.coordinates;var ve=m.type;switch(T=0,ve){case null:break;case"Point":if(e(x,C,se,K,pe)===!1)return!1;C++,K++;break;case"LineString":case"MultiPoint":for(r=0;r<x.length;r++){if(e(x[r],C,se,K,pe)===!1)return!1;C++,ve==="MultiPoint"&&K++}ve==="LineString"&&K++;break;case"Polygon":case"MultiLineString":for(r=0;r<x.length;r++){for(a=0;a<x[r].length-T;a++){if(e(x[r][a],C,se,K,pe)===!1)return!1;C++}ve==="MultiLineString"&&K++,ve==="Polygon"&&pe++}ve==="Polygon"&&K++;break;case"MultiPolygon":for(r=0;r<x.length;r++){for(pe=0,a=0;a<x[r].length;a++){for(h=0;h<x[r][a].length-T;h++){if(e(x[r][a][h],C,se,K,pe)===!1)return!1;C++}pe++}K++}break;case"GeometryCollection":for(r=0;r<m.geometries.length;r++)if(fv(m.geometries[r],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function l_(s,e){if(s.type==="Feature")e(s,0);else if(s.type==="FeatureCollection")for(var n=0;n<s.features.length&&e(s.features[n],n)!==!1;n++);}function id(s,e){var n,r,a,h,m,l,x,S,T,C,N=0,B=s.type==="FeatureCollection",U=s.type==="Feature",ee=B?s.features.length:1;for(n=0;n<ee;n++){for(l=B?s.features[n].geometry:U?s.geometry:s,S=B?s.features[n].properties:U?s.properties:{},T=B?s.features[n].bbox:U?s.bbox:void 0,C=B?s.features[n].id:U?s.id:void 0,x=l?l.type==="GeometryCollection":!1,m=x?l.geometries.length:1,a=0;a<m;a++){if(h=x?l.geometries[a]:l,h===null){if(e(null,N,S,T,C)===!1)return!1;continue}switch(h.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(h,N,S,T,C)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<h.geometries.length;r++)if(e(h.geometries[r],N,S,T,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}N++}}function _w(s,e={}){const n=[];if(id(s,a=>{n.push(a.coordinates)}),n.length<2)throw new Error("Must have at least 2 geometries");const r=hv.union(n[0],...n.slice(1));return r.length===0?null:r.length===1?qp(r[0],e.properties):uv(r,e.properties)}var yw=_w;function vw(s,e={}){if(s.bbox!=null&&e.recompute!==!0)return s.bbox;const n=[1/0,1/0,-1/0,-1/0];return fv(s,r=>{n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}function bw(s,e={}){const n=vw(s),r=(n[0]+n[2])/2,a=(n[1]+n[3])/2;return Ux([r,a],e.properties,e)}var xw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ww(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var dv={exports:{}};(function(s,e){(function(n,r){s.exports=r()})(xw,function(){function n(I,c){if(!(I instanceof c))throw new TypeError("Cannot call a class as a function")}function r(I,c){for(var d=0;d<c.length;d++){var p=c[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(I,p.key,p)}}function a(I,c,d){return c&&r(I.prototype,c),d&&r(I,d),I}function h(I,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(c&&c.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),c&&l(I,c)}function m(I){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},m(I)}function l(I,c){return l=Object.setPrototypeOf||function(d,p){return d.__proto__=p,d},l(I,c)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(I,c,d){return S=x()?Reflect.construct:function(p,b,L){var O=[null];O.push.apply(O,b);var V=new(Function.bind.apply(p,O));return L&&l(V,L.prototype),V},S.apply(null,arguments)}function T(I){var c=typeof Map=="function"?new Map:void 0;return T=function(d){if(d===null||(p=d,Function.toString.call(p).indexOf("[native code]")===-1))return d;var p;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(d))return c.get(d);c.set(d,b)}function b(){return S(d,arguments,m(this).constructor)}return b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),l(b,d)},T(I)}function C(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function N(I,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return C(I)}function B(I){var c=x();return function(){var d,p=m(I);if(c){var b=m(this).constructor;d=Reflect.construct(p,arguments,b)}else d=p.apply(this,arguments);return N(this,d)}}function U(I,c,d){return U=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,b,L){var O=function($,me){for(;!Object.prototype.hasOwnProperty.call($,me)&&($=m($))!==null;);return $}(p,b);if(O){var V=Object.getOwnPropertyDescriptor(O,b);return V.get?V.get.call(L):V.value}},U(I,c,d||I)}function ee(I){return function(c){if(Array.isArray(c))return se(c)}(I)||function(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(I)||ie(I)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ie(I,c){if(I){if(typeof I=="string")return se(I,c);var d=Object.prototype.toString.call(I).slice(8,-1);return d==="Object"&&I.constructor&&(d=I.constructor.name),d==="Map"||d==="Set"?Array.from(I):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?se(I,c):void 0}}function se(I,c){(c==null||c>I.length)&&(c=I.length);for(var d=0,p=new Array(c);d<c;d++)p[d]=I[d];return p}function Q(I,c){var d=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!d){if(Array.isArray(I)||(d=ie(I))||c){d&&(I=d);var p=0,b=function(){};return{s:b,n:function(){return p>=I.length?{done:!0}:{done:!1,value:I[p++]}},e:function($){throw $},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var L,O=!0,V=!1;return{s:function(){d=d.call(I)},n:function(){var $=d.next();return O=$.done,$},e:function($){V=!0,L=$},f:function(){try{O||d.return==null||d.return()}finally{if(V)throw L}}}}var K=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(c){this._quadrantSegments=c,this._quadrantSegments===0&&(this._joinStyle=I.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=I.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),c<=0&&(this._quadrantSegments=1),this._joinStyle!==I.JOIN_ROUND&&(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(c){this._joinStyle=c}},{key:"setSimplifyFactor",value:function(c){this._simplifyFactor=c<0?0:c}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(c){this._endCapStyle=c}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(c){this._mitreLimit=c}},{key:"setSingleSided",value:function(c){this._isSingleSided=c}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=I.CAP_ROUND,this._joinStyle=I.JOIN_ROUND,this._mitreLimit=I.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=I.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var c=arguments[0];this.setQuadrantSegments(c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.setQuadrantSegments(d),this.setEndCapStyle(p)}else if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3];this.setQuadrantSegments(b),this.setEndCapStyle(L),this.setJoinStyle(O),this.setMitreLimit(V)}}}},{key:"bufferDistanceError",value:function(c){var d=Math.PI/2/c;return 1-Math.cos(d/2)}}]),I}();K.CAP_ROUND=1,K.CAP_FLAT=2,K.CAP_SQUARE=3,K.JOIN_ROUND=1,K.JOIN_MITRE=2,K.JOIN_BEVEL=3,K.DEFAULT_QUADRANT_SEGMENTS=8,K.DEFAULT_MITRE_LIMIT=5,K.DEFAULT_SIMPLIFY_FACTOR=.01;var pe=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({Exception:d})[0],b}return a(d,[{key:"toString",value:function(){return this.message}}]),d}(T(Error)),ve=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({IllegalArgumentException:d})[0],b}return d}(pe),De=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}();function he(){}function xe(){}function be(){}var Ce,we,ye,Ue,qe,pt,St,dt,ut=function(){function I(){n(this,I)}return a(I,null,[{key:"equalsWithTolerance",value:function(c,d,p){return Math.abs(c-d)<=p}}]),I}(),Bt=function(){function I(c,d){n(this,I),this.low=d||0,this.high=c||0}return a(I,null,[{key:"toBinaryString",value:function(c){var d,p="";for(d=2147483648;d>0;d>>>=1)p+=(c.high&d)===d?"1":"0";for(d=2147483648;d>0;d>>>=1)p+=(c.low&d)===d?"1":"0";return p}}]),I}();function vt(){}function wt(){}vt.NaN=NaN,vt.isNaN=function(I){return Number.isNaN(I)},vt.isInfinite=function(I){return!Number.isFinite(I)},vt.MAX_VALUE=Number.MAX_VALUE,vt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,vt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(pt=2146435072,St=new Float64Array(1),dt=new Int32Array(St.buffer),vt.doubleToLongBits=function(I){St[0]=I;var c=0|dt[0],d=0|dt[1];return(d&pt)===pt&&1048575&d&&c!==0&&(c=0,d=2146959360),new Bt(d,c)},vt.longBitsToDouble=function(I){return dt[0]=I.low,dt[1]=I.high,St[0]}):(Ce=1023,we=Math.log2,ye=Math.floor,Ue=Math.pow,qe=function(){for(var I=53;I>0;I--){var c=Ue(2,I)-1;if(ye(we(c))+1===I)return c}return 0}(),vt.doubleToLongBits=function(I){var c,d,p,b,L,O,V,$,me;if(I<0||1/I===Number.NEGATIVE_INFINITY?(O=1<<31,I=-I):O=0,I===0)return new Bt($=O,me=0);if(I===1/0)return new Bt($=2146435072|O,me=0);if(I!=I)return new Bt($=2146959360,me=0);if(b=0,me=0,(c=ye(I))>1)if(c<=qe)(b=ye(we(c)))<=20?(me=0,$=c<<20-b&1048575):(me=c%(d=Ue(2,p=b-20))<<32-p,$=c/d&1048575);else for(p=c,me=0;(p=ye(d=p/2))!==0;)b++,me>>>=1,me|=(1&$)<<31,$>>>=1,d!==p&&($|=524288);if(V=b+Ce,L=c===0,c=I-c,b<52&&c!==0)for(p=0;;){if((d=2*c)>=1?(c=d-1,L?(V--,L=!1):(p<<=1,p|=1,b++)):(c=d,L?--V==0&&(b++,L=!1):(p<<=1,b++)),b===20)$|=p,p=0;else if(b===52){me|=p;break}if(d===1){b<20?$|=p<<20-b:b<52&&(me|=p<<52-b);break}}return $|=V<<20,new Bt($|=O,me)},vt.longBitsToDouble=function(I){var c,d,p,b,L=I.high,O=I.low,V=L&1<<31?-1:1;for(p=((2146435072&L)>>20)-Ce,b=0,d=1<<19,c=1;c<=20;c++)L&d&&(b+=Ue(2,-c)),d>>>=1;for(d=1<<31,c=21;c<=52;c++)O&d&&(b+=Ue(2,-c)),d>>>=1;if(p===-1023){if(b===0)return 0*V;p=-1022}else{if(p===1024)return b===0?V/0:NaN;b+=1}return V*b*Ue(2,p)});var ft=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({RuntimeException:d})[0],b}return d}(pe),xt=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){if(arguments.length===0)ft.constructor_.call(this);else if(arguments.length===1){var p=arguments[0];ft.constructor_.call(this,p)}}}]),d}(ft),It=function(){function I(){n(this,I)}return a(I,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)I.shouldNeverReachHere(null);else if(arguments.length===1){var c=arguments[0];throw new xt("Should never reach here"+(c!==null?": "+c:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var c=arguments[0];I.isTrue(c,null)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(!d)throw p===null?new xt:new xt(p)}}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];I.equals(c,d,null)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];if(!b.equals(p))throw new xt("Expected "+p+" but encountered "+b+(L!==null?": "+L:""))}}}]),I}(),Yt=new ArrayBuffer(8),pn=new Float64Array(Yt),Dn=new Int32Array(Yt),We=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(){return vt.NaN}},{key:"setOrdinate",value:function(c,d){switch(c){case I.X:this.x=d;break;case I.Y:this.y=d;break;case I.Z:this.setZ(d);break;default:throw new ve("Invalid ordinate index: "+c)}}},{key:"equals2D",value:function(){if(arguments.length===1){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(arguments.length===2){var d=arguments[0],p=arguments[1];return!!ut.equalsWithTolerance(this.x,d.x,p)&&!!ut.equalsWithTolerance(this.y,d.y,p)}}},{key:"setM",value:function(c){throw new ve("Invalid ordinate index: "+I.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(c){switch(c){case I.X:return this.x;case I.Y:return this.y;case I.Z:return this.getZ()}throw new ve("Invalid ordinate index: "+c)}},{key:"equals3D",value:function(c){return this.x===c.x&&this.y===c.y&&(this.getZ()===c.getZ()||vt.isNaN(this.getZ())&&vt.isNaN(c.getZ()))}},{key:"equals",value:function(c){return c instanceof I&&this.equals2D(c)}},{key:"equalInZ",value:function(c,d){return ut.equalsWithTolerance(this.getZ(),c.getZ(),d)}},{key:"setX",value:function(c){this.x=c}},{key:"compareTo",value:function(c){var d=c;return this.x<d.x?-1:this.x>d.x?1:this.y<d.y?-1:this.y>d.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(c){this.z=c}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return It.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw c}}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(c){var d=this.x-c.x,p=this.y-c.y,b=this.getZ()-c.getZ();return Math.sqrt(d*d+p*p+b*b)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(c){this.y=c}},{key:"distance",value:function(c){var d=this.x-c.x,p=this.y-c.y;return Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*c+I.hashCode(this.x))+I.hashCode(this.y)}},{key:"setCoordinate",value:function(c){this.x=c.x,this.y=c.y,this.z=c.getZ()}},{key:"interfaces_",get:function(){return[he,xe,be]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)I.constructor_.call(this,0,0);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.x,c.y,c.getZ())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];I.constructor_.call(this,d,p,I.NULL_ORDINATE)}else if(arguments.length===3){var b=arguments[0],L=arguments[1],O=arguments[2];this.x=b,this.y=L,this.z=O}}},{key:"hashCode",value:function(c){return pn[0]=c,Dn[0]^Dn[1]}}]),I}(),Xn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compare",value:function(c,d){var p=I.compare(c.x,d.x);if(p!==0)return p;var b=I.compare(c.y,d.y);return b!==0?b:this._dimensionsToTest<=2?0:I.compare(c.getZ(),d.getZ())}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)I.constructor_.call(this,2);else if(arguments.length===1){var c=arguments[0];if(c!==2&&c!==3)throw new ve("only 2 or 3 dimensions may be specified");this._dimensionsToTest=c}}},{key:"compare",value:function(c,d){return c<d?-1:c>d?1:vt.isNaN(c)?vt.isNaN(d)?0:-1:vt.isNaN(d)?1:0}}]),I}();We.DimensionalComparator=Xn,We.NULL_ORDINATE=vt.NaN,We.X=0,We.Y=1,We.Z=2,We.M=3;var dn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()}},{key:"intersection",value:function(c){if(this.isNull()||c.isNull()||!this.intersects(c))return new I;var d=this._minx>c._minx?this._minx:c._minx,p=this._miny>c._miny?this._miny:c._miny;return new I(d,this._maxx<c._maxx?this._maxx:c._maxx,p,this._maxy<c._maxy?this._maxy:c._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];return this.covers(c.x,c.y)}if(arguments[0]instanceof I){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return!this.isNull()&&p>=this._minx&&p<=this._maxx&&b>=this._miny&&b<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return!this.isNull()&&!c.isNull()&&!(c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny)}if(arguments[0]instanceof We){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(arguments.length===2){if(arguments[0]instanceof We&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1];if(this.isNull())return!1;var L=p.x<b.x?p.x:b.x;if(L>this._maxx)return!1;var O=p.x>b.x?p.x:b.x;if(O<this._minx)return!1;var V=p.y<b.y?p.y:b.y;if(V>this._maxy)return!1;var $=p.y>b.y?p.y:b.y;return!($<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var me=arguments[0],Be=arguments[1];return!this.isNull()&&!(me>this._maxx||me<this._minx||Be>this._maxy||Be<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return Math.sqrt(c*c+d*d)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.expandToInclude(c.x,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.isNull()?(this._minx=p,this._maxx=p,this._miny=b,this._maxy=b):(p<this._minx&&(this._minx=p),p>this._maxx&&(this._maxx=p),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c<d?c:d}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(c){var d=c;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0}},{key:"translate",value:function(c,d){if(this.isNull())return null;this.init(this.getMinX()+c,this.getMaxX()+c,this.getMinY()+d,this.getMaxY()+d)}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(c){return!(!this.isNull()&&!c.isNull())||c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c>d?c:d}},{key:"expandBy",value:function(){if(arguments.length===1){var c=arguments[0];this.expandBy(c,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=p,this._maxy+=p,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.covers(c)}if(arguments[0]instanceof We){var d=arguments[0];return this.covers(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.covers(p,b)}}},{key:"centre",value:function(){return this.isNull()?null:new We((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],$=arguments[3];L<O?(this._minx=L,this._maxx=O):(this._minx=O,this._maxx=L),V<$?(this._miny=V,this._maxy=$):(this._miny=$,this._maxy=V)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(c){if(this.intersects(c))return 0;var d=0;this._maxx<c._minx?d=c._minx-this._maxx:this._minx>c._maxx&&(d=this._minx-c._maxx);var p=0;return this._maxy<c._miny?p=c._miny-this._maxy:this._miny>c._maxy&&(p=this._miny-c._maxy),d===0?p:p===0?d:Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*(c=37*(c=37*c+We.hashCode(this._minx))+We.hashCode(this._maxx))+We.hashCode(this._miny))+We.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[he,be]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],$=arguments[3];this.init(L,O,V,$)}}},{key:"intersects",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2];return p.x>=(c.x<d.x?c.x:d.x)&&p.x<=(c.x>d.x?c.x:d.x)&&p.y>=(c.y<d.y?c.y:d.y)&&p.y<=(c.y>d.y?c.y:d.y)}if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3],$=Math.min(O.x,V.x),me=Math.max(O.x,V.x),Be=Math.min(b.x,L.x),Ke=Math.max(b.x,L.x);return!(Be>me)&&!(Ke<$)&&($=Math.min(O.y,V.y),me=Math.max(O.y,V.y),Be=Math.min(b.y,L.y),Ke=Math.max(b.y,L.y),!(Be>me)&&!(Ke<$))}}}]),I}(),Ot=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(c){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(c){return this===c||this.equalsExact(c,0)}},{key:"geometryChanged",value:function(){this.apply(I.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(c){return c!==null&&this.norm().equalsExact(c.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var c;if(arguments.length===1){var d=arguments[0];return c=d,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(d)}if(arguments.length===2){var p=arguments[0],b=arguments[1];return c=p,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(p,b)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(c){if(c.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION)throw new ve("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(c,d,p){return p===0?c.equals(d):c.distance(d)<=p}},{key:"norm",value:function(){var c=this.copy();return c.normalize(),c}},{key:"reverse",value:function(){var c=this.reverseInternal();return this.envelope!=null&&(c.envelope=this.envelope.copy()),c.setSRID(this.getSRID()),c}},{key:"copy",value:function(){var c=this.copyInternal();return c.envelope=this._envelope==null?null:this._envelope.copy(),c._SRID=this._SRID,c._userData=this._userData,c}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new dn(this._envelope)}},{key:"setSRID",value:function(c){this._SRID=c}},{key:"setUserData",value:function(c){this._userData=c}},{key:"compare",value:function(c,d){for(var p=c.iterator(),b=d.iterator();p.hasNext()&&b.hasNext();){var L=p.next(),O=b.next(),V=L.compareTo(O);if(V!==0)return V}return p.hasNext()?1:b.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(c){return this.getClass()===c.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===I.TYPECODE_MULTIPOINT||this.getTypeCode()===I.TYPECODE_MULTILINESTRING||this.getTypeCode()===I.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[xe,he,be]}},{key:"getClass",value:function(){return I}}],[{key:"hasNonEmptyElements",value:function(c){for(var d=0;d<c.length;d++)if(!c[d].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(c){for(var d=0;d<c.length;d++)if(c[d]===null)return!0;return!1}}]),I}();Ot.constructor_=function(I){I&&(this._envelope=null,this._userData=null,this._factory=I,this._SRID=I.getSRID())},Ot.TYPECODE_POINT=0,Ot.TYPECODE_MULTIPOINT=1,Ot.TYPECODE_LINESTRING=2,Ot.TYPECODE_LINEARRING=3,Ot.TYPECODE_MULTILINESTRING=4,Ot.TYPECODE_POLYGON=5,Ot.TYPECODE_MULTIPOLYGON=6,Ot.TYPECODE_GEOMETRYCOLLECTION=7,Ot.TYPENAME_POINT="Point",Ot.TYPENAME_MULTIPOINT="MultiPoint",Ot.TYPENAME_LINESTRING="LineString",Ot.TYPENAME_LINEARRING="LinearRing",Ot.TYPENAME_MULTILINESTRING="MultiLineString",Ot.TYPENAME_POLYGON="Polygon",Ot.TYPENAME_MULTIPOLYGON="MultiPolygon",Ot.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Ot.geometryChangedFilter={get interfaces_(){return[De]},filter:function(I){I.geometryChangedAction()}};var Se=function(){function I(){n(this,I)}return a(I,null,[{key:"toLocationSymbol",value:function(c){switch(c){case I.EXTERIOR:return"e";case I.BOUNDARY:return"b";case I.INTERIOR:return"i";case I.NONE:return"-"}throw new ve("Unknown location value: "+c)}}]),I}();Se.INTERIOR=0,Se.BOUNDARY=1,Se.EXTERIOR=2,Se.NONE=-1;var lt=function(){function I(){n(this,I)}return a(I,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),I}(),Ye=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({NoSuchElementException:d})[0],b}return d}(pe),Ct=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({UnsupportedOperationException:d})[0],b}return d}(pe),$e=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return a(d,[{key:"contains",value:function(){}}]),d}(lt),kt=function(I,c){h(p,I);var d=B(p);function p(b){var L;return n(this,p),(L=d.call(this)).map=new Map,b instanceof lt&&L.addAll(b),L}return a(p,[{key:"contains",value:function(b){var L=b.hashCode?b.hashCode():b;return!!this.map.has(L)}},{key:"add",value:function(b){var L=b.hashCode?b.hashCode():b;return!this.map.has(L)&&!!this.map.set(L,b)}},{key:"addAll",value:function(b){var L,O=Q(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;this.add(V)}}catch($){O.e($)}finally{O.f()}return!0}},{key:"remove",value:function(){throw new Ct}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new qt(this.map)}},{key:c,value:function(){return this.map}}]),p}($e,Symbol.iterator),qt=function(){function I(c){n(this,I),this.iterator=c.values();var d=this.iterator.next(),p=d.done,b=d.value;this.done=p,this.value=b}return a(I,[{key:"next",value:function(){if(this.done)throw new Ye;var c=this.value,d=this.iterator.next(),p=d.done,b=d.value;return this.done=p,this.value=b,c}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Ct}}]),I}(),Ee=function(){function I(){n(this,I)}return a(I,null,[{key:"opposite",value:function(c){return c===I.LEFT?I.RIGHT:c===I.RIGHT?I.LEFT:c}}]),I}();Ee.ON=0,Ee.LEFT=1,Ee.RIGHT=2;var Gt=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({EmptyStackException:d})[0],b}return d}(pe),_n=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({IndexOutOfBoundsException:d})[0],b}return d}(pe),Jn=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return a(d,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),d}(lt),$i=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).array=[],p}return a(d,[{key:"add",value:function(p){return this.array.push(p),!0}},{key:"get",value:function(p){if(p<0||p>=this.size())throw new _n;return this.array[p]}},{key:"push",value:function(p){return this.array.push(p),p}},{key:"pop",value:function(){if(this.array.length===0)throw new Gt;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Gt;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(p){return this.array.indexOf(p)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),d}(Jn);function xn(I,c){return I.interfaces_&&I.interfaces_.indexOf(c)>-1}var Vi=function(){function I(c){n(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),Yi=function(){function I(c){n(this,I),this.value=c}return a(I,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(c){return this.value<c?-1:this.value>c?1:0}}],[{key:"compare",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"isNan",value:function(c){return Number.isNaN(c)}},{key:"valueOf",value:function(c){return new I(c)}}]),I}(),Jr=function(){function I(){n(this,I)}return a(I,null,[{key:"isWhitespace",value:function(c){return c<=32&&c>=0||c===127}},{key:"toUpperCase",value:function(c){return c.toUpperCase()}}]),I}(),ct=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"le",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<=c._lo}},{key:"extractSignificantDigits",value:function(c,d){var p=this.abs(),b=I.magnitude(p._hi),L=I.TEN.pow(b);(p=p.divide(L)).gt(I.TEN)?(p=p.divide(I.TEN),b+=1):p.lt(I.ONE)&&(p=p.multiply(I.TEN),b-=1);for(var O=b+1,V=new Vi,$=I.MAX_PRINT_DIGITS-1,me=0;me<=$;me++){c&&me===O&&V.append(".");var Be=Math.trunc(p._hi);if(Be<0)break;var Ke=!1,mt=0;Be>9?(Ke=!0,mt="9"):mt="0"+Be,V.append(mt),p=p.subtract(I.valueOf(Be)).multiply(I.TEN),Ke&&p.selfAdd(I.TEN);var zt=!0,Nt=I.magnitude(p._hi);if(Nt<0&&Math.abs(Nt)>=$-me&&(zt=!1),!zt)break}return d[0]=b,V.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.add(c.negate())}if(typeof arguments[0]=="number"){var d=arguments[0];return this.add(-d)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof I){var c=arguments[0];return this._hi===c._hi&&this._lo===c._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.isNaN()?this:this.selfAdd(-c._hi,-c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(c){return this.le(c)?this:c}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfDivide(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfDivide(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],L=null,O=null,V=null,$=null,me=null,Be=null,Ke=null,mt=null;return me=this._hi/p,mt=(L=(Be=I.SPLIT*me)-(L=Be-me))*(V=(mt=I.SPLIT*p)-(V=mt-p))-(Ke=me*p)+L*($=p-V)+(O=me-L)*V+O*$,mt=me+(Be=(this._hi-Ke-mt+this._lo-me*b)/p),this._hi=mt,this._lo=me-mt+Be,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=null,p=null,b=null,L=null,O=null,V=null,$=null,me=null;p=(O=this._hi/c._hi)-(d=(V=I.SPLIT*O)-(d=V-O)),me=d*(b=(me=I.SPLIT*c._hi)-(b=me-c._hi))-($=O*c._hi)+d*(L=c._hi-b)+p*b+p*L;var Be=me=O+(V=(this._hi-$-me+this._lo-O*c._lo)/c._hi),Ke=O-me+V;return new I(Be,Ke)}if(typeof arguments[0]=="number"){var mt=arguments[0];return vt.isNaN(mt)?I.createNaN():I.copy(this).selfDivide(mt,0)}}},{key:"ge",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>=c._lo}},{key:"pow",value:function(c){if(c===0)return I.valueOf(1);var d=new I(this),p=I.valueOf(1),b=Math.abs(c);if(b>1)for(;b>0;)b%2==1&&p.selfMultiply(d),(b/=2)>0&&(d=d.sqr());else p=d;return c<0?p.reciprocal():p}},{key:"ceil",value:function(){if(this.isNaN())return I.NaN;var c=Math.ceil(this._hi),d=0;return c===this._hi&&(d=Math.ceil(this._lo)),new I(c,d)}},{key:"compareTo",value:function(c){var d=c;return this._hi<d._hi?-1:this._hi>d._hi?1:this._lo<d._lo?-1:this._lo>d._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.init(c),this}if(typeof arguments[0]=="number"){var d=arguments[0];return this.init(d),this}}},{key:"max",value:function(c){return this.ge(c)?this:c}},{key:"sqrt",value:function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var c=1/Math.sqrt(this._hi),d=this._hi*c,p=I.valueOf(d),b=this.subtract(p.sqr())._hi*(.5*c);return p.add(b)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfAdd(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0],p=null,b=null,L=null,O=null,V=null,$=null;return O=(L=this._hi+d)-(V=L-this._hi),b=($=(O=d-V+(this._hi-O))+this._lo)+(L-(p=L+$)),this._hi=p+b,this._lo=b+(p-this._hi),this}}else if(arguments.length===2){var me=arguments[0],Be=arguments[1],Ke=null,mt=null,zt=null,Nt=null,gn=null,bn=null,Rn=null;Nt=this._hi+me,mt=this._lo+Be,gn=Nt-(bn=Nt-this._hi),zt=mt-(Rn=mt-this._lo);var ti=(Ke=Nt+(bn=(gn=me-bn+(this._hi-gn))+mt))+(bn=(zt=Be-Rn+(this._lo-zt))+(bn+(Nt-Ke))),mi=bn+(Ke-ti);return this._hi=ti,this._lo=mi,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfMultiply(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfMultiply(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],L=null,O=null,V=null,$=null,me=null,Be=null;L=(me=I.SPLIT*this._hi)-this._hi,Be=I.SPLIT*p,L=me-L,O=this._hi-L,V=Be-p;var Ke=(me=this._hi*p)+(Be=L*(V=Be-V)-me+L*($=p-V)+O*V+O*$+(this._hi*b+this._lo*p)),mt=Be+(L=me-Ke);return this._hi=Ke,this._lo=mt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return I.NaN;var c=Math.floor(this._hi),d=0;return c===this._hi&&(d=Math.floor(this._lo)),new I(c,d)}},{key:"negate",value:function(){return this.isNaN()?this:new I(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return null;throw c}}},{key:"multiply",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return c.isNaN()?I.createNaN():I.copy(this).selfMultiply(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return vt.isNaN(d)?I.createNaN():I.copy(this).selfMultiply(d,0)}}},{key:"isNaN",value:function(){return vt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var c=I.magnitude(this._hi);return c>=-3&&c<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!0,d),b=d[0]+1,L=p;if(p.charAt(0)===".")L="0"+p;else if(b<0)L="0."+I.stringOfChar("0",-b)+p;else if(p.indexOf(".")===-1){var O=b-p.length;L=p+I.stringOfChar("0",O)+".0"}return this.isNegative()?"-"+L:L}},{key:"reciprocal",value:function(){var c,d,p,b,L=null,O=null,V=null,$=null;c=(p=1/this._hi)-(L=(V=I.SPLIT*p)-(L=V-p)),O=($=I.SPLIT*this._hi)-this._hi;var me=p+(V=(1-(b=p*this._hi)-($=L*(O=$-O)-b+L*(d=this._hi-O)+c*O+c*d)-p*this._lo)/this._hi);return new I(me,p-me+V)}},{key:"toSciNotation",value:function(){if(this.isZero())return I.SCI_NOT_ZERO;var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!1,d),b=I.SCI_NOT_EXPONENT_CHAR+d[0];if(p.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+p);var L="";p.length>1&&(L=p.substring(1));var O=p.charAt(0)+"."+L;return this.isNegative()?"-"+O+b:O+b}},{key:"abs",value:function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<c._lo}},{key:"add",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return I.copy(this).selfAdd(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return I.copy(this).selfAdd(d)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this._hi=c,this._lo=0}else if(arguments[0]instanceof I){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this._hi=p,this._lo=b}}},{key:"gt",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>c._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[be,he,xe]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this.init(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}else if(typeof arguments[0]=="string"){var p=arguments[0];I.constructor_.call(this,I.parse(p))}}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.init(b,L)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];return I.determinant(I.valueOf(c),I.valueOf(d),I.valueOf(p),I.valueOf(b))}if(arguments[3]instanceof I&&arguments[2]instanceof I&&arguments[0]instanceof I&&arguments[1]instanceof I){var L=arguments[0],O=arguments[1],V=arguments[2],$=arguments[3],me=L.multiply($).selfSubtract(O.multiply(V));return me}}},{key:"sqr",value:function(c){return I.valueOf(c).selfMultiply(c)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var c=arguments[0];return I.parse(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return new I(d)}}},{key:"sqrt",value:function(c){return I.valueOf(c).sqrt()}},{key:"parse",value:function(c){for(var d=0,p=c.length;Jr.isWhitespace(c.charAt(d));)d++;var b=!1;if(d<p){var L=c.charAt(d);L!=="-"&&L!=="+"||(d++,L==="-"&&(b=!0))}for(var O=new I,V=0,$=0,me=0,Be=!1;!(d>=p);){var Ke=c.charAt(d);if(d++,Jr.isDigit(Ke)){var mt=Ke-"0";O.selfMultiply(I.TEN),O.selfAdd(mt),V++}else{if(Ke!=="."){if(Ke==="e"||Ke==="E"){var zt=c.substring(d);try{me=Yi.parseInt(zt)}catch(ti){throw ti instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+zt+" in string "+c):ti}break}throw new NumberFormatException("Unexpected character '"+Ke+"' at position "+d+" in string "+c)}$=V,Be=!0}}var Nt=O;Be||($=V);var gn=V-$-me;if(gn===0)Nt=O;else if(gn>0){var bn=I.TEN.pow(gn);Nt=O.divide(bn)}else if(gn<0){var Rn=I.TEN.pow(-gn);Nt=O.multiply(Rn)}return b?Nt.negate():Nt}},{key:"createNaN",value:function(){return new I(vt.NaN,vt.NaN)}},{key:"copy",value:function(c){return new I(c)}},{key:"magnitude",value:function(c){var d=Math.abs(c),p=Math.log(d)/Math.log(10),b=Math.trunc(Math.floor(p));return 10*Math.pow(10,b)<=d&&(b+=1),b}},{key:"stringOfChar",value:function(c,d){for(var p=new Vi,b=0;b<d;b++)p.append(c);return p.toString()}}]),I}();ct.PI=new ct(3.141592653589793,12246467991473532e-32),ct.TWO_PI=new ct(6.283185307179586,24492935982947064e-32),ct.PI_2=new ct(1.5707963267948966,6123233995736766e-32),ct.E=new ct(2.718281828459045,14456468917292502e-32),ct.NaN=new ct(vt.NaN,vt.NaN),ct.EPS=123259516440783e-46,ct.SPLIT=134217729,ct.MAX_PRINT_DIGITS=32,ct.TEN=ct.valueOf(10),ct.ONE=ct.valueOf(1),ct.SCI_NOT_EXPONENT_CHAR="E",ct.SCI_NOT_ZERO="0.0E0";var yr=function(){function I(){n(this,I)}return a(I,null,[{key:"orientationIndex",value:function(c,d,p){var b=I.orientationIndexFilter(c,d,p);if(b<=1)return b;var L=ct.valueOf(d.x).selfAdd(-c.x),O=ct.valueOf(d.y).selfAdd(-c.y),V=ct.valueOf(p.x).selfAdd(-d.x),$=ct.valueOf(p.y).selfAdd(-d.y);return L.selfMultiply($).selfSubtract(O.selfMultiply(V)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof ct&&arguments[2]instanceof ct&&arguments[0]instanceof ct&&arguments[1]instanceof ct){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3],L=c.multiply(b).selfSubtract(d.multiply(p));return L.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var O=arguments[0],V=arguments[1],$=arguments[2],me=arguments[3],Be=ct.valueOf(O),Ke=ct.valueOf(V),mt=ct.valueOf($),zt=ct.valueOf(me),Nt=Be.multiply(zt).selfSubtract(Ke.multiply(mt));return Nt.signum()}}},{key:"intersection",value:function(c,d,p,b){var L=new ct(c.y).selfSubtract(d.y),O=new ct(d.x).selfSubtract(c.x),V=new ct(c.x).selfMultiply(d.y).selfSubtract(new ct(d.x).selfMultiply(c.y)),$=new ct(p.y).selfSubtract(b.y),me=new ct(b.x).selfSubtract(p.x),Be=new ct(p.x).selfMultiply(b.y).selfSubtract(new ct(b.x).selfMultiply(p.y)),Ke=O.multiply(Be).selfSubtract(me.multiply(V)),mt=$.multiply(V).selfSubtract(L.multiply(Be)),zt=L.multiply(me).selfSubtract($.multiply(O)),Nt=Ke.selfDivide(zt).doubleValue(),gn=mt.selfDivide(zt).doubleValue();return vt.isNaN(Nt)||vt.isInfinite(Nt)||vt.isNaN(gn)||vt.isInfinite(gn)?null:new We(Nt,gn)}},{key:"orientationIndexFilter",value:function(c,d,p){var b=null,L=(c.x-p.x)*(d.y-p.y),O=(c.y-p.y)*(d.x-p.x),V=L-O;if(L>0){if(O<=0)return I.signum(V);b=L+O}else{if(!(L<0)||O>=0)return I.signum(V);b=-L-O}var $=I.DP_SAFE_EPSILON*b;return V>=$||-V>=$?I.signum(V):2}},{key:"signum",value:function(c){return c>0?1:c<0?-1:0}}]),I}();yr.DP_SAFE_EPSILON=1e-15;var kn=function(){function I(){n(this,I)}return a(I,[{key:"getM",value:function(c){if(this.hasM()){var d=this.getDimension()-this.getMeasures();return this.getOrdinate(c,d)}return vt.NaN}},{key:"setOrdinate",value:function(c,d,p){}},{key:"getZ",value:function(c){return this.hasZ()?this.getOrdinate(c,2):vt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(c,d){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(c){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(c){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(c){}},{key:"copy",value:function(){}},{key:"getY",value:function(c){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[xe]}}]),I}();kn.X=0,kn.Y=1,kn.Z=2,kn.M=3;var mn=function(){function I(){n(this,I)}return a(I,null,[{key:"index",value:function(c,d,p){return yr.orientationIndex(c,d,p)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var c=arguments[0],d=c.length-1;if(d<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=c[0],b=0,L=1;L<=d;L++){var O=c[L];O.y>p.y&&(p=O,b=L)}var V=b;do(V-=1)<0&&(V=d);while(c[V].equals2D(p)&&V!==b);var $=b;do $=($+1)%d;while(c[$].equals2D(p)&&$!==b);var me=c[V],Be=c[$];if(me.equals2D(p)||Be.equals2D(p)||me.equals2D(Be))return!1;var Ke=I.index(me,p,Be),mt=null;return mt=Ke===0?me.x>Be.x:Ke>0,mt}if(xn(arguments[0],kn)){var zt=arguments[0],Nt=zt.size()-1;if(Nt<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var gn=zt.getCoordinate(0),bn=0,Rn=1;Rn<=Nt;Rn++){var ti=zt.getCoordinate(Rn);ti.y>gn.y&&(gn=ti,bn=Rn)}var mi=null,li=bn;do(li-=1)<0&&(li=Nt),mi=zt.getCoordinate(li);while(mi.equals2D(gn)&&li!==bn);var er=null,ss=bn;do ss=(ss+1)%Nt,er=zt.getCoordinate(ss);while(er.equals2D(gn)&&ss!==bn);if(mi.equals2D(gn)||er.equals2D(gn)||mi.equals2D(er))return!1;var Ms=I.index(mi,gn,er);return Ms===0?mi.x>er.x:Ms>0}}}]),I}();mn.CLOCKWISE=-1,mn.RIGHT=mn.CLOCKWISE,mn.COUNTERCLOCKWISE=1,mn.LEFT=mn.COUNTERCLOCKWISE,mn.COLLINEAR=0,mn.STRAIGHT=mn.COLLINEAR;var Ls=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(c,d){var p=this.getRightmostSideOfSegment(c,d);return p<0&&(p=this.getRightmostSideOfSegment(c,d-1)),p<0&&(this._minCoord=null,this.checkForRightmostCoordinate(c)),p}},{key:"findRightmostEdgeAtVertex",value:function(){var c=this._minDe.getEdge().getCoordinates();It.isTrue(this._minIndex>0&&this._minIndex<c.length,"rightmost point expected to be interior vertex of edge");var d=c[this._minIndex-1],p=c[this._minIndex+1],b=mn.index(this._minCoord,p,d),L=!1;(d.y<this._minCoord.y&&p.y<this._minCoord.y&&b===mn.COUNTERCLOCKWISE||d.y>this._minCoord.y&&p.y>this._minCoord.y&&b===mn.CLOCKWISE)&&(L=!0),L&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(c,d){var p=c.getEdge().getCoordinates();if(d<0||d+1>=p.length||p[d].y===p[d+1].y)return-1;var b=Ee.LEFT;return p[d].y<p[d+1].y&&(b=Ee.RIGHT),b}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(c){for(var d=c.getEdge().getCoordinates(),p=0;p<d.length-1;p++)(this._minCoord===null||d[p].x>this._minCoord.x)&&(this._minDe=c,this._minIndex=p,this._minCoord=d[p])}},{key:"findRightmostEdgeAtNode",value:function(){var c=this._minDe.getNode().getEdges();this._minDe=c.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();p.isForward()&&this.checkForRightmostCoordinate(p)}It.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ee.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),I}(),Mt=function(I){h(d,I);var c=B(d);function d(p,b){var L;return n(this,d),(L=c.call(this,b?p+" [ "+b+" ]":p)).pt=b?new We(b):void 0,L.name=Object.keys({TopologyException:d})[0],L}return a(d,[{key:"getCoordinate",value:function(){return this.pt}}]),d}(ft),Cn=function(){function I(){n(this,I),this.array=[]}return a(I,[{key:"addLast",value:function(c){this.array.push(c)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),I}(),At=function(I,c){h(p,I);var d=B(p);function p(b){var L;return n(this,p),(L=d.call(this)).array=[],b instanceof lt&&L.addAll(b),L}return a(p,[{key:"interfaces_",get:function(){return[Jn,lt]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(b){return arguments.length===1?this.array.push(b):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(b){var L,O=Q(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;this.array.push(V)}}catch($){O.e($)}finally{O.f()}}},{key:"set",value:function(b,L){var O=this.array[b];return this.array[b]=L,O}},{key:"iterator",value:function(){return new vr(this)}},{key:"get",value:function(b){if(b<0||b>=this.size())throw new _n;return this.array[b]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(b){b?this.array.sort(function(L,O){return b.compare(L,O)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(b){for(var L=0,O=this.array.length;L<O;L++)if(this.array[L]===b)return!!this.array.splice(L,1);return!1}},{key:c,value:function(){return this.array.values()}}]),p}(Jn,Symbol.iterator),vr=function(){function I(c){n(this,I),this.arrayList=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Ye;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(c){return this.arrayList.set(this.position-1,c)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),I}(),Gr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"clearVisitedEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();)c.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(c){for(var d=null,p=c.getEdges().iterator();p.hasNext();){var b=p.next();if(b.isVisited()||b.getSym().isVisited()){d=b;break}}if(d===null)throw new Mt("unable to find edge to compute depths at "+c.getCoordinate());c.getEdges().computeDepths(d);for(var L=c.getEdges().iterator();L.hasNext();){var O=L.next();O.setVisited(!0),this.copySymDepths(O)}}},{key:"computeDepth",value:function(c){this.clearVisitedEdges();var d=this._finder.getEdge();d.getNode(),d.getLabel(),d.setEdgeDepths(Ee.RIGHT,c),this.copySymDepths(d),this.computeDepths(d)}},{key:"create",value:function(c){this.addReachable(c),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();){var d=c.next();d.getDepth(Ee.RIGHT)>=1&&d.getDepth(Ee.LEFT)<=0&&!d.isInteriorAreaEdge()&&d.setInResult(!0)}}},{key:"computeDepths",value:function(c){var d=new kt,p=new Cn,b=c.getNode();for(p.addLast(b),d.add(b),c.setVisited(!0);!p.isEmpty();){var L=p.removeFirst();d.add(L),this.computeNodeDepth(L);for(var O=L.getEdges().iterator();O.hasNext();){var V=O.next().getSym();if(!V.isVisited()){var $=V.getNode();d.contains($)||(p.addLast($),d.add($))}}}}},{key:"compareTo",value:function(c){var d=c;return this._rightMostCoord.x<d._rightMostCoord.x?-1:this._rightMostCoord.x>d._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var c=new dn,d=this._dirEdgeList.iterator();d.hasNext();)for(var p=d.next().getEdge().getCoordinates(),b=0;b<p.length-1;b++)c.expandToInclude(p[b]);this._env=c}return this._env}},{key:"addReachable",value:function(c){var d=new $i;for(d.add(c);!d.empty();){var p=d.pop();this.add(p,d)}}},{key:"copySymDepths",value:function(c){var d=c.getSym();d.setDepth(Ee.LEFT,c.getDepth(Ee.RIGHT)),d.setDepth(Ee.RIGHT,c.getDepth(Ee.LEFT))}},{key:"add",value:function(c,d){c.setVisited(!0),this._nodes.add(c);for(var p=c.getEdges().iterator();p.hasNext();){var b=p.next();this._dirEdgeList.add(b);var L=b.getSym().getNode();L.isVisited()||d.push(L)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new At,this._nodes=new At,this._rightMostCoord=null,this._env=null,this._finder=new Ls}}]),I}(),wn=function(){function I(){n(this,I)}return a(I,null,[{key:"intersection",value:function(c,d,p,b){var L=c.x<d.x?c.x:d.x,O=c.y<d.y?c.y:d.y,V=c.x>d.x?c.x:d.x,$=c.y>d.y?c.y:d.y,me=p.x<b.x?p.x:b.x,Be=p.y<b.y?p.y:b.y,Ke=p.x>b.x?p.x:b.x,mt=p.y>b.y?p.y:b.y,zt=((L>me?L:me)+(V<Ke?V:Ke))/2,Nt=((O>Be?O:Be)+($<mt?$:mt))/2,gn=c.x-zt,bn=c.y-Nt,Rn=d.x-zt,ti=d.y-Nt,mi=p.x-zt,li=p.y-Nt,er=b.x-zt,ss=b.y-Nt,Ms=bn-ti,fi=Rn-gn,Rr=gn*ti-Rn*bn,dr=li-ss,Rs=er-mi,Wa=mi*ss-er*li,xa=Ms*Rs-dr*fi,lo=(fi*Wa-Rs*Rr)/xa,ws=(dr*Rr-Ms*Wa)/xa;return vt.isNaN(lo)||vt.isInfinite(lo)||vt.isNaN(ws)||vt.isInfinite(ws)?null:new We(lo+zt,ws+Nt)}}]),I}(),Li=function(){function I(){n(this,I)}return a(I,null,[{key:"arraycopy",value:function(c,d,p,b,L){for(var O=0,V=d;V<d+L;V++)p[b+O]=c[V],O++}},{key:"getProperty",value:function(c){return{"line.separator":`
`}[c]}}]),I}(),Ar=function(){function I(){n(this,I)}return a(I,null,[{key:"log10",value:function(c){var d=Math.log(c);return vt.isInfinite(d)||vt.isNaN(d)?d:d/I.LOG_10}},{key:"min",value:function(c,d,p,b){var L=c;return d<L&&(L=d),p<L&&(L=p),b<L&&(L=b),L}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2];return c<d?d:c>p?p:c}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],L=arguments[1],O=arguments[2];return b<L?L:b>O?O:b}}},{key:"wrap",value:function(c,d){return c<0?d- -c%d:c%d}},{key:"max",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2],b=c;return d>b&&(b=d),p>b&&(b=p),b}if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],$=arguments[3],me=L;return O>me&&(me=O),V>me&&(me=V),$>me&&(me=$),me}}},{key:"average",value:function(c,d){return(c+d)/2}}]),I}();Ar.LOG_10=Math.log(10);var Ji=function(){function I(){n(this,I)}return a(I,null,[{key:"segmentToSegment",value:function(c,d,p,b){if(c.equals(d))return I.pointToSegment(c,p,b);if(p.equals(b))return I.pointToSegment(b,c,d);var L=!1;if(dn.intersects(c,d,p,b)){var O=(d.x-c.x)*(b.y-p.y)-(d.y-c.y)*(b.x-p.x);if(O===0)L=!0;else{var V=(c.y-p.y)*(b.x-p.x)-(c.x-p.x)*(b.y-p.y),$=((c.y-p.y)*(d.x-c.x)-(c.x-p.x)*(d.y-c.y))/O,me=V/O;(me<0||me>1||$<0||$>1)&&(L=!0)}}else L=!0;return L?Ar.min(I.pointToSegment(c,p,b),I.pointToSegment(d,p,b),I.pointToSegment(p,c,d),I.pointToSegment(b,c,d)):0}},{key:"pointToSegment",value:function(c,d,p){if(d.x===p.x&&d.y===p.y)return c.distance(d);var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),L=((c.x-d.x)*(p.x-d.x)+(c.y-d.y)*(p.y-d.y))/b;if(L<=0)return c.distance(d);if(L>=1)return c.distance(p);var O=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(O)*Math.sqrt(b)}},{key:"pointToLinePerpendicular",value:function(c,d,p){var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),L=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(L)*Math.sqrt(b)}},{key:"pointToSegmentString",value:function(c,d){if(d.length===0)throw new ve("Line array must contain at least one vertex");for(var p=c.distance(d[0]),b=0;b<d.length-1;b++){var L=I.pointToSegment(c,d[b],d[b+1]);L<p&&(p=L)}return p}}]),I}(),Zr=function(){function I(){n(this,I)}return a(I,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||xn(arguments[0],kn);else if(arguments.length!==2&&arguments.length===3){var c=arguments[0],d=arguments[1];return this.create(c,d)}}}]),I}(),Me=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),J=function(){function I(){n(this,I)}return a(I,null,[{key:"ofLine",value:function(c){var d=c.size();if(d<=1)return 0;var p=0,b=new We;c.getCoordinate(0,b);for(var L=b.x,O=b.y,V=1;V<d;V++){c.getCoordinate(V,b);var $=b.x,me=b.y,Be=$-L,Ke=me-O;p+=Math.sqrt(Be*Be+Ke*Ke),L=$,O=me}return p}}]),I}(),Y=function I(){n(this,I)},ce=function(){function I(){n(this,I)}return a(I,null,[{key:"copyCoord",value:function(c,d,p,b){for(var L=Math.min(c.getDimension(),p.getDimension()),O=0;O<L;O++)p.setOrdinate(b,O,c.getOrdinate(d,O))}},{key:"isRing",value:function(c){var d=c.size();return d===0||!(d<=3)&&c.getOrdinate(0,kn.X)===c.getOrdinate(d-1,kn.X)&&c.getOrdinate(0,kn.Y)===c.getOrdinate(d-1,kn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(xn(arguments[0],kn)&&Number.isInteger(arguments[1])){var c=arguments[0],d=arguments[1];I.scroll(c,d,I.isRing(c))}else if(xn(arguments[0],kn)&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1],L=I.indexOf(b,p);if(L<=0)return null;I.scroll(p,L)}}else if(arguments.length===3){var O=arguments[0],V=arguments[1],$=arguments[2],me=V;if(me<=0)return null;for(var Be=O.copy(),Ke=$?O.size()-1:O.size(),mt=0;mt<Ke;mt++)for(var zt=0;zt<O.getDimension();zt++)O.setOrdinate(mt,zt,Be.getOrdinate((V+mt)%Ke,zt));if($)for(var Nt=0;Nt<O.getDimension();Nt++)O.setOrdinate(Ke,Nt,O.getOrdinate(0,Nt))}}},{key:"isEqual",value:function(c,d){var p=c.size();if(p!==d.size())return!1;for(var b=Math.min(c.getDimension(),d.getDimension()),L=0;L<p;L++)for(var O=0;O<b;O++){var V=c.getOrdinate(L,O),$=d.getOrdinate(L,O);if(c.getOrdinate(L,O)!==d.getOrdinate(L,O)&&(!vt.isNaN(V)||!vt.isNaN($)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var c=arguments[0];return I.minCoordinateIndex(c,0,c.size()-1)}if(arguments.length===3){for(var d=arguments[0],p=arguments[1],b=arguments[2],L=-1,O=null,V=p;V<=b;V++){var $=d.getCoordinate(V);(O===null||O.compareTo($)>0)&&(O=$,L=V)}return L}}},{key:"extend",value:function(c,d,p){var b=c.create(p,d.getDimension()),L=d.size();if(I.copy(d,0,b,0,L),L>0)for(var O=L;O<p;O++)I.copy(d,L-1,b,O,1);return b}},{key:"reverse",value:function(c){for(var d=c.size()-1,p=Math.trunc(d/2),b=0;b<=p;b++)I.swap(c,b,d-b)}},{key:"swap",value:function(c,d,p){if(d===p)return null;for(var b=0;b<c.getDimension();b++){var L=c.getOrdinate(d,b);c.setOrdinate(d,b,c.getOrdinate(p,b)),c.setOrdinate(p,b,L)}}},{key:"copy",value:function(c,d,p,b,L){for(var O=0;O<L;O++)I.copyCoord(c,d+O,p,b+O)}},{key:"ensureValidRing",value:function(c,d){var p=d.size();return p===0?d:p<=3?I.createClosedRing(c,d,4):d.getOrdinate(0,kn.X)===d.getOrdinate(p-1,kn.X)&&d.getOrdinate(0,kn.Y)===d.getOrdinate(p-1,kn.Y)?d:I.createClosedRing(c,d,p+1)}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.size();p++)if(c.x===d.getOrdinate(p,kn.X)&&c.y===d.getOrdinate(p,kn.Y))return p;return-1}},{key:"createClosedRing",value:function(c,d,p){var b=c.create(p,d.getDimension()),L=d.size();I.copy(d,0,b,0,L);for(var O=L;O<p;O++)I.copy(d,0,b,O,1);return b}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.size();p++){var b=c.getCoordinate(p);(d===null||d.compareTo(b)>0)&&(d=b)}return d}}]),I}(),le=function(){function I(){n(this,I)}return a(I,null,[{key:"toDimensionSymbol",value:function(c){switch(c){case I.FALSE:return I.SYM_FALSE;case I.TRUE:return I.SYM_TRUE;case I.DONTCARE:return I.SYM_DONTCARE;case I.P:return I.SYM_P;case I.L:return I.SYM_L;case I.A:return I.SYM_A}throw new ve("Unknown dimension value: "+c)}},{key:"toDimensionValue",value:function(c){switch(Jr.toUpperCase(c)){case I.SYM_FALSE:return I.FALSE;case I.SYM_TRUE:return I.TRUE;case I.SYM_DONTCARE:return I.DONTCARE;case I.SYM_P:return I.P;case I.SYM_L:return I.L;case I.SYM_A:return I.A}throw new ve("Unknown dimension symbol: "+c)}}]),I}();le.P=0,le.L=1,le.A=2,le.FALSE=-1,le.TRUE=-2,le.DONTCARE=-3,le.SYM_FALSE="F",le.SYM_TRUE="T",le.SYM_DONTCARE="*",le.SYM_P="0",le.SYM_L="1",le.SYM_A="2";var fe=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),je=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c,d){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),I}(),Xe=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new dn:this._points.expandEnvelope(new dn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p;if(this._points.size()!==L._points.size())return!1;for(var O=0;O<this._points.size();O++)if(!this.equal(this._points.getCoordinate(O),L._points.getCoordinate(O),b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<Math.trunc(this._points.size()/2);p++){var b=this._points.size()-1-p;if(!this._points.getCoordinate(p).equals(this._points.getCoordinate(b))){if(this._points.getCoordinate(p).compareTo(this._points.getCoordinate(b))>0){var L=this._points.copy();ce.reverse(L),this._points=L}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var p=this._points.copy();return ce.reverse(p),this.getFactory().createLineString(p)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return J.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var p=arguments[0],b=p,L=0,O=0;L<this._points.size()&&O<b._points.size();){var V=this._points.getCoordinate(L).compareTo(b._points.getCoordinate(O));if(V!==0)return V;L++,O++}return L<this._points.size()?1:O<b._points.size()?-1:0}if(arguments.length===2){var $=arguments[0],me=arguments[1],Be=$;return me.compare(this._points,Be._points)}}},{key:"apply",value:function(){if(xn(arguments[0],Me))for(var p=arguments[0],b=0;b<this._points.size();b++)p.filter(this._points.getCoordinate(b));else if(xn(arguments[0],je)){var L=arguments[0];if(this._points.size()===0)return null;for(var O=0;O<this._points.size()&&(L.filter(this._points,O),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var V=arguments[0];V.filter(this)}else if(xn(arguments[0],De)){var $=arguments[0];$.filter(this)}}},{key:"getBoundary",value:function(){throw new Ct}},{key:"isEquivalentClass",value:function(p){return p instanceof d}},{key:"getCoordinateN",value:function(p){return this._points.getCoordinate(p)}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(p){if(p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),p.size()===1)throw new ve("Invalid number of points in LineString (found "+p.size()+" - must be 0 or >= 2)");this._points=p}},{key:"isCoordinate",value:function(p){for(var b=0;b<this._points.size();b++)if(this._points.getCoordinate(b).equals(p))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(p){return this.getFactory().createPoint(this._points.getCoordinate(p))}},{key:"interfaces_",get:function(){return[Y]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];Ot.constructor_.call(this,b),this.init(p)}}}]),d}(Ot),Re=function I(){n(this,I)},et=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new dn;var p=new dn;return p.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),p}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new d(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&(!(!this.isEmpty()||!p.isEmpty())||this.isEmpty()===p.isEmpty()&&this.equal(p.getCoordinate(),this.getCoordinate(),b))}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=p;return this.getCoordinate().compareTo(b.getCoordinate())}if(arguments.length===2){var L=arguments[0],O=arguments[1],V=L;return O.compare(this._coordinates,V._coordinates)}}},{key:"apply",value:function(){if(xn(arguments[0],Me)){var p=arguments[0];if(this.isEmpty())return null;p.filter(this.getCoordinate())}else if(xn(arguments[0],je)){var b=arguments[0];if(this.isEmpty())return null;b.filter(this._coordinates,0),b.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var L=arguments[0];L.filter(this)}else if(xn(arguments[0],De)){var O=arguments[0];O.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(p){p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),It.isTrue(p.size()<=1),this._coordinates=p}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Re]}}],[{key:"constructor_",value:function(){this._coordinates=null;var p=arguments[0],b=arguments[1];Ot.constructor_.call(this,b),this.init(p)}}]),d}(Ot),gt=function(){function I(){n(this,I)}return a(I,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];return Math.abs(I.ofRingSigned(c))}if(xn(arguments[0],kn)){var d=arguments[0];return Math.abs(I.ofRingSigned(d))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];if(c.length<3)return 0;for(var d=0,p=c[0].x,b=1;b<c.length-1;b++){var L=c[b].x-p,O=c[b+1].y,V=c[b-1].y;d+=L*(V-O)}return d/2}if(xn(arguments[0],kn)){var $=arguments[0],me=$.size();if(me<3)return 0;var Be=new We,Ke=new We,mt=new We;$.getCoordinate(0,Ke),$.getCoordinate(1,mt);var zt=Ke.x;mt.x-=zt;for(var Nt=0,gn=1;gn<me-1;gn++)Be.y=Ke.y,Ke.x=mt.x,Ke.y=mt.y,$.getCoordinate(gn+1,mt),mt.x-=zt,Nt+=Ke.x*(Be.y-mt.y);return Nt/2}}}]),I}(),at=function(){function I(){n(this,I)}return a(I,null,[{key:"sort",value:function(){var c=arguments,d=arguments[0];if(arguments.length===1)d.sort(function(zt,Nt){return zt.compareTo(Nt)});else if(arguments.length===2)d.sort(function(zt,Nt){return c[1].compare(zt,Nt)});else if(arguments.length===3){var p=d.slice(arguments[1],arguments[2]);p.sort();var b=d.slice(0,arguments[1]).concat(p,d.slice(arguments[2],d.length));d.splice(0,d.length);var L,O=Q(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;d.push(V)}}catch(zt){O.e(zt)}finally{O.f()}}else if(arguments.length===4){var $=d.slice(arguments[1],arguments[2]);$.sort(function(zt,Nt){return c[3].compare(zt,Nt)});var me=d.slice(0,arguments[1]).concat($,d.slice(arguments[2],d.length));d.splice(0,d.length);var Be,Ke=Q(me);try{for(Ke.s();!(Be=Ke.n()).done;){var mt=Be.value;d.push(mt)}}catch(zt){Ke.e(zt)}finally{Ke.f()}}}},{key:"asList",value:function(c){var d,p=new At,b=Q(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p.add(L)}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"copyOf",value:function(c,d){return c.slice(0,d)}}]),I}(),Dt=function I(){n(this,I)},en=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var p=new Array(this.getNumPoints()).fill(null),b=-1,L=this._shell.getCoordinates(),O=0;O<L.length;O++)p[++b]=L[O];for(var V=0;V<this._holes.length;V++)for(var $=this._holes[V].getCoordinates(),me=0;me<$.length;me++)p[++b]=$[me];return p}},{key:"getArea",value:function(){var p=0;p+=gt.ofRing(this._shell.getCoordinateSequence());for(var b=0;b<this._holes.length;b++)p-=gt.ofRing(this._holes[b].getCoordinateSequence());return p}},{key:"copyInternal",value:function(){for(var p=this._shell.copy(),b=new Array(this._holes.length).fill(null),L=0;L<this._holes.length;L++)b[L]=this._holes[L].copy();return new d(p,b,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var p=this._shell.getCoordinateSequence(),b=this.getEnvelopeInternal(),L=0;L<5;L++){var O=p.getX(L);if(O!==b.getMinX()&&O!==b.getMaxX())return!1;var V=p.getY(L);if(V!==b.getMinY()&&V!==b.getMaxY())return!1}for(var $=p.getX(0),me=p.getY(0),Be=1;Be<=4;Be++){var Ke=p.getX(Be),mt=p.getY(Be);if(Ke!==$==(mt!==me))return!1;$=Ke,me=mt}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p,O=this._shell,V=L._shell;if(!O.equalsExact(V,b)||this._holes.length!==L._holes.length)return!1;for(var $=0;$<this._holes.length;$++)if(!this._holes[$].equalsExact(L._holes[$],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var p=0;p<this._holes.length;p++)this._holes[p]=this.normalized(this._holes[p],!1);at.sort(this._holes)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];if(b.isEmpty())return null;var O=b.getCoordinateSequence(),V=ce.minCoordinateIndex(O,0,O.size()-2);ce.scroll(O,V,!0),mn.isCCW(O)===L&&ce.reverse(O)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var p=this.getExteriorRing().reverse(),b=new Array(this.getNumInteriorRing()).fill(null),L=0;L<b.length;L++)b[L]=this.getInteriorRingN(L).reverse();return this.getFactory().createPolygon(p,b)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var p=0;p+=this._shell.getLength();for(var b=0;b<this._holes.length;b++)p+=this._holes[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=this._shell.getNumPoints(),b=0;b<this._holes.length;b++)p+=this._holes[b].getNumPoints();return p}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(p,b){var L=p.copy();return this.normalize(L,b),L}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=this._shell,L=p._shell;return b.compareToSameClass(L)}if(arguments.length===2){var O=arguments[0],V=arguments[1],$=O,me=this._shell,Be=$._shell,Ke=me.compareToSameClass(Be,V);if(Ke!==0)return Ke;for(var mt=this.getNumInteriorRing(),zt=$.getNumInteriorRing(),Nt=0;Nt<mt&&Nt<zt;){var gn=this.getInteriorRingN(Nt),bn=$.getInteriorRingN(Nt),Rn=gn.compareToSameClass(bn,V);if(Rn!==0)return Rn;Nt++}return Nt<mt?1:Nt<zt?-1:0}}},{key:"apply",value:function(){if(xn(arguments[0],Me)){var p=arguments[0];this._shell.apply(p);for(var b=0;b<this._holes.length;b++)this._holes[b].apply(p)}else if(xn(arguments[0],je)){var L=arguments[0];if(this._shell.apply(L),!L.isDone())for(var O=0;O<this._holes.length&&(this._holes[O].apply(L),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var V=arguments[0];V.filter(this)}else if(xn(arguments[0],De)){var $=arguments[0];$.filter(this),this._shell.apply($);for(var me=0;me<this._holes.length;me++)this._holes[me].apply($)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var p=new Array(this._holes.length+1).fill(null);p[0]=this._shell;for(var b=0;b<this._holes.length;b++)p[b+1]=this._holes[b];return p.length<=1?this.getFactory().createLinearRing(p[0].getCoordinateSequence()):this.getFactory().createMultiLineString(p)}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(p){return this._holes[p]}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var p=arguments[0],b=arguments[1],L=arguments[2];if(Ot.constructor_.call(this,L),p===null&&(p=this.getFactory().createLinearRing()),b===null&&(b=[]),Ot.hasNullElements(b))throw new ve("holes must not contain null elements");if(p.isEmpty()&&Ot.hasNonEmptyElements(b))throw new ve("shell is empty but holes are not");this._shell=p,this._holes=b}}]),d}(Ot),ln=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return d}($e),Vn=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this)).array=[],p instanceof lt&&b.addAll(p),b}return a(d,[{key:"contains",value:function(p){var b,L=Q(this.array);try{for(L.s();!(b=L.n()).done;)if(b.value.compareTo(p)===0)return!0}catch(O){L.e(O)}finally{L.f()}return!1}},{key:"add",value:function(p){if(this.contains(p))return!1;for(var b=0,L=this.array.length;b<L;b++)if(this.array[b].compareTo(p)===1)return!!this.array.splice(b,0,p);return this.array.push(p),!0}},{key:"addAll",value:function(p){var b,L=Q(p);try{for(L.s();!(b=L.n()).done;){var O=b.value;this.add(O)}}catch(V){L.e(V)}finally{L.f()}return!0}},{key:"remove",value:function(){throw new Ct}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Ln(this.array)}}]),d}(ln),Ln=function(){function I(c){n(this,I),this.array=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.array.length)throw new Ye;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Ct}}]),I}(),Mn=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){for(var p=new dn,b=0;b<this._geometries.length;b++)p.expandToInclude(this._geometries[b].getEnvelopeInternal());return p}},{key:"getGeometryN",value:function(p){return this._geometries[p]}},{key:"getCoordinates",value:function(){for(var p=new Array(this.getNumPoints()).fill(null),b=-1,L=0;L<this._geometries.length;L++)for(var O=this._geometries[L].getCoordinates(),V=0;V<O.length;V++)p[++b]=O[V];return p}},{key:"getArea",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getArea();return p}},{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p;if(this._geometries.length!==L._geometries.length)return!1;for(var O=0;O<this._geometries.length;O++)if(!this._geometries[O].equalsExact(L._geometries[O],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<this._geometries.length;p++)this._geometries[p].normalize();at.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var p=le.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getBoundaryDimension());return p}},{key:"reverseInternal",value:function(){for(var p=this._geometries.length,b=new At(p),L=0;L<p;L++)b.add(this._geometries[L].reverse());return this.getFactory().buildGeometry(b)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var p=le.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getDimension());return p}},{key:"getLength",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getNumPoints();return p}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=new Vn(at.asList(this._geometries)),L=new Vn(at.asList(p._geometries));return this.compare(b,L)}if(arguments.length===2){for(var O=arguments[0],V=arguments[1],$=O,me=this.getNumGeometries(),Be=$.getNumGeometries(),Ke=0;Ke<me&&Ke<Be;){var mt=this.getGeometryN(Ke),zt=$.getGeometryN(Ke),Nt=mt.compareToSameClass(zt,V);if(Nt!==0)return Nt;Ke++}return Ke<me?1:Ke<Be?-1:0}}},{key:"apply",value:function(){if(xn(arguments[0],Me))for(var p=arguments[0],b=0;b<this._geometries.length;b++)this._geometries[b].apply(p);else if(xn(arguments[0],je)){var L=arguments[0];if(this._geometries.length===0)return null;for(var O=0;O<this._geometries.length&&(this._geometries[O].apply(L),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var V=arguments[0];V.filter(this);for(var $=0;$<this._geometries.length;$++)this._geometries[$].apply(V)}else if(xn(arguments[0],De)){var me=arguments[0];me.filter(this);for(var Be=0;Be<this._geometries.length;Be++)this._geometries[Be].apply(me)}}},{key:"getBoundary",value:function(){return Ot.checkNotGeometryCollection(this),It.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];if(Ot.constructor_.call(this,b),p===null&&(p=[]),Ot.hasNullElements(p))throw new ve("geometries must not contain null elements");this._geometries=p}}}]),d}(Ot),Bn=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var p=arguments[0];return this._geometries[p].getCoordinate()}return U(m(d.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Re]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Mn.constructor_.call(this,p,b)}}]),d}(Mn),wi=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||U(m(d.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var p=this._points.copy();return ce.reverse(p),this.getFactory().createLinearRing(p)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!U(m(d.prototype),"isClosed",this).call(this))throw new ve("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<d.MINIMUM_VALID_SIZE)throw new ve("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Xe.constructor_.call(this,p,b),this.validateConstruction()}}]),d}(Xe);wi.MINIMUM_VALID_SIZE=4;var ui=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"getZ",value:function(){return We.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)We.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p.x,p.y)}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b.x,b.y)}}else if(arguments.length===2){var L=arguments[0],O=arguments[1];We.constructor_.call(this,L,O,We.NULL_ORDINATE)}}}]),d}(We);ui.X=0,ui.Y=1,ui.Z=-1,ui.M=-1;var Tn=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;case d.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getZ",value:function(){return We.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y;case d.M:return this._m}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)We.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p.x,p.y),this._m=p._m}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b.x,b.y),this._m=this.getM()}}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];We.constructor_.call(this,L,O,We.NULL_ORDINATE),this._m=V}}}]),d}(We);Tn.X=0,Tn.Y=1,Tn.Z=-1,Tn.M=2;var ii=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case We.X:this.x=b;break;case We.Y:this.y=b;break;case We.Z:this.z=b;break;case We.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getOrdinate",value:function(p){switch(p){case We.X:return this.x;case We.Y:return this.y;case We.Z:return this.getZ();case We.M:return this.getM()}throw new ve("Invalid ordinate index: "+p)}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)We.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p),this._m=p._m}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b),this._m=this.getM()}}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],$=arguments[3];We.constructor_.call(this,L,O,V),this._m=$}}}]),d}(We),hi=function(){function I(){n(this,I)}return a(I,null,[{key:"measures",value:function(c){return c instanceof ui?0:c instanceof Tn||c instanceof ii?1:0}},{key:"dimension",value:function(c){return c instanceof ui?2:c instanceof Tn?3:c instanceof ii?4:3}},{key:"create",value:function(){if(arguments.length===1){var c=arguments[0];return I.create(c,0)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return d===2?new ui:d===3&&p===0?new We:d===3&&p===1?new Tn:d===4&&p===1?new ii:new We}}}]),I}(),Mi=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getCoordinate",value:function(p){return this.get(p)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&xn(arguments[0],lt)){for(var p=arguments[0],b=arguments[1],L=!1,O=p.iterator();O.hasNext();)this.add(O.next(),b),L=!0;return L}return U(m(d.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var p=U(m(d.prototype),"clone",this).call(this),b=0;b<this.size();b++)p.add(b,this.get(b).clone());return p}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(d.coordArrayType);if(arguments.length===1){var p=arguments[0];if(p)return this.toArray(d.coordArrayType);for(var b=this.size(),L=new Array(b).fill(null),O=0;O<b;O++)L[O]=this.get(b-O-1);return L}}},{key:"add",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"add",this).call(this,p)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var b=arguments[0],L=arguments[1];return this.add(b,L,!0),!0}if(arguments[0]instanceof We&&typeof arguments[1]=="boolean"){var O=arguments[0],V=arguments[1];if(!V&&this.size()>=1){var $=this.get(this.size()-1);if($.equals2D(O))return null}U(m(d.prototype),"add",this).call(this,O)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var me=arguments[0],Be=arguments[1];return this.add(me,Be),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var Ke=arguments[0],mt=arguments[1],zt=arguments[2];if(zt)for(var Nt=0;Nt<Ke.length;Nt++)this.add(Ke[Nt],mt);else for(var gn=Ke.length-1;gn>=0;gn--)this.add(Ke[gn],mt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof We){var bn=arguments[0],Rn=arguments[1],ti=arguments[2];if(!ti){var mi=this.size();if(mi>0){if(bn>0){var li=this.get(bn-1);if(li.equals2D(Rn))return null}if(bn<mi){var er=this.get(bn);if(er.equals2D(Rn))return null}}}U(m(d.prototype),"add",this).call(this,bn,Rn)}}else if(arguments.length===4){var ss=arguments[0],Ms=arguments[1],fi=arguments[2],Rr=arguments[3],dr=1;fi>Rr&&(dr=-1);for(var Rs=fi;Rs!==Rr;Rs+=dr)this.add(ss[Rs],Ms);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var p=this.get(0).copy();this.add(p,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.ensureCapacity(p.length),this.add(p,!0)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.ensureCapacity(b.length),this.add(b,L)}}}}]),d}(At);Mi.coordArrayType=new Array(0).fill(null);var Wn=function(){function I(){n(this,I)}return a(I,null,[{key:"isRing",value:function(c){return!(c.length<4)&&!!c[0].equals2D(c[c.length-1])}},{key:"ptNotInList",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p];if(I.indexOf(b,d)<0)return b}return null}},{key:"scroll",value:function(c,d){var p=I.indexOf(d,c);if(p<0)return null;var b=new Array(c.length).fill(null);Li.arraycopy(c,p,b,0,c.length-p),Li.arraycopy(c,0,b,c.length-p,p),Li.arraycopy(b,0,c,0,c.length)}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];if(c===d)return!0;if(c===null||d===null||c.length!==d.length)return!1;for(var p=0;p<c.length;p++)if(!c[p].equals(d[p]))return!1;return!0}if(arguments.length===3){var b=arguments[0],L=arguments[1],O=arguments[2];if(b===L)return!0;if(b===null||L===null||b.length!==L.length)return!1;for(var V=0;V<b.length;V++)if(O.compare(b[V],L[V])!==0)return!1;return!0}}},{key:"intersection",value:function(c,d){for(var p=new Mi,b=0;b<c.length;b++)d.intersects(c[b])&&p.add(c[b],!0);return p.toCoordinateArray()}},{key:"measures",value:function(c){if(c===null||c.length===0)return 0;var d,p=0,b=Q(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p=Math.max(p,hi.measures(L))}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"hasRepeatedPoints",value:function(c){for(var d=1;d<c.length;d++)if(c[d-1].equals(c[d]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(c){return I.hasRepeatedPoints(c)?new Mi(c,!1).toCoordinateArray():c}},{key:"reverse",value:function(c){for(var d=c.length-1,p=Math.trunc(d/2),b=0;b<=p;b++){var L=c[b];c[b]=c[d-b],c[d-b]=L}}},{key:"removeNull",value:function(c){for(var d=0,p=0;p<c.length;p++)c[p]!==null&&d++;var b=new Array(d).fill(null);if(d===0)return b;for(var L=0,O=0;O<c.length;O++)c[O]!==null&&(b[L++]=c[O]);return b}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Array(c.length).fill(null),p=0;p<c.length;p++)d[p]=c[p].copy();return d}if(arguments.length===5)for(var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3],$=arguments[4],me=0;me<$;me++)O[V+me]=b[L+me].copy()}},{key:"isEqualReversed",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p],L=d[c.length-p-1];if(b.compareTo(L)!==0)return!1}return!0}},{key:"envelope",value:function(c){for(var d=new dn,p=0;p<c.length;p++)d.expandToInclude(c[p]);return d}},{key:"toCoordinateArray",value:function(c){return c.toArray(I.coordArrayType)}},{key:"dimension",value:function(c){if(c===null||c.length===0)return 3;var d,p=0,b=Q(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p=Math.max(p,hi.dimension(L))}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"atLeastNCoordinatesOrNothing",value:function(c,d){return d.length>=c?d:[]}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.length;p++)if(c.equals(d[p]))return p;return-1}},{key:"increasingDirection",value:function(c){for(var d=0;d<Math.trunc(c.length/2);d++){var p=c.length-1-d,b=c[d].compareTo(c[p]);if(b!==0)return b}return 1}},{key:"compare",value:function(c,d){for(var p=0;p<c.length&&p<d.length;){var b=c[p].compareTo(d[p]);if(b!==0)return b;p++}return p<d.length?-1:p<c.length?1:0}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.length;p++)(d===null||d.compareTo(c[p])>0)&&(d=c[p]);return d}},{key:"extract",value:function(c,d,p){d=Ar.clamp(d,0,c.length);var b=(p=Ar.clamp(p,-1,c.length))-d+1;p<0&&(b=0),d>=c.length&&(b=0),p<d&&(b=0);var L=new Array(b).fill(null);if(b===0)return L;for(var O=0,V=d;V<=p;V++)L[O++]=c[V];return L}}]),I}(),Tr=function(){function I(){n(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;return Wn.compare(p,b)}},{key:"interfaces_",get:function(){return[wt]}}]),I}(),Do=function(){function I(){n(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;var L=Wn.compare(p,b);return Wn.isEqualReversed(p,b)?0:L}},{key:"OLDcompare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;for(var L=Wn.increasingDirection(p),O=Wn.increasingDirection(b),V=L>0?0:p.length-1,$=O>0?0:p.length-1,me=0;me<p.length;me++){var Be=p[V].compareTo(b[$]);if(Be!==0)return Be;V+=L,$+=O}return 0}},{key:"interfaces_",get:function(){return[wt]}}]),I}();Wn.ForwardComparator=Tr,Wn.BidirectionalComparator=Do,Wn.coordArrayType=new Array(0).fill(null);var Qn=function(){function I(c){n(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),bo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(c){return this.hasM()?this._coordinates[c].getM():vt.NaN}},{key:"setOrdinate",value:function(c,d,p){switch(d){case kn.X:this._coordinates[c].x=p;break;case kn.Y:this._coordinates[c].y=p;break;default:this._coordinates[c].setOrdinate(d,p)}}},{key:"getZ",value:function(c){return this.hasZ()?this._coordinates[c].getZ():vt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(c,d){switch(d){case kn.X:return this._coordinates[c].x;case kn.Y:return this._coordinates[c].y;default:return this._coordinates[c].getOrdinate(d)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var c=arguments[0];return this._coordinates[c]}if(arguments.length===2){var d=arguments[0],p=arguments[1];p.setCoordinate(this._coordinates[d])}}},{key:"getCoordinateCopy",value:function(c){var d=this.createCoordinate();return d.setCoordinate(this._coordinates[c]),d}},{key:"createCoordinate",value:function(){return hi.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(c){return this._coordinates[c].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(c){for(var d=0;d<this._coordinates.length;d++)c.expandToInclude(this._coordinates[d]);return c}},{key:"copy",value:function(){for(var c=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++){var p=this.createCoordinate();p.setCoordinate(this._coordinates[d]),c[d]=p}return new I(c,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var c=new Qn(17*this._coordinates.length);c.append("("),c.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)c.append(", "),c.append(this._coordinates[d]);return c.append(")"),c.toString()}return"()"}},{key:"getY",value:function(c){return this._coordinates[c].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[kn,be]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];I.constructor_.call(this,c,Wn.dimension(c),Wn.measures(c))}else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=new Array(d).fill(null);for(var p=0;p<d;p++)this._coordinates[p]=new We}else if(xn(arguments[0],kn)){var b=arguments[0];if(b===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=b.getDimension(),this._measures=b.getMeasures(),this._coordinates=new Array(b.size()).fill(null);for(var L=0;L<this._coordinates.length;L++)this._coordinates[L]=b.getCoordinateCopy(L)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var O=arguments[0],V=arguments[1];I.constructor_.call(this,O,V,Wn.measures(O))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var $=arguments[0],me=arguments[1];this._coordinates=new Array($).fill(null),this._dimension=me;for(var Be=0;Be<$;Be++)this._coordinates[Be]=hi.create(me)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var Ke=arguments[0],mt=arguments[1],zt=arguments[2];this._dimension=mt,this._measures=zt,this._coordinates=Ke===null?new Array(0).fill(null):Ke}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Nt=arguments[0],gn=arguments[1],bn=arguments[2];this._coordinates=new Array(Nt).fill(null),this._dimension=gn,this._measures=bn;for(var Rn=0;Rn<Nt;Rn++)this._coordinates[Rn]=this.createCoordinate()}}}}]),I}(),aa=function(){function I(){n(this,I)}return a(I,[{key:"readResolve",value:function(){return I.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new bo(c)}if(xn(arguments[0],kn)){var d=arguments[0];return new bo(d)}}else{if(arguments.length===2){var p=arguments[0],b=arguments[1];return b>3&&(b=3),b<2&&(b=2),new bo(p,b)}if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2],$=O-V;return V>1&&(V=1),$>3&&($=3),$<2&&($=2),new bo(L,$+V,V)}}}},{key:"interfaces_",get:function(){return[Zr,be]}}],[{key:"instance",value:function(){return I.instanceObject}}]),I}();aa.instanceObject=new aa;var Cr=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var p=new At,b=0;b<this._geometries.length;b++)for(var L=this._geometries[b].getBoundary(),O=0;O<L.getNumGeometries();O++)p.add(L.getGeometryN(O));var V=new Array(p.size()).fill(null);return this.getFactory().createMultiLineString(p.toArray(V))}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Mn.constructor_.call(this,p,b)}}]),d}(Mn),Nr=function(){function I(){n(this,I)}return a(I,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),I}(),yc=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).map=new Map,p}return a(d,[{key:"get",value:function(p){return this.map.get(p)||null}},{key:"put",value:function(p,b){return this.map.set(p,b),b}},{key:"values",value:function(){for(var p=new At,b=this.map.values(),L=b.next();!L.done;)p.add(L.value),L=b.next();return p}},{key:"entrySet",value:function(){var p=new kt;return this.map.entries().forEach(function(b){return p.add(b)}),p}},{key:"size",value:function(){return this.map.size()}}]),d}(Nr),Ri=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this._modelType===d._modelType&&this._scale===d._scale}},{key:"compareTo",value:function(c){var d=c,p=this.getMaximumSignificantDigits(),b=d.getMaximumSignificantDigits();return Yi.compare(p,b)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===I.FLOATING||this._modelType===I.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var c="UNKNOWN";return this._modelType===I.FLOATING?c="Floating":this._modelType===I.FLOATING_SINGLE?c="Floating-Single":this._modelType===I.FIXED&&(c="Fixed (Scale="+this.getScale()+")"),c}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var c=arguments[0];return vt.isNaN(c)||this._modelType===I.FLOATING_SINGLE?c:this._modelType===I.FIXED?Math.round(c*this._scale)/this._scale:c}if(arguments[0]instanceof We){var d=arguments[0];if(this._modelType===I.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}}},{key:"getMaximumSignificantDigits",value:function(){var c=16;return this._modelType===I.FLOATING?c=16:this._modelType===I.FLOATING_SINGLE?c=6:this._modelType===I.FIXED&&(c=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),c}},{key:"setScale",value:function(c){this._scale=Math.abs(c)}},{key:"interfaces_",get:function(){return[be,he]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=I.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof or){var c=arguments[0];this._modelType=c,c===I.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var d=arguments[0];this._modelType=I.FIXED,this.setScale(d)}else if(arguments[0]instanceof I){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}}},{key:"mostPrecise",value:function(c,d){return c.compareTo(d)>=0?c:d}}]),I}(),or=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"readResolve",value:function(){return I.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){this._name=null;var c=arguments[0];this._name=c,I.nameToTypeMap.put(c,this)}}]),I}();or.nameToTypeMap=new yc,Ri.Type=or,Ri.FIXED=new or("FIXED"),Ri.FLOATING=new or("FLOATING"),Ri.FLOATING_SINGLE=new or("FLOATING SINGLE"),Ri.maximumPreciseValue=9007199254740992;var no=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Ct}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Y]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Mn.constructor_.call(this,p,b)}}]),d}(Mn),Qr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"createEmpty",value:function(c){switch(c){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new ve("Invalid dimension: "+c)}}},{key:"toGeometry",value:function(c){return c.isNull()?this.createPoint():c.getMinX()===c.getMaxX()&&c.getMinY()===c.getMaxY()?this.createPoint(new We(c.getMinX(),c.getMinY())):c.getMinX()===c.getMaxX()||c.getMinY()===c.getMaxY()?this.createLineString([new We(c.getMinX(),c.getMinY()),new We(c.getMaxX(),c.getMaxY())]):this.createPolygon(this.createLinearRing([new We(c.getMinX(),c.getMinY()),new We(c.getMinX(),c.getMaxY()),new We(c.getMaxX(),c.getMaxY()),new We(c.getMaxX(),c.getMinY()),new We(c.getMinX(),c.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLineString(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new Xe(d,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new no(null,this);if(arguments.length===1){var c=arguments[0];return new no(c,this)}}},{key:"buildGeometry",value:function(c){for(var d=null,p=!1,b=!1,L=c.iterator();L.hasNext();){var O=L.next(),V=O.getTypeCode();d===null&&(d=V),V!==d&&(p=!0),O instanceof Mn&&(b=!0)}if(d===null)return this.createGeometryCollection();if(p||b)return this.createGeometryCollection(I.toGeometryArray(c));var $=c.iterator().next();if(c.size()>1){if($ instanceof en)return this.createMultiPolygon(I.toPolygonArray(c));if($ instanceof Xe)return this.createMultiLineString(I.toLineStringArray(c));if($ instanceof et)return this.createMultiPoint(I.toPointArray(c));It.shouldNeverReachHere("Unhandled geometry type: "+$.getGeometryType())}return $}},{key:"createMultiPointFromCoords",value:function(c){return this.createMultiPoint(c!==null?this.getCoordinateSequenceFactory().create(c):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];return this.createPoint(c!==null?this.getCoordinateSequenceFactory().create([c]):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new et(d,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(xn(arguments[0],kn)){var c=arguments[0];return this.createPolygon(this.createLinearRing(c))}if(arguments[0]instanceof Array){var d=arguments[0];return this.createPolygon(this.createLinearRing(d))}if(arguments[0]instanceof wi){var p=arguments[0];return this.createPolygon(p,null)}}else if(arguments.length===2){var b=arguments[0],L=arguments[1];return new en(b,L,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new Mn(null,this);if(arguments.length===1){var c=arguments[0];return new Mn(c,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLinearRing(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new wi(d,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new Cr(null,this);if(arguments.length===1){var c=arguments[0];return new Cr(c,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Bn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new Bn(c,this)}if(xn(arguments[0],kn)){var d=arguments[0];if(d===null)return this.createMultiPoint(new Array(0).fill(null));for(var p=new Array(d.size()).fill(null),b=0;b<d.size();b++){var L=this.getCoordinateSequenceFactory().create(1,d.getDimension(),d.getMeasures());ce.copy(d,b,L,0,1),p[b]=this.createPoint(L)}return this.createMultiPoint(p)}}}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)I.constructor_.call(this,new Ri,0);else if(arguments.length===1){if(xn(arguments[0],Zr)){var c=arguments[0];I.constructor_.call(this,new Ri,0,c)}else if(arguments[0]instanceof Ri){var d=arguments[0];I.constructor_.call(this,d,0,I.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];I.constructor_.call(this,p,b,I.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._precisionModel=L,this._coordinateSequenceFactory=V,this._SRID=O}}},{key:"toMultiPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toGeometryArray",value:function(c){if(c===null)return null;var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return aa.instance()}},{key:"toMultiLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toMultiPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLinearRingArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"createPointFromInternalCoord",value:function(c,d){return d.getPrecisionModel().makePrecise(c),d.getFactory().createPoint(c)}}]),I}(),Pi="XY",la="XYZ",gs="XYM",Fi="XYZM",ua={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},es="EMPTY",No=1,Qi=2,io=3,ca=4,ts=5,ro=6;for(var ei in ua)ua[ei].toUpperCase();var Il=function(){function I(c){n(this,I),this.wkt=c,this.index_=-1}return a(I,[{key:"isAlpha_",value:function(c){return c>="a"&&c<="z"||c>="A"&&c<="Z"}},{key:"isNumeric_",value:function(c,d){return c>="0"&&c<="9"||c=="."&&!(d!==void 0&&d)}},{key:"isWhiteSpace_",value:function(c){return c==" "||c=="	"||c=="\r"||c==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var c,d=this.nextChar_(),p=this.index_,b=d;if(d=="(")c=Qi;else if(d==",")c=ts;else if(d==")")c=io;else if(this.isNumeric_(d)||d=="-")c=ca,b=this.readNumber_();else if(this.isAlpha_(d))c=No,b=this.readText_();else{if(this.isWhiteSpace_(d))return this.nextToken();if(d!=="")throw new Error("Unexpected character: "+d);c=ro}return{position:p,value:b,type:c}}},{key:"readNumber_",value:function(){var c,d=this.index_,p=!1,b=!1;do c=="."?p=!0:c!="e"&&c!="E"||(b=!0),c=this.nextChar_();while(this.isNumeric_(c,p)||!b&&(c=="e"||c=="E")||b&&(c=="-"||c=="+"));return parseFloat(this.wkt.substring(d,this.index_--))}},{key:"readText_",value:function(){var c,d=this.index_;do c=this.nextChar_();while(this.isAlpha_(c));return this.wkt.substring(d,this.index_--).toUpperCase()}}]),I}(),Sl=function(){function I(c,d){n(this,I),this.lexer_=c,this.token_,this.layout_=Pi,this.factory=d}return a(I,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(c){return this.token_.type==c}},{key:"match",value:function(c){var d=this.isTokenType(c);return d&&this.consume_(),d}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var c=Pi,d=this.token_;if(this.isTokenType(No)){var p=d.value;p==="Z"?c=la:p==="M"?c=gs:p==="ZM"&&(c=Fi),c!==Pi&&this.consume_()}return c}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Qi)){var c=[];do c.push(this.parseGeometry_());while(this.match(ts));if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Qi)){var c=this.parsePoint_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Qi)){var c=this.parsePointList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var c;if(this.match(Qi)){if(c=this.token_.type==Qi?this.parsePointTextList_():this.parsePointList_(),this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Qi)){var c=this.parsePolygonTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var c=[],d=this.layout_.length,p=0;p<d;++p){var b=this.token_;if(!this.match(ca))break;c.push(b.value)}if(c.length==d)return c;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var c=[this.parsePoint_()];this.match(ts);)c.push(this.parsePoint_());return c}},{key:"parsePointTextList_",value:function(){for(var c=[this.parsePointText_()];this.match(ts);)c.push(this.parsePointText_());return c}},{key:"parseLineStringTextList_",value:function(){for(var c=[this.parseLineStringText_()];this.match(ts);)c.push(this.parseLineStringText_());return c}},{key:"parsePolygonTextList_",value:function(){for(var c=[this.parsePolygonText_()];this.match(ts);)c.push(this.parsePolygonText_());return c}},{key:"isEmptyGeometry_",value:function(){var c=this.isTokenType(No)&&this.token_.value==es;return c&&this.consume_(),c}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var c=this.factory,d=function(bn){return S(We,ee(bn))},p=function(bn){var Rn=bn.map(function(ti){return c.createLinearRing(ti.map(d))});return Rn.length>1?c.createPolygon(Rn[0],Rn.slice(1)):c.createPolygon(Rn[0])},b=this.token_;if(this.match(No)){var L=b.value;if(this.layout_=this.parseGeometryLayout_(),L=="GEOMETRYCOLLECTION"){var O=this.parseGeometryCollectionText_();return c.createGeometryCollection(O)}switch(L){case"POINT":var V=this.parsePointText_();return V?c.createPoint(S(We,ee(V))):c.createPoint();case"LINESTRING":var $=this.parseLineStringText_().map(d);return c.createLineString($);case"LINEARRING":var me=this.parseLineStringText_().map(d);return c.createLinearRing(me);case"POLYGON":var Be=this.parsePolygonText_();return Be&&Be.length!==0?p(Be):c.createPolygon();case"MULTIPOINT":var Ke=this.parseMultiPointText_();if(!Ke||Ke.length===0)return c.createMultiPoint();var mt=Ke.map(d).map(function(bn){return c.createPoint(bn)});return c.createMultiPoint(mt);case"MULTILINESTRING":var zt=this.parseMultiLineStringText_().map(function(bn){return c.createLineString(bn.map(d))});return c.createMultiLineString(zt);case"MULTIPOLYGON":var Nt=this.parseMultiPolygonText_();if(!Nt||Nt.length===0)return c.createMultiPolygon();var gn=Nt.map(p);return c.createMultiPolygon(gn);default:throw new Error("Invalid geometry type: "+L)}}throw new Error(this.formatErrorMessage_())}}]),I}();function xo(I){if(I.isEmpty())return"";var c=I.getCoordinate(),d=[c.x,c.y];return c.z===void 0||Number.isNaN(c.z)||d.push(c.z),c.m===void 0||Number.isNaN(c.m)||d.push(c.m),d.join(" ")}function wo(I){for(var c=I.getCoordinates().map(function(L){var O=[L.x,L.y];return L.z===void 0||Number.isNaN(L.z)||O.push(L.z),L.m===void 0||Number.isNaN(L.m)||O.push(L.m),O}),d=[],p=0,b=c.length;p<b;++p)d.push(c[p].join(" "));return d.join(", ")}function ha(I){var c=[];c.push("("+wo(I.getExteriorRing())+")");for(var d=0,p=I.getNumInteriorRing();d<p;++d)c.push("("+wo(I.getInteriorRingN(d))+")");return c.join(", ")}var fa={Point:xo,LineString:wo,LinearRing:wo,Polygon:ha,MultiPoint:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+xo(I.getGeometryN(d))+")");return c.join(", ")},MultiLineString:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+wo(I.getGeometryN(d))+")");return c.join(", ")},MultiPolygon:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+ha(I.getGeometryN(d))+")");return c.join(", ")},GeometryCollection:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push(da(I.getGeometryN(d)));return c.join(", ")}};function da(I){var c=I.getGeometryType(),d=fa[c];c=c.toUpperCase();var p=function(b){var L="";if(b.isEmpty())return L;var O=b.getCoordinate();return O.z===void 0||Number.isNaN(O.z)||(L+="Z"),O.m===void 0||Number.isNaN(O.m)||(L+="M"),L}(I);return p.length>0&&(c+=" "+p),I.isEmpty()?c+" "+es:c+" ("+d(I)+")"}var zo=function(){function I(c){n(this,I),this.geometryFactory=c||new Qr,this.precisionModel=this.geometryFactory.getPrecisionModel()}return a(I,[{key:"read",value:function(c){var d=new Il(c);return new Sl(d,this.geometryFactory).parse()}},{key:"write",value:function(c){return da(c)}}]),I}(),za=function(){function I(c){n(this,I),this.parser=new zo(c)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}],[{key:"toLineString",value:function(c,d){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+c.x+" "+c.y+", "+d.x+" "+d.y+" )"}}]),I}(),ki=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getIndexAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intLineIndex[c][d]}},{key:"getTopologySummary",value:function(){var c=new Qn;return this.isEndPoint()&&c.append(" endpoint"),this._isProper&&c.append(" proper"),this.isCollinear()&&c.append(" collinear"),c.toString()}},{key:"computeIntersection",value:function(c,d,p,b){this._inputLines[0][0]=c,this._inputLines[0][1]=d,this._inputLines[1][0]=p,this._inputLines[1][1]=b,this._result=this.computeIntersect(c,d,p,b)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var c=arguments[0],d=this.getEdgeDistance(c,0),p=this.getEdgeDistance(c,1);d>p?(this._intLineIndex[c][0]=0,this._intLineIndex[c][1]=1):(this._intLineIndex[c][0]=1,this._intLineIndex[c][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var c=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[c][0])&&!this._intPt[d].equals2D(this._inputLines[c][1]))return!0;return!1}}},{key:"getIntersection",value:function(c){return this._intPt[c]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==I.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(c,d){return I.computeEdgeDistance(this._intPt[d],this._inputLines[c][0],this._inputLines[c][1])}},{key:"isCollinear",value:function(){return this._result===I.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return za.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+za.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(c,d){return this._inputLines[c][d]}},{key:"isIntersection",value:function(c){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(c))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[c][d]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new We,this._intPt[1]=new We,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(c,d,p){var b=Math.abs(p.x-d.x),L=Math.abs(p.y-d.y),O=-1;if(c.equals(d))O=0;else if(c.equals(p))O=b>L?b:L;else{var V=Math.abs(c.x-d.x),$=Math.abs(c.y-d.y);(O=b>L?V:$)!==0||c.equals(d)||(O=Math.max(V,$))}return It.isTrue(!(O===0&&!c.equals(d)),"Bad distance calculation"),O}},{key:"nonRobustComputeEdgeDistance",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y,O=Math.sqrt(b*b+L*L);return It.isTrue(!(O===0&&!c.equals(d)),"Invalid distance calculation"),O}}]),I}();ki.DONT_INTERSECT=0,ki.DO_INTERSECT=1,ki.COLLINEAR=2,ki.NO_INTERSECTION=0,ki.POINT_INTERSECTION=1,ki.COLLINEAR_INTERSECTION=2;var so=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.call(this)}return a(d,[{key:"isInSegmentEnvelopes",value:function(p){var b=new dn(this._inputLines[0][0],this._inputLines[0][1]),L=new dn(this._inputLines[1][0],this._inputLines[1][1]);return b.contains(p)&&L.contains(p)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return U(m(d.prototype),"computeIntersection",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=arguments[2];if(this._isProper=!1,dn.intersects(b,L,p)&&mn.index(b,L,p)===0&&mn.index(L,b,p)===0)return this._isProper=!0,(p.equals(b)||p.equals(L))&&(this._isProper=!1),this._result=ki.POINT_INTERSECTION,null;this._result=ki.NO_INTERSECTION}},{key:"intersection",value:function(p,b,L,O){var V=this.intersectionSafe(p,b,L,O);return this.isInSegmentEnvelopes(V)||(V=new We(d.nearestEndpoint(p,b,L,O))),this._precisionModel!==null&&this._precisionModel.makePrecise(V),V}},{key:"checkDD",value:function(p,b,L,O,V){var $=yr.intersection(p,b,L,O),me=this.isInSegmentEnvelopes($);Li.out.println("DD in env = "+me+"  --------------------- "+$),V.distance($)>1e-4&&Li.out.println("Distance = "+V.distance($))}},{key:"intersectionSafe",value:function(p,b,L,O){var V=wn.intersection(p,b,L,O);return V===null&&(V=d.nearestEndpoint(p,b,L,O)),V}},{key:"computeCollinearIntersection",value:function(p,b,L,O){var V=dn.intersects(p,b,L),$=dn.intersects(p,b,O),me=dn.intersects(L,O,p),Be=dn.intersects(L,O,b);return V&&$?(this._intPt[0]=L,this._intPt[1]=O,ki.COLLINEAR_INTERSECTION):me&&Be?(this._intPt[0]=p,this._intPt[1]=b,ki.COLLINEAR_INTERSECTION):V&&me?(this._intPt[0]=L,this._intPt[1]=p,!L.equals(p)||$||Be?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):V&&Be?(this._intPt[0]=L,this._intPt[1]=b,!L.equals(b)||$||me?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):$&&me?(this._intPt[0]=O,this._intPt[1]=p,!O.equals(p)||V||Be?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):$&&Be?(this._intPt[0]=O,this._intPt[1]=b,!O.equals(b)||V||me?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):ki.NO_INTERSECTION}},{key:"computeIntersect",value:function(p,b,L,O){if(this._isProper=!1,!dn.intersects(p,b,L,O))return ki.NO_INTERSECTION;var V=mn.index(p,b,L),$=mn.index(p,b,O);if(V>0&&$>0||V<0&&$<0)return ki.NO_INTERSECTION;var me=mn.index(L,O,p),Be=mn.index(L,O,b);return me>0&&Be>0||me<0&&Be<0?ki.NO_INTERSECTION:V===0&&$===0&&me===0&&Be===0?this.computeCollinearIntersection(p,b,L,O):(V===0||$===0||me===0||Be===0?(this._isProper=!1,p.equals2D(L)||p.equals2D(O)?this._intPt[0]=p:b.equals2D(L)||b.equals2D(O)?this._intPt[0]=b:V===0?this._intPt[0]=new We(L):$===0?this._intPt[0]=new We(O):me===0?this._intPt[0]=new We(p):Be===0&&(this._intPt[0]=new We(b))):(this._isProper=!0,this._intPt[0]=this.intersection(p,b,L,O)),ki.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(p,b,L,O){var V=p,$=Ji.pointToSegment(p,L,O),me=Ji.pointToSegment(b,L,O);return me<$&&($=me,V=b),(me=Ji.pointToSegment(L,p,b))<$&&($=me,V=L),(me=Ji.pointToSegment(O,p,b))<$&&($=me,V=O),V}}]),d}(ki),vc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"countSegment",value:function(c,d){if(c.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(c.y===this._p.y&&d.y===this._p.y){var p=c.x,b=d.x;return p>b&&(p=d.x,b=c.x),this._p.x>=p&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(c.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&c.y<=this._p.y){var L=mn.index(c,d,this._p);if(L===mn.COLLINEAR)return this._isPointOnSegment=!0,null;d.y<c.y&&(L=-L),L===mn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Se.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Se.BOUNDARY:this._crossingCount%2==1?Se.INTERIOR:Se.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var c=arguments[0];this._p=c}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof We&&xn(arguments[1],kn)){for(var c=arguments[0],d=arguments[1],p=new I(c),b=new We,L=new We,O=1;O<d.size();O++)if(d.getCoordinate(O,b),d.getCoordinate(O-1,L),p.countSegment(b,L),p.isOnSegment())return p.getLocation();return p.getLocation()}if(arguments[0]instanceof We&&arguments[1]instanceof Array){for(var V=arguments[0],$=arguments[1],me=new I(V),Be=1;Be<$.length;Be++){var Ke=$[Be],mt=$[Be-1];if(me.countSegment(Ke,mt),me.isOnSegment())return me.getLocation()}return me.getLocation()}}}]),I}(),qs=function(){function I(){n(this,I)}return a(I,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof We&&xn(arguments[1],kn)){for(var c=arguments[0],d=arguments[1],p=new so,b=new We,L=new We,O=d.size(),V=1;V<O;V++)if(d.getCoordinate(V-1,b),d.getCoordinate(V,L),p.computeIntersection(c,b,L),p.hasIntersection())return!0;return!1}if(arguments[0]instanceof We&&arguments[1]instanceof Array){for(var $=arguments[0],me=arguments[1],Be=new so,Ke=1;Ke<me.length;Ke++){var mt=me[Ke-1],zt=me[Ke];if(Be.computeIntersection($,mt,zt),Be.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(c,d){return vc.locatePointInRing(c,d)}},{key:"isInRing",value:function(c,d){return I.locateInRing(c,d)!==Se.EXTERIOR}}]),I}(),br=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setAllLocations",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]=c}},{key:"isNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]!==Se.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]===Se.NONE&&(this.location[d]=c)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(c){if(c.location.length>this.location.length){var d=new Array(3).fill(null);d[Ee.ON]=this.location[Ee.ON],d[Ee.LEFT]=Se.NONE,d[Ee.RIGHT]=Se.NONE,this.location=d}for(var p=0;p<this.location.length;p++)this.location[p]===Se.NONE&&p<c.location.length&&(this.location[p]=c.location[p])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var c=this.location[Ee.LEFT];this.location[Ee.LEFT]=this.location[Ee.RIGHT],this.location[Ee.RIGHT]=c}},{key:"toString",value:function(){var c=new Vi;return this.location.length>1&&c.append(Se.toLocationSymbol(this.location[Ee.LEFT])),c.append(Se.toLocationSymbol(this.location[Ee.ON])),this.location.length>1&&c.append(Se.toLocationSymbol(this.location[Ee.RIGHT])),c.toString()}},{key:"setLocations",value:function(c,d,p){this.location[Ee.ON]=c,this.location[Ee.LEFT]=d,this.location[Ee.RIGHT]=p}},{key:"get",value:function(c){return c<this.location.length?this.location[c]:Se.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]===Se.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var c=arguments[0];this.setLocation(Ee.ON,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.location[d]=p}}},{key:"init",value:function(c){this.location=new Array(c).fill(null),this.setAllLocations(Se.NONE)}},{key:"isEqualOnSide",value:function(c,d){return this.location[d]===c.location[d]}},{key:"allPositionsEqual",value:function(c){for(var d=0;d<this.location.length;d++)if(this.location[d]!==c)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];this.init(c.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[Ee.ON]=d}else if(arguments[0]instanceof I){var p=arguments[0];if(this.init(p.location.length),p!==null)for(var b=0;b<this.location.length;b++)this.location[b]=p.location[b]}}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this.init(3),this.location[Ee.ON]=L,this.location[Ee.LEFT]=O,this.location[Ee.RIGHT]=V}}}]),I}(),bi=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getGeometryCount",value:function(){var c=0;return this.elt[0].isNull()||c++,this.elt[1].isNull()||c++,c}},{key:"setAllLocations",value:function(c,d){this.elt[c].setAllLocations(d)}},{key:"isNull",value:function(c){return this.elt[c].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var c=arguments[0];this.setAllLocationsIfNull(0,c),this.setAllLocationsIfNull(1,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.elt[d].setAllLocationsIfNull(p)}}},{key:"isLine",value:function(c){return this.elt[c].isLine()}},{key:"merge",value:function(c){for(var d=0;d<2;d++)this.elt[d]===null&&c.elt[d]!==null?this.elt[d]=new br(c.elt[d]):this.elt[d].merge(c.elt[d])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var c=arguments[0];return this.elt[c].get(Ee.ON)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return this.elt[d].get(p)}}},{key:"toString",value:function(){var c=new Vi;return this.elt[0]!==null&&(c.append("A:"),c.append(this.elt[0].toString())),this.elt[1]!==null&&(c.append(" B:"),c.append(this.elt[1].toString())),c.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var c=arguments[0];return this.elt[c].isArea()}}},{key:"isAnyNull",value:function(c){return this.elt[c].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.elt[c].setLocation(Ee.ON,d)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];this.elt[p].setLocation(b,L)}}},{key:"isEqualOnSide",value:function(c,d){return this.elt[0].isEqualOnSide(c.elt[0],d)&&this.elt[1].isEqualOnSide(c.elt[1],d)}},{key:"allPositionsEqual",value:function(c,d){return this.elt[c].allPositionsEqual(d)}},{key:"toLine",value:function(c){this.elt[c].isArea()&&(this.elt[c]=new br(this.elt[c].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var c=arguments[0];this.elt[0]=new br(c),this.elt[1]=new br(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.elt[0]=new br(d.elt[0]),this.elt[1]=new br(d.elt[1])}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.elt[0]=new br(Se.NONE),this.elt[1]=new br(Se.NONE),this.elt[p].setLocation(b)}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this.elt[0]=new br(L,O,V),this.elt[1]=new br(L,O,V)}else if(arguments.length===4){var $=arguments[0],me=arguments[1],Be=arguments[2],Ke=arguments[3];this.elt[0]=new br(Se.NONE,Se.NONE,Se.NONE),this.elt[1]=new br(Se.NONE,Se.NONE,Se.NONE),this.elt[$].setLocations(me,Be,Ke)}}},{key:"toLineLabel",value:function(c){for(var d=new I(Se.NONE),p=0;p<2;p++)d.setLocation(p,c.getLocation(p));return d}}]),I}(),cr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var c=new Array(this._pts.size()).fill(null),d=0;d<this._pts.size();d++)c[d]=this._pts.get(d);this._ring=this._geometryFactory.createLinearRing(c),this._isHole=mn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(c){this._startDe=c;var d=c,p=!0;do{if(d===null)throw new Mt("Found null DirectedEdge");if(d.getEdgeRing()===this)throw new Mt("Directed Edge visited twice during ring-building at "+d.getCoordinate());this._edges.add(d);var b=d.getLabel();It.isTrue(b.isArea()),this.mergeLabel(b),this.addPoints(d.getEdge(),d.isForward(),p),p=!1,this.setEdgeRing(d,this),d=this.getNext(d)}while(d!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(c){return this._pts.get(c)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var c=this._startDe;do{var d=c.getNode().getEdges().getOutgoingDegree(this);d>this._maxNodeDegree&&(this._maxNodeDegree=d),c=this.getNext(c)}while(c!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(c,d,p){var b=c.getCoordinates();if(d){var L=1;p&&(L=0);for(var O=L;O<b.length;O++)this._pts.add(b[O])}else{var V=b.length-2;p&&(V=b.length-1);for(var $=V;$>=0;$--)this._pts.add(b[$])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var c=this._startDe;do c.getEdge().setInResult(!0),c=c.getNext();while(c!==this._startDe)}},{key:"containsPoint",value:function(c){var d=this.getLinearRing();if(!d.getEnvelopeInternal().contains(c)||!qs.isInRing(c,d.getCoordinates()))return!1;for(var p=this._holes.iterator();p.hasNext();)if(p.next().containsPoint(c))return!1;return!0}},{key:"addHole",value:function(c){this._holes.add(c)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var c=arguments[0];this.mergeLabel(c,0),this.mergeLabel(c,1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1],b=d.getLocation(p,Ee.RIGHT);if(b===Se.NONE)return null;if(this._label.getLocation(p)===Se.NONE)return this._label.setLocation(p,b),null}}},{key:"setShell",value:function(c){this._shell=c,c!==null&&c.addHole(this)}},{key:"toPolygon",value:function(c){for(var d=new Array(this._holes.size()).fill(null),p=0;p<this._holes.size();p++)d[p]=this._holes.get(p).getLinearRing();return c.createPolygon(this.getLinearRing(),d)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new At,this._pts=new At,this._label=new bi(Se.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new At,this._geometryFactory=null,arguments.length!==0&&arguments.length===2){var c=arguments[0],d=arguments[1];this._geometryFactory=d,this.computePoints(c),this.computeRing()}}}]),I}(),Fa=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"setEdgeRing",value:function(p,b){p.setMinEdgeRing(b)}},{key:"getNext",value:function(p){return p.getNextMin()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),Oa=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"buildMinimalRings",value:function(){var p=new At,b=this._startDe;do{if(b.getMinEdgeRing()===null){var L=new Fa(b,this._geometryFactory);p.add(L)}b=b.getNext()}while(b!==this._startDe);return p}},{key:"setEdgeRing",value:function(p,b){p.setEdgeRing(b)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var p=this._startDe;do p.getNode().getEdges().linkMinimalDirectedEdges(this),p=p.getNext();while(p!==this._startDe)}},{key:"getNext",value:function(p){return p.getNext()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),pa=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setVisited",value:function(c){this._isVisited=c}},{key:"setInResult",value:function(c){this._isInResult=c}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(c){this._label=c}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(c){this._isCovered=c,this._isCoveredSet=!0}},{key:"updateIM",value:function(c){It.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(c)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._label=c}}}]),I}(),ma=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"isIncidentEdgeInResult",value:function(){for(var p=this.getEdges().getEdges().iterator();p.hasNext();)if(p.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(p){p.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(p){}},{key:"computeMergedLocation",value:function(p,b){var L=Se.NONE;if(L=this._label.getLocation(b),!p.isNull(b)){var O=p.getLocation(b);L!==Se.BOUNDARY&&(L=O)}return L}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return U(m(d.prototype),"setLabel",this).apply(this,arguments);var p=arguments[0],b=arguments[1];this._label===null?this._label=new bi(p,b):this._label.setLocation(p,b)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof d){var p=arguments[0];this.mergeLabel(p._label)}else if(arguments[0]instanceof bi)for(var b=arguments[0],L=0;L<2;L++){var O=this.computeMergedLocation(b,L),V=this._label.getLocation(L);V===Se.NONE&&this._label.setLocation(L,O)}}},{key:"add",value:function(p){this._edges.insert(p),p.setNode(this)}},{key:"setLabelBoundary",value:function(p){if(this._label===null)return null;var b=Se.NONE;this._label!==null&&(b=this._label.getLocation(p));var L=null;switch(b){case Se.BOUNDARY:L=Se.INTERIOR;break;case Se.INTERIOR:default:L=Se.BOUNDARY}this._label.setLocation(p,L)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var p=arguments[0],b=arguments[1];this._coord=p,this._edges=b,this._label=new bi(0,Se.NONE)}}]),d}(pa),Fo=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return d}(Nr);function au(I){return I==null?0:I.color}function ri(I){return I==null?null:I.parent}function _s(I,c){I!==null&&(I.color=c)}function El(I){return I==null?null:I.left}function lu(I){return I==null?null:I.right}var Oo=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).root_=null,p.size_=0,p}return a(d,[{key:"get",value:function(p){for(var b=this.root_;b!==null;){var L=p.compareTo(b.key);if(L<0)b=b.left;else{if(!(L>0))return b.value;b=b.right}}return null}},{key:"put",value:function(p,b){if(this.root_===null)return this.root_={key:p,value:b,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var L,O,V=this.root_;do if(L=V,(O=p.compareTo(V.key))<0)V=V.left;else{if(!(O>0)){var $=V.value;return V.value=b,$}V=V.right}while(V!==null);var me={key:p,left:null,right:null,value:b,parent:L,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return O<0?L.left=me:L.right=me,this.fixAfterInsertion(me),this.size_++,null}},{key:"fixAfterInsertion",value:function(p){var b;for(p.color=1;p!=null&&p!==this.root_&&p.parent.color===1;)ri(p)===El(ri(ri(p)))?au(b=lu(ri(ri(p))))===1?(_s(ri(p),0),_s(b,0),_s(ri(ri(p)),1),p=ri(ri(p))):(p===lu(ri(p))&&(p=ri(p),this.rotateLeft(p)),_s(ri(p),0),_s(ri(ri(p)),1),this.rotateRight(ri(ri(p)))):au(b=El(ri(ri(p))))===1?(_s(ri(p),0),_s(b,0),_s(ri(ri(p)),1),p=ri(ri(p))):(p===El(ri(p))&&(p=ri(p),this.rotateRight(p)),_s(ri(p),0),_s(ri(ri(p)),1),this.rotateLeft(ri(ri(p))));this.root_.color=0}},{key:"values",value:function(){var p=new At,b=this.getFirstEntry();if(b!==null)for(p.add(b.value);(b=d.successor(b))!==null;)p.add(b.value);return p}},{key:"entrySet",value:function(){var p=new kt,b=this.getFirstEntry();if(b!==null)for(p.add(b);(b=d.successor(b))!==null;)p.add(b);return p}},{key:"rotateLeft",value:function(p){if(p!=null){var b=p.right;p.right=b.left,b.left!=null&&(b.left.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.left===p?p.parent.left=b:p.parent.right=b,b.left=p,p.parent=b}}},{key:"rotateRight",value:function(p){if(p!=null){var b=p.left;p.left=b.right,b.right!=null&&(b.right.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.right===p?p.parent.right=b:p.parent.left=b,b.right=p,p.parent=b}}},{key:"getFirstEntry",value:function(){var p=this.root_;if(p!=null)for(;p.left!=null;)p=p.left;return p}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(p){for(var b=this.root_;b!==null;){var L=p.compareTo(b.key);if(L<0)b=b.left;else{if(!(L>0))return!0;b=b.right}}return!1}}],[{key:"successor",value:function(p){var b;if(p===null)return null;if(p.right!==null){for(b=p.right;b.left!==null;)b=b.left;return b}b=p.parent;for(var L=p;b!==null&&L===b.right;)L=b,b=b.parent;return b}}]),d}(Fo),Bo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"find",value:function(c){return this.nodeMap.get(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof We){var c=arguments[0],d=this.nodeMap.get(c);return d===null&&(d=this.nodeFact.createNode(c),this.nodeMap.put(c,d)),d}if(arguments[0]instanceof ma){var p=arguments[0],b=this.nodeMap.get(p.getCoordinate());return b===null?(this.nodeMap.put(p.getCoordinate(),p),p):(b.mergeLabel(p),b)}}},{key:"print",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(c){for(var d=new At,p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().getLocation(c)===Se.BOUNDARY&&d.add(b)}return d}},{key:"add",value:function(c){var d=c.getCoordinate();this.addNode(d).add(c)}}],[{key:"constructor_",value:function(){this.nodeMap=new Oo,this.nodeFact=null;var c=arguments[0];this.nodeFact=c}}]),I}(),hr=function(){function I(){n(this,I)}return a(I,null,[{key:"isNorthern",value:function(c){return c===I.NE||c===I.NW}},{key:"isOpposite",value:function(c,d){return c!==d&&(c-d+4)%4===2}},{key:"commonHalfPlane",value:function(c,d){if(c===d)return c;if((c-d+4)%4===2)return-1;var p=c<d?c:d;return p===0&&(c>d?c:d)===3?3:p}},{key:"isInHalfPlane",value:function(c,d){return d===I.SE?c===I.SE||c===I.SW:c===d||c===d+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the quadrant for point ( "+c+", "+d+" )");return c>=0?d>=0?I.NE:I.SE:d>=0?I.NW:I.SW}if(arguments[0]instanceof We&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1];if(b.x===p.x&&b.y===p.y)throw new ve("Cannot compute the quadrant for two identical points "+p);return b.x>=p.x?b.y>=p.y?I.NE:I.SE:b.y>=p.y?I.NW:I.SW}}}]),I}();hr.NE=0,hr.NW=1,hr.SW=2,hr.SE=3;var ga=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareDirection",value:function(c){return this._dx===c._dx&&this._dy===c._dy?0:this._quadrant>c._quadrant?1:this._quadrant<c._quadrant?-1:mn.index(c._p0,c._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(c){this._node=c}},{key:"print",value:function(c){var d=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),b=p.lastIndexOf("."),L=p.substring(b+1);c.print("  "+L+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)}},{key:"compareTo",value:function(c){var d=c;return this.compareDirection(d)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var c=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),p=d.lastIndexOf(".");return"  "+d.substring(p+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+c+"   "+this._label}},{key:"computeLabel",value:function(c){}},{key:"init",value:function(c,d){this._p0=c,this._p1=d,this._dx=d.x-c.x,this._dy=d.y-c.y,this._quadrant=hr.quadrant(this._dx,this._dy),It.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var c=arguments[0];this._edge=c}else if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2];I.constructor_.call(this,d,p,b,null)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],$=arguments[3];I.constructor_.call(this,L),this.init(O,V),this._label=$}}}]),I}(),_a=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(p){return this._depth[p]}},{key:"setVisited",value:function(p){this._isVisited=p}},{key:"computeDirectedLabel",value:function(){this._label=new bi(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(p,b){if(this._depth[p]!==-999&&this._depth[p]!==b)throw new Mt("assigned depths do not match",this.getCoordinate());this._depth[p]=b}},{key:"isInteriorAreaEdge",value:function(){for(var p=!0,b=0;b<2;b++)this._label.isArea(b)&&this._label.getLocation(b,Ee.LEFT)===Se.INTERIOR&&this._label.getLocation(b,Ee.RIGHT)===Se.INTERIOR||(p=!1);return p}},{key:"setNextMin",value:function(p){this._nextMin=p}},{key:"print",value:function(p){U(m(d.prototype),"print",this).call(this,p),p.print(" "+this._depth[Ee.LEFT]+"/"+this._depth[Ee.RIGHT]),p.print(" ("+this.getDepthDelta()+")"),this._isInResult&&p.print(" inResult")}},{key:"setMinEdgeRing",value:function(p){this._minEdgeRing=p}},{key:"isLineEdge",value:function(){var p=this._label.isLine(0)||this._label.isLine(1),b=!this._label.isArea(0)||this._label.allPositionsEqual(0,Se.EXTERIOR),L=!this._label.isArea(1)||this._label.allPositionsEqual(1,Se.EXTERIOR);return p&&b&&L}},{key:"setEdgeRing",value:function(p){this._edgeRing=p}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var p=this._edge.getDepthDelta();return this._isForward||(p=-p),p}},{key:"setInResult",value:function(p){this._isInResult=p}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(p){this.print(p),p.print(" "),this._isForward?this._edge.print(p):this._edge.printReverse(p)}},{key:"setSym",value:function(p){this._sym=p}},{key:"setVisitedEdge",value:function(p){this.setVisited(p),this._sym.setVisited(p)}},{key:"setEdgeDepths",value:function(p,b){var L=this.getEdge().getDepthDelta();this._isForward||(L=-L);var O=1;p===Ee.LEFT&&(O=-1);var V=Ee.opposite(p),$=b+L*O;this.setDepth(p,b),this.setDepth(V,$)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(p){this._next=p}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var p=arguments[0],b=arguments[1];if(ga.constructor_.call(this,p),this._isForward=b,b)this.init(p.getCoordinate(0),p.getCoordinate(1));else{var L=p.getNumPoints()-1;this.init(p.getCoordinate(L),p.getCoordinate(L-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(p,b){return p===Se.EXTERIOR&&b===Se.INTERIOR?1:p===Se.INTERIOR&&b===Se.EXTERIOR?-1:0}}]),d}(ga),Ba=function(){function I(){n(this,I)}return a(I,[{key:"createNode",value:function(c){return new ma(c,null)}}]),I}(),ys=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"printEdges",value:function(c){c.println("Edges:");for(var d=0;d<this._edges.size();d++){c.println("edge "+d+":");var p=this._edges.get(d);p.print(c),p.eiList.print(c)}}},{key:"find",value:function(c){return this._nodes.find(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof ma){var c=arguments[0];return this._nodes.addNode(c)}if(arguments[0]instanceof We){var d=arguments[0];return this._nodes.addNode(d)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(c){Li.out.println(c)}},{key:"isBoundaryNode",value:function(c,d){var p=this._nodes.find(d);if(p===null)return!1;var b=p.getLabel();return b!==null&&b.getLocation(c)===Se.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(c,d,p,b){return!!c.equals(p)&&mn.index(c,d,b)===mn.COLLINEAR&&hr.quadrant(c,d)===hr.quadrant(p,b)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(c){Li.out.print(c)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),L=b.getCoordinates();if(this.matchInSameDirection(c,d,L[0],L[1])||this.matchInSameDirection(c,d,L[L.length-1],L[L.length-2]))return b}return null}},{key:"insertEdge",value:function(c){this._edges.add(c)}},{key:"findEdgeEnd",value:function(c){for(var d=this.getEdgeEnds().iterator();d.hasNext();){var p=d.next();if(p.getEdge()===c)return p}return null}},{key:"addEdges",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();this._edges.add(p);var b=new _a(p,!0),L=new _a(p,!1);b.setSym(L),L.setSym(b),this.add(b),this.add(L)}}},{key:"add",value:function(c){this._nodes.add(c),this._edgeEndList.add(c)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),L=b.getCoordinates();if(c.equals(L[0])&&d.equals(L[1]))return b}return null}}],[{key:"constructor_",value:function(){if(this._edges=new At,this._nodes=null,this._edgeEndList=new At,arguments.length===0)this._nodes=new Bo(new Ba);else if(arguments.length===1){var c=arguments[0];this._nodes=new Bo(c)}}},{key:"linkResultDirectedEdges",value:function(c){for(var d=c.iterator();d.hasNext();)d.next().getEdges().linkResultDirectedEdges()}}]),I}(),bc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"sortShellsAndHoles",value:function(c,d,p){for(var b=c.iterator();b.hasNext();){var L=b.next();L.isHole()?p.add(L):d.add(L)}}},{key:"computePolygons",value:function(c){for(var d=new At,p=c.iterator();p.hasNext();){var b=p.next().toPolygon(this._geometryFactory);d.add(b)}return d}},{key:"placeFreeHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();if(b.getShell()===null){var L=I.findEdgeRingContaining(b,c);if(L===null)throw new Mt("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(L)}}}},{key:"buildMinimalEdgeRings",value:function(c,d,p){for(var b=new At,L=c.iterator();L.hasNext();){var O=L.next();if(O.getMaxNodeDegree()>2){O.linkDirectedEdgesForMinimalEdgeRings();var V=O.buildMinimalRings(),$=this.findShell(V);$!==null?(this.placePolygonHoles($,V),d.add($)):p.addAll(V)}else b.add(O)}return b}},{key:"buildMaximalEdgeRings",value:function(c){for(var d=new At,p=c.iterator();p.hasNext();){var b=p.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var L=new Oa(b,this._geometryFactory);d.add(L),L.setInResult()}}return d}},{key:"placePolygonHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();b.isHole()&&b.setShell(c)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(c){for(var d=0,p=null,b=c.iterator();b.hasNext();){var L=b.next();L.isHole()||(p=L,d++)}return It.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),p}},{key:"add",value:function(){if(arguments.length===1){var c=arguments[0];this.add(c.getEdgeEnds(),c.getNodes())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];ys.linkResultDirectedEdges(p);var b=this.buildMaximalEdgeRings(d),L=new At,O=this.buildMinimalEdgeRings(b,this._shellList,L);this.sortShellsAndHoles(O,this._shellList,L),this.placeFreeHoles(this._shellList,L)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new At;var c=arguments[0];this._geometryFactory=c}},{key:"findEdgeRingContaining",value:function(c,d){for(var p=c.getLinearRing(),b=p.getEnvelopeInternal(),L=p.getCoordinateN(0),O=null,V=null,$=d.iterator();$.hasNext();){var me=$.next(),Be=me.getLinearRing(),Ke=Be.getEnvelopeInternal();if(!Ke.equals(b)&&Ke.contains(b)){L=Wn.ptNotInList(p.getCoordinates(),Be.getCoordinates());var mt=!1;qs.isInRing(L,Be.getCoordinates())&&(mt=!0),mt&&(O===null||V.contains(Ke))&&(V=(O=me).getLinearRing().getEnvelopeInternal())}}return O}}]),I}(),Ua=function(){function I(){n(this,I)}return a(I,[{key:"getBounds",value:function(){}}]),I}(),Lr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var c=arguments[0],d=arguments[1];this._bounds=c,this._item=d}}]),I}(),vs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"poll",value:function(){if(this.isEmpty())return null;var c=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),c}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(c){for(var d=null,p=this._items.get(c);2*c<=this._size&&((d=2*c)!==this._size&&this._items.get(d+1).compareTo(this._items.get(d))<0&&d++,this._items.get(d).compareTo(p)<0);c=d)this._items.set(c,this._items.get(d));this._items.set(c,p)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(c){this._items.add(null),this._size+=1;var d=this._size;for(this._items.set(0,c);c.compareTo(this._items.get(Math.trunc(d/2)))<0;d/=2)this._items.set(d,this._items.get(Math.trunc(d/2)));this._items.set(d,c)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new At,this._items.add(null)}}]),I}(),si=function(){function I(){n(this,I)}return a(I,[{key:"insert",value:function(c,d){}},{key:"remove",value:function(c,d){}},{key:"query",value:function(){}}]),I}(),Mr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(c){It.isTrue(this._bounds===null),this._childBoundables.add(c)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new At,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._level=c}}}]),I}(),Uo={reverseOrder:function(){return{compare:function(I,c){return c.compareTo(I)}}},min:function(I){return Uo.sort(I),I.get(0)},sort:function(I,c){var d=I.toArray();c?at.sort(d,c):at.sort(d);for(var p=I.iterator(),b=0,L=d.length;b<L;b++)p.next(),p.set(d[b])},singletonList:function(I){var c=new At;return c.add(I),c}},jo=function(){function I(){n(this,I)}return a(I,null,[{key:"maxDistance",value:function(c,d,p,b,L,O,V,$){var me=I.distance(c,d,L,O);return me=Math.max(me,I.distance(c,d,V,$)),me=Math.max(me,I.distance(p,b,L,O)),me=Math.max(me,I.distance(p,b,V,$))}},{key:"distance",value:function(c,d,p,b){var L=p-c,O=b-d;return Math.sqrt(L*L+O*O)}},{key:"maximumDistance",value:function(c,d){var p=Math.min(c.getMinX(),d.getMinX()),b=Math.min(c.getMinY(),d.getMinY()),L=Math.max(c.getMaxX(),d.getMaxX()),O=Math.max(c.getMaxY(),d.getMaxY());return I.distance(p,b,L,O)}},{key:"minMaxDistance",value:function(c,d){var p=c.getMinX(),b=c.getMinY(),L=c.getMaxX(),O=c.getMaxY(),V=d.getMinX(),$=d.getMinY(),me=d.getMaxX(),Be=d.getMaxY(),Ke=I.maxDistance(p,b,p,O,V,$,V,Be);return Ke=Math.min(Ke,I.maxDistance(p,b,p,O,V,$,me,$)),Ke=Math.min(Ke,I.maxDistance(p,b,p,O,me,Be,V,Be)),Ke=Math.min(Ke,I.maxDistance(p,b,p,O,me,Be,me,$)),Ke=Math.min(Ke,I.maxDistance(p,b,L,b,V,$,V,Be)),Ke=Math.min(Ke,I.maxDistance(p,b,L,b,V,$,me,$)),Ke=Math.min(Ke,I.maxDistance(p,b,L,b,me,Be,V,Be)),Ke=Math.min(Ke,I.maxDistance(p,b,L,b,me,Be,me,$)),Ke=Math.min(Ke,I.maxDistance(L,O,p,O,V,$,V,Be)),Ke=Math.min(Ke,I.maxDistance(L,O,p,O,V,$,me,$)),Ke=Math.min(Ke,I.maxDistance(L,O,p,O,me,Be,V,Be)),Ke=Math.min(Ke,I.maxDistance(L,O,p,O,me,Be,me,$)),Ke=Math.min(Ke,I.maxDistance(L,O,L,b,V,$,V,Be)),Ke=Math.min(Ke,I.maxDistance(L,O,L,b,V,$,me,$)),Ke=Math.min(Ke,I.maxDistance(L,O,L,b,me,Be,V,Be)),Ke=Math.min(Ke,I.maxDistance(L,O,L,b,me,Be,me,$))}}]),I}(),qo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"maximumDistance",value:function(){return jo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(c,d){var p=I.isComposite(this._boundable1),b=I.isComposite(this._boundable2);if(p&&b)return I.area(this._boundable1)>I.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,c,d),null):(this.expand(this._boundable2,this._boundable1,!0,c,d),null);if(p)return this.expand(this._boundable1,this._boundable2,!1,c,d),null;if(b)return this.expand(this._boundable2,this._boundable1,!0,c,d),null;throw new ve("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(I.isComposite(this._boundable1)||I.isComposite(this._boundable2))}},{key:"compareTo",value:function(c){var d=c;return this._distance<d._distance?-1:this._distance>d._distance?1:0}},{key:"expand",value:function(c,d,p,b,L){for(var O=c.getChildBoundables().iterator();O.hasNext();){var V=O.next(),$=null;($=p?new I(d,V,this._itemDistance):new I(V,d,this._itemDistance)).getDistance()<L&&b.add($)}}},{key:"getBoundable",value:function(c){return c===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var c=arguments[0],d=arguments[1],p=arguments[2];this._boundable1=c,this._boundable2=d,this._itemDistance=p,this._distance=this.distance()}},{key:"area",value:function(c){return c.getBounds().getArea()}},{key:"isComposite",value:function(c){return c instanceof Mr}}]),I}(),Al=function(){function I(){n(this,I)}return a(I,[{key:"visitItem",value:function(c){}}]),I}(),Vo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"queryInternal",value:function(){if(xn(arguments[2],Al)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var c=arguments[0],d=arguments[1],p=arguments[2],b=d.getChildBoundables(),L=0;L<b.size();L++){var O=b.get(L);this.getIntersectsOp().intersects(O.getBounds(),c)&&(O instanceof Mr?this.queryInternal(c,O,p):O instanceof Lr?p.visitItem(O.getItem()):It.shouldNeverReachHere())}else if(xn(arguments[2],Jn)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var V=arguments[0],$=arguments[1],me=arguments[2],Be=$.getChildBoundables(),Ke=0;Ke<Be.size();Ke++){var mt=Be.get(Ke);this.getIntersectsOp().intersects(mt.getBounds(),V)&&(mt instanceof Mr?this.queryInternal(V,mt,me):mt instanceof Lr?me.add(mt.getItem()):It.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(c){return c.get(c.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();b instanceof Mr?d+=this.size(b):b instanceof Lr&&(d+=1)}return d}}},{key:"removeItem",value:function(c,d){for(var p=null,b=c.getChildBoundables().iterator();b.hasNext();){var L=b.next();L instanceof Lr&&L.getItem()===d&&(p=L)}return p!==null&&(c.getChildBoundables().remove(p),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var c=this.itemsTree(this._root);return c===null?new At:c}if(arguments.length===1){for(var d=arguments[0],p=new At,b=d.getChildBoundables().iterator();b.hasNext();){var L=b.next();if(L instanceof Mr){var O=this.itemsTree(L);O!==null&&p.add(O)}else L instanceof Lr?p.add(L.getItem()):It.shouldNeverReachHere()}return p.size()<=0?null:p}}},{key:"insert",value:function(c,d){It.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Lr(c,d))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var c=arguments[0],d=new At;return this.boundablesAtLevel(c,this._root,d),d}if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];if(It.isTrue(p>-2),b.getLevel()===p)return L.add(b),null;for(var O=b.getChildBoundables().iterator();O.hasNext();){var V=O.next();V instanceof Mr?this.boundablesAtLevel(p,V,L):(It.isTrue(V instanceof Lr),p===-1&&L.add(V))}return null}}},{key:"query",value:function(){if(arguments.length===1){var c=arguments[0];this.build();var d=new At;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,d),d}if(arguments.length===2){var p=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.queryInternal(p,this._root,b)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.remove(c,this._root,d)}if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2],O=this.removeItem(b,L);if(O)return!0;for(var V=null,$=b.getChildBoundables().iterator();$.hasNext();){var me=$.next();if(this.getIntersectsOp().intersects(me.getBounds(),p)&&me instanceof Mr&&(O=this.remove(p,me,L))){V=me;break}}return V!==null&&V.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(V),O}}},{key:"createHigherLevels",value:function(c,d){It.isTrue(!c.isEmpty());var p=this.createParentBoundables(c,d+1);return p.size()===1?p.get(0):this.createHigherLevels(p,d+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();if(b instanceof Mr){var L=this.depth(b);L>d&&(d=L)}}return d+1}}},{key:"createParentBoundables",value:function(c,d){It.isTrue(!c.isEmpty());var p=new At;p.add(this.createNode(d));var b=new At(c);Uo.sort(b,this.getComparator());for(var L=b.iterator();L.hasNext();){var O=L.next();this.lastNode(p).getChildBoundables().size()===this.getNodeCapacity()&&p.add(this.createNode(d)),this.lastNode(p).addChildBoundable(O)}return p}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new At,this._nodeCapacity=null,arguments.length===0)I.constructor_.call(this,I.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var c=arguments[0];It.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}}},{key:"compareDoubles",value:function(c,d){return c>d?1:c<d?-1:0}}]),I}();Vo.IntersectsOp=function(){},Vo.DEFAULT_NODE_CAPACITY=10;var uu=function(){function I(){n(this,I)}return a(I,[{key:"distance",value:function(c,d){}}]),I}(),ns=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"createParentBoundablesFromVerticalSlices",value:function(p,b){It.isTrue(p.length>0);for(var L=new At,O=0;O<p.length;O++)L.addAll(this.createParentBoundablesFromVerticalSlice(p[O],b));return L}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.nearestNeighbourK(p,vt.POSITIVE_INFINITY,b)}if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2],$=O,me=new vs;me.add(L);for(var Be=new vs;!me.isEmpty()&&$>=0;){var Ke=me.poll(),mt=Ke.getDistance();if(mt>=$)break;if(Ke.isLeaves())if(Be.size()<V)Be.add(Ke);else{var zt=Be.peek();zt.getDistance()>mt&&(Be.poll(),Be.add(Ke));var Nt=Be.peek();$=Nt.getDistance()}else Ke.expandToQueue(me,$)}return d.getItems(Be)}}},{key:"createNode",value:function(p){return new Tl(p)}},{key:"size",value:function(){return arguments.length===0?U(m(d.prototype),"size",this).call(this):U(m(d.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn))return U(m(d.prototype),"insert",this).apply(this,arguments);var p=arguments[0],b=arguments[1];if(p.isNull())return null;U(m(d.prototype),"insert",this).call(this,p,b)}},{key:"getIntersectsOp",value:function(){return d.intersectsOp}},{key:"verticalSlices",value:function(p,b){for(var L=Math.trunc(Math.ceil(p.size()/b)),O=new Array(b).fill(null),V=p.iterator(),$=0;$<b;$++){O[$]=new At;for(var me=0;V.hasNext()&&me<L;){var Be=V.next();O[$].add(Be),me++}}return O}},{key:"query",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"query",this).call(this,p)}if(arguments.length===2){var b=arguments[0],L=arguments[1];U(m(d.prototype),"query",this).call(this,b,L)}}},{key:"getComparator",value:function(){return d.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(p,b){return U(m(d.prototype),"createParentBoundables",this).call(this,p,b)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn){var p=arguments[0],b=arguments[1];return U(m(d.prototype),"remove",this).call(this,p,b)}return U(m(d.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?U(m(d.prototype),"depth",this).call(this):U(m(d.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(p,b){It.isTrue(!p.isEmpty());var L=Math.trunc(Math.ceil(p.size()/this.getNodeCapacity())),O=new At(p);Uo.sort(O,d.xComparator);var V=this.verticalSlices(O,Math.trunc(Math.ceil(Math.sqrt(L))));return this.createParentBoundablesFromVerticalSlices(V,b)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(xn(arguments[0],uu)){var p=arguments[0];if(this.isEmpty())return null;var b=new qo(this.getRoot(),this.getRoot(),p);return this.nearestNeighbour(b)}if(arguments[0]instanceof qo){var L=arguments[0],O=vt.POSITIVE_INFINITY,V=null,$=new vs;for($.add(L);!$.isEmpty()&&O>0;){var me=$.poll(),Be=me.getDistance();if(Be>=O)break;me.isLeaves()?(O=Be,V=me):me.expandToQueue($,O)}return V===null?null:[V.getBoundable(0).getItem(),V.getBoundable(1).getItem()]}}else{if(arguments.length===2){var Ke=arguments[0],mt=arguments[1];if(this.isEmpty()||Ke.isEmpty())return null;var zt=new qo(this.getRoot(),Ke.getRoot(),mt);return this.nearestNeighbour(zt)}if(arguments.length===3){var Nt=arguments[0],gn=arguments[1],bn=arguments[2],Rn=new Lr(Nt,gn),ti=new qo(this.getRoot(),Rn,bn);return this.nearestNeighbour(ti)[0]}if(arguments.length===4){var mi=arguments[0],li=arguments[1],er=arguments[2],ss=arguments[3],Ms=new Lr(mi,li),fi=new qo(this.getRoot(),Ms,er);return this.nearestNeighbourK(fi,ss)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1],L=vt.POSITIVE_INFINITY,O=new vs;for(O.add(p);!O.isEmpty();){var V=O.poll(),$=V.getDistance();if($>b)return!1;if(V.maximumDistance()<=b)return!0;if(V.isLeaves()){if((L=$)<=b)return!0}else V.expandToQueue(O,L)}return!1}if(arguments.length===3){var me=arguments[0],Be=arguments[1],Ke=arguments[2],mt=new qo(this.getRoot(),me.getRoot(),Be);return this.isWithinDistance(mt,Ke)}}},{key:"interfaces_",get:function(){return[si,be]}}],[{key:"constructor_",value:function(){if(arguments.length===0)d.constructor_.call(this,d.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var p=arguments[0];Vo.constructor_.call(this,p)}}},{key:"centreX",value:function(p){return d.avg(p.getMinX(),p.getMaxX())}},{key:"avg",value:function(p,b){return(p+b)/2}},{key:"getItems",value:function(p){for(var b=new Array(p.size()).fill(null),L=0;!p.isEmpty();){var O=p.poll();b[L]=O.getBoundable(0).getItem(),L++}return b}},{key:"centreY",value:function(p){return d.avg(p.getMinY(),p.getMaxY())}}]),d}(Vo),Tl=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeBounds",value:function(){for(var p=null,b=this.getChildBoundables().iterator();b.hasNext();){var L=b.next();p===null?p=new dn(L.getBounds()):p.expandToInclude(L.getBounds())}return p}}],[{key:"constructor_",value:function(){var p=arguments[0];Mr.constructor_.call(this,p)}}]),d}(Mr);ns.STRtreeNode=Tl,ns.xComparator=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[wt]}},{key:"compare",value:function(c,d){return Vo.compareDoubles(ns.centreX(c.getBounds()),ns.centreX(d.getBounds()))}}]),I}()),ns.yComparator=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[wt]}},{key:"compare",value:function(c,d){return Vo.compareDoubles(ns.centreY(c.getBounds()),ns.centreY(d.getBounds()))}}]),I}()),ns.intersectsOp=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(c,d){return c.intersects(d)}}]),I}()),ns.DEFAULT_NODE_CAPACITY=10;var cu=function(){function I(){n(this,I)}return a(I,null,[{key:"relativeSign",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"compare",value:function(c,d,p){if(d.equals2D(p))return 0;var b=I.relativeSign(d.x,p.x),L=I.relativeSign(d.y,p.y);switch(c){case 0:return I.compareValue(b,L);case 1:return I.compareValue(L,b);case 2:return I.compareValue(L,-b);case 3:return I.compareValue(-b,L);case 4:return I.compareValue(-b,-L);case 5:return I.compareValue(-L,-b);case 6:return I.compareValue(-L,b);case 7:return I.compareValue(b,-L)}return It.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(c,d){return c<0?-1:c>0?1:d<0?-1:d>0?1:0}}]),I}(),hu=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(c){var d=c;return this.segmentIndex<d.segmentIndex?-1:this.segmentIndex>d.segmentIndex?1:this.coord.equals2D(d.coord)?0:this._isInterior?d._isInterior?cu.compare(this._segmentOctant,this.coord,d.coord):1:-1}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===c}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._segString=c,this.coord=new We(d),this.segmentIndex=p,this._segmentOctant=b,this._isInterior=!d.equals2D(c.getCoordinate(p))}}]),I}(),fu=function(){function I(){n(this,I)}return a(I,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),I}(),ko=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSplitCoordinates",value:function(){var c=new Mi;this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next();this.addEdgeCoordinates(p,b,c),p=b}return c.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var c=new At;this.findCollapsesFromInsertedNodes(c),this.findCollapsesFromExistingVertices(c);for(var d=c.iterator();d.hasNext();){var p=d.next().intValue();this.add(this._edge.getCoordinate(p),p)}}},{key:"createSplitEdgePts",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2;if(p===2)return[new We(c.coord),new We(d.coord)];var b=this._edge.getCoordinate(d.segmentIndex),L=d.isInterior()||!d.coord.equals2D(b);L||p--;var O=new Array(p).fill(null),V=0;O[V++]=new We(c.coord);for(var $=c.segmentIndex+1;$<=d.segmentIndex;$++)O[V++]=this._edge.getCoordinate($);return L&&(O[V]=new We(d.coord)),O}},{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"findCollapsesFromExistingVertices",value:function(c){for(var d=0;d<this._edge.size()-2;d++){var p=this._edge.getCoordinate(d);this._edge.getCoordinate(d+1);var b=this._edge.getCoordinate(d+2);p.equals2D(b)&&c.add(Yi.valueOf(d+1))}}},{key:"addEdgeCoordinates",value:function(c,d,p){var b=this.createSplitEdgePts(c,d);p.add(b,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints(),this.addCollapsedNodes();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),L=this.createSplitEdge(p,b);c.add(L),p=b}}},{key:"findCollapseIndex",value:function(c,d,p){if(!c.coord.equals2D(d.coord))return!1;var b=d.segmentIndex-c.segmentIndex;return d.isInterior()||b--,b===1&&(p[0]=c.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(c){for(var d=new Array(1).fill(null),p=this.iterator(),b=p.next();p.hasNext();){var L=p.next();this.findCollapseIndex(b,L,d)&&c.add(Yi.valueOf(d[0])),b=L}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var c=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(c),c)}},{key:"createSplitEdge",value:function(c,d){var p=this.createSplitEdgePts(c,d);return new bs(p,this._edge.getData())}},{key:"add",value:function(c,d){var p=new hu(this._edge,c,d,this._edge.getSegmentOctant(d)),b=this._nodeMap.get(p);return b!==null?(It.isTrue(b.coord.equals2D(c),"Found equal nodes with different coordinates"),b):(this._nodeMap.put(p,p),p)}},{key:"checkSplitEdgesCorrectness",value:function(c){var d=this._edge.getCoordinates(),p=c.get(0).getCoordinate(0);if(!p.equals2D(d[0]))throw new ft("bad split edge start point at "+p);var b=c.get(c.size()-1).getCoordinates(),L=b[b.length-1];if(!L.equals2D(d[d.length-1]))throw new ft("bad split edge end point at "+L)}}],[{key:"constructor_",value:function(){this._nodeMap=new Oo,this._edge=null;var c=arguments[0];this._edge=c}}]),I}(),du=function(){function I(){n(this,I)}return a(I,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the octant for point ( "+c+", "+d+" )");var p=Math.abs(c),b=Math.abs(d);return c>=0?d>=0?p>=b?0:1:p>=b?7:6:d>=0?p>=b?3:2:p>=b?4:5}if(arguments[0]instanceof We&&arguments[1]instanceof We){var L=arguments[0],O=arguments[1],V=O.x-L.x,$=O.y-L.y;if(V===0&&$===0)throw new ve("Cannot compute the octant for two identical points "+L);return I.octant(V,$)}}}]),I}(),xc=function(){function I(){n(this,I)}return a(I,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(c){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(c){}},{key:"getData",value:function(){}}]),I}(),pu=function(){function I(){n(this,I)}return a(I,[{key:"addIntersection",value:function(c,d){}},{key:"interfaces_",get:function(){return[xc]}}]),I}(),bs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(c){return this._pts[c]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(c){return c===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(c),this.getCoordinate(c+1))}},{key:"setData",value:function(c){this._data=c}},{key:"safeOctant",value:function(c,d){return c.equals2D(d)?0:du.octant(c,d)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.addIntersectionNode(c,d)}else if(arguments.length===4){var p=arguments[0],b=arguments[1],L=arguments[3],O=new We(p.getIntersection(L));this.addIntersection(O,b)}}},{key:"toString",value:function(){return za.toLineString(new bo(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(c,d){var p=d,b=p+1;if(b<this._pts.length){var L=this._pts[b];c.equals2D(L)&&(p=b)}return this._nodeList.add(c,p)}},{key:"addIntersections",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++)this.addIntersection(c,d,p,b)}},{key:"interfaces_",get:function(){return[pu]}}],[{key:"constructor_",value:function(){this._nodeList=new ko(this),this._pts=null,this._data=null;var c=arguments[0],d=arguments[1];this._pts=c,this._data=d}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var c=arguments[0],d=new At;return I.getNodedSubstrings(c,d),d}if(arguments.length===2)for(var p=arguments[0],b=arguments[1],L=p.iterator();L.hasNext();){var O=L.next();O.getNodeList().addSplitEdges(b)}}}]),I}(),Hr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=mn.index(this.p0,this.p1,c.p0),p=mn.index(this.p0,this.p1,c.p1);return d>=0&&p>=0||d<=0&&p<=0?Math.max(d,p):0}if(arguments[0]instanceof We){var b=arguments[0];return mn.index(this.p0,this.p1,b)}}},{key:"toGeometry",value:function(c){return c.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)}},{key:"intersection",value:function(c){var d=new so;return d.computeIntersection(this.p0,this.p1,c.p0,c.p1),d.hasIntersection()?d.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof We){var c=arguments[0];if(c.equals(this.p0)||c.equals(this.p1))return new We(c);var d=this.projectionFactor(c),p=new We;return p.x=this.p0.x+d*(this.p1.x-this.p0.x),p.y=this.p0.y+d*(this.p1.y-this.p0.y),p}if(arguments[0]instanceof I){var b=arguments[0],L=this.projectionFactor(b.p0),O=this.projectionFactor(b.p1);if(L>=1&&O>=1||L<=0&&O<=0)return null;var V=this.project(b.p0);L<0&&(V=this.p0),L>1&&(V=this.p1);var $=this.project(b.p1);return O<0&&($=this.p0),O>1&&($=this.p1),new I(V,$)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(c){return c===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(c){return Ji.pointToLinePerpendicular(c,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return I.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(c){if(c.equals(this.p0))return 0;if(c.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,b=d*d+p*p;return b<=0?vt.NaN:((c.x-this.p0.x)*d+(c.y-this.p0.y)*p)/b}},{key:"closestPoints",value:function(c){var d=this.intersection(c);if(d!==null)return[d,d];var p=new Array(2).fill(null),b=vt.MAX_VALUE,L=null,O=this.closestPoint(c.p0);b=O.distance(c.p0),p[0]=O,p[1]=c.p0;var V=this.closestPoint(c.p1);(L=V.distance(c.p1))<b&&(b=L,p[0]=V,p[1]=c.p1);var $=c.closestPoint(this.p0);(L=$.distance(this.p0))<b&&(b=L,p[0]=this.p0,p[1]=$);var me=c.closestPoint(this.p1);return(L=me.distance(this.p1))<b&&(b=L,p[0]=this.p1,p[1]=me),p}},{key:"closestPoint",value:function(c){var d=this.projectionFactor(c);return d>0&&d<1?this.project(c):this.p0.distance(c)<this.p1.distance(c)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(c){var d=c,p=this.p0.compareTo(d.p0);return p!==0?p:this.p1.compareTo(d.p1)}},{key:"reverse",value:function(){var c=this.p0;this.p0=this.p1,this.p1=c}},{key:"equalsTopo",value:function(c){return this.p0.equals(c.p0)&&this.p1.equals(c.p1)||this.p0.equals(c.p1)&&this.p1.equals(c.p0)}},{key:"lineIntersection",value:function(c){return wn.intersection(this.p0,this.p1,c.p0,c.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(c,d){var p=this.p0.x+c*(this.p1.x-this.p0.x),b=this.p0.y+c*(this.p1.y-this.p0.y),L=this.p1.x-this.p0.x,O=this.p1.y-this.p0.y,V=Math.sqrt(L*L+O*O),$=0,me=0;if(d!==0){if(V<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");$=d*L/V,me=d*O/V}return new We(p-me,b+$)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var c=arguments[0];this.setCoordinates(c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=p.x,this.p1.y=p.y}}},{key:"segmentFraction",value:function(c){var d=this.projectionFactor(c);return d<0?d=0:(d>1||vt.isNaN(d))&&(d=1),d}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(c){var d=this.p1.getY()-this.p0.getY(),p=this.p0.getX()-this.p1.getX(),b=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),L=d*d+p*p,O=d*d-p*p,V=c.getX(),$=c.getY();return new We((-O*V-2*d*p*$-2*d*b)/L,(O*$-2*d*p*V-2*p*b)/L)}},{key:"distance",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return Ji.segmentToSegment(this.p0,this.p1,c.p0,c.p1)}if(arguments[0]instanceof We){var d=arguments[0];return Ji.pointToSegment(d,this.p0,this.p1)}}},{key:"pointAlong",value:function(c){var d=new We;return d.x=this.p0.x+c*(this.p1.x-this.p0.x),d.y=this.p0.y+c*(this.p1.y-this.p0.y),d}},{key:"hashCode",value:function(){var c=vt.doubleToLongBits(this.p0.x);c^=31*vt.doubleToLongBits(this.p0.y);var d=Math.trunc(c)^Math.trunc(c>>32),p=vt.doubleToLongBits(this.p1.x);return p^=31*vt.doubleToLongBits(this.p1.y),d^(Math.trunc(p)^Math.trunc(p>>32))}},{key:"interfaces_",get:function(){return[he,be]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)I.constructor_.call(this,new We,new We);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0=d,this.p1=p}else if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3];I.constructor_.call(this,new We(b,L),new We(O,V))}}},{key:"midPoint",value:function(c,d){return new We((c.x+d.x)/2,(c.y+d.y)/2)}}]),I}(),ja=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"overlap",value:function(){if(arguments.length!==2&&arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];c.getLineSegment(d,this._overlapSeg1),p.getLineSegment(b,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Hr,this._overlapSeg2=new Hr}}]),I}(),mu=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLineSegment",value:function(c,d){d.p0=this._pts[c],d.p1=this._pts[c+1]}},{key:"computeSelect",value:function(c,d,p,b){var L=this._pts[d],O=this._pts[p];if(p-d==1)return b.select(this,d),null;if(!c.intersects(L,O))return null;var V=Math.trunc((d+p)/2);d<V&&this.computeSelect(c,d,V,b),V<p&&this.computeSelect(c,V,p,b)}},{key:"getCoordinates",value:function(){for(var c=new Array(this._end-this._start+1).fill(null),d=0,p=this._start;p<=this._end;p++)c[d++]=this._pts[p];return c}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.computeOverlaps(this._start,this._end,c,c._start,c._end,d)}else if(arguments.length===6){var p=arguments[0],b=arguments[1],L=arguments[2],O=arguments[3],V=arguments[4],$=arguments[5];if(b-p==1&&V-O==1)return $.overlap(this,p,L,O),null;if(!this.overlaps(p,b,L,O,V))return null;var me=Math.trunc((p+b)/2),Be=Math.trunc((O+V)/2);p<me&&(O<Be&&this.computeOverlaps(p,me,L,O,Be,$),Be<V&&this.computeOverlaps(p,me,L,Be,V,$)),me<b&&(O<Be&&this.computeOverlaps(me,b,L,O,Be,$),Be<V&&this.computeOverlaps(me,b,L,Be,V,$))}}},{key:"setId",value:function(c){this._id=c}},{key:"select",value:function(c,d){this.computeSelect(c,this._start,this._end,d)}},{key:"getEnvelope",value:function(){if(this._env===null){var c=this._pts[this._start],d=this._pts[this._end];this._env=new dn(c,d)}return this._env}},{key:"overlaps",value:function(c,d,p,b,L){return dn.intersects(this._pts[c],this._pts[d],p._pts[b],p._pts[L])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._pts=c,this._start=d,this._end=p,this._context=b}}]),I}(),wc=function(){function I(){n(this,I)}return a(I,null,[{key:"findChainEnd",value:function(c,d){for(var p=d;p<c.length-1&&c[p].equals2D(c[p+1]);)p++;if(p>=c.length-1)return c.length-1;for(var b=hr.quadrant(c[p],c[p+1]),L=d+1;L<c.length&&!(!c[L-1].equals2D(c[L])&&hr.quadrant(c[L-1],c[L])!==b);)L++;return L-1}},{key:"getChains",value:function(){if(arguments.length===1){var c=arguments[0];return I.getChains(c,null)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=new At,L=0;do{var O=I.findChainEnd(d,L),V=new mu(d,L,O,p);b.add(V),L=O}while(L<d.length-1);return b}}}]),I}(),qa=function(){function I(){n(this,I)}return a(I,[{key:"computeNodes",value:function(c){}},{key:"getNodedSubstrings",value:function(){}}]),I}(),Cl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setSegmentIntersector",value:function(c){this._segInt=c}},{key:"interfaces_",get:function(){return[qa]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this.setSegmentIntersector(c)}}}]),I}(),Va=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return bs.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(p){for(var b=wc.getChains(p.getCoordinates(),p).iterator();b.hasNext();){var L=b.next();L.setId(this._idCounter++),this._index.insert(L.getEnvelope(),L),this._monoChains.add(L)}}},{key:"computeNodes",value:function(p){this._nodedSegStrings=p;for(var b=p.iterator();b.hasNext();)this.add(b.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var p=new Ga(this._segInt),b=this._monoChains.iterator();b.hasNext();)for(var L=b.next(),O=this._index.query(L.getEnvelope()).iterator();O.hasNext();){var V=O.next();if(V.getId()>L.getId()&&(L.computeOverlaps(V,p),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new At,this._index=new ns,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0&&arguments.length===1){var p=arguments[0];Cl.constructor_.call(this,p)}}}]),d}(Cl),Ga=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"overlap",value:function(){if(arguments.length!==4)return U(m(d.prototype),"overlap",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=arguments[2],O=arguments[3],V=p.getContext(),$=L.getContext();this._si.processIntersections(V,b,$,O)}}],[{key:"constructor_",value:function(){this._si=null;var p=arguments[0];this._si=p}}]),d}(ja);Va.SegmentOverlapAction=Ga;var is=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isDeletable",value:function(c,d,p,b){var L=this._inputLine[c],O=this._inputLine[d],V=this._inputLine[p];return!!this.isConcave(L,O,V)&&!!this.isShallow(L,O,V,b)&&this.isShallowSampled(L,O,c,p,b)}},{key:"deleteShallowConcavities",value:function(){for(var c=1,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d),b=!1;p<this._inputLine.length;){var L=!1;this.isDeletable(c,d,p,this._distanceTol)&&(this._isDeleted[d]=I.DELETE,L=!0,b=!0),c=L?p:d,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d)}return b}},{key:"isShallowConcavity",value:function(c,d,p,b){return mn.index(c,d,p)===this._angleOrientation&&Ji.pointToSegment(d,c,p)<b}},{key:"isShallowSampled",value:function(c,d,p,b,L){var O=Math.trunc((b-p)/I.NUM_PTS_TO_CHECK);O<=0&&(O=1);for(var V=p;V<b;V+=O)if(!this.isShallow(c,d,this._inputLine[V],L))return!1;return!0}},{key:"isConcave",value:function(c,d,p){var b=mn.index(c,d,p)===this._angleOrientation;return b}},{key:"simplify",value:function(c){this._distanceTol=Math.abs(c),c<0&&(this._angleOrientation=mn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do d=this.deleteShallowConcavities();while(d);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(c){for(var d=c+1;d<this._inputLine.length&&this._isDeleted[d]===I.DELETE;)d++;return d}},{key:"isShallow",value:function(c,d,p,b){return Ji.pointToSegment(d,c,p)<b}},{key:"collapseLine",value:function(){for(var c=new Mi,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==I.DELETE&&c.add(this._inputLine[d]);return c.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=mn.COUNTERCLOCKWISE;var c=arguments[0];this._inputLine=c}},{key:"simplify",value:function(c,d){return new I(c).simplify(d)}}]),I}();is.INIT=0,is.DELETE=1,is.KEEP=1,is.NUM_PTS_TO_CHECK=10;var ya=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._ptList.toArray(I.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"addPt",value:function(c){var d=new We(c);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(c,d){if(d)for(var p=0;p<c.length;p++)this.addPt(c[p]);else for(var b=c.length-1;b>=0;b--)this.addPt(c[b])}},{key:"isRedundant",value:function(c){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return c.distance(d)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Qr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var c=new We(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(c.equals(d))return null;this._ptList.add(c)}},{key:"setMinimumVertexDistance",value:function(c){this._minimimVertexDistance=c}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new At}}]),I}();ya.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Oi=function(){function I(){n(this,I)}return a(I,null,[{key:"toDegrees",value:function(c){return 180*c/Math.PI}},{key:"normalize",value:function(c){for(;c>Math.PI;)c-=I.PI_TIMES_2;for(;c<=-Math.PI;)c+=I.PI_TIMES_2;return c}},{key:"angle",value:function(){if(arguments.length===1){var c=arguments[0];return Math.atan2(c.y,c.x)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=p.x-d.x,L=p.y-d.y;return Math.atan2(L,b)}}},{key:"isAcute",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y;return b*(p.x-d.x)+L*(p.y-d.y)>0}},{key:"isObtuse",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y;return b*(p.x-d.x)+L*(p.y-d.y)<0}},{key:"interiorAngle",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p);return Math.abs(L-b)}},{key:"normalizePositive",value:function(c){if(c<0){for(;c<0;)c+=I.PI_TIMES_2;c>=I.PI_TIMES_2&&(c=0)}else{for(;c>=I.PI_TIMES_2;)c-=I.PI_TIMES_2;c<0&&(c=0)}return c}},{key:"angleBetween",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p);return I.diff(b,L)}},{key:"diff",value:function(c,d){var p=null;return(p=c<d?d-c:c-d)>Math.PI&&(p=2*Math.PI-p),p}},{key:"toRadians",value:function(c){return c*Math.PI/180}},{key:"getTurn",value:function(c,d){var p=Math.sin(d-c);return p>0?I.COUNTERCLOCKWISE:p<0?I.CLOCKWISE:I.NONE}},{key:"angleBetweenOriented",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p)-b;return L<=-Math.PI?L+I.PI_TIMES_2:L>Math.PI?L-I.PI_TIMES_2:L}}]),I}();Oi.PI_TIMES_2=2*Math.PI,Oi.PI_OVER_2=Math.PI/2,Oi.PI_OVER_4=Math.PI/4,Oi.COUNTERCLOCKWISE=mn.COUNTERCLOCKWISE,Oi.CLOCKWISE=mn.CLOCKWISE,Oi.NONE=mn.COLLINEAR;var Io=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addNextSegment",value:function(c,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=c,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var p=mn.index(this._s0,this._s1,this._s2),b=p===mn.CLOCKWISE&&this._side===Ee.LEFT||p===mn.COUNTERCLOCKWISE&&this._side===Ee.RIGHT;p===0?this.addCollinear(d):b?this.addOutsideTurn(p,d):this.addInsideTurn(p,d)}},{key:"addLineEndCap",value:function(c,d){var p=new Hr(c,d),b=new Hr;this.computeOffsetSegment(p,Ee.LEFT,this._distance,b);var L=new Hr;this.computeOffsetSegment(p,Ee.RIGHT,this._distance,L);var O=d.x-c.x,V=d.y-c.y,$=Math.atan2(V,O);switch(this._bufParams.getEndCapStyle()){case K.CAP_ROUND:this._segList.addPt(b.p1),this.addDirectedFillet(d,$+Math.PI/2,$-Math.PI/2,mn.CLOCKWISE,this._distance),this._segList.addPt(L.p1);break;case K.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(L.p1);break;case K.CAP_SQUARE:var me=new We;me.x=Math.abs(this._distance)*Math.cos($),me.y=Math.abs(this._distance)*Math.sin($);var Be=new We(b.p1.x+me.x,b.p1.y+me.y),Ke=new We(L.p1.x+me.x,L.p1.y+me.y);this._segList.addPt(Be),this._segList.addPt(Ke)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(c,d,p,b){var L=wn.intersection(d.p0,d.p1,p.p0,p.p1);if(L!==null&&(b<=0?1:L.distance(c)/Math.abs(b))<=this._bufParams.getMitreLimit())return this._segList.addPt(L),null;this.addLimitedMitreJoin(d,p,b,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(c,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*I.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===K.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===K.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,c,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(c){this._segList.addPt(new We(c.x+this._distance,c.y+this._distance)),this._segList.addPt(new We(c.x+this._distance,c.y-this._distance)),this._segList.addPt(new We(c.x-this._distance,c.y-this._distance)),this._segList.addPt(new We(c.x-this._distance,c.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(c,d){this._segList.addPts(c,d)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(c,d,p,b,L){var O=d.x-c.x,V=d.y-c.y,$=Math.atan2(V,O),me=p.x-c.x,Be=p.y-c.y,Ke=Math.atan2(Be,me);b===mn.CLOCKWISE?$<=Ke&&($+=2*Math.PI):$>=Ke&&($-=2*Math.PI),this._segList.addPt(d),this.addDirectedFillet(c,$,Ke,b,L),this._segList.addPt(p)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(c,d,p){this._s1=c,this._s2=d,this._side=p,this._seg1.setCoordinates(c,d),this.computeOffsetSegment(this._seg1,p,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(c,d,p,b){var L=this._seg0.p1,O=Oi.angle(L,this._seg0.p0),V=Oi.angleBetweenOriented(this._seg0.p0,L,this._seg1.p1)/2,$=Oi.normalize(O+V),me=Oi.normalize($+Math.PI),Be=b*p,Ke=p-Be*Math.abs(Math.sin(V)),mt=L.x+Be*Math.cos(me),zt=L.y+Be*Math.sin(me),Nt=new We(mt,zt),gn=new Hr(L,Nt),bn=gn.pointAlongOffset(1,Ke),Rn=gn.pointAlongOffset(1,-Ke);this._side===Ee.LEFT?(this._segList.addPt(bn),this._segList.addPt(Rn)):(this._segList.addPt(Rn),this._segList.addPt(bn))}},{key:"addDirectedFillet",value:function(c,d,p,b,L){var O=b===mn.CLOCKWISE?-1:1,V=Math.abs(d-p),$=Math.trunc(V/this._filletAngleQuantum+.5);if($<1)return null;for(var me=V/$,Be=new We,Ke=0;Ke<$;Ke++){var mt=d+O*Ke*me;Be.x=c.x+L*Math.cos(mt),Be.y=c.y+L*Math.sin(mt),this._segList.addPt(Be)}}},{key:"computeOffsetSegment",value:function(c,d,p,b){var L=d===Ee.LEFT?1:-1,O=c.p1.x-c.p0.x,V=c.p1.y-c.p0.y,$=Math.sqrt(O*O+V*V),me=L*p*O/$,Be=L*p*V/$;b.p0.x=c.p0.x-Be,b.p0.y=c.p0.y+me,b.p1.x=c.p1.x-Be,b.p1.y=c.p1.y+me}},{key:"addInsideTurn",value:function(c,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*I.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var p=new We((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p);var b=new We((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(c){var d=new We(c.x+this._distance,c.y);this._segList.addPt(d),this.addDirectedFillet(c,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(c,d){this._segList.addPt(c.p1),this._segList.addPt(d.p0)}},{key:"init",value:function(c){this._distance=c,this._maxCurveSegmentError=c*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ya,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(c*I.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(c){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===K.JOIN_BEVEL||this._bufParams.getJoinStyle()===K.JOIN_MITRE?(c&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,mn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Hr,this._seg1=new Hr,this._offset0=new Hr,this._offset1=new Hr,this._side=0,this._hasNarrowConcaveAngle=!1;var c=arguments[0],d=arguments[1],p=arguments[2];this._precisionModel=c,this._bufParams=d,this._li=new so,this._filletAngleQuantum=Math.PI/2/d.getQuadrantSegments(),d.getQuadrantSegments()>=8&&d.getJoinStyle()===K.JOIN_ROUND&&(this._closingSegLengthFactor=I.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)}}]),I}();Io.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Io.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Io.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Io.MAX_CLOSING_SEG_LEN_FACTOR=80;var Ll=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getOffsetCurve",value:function(c,d){if(this._distance=d,d===0)return null;var p=d<0,b=Math.abs(d),L=this.getSegGen(b);c.length<=1?this.computePointCurve(c[0],L):this.computeOffsetCurve(c,p,L);var O=L.getCoordinates();return p&&Wn.reverse(O),O}},{key:"computeSingleSidedBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){p.addSegments(c,!0);var L=is.simplify(c,-b),O=L.length-1;p.initSideSegments(L[O],L[O-1],Ee.LEFT),p.addFirstSegment();for(var V=O-2;V>=0;V--)p.addNextSegment(L[V],!0)}else{p.addSegments(c,!1);var $=is.simplify(c,b),me=$.length-1;p.initSideSegments($[0],$[1],Ee.LEFT),p.addFirstSegment();for(var Be=2;Be<=me;Be++)p.addNextSegment($[Be],!0)}p.addLastSegment(),p.closeRing()}},{key:"computeRingBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);d===Ee.RIGHT&&(b=-b);var L=is.simplify(c,b),O=L.length-1;p.initSideSegments(L[O-1],L[0],d);for(var V=1;V<=O;V++){var $=V!==1;p.addNextSegment(L[V],$)}p.closeRing()}},{key:"computeLineBufferCurve",value:function(c,d){var p=this.simplifyTolerance(this._distance),b=is.simplify(c,p),L=b.length-1;d.initSideSegments(b[0],b[1],Ee.LEFT);for(var O=2;O<=L;O++)d.addNextSegment(b[O],!0);d.addLastSegment(),d.addLineEndCap(b[L-1],b[L]);var V=is.simplify(c,-p),$=V.length-1;d.initSideSegments(V[$],V[$-1],Ee.LEFT);for(var me=$-2;me>=0;me--)d.addNextSegment(V[me],!0);d.addLastSegment(),d.addLineEndCap(V[1],V[0]),d.closeRing()}},{key:"computePointCurve",value:function(c,d){switch(this._bufParams.getEndCapStyle()){case K.CAP_ROUND:d.createCircle(c);break;case K.CAP_SQUARE:d.createSquare(c)}}},{key:"getLineCurve",value:function(c,d){if(this._distance=d,this.isLineOffsetEmpty(d))return null;var p=Math.abs(d),b=this.getSegGen(p);if(c.length<=1)this.computePointCurve(c[0],b);else if(this._bufParams.isSingleSided()){var L=d<0;this.computeSingleSidedBufferCurve(c,L,b)}else this.computeLineBufferCurve(c,b);return b.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(c){return c*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(c,d,p){if(this._distance=p,c.length<=2)return this.getLineCurve(c,p);if(p===0)return I.copyCoordinates(c);var b=this.getSegGen(p);return this.computeRingBufferCurve(c,d,b),b.getCoordinates()}},{key:"computeOffsetCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){var L=is.simplify(c,-b),O=L.length-1;p.initSideSegments(L[O],L[O-1],Ee.LEFT),p.addFirstSegment();for(var V=O-2;V>=0;V--)p.addNextSegment(L[V],!0)}else{var $=is.simplify(c,b),me=$.length-1;p.initSideSegments($[0],$[1],Ee.LEFT),p.addFirstSegment();for(var Be=2;Be<=me;Be++)p.addNextSegment($[Be],!0)}p.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(c){return c===0||c<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(c){return new Io(this._precisionModel,this._bufParams,c)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var c=arguments[0],d=arguments[1];this._precisionModel=c,this._bufParams=d}},{key:"copyCoordinates",value:function(c){for(var d=new Array(c.length).fill(null),p=0;p<d.length;p++)d[p]=new We(c[p]);return d}}]),I}(),Za=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new At,p=this._subgraphs.iterator();p.hasNext();){var b=p.next(),L=b.getEnvelope();c.y<L.getMinY()||c.y>L.getMaxY()||this.findStabbedSegments(c,b.getDirectedEdges(),d)}return d}if(arguments.length===3){if(xn(arguments[2],Jn)&&arguments[0]instanceof We&&arguments[1]instanceof _a)for(var O=arguments[0],V=arguments[1],$=arguments[2],me=V.getEdge().getCoordinates(),Be=0;Be<me.length-1;Be++){this._seg.p0=me[Be],this._seg.p1=me[Be+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var Ke=Math.max(this._seg.p0.x,this._seg.p1.x);if(!(Ke<O.x)&&!(this._seg.isHorizontal()||O.y<this._seg.p0.y||O.y>this._seg.p1.y||mn.index(this._seg.p0,this._seg.p1,O)===mn.RIGHT)){var mt=V.getDepth(Ee.LEFT);this._seg.p0.equals(me[Be])||(mt=V.getDepth(Ee.RIGHT));var zt=new va(this._seg,mt);$.add(zt)}}else if(xn(arguments[2],Jn)&&arguments[0]instanceof We&&xn(arguments[1],Jn))for(var Nt=arguments[0],gn=arguments[1],bn=arguments[2],Rn=gn.iterator();Rn.hasNext();){var ti=Rn.next();ti.isForward()&&this.findStabbedSegments(Nt,ti,bn)}}}},{key:"getDepth",value:function(c){var d=this.findStabbedSegments(c);return d.size()===0?0:Uo.min(d)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Hr;var c=arguments[0];this._subgraphs=c}}]),I}(),va=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;if(this._upwardSeg.minX()>=d._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=d._upwardSeg.minX())return-1;var p=this._upwardSeg.orientationIndex(d._upwardSeg);return p!==0||(p=-1*d._upwardSeg.orientationIndex(this._upwardSeg))!==0?p:this._upwardSeg.compareTo(d._upwardSeg)}},{key:"compareX",value:function(c,d){var p=c.p0.compareTo(d.p0);return p!==0?p:c.p1.compareTo(d.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var c=arguments[0],d=arguments[1];this._upwardSeg=new Hr(c),this._leftDepth=d}}]),I}();Za.DepthSegment=va;var Ha=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){pe.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),d}(pe),Vs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getY",value:function(){var c=this.y/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getX",value:function(){var c=this.x/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getCoordinate",value:function(){var c=new We;return c.x=this.getX(),c.y=this.getY(),c}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var d=arguments[0],p=arguments[1];this.x=d,this.y=p,this.w=1}else if(arguments[0]instanceof I&&arguments[1]instanceof I){var b=arguments[0],L=arguments[1];this.x=b.y*L.w-L.y*b.w,this.y=L.x*b.w-b.x*L.w,this.w=b.x*L.y-L.x*b.y}else if(arguments[0]instanceof We&&arguments[1]instanceof We){var O=arguments[0],V=arguments[1];this.x=O.y-V.y,this.y=V.x-O.x,this.w=O.x*V.y-V.x*O.y}}else if(arguments.length===3){var $=arguments[0],me=arguments[1],Be=arguments[2];this.x=$,this.y=me,this.w=Be}else if(arguments.length===4){var Ke=arguments[0],mt=arguments[1],zt=arguments[2],Nt=arguments[3],gn=Ke.y-mt.y,bn=mt.x-Ke.x,Rn=Ke.x*mt.y-mt.x*Ke.y,ti=zt.y-Nt.y,mi=Nt.x-zt.x,li=zt.x*Nt.y-Nt.x*zt.y;this.x=bn*li-mi*Rn,this.y=ti*Rn-gn*li,this.w=gn*mi-ti*bn}}}]),I}(),Ml=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"area",value:function(){return I.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return I.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(c){if(c===null)throw new ve("Supplied point is null.");return I.interpolateZ(c,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return I.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return I.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return I.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return I.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return I.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return I.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.p0=c,this.p1=d,this.p2=p}},{key:"area",value:function(c,d,p){return Math.abs(((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2)}},{key:"signedArea",value:function(c,d,p){return((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2}},{key:"det",value:function(c,d,p,b){return c*b-d*p}},{key:"interpolateZ",value:function(c,d,p,b){var L=d.x,O=d.y,V=p.x-L,$=b.x-L,me=p.y-O,Be=b.y-O,Ke=V*Be-$*me,mt=c.x-L,zt=c.y-O,Nt=(Be*mt-$*zt)/Ke,gn=(-me*mt+V*zt)/Ke;return d.getZ()+Nt*(p.getZ()-d.getZ())+gn*(b.getZ()-d.getZ())}},{key:"longestSideLength",value:function(c,d,p){var b=c.distance(d),L=d.distance(p),O=p.distance(c),V=b;return L>V&&(V=L),O>V&&(V=O),V}},{key:"circumcentreDD",value:function(c,d,p){var b=ct.valueOf(c.x).subtract(p.x),L=ct.valueOf(c.y).subtract(p.y),O=ct.valueOf(d.x).subtract(p.x),V=ct.valueOf(d.y).subtract(p.y),$=ct.determinant(b,L,O,V).multiply(2),me=b.sqr().add(L.sqr()),Be=O.sqr().add(V.sqr()),Ke=ct.determinant(L,me,V,Be),mt=ct.determinant(b,me,O,Be),zt=ct.valueOf(p.x).subtract(Ke.divide($)).doubleValue(),Nt=ct.valueOf(p.y).add(mt.divide($)).doubleValue();return new We(zt,Nt)}},{key:"isAcute",value:function(c,d,p){return!!Oi.isAcute(c,d,p)&&!!Oi.isAcute(d,p,c)&&!!Oi.isAcute(p,c,d)}},{key:"circumcentre",value:function(c,d,p){var b=p.x,L=p.y,O=c.x-b,V=c.y-L,$=d.x-b,me=d.y-L,Be=2*I.det(O,V,$,me),Ke=I.det(V,O*O+V*V,me,$*$+me*me),mt=I.det(O,O*O+V*V,$,$*$+me*me);return new We(b-Ke/Be,L+mt/Be)}},{key:"perpendicularBisector",value:function(c,d){var p=d.x-c.x,b=d.y-c.y,L=new Vs(c.x+p/2,c.y+b/2,1),O=new Vs(c.x-b+p/2,c.y+p+b/2,1);return new Vs(L,O)}},{key:"angleBisector",value:function(c,d,p){var b=d.distance(c),L=b/(b+d.distance(p)),O=p.x-c.x,V=p.y-c.y;return new We(c.x+L*O,c.y+L*V)}},{key:"area3D",value:function(c,d,p){var b=d.x-c.x,L=d.y-c.y,O=d.getZ()-c.getZ(),V=p.x-c.x,$=p.y-c.y,me=p.getZ()-c.getZ(),Be=L*me-O*$,Ke=O*V-b*me,mt=b*$-L*V,zt=Be*Be+Ke*Ke+mt*mt,Nt=Math.sqrt(zt)/2;return Nt}},{key:"centroid",value:function(c,d,p){var b=(c.x+d.x+p.x)/3,L=(c.y+d.y+p.y)/3;return new We(b,L)}},{key:"inCentre",value:function(c,d,p){var b=d.distance(p),L=c.distance(p),O=c.distance(d),V=b+L+O,$=(b*c.x+L*d.x+O*p.x)/V,me=(b*c.y+L*d.y+O*p.y)/V;return new We($,me)}}]),I}(),kc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addRingSide",value:function(c,d,p,b,L){if(d===0&&c.length<wi.MINIMUM_VALID_SIZE)return null;var O=b,V=L;c.length>=wi.MINIMUM_VALID_SIZE&&mn.isCCW(c)&&(O=L,V=b,p=Ee.opposite(p));var $=this._curveBuilder.getRingCurve(c,p,d);this.addCurve($,O,V)}},{key:"addRingBothSides",value:function(c,d){this.addRingSide(c,d,Ee.LEFT,Se.EXTERIOR,Se.INTERIOR),this.addRingSide(c,d,Ee.RIGHT,Se.INTERIOR,Se.EXTERIOR)}},{key:"addPoint",value:function(c){if(this._distance<=0)return null;var d=c.getCoordinates(),p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Se.EXTERIOR,Se.INTERIOR)}},{key:"addPolygon",value:function(c){var d=this._distance,p=Ee.LEFT;this._distance<0&&(d=-this._distance,p=Ee.RIGHT);var b=c.getExteriorRing(),L=Wn.removeRepeatedPoints(b.getCoordinates());if(this._distance<0&&this.isErodedCompletely(b,this._distance)||this._distance<=0&&L.length<3)return null;this.addRingSide(L,d,p,Se.EXTERIOR,Se.INTERIOR);for(var O=0;O<c.getNumInteriorRing();O++){var V=c.getInteriorRingN(O),$=Wn.removeRepeatedPoints(V.getCoordinates());this._distance>0&&this.isErodedCompletely(V,-this._distance)||this.addRingSide($,d,Ee.opposite(p),Se.INTERIOR,Se.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(c,d){var p=new Ml(c[0],c[1],c[2]),b=p.inCentre();return Ji.pointToSegment(b,p.p0,p.p1)<Math.abs(d)}},{key:"addLineString",value:function(c){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var d=Wn.removeRepeatedPoints(c.getCoordinates());if(Wn.isRing(d)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(d,this._distance);else{var p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Se.EXTERIOR,Se.INTERIOR)}}},{key:"addCurve",value:function(c,d,p){if(c===null||c.length<2)return null;var b=new bs(c,new bi(0,Se.BOUNDARY,d,p));this._curveList.add(b)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(c){if(c.isEmpty())return null;if(c instanceof en)this.addPolygon(c);else if(c instanceof Xe)this.addLineString(c);else if(c instanceof et)this.addPoint(c);else if(c instanceof Bn)this.addCollection(c);else if(c instanceof no)this.addCollection(c);else if(c instanceof Cr)this.addCollection(c);else{if(!(c instanceof Mn))throw new Ct(c.getGeometryType());this.addCollection(c)}}},{key:"isErodedCompletely",value:function(c,d){var p=c.getCoordinates();if(p.length<4)return d<0;if(p.length===4)return this.isTriangleErodedCompletely(p,d);var b=c.getEnvelopeInternal(),L=Math.min(b.getHeight(),b.getWidth());return d<0&&2*Math.abs(d)>L}},{key:"addCollection",value:function(c){for(var d=0;d<c.getNumGeometries();d++){var p=c.getGeometryN(d);this.add(p)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new At;var c=arguments[0],d=arguments[1],p=arguments[2];this._inputGeom=c,this._distance=d,this._curveBuilder=p}}]),I}(),Di=function(){function I(){n(this,I)}return a(I,[{key:"locate",value:function(c){}}]),I}(),Ic=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,I.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ye;var c=this._parent.getGeometryN(this._index++);return c instanceof Mn?(this._subcollectionIterator=new I(c),this._subcollectionIterator.next()):c}},{key:"remove",value:function(){throw new Ct(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[fu]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var c=arguments[0];this._parent=c,this._atStart=!0,this._index=0,this._max=c.getNumGeometries()}},{key:"isAtomic",value:function(c){return!(c instanceof Mn)}}]),I}(),Un=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"locate",value:function(c){return I.locate(c,this._geom)}},{key:"interfaces_",get:function(){return[Di]}}],[{key:"constructor_",value:function(){this._geom=null;var c=arguments[0];this._geom=c}},{key:"locatePointInPolygon",value:function(c,d){if(d.isEmpty())return Se.EXTERIOR;var p=d.getExteriorRing(),b=I.locatePointInRing(c,p);if(b!==Se.INTERIOR)return b;for(var L=0;L<d.getNumInteriorRing();L++){var O=d.getInteriorRingN(L),V=I.locatePointInRing(c,O);if(V===Se.BOUNDARY)return Se.BOUNDARY;if(V===Se.INTERIOR)return Se.EXTERIOR}return Se.INTERIOR}},{key:"locatePointInRing",value:function(c,d){return d.getEnvelopeInternal().intersects(c)?qs.locateInRing(c,d.getCoordinates()):Se.EXTERIOR}},{key:"containsPointInPolygon",value:function(c,d){return Se.EXTERIOR!==I.locatePointInPolygon(c,d)}},{key:"locateInGeometry",value:function(c,d){if(d instanceof en)return I.locatePointInPolygon(c,d);if(d instanceof Mn)for(var p=new Ic(d);p.hasNext();){var b=p.next();if(b!==d){var L=I.locateInGeometry(c,b);if(L!==Se.EXTERIOR)return L}}return Se.EXTERIOR}},{key:"isContained",value:function(c,d){return Se.EXTERIOR!==I.locate(c,d)}},{key:"locate",value:function(c,d){return d.isEmpty()?Se.EXTERIOR:d.getEnvelopeInternal().intersects(c)?I.locateInGeometry(c,d):Se.EXTERIOR}}]),I}(),Xa=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getNextCW",value:function(c){this.getEdges();var d=this._edgeList.indexOf(c),p=d-1;return d===0&&(p=this._edgeList.size()-1),this._edgeList.get(p)}},{key:"propagateSideLabels",value:function(c){for(var d=Se.NONE,p=this.iterator();p.hasNext();){var b=p.next().getLabel();b.isArea(c)&&b.getLocation(c,Ee.LEFT)!==Se.NONE&&(d=b.getLocation(c,Ee.LEFT))}if(d===Se.NONE)return null;for(var L=d,O=this.iterator();O.hasNext();){var V=O.next(),$=V.getLabel();if($.getLocation(c,Ee.ON)===Se.NONE&&$.setLocation(c,Ee.ON,L),$.isArea(c)){var me=$.getLocation(c,Ee.LEFT),Be=$.getLocation(c,Ee.RIGHT);if(Be!==Se.NONE){if(Be!==L)throw new Mt("side location conflict",V.getCoordinate());me===Se.NONE&&It.shouldNeverReachHere("found single null side (at "+V.getCoordinate()+")"),L=me}else It.isTrue($.getLocation(c,Ee.LEFT)===Se.NONE,"found single null side"),$.setLocation(c,Ee.RIGHT,L),$.setLocation(c,Ee.LEFT,L)}}}},{key:"getCoordinate",value:function(){var c=this.iterator();return c.hasNext()?c.next().getCoordinate():null}},{key:"print",value:function(c){Li.out.println("EdgeEndStar:   "+this.getCoordinate());for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"isAreaLabelsConsistent",value:function(c){return this.computeEdgeEndLabels(c.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(c){var d=this.getEdges();if(d.size()<=0)return!0;var p=d.size()-1,b=d.get(p).getLabel().getLocation(c,Ee.LEFT);It.isTrue(b!==Se.NONE,"Found unlabelled area edge");for(var L=b,O=this.iterator();O.hasNext();){var V=O.next().getLabel();It.isTrue(V.isArea(c),"Found non-area edge");var $=V.getLocation(c,Ee.LEFT),me=V.getLocation(c,Ee.RIGHT);if($===me||me!==L)return!1;L=$}return!0}},{key:"findIndex",value:function(c){this.iterator();for(var d=0;d<this._edgeList.size();d++)if(this._edgeList.get(d)===c)return d;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new At(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(c,d,p){return this._ptInAreaLocation[c]===Se.NONE&&(this._ptInAreaLocation[c]=Un.locate(d,p[c].getGeometry())),this._ptInAreaLocation[c]}},{key:"toString",value:function(){var c=new Vi;c.append("EdgeEndStar:   "+this.getCoordinate()),c.append(`
`);for(var d=this.iterator();d.hasNext();){var p=d.next();c.append(p),c.append(`
`)}return c.toString()}},{key:"computeEdgeEndLabels",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().computeLabel(c)}},{key:"computeLabelling",value:function(c){this.computeEdgeEndLabels(c[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var d=[!1,!1],p=this.iterator();p.hasNext();)for(var b=p.next().getLabel(),L=0;L<2;L++)b.isLine(L)&&b.getLocation(L)===Se.BOUNDARY&&(d[L]=!0);for(var O=this.iterator();O.hasNext();)for(var V=O.next(),$=V.getLabel(),me=0;me<2;me++)if($.isAnyNull(me)){var Be=Se.NONE;if(d[me])Be=Se.EXTERIOR;else{var Ke=V.getCoordinate();Be=this.getLocation(me,Ke,c)}$.setAllLocationsIfNull(me,Be)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(c,d){this._edgeMap.put(c,d),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Oo,this._edgeList=null,this._ptInAreaLocation=[Se.NONE,Se.NONE]}}]),I}(),pi=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var p=null,b=null,L=this._SCANNING_FOR_INCOMING,O=0;O<this._resultAreaEdgeList.size();O++){var V=this._resultAreaEdgeList.get(O),$=V.getSym();if(V.getLabel().isArea())switch(p===null&&V.isInResult()&&(p=V),L){case this._SCANNING_FOR_INCOMING:if(!$.isInResult())continue;b=$,L=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!V.isInResult())continue;b.setNext(V),L=this._SCANNING_FOR_INCOMING}}if(L===this._LINKING_TO_OUTGOING){if(p===null)throw new Mt("no outgoing dirEdge found",this.getCoordinate());It.isTrue(p.isInResult(),"unable to link last incoming dirEdge"),b.setNext(p)}}},{key:"insert",value:function(p){var b=p;this.insertEdgeEnd(b,b)}},{key:"getRightmostEdge",value:function(){var p=this.getEdges(),b=p.size();if(b<1)return null;var L=p.get(0);if(b===1)return L;var O=p.get(b-1),V=L.getQuadrant(),$=O.getQuadrant();return hr.isNorthern(V)&&hr.isNorthern($)?L:hr.isNorthern(V)||hr.isNorthern($)?L.getDy()!==0?L:O.getDy()!==0?O:(It.shouldNeverReachHere("found two horizontal edges incident on node"),null):O}},{key:"print",value:function(p){Li.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var b=this.iterator();b.hasNext();){var L=b.next();p.print("out "),L.print(p),p.println(),p.print("in "),L.getSym().print(p),p.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new At;for(var p=this.iterator();p.hasNext();){var b=p.next();(b.isInResult()||b.getSym().isInResult())&&this._resultAreaEdgeList.add(b)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(p){for(var b=this.iterator();b.hasNext();){var L=b.next().getLabel();L.setAllLocationsIfNull(0,p.getLocation(0)),L.setAllLocationsIfNull(1,p.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var p=null,b=null,L=this._edgeList.size()-1;L>=0;L--){var O=this._edgeList.get(L),V=O.getSym();b===null&&(b=V),p!==null&&V.setNext(p),p=O}b.setNext(p)}},{key:"computeDepths",value:function(){if(arguments.length===1){var p=arguments[0],b=this.findIndex(p),L=p.getDepth(Ee.LEFT),O=p.getDepth(Ee.RIGHT),V=this.computeDepths(b+1,this._edgeList.size(),L),$=this.computeDepths(0,b,V);if($!==O)throw new Mt("depth mismatch at "+p.getCoordinate())}else if(arguments.length===3){for(var me=arguments[0],Be=arguments[1],Ke=arguments[2],mt=Ke,zt=me;zt<Be;zt++){var Nt=this._edgeList.get(zt);Nt.setEdgeDepths(Ee.RIGHT,mt),mt=Nt.getDepth(Ee.LEFT)}return mt}}},{key:"mergeSymLabels",value:function(){for(var p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().merge(b.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(p){for(var b=null,L=null,O=this._SCANNING_FOR_INCOMING,V=this._resultAreaEdgeList.size()-1;V>=0;V--){var $=this._resultAreaEdgeList.get(V),me=$.getSym();switch(b===null&&$.getEdgeRing()===p&&(b=$),O){case this._SCANNING_FOR_INCOMING:if(me.getEdgeRing()!==p)continue;L=me,O=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if($.getEdgeRing()!==p)continue;L.setNextMin($),O=this._SCANNING_FOR_INCOMING}}O===this._LINKING_TO_OUTGOING&&(It.isTrue(b!==null,"found null for first outgoing dirEdge"),It.isTrue(b.getEdgeRing()===p,"unable to link last incoming dirEdge"),L.setNextMin(b))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var p=0,b=this.iterator();b.hasNext();){var L=b.next();L.isInResult()&&p++}return p}if(arguments.length===1){for(var O=arguments[0],V=0,$=this.iterator();$.hasNext();){var me=$.next();me.getEdgeRing()===O&&V++}return V}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var p=Se.NONE,b=this.iterator();b.hasNext();){var L=b.next(),O=L.getSym();if(!L.isLineEdge()){if(L.isInResult()){p=Se.INTERIOR;break}if(O.isInResult()){p=Se.EXTERIOR;break}}}if(p===Se.NONE)return null;for(var V=p,$=this.iterator();$.hasNext();){var me=$.next(),Be=me.getSym();me.isLineEdge()?me.getEdge().setCovered(V===Se.INTERIOR):(me.isInResult()&&(V=Se.EXTERIOR),Be.isInResult()&&(V=Se.INTERIOR))}}},{key:"computeLabelling",value:function(p){U(m(d.prototype),"computeLabelling",this).call(this,p),this._label=new bi(Se.NONE);for(var b=this.iterator();b.hasNext();)for(var L=b.next().getEdge().getLabel(),O=0;O<2;O++){var V=L.getLocation(O);V!==Se.INTERIOR&&V!==Se.BOUNDARY||this._label.setLocation(O,Se.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),d}(Xa),ci=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.call(this)}return a(d,[{key:"createNode",value:function(p){return new ma(p,new pi)}}]),d}(Ba),oo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;return I.compareOriented(this._pts,this._orientation,d._pts,d._orientation)}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var c=arguments[0];this._pts=c,this._orientation=I.orientation(c)}},{key:"orientation",value:function(c){return Wn.increasingDirection(c)===1}},{key:"compareOriented",value:function(c,d,p,b){for(var L=d?1:-1,O=b?1:-1,V=d?c.length:-1,$=b?p.length:-1,me=d?0:c.length-1,Be=b?0:p.length-1;;){var Ke=c[me].compareTo(p[Be]);if(Ke!==0)return Ke;var mt=(me+=L)===V,zt=(Be+=O)===$;if(mt&&!zt)return-1;if(!mt&&zt)return 1;if(mt&&zt)return 0}}}]),I}(),ba=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.print("MULTILINESTRING ( ");for(var d=0;d<this._edges.size();d++){var p=this._edges.get(d);d>0&&c.print(","),c.print("(");for(var b=p.getCoordinates(),L=0;L<b.length;L++)L>0&&c.print(","),c.print(b[L].x+" "+b[L].y);c.println(")")}c.print(")  ")}},{key:"addAll",value:function(c){for(var d=c.iterator();d.hasNext();)this.add(d.next())}},{key:"findEdgeIndex",value:function(c){for(var d=0;d<this._edges.size();d++)if(this._edges.get(d).equals(c))return d;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(c){return this._edges.get(c)}},{key:"findEqualEdge",value:function(c){var d=new oo(c.getCoordinates());return this._ocaMap.get(d)}},{key:"add",value:function(c){this._edges.add(c);var d=new oo(c.getCoordinates());this._ocaMap.put(d,c)}}],[{key:"constructor_",value:function(){this._edges=new At,this._ocaMap=new Oo}}]),I}(),Go=function(){function I(){n(this,I)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){}},{key:"isDone",value:function(){}}]),I}(),Rl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isTrivialIntersection",value:function(c,d,p,b){if(c===p&&this._li.getIntersectionNum()===1){if(I.isAdjacentSegments(d,b))return!0;if(c.isClosed()){var L=c.size()-1;if(d===0&&b===L||b===0&&d===L)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;this.numTests++;var L=c.getCoordinates()[d],O=c.getCoordinates()[d+1],V=p.getCoordinates()[b],$=p.getCoordinates()[b+1];this._li.computeIntersection(L,O,V,$),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(c,d,p,b)||(this._hasIntersection=!0,c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Go]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var c=arguments[0];this._li=c}},{key:"isAdjacentSegments",value:function(c,d){return Math.abs(c-d)===1}}]),I}(),So=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex),c.println(" dist = "+this.dist)}},{key:"compareTo",value:function(c){var d=c;return this.compare(d.segmentIndex,d.dist)}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===c}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(c,d){return this.segmentIndex<c?-1:this.segmentIndex>c?1:this.dist<d?-1:this.dist>d?1:0}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.coord=new We(c),this.segmentIndex=d,this.dist=p}}]),I}(),Zo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),L=this.createSplitEdge(p,b);c.add(L),p=b}}},{key:"addEndpoints",value:function(){var c=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[c],c,0)}},{key:"createSplitEdge",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2,b=this.edge.pts[d.segmentIndex],L=d.dist>0||!d.coord.equals2D(b);L||p--;var O=new Array(p).fill(null),V=0;O[V++]=new We(c.coord);for(var $=c.segmentIndex+1;$<=d.segmentIndex;$++)O[V++]=this.edge.pts[$];return L&&(O[V]=d.coord),new Ho(O,new bi(this.edge._label))}},{key:"add",value:function(c,d,p){var b=new So(c,d,p),L=this._nodeMap.get(b);return L!==null?L:(this._nodeMap.put(b,b),b)}},{key:"isIntersection",value:function(c){for(var d=this.iterator();d.hasNext();)if(d.next().coord.equals(c))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Oo,this.edge=null;var c=arguments[0];this.edge=c}}]),I}(),rs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"isCoveredBy",value:function(){return(I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this._matrix[p][b]=le.toDimensionValue(c.charAt(d))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._matrix[L][O]=V}}},{key:"isContains",value:function(){return I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this.setAtLeast(p,b,le.toDimensionValue(c.charAt(d)))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._matrix[L][O]<V&&(this._matrix[L][O]=V)}}},{key:"setAtLeastIfValid",value:function(c,d,p){c>=0&&d>=0&&this.setAtLeast(c,d,p)}},{key:"isWithin",value:function(){return I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE}},{key:"isTouches",value:function(c,d){return c>d?this.isTouches(d,c):(c===le.A&&d===le.A||c===le.L&&d===le.L||c===le.L&&d===le.A||c===le.P&&d===le.A||c===le.P&&d===le.L)&&this._matrix[Se.INTERIOR][Se.INTERIOR]===le.FALSE&&(I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))}},{key:"isOverlaps",value:function(c,d){return c===le.P&&d===le.P||c===le.A&&d===le.A?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):c===le.L&&d===le.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===1&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR])}},{key:"isEquals",value:function(c,d){return c===d&&I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"toString",value:function(){for(var c=new Qn("123456789"),d=0;d<3;d++)for(var p=0;p<3;p++)c.setCharAt(3*d+p,le.toDimensionSymbol(this._matrix[d][p]));return c.toString()}},{key:"setAll",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this._matrix[d][p]=c}},{key:"get",value:function(c,d){return this._matrix[c][d]}},{key:"transpose",value:function(){var c=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=c,c=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=c,c=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=c,this}},{key:"matches",value:function(c){if(c.length!==9)throw new ve("Should be length 9: "+c);for(var d=0;d<3;d++)for(var p=0;p<3;p++)if(!I.matches(this._matrix[d][p],c.charAt(3*d+p)))return!1;return!0}},{key:"add",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this.setAtLeast(d,p,c.get(d,p))}},{key:"isDisjoint",value:function(){return this._matrix[Se.INTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.INTERIOR][Se.BOUNDARY]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.INTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.BOUNDARY]===le.FALSE}},{key:"isCrosses",value:function(c,d){return c===le.P&&d===le.L||c===le.P&&d===le.A||c===le.L&&d===le.A?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR]):c===le.L&&d===le.P||c===le.A&&d===le.P||c===le.A&&d===le.L?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):c===le.L&&d===le.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===0}},{key:"interfaces_",get:function(){return[xe]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(le.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var c=arguments[0];I.constructor_.call(this),this.set(c)}else if(arguments[0]instanceof I){var d=arguments[0];I.constructor_.call(this),this._matrix[Se.INTERIOR][Se.INTERIOR]=d._matrix[Se.INTERIOR][Se.INTERIOR],this._matrix[Se.INTERIOR][Se.BOUNDARY]=d._matrix[Se.INTERIOR][Se.BOUNDARY],this._matrix[Se.INTERIOR][Se.EXTERIOR]=d._matrix[Se.INTERIOR][Se.EXTERIOR],this._matrix[Se.BOUNDARY][Se.INTERIOR]=d._matrix[Se.BOUNDARY][Se.INTERIOR],this._matrix[Se.BOUNDARY][Se.BOUNDARY]=d._matrix[Se.BOUNDARY][Se.BOUNDARY],this._matrix[Se.BOUNDARY][Se.EXTERIOR]=d._matrix[Se.BOUNDARY][Se.EXTERIOR],this._matrix[Se.EXTERIOR][Se.INTERIOR]=d._matrix[Se.EXTERIOR][Se.INTERIOR],this._matrix[Se.EXTERIOR][Se.BOUNDARY]=d._matrix[Se.EXTERIOR][Se.BOUNDARY],this._matrix[Se.EXTERIOR][Se.EXTERIOR]=d._matrix[Se.EXTERIOR][Se.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var c=arguments[0],d=arguments[1];return d===le.SYM_DONTCARE||d===le.SYM_TRUE&&(c>=0||c===le.TRUE)||d===le.SYM_FALSE&&c===le.FALSE||d===le.SYM_P&&c===le.P||d===le.SYM_L&&c===le.L||d===le.SYM_A&&c===le.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var p=arguments[0],b=arguments[1],L=new I(p);return L.matches(b)}}},{key:"isTrue",value:function(c){return c>=0||c===le.TRUE}}]),I}(),Pl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(c){return c===null||c.length===0?null:(this.ensureCapacity(this._size+c.length),Li.arraycopy(c,0,this._data,this._size,c.length),void(this._size+=c.length))}},{key:"ensureCapacity",value:function(c){if(c<=this._data.length)return null;var d=Math.max(c,2*this._data.length);this._data=at.copyOf(this._data,d)}},{key:"toArray",value:function(){var c=new Array(this._size).fill(null);return Li.arraycopy(this._data,0,c,0,this._size),c}},{key:"add",value:function(c){this.ensureCapacity(this._size+1),this._data[this._size]=c,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)I.constructor_.call(this,10);else if(arguments.length===1){var c=arguments[0];this._data=new Array(c).fill(null)}}}]),I}(),Dl=function(){function I(){n(this,I)}return a(I,[{key:"getChainStartIndices",value:function(c){var d=0,p=new Pl(Math.trunc(c.length/2));p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return p.toArray()}},{key:"findChainEnd",value:function(c,d){for(var p=hr.quadrant(c[d],c[d+1]),b=d+1;b<c.length&&hr.quadrant(c[b-1],c[b])===p;)b++;return b-1}},{key:"OLDgetChainStartIndices",value:function(c){var d=0,p=new At;p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return I.toIntArray(p)}}],[{key:"toIntArray",value:function(c){for(var d=new Array(c.size()).fill(null),p=0;p<d.length;p++)d[p]=c.get(p).intValue();return d}}]),I}(),Nl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d>p?d:p}},{key:"getMinX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d<p?d:p}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this.computeIntersectsForChain(this.startIndex[c],this.startIndex[c+1],d,d.startIndex[p],d.startIndex[p+1],b)}else if(arguments.length===6){var L=arguments[0],O=arguments[1],V=arguments[2],$=arguments[3],me=arguments[4],Be=arguments[5];if(O-L==1&&me-$==1)return Be.addIntersections(this.e,L,V.e,$),null;if(!this.overlaps(L,O,V,$,me))return null;var Ke=Math.trunc((L+O)/2),mt=Math.trunc(($+me)/2);L<Ke&&($<mt&&this.computeIntersectsForChain(L,Ke,V,$,mt,Be),mt<me&&this.computeIntersectsForChain(L,Ke,V,mt,me,Be)),Ke<O&&($<mt&&this.computeIntersectsForChain(Ke,O,V,$,mt,Be),mt<me&&this.computeIntersectsForChain(Ke,O,V,mt,me,Be))}}},{key:"overlaps",value:function(c,d,p,b,L){return dn.intersects(this.pts[c],this.pts[d],p.pts[b],p.pts[L])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(c,d){for(var p=0;p<this.startIndex.length-1;p++)for(var b=0;b<c.startIndex.length-1;b++)this.computeIntersectsForChain(p,c,b,d)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var c=arguments[0];this.e=c,this.pts=c.getCoordinates();var d=new Dl;this.startIndex=d.getChainStartIndices(this.pts)}}]),I}(),ao=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getDepth",value:function(c,d){return this._depth[c][d]}},{key:"setDepth",value:function(c,d,p){this._depth[c][d]=p}},{key:"isNull",value:function(){if(arguments.length===0){for(var c=0;c<2;c++)for(var d=0;d<3;d++)if(this._depth[c][d]!==I.NULL_VALUE)return!1;return!0}if(arguments.length===1){var p=arguments[0];return this._depth[p][1]===I.NULL_VALUE}if(arguments.length===2){var b=arguments[0],L=arguments[1];return this._depth[b][L]===I.NULL_VALUE}}},{key:"normalize",value:function(){for(var c=0;c<2;c++)if(!this.isNull(c)){var d=this._depth[c][1];this._depth[c][2]<d&&(d=this._depth[c][2]),d<0&&(d=0);for(var p=1;p<3;p++){var b=0;this._depth[c][p]>d&&(b=1),this._depth[c][p]=b}}}},{key:"getDelta",value:function(c){return this._depth[c][Ee.RIGHT]-this._depth[c][Ee.LEFT]}},{key:"getLocation",value:function(c,d){return this._depth[c][d]<=0?Se.EXTERIOR:Se.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<2;d++)for(var p=1;p<3;p++){var b=c.getLocation(d,p);b!==Se.EXTERIOR&&b!==Se.INTERIOR||(this.isNull(d,p)?this._depth[d][p]=I.depthAtLocation(b):this._depth[d][p]+=I.depthAtLocation(b))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];V===Se.INTERIOR&&this._depth[L][O]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var c=0;c<2;c++)for(var d=0;d<3;d++)this._depth[c][d]=I.NULL_VALUE}},{key:"depthAtLocation",value:function(c){return c===Se.EXTERIOR?0:c===Se.INTERIOR?1:I.NULL_VALUE}}]),I}();ao.NULL_VALUE=-1;var Ho=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var p=new Array(2).fill(null);return p[0]=this.pts[0],p[1]=this.pts[1],new d(p,bi.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(p){this._isIsolated=p}},{key:"setName",value:function(p){this._name=p}},{key:"equals",value:function(p){if(!(p instanceof d))return!1;var b=p;if(this.pts.length!==b.pts.length)return!1;for(var L=!0,O=!0,V=this.pts.length,$=0;$<this.pts.length;$++)if(this.pts[$].equals2D(b.pts[$])||(L=!1),this.pts[$].equals2D(b.pts[--V])||(O=!1),!L&&!O)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var p=arguments[0];return this.pts[p]}}},{key:"print",value:function(p){p.print("edge "+this._name+": "),p.print("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.print(","),p.print(this.pts[b].x+" "+this.pts[b].y);p.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(p){d.updateIM(this._label,p)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(p){p.print("edge "+this._name+": ");for(var b=this.pts.length-1;b>=0;b--)p.print(this.pts[b]+" ");p.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Nl(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new dn;for(var p=0;p<this.pts.length;p++)this._env.expandToInclude(this.pts[p])}return this._env}},{key:"addIntersection",value:function(p,b,L,O){var V=new We(p.getIntersection(O)),$=b,me=p.getEdgeDistance(L,O),Be=$+1;if(Be<this.pts.length){var Ke=this.pts[Be];V.equals2D(Ke)&&($=Be,me=0)}this.eiList.add(V,$,me)}},{key:"toString",value:function(){var p=new Qn;p.append("edge "+this._name+": "),p.append("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.append(","),p.append(this.pts[b].x+" "+this.pts[b].y);return p.append(")  "+this._label+" "+this._depthDelta),p.toString()}},{key:"isPointwiseEqual",value:function(p){if(this.pts.length!==p.pts.length)return!1;for(var b=0;b<this.pts.length;b++)if(!this.pts[b].equals2D(p.pts[b]))return!1;return!0}},{key:"setDepthDelta",value:function(p){this._depthDelta=p}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(p,b,L){for(var O=0;O<p.getIntersectionNum();O++)this.addIntersection(p,b,L,O)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Zo(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ao,this._depthDelta=0,arguments.length===1){var p=arguments[0];d.constructor_.call(this,p,null)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.pts=b,this._label=L}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof rs&&arguments[0]instanceof bi))return U(m(d),"updateIM",this).apply(this,arguments);var p=arguments[0],b=arguments[1];b.setAtLeastIfValid(p.getLocation(0,Ee.ON),p.getLocation(1,Ee.ON),1),p.isArea()&&(b.setAtLeastIfValid(p.getLocation(0,Ee.LEFT),p.getLocation(1,Ee.LEFT),2),b.setAtLeastIfValid(p.getLocation(0,Ee.RIGHT),p.getLocation(1,Ee.RIGHT),2))}}]),d}(pa),Xo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setWorkingPrecisionModel",value:function(c){this._workingPrecisionModel=c}},{key:"insertUniqueEdge",value:function(c){var d=this._edgeList.findEqualEdge(c);if(d!==null){var p=d.getLabel(),b=c.getLabel();d.isPointwiseEqual(c)||(b=new bi(c.getLabel())).flip(),p.merge(b);var L=I.depthDelta(b),O=d.getDepthDelta()+L;d.setDepthDelta(O)}else this._edgeList.add(c),c.setDepthDelta(I.depthDelta(c.getLabel()))}},{key:"buildSubgraphs",value:function(c,d){for(var p=new At,b=c.iterator();b.hasNext();){var L=b.next(),O=L.getRightmostCoordinate(),V=new Za(p).getDepth(O);L.computeDepth(V),L.findResultEdges(),p.add(L),d.add(L.getDirectedEdges(),L.getNodes())}}},{key:"createSubgraphs",value:function(c){for(var d=new At,p=c.getNodes().iterator();p.hasNext();){var b=p.next();if(!b.isVisited()){var L=new Gr;L.create(b),d.add(L)}}return Uo.sort(d,Uo.reverseOrder()),d}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(c){if(this._workingNoder!==null)return this._workingNoder;var d=new Va,p=new so;return p.setPrecisionModel(c),d.setSegmentIntersector(new Rl(p)),d}},{key:"buffer",value:function(c,d){var p=this._workingPrecisionModel;p===null&&(p=c.getPrecisionModel()),this._geomFact=c.getFactory();var b=new Ll(p,this._bufParams),L=new kc(c,d,b).getCurves();if(L.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(L,p),this._graph=new ys(new ci),this._graph.addEdges(this._edgeList.getEdges());var O=this.createSubgraphs(this._graph),V=new bc(this._geomFact);this.buildSubgraphs(O,V);var $=V.getPolygons();return $.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry($)}},{key:"computeNodedEdges",value:function(c,d){var p=this.getNoder(d);p.computeNodes(c);for(var b=p.getNodedSubstrings().iterator();b.hasNext();){var L=b.next(),O=L.getCoordinates();if(O.length!==2||!O[0].equals2D(O[1])){var V=L.getData(),$=new Ho(L.getCoordinates(),new bi(V));this.insertUniqueEdge($)}}}},{key:"setNoder",value:function(c){this._workingNoder=c}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ba;var c=arguments[0];this._bufParams=c}},{key:"depthDelta",value:function(c){var d=c.getLocation(0,Ee.LEFT),p=c.getLocation(0,Ee.RIGHT);return d===Se.INTERIOR&&p===Se.EXTERIOR?1:d===Se.EXTERIOR&&p===Se.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(c){for(var d=new Qr,p=new At;c.hasNext();){var b=c.next(),L=d.createLineString(b.getCoordinates());p.add(L)}return d.buildGeometry(p)}}]),I}(),Wo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"rescale",value:function(){if(xn(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.rescale(p.getCoordinates())}else if(arguments[0]instanceof Array){for(var b=arguments[0],L=0;L<b.length;L++)b[L].x=b[L].x/this._scaleFactor+this._offsetX,b[L].y=b[L].y/this._scaleFactor+this._offsetY;b.length===2&&b[0].equals2D(b[1])&&Li.out.println(b)}}},{key:"scale",value:function(){if(xn(arguments[0],lt)){for(var c=arguments[0],d=new At(c.size()),p=c.iterator();p.hasNext();){var b=p.next();d.add(new bs(this.scale(b.getCoordinates()),b.getData()))}return d}if(arguments[0]instanceof Array){for(var L=arguments[0],O=new Array(L.length).fill(null),V=0;V<L.length;V++)O[V]=new We(Math.round((L[V].x-this._offsetX)*this._scaleFactor),Math.round((L[V].y-this._offsetY)*this._scaleFactor),L[V].getZ());var $=Wn.removeRepeatedPoints(O);return $}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var c=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(c),c}},{key:"computeNodes",value:function(c){var d=c;this._isScaled&&(d=this.scale(c)),this._noder.computeNodes(d)}},{key:"interfaces_",get:function(){return[qa]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var c=arguments[0],d=arguments[1];I.constructor_.call(this,c,d,0,0)}else if(arguments.length===4){var p=arguments[0],b=arguments[1];this._noder=p,this._scaleFactor=b,this._isScaled=!this.isIntegerPrecision()}}}]),I}(),Ko=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next(),p=d.getCoordinates();this.checkEndPtVertexIntersections(p[0],this._segStrings),this.checkEndPtVertexIntersections(p[p.length-1],this._segStrings)}else if(arguments.length===2){for(var b=arguments[0],L=arguments[1],O=L.iterator();O.hasNext();)for(var V=O.next(),$=V.getCoordinates(),me=1;me<$.length-1;me++)if($[me].equals(b))throw new ft("found endpt/interior pt intersection at index "+me+" :pt "+b)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();)for(var d=c.next(),p=this._segStrings.iterator();p.hasNext();){var b=p.next();this.checkInteriorIntersections(d,b)}else if(arguments.length===2)for(var L=arguments[0],O=arguments[1],V=L.getCoordinates(),$=O.getCoordinates(),me=0;me<V.length-1;me++)for(var Be=0;Be<$.length-1;Be++)this.checkInteriorIntersections(L,me,O,Be);else if(arguments.length===4){var Ke=arguments[0],mt=arguments[1],zt=arguments[2],Nt=arguments[3];if(Ke===zt&&mt===Nt)return null;var gn=Ke.getCoordinates()[mt],bn=Ke.getCoordinates()[mt+1],Rn=zt.getCoordinates()[Nt],ti=zt.getCoordinates()[Nt+1];if(this._li.computeIntersection(gn,bn,Rn,ti),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,gn,bn)||this.hasInteriorIntersection(this._li,Rn,ti)))throw new ft("found non-noded intersection at "+gn+"-"+bn+" and "+Rn+"-"+ti)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next();this.checkCollapses(d)}else if(arguments.length===1)for(var p=arguments[0],b=p.getCoordinates(),L=0;L<b.length-2;L++)this.checkCollapse(b[L],b[L+1],b[L+2])}},{key:"hasInteriorIntersection",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++){var L=c.getIntersection(b);if(!L.equals(d)&&!L.equals(p))return!0}return!1}},{key:"checkCollapse",value:function(c,d,p){if(c.equals(p))throw new ft("found non-noded collapse at "+I.fact.createLineString([c,d,p]))}}],[{key:"constructor_",value:function(){this._li=new so,this._segStrings=null;var c=arguments[0];this._segStrings=c}}]),I}();Ko.fact=new Qr;var $o=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"intersectsScaled",value:function(c,d){var p=Math.min(c.x,d.x),b=Math.max(c.x,d.x),L=Math.min(c.y,d.y),O=Math.max(c.y,d.y),V=this._maxx<p||this._minx>b||this._maxy<L||this._miny>O;if(V)return!1;var $=this.intersectsToleranceSquare(c,d);return It.isTrue(!(V&&$),"Found bad envelope test"),$}},{key:"initCorners",value:function(c){var d=.5;this._minx=c.x-d,this._maxx=c.x+d,this._miny=c.y-d,this._maxy=c.y+d,this._corner[0]=new We(this._maxx,this._maxy),this._corner[1]=new We(this._minx,this._maxy),this._corner[2]=new We(this._minx,this._miny),this._corner[3]=new We(this._maxx,this._miny)}},{key:"intersects",value:function(c,d){return this._scaleFactor===1?this.intersectsScaled(c,d):(this.copyScaled(c,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(c){return Math.round(c*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(c,d){d.x=this.scale(c.x),d.y=this.scale(c.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var c=I.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new dn(this._originalPt.x-c,this._originalPt.x+c,this._originalPt.y-c,this._originalPt.y+c)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(c,d){return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(c,d){var p=!1,b=!1;return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!p||!b)||!!c.equals(this._pt)||!!d.equals(this._pt))))}},{key:"addSnappedNode",value:function(c,d){var p=c.getCoordinate(d),b=c.getCoordinate(d+1);return!!this.intersects(p,b)&&(c.addIntersection(this.getCoordinate(),d),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var c=arguments[0],d=arguments[1],p=arguments[2];if(this._originalPt=c,this._pt=c,this._scaleFactor=d,this._li=p,d<=0)throw new ve("Scale factor must be non-zero");d!==1&&(this._pt=new We(this.scale(c.x),this.scale(c.y)),this._p0Scaled=new We,this._p1Scaled=new We),this.initCorners(this._pt)}}]),I}();$o.SAFE_ENV_EXPANSION_FACTOR=.75;var Yo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"select",value:function(){if(arguments.length!==1&&arguments.length===2){var c=arguments[0],d=arguments[1];c.getLineSegment(d,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Hr}}]),I}(),Eo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"snap",value:function(){if(arguments.length===1){var c=arguments[0];return this.snap(c,null,-1)}if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2],L=d.getSafeEnvelope(),O=new zl(d,p,b);return this._index.query(L,new(function(){function V(){n(this,V)}return a(V,[{key:"interfaces_",get:function(){return[Al]}},{key:"visitItem",value:function($){$.select(L,O)}}]),V}())),O.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var c=arguments[0];this._index=c}}]),I}(),zl=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof mu))return U(m(d.prototype),"select",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=p.getContext();if(this._parentEdge===L&&(b===this._hotPixelVertexIndex||b+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(L,b)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var p=arguments[0],b=arguments[1],L=arguments[2];this._hotPixel=p,this._parentEdge=b,this._hotPixelVertexIndex=L}}]),d}(Yo);Eo.HotPixelSnapAction=zl;var Fl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;var L=c.getCoordinates()[d],O=c.getCoordinates()[d+1],V=p.getCoordinates()[b],$=p.getCoordinates()[b+1];if(this._li.computeIntersection(L,O,V,$),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var me=0;me<this._li.getIntersectionNum();me++)this._interiorIntersections.add(this._li.getIntersection(me));c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Go]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var c=arguments[0];this._li=c,this._interiorIntersections=new At}}]),I}(),$n=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkCorrectness",value:function(c){var d=bs.getNodedSubstrings(c),p=new Ko(d);try{p.checkValid()}catch(b){if(!(b instanceof pe))throw b;b.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return bs.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(c,d){var p=this.findInteriorIntersections(c,d);this.computeIntersectionSnaps(p),this.computeVertexSnaps(c)}},{key:"findInteriorIntersections",value:function(c,d){var p=new Fl(d);return this._noder.setSegmentIntersector(p),this._noder.computeNodes(c),p.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(xn(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.computeVertexSnaps(p)}else if(arguments[0]instanceof bs)for(var b=arguments[0],L=b.getCoordinates(),O=0;O<L.length;O++){var V=new $o(L[O],this._scaleFactor,this._li),$=this._pointSnapper.snap(V,b,O);$&&b.addIntersection(L[O],O)}}},{key:"computeNodes",value:function(c){this._nodedSegStrings=c,this._noder=new Va,this._pointSnapper=new Eo(this._noder.getIndex()),this.snapRound(c,this._li)}},{key:"computeIntersectionSnaps",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next(),b=new $o(p,this._scaleFactor,this._li);this._pointSnapper.snap(b)}}},{key:"interfaces_",get:function(){return[qa]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var c=arguments[0];this._pm=c,this._li=new so,this._li.setPrecisionModel(c),this._scaleFactor=c.getScale()}}]),I}(),Gs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"bufferFixedPrecision",value:function(c){var d=new Wo(new $n(new Ri(1)),c.getScale()),p=new Xo(this._bufParams);p.setWorkingPrecisionModel(c),p.setNoder(d),this._resultGeometry=p.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var c=I.MAX_PRECISION_DIGITS;c>=0;c--){try{this.bufferReducedPrecision(c)}catch(L){if(!(L instanceof Mt))throw L;this._saveException=L}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var d=arguments[0],p=I.precisionScaleFactor(this._argGeom,this._distance,d),b=new Ri(p);this.bufferFixedPrecision(b)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var c=this._argGeom.getFactory().getPrecisionModel();c.getType()===Ri.FIXED?this.bufferFixedPrecision(c):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(c){this._bufParams.setQuadrantSegments(c)}},{key:"bufferOriginalPrecision",value:function(){try{var c=new Xo(this._bufParams);this._resultGeometry=c.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof ft))throw d;this._saveException=d}}},{key:"getResultGeometry",value:function(c){return this._distance=c,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(c){this._bufParams.setEndCapStyle(c)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new K,this._resultGeometry=null,this._saveException=null,arguments.length===1){var c=arguments[0];this._argGeom=c}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this._argGeom=d,this._bufParams=p}}},{key:"bufferOp",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1],p=new I(c),b=p.getResultGeometry(d);return b}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ot&&typeof arguments[1]=="number"){var L=arguments[0],O=arguments[1],V=arguments[2],$=new I(L);$.setQuadrantSegments(V);var me=$.getResultGeometry(O);return me}if(arguments[2]instanceof K&&arguments[0]instanceof Ot&&typeof arguments[1]=="number"){var Be=arguments[0],Ke=arguments[1],mt=arguments[2],zt=new I(Be,mt),Nt=zt.getResultGeometry(Ke);return Nt}}else if(arguments.length===4){var gn=arguments[0],bn=arguments[1],Rn=arguments[2],ti=arguments[3],mi=new I(gn);mi.setQuadrantSegments(Rn),mi.setEndCapStyle(ti);var li=mi.getResultGeometry(bn);return li}}},{key:"precisionScaleFactor",value:function(c,d,p){var b=c.getEnvelopeInternal(),L=Ar.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(d>0?d:0),O=p-Math.trunc(Math.log(L)/Math.log(10)+1);return Math.pow(10,O)}}]),I}();Gs.CAP_ROUND=K.CAP_ROUND,Gs.CAP_BUTT=K.CAP_FLAT,Gs.CAP_FLAT=K.CAP_FLAT,Gs.CAP_SQUARE=K.CAP_SQUARE,Gs.MAX_PRECISION_DIGITS=12;var Sc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ol=function(){function I(c){n(this,I),this.geometryFactory=c||new Qr}return a(I,[{key:"read",value:function(c){var d,p=(d=typeof c=="string"?JSON.parse(c):c).type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+d.type);return Sc.indexOf(p)!==-1?fr[p].call(this,d.coordinates):p==="GeometryCollection"?fr[p].call(this,d.geometries):fr[p].call(this,d)}},{key:"write",value:function(c){var d=c.getGeometryType();if(!xs[d])throw new Error("Geometry is not supported");return xs[d].call(this,c)}}]),I}(),fr={Feature:function(I){var c={};for(var d in I)c[d]=I[d];if(I.geometry){var p=I.geometry.type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+I.type);c.geometry=this.read(I.geometry)}return I.bbox&&(c.bbox=fr.bbox.call(this,I.bbox)),c},FeatureCollection:function(I){var c={};if(I.features){c.features=[];for(var d=0;d<I.features.length;++d)c.features.push(this.read(I.features[d]))}return I.bbox&&(c.bbox=this.parse.bbox.call(this,I.bbox)),c},coordinates:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(S(We,ee(p)))}return c},bbox:function(I){return this.geometryFactory.createLinearRing([new We(I[0],I[1]),new We(I[2],I[1]),new We(I[2],I[3]),new We(I[0],I[3]),new We(I[0],I[1])])},Point:function(I){var c=S(We,ee(I));return this.geometryFactory.createPoint(c)},MultiPoint:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.Point.call(this,I[d]));return this.geometryFactory.createMultiPoint(c)},LineString:function(I){var c=fr.coordinates.call(this,I);return this.geometryFactory.createLineString(c)},MultiLineString:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.LineString.call(this,I[d]));return this.geometryFactory.createMultiLineString(c)},Polygon:function(I){for(var c=fr.coordinates.call(this,I[0]),d=this.geometryFactory.createLinearRing(c),p=[],b=1;b<I.length;++b){var L=I[b],O=fr.coordinates.call(this,L),V=this.geometryFactory.createLinearRing(O);p.push(V)}return this.geometryFactory.createPolygon(d,p)},MultiPolygon:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(fr.Polygon.call(this,p))}return this.geometryFactory.createMultiPolygon(c)},GeometryCollection:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(this.read(p))}return this.geometryFactory.createGeometryCollection(c)}},xs={coordinate:function(I){var c=[I.x,I.y];return I.z&&c.push(I.z),I.m&&c.push(I.m),c},Point:function(I){return{type:"Point",coordinates:xs.coordinate.call(this,I.getCoordinate())}},MultiPoint:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=xs.Point.call(this,p);c.push(b.coordinates)}return{type:"MultiPoint",coordinates:c}},LineString:function(I){for(var c=[],d=I.getCoordinates(),p=0;p<d.length;++p){var b=d[p];c.push(xs.coordinate.call(this,b))}return{type:"LineString",coordinates:c}},MultiLineString:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=xs.LineString.call(this,p);c.push(b.coordinates)}return{type:"MultiLineString",coordinates:c}},Polygon:function(I){var c=[],d=xs.LineString.call(this,I._shell);c.push(d.coordinates);for(var p=0;p<I._holes.length;++p){var b=I._holes[p],L=xs.LineString.call(this,b);c.push(L.coordinates)}return{type:"Polygon",coordinates:c}},MultiPolygon:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=xs.Polygon.call(this,p);c.push(b.coordinates)}return{type:"MultiPolygon",coordinates:c}},GeometryCollection:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=p.getGeometryType();c.push(xs[b].call(this,p))}return{type:"GeometryCollection",geometries:c}}};return{BufferOp:Gs,GeoJSONReader:function(){function I(c){n(this,I),this.parser=new Ol(c||new Qr)}return a(I,[{key:"read",value:function(c){return this.parser.read(c)}}]),I}(),GeoJSONWriter:function(){function I(){n(this,I),this.parser=new Ol(this.geometryFactory)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}]),I}()}})})(dv);var kw=dv.exports;const Iw=ww(kw);function kl(){return new Of}function Of(){this.reset()}Of.prototype={constructor:Of,reset:function(){this.s=this.t=0},add:function(s){u_(yf,s,this.t),u_(this,yf.s,this.s),this.s?this.t+=yf.t:this.s=yf.t},valueOf:function(){return this.s}};var yf=new Of;function u_(s,e,n){var r=s.s=e+n,a=r-e,h=r-a;s.t=e-h+(n-a)}var zi=1e-6,di=Math.PI,sa=di/2,c_=di/4,oa=di*2,pl=180/di,mo=di/180,Vr=Math.abs,Sw=Math.atan,rc=Math.atan2,nr=Math.cos,ir=Math.sin,fc=Math.sqrt;function pv(s){return s>1?0:s<-1?di:Math.acos(s)}function su(s){return s>1?sa:s<-1?-sa:Math.asin(s)}function mh(){}function Bf(s,e){s&&f_.hasOwnProperty(s.type)&&f_[s.type](s,e)}var h_={Feature:function(s,e){Bf(s.geometry,e)},FeatureCollection:function(s,e){for(var n=s.features,r=-1,a=n.length;++r<a;)Bf(n[r].geometry,e)}},f_={Sphere:function(s,e){e.sphere()},Point:function(s,e){s=s.coordinates,e.point(s[0],s[1],s[2])},MultiPoint:function(s,e){for(var n=s.coordinates,r=-1,a=n.length;++r<a;)s=n[r],e.point(s[0],s[1],s[2])},LineString:function(s,e){kp(s.coordinates,e,0)},MultiLineString:function(s,e){for(var n=s.coordinates,r=-1,a=n.length;++r<a;)kp(n[r],e,0)},Polygon:function(s,e){d_(s.coordinates,e)},MultiPolygon:function(s,e){for(var n=s.coordinates,r=-1,a=n.length;++r<a;)d_(n[r],e)},GeometryCollection:function(s,e){for(var n=s.geometries,r=-1,a=n.length;++r<a;)Bf(n[r],e)}};function kp(s,e,n){var r=-1,a=s.length-n,h;for(e.lineStart();++r<a;)h=s[r],e.point(h[0],h[1],h[2]);e.lineEnd()}function d_(s,e){var n=-1,r=s.length;for(e.polygonStart();++n<r;)kp(s[n],e,1);e.polygonEnd()}function Ew(s,e){s&&h_.hasOwnProperty(s.type)?h_[s.type](s,e):Bf(s,e)}kl();kl();function Ip(s){return[rc(s[1],s[0]),su(s[2])]}function sc(s){var e=s[0],n=s[1],r=nr(n);return[r*nr(e),r*ir(e),ir(n)]}function vf(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Uf(s,e){return[s[1]*e[2]-s[2]*e[1],s[2]*e[0]-s[0]*e[2],s[0]*e[1]-s[1]*e[0]]}function op(s,e){s[0]+=e[0],s[1]+=e[1],s[2]+=e[2]}function bf(s,e){return[s[0]*e,s[1]*e,s[2]*e]}function Sp(s){var e=fc(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);s[0]/=e,s[1]/=e,s[2]/=e}kl();function mv(s,e){function n(r,a){return r=s(r,a),e(r[0],r[1])}return s.invert&&e.invert&&(n.invert=function(r,a){return r=e.invert(r,a),r&&s.invert(r[0],r[1])}),n}function Ep(s,e){return[s>di?s-oa:s<-di?s+oa:s,e]}Ep.invert=Ep;function Aw(s,e,n){return(s%=oa)?e||n?mv(m_(s),g_(e,n)):m_(s):e||n?g_(e,n):Ep}function p_(s){return function(e,n){return e+=s,[e>di?e-oa:e<-di?e+oa:e,n]}}function m_(s){var e=p_(s);return e.invert=p_(-s),e}function g_(s,e){var n=nr(s),r=ir(s),a=nr(e),h=ir(e);function m(l,x){var S=nr(x),T=nr(l)*S,C=ir(l)*S,N=ir(x),B=N*n+T*r;return[rc(C*a-B*h,T*n-N*r),su(B*a+C*h)]}return m.invert=function(l,x){var S=nr(x),T=nr(l)*S,C=ir(l)*S,N=ir(x),B=N*a-C*h;return[rc(C*a+N*h,T*n+B*r),su(B*n-T*r)]},m}function Tw(s,e,n,r,a,h){if(n){var m=nr(e),l=ir(e),x=r*n;a==null?(a=e+r*oa,h=e-x/2):(a=__(m,a),h=__(m,h),(r>0?a<h:a>h)&&(a+=r*oa));for(var S,T=a;r>0?T>h:T<h;T-=x)S=Ip([m,-l*nr(T),-l*ir(T)]),s.point(S[0],S[1])}}function __(s,e){e=sc(e),e[0]-=s,Sp(e);var n=pv(-e[1]);return((-e[2]<0?-n:n)+oa-zi)%oa}function gv(){var s=[],e;return{point:function(n,r){e.push([n,r])},lineStart:function(){s.push(e=[])},lineEnd:mh,rejoin:function(){s.length>1&&s.push(s.pop().concat(s.shift()))},result:function(){var n=s;return s=[],e=null,n}}}function Cw(s,e,n,r,a,h){var m=s[0],l=s[1],x=e[0],S=e[1],T=0,C=1,N=x-m,B=S-l,U;if(U=n-m,!(!N&&U>0)){if(U/=N,N<0){if(U<T)return;U<C&&(C=U)}else if(N>0){if(U>C)return;U>T&&(T=U)}if(U=a-m,!(!N&&U<0)){if(U/=N,N<0){if(U>C)return;U>T&&(T=U)}else if(N>0){if(U<T)return;U<C&&(C=U)}if(U=r-l,!(!B&&U>0)){if(U/=B,B<0){if(U<T)return;U<C&&(C=U)}else if(B>0){if(U>C)return;U>T&&(T=U)}if(U=h-l,!(!B&&U<0)){if(U/=B,B<0){if(U>C)return;U>T&&(T=U)}else if(B>0){if(U<T)return;U<C&&(C=U)}return T>0&&(s[0]=m+T*N,s[1]=l+T*B),C<1&&(e[0]=m+C*N,e[1]=l+C*B),!0}}}}}function Cf(s,e){return Vr(s[0]-e[0])<zi&&Vr(s[1]-e[1])<zi}function xf(s,e,n,r){this.x=s,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function _v(s,e,n,r,a){var h=[],m=[],l,x;if(s.forEach(function(U){if(!((ee=U.length-1)<=0)){var ee,ie=U[0],se=U[ee],Q;if(Cf(ie,se)){for(a.lineStart(),l=0;l<ee;++l)a.point((ie=U[l])[0],ie[1]);a.lineEnd();return}h.push(Q=new xf(ie,U,null,!0)),m.push(Q.o=new xf(ie,null,Q,!1)),h.push(Q=new xf(se,U,null,!1)),m.push(Q.o=new xf(se,null,Q,!0))}}),!!h.length){for(m.sort(e),y_(h),y_(m),l=0,x=m.length;l<x;++l)m[l].e=n=!n;for(var S=h[0],T,C;;){for(var N=S,B=!0;N.v;)if((N=N.n)===S)return;T=N.z,a.lineStart();do{if(N.v=N.o.v=!0,N.e){if(B)for(l=0,x=T.length;l<x;++l)a.point((C=T[l])[0],C[1]);else r(N.x,N.n.x,1,a);N=N.n}else{if(B)for(T=N.p.z,l=T.length-1;l>=0;--l)a.point((C=T[l])[0],C[1]);else r(N.x,N.p.x,-1,a);N=N.p}N=N.o,T=N.z,B=!B}while(!N.v);a.lineEnd()}}}function y_(s){if(e=s.length){for(var e,n=0,r=s[0],a;++n<e;)r.n=a=s[n],a.p=r,r=a;r.n=a=s[0],a.p=r}}function yv(s,e){return s<e?-1:s>e?1:s>=e?0:NaN}function Lw(s){return s.length===1&&(s=Mw(s)),{left:function(e,n,r,a){for(r==null&&(r=0),a==null&&(a=e.length);r<a;){var h=r+a>>>1;s(e[h],n)<0?r=h+1:a=h}return r},right:function(e,n,r,a){for(r==null&&(r=0),a==null&&(a=e.length);r<a;){var h=r+a>>>1;s(e[h],n)>0?a=h:r=h+1}return r}}}function Mw(s){return function(e,n){return yv(s(e),n)}}Lw(yv);function vv(s){for(var e=s.length,n,r=-1,a=0,h,m;++r<e;)a+=s[r].length;for(h=new Array(a);--e>=0;)for(m=s[e],n=m.length;--n>=0;)h[--a]=m[n];return h}var gh=1e9,wf=-gh;function Rw(s,e,n,r){function a(S,T){return s<=S&&S<=n&&e<=T&&T<=r}function h(S,T,C,N){var B=0,U=0;if(S==null||(B=m(S,C))!==(U=m(T,C))||x(S,T)<0^C>0)do N.point(B===0||B===3?s:n,B>1?r:e);while((B=(B+C+4)%4)!==U);else N.point(T[0],T[1])}function m(S,T){return Vr(S[0]-s)<zi?T>0?0:3:Vr(S[0]-n)<zi?T>0?2:1:Vr(S[1]-e)<zi?T>0?1:0:T>0?3:2}function l(S,T){return x(S.x,T.x)}function x(S,T){var C=m(S,1),N=m(T,1);return C!==N?C-N:C===0?T[1]-S[1]:C===1?S[0]-T[0]:C===2?S[1]-T[1]:T[0]-S[0]}return function(S){var T=S,C=gv(),N,B,U,ee,ie,se,Q,K,pe,ve,De,he={point:xe,lineStart:ye,lineEnd:Ue,polygonStart:Ce,polygonEnd:we};function xe(pt,St){a(pt,St)&&T.point(pt,St)}function be(){for(var pt=0,St=0,dt=B.length;St<dt;++St)for(var ut=B[St],Bt=1,vt=ut.length,wt=ut[0],ft,xt,It=wt[0],Yt=wt[1];Bt<vt;++Bt)ft=It,xt=Yt,wt=ut[Bt],It=wt[0],Yt=wt[1],xt<=r?Yt>r&&(It-ft)*(r-xt)>(Yt-xt)*(s-ft)&&++pt:Yt<=r&&(It-ft)*(r-xt)<(Yt-xt)*(s-ft)&&--pt;return pt}function Ce(){T=C,N=[],B=[],De=!0}function we(){var pt=be(),St=De&&pt,dt=(N=vv(N)).length;(St||dt)&&(S.polygonStart(),St&&(S.lineStart(),h(null,null,1,S),S.lineEnd()),dt&&_v(N,l,pt,h,S),S.polygonEnd()),T=S,N=B=U=null}function ye(){he.point=qe,B&&B.push(U=[]),ve=!0,pe=!1,Q=K=NaN}function Ue(){N&&(qe(ee,ie),se&&pe&&C.rejoin(),N.push(C.result())),he.point=xe,pe&&T.lineEnd()}function qe(pt,St){var dt=a(pt,St);if(B&&U.push([pt,St]),ve)ee=pt,ie=St,se=dt,ve=!1,dt&&(T.lineStart(),T.point(pt,St));else if(dt&&pe)T.point(pt,St);else{var ut=[Q=Math.max(wf,Math.min(gh,Q)),K=Math.max(wf,Math.min(gh,K))],Bt=[pt=Math.max(wf,Math.min(gh,pt)),St=Math.max(wf,Math.min(gh,St))];Cw(ut,Bt,s,e,n,r)?(pe||(T.lineStart(),T.point(ut[0],ut[1])),T.point(Bt[0],Bt[1]),dt||T.lineEnd(),De=!1):dt&&(T.lineStart(),T.point(pt,St),De=!1)}Q=pt,K=St,pe=dt}return he}}var ap=kl();function Pw(s,e){var n=e[0],r=e[1],a=[ir(n),-nr(n),0],h=0,m=0;ap.reset();for(var l=0,x=s.length;l<x;++l)if(T=(S=s[l]).length)for(var S,T,C=S[T-1],N=C[0],B=C[1]/2+c_,U=ir(B),ee=nr(B),ie=0;ie<T;++ie,N=Q,U=pe,ee=ve,C=se){var se=S[ie],Q=se[0],K=se[1]/2+c_,pe=ir(K),ve=nr(K),De=Q-N,he=De>=0?1:-1,xe=he*De,be=xe>di,Ce=U*pe;if(ap.add(rc(Ce*he*ir(xe),ee*ve+Ce*nr(xe))),h+=be?De+he*oa:De,be^N>=n^Q>=n){var we=Uf(sc(C),sc(se));Sp(we);var ye=Uf(a,we);Sp(ye);var Ue=(be^De>=0?-1:1)*su(ye[2]);(r>Ue||r===Ue&&(we[0]||we[1]))&&(m+=be^De>=0?1:-1)}}return(h<-zi||h<zi&&ap<-zi)^m&1}kl();function v_(s){return s}kl();kl();var oc=1/0,jf=oc,Mh=-oc,qf=Mh,b_={point:Dw,lineStart:mh,lineEnd:mh,polygonStart:mh,polygonEnd:mh,result:function(){var s=[[oc,jf],[Mh,qf]];return Mh=qf=-(jf=oc=1/0),s}};function Dw(s,e){s<oc&&(oc=s),s>Mh&&(Mh=s),e<jf&&(jf=e),e>qf&&(qf=e)}kl();function bv(s,e,n,r){return function(a,h){var m=e(h),l=a.invert(r[0],r[1]),x=gv(),S=e(x),T=!1,C,N,B,U={point:ee,lineStart:se,lineEnd:Q,polygonStart:function(){U.point=K,U.lineStart=pe,U.lineEnd=ve,N=[],C=[]},polygonEnd:function(){U.point=ee,U.lineStart=se,U.lineEnd=Q,N=vv(N);var De=Pw(C,l);N.length?(T||(h.polygonStart(),T=!0),_v(N,zw,De,n,h)):De&&(T||(h.polygonStart(),T=!0),h.lineStart(),n(null,null,1,h),h.lineEnd()),T&&(h.polygonEnd(),T=!1),N=C=null},sphere:function(){h.polygonStart(),h.lineStart(),n(null,null,1,h),h.lineEnd(),h.polygonEnd()}};function ee(De,he){var xe=a(De,he);s(De=xe[0],he=xe[1])&&h.point(De,he)}function ie(De,he){var xe=a(De,he);m.point(xe[0],xe[1])}function se(){U.point=ie,m.lineStart()}function Q(){U.point=ee,m.lineEnd()}function K(De,he){B.push([De,he]);var xe=a(De,he);S.point(xe[0],xe[1])}function pe(){S.lineStart(),B=[]}function ve(){K(B[0][0],B[0][1]),S.lineEnd();var De=S.clean(),he=x.result(),xe,be=he.length,Ce,we,ye;if(B.pop(),C.push(B),B=null,!!be){if(De&1){if(we=he[0],(Ce=we.length-1)>0){for(T||(h.polygonStart(),T=!0),h.lineStart(),xe=0;xe<Ce;++xe)h.point((ye=we[xe])[0],ye[1]);h.lineEnd()}return}be>1&&De&2&&he.push(he.pop().concat(he.shift())),N.push(he.filter(Nw))}}return U}}function Nw(s){return s.length>1}function zw(s,e){return((s=s.x)[0]<0?s[1]-sa-zi:sa-s[1])-((e=e.x)[0]<0?e[1]-sa-zi:sa-e[1])}const x_=bv(function(){return!0},Fw,Bw,[-di,-sa]);function Fw(s){var e=NaN,n=NaN,r=NaN,a;return{lineStart:function(){s.lineStart(),a=1},point:function(h,m){var l=h>0?di:-di,x=Vr(h-e);Vr(x-di)<zi?(s.point(e,n=(n+m)/2>0?sa:-sa),s.point(r,n),s.lineEnd(),s.lineStart(),s.point(l,n),s.point(h,n),a=0):r!==l&&x>=di&&(Vr(e-r)<zi&&(e-=r*zi),Vr(h-l)<zi&&(h-=l*zi),n=Ow(e,n,h,m),s.point(r,n),s.lineEnd(),s.lineStart(),s.point(l,n),a=0),s.point(e=h,n=m),r=l},lineEnd:function(){s.lineEnd(),e=n=NaN},clean:function(){return 2-a}}}function Ow(s,e,n,r){var a,h,m=ir(s-n);return Vr(m)>zi?Sw((ir(e)*(h=nr(r))*ir(n)-ir(r)*(a=nr(e))*ir(s))/(a*h*m)):(e+r)/2}function Bw(s,e,n,r){var a;if(s==null)a=n*sa,r.point(-di,a),r.point(0,a),r.point(di,a),r.point(di,0),r.point(di,-a),r.point(0,-a),r.point(-di,-a),r.point(-di,0),r.point(-di,a);else if(Vr(s[0]-e[0])>zi){var h=s[0]<e[0]?di:-di;a=n*h/2,r.point(-h,a),r.point(0,a),r.point(h,a)}else r.point(e[0],e[1])}function Uw(s,e){var n=nr(s),r=n>0,a=Vr(n)>zi;function h(T,C,N,B){Tw(B,s,e,N,T,C)}function m(T,C){return nr(T)*nr(C)>n}function l(T){var C,N,B,U,ee;return{lineStart:function(){U=B=!1,ee=1},point:function(ie,se){var Q=[ie,se],K,pe=m(ie,se),ve=r?pe?0:S(ie,se):pe?S(ie+(ie<0?di:-di),se):0;if(!C&&(U=B=pe)&&T.lineStart(),pe!==B&&(K=x(C,Q),(!K||Cf(C,K)||Cf(Q,K))&&(Q[0]+=zi,Q[1]+=zi,pe=m(Q[0],Q[1]))),pe!==B)ee=0,pe?(T.lineStart(),K=x(Q,C),T.point(K[0],K[1])):(K=x(C,Q),T.point(K[0],K[1]),T.lineEnd()),C=K;else if(a&&C&&r^pe){var De;!(ve&N)&&(De=x(Q,C,!0))&&(ee=0,r?(T.lineStart(),T.point(De[0][0],De[0][1]),T.point(De[1][0],De[1][1]),T.lineEnd()):(T.point(De[1][0],De[1][1]),T.lineEnd(),T.lineStart(),T.point(De[0][0],De[0][1])))}pe&&(!C||!Cf(C,Q))&&T.point(Q[0],Q[1]),C=Q,B=pe,N=ve},lineEnd:function(){B&&T.lineEnd(),C=null},clean:function(){return ee|(U&&B)<<1}}}function x(T,C,N){var B=sc(T),U=sc(C),ee=[1,0,0],ie=Uf(B,U),se=vf(ie,ie),Q=ie[0],K=se-Q*Q;if(!K)return!N&&T;var pe=n*se/K,ve=-n*Q/K,De=Uf(ee,ie),he=bf(ee,pe),xe=bf(ie,ve);op(he,xe);var be=De,Ce=vf(he,be),we=vf(be,be),ye=Ce*Ce-we*(vf(he,he)-1);if(!(ye<0)){var Ue=fc(ye),qe=bf(be,(-Ce-Ue)/we);if(op(qe,he),qe=Ip(qe),!N)return qe;var pt=T[0],St=C[0],dt=T[1],ut=C[1],Bt;St<pt&&(Bt=pt,pt=St,St=Bt);var vt=St-pt,wt=Vr(vt-di)<zi,ft=wt||vt<zi;if(!wt&&ut<dt&&(Bt=dt,dt=ut,ut=Bt),ft?wt?dt+ut>0^qe[1]<(Vr(qe[0]-pt)<zi?dt:ut):dt<=qe[1]&&qe[1]<=ut:vt>di^(pt<=qe[0]&&qe[0]<=St)){var xt=bf(be,(-Ce+Ue)/we);return op(xt,he),[qe,Ip(xt)]}}}function S(T,C){var N=r?s:di-s,B=0;return T<-N?B|=1:T>N&&(B|=2),C<-N?B|=4:C>N&&(B|=8),B}return bv(m,l,h,r?[0,-s]:[-di,s-di])}function xv(s){return function(e){var n=new Ap;for(var r in s)n[r]=s[r];return n.stream=e,n}}function Ap(){}Ap.prototype={constructor:Ap,point:function(s,e){this.stream.point(s,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function wv(s,e,n){var r=e[1][0]-e[0][0],a=e[1][1]-e[0][1],h=s.clipExtent&&s.clipExtent();s.scale(150).translate([0,0]),h!=null&&s.clipExtent(null),Ew(n,s.stream(b_));var m=b_.result(),l=Math.min(r/(m[1][0]-m[0][0]),a/(m[1][1]-m[0][1])),x=+e[0][0]+(r-l*(m[1][0]+m[0][0]))/2,S=+e[0][1]+(a-l*(m[1][1]+m[0][1]))/2;return h!=null&&s.clipExtent(h),s.scale(l*150).translate([x,S])}function jw(s,e,n){return wv(s,[[0,0],e],n)}var w_=16,qw=nr(30*mo);function k_(s,e){return+e?Gw(s,e):Vw(s)}function Vw(s){return xv({point:function(e,n){e=s(e,n),this.stream.point(e[0],e[1])}})}function Gw(s,e){function n(r,a,h,m,l,x,S,T,C,N,B,U,ee,ie){var se=S-r,Q=T-a,K=se*se+Q*Q;if(K>4*e&&ee--){var pe=m+N,ve=l+B,De=x+U,he=fc(pe*pe+ve*ve+De*De),xe=su(De/=he),be=Vr(Vr(De)-1)<zi||Vr(h-C)<zi?(h+C)/2:rc(ve,pe),Ce=s(be,xe),we=Ce[0],ye=Ce[1],Ue=we-r,qe=ye-a,pt=Q*Ue-se*qe;(pt*pt/K>e||Vr((se*Ue+Q*qe)/K-.5)>.3||m*N+l*B+x*U<qw)&&(n(r,a,h,m,l,x,we,ye,be,pe/=he,ve/=he,De,ee,ie),ie.point(we,ye),n(we,ye,be,pe,ve,De,S,T,C,N,B,U,ee,ie))}}return function(r){var a,h,m,l,x,S,T,C,N,B,U,ee,ie={point:se,lineStart:Q,lineEnd:pe,polygonStart:function(){r.polygonStart(),ie.lineStart=ve},polygonEnd:function(){r.polygonEnd(),ie.lineStart=Q}};function se(xe,be){xe=s(xe,be),r.point(xe[0],xe[1])}function Q(){C=NaN,ie.point=K,r.lineStart()}function K(xe,be){var Ce=sc([xe,be]),we=s(xe,be);n(C,N,T,B,U,ee,C=we[0],N=we[1],T=xe,B=Ce[0],U=Ce[1],ee=Ce[2],w_,r),r.point(C,N)}function pe(){ie.point=se,r.lineEnd()}function ve(){Q(),ie.point=De,ie.lineEnd=he}function De(xe,be){K(a=xe,be),h=C,m=N,l=B,x=U,S=ee,ie.point=K}function he(){n(C,N,T,B,U,ee,h,m,a,l,x,S,w_,r),ie.lineEnd=pe,pe()}return ie}}var Zw=xv({point:function(s,e){this.stream.point(s*mo,e*mo)}});function Hw(s){return Xw(function(){return s})()}function Xw(s){var e,n=150,r=480,a=250,h,m,l=0,x=0,S=0,T=0,C=0,N,B,U=null,ee=x_,ie=null,se,Q,K,pe=v_,ve=.5,De=k_(we,ve),he,xe;function be(qe){return qe=B(qe[0]*mo,qe[1]*mo),[qe[0]*n+h,m-qe[1]*n]}function Ce(qe){return qe=B.invert((qe[0]-h)/n,(m-qe[1])/n),qe&&[qe[0]*pl,qe[1]*pl]}function we(qe,pt){return qe=e(qe,pt),[qe[0]*n+h,m-qe[1]*n]}be.stream=function(qe){return he&&xe===qe?he:he=Zw(ee(N,De(pe(xe=qe))))},be.clipAngle=function(qe){return arguments.length?(ee=+qe?Uw(U=qe*mo,6*mo):(U=null,x_),Ue()):U*pl},be.clipExtent=function(qe){return arguments.length?(pe=qe==null?(ie=se=Q=K=null,v_):Rw(ie=+qe[0][0],se=+qe[0][1],Q=+qe[1][0],K=+qe[1][1]),Ue()):ie==null?null:[[ie,se],[Q,K]]},be.scale=function(qe){return arguments.length?(n=+qe,ye()):n},be.translate=function(qe){return arguments.length?(r=+qe[0],a=+qe[1],ye()):[r,a]},be.center=function(qe){return arguments.length?(l=qe[0]%360*mo,x=qe[1]%360*mo,ye()):[l*pl,x*pl]},be.rotate=function(qe){return arguments.length?(S=qe[0]%360*mo,T=qe[1]%360*mo,C=qe.length>2?qe[2]%360*mo:0,ye()):[S*pl,T*pl,C*pl]},be.precision=function(qe){return arguments.length?(De=k_(we,ve=qe*qe),Ue()):fc(ve)},be.fitExtent=function(qe,pt){return wv(be,qe,pt)},be.fitSize=function(qe,pt){return jw(be,qe,pt)};function ye(){B=mv(N=Aw(S,T,C),e);var qe=e(l,x);return h=r-qe[0]*n,m=a+qe[1]*n,Ue()}function Ue(){return he=xe=null,be}return function(){return e=s.apply(this,arguments),be.invert=e.invert&&Ce,ye()}}function kv(s){return function(e,n){var r=nr(e),a=nr(n),h=s(r*a);return[h*a*ir(e),h*ir(n)]}}function Iv(s){return function(e,n){var r=fc(e*e+n*n),a=s(r),h=ir(a),m=nr(a);return[rc(e*h,r*m),su(r&&n*h/r)]}}var Ww=kv(function(s){return fc(2/(1+s))});Ww.invert=Iv(function(s){return 2*su(s/2)});var Sv=kv(function(s){return(s=pv(s))&&s/ir(s)});Sv.invert=Iv(function(s){return s});function Kw(){return Hw(Sv).scale(79.4188).clipAngle(180-.001)}function I_(s,e){return[s,e]}I_.invert=I_;var{BufferOp:$w,GeoJSONReader:Yw,GeoJSONWriter:Jw}=Iw;function Qw(s,e,n){n=n||{};var r=n.units||"kilometers",a=n.steps||8;if(!s)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var h=[];switch(s.type){case"GeometryCollection":return id(s,function(m){var l=Lf(m,e,r,a);l&&h.push(l)}),ru(h);case"FeatureCollection":return l_(s,function(m){var l=Lf(m,e,r,a);l&&l_(l,function(x){x&&h.push(x)})}),ru(h)}return Lf(s,e,r,a)}function Lf(s,e,n,r){var a=s.properties||{},h=s.type==="Feature"?s.geometry:s;if(h.type==="GeometryCollection"){var m=[];return id(s,function(ee){var ie=Lf(ee,e,n,r);ie&&m.push(ie)}),ru(m)}var l=e2(h),x={type:h.type,coordinates:Av(h.coordinates,l)},S=new Yw,T=S.read(x),C=jx(qx(e,n),"meters"),N=$w.bufferOp(T,C,r),B=new Jw;if(N=B.write(N),!Ev(N.coordinates)){var U={type:N.type,coordinates:Tv(N.coordinates,l)};return zh(U,a)}}function Ev(s){return Array.isArray(s[0])?Ev(s[0]):isNaN(s[0])}function Av(s,e){return typeof s[0]!="object"?e(s):s.map(function(n){return Av(n,e)})}function Tv(s,e){return typeof s[0]!="object"?e.invert(s):s.map(function(n){return Tv(n,e)})}function e2(s){var e=bw(s).geometry.coordinates,n=[-e[0],-e[1]];return Kw().rotate(n).scale(Bs)}var t2=Qw;function n2(s){const e=[];if(id(s,a=>{e.push(a.coordinates)}),e.length<2)throw new Error("Must have at least two features");const n=s.features[0].properties||{},r=hv.difference(e[0],...e.slice(1));return r.length===0?null:r.length===1?qp(r[0],n):uv(r,n)}var i2=n2;function S_(s){let e;for(const n of s)e&&n[0]-e[0]>=180?n[0]-=360:e&&n[0]-e[0]<-180&&(n[0]+=360),e=n}function E_(s,e){const n=i2(ru([qp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),s]));if(!n)return;n.properties={isMask:"y"};const r=t2(s,0);if(r){if(r.geometry.type==="Polygon")for(const a of r.geometry.coordinates)S_(a);else for(const a of r.geometry.coordinates)for(const h of a)S_(h);e(ru([r,n]))}}const A_=ru([]);function r2(s,e,n=!0,r=!0,a={},h={},m={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let l;const x=[];let S,T,C;function N(){!s.getSource("full-geom")&&(m!=null&&m.fill||m!=null&&m.line)&&s.addSource("full-geom",{type:"geojson",data:A_}),!s.getLayer("full-geom-fill")&&m!=null&&m.fill&&s.addLayer({...m==null?void 0:m.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),!s.getLayer("full-geom-line")&&m!=null&&m.line&&s.addLayer({...m==null?void 0:m.line,id:"full-geom-line",type:"line",source:"full-geom"}),C&&ee(C)}s.loaded()?N():s.once("load",()=>{N()}),s.on("styledata",()=>{N()});const B=ie=>{l==null||l({type:"mapClick",coordinates:[ie.lngLat.lng,ie.lngLat.lat]})};function U(ie=!1){if(!e)throw new Error;const se=document.createElement("div");return ie&&se.classList.add("marker-interactive"),new Px({props:{displayIn:"maplibre"},target:se}),new e.Marker({element:se,offset:[1,-13]})}function ee(ie){var se;C=ie,(se=s.getSource("full-geom"))==null||se.setData(ie)}return{setEventHandler(ie){ie?(l=ie,s.on("click",B)):(l=void 0,s.off("click",B))},flyTo(ie,se){s.flyTo({center:ie,zoom:se,...a})},fitBounds(ie,se,Q){s.fitBounds([[ie[0],ie[1]],[ie[2],ie[3]]],{padding:se,maxZoom:Q,...h})},indicateReverse(ie){s.getCanvasContainer().style.cursor=ie?"crosshair":""},setReverseMarker(ie){!e||!n||(T?ie?T.setLngLat(ie):(T.remove(),T=void 0):ie&&(T=(typeof n=="object"?new e.Marker(n):U()).setLngLat(ie).addTo(s),T.getElement().classList.add("marker-reverse")))},setMarkers(ie,se){if(n){for(const Q of x)Q.remove();if(x.length=0,ee(A_),!!e){if(se){let Q=!1;if(se.geometry.type==="GeometryCollection"){const K=se.geometry.geometries.filter(pe=>pe.type==="Polygon"||pe.type==="MultiPolygon");e:if(K.length>0){const pe=yw(ru(K.map(ve=>zh(ve))));if(!pe)break e;E_({...se,geometry:pe.geometry},ee),Q=!0}else{const pe=se.geometry.geometries.filter(ve=>ve.type==="LineString"||ve.type==="MultiLineString");pe.length>0&&(ee({...se,geometry:{type:"GeometryCollection",geometries:pe}}),Q=!0)}}if(!Q){if(se.geometry.type==="Polygon"||se.geometry.type==="MultiPolygon")E_(se,ee);else if(se.geometry.type==="LineString"||se.geometry.type==="MultiLineString"){ee(se);return}}n&&x.push((typeof n=="object"?new e.Marker(n):U()).setLngLat(se.center).addTo(s))}if(r)for(const Q of ie??[]){if(Q===se)continue;const K=(typeof r=="object"?new e.Marker(r):U(!0)).setLngLat(Q.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Q.place_type[0]==="reverse"?Q.place_name:Q.place_name.replace(/,.*/,""))).addTo(s),pe=K.getElement();pe.addEventListener("click",ve=>{ve.stopPropagation(),l==null||l({type:"markerClick",id:Q.id})}),pe.addEventListener("mouseenter",()=>{l==null||l({type:"markerMouseEnter",id:Q.id}),K.togglePopup()}),pe.addEventListener("mouseleave",()=>{l==null||l({type:"markerMouseLeave",id:Q.id}),K.togglePopup()}),x.push(K)}}}},setSelectedMarker(ie){S&&S.getElement().classList.toggle("marker-selected",!1),S=ie>-1?x[ie]:void 0,S==null||S.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const ie=s.getCenter();return[s.getZoom(),ie.lng,ie.lat]}}}function s2(s){let e,n;return{c(){e=Da("svg"),n=Da("path"),Ze(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ze(e,"viewBox","0 0 14 14"),Ze(e,"width","13"),Ze(e,"height","13"),Ze(e,"class","svelte-en2qvf")},m(r,a){ae(r,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(r){r&&oe(e)}}}class Cv extends fn{constructor(e){super(),hn(this,e,null,s2,an,{})}}function o2(s){let e,n;return{c(){e=Da("svg"),n=Da("path"),Ze(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ze(e,"viewBox","0 0 30 30"),Ze(e,"fill","none"),Ze(e,"xmlns","http://www.w3.org/2000/svg"),Ze(e,"class","svelte-d2loi5")},m(r,a){ae(r,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(r){r&&oe(e)}}}class Lv extends fn{constructor(e){super(),hn(this,e,null,o2,an,{})}}function a2(s){let e,n;return{c(){e=ue("img"),Yr(e.src,n=s[3]+"area.svg")||Ze(e,"src",n),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){ae(r,e,a)},p(r,a){a&8&&!Yr(e.src,n=r[3]+"area.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",r[6])},d(r){r&&oe(e)}}}function l2(s){let e,n;return{c(){e=ue("img"),Yr(e.src,n=s[3]+"reverse.svg")||Ze(e,"src",n),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){ae(r,e,a)},p(r,a){a&8&&!Yr(e.src,n=r[3]+"reverse.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",r[6])},d(r){r&&oe(e)}}}function u2(s){let e,n;return{c(){e=ue("img"),Yr(e.src,n=s[3]+"poi.svg")||Ze(e,"src",n),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){ae(r,e,a)},p(r,a){a&8&&!Yr(e.src,n=r[3]+"poi.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",r[6])},d(r){r&&oe(e)}}}function c2(s){let e,n;return{c(){e=ue("img"),Yr(e.src,n=s[3]+"postal_code.svg")||Ze(e,"src",n),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){ae(r,e,a)},p(r,a){a&8&&!Yr(e.src,n=r[3]+"postal_code.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",r[6])},d(r){r&&oe(e)}}}function h2(s){let e,n;return{c(){e=ue("img"),Yr(e.src,n=s[3]+"street.svg")||Ze(e,"src",n),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){ae(r,e,a)},p(r,a){a&8&&!Yr(e.src,n=r[3]+"street.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",r[6])},d(r){r&&oe(e)}}}function f2(s){let e,n;return{c(){e=ue("img"),Yr(e.src,n=s[3]+"road.svg")||Ze(e,"src",n),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){ae(r,e,a)},p(r,a){a&8&&!Yr(e.src,n=r[3]+"road.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",r[6])},d(r){r&&oe(e)}}}function d2(s){let e,n;return{c(){e=ue("img"),Yr(e.src,n=s[3]+"housenumber.svg")||Ze(e,"src",n),Ze(e,"alt",s[6]),Ze(e,"class","svelte-ltkwvy")},m(r,a){ae(r,e,a)},p(r,a){a&8&&!Yr(e.src,n=r[3]+"housenumber.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",r[6])},d(r){r&&oe(e)}}}function p2(s){let e,n,r,a;return{c(){e=ue("img"),Yr(e.src,n=s[5])||Ze(e,"src",n),Ze(e,"alt",s[4]),Ze(e,"class","svelte-ltkwvy")},m(h,m){ae(h,e,m),r||(a=Rt(e,"error",s[14]),r=!0)},p(h,m){m&32&&!Yr(e.src,n=h[5])&&Ze(e,"src",n),m&16&&Ze(e,"alt",h[4])},d(h){h&&oe(e),r=!1,a()}}}function T_(s){let e,n;return{c(){e=ue("span"),n=Fe(s[6]),Ze(e,"class","secondary svelte-ltkwvy")},m(r,a){ae(r,e,a),Z(e,n)},p(r,a){a&64&&Lt(n,r[6])},d(r){r&&oe(e)}}}function m2(s){var he,xe;let e,n,r,a,h,m,l,x,S=(s[7]?s[0].place_name:s[0].place_name.replace(/,.*/,""))+"",T,C,N=s[2]==="always"||s[2]&&!s[0].address&&((he=s[0].properties)==null?void 0:he.kind)!=="road"&&((xe=s[0].properties)==null?void 0:xe.kind)!=="road_relation"&&!s[0].id.startsWith("address.")&&!s[0].id.startsWith("postal_code.")&&(!s[0].id.startsWith("poi.")||!s[5])&&!s[7],B,U,ee=(s[7]?"":s[0].place_name.replace(/[^,]*,?\s*/,""))+"",ie,se,Q;function K(be,Ce){var we,ye;return Ce&1&&(n=null),Ce&1&&(r=null),Ce&1&&(a=null),be[5]?p2:be[0].address?d2:((we=be[0].properties)==null?void 0:we.kind)==="road"||((ye=be[0].properties)==null?void 0:ye.kind)==="road_relation"?f2:(n==null&&(n=!!be[0].id.startsWith("address.")),n?h2:(r==null&&(r=!!be[0].id.startsWith("postal_code.")),r?c2:(a==null&&(a=!!be[0].id.startsWith("poi.")),a?u2:be[7]?l2:a2)))}let pe=K(s,-1),ve=pe(s),De=N&&T_(s);return{c(){e=ue("li"),ve.c(),h=Oe(),m=ue("span"),l=ue("span"),x=ue("span"),T=Fe(S),C=Oe(),De&&De.c(),B=Oe(),U=ue("span"),ie=Fe(ee),Ze(x,"class","primary svelte-ltkwvy"),Ze(l,"class","svelte-ltkwvy"),Ze(U,"class","line2 svelte-ltkwvy"),Ze(m,"class","texts svelte-ltkwvy"),Ze(e,"tabindex","0"),Ze(e,"data-selected",s[1]),Ze(e,"class","svelte-ltkwvy"),Sr(e,"selected",s[1])},m(be,Ce){ae(be,e,Ce),ve.m(e,null),Z(e,h),Z(e,m),Z(m,l),Z(l,x),Z(x,T),Z(l,C),De&&De.m(l,null),Z(m,B),Z(m,U),Z(U,ie),se||(Q=[Rt(e,"mouseenter",s[12]),Rt(e,"focus",s[13])],se=!0)},p(be,[Ce]){var we,ye;pe===(pe=K(be,Ce))&&ve?ve.p(be,Ce):(ve.d(1),ve=pe(be),ve&&(ve.c(),ve.m(e,h))),Ce&1&&S!==(S=(be[7]?be[0].place_name:be[0].place_name.replace(/,.*/,""))+"")&&Lt(T,S),Ce&37&&(N=be[2]==="always"||be[2]&&!be[0].address&&((we=be[0].properties)==null?void 0:we.kind)!=="road"&&((ye=be[0].properties)==null?void 0:ye.kind)!=="road_relation"&&!be[0].id.startsWith("address.")&&!be[0].id.startsWith("postal_code.")&&(!be[0].id.startsWith("poi.")||!be[5])&&!be[7]),N?De?De.p(be,Ce):(De=T_(be),De.c(),De.m(l,null)):De&&(De.d(1),De=null),Ce&1&&ee!==(ee=(be[7]?"":be[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Lt(ie,ee),Ce&2&&Ze(e,"data-selected",be[1]),Ce&2&&Sr(e,"selected",be[1])},i:tt,o:tt,d(be){be&&oe(e),ve.d(),De&&De.d(),se=!1,Ki(Q)}}}function g2(s,e,n){var K;let r,a,{feature:h}=e,{selected:m=!1}=e,{showPlaceType:l}=e,{missingIconsCache:x}=e,{iconsBaseUrl:S}=e;const T=(K=h.properties)==null?void 0:K.categories;let C,N,B=0,U=h.place_type[0]==="reverse";function ee(){N&&x.add(N),n(10,B++,B)}function ie(pe){ur.call(this,s,pe)}function se(pe){ur.call(this,s,pe)}const Q=()=>ee();return s.$$set=pe=>{"feature"in pe&&n(0,h=pe.feature),"selected"in pe&&n(1,m=pe.selected),"showPlaceType"in pe&&n(2,l=pe.showPlaceType),"missingIconsCache"in pe&&n(9,x=pe.missingIconsCache),"iconsBaseUrl"in pe&&n(3,S=pe.iconsBaseUrl)},s.$$.update=()=>{var pe,ve,De,he;if(s.$$.dirty&3640)do n(11,r--,r),n(4,C=T==null?void 0:T[r]),n(5,N=C?S+C.replace(/ /g,"_")+".svg":void 0);while(r>-1&&(!N||x.has(N)));s.$$.dirty&1&&n(6,a=h.id.startsWith("poi.")?(ve=(pe=h.properties)==null?void 0:pe.categories)==null?void 0:ve.join(", "):((he=(De=h.properties)==null?void 0:De.place_type_name)==null?void 0:he[0])??h.place_type[0])},n(11,r=(T==null?void 0:T.length)??0),[h,m,l,S,C,N,a,U,ee,x,B,r,ie,se,Q]}class _2 extends fn{constructor(e){super(),hn(this,e,g2,m2,an,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function y2(s){let e;return{c(){e=ue("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ze(e,"class","svelte-7cmwmc")},m(n,r){ae(n,e,r)},p:tt,i:tt,o:tt,d(n){n&&oe(e)}}}class v2 extends fn{constructor(e){super(),hn(this,e,null,y2,an,{})}}function b2(s){let e,n;return{c(){e=Da("svg"),n=Da("path"),Ze(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ze(e,"viewBox","0 0 60.006 21.412"),Ze(e,"width","14"),Ze(e,"height","20"),Ze(e,"class","svelte-en2qvf")},m(r,a){ae(r,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(r){r&&oe(e)}}}class x2 extends fn{constructor(e){super(),hn(this,e,null,b2,an,{})}}function w2(s){let e,n,r;return{c(){e=Da("svg"),n=Da("circle"),r=Da("path"),Ze(n,"cx","4.789"),Ze(n,"cy","4.787"),Ze(n,"r","3.85"),Ze(n,"class","svelte-1aq105l"),Ze(r,"d","M12.063 12.063 7.635 7.635"),Ze(r,"class","svelte-1aq105l"),Ze(e,"xmlns","http://www.w3.org/2000/svg"),Ze(e,"width","13"),Ze(e,"height","13"),Ze(e,"viewBox","0 0 13 13"),Ze(e,"class","svelte-1aq105l")},m(a,h){ae(a,e,h),Z(e,n),Z(e,r)},p:tt,i:tt,o:tt,d(a){a&&oe(e)}}}class k2 extends fn{constructor(e){super(),hn(this,e,null,w2,an,{})}}function I2(s,e,n){const r=e[1],a=e[0],h=r-a;return s===r&&n?s:((s-a)%h+h)%h+a}function C_(s){const e=[...s];return e[2]<e[0]&&(e[2]+=360),e}let ch;async function S2(s,e,n){const r=s==null?void 0:s.getCenterAndZoom();for(const a of e??[])if(!(r&&(a.minZoom!=null&&a.minZoom>r[0]||a.maxZoom!=null&&a.maxZoom<r[0]))){if(a.type==="fixed")return a.coordinates.join(",");e:if(a.type==="client-geolocation"){if(ch&&a.cachedLocationExpiry&&ch.time+a.cachedLocationExpiry>Date.now()){if(!ch.coords)break e;return ch.coords}let h;try{return h=await new Promise((m,l)=>{n.signal.addEventListener("abort",()=>{l(Error("aborted"))}),navigator.geolocation.getCurrentPosition(x=>{m([x.coords.longitude,x.coords.latitude].map(S=>S.toFixed(6)).join(","))},x=>{l(x)},a)}),h}catch{}finally{a.cachedLocationExpiry&&(ch={time:Date.now(),coords:h})}if(n.signal.aborted)return}if(a.type==="server-geolocation")return"ip";if(r&&a.type==="map-center")return r[1].toFixed(6)+","+r[2].toFixed(6)}}const E2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,L_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,M_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,R_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,P_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,D_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function A2(s){if(!["DMS","DM","DD"].includes(s))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(B=>Number(B.trim())),n=Number(e[0]),r=Number(e[1]),a=Math.abs(n),h=Math.abs(r),m=n>0?"N":"S",l=r>0?"E":"W";let x;s=="DD"&&(x=`${a} ${m}, ${h} ${l}`);const S=Math.floor(a),T=Math.floor(h),C=(a-S)*60,N=(h-T)*60;if(s=="DM"){let B=N_(C,3).toFixed(3).padStart(6,"0"),U=N_(N,3).toFixed(3).padStart(6,"0");B.endsWith(".000")&&U.endsWith(".000")&&(B=B.replace(/\.000$/,""),U=U.replace(/\.000$/,"")),x=`${S} ${B}' ${m}, ${T} ${U}' ${l}`}if(s=="DMS"){const B=Math.floor(C),U=Math.floor(N);let ee=((C-B)*60).toFixed(1).padStart(4,"0"),ie=((N-U)*60).toFixed(1).padStart(4,"0");const se=B.toString().padStart(2,"0"),Q=U.toString().padStart(2,"0");ee.endsWith(".0")&&ie.endsWith(".0")&&(ee=ee.replace(/\.0$/,""),ie=ie.replace(/\.0$/,"")),x=`${S} ${se}' ${ee}" ${m}, ${T} ${Q}' ${ie}" ${l}`}return x}else throw new Error("no decimal coordinates to convert")}function N_(s,e){const n=Math.pow(10,e);return Math.round((s+Number.EPSILON)*n)/n}function Gp(s,e){e||(e=5),s=s.replace(/\s+/g," ").trim();let n=null,r=null,a="",h="",m=null,l=[],x=!1;if(E2.test(s))throw new Error("invalid coordinate value");if(L_.test(s))if(l=L_.exec(s),x=hh(l),x)n=Math.abs(l[1])+l[2]/60,Number(l[1])<0&&(n*=-1),r=Math.abs(l[3])+l[4]/60,Number(l[3])<0&&(r*=-1),m="DM";else throw new Error("invalid coordinate format");else if(M_.test(s))if(l=M_.exec(s),x=hh(l),x){if(n=l[2],r=l[6],n.includes(",")&&(n=n.replace(",",".")),r.includes(",")&&(r=r.replace(",",".")),m="DD",Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");l[1]?(a=l[1],h=l[5]):l[4]&&(a=l[4],h=l[8])}else throw new Error("invalid decimal coordinate format");else if(R_.test(s))if(l=R_.exec(s),x=hh(l),x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4]/60,m="DM"),l[6]&&(n+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),r=Math.abs(parseInt(l[9])),l[11]&&(r+=l[11]/60),l[13]&&(r+=l[13].replace(",",".")/3600),parseInt(l[9])<0&&(r=-1*r),l[1]?(a=l[1],h=l[8]):l[7]&&(a=l[7],h=l[14]);else throw new Error("invalid DMS coordinates format");else if(P_.test(s))if(l=P_.exec(s),x=hh(l),x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4]/60,m="DM"),l[6]&&(n+=l[6]/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),r=Math.abs(parseInt(l[10])),l[12]&&(r+=l[12]/60),l[14]&&(r+=l[14]/3600),parseInt(l[10])<0&&(r=-1*r),l[1]?(a=l[1],h=l[9]):l[8]&&(a=l[8],h=l[16]);else throw new Error("invalid DMS coordinates format");else if(D_.test(s)){if(l=D_.exec(s),x=hh(l),l.filter(S=>S).length<=5)throw new Error("invalid coordinates format");if(x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4].replace(",",".")/60,m="DM"),l[6]&&(n+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),r=Math.abs(parseInt(l[10])),l[12]&&(r+=l[12].replace(",",".")/60),l[14]&&(r+=l[14].replace(",",".")/3600),parseInt(l[10])<0&&(r=-1*r),l[1]?(a=l[1],h=l[9]):l[8]&&(a=l[8],h=l[16]);else throw new Error("invalid coordinates format")}if(x){if(Math.abs(r)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if(a&&!h||!a&&h)throw new Error("invalid coordinates value");if(a&&a==h)throw new Error("invalid coordinates format");n.toString().includes(",")&&(n=n.replace(",",".")),r.toString().includes(",")&&(r=r.replace(",","."));let S=/S|SOUTH/i;S.test(a)&&n>0&&(n=-1*n),S=/W|WEST/i,S.test(h)&&r>0&&(r=-1*r);const T=l[0].trim();let C,N;const B=/[,/;\u0020]/g,U=T.match(B);if(U==null){const se=Math.floor(s.length/2);C=T.substring(0,se).trim(),N=T.substring(se).trim()}else{let se;U.length%2==1?se=Math.floor(U.length/2):se=U.length/2-1;let Q=0;if(se==0)Q=T.indexOf(U[0]),C=T.substring(0,Q).trim(),N=T.substring(Q+1).trim();else{let K=0,pe=0;for(;K<=se;)Q=T.indexOf(U[K],pe),pe=Q+1,K++;C=T.substring(0,Q).trim(),N=T.substring(Q+1).trim()}}const ee=C.split(".");if(ee.length==2&&ee[1]==0&&ee[1].length!=2)throw new Error("invalid coordinates format");const ie=N.split(".");if(ie.length==2&&ie[1]==0&&ie[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(C)||/^\d+$/.test(N))throw new Error("degree only coordinate/s provided");return n=Number(Number(n).toFixed(e)),r=Number(Number(r).toFixed(e)),Object.freeze({verbatimCoordinates:T,verbatimLatitude:C,verbatimLongitude:N,decimalLatitude:n,decimalLongitude:r,decimalCoordinates:`${n},${r}`,originalFormat:m,closeEnough:T2,toCoordinateFormat:A2})}else throw new Error("coordinates pattern match failed")}function hh(s){if(!isNaN(s[0]))return!1;const e=[...s];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,r=/[eastsouthnorthwest]+/i,a=e.length/2;for(let h=0;h<a;h++){const m=e[h],l=e[h+a],x=n.test(m)&&n.test(l),S=r.test(m)&&r.test(l),T=m==l;if(!(m==null&&l==null)){if(m==null||l==null)return!1;if(x||S||T)continue;return!1}}return!0}function z_(s,e){const n=Math.abs(s-e);return Number(n.toFixed(6))<=1e-5}function T2(s){if(!s)throw new Error("coords must be provided");if(s.includes(",")){const e=s.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return z_(this.decimalLatitude,Number(e[0]))&&z_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const C2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Gp.to=C2;const L2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],M2={decimalLatitude:40.123,decimalLongitude:-74.123},R2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],P2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function D2(){const s=[];return L2.forEach(e=>{e.decimalLatitude?s.push(e):s.push({...e,...M2})}),[...s,...R2,...P2]}const N2=D2();Gp.formats=N2.map(s=>s.verbatimCoordinates);const z2=Gp;function F_(s,e,n){const r=s.slice();return r[81]=e[n],r[83]=n,r}function O_(s){let e,n;return e=new v2({}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function B_(s){let e,n,r,a,h;return n=new x2({}),{c(){e=ue("button"),ot(n.$$.fragment),Ze(e,"type","button"),Ze(e,"title",s[9]),Ze(e,"class","svelte-zh3kmv"),Sr(e,"active",s[0])},m(m,l){ae(m,e,l),it(n,e,null),r=!0,a||(h=Rt(e,"click",s[67]),a=!0)},p(m,l){(!r||l[0]&512)&&Ze(e,"title",m[9]),(!r||l[0]&1)&&Sr(e,"active",m[0])},i(m){r||(_e(n.$$.fragment,m),r=!0)},o(m){Ie(n.$$.fragment,m),r=!1},d(m){m&&oe(e),rt(n),a=!1,h()}}}function F2(s){let e,n=[],r=new Map,a,h,m,l=qn(s[14]);const x=S=>S[81].id+(S[81].address?","+S[81].address:"");for(let S=0;S<l.length;S+=1){let T=F_(s,l,S),C=x(T);r.set(C,n[S]=U_(C,T))}return{c(){e=ue("ul");for(let S=0;S<n.length;S+=1)n[S].c();Ze(e,"class","svelte-zh3kmv")},m(S,T){ae(S,e,T);for(let C=0;C<n.length;C+=1)n[C]&&n[C].m(e,null);a=!0,h||(m=[Rt(e,"mouseleave",s[71]),Rt(e,"blur",s[72])],h=!0)},p(S,T){T[0]&17880064&&(l=qn(S[14]),zn(),n=ox(n,T,x,1,S,l,r,e,sx,U_,null,F_),Fn())},i(S){if(!a){for(let T=0;T<l.length;T+=1)_e(n[T]);a=!0}},o(S){for(let T=0;T<n.length;T+=1)Ie(n[T]);a=!1},d(S){S&&oe(e);for(let T=0;T<n.length;T+=1)n[T].d();h=!1,Ki(m)}}}function O2(s){let e,n,r,a,h,m;return n=new Lv({}),{c(){e=ue("div"),ot(n.$$.fragment),r=Oe(),a=ue("div"),h=Fe(s[7]),Ze(a,"class","svelte-zh3kmv"),Ze(e,"class","no-results svelte-zh3kmv")},m(l,x){ae(l,e,x),it(n,e,null),Z(e,r),Z(e,a),Z(a,h),m=!0},p(l,x){(!m||x[0]&128)&&Lt(h,l[7])},i(l){m||(_e(n.$$.fragment,l),m=!0)},o(l){Ie(n.$$.fragment,l),m=!1},d(l){l&&oe(e),rt(n)}}}function B2(s){let e="",n;return{c(){n=Fe(e)},m(r,a){ae(r,n,a)},p:tt,i:tt,o:tt,d(r){r&&oe(n)}}}function U2(s){let e,n,r,a,h,m,l,x,S,T,C;return n=new Lv({}),x=new Cv({}),{c(){e=ue("div"),ot(n.$$.fragment),r=Oe(),a=ue("div"),h=Fe(s[6]),m=Oe(),l=ue("button"),ot(x.$$.fragment),Ze(a,"class","svelte-zh3kmv"),Ze(l,"class","svelte-zh3kmv"),Ze(e,"class","error svelte-zh3kmv")},m(N,B){ae(N,e,B),it(n,e,null),Z(e,r),Z(e,a),Z(a,h),Z(e,m),Z(e,l),it(x,l,null),S=!0,T||(C=Rt(l,"click",s[68]),T=!0)},p(N,B){(!S||B[0]&64)&&Lt(h,N[6])},i(N){S||(_e(n.$$.fragment,N),_e(x.$$.fragment,N),S=!0)},o(N){Ie(n.$$.fragment,N),Ie(x.$$.fragment,N),S=!1},d(N){N&&oe(e),rt(n),rt(x),T=!1,C()}}}function U_(s,e){let n,r,a;function h(){return e[69](e[83])}function m(){return e[70](e[81])}return r=new _2({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),r.$on("mouseenter",h),r.$on("focus",m),{key:s,first:null,c(){n=ni(),ot(r.$$.fragment),this.first=n},m(l,x){ae(l,n,x),it(r,l,x),a=!0},p(l,x){e=l;const S={};x[0]&16384&&(S.feature=e[81]),x[0]&1024&&(S.showPlaceType=e[10]),x[0]&49152&&(S.selected=e[15]===e[83]),x[0]&4096&&(S.iconsBaseUrl=e[12]),r.$set(S)},i(l){a||(_e(r.$$.fragment,l),a=!0)},o(l){Ie(r.$$.fragment,l),a=!1},d(l){l&&oe(n),rt(r,l)}}}function j2(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe,ve,De=!1;h=new k2({}),C=new Cv({});let he=s[19]&&O_(),xe=s[5]===!0&&B_(s);const be=s[59].default,Ce=Zi(be,s,s[58],null),we=[U2,B2,O2,F2],ye=[];function Ue(qe,pt){var St,dt;return qe[18]?0:qe[16]?((St=qe[14])==null?void 0:St.length)===0?2:qe[16]&&((dt=qe[14])!=null&&dt.length)?3:-1:1}return~(ie=Ue(s))&&(se=ye[ie]=we[ie](s)),{c(){e=Oe(),n=ue("form"),r=ue("div"),a=ue("button"),ot(h.$$.fragment),m=Oe(),l=ue("input"),x=Oe(),S=ue("div"),T=ue("button"),ot(C.$$.fragment),N=Oe(),he&&he.c(),B=Oe(),xe&&xe.c(),U=Oe(),Ce&&Ce.c(),ee=Oe(),se&&se.c(),Ze(a,"class","search-button svelte-zh3kmv"),Ze(a,"type","button"),Ze(l,"placeholder",s[8]),Ze(l,"aria-label",s[8]),Ze(l,"class","svelte-zh3kmv"),Ze(T,"type","button"),Ze(T,"title",s[3]),Ze(T,"class","svelte-zh3kmv"),Ze(S,"class","clear-button-container svelte-zh3kmv"),Sr(S,"displayable",s[1]!==""),Ze(r,"class","input-group svelte-zh3kmv"),Ze(n,"tabindex","0"),Ze(n,"class",Q=Nf(s[2])+" svelte-zh3kmv"),Sr(n,"can-collapse",s[4]&&s[1]==="")},m(qe,pt){ae(qe,e,pt),ae(qe,n,pt),Z(n,r),Z(r,a),it(h,a,null),Z(r,m),Z(r,l),s[61](l),qi(l,s[1]),Z(r,x),Z(r,S),Z(S,T),it(C,T,null),Z(S,N),he&&he.m(S,null),Z(r,B),xe&&xe.m(r,null),Z(r,U),Ce&&Ce.m(r,null),Z(n,ee),~ie&&ye[ie].m(n,null),K=!0,pe||(ve=[Rt(a,"click",s[60]),Rt(l,"input",s[62]),Rt(l,"focus",s[63]),Rt(l,"blur",s[64]),Rt(l,"keydown",s[22]),Rt(l,"input",s[65]),Rt(T,"click",s[66]),Rt(n,"submit",Nh(s[21]))],pe=!0)},p(qe,pt){(!K||pt[0]&256)&&Ze(l,"placeholder",qe[8]),(!K||pt[0]&256)&&Ze(l,"aria-label",qe[8]),pt[0]&2&&l.value!==qe[1]&&qi(l,qe[1]),(!K||pt[0]&8)&&Ze(T,"title",qe[3]),qe[19]?he?pt[0]&524288&&_e(he,1):(he=O_(),he.c(),_e(he,1),he.m(S,null)):he&&(zn(),Ie(he,1,1,()=>{he=null}),Fn()),(!K||pt[0]&2)&&Sr(S,"displayable",qe[1]!==""),qe[5]===!0?xe?(xe.p(qe,pt),pt[0]&32&&_e(xe,1)):(xe=B_(qe),xe.c(),_e(xe,1),xe.m(r,U)):xe&&(zn(),Ie(xe,1,1,()=>{xe=null}),Fn()),Ce&&Ce.p&&(!K||pt[1]&134217728)&&Xi(Ce,be,qe,qe[58],K?Hi(be,qe[58],pt,null):Wi(qe[58]),null);let St=ie;ie=Ue(qe),ie===St?~ie&&ye[ie].p(qe,pt):(se&&(zn(),Ie(ye[St],1,1,()=>{ye[St]=null}),Fn()),~ie?(se=ye[ie],se?se.p(qe,pt):(se=ye[ie]=we[ie](qe),se.c()),_e(se,1),se.m(n,null)):se=null),(!K||pt[0]&4&&Q!==(Q=Nf(qe[2])+" svelte-zh3kmv"))&&Ze(n,"class",Q),(!K||pt[0]&22)&&Sr(n,"can-collapse",qe[4]&&qe[1]==="")},i(qe){K||(_e(De),_e(h.$$.fragment,qe),_e(C.$$.fragment,qe),_e(he),_e(xe),_e(Ce,qe),_e(se),K=!0)},o(qe){Ie(De),Ie(h.$$.fragment,qe),Ie(C.$$.fragment,qe),Ie(he),Ie(xe),Ie(Ce,qe),Ie(se),K=!1},d(qe){qe&&(oe(e),oe(n)),rt(h),s[61](null),rt(C),he&&he.d(),xe&&xe.d(),Ce&&Ce.d(qe),~ie&&ye[ie].d(),pe=!1,Ki(ve)}}}function q2(s,e,n){let r,{$$slots:a={},$$scope:h}=e,{class:m=void 0}=e,{apiKey:l}=e,{bbox:x=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:T=!1}=e,{collapsed:C=!1}=e,{country:N=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:U=!1}=e,{errorMessage:ee="Something went wrong"}=e,{filter:ie=()=>!0}=e,{flyTo:se=!0}=e,{fuzzyMatch:Q=!0}=e,{language:K=void 0}=e,{limit:pe=void 0}=e,{mapController:ve=void 0}=e,{minLength:De=2}=e,{noResultsMessage:he="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:xe="Search"}=e,{proximity:be=[{type:"server-geolocation"}]}=e,{reverseActive:Ce=U==="always"}=e,{reverseButtonTitle:we="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{showFullGeometry:Ue=!0}=e,{showPlaceType:qe="ifNeeded"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:St=!0}=e,{flyToSelected:dt=!1}=e,{markerOnSelected:ut=!0}=e,{types:Bt=void 0}=e,{excludeTypes:vt=!1}=e,{zoom:wt=16}=e,{maxZoom:ft=18}=e,{apiUrl:xt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:It={}}=e,{iconsBaseUrl:Yt="https://cdn.maptiler.com/maptiler-geocoding-control/v1.3.3/icons/"}=e,{adjustUrlQuery:pn=()=>{}}=e;function Dn(){kt.focus()}function We(){kt.blur()}function Xn(fe,je=!0,Xe=!1){n(1,ye=fe),je?(n(15,qt=-1),Jr()):(Mt(!Xe,Xe),setTimeout(()=>{kt.focus(),kt.select()}))}function dn(){n(14,lt=void 0),n(55,Ct=void 0),n(15,qt=-1)}function Ot(){n(54,Ye=[]),n(55,Ct=void 0)}let Se=!1,lt,Ye,Ct,$e="",kt,qt=-1,Ee,Gt=[],_n,Jn,$i,xn;const Vi=new Set,Yi=hc();vo(()=>{ve&&(ve.setEventHandler(void 0),ve.indicateReverse(!1),ve.setSelectedMarker(-1),ve.setMarkers(void 0,void 0))});function Jr(fe){if(Jn&&(clearTimeout(Jn),Jn=void 0),qt>-1&&lt)n(55,Ct=lt[qt]),n(1,ye=Ct.place_type[0]==="reverse"?Ct.place_name:Ct.place_name.replace(/,.*/,"")),n(18,Ee=void 0),n(54,Ye=void 0),n(15,qt=-1);else if(ye){const je=fe||!ct(ye);yr(ye,{exact:!0}).then(()=>{n(54,Ye=lt),n(55,Ct=void 0),je&&kn()}).catch(Xe=>n(18,Ee=Xe))}}function ct(fe){try{return z2(fe,6)}catch{return!1}}async function yr(fe,{byId:je=!1,exact:Xe=!1}={}){n(18,Ee=void 0),_n==null||_n.abort();const Re=new AbortController;n(19,_n=Re);try{const et=ct(fe),gt=new URLSearchParams;if(K!==void 0&&gt.set("language",Array.isArray(K)?K.join(","):K??""),Bt&&gt.set("types",Bt.join(",")),vt&&gt.set("excludeTypes",String(vt)),x&&gt.set("bbox",x.map(ln=>ln.toFixed(6)).join(",")),N&&gt.set("country",Array.isArray(N)?N.join(","):N),!je&&!et){const ln=await S2(ve,be,Re);ln&&gt.set("proximity",ln),(Xe||!pt)&&gt.set("autocomplete","false"),gt.set("fuzzyMatch",String(Q))}pe!==void 0&&(!et||(Bt==null?void 0:Bt.length)===1)&&gt.set("limit",String(pe)),gt.set("key",l),pn(gt);const at=xt+"/"+encodeURIComponent(et?et.decimalLongitude+","+et.decimalLatitude:fe)+".json?"+gt.toString();if(at===$e){je?(n(14,lt=void 0),n(55,Ct=Gt[0])):n(14,lt=Gt);return}$e=at;const Dt=await fetch(at,{signal:Re.signal,...It});if(!Dt.ok)throw new Error(await Dt.text());const en=await Dt.json();Yi("response",{url:at,featureCollection:en}),je?(n(14,lt=void 0),n(55,Ct=en.features[0]),Gt=[Ct]):(n(14,lt=en.features.filter(ie)),et&&lt.unshift({type:"Feature",properties:{},id:"reverse_"+et.decimalLongitude+"_"+et.decimalLatitude,text:et.decimalLatitude+", "+et.decimalLongitude,place_name:et.decimalLatitude+", "+et.decimalLongitude,place_type:["reverse"],center:[et.decimalLongitude,et.decimalLatitude],bbox:[et.decimalLongitude,et.decimalLatitude,et.decimalLongitude,et.decimalLatitude],geometry:{type:"Point",coordinates:[et.decimalLongitude,et.decimalLatitude]}}),Gt=lt,et&&kt.focus())}catch(et){if(et&&typeof et=="object"&&"name"in et&&et.name==="AbortError")return;throw et}finally{Re===_n&&n(19,_n=void 0)}}function kn(){var Xe;if(!(Ye!=null&&Ye.length)||!se)return;const fe=[180,90,-180,-90],je=!Ye.some(Re=>!Re.matching_text);for(const Re of Ye)if(je||!Re.matching_text)for(const et of[0,1,2,3])fe[et]=Math[et<2?"min":"max"](fe[et],((Xe=Re.bbox)==null?void 0:Xe[et])??Re.center[et%2]);ve&&Ye.length>0&&(Ct&&fe[0]===fe[2]&&fe[1]===fe[3]?ve.flyTo(Ct.center,wt):ve.fitBounds(C_(fe),50,ft))}function mn(fe){n(0,Ce=U==="always"),n(14,lt=void 0),n(55,Ct=void 0),n(15,qt=-1),Xn(fe[1].toFixed(6)+", "+I2(fe[0],[-180,180],!0).toFixed(6),!1,!0)}function Ls(fe){if(!lt)return;let je=fe.key==="ArrowDown"?1:fe.key==="ArrowUp"?-1:0;je&&(qt===(St?0:-1)&&je===-1&&n(15,qt=lt.length),n(15,qt+=je),qt>=lt.length&&n(15,qt=-1),qt<0&&St&&n(15,qt=0),fe.preventDefault())}function Mt(fe=!0,je=!1){if(n(18,Ee=void 0),pt||je){if(Jn&&clearTimeout(Jn),ye.length<De)return;const Xe=ye;Jn=window.setTimeout(()=>{yr(Xe).catch(Re=>n(18,Ee=Re))},fe?B:0)}else n(14,lt=void 0),n(18,Ee=void 0)}function Cn(fe){n(55,Ct=fe),n(1,ye=fe.place_name),n(15,qt=-1)}const At=()=>kt.focus();function vr(fe){Kn[fe?"unshift":"push"](()=>{kt=fe,n(17,kt)})}function Gr(){ye=this.value,n(1,ye),n(13,Se),n(27,T)}const wn=()=>n(13,Se=!0),Li=()=>n(13,Se=!1),Ar=()=>Mt(),Ji=()=>{n(1,ye=""),kt.focus()},Zr=()=>n(0,Ce=!Ce),Me=()=>n(18,Ee=void 0),J=fe=>n(15,qt=fe),Y=fe=>Cn(fe),ce=()=>{St||n(15,qt=-1)},le=()=>{};return s.$$set=fe=>{"class"in fe&&n(2,m=fe.class),"apiKey"in fe&&n(25,l=fe.apiKey),"bbox"in fe&&n(26,x=fe.bbox),"clearButtonTitle"in fe&&n(3,S=fe.clearButtonTitle),"clearOnBlur"in fe&&n(27,T=fe.clearOnBlur),"collapsed"in fe&&n(4,C=fe.collapsed),"country"in fe&&n(28,N=fe.country),"debounceSearch"in fe&&n(29,B=fe.debounceSearch),"enableReverse"in fe&&n(5,U=fe.enableReverse),"errorMessage"in fe&&n(6,ee=fe.errorMessage),"filter"in fe&&n(30,ie=fe.filter),"flyTo"in fe&&n(31,se=fe.flyTo),"fuzzyMatch"in fe&&n(32,Q=fe.fuzzyMatch),"language"in fe&&n(33,K=fe.language),"limit"in fe&&n(34,pe=fe.limit),"mapController"in fe&&n(35,ve=fe.mapController),"minLength"in fe&&n(36,De=fe.minLength),"noResultsMessage"in fe&&n(7,he=fe.noResultsMessage),"placeholder"in fe&&n(8,xe=fe.placeholder),"proximity"in fe&&n(37,be=fe.proximity),"reverseActive"in fe&&n(0,Ce=fe.reverseActive),"reverseButtonTitle"in fe&&n(9,we=fe.reverseButtonTitle),"searchValue"in fe&&n(1,ye=fe.searchValue),"showFullGeometry"in fe&&n(38,Ue=fe.showFullGeometry),"showPlaceType"in fe&&n(10,qe=fe.showPlaceType),"showResultsWhileTyping"in fe&&n(39,pt=fe.showResultsWhileTyping),"selectFirst"in fe&&n(11,St=fe.selectFirst),"flyToSelected"in fe&&n(40,dt=fe.flyToSelected),"markerOnSelected"in fe&&n(41,ut=fe.markerOnSelected),"types"in fe&&n(42,Bt=fe.types),"excludeTypes"in fe&&n(43,vt=fe.excludeTypes),"zoom"in fe&&n(44,wt=fe.zoom),"maxZoom"in fe&&n(45,ft=fe.maxZoom),"apiUrl"in fe&&n(46,xt=fe.apiUrl),"fetchParameters"in fe&&n(47,It=fe.fetchParameters),"iconsBaseUrl"in fe&&n(12,Yt=fe.iconsBaseUrl),"adjustUrlQuery"in fe&&n(48,pn=fe.adjustUrlQuery),"$$scope"in fe&&n(58,h=fe.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&32&&n(0,Ce=U==="always"),s.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,$i=Se),T&&!Se&&n(1,ye="")}),s.$$.dirty[0]&16386|s.$$.dirty[1]&32&&ye.length<De&&(n(55,Ct=void 0),n(14,lt=void 0),n(18,Ee=void 0),n(54,Ye=lt)),s.$$.dirty[1]&16777344&&Ue&&Ct&&!Ct.address&&Ct.geometry.type==="Point"&&Ct.place_type[0]!=="reverse"&&yr(Ct.id,{byId:!0}).catch(fe=>n(18,Ee=fe)),s.$$.dirty[1]&50356241&&(ve&&Ct&&Ct.id!==xn&&se&&(!Ct.bbox||Ct.bbox[0]===Ct.bbox[2]&&Ct.bbox[1]===Ct.bbox[3]?ve.flyTo(Ct.center,Ct.id.startsWith("poi.")||Ct.id.startsWith("address.")?ft:wt):ve.fitBounds(C_(Ct.bbox),50,ft),n(14,lt=void 0),n(54,Ye=void 0),n(15,qt=-1)),n(56,xn=Ct==null?void 0:Ct.id)),s.$$.dirty[0]&18432&&St&&lt!=null&&lt.length&&n(15,qt=0),s.$$.dirty[0]&2050&&(St||n(15,qt=-1)),s.$$.dirty[0]&16384|s.$$.dirty[1]&8388608&&Ye!==lt&&n(54,Ye=void 0),s.$$.dirty[0]&81921|s.$$.dirty[1]&8388624&&ve&&ve.setEventHandler(fe=>{switch(fe.type){case"mapClick":Ce&&mn(fe.coordinates);break;case"markerClick":{const je=lt==null?void 0:lt.find(Xe=>Xe.id===fe.id);je&&Cn(je)}break;case"markerMouseEnter":Ye&&n(15,qt=$i?(lt==null?void 0:lt.findIndex(je=>je.id===fe.id))??-1:-1);break;case"markerMouseLeave":Ye&&n(15,qt=-1);break}}),s.$$.dirty[0]&49152&&n(57,r=lt==null?void 0:lt[qt]),s.$$.dirty[1]&67133969&&ve&&r&&se&&dt&&ve.flyTo(r.center,r.id.startsWith("poi.")||r.id.startsWith("address.")?ft:wt),s.$$.dirty[1]&1040&&(ut||ve==null||ve.setMarkers(void 0,void 0)),s.$$.dirty[1]&75498512&&ve&&ut&&!Ye&&(ve.setMarkers(r?[r]:void 0,void 0),ve.setSelectedMarker(r?0:-1)),s.$$.dirty[1]&25165840&&ve&&ve.setMarkers(Ye,Ct),s.$$.dirty[0]&32768|s.$$.dirty[1]&8388624&&Ye&&ve&&ve.setSelectedMarker(qt),s.$$.dirty[0]&2|s.$$.dirty[1]&16&&ve){const fe=ct(ye);ve.setReverseMarker(fe?[fe.decimalLongitude,fe.decimalLatitude]:void 0)}s.$$.dirty[1]&67108864&&Yi("select",r),s.$$.dirty[1]&16777216&&Yi("pick",Ct),s.$$.dirty[0]&81920&&Yi("optionsVisibilityChange",$i&&!!lt),s.$$.dirty[0]&16384&&Yi("featuresListed",lt),s.$$.dirty[1]&8388608&&Yi("featuresMarked",Ye),s.$$.dirty[0]&1&&Yi("reverseToggle",Ce),s.$$.dirty[0]&2&&Yi("queryChange",ye),s.$$.dirty[0]&1|s.$$.dirty[1]&16&&ve&&ve.indicateReverse(Ce)},[Ce,ye,m,S,C,U,ee,he,xe,we,qe,St,Yt,Se,lt,qt,$i,kt,Ee,_n,Vi,Jr,Ls,Mt,Cn,l,x,T,N,B,ie,se,Q,K,pe,ve,De,be,Ue,pt,dt,ut,Bt,vt,wt,ft,xt,It,pn,Dn,We,Xn,dn,Ot,Ye,Ct,xn,r,h,a,At,vr,Gr,wn,Li,Ar,Ji,Zr,Me,J,Y,ce,le]}class V2 extends fn{constructor(e){super(),hn(this,e,q2,j2,an,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function j_(s){let e,n,r;return n=new V2({props:{mapController:s[1],apiKey:s[0]}}),{c(){e=ue("div"),ot(n.$$.fragment),Ze(e,"class","svelte-ixhnie")},m(a,h){ae(a,e,h),it(n,e,null),r=!0},p(a,h){const m={};h&2&&(m.mapController=a[1]),h&1&&(m.apiKey=a[0]),n.$set(m)},i(a){r||(_e(n.$$.fragment,a),r=!0)},o(a){Ie(n.$$.fragment,a),r=!1},d(a){a&&oe(e),rt(n)}}}function G2(s){let e,n,r=s[1]&&j_(s);return{c(){r&&r.c(),e=ni()},m(a,h){r&&r.m(a,h),ae(a,e,h),n=!0},p(a,[h]){a[1]?r?(r.p(a,h),h&2&&_e(r,1)):(r=j_(a),r.c(),_e(r,1),r.m(e.parentNode,e)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d(a)}}}function Z2(s,e,n){let r,{apiKey:a}=e,{map:h}=e;return s.$$set=m=>{"apiKey"in m&&n(0,a=m.apiKey),"map"in m&&n(2,h=m.map)},s.$$.update=()=>{s.$$.dirty&4&&n(1,r=h?r2(h,Ts):null)},[a,r,h]}class H2 extends fn{constructor(e){super(),hn(this,e,Z2,G2,an,{apiKey:0,map:2})}}const Zu=[];function lp(s,e){return{subscribe:Yn(s,e).subscribe}}function Yn(s,e=tt){let n;const r=new Set;function a(l){if(an(s,l)&&(s=l,n)){const x=!Zu.length;for(const S of r)S[1](),Zu.push(S,s);if(x){for(let S=0;S<Zu.length;S+=2)Zu[S][0](Zu[S+1]);Zu.length=0}}}function h(l){a(l(s))}function m(l,x=tt){const S=[l,x];return r.add(S),r.size===1&&(n=e(a,h)||tt),l(s),()=>{r.delete(S),r.size===0&&n&&(n(),n=null)}}return{set:a,update:h,subscribe:m}}const X2=Symbol.for("svelte-maplibre");function W2(){return Q0(X2)}function K2(s){return"layerType"in s&&s.layerType==="deckgl"}var Rh=$2;function $2(s){var e,n,r;if(s){if(Array.isArray(s)){for(e=[],n=s.length,r=0;r<n;r++){var a=s[r];a!=null&&e.push(a)}return e}if(typeof s=="object"){e={};var h=Object.keys(s);for(n=h.length,r=0;r<n;r++){var m=h[r],l=s[m];l!=null&&(e[m]=l)}return e}}}var Hu=Zp;function Zp(s,e){return s===e||s!==s&&e!==e?!0:typeof s!=typeof e||{}.toString.call(s)!={}.toString.call(e)||s!==Object(s)||!s?!1:Array.isArray(s)?q_(s,e):{}.toString.call(s)=="[object Set]"?q_(Array.from(s),Array.from(e)):{}.toString.call(s)=="[object Object]"?J2(s,e):Y2(s,e)}function Y2(s,e){return s.toString()===e.toString()}function q_(s,e){var n=s.length;if(n!=e.length)return!1;for(var r=0;r<n;r++)if(!Zp(s[r],e[r]))return!1;return!0}function J2(s,e){var n=Object.keys(s),r=n.length;if(r!=Object.keys(e).length)return!1;for(var a=0;a<r;a++){var h=n[a];if(!(e.hasOwnProperty(h)&&Zp(s[h],e[h])))return!1}return!0}const Q2=s=>({features:s[0]&16,data:s[0]&16,map:s[0]&4,close:s[0]&1}),V_=s=>{var e;return{features:s[4],data:(e=s[4])==null?void 0:e[0],map:s[2],close:s[31]}};function G_(s){let e,n,r=(s[4]||s[3]instanceof Ts.Marker)&&Z_(s);return{c(){e=ue("div"),r&&r.c()},m(a,h){ae(a,e,h),r&&r.m(e,null),s[32](e),n=!0},p(a,h){a[4]||a[3]instanceof Ts.Marker?r?(r.p(a,h),h[0]&24&&_e(r,1)):(r=Z_(a),r.c(),_e(r,1),r.m(e,null)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d(),s[32](null)}}}function Z_(s){let e;const n=s[30].default,r=Zi(n,s,s[29],V_);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h[0]&536870933)&&Xi(r,n,a,a[29],e?Hi(n,a[29],h,Q2):Wi(a[29]),V_)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function ek(s){let e,n,r=s[9].default&&G_(s);return{c(){r&&r.c(),e=ni()},m(a,h){r&&r.m(a,h),ae(a,e,h),n=!0},p(a,h){a[9].default?r?(r.p(a,h),h[0]&512&&_e(r,1)):(r=G_(a),r.c(),_e(r,1),r.m(e.parentNode,e)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d(a)}}}function tk(s,e,n){let r,a,h,m,l,x,{$$slots:S={},$$scope:T}=e;const C=Qb(S);let{closeButton:N=void 0}=e,{closeOnClickOutside:B=!0}=e,{closeOnClickInside:U=!1}=e,{closeOnMove:ee=!1}=e,{openOn:ie="click"}=e,{openIfTopMost:se=!0}=e,{focusAfterOpen:Q=!0}=e,{anchor:K=void 0}=e,{offset:pe=void 0}=e,{popupClass:ve=void 0}=e,{maxWidth:De=void 0}=e,{lngLat:he=void 0}=e,{html:xe=void 0}=e,{open:be=!1}=e;const Ce=hc(),{map:we,popupTarget:ye,layerEvent:Ue,layer:qe,eventTopMost:pt}=W2();Ft(s,we,Ye=>n(2,h=Ye)),Ft(s,ye,Ye=>n(3,l=Ye)),Ft(s,Ue,Ye=>n(28,m=Ye)),Ft(s,qe,Ye=>n(35,x=Ye));const St=["click","dblclick","contextmenu"];let dt,ut=!1,Bt;function vt(){if(!dt)return;let Ye=dt.getElement();!Ye||Ye===Bt||(Bt=Ye,ie==="hover"&&(Bt.style.pointerEvents="none"),Bt.addEventListener("mouseenter",()=>{n(24,ut=!0)},{passive:!0}),Bt.addEventListener("mouseleave",()=>{n(24,ut=!1)},{passive:!0}),Bt.addEventListener("click",()=>{U&&n(0,be=!1)},{passive:!0}))}cc(()=>{if(h)return h.on("click",dn),h.on("contextmenu",dn),typeof l=="string"&&(h.on("click",l,It),h.on("dblclick",l,It),h.on("contextmenu",l,It),h.on("mousemove",l,Xn),h.on("mouseleave",l,We),h.on("touchstart",l,pn),h.on("touchend",l,Dn)),()=>{h!=null&&h.loaded()&&(dt==null||dt.remove(),h.off("click",dn),h.off("contextmenu",dn),l instanceof Ts.Marker?l.getPopup()===dt&&l.setPopup(void 0):typeof l=="string"&&(h.off("click",l,It),h.off("dblclick",l,It),h.off("contextmenu",l,It),h.off("mousemove",l,Xn),h.off("mouseleave",l,We),h.off("touchstart",l,pn),h.off("touchend",l,Dn)))}});function wt(Ye){return se?!("marker"in Ye)&&!K2(Ye)&&pt(Ye)!==x:!1}let ft=null,xt="normal";function It(Ye){Ye.type===ie&&(wt(Ye)||("layerType"in Ye?Ye.layerType==="deckgl"?(n(10,he=Ye.coordinate),n(4,ft=Ye.object?[Ye.object]:null)):(n(10,he=Ye.lngLat),n(4,ft=Ye.features??[])):(n(10,he=Ye.lngLat),n(4,ft=Ye.features??[])),setTimeout(()=>n(0,be=!0))))}let Yt=null;function pn(Ye){Yt=Ye.point}function Dn(Ye){if(!Yt||ie!=="hover")return;let Ct=Yt.dist(Ye.point);Yt=null,Ct<3&&(n(10,he=Ye.lngLat),n(4,ft=Ye.features??[]),dt.isOpen()?n(25,xt="justOpened"):(n(25,xt="opening"),n(0,be=!0)))}function We(Ye){ie!=="hover"||Yt||xt!=="normal"||(n(0,be=!1),n(4,ft=null))}function Xn(Ye){if(!(ie!=="hover"||Yt||xt!=="normal")){if(wt(Ye)){n(0,be=!1),n(4,ft=null);return}n(0,be=!0),n(4,ft=Ye.features??[]),n(10,he=Ye.lngLat)}}function dn(Ye){if(xt==="justOpened"){n(25,xt="normal");return}if(!B)return;let Ct=[Bt,l instanceof Ts.Marker?l==null?void 0:l.getElement():null];be&&dt.isOpen()&&!Ct.some($e=>$e==null?void 0:$e.contains(Ye.originalEvent.target))&&(Ye.type==="contextmenu"&&ie==="contextmenu"||Ye.type!=="contextmenu")&&n(0,be=!1)}vo(()=>{h&&(dt!=null&&dt.isOpen())&&dt.remove()});let Ot;const Se=()=>n(0,be=!1);function lt(Ye){Kn[Ye?"unshift":"push"](()=>{Ot=Ye,n(1,Ot)})}return s.$$set=Ye=>{"closeButton"in Ye&&n(11,N=Ye.closeButton),"closeOnClickOutside"in Ye&&n(12,B=Ye.closeOnClickOutside),"closeOnClickInside"in Ye&&n(13,U=Ye.closeOnClickInside),"closeOnMove"in Ye&&n(14,ee=Ye.closeOnMove),"openOn"in Ye&&n(15,ie=Ye.openOn),"openIfTopMost"in Ye&&n(16,se=Ye.openIfTopMost),"focusAfterOpen"in Ye&&n(17,Q=Ye.focusAfterOpen),"anchor"in Ye&&n(18,K=Ye.anchor),"offset"in Ye&&n(19,pe=Ye.offset),"popupClass"in Ye&&n(20,ve=Ye.popupClass),"maxWidth"in Ye&&n(21,De=Ye.maxWidth),"lngLat"in Ye&&n(10,he=Ye.lngLat),"html"in Ye&&n(22,xe=Ye.html),"open"in Ye&&n(0,be=Ye.open),"$$scope"in Ye&&n(29,T=Ye.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&14336&&n(27,r=N??(!B&&!U)),s.$$.dirty[0]&146685952&&(dt||(n(23,dt=new Ts.Popup({closeButton:r,closeOnClick:!1,closeOnMove:ee,focusAfterOpen:Q,maxWidth:De,className:ve,anchor:K,offset:pe})),Bt=dt.getElement(),dt.on("open",()=>{n(0,be=!0),vt(),Ce("open",dt)}),dt.on("close",()=>{n(0,be=!1),Ce("close",dt)}),dt.on("hover",()=>{Ce("hover",dt)}))),s.$$.dirty[0]&8421384&&dt&&l instanceof Ts.Marker&&(ie==="click"?l.setPopup(dt):l.getPopup()===dt&&l.setPopup(void 0)),s.$$.dirty[0]&268468224&&St.includes(ie)&&(m==null?void 0:m.type)===ie&&(It(m),Nn(Ue,m=null,m)),s.$$.dirty[0]&268468224&&n(26,a=ie==="hover"&&((m==null?void 0:m.type)==="mousemove"||(m==null?void 0:m.type)==="mouseenter")),s.$$.dirty[0]&352354304&&ie==="hover"&&Ue&&(a&&m&&(m.layerType==="deckgl"?(n(10,he=m.coordinate),n(4,ft=m.object?[m.object]:null)):(n(10,he=m.lngLat),n(4,ft=m.features??[]))),n(0,be=(a||ut)??!1)),s.$$.dirty[0]&12582914&&(Ot?dt.setDOMContent(Ot):xe&&dt.setHTML(xe)),s.$$.dirty[0]&8389632&&he&&dt.setLngLat(he),s.$$.dirty[0]&41943045&&h){let Ye=dt.isOpen();be&&!Ye?(dt.addTo(h),xt==="opening"&&n(25,xt="justOpened")):!be&&Ye&&dt.remove()}},[be,Ot,h,l,ft,we,ye,Ue,qe,C,he,N,B,U,ee,ie,se,Q,K,pe,ve,De,xe,dt,ut,xt,a,r,m,T,S,Se,lt]}class nk extends fn{constructor(e){super(),hn(this,e,tk,ek,an,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var nc=Math.pow,ps=(s,e,n)=>new Promise((r,a)=>{var h=x=>{try{l(n.next(x))}catch(S){a(S)}},m=x=>{try{l(n.throw(x))}catch(S){a(S)}},l=x=>x.done?r(x.value):Promise.resolve(x.value).then(h,m);l((n=n.apply(s,e)).next())}),eo=Uint8Array,Yu=Uint16Array,ik=Int32Array,Mv=new eo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Rv=new eo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rk=new eo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Pv=function(s,e){for(var n=new Yu(31),r=0;r<31;++r)n[r]=e+=1<<s[r-1];for(var a=new ik(n[30]),r=1;r<30;++r)for(var h=n[r];h<n[r+1];++h)a[h]=h-n[r]<<5|r;return{b:n,r:a}},Dv=Pv(Mv,2),Nv=Dv.b,sk=Dv.r;Nv[28]=258,sk[258]=28;var ok=Pv(Rv,0),ak=ok.b,Tp=new Yu(32768);for(yi=0;yi<32768;++yi)Ca=(yi&43690)>>1|(yi&21845)<<1,Ca=(Ca&52428)>>2|(Ca&13107)<<2,Ca=(Ca&61680)>>4|(Ca&3855)<<4,Tp[yi]=((Ca&65280)>>8|(Ca&255)<<8)>>1;var Ca,yi,kh=function(s,e,n){for(var r=s.length,a=0,h=new Yu(e);a<r;++a)s[a]&&++h[s[a]-1];var m=new Yu(e);for(a=1;a<e;++a)m[a]=m[a-1]+h[a-1]<<1;var l;if(n){l=new Yu(1<<e);var x=15-e;for(a=0;a<r;++a)if(s[a])for(var S=a<<4|s[a],T=e-s[a],C=m[s[a]-1]++<<T,N=C|(1<<T)-1;C<=N;++C)l[Tp[C]>>x]=S}else for(l=new Yu(r),a=0;a<r;++a)s[a]&&(l[a]=Tp[m[s[a]-1]++]>>15-s[a]);return l},Oh=new eo(288);for(yi=0;yi<144;++yi)Oh[yi]=8;var yi;for(yi=144;yi<256;++yi)Oh[yi]=9;var yi;for(yi=256;yi<280;++yi)Oh[yi]=7;var yi;for(yi=280;yi<288;++yi)Oh[yi]=8;var yi,zv=new eo(32);for(yi=0;yi<32;++yi)zv[yi]=5;var yi,lk=kh(Oh,9,1),uk=kh(zv,5,1),up=function(s){for(var e=s[0],n=1;n<s.length;++n)s[n]>e&&(e=s[n]);return e},Lo=function(s,e,n){var r=e/8|0;return(s[r]|s[r+1]<<8)>>(e&7)&n},cp=function(s,e){var n=e/8|0;return(s[n]|s[n+1]<<8|s[n+2]<<16)>>(e&7)},ck=function(s){return(s+7)/8|0},hk=function(s,e,n){(e==null||e<0)&&(e=0),(n==null||n>s.length)&&(n=s.length);var r=new eo(n-e);return r.set(s.subarray(e,n)),r},fk=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qs=function(s,e,n){var r=new Error(e||fk[s]);if(r.code=s,Error.captureStackTrace&&Error.captureStackTrace(r,Qs),!n)throw r;return r},Hp=function(s,e,n,r){var a=s.length,h=r?r.length:0;if(!a||e.f&&!e.l)return n||new eo(0);var m=!n||e.i!=2,l=e.i;n||(n=new eo(a*3));var x=function(dn){var Ot=n.length;if(dn>Ot){var Se=new eo(Math.max(Ot*2,dn));Se.set(n),n=Se}},S=e.f||0,T=e.p||0,C=e.b||0,N=e.l,B=e.d,U=e.m,ee=e.n,ie=a*8;do{if(!N){S=Lo(s,T,1);var se=Lo(s,T+1,3);if(T+=3,se)if(se==1)N=lk,B=uk,U=9,ee=5;else if(se==2){var ve=Lo(s,T,31)+257,De=Lo(s,T+10,15)+4,he=ve+Lo(s,T+5,31)+1;T+=14;for(var xe=new eo(he),be=new eo(19),Ce=0;Ce<De;++Ce)be[rk[Ce]]=Lo(s,T+Ce*3,7);T+=De*3;for(var we=up(be),ye=(1<<we)-1,Ue=kh(be,we,1),Ce=0;Ce<he;){var qe=Ue[Lo(s,T,ye)];T+=qe&15;var Q=qe>>4;if(Q<16)xe[Ce++]=Q;else{var pt=0,St=0;for(Q==16?(St=3+Lo(s,T,3),T+=2,pt=xe[Ce-1]):Q==17?(St=3+Lo(s,T,7),T+=3):Q==18&&(St=11+Lo(s,T,127),T+=7);St--;)xe[Ce++]=pt}}var dt=xe.subarray(0,ve),ut=xe.subarray(ve);U=up(dt),ee=up(ut),N=kh(dt,U,1),B=kh(ut,ee,1)}else Qs(1);else{var Q=ck(T)+4,K=s[Q-4]|s[Q-3]<<8,pe=Q+K;if(pe>a){l&&Qs(0);break}m&&x(C+K),n.set(s.subarray(Q,pe),C),e.b=C+=K,e.p=T=pe*8,e.f=S;continue}if(T>ie){l&&Qs(0);break}}m&&x(C+131072);for(var Bt=(1<<U)-1,vt=(1<<ee)-1,wt=T;;wt=T){var pt=N[cp(s,T)&Bt],ft=pt>>4;if(T+=pt&15,T>ie){l&&Qs(0);break}if(pt||Qs(2),ft<256)n[C++]=ft;else if(ft==256){wt=T,N=null;break}else{var xt=ft-254;if(ft>264){var Ce=ft-257,It=Mv[Ce];xt=Lo(s,T,(1<<It)-1)+Nv[Ce],T+=It}var Yt=B[cp(s,T)&vt],pn=Yt>>4;Yt||Qs(3),T+=Yt&15;var ut=ak[pn];if(pn>3){var It=Rv[pn];ut+=cp(s,T)&(1<<It)-1,T+=It}if(T>ie){l&&Qs(0);break}m&&x(C+131072);var Dn=C+xt;if(C<ut){var We=h-ut,Xn=Math.min(ut,Dn);for(We+C<0&&Qs(3);C<Xn;++C)n[C]=r[We+C]}for(;C<Dn;C+=4)n[C]=n[C-ut],n[C+1]=n[C+1-ut],n[C+2]=n[C+2-ut],n[C+3]=n[C+3-ut];C=Dn}}e.l=N,e.p=wt,e.b=C,e.f=S,N&&(S=1,e.m=U,e.d=B,e.n=ee)}while(!S);return C==n.length?n:hk(n,0,C)},dk=new eo(0),pk=function(s){(s[0]!=31||s[1]!=139||s[2]!=8)&&Qs(6,"invalid gzip data");var e=s[3],n=10;e&4&&(n+=(s[10]|s[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!s[n++]);return n+(e&2)},mk=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},gk=function(s,e){return((s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31)&&Qs(6,"invalid zlib data"),(s[1]>>5&1)==+!e&&Qs(6,"invalid zlib data: "+(s[1]&32?"need":"unexpected")+" dictionary"),(s[1]>>3&4)+2};function _k(s,e){return Hp(s,{i:2},e&&e.out,e&&e.dictionary)}function yk(s,e){var n=pk(s);return n+8>s.length&&Qs(6,"invalid gzip data"),Hp(s.subarray(n,-8),{i:2},e&&e.out||new eo(mk(s)),e&&e.dictionary)}function vk(s,e){return Hp(s.subarray(gk(s,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Cp(s,e){return s[0]==31&&s[1]==139&&s[2]==8?yk(s,e):(s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?_k(s,e):vk(s,e)}var bk=typeof TextDecoder<"u"&&new TextDecoder,xk=0;try{bk.decode(dk,{stream:!0}),xk=1}catch{}var Fv=(s,e)=>s*nc(2,e),fh=(s,e)=>Math.floor(s/nc(2,e)),Vf=(s,e)=>Fv(s.getUint16(e+1,!0),8)+s.getUint8(e),Ov=(s,e)=>Fv(s.getUint32(e+2,!0),16)+s.getUint16(e,!0),wk=(s,e,n,r,a)=>{if(s!==r.getUint8(a))return s-r.getUint8(a);const h=Vf(r,a+1);if(e!==h)return e-h;const m=Vf(r,a+4);return n!==m?n-m:0},kk=(s,e,n,r)=>{const a=Bv(s,e|128,n,r);return a?{z:e,x:n,y:r,offset:a[0],length:a[1],isDir:!0}:null},H_=(s,e,n,r)=>{const a=Bv(s,e,n,r);return a?{z:e,x:n,y:r,offset:a[0],length:a[1],isDir:!1}:null},Bv=(s,e,n,r)=>{let a=0,h=s.byteLength/17-1;for(;a<=h;){const m=h+a>>1,l=wk(e,n,r,s,m*17);if(l>0)a=m+1;else if(l<0)h=m-1;else return[Ov(s,m*17+7),s.getUint32(m*17+13,!0)]}return null},Ik=(s,e)=>s.isDir&&!e.isDir?1:!s.isDir&&e.isDir?-1:s.z!==e.z?s.z-e.z:s.x!==e.x?s.x-e.x:s.y-e.y,Uv=(s,e)=>{const n=s.getUint8(e*17);return{z:n&127,x:Vf(s,e*17+1),y:Vf(s,e*17+4),offset:Ov(s,e*17+7),length:s.getUint32(e*17+13,!0),isDir:n>>7===1}},X_=s=>{const e=[],n=new DataView(s);for(let r=0;r<n.byteLength/17;r++)e.push(Uv(n,r));return Sk(e)},Sk=s=>{s.sort(Ik);const e=new ArrayBuffer(17*s.length),n=new Uint8Array(e);for(let r=0;r<s.length;r++){const a=s[r];let h=a.z;a.isDir&&(h=h|128),n[r*17]=h,n[r*17+1]=a.x&255,n[r*17+2]=a.x>>8&255,n[r*17+3]=a.x>>16&255,n[r*17+4]=a.y&255,n[r*17+5]=a.y>>8&255,n[r*17+6]=a.y>>16&255,n[r*17+7]=a.offset&255,n[r*17+8]=fh(a.offset,8)&255,n[r*17+9]=fh(a.offset,16)&255,n[r*17+10]=fh(a.offset,24)&255,n[r*17+11]=fh(a.offset,32)&255,n[r*17+12]=fh(a.offset,48)&255,n[r*17+13]=a.length&255,n[r*17+14]=a.length>>8&255,n[r*17+15]=a.length>>16&255,n[r*17+16]=a.length>>24&255}return e},Ek=(s,e)=>{if(s.byteLength<17)return null;const n=s.byteLength/17,r=Uv(s,n-1);if(r.isDir){const a=r.z,h=e.z-a,m=Math.trunc(e.x/(1<<h)),l=Math.trunc(e.y/(1<<h));return{z:a,x:m,y:l}}return null};function Ak(s){return ps(this,null,function*(){const e=yield s.getBytes(0,512e3),n=new DataView(e.data),r=n.getUint32(4,!0),a=n.getUint16(8,!0),h=new TextDecoder("utf-8"),m=JSON.parse(h.decode(new DataView(e.data,10,r)));let l=0;m.compression==="gzip"&&(l=2);let x=0;"minzoom"in m&&(x=+m.minzoom);let S=0;"maxzoom"in m&&(S=+m.maxzoom);let T=0,C=0,N=0,B=-180,U=-85,ee=180,ie=85;if(m.bounds){const Q=m.bounds.split(",");B=+Q[0],U=+Q[1],ee=+Q[2],ie=+Q[3]}if(m.center){const Q=m.center.split(",");T=+Q[0],C=+Q[1],N=+Q[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:a*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:x,maxZoom:S,minLon:B,minLat:U,maxLon:ee,maxLat:ie,centerZoom:N,centerLon:T,centerLat:C,etag:e.etag}})}function Tk(s,e,n,r,a,h,m){return ps(this,null,function*(){let l=yield n.getArrayBuffer(e,s.rootDirectoryOffset,s.rootDirectoryLength,s);s.specVersion===1&&(l=X_(l));const x=H_(new DataView(l),r,a,h);if(x){let C=(yield e.getBytes(x.offset,x.length,m)).data;const N=new DataView(C);return N.getUint8(0)===31&&N.getUint8(1)===139&&(C=Cp(new Uint8Array(C))),{data:C}}const S=Ek(new DataView(l),{z:r,x:a,y:h});if(S){const T=kk(new DataView(l),S.z,S.x,S.y);if(T){let C=yield n.getArrayBuffer(e,T.offset,T.length,s);s.specVersion===1&&(C=X_(C));const N=H_(new DataView(C),r,a,h);if(N){let U=(yield e.getBytes(N.offset,N.length,m)).data;const ee=new DataView(U);return ee.getUint8(0)===31&&ee.getUint8(1)===139&&(U=Cp(new Uint8Array(U))),{data:U}}}}})}var jv={getHeader:Ak,getZxy:Tk},Ck=s=>(e,n)=>{if(n instanceof AbortController)return s(e,n);const r=new AbortController;return s(e,r).then(a=>n(void 0,a.data,a.cacheControl||"",a.expires||""),a=>n(a)).catch(a=>n(a)),{cancel:()=>r.abort()}},Lk=class{constructor(){this.tilev4=(s,e)=>ps(this,null,function*(){if(s.type==="json"){const C=s.url.substr(10);let N=this.tiles.get(C);N||(N=new W_(C),this.tiles.set(C,N));const B=yield N.getHeader();return{data:{tiles:[`${s.url}/{z}/{x}/{y}`],minzoom:B.minZoom,maxzoom:B.maxZoom,bounds:[B.minLon,B.minLat,B.maxLon,B.maxLat]}}}const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=s.url.match(n);if(!r)throw new Error("Invalid PMTiles protocol URL");const a=r[1];let h=this.tiles.get(a);h||(h=new W_(a),this.tiles.set(a,h));const m=r[2],l=r[3],x=r[4],S=yield h.getHeader(),T=yield h==null?void 0:h.getZxy(+m,+l,+x,e.signal);return T?{data:new Uint8Array(T.data),cacheControl:T.cacheControl,expires:T.expires}:S.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=Ck(this.tilev4),this.tiles=new Map}add(s){this.tiles.set(s.source.getKey(),s)}get(s){return this.tiles.get(s)}};function Xu(s,e){return(e>>>0)*4294967296+(s>>>0)}function Mk(s,e){const n=e.buf;let r=n[e.pos++],a=(r&112)>>4;if(r<128||(r=n[e.pos++],a|=(r&127)<<3,r<128)||(r=n[e.pos++],a|=(r&127)<<10,r<128)||(r=n[e.pos++],a|=(r&127)<<17,r<128)||(r=n[e.pos++],a|=(r&127)<<24,r<128)||(r=n[e.pos++],a|=(r&1)<<31,r<128))return Xu(s,a);throw new Error("Expected varint not more than 10 bytes")}function dh(s){const e=s.buf;let n=e[s.pos++],r=n&127;return n<128||(n=e[s.pos++],r|=(n&127)<<7,n<128)||(n=e[s.pos++],r|=(n&127)<<14,n<128)||(n=e[s.pos++],r|=(n&127)<<21,n<128)?r:(n=e[s.pos],r|=(n&15)<<28,Mk(r,s))}function Rk(s,e,n,r){if(r===0){n===1&&(e[0]=s-1-e[0],e[1]=s-1-e[1]);const a=e[0];e[0]=e[1],e[1]=a}}var Pk=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Dk(s,e,n){if(s>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>nc(2,s)-1||n>nc(2,s)-1)throw Error("tile x/y outside zoom level bounds");const r=Pk[s],a=nc(2,s);let h=0,m=0,l=0;const x=[e,n];let S=a/2;for(;S>0;)h=(x[0]&S)>0?1:0,m=(x[1]&S)>0?1:0,l+=S*S*(3*h^m),Rk(S,x,h,m),S=S/2;return r+l}function qv(s,e){return ps(this,null,function*(){if(e===1||e===0)return s;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Cp(new Uint8Array(s));const n=new Response(s).body;if(!n)throw Error("Failed to read response stream");const r=n.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw Error("Compression method not supported")})}var Nk=127;function zk(s,e){let n=0,r=s.length-1;for(;n<=r;){const a=r+n>>1,h=e-s[a].tileId;if(h>0)n=a+1;else if(h<0)r=a-1;else return s[a]}return r>=0&&(s[r].runLength===0||e-s[r].tileId<s[r].runLength)?s[r]:null}var Fk=class{constructor(s,e=new Headers){this.url=s,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(s){this.customHeaders=s}getBytes(s,e,n,r){return ps(this,null,function*(){let a,h;n?h=n:(a=new AbortController,h=a.signal);const m=new Headers(this.customHeaders);m.set("range",`bytes=${s}-${s+e-1}`);let l;this.mustReload&&(l="reload");let x=yield fetch(this.url,{signal:h,cache:l,headers:m});if(s===0&&x.status===416){const N=x.headers.get("Content-Range");if(!N||!N.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const B=+N.substr(8);x=yield fetch(this.url,{signal:h,cache:"reload",headers:{range:`bytes=0-${B-1}`}})}let S=x.headers.get("Etag");if(S!=null&&S.startsWith("W/")&&(S=null),x.status===416||r&&S&&S!==r)throw this.mustReload=!0,new Lp(`Server returned non-matching ETag ${r} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(x.status>=300)throw Error(`Bad response code: ${x.status}`);const T=x.headers.get("Content-Length");if(x.status===200&&(!T||+T>e))throw a&&a.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield x.arrayBuffer(),etag:S||void 0,cacheControl:x.headers.get("Cache-Control")||void 0,expires:x.headers.get("Expires")||void 0}})}};function Mo(s,e){const n=s.getUint32(e+4,!0),r=s.getUint32(e+0,!0);return n*nc(2,32)+r}function Ok(s,e){const n=new DataView(s),r=n.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Mo(n,8),rootDirectoryLength:Mo(n,16),jsonMetadataOffset:Mo(n,24),jsonMetadataLength:Mo(n,32),leafDirectoryOffset:Mo(n,40),leafDirectoryLength:Mo(n,48),tileDataOffset:Mo(n,56),tileDataLength:Mo(n,64),numAddressedTiles:Mo(n,72),numTileEntries:Mo(n,80),numTileContents:Mo(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function Vv(s){const e={buf:new Uint8Array(s),pos:0},n=dh(e),r=[];let a=0;for(let h=0;h<n;h++){const m=dh(e);r.push({tileId:a+m,offset:0,length:0,runLength:1}),a+=m}for(let h=0;h<n;h++)r[h].runLength=dh(e);for(let h=0;h<n;h++)r[h].length=dh(e);for(let h=0;h<n;h++){const m=dh(e);m===0&&h>0?r[h].offset=r[h-1].offset+r[h-1].length:r[h].offset=m-1}return r}function Bk(s){const e=new DataView(s);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Lp=class extends Error{};function Uk(s,e){return ps(this,null,function*(){const n=yield s.getBytes(0,16384);if(new DataView(n.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Bk(n.data)<3)return[yield jv.getHeader(s)];const a=n.data.slice(0,Nk),h=Ok(a,n.etag),m=n.data.slice(h.rootDirectoryOffset,h.rootDirectoryOffset+h.rootDirectoryLength),l=`${s.getKey()}|${h.etag||""}|${h.rootDirectoryOffset}|${h.rootDirectoryLength}`,x=Vv(yield e(m,h.internalCompression));return[h,[l,x.length,x]]})}function jk(s,e,n,r,a){return ps(this,null,function*(){const h=yield s.getBytes(n,r,void 0,a.etag),m=yield e(h.data,a.internalCompression),l=Vv(m);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var qk=class{constructor(s=100,e=!0,n=qv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=s,this.counter=1,this.decompress=n}getHeader(s){return ps(this,null,function*(){const e=s.getKey(),n=this.cache.get(e);if(n)return n.lastUsed=this.counter++,yield n.data;const r=new Promise((a,h)=>{Uk(s,this.decompress).then(m=>{m[1]&&this.cache.set(m[1][0],{lastUsed:this.counter++,data:Promise.resolve(m[1][2])}),a(m[0]),this.prune()}).catch(m=>{h(m)})});return this.cache.set(e,{lastUsed:this.counter++,data:r}),r})}getDirectory(s,e,n,r){return ps(this,null,function*(){const a=`${s.getKey()}|${r.etag||""}|${e}|${n}`,h=this.cache.get(a);if(h)return h.lastUsed=this.counter++,yield h.data;const m=new Promise((l,x)=>{jk(s,this.decompress,e,n,r).then(S=>{l(S),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}getArrayBuffer(s,e,n,r){return ps(this,null,function*(){const a=`${s.getKey()}|${r.etag||""}|${e}|${n}`,h=this.cache.get(a);if(h)return h.lastUsed=this.counter++,yield h.data;const m=new Promise((l,x)=>{s.getBytes(e,n,void 0,r.etag).then(S=>{l(S.data),this.cache.has(a),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}prune(){if(this.cache.size>=this.maxCacheEntries){let s=1/0,e;this.cache.forEach((n,r)=>{n.lastUsed<s&&(s=n.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(s){return ps(this,null,function*(){const e=s.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(s.getKey());const n=new Promise((r,a)=>{this.getHeader(s).then(h=>{r(),this.invalidations.delete(e)}).catch(h=>{a(h)})});this.invalidations.set(e,n)})}},W_=class{constructor(s,e,n){typeof s=="string"?this.source=new Fk(s):this.source=s,n?this.decompress=n:this.decompress=qv,e?this.cache=e:this.cache=new qk}getHeader(){return ps(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(s,e,n,r){return ps(this,null,function*(){const a=Dk(s,e,n),h=yield this.cache.getHeader(this.source);if(h.specVersion<3)return jv.getZxy(h,this.source,this.cache,s,e,n,r);if(s<h.minZoom||s>h.maxZoom)return;let m=h.rootDirectoryOffset,l=h.rootDirectoryLength;for(let x=0;x<=3;x++){const S=yield this.cache.getDirectory(this.source,m,l,h),T=zk(S,a);if(T){if(T.runLength>0){const C=yield this.source.getBytes(h.tileDataOffset+T.offset,T.length,r,h.etag);return{data:yield this.decompress(C.data,h.tileCompression),cacheControl:C.cacheControl,expires:C.expires}}m=h.leafDirectoryOffset+T.offset,l=T.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(s,e,n,r){return ps(this,null,function*(){try{return yield this.getZxyAttempt(s,e,n,r)}catch(a){if(a instanceof Lp)return this.cache.invalidate(this.source),yield this.getZxyAttempt(s,e,n,r);throw a}})}getMetadataAttempt(){return ps(this,null,function*(){const s=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(s.jsonMetadataOffset,s.jsonMetadataLength,void 0,s.etag),n=yield this.decompress(e.data,s.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(n))})}getMetadata(){return ps(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(s){if(s instanceof Lp)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw s}})}};const Vk=s=>({props:s&8}),K_=s=>({props:Hk(s[3])});function Gk(s){let e;const n=s[1].default,r=Zi(n,s,s[2],K_);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&12)&&Xi(r,n,a,a[2],e?Hi(n,a[2],h,Vk):Wi(a[2]),K_)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function Zk(s){let e,n;return e=new nk({props:{openOn:s[0],$$slots:{default:[Gk,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,[a]){const h={};a&1&&(h.openOn=r[0]),a&12&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function Hk(s){return s?s[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function Xk(s,e,n){let{$$slots:r={},$$scope:a}=e,{openOn:h="hover"}=e;return s.$$set=m=>{"openOn"in m&&n(0,h=m.openOn),"$$scope"in m&&n(2,a=m.$$scope)},[h,r,a]}class js extends fn{constructor(e){super(),hn(this,e,Xk,Zk,an,{openOn:0})}}function Xp(s,e,n){let r=["match",s];for(let[a,h]of Object.entries(e))r.push(a),r.push(h);return r.push(n),r}function Gf(s,e,n){let r=["step",s];for(let a=1;a<e.length;a++)r.push(n[a-1]),r.push(e[a]);return r.push(n[n.length-1]),r}function Mf(){return{type:"FeatureCollection",features:[]}}let Wk=Date.now();function dc(s){return`${s}-${Wk++}`}const Wp=Symbol.for("svelte-maplibre");function pc(){return Q0(Wp)}function Kk(s){let e=new WeakMap;return n=>{var m;let r=e.get(n.originalEvent);if(r!==void 0)return r;let h=(m=n.target.queryRenderedFeatures(n.point).find(l=>{var x;return(x=s.get(l.layer.id))==null?void 0:x.interactive}))==null?void 0:m.layer.id;return e.set(n.originalEvent,h),h}}function $k(){let s=new Map;return J0(Wp,{map:Yn(null),source:lp(null),layer:lp(null),popupTarget:lp(null),cluster:Yn(),loadedImages:Yn(new Set),minzoom:Yn(0),maxzoom:Yn(24),layerEvent:Yn(null),layerInfo:s,eventTopMost:Kk(s),markerClickManager:new Qk})}function $_(s){return{subscribe:s.subscribe}}function Kp({key:s,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:r=!1}){let a=pc(),h=Yn(null),m=$_(h),l={...a,[s]:$_(h)};if(e&&(l.popupTarget=m),r){let x=Yn(null);l.layerEvent=x,a.layerEvent=x}return n&&(l.cluster=Yn()),J0(Wp,l),{...a,self:h}}function Gv(){return Kp({key:"source",setCluster:!0})}function Yk(s=!0){return Kp({key:"layer",setPopupTarget:s,setMouseEvent:s})}function Jk(){return Kp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Qk{constructor(){lh(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const n of this._handlers)n(e)}}function Y_(s){let e;return n=>{if(n)for(let r in n){let a=e==null?void 0:e[r],h=n[r];a!==h&&s(r,h,a)}else if(e)for(let r in e)s(r,void 0,e[r]);e=n}}function eI(s,...e){let n=[s];for(let r of e)if(r)Array.isArray(r)&&r[0]===s?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function tI(s){return s===!0?["has","point_count"]:s===!1?["!",["has","point_count"]]:void 0}function Cs(s,e){return["case",["boolean",["feature-state","hover"],!1],e,s]}function J_(s){let e=s[0],n,r,a=Q_(s);return{c(){a.c(),n=ni()},m(h,m){a.m(h,m),ae(h,n,m),r=!0},p(h,m){m[0]&1&&an(e,e=h[0])?(zn(),Ie(a,1,1,tt),Fn(),a=Q_(h),a.c(),_e(a,1),a.m(n.parentNode,n)):a.p(h,m)},i(h){r||(_e(a),r=!0)},o(h){Ie(a),r=!1},d(h){h&&oe(n),a.d(h)}}}function Q_(s){let e;const n=s[36].default,r=Zi(n,s,s[35],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h[1]&16)&&Xi(r,n,a,a[35],e?Hi(n,a[35],h,null):Wi(a[35]),null)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function nI(s){let e,n,r=s[0]&&J_(s);return{c(){r&&r.c(),e=ni()},m(a,h){r&&r.m(a,h),ae(a,e,h),n=!0},p(a,h){a[0]?r?(r.p(a,h),h[0]&1&&_e(r,1)):(r=J_(a),r.c(),_e(r,1),r.m(e.parentNode,e)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d(a)}}}function iI(s,e,n){let r,a,h,m,l,x,S,T,C,N,B,U,{$$slots:ee={},$$scope:ie}=e,{id:se=dc("layer")}=e,{source:Q=void 0}=e,{sourceLayer:K=void 0}=e,{beforeId:pe=void 0}=e,{beforeLayerType:ve=void 0}=e,{type:De}=e,{paint:he=void 0}=e,{layout:xe=void 0}=e,{filter:be=void 0}=e,{applyToClusters:Ce=void 0}=e,{minzoom:we=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:Ue=!1}=e,{hovered:qe=null}=e,{interactive:pt=!0}=e,{hoverCursor:St=void 0}=e,{eventsIfTopMost:dt=!1}=e;const ut=hc(),{map:Bt,source:vt,self:wt,minzoom:ft,maxzoom:xt,eventTopMost:It,layerInfo:Yt}=Yk();Ft(s,Bt,lt=>n(31,C=lt)),Ft(s,vt,lt=>n(32,N=lt)),Ft(s,wt,lt=>n(0,T=lt)),Ft(s,ft,lt=>n(34,U=lt)),Ft(s,xt,lt=>n(33,B=lt)),vo(()=>{T&&C&&(Yt.delete(T),C==null||C.removeLayer(T))});let pn;function Dn(lt){var kt,qt;if(!pt||!T||!C||dt&&It(lt)!==T)return;let Ye=lt.features??[],Ct=(qt=(kt=Ye[0])==null?void 0:kt.properties)==null?void 0:qt.cluster_id,$e={event:lt,map:C,clusterId:Ct,layer:T,source:l,features:Ye};ut(lt.type,$e)}function We(lt){var kt,qt;if(!pt||!T||!C||dt&&It(lt)!==T)return;St&&(C.getCanvas().style.cursor=St);let Ye=lt.features??[];n(6,qe=Ye[0]??null);let Ct=(qt=(kt=Ye[0])==null?void 0:kt.properties)==null?void 0:qt.cluster_id;ut("mouseenter",{event:lt,map:C,clusterId:Ct,layer:T,source:l,features:Ye})}function Xn(lt){var kt,qt,Ee;if(!pt||!C)return;if(dt&&It(lt)!==T){n(6,qe=null),Ue&&pn!==void 0&&(C==null||C.setFeatureState({source:l,sourceLayer:K,id:pn},{hover:!1}),pn=void 0);return}C.getCanvas().style.cursor=St;let Ye=lt.features??[],Ct=(qt=(kt=Ye[0])==null?void 0:kt.properties)==null?void 0:qt.cluster_id,$e=(Ee=Ye[0])==null?void 0:Ee.id;$e!==pn&&(Ue&&(pn!==void 0&&(C==null||C.setFeatureState({source:l,id:pn,sourceLayer:K},{hover:!1})),C==null||C.setFeatureState({source:l,id:$e,sourceLayer:K},{hover:!0})),pn=$e,n(6,qe=Ye[0]??null)),ut("mousemove",{event:lt,map:C,clusterId:Ct,layer:T,source:l,features:Ye})}function dn(lt){if(!(!pt||!T||!C)){if(St&&(C.getCanvas().style.cursor=""),n(6,qe=null),Ue&&pn!==void 0){const Ye={source:l,id:pn,sourceLayer:K};C==null||C.setFeatureState(Ye,{hover:!1}),pn=void 0}ut("mouseleave",{map:C,layer:T,source:l})}}let Ot=!0;function Se(lt){C&&(C.off("click",lt,Dn),C.off("dblclick",lt,Dn),C.off("contextmenu",lt,Dn),C.off("mouseenter",lt,We),C.off("mousemove",lt,Xn),C.off("mouseleave",lt,dn))}return vo(()=>{C&&T&&Se(T)}),s.$$set=lt=>{"id"in lt&&n(7,se=lt.id),"source"in lt&&n(8,Q=lt.source),"sourceLayer"in lt&&n(9,K=lt.sourceLayer),"beforeId"in lt&&n(10,pe=lt.beforeId),"beforeLayerType"in lt&&n(11,ve=lt.beforeLayerType),"type"in lt&&n(12,De=lt.type),"paint"in lt&&n(13,he=lt.paint),"layout"in lt&&n(14,xe=lt.layout),"filter"in lt&&n(15,be=lt.filter),"applyToClusters"in lt&&n(16,Ce=lt.applyToClusters),"minzoom"in lt&&n(17,we=lt.minzoom),"maxzoom"in lt&&n(18,ye=lt.maxzoom),"manageHoverState"in lt&&n(19,Ue=lt.manageHoverState),"hovered"in lt&&n(6,qe=lt.hovered),"interactive"in lt&&n(20,pt=lt.interactive),"hoverCursor"in lt&&n(21,St=lt.hoverCursor),"eventsIfTopMost"in lt&&n(22,dt=lt.eventsIfTopMost),"$$scope"in lt&&n(35,ie=lt.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&65536&&n(30,r=tI(Ce)),s.$$.dirty[0]&1073774592&&n(24,a=eI("all",r,be)),s.$$.dirty[0]&131072|s.$$.dirty[1]&8&&n(26,h=we??U),s.$$.dirty[0]&262144|s.$$.dirty[1]&4&&n(25,m=ye??B),s.$$.dirty[0]&256|s.$$.dirty[1]&2&&n(29,l=Q||N),s.$$.dirty[0]&654343809|s.$$.dirty[1]&1&&C&&T!==se&&l){T&&(Se(T),Yt.delete(T));let lt=pe;if(!pe&&ve){let Ye=C.getStyle().layers,Ct=typeof ve=="function"?ve:kt=>kt.type===ve,$e=Ye==null?void 0:Ye.find(Ct);$e&&(lt=$e.id)}Nn(wt,T=se,T),C.addLayer(Rh({id:T,type:De,source:l,"source-layer":K,filter:a,paint:he,layout:xe,minzoom:h,maxzoom:m}),lt),n(23,Ot=!0),C.on("click",T,Dn),C.on("dblclick",T,Dn),C.on("contextmenu",T,Dn),C.on("mouseenter",T,We),C.on("mousemove",T,Xn),C.on("mouseleave",T,dn)}s.$$.dirty[0]&1048577&&T&&Yt.set(T,{interactive:pt}),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&n(28,x=T?Y_((lt,Ye)=>C==null?void 0:C.setPaintProperty(T,lt,Ye)):void 0),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&n(27,S=T?Y_((lt,Ye)=>C==null?void 0:C.setLayoutProperty(T,lt,Ye)):void 0),s.$$.dirty[0]&268443648&&(x==null||x(he)),s.$$.dirty[0]&134234112&&(S==null||S(xe)),s.$$.dirty[0]&100663297|s.$$.dirty[1]&1&&T&&(C==null||C.setLayerZoomRange(T,h,m)),s.$$.dirty[0]&25165825|s.$$.dirty[1]&1&&T&&(Ot?n(23,Ot=!1):C==null||C.setFilter(T,a))},[T,Bt,vt,wt,ft,xt,qe,se,Q,K,pe,ve,De,he,xe,be,Ce,we,ye,Ue,pt,St,dt,Ot,a,m,h,S,x,l,r,C,N,B,U,ie,ee]}class $p extends fn{constructor(e){super(),hn(this,e,iI,nI,an,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function rI(s){let e;const n=s[16].default,r=Zi(n,s,s[24],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&16777216)&&Xi(r,n,a,a[24],e?Hi(n,a[24],h,null):Wi(a[24]),null)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function sI(s){let e,n,r;function a(m){s[17](m)}let h={id:s[1],type:"circle",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[rI]},$$scope:{ctx:s}};return s[0]!==void 0&&(h.hovered=s[0]),e=new $p({props:h}),Kn.push(()=>gr(e,"hovered",a)),e.$on("click",s[18]),e.$on("dblclick",s[19]),e.$on("contextmenu",s[20]),e.$on("mouseenter",s[21]),e.$on("mousemove",s[22]),e.$on("mouseleave",s[23]),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),r=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.applyToClusters=m[9]),l&1024&&(x.minzoom=m[10]),l&2048&&(x.maxzoom=m[11]),l&4096&&(x.hoverCursor=m[12]),l&8192&&(x.manageHoverState=m[13]),l&16384&&(x.eventsIfTopMost=m[14]),l&32768&&(x.interactive=m[15]),l&16777216&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],mr(()=>n=!1)),e.$set(x)},i(m){r||(_e(e.$$.fragment,m),r=!0)},o(m){Ie(e.$$.fragment,m),r=!1},d(m){rt(e,m)}}}function oI(s,e,n){let{$$slots:r={},$$scope:a}=e,{id:h=dc("circle")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{applyToClusters:B=void 0}=e,{minzoom:U=void 0}=e,{maxzoom:ee=void 0}=e,{hoverCursor:ie=void 0}=e,{manageHoverState:se=!1}=e,{hovered:Q=null}=e,{eventsIfTopMost:K=!1}=e,{interactive:pe=!0}=e;function ve(ye){Q=ye,n(0,Q)}function De(ye){ur.call(this,s,ye)}function he(ye){ur.call(this,s,ye)}function xe(ye){ur.call(this,s,ye)}function be(ye){ur.call(this,s,ye)}function Ce(ye){ur.call(this,s,ye)}function we(ye){ur.call(this,s,ye)}return s.$$set=ye=>{"id"in ye&&n(1,h=ye.id),"source"in ye&&n(2,m=ye.source),"sourceLayer"in ye&&n(3,l=ye.sourceLayer),"beforeId"in ye&&n(4,x=ye.beforeId),"beforeLayerType"in ye&&n(5,S=ye.beforeLayerType),"paint"in ye&&n(6,T=ye.paint),"layout"in ye&&n(7,C=ye.layout),"filter"in ye&&n(8,N=ye.filter),"applyToClusters"in ye&&n(9,B=ye.applyToClusters),"minzoom"in ye&&n(10,U=ye.minzoom),"maxzoom"in ye&&n(11,ee=ye.maxzoom),"hoverCursor"in ye&&n(12,ie=ye.hoverCursor),"manageHoverState"in ye&&n(13,se=ye.manageHoverState),"hovered"in ye&&n(0,Q=ye.hovered),"eventsIfTopMost"in ye&&n(14,K=ye.eventsIfTopMost),"interactive"in ye&&n(15,pe=ye.interactive),"$$scope"in ye&&n(24,a=ye.$$scope)},[Q,h,m,l,x,S,T,C,N,B,U,ee,ie,se,K,pe,r,ve,De,he,xe,be,Ce,we,a]}class Yp extends fn{constructor(e){super(),hn(this,e,oI,sI,an,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function aI(s){let e;const n=s[15].default,r=Zi(n,s,s[23],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&8388608)&&Xi(r,n,a,a[23],e?Hi(n,a[23],h,null):Wi(a[23]),null)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function lI(s){let e,n,r;function a(m){s[16](m)}let h={id:s[1],type:"fill",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[aI]},$$scope:{ctx:s}};return s[0]!==void 0&&(h.hovered=s[0]),e=new $p({props:h}),Kn.push(()=>gr(e,"hovered",a)),e.$on("click",s[17]),e.$on("dblclick",s[18]),e.$on("contextmenu",s[19]),e.$on("mouseenter",s[20]),e.$on("mousemove",s[21]),e.$on("mouseleave",s[22]),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),r=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],mr(()=>n=!1)),e.$set(x)},i(m){r||(_e(e.$$.fragment,m),r=!0)},o(m){Ie(e.$$.fragment,m),r=!1},d(m){rt(e,m)}}}function uI(s,e,n){let{$$slots:r={},$$scope:a}=e,{id:h=dc("fill")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:se=null}=e,{eventsIfTopMost:Q=!1}=e,{interactive:K=!0}=e;function pe(we){se=we,n(0,se)}function ve(we){ur.call(this,s,we)}function De(we){ur.call(this,s,we)}function he(we){ur.call(this,s,we)}function xe(we){ur.call(this,s,we)}function be(we){ur.call(this,s,we)}function Ce(we){ur.call(this,s,we)}return s.$$set=we=>{"id"in we&&n(1,h=we.id),"source"in we&&n(2,m=we.source),"sourceLayer"in we&&n(3,l=we.sourceLayer),"beforeId"in we&&n(4,x=we.beforeId),"beforeLayerType"in we&&n(5,S=we.beforeLayerType),"paint"in we&&n(6,T=we.paint),"layout"in we&&n(7,C=we.layout),"filter"in we&&n(8,N=we.filter),"minzoom"in we&&n(9,B=we.minzoom),"maxzoom"in we&&n(10,U=we.maxzoom),"hoverCursor"in we&&n(11,ee=we.hoverCursor),"manageHoverState"in we&&n(12,ie=we.manageHoverState),"hovered"in we&&n(0,se=we.hovered),"eventsIfTopMost"in we&&n(13,Q=we.eventsIfTopMost),"interactive"in we&&n(14,K=we.interactive),"$$scope"in we&&n(23,a=we.$$scope)},[se,h,m,l,x,S,T,C,N,B,U,ee,ie,Q,K,r,pe,ve,De,he,xe,be,Ce,a]}class mc extends fn{constructor(e){super(),hn(this,e,uI,lI,an,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function cI(s,e,n){let r;const{map:a}=pc();Ft(s,a,x=>n(4,r=x));let{position:h="top-left"}=e,{container:m=void 0}=e,l=null;return vo(()=>{r!=null&&r.loaded()&&l&&r.removeControl(l)}),s.$$set=x=>{"position"in x&&n(1,h=x.position),"container"in x&&n(2,m=x.container)},s.$$.update=()=>{if(s.$$.dirty&30&&r&&!l){let x;typeof m=="string"?x=document.querySelector(m)??void 0:x=m,n(3,l=new Ts.FullscreenControl({container:x})),r.addControl(l,h)}},[a,h,m,l,r]}class hI extends fn{constructor(e){super(),hn(this,e,cI,null,an,{position:1,container:2})}}function Zv(s,e,n,r,a){let h=!1;s.getSource(e)&&(h=!0,s.removeSource(e));const m=()=>{r(e)&&(s.addSource(e,n),a())};if(h){const l=()=>{e&&(s.getSource(e)?setTimeout(l,1):m())};l()}else m()}function Hv(s,e,n){nx().then(()=>{let r=Df(s);if(!r)return;r.getSource(e)===n&&r.removeSource(e)})}function ey(s){let e=s[0],n,r,a=ty(s);return{c(){a.c(),n=ni()},m(h,m){a.m(h,m),ae(h,n,m),r=!0},p(h,m){m&1&&an(e,e=h[0])?(zn(),Ie(a,1,1,tt),Fn(),a=ty(h),a.c(),_e(a,1),a.m(n.parentNode,n)):a.p(h,m)},i(h){r||(_e(a),r=!0)},o(h){Ie(a),r=!1},d(h){h&&oe(n),a.d(h)}}}function ty(s){let e;const n=s[19].default,r=Zi(n,s,s[18],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&262144)&&Xi(r,n,a,a[18],e?Hi(n,a[18],h,null):Wi(a[18]),null)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function fI(s){let e,n,r=s[0]&&ey(s);return{c(){r&&r.c(),e=ni()},m(a,h){r&&r.m(a,h),ae(a,e,h),n=!0},p(a,[h]){a[0]?r?(r.p(a,h),h&1&&_e(r,1)):(r=ey(a),r.c(),_e(r,1),r.m(e.parentNode,e)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d(a)}}}function dI(s,e,n){let r,a,h,{$$slots:m={},$$scope:l}=e,{id:x=dc("geojson")}=e,{data:S}=e,{generateId:T=!1}=e,{promoteId:C=void 0}=e,{filter:N=void 0}=e,{lineMetrics:B=void 0}=e,{cluster:U=void 0}=e,{maxzoom:ee=void 0}=e,{attribution:ie=void 0}=e,{buffer:se=void 0}=e,{tolerance:Q=void 0}=e;const{map:K,cluster:pe,self:ve}=Gv();Ft(s,K,xe=>n(17,a=xe)),Ft(s,pe,xe=>n(20,h=xe)),Ft(s,ve,xe=>n(0,r=xe));let De,he=!0;return vo(()=>{r&&De&&a&&(Hv(K,r,De),Nn(ve,r=null,r),n(15,De=void 0))}),s.$$set=xe=>{"id"in xe&&n(4,x=xe.id),"data"in xe&&n(5,S=xe.data),"generateId"in xe&&n(6,T=xe.generateId),"promoteId"in xe&&n(7,C=xe.promoteId),"filter"in xe&&n(8,N=xe.filter),"lineMetrics"in xe&&n(9,B=xe.lineMetrics),"cluster"in xe&&n(10,U=xe.cluster),"maxzoom"in xe&&n(11,ee=xe.maxzoom),"attribution"in xe&&n(12,ie=xe.attribution),"buffer"in xe&&n(13,se=xe.buffer),"tolerance"in xe&&n(14,Q=xe.tolerance),"$$scope"in xe&&n(18,l=xe.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&Nn(pe,h=U,h),s.$$.dirty&196593&&a&&r!==x&&(Nn(ve,r=x,r),Zv(a,r,Rh({type:"geojson",data:S,filter:N,lineMetrics:B,generateId:T,promoteId:C,cluster:!!U,clusterMinPoints:U==null?void 0:U.minPoints,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius,clusterProperties:U==null?void 0:U.properties,maxzoom:ee,attribution:ie,buffer:se,tolerance:Q}),xe=>a&&xe===r,()=>{r&&(n(15,De=a==null?void 0:a.getSource(r)),n(16,he=!0))})),s.$$.dirty&131088&&(a==null||a.on("style.load",()=>{n(15,De=a==null?void 0:a.getSource(x))})),s.$$.dirty&98336&&De&&(he?n(16,he=!1):De.setData(S)),s.$$.dirty&33792&&(De==null||De.setClusterOptions(Rh({cluster:!!U,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius})))},[r,K,pe,ve,x,S,T,C,N,B,U,ee,ie,se,Q,De,he,a,l,m]}class rr extends fn{constructor(e){super(),hn(this,e,dI,fI,an,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function pI(s,e,n){let r;const{map:a}=pc();Ft(s,a,N=>n(8,r=N));let{position:h="top-left"}=e,{positionOptions:m=void 0}=e,{fitBoundsOptions:l=void 0}=e,{trackUserLocation:x=!1}=e,{showAccuracyCircle:S=!0}=e,{showUserLocation:T=!0}=e,{control:C=null}=e;return vo(()=>{r!=null&&r.loaded()&&C&&r.removeControl(C)}),s.$$set=N=>{"position"in N&&n(2,h=N.position),"positionOptions"in N&&n(3,m=N.positionOptions),"fitBoundsOptions"in N&&n(4,l=N.fitBoundsOptions),"trackUserLocation"in N&&n(5,x=N.trackUserLocation),"showAccuracyCircle"in N&&n(6,S=N.showAccuracyCircle),"showUserLocation"in N&&n(7,T=N.showUserLocation),"control"in N&&n(1,C=N.control)},s.$$.update=()=>{s.$$.dirty&510&&r&&!C&&(n(1,C=new Ts.GeolocateControl({positionOptions:m,fitBoundsOptions:l,trackUserLocation:x,showAccuracyCircle:S,showUserLocation:T})),r.addControl(C,h))},[a,C,h,m,l,x,S,T,r]}class mI extends fn{constructor(e){super(),hn(this,e,pI,null,an,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function gI(s){let e;const n=s[15].default,r=Zi(n,s,s[23],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&8388608)&&Xi(r,n,a,a[23],e?Hi(n,a[23],h,null):Wi(a[23]),null)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function _I(s){let e,n,r;function a(m){s[16](m)}let h={id:s[1],type:"line",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[gI]},$$scope:{ctx:s}};return s[0]!==void 0&&(h.hovered=s[0]),e=new $p({props:h}),Kn.push(()=>gr(e,"hovered",a)),e.$on("click",s[17]),e.$on("dblclick",s[18]),e.$on("contextmenu",s[19]),e.$on("mouseenter",s[20]),e.$on("mousemove",s[21]),e.$on("mouseleave",s[22]),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),r=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],mr(()=>n=!1)),e.$set(x)},i(m){r||(_e(e.$$.fragment,m),r=!0)},o(m){Ie(e.$$.fragment,m),r=!1},d(m){rt(e,m)}}}function yI(s,e,n){let{$$slots:r={},$$scope:a}=e,{id:h=dc("line")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:se=null}=e,{eventsIfTopMost:Q=!1}=e,{interactive:K=!0}=e;function pe(we){se=we,n(0,se)}function ve(we){ur.call(this,s,we)}function De(we){ur.call(this,s,we)}function he(we){ur.call(this,s,we)}function xe(we){ur.call(this,s,we)}function be(we){ur.call(this,s,we)}function Ce(we){ur.call(this,s,we)}return s.$$set=we=>{"id"in we&&n(1,h=we.id),"source"in we&&n(2,m=we.source),"sourceLayer"in we&&n(3,l=we.sourceLayer),"beforeId"in we&&n(4,x=we.beforeId),"beforeLayerType"in we&&n(5,S=we.beforeLayerType),"paint"in we&&n(6,T=we.paint),"layout"in we&&n(7,C=we.layout),"filter"in we&&n(8,N=we.filter),"minzoom"in we&&n(9,B=we.minzoom),"maxzoom"in we&&n(10,U=we.maxzoom),"hoverCursor"in we&&n(11,ee=we.hoverCursor),"manageHoverState"in we&&n(12,ie=we.manageHoverState),"hovered"in we&&n(0,se=we.hovered),"eventsIfTopMost"in we&&n(13,Q=we.eventsIfTopMost),"interactive"in we&&n(14,K=we.interactive),"$$scope"in we&&n(23,a=we.$$scope)},[se,h,m,l,x,S,T,C,N,B,U,ee,ie,Q,K,r,pe,ve,De,he,xe,be,Ce,a]}class _r extends fn{constructor(e){super(),hn(this,e,yI,_I,an,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function vI(s,e,n){let r;const a=hc();let{layer:h=void 0}=e;const{map:m}=pc();Ft(s,m,T=>n(2,r=T));function l(T){a(T.type,{...T,map:m})}const x=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],S=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return vo(()=>{if(r)if(h)for(const T of x)r.off(T,h,l);else for(const T of S)r.off(T,l)}),s.$$set=T=>{"layer"in T&&n(1,h=T.layer)},s.$$.update=()=>{if(s.$$.dirty&6&&r)if(h)for(const T of x)r.on(T,h,l);else for(const T of S)r.on(T,l)},[m,h,r]}class Xv extends fn{constructor(e){super(),hn(this,e,vI,null,an,{layer:1})}}function bI(s){let e=s.getCenter(),n=Math.round(s.getZoom()*100)/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),h=Math.round(e.lat*a)/a,m=Math.round(e.lng*a)/a,l=`${n}/${h}/${m}`,x=s.getBearing(),S=s.getPitch();return(x||S)&&(l+=`/${Math.round(x*10)/10}`),S&&(l+=`/${Math.round(S)}`),`#${l}`}function xI(s){return s.replace("#","").split("/").map(parseFloat)}function wI(s,e,n){let r;const{map:a}=pc();Ft(s,a,T=>n(6,r=T));let{position:h="top-left"}=e,{showCompass:m=!0}=e,{showZoom:l=!0}=e,{visualizePitch:x=!1}=e,S=null;return vo(()=>{r!=null&&r.loaded()&&S&&r.removeControl(S)}),s.$$set=T=>{"position"in T&&n(1,h=T.position),"showCompass"in T&&n(2,m=T.showCompass),"showZoom"in T&&n(3,l=T.showZoom),"visualizePitch"in T&&n(4,x=T.visualizePitch)},s.$$.update=()=>{s.$$.dirty&126&&r&&!S&&(n(5,S=new Ts.NavigationControl({showCompass:m,showZoom:l,visualizePitch:x})),r.addControl(S,h))},[a,h,m,l,x,S,r]}class kI extends fn{constructor(e){super(),hn(this,e,wI,null,an,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function II(s,e,n){let r;const{map:a}=pc();Ft(s,a,S=>n(5,r=S));let{position:h="bottom-left"}=e,{maxWidth:m=void 0}=e,{unit:l="metric"}=e,x=null;return vo(()=>{r!=null&&r.loaded()&&x&&r.removeControl(x)}),s.$$set=S=>{"position"in S&&n(1,h=S.position),"maxWidth"in S&&n(2,m=S.maxWidth),"unit"in S&&n(3,l=S.unit)},s.$$.update=()=>{s.$$.dirty&62&&r&&!x&&(n(4,x=new Ts.ScaleControl({maxWidth:m,unit:l})),r.addControl(x,h))},[a,h,m,l,x,r]}class SI extends fn{constructor(e){super(),hn(this,e,II,null,an,{position:1,maxWidth:2,unit:3})}}const{window:EI}=Y0,AI=s=>({map:s[0]&16,loadedImages:s[0]&32,allImagesLoaded:s[0]&64}),ny=s=>({map:s[4],loadedImages:s[5],allImagesLoaded:s[6]});function iy(s){let e,n,r=s[3]&&ry(s);const a=s[46].default,h=Zi(a,s,s[45],ny);return{c(){r&&r.c(),e=Oe(),h&&h.c()},m(m,l){r&&r.m(m,l),ae(m,e,l),h&&h.m(m,l),n=!0},p(m,l){m[3]?r?(r.p(m,l),l[0]&8&&_e(r,1)):(r=ry(m),r.c(),_e(r,1),r.m(e.parentNode,e)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn()),h&&h.p&&(!n||l[0]&112|l[1]&16384)&&Xi(h,a,m,m[45],n?Hi(a,m[45],l,AI):Wi(m[45]),ny)},i(m){n||(_e(r),_e(h,m),n=!0)},o(m){Ie(r),Ie(h,m),n=!1},d(m){m&&oe(e),r&&r.d(m),h&&h.d(m)}}}function ry(s){let e,n,r,a,h,m,l,x;return e=new kI({props:{position:s[7]}}),r=new mI({props:{position:s[7],fitBoundsOptions:{maxZoom:12}}}),h=new hI({props:{position:s[7]}}),l=new SI({props:{position:s[7]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment),m=Oe(),ot(l.$$.fragment)},m(S,T){it(e,S,T),ae(S,n,T),it(r,S,T),ae(S,a,T),it(h,S,T),ae(S,m,T),it(l,S,T),x=!0},p(S,T){const C={};T[0]&128&&(C.position=S[7]),e.$set(C);const N={};T[0]&128&&(N.position=S[7]),r.$set(N);const B={};T[0]&128&&(B.position=S[7]),h.$set(B);const U={};T[0]&128&&(U.position=S[7]),l.$set(U)},i(S){x||(_e(e.$$.fragment,S),_e(r.$$.fragment,S),_e(h.$$.fragment,S),_e(l.$$.fragment,S),x=!0)},o(S){Ie(e.$$.fragment,S),Ie(r.$$.fragment,S),Ie(h.$$.fragment,S),Ie(l.$$.fragment,S),x=!1},d(S){S&&(oe(n),oe(a),oe(m)),rt(e,S),rt(r,S),rt(h,S),rt(l,S)}}}function TI(s){let e,n,r,a,h,m=s[4]&&s[0]&&iy(s);return{c(){e=ue("div"),m&&m.c(),Ze(e,"class",n=Nf(s[2])+" svelte-p00lfq"),Ze(e,"data-testid","map-container"),Sr(e,"expand-map",!s[2])},m(l,x){ae(l,e,x),m&&m.m(e,null),s[47](e),r=!0,a||(h=[Rt(EI,"hashchange",s[11]),dp(s[10].call(null,e))],a=!0)},p(l,x){l[4]&&l[0]?m?(m.p(l,x),x[0]&17&&_e(m,1)):(m=iy(l),m.c(),_e(m,1),m.m(e,null)):m&&(zn(),Ie(m,1,1,()=>{m=null}),Fn()),(!r||x[0]&4&&n!==(n=Nf(l[2])+" svelte-p00lfq"))&&Ze(e,"class",n),(!r||x[0]&4)&&Sr(e,"expand-map",!l[2])},i(l){r||(_e(m),r=!0)},o(l){Ie(m),r=!1},d(l){l&&oe(e),m&&m.d(),s[47](null),a=!1,Ki(h)}}}function CI(s,e,n){let r,a,h,m,{$$slots:l={},$$scope:x}=e,{map:S=null}=e,{mapContainer:T=void 0}=e,{class:C=void 0}=e,{style:N}=e,{diffStyleUpdates:B=!1}=e,{center:U=void 0}=e,{zoom:ee=void 0}=e,{pitch:ie=0}=e,{bearing:se=0}=e,{bounds:Q=void 0}=e,{hash:K=!1}=e,{updateHash:pe=Ee=>{window.history.replaceState(window.history.state,"",Ee)}}=e,{loaded:ve=!1}=e,{minZoom:De=0}=e,{maxZoom:he=22}=e,{minPitch:xe=0}=e,{maxPitch:be=60}=e,{renderWorldCopies:Ce=void 0}=e,{dragPan:we=void 0}=e,{dragRotate:ye=void 0}=e,{pitchWithRotate:Ue=void 0}=e,{antialias:qe=void 0}=e,{zoomOnDoubleClick:pt=!0}=e,{locale:St=void 0}=e,{interactive:dt=!0}=e,{attributionControl:ut=!0}=e,{cooperativeGestures:Bt=!1}=e,{preserveDrawingBuffer:vt=!1}=e,{maxBounds:wt=void 0}=e,{images:ft=[]}=e,{standardControls:xt=!1}=e,{filterLayers:It=void 0}=e,{transformRequest:Yt=void 0}=e;const pn=hc(),{map:Dn,loadedImages:We}=$k();Ft(s,Dn,Ee=>n(4,h=Ee)),Ft(s,We,Ee=>n(5,m=Ee));let Xn=new Set;async function dn(Ee,Gt=!1){if(h&&!(!h.loaded()&&!Gt))if("url"in Ee){Xn.add(Ee.id);try{let _n=await h.loadImage(Ee.url);h==null||h.addImage(Ee.id,_n.data,Ee.options),m.add(Ee.id),We.set(m)}catch(_n){pn("error",_n)}finally{Xn.delete(Ee.id)}}else h.addImage(Ee.id,Ee.data,Ee.options),m.add(Ee.id),We.set(m)}let Ot,Se,lt,Ye;function Ct(Ee){return kt(),Nn(Dn,h=new Ts.Map(Rh({container:Ee,style:N,locale:St,center:U,zoom:ee,pitch:ie,bearing:se,minZoom:De,maxZoom:he,minPitch:xe,maxPitch:be,renderWorldCopies:Ce,dragPan:we,dragRotate:ye,pitchWithRotate:Ue,antialias:qe,interactive:dt,preserveDrawingBuffer:vt,maxBounds:wt,bounds:Q,attributionControl:ut,transformRequest:Yt,cooperativeGestures:Bt})),h),h.on("load",Gt=>{Gt.target.getContainer().setAttribute("data-testid","map"),Gt.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,ve=!0),pn("load",h)}),h.on("error",Gt=>pn("error",{...Gt,map:h})),h.on("movestart",Gt=>pn("movestart",{...Gt,map:h})),h.on("moveend",Gt=>{if(n(12,U=Gt.target.getCenter()),n(13,ee=Gt.target.getZoom()),n(14,ie=Gt.target.getPitch()),n(15,se=Gt.target.getBearing()),n(16,Q=Gt.target.getBounds()),pn("moveend",{...Gt,map:h}),K){let _n=new URL(window.location.href.replace(/(#.+)?$/,bI(h)));pe(_n)}}),h.on("click",Gt=>pn("click",{...Gt,map:h})),h.on("dblclick",Gt=>pn("dblclick",{...Gt,map:h})),h.on("contextmenu",Gt=>pn("contextmenu",{...Gt,map:h})),h.on("zoomstart",Gt=>pn("zoomstart",{...Gt,map:h})),h.on("zoom",Gt=>{pn("zoom",{...Gt,map:h})}),h.on("zoomend",Gt=>{pn("zoomend",{...Gt,map:h})}),h.on("style.load",()=>{if(h){const Gt=h.getStyle();if(n(42,Ot=Gt.layers.map(_n=>_n.id)),n(43,Se=Object.keys(Gt.sources)),Ye)for(const[_n,Jn]of Object.entries(Ye))h.addSource(_n,Jn);if(lt)for(const _n of lt)h.addLayer(_n);for(const _n of ft)dn(_n,!0)}}),h.on("styledata",Gt=>{if(h&&It){const _n=h.getStyle().layers;if(_n)for(let Jn of _n)It(Jn)||h.setLayoutProperty(Jn.id,"visibility","none")}pn("styledata",{...Gt,map:h})}),{destroy(){n(0,ve=!1),h==null||h.remove(),Nn(Dn,h=null,h)}}}let $e=N;function kt(){if(K){let Ee=xI(window.location.hash);Ee.length>=3&&(n(13,ee=Ee[0]),n(12,U=[Ee[2],Ee[1]])),Ee.length==5&&(n(15,se=Ee[3]),n(14,ie=Ee[4]))}}function qt(Ee){Kn[Ee?"unshift":"push"](()=>{T=Ee,n(1,T)})}return s.$$set=Ee=>{"map"in Ee&&n(17,S=Ee.map),"mapContainer"in Ee&&n(1,T=Ee.mapContainer),"class"in Ee&&n(2,C=Ee.class),"style"in Ee&&n(18,N=Ee.style),"diffStyleUpdates"in Ee&&n(19,B=Ee.diffStyleUpdates),"center"in Ee&&n(12,U=Ee.center),"zoom"in Ee&&n(13,ee=Ee.zoom),"pitch"in Ee&&n(14,ie=Ee.pitch),"bearing"in Ee&&n(15,se=Ee.bearing),"bounds"in Ee&&n(16,Q=Ee.bounds),"hash"in Ee&&n(20,K=Ee.hash),"updateHash"in Ee&&n(21,pe=Ee.updateHash),"loaded"in Ee&&n(0,ve=Ee.loaded),"minZoom"in Ee&&n(22,De=Ee.minZoom),"maxZoom"in Ee&&n(23,he=Ee.maxZoom),"minPitch"in Ee&&n(24,xe=Ee.minPitch),"maxPitch"in Ee&&n(25,be=Ee.maxPitch),"renderWorldCopies"in Ee&&n(26,Ce=Ee.renderWorldCopies),"dragPan"in Ee&&n(27,we=Ee.dragPan),"dragRotate"in Ee&&n(28,ye=Ee.dragRotate),"pitchWithRotate"in Ee&&n(29,Ue=Ee.pitchWithRotate),"antialias"in Ee&&n(30,qe=Ee.antialias),"zoomOnDoubleClick"in Ee&&n(31,pt=Ee.zoomOnDoubleClick),"locale"in Ee&&n(32,St=Ee.locale),"interactive"in Ee&&n(33,dt=Ee.interactive),"attributionControl"in Ee&&n(34,ut=Ee.attributionControl),"cooperativeGestures"in Ee&&n(35,Bt=Ee.cooperativeGestures),"preserveDrawingBuffer"in Ee&&n(36,vt=Ee.preserveDrawingBuffer),"maxBounds"in Ee&&n(37,wt=Ee.maxBounds),"images"in Ee&&n(38,ft=Ee.images),"standardControls"in Ee&&n(3,xt=Ee.standardControls),"filterLayers"in Ee&&n(39,It=Ee.filterLayers),"transformRequest"in Ee&&n(40,Yt=Ee.transformRequest),"$$scope"in Ee&&n(45,x=Ee.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&8&&n(7,r=typeof xt=="boolean"?void 0:xt),s.$$.dirty[0]&16&&n(17,S=h),s.$$.dirty[0]&786448|s.$$.dirty[1]&14336&&h&&!Hu(N,$e)){const Ee=h.getStyle();if(Ot&&(lt=Ee.layers.filter(Gt=>!Ot.includes(Gt.id))),Se){const Gt=Object.keys(Ee.sources).filter(_n=>!Se.includes(_n));Ye={};for(const _n of Gt)Ye[_n]=Ee.sources[_n]}n(44,$e=N),h.setStyle(N,{diff:B}),Nn(We,m=new Set,m),n(41,Xn=new Set)}if(s.$$.dirty[0]&49|s.$$.dirty[1]&1152&&ve&&h!=null&&h.loaded())for(let Ee of ft)!m.has(Ee.id)&&!Xn.has(Ee.id)&&!h.hasImage(Ee.id)&&dn(Ee);if(s.$$.dirty[0]&32|s.$$.dirty[1]&128&&n(6,a=ft.every(Ee=>m.has(Ee.id))),s.$$.dirty[0]&61456&&h){let Ee={};U!=null&&!Hu(U,h==null?void 0:h.getCenter())&&(Ee.center=U),ee!=null&&!Hu(ee,h==null?void 0:h.getZoom())&&(Ee.zoom=ee),se!=null&&!Hu(se,h==null?void 0:h.getBearing())&&(Ee.bearing=se),ie!=null&&!Hu(ie,h==null?void 0:h.getPitch())&&(Ee.pitch=ie),Object.keys(Ee).length&&h.easeTo(Ee)}s.$$.dirty[0]&65552&&Q&&!Hu(Q,h==null?void 0:h.getBounds())&&(h==null||h.fitBounds(Q)),s.$$.dirty[0]&16|s.$$.dirty[1]&1&&(pt?h==null||h.doubleClickZoom.enable():h==null||h.doubleClickZoom.disable())},[ve,T,C,xt,h,m,a,r,Dn,We,Ct,kt,U,ee,ie,se,Q,S,N,B,K,pe,De,he,xe,be,Ce,we,ye,Ue,qe,pt,St,dt,ut,Bt,vt,wt,ft,It,Yt,Xn,Ot,Se,$e,x,l,qt]}class LI extends fn{constructor(e){super(),hn(this,e,CI,TI,an,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const MI=s=>({marker:s&8}),sy=s=>({marker:s[3]});function RI(s){let e,n,r,a,h,m,l;const x=s[19].default,S=Zi(x,s,s[18],sy);return{c(){e=ue("div"),S&&S.c(),Ze(e,"tabindex",n=s[1]?0:void 0),Ze(e,"role",r=s[1]?"button":void 0),Pn(e,"z-index",s[2])},m(T,C){ae(T,e,C),S&&S.m(e,null),h=!0,m||(l=[dp(s[7].call(null,e)),dp(a=PI.call(null,e,s[0])),Rt(e,"click",tp(s[20])),Rt(e,"dblclick",tp(s[21])),Rt(e,"contextmenu",tp(Nh(s[22]))),Rt(e,"mouseenter",s[23]),Rt(e,"mouseleave",s[24]),Rt(e,"mousemove",s[25]),Rt(e,"keydown",s[8])],m=!0)},p(T,[C]){S&&S.p&&(!h||C&262152)&&Xi(S,x,T,T[18],h?Hi(x,T[18],C,MI):Wi(T[18]),sy),(!h||C&2&&n!==(n=T[1]?0:void 0))&&Ze(e,"tabindex",n),(!h||C&2&&r!==(r=T[1]?"button":void 0))&&Ze(e,"role",r),a&&iu(a.update)&&C&1&&a.update.call(null,T[0]),C&4&&Pn(e,"z-index",T[2])},i(T){h||(_e(S,T),h=!0)},o(T){Ie(S,T),h=!1},d(T){T&&oe(e),S&&S.d(T),m=!1,Ki(l)}}}function PI(s,e){const n=s.className;function r(a){a?s.className=`${n} ${a}`:s.className=n}return r(e),{update:r}}function DI(s,e,n){let r,a,h,{$$slots:m={},$$scope:l}=e,{marker:x=void 0}=e,{lngLat:S}=e,{class:T=void 0}=e,{interactive:C=!0}=e,{asButton:N=!1}=e,{draggable:B=!1}=e,{feature:U=null}=e,{offset:ee=void 0}=e,{zIndex:ie=void 0}=e,{rotation:se=0}=e,{opacity:Q=1}=e;const K=hc(),{map:pe,layerEvent:ve,self:De,markerClickManager:he}=Jk();Ft(s,pe,ut=>n(27,h=ut)),Ft(s,ve,ut=>n(26,r=ut)),Ft(s,De,ut=>n(3,a=ut));function xe(ut){Nn(De,a=new Ts.Marker({element:ut,rotation:se,draggable:B,offset:ee,opacity:Q.toString()}).setLngLat(S).addTo(h),a),n(11,x=a);const Bt=()=>we("dragstart"),vt=()=>{be(),we("drag")},wt=()=>{be(),we("dragend")};return B&&(a.on("dragstart",Bt),a.on("drag",vt),a.on("dragend",wt)),{destroy(){B&&(a==null||a.off("dragstart",Bt),a==null||a.off("drag",vt),a==null||a.off("dragend",wt)),n(11,x=void 0),a==null||a.remove()}}}function be(){let ut=a==null?void 0:a.getLngLat();ut&&(Array.isArray(S)?n(10,S=[ut.lng,ut.lat]):S&&"lon"in S?n(10,S={lon:ut.lng,lat:ut.lat}):n(10,S=ut))}function Ce(ut){ut.key===" "&&(ut.preventDefault(),ut.stopPropagation(),we("click"))}function we(ut){if(!C)return;let Bt=a==null?void 0:a.getLngLat();if(!Bt)return;const vt=[Bt.lng,Bt.lat];let wt={map:h,marker:a,lngLat:vt,features:[{type:"Feature",properties:(U==null?void 0:U.properties)??{},geometry:{type:"Point",coordinates:vt}}]};(ut==="click"||ut==="contextmenu")&&he.handleClick(wt),Nn(ve,r={...wt,layerType:"marker",type:ut},r),K(ut,wt)}const ye=()=>we("click"),Ue=()=>we("dblclick"),qe=()=>{we("contextmenu")},pt=()=>{we("mouseenter")},St=()=>{we("mouseleave")},dt=()=>we("mousemove");return s.$$set=ut=>{"marker"in ut&&n(11,x=ut.marker),"lngLat"in ut&&n(10,S=ut.lngLat),"class"in ut&&n(0,T=ut.class),"interactive"in ut&&n(12,C=ut.interactive),"asButton"in ut&&n(1,N=ut.asButton),"draggable"in ut&&n(13,B=ut.draggable),"feature"in ut&&n(14,U=ut.feature),"offset"in ut&&n(15,ee=ut.offset),"zIndex"in ut&&n(2,ie=ut.zIndex),"rotation"in ut&&n(16,se=ut.rotation),"opacity"in ut&&n(17,Q=ut.opacity),"$$scope"in ut&&n(18,l=ut.$$scope)},s.$$.update=()=>{s.$$.dirty&1032&&(a==null||a.setLngLat(S)),s.$$.dirty&32776&&(a==null||a.setOffset(ee??[0,0])),s.$$.dirty&65544&&(a==null||a.setRotation(se)),s.$$.dirty&131080&&(a==null||a.setOpacity(Q.toString()))},[T,N,ie,a,pe,ve,De,xe,Ce,we,S,x,C,B,U,ee,se,Q,l,m,ye,Ue,qe,pt,St,dt]}class Zf extends fn{constructor(e){super(),hn(this,e,DI,RI,an,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function oy(s){let e=s[0],n,r,a=ay(s);return{c(){a.c(),n=ni()},m(h,m){a.m(h,m),ae(h,n,m),r=!0},p(h,m){m&1&&an(e,e=h[0])?(zn(),Ie(a,1,1,tt),Fn(),a=ay(h),a.c(),_e(a,1),a.m(n.parentNode,n)):a.p(h,m)},i(h){r||(_e(a),r=!0)},o(h){Ie(a),r=!1},d(h){h&&oe(n),a.d(h)}}}function ay(s){let e;const n=s[15].default,r=Zi(n,s,s[14],null);return{c(){r&&r.c()},m(a,h){r&&r.m(a,h),e=!0},p(a,h){r&&r.p&&(!e||h&16384)&&Xi(r,n,a,a[14],e?Hi(n,a[14],h,null):Wi(a[14]),null)},i(a){e||(_e(r,a),e=!0)},o(a){Ie(r,a),e=!1},d(a){r&&r.d(a)}}}function NI(s){let e,n,r=s[0]&&oy(s);return{c(){r&&r.c(),e=ni()},m(a,h){r&&r.m(a,h),ae(a,e,h),n=!0},p(a,[h]){a[0]?r?(r.p(a,h),h&1&&_e(r,1)):(r=oy(a),r.c(),_e(r,1),r.m(e.parentNode,e)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d(a)}}}function zI(s,e,n){let r,a,{$$slots:h={},$$scope:m}=e,{id:l=dc("vector")}=e,{url:x=null}=e,{tiles:S=null}=e,{promoteId:T=null}=e,{bounds:C=null}=e,{scheme:N=null}=e,{attribution:B=null}=e,{minzoom:U=null}=e,{maxzoom:ee=null}=e,{volatile:ie=null}=e;if(x&&x.includes("pmtiles://")&&!Ts.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let pe=new Lk;Ts.addProtocol("pmtiles",pe.tile)}const{map:se,self:Q}=Gv();Ft(s,se,pe=>n(13,a=pe)),Ft(s,Q,pe=>n(0,r=pe));let K;return vo(()=>{r&&a&&(Hv(se,r,K),Nn(Q,r=null,r),K=void 0)}),s.$$set=pe=>{"id"in pe&&n(3,l=pe.id),"url"in pe&&n(4,x=pe.url),"tiles"in pe&&n(5,S=pe.tiles),"promoteId"in pe&&n(6,T=pe.promoteId),"bounds"in pe&&n(7,C=pe.bounds),"scheme"in pe&&n(8,N=pe.scheme),"attribution"in pe&&n(9,B=pe.attribution),"minzoom"in pe&&n(10,U=pe.minzoom),"maxzoom"in pe&&n(11,ee=pe.maxzoom),"volatile"in pe&&n(12,ie=pe.volatile),"$$scope"in pe&&n(14,m=pe.$$scope)},s.$$.update=()=>{s.$$.dirty&16377&&a&&r!==l&&(Nn(Q,r=l,r),Zv(a,r,Rh({type:"vector",url:x,tiles:S,promoteId:T,bounds:C,scheme:N,attribution:B,minzoom:U,maxzoom:ee,volatile:ie}),pe=>a&&pe===r,()=>{r&&(K=a==null?void 0:a.getSource(r))})),s.$$.dirty&8200&&(a==null||a.on("style.load",()=>{K=a==null?void 0:a.getSource(l)}))},[r,se,Q,l,x,S,T,C,N,B,U,ee,ie,a,m,h]}class Jp extends fn{constructor(e){super(),hn(this,e,zI,NI,an,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const FI=s=>({}),ly=s=>({}),OI=s=>({}),uy=s=>({}),BI=s=>({}),cy=s=>({}),UI=s=>({}),hy=s=>({});function jI(s){let e,n,r,a,h,m,l,x,S;const T=s[1].top,C=Zi(T,s,s[0],hy),N=s[1].left,B=Zi(N,s,s[0],cy),U=s[1].main,ee=Zi(U,s,s[0],uy),ie=s[1].right,se=Zi(ie,s,s[0],ly);return{c(){e=ue("div"),C&&C.c(),n=Oe(),r=ue("div"),a=ue("div"),B&&B.c(),h=Oe(),m=ue("div"),ee&&ee.c(),l=Oe(),x=ue("div"),se&&se.c(),Ze(e,"class","top svelte-11kzs8g"),Ze(a,"class","left svelte-11kzs8g"),Ze(m,"class","main svelte-11kzs8g"),Ze(x,"class","right svelte-11kzs8g"),Ze(r,"class","main-row svelte-11kzs8g")},m(Q,K){ae(Q,e,K),C&&C.m(e,null),ae(Q,n,K),ae(Q,r,K),Z(r,a),B&&B.m(a,null),Z(r,h),Z(r,m),ee&&ee.m(m,null),Z(r,l),Z(r,x),se&&se.m(x,null),S=!0},p(Q,[K]){C&&C.p&&(!S||K&1)&&Xi(C,T,Q,Q[0],S?Hi(T,Q[0],K,UI):Wi(Q[0]),hy),B&&B.p&&(!S||K&1)&&Xi(B,N,Q,Q[0],S?Hi(N,Q[0],K,BI):Wi(Q[0]),cy),ee&&ee.p&&(!S||K&1)&&Xi(ee,U,Q,Q[0],S?Hi(U,Q[0],K,OI):Wi(Q[0]),uy),se&&se.p&&(!S||K&1)&&Xi(se,ie,Q,Q[0],S?Hi(ie,Q[0],K,FI):Wi(Q[0]),ly)},i(Q){S||(_e(C,Q),_e(B,Q),_e(ee,Q),_e(se,Q),S=!0)},o(Q){Ie(C,Q),Ie(B,Q),Ie(ee,Q),Ie(se,Q),S=!1},d(Q){Q&&(oe(e),oe(n),oe(r)),C&&C.d(Q),B&&B.d(Q),ee&&ee.d(Q),se&&se.d(Q)}}}function qI(s,e,n){let{$$slots:r={},$$scope:a}=e;return s.$$set=h=>{"$$scope"in h&&n(0,a=h.$$scope)},[a,r]}class VI extends fn{constructor(e){super(),hn(this,e,qI,jI,an,{})}}const GI=s=>({}),fy=s=>({}),ZI=s=>({}),dy=s=>({}),HI=s=>({}),py=s=>({});function XI(s){let e,n,r,a,h,m;const l=s[4].left,x=Zi(l,s,s[3],py),S=s[4].map,T=Zi(S,s,s[3],dy),C=s[4].right,N=Zi(C,s,s[3],fy);return{c(){e=ue("div"),x&&x.c(),n=Oe(),r=ue("div"),T&&T.c(),a=Oe(),h=ue("div"),N&&N.c()},m(B,U){ae(B,e,U),x&&x.m(e,null),s[5](e),ae(B,n,U),ae(B,r,U),T&&T.m(r,null),s[6](r),ae(B,a,U),ae(B,h,U),N&&N.m(h,null),s[7](h),m=!0},p(B,[U]){x&&x.p&&(!m||U&8)&&Xi(x,l,B,B[3],m?Hi(l,B[3],U,HI):Wi(B[3]),py),T&&T.p&&(!m||U&8)&&Xi(T,S,B,B[3],m?Hi(S,B[3],U,ZI):Wi(B[3]),dy),N&&N.p&&(!m||U&8)&&Xi(N,C,B,B[3],m?Hi(C,B[3],U,GI):Wi(B[3]),fy)},i(B){m||(_e(x,B),_e(T,B),_e(N,B),m=!0)},o(B){Ie(x,B),Ie(T,B),Ie(N,B),m=!1},d(B){B&&(oe(e),oe(n),oe(r),oe(a),oe(h)),x&&x.d(B),s[5](null),T&&T.d(B),s[6](null),N&&N.d(B),s[7](null)}}}function WI(s,e,n){let r,a,h;Ft(s,Mp,C=>n(0,r=C)),Ft(s,Pp,C=>n(1,a=C)),Ft(s,Rp,C=>n(2,h=C));let{$$slots:m={},$$scope:l}=e;function x(C){Kn[C?"unshift":"push"](()=>{r=C,Mp.set(r)})}function S(C){Kn[C?"unshift":"push"](()=>{a=C,Pp.set(a)})}function T(C){Kn[C?"unshift":"push"](()=>{h=C,Rp.set(h)})}return s.$$set=C=>{"$$scope"in C&&n(3,l=C.$$scope)},[r,a,h,l,m,x,S,T]}class gc extends fn{constructor(e){super(),hn(this,e,WI,XI,an,{})}}let Mp=Yn(null),Rp=Yn(null),Pp=Yn(null);function my(s){let e,n;return{c(){e=ue("div"),n=Fe(s[0]),Ze(e,"class","svelte-1uuov7f")},m(r,a){ae(r,e,a),Z(e,n)},p(r,a){a&1&&Lt(n,r[0])},d(r){r&&oe(e)}}}function KI(s){let e,n=s[0]&&my(s);return{c(){n&&n.c(),e=ni()},m(r,a){n&&n.m(r,a),ae(r,e,a)},p(r,[a]){r[0]?n?n.p(r,a):(n=my(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:tt,o:tt,d(r){r&&oe(e),n&&n.d(r)}}}function $I(s,e,n){let{loading:r}=e;return s.$$set=a=>{"loading"in a&&n(0,r=a.loading)},[r]}class YI extends fn{constructor(e){super(),hn(this,e,$I,KI,an,{loading:0})}}const JI=s=>({dialog:s&1}),gy=s=>({dialog:s[0]});function QI(s){let e,n,r,a,h;const m=s[4].default,l=Zi(m,s,s[3],gy);return{c(){e=ue("dialog"),n=ue("article"),l&&l.c(),e.open=!0},m(x,S){ae(x,e,S),Z(e,n),l&&l.m(n,null),s[6](e),r=!0,a||(h=[Rt(window,"click",s[1]),Rt(window,"keydown",s[2]),Rt(e,"close",s[5])],a=!0)},p(x,[S]){l&&l.p&&(!r||S&9)&&Xi(l,m,x,x[3],r?Hi(m,x[3],S,JI):Wi(x[3]),gy)},i(x){r||(_e(l,x),r=!0)},o(x){Ie(l,x),r=!1},d(x){x&&oe(e),l&&l.d(x),s[6](null),a=!1,Ki(h)}}}function eS(s,e,n){let{$$slots:r={},$$scope:a}=e,h;function m(T){h.open&&T.target==h&&h.close()}function l(T){(T.key=="Escape"||T.key=="Enter")&&(T.stopPropagation(),h.close())}function x(T){ur.call(this,s,T)}function S(T){Kn[T?"unshift":"push"](()=>{h=T,n(0,h)})}return s.$$set=T=>{"$$scope"in T&&n(3,a=T.$$scope)},[h,m,l,a,r,x,S]}class Wv extends fn{constructor(e){super(),hn(this,e,eS,QI,an,{})}}function _y(s,e,n){const r=s.slice();return r[1]=e[n][0],r[2]=e[n][1],r}function yy(s){let e,n,r=s[1]+"",a,h,m,l=s[2]+"",x,S;return{c(){e=ue("tr"),n=ue("td"),a=Fe(r),h=Oe(),m=ue("td"),x=Fe(l),S=Oe()},m(T,C){ae(T,e,C),Z(e,n),Z(n,a),Z(e,h),Z(e,m),Z(m,x),Z(e,S)},p(T,C){C&1&&r!==(r=T[1]+"")&&Lt(a,r),C&1&&l!==(l=T[2]+"")&&Lt(x,l)},d(T){T&&oe(e)}}}function tS(s){let e,n,r=qn(Object.entries(s[0])),a=[];for(let h=0;h<r.length;h+=1)a[h]=yy(_y(s,r,h));return{c(){e=ue("table"),n=ue("tbody");for(let h=0;h<a.length;h+=1)a[h].c();Ze(e,"class","svelte-lh2o9l")},m(h,m){ae(h,e,m),Z(e,n);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(n,null)},p(h,[m]){if(m&1){r=qn(Object.entries(h[0]));let l;for(l=0;l<r.length;l+=1){const x=_y(h,r,l);a[l]?a[l].p(x,m):(a[l]=yy(x),a[l].c(),a[l].m(n,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=r.length}},i:tt,o:tt,d(h){h&&oe(e),Er(a,h)}}}function nS(s,e,n){let{properties:r}=e;return s.$$set=a=>{"properties"in a&&n(0,r=a.properties)},[r]}class iS extends fn{constructor(e){super(),hn(this,e,nS,tS,an,{properties:0})}}function vy(s,e,n){const r=s.slice();return r[3]=e[n],r}function by(s,e,n){const r=s.slice();return r[6]=e[n],r}function xy(s){let e,n;return{c(){e=ue("span"),n=Fe(`
    `),Pn(e,"background",s[6]),Pn(e,"width","100%"),Pn(e,"border","1px solid black")},m(r,a){ae(r,e,a),Z(e,n)},p(r,a){a&1&&Pn(e,"background",r[6])},d(r){r&&oe(e)}}}function rS(s){let e,n=s[3]+"",r;return{c(){e=ue("span"),r=Fe(n)},m(a,h){ae(a,e,h),Z(e,r)},p(a,h){h&2&&n!==(n=a[3]+"")&&Lt(r,n)},d(a){a&&oe(e)}}}function sS(s){let e,n=s[3].toFixed(s[2])+"",r;return{c(){e=ue("span"),r=Fe(n)},m(a,h){ae(a,e,h),Z(e,r)},p(a,h){h&6&&n!==(n=a[3].toFixed(a[2])+"")&&Lt(r,n)},d(a){a&&oe(e)}}}function wy(s){let e;function n(h,m){return h[2]>0?sS:rS}let r=n(s),a=r(s);return{c(){a.c(),e=ni()},m(h,m){a.m(h,m),ae(h,e,m)},p(h,m){r===(r=n(h))&&a?a.p(h,m):(a.d(1),a=r(h),a&&(a.c(),a.m(e.parentNode,e)))},d(h){h&&oe(e),a.d(h)}}}function oS(s){let e,n,r,a=qn(s[0]),h=[];for(let x=0;x<a.length;x+=1)h[x]=xy(by(s,a,x));let m=qn(s[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=wy(vy(s,m,x));return{c(){e=ue("div");for(let x=0;x<h.length;x+=1)h[x].c();n=Oe(),r=ue("div");for(let x=0;x<l.length;x+=1)l[x].c();Pn(e,"display","flex"),Pn(r,"display","flex"),Pn(r,"justify-content","space-between")},m(x,S){ae(x,e,S);for(let T=0;T<h.length;T+=1)h[T]&&h[T].m(e,null);ae(x,n,S),ae(x,r,S);for(let T=0;T<l.length;T+=1)l[T]&&l[T].m(r,null)},p(x,[S]){if(S&1){a=qn(x[0]);let T;for(T=0;T<a.length;T+=1){const C=by(x,a,T);h[T]?h[T].p(C,S):(h[T]=xy(C),h[T].c(),h[T].m(e,null))}for(;T<h.length;T+=1)h[T].d(1);h.length=a.length}if(S&6){m=qn(x[1]);let T;for(T=0;T<m.length;T+=1){const C=vy(x,m,T);l[T]?l[T].p(C,S):(l[T]=wy(C),l[T].c(),l[T].m(r,null))}for(;T<l.length;T+=1)l[T].d(1);l.length=m.length}},i:tt,o:tt,d(x){x&&(oe(e),oe(n),oe(r)),Er(h,x),Er(l,x)}}}function aS(s,e,n){let{colorScale:r}=e,{limits:a}=e,{decimalPlaces:h=0}=e;return s.$$set=m=>{"colorScale"in m&&n(0,r=m.colorScale),"limits"in m&&n(1,a=m.limits),"decimalPlaces"in m&&n(2,h=m.decimalPlaces)},[r,a,h]}class Qp extends fn{constructor(e){super(),hn(this,e,aS,oS,an,{colorScale:0,limits:1,decimalPlaces:2})}}function xl(s){if(s==null||s==null)throw new Error("Oops, notNull given something null");return s}let _t;const La=new Array(128).fill(void 0);La.push(void 0,null,!0,!1);function En(s){return La[s]}let Ih=La.length;function lS(s){s<132||(La[s]=Ih,Ih=s)}function Ui(s){const e=En(s);return lS(s),e}const Kv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Kv.decode();let _h=null;function ic(){return(_h===null||_h.byteLength===0)&&(_h=new Uint8Array(_t.memory.buffer)),_h}function ji(s,e){return s=s>>>0,Kv.decode(ic().subarray(s,s+e))}function Ci(s){Ih===La.length&&La.push(La.length+1);const e=Ih;return Ih=La[e],La[e]=s,e}let Po=0;const Rf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},uS=typeof Rf.encodeInto=="function"?function(s,e){return Rf.encodeInto(s,e)}:function(s,e){const n=Rf.encode(s);return e.set(n),{read:s.length,written:n.length}};function nu(s,e,n){if(n===void 0){const l=Rf.encode(s),x=e(l.length,1)>>>0;return ic().subarray(x,x+l.length).set(l),Po=l.length,x}let r=s.length,a=e(r,1)>>>0;const h=ic();let m=0;for(;m<r;m++){const l=s.charCodeAt(m);if(l>127)break;h[a+m]=l}if(m!==r){m!==0&&(s=s.slice(m)),a=n(a,r,r=m+s.length*3,1)>>>0;const l=ic().subarray(a+m,a+r),x=uS(s,l);m+=x.written,a=n(a,r,m,1)>>>0}return Po=m,a}function Jl(s){return s==null}let Yl=null;function Tt(){return(Yl===null||Yl.buffer.detached===!0||Yl.buffer.detached===void 0&&Yl.buffer!==_t.memory.buffer)&&(Yl=new DataView(_t.memory.buffer)),Yl}function Dp(s){const e=typeof s;if(e=="number"||e=="boolean"||s==null)return`${s}`;if(e=="string")return`"${s}"`;if(e=="symbol"){const a=s.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=s.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(s)){const a=s.length;let h="[";a>0&&(h+=Dp(s[0]));for(let m=1;m<a;m++)h+=", "+Dp(s[m]);return h+="]",h}const n=/\[object ([^\]]+)\]/.exec(toString.call(s));let r;if(n.length>1)r=n[1];else return toString.call(s);if(r=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:r}function cS(s,e){const n=e(s.length*1,1)>>>0;return ic().set(s,n/1),Po=s.length,n}let yh=null;function hS(){return(yh===null||yh.byteLength===0)&&(yh=new Float64Array(_t.memory.buffer)),yh}function fS(s,e){return s=s>>>0,hS().subarray(s/8,s/8+e)}function dS(s,e){return s=s>>>0,ic().subarray(s/1,s/1+e)}function ml(s,e){try{return s.apply(this,e)}catch(n){_t.__wbindgen_exn_store(Ci(n))}}const ky=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>_t.__wbg_mapmodel_free(s>>>0,1));class pS{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ky.unregister(this),e}free(){const e=this.__destroy_into_raw();_t.__wbg_mapmodel_free(e,0)}constructor(e){try{const h=_t.__wbindgen_add_to_stack_pointer(-16),m=cS(e,_t.__wbindgen_malloc),l=Po;_t.mapmodel_new(h,m,l);var n=Tt().getInt32(h+4*0,!0),r=Tt().getInt32(h+4*1,!0),a=Tt().getInt32(h+4*2,!0);if(a)throw Ui(r);return this.__wbg_ptr=n>>>0,ky.register(this,this.__wbg_ptr,this),this}finally{_t.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderDebug(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getInvertedBoundary(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getInvertedBoundary(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getBounds(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getBounds(a,this.__wbg_ptr);var e=Tt().getInt32(a+4*0,!0),n=Tt().getInt32(a+4*1,!0),r=fS(e,n).slice();return _t.__wbindgen_free(e,n*8,8),r}finally{_t.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toRouteSnapper(a,this.__wbg_ptr);var e=Tt().getInt32(a+4*0,!0),n=Tt().getInt32(a+4*1,!0),r=dS(e,n).slice();return _t.__wbindgen_free(e,n*1,1),r}finally{_t.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,n){try{const m=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_setRoute(m,this.__wbg_ptr,!Jl(e),Jl(e)?0:e,Ci(n));var r=Tt().getInt32(m+4*0,!0),a=Tt().getInt32(m+4*1,!0),h=Tt().getInt32(m+4*2,!0);if(h)throw Ui(a);return r>>>0}finally{_t.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_deleteRoute(a,this.__wbg_ptr,e);var n=Tt().getInt32(a+4*0,!0),r=Tt().getInt32(a+4*1,!0);if(r)throw Ui(n)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){_t.mapmodel_clearAllRoutes(this.__wbg_ptr)}renderRoutes(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderRoutes(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}evaluateRoute(e){let n,r;try{const T=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateRoute(T,this.__wbg_ptr,Ci(e));var a=Tt().getInt32(T+4*0,!0),h=Tt().getInt32(T+4*1,!0),m=Tt().getInt32(T+4*2,!0),l=Tt().getInt32(T+4*3,!0),x=a,S=h;if(l)throw x=0,S=0,Ui(m);return n=x,r=S,ji(x,S)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(n,r,1)}}debugReachablePath(e,n){let r,a;try{const C=_t.__wbindgen_add_to_stack_pointer(-16),N=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Po;_t.mapmodel_debugReachablePath(C,this.__wbg_ptr,N,B,n);var h=Tt().getInt32(C+4*0,!0),m=Tt().getInt32(C+4*1,!0),l=Tt().getInt32(C+4*2,!0),x=Tt().getInt32(C+4*3,!0),S=h,T=m;if(x)throw S=0,T=0,Ui(l);return r=S,a=T,ji(S,T)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(r,a,1)}}debugUnreachablePath(e,n){let r,a;try{const C=_t.__wbindgen_add_to_stack_pointer(-16),N=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Po;_t.mapmodel_debugUnreachablePath(C,this.__wbg_ptr,N,B,n);var h=Tt().getInt32(C+4*0,!0),m=Tt().getInt32(C+4*1,!0),l=Tt().getInt32(C+4*2,!0),x=Tt().getInt32(C+4*3,!0),S=h,T=m;if(x)throw S=0,T=0,Ui(l);return r=S,a=T,ji(S,T)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(r,a,1)}}evaluateOD(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateOD(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}recalculateStats(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_recalculateStats(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toSavefile(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16),h=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),m=Po;_t.mapmodel_loadSavefile(a,this.__wbg_ptr,h,m);var n=Tt().getInt32(a+4*0,!0),r=Tt().getInt32(a+4*1,!0);if(r)throw Ui(n)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_meshDensity(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}classifyExistingNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_classifyExistingNetwork(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}importExistingRoutes(){return _t.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return _t.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getSchools(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getGPHospitals(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getGPHospitals(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getTownCentres(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getTownCentres(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getDataZones(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getDataZones(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderReachableNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderReachableNetwork(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderLevelOfService(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderLevelOfService(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderCoreNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderCoreNetwork(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderPrecalculatedFlows(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderPrecalculatedFlows(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getMajorJunctions(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getMajorJunctions(S,this.__wbg_ptr);var r=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=r,x=a;if(m)throw l=0,x=0,Ui(h);return e=l,n=x,ji(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}}async function mS(s,e){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,e)}catch(r){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await s.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(s,e);return n instanceof WebAssembly.Instance?{instance:n,module:s}:n}}function gS(){const s={};return s.wbg={},s.wbg.__wbindgen_object_drop_ref=function(e){Ui(e)},s.wbg.__wbindgen_string_new=function(e,n){const r=ji(e,n);return Ci(r)},s.wbg.__wbindgen_string_get=function(e,n){const r=En(n),a=typeof r=="string"?r:void 0;var h=Jl(a)?0:nu(a,_t.__wbindgen_malloc,_t.__wbindgen_realloc),m=Po;Tt().setInt32(e+4*1,m,!0),Tt().setInt32(e+4*0,h,!0)},s.wbg.__wbindgen_number_get=function(e,n){const r=En(n),a=typeof r=="number"?r:void 0;Tt().setFloat64(e+8*1,Jl(a)?0:a,!0),Tt().setInt32(e+4*0,!Jl(a),!0)},s.wbg.__wbindgen_error_new=function(e,n){const r=new Error(ji(e,n));return Ci(r)},s.wbg.__wbindgen_boolean_get=function(e){const n=En(e);return typeof n=="boolean"?n?1:0:2},s.wbg.__wbindgen_is_bigint=function(e){return typeof En(e)=="bigint"},s.wbg.__wbindgen_is_object=function(e){const n=En(e);return typeof n=="object"&&n!==null},s.wbg.__wbindgen_in=function(e,n){return En(e)in En(n)},s.wbg.__wbindgen_bigint_from_i64=function(e){return Ci(e)},s.wbg.__wbindgen_jsval_eq=function(e,n){return En(e)===En(n)},s.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return Ci(n)},s.wbg.__wbindgen_is_string=function(e){return typeof En(e)=="string"},s.wbg.__wbindgen_is_undefined=function(e){return En(e)===void 0},s.wbg.__wbindgen_jsval_loose_eq=function(e,n){return En(e)==En(n)},s.wbg.__wbindgen_as_number=function(e){return+En(e)},s.wbg.__wbg_String_b9412f8799faab3e=function(e,n){const r=String(En(n)),a=nu(r,_t.__wbindgen_malloc,_t.__wbindgen_realloc),h=Po;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},s.wbg.__wbindgen_object_clone_ref=function(e){const n=En(e);return Ci(n)},s.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,n){const r=En(e)[En(n)];return Ci(r)},s.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(En(e))},s.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(En(e))},s.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(En(e))},s.wbg.__wbg_log_b103404cc5920657=function(e){console.log(En(e))},s.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(En(e))},s.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Ci(e)},s.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const r=En(n).stack,a=nu(r,_t.__wbindgen_malloc,_t.__wbindgen_realloc),h=Po;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},s.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let r,a;try{r=e,a=n,console.error(ji(e,n))}finally{_t.__wbindgen_free(r,a,1)}},s.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const n=En(e).performance;return Ci(n)},s.wbg.__wbg_now_abd80e969af37148=function(e){return En(e).now()},s.wbg.__wbg_get_3baa728f9d58d3f6=function(e,n){const r=En(e)[n>>>0];return Ci(r)},s.wbg.__wbg_length_ae22078168b726f5=function(e){return En(e).length},s.wbg.__wbindgen_is_function=function(e){return typeof En(e)=="function"},s.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,n){const r=new Function(ji(e,n));return Ci(r)},s.wbg.__wbg_next_de3e9db4440638b2=function(e){const n=En(e).next;return Ci(n)},s.wbg.__wbg_next_f9cb570345655b9a=function(){return ml(function(e){const n=En(e).next();return Ci(n)},arguments)},s.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return En(e).done},s.wbg.__wbg_value_6d39332ab4788d86=function(e){const n=En(e).value;return Ci(n)},s.wbg.__wbg_iterator_888179a48810a9fe=function(){return Ci(Symbol.iterator)},s.wbg.__wbg_get_224d16597dbbfd96=function(){return ml(function(e,n){const r=Reflect.get(En(e),En(n));return Ci(r)},arguments)},s.wbg.__wbg_call_1084a111329e68ce=function(){return ml(function(e,n){const r=En(e).call(En(n));return Ci(r)},arguments)},s.wbg.__wbg_self_3093d5d1f7bcb682=function(){return ml(function(){const e=self.self;return Ci(e)},arguments)},s.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return ml(function(){const e=window.window;return Ci(e)},arguments)},s.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return ml(function(){const e=globalThis.globalThis;return Ci(e)},arguments)},s.wbg.__wbg_global_e5a3fe56f8be9485=function(){return ml(function(){const e=global.global;return Ci(e)},arguments)},s.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(En(e))},s.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let n;try{n=En(e)instanceof ArrayBuffer}catch{n=!1}return n},s.wbg.__wbg_call_89af060b4e1523f2=function(){return ml(function(e,n,r){const a=En(e).call(En(n),En(r));return Ci(a)},arguments)},s.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let n;try{n=En(e)instanceof Map}catch{n=!1}return n},s.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(En(e))},s.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const n=Object.entries(En(e));return Ci(n)},s.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const n=En(e).buffer;return Ci(n)},s.wbg.__wbg_new_ea1883e1e5e86686=function(e){const n=new Uint8Array(En(e));return Ci(n)},s.wbg.__wbg_set_d1e79e2388520f18=function(e,n,r){En(e).set(En(n),r>>>0)},s.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return En(e).length},s.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let n;try{n=En(e)instanceof Uint8Array}catch{n=!1}return n},s.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const r=En(n),a=typeof r=="bigint"?r:void 0;Tt().setBigInt64(e+8*1,Jl(a)?BigInt(0):a,!0),Tt().setInt32(e+4*0,!Jl(a),!0)},s.wbg.__wbindgen_debug_string=function(e,n){const r=Dp(En(n)),a=nu(r,_t.__wbindgen_malloc,_t.__wbindgen_realloc),h=Po;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},s.wbg.__wbindgen_throw=function(e,n){throw new Error(ji(e,n))},s.wbg.__wbindgen_memory=function(){const e=_t.memory;return Ci(e)},s}function _S(s,e){return _t=s.exports,$v.__wbindgen_wasm_module=e,Yl=null,yh=null,_h=null,_t}async function $v(s){if(_t!==void 0)return _t;typeof s<"u"&&Object.getPrototypeOf(s)===Object.prototype?{module_or_path:s}=s:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof s>"u"&&(s=new URL("backend_bg.wasm",self.location));const e=gS();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:n,module:r}=await mS(await s,e);return _S(n,r)}class yS{constructor(){lh(this,"inner");this.inner=null}async loadFile(e){await $v(),this.inner=new pS(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,n){return this.checkReady(),this.inner.setRoute(e??void 0,n)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,n){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,n))}debugUnreachablePath(e,n){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,n))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let Yv="MZEJTanw3WpxRvt7qDfo",Hf=Yn(""),Ni=Yn({kind:"main"}),Ql=Yn("primary"),vS=Yn(null),Ph=Yn(0),sr=Yn(null),Ju=Yn(null),Sh=Yn(null),em=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],ou=Object.fromEntries(em.map(([s,e,n])=>[s,[e,n]]));async function Dh(){let s=Df(sr),e=Df(Hf);if(!s||!e)return;let n=await s.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,n)}let Np=Yn(!0);function rd(s){return Df(Np)?`https://assets.od2net.org/tmp_npt_editor/${s}`:s}let Iy=Yn(null);function bS(s){let e,n,r,a,h,m,l,x;return{c(){e=ue("div"),n=ue("h2"),n.textContent="Debug network mode",r=Oe(),a=ue("button"),a.textContent="Back",h=Oe(),m=ue("p"),m.textContent="Hover to see a segment's properties, and click to open OSM",Ze(e,"slot","left")},m(S,T){ae(S,e,T),Z(e,n),Z(e,r),Z(e,a),Z(e,h),Z(e,m),l||(x=Rt(a,"click",s[3]),l=!0)},p:tt,d(S){S&&oe(e),l=!1,x()}}}function xS(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function wS(s){let e,n;return e=new rr({props:{data:s[4],generateId:!0,$$slots:{default:[SS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.data=r[4]),a&64&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function kS(s){let e,n;return e=new iS({props:{properties:s[5]}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&32&&(h.properties=r[5]),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function IS(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[kS,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&96&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function SS(s){let e,n;return e=new _r({props:{id:"network",paint:{"line-width":Cs(5,7),"line-color":"black"},manageHoverState:!0,hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[IS]},$$scope:{ctx:s}}}),e.$on("click",s[2]),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&64&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function ES(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function AS(s){let e,n,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:ES,then:wS,catch:xS,value:4,blocks:[,,,]};return ms(n=xl(s[0]).renderDebug(),a),{c(){e=ue("div"),a.block.c(),Ze(e,"slot","map")},m(h,m){ae(h,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,r=!0},p(h,m){s=h,a.ctx=s,m&1&&n!==(n=xl(s[0]).renderDebug())&&ms(n,a)||wl(a,s,m)},i(h){r||(_e(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}r=!1},d(h){h&&oe(e),a.block.d(),a.token=null,a=null}}}function TS(s){let e,n;return e=new gc({props:{$$slots:{map:[AS],left:[bS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,[a]){const h={};a&67&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function CS(s,e,n){let r,a;return Ft(s,sr,l=>n(0,r=l)),Ft(s,Ni,l=>n(1,a=l)),[r,a,l=>window.open(xl(l.detail.features[0].properties).way,"_blank"),()=>Nn(Ni,a={kind:"main"},a)]}class LS extends fn{constructor(e){super(),hn(this,e,CS,TS,an,{})}}function MS(s){let e,n,r,a,h,m;return{c(){e=ue("div"),n=ue("h2"),n.textContent="Debug mesh density mode",r=Oe(),a=ue("button"),a.textContent="Back",Ze(e,"slot","left")},m(l,x){ae(l,e,x),Z(e,n),Z(e,r),Z(e,a),h||(m=Rt(a,"click",s[2]),h=!0)},p:tt,d(l){l&&oe(e),h=!1,m()}}}function RS(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function PS(s){let e,n;return e=new rr({props:{data:s[3],generateId:!0,$$slots:{default:[DS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.data=r[3]),a&16&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function DS(s){let e,n,r,a;return e=new _r({props:{paint:{"line-color":"black"}}}),r=new mc({props:{paint:{"fill-color":"grey","fill-opacity":Cs(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p:tt,i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function NS(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function zS(s){let e,n,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:NS,then:PS,catch:RS,value:3,blocks:[,,,]};return ms(n=xl(s[0]).meshDensity(),a),{c(){e=ue("div"),a.block.c(),Ze(e,"slot","map")},m(h,m){ae(h,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,r=!0},p(h,m){s=h,a.ctx=s,m&1&&n!==(n=xl(s[0]).meshDensity())&&ms(n,a)||wl(a,s,m)},i(h){r||(_e(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}r=!1},d(h){h&&oe(e),a.block.d(),a.token=null,a=null}}}function FS(s){let e,n;return e=new gc({props:{$$slots:{map:[zS],left:[MS]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,[a]){const h={};a&19&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function OS(s,e,n){let r,a;return Ft(s,sr,m=>n(0,r=m)),Ft(s,Ni,m=>n(1,a=m)),[r,a,()=>Nn(Ni,a={kind:"main"},a)]}class BS extends fn{constructor(e){super(),hn(this,e,OS,FS,an,{})}}let Jv=Yn(new Map),zp=Yn(!0),Xf=Yn(!1),Wf=Yn(!1),Kf=Yn(!1),$f=Yn(!1),Yf=Yn(!1),Qu=Yn(!1),Fp=Yn(!0),Sy=Yn(!1);function US(s){let e,n,r,a;const h=s[1].default,m=Zi(h,s,s[0],null);return{c(){e=ue("a"),m&&m.c(),Ze(e,"href","#")},m(l,x){ae(l,e,x),m&&m.m(e,null),n=!0,r||(a=Rt(e,"click",Nh(s[2])),r=!0)},p(l,[x]){m&&m.p&&(!n||x&1)&&Xi(m,h,l,l[0],n?Hi(h,l[0],x,null):Wi(l[0]),null)},i(l){n||(_e(m,l),n=!0)},o(l){Ie(m,l),n=!1},d(l){l&&oe(e),m&&m.d(l),r=!1,a()}}}function jS(s,e,n){let{$$slots:r={},$$scope:a}=e;function h(m){ur.call(this,s,m)}return s.$$set=m=>{"$$scope"in m&&n(0,a=m.$$scope)},[a,r,h]}class qS extends fn{constructor(e){super(),hn(this,e,jS,US,an,{})}}let ds={primaryRoutes:"#c00000",secondaryRoutes:"#e97132",localAccessRoutes:"#ffc000",longDistanceRoutes:"#4ea72e"},tm={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},ac=Xp(["get","infra_type"],Object.fromEntries(em.map(s=>[s[0],s[2]])),"red"),Op=Xp(["get","los"],tm,"black");function Ey(s){let e,n,r,a,h=`2px solid ${ds.primaryRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Primary Route Reference Layers",r=Oe(),a=ue("div"),e.open=!0,Pn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,r),Z(e,a),s[8](a)},p:tt,d(m){m&&oe(e),s[8](null)}}}function Ay(s){let e,n,r,a,h=`2px solid ${ds.secondaryRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Secondary Route Reference Layers",r=Oe(),a=ue("div"),e.open=!0,Pn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,r),Z(e,a),s[9](a)},p:tt,d(m){m&&oe(e),s[9](null)}}}function Ty(s){let e,n,r,a,h=`2px solid ${ds.localAccessRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Local Access Route Reference Layers",r=Oe(),a=ue("div"),e.open=!0,Pn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,r),Z(e,a),s[10](a)},p:tt,d(m){m&&oe(e),s[10](null)}}}function Cy(s){let e,n,r,a,h=`2px solid ${ds.longDistanceRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Long Disance Route Reference Layers",r=Oe(),a=ue("div"),e.open=!0,Pn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,r),Z(e,a),s[11](a)},p:tt,d(m){m&&oe(e),s[11](null)}}}function VS(s){let e,n,r,a,h,m,l,x,S,T=s[5]=="primary"&&Ey(s),C=s[5]=="secondary"&&Ay(s),N=s[5]=="local access"&&Ty(s),B=s[5]=="long distance"&&Cy(s);return{c(){e=ue("details"),n=ue("summary"),n.textContent="Basic Reference Layers",r=Oe(),a=ue("div"),h=Oe(),T&&T.c(),m=Oe(),C&&C.c(),l=Oe(),N&&N.c(),x=Oe(),B&&B.c(),S=ni(),e.open=!0,Pn(e,"border","2px solid black")},m(U,ee){ae(U,e,ee),Z(e,n),Z(e,r),Z(e,a),s[7](a),ae(U,h,ee),T&&T.m(U,ee),ae(U,m,ee),C&&C.m(U,ee),ae(U,l,ee),N&&N.m(U,ee),ae(U,x,ee),B&&B.m(U,ee),ae(U,S,ee)},p(U,[ee]){U[5]=="primary"?T?T.p(U,ee):(T=Ey(U),T.c(),T.m(m.parentNode,m)):T&&(T.d(1),T=null),U[5]=="secondary"?C?C.p(U,ee):(C=Ay(U),C.c(),C.m(l.parentNode,l)):C&&(C.d(1),C=null),U[5]=="local access"?N?N.p(U,ee):(N=Ty(U),N.c(),N.m(x.parentNode,x)):N&&(N.d(1),N=null),U[5]=="long distance"?B?B.p(U,ee):(B=Cy(U),B.c(),B.m(S.parentNode,S)):B&&(B.d(1),B=null)},i:tt,o:tt,d(U){U&&(oe(e),oe(h),oe(m),oe(l),oe(x),oe(S)),s[7](null),T&&T.d(U),C&&C.d(U),N&&N.d(U),B&&B.d(U)}}}function ph(s,e,n){if(s){s.innerHTML="";for(let r of n){let a=e.get(r);a&&s.appendChild(a)}}}function GS(s,e,n){let r,a;Ft(s,Jv,ee=>n(6,r=ee)),Ft(s,Ql,ee=>n(5,a=ee));let h=null,m=null,l=null,x=null,S=null;function T(ee){Kn[ee?"unshift":"push"](()=>{h=ee,n(0,h)})}function C(ee){Kn[ee?"unshift":"push"](()=>{m=ee,n(1,m)})}function N(ee){Kn[ee?"unshift":"push"](()=>{l=ee,n(2,l)})}function B(ee){Kn[ee?"unshift":"push"](()=>{x=ee,n(3,x)})}function U(ee){Kn[ee?"unshift":"push"](()=>{S=ee,n(4,S)})}return s.$$.update=()=>{s.$$.dirty&65&&ph(h,r,["route network","simd","population density","core network","existing network","level of service","traffic volume","reachable network"]),s.$$.dirty&66&&ph(m,r,["high npt route coverage"]),s.$$.dirty&68&&ph(l,r,["town centres"]),s.$$.dirty&72&&ph(x,r,["schools","gp hospitals"]),s.$$.dirty&80&&ph(S,r,["urban areas"])},[h,m,l,x,S,a,r,T,C,N,B,U]}class ZS extends fn{constructor(e){super(),hn(this,e,GS,VS,an,{})}}function HS(s){let e,n,r,a,h,m=Math.round(s[2]*100)+"",l,x,S,T,C,N,B;return{c(){e=ue("p"),n=ue("a"),r=Fe(s[1]),a=Fe(`
  :
  `),h=ue("b"),l=Fe(m),x=Fe("%"),S=Oe(),T=ue("progress"),Ze(n,"href","#"),T.value=C=s[2]*100,Ze(T,"max","100")},m(U,ee){ae(U,e,ee),Z(e,n),Z(n,r),Z(e,a),Z(e,h),Z(h,l),Z(h,x),Z(e,S),Z(e,T),N||(B=Rt(n,"click",Nh(s[3])),N=!0)},p(U,[ee]){ee&2&&Lt(r,U[1]),ee&4&&m!==(m=Math.round(U[2]*100)+"")&&Lt(l,m),ee&4&&C!==(C=U[2]*100)&&(T.value=C)},i:tt,o:tt,d(U){U&&oe(e),N=!1,B()}}}function XS(s,e,n){let{label:r}=e,{showLayer:a}=e,{pct:h}=e;const m=()=>n(0,a=!0);return s.$$set=l=>{"label"in l&&n(1,r=l.label),"showLayer"in l&&n(0,a=l.showLayer),"pct"in l&&n(2,h=l.pct)},[a,r,h,m]}class Ma extends fn{constructor(e){super(),hn(this,e,XS,HS,an,{label:1,showLayer:0,pct:2})}}function Ly(s,e,n){const r=s.slice();return r[22]=e[n][0],r[23]=e[n][1],r}function My(s,e,n){const r=s.slice();return r[22]=e[n][0],r[23]=e[n][1],r}function Ry(s){let e,n,r,a=`2px solid ${ds.primaryRoutes}`,h,m,l,x,S,T,C,N,B=s[0].average_weighted_directness.toFixed(1)+"",U,ee,ie,se,Q,K,pe,ve,De,he,xe,be,Ce,we,ye;function Ue(ft){s[11](ft)}let qe={label:"High cycling flow coverage",pct:lc(s[0].covered_flow_quintile_sums[0],s[0].total_flow_quintile_sums[0])};s[1]!==void 0&&(qe.showLayer=s[1]),n=new Ma({props:qe}),Kn.push(()=>gr(n,"showLayer",Ue));let pt=(s[2]=="secondary"||s[2]=="local access"||s[2]=="long distance")&&Py(s),St=(s[2]=="local access"||s[2]=="long distance")&&Dy(s),dt=s[2]=="long distance"&&Ny(s),ut=qn(Object.entries(s[0].od_percents_infra_type).toSorted(Oy)),Bt=[];for(let ft=0;ft<ut.length;ft+=1)Bt[ft]=zy(My(s,ut,ft));let vt=qn(Object.entries(s[0].od_percents_los).toSorted(By)),wt=[];for(let ft=0;ft<vt.length;ft+=1)wt[ft]=Fy(Ly(s,vt,ft));return{c(){e=ue("div"),ot(n.$$.fragment),h=Oe(),pt&&pt.c(),m=Oe(),St&&St.c(),l=Oe(),dt&&dt.c(),x=Oe(),S=ue("div"),T=ue("p"),C=ue("a"),C.textContent="Average weighted directness",N=Fe(`
      : `),U=Fe(B),ee=Fe("x"),ie=Oe(),se=ue("details"),Q=ue("summary"),Q.textContent="Percent of demand by infrastructure type",K=Oe(),pe=ue("ul");for(let ft=0;ft<Bt.length;ft+=1)Bt[ft].c();ve=Oe(),De=ue("details"),he=ue("summary"),he.textContent="Percent of demand by level of service:",xe=Oe(),be=ue("ul");for(let ft=0;ft<wt.length;ft+=1)wt[ft].c();Pn(e,"border",a),Ze(C,"href","#"),Pn(S,"margin-top","4px"),Pn(S,"border","2px solid black")},m(ft,xt){ae(ft,e,xt),it(n,e,null),ae(ft,h,xt),pt&&pt.m(ft,xt),ae(ft,m,xt),St&&St.m(ft,xt),ae(ft,l,xt),dt&&dt.m(ft,xt),ae(ft,x,xt),ae(ft,S,xt),Z(S,T),Z(T,C),Z(T,N),Z(T,U),Z(T,ee),Z(S,ie),Z(S,se),Z(se,Q),Z(se,K),Z(se,pe);for(let It=0;It<Bt.length;It+=1)Bt[It]&&Bt[It].m(pe,null);Z(S,ve),Z(S,De),Z(De,he),Z(De,xe),Z(De,be);for(let It=0;It<wt.length;It+=1)wt[It]&&wt[It].m(be,null);Ce=!0,we||(ye=Rt(C,"click",Nh(s[20])),we=!0)},p(ft,xt){const It={};if(xt&1&&(It.pct=lc(ft[0].covered_flow_quintile_sums[0],ft[0].total_flow_quintile_sums[0])),!r&&xt&2&&(r=!0,It.showLayer=ft[1],mr(()=>r=!1)),n.$set(It),ft[2]=="secondary"||ft[2]=="local access"||ft[2]=="long distance"?pt?(pt.p(ft,xt),xt&4&&_e(pt,1)):(pt=Py(ft),pt.c(),_e(pt,1),pt.m(m.parentNode,m)):pt&&(zn(),Ie(pt,1,1,()=>{pt=null}),Fn()),ft[2]=="local access"||ft[2]=="long distance"?St?(St.p(ft,xt),xt&4&&_e(St,1)):(St=Dy(ft),St.c(),_e(St,1),St.m(l.parentNode,l)):St&&(zn(),Ie(St,1,1,()=>{St=null}),Fn()),ft[2]=="long distance"?dt?(dt.p(ft,xt),xt&4&&_e(dt,1)):(dt=Ny(ft),dt.c(),_e(dt,1),dt.m(x.parentNode,x)):dt&&(zn(),Ie(dt,1,1,()=>{dt=null}),Fn()),(!Ce||xt&1)&&B!==(B=ft[0].average_weighted_directness.toFixed(1)+"")&&Lt(U,B),xt&1){ut=qn(Object.entries(ft[0].od_percents_infra_type).toSorted(Oy));let Yt;for(Yt=0;Yt<ut.length;Yt+=1){const pn=My(ft,ut,Yt);Bt[Yt]?Bt[Yt].p(pn,xt):(Bt[Yt]=zy(pn),Bt[Yt].c(),Bt[Yt].m(pe,null))}for(;Yt<Bt.length;Yt+=1)Bt[Yt].d(1);Bt.length=ut.length}if(xt&1){vt=qn(Object.entries(ft[0].od_percents_los).toSorted(By));let Yt;for(Yt=0;Yt<vt.length;Yt+=1){const pn=Ly(ft,vt,Yt);wt[Yt]?wt[Yt].p(pn,xt):(wt[Yt]=Fy(pn),wt[Yt].c(),wt[Yt].m(be,null))}for(;Yt<wt.length;Yt+=1)wt[Yt].d(1);wt.length=vt.length}},i(ft){Ce||(_e(n.$$.fragment,ft),_e(pt),_e(St),_e(dt),Ce=!0)},o(ft){Ie(n.$$.fragment,ft),Ie(pt),Ie(St),Ie(dt),Ce=!1},d(ft){ft&&(oe(e),oe(h),oe(m),oe(l),oe(x),oe(S)),rt(n),pt&&pt.d(ft),St&&St.d(ft),dt&&dt.d(ft),Er(Bt,ft),Er(wt,ft),we=!1,ye()}}}function Py(s){let e,n,r,a,h,m,l=`2px solid ${ds.secondaryRoutes}`,x;function S(B){s[12](B)}let T={label:"Medium cycling flow coverage",pct:lc(s[0].covered_flow_quintile_sums[1],s[0].total_flow_quintile_sums[1])};s[1]!==void 0&&(T.showLayer=s[1]),n=new Ma({props:T}),Kn.push(()=>gr(n,"showLayer",S));function C(B){s[13](B)}let N={label:"Town centres",pct:s[0].percent_reachable_town_centres};return s[3]!==void 0&&(N.showLayer=s[3]),h=new Ma({props:N}),Kn.push(()=>gr(h,"showLayer",C)),{c(){e=ue("div"),ot(n.$$.fragment),a=Oe(),ot(h.$$.fragment),Pn(e,"margin-top","4px"),Pn(e,"border",l)},m(B,U){ae(B,e,U),it(n,e,null),Z(e,a),it(h,e,null),x=!0},p(B,U){const ee={};U&1&&(ee.pct=lc(B[0].covered_flow_quintile_sums[1],B[0].total_flow_quintile_sums[1])),!r&&U&2&&(r=!0,ee.showLayer=B[1],mr(()=>r=!1)),n.$set(ee);const ie={};U&1&&(ie.pct=B[0].percent_reachable_town_centres),!m&&U&8&&(m=!0,ie.showLayer=B[3],mr(()=>m=!1)),h.$set(ie)},i(B){x||(_e(n.$$.fragment,B),_e(h.$$.fragment,B),x=!0)},o(B){Ie(n.$$.fragment,B),Ie(h.$$.fragment,B),x=!1},d(B){B&&oe(e),rt(n),rt(h)}}}function Dy(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie=`2px solid ${ds.localAccessRoutes}`,se;function Q(ye){s[14](ye)}let K={label:"Low cycling flow coverage",pct:lc(s[0].covered_flow_quintile_sums[2],s[0].total_flow_quintile_sums[2])};s[1]!==void 0&&(K.showLayer=s[1]),n=new Ma({props:K}),Kn.push(()=>gr(n,"showLayer",Q));function pe(ye){s[15](ye)}let ve={label:"Schools",pct:s[0].percent_reachable_schools};s[4]!==void 0&&(ve.showLayer=s[4]),h=new Ma({props:ve}),Kn.push(()=>gr(h,"showLayer",pe));function De(ye){s[16](ye)}let he={label:"GPs and hospitals",pct:s[0].percent_reachable_gp_hospitals};s[5]!==void 0&&(he.showLayer=s[5]),x=new Ma({props:he}),Kn.push(()=>gr(x,"showLayer",De));function xe(ye){s[17](ye)}let be={label:"Deprived population coverage",pct:s[0].percent_reachable_imd_population};s[6]!==void 0&&(be.showLayer=s[6]),C=new Ma({props:be}),Kn.push(()=>gr(C,"showLayer",xe));function Ce(ye){s[18](ye)}let we={label:"Population coverage",pct:s[0].percent_reachable_population};return s[7]!==void 0&&(we.showLayer=s[7]),U=new Ma({props:we}),Kn.push(()=>gr(U,"showLayer",Ce)),{c(){e=ue("div"),ot(n.$$.fragment),a=Oe(),ot(h.$$.fragment),l=Oe(),ot(x.$$.fragment),T=Oe(),ot(C.$$.fragment),B=Oe(),ot(U.$$.fragment),Pn(e,"margin-top","4px"),Pn(e,"border",ie)},m(ye,Ue){ae(ye,e,Ue),it(n,e,null),Z(e,a),it(h,e,null),Z(e,l),it(x,e,null),Z(e,T),it(C,e,null),Z(e,B),it(U,e,null),se=!0},p(ye,Ue){const qe={};Ue&1&&(qe.pct=lc(ye[0].covered_flow_quintile_sums[2],ye[0].total_flow_quintile_sums[2])),!r&&Ue&2&&(r=!0,qe.showLayer=ye[1],mr(()=>r=!1)),n.$set(qe);const pt={};Ue&1&&(pt.pct=ye[0].percent_reachable_schools),!m&&Ue&16&&(m=!0,pt.showLayer=ye[4],mr(()=>m=!1)),h.$set(pt);const St={};Ue&1&&(St.pct=ye[0].percent_reachable_gp_hospitals),!S&&Ue&32&&(S=!0,St.showLayer=ye[5],mr(()=>S=!1)),x.$set(St);const dt={};Ue&1&&(dt.pct=ye[0].percent_reachable_imd_population),!N&&Ue&64&&(N=!0,dt.showLayer=ye[6],mr(()=>N=!1)),C.$set(dt);const ut={};Ue&1&&(ut.pct=ye[0].percent_reachable_population),!ee&&Ue&128&&(ee=!0,ut.showLayer=ye[7],mr(()=>ee=!1)),U.$set(ut)},i(ye){se||(_e(n.$$.fragment,ye),_e(h.$$.fragment,ye),_e(x.$$.fragment,ye),_e(C.$$.fragment,ye),_e(U.$$.fragment,ye),se=!0)},o(ye){Ie(n.$$.fragment,ye),Ie(h.$$.fragment,ye),Ie(x.$$.fragment,ye),Ie(C.$$.fragment,ye),Ie(U.$$.fragment,ye),se=!1},d(ye){ye&&oe(e),rt(n),rt(h),rt(x),rt(C),rt(U)}}}function Ny(s){let e,n,r,a=`2px solid ${ds.longDistanceRoutes}`,h;function m(x){s[19](x)}let l={label:"Reachable settlements (TODO)",pct:0};return s[8]!==void 0&&(l.showLayer=s[8]),n=new Ma({props:l}),Kn.push(()=>gr(n,"showLayer",m)),{c(){e=ue("div"),ot(n.$$.fragment),Pn(e,"margin-top","4px"),Pn(e,"border",a)},m(x,S){ae(x,e,S),it(n,e,null),h=!0},p(x,S){const T={};!r&&S&256&&(r=!0,T.showLayer=x[8],mr(()=>r=!1)),n.$set(T)},i(x){h||(_e(n.$$.fragment,x),h=!0)},o(x){Ie(n.$$.fragment,x),h=!1},d(x){x&&oe(e),rt(n)}}}function zy(s){let e,n=s[22]+"",r,a,h=Math.round(s[23]*100)+"",m,l;return{c(){e=ue("li"),r=Fe(n),a=Fe(": "),m=Fe(h),l=Fe("%")},m(x,S){ae(x,e,S),Z(e,r),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[22]+"")&&Lt(r,n),S&1&&h!==(h=Math.round(x[23]*100)+"")&&Lt(m,h)},d(x){x&&oe(e)}}}function Fy(s){let e,n=s[22]+"",r,a,h=Math.round(s[23]*100)+"",m,l;return{c(){e=ue("li"),r=Fe(n),a=Fe(": "),m=Fe(h),l=Fe("%")},m(x,S){ae(x,e,S),Z(e,r),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[22]+"")&&Lt(r,n),S&1&&h!==(h=Math.round(x[23]*100)+"")&&Lt(m,h)},d(x){x&&oe(e)}}}function WS(s){let e,n,r,a,h,m,l=s[0]&&Ry(s);return{c(){e=ue("button"),e.textContent="Recalculate",n=Oe(),l&&l.c(),r=ni()},m(x,S){ae(x,e,S),ae(x,n,S),l&&l.m(x,S),ae(x,r,S),a=!0,h||(m=Rt(e,"click",s[10]),h=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&_e(l,1)):(l=Ry(x),l.c(),_e(l,1),l.m(r.parentNode,r)):l&&(zn(),Ie(l,1,1,()=>{l=null}),Fn())},i(x){a||(_e(l),a=!0)},o(x){Ie(l),a=!1},d(x){x&&(oe(e),oe(n),oe(r)),l&&l.d(x),h=!1,m()}}}function lc(s,e){return e==0?0:s/e}const Oy=(s,e)=>e[1]-s[1],By=(s,e)=>e[1]-s[1];function KS(s,e,n){let r,a,h,m,l,x,S,T,C,N,B;Ft(s,Iy,be=>n(0,r=be)),Ft(s,sr,be=>n(21,a=be)),Ft(s,Qu,be=>n(1,h=be)),Ft(s,Ql,be=>n(2,m=be)),Ft(s,Kf,be=>n(3,l=be)),Ft(s,Xf,be=>n(4,x=be)),Ft(s,Wf,be=>n(5,S=be)),Ft(s,$f,be=>n(6,T=be)),Ft(s,Yf,be=>n(7,C=be)),Ft(s,Sy,be=>n(8,N=be)),Ft(s,Ni,be=>n(9,B=be));async function U(){Nn(Iy,r=await a.recalculateStats(),r)}cc(async()=>{r==null&&await U()});function ee(be){h=be,Qu.set(h)}function ie(be){h=be,Qu.set(h)}function se(be){l=be,Kf.set(l)}function Q(be){h=be,Qu.set(h)}function K(be){x=be,Xf.set(x)}function pe(be){S=be,Wf.set(S)}function ve(be){T=be,$f.set(T)}function De(be){C=be,Yf.set(C)}function he(be){N=be,Sy.set(N)}return[r,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe,ve,De,he,()=>Nn(Ni,B={kind:"evaluate-route",browse:xl(r).worst_directness_routes},B)]}class $S extends fn{constructor(e){super(),hn(this,e,KS,WS,an,{})}}function Uy(s,e,n){const r=s.slice();return r[4]=e[n],r}function jy(s){let e,n=s[4]+"",r;return{c(){e=ue("option"),r=Fe(n),e.__value=s[4],qi(e,e.__value)},m(a,h){ae(a,e,h),Z(e,r)},p:tt,d(a){a&&oe(e)}}}function YS(s){let e,n,r,a,h,m=qn(s[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=jy(Uy(s,m,x));return{c(){e=ue("label"),n=Fe(`Area:
  `),r=ue("select");for(let x=0;x<l.length;x+=1)l[x].c();s[0]===void 0&&ra(()=>s[3].call(r))},m(x,S){ae(x,e,S),Z(e,n),Z(e,r);for(let T=0;T<l.length;T+=1)l[T]&&l[T].m(r,null);Us(r,s[0],!0),a||(h=[Rt(r,"change",s[3]),Rt(r,"change",s[2])],a=!0)},p(x,[S]){if(S&2){m=qn(x[1]);let T;for(T=0;T<m.length;T+=1){const C=Uy(x,m,T);l[T]?l[T].p(C,S):(l[T]=jy(C),l[T].c(),l[T].m(r,null))}for(;T<l.length;T+=1)l[T].d(1);l.length=m.length}S&3&&Us(r,x[0])},i:tt,o:tt,d(x){x&&oe(e),Er(l,x),a=!1,Ki(h)}}}function JS(s,e,n){let{area:r}=e,a=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];a.sort();function h(){window.location.href=`index.html?boundary=${r}`}function m(){r=eu(this),n(0,r),n(1,a)}return s.$$set=l=>{"area"in l&&n(0,r=l.area)},[r,a,h,m]}class QS extends fn{constructor(e){super(),hn(this,e,JS,YS,an,{area:0})}}const{window:eE}=Y0;function qy(s,e,n){const r=s.slice();return r[19]=e[n],r}function Vy(s){let e,n,r=qn(s[0].features),a=[];for(let m=0;m<r.length;m+=1)a[m]=Gy(qy(s,r,m));const h=m=>Ie(a[m],1,1,()=>{a[m]=null});return{c(){e=ue("ol");for(let m=0;m<a.length;m+=1)a[m].c()},m(m,l){ae(m,e,l);for(let x=0;x<a.length;x+=1)a[x]&&a[x].m(e,null);n=!0},p(m,l){if(l&65){r=qn(m[0].features);let x;for(x=0;x<r.length;x+=1){const S=qy(m,r,x);a[x]?(a[x].p(S,l),_e(a[x],1)):(a[x]=Gy(S),a[x].c(),_e(a[x],1),a[x].m(e,null))}for(zn(),x=r.length;x<a.length;x+=1)h(x);Fn()}},i(m){if(!n){for(let l=0;l<r.length;l+=1)_e(a[l]);n=!0}},o(m){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Ie(a[l]);n=!1},d(m){m&&oe(e),Er(a,m)}}}function tE(s){var l,x;let e=(((l=s[19].properties)==null?void 0:l.name)||`Untitled route ${s[19].id}`)+"",n,r,a=((x=s[19].properties)==null?void 0:x.infra_type)+"",h,m;return{c(){n=Fe(e),r=Fe(" ("),h=Fe(a),m=Fe(")")},m(S,T){ae(S,n,T),ae(S,r,T),ae(S,h,T),ae(S,m,T)},p(S,T){var C,N;T&1&&e!==(e=(((C=S[19].properties)==null?void 0:C.name)||`Untitled route ${S[19].id}`)+"")&&Lt(n,e),T&1&&a!==(a=((N=S[19].properties)==null?void 0:N.infra_type)+"")&&Lt(h,a)},d(S){S&&(oe(n),oe(r),oe(h),oe(m))}}}function Gy(s){let e,n,r,a;function h(){return s[15](s[19])}return n=new qS({props:{$$slots:{default:[tE]},$$scope:{ctx:s}}}),n.$on("click",h),{c(){e=ue("li"),ot(n.$$.fragment),r=Oe()},m(m,l){ae(m,e,l),it(n,e,null),Z(e,r),a=!0},p(m,l){s=m;const x={};l&4194305&&(x.$$scope={dirty:l,ctx:s}),n.$set(x)},i(m){a||(_e(n.$$.fragment,m),a=!0)},o(m){Ie(n.$$.fragment,m),a=!1},d(m){m&&oe(e),rt(n)}}}function nE(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe,ve,De;n=new QS({props:{area:s[3]}});let he=s[0]&&Vy(s);return K=new ZS({}),{c(){e=ue("div"),ot(n.$$.fragment),r=Oe(),a=ue("div"),h=ue("button"),h.innerHTML=`Draw new <u>r</u>
        oute line`,m=Oe(),l=ue("button"),l.textContent="Clear all",x=Oe(),S=ue("label"),T=ue("input"),C=Fe(`
      Show current network`),N=Oe(),B=ue("details"),U=ue("summary"),U.textContent="Current network routes",ee=Oe(),he&&he.c(),ie=Oe(),se=ue("hr"),Q=Oe(),ot(K.$$.fragment),Ze(l,"class","secondary"),Ze(T,"type","checkbox"),Ze(e,"slot","left")},m(xe,be){ae(xe,e,be),it(n,e,null),Z(e,r),Z(e,a),Z(a,h),Z(a,m),Z(a,l),Z(e,x),Z(e,S),Z(S,T),T.checked=s[2],Z(S,C),Z(e,N),Z(e,B),Z(B,U),Z(B,ee),he&&he.m(B,null),Z(e,ie),Z(e,se),Z(e,Q),it(K,e,null),pe=!0,ve||(De=[Rt(h,"click",s[13]),Rt(l,"click",s[7]),Rt(T,"change",s[14])],ve=!0)},p(xe,be){const Ce={};be&8&&(Ce.area=xe[3]),n.$set(Ce),be&4&&(T.checked=xe[2]),xe[0]?he?(he.p(xe,be),be&1&&_e(he,1)):(he=Vy(xe),he.c(),_e(he,1),he.m(B,null)):he&&(zn(),Ie(he,1,1,()=>{he=null}),Fn())},i(xe){pe||(_e(n.$$.fragment,xe),_e(he),_e(K.$$.fragment,xe),pe=!0)},o(xe){Ie(n.$$.fragment,xe),Ie(he),Ie(K.$$.fragment,xe),pe=!1},d(xe){xe&&oe(e),rt(n),he&&he.d(),rt(K),ve=!1,Ki(De)}}}function Zy(s){let e,n;return e=new rr({props:{data:s[0],$$slots:{default:[sE]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.data=r[0]),a&4194308&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function iE(s){let e=(s[18].name||"Untitled")+"",n,r,a=ou[s[18].infra_type][0]+"",h,m;return{c(){n=Fe(e),r=Fe(" ("),h=Fe(a),m=Fe(")")},m(l,x){ae(l,n,x),ae(l,r,x),ae(l,h,x),ae(l,m,x)},p(l,x){x&262144&&e!==(e=(l[18].name||"Untitled")+"")&&Lt(n,e),x&262144&&a!==(a=ou[l[18].infra_type][0]+"")&&Lt(h,a)},d(l){l&&(oe(n),oe(r),oe(h),oe(m))}}}function rE(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[iE,({props:r})=>({18:r}),({props:r})=>r?262144:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&4456448&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function sE(s){let e,n;return e=new _r({props:{id:"routes",paint:{"line-width":Cs(5,7),"line-color":ac},layout:{visibility:s[2]?"visible":"none"},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[rE]},$$scope:{ctx:s}}}),e.$on("click",s[5]),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&4&&(h.layout={visibility:r[2]?"visible":"none"}),a&4194304&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function oE(s){let e,n,r=s[0]&&Zy(s);return{c(){e=ue("div"),r&&r.c(),Ze(e,"slot","map")},m(a,h){ae(a,e,h),r&&r.m(e,null),n=!0},p(a,h){a[0]?r?(r.p(a,h),h&1&&_e(r,1)):(r=Zy(a),r.c(),_e(r,1),r.m(e,null)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d()}}}function aE(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se;return n=new $S({}),{c(){e=ue("div"),ot(n.$$.fragment),r=Oe(),a=ue("div"),h=ue("button"),h.textContent="Evaluate a route",m=Oe(),l=ue("div"),x=ue("button"),x.textContent="Evaluate OD",S=Oe(),T=ue("div"),C=ue("button"),C.textContent="Debug network",N=Oe(),B=ue("div"),U=ue("button"),U.textContent="Debug mesh density",Ze(h,"class","secondary"),Ze(x,"class","secondary"),Ze(C,"class","secondary"),Ze(U,"class","secondary"),Ze(e,"slot","right")},m(Q,K){ae(Q,e,K),it(n,e,null),Z(e,r),Z(e,a),Z(a,h),Z(e,m),Z(e,l),Z(l,x),Z(e,S),Z(e,T),Z(T,C),Z(e,N),Z(e,B),Z(B,U),ee=!0,ie||(se=[Rt(h,"click",s[9]),Rt(x,"click",s[10]),Rt(C,"click",s[11]),Rt(U,"click",s[12])],ie=!0)},p:tt,i(Q){ee||(_e(n.$$.fragment,Q),ee=!0)},o(Q){Ie(n.$$.fragment,Q),ee=!1},d(Q){Q&&oe(e),rt(n),ie=!1,Ki(se)}}}function lE(s){let e,n,r,a;return e=new gc({props:{$$slots:{right:[aE],map:[oE],left:[nE]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(h,m){it(e,h,m),n=!0,r||(a=Rt(eE,"keydown",s[4]),r=!0)},p(h,[m]){const l={};m&4194319&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){n||(_e(e.$$.fragment,h),n=!0)},o(h){Ie(e.$$.fragment,h),n=!1},d(h){rt(e,h),r=!1,a()}}}function uE(s,e,n){let r,a,h,m,l;Ft(s,sr,ve=>n(16,r=ve)),Ft(s,Ni,ve=>n(1,a=ve)),Ft(s,Ph,ve=>n(8,h=ve)),Ft(s,zp,ve=>n(2,m=ve)),Ft(s,Hf,ve=>n(3,l=ve));let x=null;cc(S);async function S(){n(0,x=await r.renderRoutes())}function T(ve){ve.key=="r"&&(ve.preventDefault(),Nn(Ni,a={kind:"edit-route",id:null},a))}function C(ve){Nn(Ni,a={kind:"edit-route",id:ve.detail.features[0].id},a)}function N(ve){Nn(Ni,a={kind:"edit-route",id:ve},a)}async function B(){window.confirm("Clear everything? You can't undo this")&&(await(r==null?void 0:r.clearAllRoutes()),await Dh(),await S())}const U=()=>Nn(Ni,a={kind:"evaluate-route",browse:[]},a),ee=()=>Nn(Ni,a={kind:"evaluate-od"},a),ie=()=>Nn(Ni,a={kind:"debug-network"},a),se=()=>Nn(Ni,a={kind:"debug-mesh-density"},a),Q=()=>Nn(Ni,a={kind:"edit-route",id:null},a);function K(){m=this.checked,zp.set(m)}const pe=ve=>N(ve.id);return s.$$.update=()=>{s.$$.dirty&256&&h>0&&S()},[x,a,m,l,T,C,N,B,h,U,ee,ie,se,Q,K,pe]}class cE extends fn{constructor(e){super(),hn(this,e,uE,lE,an,{})}}function hE(s,e,n){const r=s.slice();return r[0]=e[n][0],r[1]=e[n][1],r[2]=e[n][2],r}function fE(s){let e,n,r;return{c(){e=ue("span"),e.textContent=`${s[1]}`,n=Oe(),r=ue("br"),Pn(e,"color",s[2])},m(a,h){ae(a,e,h),ae(a,n,h),ae(a,r,h)},p:tt,d(a){a&&(oe(e),oe(n),oe(r))}}}function dE(s){let e,n,r,a,h=qn(em),m=[];for(let l=0;l<h.length;l+=1)m[l]=fE(hE(s,h,l));return{c(){e=ue("div"),n=ue("details"),r=ue("summary"),r.textContent="Legend",a=Oe();for(let l=0;l<m.length;l+=1)m[l].c();n.open=!0,Ze(e,"class","svelte-1oq1sox")},m(l,x){ae(l,e,x),Z(e,n),Z(n,r),Z(n,a);for(let S=0;S<m.length;S+=1)m[S]&&m[S].m(n,null)},p:tt,i:tt,o:tt,d(l){l&&oe(e),Er(m,l)}}}class pE extends fn{constructor(e){super(),hn(this,e,null,dE,an,{})}}const mE="/npw/assets/help-d011708a.svg";function Hy(s){let e,n;return e=new Wv({props:{$$slots:{default:[gE]},$$scope:{ctx:s}}}),e.$on("close",s[3]),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&16&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function gE(s){let e,n,r;const a=s[1].default,h=Zi(a,s,s[4],null);return{c(){e=ue("h2"),e.textContent="Help",n=Oe(),h&&h.c()},m(m,l){ae(m,e,l),ae(m,n,l),h&&h.m(m,l),r=!0},p(m,l){h&&h.p&&(!r||l&16)&&Xi(h,a,m,m[4],r?Hi(a,m[4],l,null):Wi(m[4]),null)},i(m){r||(_e(h,m),r=!0)},o(m){Ie(h,m),r=!1},d(m){m&&(oe(e),oe(n)),h&&h.d(m)}}}function _E(s){let e,n,r,a,h,m,l=s[0]&&Hy(s);return{c(){e=ue("button"),e.innerHTML=`<img src="${mE}" title="Help" alt="Help"/>`,n=Oe(),l&&l.c(),r=ni(),Ze(e,"class","svelte-gb6dzm")},m(x,S){ae(x,e,S),ae(x,n,S),l&&l.m(x,S),ae(x,r,S),a=!0,h||(m=Rt(e,"click",s[2]),h=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&_e(l,1)):(l=Hy(x),l.c(),_e(l,1),l.m(r.parentNode,r)):l&&(zn(),Ie(l,1,1,()=>{l=null}),Fn())},i(x){a||(_e(l),a=!0)},o(x){Ie(l),a=!1},d(x){x&&(oe(e),oe(n),oe(r)),l&&l.d(x),h=!1,m()}}}function yE(s,e,n){let{$$slots:r={},$$scope:a}=e,h=!1;const m=()=>n(0,h=!0),l=()=>n(0,h=!1);return s.$$set=x=>{"$$scope"in x&&n(4,a=x.$$scope)},[h,r,m,l,a]}class Qv extends fn{constructor(e){super(),hn(this,e,yE,_E,an,{})}}function Xy(s,e,n){const r=s.slice();return r[1]=e[n][0],r[2]=e[n][1],r}function Wy(s){let e,n,r,a=s[1]+"",h,m;return{c(){e=ue("li"),n=ue("span"),r=Oe(),h=Fe(a),m=Oe(),Ze(n,"class","svelte-kzgqtg"),Pn(n,"background",s[2])},m(l,x){ae(l,e,x),Z(e,n),Z(e,r),Z(e,h),Z(e,m)},p(l,x){x&1&&Pn(n,"background",l[2]),x&1&&a!==(a=l[1]+"")&&Lt(h,a)},d(l){l&&oe(e)}}}function vE(s){let e,n=qn(Object.entries(s[0])),r=[];for(let a=0;a<n.length;a+=1)r[a]=Wy(Xy(s,n,a));return{c(){e=ue("ul");for(let a=0;a<r.length;a+=1)r[a].c()},m(a,h){ae(a,e,h);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(e,null)},p(a,[h]){if(h&1){n=qn(Object.entries(a[0]));let m;for(m=0;m<n.length;m+=1){const l=Xy(a,n,m);r[m]?r[m].p(l,h):(r[m]=Wy(l),r[m].c(),r[m].m(e,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=n.length}},i:tt,o:tt,d(a){a&&oe(e),Er(r,a)}}}function bE(s,e,n){let{colors:r}=e;return s.$$set=a=>{"colors"in a&&n(0,r=a.colors)},[r]}class _c extends fn{constructor(e){super(),hn(this,e,bE,vE,an,{colors:0})}}let un;const e1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&e1.decode();let vh=null;function Eh(){return(vh===null||vh.byteLength===0)&&(vh=new Uint8Array(un.memory.buffer)),vh}function _o(s,e){return s=s>>>0,e1.decode(Eh().subarray(s,s+e))}const Ra=new Array(128).fill(void 0);Ra.push(void 0,null,!0,!1);let Ah=Ra.length;function lr(s){Ah===Ra.length&&Ra.push(Ra.length+1);const e=Ah;return Ah=Ra[e],Ra[e]=s,e}function Hn(s){return Ra[s]}function xE(s){s<132||(Ra[s]=Ah,Ah=s)}function $u(s){const e=Hn(s);return xE(s),e}function hp(s){return s==null}let bh=null;function wE(){return(bh===null||bh.byteLength===0)&&(bh=new Float64Array(un.memory.buffer)),bh}let xh=null;function ai(){return(xh===null||xh.byteLength===0)&&(xh=new Int32Array(un.memory.buffer)),xh}let yl=0;const Pf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},kE=typeof Pf.encodeInto=="function"?function(s,e){return Pf.encodeInto(s,e)}:function(s,e){const n=Pf.encode(s);return e.set(n),{read:s.length,written:n.length}};function kf(s,e,n){if(n===void 0){const l=Pf.encode(s),x=e(l.length,1)>>>0;return Eh().subarray(x,x+l.length).set(l),yl=l.length,x}let r=s.length,a=e(r,1)>>>0;const h=Eh();let m=0;for(;m<r;m++){const l=s.charCodeAt(m);if(l>127)break;h[a+m]=l}if(m!==r){m!==0&&(s=s.slice(m)),a=n(a,r,r=m+s.length*3,1)>>>0;const l=Eh().subarray(a+m,a+r),x=kE(s,l);m+=x.written}return yl=m,a}function Bp(s){const e=typeof s;if(e=="number"||e=="boolean"||s==null)return`${s}`;if(e=="string")return`"${s}"`;if(e=="symbol"){const a=s.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=s.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(s)){const a=s.length;let h="[";a>0&&(h+=Bp(s[0]));for(let m=1;m<a;m++)h+=", "+Bp(s[m]);return h+="]",h}const n=/\[object ([^\]]+)\]/.exec(toString.call(s));let r;if(n.length>1)r=n[1];else return toString.call(s);if(r=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:r}function IE(s,e){const n=e(s.length*1,1)>>>0;return Eh().set(s,n/1),yl=s.length,n}function fp(s,e){try{return s.apply(this,e)}catch(n){un.__wbindgen_exn_store(lr(n))}}class Jf{static __wrap(e){e=e>>>0;const n=Object.create(Jf.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();un.__wbg_jsroutesnapper_free(e)}constructor(e){try{const h=un.__wbindgen_add_to_stack_pointer(-16),m=IE(e,un.__wbindgen_malloc),l=yl;un.jsroutesnapper_new(h,m,l);var n=ai()[h/4+0],r=ai()[h/4+1],a=ai()[h/4+2];if(a)throw $u(r);return Jf.__wrap(n)}finally{un.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){un.jsroutesnapper_setRouteConfig(this.__wbg_ptr,lr(e))}setAreaMode(){un.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getConfig(h,this.__wbg_ptr);var r=ai()[h/4+0],a=ai()[h/4+1];return e=r,n=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const r=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_toFinalFeature(r,this.__wbg_ptr);var e=ai()[r/4+0],n=ai()[r/4+1];let a;return e!==0&&(a=_o(e,n).slice(),un.__wbindgen_free(e,n*1)),a}finally{un.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_renderGeojson(h,this.__wbg_ptr);var r=ai()[h/4+0],a=ai()[h/4+1];return e=r,n=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}toggleSnapMode(){un.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,r){return un.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,r)!==0}onClick(){un.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return un.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return un.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){un.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const a=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_editExisting(a,this.__wbg_ptr,lr(e));var n=ai()[a/4+0],r=ai()[a/4+1];if(r)throw $u(n)}finally{un.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugRenderGraph(h,this.__wbg_ptr);var r=ai()[h/4+0],a=ai()[h/4+1];return e=r,n=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugSnappableNodes(h,this.__wbg_ptr);var r=ai()[h/4+0],a=ai()[h/4+1];return e=r,n=a,_o(r,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,r;try{const T=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_routeNameForWaypoints(T,this.__wbg_ptr,lr(e));var a=ai()[T/4+0],h=ai()[T/4+1],m=ai()[T/4+2],l=ai()[T/4+3],x=a,S=h;if(l)throw x=0,S=0,$u(m);return n=x,r=S,_o(x,S)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(n,r,1)}}addSnappedWaypoint(e,n){un.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){un.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,r;try{const T=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_calculateRoute(T,this.__wbg_ptr,lr(e));var a=ai()[T/4+0],h=ai()[T/4+1],m=ai()[T/4+2],l=ai()[T/4+3],x=a,S=h;if(l)throw x=0,S=0,$u(m);return n=x,r=S,_o(x,S)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(n,r,1)}}getExtraNodes(e,n){let r,a;try{const C=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getExtraNodes(C,this.__wbg_ptr,lr(e),lr(n));var h=ai()[C/4+0],m=ai()[C/4+1],l=ai()[C/4+2],x=ai()[C/4+3],S=h,T=m;if(x)throw S=0,T=0,$u(l);return r=S,a=T,_o(S,T)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(r,a,1)}}}async function SE(s,e){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,e)}catch(r){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await s.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(s,e);return n instanceof WebAssembly.Instance?{instance:n,module:s}:n}}function EE(){const s={};return s.wbg={},s.wbg.__wbindgen_string_new=function(e,n){const r=_o(e,n);return lr(r)},s.wbg.__wbindgen_object_drop_ref=function(e){$u(e)},s.wbg.__wbindgen_error_new=function(e,n){const r=new Error(_o(e,n));return lr(r)},s.wbg.__wbindgen_number_get=function(e,n){const r=Hn(n),a=typeof r=="number"?r:void 0;wE()[e/8+1]=hp(a)?0:a,ai()[e/4+0]=!hp(a)},s.wbg.__wbindgen_is_object=function(e){const n=Hn(e);return typeof n=="object"&&n!==null},s.wbg.__wbindgen_is_undefined=function(e){return Hn(e)===void 0},s.wbg.__wbindgen_in=function(e,n){return Hn(e)in Hn(n)},s.wbg.__wbindgen_boolean_get=function(e){const n=Hn(e);return typeof n=="boolean"?n?1:0:2},s.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Hn(e)==Hn(n)},s.wbg.__wbindgen_string_get=function(e,n){const r=Hn(n),a=typeof r=="string"?r:void 0;var h=hp(a)?0:kf(a,un.__wbindgen_malloc,un.__wbindgen_realloc),m=yl;ai()[e/4+1]=m,ai()[e/4+0]=h},s.wbg.__wbg_String_4370c5505c674d30=function(e,n){const r=String(Hn(n)),a=kf(r,un.__wbindgen_malloc,un.__wbindgen_realloc),h=yl;ai()[e/4+1]=h,ai()[e/4+0]=a},s.wbg.__wbindgen_object_clone_ref=function(e){const n=Hn(e);return lr(n)},s.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const r=Hn(e)[Hn(n)];return lr(r)},s.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return lr(e)},s.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const r=Hn(n).stack,a=kf(r,un.__wbindgen_malloc,un.__wbindgen_realloc),h=yl;ai()[e/4+1]=h,ai()[e/4+0]=a},s.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let r,a;try{r=e,a=n,console.error(_o(e,n))}finally{un.__wbindgen_free(r,a,1)}},s.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Hn(e))},s.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Hn(e))},s.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Hn(e))},s.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Hn(e))},s.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Hn(e))},s.wbg.__wbg_get_44be0491f933a435=function(e,n){const r=Hn(e)[n>>>0];return lr(r)},s.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Hn(e).length},s.wbg.__wbindgen_is_function=function(e){return typeof Hn(e)=="function"},s.wbg.__wbg_next_526fc47e980da008=function(e){const n=Hn(e).next;return lr(n)},s.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return fp(function(e){const n=Hn(e).next();return lr(n)},arguments)},s.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Hn(e).done},s.wbg.__wbg_value_1695675138684bd5=function(e){const n=Hn(e).value;return lr(n)},s.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return lr(Symbol.iterator)},s.wbg.__wbg_get_97b561fb56f034b5=function(){return fp(function(e,n){const r=Reflect.get(Hn(e),Hn(n));return lr(r)},arguments)},s.wbg.__wbg_call_cb65541d95d71282=function(){return fp(function(e,n){const r=Hn(e).call(Hn(n));return lr(r)},arguments)},s.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Hn(e))},s.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Hn(e)instanceof ArrayBuffer}catch{n=!1}return n},s.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Hn(e).buffer;return lr(n)},s.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Hn(e));return lr(n)},s.wbg.__wbg_set_5cf90238115182c3=function(e,n,r){Hn(e).set(Hn(n),r>>>0)},s.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Hn(e).length},s.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Hn(e)instanceof Uint8Array}catch{n=!1}return n},s.wbg.__wbindgen_debug_string=function(e,n){const r=Bp(Hn(n)),a=kf(r,un.__wbindgen_malloc,un.__wbindgen_realloc),h=yl;ai()[e/4+1]=h,ai()[e/4+0]=a},s.wbg.__wbindgen_throw=function(e,n){throw new Error(_o(e,n))},s.wbg.__wbindgen_memory=function(){const e=un.memory;return lr(e)},s}function AE(s,e){return un=s.exports,t1.__wbindgen_wasm_module=e,bh=null,xh=null,vh=null,un}async function t1(s){if(un!==void 0)return un;typeof s>"u"&&(s="/npw/assets/route_snapper_bg.wasm");const e=EE();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:n,module:r}=await SE(await s,e);return AE(n,r)}const TE=30;class CE{constructor(e,n,r,a,h){this.onMouseMove=m=>{if(!this.active)return;const l=[m.point.x-TE,m.point.y],x=this.map.unproject(m.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(m.lngLat.lng,m.lngLat.lat,x)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=m=>{this.active&&(m.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||m.key=="Escape"&&(m.stopPropagation(),this.cancel())},this.onKeyPress=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||(m.key=="Enter"?(m.stopPropagation(),this.finish()):m.key=="s"||m.key=="S"?(m.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):m.key=="z"&&m.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Jf(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=r,this.snapMode=a,this.undoLength=h,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}let Qf=Yn(null);const go=Yn([]);const LE=s=>({}),Ky=s=>({});function $y(s,e,n){const r=s.slice();return r[50]=e[n],r[51]=e,r[52]=n,r}function Yy(s,e,n){const r=s.slice();return r[53]=e[n],r[54]=e,r[55]=n,r}const ME=s=>({}),Jy=s=>({});function RE(s){let e,n=s[10].length+"",r,a;return{c(){e=Fe("Undo ("),r=Fe(n),a=Fe(")")},m(h,m){ae(h,e,m),ae(h,r,m),ae(h,a,m)},p(h,m){m[0]&1024&&n!==(n=h[10].length+"")&&Lt(r,n)},d(h){h&&(oe(e),oe(r),oe(a))}}}function PE(s){let e;return{c(){e=Fe("Undo")},m(n,r){ae(n,e,r)},p:tt,d(n){n&&oe(e)}}}function DE(s){let e,n,r,a,h;return{c(){e=ue("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,n=Oe(),r=ue("p"),r.textContent="Keyboard shortcuts:",a=Oe(),h=ue("ul"),h.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(m,l){ae(m,e,l),ae(m,n,l),ae(m,r,l),ae(m,a,l),ae(m,h,l)},p:tt,d(m){m&&(oe(e),oe(n),oe(r),oe(a),oe(h))}}}function NE(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe,ve,De,he,xe,be,Ce,we,ye,Ue,qe,pt,St,dt,ut,Bt,vt,wt,ft,xt,It,Yt,pn,Dn,We,Xn,dn,Ot,Se,lt,Ye,Ct,$e;function kt(Gt,_n){return Gt[10].length==0?PE:RE}let qt=kt(s),Ee=qt(s);return ee=new Qv({props:{$$slots:{default:[DE]},$$scope:{ctx:s}}}),lt=qg(s[39][0]),Ye=qg(s[39][1]),{c(){e=ue("div"),n=ue("h2"),n.textContent="Editing a route",r=Oe(),a=ue("button"),h=Fe("Finish"),l=Oe(),x=ue("button"),Ee.c(),T=Oe(),C=ue("button"),C.textContent="Delete",N=Oe(),B=ue("button"),B.textContent="Cancel",U=Oe(),ot(ee.$$.fragment),ie=Oe(),se=ue("fieldset"),Q=ue("label"),K=ue("input"),pe=Fe(`
        Snap to roads`),ve=Oe(),De=ue("label"),he=ue("input"),xe=Fe(`
        Draw anywhere`),be=Oe(),Ce=ue("fieldset"),we=ue("label"),ye=ue("input"),Ue=Fe(`
        Extend from start (
        `),qe=ue("b"),qe.textContent="1",pt=Fe(`
        )`),St=Oe(),dt=ue("label"),ut=ue("input"),Bt=Fe(`
        Extend from end (
        `),vt=ue("b"),vt.textContent="2",wt=Fe(`
        )`),ft=Oe(),xt=ue("label"),It=ue("input"),Yt=Fe(`
        Adjust middle points (
        `),pn=ue("b"),pn.textContent="3",Dn=Fe(`
        )`),We=Oe(),Xn=ue("label"),dn=ue("input"),Ot=Fe(`
      Show major junctions`),a.disabled=m=s[7].length<2,Ze(x,"class","secondary"),x.disabled=S=s[10].length==0,Ze(C,"class","secondary"),Ze(B,"class","secondary"),Ze(K,"type","radio"),K.__value="snap",qi(K,K.__value),Ze(he,"type","radio"),he.__value="free",qi(he,he.__value),Ze(ye,"type","radio"),ye.__value="append-start",qi(ye,ye.__value),Ze(ut,"type","radio"),ut.__value="append-end",qi(ut,ut.__value),Ze(It,"type","radio"),It.__value="adjust",qi(It,It.__value),Ze(dn,"type","checkbox"),Ze(e,"slot","left"),lt.p(ye,ut,It),Ye.p(K,he)},m(Gt,_n){ae(Gt,e,_n),Z(e,n),Z(e,r),Z(e,a),Z(a,h),Z(e,l),Z(e,x),Ee.m(x,null),Z(e,T),Z(e,C),Z(e,N),Z(e,B),Z(e,U),it(ee,e,null),Z(e,ie),Z(e,se),Z(se,Q),Z(Q,K),K.checked=K.__value===s[9],Z(Q,pe),Z(se,ve),Z(se,De),Z(De,he),he.checked=he.__value===s[9],Z(De,xe),Z(e,be),Z(e,Ce),Z(Ce,we),Z(we,ye),ye.checked=ye.__value===s[3],Z(we,Ue),Z(we,qe),Z(we,pt),Z(Ce,St),Z(Ce,dt),Z(dt,ut),ut.checked=ut.__value===s[3],Z(dt,Bt),Z(dt,vt),Z(dt,wt),Z(Ce,ft),Z(Ce,xt),Z(xt,It),It.checked=It.__value===s[3],Z(xt,Yt),Z(xt,pn),Z(xt,Dn),Z(e,We),Z(e,Xn),Z(Xn,dn),dn.checked=s[13],Z(Xn,Ot),Se=!0,Ct||($e=[Rt(a,"click",function(){iu(s[0])&&s[0].apply(this,arguments)}),Rt(x,"click",s[14]),Rt(C,"click",function(){iu(s[2])&&s[2].apply(this,arguments)}),Rt(B,"click",function(){iu(s[1])&&s[1].apply(this,arguments)}),Rt(K,"change",s[38]),Rt(K,"change",s[15]),Rt(he,"change",s[40]),Rt(he,"change",s[15]),Rt(ye,"change",s[41]),Rt(ut,"change",s[42]),Rt(It,"change",s[43]),Rt(dn,"change",s[44])],Ct=!0)},p(Gt,_n){s=Gt,(!Se||_n[0]&128&&m!==(m=s[7].length<2))&&(a.disabled=m),qt===(qt=kt(s))&&Ee?Ee.p(s,_n):(Ee.d(1),Ee=qt(s),Ee&&(Ee.c(),Ee.m(x,null))),(!Se||_n[0]&1024&&S!==(S=s[10].length==0))&&(x.disabled=S);const Jn={};_n[1]&16384&&(Jn.$$scope={dirty:_n,ctx:s}),ee.$set(Jn),_n[0]&512&&(K.checked=K.__value===s[9]),_n[0]&512&&(he.checked=he.__value===s[9]),_n[0]&8&&(ye.checked=ye.__value===s[3]),_n[0]&8&&(ut.checked=ut.__value===s[3]),_n[0]&8&&(It.checked=It.__value===s[3]),_n[0]&8192&&(dn.checked=s[13])},i(Gt){Se||(_e(ee.$$.fragment,Gt),Se=!0)},o(Gt){Ie(ee.$$.fragment,Gt),Se=!1},d(Gt){Gt&&oe(e),Ee.d(),rt(ee),lt.r(),Ye.r(),Ct=!1,Ki($e)}}}function zE(s){let e;return{c(){e=ue("span"),Ze(e,"class","dot svelte-1cj4rwq"),Sr(e,"snapped-node",s[53].snapped),Sr(e,"free-node",!s[53].snapped),Sr(e,"hide",s[6])},m(n,r){ae(n,e,r)},p(n,r){r[0]&2048&&Sr(e,"snapped-node",n[53].snapped),r[0]&2048&&Sr(e,"free-node",!n[53].snapped),r[0]&64&&Sr(e,"hide",n[6])},d(n){n&&oe(e)}}}function Qy(s){let e,n,r;function a(x){s[29](x,s[53])}function h(){return s[30](s[53])}function m(){return s[31](s[53])}let l={draggable:!0,zIndex:0,$$slots:{default:[zE]},$$scope:{ctx:s}};return s[53].point!==void 0&&(l.lngLat=s[53].point),e=new Zf({props:l}),Kn.push(()=>gr(e,"lngLat",a)),e.$on("dragstart",h),e.$on("drag",m),e.$on("dragend",s[23]),{c(){ot(e.$$.fragment)},m(x,S){it(e,x,S),r=!0},p(x,S){s=x;const T={};S[0]&2112|S[1]&16384&&(T.$$scope={dirty:S,ctx:s}),!n&&S[0]&2048&&(n=!0,T.lngLat=s[53].point,mr(()=>n=!1)),e.$set(T)},i(x){r||(_e(e.$$.fragment,x),r=!0)},o(x){Ie(e.$$.fragment,x),r=!1},d(x){rt(e,x)}}}function FE(s){let e;return{c(){e=ue("span"),e.textContent=`${s[52]+1}`,Ze(e,"class","dot svelte-1cj4rwq"),Sr(e,"snapped",s[50].snapped)},m(n,r){ae(n,e,r)},p(n,r){r[0]&128&&Sr(e,"snapped",n[50].snapped)},d(n){n&&oe(e)}}}function e0(s){let e,n,r;function a(x){s[32](x,s[50])}function h(){return s[33](s[52])}function m(){return s[34](s[52])}let l={draggable:!0,zIndex:1,$$slots:{default:[FE]},$$scope:{ctx:s}};return s[50].point!==void 0&&(l.lngLat=s[50].point),e=new Zf({props:l}),Kn.push(()=>gr(e,"lngLat",a)),e.$on("click",h),e.$on("contextmenu",m),e.$on("mouseenter",s[35]),e.$on("mouseleave",s[36]),e.$on("dragstart",s[25]),e.$on("dragend",s[37]),{c(){ot(e.$$.fragment)},m(x,S){it(e,x,S),r=!0},p(x,S){s=x;const T={};S[0]&128|S[1]&16384&&(T.$$scope={dirty:S,ctx:s}),!n&&S[0]&128&&(n=!0,T.lngLat=s[50].point,mr(()=>n=!1)),e.$set(T)},i(x){r||(_e(e.$$.fragment,x),r=!0)},o(x){Ie(e.$$.fragment,x),r=!1},d(x){rt(e,x)}}}function OE(s){let e,n;return e=new _r({props:{paint:{"line-color":"black","line-width":10}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function BE(s){let e,n;return e=new _r({props:{paint:{"line-color":"black","line-width":3}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function UE(s){let e,n,r,a,h,m,l,x,S,T;n=new Xv({}),n.$on("click",s[16]),n.$on("mousemove",s[17]);let C=qn(s[11]),N=[];for(let K=0;K<C.length;K+=1)N[K]=Qy(Yy(s,C,K));const B=K=>Ie(N[K],1,1,()=>{N[K]=null});let U=qn(s[7]),ee=[];for(let K=0;K<U.length;K+=1)ee[K]=e0($y(s,U,K));const ie=K=>Ie(ee[K],1,1,()=>{ee[K]=null});m=new rr({props:{data:s[20](s[8],s[7]),generateId:!0,$$slots:{default:[OE]},$$scope:{ctx:s}}}),x=new rr({props:{data:s[12],$$slots:{default:[BE]},$$scope:{ctx:s}}});const se=s[28]["extra-map"],Q=Zi(se,s,s[45],Ky);return{c(){e=ue("div"),ot(n.$$.fragment),r=Oe();for(let K=0;K<N.length;K+=1)N[K].c();a=Oe();for(let K=0;K<ee.length;K+=1)ee[K].c();h=Oe(),ot(m.$$.fragment),l=Oe(),ot(x.$$.fragment),S=Oe(),Q&&Q.c(),Ze(e,"slot","map")},m(K,pe){ae(K,e,pe),it(n,e,null),Z(e,r);for(let ve=0;ve<N.length;ve+=1)N[ve]&&N[ve].m(e,null);Z(e,a);for(let ve=0;ve<ee.length;ve+=1)ee[ve]&&ee[ve].m(e,null);Z(e,h),it(m,e,null),Z(e,l),it(x,e,null),Z(e,S),Q&&Q.m(e,null),T=!0},p(K,pe){if(pe[0]&14682176){C=qn(K[11]);let he;for(he=0;he<C.length;he+=1){const xe=Yy(K,C,he);N[he]?(N[he].p(xe,pe),_e(N[he],1)):(N[he]=Qy(xe),N[he].c(),_e(N[he],1),N[he].m(e,a))}for(zn(),he=C.length;he<N.length;he+=1)B(he);Fn()}if(pe[0]&34341040){U=qn(K[7]);let he;for(he=0;he<U.length;he+=1){const xe=$y(K,U,he);ee[he]?(ee[he].p(xe,pe),_e(ee[he],1)):(ee[he]=e0(xe),ee[he].c(),_e(ee[he],1),ee[he].m(e,h))}for(zn(),he=U.length;he<ee.length;he+=1)ie(he);Fn()}const ve={};pe[0]&384&&(ve.data=K[20](K[8],K[7])),pe[1]&16384&&(ve.$$scope={dirty:pe,ctx:K}),m.$set(ve);const De={};pe[0]&4096&&(De.data=K[12]),pe[1]&16384&&(De.$$scope={dirty:pe,ctx:K}),x.$set(De),Q&&Q.p&&(!T||pe[1]&16384)&&Xi(Q,se,K,K[45],T?Hi(se,K[45],pe,LE):Wi(K[45]),Ky)},i(K){if(!T){_e(n.$$.fragment,K);for(let pe=0;pe<C.length;pe+=1)_e(N[pe]);for(let pe=0;pe<U.length;pe+=1)_e(ee[pe]);_e(m.$$.fragment,K),_e(x.$$.fragment,K),_e(Q,K),T=!0}},o(K){Ie(n.$$.fragment,K),N=N.filter(Boolean);for(let pe=0;pe<N.length;pe+=1)Ie(N[pe]);ee=ee.filter(Boolean);for(let pe=0;pe<ee.length;pe+=1)Ie(ee[pe]);Ie(m.$$.fragment,K),Ie(x.$$.fragment,K),Ie(Q,K),T=!1},d(K){K&&oe(e),rt(n),Er(N,K),Er(ee,K),rt(m),rt(x),Q&&Q.d(K)}}}function jE(s){let e,n;const r=s[28]["extra-right"],a=Zi(r,s,s[45],Jy);return{c(){e=ue("div"),a&&a.c(),Ze(e,"slot","right")},m(h,m){ae(h,e,m),a&&a.m(e,null),n=!0},p(h,m){a&&a.p&&(!n||m[1]&16384)&&Xi(a,r,h,h[45],n?Hi(r,h[45],m,ME):Wi(h[45]),Jy)},i(h){n||(_e(a,h),n=!0)},o(h){Ie(a,h),n=!1},d(h){h&&oe(e),a&&a.d(h)}}}function qE(s){let e,n,r,a;return e=new gc({props:{$$slots:{right:[jE],map:[UE],left:[NE]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(h,m){it(e,h,m),n=!0,r||(a=Rt(window,"keydown",s[24]),r=!0)},p(h,m){const l={};m[0]&16383|m[1]&16384&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){n||(_e(e.$$.fragment,h),n=!0)},o(h){Ie(e.$$.fragment,h),n=!1},d(h){rt(e,h),r=!1,a()}}}function VE(s,e,n){let r,a,h,m;Ft(s,go,kt=>n(7,a=kt)),Ft(s,Qf,kt=>n(8,h=kt)),Ft(s,Fp,kt=>n(13,m=kt));let{$$slots:l={},$$scope:x}=e,{map:S}=e,{finish:T}=e,{cancel:C}=e,{deleteRoute:N}=e;vo(()=>{Nn(go,a=[],a),h==null||h.stop(),S.getCanvas().style.cursor="inherit"});let B="append-end",U="snap",ee=[],ie=[],se=null,Q=!1,K=!1,pe=!1;function ve(kt){let qt=kt.length==0?"crosshair":"inherit";S.getCanvas().style.cursor=qt}function De(){let kt=ee.pop();n(10,ee),kt&&Nn(go,a=kt,a)}function he(){ee.length==100&&ee.shift(),n(10,ee=[...ee,JSON.parse(JSON.stringify(a))])}function xe(){n(9,U=U=="snap"?"free":"snap"),se&&n(27,se.snapped=U=="snap",se)}function be(kt){he(),go.update(qt=>(B=="append-start"?qt.splice(0,0,{point:kt.detail.lngLat.toArray(),snapped:U=="snap"}):B=="append-end"&&qt.push({point:kt.detail.lngLat.toArray(),snapped:U=="snap"}),qt))}function Ce(kt){n(27,se={point:kt.detail.lngLat.toArray(),snapped:U=="snap"})}function we(kt){he(),go.update(qt=>(qt[kt].snapped=!qt[kt].snapped,qt))}function ye(kt){he(),go.update(qt=>(qt.splice(kt,1),qt)),n(4,Q=!1)}function Ue(kt,qt){try{if(kt)return JSON.parse(kt.inner.calculateRoute(qt))}catch{}return Mf()}function qe(kt,qt,Ee,Gt,_n){if(_n)return Mf();try{if(kt&&qt.length>0&&Gt){if(Ee=="append-start")return JSON.parse(kt.inner.calculateRoute([Gt,qt[0]]));if(Ee=="append-end")return JSON.parse(kt.inner.calculateRoute([qt[qt.length-1],Gt]))}}catch{}return Mf()}function pt(kt,qt,Ee,Gt){if(Gt)return;if(!kt||Ee!="adjust"){n(11,ie=[]);return}let _n=[],Jn=1;for(let $i=0;$i<qt.length-1;$i++){let xn=JSON.parse(kt.inner.getExtraNodes(qt[$i],qt[$i+1]));for(let[Vi,Yi,Jr]of xn)_n.push({point:[Vi,Yi],snapped:Jr,insertIdx:Jn});Jn++}n(11,ie=_n)}function St(kt){he(),go.update(qt=>(qt.splice(kt.insertIdx,0,{point:kt.point,snapped:kt.snapped}),qt)),n(6,pe=!0)}function dt(kt){go.update(qt=>(qt[kt.insertIdx].point=kt.point,qt))}function ut(){n(6,pe=!1)}function Bt(kt){let qt=kt.target.tagName,Ee=qt=="INPUT"||qt=="TEXTAREA";kt.key==="Enter"&&!Ee?(kt.stopPropagation(),a.length>=2&&T()):kt.key==="Escape"?(kt.stopPropagation(),C()):kt.key=="s"&&!Ee?xe():kt.key=="1"&&!Ee?n(3,B="append-start"):kt.key=="2"&&!Ee?n(3,B="append-end"):kt.key=="3"&&!Ee?n(3,B="adjust"):kt.key=="z"&&kt.ctrlKey&&(kt.stopPropagation(),De())}function vt(){he(),n(5,K=!0)}const wt=[[],[]];function ft(kt,qt){s.$$.not_equal(qt.point,kt)&&(qt.point=kt,n(11,ie))}const xt=kt=>St(kt),It=kt=>dt(kt);function Yt(kt,qt){s.$$.not_equal(qt.point,kt)&&(qt.point=kt,go.set(a))}const pn=kt=>we(kt),Dn=kt=>ye(kt),We=()=>n(4,Q=!0),Xn=()=>n(4,Q=!1),dn=()=>n(5,K=!1);function Ot(){U=this.__value,n(9,U)}function Se(){U=this.__value,n(9,U)}function lt(){B=this.__value,n(3,B)}function Ye(){B=this.__value,n(3,B)}function Ct(){B=this.__value,n(3,B)}function $e(){m=this.checked,Fp.set(m)}return s.$$set=kt=>{"map"in kt&&n(26,S=kt.map),"finish"in kt&&n(0,T=kt.finish),"cancel"in kt&&n(1,C=kt.cancel),"deleteRoute"in kt&&n(2,N=kt.deleteRoute),"$$scope"in kt&&n(45,x=kt.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&456&&pt(h,a,B,pe),s.$$.dirty[0]&134218168&&n(12,r=qe(h,a,B,se,Q||K)),s.$$.dirty[0]&128&&ve(a)},[T,C,N,B,Q,K,pe,a,h,U,ee,ie,r,m,De,xe,be,Ce,we,ye,Ue,St,dt,ut,Bt,vt,S,se,l,ft,xt,It,Yt,pn,Dn,We,Xn,dn,Ot,wt,Se,lt,Ye,Ct,$e,x]}class GE extends fn{constructor(e){super(),hn(this,e,VE,qE,an,{map:26,finish:0,cancel:1,deleteRoute:2},null,[-1,-1])}}const ZE="/npw/assets/SegregatedWide-90b2a345.jpg",HE="/npw/assets/OffRoad-d9bc7e74.jpg",XE="/npw/assets/SegregatedNarrow-5cd3bb62.jpg",WE="/npw/assets/SharedFootway-9cec7d1e.jpg",KE="/npw/assets/CycleLane-4550fbbf.jpg",$E="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA+Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBkZWZhdWx0IHF1YWxpdHkK/9sAQwAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy/8AAEQgA4QEsAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A7Oiiivpj8NCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoq1aafdX+/7NFv2Y3fMBjPTqfarP/CP6p/z6/wDkRf8AGolVpxdnJfeddLAYqrFTp0pNPqotr8jMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8an29L+ZfeX/ZeO/wCfM/8AwF/5GZRWn/wj+qf8+v8A5EX/ABo/4R/VP+fX/wAiL/jR7el/MvvD+y8d/wA+Z/8AgL/yMyitP/hH9U/59f8AyIv+NH/CP6p/z6/+RF/xo9vS/mX3h/ZeO/58z/8AAX/kZlFaf/CP6p/z6/8AkRf8aP8AhH9U/wCfX/yIv+NHt6X8y+8P7Lx3/Pmf/gL/AMjMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8aPb0v5l94f2Xjv+fM//AX/AJGZRWn/AMI/qn/Pr/5EX/Gj/hH9U/59f/Ii/wCNHt6X8y+8P7Lx3/Pmf/gL/wAjMorT/wCEf1T/AJ9f/Ii/40f8I/qn/Pr/AORF/wAaPb0v5l94f2Xjv+fM/wDwF/5GZRWn/wAI/qn/AD6/+RF/xo/4R/VP+fX/AMiL/jR7el/MvvD+y8d/z5n/AOAv/IzKK0/+Ef1T/n1/8iL/AI1FcaPf2sDTTQbY1xk71OMnHY01Wpt2Ul94pZdjIRcpUpJL+6/8ijRRRWhxBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAaFhql9pdsx07TVv7i4uobcI8xiRA2/LswRiAMeneof+E98RNJ4iji8LWM0ug7ftEcWqyM0uU3gRj7P8xx645rc8I/8vn/AAD/ANmrI8E/8lC8f/8AX5bf+ia8PGfx5fL8j9W4b/5FdL/t7/0pmpdeLp5ten0PQdK/tK+tY0kvGkuBBDbbhlVZ9rEsRzgKeKk0fxW+rT6lpb6f9j1+wUNJY3E3yOGHyOsig5Q9NwXI7isD4dg2Xi7x3p118t82rG7Abq0EgzGR6gcj2pIwb74/yz2fMWn6EIL116B3lLIh98fN+Fcp7hZ0Pxzr2t+HP7eh8LQvZh5FaG31EyXHyMVbajRKrdDgbsmtS68faLD4VstftmlvItQdYbKCFf3s8rHAjAPQ5BBz0wax/hFNHb/DSOaaRY4o7m7d3Y4CgTOSSfSvOvD0Etnb+BddukaPRn1+9dN4wqLNhYWPoNysQff3oA9Wm8ZX+jXFn/wkuhLptleSrAl3DeC4SKRvurL8q7c9MjcM9TXX1wHxndJPhre2AXzLu/mgt7SEfeklMqkBffAJ/Cu6tUkitIY5X3yLGqu3qQOTQBLRRRQAUUUUAFFFFABRRRQAUUUUAFZniD/kB3P/AAH/ANCFadZniD/kB3P/AAH/ANCFa0P4sfVHDmn+41v8EvyZw1FFFfQn42FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB03hH/l8/wCAf+zVb0nwlo+iandajYR3SXV3g3DyX08olI4BYO5BIHAOMiuYtNQurDf9ml2b8bvlBzjp1HvVn/hINU/5+v8AyGv+FebiMHUqVHNNH22UcSYXB4OGHqRk2r7JW1bfddzo9W8M6RrdxFc31oTcxKVjuIZXhlVT1UOhDY9s4p1h4e0rStNm0+wtfssE24ymGRlkdj1YyA7y3+1nPvXNf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFY/2fV7r+vkej/rhgf5J/cv8A5IvQfDfwtbWa2SWV01kGLfZJdQuJICSckmNpCpyeeRXQ3WmWN7pr6bc2cEtk6CM27xgptHQY6YHH0rkP+Eg1T/n6/wDIa/4Uf8JBqn/P1/5DX/Cj+z6vdf18g/1wwP8AJP7l/wDJG3p/gzQdMvor23sma5hBWGS4uJJzCD12eYzbP+A4rerhv+Eg1T/n6/8AIa/4Uf8ACQap/wA/X/kNf8KP7Pq91/XyD/XDA/yT+5f/ACR3NFcN/wAJBqn/AD9f+Q1/wo/4SDVP+fr/AMhr/hR/Z9Xuv6+Qf64YH+Sf3L/5I7miuG/4SDVP+fr/AMhr/hR/wkGqf8/X/kNf8KP7Pq91/XyD/XDA/wAk/uX/AMkdzRXDf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFH9n1e6/r5B/rhgf5J/cv/kjuaK4b/hINU/5+v/Ia/wCFH/CQap/z9f8AkNf8KP7Pq91/XyD/AFwwP8k/uX/yR3NFcN/wkGqf8/X/AJDX/Cj/AISDVP8An6/8hr/hR/Z9Xuv6+Qf64YH+Sf3L/wCSO5rM8Qf8gO5/4D/6EK5n/hINU/5+v/Ia/wCFRXGsX91A0M0+6NsZGxRnBz2FXTwNSM1JtaP+uhzYzirB18NUpRjK8otbLqrdyjRRRXqnwIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//2Q==",YE="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA+Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBkZWZhdWx0IHF1YWxpdHkK/9sAQwAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy/8AAEQgA4QEsAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A7Oiiivpj8NCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoq1aafdX+/7NFv2Y3fMBjPTqfarP/CP6p/z6/wDkRf8AGolVpxdnJfeddLAYqrFTp0pNPqotr8jMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8an29L+ZfeX/ZeO/wCfM/8AwF/5GZRWn/wj+qf8+v8A5EX/ABo/4R/VP+fX/wAiL/jR7el/MvvD+y8d/wA+Z/8AgL/yMyitP/hH9U/59f8AyIv+NH/CP6p/z6/+RF/xo9vS/mX3h/ZeO/58z/8AAX/kZlFaf/CP6p/z6/8AkRf8aP8AhH9U/wCfX/yIv+NHt6X8y+8P7Lx3/Pmf/gL/AMjMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8aPb0v5l94f2Xjv+fM//AX/AJGZRWn/AMI/qn/Pr/5EX/Gj/hH9U/59f/Ii/wCNHt6X8y+8P7Lx3/Pmf/gL/wAjMorT/wCEf1T/AJ9f/Ii/40f8I/qn/Pr/AORF/wAaPb0v5l94f2Xjv+fM/wDwF/5GZRWn/wAI/qn/AD6/+RF/xo/4R/VP+fX/AMiL/jR7el/MvvD+y8d/z5n/AOAv/IzKK0/+Ef1T/n1/8iL/AI1FcaPf2sDTTQbY1xk71OMnHY01Wpt2Ul94pZdjIRcpUpJL+6/8ijRRRWhxBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAaFhql9pdsx07TVv7i4uobcI8xiRA2/LswRiAMeneof+E98RNJ4iji8LWM0ug7ftEcWqyM0uU3gRj7P8xx645rc8I/8vn/AAD/ANmrI8E/8lC8f/8AX5bf+ia8PGfx5fL8j9W4b/5FdL/t7/0pmpdeLp5ten0PQdK/tK+tY0kvGkuBBDbbhlVZ9rEsRzgKeKk0fxW+rT6lpb6f9j1+wUNJY3E3yOGHyOsig5Q9NwXI7isD4dg2Xi7x3p118t82rG7Abq0EgzGR6gcj2pIwb74/yz2fMWn6EIL116B3lLIh98fN+Fcp7hZ0Pxzr2t+HP7eh8LQvZh5FaG31EyXHyMVbajRKrdDgbsmtS68faLD4VstftmlvItQdYbKCFf3s8rHAjAPQ5BBz0wax/hFNHb/DSOaaRY4o7m7d3Y4CgTOSSfSvOvD0Etnb+BddukaPRn1+9dN4wqLNhYWPoNysQff3oA9Wm8ZX+jXFn/wkuhLptleSrAl3DeC4SKRvurL8q7c9MjcM9TXX1wHxndJPhre2AXzLu/mgt7SEfeklMqkBffAJ/Cu6tUkitIY5X3yLGqu3qQOTQBLRRRQAUUUUAFFFFABRRRQAUUUUAFZniD/kB3P/AAH/ANCFadZniD/kB3P/AAH/ANCFa0P4sfVHDmn+41v8EvyZw1FFFfQn42FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB03hH/l8/wCAf+zVb0nwlo+iandajYR3SXV3g3DyX08olI4BYO5BIHAOMiuYtNQurDf9ml2b8bvlBzjp1HvVn/hINU/5+v8AyGv+FebiMHUqVHNNH22UcSYXB4OGHqRk2r7JW1bfddzo9W8M6RrdxFc31oTcxKVjuIZXhlVT1UOhDY9s4p1h4e0rStNm0+wtfssE24ymGRlkdj1YyA7y3+1nPvXNf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFY/2fV7r+vkej/rhgf5J/cv8A5IvQfDfwtbWa2SWV01kGLfZJdQuJICSckmNpCpyeeRXQ3WmWN7pr6bc2cEtk6CM27xgptHQY6YHH0rkP+Eg1T/n6/wDIa/4Uf8JBqn/P1/5DX/Cj+z6vdf18g/1wwP8AJP7l/wDJG3p/gzQdMvor23sma5hBWGS4uJJzCD12eYzbP+A4rerhv+Eg1T/n6/8AIa/4Uf8ACQap/wA/X/kNf8KP7Pq91/XyD/XDA/yT+5f/ACR3NFcN/wAJBqn/AD9f+Q1/wo/4SDVP+fr/AMhr/hR/Z9Xuv6+Qf64YH+Sf3L/5I7miuG/4SDVP+fr/AMhr/hR/wkGqf8/X/kNf8KP7Pq91/XyD/XDA/wAk/uX/AMkdzRXDf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFH9n1e6/r5B/rhgf5J/cv/kjuaK4b/hINU/5+v/Ia/wCFH/CQap/z9f8AkNf8KP7Pq91/XyD/AFwwP8k/uX/yR3NFcN/wkGqf8/X/AJDX/Cj/AISDVP8An6/8hr/hR/Z9Xuv6+Qf64YH+Sf3L/wCSO5rM8Qf8gO5/4D/6EK5n/hINU/5+v/Ia/wCFRXGsX91A0M0+6NsZGxRnBz2FXTwNSM1JtaP+uhzYzirB18NUpRjK8otbLqrdyjRRRXqnwIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//2Q==";function t0(s,e,n){const r=s.slice();r[3]=e[n][0],r[4]=e[n][1],r[5]=e[n][2];const a=ou[r[3]];return r[6]=a[0],r[7]=a[1],r}function n0(s){let e,n,r,a,h,m,l,x;function S(){return s[2](s[3])}return{c(){e=ue("div"),n=ue("img"),a=Oe(),h=ue("span"),h.textContent=`${s[6]}`,m=Oe(),Yr(n.src,r=s[4])||Ze(n,"src",r),Ze(n,"alt",s[6]),Pn(h,"color",s[7]),Ze(e,"class","card svelte-o9mz9k"),Sr(e,"current",s[0]==s[3])},m(T,C){ae(T,e,C),Z(e,n),Z(e,a),Z(e,h),Z(e,m),l||(x=Rt(e,"click",S),l=!0)},p(T,C){s=T,C&3&&Sr(e,"current",s[0]==s[3])},d(T){T&&oe(e),l=!1,x()}}}function JE(s){let e,n=qn(s[1]),r=[];for(let a=0;a<n.length;a+=1)r[a]=n0(t0(s,n,a));return{c(){e=ue("div");for(let a=0;a<r.length;a+=1)r[a].c();Pn(e,"display","flex"),Pn(e,"flex-wrap","wrap"),Pn(e,"gap","4px")},m(a,h){ae(a,e,h);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(e,null)},p(a,[h]){if(h&3){n=qn(a[1]);let m;for(m=0;m<n.length;m+=1){const l=t0(a,n,m);r[m]?r[m].p(l,h):(r[m]=n0(l),r[m].c(),r[m].m(e,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=n.length}},i:tt,o:tt,d(a){a&&oe(e),Er(r,a)}}}function QE(s,e,n){let{current:r}=e,a=[["SegregatedWide",ZE,"https://www.cyclestreets.net/location/81274/"],["OffRoad",HE,"https://www.cyclestreets.net/location/86744/"],["SegregatedNarrow",XE,"https://www.cyclestreets.net/location/196620/"],["SharedFootway",WE,"https://www.cyclestreets.net/location/92805/"],["CycleLane",KE,"https://www.cyclestreets.net/location/81341/"],["MixedTraffic",$E,""],["Unknown",YE,""]];const h=m=>n(0,r=m);return s.$$set=m=>{"current"in m&&n(0,r=m.current)},[r,a,h]}class eA extends fn{constructor(e){super(),hn(this,e,QE,JE,an,{current:0})}}function i0(s){let e,n;return e=new rr({props:{data:s[5],$$slots:{default:[tA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&32&&(h.data=r[5]),a&65538&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function tA(s){let e,n;return e=new _r({props:{id:"routes",filter:s[1]==null?void 0:["!=",["id"],s[1]],paint:{"line-width":5,"line-color":ac,"line-opacity":.5}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&2&&(h.filter=r[1]==null?void 0:["!=",["id"],r[1]]),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function nA(s){let e,n,r=s[5]&&i0(s);return{c(){e=ue("span"),r&&r.c(),Ze(e,"slot","extra-map")},m(a,h){ae(a,e,h),r&&r.m(e,null),n=!0},p(a,h){a[5]?r?(r.p(a,h),h&32&&_e(r,1)):(r=i0(a),r.c(),_e(r,1),r.m(e,null)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d()}}}function iA(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U;function ee(se){s[10](se)}let ie={};return s[4]!==void 0&&(ie.current=s[4]),m=new eA({props:ie}),Kn.push(()=>gr(m,"current",ee)),{c(){e=ue("div"),n=ue("label"),r=Fe(`Name:
      `),a=ue("input"),h=Oe(),ot(m.$$.fragment),x=Oe(),S=ue("label"),T=Fe(`Notes:
      `),C=ue("textarea"),Ze(a,"type","text"),Ze(C,"rows","5"),Ze(e,"slot","extra-right")},m(se,Q){ae(se,e,Q),Z(e,n),Z(n,r),Z(n,a),qi(a,s[2]),Z(e,h),it(m,e,null),Z(e,x),Z(e,S),Z(S,T),Z(S,C),qi(C,s[3]),N=!0,B||(U=[Rt(a,"input",s[9]),Rt(C,"input",s[11])],B=!0)},p(se,Q){Q&4&&a.value!==se[2]&&qi(a,se[2]);const K={};!l&&Q&16&&(l=!0,K.current=se[4],mr(()=>l=!1)),m.$set(K),Q&8&&qi(C,se[3])},i(se){N||(_e(m.$$.fragment,se),N=!0)},o(se){Ie(m.$$.fragment,se),N=!1},d(se){se&&oe(e),rt(m),B=!1,Ki(U)}}}function rA(s){let e,n;return e=new GE({props:{map:s[0],finish:s[7],cancel:s[8],deleteRoute:s[6],$$slots:{"extra-right":[iA],"extra-map":[nA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,[a]){const h={};a&1&&(h.map=r[0]),a&65598&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function sA(s,e,n){let r,a,h,m;Ft(s,Ni,K=>n(12,r=K)),Ft(s,sr,K=>n(13,a=K)),Ft(s,go,K=>n(14,h=K)),Ft(s,Qf,K=>n(15,m=K));let{map:l}=e,{id:x}=e,S="",T="",C="Unknown",N=null;cc(async()=>{if(n(5,N=await a.renderRoutes()),Nn(go,h=[],h),x!=null){let K=N.features.find(pe=>pe.id==x);n(2,S=K.properties.name),n(3,T=K.properties.notes),n(4,C=K.properties.infra_type),Nn(go,h=K.properties.waypoints.map(pe=>({point:[pe.lon,pe.lat],snapped:pe.snapped})),h)}});async function B(){x&&(await a.deleteRoute(x),await Dh()),Nn(Ni,r={kind:"main"},r)}async function U(){try{let K=JSON.parse(m.inner.calculateRoute(h));if(!K){window.alert("No route drawn");return}await a.setRoute(x,{feature:K,name:S,notes:T,nodes:K.properties.full_path,infra_type:C}),await Dh(),Nn(Ni,r={kind:"main"},r)}catch(K){window.alert(K)}}function ee(){Nn(Ni,r={kind:"main"},r)}function ie(){S=this.value,n(2,S)}function se(K){C=K,n(4,C)}function Q(){T=this.value,n(3,T)}return s.$$set=K=>{"map"in K&&n(0,l=K.map),"id"in K&&n(1,x=K.id)},[l,x,S,T,C,N,B,U,ee,ie,se,Q]}class oA extends fn{constructor(e){super(),hn(this,e,sA,rA,an,{map:0,id:1})}}function r0(s,e,n){const r=s.slice();return r[3]=e[n],r}function s0(s){let e,n,r,a=s[3].infra_type+"",h,m,l=s[3].name+"",x,S,T;return{c(){e=ue("li"),n=ue("a"),r=Fe("["),h=Fe(a),m=Fe("] "),x=Fe(l),T=Oe(),Ze(n,"href",S=s[3].way),Ze(n,"target","_blank")},m(C,N){ae(C,e,N),Z(e,n),Z(n,r),Z(n,h),Z(n,m),Z(n,x),Z(e,T)},p(C,N){N&1&&a!==(a=C[3].infra_type+"")&&Lt(h,a),N&1&&l!==(l=C[3].name+"")&&Lt(x,l),N&1&&S!==(S=C[3].way)&&Ze(n,"href",S)},d(C){C&&oe(e)}}}function aA(s){let e,n,r,a=(s[0].route_length/s[0].direct_length).toFixed(1)+"",h,m,l,x,S,T,C=(s[0].route_length/s[0].car_length).toFixed(1)+"",N,B,U,ee,ie,se,Q,K,pe,ve=If(s[0],s[1])+"",De,he,xe,be,Ce,we=Sf(s[0],s[1])+"",ye,Ue,qe,pt,St,dt=If(s[0],s[2])+"",ut,Bt,vt,wt,ft,xt=Sf(s[0],s[2])+"",It,Yt,pn,Dn,We,Xn,dn,Ot,Se=qn(s[0].directions),lt=[];for(let Ye=0;Ye<Se.length;Ye+=1)lt[Ye]=s0(r0(s,Se,Ye));return{c(){e=ue("p"),n=Fe("Detour factor: "),r=ue("b"),h=Fe(a),m=Fe("x"),l=Fe(`
  longer than straight line`),x=Oe(),S=ue("p"),T=ue("b"),N=Fe(C),B=Fe("x"),U=Fe(`
  longer than the driving route (in
  `),ee=ue("span"),ee.textContent="red",ie=Fe(`
  )`),se=Oe(),Q=ue("hr"),K=Oe(),pe=ue("p"),De=Fe(ve),he=Fe(" changes in infrastructure type"),xe=Oe(),be=ue("p"),Ce=Fe("By length: "),ye=Fe(we),Ue=Oe(),qe=ue("hr"),pt=Oe(),St=ue("p"),ut=Fe(dt),Bt=Fe(" changes in level of service"),vt=Oe(),wt=ue("p"),ft=Fe("By length: "),It=Fe(xt),Yt=Oe(),pn=ue("hr"),Dn=Oe(),We=ue("details"),Xn=ue("summary"),Xn.textContent="Route directions",dn=Oe(),Ot=ue("ol");for(let Ye=0;Ye<lt.length;Ye+=1)lt[Ye].c();Pn(ee,"color","red")},m(Ye,Ct){ae(Ye,e,Ct),Z(e,n),Z(e,r),Z(r,h),Z(r,m),Z(e,l),ae(Ye,x,Ct),ae(Ye,S,Ct),Z(S,T),Z(T,N),Z(T,B),Z(S,U),Z(S,ee),Z(S,ie),ae(Ye,se,Ct),ae(Ye,Q,Ct),ae(Ye,K,Ct),ae(Ye,pe,Ct),Z(pe,De),Z(pe,he),ae(Ye,xe,Ct),ae(Ye,be,Ct),Z(be,Ce),Z(be,ye),ae(Ye,Ue,Ct),ae(Ye,qe,Ct),ae(Ye,pt,Ct),ae(Ye,St,Ct),Z(St,ut),Z(St,Bt),ae(Ye,vt,Ct),ae(Ye,wt,Ct),Z(wt,ft),Z(wt,It),ae(Ye,Yt,Ct),ae(Ye,pn,Ct),ae(Ye,Dn,Ct),ae(Ye,We,Ct),Z(We,Xn),Z(We,dn),Z(We,Ot);for(let $e=0;$e<lt.length;$e+=1)lt[$e]&&lt[$e].m(Ot,null)},p(Ye,[Ct]){if(Ct&1&&a!==(a=(Ye[0].route_length/Ye[0].direct_length).toFixed(1)+"")&&Lt(h,a),Ct&1&&C!==(C=(Ye[0].route_length/Ye[0].car_length).toFixed(1)+"")&&Lt(N,C),Ct&1&&ve!==(ve=If(Ye[0],Ye[1])+"")&&Lt(De,ve),Ct&1&&we!==(we=Sf(Ye[0],Ye[1])+"")&&Lt(ye,we),Ct&1&&dt!==(dt=If(Ye[0],Ye[2])+"")&&Lt(ut,dt),Ct&1&&xt!==(xt=Sf(Ye[0],Ye[2])+"")&&Lt(It,xt),Ct&1){Se=qn(Ye[0].directions);let $e;for($e=0;$e<Se.length;$e+=1){const kt=r0(Ye,Se,$e);lt[$e]?lt[$e].p(kt,Ct):(lt[$e]=s0(kt),lt[$e].c(),lt[$e].m(Ot,null))}for(;$e<lt.length;$e+=1)lt[$e].d(1);lt.length=Se.length}},i:tt,o:tt,d(Ye){Ye&&(oe(e),oe(x),oe(S),oe(se),oe(Q),oe(K),oe(pe),oe(xe),oe(be),oe(Ue),oe(qe),oe(pt),oe(St),oe(vt),oe(wt),oe(Yt),oe(pn),oe(Dn),oe(We)),Er(lt,Ye)}}}function If(s,e){let n=0;for(let r=0;r<s.directions.length-1;r++){let a=e(s.directions[r]),h=e(s.directions[r+1]);a!=h&&n++}return n}function Sf(s,e){let n={};for(let h of s.directions){let m=e(h);Object.hasOwn(n,m)||(n[m]=0),n[m]+=h.length}let r=0;for(let h of Object.values(n))r+=h;let a=[];for(let[h,m]of Object.entries(n).toSorted((l,x)=>x[1]-l[1])){let l=Math.round(m/r*100);a.push(`${l}% ${h}`)}return a.join(", ")}function lA(s,e,n){let{gj:r}=e,a=m=>m.infra_type,h=m=>m.los;return s.$$set=m=>{"gj"in m&&n(0,r=m.gj)},[r,a,h]}class uA extends fn{constructor(e){super(),hn(this,e,lA,aA,an,{gj:0})}}function o0(s){let e,n;return{c(){e=ue("p"),n=Fe(s[6])},m(r,a){ae(r,e,a),Z(e,n)},p(r,a){a&64&&Lt(n,r[6])},d(r){r&&oe(e)}}}function a0(s){let e,n;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function l0(s){let e,n;return e=new uA({props:{gj:s[5]}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&32&&(h.gj=r[5]),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function cA(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe=s[6]&&o0(s),ve=s[2]=="los"&&a0(),De=s[5]&&l0(s);return{c(){e=ue("div"),n=ue("h2"),n.textContent="Evaluate a route mode",r=Oe(),a=ue("button"),a.textContent="Back",h=Oe(),m=ue("p"),m.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,l=Oe(),pe&&pe.c(),x=Oe(),S=ue("label"),T=Fe(`Show details along route
      `),C=ue("select"),N=ue("option"),N.textContent="Just show route",B=ue("option"),B.textContent="Level of service",U=ue("option"),U.textContent="Infrastructure type",ee=Oe(),ve&&ve.c(),ie=Oe(),De&&De.c(),N.__value="",qi(N,N.__value),B.__value="los",qi(B,B.__value),U.__value="infra_type",qi(U,U.__value),s[2]===void 0&&ra(()=>s[17].call(C)),Ze(e,"slot","left")},m(he,xe){ae(he,e,xe),Z(e,n),Z(e,r),Z(e,a),Z(e,h),Z(e,m),Z(e,l),pe&&pe.m(e,null),Z(e,x),Z(e,S),Z(S,T),Z(S,C),Z(C,N),Z(C,B),Z(C,U),Us(C,s[2],!0),Z(e,ee),ve&&ve.m(e,null),Z(e,ie),De&&De.m(e,null),se=!0,Q||(K=[Rt(a,"click",s[16]),Rt(C,"change",s[17])],Q=!0)},p(he,xe){he[6]?pe?pe.p(he,xe):(pe=o0(he),pe.c(),pe.m(e,x)):pe&&(pe.d(1),pe=null),xe&4&&Us(C,he[2]),he[2]=="los"?ve?xe&4&&_e(ve,1):(ve=a0(),ve.c(),_e(ve,1),ve.m(e,ie)):ve&&(zn(),Ie(ve,1,1,()=>{ve=null}),Fn()),he[5]?De?(De.p(he,xe),xe&32&&_e(De,1)):(De=l0(he),De.c(),_e(De,1),De.m(e,null)):De&&(zn(),Ie(De,1,1,()=>{De=null}),Fn())},i(he){se||(_e(ve),_e(De),se=!0)},o(he){Ie(ve),Ie(De),se=!1},d(he){he&&oe(e),pe&&pe.d(),ve&&ve.d(),De&&De.d(),Q=!1,Ki(K)}}}function hA(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function fA(s){let e,n;return e=new rr({props:{data:s[20],$$slots:{default:[dA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&256&&(h.data=r[20]),a&2097664&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function dA(s){let e,n;return e=new _r({props:{id:"routes",paint:{"line-width":5,"line-color":ac},layout:{visibility:s[9]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&512&&(h.layout={visibility:r[9]?"visible":"none"}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function pA(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function u0(s){let e,n,r,a,h,m;function l(C){s[14](C)}let x={draggable:!0,$$slots:{default:[mA]},$$scope:{ctx:s}};s[4]!==void 0&&(x.lngLat=s[4]),e=new Zf({props:x}),Kn.push(()=>gr(e,"lngLat",l));function S(C){s[15](C)}let T={draggable:!0,$$slots:{default:[gA]},$$scope:{ctx:s}};return s[3]!==void 0&&(T.lngLat=s[3]),a=new Zf({props:T}),Kn.push(()=>gr(a,"lngLat",S)),{c(){ot(e.$$.fragment),r=Oe(),ot(a.$$.fragment)},m(C,N){it(e,C,N),ae(C,r,N),it(a,C,N),m=!0},p(C,N){const B={};N&2097152&&(B.$$scope={dirty:N,ctx:C}),!n&&N&16&&(n=!0,B.lngLat=C[4],mr(()=>n=!1)),e.$set(B);const U={};N&2097152&&(U.$$scope={dirty:N,ctx:C}),!h&&N&8&&(h=!0,U.lngLat=C[3],mr(()=>h=!1)),a.$set(U)},i(C){m||(_e(e.$$.fragment,C),_e(a.$$.fragment,C),m=!0)},o(C){Ie(e.$$.fragment,C),Ie(a.$$.fragment,C),m=!1},d(C){C&&oe(r),rt(e,C),rt(a,C)}}}function mA(s){let e;return{c(){e=ue("span"),e.textContent="A",Ze(e,"class","dot svelte-1ej0v4r")},m(n,r){ae(n,e,r)},p:tt,d(n){n&&oe(e)}}}function gA(s){let e;return{c(){e=ue("span"),e.textContent="B",Ze(e,"class","dot svelte-1ej0v4r")},m(n,r){ae(n,e,r)},p:tt,d(n){n&&oe(e)}}}function c0(s){let e,n;return e=new rr({props:{data:s[5],generateId:!0,$$slots:{default:[_A]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&32&&(h.data=r[5]),a&2097156&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function _A(s){let e,n,r,a;return e=new _r({props:{filter:["!",["has","car_route"]],paint:{"line-width":20,"line-color":s[2]==""?"cyan":s[2]=="los"?Op:ac,"line-opacity":Cs(.5,1)},manageHoverState:!0}}),r=new _r({props:{filter:["has","car_route"],paint:{"line-width":10,"line-color":"red","line-opacity":Cs(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,m){const l={};m&4&&(l.paint={"line-width":20,"line-color":h[2]==""?"cyan":h[2]=="los"?Op:ac,"line-opacity":Cs(.5,1)}),e.$set(l)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function yA(s){let e,n,r,a,h,m,l;n=new Xv({}),n.$on("contextmenu",s[10]);let x={ctx:s,current:null,token:null,hasCatch:!1,pending:pA,then:fA,catch:hA,value:20,blocks:[,,,]};ms(a=xl(s[8]).renderRoutes(),x);let S=s[4]&&s[3]&&u0(s),T=s[5]&&c0(s);return{c(){e=ue("div"),ot(n.$$.fragment),r=Oe(),x.block.c(),h=Oe(),S&&S.c(),m=Oe(),T&&T.c(),Ze(e,"slot","map")},m(C,N){ae(C,e,N),it(n,e,null),Z(e,r),x.block.m(e,x.anchor=null),x.mount=()=>e,x.anchor=h,Z(e,h),S&&S.m(e,null),Z(e,m),T&&T.m(e,null),l=!0},p(C,N){s=C,x.ctx=s,N&256&&a!==(a=xl(s[8]).renderRoutes())&&ms(a,x)||wl(x,s,N),s[4]&&s[3]?S?(S.p(s,N),N&24&&_e(S,1)):(S=u0(s),S.c(),_e(S,1),S.m(e,m)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn()),s[5]?T?(T.p(s,N),N&32&&_e(T,1)):(T=c0(s),T.c(),_e(T,1),T.m(e,null)):T&&(zn(),Ie(T,1,1,()=>{T=null}),Fn())},i(C){l||(_e(n.$$.fragment,C),_e(x.block),_e(S),_e(T),l=!0)},o(C){Ie(n.$$.fragment,C);for(let N=0;N<3;N+=1){const B=x.blocks[N];Ie(B)}Ie(S),Ie(T),l=!1},d(C){C&&oe(e),rt(n),x.block.d(),x.token=null,x=null,S&&S.d(),T&&T.d()}}}function h0(s){let e,n,r,a,h,m,l,x=s[1]+1+"",S,T,C=s[0].length+"",N,B,U,ee,ie,se,Q;return{c(){e=ue("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",n=Oe(),r=ue("div"),a=ue("button"),h=Fe("Previous"),l=Oe(),S=Fe(x),T=Fe(" / "),N=Fe(C),B=Oe(),U=ue("button"),ee=Fe("Next"),Ze(a,"class","secondary"),a.disabled=m=s[1]==0,Ze(U,"class","secondary"),U.disabled=ie=s[1]==s[0].length-1},m(K,pe){ae(K,e,pe),ae(K,n,pe),ae(K,r,pe),Z(r,a),Z(a,h),Z(r,l),Z(r,S),Z(r,T),Z(r,N),Z(r,B),Z(r,U),Z(U,ee),se||(Q=[Rt(a,"click",s[12]),Rt(U,"click",s[13])],se=!0)},p(K,pe){pe&2&&m!==(m=K[1]==0)&&(a.disabled=m),pe&2&&x!==(x=K[1]+1+"")&&Lt(S,x),pe&1&&C!==(C=K[0].length+"")&&Lt(N,C),pe&3&&ie!==(ie=K[1]==K[0].length-1)&&(U.disabled=ie)},d(K){K&&(oe(e),oe(n),oe(r)),se=!1,Ki(Q)}}}function vA(s){let e,n=s[0].length>0&&h0(s);return{c(){e=ue("div"),n&&n.c(),Ze(e,"slot","right")},m(r,a){ae(r,e,a),n&&n.m(e,null)},p(r,a){r[0].length>0?n?n.p(r,a):(n=h0(r),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(r){r&&oe(e),n&&n.d()}}}function bA(s){let e,n,r,a;return e=new gc({props:{$$slots:{right:[vA],map:[yA],left:[cA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(h,m){it(e,h,m),n=!0,r||(a=Rt(window,"keydown",s[11]),r=!0)},p(h,[m]){const l={};m&2098175&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){n||(_e(e.$$.fragment,h),n=!0)},o(h){Ie(e.$$.fragment,h),n=!1},d(h){rt(e,h),r=!1,a()}}}function xA(s,e,n){let r,a,h,m,l;Ft(s,Ni,he=>n(7,r=he)),Ft(s,Sh,he=>n(3,a=he)),Ft(s,Ju,he=>n(4,h=he)),Ft(s,sr,he=>n(8,m=he)),Ft(s,zp,he=>n(9,l=he));let{browse:x}=e,S=0,T=null,C="",N="los";async function B(he,xe,be=""){try{n(5,T=await m.evaluateRoute({start:he,end:[xe.lng,xe.lat],breakdown:be})),n(6,C="")}catch(Ce){n(5,T=null),n(6,C=Ce.toString())}}function U(he){Nn(Ju,h=he.detail.lngLat,h)}async function ee(he){if(x.length==0)return;let xe=x[he];Nn(Ju,h={lng:xe[0].x,lat:xe[0].y},h),Nn(Sh,a={lng:xe[1].x,lat:xe[1].y},a),B(h,a,N)}function ie(he){he.key==="Escape"&&(he.stopPropagation(),Nn(Ni,r={kind:"main"},r))}const se=()=>n(1,S--,S),Q=()=>n(1,S++,S);function K(he){h=he,Ju.set(h)}function pe(he){a=he,Sh.set(a)}const ve=()=>Nn(Ni,r={kind:"main"},r);function De(){N=eu(this),n(2,N)}return s.$$set=he=>{"browse"in he&&n(0,x=he.browse)},s.$$.update=()=>{s.$$.dirty&28&&B(h,a,N),s.$$.dirty&2&&ee(S)},[x,S,N,a,h,T,C,r,m,l,U,ie,se,Q,K,pe,ve,De]}class wA extends fn{constructor(e){super(),hn(this,e,xA,bA,an,{browse:0})}}function Ir(s,e){return e==0?"0%":`${Math.round(s/e*100)}%`}function ed(s){return s.reduce((e,n)=>e+n,0)}function td(s){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",s],.0021]]]]]]]]}function nm(s){return["step",["get",s],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function f0(s,e,n){const r=s.slice();return r[5]=e[n][0],r[6]=e[n][1],r}function d0(s){let e,n=s[0].succeeded.toLocaleString()+"",r,a,h=s[0].failed.toLocaleString()+"",m,l,x,S,T,C=s[0].max_count.toLocaleString()+"",N,B,U,ee,ie,se,Q,K=(100*s[0].percent_off_network).toFixed(1)+"",pe,ve,De,he=qn(Object.entries(s[0].percent_on_network)),xe=[];for(let be=0;be<he.length;be+=1)xe[be]=p0(f0(s,he,be));return{c(){e=ue("p"),r=Fe(n),a=Fe(" routes succeeded, "),m=Fe(h),l=Fe(`
        failed`),x=Oe(),S=ue("p"),T=Fe("Highest count on any one road is "),N=Fe(C),B=Oe(),U=ue("p"),U.textContent="Percent of demand by infrastructure type:",ee=Oe(),ie=ue("ul"),se=ue("li"),Q=Fe("Off the network: "),pe=Fe(K),ve=Fe("%"),De=Oe();for(let be=0;be<xe.length;be+=1)xe[be].c()},m(be,Ce){ae(be,e,Ce),Z(e,r),Z(e,a),Z(e,m),Z(e,l),ae(be,x,Ce),ae(be,S,Ce),Z(S,T),Z(S,N),ae(be,B,Ce),ae(be,U,Ce),ae(be,ee,Ce),ae(be,ie,Ce),Z(ie,se),Z(se,Q),Z(se,pe),Z(se,ve),Z(ie,De);for(let we=0;we<xe.length;we+=1)xe[we]&&xe[we].m(ie,null)},p(be,Ce){if(Ce&1&&n!==(n=be[0].succeeded.toLocaleString()+"")&&Lt(r,n),Ce&1&&h!==(h=be[0].failed.toLocaleString()+"")&&Lt(m,h),Ce&1&&C!==(C=be[0].max_count.toLocaleString()+"")&&Lt(N,C),Ce&1&&K!==(K=(100*be[0].percent_off_network).toFixed(1)+"")&&Lt(pe,K),Ce&1){he=qn(Object.entries(be[0].percent_on_network));let we;for(we=0;we<he.length;we+=1){const ye=f0(be,he,we);xe[we]?xe[we].p(ye,Ce):(xe[we]=p0(ye),xe[we].c(),xe[we].m(ie,null))}for(;we<xe.length;we+=1)xe[we].d(1);xe.length=he.length}},d(be){be&&(oe(e),oe(x),oe(S),oe(B),oe(U),oe(ee),oe(ie)),Er(xe,be)}}}function p0(s){let e,n=s[5]+"",r,a,h=(100*s[6]).toFixed(1)+"",m,l;return{c(){e=ue("li"),r=Fe(n),a=Fe(": "),m=Fe(h),l=Fe("%")},m(x,S){ae(x,e,S),Z(e,r),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[5]+"")&&Lt(r,n),S&1&&h!==(h=(100*x[6]).toFixed(1)+"")&&Lt(m,h)},d(x){x&&oe(e)}}}function kA(s){let e,n,r,a,h,m,l,x=s[0]&&d0(s);return{c(){e=ue("div"),n=ue("h2"),n.textContent="Evaluate OD mode",r=Oe(),a=ue("button"),a.textContent="Back",h=Oe(),x&&x.c(),Ze(e,"slot","left")},m(S,T){ae(S,e,T),Z(e,n),Z(e,r),Z(e,a),Z(e,h),x&&x.m(e,null),m||(l=Rt(a,"click",s[2]),m=!0)},p(S,T){S[0]?x?x.p(S,T):(x=d0(S),x.c(),x.m(e,null)):x&&(x.d(1),x=null)},d(S){S&&oe(e),x&&x.d(),m=!1,l()}}}function m0(s){let e,n;return e=new rr({props:{data:s[0],generateId:!0,$$slots:{default:[EA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.data=r[0]),a&512&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function IA(s){let e=s[4].count+"",n,r,a=s[4].infra_type+"",h;return{c(){n=Fe(e),r=Fe(" on "),h=Fe(a)},m(m,l){ae(m,n,l),ae(m,r,l),ae(m,h,l)},p(m,l){l&16&&e!==(e=m[4].count+"")&&Lt(n,e),l&16&&a!==(a=m[4].infra_type+"")&&Lt(h,a)},d(m){m&&(oe(n),oe(r),oe(h))}}}function SA(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[IA,({props:r})=>({4:r}),({props:r})=>r?16:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&528&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function EA(s){let e,n;return e=new _r({props:{paint:{"line-width":td("count"),"line-color":nm("count")},manageHoverState:!0,eventsIfTopMost:!0,$$slots:{default:[SA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&512&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function AA(s){let e,n,r=s[0]&&m0(s);return{c(){e=ue("div"),r&&r.c(),Ze(e,"slot","map")},m(a,h){ae(a,e,h),r&&r.m(e,null),n=!0},p(a,h){a[0]?r?(r.p(a,h),h&1&&_e(r,1)):(r=m0(a),r.c(),_e(r,1),r.m(e,null)):r&&(zn(),Ie(r,1,1,()=>{r=null}),Fn())},i(a){n||(_e(r),n=!0)},o(a){Ie(r),n=!1},d(a){a&&oe(e),r&&r.d()}}}function TA(s){let e,n;return e=new gc({props:{$$slots:{map:[AA],left:[kA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,[a]){const h={};a&515&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function CA(s,e,n){let r,a;Ft(s,sr,l=>n(3,r=l)),Ft(s,Ni,l=>n(1,a=l));let h=null;return cc(async()=>{n(0,h=await r.evaluateOD())}),[h,a,()=>Nn(Ni,a={kind:"main"},a)]}class LA extends fn{constructor(e){super(),hn(this,e,CA,TA,an,{})}}function MA(s){let e;return{c(){e=ue("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(n,r){ae(n,e,r)},d(n){n&&oe(e)}}}function RA(s){let e;return{c(){e=ue("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(n,r){ae(n,e,r)},d(n){n&&oe(e)}}}function PA(s){let e;return{c(){e=ue("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(n,r){ae(n,e,r)},d(n){n&&oe(e)}}}function DA(s){let e;return{c(){e=ue("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(n,r){ae(n,e,r)},d(n){n&&oe(e)}}}function NA(s){let e;function n(h,m){if(h[0]=="primary")return DA;if(h[0]=="secondary")return PA;if(h[0]=="local access")return RA;if(h[0]=="long distance")return MA}let r=n(s),a=r&&r(s);return{c(){a&&a.c(),e=ni()},m(h,m){a&&a.m(h,m),ae(h,e,m)},p(h,m){r!==(r=n(h))&&(a&&a.d(1),a=r&&r(h),a&&(a.c(),a.m(e.parentNode,e)))},d(h){h&&oe(e),a&&a.d(h)}}}function zA(s){let e,n,r,a,h,m,l,x,S,T,C,N,B;return T=new Qv({props:{$$slots:{default:[NA]},$$scope:{ctx:s}}}),{c(){e=ue("div"),n=ue("button"),n.textContent="Primary routes",r=Oe(),a=ue("button"),a.textContent="Secondary routes",h=Oe(),m=ue("button"),m.textContent="Local access routes",l=Oe(),x=ue("button"),x.textContent="Long distance routes",S=Oe(),ot(T.$$.fragment),Ze(n,"class","svelte-gv50c1"),Pn(n,"background",s[0]=="primary"?ds.primaryRoutes:"grey"),Ze(a,"class","svelte-gv50c1"),Pn(a,"background",s[0]=="secondary"?ds.secondaryRoutes:"grey"),Ze(m,"class","svelte-gv50c1"),Pn(m,"background",s[0]=="local access"?ds.localAccessRoutes:"grey"),Ze(x,"class","svelte-gv50c1"),Pn(x,"background",s[0]=="long distance"?ds.longDistanceRoutes:"grey"),Ze(e,"class","svelte-gv50c1")},m(U,ee){ae(U,e,ee),Z(e,n),Z(e,r),Z(e,a),Z(e,h),Z(e,m),Z(e,l),Z(e,x),Z(e,S),it(T,e,null),C=!0,N||(B=[Rt(n,"click",s[1]),Rt(a,"click",s[2]),Rt(m,"click",s[3]),Rt(x,"click",s[4])],N=!0)},p(U,[ee]){ee&1&&Pn(n,"background",U[0]=="primary"?ds.primaryRoutes:"grey"),ee&1&&Pn(a,"background",U[0]=="secondary"?ds.secondaryRoutes:"grey"),ee&1&&Pn(m,"background",U[0]=="local access"?ds.localAccessRoutes:"grey"),ee&1&&Pn(x,"background",U[0]=="long distance"?ds.longDistanceRoutes:"grey");const ie={};ee&33&&(ie.$$scope={dirty:ee,ctx:U}),T.$set(ie)},i(U){C||(_e(T.$$.fragment,U),C=!0)},o(U){Ie(T.$$.fragment,U),C=!1},d(U){U&&oe(e),rt(T),N=!1,Ki(B)}}}function FA(s,e,n){let r;return Ft(s,Ql,x=>n(0,r=x)),[r,()=>Nn(Ql,r="primary",r),()=>Nn(Ql,r="secondary",r),()=>Nn(Ql,r="local access",r),()=>Nn(Ql,r="long distance",r)]}class OA extends fn{constructor(e){super(),hn(this,e,FA,zA,an,{})}}function BA(s){let e,n;const r=s[3].default,a=Zi(r,s,s[2],null);return{c(){e=ue("div"),a&&a.c()},m(h,m){ae(h,e,m),a&&a.m(e,null),s[4](e),n=!0},p(h,[m]){a&&a.p&&(!n||m&4)&&Xi(a,r,h,h[2],n?Hi(r,h[2],m,null):Wi(h[2]),null)},i(h){n||(_e(a,h),n=!0)},o(h){Ie(a,h),n=!1},d(h){h&&oe(e),a&&a.d(h),s[4](null)}}}function UA(s,e,n){let{$$slots:r={},$$scope:a}=e,{name:h}=e,m=null;function l(x){Kn[x?"unshift":"push"](()=>{m=x,n(0,m)})}return s.$$set=x=>{"name"in x&&n(1,h=x.name),"$$scope"in x&&n(2,a=x.$$scope)},s.$$.update=()=>{s.$$.dirty&3&&m&&Jv.update(x=>(x.set(h,m),x))},[m,h,a,r,l]}class to extends fn{constructor(e){super(),hn(this,e,UA,BA,an,{name:1})}}function g0(s){let e,n,r;return{c(){e=ue("button"),e.textContent="Import existing routes",Ze(e,"class","outline")},m(a,h){ae(a,e,h),n||(r=Rt(e,"click",s[6]),n=!0)},p:tt,d(a){a&&oe(e),n=!1,r()}}}function jA(s){let e,n,r,a,h,m,l,x=s[0]&&g0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Existing network`),a=Oe(),x&&x.c(),h=ni(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=s[0],Z(e,r),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",s[5]),m=!0)},p(S,T){T&1&&(n.checked=S[0]),S[0]?x?x.p(S,T):(x=g0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function _0(s){let e,n;return e=new Wv({props:{$$slots:{default:[qA]},$$scope:{ctx:s}}}),e.$on("close",s[8]),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&4100&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function qA(s){let e,n,r,a,h,m,l,x,S;return{c(){e=ue("h2"),e.textContent="Import existing routes from OpenStreetMap",n=Oe(),r=ue("p"),a=Fe(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),h=ue("button"),h.textContent="Import existing routes",m=Oe(),l=ue("button"),l.textContent="Cancel",Ze(l,"class","secondary")},m(T,C){ae(T,e,C),ae(T,n,C),ae(T,r,C),Z(r,a),Z(r,h),Z(r,m),Z(r,l),x||(S=[Rt(h,"click",s[4]),Rt(l,"click",s[7])],x=!0)},p:tt,d(T){T&&(oe(e),oe(n),oe(r)),x=!1,Ki(S)}}}function y0(s){let e,n,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:WA,then:GA,catch:VA,value:10,blocks:[,,,]};return ms(n=s[3].classifyExistingNetwork(),a),{c(){e=ni(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&8&&n!==(n=s[3].classifyExistingNetwork())&&ms(n,a)||wl(a,s,m)},i(h){r||(_e(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}r=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function VA(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function GA(s){let e,n;return e=new rr({props:{data:s[10],generateId:!0,$$slots:{default:[XA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&8&&(h.data=r[10]),a&4097&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function ZA(s){let e=ou[s[11].infra_type][0]+"",n;return{c(){n=Fe(e)},m(r,a){ae(r,n,a)},p(r,a){a&2048&&e!==(e=ou[r[11].infra_type][0]+"")&&Lt(n,e)},d(r){r&&oe(n)}}}function HA(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[ZA,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function XA(s){let e,n;return e=new _r({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":Cs(5,7),"line-color":ac,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[HA]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),a&4096&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function WA(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function KA(s){let e,n,r,a,h;e=new to({props:{name:"existing network",$$slots:{default:[jA]},$$scope:{ctx:s}}});let m=s[2]&&_0(s),l=s[3]&&s[1]&&y0(s);return{c(){ot(e.$$.fragment),n=Oe(),m&&m.c(),r=Oe(),l&&l.c(),a=ni()},m(x,S){it(e,x,S),ae(x,n,S),m&&m.m(x,S),ae(x,r,S),l&&l.m(x,S),ae(x,a,S),h=!0},p(x,[S]){const T={};S&4101&&(T.$$scope={dirty:S,ctx:x}),e.$set(T),x[2]?m?(m.p(x,S),S&4&&_e(m,1)):(m=_0(x),m.c(),_e(m,1),m.m(r.parentNode,r)):m&&(zn(),Ie(m,1,1,()=>{m=null}),Fn()),x[3]&&x[1]?l?(l.p(x,S),S&10&&_e(l,1)):(l=y0(x),l.c(),_e(l,1),l.m(a.parentNode,a)):l&&(zn(),Ie(l,1,1,()=>{l=null}),Fn())},i(x){h||(_e(e.$$.fragment,x),_e(m),_e(l),h=!0)},o(x){Ie(e.$$.fragment,x),Ie(m),Ie(l),h=!1},d(x){x&&(oe(n),oe(r),oe(a)),rt(e,x),m&&m.d(x),l&&l.d(x)}}}function $A(s,e,n){let r,a;Ft(s,Ph,B=>n(9,r=B)),Ft(s,sr,B=>n(3,a=B));let h=!1,m=!1,l=!1;async function x(){if(n(2,l=!1),a){let B=a.importExistingRoutes(),U=B==1?"route segment":"route segments";await Dh(),Nn(Ph,r+=1,r),window.alert(`Imported ${B} ${U}`),n(0,h=!1)}}function S(){h=this.checked,n(0,h)}const T=()=>n(2,l=!0),C=()=>n(2,l=!1),N=()=>n(2,l=!1);return s.$$.update=()=>{s.$$.dirty&1&&h&&n(1,m=!0)},[h,m,l,a,x,S,T,C,N]}class YA extends fn{constructor(e){super(),hn(this,e,$A,KA,an,{})}}function v0(s,e,n){const r=s.slice();return r[17]=e[n][0],r[18]=e[n][1],r}function b0(s,e,n){const r=s.slice();return r[17]=e[n][0],r[18]=e[n][1],r}function x0(s,e,n){const r=s.slice();return r[17]=e[n][0],r[18]=e[n][1],r}function w0(s,e,n){const r=s.slice();return r[17]=e[n][0],r[18]=e[n][1],r}function k0(s,e,n){const r=s.slice();return r[17]=e[n][0],r[18]=e[n][1],r}function I0(s,e,n){const r=s.slice();return r[17]=e[n][0],r[18]=e[n][1],r}function S0(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q=qn(s[7]),K=[];for(let Ce=0;Ce<Q.length;Ce+=1)K[Ce]=E0(I0(s,Q,Ce));let pe=qn(s[8]),ve=[];for(let Ce=0;Ce<pe.length;Ce+=1)ve[Ce]=A0(k0(s,pe,Ce));let De=qn(s[9]),he=[];for(let Ce=0;Ce<De.length;Ce+=1)he[Ce]=T0(w0(s,De,Ce));let xe=qn(s[10]),be=[];for(let Ce=0;Ce<xe.length;Ce+=1)be[Ce]=C0(x0(s,xe,Ce));return{c(){e=ue("label"),n=Fe(`Trip purpose:
      `),r=ue("select");for(let Ce=0;Ce<K.length;Ce+=1)K[Ce].c();a=Oe(),h=ue("label"),m=Fe(`Scenario:
      `),l=ue("select");for(let Ce=0;Ce<ve.length;Ce+=1)ve[Ce].c();x=Oe(),S=ue("label"),T=Fe(`Network type:
      `),C=ue("select");for(let Ce=0;Ce<he.length;Ce+=1)he[Ce].c();N=Oe(),B=ue("label"),U=Fe(`Color by:
      `),ee=ue("select");for(let Ce=0;Ce<be.length;Ce+=1)be[Ce].c();s[0]===void 0&&ra(()=>s[12].call(r)),s[1]===void 0&&ra(()=>s[13].call(l)),s[2]===void 0&&ra(()=>s[14].call(C)),s[3]===void 0&&ra(()=>s[15].call(ee))},m(Ce,we){ae(Ce,e,we),Z(e,n),Z(e,r);for(let ye=0;ye<K.length;ye+=1)K[ye]&&K[ye].m(r,null);Us(r,s[0],!0),ae(Ce,a,we),ae(Ce,h,we),Z(h,m),Z(h,l);for(let ye=0;ye<ve.length;ye+=1)ve[ye]&&ve[ye].m(l,null);Us(l,s[1],!0),ae(Ce,x,we),ae(Ce,S,we),Z(S,T),Z(S,C);for(let ye=0;ye<he.length;ye+=1)he[ye]&&he[ye].m(C,null);Us(C,s[2],!0),ae(Ce,N,we),ae(Ce,B,we),Z(B,U),Z(B,ee);for(let ye=0;ye<be.length;ye+=1)be[ye]&&be[ye].m(ee,null);Us(ee,s[3],!0),ie||(se=[Rt(r,"change",s[12]),Rt(l,"change",s[13]),Rt(C,"change",s[14]),Rt(ee,"change",s[15])],ie=!0)},p(Ce,we){if(we[0]&128){Q=qn(Ce[7]);let ye;for(ye=0;ye<Q.length;ye+=1){const Ue=I0(Ce,Q,ye);K[ye]?K[ye].p(Ue,we):(K[ye]=E0(Ue),K[ye].c(),K[ye].m(r,null))}for(;ye<K.length;ye+=1)K[ye].d(1);K.length=Q.length}if(we[0]&129&&Us(r,Ce[0]),we[0]&256){pe=qn(Ce[8]);let ye;for(ye=0;ye<pe.length;ye+=1){const Ue=k0(Ce,pe,ye);ve[ye]?ve[ye].p(Ue,we):(ve[ye]=A0(Ue),ve[ye].c(),ve[ye].m(l,null))}for(;ye<ve.length;ye+=1)ve[ye].d(1);ve.length=pe.length}if(we[0]&258&&Us(l,Ce[1]),we[0]&512){De=qn(Ce[9]);let ye;for(ye=0;ye<De.length;ye+=1){const Ue=w0(Ce,De,ye);he[ye]?he[ye].p(Ue,we):(he[ye]=T0(Ue),he[ye].c(),he[ye].m(C,null))}for(;ye<he.length;ye+=1)he[ye].d(1);he.length=De.length}if(we[0]&516&&Us(C,Ce[2]),we[0]&1024){xe=qn(Ce[10]);let ye;for(ye=0;ye<xe.length;ye+=1){const Ue=x0(Ce,xe,ye);be[ye]?be[ye].p(Ue,we):(be[ye]=C0(Ue),be[ye].c(),be[ye].m(ee,null))}for(;ye<be.length;ye+=1)be[ye].d(1);be.length=xe.length}we[0]&1032&&Us(ee,Ce[3])},d(Ce){Ce&&(oe(e),oe(a),oe(h),oe(x),oe(S),oe(N),oe(B)),Er(K,Ce),Er(ve,Ce),Er(he,Ce),Er(be,Ce),ie=!1,Ki(se)}}}function E0(s){let e,n=s[18]+"",r;return{c(){e=ue("option"),r=Fe(n),e.__value=s[17],qi(e,e.__value)},m(a,h){ae(a,e,h),Z(e,r)},p:tt,d(a){a&&oe(e)}}}function A0(s){let e,n=s[18]+"",r;return{c(){e=ue("option"),r=Fe(n),e.__value=s[17],qi(e,e.__value)},m(a,h){ae(a,e,h),Z(e,r)},p:tt,d(a){a&&oe(e)}}}function T0(s){let e,n=s[18]+"",r;return{c(){e=ue("option"),r=Fe(n),e.__value=s[17],qi(e,e.__value)},m(a,h){ae(a,e,h),Z(e,r)},p:tt,d(a){a&&oe(e)}}}function C0(s){let e,n=s[18]+"",r;return{c(){e=ue("option"),r=Fe(n),e.__value=s[17],qi(e,e.__value)},m(a,h){ae(a,e,h),Z(e,r)},p:tt,d(a){a&&oe(e)}}}function JA(s){let e,n,r,a,h,m,l,x=s[5]&&S0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Route network`),a=Oe(),x&&x.c(),h=ni(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=s[5],Z(e,r),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",s[11]),m=!0)},p(S,T){T[0]&32&&(n.checked=S[5]),S[5]?x?x.p(S,T):(x=S0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function L0(s){let e,n,r,a,h=s[16][`${s[17]}_fastest_bicycle`].toLocaleString()+"",m,l,x,S=s[16][`${s[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",T,C,N,B=s[16][`${s[17]}_fastest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=ue("tr"),n=ue("th"),n.textContent=`${s[18]}`,r=Oe(),a=ue("td"),m=Fe(h),l=Oe(),x=ue("td"),T=Fe(S),C=Oe(),N=ue("td"),U=Fe(B),ee=Oe()},m(ie,se){ae(ie,e,se),Z(e,n),Z(e,r),Z(e,a),Z(a,m),Z(e,l),Z(e,x),Z(x,T),Z(e,C),Z(e,N),Z(N,U),Z(e,ee)},p(ie,se){se[0]&65536&&h!==(h=ie[16][`${ie[17]}_fastest_bicycle`].toLocaleString()+"")&&Lt(m,h),se[0]&65536&&S!==(S=ie[16][`${ie[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&Lt(T,S),se[0]&65536&&B!==(B=ie[16][`${ie[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&Lt(U,B)},d(ie){ie&&oe(e)}}}function M0(s){let e,n,r,a,h=s[16][`${s[17]}_quietest_bicycle`].toLocaleString()+"",m,l,x,S=s[16][`${s[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",T,C,N,B=s[16][`${s[17]}_quietest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=ue("tr"),n=ue("th"),n.textContent=`${s[18]}`,r=Oe(),a=ue("td"),m=Fe(h),l=Oe(),x=ue("td"),T=Fe(S),C=Oe(),N=ue("td"),U=Fe(B),ee=Oe()},m(ie,se){ae(ie,e,se),Z(e,n),Z(e,r),Z(e,a),Z(a,m),Z(e,l),Z(e,x),Z(x,T),Z(e,C),Z(e,N),Z(N,U),Z(e,ee)},p(ie,se){se[0]&65536&&h!==(h=ie[16][`${ie[17]}_quietest_bicycle`].toLocaleString()+"")&&Lt(m,h),se[0]&65536&&S!==(S=ie[16][`${ie[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&Lt(T,S),se[0]&65536&&B!==(B=ie[16][`${ie[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&Lt(U,B)},d(ie){ie&&oe(e)}}}function QA(s){let e,n,r,a=s[16][s[4]].toLocaleString()+"",h,m,l,x,S=s[16].gradient+"",T,C,N,B,U,ee=s[16].quietness+"",ie,se,Q,K,pe,ve,De,he,xe,be,Ce,we,ye,Ue,qe,pt,St,dt=qn(s[7]),ut=[];for(let wt=0;wt<dt.length;wt+=1)ut[wt]=L0(b0(s,dt,wt));let Bt=qn(s[7]),vt=[];for(let wt=0;wt<Bt.length;wt+=1)vt[wt]=M0(v0(s,Bt,wt));return{c(){e=ue("div"),n=ue("p"),r=Fe("Cyclists: "),h=Fe(a),m=Oe(),l=ue("p"),x=Fe("Gradient: "),T=Fe(S),C=Fe("%"),N=Oe(),B=ue("p"),U=Fe("Cycle-friendliness: "),ie=Fe(ee),se=Fe("%"),Q=Oe(),K=ue("details"),pe=ue("summary"),pe.textContent="All network details",ve=Oe(),De=ue("p"),De.textContent="Fast/Direct network",he=Oe(),xe=ue("table"),be=ue("tr"),be.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ce=Oe();for(let wt=0;wt<ut.length;wt+=1)ut[wt].c();we=Oe(),ye=ue("p"),ye.textContent="Quiet/Indirect network",Ue=Oe(),qe=ue("table"),pt=ue("tr"),pt.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",St=Oe();for(let wt=0;wt<vt.length;wt+=1)vt[wt].c();Pn(e,"max-width","30vw"),Pn(e,"max-height","60vh"),Pn(e,"overflow","auto")},m(wt,ft){ae(wt,e,ft),Z(e,n),Z(n,r),Z(n,h),Z(e,m),Z(e,l),Z(l,x),Z(l,T),Z(l,C),Z(e,N),Z(e,B),Z(B,U),Z(B,ie),Z(B,se),Z(e,Q),Z(e,K),Z(K,pe),Z(K,ve),Z(K,De),Z(K,he),Z(K,xe),Z(xe,be),Z(xe,Ce);for(let xt=0;xt<ut.length;xt+=1)ut[xt]&&ut[xt].m(xe,null);Z(K,we),Z(K,ye),Z(K,Ue),Z(K,qe),Z(qe,pt),Z(qe,St);for(let xt=0;xt<vt.length;xt+=1)vt[xt]&&vt[xt].m(qe,null)},p(wt,ft){if(ft[0]&65552&&a!==(a=wt[16][wt[4]].toLocaleString()+"")&&Lt(h,a),ft[0]&65536&&S!==(S=wt[16].gradient+"")&&Lt(T,S),ft[0]&65536&&ee!==(ee=wt[16].quietness+"")&&Lt(ie,ee),ft[0]&65664){dt=qn(wt[7]);let xt;for(xt=0;xt<dt.length;xt+=1){const It=b0(wt,dt,xt);ut[xt]?ut[xt].p(It,ft):(ut[xt]=L0(It),ut[xt].c(),ut[xt].m(xe,null))}for(;xt<ut.length;xt+=1)ut[xt].d(1);ut.length=dt.length}if(ft[0]&65664){Bt=qn(wt[7]);let xt;for(xt=0;xt<Bt.length;xt+=1){const It=v0(wt,Bt,xt);vt[xt]?vt[xt].p(It,ft):(vt[xt]=M0(It),vt[xt].c(),vt[xt].m(qe,null))}for(;xt<vt.length;xt+=1)vt[xt].d(1);vt.length=Bt.length}},d(wt){wt&&oe(e),Er(ut,wt),Er(vt,wt)}}}function eT(s){let e,n;return e=new js({props:{openOn:"click",$$slots:{default:[QA,({props:r})=>({16:r}),({props:r})=>[r?65536:0]]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a[0]&65552|a[1]&1&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function tT(s){let e,n;return e=new _r({props:{sourceLayer:"rnet",paint:{"line-color":s[6],"line-width":td(s[4])},layout:{visibility:s[5]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[eT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a[0]&80&&(h.paint={"line-color":r[6],"line-width":td(r[4])}),a[0]&32&&(h.layout={visibility:r[5]?"visible":"none"}),a[0]&16|a[1]&1&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function nT(s){let e,n,r,a;return e=new to({props:{name:"route network",$$slots:{default:[JA]},$$scope:{ctx:s}}}),r=new Jp({props:{url:`pmtiles://${rd("route_network.pmtiles")}`,$$slots:{default:[tT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,m){const l={};m[0]&47|m[1]&1&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m[0]&112|m[1]&1&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function iT(s,e,n){let r,a,h=!1,m="all",l="bicycle_go_dutch",x="fastest",S="flow",T=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],C=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],N=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],B=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function U(){h=this.checked,n(5,h)}function ee(){m=eu(this),n(0,m),n(7,T)}function ie(){l=eu(this),n(1,l),n(8,C)}function se(){x=eu(this),n(2,x),n(9,N)}function Q(){S=eu(this),n(3,S),n(10,B)}return s.$$.update=()=>{s.$$.dirty[0]&7&&n(4,r=`${m}_${x}_${l}`),s.$$.dirty[0]&24&&n(6,a={none:"#304ce7",flow:nm(r),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:["step",["get","gradient"],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}[S])},[m,l,x,S,r,h,a,T,C,N,B,U,ee,ie,se,Q]}class rT extends fn{constructor(e){super(),hn(this,e,iT,nT,an,{},null,[-1,-1])}}function R0(s){let e,n,r,a,h,m,l,x,S,T,C;return{c(){e=ue("button"),e.textContent="Import core network",n=Oe(),r=ue("label"),a=ue("input"),h=Fe(`
      Show actual core network`),m=Oe(),l=ue("label"),x=ue("input"),S=Fe(`
      Show map-matched core network`),Ze(e,"class","outline"),Ze(a,"type","checkbox"),Ze(x,"type","checkbox"),Pn(l,"color","red")},m(N,B){ae(N,e,B),ae(N,n,B),ae(N,r,B),Z(r,a),a.checked=s[2],Z(r,h),ae(N,m,B),ae(N,l,B),Z(l,x),x.checked=s[3],Z(l,S),T||(C=[Rt(e,"click",s[5]),Rt(a,"change",s[7]),Rt(x,"change",s[8])],T=!0)},p(N,B){B&4&&(a.checked=N[2]),B&8&&(x.checked=N[3])},d(N){N&&(oe(e),oe(n),oe(r),oe(m),oe(l)),T=!1,Ki(C)}}}function sT(s){let e,n,r,a,h,m,l,x=s[0]&&R0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Core network`),a=Oe(),x&&x.c(),h=ni(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=s[0],Z(e,r),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",s[6]),m=!0)},p(S,T){T&1&&(n.checked=S[0]),S[0]?x?x.p(S,T):(x=R0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function oT(s){let e,n=s[11].all_fastest_bicycle_go_dutch+"",r;return{c(){e=Fe("Go Dutch value "),r=Fe(n)},m(a,h){ae(a,e,h),ae(a,r,h)},p(a,h){h&2048&&n!==(n=a[11].all_fastest_bicycle_go_dutch+"")&&Lt(r,n)},d(a){a&&(oe(e),oe(r))}}}function aT(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[oT,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function lT(s){let e,n;return e=new _r({props:{sourceLayer:"coherent_networks",paint:{"line-color":"black","line-width":2},layout:{visibility:s[0]&&s[2]?"visible":"none"},$$slots:{default:[aT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&5&&(h.layout={visibility:r[0]&&r[2]?"visible":"none"}),a&4096&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function P0(s){let e,n,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:fT,then:cT,catch:uT,value:10,blocks:[,,,]};return ms(n=s[4].renderCoreNetwork(),a),{c(){e=ni(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&16&&n!==(n=s[4].renderCoreNetwork())&&ms(n,a)||wl(a,s,m)},i(h){r||(_e(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}r=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function uT(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function cT(s){let e,n;return e=new rr({props:{data:s[10],generateId:!0,$$slots:{default:[hT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&16&&(h.data=r[10]),a&4105&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function hT(s){let e,n;return e=new _r({props:{paint:{"line-color":"red","line-width":10,"line-opacity":.5},layout:{visibility:s[0]&&s[3]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&9&&(h.layout={visibility:r[0]&&r[3]?"visible":"none"}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function fT(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function dT(s){let e,n,r,a,h,m;e=new to({props:{name:"core network",$$slots:{default:[sT]},$$scope:{ctx:s}}}),r=new Jp({props:{url:`pmtiles://${rd("core_network.pmtiles")}`,$$slots:{default:[lT]},$$scope:{ctx:s}}});let l=s[4]&&s[1]&&P0(s);return{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment),a=Oe(),l&&l.c(),h=ni()},m(x,S){it(e,x,S),ae(x,n,S),it(r,x,S),ae(x,a,S),l&&l.m(x,S),ae(x,h,S),m=!0},p(x,[S]){const T={};S&4109&&(T.$$scope={dirty:S,ctx:x}),e.$set(T);const C={};S&4101&&(C.$$scope={dirty:S,ctx:x}),r.$set(C),x[4]&&x[1]?l?(l.p(x,S),S&18&&_e(l,1)):(l=P0(x),l.c(),_e(l,1),l.m(h.parentNode,h)):l&&(zn(),Ie(l,1,1,()=>{l=null}),Fn())},i(x){m||(_e(e.$$.fragment,x),_e(r.$$.fragment,x),_e(l),m=!0)},o(x){Ie(e.$$.fragment,x),Ie(r.$$.fragment,x),Ie(l),m=!1},d(x){x&&(oe(n),oe(a),oe(h)),rt(e,x),rt(r,x),l&&l.d(x)}}}function pT(s,e,n){let r,a;Ft(s,Ph,B=>n(9,r=B)),Ft(s,sr,B=>n(4,a=B));let h=!1,m=!1,l=!0,x=!0;async function S(){if(a){let B=a.importCoreNetwork(),U=B==1?"route segment":"route segments";await Dh(),Nn(Ph,r+=1,r),window.alert(`Imported ${B} ${U}`)}}function T(){h=this.checked,n(0,h)}function C(){l=this.checked,n(2,l)}function N(){x=this.checked,n(3,x)}return s.$$.update=()=>{s.$$.dirty&1&&h&&n(1,m=!0)},[h,m,l,x,a,S,T,C,N]}class mT extends fn{constructor(e){super(),hn(this,e,pT,dT,an,{})}}function gT(s){let e,n;return e=new _r({props:{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function _T(s){let e,n;return e=new rr({props:{data:s[0],generateId:!0,$$slots:{default:[gT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,[a]){const h={};a&1&&(h.data=r[0]),a&32&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function yT(s,e,n){let r;Ft(s,sr,x=>n(3,r=x));let{kind:a}=e,{hovered:h}=e,m={type:"FeatureCollection",features:[]};async function l(x){r&&x?x.properties.reachable?n(0,m=await r.debugReachablePath(a,x.properties.idx)):n(0,m=await r.debugUnreachablePath(a,x.properties.idx)):n(0,m={type:"FeatureCollection",features:[]})}return s.$$set=x=>{"kind"in x&&n(1,a=x.kind),"hovered"in x&&n(2,h=x.hovered)},s.$$.update=()=>{s.$$.dirty&4&&l(h)},[m,a,h]}class im extends fn{constructor(e){super(),hn(this,e,yT,_T,an,{kind:1,hovered:2})}}function D0(s){let e,n,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=Ir(s[3],s[0].features.length)+"",C,N,B,U,ee,ie,se;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Oe(),r=ue("p"),h=Fe(a),m=Fe(" / "),x=Fe(l),S=Fe(" ("),C=Fe(T),N=Fe(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(Q,K){ae(Q,e,K),ae(Q,n,K),ae(Q,r,K),Z(r,h),Z(r,m),Z(r,x),Z(r,S),Z(r,C),Z(r,N),ae(Q,B,K),it(U,Q,K),ee=!0,ie||(se=Rt(e,"click",s[4]),ie=!0)},p(Q,K){(!ee||K&8)&&a!==(a=Q[3].toLocaleString()+"")&&Lt(h,a),(!ee||K&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Lt(x,l),(!ee||K&9)&&T!==(T=Ir(Q[3],Q[0].features.length)+"")&&Lt(C,T)},i(Q){ee||(_e(U.$$.fragment,Q),ee=!0)},o(Q){Ie(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(r),oe(B)),rt(U,Q),ie=!1,se()}}}function vT(s){let e,n,r,a,h,m,l,x,S=s[1]&&D0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Schools`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[1],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[5]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&_e(S,1)):(S=D0(T),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function bT(s){let e=s[8].name+"",n,r,a=s[8].kind+"",h,m,l=s[8].pupils+"",x,S,T=s[8].reachable?"is":"is not",C,N;return{c(){n=Fe(e),r=Fe(" is a "),h=Fe(a),m=Fe(" school with "),x=Fe(l),S=Fe(" pupils. It "),C=Fe(T),N=Fe(" reachable.")},m(B,U){ae(B,n,U),ae(B,r,U),ae(B,h,U),ae(B,m,U),ae(B,x,U),ae(B,S,U),ae(B,C,U),ae(B,N,U)},p(B,U){U&256&&e!==(e=B[8].name+"")&&Lt(n,e),U&256&&a!==(a=B[8].kind+"")&&Lt(h,a),U&256&&l!==(l=B[8].pupils+"")&&Lt(x,l),U&256&&T!==(T=B[8].reachable?"is":"is not")&&Lt(C,T)},d(B){B&&(oe(n),oe(r),oe(h),oe(m),oe(x),oe(S),oe(C),oe(N))}}}function xT(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[bT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function wT(s){let e,n,r;function a(m){s[6](m)}let h={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Cs(5,8)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[xT]},$$scope:{ctx:s}};return s[2]!==void 0&&(h.hovered=s[2]),e=new Yp({props:h}),Kn.push(()=>gr(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),r=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],mr(()=>n=!1)),e.$set(x)},i(m){r||(_e(e.$$.fragment,m),r=!0)},o(m){Ie(e.$$.fragment,m),r=!1},d(m){rt(e,m)}}}function kT(s){let e,n,r,a,h,m;return e=new to({props:{name:"schools",$$slots:{default:[vT]},$$scope:{ctx:s}}}),r=new rr({props:{data:s[0],generateId:!0,$$slots:{default:[wT]},$$scope:{ctx:s}}}),h=new im({props:{kind:"schools",hovered:s[2]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){it(e,l,x),ae(l,n,x),it(r,l,x),ae(l,a,x),it(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),r.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(_e(e.$$.fragment,l),_e(r.$$.fragment,l),_e(h.$$.fragment,l),m=!0)},o(l){Ie(e.$$.fragment,l),Ie(r.$$.fragment,l),Ie(h.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),rt(e,l),rt(r,l),rt(h,l)}}}function IT(s,e,n){let r,a,h;Ft(s,Xf,C=>n(1,a=C)),Ft(s,sr,C=>n(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&n(0,m=await h.getSchools())}function S(){a=this.checked,Xf.set(a)}function T(C){l=C,n(2,l)}return s.$$.update=()=>{s.$$.dirty&3&&a&&m.features.length==0&&x(),s.$$.dirty&1&&n(3,r=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,r,x,S,T]}class ST extends fn{constructor(e){super(),hn(this,e,IT,kT,an,{})}}function N0(s){let e,n,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=Ir(s[3],s[0].features.length)+"",C,N,B,U,ee,ie,se;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Oe(),r=ue("p"),h=Fe(a),m=Fe(" / "),x=Fe(l),S=Fe(" ("),C=Fe(T),N=Fe(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(Q,K){ae(Q,e,K),ae(Q,n,K),ae(Q,r,K),Z(r,h),Z(r,m),Z(r,x),Z(r,S),Z(r,C),Z(r,N),ae(Q,B,K),it(U,Q,K),ee=!0,ie||(se=Rt(e,"click",s[4]),ie=!0)},p(Q,K){(!ee||K&8)&&a!==(a=Q[3].toLocaleString()+"")&&Lt(h,a),(!ee||K&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Lt(x,l),(!ee||K&9)&&T!==(T=Ir(Q[3],Q[0].features.length)+"")&&Lt(C,T)},i(Q){ee||(_e(U.$$.fragment,Q),ee=!0)},o(Q){Ie(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(r),oe(B)),rt(U,Q),ie=!1,se()}}}function ET(s){let e,n,r,a,h,m,l,x,S=s[1]&&N0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Town centres`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[1],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[5]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&_e(S,1)):(S=N0(T),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function AT(s){let e,n=(s[8].name||"")+"",r,a,h=s[8].reachable?"is":"is not",m,l;return{c(){e=Fe("Town centre "),r=Fe(n),a=Oe(),m=Fe(h),l=Fe(" reachable.")},m(x,S){ae(x,e,S),ae(x,r,S),ae(x,a,S),ae(x,m,S),ae(x,l,S)},p(x,S){S&256&&n!==(n=(x[8].name||"")+"")&&Lt(r,n),S&256&&h!==(h=x[8].reachable?"is":"is not")&&Lt(m,h)},d(x){x&&(oe(e),oe(r),oe(a),oe(m),oe(l))}}}function TT(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[AT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function CT(s){let e,n,r;function a(m){s[6](m)}let h={manageHoverState:!0,paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":Cs(.7,.9)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[TT]},$$scope:{ctx:s}};return s[2]!==void 0&&(h.hovered=s[2]),e=new mc({props:h}),Kn.push(()=>gr(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),r=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],mr(()=>n=!1)),e.$set(x)},i(m){r||(_e(e.$$.fragment,m),r=!0)},o(m){Ie(e.$$.fragment,m),r=!1},d(m){rt(e,m)}}}function LT(s){let e,n,r,a,h,m;return e=new to({props:{name:"town centres",$$slots:{default:[ET]},$$scope:{ctx:s}}}),r=new rr({props:{data:s[0],generateId:!0,$$slots:{default:[CT]},$$scope:{ctx:s}}}),h=new im({props:{kind:"town_centres",hovered:s[2]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){it(e,l,x),ae(l,n,x),it(r,l,x),ae(l,a,x),it(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),r.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(_e(e.$$.fragment,l),_e(r.$$.fragment,l),_e(h.$$.fragment,l),m=!0)},o(l){Ie(e.$$.fragment,l),Ie(r.$$.fragment,l),Ie(h.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),rt(e,l),rt(r,l),rt(h,l)}}}function MT(s,e,n){let r,a,h;Ft(s,Kf,C=>n(1,a=C)),Ft(s,sr,C=>n(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&n(0,m=await h.getTownCentres())}function S(){a=this.checked,Kf.set(a)}function T(C){l=C,n(2,l)}return s.$$.update=()=>{s.$$.dirty&3&&a&&m.features.length==0&&x(),s.$$.dirty&1&&n(3,r=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,r,x,S,T]}class RT extends fn{constructor(e){super(),hn(this,e,MT,LT,an,{})}}function z0(s){let e,n,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=Ir(s[3],s[0].features.length)+"",C,N,B,U,ee,ie,se;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Oe(),r=ue("p"),h=Fe(a),m=Fe(" / "),x=Fe(l),S=Fe(" ("),C=Fe(T),N=Fe(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(Q,K){ae(Q,e,K),ae(Q,n,K),ae(Q,r,K),Z(r,h),Z(r,m),Z(r,x),Z(r,S),Z(r,C),Z(r,N),ae(Q,B,K),it(U,Q,K),ee=!0,ie||(se=Rt(e,"click",s[4]),ie=!0)},p(Q,K){(!ee||K&8)&&a!==(a=Q[3].toLocaleString()+"")&&Lt(h,a),(!ee||K&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Lt(x,l),(!ee||K&9)&&T!==(T=Ir(Q[3],Q[0].features.length)+"")&&Lt(C,T)},i(Q){ee||(_e(U.$$.fragment,Q),ee=!0)},o(Q){Ie(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(r),oe(B)),rt(U,Q),ie=!1,se()}}}function PT(s){let e,n,r,a,h,m,l,x,S=s[1]&&z0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    GPs and hospitals`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[1],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[5]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&_e(S,1)):(S=z0(T),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function DT(s){let e=s[8].name+"",n,r,a=s[8].kind+"",h,m,l=s[8].reachable?"is":"is not",x,S;return{c(){n=Fe(e),r=Fe(" is a "),h=Fe(a),m=Fe(". It "),x=Fe(l),S=Fe(" reachable.")},m(T,C){ae(T,n,C),ae(T,r,C),ae(T,h,C),ae(T,m,C),ae(T,x,C),ae(T,S,C)},p(T,C){C&256&&e!==(e=T[8].name+"")&&Lt(n,e),C&256&&a!==(a=T[8].kind+"")&&Lt(h,a),C&256&&l!==(l=T[8].reachable?"is":"is not")&&Lt(x,l)},d(T){T&&(oe(n),oe(r),oe(h),oe(m),oe(x),oe(S))}}}function NT(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[DT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function zT(s){let e,n,r;function a(m){s[6](m)}let h={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Cs(5,8)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[NT]},$$scope:{ctx:s}};return s[2]!==void 0&&(h.hovered=s[2]),e=new Yp({props:h}),Kn.push(()=>gr(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),r=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],mr(()=>n=!1)),e.$set(x)},i(m){r||(_e(e.$$.fragment,m),r=!0)},o(m){Ie(e.$$.fragment,m),r=!1},d(m){rt(e,m)}}}function FT(s){let e,n,r,a,h,m;return e=new to({props:{name:"gp hospitals",$$slots:{default:[PT]},$$scope:{ctx:s}}}),r=new rr({props:{data:s[0],generateId:!0,$$slots:{default:[zT]},$$scope:{ctx:s}}}),h=new im({props:{kind:"gp_hospitals",hovered:s[2]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){it(e,l,x),ae(l,n,x),it(r,l,x),ae(l,a,x),it(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),r.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(_e(e.$$.fragment,l),_e(r.$$.fragment,l),_e(h.$$.fragment,l),m=!0)},o(l){Ie(e.$$.fragment,l),Ie(r.$$.fragment,l),Ie(h.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),rt(e,l),rt(r,l),rt(h,l)}}}function OT(s,e,n){let r,a,h;Ft(s,Wf,C=>n(1,a=C)),Ft(s,sr,C=>n(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&n(0,m=await h.getGpHospitals())}function S(){a=this.checked,Wf.set(a)}function T(C){l=C,n(2,l)}return s.$$.update=()=>{s.$$.dirty&3&&a&&m.features.length==0&&x(),s.$$.dirty&1&&n(3,r=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,r,x,S,T]}class BT extends fn{constructor(e){super(),hn(this,e,OT,FT,an,{})}}function UT(s){let e,n,r,a,h;return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Urban areas`),Ze(n,"type","checkbox")},m(m,l){ae(m,e,l),Z(e,n),n.checked=s[0],Z(e,r),a||(h=Rt(n,"change",s[1]),a=!0)},p(m,l){l&1&&(n.checked=m[0])},d(m){m&&oe(e),a=!1,h()}}}function jT(s){let e,n;return e=new mc({props:{sourceLayer:"urban_areas",manageHoverState:!0,paint:{"fill-color":"black","fill-opacity":Cs(1,.5)},layout:{visibility:s[0]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function qT(s){let e,n,r,a;return e=new to({props:{name:"urban areas",$$slots:{default:[UT]},$$scope:{ctx:s}}}),r=new Jp({props:{url:`pmtiles://${rd("urban_areas.pmtiles")}`,$$slots:{default:[jT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,[m]){const l={};m&5&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&5&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function VT(s,e,n){let r=!1;function a(){r=this.checked,n(0,r)}return[r,a]}class GT extends fn{constructor(e){super(),hn(this,e,VT,qT,an,{})}}function F0(s){let e,n,r,a,h,m;return r=new _c({props:{colors:s[3]}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Oe(),ot(r.$$.fragment),Ze(e,"class","outline")},m(l,x){ae(l,e,x),ae(l,n,x),it(r,l,x),a=!0,h||(m=Rt(e,"click",s[2]),h=!0)},p:tt,i(l){a||(_e(r.$$.fragment,l),a=!0)},o(l){Ie(r.$$.fragment,l),a=!1},d(l){l&&(oe(e),oe(n)),rt(r,l),h=!1,m()}}}function ZT(s){let e,n,r,a,h,m,l,x,S=s[0]&&F0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Reachable network`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[0],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[4]),l=!0)},p(T,C){C&1&&(n.checked=T[0]),T[0]?S?(S.p(T,C),C&1&&_e(S,1)):(S=F0(T),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function HT(s){let e,n;return e=new _r({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":Cs(5,7),"line-color":Xp(["get","kind"],s[3],"black"),"line-opacity":.8},manageHoverState:!0}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function XT(s){let e,n,r,a;return e=new to({props:{name:"reachable network",$$slots:{default:[ZT]},$$scope:{ctx:s}}}),r=new rr({props:{data:s[1],generateId:!0,$$slots:{default:[HT]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,[m]){const l={};m&65&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.data=h[1]),m&65&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function WT(s,e,n){let r;Ft(s,sr,S=>n(5,r=S));let a=!1,h={type:"FeatureCollection",features:[]};async function m(){n(1,h=await r.renderReachableNetwork())}let l={network:"green",reachable:"purple",severance:"red"};function x(){a=this.checked,n(0,a)}return s.$$.update=()=>{s.$$.dirty&3&&a&&h.features.length==0&&m()},[a,h,m,l,x]}class KT extends fn{constructor(e){super(),hn(this,e,WT,XT,an,{})}}function O0(s){let e,n;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function $T(s){let e,n,r,a,h,m,l,x,S=s[0]&&O0();return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Level of Service`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[0],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[3]),l=!0)},p(T,C){C&1&&(n.checked=T[0]),T[0]?S?C&1&&_e(S,1):(S=O0(),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function B0(s){let e,n,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:nC,then:JT,catch:YT,value:4,blocks:[,,,]};return ms(n=s[2].renderLevelOfService(),a),{c(){e=ni(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&4&&n!==(n=s[2].renderLevelOfService())&&ms(n,a)||wl(a,s,m)},i(h){r||(_e(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}r=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function YT(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function JT(s){let e,n;return e=new rr({props:{data:s[4],generateId:!0,$$slots:{default:[tC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&4&&(h.data=r[4]),a&65&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function QT(s){let e,n,r,a,h,m=s[5].los+"",l,x,S,T,C,N,B=ou[s[5].infra_type][0]+"",U,ee,ie,se,Q,K,pe=s[5].speed+"",ve,De,he,xe,be,Ce,we=s[5].traffic.toLocaleString()+"",ye;return{c(){e=ue("table"),n=ue("tr"),r=ue("th"),r.textContent="Level of Service",a=Oe(),h=ue("td"),l=Fe(m),x=Oe(),S=ue("tr"),T=ue("th"),T.textContent="Infrastructure type",C=Oe(),N=ue("td"),U=Fe(B),ee=Oe(),ie=ue("tr"),se=ue("th"),se.textContent="Speed (mph)",Q=Oe(),K=ue("td"),ve=Fe(pe),De=Oe(),he=ue("tr"),xe=ue("th"),xe.textContent="Estimated daily traffic volume",be=Oe(),Ce=ue("td"),ye=Fe(we)},m(Ue,qe){ae(Ue,e,qe),Z(e,n),Z(n,r),Z(n,a),Z(n,h),Z(h,l),Z(e,x),Z(e,S),Z(S,T),Z(S,C),Z(S,N),Z(N,U),Z(e,ee),Z(e,ie),Z(ie,se),Z(ie,Q),Z(ie,K),Z(K,ve),Z(e,De),Z(e,he),Z(he,xe),Z(he,be),Z(he,Ce),Z(Ce,ye)},p(Ue,qe){qe&32&&m!==(m=Ue[5].los+"")&&Lt(l,m),qe&32&&B!==(B=ou[Ue[5].infra_type][0]+"")&&Lt(U,B),qe&32&&pe!==(pe=Ue[5].speed+"")&&Lt(ve,pe),qe&32&&we!==(we=Ue[5].traffic.toLocaleString()+"")&&Lt(ye,we)},d(Ue){Ue&&oe(e)}}}function eC(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[QT,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&96&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function tC(s){let e,n;return e=new _r({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":Cs(5,7),"line-color":Op,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[eC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),a&64&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function nC(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function iC(s){let e,n,r,a;e=new to({props:{name:"level of service",$$slots:{default:[$T]},$$scope:{ctx:s}}});let h=s[2]&&s[1]&&B0(s);return{c(){ot(e.$$.fragment),n=Oe(),h&&h.c(),r=ni()},m(m,l){it(e,m,l),ae(m,n,l),h&&h.m(m,l),ae(m,r,l),a=!0},p(m,[l]){const x={};l&65&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?h?(h.p(m,l),l&6&&_e(h,1)):(h=B0(m),h.c(),_e(h,1),h.m(r.parentNode,r)):h&&(zn(),Ie(h,1,1,()=>{h=null}),Fn())},i(m){a||(_e(e.$$.fragment,m),_e(h),a=!0)},o(m){Ie(e.$$.fragment,m),Ie(h),a=!1},d(m){m&&(oe(n),oe(r)),rt(e,m),h&&h.d(m)}}}function rC(s,e,n){let r;Ft(s,sr,l=>n(2,r=l));let a=!1,h=!1;function m(){a=this.checked,n(0,a)}return s.$$.update=()=>{s.$$.dirty&1&&a&&n(1,h=!0)},[a,h,r,m]}class sC extends fn{constructor(e){super(),hn(this,e,rC,iC,an,{})}}function U0(s){let e,n;return e=new Qp({props:{colorScale:s[3],limits:s[4]}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function oC(s){let e,n,r,a,h,m,l,x,S=s[0]&&U0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Estimated traffic volume`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[0],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[5]),l=!0)},p(T,C){C&1&&(n.checked=T[0]),T[0]?S?(S.p(T,C),C&1&&_e(S,1)):(S=U0(T),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function j0(s){let e,n,r,a={ctx:s,current:null,token:null,hasCatch:!1,pending:fC,then:lC,catch:aC,value:6,blocks:[,,,]};return ms(n=s[2].renderLevelOfService(),a),{c(){e=ni(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(h,m){s=h,a.ctx=s,m&4&&n!==(n=s[2].renderLevelOfService())&&ms(n,a)||wl(a,s,m)},i(h){r||(_e(a.block),r=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}r=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function aC(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function lC(s){let e,n;return e=new rr({props:{data:s[6],generateId:!0,$$slots:{default:[hC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&4&&(h.data=r[6]),a&257&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function uC(s){let e,n=s[7].traffic.toLocaleString()+"",r;return{c(){e=ue("p"),r=Fe(n)},m(a,h){ae(a,e,h),Z(e,r)},p(a,h){h&128&&n!==(n=a[7].traffic.toLocaleString()+"")&&Lt(r,n)},d(a){a&&oe(e)}}}function cC(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[uC,({props:r})=>({7:r}),({props:r})=>r?128:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&384&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function hC(s){let e,n;return e=new _r({props:{layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":Gf(["get","traffic"],s[4],[1,2,3]),"line-color":Gf(["get","traffic"],s[4],s[3]),"line-opacity":.8},manageHoverState:!0,$$slots:{default:[cC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.layout={visibility:r[0]?"visible":"none"}),a&256&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function fC(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function dC(s){let e,n,r,a;e=new to({props:{name:"traffic volume",$$slots:{default:[oC]},$$scope:{ctx:s}}});let h=s[2]&&s[1]&&j0(s);return{c(){ot(e.$$.fragment),n=Oe(),h&&h.c(),r=ni()},m(m,l){it(e,m,l),ae(m,n,l),h&&h.m(m,l),ae(m,r,l),a=!0},p(m,[l]){const x={};l&257&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?h?(h.p(m,l),l&6&&_e(h,1)):(h=j0(m),h.c(),_e(h,1),h.m(r.parentNode,r)):h&&(zn(),Ie(h,1,1,()=>{h=null}),Fn())},i(m){a||(_e(e.$$.fragment,m),_e(h),a=!0)},o(m){Ie(e.$$.fragment,m),Ie(h),a=!1},d(m){m&&(oe(n),oe(r)),rt(e,m),h&&h.d(m)}}}function pC(s,e,n){let r;Ft(s,sr,S=>n(2,r=S));let a=!1,h=!1,m=["#27918d","#ffaa33","#440154"],l=[0,2e3,4e3,1e4];function x(){a=this.checked,n(0,a)}return s.$$.update=()=>{s.$$.dirty&1&&a&&n(1,h=!0)},[a,h,r,m,l,x]}class mC extends fn{constructor(e){super(),hn(this,e,pC,dC,an,{})}}function q0(s){let e,n,r,a,h,m=s[3].toLocaleString()+"",l,x,S=s[0].features.length.toLocaleString()+"",T,C,N=s[2].toLocaleString()+"",B,U,ee=s[4].toLocaleString()+"",ie,se,Q=Ir(s[2],s[4])+"",K,pe,ve,De,he,xe,be,Ce,we;return De=new Qp({props:{colorScale:s[6],limits:s[7]}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Oe(),r=ue("p"),r.textContent="Only the top 20%ile most deprived zones are shown",a=Oe(),h=ue("p"),l=Fe(m),x=Fe(" / "),T=Fe(S),C=Fe(` zones
      reachable. That's `),B=Fe(N),U=Fe(" / "),ie=Fe(ee),se=Fe(`
      (`),K=Fe(Q),pe=Fe(") of the population."),ve=Oe(),ot(De.$$.fragment),he=Oe(),xe=ue("p"),xe.textContent=`Darker colours are more deprived. Zones with a red outline are not
      reachable by the current network.`,Ze(e,"class","outline")},m(ye,Ue){ae(ye,e,Ue),ae(ye,n,Ue),ae(ye,r,Ue),ae(ye,a,Ue),ae(ye,h,Ue),Z(h,l),Z(h,x),Z(h,T),Z(h,C),Z(h,B),Z(h,U),Z(h,ie),Z(h,se),Z(h,K),Z(h,pe),ae(ye,ve,Ue),it(De,ye,Ue),ae(ye,he,Ue),ae(ye,xe,Ue),be=!0,Ce||(we=Rt(e,"click",s[5]),Ce=!0)},p(ye,Ue){(!be||Ue&8)&&m!==(m=ye[3].toLocaleString()+"")&&Lt(l,m),(!be||Ue&1)&&S!==(S=ye[0].features.length.toLocaleString()+"")&&Lt(T,S),(!be||Ue&4)&&N!==(N=ye[2].toLocaleString()+"")&&Lt(B,N),(!be||Ue&16)&&ee!==(ee=ye[4].toLocaleString()+"")&&Lt(ie,ee),(!be||Ue&20)&&Q!==(Q=Ir(ye[2],ye[4])+"")&&Lt(K,Q)},i(ye){be||(_e(De.$$.fragment,ye),be=!0)},o(ye){Ie(De.$$.fragment,ye),be=!1},d(ye){ye&&(oe(e),oe(n),oe(r),oe(a),oe(h),oe(ve),oe(he),oe(xe)),rt(De,ye),Ce=!1,we()}}}function gC(s){let e,n,r,a,h,m,l,x,S=s[1]&&q0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    SIMD`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[1],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[8]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&_e(S,1)):(S=q0(T),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function _C(s){let e,n,r=s[10].id+"",a,h,m=s[10].reachable?"is":"is not",l,x,S=s[10].population.toLocaleString()+"",T,C,N=s[10].imd_rank+"",B,U,ee=s[10].imd_percentile+"",ie,se;return{c(){e=ue("p"),n=Fe("Data zone "),a=Fe(r),h=Oe(),l=Fe(m),x=Fe(" reachable. It has "),T=Fe(S),C=Fe(`
        people, and a SIMD rank of `),B=Fe(N),U=Fe(", putting it in the "),ie=Fe(ee),se=Fe(`
        percentile.`)},m(Q,K){ae(Q,e,K),Z(e,n),Z(e,a),Z(e,h),Z(e,l),Z(e,x),Z(e,T),Z(e,C),Z(e,B),Z(e,U),Z(e,ie),Z(e,se)},p(Q,K){K&1024&&r!==(r=Q[10].id+"")&&Lt(a,r),K&1024&&m!==(m=Q[10].reachable?"is":"is not")&&Lt(l,m),K&1024&&S!==(S=Q[10].population.toLocaleString()+"")&&Lt(T,S),K&1024&&N!==(N=Q[10].imd_rank+"")&&Lt(B,N),K&1024&&ee!==(ee=Q[10].imd_percentile+"")&&Lt(ie,ee)},d(Q){Q&&oe(e)}}}function yC(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[_C,({props:r})=>({10:r}),({props:r})=>r?1024:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&3072&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function vC(s){let e,n,r,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","imd_percentile"],s[7],s[6]),"fill-opacity":Cs(.7,.9)},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[yC]},$$scope:{ctx:s}}}),r=new _r({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:s[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,m){const l={};m&2&&(l.layout={visibility:h[1]?"visible":"none"}),m&2048&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.layout={visibility:h[1]?"visible":"none"}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function bC(s){let e,n,r,a;return e=new to({props:{name:"simd",$$slots:{default:[gC]},$$scope:{ctx:s}}}),r=new rr({props:{data:s[0],generateId:!0,$$slots:{default:[vC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,[m]){const l={};m&2079&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&2050&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function xC(s,e,n){let r,a,h,m,l;Ft(s,$f,B=>n(1,m=B)),Ft(s,sr,B=>n(9,l=B));let x={type:"FeatureCollection",features:[]};async function S(){if(l){let B=await l.getDataZones();B.features=B.features.filter(U=>U.properties.imd_percentile<=20),n(0,x=B)}}let T=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],C=[0,4,8,12,16,20];function N(){m=this.checked,$f.set(m)}return s.$$.update=()=>{s.$$.dirty&3&&m&&x.features.length==0&&S(),s.$$.dirty&1&&n(4,r=ed(x.features.map(B=>B.properties.population))),s.$$.dirty&1&&n(3,a=x.features.filter(B=>B.properties.reachable).length),s.$$.dirty&1&&n(2,h=ed(x.features.filter(B=>B.properties.reachable).map(B=>B.properties.population)))},[x,m,h,a,r,S,T,C,N]}class wC extends fn{constructor(e){super(),hn(this,e,xC,bC,an,{})}}function V0(s){let e,n,r,a=s[3].toLocaleString()+"",h,m,l=s[0].features.length.toLocaleString()+"",x,S,T=s[2].toLocaleString()+"",C,N,B=s[4].toLocaleString()+"",U,ee,ie=Ir(s[2],s[4])+"",se,Q,K,pe,ve,De,he,xe,be;return pe=new Qp({props:{colorScale:s[6],limits:s[7]}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Oe(),r=ue("p"),h=Fe(a),m=Fe(" / "),x=Fe(l),S=Fe(` zones
      reachable. That's `),C=Fe(T),N=Fe(" / "),U=Fe(B),ee=Fe(`
      (`),se=Fe(ie),Q=Fe(") of the population."),K=Oe(),ot(pe.$$.fragment),ve=Oe(),De=ue("p"),De.textContent=`Darker colours are denser. Zones with a red outline are not reachable by
      the current network. Only the top 3 densest quintiles are shown.`,Ze(e,"class","outline")},m(Ce,we){ae(Ce,e,we),ae(Ce,n,we),ae(Ce,r,we),Z(r,h),Z(r,m),Z(r,x),Z(r,S),Z(r,C),Z(r,N),Z(r,U),Z(r,ee),Z(r,se),Z(r,Q),ae(Ce,K,we),it(pe,Ce,we),ae(Ce,ve,we),ae(Ce,De,we),he=!0,xe||(be=Rt(e,"click",s[5]),xe=!0)},p(Ce,we){(!he||we&8)&&a!==(a=Ce[3].toLocaleString()+"")&&Lt(h,a),(!he||we&1)&&l!==(l=Ce[0].features.length.toLocaleString()+"")&&Lt(x,l),(!he||we&4)&&T!==(T=Ce[2].toLocaleString()+"")&&Lt(C,T),(!he||we&16)&&B!==(B=Ce[4].toLocaleString()+"")&&Lt(U,B),(!he||we&20)&&ie!==(ie=Ir(Ce[2],Ce[4])+"")&&Lt(se,ie)},i(Ce){he||(_e(pe.$$.fragment,Ce),he=!0)},o(Ce){Ie(pe.$$.fragment,Ce),he=!1},d(Ce){Ce&&(oe(e),oe(n),oe(r),oe(K),oe(ve),oe(De)),rt(pe,Ce),xe=!1,be()}}}function kC(s){let e,n,r,a,h,m,l,x,S=s[1]&&V0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    Population`),a=Oe(),S&&S.c(),h=ni(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=s[1],Z(e,r),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",s[9]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&_e(S,1)):(S=V0(T),S.c(),_e(S,1),S.m(h.parentNode,h)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){m||(_e(S),m=!0)},o(T){Ie(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function IC(s){let e,n,r=s[11].id+"",a,h,m=s[11].reachable?"is":"is not",l,x,S=s[11].population.toLocaleString()+"",T,C,N=Math.round(s[11].population/s[11].area_km2).toLocaleString()+"",B,U,ee=s[11].density_quintile+"",ie,se;return{c(){e=ue("p"),n=Fe("Data zone "),a=Fe(r),h=Oe(),l=Fe(m),x=Fe(" reachable. It has "),T=Fe(S),C=Fe(`
        people, with a density of `),B=Fe(N),U=Fe(" people per square kilometer, putting it in quintile "),ie=Fe(ee),se=Fe(`
        for this study area.`),Pn(e,"max-width","30vw")},m(Q,K){ae(Q,e,K),Z(e,n),Z(e,a),Z(e,h),Z(e,l),Z(e,x),Z(e,T),Z(e,C),Z(e,B),Z(e,U),Z(e,ie),Z(e,se)},p(Q,K){K&2048&&r!==(r=Q[11].id+"")&&Lt(a,r),K&2048&&m!==(m=Q[11].reachable?"is":"is not")&&Lt(l,m),K&2048&&S!==(S=Q[11].population.toLocaleString()+"")&&Lt(T,S),K&2048&&N!==(N=Math.round(Q[11].population/Q[11].area_km2).toLocaleString()+"")&&Lt(B,N),K&2048&&ee!==(ee=Q[11].density_quintile+"")&&Lt(ie,ee)},d(Q){Q&&oe(e)}}}function SC(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[IC,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function EC(s){let e,n,r,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","density_quintile"],s[7],s[6]),"fill-opacity":s[8]},layout:{visibility:s[1]?"visible":"none"},$$slots:{default:[SC]},$$scope:{ctx:s}}}),r=new _r({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:s[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,m){const l={};m&2&&(l.layout={visibility:h[1]?"visible":"none"}),m&4096&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.layout={visibility:h[1]?"visible":"none"}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function AC(s){let e,n,r,a;return e=new to({props:{name:"population density",$$slots:{default:[kC]},$$scope:{ctx:s}}}),r=new rr({props:{data:s[0],generateId:!0,$$slots:{default:[EC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,[m]){const l={};m&4127&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&4098&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function TC(s,e,n){let r,a,h,m,l;Ft(s,Yf,U=>n(1,m=U)),Ft(s,sr,U=>n(10,l=U));let x={type:"FeatureCollection",features:[]};async function S(){l&&n(0,x=await l.getDataZones())}let T=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],C=[0,1,2,3,4,5],N=Cs(["case",["<",["get","density_quintile"],4],.5,0],.9);function B(){m=this.checked,Yf.set(m)}return s.$$.update=()=>{s.$$.dirty&3&&m&&x.features.length==0&&S(),s.$$.dirty&1&&n(4,r=ed(x.features.map(U=>U.properties.population))),s.$$.dirty&1&&n(3,a=x.features.filter(U=>U.properties.reachable).length),s.$$.dirty&1&&n(2,h=ed(x.features.filter(U=>U.properties.reachable).map(U=>U.properties.population)))},[x,m,h,a,r,S,T,C,N,B]}class CC extends fn{constructor(e){super(),hn(this,e,TC,AC,an,{})}}function G0(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe=s[0].total_quintile_sums.length>0&&Z0(s);return{c(){e=ue("div"),n=ue("button"),n.textContent="Recalculate",r=Oe(),a=ue("label"),h=ue("input"),m=Fe(`
        Only show routes covered by current edits`),l=Oe(),x=ue("label"),S=Fe(`Only show quintile:
        `),T=ue("select"),C=ue("option"),C.textContent="Show all",N=ue("option"),N.textContent="1",B=ue("option"),B.textContent="2",U=ue("option"),U.textContent="3",ee=ue("option"),ee.textContent="4",ie=ue("option"),ie.textContent="5",se=Oe(),pe&&pe.c(),Ze(n,"class","outline"),Ze(h,"type","checkbox"),C.__value="",qi(C,C.__value),N.__value="1",qi(N,N.__value),B.__value="2",qi(B,B.__value),U.__value="3",qi(U,U.__value),ee.__value="4",qi(ee,ee.__value),ie.__value="5",qi(ie,ie.__value),s[3]===void 0&&ra(()=>s[7].call(T)),Pn(e,"border","1px solid black"),Pn(e,"padding","4px")},m(ve,De){ae(ve,e,De),Z(e,n),Z(e,r),Z(e,a),Z(a,h),h.checked=s[2],Z(a,m),Z(e,l),Z(e,x),Z(x,S),Z(x,T),Z(T,C),Z(T,N),Z(T,B),Z(T,U),Z(T,ee),Z(T,ie),Us(T,s[3],!0),Z(e,se),pe&&pe.m(e,null),Q||(K=[Rt(n,"click",s[4]),Rt(h,"change",s[6]),Rt(T,"change",s[7])],Q=!0)},p(ve,De){De&4&&(h.checked=ve[2]),De&8&&Us(T,ve[3]),ve[0].total_quintile_sums.length>0?pe?pe.p(ve,De):(pe=Z0(ve),pe.c(),pe.m(e,null)):pe&&(pe.d(1),pe=null)},d(ve){ve&&oe(e),pe&&pe.d(),Q=!1,Ki(K)}}}function Z0(s){let e,n,r,a,h,m=Ir(s[0].covered_quintile_sums[0],s[0].total_quintile_sums[0])+"",l,x,S,T,C=Ir(s[0].covered_quintile_sums[1],s[0].total_quintile_sums[1])+"",N,B,U,ee,ie=Ir(s[0].covered_quintile_sums[2],s[0].total_quintile_sums[2])+"",se,Q,K,pe,ve=Ir(s[0].covered_quintile_sums[3],s[0].total_quintile_sums[3])+"",De,he,xe,be,Ce=Ir(s[0].covered_quintile_sums[4],s[0].total_quintile_sums[4])+"",we;return{c(){e=ue("p"),e.textContent="Flow covered by current edits",n=Oe(),r=ue("ul"),a=ue("li"),h=Fe("Quintile 1: "),l=Fe(m),x=Oe(),S=ue("li"),T=Fe("Quintile 2: "),N=Fe(C),B=Oe(),U=ue("li"),ee=Fe("Quintile 3: "),se=Fe(ie),Q=Oe(),K=ue("li"),pe=Fe("Quintile 4: "),De=Fe(ve),he=Oe(),xe=ue("li"),be=Fe("Quintile 5: "),we=Fe(Ce)},m(ye,Ue){ae(ye,e,Ue),ae(ye,n,Ue),ae(ye,r,Ue),Z(r,a),Z(a,h),Z(a,l),Z(r,x),Z(r,S),Z(S,T),Z(S,N),Z(r,B),Z(r,U),Z(U,ee),Z(U,se),Z(r,Q),Z(r,K),Z(K,pe),Z(K,De),Z(r,he),Z(r,xe),Z(xe,be),Z(xe,we)},p(ye,Ue){Ue&1&&m!==(m=Ir(ye[0].covered_quintile_sums[0],ye[0].total_quintile_sums[0])+"")&&Lt(l,m),Ue&1&&C!==(C=Ir(ye[0].covered_quintile_sums[1],ye[0].total_quintile_sums[1])+"")&&Lt(N,C),Ue&1&&ie!==(ie=Ir(ye[0].covered_quintile_sums[2],ye[0].total_quintile_sums[2])+"")&&Lt(se,ie),Ue&1&&ve!==(ve=Ir(ye[0].covered_quintile_sums[3],ye[0].total_quintile_sums[3])+"")&&Lt(De,ve),Ue&1&&Ce!==(Ce=Ir(ye[0].covered_quintile_sums[4],ye[0].total_quintile_sums[4])+"")&&Lt(we,Ce)},d(ye){ye&&(oe(e),oe(n),oe(r))}}}function LC(s){let e,n,r,a,h,m,l,x=s[1]&&G0(s);return{c(){e=ue("label"),n=ue("input"),r=Fe(`
    High NPT route coverage`),a=Oe(),x&&x.c(),h=ni(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=s[1],Z(e,r),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",s[5]),m=!0)},p(S,T){T&2&&(n.checked=S[1]),S[1]?x?x.p(S,T):(x=G0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function MC(s){let e,n=s[9].flow.toLocaleString()+"",r,a,h=s[9].quintile+"",m,l,x=s[9].covered+"",S;return{c(){e=Fe("Flow "),r=Fe(n),a=Fe(" is in quintile "),m=Fe(h),l=Fe(`,
      covered `),S=Fe(x)},m(T,C){ae(T,e,C),ae(T,r,C),ae(T,a,C),ae(T,m,C),ae(T,l,C),ae(T,S,C)},p(T,C){C&512&&n!==(n=T[9].flow.toLocaleString()+"")&&Lt(r,n),C&512&&h!==(h=T[9].quintile+"")&&Lt(m,h),C&512&&x!==(x=T[9].covered+"")&&Lt(S,x)},d(T){T&&(oe(e),oe(r),oe(a),oe(m),oe(l),oe(S))}}}function RC(s){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[MC,({props:r})=>({9:r}),({props:r})=>r?512:0]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1536&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function PC(s){let e,n;return e=new _r({props:{layout:{visibility:s[1]?"visible":"none"},filter:H0(s[2],s[3]),paint:{"line-width":td("flow"),"line-color":nm("flow")},$$slots:{default:[RC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&2&&(h.layout={visibility:r[1]?"visible":"none"}),a&12&&(h.filter=H0(r[2],r[3])),a&1024&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function DC(s){let e,n,r,a;return e=new to({props:{name:"high npt route coverage",$$slots:{default:[LC]},$$scope:{ctx:s}}}),r=new rr({props:{data:s[0],$$slots:{default:[PC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,[m]){const l={};m&1039&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&1038&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function H0(s,e){let n=["all"];return s&&n.push(["get","covered"]),e.length>0&&n.push(["==",["get","quintile"],parseInt(e)]),n}function NC(s,e,n){let r,a;Ft(s,Qu,N=>n(1,r=N)),Ft(s,sr,N=>n(8,a=N));let h=!1,m="",l={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function x(){a&&n(0,l=await a.renderPrecalculatedFlows())}function S(){r=this.checked,Qu.set(r)}function T(){h=this.checked,n(2,h)}function C(){m=eu(this),n(3,m)}return s.$$.update=()=>{s.$$.dirty&3&&r&&l.features.length==0&&x()},[l,r,h,m,x,S,T,C]}class zC extends fn{constructor(e){super(),hn(this,e,NC,DC,an,{})}}function FC(s){let e,n;return e=new Yp({props:{paint:{"circle-color":"purple","circle-radius":5},layout:{visibility:s[1]&&s[2].kind=="edit-route"?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&6&&(h.layout={visibility:r[1]&&r[2].kind=="edit-route"?"visible":"none"}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function OC(s){let e,n;return e=new rr({props:{data:s[0],$$slots:{default:[FC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,[a]){const h={};a&1&&(h.data=r[0]),a&38&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function BC(s,e,n){let r,a,h;Ft(s,Fp,x=>n(1,r=x)),Ft(s,sr,x=>n(3,a=x)),Ft(s,Ni,x=>n(2,h=x));let m={type:"FeatureCollection",features:[]};async function l(){a&&n(0,m=await a.getMajorJunctions())}return s.$$.update=()=>{s.$$.dirty&3&&r&&m.features.length==0&&l()},[m,r,h]}class UC extends fn{constructor(e){super(),hn(this,e,BC,OC,an,{})}}function jC(s){let e,n,r,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,K,pe,ve,De,he,xe,be,Ce,we,ye;return e=new YA({}),r=new rT({}),h=new zC({}),l=new mT({}),S=new ST({}),C=new RT({}),B=new BT({}),ee=new GT({}),se=new sC({}),K=new mC({}),ve=new KT({}),he=new wC({}),be=new CC({}),we=new UC({}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment),a=Oe(),ot(h.$$.fragment),m=Oe(),ot(l.$$.fragment),x=Oe(),ot(S.$$.fragment),T=Oe(),ot(C.$$.fragment),N=Oe(),ot(B.$$.fragment),U=Oe(),ot(ee.$$.fragment),ie=Oe(),ot(se.$$.fragment),Q=Oe(),ot(K.$$.fragment),pe=Oe(),ot(ve.$$.fragment),De=Oe(),ot(he.$$.fragment),xe=Oe(),ot(be.$$.fragment),Ce=Oe(),ot(we.$$.fragment)},m(Ue,qe){it(e,Ue,qe),ae(Ue,n,qe),it(r,Ue,qe),ae(Ue,a,qe),it(h,Ue,qe),ae(Ue,m,qe),it(l,Ue,qe),ae(Ue,x,qe),it(S,Ue,qe),ae(Ue,T,qe),it(C,Ue,qe),ae(Ue,N,qe),it(B,Ue,qe),ae(Ue,U,qe),it(ee,Ue,qe),ae(Ue,ie,qe),it(se,Ue,qe),ae(Ue,Q,qe),it(K,Ue,qe),ae(Ue,pe,qe),it(ve,Ue,qe),ae(Ue,De,qe),it(he,Ue,qe),ae(Ue,xe,qe),it(be,Ue,qe),ae(Ue,Ce,qe),it(we,Ue,qe),ye=!0},p:tt,i(Ue){ye||(_e(e.$$.fragment,Ue),_e(r.$$.fragment,Ue),_e(h.$$.fragment,Ue),_e(l.$$.fragment,Ue),_e(S.$$.fragment,Ue),_e(C.$$.fragment,Ue),_e(B.$$.fragment,Ue),_e(ee.$$.fragment,Ue),_e(se.$$.fragment,Ue),_e(K.$$.fragment,Ue),_e(ve.$$.fragment,Ue),_e(he.$$.fragment,Ue),_e(be.$$.fragment,Ue),_e(we.$$.fragment,Ue),ye=!0)},o(Ue){Ie(e.$$.fragment,Ue),Ie(r.$$.fragment,Ue),Ie(h.$$.fragment,Ue),Ie(l.$$.fragment,Ue),Ie(S.$$.fragment,Ue),Ie(C.$$.fragment,Ue),Ie(B.$$.fragment,Ue),Ie(ee.$$.fragment,Ue),Ie(se.$$.fragment,Ue),Ie(K.$$.fragment,Ue),Ie(ve.$$.fragment,Ue),Ie(he.$$.fragment,Ue),Ie(be.$$.fragment,Ue),Ie(we.$$.fragment,Ue),ye=!1},d(Ue){Ue&&(oe(n),oe(a),oe(m),oe(x),oe(T),oe(N),oe(U),oe(ie),oe(Q),oe(pe),oe(De),oe(xe),oe(Ce)),rt(e,Ue),rt(r,Ue),rt(h,Ue),rt(l,Ue),rt(S,Ue),rt(C,Ue),rt(B,Ue),rt(ee,Ue),rt(se,Ue),rt(K,Ue),rt(ve,Ue),rt(he,Ue),rt(be,Ue),rt(we,Ue)}}}class qC extends fn{constructor(e){super(),hn(this,e,null,jC,an,{})}}function VC(s){let e,n,r;return n=new OA({}),{c(){e=ue("div"),ot(n.$$.fragment),Ze(e,"slot","top")},m(a,h){ae(a,e,h),it(n,e,null),r=!0},p:tt,i(a){r||(_e(n.$$.fragment,a),r=!0)},o(a){Ie(n.$$.fragment,a),r=!1},d(a){a&&oe(e),rt(n)}}}function GC(s){let e,n;return{c(){e=ue("div"),n=ue("div"),Ze(e,"slot","left")},m(r,a){ae(r,e,a),Z(e,n),s[14](n)},p:tt,d(r){r&&oe(e),s[14](null)}}}function ZC(s){let e,n;return e=new H2({props:{map:s[0],apiKey:Yv}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&1&&(h.map=r[0]),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function X0(s){let e,n,r,a,h,m,l,x,S={ctx:s,current:null,token:null,hasCatch:!1,pending:KC,then:XC,catch:HC,value:21,blocks:[,,,]};ms(e=s[5].getInvertedBoundary(),S),r=new qC({});const T=[tL,eL,QC,JC,YC,$C],C=[];function N(B,U){return B[6].kind=="main"?0:B[6].kind=="edit-route"&&B[0]?1:B[6].kind=="evaluate-route"?2:B[6].kind=="evaluate-od"?3:B[6].kind=="debug-network"?4:B[6].kind=="debug-mesh-density"?5:-1}return~(h=N(s))&&(m=C[h]=T[h](s)),{c(){S.block.c(),n=Oe(),ot(r.$$.fragment),a=Oe(),m&&m.c(),l=ni()},m(B,U){S.block.m(B,S.anchor=U),S.mount=()=>n.parentNode,S.anchor=n,ae(B,n,U),it(r,B,U),ae(B,a,U),~h&&C[h].m(B,U),ae(B,l,U),x=!0},p(B,U){s=B,S.ctx=s,U&32&&e!==(e=s[5].getInvertedBoundary())&&ms(e,S)||wl(S,s,U);let ee=h;h=N(s),h===ee?~h&&C[h].p(s,U):(m&&(zn(),Ie(C[ee],1,1,()=>{C[ee]=null}),Fn()),~h?(m=C[h],m?m.p(s,U):(m=C[h]=T[h](s),m.c()),_e(m,1),m.m(l.parentNode,l)):m=null)},i(B){x||(_e(S.block),_e(r.$$.fragment,B),_e(m),x=!0)},o(B){for(let U=0;U<3;U+=1){const ee=S.blocks[U];Ie(ee)}Ie(r.$$.fragment,B),Ie(m),x=!1},d(B){B&&(oe(n),oe(a),oe(l)),S.block.d(B),S.token=null,S=null,rt(r,B),~h&&C[h].d(B)}}}function HC(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function XC(s){let e,n;return e=new rr({props:{data:s[21],$$slots:{default:[WC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&32&&(h.data=r[21]),a&4194304&&(h.$$scope={dirty:a,ctx:r}),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function WC(s){let e,n;return e=new mc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function KC(s){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function $C(s){let e,n;return e=new BS({}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function YC(s){let e,n;return e=new LS({}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function JC(s){let e,n;return e=new LA({}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function QC(s){let e,n;return e=new wA({props:{browse:s[6].browse}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&64&&(h.browse=r[6].browse),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function eL(s){let e,n;return e=new oA({props:{id:s[6].id,map:s[0]}}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p(r,a){const h={};a&64&&(h.id=r[6].id),a&1&&(h.map=r[0]),e.$set(h)},i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function tL(s){let e,n;return e=new cE({}),{c(){ot(e.$$.fragment)},m(r,a){it(e,r,a),n=!0},p:tt,i(r){n||(_e(e.$$.fragment,r),n=!0)},o(r){Ie(e.$$.fragment,r),n=!1},d(r){rt(e,r)}}}function nL(s){let e,n,r,a,h,m,l,x=ZC(s);n=new pE({});let S=s[5]&&X0(s);return{c(){x&&x.c(),e=Oe(),ot(n.$$.fragment),r=Oe(),a=ue("div"),h=Oe(),S&&S.c(),m=ni()},m(T,C){x&&x.m(T,C),ae(T,e,C),it(n,T,C),ae(T,r,C),ae(T,a,C),s[11](a),ae(T,h,C),S&&S.m(T,C),ae(T,m,C),l=!0},p(T,C){x.p(T,C),T[5]?S?(S.p(T,C),C&32&&_e(S,1)):(S=X0(T),S.c(),_e(S,1),S.m(m.parentNode,m)):S&&(zn(),Ie(S,1,1,()=>{S=null}),Fn())},i(T){l||(_e(x),_e(n.$$.fragment,T),_e(S),l=!0)},o(T){Ie(x),Ie(n.$$.fragment,T),Ie(S),l=!1},d(T){T&&(oe(e),oe(r),oe(a),oe(h),oe(m)),x&&x.d(T),rt(n,T),s[11](null),S&&S.d(T)}}}function iL(s){let e,n,r,a;function h(l){s[12](l)}let m={style:`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${Yv}`,standardControls:!0,$$slots:{default:[nL]},$$scope:{ctx:s}};return s[0]!==void 0&&(m.map=s[0]),n=new LI({props:m}),Kn.push(()=>gr(n,"map",h)),n.$on("error",s[13]),{c(){e=ue("div"),ot(n.$$.fragment),Ze(e,"slot","main"),Pn(e,"position","relative"),Pn(e,"width","100%"),Pn(e,"height","100%")},m(l,x){ae(l,e,x),it(n,e,null),a=!0},p(l,x){const S={};x&4194405&&(S.$$scope={dirty:x,ctx:l}),!r&&x&1&&(r=!0,S.map=l[0],mr(()=>r=!1)),n.$set(S)},i(l){a||(_e(n.$$.fragment,l),a=!0)},o(l){Ie(n.$$.fragment,l),a=!1},d(l){l&&oe(e),rt(n)}}}function rL(s){let e,n;return{c(){e=ue("div"),n=ue("div"),Ze(e,"slot","right")},m(r,a){ae(r,e,a),Z(e,n),s[10](n)},p:tt,d(r){r&&oe(e),s[10](null)}}}function sL(s){let e,n,r,a;return e=new YI({props:{loading:s[4]}}),r=new VI({props:{$$slots:{right:[rL],main:[iL],left:[GC],top:[VC]},$$scope:{ctx:s}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(r.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(r,h,m),a=!0},p(h,[m]){const l={};m&16&&(l.loading=h[4]),e.$set(l);const x={};m&4194415&&(x.$$scope={dirty:m,ctx:h}),r.$set(x)},i(h){a||(_e(e.$$.fragment,h),_e(r.$$.fragment,h),a=!0)},o(h){Ie(e.$$.fragment,h),Ie(r.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(r,h)}}}function Ef(s,e,n){return e+s*(n-e)}function oL(s,e,n){let r,a,h,m,l,x,S,T,C,N;Ft(s,Rp,xe=>n(7,r=xe)),Ft(s,Pp,xe=>n(8,a=xe)),Ft(s,Mp,xe=>n(9,h=xe)),Ft(s,sr,xe=>n(5,m=xe)),Ft(s,Qf,xe=>n(15,l=xe)),Ft(s,Sh,xe=>n(16,x=xe)),Ft(s,Ju,xe=>n(17,S=xe)),Ft(s,Hf,xe=>n(18,T=xe)),Ft(s,Np,xe=>n(19,C=xe)),Ft(s,Ni,xe=>n(6,N=xe));let B="",U;cc(async()=>{await t1();let xe=new URLSearchParams(window.location.search);Nn(Hf,T=xe.get("boundary")||"LAD_City of Edinburgh",T),n(4,B=`Loading ${T}`);let be=new yS,Ce=await fetch(`areas/${T}.bin`);Ce.ok?(console.log("Using locally hosted files"),Nn(Np,C=!1,C)):(console.log("Using remote hosted files"),Ce=await fetch(rd(`areas/${T}.bin`)));let we=await Ce.arrayBuffer();try{await be.loadFile(new Uint8Array(we))}catch(qe){window.alert(`Couldn't load: ${qe}`)}let ye=window.localStorage.getItem(`tmp-npt-editor/${T}`);if(ye)try{await be.loadSavefile(ye)}catch(qe){window.alert(`Couldn't restore saved state: ${qe}`)}n(4,B="");let Ue=await be.getBounds();Nn(Ju,S={lng:Ef(.4,Ue[0],Ue[2]),lat:Ef(.4,Ue[1],Ue[3])},S),Nn(Sh,x={lng:Ef(.6,Ue[0],Ue[2]),lat:Ef(.6,Ue[1],Ue[3])},x),Nn(Qf,l=new CE(U,be.toRouteSnapper(),Yn(Mf()),Yn(!0),Yn(0)),l),sr.set(be),await ee()});async function ee(){U&&m&&U.fitBounds(await m.getBounds(),{animate:!1})}let ie,se,Q;function K(xe){Kn[xe?"unshift":"push"](()=>{Q=xe,n(3,Q),n(7,r)})}function pe(xe){Kn[xe?"unshift":"push"](()=>{se=xe,n(2,se),n(8,a)})}function ve(xe){U=xe,n(0,U)}const De=xe=>{console.log(xe.detail.error)};function he(xe){Kn[xe?"unshift":"push"](()=>{ie=xe,n(1,ie),n(9,h)})}return s.$$.update=()=>{s.$$.dirty&1&&U&&vS.set(U),s.$$.dirty&514&&ie&&h&&(n(1,ie.innerHTML="",ie),ie.appendChild(h)),s.$$.dirty&260&&se&&a&&(n(2,se.innerHTML="",se),se.appendChild(a)),s.$$.dirty&136&&Q&&r&&(n(3,Q.innerHTML="",Q),Q.appendChild(r))},[U,ie,se,Q,B,m,N,r,a,h,K,pe,ve,De,he]}class aL extends fn{constructor(e){super(),hn(this,e,oL,sL,an,{})}}new aL({target:document.getElementById("app")});
