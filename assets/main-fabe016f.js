var Gv=Object.defineProperty;var Wv=(o,e,t)=>e in o?Gv(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Pu=(o,e,t)=>(Wv(o,typeof e!="symbol"?e+"":e,t),t);function Hv(o,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const l in r)if(l!=="default"&&!(l in o)){const u=Object.getOwnPropertyDescriptor(r,l);u&&Object.defineProperty(o,l,u.get?u:{enumerable:!0,get:()=>r[l]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function We(){}function Ni(o,e){for(const t in e)o[t]=e[t];return o}function Xv(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function Q0(o){return o()}function $_(){return Object.create(null)}function cn(o){o.forEach(Q0)}function tl(o){return typeof o=="function"}function Vt(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let fd;function zr(o,e){return o===e?!0:(fd||(fd=document.createElement("a")),fd.href=e,o===fd.href)}function Kv(o){return Object.keys(o).length===0}function e1(o,...e){if(o==null){for(const r of e)r(void 0);return We}const t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ju(o){let e;return e1(o,t=>e=t)(),e}function bt(o,e,t){o.$$.on_destroy.push(e1(e,t))}function mn(o,e,t,r){if(o){const l=t1(o,e,t,r);return o[0](l)}}function t1(o,e,t,r){return o[1]&&r?Ni(t.ctx.slice(),o[1](r(e))):t.ctx}function _n(o,e,t,r){if(o[2]&&r){const l=o[2](r(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let s=0;s<d;s+=1)u[s]=e.dirty[s]|l[s];return u}return e.dirty|l}return e.dirty}function gn(o,e,t,r,l,u){if(l){const d=t1(e,t,r,u);o.p(d,l)}}function yn(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Jv(o){const e={};for(const t in o)e[t]=!0;return e}function Cd(o){return o??""}function oi(o,e,t){return o.set(t),e}function mp(o){return o&&tl(o.destroy)?o.destroy:We}const i1=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function F(o,e){o.appendChild(e)}function J(o,e,t){o.insertBefore(e,t||null)}function X(o){o.parentNode&&o.parentNode.removeChild(o)}function jn(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function ee(o){return document.createElement(o)}function xs(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function be(o){return document.createTextNode(o)}function we(){return be(" ")}function Ei(){return be("")}function ft(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function ah(o){return function(e){return e.preventDefault(),o.call(this,e)}}function op(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function Pe(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function U_(o){let e;return{p(...t){e=t,e.forEach(r=>o.push(r))},r(){e.forEach(t=>o.splice(o.indexOf(t),1))}}}function Yv(o){return Array.from(o.childNodes)}function pt(o,e){e=""+e,o.data!==e&&(o.data=e)}function Zi(o,e){o.value=e??""}function mi(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function hr(o,e,t){for(let r=0;r<o.options.length;r+=1){const l=o.options[r];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function vs(o){const e=o.querySelector(":checked");return e&&e.__value}function dr(o,e,t){o.classList.toggle(e,!!t)}function Qv(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}let Yu;function ws(o){Yu=o}function _c(){if(!Yu)throw new Error("Function called outside component initialization");return Yu}function gc(o){_c().$$.on_mount.push(o)}function Po(o){_c().$$.on_destroy.push(o)}function yc(){const o=_c();return(e,t,{cancelable:r=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=Qv(e,t,{cancelable:r});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function n1(o,e){return _c().$$.context.set(o,e),e}function r1(o){return _c().$$.context.get(o)}function Fn(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const rc=[],Ai=[];let cc=[];const _p=[],o1=Promise.resolve();let gp=!1;function s1(){gp||(gp=!0,o1.then(jp))}function ew(){return s1(),o1}function Mo(o){cc.push(o)}function Hn(o){_p.push(o)}const sp=new Set;let Yl=0;function jp(){if(Yl!==0)return;const o=Yu;do{try{for(;Yl<rc.length;){const e=rc[Yl];Yl++,ws(e),tw(e.$$)}}catch(e){throw rc.length=0,Yl=0,e}for(ws(null),rc.length=0,Yl=0;Ai.length;)Ai.pop()();for(let e=0;e<cc.length;e+=1){const t=cc[e];sp.has(t)||(sp.add(t),t())}cc.length=0}while(rc.length);for(;_p.length;)_p.pop()();gp=!1,sp.clear(),ws(o)}function tw(o){if(o.fragment!==null){o.update(),cn(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Mo)}}function iw(o){const e=[],t=[];cc.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),cc=e}const vd=new Set;let Ya;function ui(){Ya={r:0,c:[],p:Ya}}function hi(){Ya.r||cn(Ya.c),Ya=Ya.p}function ne(o,e){o&&o.i&&(vd.delete(o),o.i(e))}function he(o,e,t,r){if(o&&o.o){if(vd.has(o))return;vd.add(o),Ya.c.push(()=>{vd.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function Dr(o,e){const t=e.token={};function r(l,u,d,s){if(e.token!==t)return;e.resolved=s;let g=e.ctx;d!==void 0&&(g=g.slice(),g[d]=s);const y=l&&(e.current=l)(g);let k=!1;e.block&&(e.blocks?e.blocks.forEach((S,L)=>{L!==u&&S&&(ui(),he(S,1,1,()=>{e.blocks[L]===S&&(e.blocks[L]=null)}),hi())}):e.block.d(1),y.c(),ne(y,1),y.m(e.mount(),e.anchor),k=!0),e.block=y,e.blocks&&(e.blocks[u]=y),k&&jp()}if(Xv(o)){const l=_c();if(o.then(u=>{ws(l),r(e.then,1,e.value,u),ws(null)},u=>{if(ws(l),r(e.catch,2,e.error,u),ws(null),!e.hasCatch)throw u}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function ba(o,e,t){const r=e.slice(),{resolved:l}=o;o.current===o.then&&(r[o.value]=l),o.current===o.catch&&(r[o.error]=l),o.block.p(r,t)}function bi(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function nw(o,e){he(o,1,1,()=>{e.delete(o.key)})}function rw(o,e,t,r,l,u,d,s,g,y,k,S){let L=o.length,P=u.length,R=L;const Z={};for(;R--;)Z[o[R].key]=R;const U=[],H=new Map,G=new Map,K=[];for(R=P;R--;){const te=S(l,u,R),Y=t(te);let ue=d.get(Y);ue?r&&K.push(()=>ue.p(te,e)):(ue=y(Y,te),ue.c()),H.set(Y,U[R]=ue),Y in Z&&G.set(Y,Math.abs(R-Z[Y]))}const le=new Set,Se=new Set;function Le(te){ne(te,1),te.m(s,k),d.set(te.key,te),k=te.first,P--}for(;L&&P;){const te=U[P-1],Y=o[L-1],ue=te.key,fe=Y.key;te===Y?(k=te.first,L--,P--):H.has(fe)?!d.has(ue)||le.has(ue)?Le(te):Se.has(fe)?L--:G.get(ue)>G.get(fe)?(Se.add(ue),Le(te)):(le.add(fe),L--):(g(Y,d),L--)}for(;L--;){const te=o[L];H.has(te.key)||g(te,d)}for(;P;)Le(U[P-1]);return cn(K),U}function vn(o,e){const t={},r={},l={$$scope:1};let u=o.length;for(;u--;){const d=o[u],s=e[u];if(s){for(const g in d)g in s||(r[g]=1);for(const g in s)l[g]||(t[g]=s[g],l[g]=1);o[u]=s}else for(const g in d)l[g]=1}for(const d in r)d in t||(t[d]=void 0);return t}function ow(o){return typeof o=="object"&&o!==null?o:{}}function Xn(o,e,t){const r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function Ve(o){o&&o.c()}function je(o,e,t){const{fragment:r,after_update:l}=o.$$;r&&r.m(e,t),Mo(()=>{const u=o.$$.on_mount.map(Q0).filter(tl);o.$$.on_destroy?o.$$.on_destroy.push(...u):cn(u),o.$$.on_mount=[]}),l.forEach(Mo)}function $e(o,e){const t=o.$$;t.fragment!==null&&(iw(t.after_update),cn(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function sw(o,e){o.$$.dirty[0]===-1&&(rc.push(o),s1(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function Gt(o,e,t,r,l,u,d=null,s=[-1]){const g=Yu;ws(o);const y=o.$$={fragment:null,ctx:[],props:u,update:We,not_equal:l,bound:$_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:$_(),dirty:s,skip_bound:!1,root:e.target||g.$$.root};d&&d(y.root);let k=!1;if(y.ctx=t?t(o,e.props||{},(S,L,...P)=>{const R=P.length?P[0]:L;return y.ctx&&l(y.ctx[S],y.ctx[S]=R)&&(!y.skip_bound&&y.bound[S]&&y.bound[S](R),k&&sw(o,S)),L}):[],y.update(),k=!0,cn(y.before_update),y.fragment=r?r(y.ctx):!1,e.target){if(e.hydrate){const S=Yv(e.target);y.fragment&&y.fragment.l(S),S.forEach(X)}else y.fragment&&y.fragment.c();e.intro&&ne(o.$$.fragment),je(o,e.target,e.anchor),jp()}ws(g)}class Wt{constructor(){Pu(this,"$$");Pu(this,"$$set")}$destroy(){$e(this,1),this.$destroy=We}$on(e,t){if(!tl(t))return We;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const l=r.indexOf(t);l!==-1&&r.splice(l,1)}}$set(e){this.$$set&&!Kv(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const aw="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(aw);var lw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cw(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var a1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(o,e){(function(t,r){o.exports=r()})(lw,function(){var t={},r={};function l(d,s,g){if(r[d]=g,d==="index"){var y="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",k={};return r.shared(k),r.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function s(a,n,c,f){return new(c||(c=Promise))(function(_,w){function x(A){try{C(f.next(A))}catch(z){w(z)}}function T(A){try{C(f.throw(A))}catch(z){w(z)}}function C(A){var z;A.done?_(A.value):(z=A.value,z instanceof c?z:new c(function(B){B(z)})).then(x,T)}C((f=f.apply(a,n||[])).next())})}function g(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}typeof SuppressedError=="function"&&SuppressedError;var y=k;function k(a,n){this.x=a,this.y=n}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,n){return this.clone()._rotateAround(a,n)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var n=a.x-this.x,c=a.y-this.y;return n*n+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,n){return Math.atan2(this.x*n-this.y*a,this.x*a+this.y*n)},_matMult:function(a){var n=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=n,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var n=Math.cos(a),c=Math.sin(a),f=c*this.x+n*this.y;return this.x=n*this.x-c*this.y,this.y=f,this},_rotateAround:function(a,n){var c=Math.cos(a),f=Math.sin(a),_=n.y+f*(this.x-n.x)+c*(this.y-n.y);return this.x=n.x+c*(this.x-n.x)-f*(this.y-n.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(a){return a instanceof k?a:Array.isArray(a)?new k(a[0],a[1]):a};var S=g(y),L=P;function P(a,n,c,f){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=n,this.p2x=c,this.p2y=f}P.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,n){if(n===void 0&&(n=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,f=0;f<8;f++){var _=this.sampleCurveX(c)-a;if(Math.abs(_)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=_/w}var x=0,T=1;for(c=a,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-a)<n));f++)a>_?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(a,n){return this.sampleCurveY(this.solveCurveX(a,n))}};var R=g(L);let Z,U;function H(){return Z==null&&(Z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Z}function G(){if(U==null&&(U=!1,H())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let f=0;f<5*5;f++){const _=4*f;n.fillStyle=`rgb(${_},${_+1},${_+2})`,n.fillRect(f%5,Math.floor(f/5),1,1)}const c=n.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){U=!0;break}}}return U||!1}function K(a,n,c,f){const _=new R(a,n,c,f);return w=>_.solve(w)}const le=K(.25,.1,.25,1);function Se(a,n,c){return Math.min(c,Math.max(n,a))}function Le(a,n,c){const f=c-n,_=((a-n)%f+f)%f+n;return _===n?c:_}function te(a,...n){for(const c of n)for(const f in c)a[f]=c[f];return a}let Y=1;function ue(a,n,c){const f={};for(const _ in a)f[_]=n.call(this,a[_],_,a);return f}function fe(a,n,c){const f={};for(const _ in a)n.call(this,a[_],_,a)&&(f[_]=a[_]);return f}function ce(a){return Array.isArray(a)?a.map(ce):typeof a=="object"&&a?ue(a,ce):a}const ae={};function Ge(a){ae[a]||(typeof console<"u"&&console.warn(a),ae[a]=!0)}function Ee(a,n,c){return(c.y-a.y)*(n.x-a.x)>(n.y-a.y)*(c.x-a.x)}function ze(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let rt=null;function it(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ft(a,n,c,f,_){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(a,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const T=x.startsWith("BGR"),C=new Uint8ClampedArray(f*_*4);if(yield w.copyTo(C,function(A,z,B,$,W){const ie=4*Math.max(-z,0),oe=(Math.max(0,B)-B)*$*4+ie,_e=4*$,ve=Math.max(0,z),Ze=Math.max(0,B);return{rect:{x:ve,y:Ze,width:Math.min(A.width,z+$)-ve,height:Math.min(A.height,B+W)-Ze},layout:[{offset:oe,stride:_e}]}}(a,n,c,f,_)),T)for(let A=0;A<C.length;A+=4){const z=C[A];C[A]=C[A+2],C[A+2]=z}return C}finally{w.close()}})}let jt,ut;const et="AbortError";function at(){return new Error(et)}const Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Dt(a){return Bt.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const Ht="global-dispatcher";class ai extends Error{constructor(n,c,f,_){super(`AJAXError: ${c} (${n}): ${f}`),this.status=n,this.statusText=c,this.url=f,this.body=_}}const si=()=>ze(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Si=function(a,n){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const f=Dt(a.url);if(f)return f(a,n);if(ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:Ht},n)}if(!(/^file:/.test(c=a.url)||/^file:/.test(si())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,_){return s(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:si(),signal:_.signal});f.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const A=yield x.blob();throw new ai(x.status,x.statusText,f.url,A)}let T;T=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const C=yield T;if(_.signal.aborted)throw at();return{data:C,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(a,n);if(ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:Ht},n)}var c;return function(f,_){return new Promise((w,x)=>{var T;const C=new XMLHttpRequest;C.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(C.responseType="arraybuffer");for(const A in f.headers)C.setRequestHeader(A,f.headers[A]);f.type==="json"&&(C.responseType="text",!((T=f.headers)===null||T===void 0)&&T.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=f.credentials==="include",C.onerror=()=>{x(new Error(C.statusText))},C.onload=()=>{if(!_.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let A=C.response;if(f.type==="json")try{A=JSON.parse(C.response)}catch(z){return void x(z)}w({data:A,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const A=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});x(new ai(C.status,C.statusText,f.url,A))}},_.signal.addEventListener("abort",()=>{C.abort(),x(at())}),C.send(f.body)})}(a,n)};function Ri(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const n=new URL(a),c=window.location;return n.protocol===c.protocol&&n.host===c.host}function vi(a,n,c){c[a]&&c[a].indexOf(n)!==-1||(c[a]=c[a]||[],c[a].push(n))}function di(a,n,c){if(c&&c[a]){const f=c[a].indexOf(n);f!==-1&&c[a].splice(f,1)}}class lt{constructor(n,c={}){te(this,c),this.type=n}}class qe extends lt{constructor(n,c={}){super("error",te({error:n},c))}}class st{on(n,c){return this._listeners=this._listeners||{},vi(n,c,this._listeners),this}off(n,c){return di(n,c,this._listeners),di(n,c,this._oneTimeListeners),this}once(n,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},vi(n,c,this._oneTimeListeners),this):new Promise(f=>this.once(n,f))}fire(n,c){typeof n=="string"&&(n=new lt(n,c||{}));const f=n.type;if(this.listens(f)){n.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of _)T.call(this,n);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of w)di(f,T,this._oneTimeListeners),T.call(this,n);const x=this._eventedParent;x&&(te(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(n))}else n instanceof qe&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,c){return this._eventedParent=n,this._eventedParentData=c,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yt(a,n){const c={};for(const f in a)f!=="ref"&&(c[f]=a[f]);return mt.forEach(f=>{f in n&&(c[f]=n[f])}),c}function Ie(a,n){if(Array.isArray(a)){if(!Array.isArray(n)||a.length!==n.length)return!1;for(let c=0;c<a.length;c++)if(!Ie(a[c],n[c]))return!1;return!0}if(typeof a=="object"&&a!==null&&n!==null){if(typeof n!="object"||Object.keys(a).length!==Object.keys(n).length)return!1;for(const c in a)if(!Ie(a[c],n[c]))return!1;return!0}return a===n}function nt(a,n){a.push(n)}function Xt(a,n,c){nt(c,{command:"addSource",args:[a,n[a]]})}function wi(a,n,c){nt(n,{command:"removeSource",args:[a]}),c[a]=!0}function $i(a,n,c,f){wi(a,c,f),Xt(a,n,c)}function Li(a,n,c){let f;for(f in a[c])if(Object.prototype.hasOwnProperty.call(a[c],f)&&f!=="data"&&!Ie(a[c][f],n[c][f]))return!1;for(f in n[c])if(Object.prototype.hasOwnProperty.call(n[c],f)&&f!=="data"&&!Ie(a[c][f],n[c][f]))return!1;return!0}function gi(a,n,c,f,_,w){a=a||{},n=n||{};for(const x in a)Object.prototype.hasOwnProperty.call(a,x)&&(Ie(a[x],n[x])||c.push({command:w,args:[f,x,n[x],_]}));for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&!Object.prototype.hasOwnProperty.call(a,x)&&(Ie(a[x],n[x])||c.push({command:w,args:[f,x,n[x],_]}))}function Fi(a){return a.id}function br(a,n){return a[n.id]=n,a}class ct{constructor(n,c,f,_){this.message=(n?`${n}: `:"")+f,_&&(this.identifier=_),c!=null&&c.__line__&&(this.line=c.__line__)}}function tr(a,...n){for(const c of n)for(const f in c)a[f]=c[f];return a}class dn extends Error{constructor(n,c){super(c),this.message=c,this.key=n}}class Un{constructor(n,c=[]){this.parent=n,this.bindings={};for(const[f,_]of c)this.bindings[f]=_}concat(n){return new Un(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Wr={kind:"null"},vt={kind:"number"},li={kind:"string"},Jt={kind:"boolean"},Sn={kind:"color"},Bn={kind:"object"},ei={kind:"value"},vr={kind:"collator"},Fr={kind:"formatted"},Hr={kind:"padding"},wr={kind:"resolvedImage"},ye={kind:"variableAnchorOffsetCollection"};function q(a,n){return{kind:"array",itemType:a,N:n}}function V(a){if(a.kind==="array"){const n=V(a.itemType);return typeof a.N=="number"?`array<${n}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${n}>`}return a.kind}const re=[Wr,vt,li,Jt,Sn,Fr,Bn,q(ei),Hr,wr,ye];function pe(a,n){if(n.kind==="error")return null;if(a.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!pe(a.itemType,n.itemType))&&(typeof a.N!="number"||a.N===n.N))return null}else{if(a.kind===n.kind)return null;if(a.kind==="value"){for(const c of re)if(!pe(c,n))return null}}return`Expected ${V(a)} but found ${V(n)} instead.`}function Me(a,n){return n.some(c=>c.kind===a.kind)}function De(a,n){return n.some(c=>c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a)}function Ue(a,n){return a.kind==="array"&&n.kind==="array"?a.itemType.kind===n.itemType.kind&&typeof a.N=="number":a.kind===n.kind}const j=.96422,Fe=.82521,Ke=4/29,Ne=6/29,Xe=3*Ne*Ne,_t=Ne*Ne*Ne,Et=Math.PI/180,pi=180/Math.PI;function Qt(a){return(a%=360)<0&&(a+=360),a}function ci([a,n,c,f]){let _,w;const x=Pn((.2225045*(a=xi(a))+.7168786*(n=xi(n))+.0606169*(c=xi(c)))/1);a===n&&n===c?_=w=x:(_=Pn((.4360747*a+.3850649*n+.1430804*c)/j),w=Pn((.0139322*a+.0971045*n+.7141733*c)/Fe));const T=116*x-16;return[T<0?0:T,500*(_-x),200*(x-w),f]}function xi(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Pn(a){return a>_t?Math.pow(a,1/3):a/Xe+Ke}function fn([a,n,c,f]){let _=(a+16)/116,w=isNaN(n)?_:_+n/500,x=isNaN(c)?_:_-c/200;return _=1*Vi(_),w=j*Vi(w),x=Fe*Vi(x),[_i(3.1338561*w-1.6168667*_-.4906146*x),_i(-.9787684*w+1.9161415*_+.033454*x),_i(.0719453*w-.2289914*_+1.4052427*x),f]}function _i(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function Vi(a){return a>Ne?a*a*a:Xe*(a-Ke)}function an(a){return parseInt(a.padEnd(2,a),16)/255}function Vn(a,n){return Kn(n?a/100:a,0,1)}function Kn(a,n,c){return Math.min(Math.max(n,a),c)}function fr(a){return!a.some(Number.isNaN)}const Es={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qi{constructor(n,c,f,_=1,w=!0){this.r=n,this.g=c,this.b=f,this.a=_,w||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[n,c,f,_]))}static parse(n){if(n instanceof qi)return n;if(typeof n!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Es[f];if(_){const[x,T,C]=_;return[x/255,T/255,C/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let T=1;return[an(f.slice(T,T+=x)),an(f.slice(T,T+=x)),an(f.slice(T,T+=x)),an(f.slice(T,T+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,C,A,z,B,$,W,ie,oe,_e,ve,Ze]=x,Ae=[z||" ",W||" ",_e].join("");if(Ae==="  "||Ae==="  /"||Ae===",,"||Ae===",,,"){const Oe=[A,$,oe].join(""),Je=Oe==="%%%"?100:Oe===""?255:0;if(Je){const gt=[Kn(+C/Je,0,1),Kn(+B/Je,0,1),Kn(+ie/Je,0,1),ve?Vn(+ve,Ze):1];if(fr(gt))return gt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,T,C,A,z,B,$,W,ie]=w,oe=[C||" ",z||" ",$].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const _e=[+T,Kn(+A,0,100),Kn(+B,0,100),W?Vn(+W,ie):1];if(fr(_e))return function([ve,Ze,Ae,Oe]){function Je(gt){const Mt=(gt+ve/30)%12,Kt=Ze*Math.min(Ae,1-Ae);return Ae-Kt*Math.max(-1,Math.min(Mt-3,9-Mt,1))}return ve=Qt(ve),Ze/=100,Ae/=100,[Je(0),Je(8),Je(4),Oe]}(_e)}}}(n);return c?new qi(...c,!1):void 0}get rgb(){const{r:n,g:c,b:f,a:_}=this,w=_||1/0;return this.overwriteGetter("rgb",[n/w,c/w,f/w,_])}get hcl(){return this.overwriteGetter("hcl",function(n){const[c,f,_,w]=ci(n),x=Math.sqrt(f*f+_*_);return[Math.round(1e4*x)?Qt(Math.atan2(_,f)*pi):NaN,x,c,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ci(this.rgb))}overwriteGetter(n,c){return Object.defineProperty(this,n,{value:c}),c}toString(){const[n,c,f,_]=this.rgb;return`rgba(${[n,c,f].map(w=>Math.round(255*w)).join(",")},${_})`}}qi.black=new qi(0,0,0,1),qi.white=new qi(1,1,1,1),qi.transparent=new qi(0,0,0,0),qi.red=new qi(1,0,0,1);class Sc{constructor(n,c,f){this.sensitivity=n?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,c){return this.collator.compare(n,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tc{constructor(n,c,f,_,w){this.text=n,this.image=c,this.scale=f,this.fontStack=_,this.textColor=w}}class Br{constructor(n){this.sections=n}static fromString(n){return new Br([new Tc(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Br?n:Br.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Or{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Or)return n;if(typeof n=="number")return new Or([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const c of n)if(typeof c!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Or(n)}}toString(){return JSON.stringify(this.values)}}const Vd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Xr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let c=0;c<n.length;c+=2){const f=n[c],_=n[c+1];if(typeof f!="string"||!Vd.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Xr(n)}}toString(){return JSON.stringify(this.values)}}class Nr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Nr({name:n,available:!1}):null}}function Ls(a,n,c,f){return typeof a=="number"&&a>=0&&a<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[a,n,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[a,n,c,f]:[a,n,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Yo(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof qi||a instanceof Sc||a instanceof Br||a instanceof Or||a instanceof Xr||a instanceof Nr)return!0;if(Array.isArray(a)){for(const n of a)if(!Yo(n))return!1;return!0}if(typeof a=="object"){for(const n in a)if(!Yo(a[n]))return!1;return!0}return!1}function zn(a){if(a===null)return Wr;if(typeof a=="string")return li;if(typeof a=="boolean")return Jt;if(typeof a=="number")return vt;if(a instanceof qi)return Sn;if(a instanceof Sc)return vr;if(a instanceof Br)return Fr;if(a instanceof Or)return Hr;if(a instanceof Xr)return ye;if(a instanceof Nr)return wr;if(Array.isArray(a)){const n=a.length;let c;for(const f of a){const _=zn(f);if(c){if(c===_)continue;c=ei;break}c=_}return q(c||ei,n)}return Bn}function Sa(a){const n=typeof a;return a===null?"":n==="string"||n==="number"||n==="boolean"?String(a):a instanceof qi||a instanceof Br||a instanceof Or||a instanceof Xr||a instanceof Nr?a.toString():JSON.stringify(a)}class ro{constructor(n,c){this.type=n,this.value=c}static parse(n,c){if(n.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Yo(n[1]))return c.error("invalid value");const f=n[1];let _=zn(f);const w=c.expectedType;return _.kind!=="array"||_.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(_=w),new ro(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Mn{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const rl={string:li,number:vt,boolean:Jt,object:Bn};class oo{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");let f,_=1;const w=n[0];if(w==="array"){let T,C;if(n.length>2){const A=n[1];if(typeof A!="string"||!(A in rl)||A==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=rl[A],_++}else T=ei;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return c.error('The length argument to "array" must be a positive integer literal',2);C=n[2],_++}f=q(T,C)}else{if(!rl[w])throw new Error(`Types doesn't contain name = ${w}`);f=rl[w]}const x=[];for(;_<n.length;_++){const T=c.parse(n[_],_,ei);if(!T)return null;x.push(T)}return new oo(f,x)}evaluate(n){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(n);if(!pe(this.type,zn(f)))return f;if(c===this.args.length-1)throw new Mn(`Expected value to be of type ${V(this.type)}, but found ${V(zn(f))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Ic={"to-boolean":Jt,"to-color":Sn,"to-number":vt,"to-string":li};class so{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[0];if(!Ic[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&n.length!==2)return c.error("Expected one argument.");const _=Ic[f],w=[];for(let x=1;x<n.length;x++){const T=c.parse(n[x],x,ei);if(!T)return null;w.push(T)}return new so(_,w)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let c,f;for(const _ of this.args){if(c=_.evaluate(n),f=null,c instanceof qi)return c;if(typeof c=="string"){const w=n.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Ls(c[0],c[1],c[2],c[3]),!f))return new qi(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Mn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(n);const _=Or.parse(c);if(_)return _}throw new Mn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(n);const _=Xr.parse(c);if(_)return _}throw new Mn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(n),c===null)return 0;const _=Number(c);if(!isNaN(_))return _}throw new Mn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Br.fromString(Sa(this.args[0].evaluate(n)));case"resolvedImage":return Nr.fromString(Sa(this.args[0].evaluate(n)));default:return Sa(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const qd=["Unknown","Point","LineString","Polygon"];class ol{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let c=this._parseColorCache[n];return c||(c=this._parseColorCache[n]=qi.parse(n)),c}}class Qo{constructor(n,c,f=[],_,w=new Un,x=[]){this.registry=n,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=w,this.errors=x,this.expectedType=_,this._isConstant=c}parse(n,c,f,_,w={}){return c?this.concat(c,f,_)._parse(n,w):this._parse(n,w)}_parse(n,c){function f(_,w,x){return x==="assert"?new oo(w,[_]):x==="coerce"?new so(w,[_]):_}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=n[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[_];if(w){let x=w.parse(n,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,C=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||C.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(T.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(T,C))return null}else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"assert")}if(!(x instanceof ro)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const T=new ol;try{x=new ro(x.type,x.evaluate(T))}catch(C){return this.error(C.message),null}}return x}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,c,f){const _=typeof n=="number"?this.path.concat(n):this.path,w=f?this.scope.concat(f):this.scope;return new Qo(this.registry,this._isConstant,_,c||null,w,this.errors)}error(n,...c){const f=`${this.key}${c.map(_=>`[${_}]`).join("")}`;this.errors.push(new dn(f,n))}checkSubtype(n,c){const f=pe(n,c);return f&&this.error(f),f}}class qo{constructor(n,c){this.type=c.type,this.bindings=[].concat(n),this.result=c}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const c of this.bindings)n(c[1]);n(this.result)}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const f=[];for(let w=1;w<n.length-1;w+=2){const x=n[w];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const T=c.parse(n[w+1],w+1);if(!T)return null;f.push([x,T])}const _=c.parse(n[n.length-1],n.length-1,c.expectedType,f);return _?new qo(f,_):null}outputDefined(){return this.result.outputDefined()}}class Bi{constructor(n,c){this.type=c.type,this.name=n,this.boundExpression=c}static parse(n,c){if(n.length!==2||typeof n[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=n[1];return c.scope.has(f)?new Bi(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Cc{constructor(n,c,f){this.type=n,this.index=c,this.input=f}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,vt),_=c.parse(n[2],2,q(c.expectedType||ei));return f&&_?new Cc(_.type.itemType,f,_):null}evaluate(n){const c=this.index.evaluate(n),f=this.input.evaluate(n);if(c<0)throw new Mn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new Mn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new Mn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Ec{constructor(n,c){this.type=Jt,this.needle=n,this.haystack=c}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ei),_=c.parse(n[2],2,ei);return f&&_?Me(f.type,[Jt,li,vt,Wr,ei])?new Ec(f,_):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${V(f.type)} instead`):null}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!f)return!1;if(!De(c,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${V(zn(c))} instead.`);if(!De(f,["string","array"]))throw new Mn(`Expected second argument to be of type array or string, but found ${V(zn(f))} instead.`);return f.indexOf(c)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Ms{constructor(n,c,f){this.type=vt,this.needle=n,this.haystack=c,this.fromIndex=f}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ei),_=c.parse(n[2],2,ei);if(!f||!_)return null;if(!Me(f.type,[Jt,li,vt,Wr,ei]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${V(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,vt);return w?new Ms(f,_,w):null}return new Ms(f,_)}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!De(c,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${V(zn(c))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(n)),De(f,["string"])){const w=f.indexOf(c,_);return w===-1?-1:[...f.slice(0,w)].length}if(De(f,["array"]))return f.indexOf(c,_);throw new Mn(`Expected second argument to be of type array or string, but found ${V(zn(f))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class Lc{constructor(n,c,f,_,w,x){this.inputType=n,this.type=c,this.input=f,this.cases=_,this.outputs=w,this.otherwise=x}static parse(n,c){if(n.length<5)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return c.error("Expected an even number of arguments.");let f,_;c.expectedType&&c.expectedType.kind!=="value"&&(_=c.expectedType);const w={},x=[];for(let A=2;A<n.length-1;A+=2){let z=n[A];const B=n[A+1];Array.isArray(z)||(z=[z]);const $=c.concat(A);if(z.length===0)return $.error("Expected at least one branch label.");for(const ie of z){if(typeof ie!="number"&&typeof ie!="string")return $.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return $.error("Numeric branch labels must be integer values.");if(f){if($.checkSubtype(f,zn(ie)))return null}else f=zn(ie);if(w[String(ie)]!==void 0)return $.error("Branch labels must be unique.");w[String(ie)]=x.length}const W=c.parse(B,A,_);if(!W)return null;_=_||W.type,x.push(W)}const T=c.parse(n[1],1,ei);if(!T)return null;const C=c.parse(n[n.length-1],n.length-1,_);return C?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new Lc(f,_,T,w,x,C):null}evaluate(n){const c=this.input.evaluate(n);return(zn(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class sl{constructor(n,c,f){this.type=n,this.branches=c,this.otherwise=f}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const _=[];for(let x=1;x<n.length-1;x+=2){const T=c.parse(n[x],x,Jt);if(!T)return null;const C=c.parse(n[x+1],x+1,f);if(!C)return null;_.push([T,C]),f=f||C.type}const w=c.parse(n[n.length-1],n.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new sl(f,_,w)}evaluate(n){for(const[c,f]of this.branches)if(c.evaluate(n))return f.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[c,f]of this.branches)n(c),n(f);n(this.otherwise)}outputDefined(){return this.branches.every(([n,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Ta{constructor(n,c,f,_){this.type=n,this.input=c,this.beginIndex=f,this.endIndex=_}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ei),_=c.parse(n[2],2,vt);if(!f||!_)return null;if(!Me(f.type,[q(ei),li,ei]))return c.error(`Expected first argument to be of type array or string, but found ${V(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,vt);return w?new Ta(f.type,f,_,w):null}return new Ta(f.type,f,_)}evaluate(n){const c=this.input.evaluate(n),f=this.beginIndex.evaluate(n);let _;if(this.endIndex&&(_=this.endIndex.evaluate(n)),De(c,["string"]))return[...c].slice(f,_).join("");if(De(c,["array"]))return c.slice(f,_);throw new Mn(`Expected first argument to be of type array or string, but found ${V(zn(c))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function al(a,n){const c=a.length-1;let f,_,w=0,x=c,T=0;for(;w<=x;)if(T=Math.floor((w+x)/2),f=a[T],_=a[T+1],f<=n){if(T===c||n<_)return T;w=T+1}else{if(!(f>n))throw new Mn("Input is not a number.");x=T-1}return 0}class As{constructor(n,c,f){this.type=n,this.input=c,this.labels=[],this.outputs=[];for(const[_,w]of f)this.labels.push(_),this.outputs.push(w)}static parse(n,c){if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(n[1],1,vt);if(!f)return null;const _=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let x=1;x<n.length;x+=2){const T=x===1?-1/0:n[x],C=n[x+1],A=x,z=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(_.length&&_[_.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const B=c.parse(C,z,w);if(!B)return null;w=w||B.type,_.push([T,B])}return new As(w,f,_)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const _=this.input.evaluate(n);if(_<=c[0])return f[0].evaluate(n);const w=c.length;return _>=c[w-1]?f[w-1].evaluate(n):f[al(c,_)].evaluate(n)}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function hh(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Zd=dh;function dh(a,n,c,f){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=n,this.p2x=c,this.p2y=f}dh.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,n){if(n===void 0&&(n=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,f=0;f<8;f++){var _=this.sampleCurveX(c)-a;if(Math.abs(_)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=_/w}var x=0,T=1;for(c=a,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-a)<n));f++)a>_?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(a,n){return this.sampleCurveY(this.solveCurveX(a,n))}};var Gd=hh(Zd);function es(a,n,c){return a+c*(n-a)}function Ia(a,n,c){return a.map((f,_)=>es(f,n[_],c))}const xr={number:es,color:function(a,n,c,f="rgb"){switch(f){case"rgb":{const[_,w,x,T]=Ia(a.rgb,n.rgb,c);return new qi(_,w,x,T,!1)}case"hcl":{const[_,w,x,T]=a.hcl,[C,A,z,B]=n.hcl;let $,W;if(isNaN(_)||isNaN(C))isNaN(_)?isNaN(C)?$=NaN:($=C,x!==1&&x!==0||(W=A)):($=_,z!==1&&z!==0||(W=w));else{let Ze=C-_;C>_&&Ze>180?Ze-=360:C<_&&_-C>180&&(Ze+=360),$=_+c*Ze}const[ie,oe,_e,ve]=function([Ze,Ae,Oe,Je]){return Ze=isNaN(Ze)?0:Ze*Et,fn([Oe,Math.cos(Ze)*Ae,Math.sin(Ze)*Ae,Je])}([$,W??es(w,A,c),es(x,z,c),es(T,B,c)]);return new qi(ie,oe,_e,ve,!1)}case"lab":{const[_,w,x,T]=fn(Ia(a.lab,n.lab,c));return new qi(_,w,x,T,!1)}}},array:Ia,padding:function(a,n,c){return new Or(Ia(a.values,n.values,c))},variableAnchorOffsetCollection:function(a,n,c){const f=a.values,_=n.values;if(f.length!==_.length)throw new Mn(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${n.toString()}`);const w=[];for(let x=0;x<f.length;x+=2){if(f[x]!==_[x])throw new Mn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${_[x]}`);w.push(f[x]);const[T,C]=f[x+1],[A,z]=_[x+1];w.push([es(T,A,c),es(C,z,c)])}return new Xr(w)}};class kr{constructor(n,c,f,_,w){this.type=n,this.operator=c,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[x,T]of w)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(n,c,f,_){let w=0;if(n.name==="exponential")w=ll(c,n.base,f,_);else if(n.name==="linear")w=ll(c,1,f,_);else if(n.name==="cubic-bezier"){const x=n.controlPoints;w=new Gd(x[0],x[1],x[2],x[3]).solve(ll(c,1,f,_))}return w}static parse(n,c){let[f,_,w,...x]=n;if(!Array.isArray(_)||_.length===0)return c.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const A=_[1];if(typeof A!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:A}}else{if(_[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const A=_.slice(1);if(A.length!==4||A.some(z=>typeof z!="number"||z<0||z>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:A}}}if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,vt),!w)return null;const T=[];let C=null;f==="interpolate-hcl"||f==="interpolate-lab"?C=Sn:c.expectedType&&c.expectedType.kind!=="value"&&(C=c.expectedType);for(let A=0;A<x.length;A+=2){const z=x[A],B=x[A+1],$=A+3,W=A+4;if(typeof z!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=z)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const ie=c.parse(B,W,C);if(!ie)return null;C=C||ie.type,T.push([z,ie])}return Ue(C,vt)||Ue(C,Sn)||Ue(C,Hr)||Ue(C,ye)||Ue(C,q(vt))?new kr(C,f,_,w,T):c.error(`Type ${V(C)} is not interpolatable.`)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const _=this.input.evaluate(n);if(_<=c[0])return f[0].evaluate(n);const w=c.length;if(_>=c[w-1])return f[w-1].evaluate(n);const x=al(c,_),T=kr.interpolationFactor(this.interpolation,_,c[x],c[x+1]),C=f[x].evaluate(n),A=f[x+1].evaluate(n);switch(this.operator){case"interpolate":return xr[this.type.kind](C,A,T);case"interpolate-hcl":return xr.color(C,A,T,"hcl");case"interpolate-lab":return xr.color(C,A,T,"lab")}}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function ll(a,n,c,f){const _=f-c,w=a-c;return _===0?0:n===1?w/_:(Math.pow(n,w)-1)/(Math.pow(n,_)-1)}class cl{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expectected at least one argument.");let f=null;const _=c.expectedType;_&&_.kind!=="value"&&(f=_);const w=[];for(const T of n.slice(1)){const C=c.parse(T,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,w.push(C)}if(!f)throw new Error("No output type");const x=_&&w.some(T=>pe(_,T.type));return new cl(x?ei:f,w)}evaluate(n){let c,f=null,_=0;for(const w of this.args)if(_++,f=w.evaluate(n),f&&f instanceof Nr&&!f.available&&(c||(c=f.name),f=null,_===this.args.length&&(f=c)),f!==null)break;return f}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function ul(a,n){return a==="=="||a==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function fh(a,n,c,f){return f.compare(n,c)===0}function Ps(a,n,c){const f=a!=="=="&&a!=="!=";return class l1{constructor(w,x,T){this.type=Jt,this.lhs=w,this.rhs=x,this.collator=T,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const T=w[0];let C=x.parse(w[1],1,ei);if(!C)return null;if(!ul(T,C.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${V(C.type)}'.`);let A=x.parse(w[2],2,ei);if(!A)return null;if(!ul(T,A.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${V(A.type)}'.`);if(C.type.kind!==A.type.kind&&C.type.kind!=="value"&&A.type.kind!=="value")return x.error(`Cannot compare types '${V(C.type)}' and '${V(A.type)}'.`);f&&(C.type.kind==="value"&&A.type.kind!=="value"?C=new oo(A.type,[C]):C.type.kind!=="value"&&A.type.kind==="value"&&(A=new oo(C.type,[A])));let z=null;if(w.length===4){if(C.type.kind!=="string"&&A.type.kind!=="string"&&C.type.kind!=="value"&&A.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(z=x.parse(w[3],3,vr),!z)return null}return new l1(C,A,z)}evaluate(w){const x=this.lhs.evaluate(w),T=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const C=zn(x),A=zn(T);if(C.kind!==A.kind||C.kind!=="string"&&C.kind!=="number")throw new Mn(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${C.kind}, ${A.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=zn(x),A=zn(T);if(C.kind!=="string"||A.kind!=="string")return n(w,x,T)}return this.collator?c(w,x,T,this.collator.evaluate(w)):n(w,x,T)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Wd=Ps("==",function(a,n,c){return n===c},fh),ph=Ps("!=",function(a,n,c){return n!==c},function(a,n,c,f){return!fh(0,n,c,f)}),mh=Ps("<",function(a,n,c){return n<c},function(a,n,c,f){return f.compare(n,c)<0}),Hd=Ps(">",function(a,n,c){return n>c},function(a,n,c,f){return f.compare(n,c)>0}),Xd=Ps("<=",function(a,n,c){return n<=c},function(a,n,c,f){return f.compare(n,c)<=0}),_h=Ps(">=",function(a,n,c){return n>=c},function(a,n,c,f){return f.compare(n,c)>=0});class Ca{constructor(n,c,f){this.type=vr,this.locale=f,this.caseSensitive=n,this.diacriticSensitive=c}static parse(n,c){if(n.length!==2)return c.error("Expected one argument.");const f=n[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const _=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Jt);if(!_)return null;const w=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Jt);if(!w)return null;let x=null;return f.locale&&(x=c.parse(f.locale,1,li),!x)?null:new Ca(_,w,x)}evaluate(n){return new Sc(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class Mc{constructor(n,c,f,_,w){this.type=li,this.number=n,this.locale=c,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=w}static parse(n,c){if(n.length!==3)return c.error("Expected two arguments.");const f=c.parse(n[1],1,vt);if(!f)return null;const _=n[2];if(typeof _!="object"||Array.isArray(_))return c.error("NumberFormat options argument must be an object.");let w=null;if(_.locale&&(w=c.parse(_.locale,1,li),!w))return null;let x=null;if(_.currency&&(x=c.parse(_.currency,1,li),!x))return null;let T=null;if(_["min-fraction-digits"]&&(T=c.parse(_["min-fraction-digits"],1,vt),!T))return null;let C=null;return _["max-fraction-digits"]&&(C=c.parse(_["max-fraction-digits"],1,vt),!C)?null:new Mc(f,w,x,T,C)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class hl{constructor(n){this.type=Fr,this.sections=n}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const _=[];let w=!1;for(let x=1;x<=n.length-1;++x){const T=n[x];if(w&&typeof T=="object"&&!Array.isArray(T)){w=!1;let C=null;if(T["font-scale"]&&(C=c.parse(T["font-scale"],1,vt),!C))return null;let A=null;if(T["text-font"]&&(A=c.parse(T["text-font"],1,q(li)),!A))return null;let z=null;if(T["text-color"]&&(z=c.parse(T["text-color"],1,Sn),!z))return null;const B=_[_.length-1];B.scale=C,B.font=A,B.textColor=z}else{const C=c.parse(n[x],1,ei);if(!C)return null;const A=C.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,_.push({content:C,scale:null,font:null,textColor:null})}}return new hl(_)}evaluate(n){return new Br(this.sections.map(c=>{const f=c.content.evaluate(n);return zn(f)===wr?new Tc("",f,null,null,null):new Tc(Sa(f),null,c.scale?c.scale.evaluate(n):null,c.font?c.font.evaluate(n).join(","):null,c.textColor?c.textColor.evaluate(n):null)}))}eachChild(n){for(const c of this.sections)n(c.content),c.scale&&n(c.scale),c.font&&n(c.font),c.textColor&&n(c.textColor)}outputDefined(){return!1}}class Ac{constructor(n){this.type=wr,this.input=n}static parse(n,c){if(n.length!==2)return c.error("Expected two arguments.");const f=c.parse(n[1],1,li);return f?new Ac(f):c.error("No image name provided.")}evaluate(n){const c=this.input.evaluate(n),f=Nr.fromString(c);return f&&n.availableImages&&(f.available=n.availableImages.indexOf(c)>-1),f}eachChild(n){n(this.input)}outputDefined(){return!1}}class Pc{constructor(n){this.type=vt,this.input=n}static parse(n,c){if(n.length!==2)return c.error(`Expected 1 argument, but found ${n.length-1} instead.`);const f=c.parse(n[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${V(f.type)} instead.`):new Pc(f):null}evaluate(n){const c=this.input.evaluate(n);if(typeof c=="string")return[...c].length;if(Array.isArray(c))return c.length;throw new Mn(`Expected value to be of type string or array, but found ${V(zn(c))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const wo=8192;function Kd(a,n){const c=(180+a[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,n.z);return[Math.round(c*_*wo),Math.round(f*_*wo)]}function zc(a,n){const c=Math.pow(2,n.z);return[(_=(a[0]/wo+n.x)/c,360*_-180),(f=(a[1]/wo+n.y)/c,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,_}function ts(a,n){a[0]=Math.min(a[0],n[0]),a[1]=Math.min(a[1],n[1]),a[2]=Math.max(a[2],n[0]),a[3]=Math.max(a[3],n[1])}function Zo(a,n){return!(a[0]<=n[0]||a[2]>=n[2]||a[1]<=n[1]||a[3]>=n[3])}function Ui(a,n,c){const f=a[0]-n[0],_=a[1]-n[1],w=a[0]-c[0],x=a[1]-c[1];return f*x-w*_==0&&f*w<=0&&_*x<=0}function dl(a,n,c,f){return(_=[f[0]-c[0],f[1]-c[1]])[0]*(w=[n[0]-a[0],n[1]-a[1]])[1]-_[1]*w[0]!=0&&!(!yh(a,n,c,f)||!yh(c,f,a,n));var _,w}function Jd(a,n,c){for(const f of c)for(let _=0;_<f.length-1;++_)if(dl(a,n,f[_],f[_+1]))return!0;return!1}function zs(a,n,c=!1){let f=!1;for(const T of n)for(let C=0;C<T.length-1;C++){if(Ui(a,T[C],T[C+1]))return c;(w=T[C])[1]>(_=a)[1]!=(x=T[C+1])[1]>_[1]&&_[0]<(x[0]-w[0])*(_[1]-w[1])/(x[1]-w[1])+w[0]&&(f=!f)}var _,w,x;return f}function Yd(a,n){for(const c of n)if(zs(a,c))return!0;return!1}function gh(a,n){for(const c of a)if(!zs(c,n))return!1;for(let c=0;c<a.length-1;++c)if(Jd(a[c],a[c+1],n))return!1;return!0}function Qd(a,n){for(const c of n)if(gh(a,c))return!0;return!1}function yh(a,n,c,f){const _=f[0]-c[0],w=f[1]-c[1],x=(a[0]-c[0])*w-_*(a[1]-c[1]),T=(n[0]-c[0])*w-_*(n[1]-c[1]);return x>0&&T<0||x<0&&T>0}function Dc(a,n,c){const f=[];for(let _=0;_<a.length;_++){const w=[];for(let x=0;x<a[_].length;x++){const T=Kd(a[_][x],c);ts(n,T),w.push(T)}f.push(w)}return f}function bh(a,n,c){const f=[];for(let _=0;_<a.length;_++){const w=Dc(a[_],n,c);f.push(w)}return f}function vh(a,n,c,f){if(a[0]<c[0]||a[0]>c[2]){const _=.5*f;let w=a[0]-c[0]>_?-f:c[0]-a[0]>_?f:0;w===0&&(w=a[0]-c[2]>_?-f:c[2]-a[0]>_?f:0),a[0]+=w}ts(n,a)}function wh(a,n,c,f){const _=Math.pow(2,f.z)*wo,w=[f.x*wo,f.y*wo],x=[];for(const T of a)for(const C of T){const A=[C.x+w[0],C.y+w[1]];vh(A,n,c,_),x.push(A)}return x}function xh(a,n,c,f){const _=Math.pow(2,f.z)*wo,w=[f.x*wo,f.y*wo],x=[];for(const C of a){const A=[];for(const z of C){const B=[z.x+w[0],z.y+w[1]];ts(n,B),A.push(B)}x.push(A)}if(n[2]-n[0]<=_/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of x)for(const A of C)vh(A,n,c,_)}var T;return x}class is{constructor(n,c){this.type=Jt,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Yo(n[1])){const f=n[1];if(f.type==="FeatureCollection"){const _=[];for(const w of f.features){const{type:x,coordinates:T}=w.geometry;x==="Polygon"&&_.push(T),x==="MultiPolygon"&&_.push(...T)}if(_.length)return new is(f,{type:"MultiPolygon",coordinates:_})}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new is(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new is(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Dc(f.coordinates,w,x),C=wh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!zs(A,T))return!1}if(f.type==="MultiPolygon"){const T=bh(f.coordinates,w,x),C=wh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!Yd(A,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Dc(f.coordinates,w,x),C=xh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!gh(A,T))return!1}if(f.type==="MultiPolygon"){const T=bh(f.coordinates,w,x),C=xh(c.geometry(),_,w,x);if(!Zo(_,w))return!1;for(const A of C)if(!Qd(A,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let kh=class{constructor(a=[],n=(c,f)=>c<f?-1:c>f?1:0){if(this.data=a,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:n,compare:c}=this,f=n[a];for(;a>0;){const _=a-1>>1,w=n[_];if(c(f,w)>=0)break;n[a]=w,a=_}n[a]=f}_down(a){const{data:n,compare:c}=this,f=this.length>>1,_=n[a];for(;a<f;){let w=1+(a<<1);const x=w+1;if(x<this.length&&c(n[x],n[w])<0&&(w=x),c(n[w],_)>=0)break;n[a]=n[w],a=w}n[a]=_}};function ef(a,n,c,f,_){Sh(a,n,c,f||a.length-1,_||tf)}function Sh(a,n,c,f,_){for(;f>c;){if(f-c>600){var w=f-c+1,x=n-c+1,T=Math.log(w),C=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*C*(w-C)/w)*(x-w/2<0?-1:1);Sh(a,n,Math.max(c,Math.floor(n-x*C/w+A)),Math.min(f,Math.floor(n+(w-x)*C/w+A)),_)}var z=a[n],B=c,$=f;for(Ea(a,c,n),_(a[f],z)>0&&Ea(a,c,f);B<$;){for(Ea(a,B,$),B++,$--;_(a[B],z)<0;)B++;for(;_(a[$],z)>0;)$--}_(a[c],z)===0?Ea(a,c,$):Ea(a,++$,f),$<=n&&(c=$+1),n<=$&&(f=$-1)}}function Ea(a,n,c){var f=a[n];a[n]=a[c],a[c]=f}function tf(a,n){return a<n?-1:a>n?1:0}function fl(a,n){if(a.length<=1)return[a];const c=[];let f,_;for(const w of a){const x=rf(w);x!==0&&(w.area=Math.abs(x),_===void 0&&(_=x<0),_===x<0?(f&&c.push(f),f=[w]):f.push(w))}if(f&&c.push(f),n>1)for(let w=0;w<c.length;w++)c[w].length<=n||(ef(c[w],n,1,c[w].length-1,nf),c[w]=c[w].slice(0,n));return c}function nf(a,n){return n.area-a.area}function rf(a){let n=0;for(let c,f,_=0,w=a.length,x=w-1;_<w;x=_++)c=a[_],f=a[x],n+=(f.x-c.x)*(c.y+f.y);return n}const Th=1/298.257223563,Ih=Th*(2-Th),Ch=Math.PI/180;class Rc{constructor(n){const c=6378.137*Ch*1e3,f=Math.cos(n*Ch),_=1/(1-Ih*(1-f*f)),w=Math.sqrt(_);this.kx=c*w*f,this.ky=c*w*_*(1-Ih)}distance(n,c){const f=this.wrap(n[0]-c[0])*this.kx,_=(n[1]-c[1])*this.ky;return Math.sqrt(f*f+_*_)}pointOnLine(n,c){let f,_,w,x,T=1/0;for(let C=0;C<n.length-1;C++){let A=n[C][0],z=n[C][1],B=this.wrap(n[C+1][0]-A)*this.kx,$=(n[C+1][1]-z)*this.ky,W=0;B===0&&$===0||(W=(this.wrap(c[0]-A)*this.kx*B+(c[1]-z)*this.ky*$)/(B*B+$*$),W>1?(A=n[C+1][0],z=n[C+1][1]):W>0&&(A+=B/this.kx*W,z+=$/this.ky*W)),B=this.wrap(c[0]-A)*this.kx,$=(c[1]-z)*this.ky;const ie=B*B+$*$;ie<T&&(T=ie,f=A,_=z,w=C,x=W)}return{point:[f,_],index:w,t:Math.max(0,Math.min(1,x))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Eh(a,n){return n[0]-a[0]}function pl(a){return a[1]-a[0]+1}function Do(a,n){return a[1]>=a[0]&&a[1]<n}function Fc(a,n){if(a[0]>a[1])return[null,null];const c=pl(a);if(n){if(c===2)return[a,null];const _=Math.floor(c/2);return[[a[0],a[0]+_],[a[0]+_,a[1]]]}if(c===1)return[a,null];const f=Math.floor(c/2)-1;return[[a[0],a[0]+f],[a[0]+f+1,a[1]]]}function Bc(a,n){if(!Do(n,a.length))return[1/0,1/0,-1/0,-1/0];const c=[1/0,1/0,-1/0,-1/0];for(let f=n[0];f<=n[1];++f)ts(c,a[f]);return c}function Oc(a){const n=[1/0,1/0,-1/0,-1/0];for(const c of a)for(const f of c)ts(n,f);return n}function ml(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Nc(a,n,c){if(!ml(a)||!ml(n))return NaN;let f=0,_=0;return a[2]<n[0]&&(f=n[0]-a[2]),a[0]>n[2]&&(f=a[0]-n[2]),a[1]>n[3]&&(_=a[1]-n[3]),a[3]<n[1]&&(_=n[1]-a[3]),c.distance([0,0],[f,_])}function ns(a,n,c){const f=c.pointOnLine(n,a);return c.distance(a,f.point)}function jc(a,n,c,f,_){const w=Math.min(ns(a,[c,f],_),ns(n,[c,f],_)),x=Math.min(ns(c,[a,n],_),ns(f,[a,n],_));return Math.min(w,x)}function of(a,n,c,f,_){if(!Do(n,a.length)||!Do(f,c.length))return 1/0;let w=1/0;for(let x=n[0];x<n[1];++x){const T=a[x],C=a[x+1];for(let A=f[0];A<f[1];++A){const z=c[A],B=c[A+1];if(dl(T,C,z,B))return 0;w=Math.min(w,jc(T,C,z,B,_))}}return w}function Tn(a,n,c,f,_){if(!Do(n,a.length)||!Do(f,c.length))return NaN;let w=1/0;for(let x=n[0];x<=n[1];++x)for(let T=f[0];T<=f[1];++T)if(w=Math.min(w,_.distance(a[x],c[T])),w===0)return w;return w}function sf(a,n,c){if(zs(a,n,!0))return 0;let f=1/0;for(const _ of n){const w=_[0],x=_[_.length-1];if(w!==x&&(f=Math.min(f,ns(a,[x,w],c)),f===0))return f;const T=c.pointOnLine(_,a);if(f=Math.min(f,c.distance(a,T.point)),f===0)return f}return f}function yi(a,n,c,f){if(!Do(n,a.length))return NaN;for(let w=n[0];w<=n[1];++w)if(zs(a[w],c,!0))return 0;let _=1/0;for(let w=n[0];w<n[1];++w){const x=a[w],T=a[w+1];for(const C of c)for(let A=0,z=C.length,B=z-1;A<z;B=A++){const $=C[B],W=C[A];if(dl(x,T,$,W))return 0;_=Math.min(_,jc(x,T,$,W,f))}}return _}function _l(a,n){for(const c of a)for(const f of c)if(zs(f,n,!0))return!0;return!1}function Ji(a,n,c,f=1/0){const _=Oc(a),w=Oc(n);if(f!==1/0&&Nc(_,w,c)>=f)return f;if(Zo(_,w)){if(_l(a,n))return 0}else if(_l(n,a))return 0;let x=1/0;for(const T of a)for(let C=0,A=T.length,z=A-1;C<A;z=C++){const B=T[z],$=T[C];for(const W of n)for(let ie=0,oe=W.length,_e=oe-1;ie<oe;_e=ie++){const ve=W[_e],Ze=W[ie];if(dl(B,$,ve,Ze))return 0;x=Math.min(x,jc(B,$,ve,Ze,c))}}return x}function Gi(a,n,c,f,_,w){if(!w)return;const x=Nc(Bc(f,w),_,c);x<n&&a.push([x,w,[0,0]])}function rs(a,n,c,f,_,w,x){if(!w||!x)return;const T=Nc(Bc(f,w),Bc(_,x),c);T<n&&a.push([T,w,x])}function La(a,n,c,f,_=1/0){let w=Math.min(f.distance(a[0],c[0][0]),_);if(w===0)return w;const x=new kh([[0,[0,a.length-1],[0,0]]],Eh),T=Oc(c);for(;x.length>0;){const C=x.pop();if(C[0]>=w)continue;const A=C[1],z=n?50:100;if(pl(A)<=z){if(!Do(A,a.length))return NaN;if(n){const B=yi(a,A,c,f);if(isNaN(B)||B===0)return B;w=Math.min(w,B)}else for(let B=A[0];B<=A[1];++B){const $=sf(a[B],c,f);if(w=Math.min(w,$),w===0)return 0}}else{const B=Fc(A,n);Gi(x,w,f,a,T,B[0]),Gi(x,w,f,a,T,B[1])}}return w}function Ma(a,n,c,f,_,w=1/0){let x=Math.min(w,_.distance(a[0],c[0]));if(x===0)return x;const T=new kh([[0,[0,a.length-1],[0,c.length-1]]],Eh);for(;T.length>0;){const C=T.pop();if(C[0]>=x)continue;const A=C[1],z=C[2],B=n?50:100,$=f?50:100;if(pl(A)<=B&&pl(z)<=$){if(!Do(A,a.length)&&Do(z,c.length))return NaN;let W;if(n&&f)W=of(a,A,c,z,_),x=Math.min(x,W);else if(n&&!f){const ie=a.slice(A[0],A[1]+1);for(let oe=z[0];oe<=z[1];++oe)if(W=ns(c[oe],ie,_),x=Math.min(x,W),x===0)return x}else if(!n&&f){const ie=c.slice(z[0],z[1]+1);for(let oe=A[0];oe<=A[1];++oe)if(W=ns(a[oe],ie,_),x=Math.min(x,W),x===0)return x}else W=Tn(a,A,c,z,_),x=Math.min(x,W)}else{const W=Fc(A,n),ie=Fc(z,f);rs(T,x,_,a,c,W[0],ie[0]),rs(T,x,_,a,c,W[0],ie[1]),rs(T,x,_,a,c,W[1],ie[0]),rs(T,x,_,a,c,W[1],ie[1])}}return x}function $c(a){return a.type==="MultiPolygon"?a.coordinates.map(n=>({type:"Polygon",coordinates:n})):a.type==="MultiLineString"?a.coordinates.map(n=>({type:"LineString",coordinates:n})):a.type==="MultiPoint"?a.coordinates.map(n=>({type:"Point",coordinates:n})):[a]}class os{constructor(n,c){this.type=vt,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Yo(n[1])){const f=n[1];if(f.type==="FeatureCollection")return new os(f,f.features.map(_=>$c(_.geometry)).flat());if(f.type==="Feature")return new os(f,$c(f.geometry));if("type"in f&&"coordinates"in f)return new os(f,$c(f))}return c.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,f){const _=c.geometry(),w=_.flat().map(C=>zc([C.x,C.y],c.canonical));if(_.length===0)return NaN;const x=new Rc(w[0][1]);let T=1/0;for(const C of f){switch(C.type){case"Point":T=Math.min(T,Ma(w,!1,[C.coordinates],!1,x,T));break;case"LineString":T=Math.min(T,Ma(w,!1,C.coordinates,!0,x,T));break;case"Polygon":T=Math.min(T,La(w,!1,C.coordinates,x,T))}if(T===0)return T}return T}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,f){const _=c.geometry(),w=_.flat().map(C=>zc([C.x,C.y],c.canonical));if(_.length===0)return NaN;const x=new Rc(w[0][1]);let T=1/0;for(const C of f){switch(C.type){case"Point":T=Math.min(T,Ma(w,!0,[C.coordinates],!1,x,T));break;case"LineString":T=Math.min(T,Ma(w,!0,C.coordinates,!0,x,T));break;case"Polygon":T=Math.min(T,La(w,!0,C.coordinates,x,T))}if(T===0)return T}return T}(n,this.geometries);if(n.geometryType()==="Polygon")return function(c,f){const _=c.geometry();if(_.length===0||_[0].length===0)return NaN;const w=fl(_,0).map(C=>C.map(A=>A.map(z=>zc([z.x,z.y],c.canonical)))),x=new Rc(w[0][0][0][1]);let T=1/0;for(const C of f)for(const A of w){switch(C.type){case"Point":T=Math.min(T,La([C.coordinates],!1,A,x,T));break;case"LineString":T=Math.min(T,La(C.coordinates,!0,A,x,T));break;case"Polygon":T=Math.min(T,Ji(A,C.coordinates,x,T))}if(T===0)return T}return T}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ds={"==":Wd,"!=":ph,">":Hd,"<":mh,">=":_h,"<=":Xd,array:oo,at:Cc,boolean:oo,case:sl,coalesce:cl,collator:Ca,format:hl,image:Ac,in:Ec,"index-of":Ms,interpolate:kr,"interpolate-hcl":kr,"interpolate-lab":kr,length:Pc,let:qo,literal:ro,match:Lc,number:oo,"number-format":Mc,object:oo,slice:Ta,step:As,string:oo,"to-boolean":so,"to-color":so,"to-number":so,"to-string":so,var:Bi,within:is,distance:os};class Kr{constructor(n,c,f,_){this.name=n,this.type=c,this._evaluate=f,this.args=_}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,c){const f=n[0],_=Kr.definitions[f];if(!_)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(_)?_[0]:_.type,x=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,T=x.filter(([A])=>!Array.isArray(A)||A.length===n.length-1);let C=null;for(const[A,z]of T){C=new Qo(c.registry,Aa,c.path,null,c.scope);const B=[];let $=!1;for(let W=1;W<n.length;W++){const ie=n[W],oe=Array.isArray(A)?A[W-1]:A.type,_e=C.parse(ie,1+B.length,oe);if(!_e){$=!0;break}B.push(_e)}if(!$)if(Array.isArray(A)&&A.length!==B.length)C.error(`Expected ${A.length} arguments, but found ${B.length} instead.`);else{for(let W=0;W<B.length;W++){const ie=Array.isArray(A)?A[W]:A.type,oe=B[W];C.concat(W+1).checkSubtype(ie,oe.type)}if(C.errors.length===0)return new Kr(f,w,z,B)}}if(T.length===1)c.errors.push(...C.errors);else{const A=(T.length?T:x).map(([B])=>{return $=B,Array.isArray($)?`(${$.map(V).join(", ")})`:`(${V($.type)}...)`;var $}).join(" | "),z=[];for(let B=1;B<n.length;B++){const $=c.parse(n[B],1+z.length);if(!$)return null;z.push(V($.type))}c.error(`Expected arguments of type ${A}, but found (${z.join(", ")}) instead.`)}return null}static register(n,c){Kr.definitions=c;for(const f in c)n[f]=Kr}}function Uc(a,[n,c,f,_]){n=n.evaluate(a),c=c.evaluate(a),f=f.evaluate(a);const w=_?_.evaluate(a):1,x=Ls(n,c,f,w);if(x)throw new Mn(x);return new qi(n/255,c/255,f/255,w,!1)}function Vc(a,n){return a in n}function qc(a,n){const c=n[a];return c===void 0?null:c}function ss(a){return{type:a}}function Aa(a){if(a instanceof Bi)return Aa(a.boundExpression);if(a instanceof Kr&&a.name==="error"||a instanceof Ca||a instanceof is||a instanceof os)return!1;const n=a instanceof so||a instanceof oo;let c=!0;return a.eachChild(f=>{c=n?c&&Aa(f):c&&f instanceof ro}),!!c&&Pa(a)&&za(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Pa(a){if(a instanceof Kr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof is||a instanceof os)return!1;let n=!0;return a.eachChild(c=>{n&&!Pa(c)&&(n=!1)}),n}function Rs(a){if(a instanceof Kr&&a.name==="feature-state")return!1;let n=!0;return a.eachChild(c=>{n&&!Rs(c)&&(n=!1)}),n}function za(a,n){if(a instanceof Kr&&n.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(f=>{c&&!za(f,n)&&(c=!1)}),c}function gl(a){return{result:"success",value:a}}function Fs(a){return{result:"error",value:a}}function Bs(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Lh(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Zc(a){return!!a.expression&&a.expression.interpolated}function Pi(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function yl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function af(a){return a}function Mh(a,n){const c=n.type==="color",f=a.stops&&typeof a.stops[0][0]=="object",_=f||!(f||a.property!==void 0),w=a.type||(Zc(n)?"exponential":"interval");if(c||n.type==="padding"){const z=c?qi.parse:Or.parse;(a=tr({},a)).stops&&(a.stops=a.stops.map(B=>[B[0],z(B[1])])),a.default=z(a.default?a.default:n.default)}if(a.colorSpace&&(x=a.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var x;let T,C,A;if(w==="exponential")T=Ph;else if(w==="interval")T=bl;else if(w==="categorical"){T=Ah,C=Object.create(null);for(const z of a.stops)C[z[0]]=z[1];A=typeof a.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);T=zh}if(f){const z={},B=[];for(let ie=0;ie<a.stops.length;ie++){const oe=a.stops[ie],_e=oe[0].zoom;z[_e]===void 0&&(z[_e]={zoom:_e,type:a.type,property:a.property,default:a.default,stops:[]},B.push(_e)),z[_e].stops.push([oe[0].value,oe[1]])}const $=[];for(const ie of B)$.push([z[ie].zoom,Mh(z[ie],n)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:kr.interpolationFactor.bind(void 0,W),zoomStops:$.map(ie=>ie[0]),evaluate:({zoom:ie},oe)=>Ph({stops:$,base:a.base},n,ie).evaluate(ie,oe)}}if(_){const z=w==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:kr.interpolationFactor.bind(void 0,z),zoomStops:a.stops.map(B=>B[0]),evaluate:({zoom:B})=>T(a,n,B,C,A)}}return{kind:"source",evaluate(z,B){const $=B&&B.properties?B.properties[a.property]:void 0;return $===void 0?Os(a.default,n.default):T(a,n,$,C,A)}}}function Os(a,n,c){return a!==void 0?a:n!==void 0?n:c!==void 0?c:void 0}function Ah(a,n,c,f,_){return Os(typeof c===_?f[c]:void 0,a.default,n.default)}function bl(a,n,c){if(Pi(c)!=="number")return Os(a.default,n.default);const f=a.stops.length;if(f===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[f-1][0])return a.stops[f-1][1];const _=al(a.stops.map(w=>w[0]),c);return a.stops[_][1]}function Ph(a,n,c){const f=a.base!==void 0?a.base:1;if(Pi(c)!=="number")return Os(a.default,n.default);const _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];const w=al(a.stops.map(z=>z[0]),c),x=function(z,B,$,W){const ie=W-$,oe=z-$;return ie===0?0:B===1?oe/ie:(Math.pow(B,oe)-1)/(Math.pow(B,ie)-1)}(c,f,a.stops[w][0],a.stops[w+1][0]),T=a.stops[w][1],C=a.stops[w+1][1],A=xr[n.type]||af;return typeof T.evaluate=="function"?{evaluate(...z){const B=T.evaluate.apply(void 0,z),$=C.evaluate.apply(void 0,z);if(B!==void 0&&$!==void 0)return A(B,$,x,a.colorSpace)}}:A(T,C,x,a.colorSpace)}function zh(a,n,c){switch(n.type){case"color":c=qi.parse(c);break;case"formatted":c=Br.fromString(c.toString());break;case"resolvedImage":c=Nr.fromString(c.toString());break;case"padding":c=Or.parse(c);break;default:Pi(c)===n.type||n.type==="enum"&&n.values[c]||(c=void 0)}return Os(c,a.default,n.default)}Kr.register(Ds,{error:[{kind:"error"},[li],(a,[n])=>{throw new Mn(n.evaluate(a))}],typeof:[li,[ei],(a,[n])=>V(zn(n.evaluate(a)))],"to-rgba":[q(vt,4),[Sn],(a,[n])=>{const[c,f,_,w]=n.evaluate(a).rgb;return[255*c,255*f,255*_,w]}],rgb:[Sn,[vt,vt,vt],Uc],rgba:[Sn,[vt,vt,vt,vt],Uc],has:{type:Jt,overloads:[[[li],(a,[n])=>Vc(n.evaluate(a),a.properties())],[[li,Bn],(a,[n,c])=>Vc(n.evaluate(a),c.evaluate(a))]]},get:{type:ei,overloads:[[[li],(a,[n])=>qc(n.evaluate(a),a.properties())],[[li,Bn],(a,[n,c])=>qc(n.evaluate(a),c.evaluate(a))]]},"feature-state":[ei,[li],(a,[n])=>qc(n.evaluate(a),a.featureState||{})],properties:[Bn,[],a=>a.properties()],"geometry-type":[li,[],a=>a.geometryType()],id:[ei,[],a=>a.id()],zoom:[vt,[],a=>a.globals.zoom],"heatmap-density":[vt,[],a=>a.globals.heatmapDensity||0],"line-progress":[vt,[],a=>a.globals.lineProgress||0],accumulated:[ei,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[vt,ss(vt),(a,n)=>{let c=0;for(const f of n)c+=f.evaluate(a);return c}],"*":[vt,ss(vt),(a,n)=>{let c=1;for(const f of n)c*=f.evaluate(a);return c}],"-":{type:vt,overloads:[[[vt,vt],(a,[n,c])=>n.evaluate(a)-c.evaluate(a)],[[vt],(a,[n])=>-n.evaluate(a)]]},"/":[vt,[vt,vt],(a,[n,c])=>n.evaluate(a)/c.evaluate(a)],"%":[vt,[vt,vt],(a,[n,c])=>n.evaluate(a)%c.evaluate(a)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(a,[n,c])=>Math.pow(n.evaluate(a),c.evaluate(a))],sqrt:[vt,[vt],(a,[n])=>Math.sqrt(n.evaluate(a))],log10:[vt,[vt],(a,[n])=>Math.log(n.evaluate(a))/Math.LN10],ln:[vt,[vt],(a,[n])=>Math.log(n.evaluate(a))],log2:[vt,[vt],(a,[n])=>Math.log(n.evaluate(a))/Math.LN2],sin:[vt,[vt],(a,[n])=>Math.sin(n.evaluate(a))],cos:[vt,[vt],(a,[n])=>Math.cos(n.evaluate(a))],tan:[vt,[vt],(a,[n])=>Math.tan(n.evaluate(a))],asin:[vt,[vt],(a,[n])=>Math.asin(n.evaluate(a))],acos:[vt,[vt],(a,[n])=>Math.acos(n.evaluate(a))],atan:[vt,[vt],(a,[n])=>Math.atan(n.evaluate(a))],min:[vt,ss(vt),(a,n)=>Math.min(...n.map(c=>c.evaluate(a)))],max:[vt,ss(vt),(a,n)=>Math.max(...n.map(c=>c.evaluate(a)))],abs:[vt,[vt],(a,[n])=>Math.abs(n.evaluate(a))],round:[vt,[vt],(a,[n])=>{const c=n.evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[vt,[vt],(a,[n])=>Math.floor(n.evaluate(a))],ceil:[vt,[vt],(a,[n])=>Math.ceil(n.evaluate(a))],"filter-==":[Jt,[li,ei],(a,[n,c])=>a.properties()[n.value]===c.value],"filter-id-==":[Jt,[ei],(a,[n])=>a.id()===n.value],"filter-type-==":[Jt,[li],(a,[n])=>a.geometryType()===n.value],"filter-<":[Jt,[li,ei],(a,[n,c])=>{const f=a.properties()[n.value],_=c.value;return typeof f==typeof _&&f<_}],"filter-id-<":[Jt,[ei],(a,[n])=>{const c=a.id(),f=n.value;return typeof c==typeof f&&c<f}],"filter->":[Jt,[li,ei],(a,[n,c])=>{const f=a.properties()[n.value],_=c.value;return typeof f==typeof _&&f>_}],"filter-id->":[Jt,[ei],(a,[n])=>{const c=a.id(),f=n.value;return typeof c==typeof f&&c>f}],"filter-<=":[Jt,[li,ei],(a,[n,c])=>{const f=a.properties()[n.value],_=c.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[Jt,[ei],(a,[n])=>{const c=a.id(),f=n.value;return typeof c==typeof f&&c<=f}],"filter->=":[Jt,[li,ei],(a,[n,c])=>{const f=a.properties()[n.value],_=c.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[Jt,[ei],(a,[n])=>{const c=a.id(),f=n.value;return typeof c==typeof f&&c>=f}],"filter-has":[Jt,[ei],(a,[n])=>n.value in a.properties()],"filter-has-id":[Jt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Jt,[q(li)],(a,[n])=>n.value.indexOf(a.geometryType())>=0],"filter-id-in":[Jt,[q(ei)],(a,[n])=>n.value.indexOf(a.id())>=0],"filter-in-small":[Jt,[li,q(ei)],(a,[n,c])=>c.value.indexOf(a.properties()[n.value])>=0],"filter-in-large":[Jt,[li,q(ei)],(a,[n,c])=>function(f,_,w,x){for(;w<=x;){const T=w+x>>1;if(_[T]===f)return!0;_[T]>f?x=T-1:w=T+1}return!1}(a.properties()[n.value],c.value,0,c.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(a,[n,c])=>n.evaluate(a)&&c.evaluate(a)],[ss(Jt),(a,n)=>{for(const c of n)if(!c.evaluate(a))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(a,[n,c])=>n.evaluate(a)||c.evaluate(a)],[ss(Jt),(a,n)=>{for(const c of n)if(c.evaluate(a))return!0;return!1}]]},"!":[Jt,[Jt],(a,[n])=>!n.evaluate(a)],"is-supported-script":[Jt,[li],(a,[n])=>{const c=a.globals&&a.globals.isSupportedScript;return!c||c(n.evaluate(a))}],upcase:[li,[li],(a,[n])=>n.evaluate(a).toUpperCase()],downcase:[li,[li],(a,[n])=>n.evaluate(a).toLowerCase()],concat:[li,ss(ei),(a,n)=>n.map(c=>Sa(c.evaluate(a))).join("")],"resolved-locale":[li,[vr],(a,[n])=>n.evaluate(a).resolvedLocale()]});class vl{constructor(n,c){var f;this.expression=n,this._warningHistory={},this._evaluator=new ol,this._defaultValue=c?(f=c).type==="color"&&yl(f.default)?new qi(0,0,0,0):f.type==="color"?qi.parse(f.default)||null:f.type==="padding"?Or.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Xr.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(n,c,f,_,w,x){return this._evaluator.globals=n,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(n,c,f,_,w,x){this._evaluator.globals=n,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Mn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function wl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ds}function Ns(a,n){const c=new Qo(Ds,Aa,[],n?function(_){const w={color:Sn,string:li,number:vt,enum:li,boolean:Jt,formatted:Fr,padding:Hr,resolvedImage:wr,variableAnchorOffsetCollection:ye};return _.type==="array"?q(w[_.value]||ei,_.length):w[_.type]}(n):void 0),f=c.parse(a,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?gl(new vl(f,n)):Fs(c.errors)}class js{constructor(n,c){this.kind=n,this._styleExpression=c,this.isStateDependent=n!=="constant"&&!Rs(c.expression)}evaluateWithoutErrorHandling(n,c,f,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,_,w,x)}evaluate(n,c,f,_,w,x){return this._styleExpression.evaluate(n,c,f,_,w,x)}}class $s{constructor(n,c,f,_){this.kind=n,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=n!=="camera"&&!Rs(c.expression),this.interpolationType=_}evaluateWithoutErrorHandling(n,c,f,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,_,w,x)}evaluate(n,c,f,_,w,x){return this._styleExpression.evaluate(n,c,f,_,w,x)}interpolationFactor(n,c,f){return this.interpolationType?kr.interpolationFactor(this.interpolationType,n,c,f):0}}function Gc(a,n){const c=Ns(a,n);if(c.result==="error")return c;const f=c.value.expression,_=Pa(f);if(!_&&!Bs(n))return Fs([new dn("","data expressions not supported")]);const w=za(f,["zoom"]);if(!w&&!Lh(n))return Fs([new dn("","zoom expressions not supported")]);const x=Da(f);return x||w?x instanceof dn?Fs([x]):x instanceof kr&&!Zc(n)?Fs([new dn("",'"interpolate" expressions cannot be used with this property')]):gl(x?new $s(_?"camera":"composite",c.value,x.labels,x instanceof kr?x.interpolation:void 0):new js(_?"constant":"source",c.value)):Fs([new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Us{constructor(n,c){this._parameters=n,this._specification=c,tr(this,Mh(this._parameters,this._specification))}static deserialize(n){return new Us(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Da(a){let n=null;if(a instanceof qo)n=Da(a.result);else if(a instanceof cl){for(const c of a.args)if(n=Da(c),n)break}else(a instanceof As||a instanceof kr)&&a.input instanceof Kr&&a.input.name==="zoom"&&(n=a);return n instanceof dn||a.eachChild(c=>{const f=Da(c);f instanceof dn?n=f:!n&&f?n=new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&f&&n!==f&&(n=new dn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function xl(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const n of a.slice(1))if(!xl(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const kl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wc(a){if(a==null)return{filter:()=>!0,needGeometry:!1};xl(a)||(a=Sl(a));const n=Ns(a,kl);if(n.result==="error")throw new Error(n.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,_)=>n.value.evaluate(c,f,{},_),needGeometry:Dh(a)}}function lf(a,n){return a<n?-1:a>n?1:0}function Dh(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let n=1;n<a.length;n++)if(Dh(a[n]))return!0;return!1}function Sl(a){if(!a)return!0;const n=a[0];return a.length<=1?n!=="any":n==="=="?Hc(a[1],a[2],"=="):n==="!="?ir(Hc(a[1],a[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Hc(a[1],a[2],n):n==="any"?(c=a.slice(1),["any"].concat(c.map(Sl))):n==="all"?["all"].concat(a.slice(1).map(Sl)):n==="none"?["all"].concat(a.slice(1).map(Sl).map(ir)):n==="in"?Ra(a[1],a.slice(2)):n==="!in"?ir(Ra(a[1],a.slice(2))):n==="has"?Fa(a[1]):n!=="!has"||ir(Fa(a[1]));var c}function Hc(a,n,c){switch(a){case"$type":return[`filter-type-${c}`,n];case"$id":return[`filter-id-${c}`,n];default:return[`filter-${c}`,a,n]}}function Ra(a,n){if(n.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(c=>typeof c!=typeof n[0])?["filter-in-large",a,["literal",n.sort(lf)]]:["filter-in-small",a,["literal",n]]}}function Fa(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ir(a){return["!",a]}function as(a){const n=typeof a;if(n==="number"||n==="boolean"||n==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let _="[";for(const w of a)_+=`${as(w)},`;return`${_}]`}const c=Object.keys(a).sort();let f="{";for(let _=0;_<c.length;_++)f+=`${JSON.stringify(c[_])}:${as(a[c[_]])},`;return`${f}}`}function Rh(a){let n="";for(const c of mt)n+=`/${as(a[c])}`;return n}function Fh(a){const n=a.value;return n?[new ct(a.key,n,"constants have been deprecated as of v8")]:[]}function In(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ao(a){if(Array.isArray(a))return a.map(ao);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const n={};for(const c in a)n[c]=ao(a[c]);return n}return In(a)}function jr(a){const n=a.key,c=a.value,f=a.valueSpec||{},_=a.objectElementValidators||{},w=a.style,x=a.styleSpec,T=a.validateSpec;let C=[];const A=Pi(c);if(A!=="object")return[new ct(n,c,`object expected, ${A} found`)];for(const z in c){const B=z.split(".")[0],$=f[B]||f["*"];let W;if(_[B])W=_[B];else if(f[B])W=T;else if(_["*"])W=_["*"];else{if(!f["*"]){C.push(new ct(n,c[z],`unknown property "${z}"`));continue}W=T}C=C.concat(W({key:(n&&`${n}.`)+z,value:c[z],valueSpec:$,style:w,styleSpec:x,object:c,objectKey:z,validateSpec:T},c))}for(const z in f)_[z]||f[z].required&&f[z].default===void 0&&c[z]===void 0&&C.push(new ct(n,c,`missing required property "${z}"`));return C}function Ba(a){const n=a.value,c=a.valueSpec,f=a.style,_=a.styleSpec,w=a.key,x=a.arrayElementValidator||a.validateSpec;if(Pi(n)!=="array")return[new ct(w,n,`array expected, ${Pi(n)} found`)];if(c.length&&n.length!==c.length)return[new ct(w,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new ct(w,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let T={type:c.value,values:c.values};_.$version<7&&(T.function=c.function),Pi(c.value)==="object"&&(T=c.value);let C=[];for(let A=0;A<n.length;A++)C=C.concat(x({array:n,arrayIndex:A,value:n[A],valueSpec:T,validateSpec:a.validateSpec,style:f,styleSpec:_,key:`${w}[${A}]`}));return C}function Xc(a){const n=a.key,c=a.value,f=a.valueSpec;let _=Pi(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new ct(n,c,`number expected, ${_} found`)]:"minimum"in f&&c<f.minimum?[new ct(n,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new ct(n,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function Tl(a){const n=a.valueSpec,c=In(a.value.type);let f,_,w,x={};const T=c!=="categorical"&&a.value.property===void 0,C=!T,A=Pi(a.value.stops)==="array"&&Pi(a.value.stops[0])==="array"&&Pi(a.value.stops[0][0])==="object",z=jr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(W){if(c==="identity")return[new ct(W.key,W.value,'identity function may not have a "stops" property')];let ie=[];const oe=W.value;return ie=ie.concat(Ba({key:W.key,value:oe,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:B})),Pi(oe)==="array"&&oe.length===0&&ie.push(new ct(W.key,oe,"array must have at least one stop")),ie},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:n,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return c==="identity"&&T&&z.push(new ct(a.key,a.value,'missing required property "property"')),c==="identity"||a.value.stops||z.push(new ct(a.key,a.value,'missing required property "stops"')),c==="exponential"&&a.valueSpec.expression&&!Zc(a.valueSpec)&&z.push(new ct(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(C&&!Bs(a.valueSpec)?z.push(new ct(a.key,a.value,"property functions not supported")):T&&!Lh(a.valueSpec)&&z.push(new ct(a.key,a.value,"zoom functions not supported"))),c!=="categorical"&&!A||a.value.property!==void 0||z.push(new ct(a.key,a.value,'"property" property is required')),z;function B(W){let ie=[];const oe=W.value,_e=W.key;if(Pi(oe)!=="array")return[new ct(_e,oe,`array expected, ${Pi(oe)} found`)];if(oe.length!==2)return[new ct(_e,oe,`array length 2 expected, length ${oe.length} found`)];if(A){if(Pi(oe[0])!=="object")return[new ct(_e,oe,`object expected, ${Pi(oe[0])} found`)];if(oe[0].zoom===void 0)return[new ct(_e,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new ct(_e,oe,"object stop key must have value")];if(w&&w>In(oe[0].zoom))return[new ct(_e,oe[0].zoom,"stop zoom values must appear in ascending order")];In(oe[0].zoom)!==w&&(w=In(oe[0].zoom),_=void 0,x={}),ie=ie.concat(jr({key:`${_e}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Xc,value:$}}))}else ie=ie.concat($({key:`${_e}[0]`,value:oe[0],valueSpec:{},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},oe));return wl(ao(oe[1]))?ie.concat([new ct(`${_e}[1]`,oe[1],"expressions are not allowed in function stops.")]):ie.concat(W.validateSpec({key:`${_e}[1]`,value:oe[1],valueSpec:n,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function $(W,ie){const oe=Pi(W.value),_e=In(W.value),ve=W.value!==null?W.value:ie;if(f){if(oe!==f)return[new ct(W.key,ve,`${oe} stop domain type must match previous stop domain type ${f}`)]}else f=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new ct(W.key,ve,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&c!=="categorical"){let Ze=`number expected, ${oe} found`;return Bs(n)&&c===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(W.key,ve,Ze)]}return c!=="categorical"||oe!=="number"||isFinite(_e)&&Math.floor(_e)===_e?c!=="categorical"&&oe==="number"&&_!==void 0&&_e<_?[new ct(W.key,ve,"stop domain values must appear in ascending order")]:(_=_e,c==="categorical"&&_e in x?[new ct(W.key,ve,"stop domain values must be unique")]:(x[_e]=!0,[])):[new ct(W.key,ve,`integer expected, found ${_e}`)]}}function Vs(a){const n=(a.expressionContext==="property"?Gc:Ns)(ao(a.value),a.valueSpec);if(n.result==="error")return n.value.map(f=>new ct(`${a.key}${f.key}`,a.value,f.message));const c=n.value.expression||n.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new ct(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Rs(c))return[new ct(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Rs(c))return[new ct(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!za(c,["zoom","feature-state"]))return[new ct(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Pa(c))return[new ct(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ro(a){const n=a.key,c=a.value,f=a.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(In(c))===-1&&_.push(new ct(n,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(In(c))===-1&&_.push(new ct(n,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Kc(a){return xl(ao(a.value))?Vs(tr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Il(a)}function Il(a){const n=a.value,c=a.key;if(Pi(n)!=="array")return[new ct(c,n,`array expected, ${Pi(n)} found`)];const f=a.styleSpec;let _,w=[];if(n.length<1)return[new ct(c,n,"filter array must have at least 1 element")];switch(w=w.concat(Ro({key:`${c}[0]`,value:n[0],valueSpec:f.filter_operator,style:a.style,styleSpec:a.styleSpec})),In(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&In(n[1])==="$type"&&w.push(new ct(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&w.push(new ct(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=Pi(n[1]),_!=="string"&&w.push(new ct(`${c}[1]`,n[1],`string expected, ${_} found`)));for(let x=2;x<n.length;x++)_=Pi(n[x]),In(n[1])==="$type"?w=w.concat(Ro({key:`${c}[${x}]`,value:n[x],valueSpec:f.geometry_type,style:a.style,styleSpec:a.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&w.push(new ct(`${c}[${x}]`,n[x],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)w=w.concat(Il({key:`${c}[${x}]`,value:n[x],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":_=Pi(n[1]),n.length!==2?w.push(new ct(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&w.push(new ct(`${c}[1]`,n[1],`string expected, ${_} found`))}return w}function Jc(a,n){const c=a.key,f=a.validateSpec,_=a.style,w=a.styleSpec,x=a.value,T=a.objectKey,C=w[`${n}_${a.layerType}`];if(!C)return[];const A=T.match(/^(.*)-transition$/);if(n==="paint"&&A&&C[A[1]]&&C[A[1]].transition)return f({key:c,value:x,valueSpec:w.transition,style:_,styleSpec:w});const z=a.valueSpec||C[T];if(!z)return[new ct(c,x,`unknown property "${T}"`)];let B;if(Pi(x)==="string"&&Bs(z)&&!z.tokens&&(B=/^{([^}]+)}$/.exec(x)))return[new ct(c,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const $=[];return a.layerType==="symbol"&&(T==="text-field"&&_&&!_.glyphs&&$.push(new ct(c,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&yl(ao(x))&&In(x.type)==="identity"&&$.push(new ct(c,x,'"text-font" does not support identity functions'))),$.concat(f({key:a.key,value:x,valueSpec:z,style:_,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:T}))}function Cl(a){return Jc(a,"paint")}function Yc(a){return Jc(a,"layout")}function Qc(a){let n=[];const c=a.value,f=a.key,_=a.style,w=a.styleSpec;c.type||c.ref||n.push(new ct(f,c,'either "type" or "ref" is required'));let x=In(c.type);const T=In(c.ref);if(c.id){const C=In(c.id);for(let A=0;A<a.arrayIndex;A++){const z=_.layers[A];In(z.id)===C&&n.push(new ct(f,c.id,`duplicate layer id "${c.id}", previously used at line ${z.id.__line__}`))}}if("ref"in c){let C;["type","source","source-layer","filter","layout"].forEach(A=>{A in c&&n.push(new ct(f,c[A],`"${A}" is prohibited for ref layers`))}),_.layers.forEach(A=>{In(A.id)===T&&(C=A)}),C?C.ref?n.push(new ct(f,c.ref,"ref cannot reference another ref layer")):x=In(C.type):n.push(new ct(f,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const C=_.sources&&_.sources[c.source],A=C&&In(C.type);C?A==="vector"&&x==="raster"?n.push(new ct(f,c.source,`layer "${c.id}" requires a raster source`)):A!=="raster-dem"&&x==="hillshade"?n.push(new ct(f,c.source,`layer "${c.id}" requires a raster-dem source`)):A==="raster"&&x!=="raster"?n.push(new ct(f,c.source,`layer "${c.id}" requires a vector source`)):A!=="vector"||c["source-layer"]?A==="raster-dem"&&x!=="hillshade"?n.push(new ct(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||A==="geojson"&&C.lineMetrics||n.push(new ct(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new ct(f,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new ct(f,c.source,`source "${c.source}" not found`))}else n.push(new ct(f,c,'missing required property "source"'));return n=n.concat(jr({key:f,value:c,valueSpec:w.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${f}.type`,value:c.type,valueSpec:w.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:c,objectKey:"type"}),filter:Kc,layout:C=>jr({layer:c,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":A=>Yc(tr({layerType:x},A))}}),paint:C=>jr({layer:c,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":A=>Cl(tr({layerType:x},A))}})}})),n}function ls(a){const n=a.value,c=a.key,f=Pi(n);return f!=="string"?[new ct(c,n,`string expected, ${f} found`)]:[]}const El={promoteId:function({key:a,value:n}){if(Pi(n)==="string")return ls({key:a,value:n});{const c=[];for(const f in n)c.push(...ls({key:`${a}.${f}`,value:n[f]}));return c}}};function Oa(a){const n=a.value,c=a.key,f=a.styleSpec,_=a.style,w=a.validateSpec;if(!n.type)return[new ct(c,n,'"type" is required')];const x=In(n.type);let T;switch(x){case"vector":case"raster":return T=jr({key:c,value:n,valueSpec:f[`source_${x.replace("-","_")}`],style:a.style,styleSpec:f,objectElementValidators:El,validateSpec:w}),T;case"raster-dem":return T=function(C){var A;const z=(A=C.sourceName)!==null&&A!==void 0?A:"",B=C.value,$=C.styleSpec,W=$.source_raster_dem,ie=C.style;let oe=[];const _e=Pi(B);if(B===void 0)return oe;if(_e!=="object")return oe.push(new ct("source_raster_dem",B,`object expected, ${_e} found`)),oe;const ve=In(B.encoding)==="custom",Ze=["redFactor","greenFactor","blueFactor","baseShift"],Ae=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const Oe in B)!ve&&Ze.includes(Oe)?oe.push(new ct(Oe,B[Oe],`In "${z}": "${Oe}" is only valid when "encoding" is set to "custom". ${Ae} encoding found`)):W[Oe]?oe=oe.concat(C.validateSpec({key:Oe,value:B[Oe],valueSpec:W[Oe],validateSpec:C.validateSpec,style:ie,styleSpec:$})):oe.push(new ct(Oe,B[Oe],`unknown property "${Oe}"`));return oe}({sourceName:c,value:n,style:a.style,styleSpec:f,validateSpec:w}),T;case"geojson":if(T=jr({key:c,value:n,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:w,objectElementValidators:El}),n.cluster)for(const C in n.clusterProperties){const[A,z]=n.clusterProperties[C],B=typeof A=="string"?[A,["accumulated"],["get",C]]:A;T.push(...Vs({key:`${c}.${C}.map`,value:z,validateSpec:w,expressionContext:"cluster-map"})),T.push(...Vs({key:`${c}.${C}.reduce`,value:B,validateSpec:w,expressionContext:"cluster-reduce"}))}return T;case"video":return jr({key:c,value:n,valueSpec:f.source_video,style:_,validateSpec:w,styleSpec:f});case"image":return jr({key:c,value:n,valueSpec:f.source_image,style:_,validateSpec:w,styleSpec:f});case"canvas":return[new ct(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ro({key:`${c}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:w,styleSpec:f})}}function eu(a){const n=a.value,c=a.styleSpec,f=c.light,_=a.style;let w=[];const x=Pi(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new ct("light",n,`object expected, ${x} found`)]),w;for(const T in n){const C=T.match(/^(.*)-transition$/);w=w.concat(C&&f[C[1]]&&f[C[1]].transition?a.validateSpec({key:T,value:n[T],valueSpec:c.transition,validateSpec:a.validateSpec,style:_,styleSpec:c}):f[T]?a.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:a.validateSpec,style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)])}return w}function tu(a){const n=a.value,c=a.styleSpec,f=c.sky,_=a.style,w=Pi(n);if(n===void 0)return[];if(w!=="object")return[new ct("sky",n,`object expected, ${w} found`)];let x=[];for(const T in n)x=x.concat(f[T]?a.validateSpec({key:T,value:n[T],valueSpec:f[T],style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)]);return x}function iu(a){const n=a.value,c=a.styleSpec,f=c.terrain,_=a.style;let w=[];const x=Pi(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new ct("terrain",n,`object expected, ${x} found`)]),w;for(const T in n)w=w.concat(f[T]?a.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:a.validateSpec,style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)]);return w}function nu(a){let n=[];const c=a.value,f=a.key;if(Array.isArray(c)){const _=[],w=[];for(const x in c)c[x].id&&_.includes(c[x].id)&&n.push(new ct(f,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),_.push(c[x].id),c[x].url&&w.includes(c[x].url)&&n.push(new ct(f,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),w.push(c[x].url),n=n.concat(jr({key:`${f}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return n}return ls({key:f,value:c})}const Ll={"*":()=>[],array:Ba,boolean:function(a){const n=a.value,c=a.key,f=Pi(n);return f!=="boolean"?[new ct(c,n,`boolean expected, ${f} found`)]:[]},number:Xc,color:function(a){const n=a.key,c=a.value,f=Pi(c);return f!=="string"?[new ct(n,c,`color expected, ${f} found`)]:qi.parse(String(c))?[]:[new ct(n,c,`color expected, "${c}" found`)]},constants:Fh,enum:Ro,filter:Kc,function:Tl,layer:Qc,object:jr,source:Oa,light:eu,sky:tu,terrain:iu,projection:function(a){const n=a.value,c=a.styleSpec,f=c.projection,_=a.style,w=Pi(n);if(n===void 0)return[];if(w!=="object")return[new ct("projection",n,`object expected, ${w} found`)];let x=[];for(const T in n)x=x.concat(f[T]?a.validateSpec({key:T,value:n[T],valueSpec:f[T],style:_,styleSpec:c}):[new ct(T,n[T],`unknown property "${T}"`)]);return x},string:ls,formatted:function(a){return ls(a).length===0?[]:Vs(a)},resolvedImage:function(a){return ls(a).length===0?[]:Vs(a)},padding:function(a){const n=a.key,c=a.value;if(Pi(c)==="array"){if(c.length<1||c.length>4)return[new ct(n,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let _=[];for(let w=0;w<c.length;w++)_=_.concat(a.validateSpec({key:`${n}[${w}]`,value:c[w],validateSpec:a.validateSpec,valueSpec:f}));return _}return Xc({key:n,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(a){const n=a.key,c=a.value,f=Pi(c),_=a.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new ct(n,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<c.length;x+=2)w=w.concat(Ro({key:`${n}[${x}]`,value:c[x],valueSpec:_.layout_symbol["text-anchor"]})),w=w.concat(Ba({key:`${n}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:_}));return w},sprite:nu};function qs(a){const n=a.value,c=a.valueSpec,f=a.styleSpec;return a.validateSpec=qs,c.expression&&yl(In(n))?Tl(a):c.expression&&wl(ao(n))?Vs(a):c.type&&Ll[c.type]?Ll[c.type](a):jr(tr({},a,{valueSpec:c.type?f[c.type]:c}))}function Bh(a){const n=a.value,c=a.key,f=ls(a);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new ct(c,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new ct(c,n,'"glyphs" url must include a "{range}" token'))),f}function Jr(a,n=Te){let c=[];return c=c.concat(qs({key:"",value:a,valueSpec:n.$root,styleSpec:n,style:a,validateSpec:qs,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),a.constants&&(c=c.concat(Fh({key:"constants",value:a.constants,style:a,styleSpec:n,validateSpec:qs}))),ru(c)}function xo(a){return function(n){return a({...n,validateSpec:qs})}}function ru(a){return[].concat(a).sort((n,c)=>n.line-c.line)}function lo(a){return function(...n){return ru(a.apply(this,n))}}Jr.source=lo(xo(Oa)),Jr.sprite=lo(xo(nu)),Jr.glyphs=lo(xo(Bh)),Jr.light=lo(xo(eu)),Jr.sky=lo(xo(tu)),Jr.terrain=lo(xo(iu)),Jr.layer=lo(xo(Qc)),Jr.filter=lo(xo(Kc)),Jr.paintProperty=lo(xo(Cl)),Jr.layoutProperty=lo(xo(Yc));const cs=Jr,cf=cs.light,uf=cs.sky,Oh=cs.paintProperty,Nh=cs.layoutProperty;function ou(a,n){let c=!1;if(n&&n.length)for(const f of n)a.fire(new qe(new Error(f.message))),c=!0;return c}class Zs{constructor(n,c,f){const _=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(c=x[1])+2*(f=x[2]);for(let C=0;C<this.d*this.d;C++){const A=x[3+C],z=x[3+C+1];_.push(A===z?null:x.subarray(A,z))}const T=x[3+_.length+1];this.keys=x.subarray(x[3+_.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let x=0;x<this.d*this.d;x++)_.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=f,this.scale=c/n,this.uid=0;const w=f/c*n;this.min=-w,this.max=n+w}insert(n,c,f,_,w){this._forEachCell(c,f,_,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,c,f,_,w,x){this.cells[w].push(x)}query(n,c,f,_,w){const x=this.min,T=this.max;if(n<=x&&c<=x&&T<=f&&T<=_&&!w)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(n,c,f,_,this._queryCell,C,{},w),C}}_queryCell(n,c,f,_,w,x,T,C){const A=this.cells[w];if(A!==null){const z=this.keys,B=this.bboxes;for(let $=0;$<A.length;$++){const W=A[$];if(T[W]===void 0){const ie=4*W;(C?C(B[ie+0],B[ie+1],B[ie+2],B[ie+3]):n<=B[ie+2]&&c<=B[ie+3]&&f>=B[ie+0]&&_>=B[ie+1])?(T[W]=!0,x.push(z[W])):T[W]=!1}}}}_forEachCell(n,c,f,_,w,x,T,C){const A=this._convertToCellCoord(n),z=this._convertToCellCoord(c),B=this._convertToCellCoord(f),$=this._convertToCellCoord(_);for(let W=A;W<=B;W++)for(let ie=z;ie<=$;ie++){const oe=this.d*ie+W;if((!C||C(this._convertFromCellCoord(W),this._convertFromCellCoord(ie),this._convertFromCellCoord(W+1),this._convertFromCellCoord(ie+1)))&&w.call(this,n,c,f,_,oe,x,T,C))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,c=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const _=new Int32Array(c+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let w=c;for(let x=0;x<n.length;x++){const T=n[x];_[3+x]=w,_.set(T,w),w+=T.length}return _[3+n.length]=w,_.set(this.keys,w),w+=this.keys.length,_[3+n.length+1]=w,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer}static serialize(n,c){const f=n.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(n){return new Zs(n.buffer)}}const Yr={};function zt(a,n,c={}){if(Yr[a])throw new Error(`${a} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:a,writeable:!1}),Yr[a]={klass:n,omit:c.omit||[],shallow:c.shallow||[]}}zt("Object",Object),zt("TransferableGridIndex",Zs),zt("Color",qi),zt("Error",Error),zt("AJAXError",ai),zt("ResolvedImage",Nr),zt("StylePropertyFunction",Us),zt("StyleExpression",vl,{omit:["_evaluator"]}),zt("ZoomDependentExpression",$s),zt("ZoomConstantExpression",js),zt("CompoundExpression",Kr,{omit:["_evaluate"]});for(const a in Ds)Ds[a]._classRegistryKey||zt(`Expression_${a}`,Ds[a]);function Ml(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function su(a){return a.$name||a.constructor._classRegistryKey}function jh(a){return!function(n){if(n===null||typeof n!="object")return!1;const c=su(n);return!(!c||c==="Object")}(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||Ml(a)||it(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function Gs(a,n){if(jh(a))return(Ml(a)||it(a))&&n&&n.push(a),ArrayBuffer.isView(a)&&n&&n.push(a.buffer),a instanceof ImageData&&n&&n.push(a.data.buffer),a;if(Array.isArray(a)){const w=[];for(const x of a)w.push(Gs(x,n));return w}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const c=su(a);if(!c)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!Yr[c])throw new Error(`${c} is not registered.`);const{klass:f}=Yr[c],_=f.serialize?f.serialize(a,n):{};if(f.serialize){if(n&&_===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in a){if(!a.hasOwnProperty(w)||Yr[c].omit.indexOf(w)>=0)continue;const x=a[w];_[w]=Yr[c].shallow.indexOf(w)>=0?x:Gs(x,n)}a instanceof Error&&(_.message=a.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(_.$name=c),_}function Ws(a){if(jh(a))return a;if(Array.isArray(a))return a.map(Ws);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const n=su(a)||"Object";if(!Yr[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:c}=Yr[n];if(!c)throw new Error(`can't deserialize unregistered class ${n}`);if(c.deserialize)return c.deserialize(a);const f=Object.create(c.prototype);for(const _ of Object.keys(a)){if(_==="$name")continue;const w=a[_];f[_]=Yr[n].shallow.indexOf(_)>=0?w:Ws(w)}return f}class au{constructor(){this.first=!0}update(n,c){const f=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=f,!0))}}const Ti={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function lu(a){for(const n of a)if(uu(n.charCodeAt(0)))return!0;return!1}function hf(a){for(const n of a)if(!Hs(n.charCodeAt(0)))return!1;return!0}function cu(a){const n=a.map(c=>{try{return new RegExp(`\\p{sc=${c}}`,"u").source}catch{return null}}).filter(c=>c);return new RegExp(n.join("|"),"u")}const df=cu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Hs(a){return!df.test(String.fromCodePoint(a))}const $h=cu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function uu(a){return!(a!==746&&a!==747&&(a<4352||!(Ti["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ti["CJK Compatibility"](a)||Ti["CJK Strokes"](a)||!(!Ti["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ti["Enclosed CJK Letters and Months"](a)||Ti["Ideographic Description Characters"](a)||Ti.Kanbun(a)||Ti.Katakana(a)&&a!==12540||!(!Ti["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ti["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ti["Vertical Forms"](a)||Ti["Yijing Hexagram Symbols"](a)||/\p{sc=Cans}/u.test(String.fromCodePoint(a))||/\p{sc=Hang}/u.test(String.fromCodePoint(a))||$h.test(String.fromCodePoint(a)))))}function Uh(a){return!(uu(a)||function(n){return!!(Ti["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Ti["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Ti["Letterlike Symbols"](n)||Ti["Number Forms"](n)||Ti["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Ti["Control Pictures"](n)&&n!==9251||Ti["Optical Character Recognition"](n)||Ti["Enclosed Alphanumerics"](n)||Ti["Geometric Shapes"](n)||Ti["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Ti["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Ti["CJK Symbols and Punctuation"](n)||Ti.Katakana(n)||Ti["Private Use Area"](n)||Ti["CJK Compatibility Forms"](n)||Ti["Small Form Variants"](n)||Ti["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(a))}const ff=cu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function hu(a){return ff.test(String.fromCodePoint(a))}function pf(a,n){return!(!n&&hu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ti.Khmer(a))}function mf(a){for(const n of a)if(hu(n.charCodeAt(0)))return!0;return!1}const $r=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class en{constructor(n,c){this.zoom=n,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new au,this.transition={})}isSupportedScript(n){return function(c,f){for(const _ of c)if(!pf(_.charCodeAt(0),f))return!1;return!0}(n,$r.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,c=n-Math.floor(n),f=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class Xs{constructor(n,c){this.property=n,this.value=c,this.expression=function(f,_){if(yl(f))return new Us(f,_);if(wl(f)){const w=Gc(f,_);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return _.type==="color"&&typeof f=="string"?w=qi.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Xr.parse(f)):w=Or.parse(f),{kind:"constant",evaluate:()=>w}}}(c===void 0?n.specification.default:c,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,c,f){return this.property.possiblyEvaluate(this,n,c,f)}}class Al{constructor(n){this.property=n,this.value=new Xs(n,void 0)}transitioned(n,c){return new Vh(this.property,this.value,c,te({},n.transition,this.transition),n.now)}untransitioned(){return new Vh(this.property,this.value,null,{},0)}}class Pl{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return ce(this._values[n].value.value)}setValue(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Al(this._values[n].property)),this._values[n].value=new Xs(this._values[n].property,c===null?void 0:ce(c))}getTransition(n){return ce(this._values[n].transition)}setTransition(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Al(this._values[n].property)),this._values[n].transition=ce(c)||void 0}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f);const _=this.getTransition(c);_!==void 0&&(n[`${c}-transition`]=_)}return n}transitioned(n,c){const f=new Na(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(n,c._values[_]);return f}untransitioned(){const n=new Na(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].untransitioned();return n}}class Vh{constructor(n,c,f,_,w){this.property=n,this.value=c,this.begin=w+_.delay||0,this.end=this.begin+_.duration||0,n.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(n,c,f){const _=n.now||0,w=this.value.possiblyEvaluate(n,c,f),x=this.prior;if(x){if(_>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(_<this.begin)return x.possiblyEvaluate(n,c,f);{const T=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(n,c,f),w,function(C){if(C<=0)return 0;if(C>=1)return 1;const A=C*C,z=A*C;return 4*(C<.5?z:3*(C-A)+z-.75)}(T))}}return w}}class Na{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,c,f){const _=new $a(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(n,c,f);return _}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class ja{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return ce(this._values[n].value)}setValue(n,c){this._values[n]=new Xs(this._values[n].property,c===null?void 0:ce(c))}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f)}return n}possiblyEvaluate(n,c,f){const _=new $a(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(n,c,f);return _}}class ko{constructor(n,c,f){this.property=n,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,c,f,_){return this.property.evaluate(this.value,this.parameters,n,c,f,_)}}class $a{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Ot{constructor(n){this.specification=n}possiblyEvaluate(n,c){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(c)}interpolate(n,c,f){const _=xr[this.specification.type];return _?_(n,c,f):n}}class Yt{constructor(n,c){this.specification=n,this.overrides=c}possiblyEvaluate(n,c,f,_){return new ko(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(c,null,{},f,_)}:n.expression,c)}interpolate(n,c,f){if(n.value.kind!=="constant"||c.value.kind!=="constant")return n;if(n.value.value===void 0||c.value.value===void 0)return new ko(this,{kind:"constant",value:void 0},n.parameters);const _=xr[this.specification.type];if(_){const w=_(n.value.value,c.value.value,f);return new ko(this,{kind:"constant",value:w},n.parameters)}return n}evaluate(n,c,f,_,w,x){return n.kind==="constant"?n.value:n.evaluate(c,f,_,w,x)}}class zl extends Yt{possiblyEvaluate(n,c,f,_){if(n.value===void 0)return new ko(this,{kind:"constant",value:void 0},c);if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,_),x=n.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,T=this._calculate(x,x,x,c);return new ko(this,{kind:"constant",value:T},c)}if(n.expression.kind==="camera"){const w=this._calculate(n.expression.evaluate({zoom:c.zoom-1}),n.expression.evaluate({zoom:c.zoom}),n.expression.evaluate({zoom:c.zoom+1}),c);return new ko(this,{kind:"constant",value:w},c)}return new ko(this,n.expression,c)}evaluate(n,c,f,_,w,x){if(n.kind==="source"){const T=n.evaluate(c,f,_,w,x);return this._calculate(T,T,T,c)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(c.zoom)-1},f,_),n.evaluate({zoom:Math.floor(c.zoom)},f,_),n.evaluate({zoom:Math.floor(c.zoom)+1},f,_),c):n.value}_calculate(n,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class Dl{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,_){if(n.value!==void 0){if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,_);return this._calculate(w,w,w,c)}return this._calculate(n.expression.evaluate(new en(Math.floor(c.zoom-1),c)),n.expression.evaluate(new en(Math.floor(c.zoom),c)),n.expression.evaluate(new en(Math.floor(c.zoom+1),c)),c)}}_calculate(n,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class du{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,_){return!!n.expression.evaluate(c,null,{},f,_)}interpolate(){return!1}}class v{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in n){const f=n[c];f.specification.overridable&&this.overridableProperties.push(c);const _=this.defaultPropertyValues[c]=new Xs(f,void 0),w=this.defaultTransitionablePropertyValues[c]=new Al(f);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=_.possiblyEvaluate({})}}}zt("DataDrivenProperty",Yt),zt("DataConstantProperty",Ot),zt("CrossFadedDataDrivenProperty",zl),zt("CrossFadedProperty",Dl),zt("ColorRampProperty",du);const i="-transition";class h extends st{constructor(n,c){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),c.layout&&(this._unevaluatedLayout=new ja(c.layout)),c.paint)){this._transitionablePaint=new Pl(c.paint);for(const f in n.paint)this.setPaintProperty(f,n.paint[f],{validate:!1});for(const f in n.layout)this.setLayoutProperty(f,n.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $a(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,c,f={}){c!=null&&this._validate(Nh,`layers.${this.id}.layout.${n}`,n,c,f)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,c):this.visibility=c)}getPaintProperty(n){return n.endsWith(i)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,c,f={}){if(c!=null&&this._validate(Oh,`layers.${this.id}.paint.${n}`,n,c,f))return!1;if(n.endsWith(i))return this._transitionablePaint.setTransition(n.slice(0,-11),c||void 0),!1;{const _=this._transitionablePaint._values[n],w=_.property.specification["property-type"]==="cross-faded-data-driven",x=_.value.isDataDriven(),T=_.value;this._transitionablePaint.setValue(n,c),this._handleSpecialPaintPropertyUpdate(n);const C=this._transitionablePaint._values[n].value;return C.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(n,T,C)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,c,f){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,c){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,c)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),fe(n,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(n,c,f,_,w={}){return(!w||w.validate!==!1)&&ou(this,n.call(cs,{key:c,layerType:this.type,objectKey:f,value:_,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const c=this.paint.get(n);if(c instanceof ko&&Bs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(n,c){this._structArray=n,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class b{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,c){return n._trim(),c&&(n.isTransferred=!0,c.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const c=Object.create(this.prototype);return c.arrayBuffer=n.arrayBuffer,c.length=n.length,c.capacity=n.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function I(a,n=1){let c=0,f=0;return{members:a.map(_=>{const w=p[_.type].BYTES_PER_ELEMENT,x=c=E(c,Math.max(n,w)),T=_.components||1;return f=Math.max(f,w),c+=w*T,{name:_.name,type:_.type,components:T,offset:x}}),size:E(c,Math.max(f,n)),alignment:n}}function E(a,n){return Math.ceil(a/n)*n}class M extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const _=2*n;return this.int16[_+0]=c,this.int16[_+1]=f,n}}M.prototype.bytesPerElement=4,zt("StructArrayLayout2i4",M);class D extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=_,n}}D.prototype.bytesPerElement=6,zt("StructArrayLayout3i6",D);class O extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,_)}emplace(n,c,f,_,w){const x=4*n;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=_,this.int16[x+3]=w,n}}O.prototype.bytesPerElement=8,zt("StructArrayLayout4i8",O);class N extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=6*n;return this.int16[C+0]=c,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=T,n}}N.prototype.bytesPerElement=12,zt("StructArrayLayout2i4i12",N);class Q extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=4*n,A=8*n;return this.int16[C+0]=c,this.int16[C+1]=f,this.uint8[A+4]=_,this.uint8[A+5]=w,this.uint8[A+6]=x,this.uint8[A+7]=T,n}}Q.prototype.bytesPerElement=8,zt("StructArrayLayout2i4ub8",Q);class se extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const _=2*n;return this.float32[_+0]=c,this.float32[_+1]=f,n}}se.prototype.bytesPerElement=8,zt("StructArrayLayout2f8",se);class de extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,z){const B=this.length;return this.resize(B+1),this.emplace(B,n,c,f,_,w,x,T,C,A,z)}emplace(n,c,f,_,w,x,T,C,A,z,B){const $=10*n;return this.uint16[$+0]=c,this.uint16[$+1]=f,this.uint16[$+2]=_,this.uint16[$+3]=w,this.uint16[$+4]=x,this.uint16[$+5]=T,this.uint16[$+6]=C,this.uint16[$+7]=A,this.uint16[$+8]=z,this.uint16[$+9]=B,n}}de.prototype.bytesPerElement=20,zt("StructArrayLayout10ui20",de);class ge extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,z,B,$){const W=this.length;return this.resize(W+1),this.emplace(W,n,c,f,_,w,x,T,C,A,z,B,$)}emplace(n,c,f,_,w,x,T,C,A,z,B,$,W){const ie=12*n;return this.int16[ie+0]=c,this.int16[ie+1]=f,this.int16[ie+2]=_,this.int16[ie+3]=w,this.uint16[ie+4]=x,this.uint16[ie+5]=T,this.uint16[ie+6]=C,this.uint16[ie+7]=A,this.int16[ie+8]=z,this.int16[ie+9]=B,this.int16[ie+10]=$,this.int16[ie+11]=W,n}}ge.prototype.bytesPerElement=24,zt("StructArrayLayout4i4ui4i24",ge);class xe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,n}}xe.prototype.bytesPerElement=12,zt("StructArrayLayout3f12",xe);class ke extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint32[1*n+0]=c,n}}ke.prototype.bytesPerElement=4,zt("StructArrayLayout1ul4",ke);class Ce extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A){const z=this.length;return this.resize(z+1),this.emplace(z,n,c,f,_,w,x,T,C,A)}emplace(n,c,f,_,w,x,T,C,A,z){const B=10*n,$=5*n;return this.int16[B+0]=c,this.int16[B+1]=f,this.int16[B+2]=_,this.int16[B+3]=w,this.int16[B+4]=x,this.int16[B+5]=T,this.uint32[$+3]=C,this.uint16[B+8]=A,this.uint16[B+9]=z,n}}Ce.prototype.bytesPerElement=20,zt("StructArrayLayout6i1ul2ui20",Ce);class me extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=6*n;return this.int16[C+0]=c,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=T,n}}me.prototype.bytesPerElement=12,zt("StructArrayLayout2i2i2i12",me);class Re extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w){const x=this.length;return this.resize(x+1),this.emplace(x,n,c,f,_,w)}emplace(n,c,f,_,w,x){const T=4*n,C=8*n;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=_,this.int16[C+6]=w,this.int16[C+7]=x,n}}Re.prototype.bytesPerElement=16,zt("StructArrayLayout2f1f2i16",Re);class Be extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,_,w,x)}emplace(n,c,f,_,w,x,T){const C=16*n,A=4*n,z=8*n;return this.uint8[C+0]=c,this.uint8[C+1]=f,this.float32[A+1]=_,this.float32[A+2]=w,this.int16[z+6]=x,this.int16[z+7]=T,n}}Be.prototype.bytesPerElement=16,zt("StructArrayLayout2ub2f2i16",Be);class He extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.uint16[w+0]=c,this.uint16[w+1]=f,this.uint16[w+2]=_,n}}He.prototype.bytesPerElement=6,zt("StructArrayLayout3ui6",He);class ot extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,z,B,$,W,ie,oe,_e,ve){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,n,c,f,_,w,x,T,C,A,z,B,$,W,ie,oe,_e,ve)}emplace(n,c,f,_,w,x,T,C,A,z,B,$,W,ie,oe,_e,ve,Ze){const Ae=24*n,Oe=12*n,Je=48*n;return this.int16[Ae+0]=c,this.int16[Ae+1]=f,this.uint16[Ae+2]=_,this.uint16[Ae+3]=w,this.uint32[Oe+2]=x,this.uint32[Oe+3]=T,this.uint32[Oe+4]=C,this.uint16[Ae+10]=A,this.uint16[Ae+11]=z,this.uint16[Ae+12]=B,this.float32[Oe+7]=$,this.float32[Oe+8]=W,this.uint8[Je+36]=ie,this.uint8[Je+37]=oe,this.uint8[Je+38]=_e,this.uint32[Oe+10]=ve,this.int16[Ae+22]=Ze,n}}ot.prototype.bytesPerElement=48,zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ot);class wt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,_,w,x,T,C,A,z,B,$,W,ie,oe,_e,ve,Ze,Ae,Oe,Je,gt,Mt,Kt,Ct,Tt,Ut,Rt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,n,c,f,_,w,x,T,C,A,z,B,$,W,ie,oe,_e,ve,Ze,Ae,Oe,Je,gt,Mt,Kt,Ct,Tt,Ut,Rt)}emplace(n,c,f,_,w,x,T,C,A,z,B,$,W,ie,oe,_e,ve,Ze,Ae,Oe,Je,gt,Mt,Kt,Ct,Tt,Ut,Rt,Pt){const tt=32*n,Zt=16*n;return this.int16[tt+0]=c,this.int16[tt+1]=f,this.int16[tt+2]=_,this.int16[tt+3]=w,this.int16[tt+4]=x,this.int16[tt+5]=T,this.int16[tt+6]=C,this.int16[tt+7]=A,this.uint16[tt+8]=z,this.uint16[tt+9]=B,this.uint16[tt+10]=$,this.uint16[tt+11]=W,this.uint16[tt+12]=ie,this.uint16[tt+13]=oe,this.uint16[tt+14]=_e,this.uint16[tt+15]=ve,this.uint16[tt+16]=Ze,this.uint16[tt+17]=Ae,this.uint16[tt+18]=Oe,this.uint16[tt+19]=Je,this.uint16[tt+20]=gt,this.uint16[tt+21]=Mt,this.uint16[tt+22]=Kt,this.uint32[Zt+12]=Ct,this.float32[Zt+13]=Tt,this.float32[Zt+14]=Ut,this.uint16[tt+30]=Rt,this.uint16[tt+31]=Pt,n}}wt.prototype.bytesPerElement=64,zt("StructArrayLayout8i15ui1ul2f2ui64",wt);class It extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.float32[1*n+0]=c,n}}It.prototype.bytesPerElement=4,zt("StructArrayLayout1f4",It);class At extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=3*n;return this.uint16[6*n+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,n}}At.prototype.bytesPerElement=12,zt("StructArrayLayout1ui2f12",At);class kt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,c,f)}emplace(n,c,f,_){const w=4*n;return this.uint32[2*n+0]=c,this.uint16[w+2]=f,this.uint16[w+3]=_,n}}kt.prototype.bytesPerElement=8,zt("StructArrayLayout1ul2ui8",kt);class xt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const _=2*n;return this.uint16[_+0]=c,this.uint16[_+1]=f,n}}xt.prototype.bytesPerElement=4,zt("StructArrayLayout2ui4",xt);class Nt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint16[1*n+0]=c,n}}Nt.prototype.bytesPerElement=2,zt("StructArrayLayout1ui2",Nt);class ri extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,_)}emplace(n,c,f,_,w){const x=4*n;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=_,this.float32[x+3]=w,n}}ri.prototype.bytesPerElement=16,zt("StructArrayLayout4f16",ri);class St extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}St.prototype.size=20;class Lt extends Ce{get(n){return new St(this,n)}}zt("CollisionBoxArray",Lt);class ti extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ti.prototype.size=48;class tn extends ot{get(n){return new ti(this,n)}}zt("PlacedSymbolArray",tn);class fi extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}fi.prototype.size=64;class ki extends wt{get(n){return new fi(this,n)}}zt("SymbolInstanceArray",ki);class nn extends It{getoffsetX(n){return this.float32[1*n+0]}}zt("GlyphOffsetArray",nn);class nr extends D{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}zt("SymbolLineVertexArray",nr);class co extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}co.prototype.size=12;class rn extends At{get(n){return new co(this,n)}}zt("TextAnchorOffsetArray",rn);class Sr extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Sr.prototype.size=8;class pr extends kt{get(n){return new Sr(this,n)}}zt("FeatureIndexArray",pr);class rr extends M{}class mr extends M{}class So extends M{}class Ks extends N{}class Rl extends Q{}class Js extends se{}class Qr extends de{}class Fl extends ge{}class fu extends xe{}class eo extends ke{}class to extends me{}class Go extends Be{}class uo extends He{}class Jn extends xt{}const or=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ur}=or;class Ii{constructor(n=[]){this.segments=n}prepareSegment(n,c,f,_){let w=this.segments[this.segments.length-1];return n>Ii.MAX_VERTEX_ARRAY_LENGTH&&Ge(`Max vertices per segment is ${Ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!w||w.vertexLength+n>Ii.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==_)&&(w={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},_!==void 0&&(w.sortKey=_),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const n of this.segments)for(const c in n.vaos)n.vaos[c].destroy()}static simpleSegment(n,c,f,_){return new Ii([{vertexOffset:n,primitiveOffset:c,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function us(a,n){return 256*(a=Se(Math.floor(a),0,255))+Se(Math.floor(n),0,255)}Ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt("SegmentVector",Ii);const Ys=I([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Qs={exports:{}},qh={exports:{}};qh.exports=function(a,n){var c,f,_,w,x,T,C,A;for(f=a.length-(c=3&a.length),_=n,x=3432918353,T=461845907,A=0;A<f;)C=255&a.charCodeAt(A)|(255&a.charCodeAt(++A))<<8|(255&a.charCodeAt(++A))<<16|(255&a.charCodeAt(++A))<<24,++A,_=27492+(65535&(w=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(C=0,c){case 3:C^=(255&a.charCodeAt(A+2))<<16;case 2:C^=(255&a.charCodeAt(A+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&a.charCodeAt(A)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var _f=qh.exports,Zh={exports:{}};Zh.exports=function(a,n){for(var c,f=a.length,_=n^f,w=0;f>=4;)c=1540483477*(65535&(c=255&a.charCodeAt(w)|(255&a.charCodeAt(++w))<<8|(255&a.charCodeAt(++w))<<16|(255&a.charCodeAt(++w))<<24))+((1540483477*(c>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:_^=(255&a.charCodeAt(w+2))<<16;case 2:_^=(255&a.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var Wo=_f,Gh=Zh.exports;Qs.exports=Wo,Qs.exports.murmur3=Wo,Qs.exports.murmur2=Gh;var Bl=g(Qs.exports);class Ua{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,c,f,_){this.ids.push(Ol(n)),this.positions.push(c,f,_)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Ol(n);let f=0,_=this.ids.length-1;for(;f<_;){const x=f+_>>1;this.ids[x]>=c?_=x:f=x+1}const w=[];for(;this.ids[f]===c;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(n,c){const f=new Float64Array(n.ids),_=new Uint32Array(n.positions);return Nl(f,_,0,f.length-1),c&&c.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(n){const c=new Ua;return c.ids=n.ids,c.positions=n.positions,c.indexed=!0,c}}function Ol(a){const n=+a;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Bl(String(a))}function Nl(a,n,c,f){for(;c<f;){const _=a[c+f>>1];let w=c-1,x=f+1;for(;;){do w++;while(a[w]<_);do x--;while(a[x]>_);if(w>=x)break;ea(a,w,x),ea(n,3*w,3*x),ea(n,3*w+1,3*x+1),ea(n,3*w+2,3*x+2)}x-c<f-x?(Nl(a,n,c,x),c=x+1):(Nl(a,n,x+1,f),f=x)}}function ea(a,n,c){const f=a[n];a[n]=a[c],a[c]=f}zt("FeaturePositionMap",Ua);class Va{constructor(n,c){this.gl=n.gl,this.location=c}}class Wh extends Va{constructor(n,c){super(n,c),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class rm extends Va{constructor(n,c){super(n,c),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class om extends Va{constructor(n,c){super(n,c),this.current=qi.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const eb=new Float32Array(16);function gf(a){return[us(255*a.r,255*a.g),us(255*a.b,255*a.a)]}class pu{constructor(n,c,f){this.value=n,this.uniformNames=c.map(_=>`u_${_}`),this.type=f}setUniform(n,c,f){n.set(f.constantOr(this.value))}getBinding(n,c,f){return this.type==="color"?new om(n,c):new Wh(n,c)}}class jl{constructor(n,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=n.tlbr}setUniform(n,c,f,_){const w=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&n.set(w)}getBinding(n,c,f){return f.substr(0,9)==="u_pattern"?new rm(n,c):new Wh(n,c)}}class hs{constructor(n,c,f,_){this.expression=n,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,c,f,_,w){const x=this.paintVertexArray.length,T=this.expression.evaluate(new en(0),c,{},_,[],w);this.paintVertexArray.resize(n),this._setPaintValue(x,n,T)}updatePaintArray(n,c,f,_){const w=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(n,c,w)}_setPaintValue(n,c,f){if(this.type==="color"){const _=gf(f);for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,_[0],_[1])}else{for(let _=n;_<c;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fo{constructor(n,c,f,_,w,x){this.expression=n,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(n,c,f,_,w){const x=this.expression.evaluate(new en(this.zoom),c,{},_,[],w),T=this.expression.evaluate(new en(this.zoom+1),c,{},_,[],w),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,x,T)}updatePaintArray(n,c,f,_){const w=this.expression.evaluate({zoom:this.zoom},f,_),x=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(n,c,w,x)}_setPaintValue(n,c,f,_){if(this.type==="color"){const w=gf(f),x=gf(_);for(let T=n;T<c;T++)this.paintVertexArray.emplace(T,w[0],w[1],x[0],x[1])}else{for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,_=Se(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(_)}getBinding(n,c,f){return new Wh(n,c)}}class ta{constructor(n,c,f,_,w,x){this.expression=n,this.type=c,this.useIntegerZoom=f,this.zoom=_,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(n,c,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(_,n,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(n,c,f,_,w){this._setPaintValues(n,c,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(n,c,f,_){if(!_||!f)return;const{min:w,mid:x,max:T}=f,C=_[w],A=_[x],z=_[T];if(C&&A&&z)for(let B=n;B<c;B++)this.zoomInPaintVertexArray.emplace(B,A.tl[0],A.tl[1],A.br[0],A.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],A.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,A.tl[0],A.tl[1],A.br[0],A.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],A.pixelRatio,z.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Ys.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Ys.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class sm{constructor(n,c,f){this.binders={},this._buffers=[];const _=[];for(const w in n.paint._values){if(!f(w))continue;const x=n.paint.get(w);if(!(x instanceof ko&&Bs(x.property.specification)))continue;const T=tb(w,n.type),C=x.value,A=x.property.specification.type,z=x.property.useIntegerZoom,B=x.property.specification["property-type"],$=B==="cross-faded"||B==="cross-faded-data-driven";if(C.kind==="constant")this.binders[w]=$?new jl(C.value,T):new pu(C.value,T,A),_.push(`/u_${w}`);else if(C.kind==="source"||$){const W=am(w,A,"source");this.binders[w]=$?new ta(C,A,z,c,W,n.id):new hs(C,T,A,W),_.push(`/a_${w}`)}else{const W=am(w,A,"composite");this.binders[w]=new Fo(C,T,A,z,c,W),_.push(`/z_${w}`)}}this.cacheKey=_.sort().join("")}getMaxValue(n){const c=this.binders[n];return c instanceof hs||c instanceof Fo?c.maxValue:0}populatePaintArrays(n,c,f,_,w){for(const x in this.binders){const T=this.binders[x];(T instanceof hs||T instanceof Fo||T instanceof ta)&&T.populatePaintArray(n,c,f,_,w)}}setConstantPatternPositions(n,c){for(const f in this.binders){const _=this.binders[f];_ instanceof jl&&_.setConstantPatternPositions(n,c)}}updatePaintArrays(n,c,f,_,w){let x=!1;for(const T in n){const C=c.getPositions(T);for(const A of C){const z=f.feature(A.index);for(const B in this.binders){const $=this.binders[B];if(($ instanceof hs||$ instanceof Fo||$ instanceof ta)&&$.expression.isStateDependent===!0){const W=_.paint.get(B);$.expression=W.value,$.updatePaintArray(A.start,A.end,z,n[T],w),x=!0}}}}return x}defines(){const n=[];for(const c in this.binders){const f=this.binders[c];(f instanceof pu||f instanceof jl)&&n.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return n}getBinderAttributes(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof hs||f instanceof Fo)for(let _=0;_<f.paintVertexAttributes.length;_++)n.push(f.paintVertexAttributes[_].name);else if(f instanceof ta)for(let _=0;_<Ys.members.length;_++)n.push(Ys.members[_].name)}return n}getBinderUniforms(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof pu||f instanceof jl||f instanceof Fo)for(const _ of f.uniformNames)n.push(_)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,c){const f=[];for(const _ in this.binders){const w=this.binders[_];if(w instanceof pu||w instanceof jl||w instanceof Fo){for(const x of w.uniformNames)if(c[x]){const T=w.getBinding(n,c[x],x);f.push({name:x,property:_,binding:T})}}}return f}setUniforms(n,c,f,_){for(const{name:w,property:x,binding:T}of c)this.binders[x].setUniform(T,_,f.get(x),w)}updatePaintBuffers(n){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(n&&f instanceof ta){const _=n.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof hs||f instanceof Fo)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(n){for(const c in this.binders){const f=this.binders[c];(f instanceof hs||f instanceof Fo||f instanceof ta)&&f.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const c=this.binders[n];(c instanceof hs||c instanceof Fo||c instanceof ta)&&c.destroy()}}}class qa{constructor(n,c,f=()=>!0){this.programConfigurations={};for(const _ of n)this.programConfigurations[_.id]=new sm(_,c,f);this.needsUpload=!1,this._featureMap=new Ua,this._bufferOffset=0}populatePaintArrays(n,c,f,_,w,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,c,_,w,x);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,c,f,_){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(n,this._featureMap,c,w,_)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function tb(a,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${n}-`,"").replace(/-/g,"_")]}function am(a,n,c){const f={color:{source:se,composite:ri},number:{source:It,composite:se}},_=function(w){return{"line-pattern":{source:Qr,composite:Qr},"fill-pattern":{source:Qr,composite:Qr},"fill-extrusion-pattern":{source:Qr,composite:Qr}}[w]}(a);return _&&_[c]||f[n][c]}zt("ConstantBinder",pu),zt("CrossFadedConstantBinder",jl),zt("SourceExpressionBinder",hs),zt("CrossFadedCompositeBinder",ta),zt("CompositeExpressionBinder",Fo),zt("ProgramConfiguration",sm,{omit:["_buffers"]}),zt("ProgramConfigurationSet",qa);const Dn=8192,yf=Math.pow(2,14)-1,lm=-yf-1;function Za(a){const n=Dn/a.extent,c=a.loadGeometry();for(let f=0;f<c.length;f++){const _=c[f];for(let w=0;w<_.length;w++){const x=_[w],T=Math.round(x.x*n),C=Math.round(x.y*n);x.x=Se(T,lm,yf),x.y=Se(C,lm,yf),(T<x.x||T>x.x+1||C<x.y||C>x.y+1)&&Ge("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function Ga(a,n){return{type:a.type,id:a.id,properties:a.properties,geometry:n?Za(a):[]}}function Hh(a,n,c,f,_){a.emplaceBack(2*n+(f+1)/2,2*c+(_+1)/2)}class bf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new mr,this.indexArray=new uo,this.segments=new Ii,this.programConfigurations=new qa(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){const _=this.layers[0],w=[];let x=null,T=!1;_.type==="circle"&&(x=_.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:C,id:A,index:z,sourceLayerIndex:B}of n){const $=this.layers[0]._featureFilter.needGeometry,W=Ga(C,$);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),W,f))continue;const ie=T?x.evaluate(W,{},f):void 0,oe={id:A,properties:C.properties,type:C.type,sourceLayerIndex:B,index:z,geometry:$?W.geometry:Za(C),patterns:{},sortKey:ie};w.push(oe)}T&&w.sort((C,A)=>C.sortKey-A.sortKey);for(const C of w){const{geometry:A,index:z,sourceLayerIndex:B}=C,$=n[z].feature;this.addFeature(C,A,z,f),c.featureIndex.insert($,A,z,B,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ur),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,c,f,_){for(const w of c)for(const x of w){const T=x.x,C=x.y;if(T<0||T>=Dn||C<0||C>=Dn)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),z=A.vertexLength;Hh(this.layoutVertexArray,T,C,-1,-1),Hh(this.layoutVertexArray,T,C,1,-1),Hh(this.layoutVertexArray,T,C,1,1),Hh(this.layoutVertexArray,T,C,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,{},_)}}function cm(a,n){for(let c=0;c<a.length;c++)if($l(n,a[c]))return!0;for(let c=0;c<n.length;c++)if($l(a,n[c]))return!0;return!!vf(a,n)}function ib(a,n,c){return!!$l(a,n)||!!wf(n,a,c)}function um(a,n){if(a.length===1)return dm(n,a[0]);for(let c=0;c<n.length;c++){const f=n[c];for(let _=0;_<f.length;_++)if($l(a,f[_]))return!0}for(let c=0;c<a.length;c++)if(dm(n,a[c]))return!0;for(let c=0;c<n.length;c++)if(vf(a,n[c]))return!0;return!1}function nb(a,n,c){if(a.length>1){if(vf(a,n))return!0;for(let f=0;f<n.length;f++)if(wf(n[f],a,c))return!0}for(let f=0;f<a.length;f++)if(wf(a[f],n,c))return!0;return!1}function vf(a,n){if(a.length===0||n.length===0)return!1;for(let c=0;c<a.length-1;c++){const f=a[c],_=a[c+1];for(let w=0;w<n.length-1;w++)if(rb(f,_,n[w],n[w+1]))return!0}return!1}function rb(a,n,c,f){return Ee(a,c,f)!==Ee(n,c,f)&&Ee(a,n,c)!==Ee(a,n,f)}function wf(a,n,c){const f=c*c;if(n.length===1)return a.distSqr(n[0])<f;for(let _=1;_<n.length;_++)if(hm(a,n[_-1],n[_])<f)return!0;return!1}function hm(a,n,c){const f=n.distSqr(c);if(f===0)return a.distSqr(n);const _=((a.x-n.x)*(c.x-n.x)+(a.y-n.y)*(c.y-n.y))/f;return a.distSqr(_<0?n:_>1?c:c.sub(n)._mult(_)._add(n))}function dm(a,n){let c,f,_,w=!1;for(let x=0;x<a.length;x++){c=a[x];for(let T=0,C=c.length-1;T<c.length;C=T++)f=c[T],_=c[C],f.y>n.y!=_.y>n.y&&n.x<(_.x-f.x)*(n.y-f.y)/(_.y-f.y)+f.x&&(w=!w)}return w}function $l(a,n){let c=!1;for(let f=0,_=a.length-1;f<a.length;_=f++){const w=a[f],x=a[_];w.y>n.y!=x.y>n.y&&n.x<(x.x-w.x)*(n.y-w.y)/(x.y-w.y)+w.x&&(c=!c)}return c}function ob(a,n,c){const f=c[0],_=c[2];if(a.x<f.x&&n.x<f.x||a.x>_.x&&n.x>_.x||a.y<f.y&&n.y<f.y||a.y>_.y&&n.y>_.y)return!1;const w=Ee(a,n,c[0]);return w!==Ee(a,n,c[1])||w!==Ee(a,n,c[2])||w!==Ee(a,n,c[3])}function mu(a,n,c){const f=n.paint.get(a).value;return f.kind==="constant"?f.value:c.programConfigurations.get(n.id).getMaxValue(a)}function Xh(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Kh(a,n,c,f,_){if(!n[0]&&!n[1])return a;const w=S.convert(n)._mult(_);c==="viewport"&&w._rotate(-f);const x=[];for(let T=0;T<a.length;T++)x.push(a[T].sub(w));return x}let fm,pm;zt("CircleBucket",bf,{omit:["layers"]});var sb={get paint(){return pm=pm||new v({"circle-radius":new Yt(Te.paint_circle["circle-radius"]),"circle-color":new Yt(Te.paint_circle["circle-color"]),"circle-blur":new Yt(Te.paint_circle["circle-blur"]),"circle-opacity":new Yt(Te.paint_circle["circle-opacity"]),"circle-translate":new Ot(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return fm=fm||new v({"circle-sort-key":new Yt(Te.layout_circle["circle-sort-key"])})}},Tr=1e-6,Ul=typeof Float32Array<"u"?Float32Array:Array;function xf(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function mm(a,n,c){var f=n[0],_=n[1],w=n[2],x=n[3],T=n[4],C=n[5],A=n[6],z=n[7],B=n[8],$=n[9],W=n[10],ie=n[11],oe=n[12],_e=n[13],ve=n[14],Ze=n[15],Ae=c[0],Oe=c[1],Je=c[2],gt=c[3];return a[0]=Ae*f+Oe*T+Je*B+gt*oe,a[1]=Ae*_+Oe*C+Je*$+gt*_e,a[2]=Ae*w+Oe*A+Je*W+gt*ve,a[3]=Ae*x+Oe*z+Je*ie+gt*Ze,a[4]=(Ae=c[4])*f+(Oe=c[5])*T+(Je=c[6])*B+(gt=c[7])*oe,a[5]=Ae*_+Oe*C+Je*$+gt*_e,a[6]=Ae*w+Oe*A+Je*W+gt*ve,a[7]=Ae*x+Oe*z+Je*ie+gt*Ze,a[8]=(Ae=c[8])*f+(Oe=c[9])*T+(Je=c[10])*B+(gt=c[11])*oe,a[9]=Ae*_+Oe*C+Je*$+gt*_e,a[10]=Ae*w+Oe*A+Je*W+gt*ve,a[11]=Ae*x+Oe*z+Je*ie+gt*Ze,a[12]=(Ae=c[12])*f+(Oe=c[13])*T+(Je=c[14])*B+(gt=c[15])*oe,a[13]=Ae*_+Oe*C+Je*$+gt*_e,a[14]=Ae*w+Oe*A+Je*W+gt*ve,a[15]=Ae*x+Oe*z+Je*ie+gt*Ze,a}Math.hypot||(Math.hypot=function(){for(var a=0,n=arguments.length;n--;)a+=arguments[n]*arguments[n];return Math.sqrt(a)});var _u,ab=mm;function Jh(a,n,c){var f=n[0],_=n[1],w=n[2],x=n[3];return a[0]=c[0]*f+c[4]*_+c[8]*w+c[12]*x,a[1]=c[1]*f+c[5]*_+c[9]*w+c[13]*x,a[2]=c[2]*f+c[6]*_+c[10]*w+c[14]*x,a[3]=c[3]*f+c[7]*_+c[11]*w+c[15]*x,a}_u=new Ul(4),Ul!=Float32Array&&(_u[0]=0,_u[1]=0,_u[2]=0,_u[3]=0);class lb extends h{constructor(n){super(n,sb)}createBucket(n){return new bf(n)}queryRadius(n){const c=n;return mu("circle-radius",this,c)+mu("circle-stroke-width",this,c)+Xh(this.paint.get("circle-translate"))}queryIntersectsFeature(n,c,f,_,w,x,T,C){const A=Kh(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,T),z=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),B=this.paint.get("circle-pitch-alignment")==="map",$=B?A:function(ie,oe){return ie.map(_e=>_m(_e,oe))}(A,C),W=B?z*T:z;for(const ie of _)for(const oe of ie){const _e=B?oe:_m(oe,C);let ve=W;const Ze=Jh([],[oe.x,oe.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ve*=Ze[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ve*=x.cameraToCenterDistance/Ze[3]),ib($,_e,ve))return!0}return!1}}function _m(a,n){const c=Jh([],[a.x,a.y,0,1],n);return new S(c[0]/c[3],c[1]/c[3])}class gm extends bf{}let ym;zt("HeatmapBucket",gm,{omit:["layers"]});var cb={get paint(){return ym=ym||new v({"heatmap-radius":new Yt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new du(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(Te.paint_heatmap["heatmap-opacity"])})}};function kf(a,{width:n,height:c},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==n*c*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${n*c*f}`)}else _=new Uint8Array(n*c*f);return a.width=n,a.height=c,a.data=_,a}function bm(a,{width:n,height:c},f){if(n===a.width&&c===a.height)return;const _=kf({},{width:n,height:c},f);Sf(a,_,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,n),height:Math.min(a.height,c)},f),a.width=n,a.height=c,a.data=_.data}function Sf(a,n,c,f,_,w){if(_.width===0||_.height===0)return n;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>n.width||_.height>n.height||f.x>n.width-_.width||f.y>n.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const x=a.data,T=n.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<_.height;C++){const A=((c.y+C)*a.width+c.x)*w,z=((f.y+C)*n.width+f.x)*w;for(let B=0;B<_.width*w;B++)T[z+B]=x[A+B]}return n}class gu{constructor(n,c){kf(this,n,1,c)}resize(n){bm(this,n,1)}clone(){return new gu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,_,w){Sf(n,c,f,_,w,1)}}class ho{constructor(n,c){kf(this,n,4,c)}resize(n){bm(this,n,4)}replace(n,c){c?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,_,w){Sf(n,c,f,_,w,4)}}function vm(a){const n={},c=a.resolution||256,f=a.clips?a.clips.length:1,_=a.image||new ho({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(x,T,C)=>{n[a.evaluationKey]=C;const A=a.expression.evaluate(n);_.data[x+T+0]=Math.floor(255*A.r/A.a),_.data[x+T+1]=Math.floor(255*A.g/A.a),_.data[x+T+2]=Math.floor(255*A.b/A.a),_.data[x+T+3]=Math.floor(255*A.a)};if(a.clips)for(let x=0,T=0;x<f;++x,T+=4*c)for(let C=0,A=0;C<c;C++,A+=4){const z=C/(c-1),{start:B,end:$}=a.clips[x];w(T,A,B*(1-z)+$*z)}else for(let x=0,T=0;x<c;x++,T+=4)w(0,T,x/(c-1));return _}zt("AlphaImage",gu),zt("RGBAImage",ho);const Tf="big-fb";class ub extends h{createBucket(n){return new gm(n)}constructor(n){super(n,cb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Tf)&&this.heatmapFbos.delete(Tf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wm;var hb={get paint(){return wm=wm||new v({"hillshade-illumination-direction":new Ot(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(Te.paint_hillshade["hillshade-accent-color"])})}};class db extends h{constructor(n){super(n,hb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const fb=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:pb}=fb;function xm(a,n,c=2){const f=n&&n.length,_=f?n[0]*c:a.length;let w=km(a,0,_,c,!0);const x=[];if(!w||w.next===w.prev)return x;let T,C,A;if(f&&(w=function(z,B,$,W){const ie=[];for(let oe=0,_e=B.length;oe<_e;oe++){const ve=km(z,B[oe]*W,oe<_e-1?B[oe+1]*W:z.length,W,!1);ve===ve.next&&(ve.steiner=!0),ie.push(xb(ve))}ie.sort(bb);for(let oe=0;oe<ie.length;oe++)$=vb(ie[oe],$);return $}(a,n,w,c)),a.length>80*c){T=1/0,C=1/0;let z=-1/0,B=-1/0;for(let $=c;$<_;$+=c){const W=a[$],ie=a[$+1];W<T&&(T=W),ie<C&&(C=ie),W>z&&(z=W),ie>B&&(B=ie)}A=Math.max(z-T,B-C),A=A!==0?32767/A:0}return yu(w,x,c,T,C,A,0),x}function km(a,n,c,f,_){let w;if(_===function(x,T,C,A){let z=0;for(let B=T,$=C-A;B<C;B+=A)z+=(x[$]-x[B])*(x[B+1]+x[$+1]),$=B;return z}(a,n,c,f)>0)for(let x=n;x<c;x+=f)w=Im(x/f|0,a[x],a[x+1],w);else for(let x=c-f;x>=n;x-=f)w=Im(x/f|0,a[x],a[x+1],w);return w&&Yh(w,w.next)&&(vu(w),w=w.next),w}function Wa(a,n){if(!a)return a;n||(n=a);let c,f=a;do if(c=!1,f.steiner||!Yh(f,f.next)&&An(f.prev,f,f.next)!==0)f=f.next;else{if(vu(f),f=n=f.prev,f===f.next)break;c=!0}while(c||f!==n);return n}function yu(a,n,c,f,_,w,x){if(!a)return;!x&&w&&function(C,A,z,B){let $=C;do $.z===0&&($.z=If($.x,$.y,A,z,B)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==C);$.prevZ.nextZ=null,$.prevZ=null,function(W){let ie,oe=1;do{let _e,ve=W;W=null;let Ze=null;for(ie=0;ve;){ie++;let Ae=ve,Oe=0;for(let gt=0;gt<oe&&(Oe++,Ae=Ae.nextZ,Ae);gt++);let Je=oe;for(;Oe>0||Je>0&&Ae;)Oe!==0&&(Je===0||!Ae||ve.z<=Ae.z)?(_e=ve,ve=ve.nextZ,Oe--):(_e=Ae,Ae=Ae.nextZ,Je--),Ze?Ze.nextZ=_e:W=_e,_e.prevZ=Ze,Ze=_e;ve=Ae}Ze.nextZ=null,oe*=2}while(ie>1)}($)}(a,f,_,w);let T=a;for(;a.prev!==a.next;){const C=a.prev,A=a.next;if(w?_b(a,f,_,w):mb(a))n.push(C.i,a.i,A.i),vu(a),a=A.next,T=A.next;else if((a=A)===T){x?x===1?yu(a=gb(Wa(a),n),n,c,f,_,w,2):x===2&&yb(a,n,c,f,_,w):yu(Wa(a),n,c,f,_,w,1);break}}}function mb(a){const n=a.prev,c=a,f=a.next;if(An(n,c,f)>=0)return!1;const _=n.x,w=c.x,x=f.x,T=n.y,C=c.y,A=f.y,z=_<w?_<x?_:x:w<x?w:x,B=T<C?T<A?T:A:C<A?C:A,$=_>w?_>x?_:x:w>x?w:x,W=T>C?T>A?T:A:C>A?C:A;let ie=f.next;for(;ie!==n;){if(ie.x>=z&&ie.x<=$&&ie.y>=B&&ie.y<=W&&Vl(_,T,w,C,x,A,ie.x,ie.y)&&An(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function _b(a,n,c,f){const _=a.prev,w=a,x=a.next;if(An(_,w,x)>=0)return!1;const T=_.x,C=w.x,A=x.x,z=_.y,B=w.y,$=x.y,W=T<C?T<A?T:A:C<A?C:A,ie=z<B?z<$?z:$:B<$?B:$,oe=T>C?T>A?T:A:C>A?C:A,_e=z>B?z>$?z:$:B>$?B:$,ve=If(W,ie,n,c,f),Ze=If(oe,_e,n,c,f);let Ae=a.prevZ,Oe=a.nextZ;for(;Ae&&Ae.z>=ve&&Oe&&Oe.z<=Ze;){if(Ae.x>=W&&Ae.x<=oe&&Ae.y>=ie&&Ae.y<=_e&&Ae!==_&&Ae!==x&&Vl(T,z,C,B,A,$,Ae.x,Ae.y)&&An(Ae.prev,Ae,Ae.next)>=0||(Ae=Ae.prevZ,Oe.x>=W&&Oe.x<=oe&&Oe.y>=ie&&Oe.y<=_e&&Oe!==_&&Oe!==x&&Vl(T,z,C,B,A,$,Oe.x,Oe.y)&&An(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Ae&&Ae.z>=ve;){if(Ae.x>=W&&Ae.x<=oe&&Ae.y>=ie&&Ae.y<=_e&&Ae!==_&&Ae!==x&&Vl(T,z,C,B,A,$,Ae.x,Ae.y)&&An(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.prevZ}for(;Oe&&Oe.z<=Ze;){if(Oe.x>=W&&Oe.x<=oe&&Oe.y>=ie&&Oe.y<=_e&&Oe!==_&&Oe!==x&&Vl(T,z,C,B,A,$,Oe.x,Oe.y)&&An(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function gb(a,n){let c=a;do{const f=c.prev,_=c.next.next;!Yh(f,_)&&Sm(f,c,c.next,_)&&bu(f,_)&&bu(_,f)&&(n.push(f.i,c.i,_.i),vu(c),vu(c.next),c=a=_),c=c.next}while(c!==a);return Wa(c)}function yb(a,n,c,f,_,w){let x=a;do{let T=x.next.next;for(;T!==x.prev;){if(x.i!==T.i&&kb(x,T)){let C=Tm(x,T);return x=Wa(x,x.next),C=Wa(C,C.next),yu(x,n,c,f,_,w,0),void yu(C,n,c,f,_,w,0)}T=T.next}x=x.next}while(x!==a)}function bb(a,n){return a.x-n.x}function vb(a,n){const c=function(_,w){let x=w;const T=_.x,C=_.y;let A,z=-1/0;do{if(C<=x.y&&C>=x.next.y&&x.next.y!==x.y){const oe=x.x+(C-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(oe<=T&&oe>z&&(z=oe,A=x.x<x.next.x?x:x.next,oe===T))return A}x=x.next}while(x!==w);if(!A)return null;const B=A,$=A.x,W=A.y;let ie=1/0;x=A;do{if(T>=x.x&&x.x>=$&&T!==x.x&&Vl(C<W?T:z,C,$,W,C<W?z:T,C,x.x,x.y)){const oe=Math.abs(C-x.y)/(T-x.x);bu(x,_)&&(oe<ie||oe===ie&&(x.x>A.x||x.x===A.x&&wb(A,x)))&&(A=x,ie=oe)}x=x.next}while(x!==B);return A}(a,n);if(!c)return n;const f=Tm(c,a);return Wa(f,f.next),Wa(c,c.next)}function wb(a,n){return An(a.prev,a,n.prev)<0&&An(n.next,a,a.next)<0}function If(a,n,c,f,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-c)*_|0)|a<<8))|a<<4))|a<<2))|a<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-f)*_|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function xb(a){let n=a,c=a;do(n.x<c.x||n.x===c.x&&n.y<c.y)&&(c=n),n=n.next;while(n!==a);return c}function Vl(a,n,c,f,_,w,x,T){return(_-x)*(n-T)>=(a-x)*(w-T)&&(a-x)*(f-T)>=(c-x)*(n-T)&&(c-x)*(w-T)>=(_-x)*(f-T)}function kb(a,n){return a.next.i!==n.i&&a.prev.i!==n.i&&!function(c,f){let _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==f.i&&_.next.i!==f.i&&Sm(_,_.next,c,f))return!0;_=_.next}while(_!==c);return!1}(a,n)&&(bu(a,n)&&bu(n,a)&&function(c,f){let _=c,w=!1;const x=(c.x+f.x)/2,T=(c.y+f.y)/2;do _.y>T!=_.next.y>T&&_.next.y!==_.y&&x<(_.next.x-_.x)*(T-_.y)/(_.next.y-_.y)+_.x&&(w=!w),_=_.next;while(_!==c);return w}(a,n)&&(An(a.prev,a,n.prev)||An(a,n.prev,n))||Yh(a,n)&&An(a.prev,a,a.next)>0&&An(n.prev,n,n.next)>0)}function An(a,n,c){return(n.y-a.y)*(c.x-n.x)-(n.x-a.x)*(c.y-n.y)}function Yh(a,n){return a.x===n.x&&a.y===n.y}function Sm(a,n,c,f){const _=ed(An(a,n,c)),w=ed(An(a,n,f)),x=ed(An(c,f,a)),T=ed(An(c,f,n));return _!==w&&x!==T||!(_!==0||!Qh(a,c,n))||!(w!==0||!Qh(a,f,n))||!(x!==0||!Qh(c,a,f))||!(T!==0||!Qh(c,n,f))}function Qh(a,n,c){return n.x<=Math.max(a.x,c.x)&&n.x>=Math.min(a.x,c.x)&&n.y<=Math.max(a.y,c.y)&&n.y>=Math.min(a.y,c.y)}function ed(a){return a>0?1:a<0?-1:0}function bu(a,n){return An(a.prev,a,a.next)<0?An(a,n,a.next)>=0&&An(a,a.prev,n)>=0:An(a,n,a.prev)<0||An(a,a.next,n)<0}function Tm(a,n){const c=Cf(a.i,a.x,a.y),f=Cf(n.i,n.x,n.y),_=a.next,w=n.prev;return a.next=n,n.prev=a,c.next=_,_.prev=c,f.next=c,c.prev=f,w.next=f,f.prev=w,f}function Im(a,n,c,f){const _=Cf(a,n,c);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function vu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Cf(a,n,c){return{i:a,x:n,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ef(a,n,c){const f=c.patternDependencies;let _=!1;for(const w of n){const x=w.paint.get(`${a}-pattern`);x.isConstant()||(_=!0);const T=x.constantOr(null);T&&(_=!0,f[T.to]=!0,f[T.from]=!0)}return _}function Lf(a,n,c,f,_){const w=_.patternDependencies;for(const x of n){const T=x.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:f-1},c,{},_.availableImages),A=T.evaluate({zoom:f},c,{},_.availableImages),z=T.evaluate({zoom:f+1},c,{},_.availableImages);C=C&&C.name?C.name:C,A=A&&A.name?A.name:A,z=z&&z.name?z.name:z,w[C]=!0,w[A]=!0,w[z]=!0,c.patterns[x.id]={min:C,mid:A,max:z}}}return c}class Mf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new So,this.indexArray=new uo,this.indexArray2=new Jn,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ii,this.segments2=new Ii,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=Ef("fill",this.layers,c);const _=this.layers[0].layout.get("fill-sort-key"),w=!_.isConstant(),x=[];for(const{feature:T,id:C,index:A,sourceLayerIndex:z}of n){const B=this.layers[0]._featureFilter.needGeometry,$=Ga(T,B);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),$,f))continue;const W=w?_.evaluate($,{},f,c.availableImages):void 0,ie={id:C,properties:T.properties,type:T.type,sourceLayerIndex:z,index:A,geometry:B?$.geometry:Za(T),patterns:{},sortKey:W};x.push(ie)}w&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:A,sourceLayerIndex:z}=T;if(this.hasPattern){const B=Lf("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(B)}else this.addFeature(T,C,A,f,{});c.featureIndex.insert(n[A].feature,C,A,z,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,pb),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,c,f,_,w){for(const x of fl(c,500)){let T=0;for(const W of x)T+=W.length;const C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=C.vertexLength,z=[],B=[];for(const W of x){if(W.length===0)continue;W!==x[0]&&B.push(z.length/2);const ie=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),oe=ie.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(oe+W.length-1,oe),z.push(W[0].x),z.push(W[0].y);for(let _e=1;_e<W.length;_e++)this.layoutVertexArray.emplaceBack(W[_e].x,W[_e].y),this.indexArray2.emplaceBack(oe+_e-1,oe+_e),z.push(W[_e].x),z.push(W[_e].y);ie.vertexLength+=W.length,ie.primitiveLength+=W.length}const $=xm(z,B);for(let W=0;W<$.length;W+=3)this.indexArray.emplaceBack(A+$[W],A+$[W+1],A+$[W+2]);C.vertexLength+=T,C.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,_)}}let Cm,Em;zt("FillBucket",Mf,{omit:["layers","patternFeatures"]});var Sb={get paint(){return Em=Em||new v({"fill-antialias":new Ot(Te.paint_fill["fill-antialias"]),"fill-opacity":new Yt(Te.paint_fill["fill-opacity"]),"fill-color":new Yt(Te.paint_fill["fill-color"]),"fill-outline-color":new Yt(Te.paint_fill["fill-outline-color"]),"fill-translate":new Ot(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new zl(Te.paint_fill["fill-pattern"])})},get layout(){return Cm=Cm||new v({"fill-sort-key":new Yt(Te.layout_fill["fill-sort-key"])})}};class Tb extends h{constructor(n){super(n,Sb)}recalculate(n,c){super.recalculate(n,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Mf(n)}queryRadius(){return Xh(this.paint.get("fill-translate"))}queryIntersectsFeature(n,c,f,_,w,x,T){return um(Kh(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,T),_)}isTileClipped(){return!0}}const Ib=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Cb=I([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Eb}=Ib;var ia={},Lb=y,Lm=ql;function ql(a,n,c,f,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=f,this._values=_,a.readFields(Mb,this,n)}function Mb(a,n,c){a==1?n.id=c.readVarint():a==2?function(f,_){for(var w=f.readVarint()+f.pos;f.pos<w;){var x=_._keys[f.readVarint()],T=_._values[f.readVarint()];_.properties[x]=T}}(c,n):a==3?n.type=c.readVarint():a==4&&(n._geometry=c.pos)}function Ab(a){for(var n,c,f=0,_=0,w=a.length,x=w-1;_<w;x=_++)f+=((c=a[x]).x-(n=a[_]).x)*(n.y+c.y);return f}ql.types=["Unknown","Point","LineString","Polygon"],ql.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var n,c=a.readVarint()+a.pos,f=1,_=0,w=0,x=0,T=[];a.pos<c;){if(_<=0){var C=a.readVarint();f=7&C,_=C>>3}if(_--,f===1||f===2)w+=a.readSVarint(),x+=a.readSVarint(),f===1&&(n&&T.push(n),n=[]),n.push(new Lb(w,x));else{if(f!==7)throw new Error("unknown command "+f);n&&n.push(n[0].clone())}}return n&&T.push(n),T},ql.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var n=a.readVarint()+a.pos,c=1,f=0,_=0,w=0,x=1/0,T=-1/0,C=1/0,A=-1/0;a.pos<n;){if(f<=0){var z=a.readVarint();c=7&z,f=z>>3}if(f--,c===1||c===2)(_+=a.readSVarint())<x&&(x=_),_>T&&(T=_),(w+=a.readSVarint())<C&&(C=w),w>A&&(A=w);else if(c!==7)throw new Error("unknown command "+c)}return[x,C,T,A]},ql.prototype.toGeoJSON=function(a,n,c){var f,_,w=this.extent*Math.pow(2,c),x=this.extent*a,T=this.extent*n,C=this.loadGeometry(),A=ql.types[this.type];function z(W){for(var ie=0;ie<W.length;ie++){var oe=W[ie];W[ie]=[360*(oe.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+T)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(f=0;f<C.length;f++)B[f]=C[f][0];z(C=B);break;case 2:for(f=0;f<C.length;f++)z(C[f]);break;case 3:for(C=function(W){var ie=W.length;if(ie<=1)return[W];for(var oe,_e,ve=[],Ze=0;Ze<ie;Ze++){var Ae=Ab(W[Ze]);Ae!==0&&(_e===void 0&&(_e=Ae<0),_e===Ae<0?(oe&&ve.push(oe),oe=[W[Ze]]):oe.push(W[Ze]))}return oe&&ve.push(oe),ve}(C),f=0;f<C.length;f++)for(_=0;_<C[f].length;_++)z(C[f][_])}C.length===1?C=C[0]:A="Multi"+A;var $={type:"Feature",geometry:{type:A,coordinates:C},properties:this.properties};return"id"in this&&($.id=this.id),$};var Pb=Lm,Mm=Am;function Am(a,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(zb,this,n),this.length=this._features.length}function zb(a,n,c){a===15?n.version=c.readVarint():a===1?n.name=c.readString():a===5?n.extent=c.readVarint():a===2?n._features.push(c.pos):a===3?n._keys.push(c.readString()):a===4&&n._values.push(function(f){for(var _=null,w=f.readVarint()+f.pos;f.pos<w;){var x=f.readVarint()>>3;_=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return _}(c))}Am.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var n=this._pbf.readVarint()+this._pbf.pos;return new Pb(this._pbf,n,this.extent,this._keys,this._values)};var Db=Mm;function Rb(a,n,c){if(a===3){var f=new Db(c,c.readVarint()+c.pos);f.length&&(n[f.name]=f)}}ia.VectorTile=function(a,n){this.layers=a.readFields(Rb,{},n)},ia.VectorTileFeature=Lm,ia.VectorTileLayer=Mm;const Fb=ia.VectorTileFeature.types,Af=Math.pow(2,13);function wu(a,n,c,f,_,w,x,T){a.emplaceBack(n,c,2*Math.floor(f*Af)+x,_*Af*2,w*Af*2,Math.round(T))}class Pf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Ks,this.centroidVertexArray=new rr,this.indexArray=new uo,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ii,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.features=[],this.hasPattern=Ef("fill-extrusion",this.layers,c);for(const{feature:_,id:w,index:x,sourceLayerIndex:T}of n){const C=this.layers[0]._featureFilter.needGeometry,A=Ga(_,C);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),A,f))continue;const z={id:w,sourceLayerIndex:T,index:x,geometry:C?A.geometry:Za(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Lf("fill-extrusion",this.layers,z,this.zoom,c)):this.addFeature(z,z.geometry,x,f,{}),c.featureIndex.insert(_,z.geometry,x,T,this.index,!0)}}addFeatures(n,c,f){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,c,f)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Eb),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,Cb.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,c,f,_,w){for(const x of fl(c,500)){const T={x:0,y:0,vertexCount:0};let C=0;for(const ie of x)C+=ie.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ie of x){if(ie.length===0||Ob(ie))continue;let oe=0;for(let _e=0;_e<ie.length;_e++){const ve=ie[_e];if(_e>=1){const Ze=ie[_e-1];if(!Bb(ve,Ze)){A.vertexLength+4>Ii.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ae=ve.sub(Ze)._perp()._unit(),Oe=Ze.dist(ve);oe+Oe>32768&&(oe=0),wu(this.layoutVertexArray,ve.x,ve.y,Ae.x,Ae.y,0,0,oe),wu(this.layoutVertexArray,ve.x,ve.y,Ae.x,Ae.y,0,1,oe),T.x+=2*ve.x,T.y+=2*ve.y,T.vertexCount+=2,oe+=Oe,wu(this.layoutVertexArray,Ze.x,Ze.y,Ae.x,Ae.y,0,0,oe),wu(this.layoutVertexArray,Ze.x,Ze.y,Ae.x,Ae.y,0,1,oe),T.x+=2*Ze.x,T.y+=2*Ze.y,T.vertexCount+=2;const Je=A.vertexLength;this.indexArray.emplaceBack(Je,Je+2,Je+1),this.indexArray.emplaceBack(Je+1,Je+2,Je+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+C>Ii.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),Fb[n.type]!=="Polygon")continue;const z=[],B=[],$=A.vertexLength;for(const ie of x)if(ie.length!==0){ie!==x[0]&&B.push(z.length/2);for(let oe=0;oe<ie.length;oe++){const _e=ie[oe];wu(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),T.x+=_e.x,T.y+=_e.y,T.vertexCount+=1,z.push(_e.x),z.push(_e.y)}}const W=xm(z,B);for(let ie=0;ie<W.length;ie+=3)this.indexArray.emplaceBack($+W[ie],$+W[ie+2],$+W[ie+1]);A.primitiveLength+=W.length/3,A.vertexLength+=C;for(let ie=0;ie<T.vertexCount;ie++){const oe=Math.floor(T.x/T.vertexCount),_e=Math.floor(T.y/T.vertexCount);this.centroidVertexArray.emplaceBack(oe,_e)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,_)}}function Bb(a,n){return a.x===n.x&&(a.x<0||a.x>Dn)||a.y===n.y&&(a.y<0||a.y>Dn)}function Ob(a){return a.every(n=>n.x<0)||a.every(n=>n.x>Dn)||a.every(n=>n.y<0)||a.every(n=>n.y>Dn)}let Pm;zt("FillExtrusionBucket",Pf,{omit:["layers","features"]});var Nb={get paint(){return Pm=Pm||new v({"fill-extrusion-opacity":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zl(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class jb extends h{constructor(n){super(n,Nb)}createBucket(n){return new Pf(n)}queryRadius(){return Xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,c,f,_,w,x,T,C){const A=Kh(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,T),z=this.paint.get("fill-extrusion-height").evaluate(c,f),B=this.paint.get("fill-extrusion-base").evaluate(c,f),$=function(ie,oe,_e,ve){const Ze=[];for(const Ae of ie){const Oe=[Ae.x,Ae.y,0,1];Jh(Oe,Oe,oe),Ze.push(new S(Oe[0]/Oe[3],Oe[1]/Oe[3]))}return Ze}(A,C),W=function(ie,oe,_e,ve){const Ze=[],Ae=[],Oe=ve[8]*oe,Je=ve[9]*oe,gt=ve[10]*oe,Mt=ve[11]*oe,Kt=ve[8]*_e,Ct=ve[9]*_e,Tt=ve[10]*_e,Ut=ve[11]*_e;for(const Rt of ie){const Pt=[],tt=[];for(const Zt of Rt){const $t=Zt.x,ii=Zt.y,Ki=ve[0]*$t+ve[4]*ii+ve[12],Hi=ve[1]*$t+ve[5]*ii+ve[13],qn=ve[2]*$t+ve[6]*ii+ve[14],To=ve[3]*$t+ve[7]*ii+ve[15],ar=qn+gt,Zn=To+Mt,Ir=Ki+Kt,Cr=Hi+Ct,Er=qn+Tt,Cn=To+Ut,Gn=new S((Ki+Oe)/Zn,(Hi+Je)/Zn);Gn.z=ar/Zn,Pt.push(Gn);const _r=new S(Ir/Cn,Cr/Cn);_r.z=Er/Cn,tt.push(_r)}Ze.push(Pt),Ae.push(tt)}return[Ze,Ae]}(_,B,z,C);return function(ie,oe,_e){let ve=1/0;um(_e,oe)&&(ve=zm(_e,oe[0]));for(let Ze=0;Ze<oe.length;Ze++){const Ae=oe[Ze],Oe=ie[Ze];for(let Je=0;Je<Ae.length-1;Je++){const gt=Ae[Je],Mt=[gt,Ae[Je+1],Oe[Je+1],Oe[Je],gt];cm(_e,Mt)&&(ve=Math.min(ve,zm(_e,Mt)))}}return ve!==1/0&&ve}(W[0],W[1],$)}}function xu(a,n){return a.x*n.x+a.y*n.y}function zm(a,n){if(a.length===1){let c=0;const f=n[c++];let _;for(;!_||f.equals(_);)if(_=n[c++],!_)return 1/0;for(;c<n.length;c++){const w=n[c],x=a[0],T=_.sub(f),C=w.sub(f),A=x.sub(f),z=xu(T,T),B=xu(T,C),$=xu(C,C),W=xu(A,T),ie=xu(A,C),oe=z*$-B*B,_e=($*W-B*ie)/oe,ve=(z*ie-B*W)/oe,Ze=f.z*(1-_e-ve)+_.z*_e+w.z*ve;if(isFinite(Ze))return Ze}return 1/0}{let c=1/0;for(const f of n)c=Math.min(c,f.z);return c}}const $b=I([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ub}=$b,Vb=I([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qb}=Vb,Zb=ia.VectorTileFeature.types,Gb=Math.cos(Math.PI/180*37.5),Dm=Math.pow(2,14)/.5;class zf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Rl,this.layoutVertexArray2=new Js,this.indexArray=new uo,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=Ef("line",this.layers,c);const _=this.layers[0].layout.get("line-sort-key"),w=!_.isConstant(),x=[];for(const{feature:T,id:C,index:A,sourceLayerIndex:z}of n){const B=this.layers[0]._featureFilter.needGeometry,$=Ga(T,B);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),$,f))continue;const W=w?_.evaluate($,{},f):void 0,ie={id:C,properties:T.properties,type:T.type,sourceLayerIndex:z,index:A,geometry:B?$.geometry:Za(T),patterns:{},sortKey:W};x.push(ie)}w&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:A,sourceLayerIndex:z}=T;if(this.hasPattern){const B=Lf("line",this.layers,T,this.zoom,c);this.patternFeatures.push(B)}else this.addFeature(T,C,A,f,{});c.featureIndex.insert(n[A].feature,C,A,z,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,qb)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ub),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,c,f,_,w){const x=this.layers[0].layout,T=x.get("line-join").evaluate(n,{}),C=x.get("line-cap"),A=x.get("line-miter-limit"),z=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const B of c)this.addLine(B,n,T,C,A,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,_)}addLine(n,c,f,_,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<n.length-1;ve++)this.totalDistance+=n[ve].dist(n[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Zb[c.type]==="Polygon";let C=n.length;for(;C>=2&&n[C-1].equals(n[C-2]);)C--;let A=0;for(;A<C-1&&n[A].equals(n[A+1]);)A++;if(C<(T?3:2))return;f==="bevel"&&(w=1.05);const z=this.overscaling<=16?15*Dn/(512*this.overscaling):0,B=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let $,W,ie,oe,_e;this.e1=this.e2=-1,T&&($=n[C-2],_e=n[A].sub($)._unit()._perp());for(let ve=A;ve<C;ve++){if(ie=ve===C-1?T?n[A+1]:void 0:n[ve+1],ie&&n[ve].equals(ie))continue;_e&&(oe=_e),$&&(W=$),$=n[ve],_e=ie?ie.sub($)._unit()._perp():oe,oe=oe||_e;let Ze=oe.add(_e);Ze.x===0&&Ze.y===0||Ze._unit();const Ae=oe.x*_e.x+oe.y*_e.y,Oe=Ze.x*_e.x+Ze.y*_e.y,Je=Oe!==0?1/Oe:1/0,gt=2*Math.sqrt(2-2*Oe),Mt=Oe<Gb&&W&&ie,Kt=oe.x*_e.y-oe.y*_e.x>0;if(Mt&&ve>A){const Ut=$.dist(W);if(Ut>2*z){const Rt=$.sub($.sub(W)._mult(z/Ut)._round());this.updateDistance(W,Rt),this.addCurrentVertex(Rt,oe,0,0,B),W=Rt}}const Ct=W&&ie;let Tt=Ct?f:T?"butt":_;if(Ct&&Tt==="round"&&(Je<x?Tt="miter":Je<=2&&(Tt="fakeround")),Tt==="miter"&&Je>w&&(Tt="bevel"),Tt==="bevel"&&(Je>2&&(Tt="flipbevel"),Je<w&&(Tt="miter")),W&&this.updateDistance(W,$),Tt==="miter")Ze._mult(Je),this.addCurrentVertex($,Ze,0,0,B);else if(Tt==="flipbevel"){if(Je>100)Ze=_e.mult(-1);else{const Ut=Je*oe.add(_e).mag()/oe.sub(_e).mag();Ze._perp()._mult(Ut*(Kt?-1:1))}this.addCurrentVertex($,Ze,0,0,B),this.addCurrentVertex($,Ze.mult(-1),0,0,B)}else if(Tt==="bevel"||Tt==="fakeround"){const Ut=-Math.sqrt(Je*Je-1),Rt=Kt?Ut:0,Pt=Kt?0:Ut;if(W&&this.addCurrentVertex($,oe,Rt,Pt,B),Tt==="fakeround"){const tt=Math.round(180*gt/Math.PI/20);for(let Zt=1;Zt<tt;Zt++){let $t=Zt/tt;if($t!==.5){const Ki=$t-.5;$t+=$t*Ki*($t-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*Ki*Ki+(.848013+Ae*(.215638*Ae-1.06021)))}const ii=_e.sub(oe)._mult($t)._add(oe)._unit()._mult(Kt?-1:1);this.addHalfVertex($,ii.x,ii.y,!1,Kt,0,B)}}ie&&this.addCurrentVertex($,_e,-Rt,-Pt,B)}else if(Tt==="butt")this.addCurrentVertex($,Ze,0,0,B);else if(Tt==="square"){const Ut=W?1:-1;this.addCurrentVertex($,Ze,Ut,Ut,B)}else Tt==="round"&&(W&&(this.addCurrentVertex($,oe,0,0,B),this.addCurrentVertex($,oe,1,1,B,!0)),ie&&(this.addCurrentVertex($,_e,-1,-1,B,!0),this.addCurrentVertex($,_e,0,0,B)));if(Mt&&ve<C-1){const Ut=$.dist(ie);if(Ut>2*z){const Rt=$.add(ie.sub($)._mult(z/Ut)._round());this.updateDistance($,Rt),this.addCurrentVertex(Rt,_e,0,0,B),$=Rt}}}}addCurrentVertex(n,c,f,_,w,x=!1){const T=c.y*_-c.x,C=-c.y-c.x*_;this.addHalfVertex(n,c.x+c.y*f,c.y-c.x*f,x,!1,f,w),this.addHalfVertex(n,T,C,x,!0,-_,w),this.distance>Dm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,c,f,_,w,x))}addHalfVertex({x:n,y:c},f,_,w,x,T,C){const A=.5*(this.lineClips?this.scaledDistance*(Dm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(w?1:0),(c<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(T===0?0:T<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),C.primitiveLength++),x?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,c){this.distance+=n.dist(c),this.updateScaledDistance()}}let Rm,Fm;zt("LineBucket",zf,{omit:["layers","patternFeatures"]});var Bm={get paint(){return Fm=Fm||new v({"line-opacity":new Yt(Te.paint_line["line-opacity"]),"line-color":new Yt(Te.paint_line["line-color"]),"line-translate":new Ot(Te.paint_line["line-translate"]),"line-translate-anchor":new Ot(Te.paint_line["line-translate-anchor"]),"line-width":new Yt(Te.paint_line["line-width"]),"line-gap-width":new Yt(Te.paint_line["line-gap-width"]),"line-offset":new Yt(Te.paint_line["line-offset"]),"line-blur":new Yt(Te.paint_line["line-blur"]),"line-dasharray":new Dl(Te.paint_line["line-dasharray"]),"line-pattern":new zl(Te.paint_line["line-pattern"]),"line-gradient":new du(Te.paint_line["line-gradient"])})},get layout(){return Rm=Rm||new v({"line-cap":new Ot(Te.layout_line["line-cap"]),"line-join":new Yt(Te.layout_line["line-join"]),"line-miter-limit":new Ot(Te.layout_line["line-miter-limit"]),"line-round-limit":new Ot(Te.layout_line["line-round-limit"]),"line-sort-key":new Yt(Te.layout_line["line-sort-key"])})}};class Wb extends Yt{possiblyEvaluate(n,c){return c=new en(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(n,c)}evaluate(n,c,f,_){return c=te({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(n,c,f,_)}}let td;class Hb extends h{constructor(n){super(n,Bm),this.gradientVersion=0,td||(td=new Wb(Bm.paint.properties["line-width"].specification),td.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof As,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,c){super.recalculate(n,c),this.paint._values["line-floorwidth"]=td.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new zf(n)}queryRadius(n){const c=n,f=Om(mu("line-width",this,c),mu("line-gap-width",this,c)),_=mu("line-offset",this,c);return f/2+Math.abs(_)+Xh(this.paint.get("line-translate"))}queryIntersectsFeature(n,c,f,_,w,x,T){const C=Kh(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,T),A=T/2*Om(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),z=this.paint.get("line-offset").evaluate(c,f);return z&&(_=function(B,$){const W=[];for(let ie=0;ie<B.length;ie++){const oe=B[ie],_e=[];for(let ve=0;ve<oe.length;ve++){const Ze=oe[ve-1],Ae=oe[ve],Oe=oe[ve+1],Je=ve===0?new S(0,0):Ae.sub(Ze)._unit()._perp(),gt=ve===oe.length-1?new S(0,0):Oe.sub(Ae)._unit()._perp(),Mt=Je._add(gt)._unit(),Kt=Mt.x*gt.x+Mt.y*gt.y;Kt!==0&&Mt._mult(1/Kt),_e.push(Mt._mult($)._add(Ae))}W.push(_e)}return W}(_,z*T)),function(B,$,W){for(let ie=0;ie<$.length;ie++){const oe=$[ie];if(B.length>=3){for(let _e=0;_e<oe.length;_e++)if($l(B,oe[_e]))return!0}if(nb(B,oe,W))return!0}return!1}(C,_,A)}isTileClipped(){return!0}}function Om(a,n){return n>0?n+2*a:a}const Xb=I([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kb=I([{name:"a_projected_pos",components:3,type:"Float32"}],4);I([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jb=I([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);I([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nm=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Yb=I([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Qb(a,n,c){return a.sections.forEach(f=>{f.text=function(_,w,x){const T=w.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?_=_.toLocaleUpperCase():T==="lowercase"&&(_=_.toLocaleLowerCase()),$r.applyArabicShaping&&(_=$r.applyArabicShaping(_)),_}(f.text,n,c)}),a}I([{name:"triangle",components:3,type:"Uint16"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),I([{type:"Float32",name:"offsetX"}]),I([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),I([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ku={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var On=24,jm=Wi,$m=function(a,n,c,f,_){var w,x,T=8*_-f-1,C=(1<<T)-1,A=C>>1,z=-7,B=c?_-1:0,$=c?-1:1,W=a[n+B];for(B+=$,w=W&(1<<-z)-1,W>>=-z,z+=T;z>0;w=256*w+a[n+B],B+=$,z-=8);for(x=w&(1<<-z)-1,w>>=-z,z+=f;z>0;x=256*x+a[n+B],B+=$,z-=8);if(w===0)w=1-A;else{if(w===C)return x?NaN:1/0*(W?-1:1);x+=Math.pow(2,f),w-=A}return(W?-1:1)*x*Math.pow(2,w-f)},Um=function(a,n,c,f,_,w){var x,T,C,A=8*w-_-1,z=(1<<A)-1,B=z>>1,$=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=f?0:w-1,ie=f?1:-1,oe=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,x=z):(x=Math.floor(Math.log(n)/Math.LN2),n*(C=Math.pow(2,-x))<1&&(x--,C*=2),(n+=x+B>=1?$/C:$*Math.pow(2,1-B))*C>=2&&(x++,C/=2),x+B>=z?(T=0,x=z):x+B>=1?(T=(n*C-1)*Math.pow(2,_),x+=B):(T=n*Math.pow(2,B-1)*Math.pow(2,_),x=0));_>=8;a[c+W]=255&T,W+=ie,T/=256,_-=8);for(x=x<<_|T,A+=_;A>0;a[c+W]=255&x,W+=ie,x/=256,A-=8);a[c+W-ie]|=128*oe};function Wi(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Wi.Varint=0,Wi.Fixed64=1,Wi.Bytes=2,Wi.Fixed32=5;var Df=4294967296,Vm=1/Df,qm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ds(a){return a.type===Wi.Bytes?a.readVarint()+a.pos:a.pos+1}function Zl(a,n,c){return c?4294967296*n+(a>>>0):4294967296*(n>>>0)+(a>>>0)}function Zm(a,n,c){var f=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));c.realloc(f);for(var _=c.pos-1;_>=a;_--)c.buf[_+f]=c.buf[_]}function ev(a,n){for(var c=0;c<a.length;c++)n.writeVarint(a[c])}function tv(a,n){for(var c=0;c<a.length;c++)n.writeSVarint(a[c])}function iv(a,n){for(var c=0;c<a.length;c++)n.writeFloat(a[c])}function nv(a,n){for(var c=0;c<a.length;c++)n.writeDouble(a[c])}function rv(a,n){for(var c=0;c<a.length;c++)n.writeBoolean(a[c])}function ov(a,n){for(var c=0;c<a.length;c++)n.writeFixed32(a[c])}function sv(a,n){for(var c=0;c<a.length;c++)n.writeSFixed32(a[c])}function av(a,n){for(var c=0;c<a.length;c++)n.writeFixed64(a[c])}function lv(a,n){for(var c=0;c<a.length;c++)n.writeSFixed64(a[c])}function id(a,n){return(a[n]|a[n+1]<<8|a[n+2]<<16)+16777216*a[n+3]}function Gl(a,n,c){a[c]=n,a[c+1]=n>>>8,a[c+2]=n>>>16,a[c+3]=n>>>24}function Gm(a,n){return(a[n]|a[n+1]<<8|a[n+2]<<16)+(a[n+3]<<24)}Wi.prototype={destroy:function(){this.buf=null},readFields:function(a,n,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),_=f>>3,w=this.pos;this.type=7&f,a(_,n,this),this.pos===w&&this.skip(f)}return n},readMessage:function(a,n){return this.readFields(a,n,this.readVarint()+this.pos)},readFixed32:function(){var a=id(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Gm(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=id(this.buf,this.pos)+id(this.buf,this.pos+4)*Df;return this.pos+=8,a},readSFixed64:function(){var a=id(this.buf,this.pos)+Gm(this.buf,this.pos+4)*Df;return this.pos+=8,a},readFloat:function(){var a=$m(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=$m(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var n,c,f=this.buf;return n=127&(c=f[this.pos++]),c<128?n:(n|=(127&(c=f[this.pos++]))<<7,c<128?n:(n|=(127&(c=f[this.pos++]))<<14,c<128?n:(n|=(127&(c=f[this.pos++]))<<21,c<128?n:function(_,w,x){var T,C,A=x.buf;if(T=(112&(C=A[x.pos++]))>>4,C<128||(T|=(127&(C=A[x.pos++]))<<3,C<128)||(T|=(127&(C=A[x.pos++]))<<10,C<128)||(T|=(127&(C=A[x.pos++]))<<17,C<128)||(T|=(127&(C=A[x.pos++]))<<24,C<128)||(T|=(1&(C=A[x.pos++]))<<31,C<128))return Zl(_,T,w);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(c=f[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,n=this.pos;return this.pos=a,a-n>=12&&qm?function(c,f,_){return qm.decode(c.subarray(f,_))}(this.buf,n,a):function(c,f,_){for(var w="",x=f;x<_;){var T,C,A,z=c[x],B=null,$=z>239?4:z>223?3:z>191?2:1;if(x+$>_)break;$===1?z<128&&(B=z):$===2?(192&(T=c[x+1]))==128&&(B=(31&z)<<6|63&T)<=127&&(B=null):$===3?(C=c[x+2],(192&(T=c[x+1]))==128&&(192&C)==128&&((B=(15&z)<<12|(63&T)<<6|63&C)<=2047||B>=55296&&B<=57343)&&(B=null)):$===4&&(C=c[x+2],A=c[x+3],(192&(T=c[x+1]))==128&&(192&C)==128&&(192&A)==128&&((B=(15&z)<<18|(63&T)<<12|(63&C)<<6|63&A)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,$=1):B>65535&&(B-=65536,w+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),w+=String.fromCharCode(B),x+=$}return w}(this.buf,n,a)},readBytes:function(){var a=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,a);return this.pos=a,n},readPackedVarint:function(a,n){if(this.type!==Wi.Bytes)return a.push(this.readVarint(n));var c=ds(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(n));return a},readPackedSVarint:function(a){if(this.type!==Wi.Bytes)return a.push(this.readSVarint());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Wi.Bytes)return a.push(this.readBoolean());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Wi.Bytes)return a.push(this.readFloat());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Wi.Bytes)return a.push(this.readDouble());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Wi.Bytes)return a.push(this.readFixed32());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Wi.Bytes)return a.push(this.readSFixed32());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Wi.Bytes)return a.push(this.readFixed64());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Wi.Bytes)return a.push(this.readSFixed64());var n=ds(this);for(a=a||[];this.pos<n;)a.push(this.readSFixed64());return a},skip:function(a){var n=7&a;if(n===Wi.Varint)for(;this.buf[this.pos++]>127;);else if(n===Wi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Wi.Fixed32)this.pos+=4;else{if(n!==Wi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(a,n){this.writeVarint(a<<3|n)},realloc:function(a){for(var n=this.length||16;n<this.pos+a;)n*=2;if(n!==this.length){var c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Gl(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Gl(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Gl(this.buf,-1&a,this.pos),Gl(this.buf,Math.floor(a*Vm),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Gl(this.buf,-1&a,this.pos),Gl(this.buf,Math.floor(a*Vm),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(n,c){var f,_;if(n>=0?(f=n%4294967296|0,_=n/4294967296|0):(_=~(-n/4294967296),4294967295^(f=~(-n%4294967296))?f=f+1|0:(f=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(w,x,T){T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,T.buf[T.pos]=127&(w>>>=7)}(f,0,c),function(w,x){var T=(7&w)<<4;x.buf[x.pos++]|=T|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var n=this.pos;this.pos=function(f,_,w){for(var x,T,C=0;C<_.length;C++){if((x=_.charCodeAt(C))>55295&&x<57344){if(!T){x>56319||C+1===_.length?(f[w++]=239,f[w++]=191,f[w++]=189):T=x;continue}if(x<56320){f[w++]=239,f[w++]=191,f[w++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(f[w++]=239,f[w++]=191,f[w++]=189,T=null);x<128?f[w++]=x:(x<2048?f[w++]=x>>6|192:(x<65536?f[w++]=x>>12|224:(f[w++]=x>>18|240,f[w++]=x>>12&63|128),f[w++]=x>>6&63|128),f[w++]=63&x|128)}return w}(this.buf,a,this.pos);var c=this.pos-n;c>=128&&Zm(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),Um(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Um(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var n=a.length;this.writeVarint(n),this.realloc(n);for(var c=0;c<n;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,n){this.pos++;var c=this.pos;a(n,this);var f=this.pos-c;f>=128&&Zm(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(a,n,c){this.writeTag(a,Wi.Bytes),this.writeRawMessage(n,c)},writePackedVarint:function(a,n){n.length&&this.writeMessage(a,ev,n)},writePackedSVarint:function(a,n){n.length&&this.writeMessage(a,tv,n)},writePackedBoolean:function(a,n){n.length&&this.writeMessage(a,rv,n)},writePackedFloat:function(a,n){n.length&&this.writeMessage(a,iv,n)},writePackedDouble:function(a,n){n.length&&this.writeMessage(a,nv,n)},writePackedFixed32:function(a,n){n.length&&this.writeMessage(a,ov,n)},writePackedSFixed32:function(a,n){n.length&&this.writeMessage(a,sv,n)},writePackedFixed64:function(a,n){n.length&&this.writeMessage(a,av,n)},writePackedSFixed64:function(a,n){n.length&&this.writeMessage(a,lv,n)},writeBytesField:function(a,n){this.writeTag(a,Wi.Bytes),this.writeBytes(n)},writeFixed32Field:function(a,n){this.writeTag(a,Wi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(a,n){this.writeTag(a,Wi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(a,n){this.writeTag(a,Wi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(a,n){this.writeTag(a,Wi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(a,n){this.writeTag(a,Wi.Varint),this.writeVarint(n)},writeSVarintField:function(a,n){this.writeTag(a,Wi.Varint),this.writeSVarint(n)},writeStringField:function(a,n){this.writeTag(a,Wi.Bytes),this.writeString(n)},writeFloatField:function(a,n){this.writeTag(a,Wi.Fixed32),this.writeFloat(n)},writeDoubleField:function(a,n){this.writeTag(a,Wi.Fixed64),this.writeDouble(n)},writeBooleanField:function(a,n){this.writeVarintField(a,!!n)}};var Rf=g(jm);const Ff=3;function cv(a,n,c){a===1&&c.readMessage(uv,n)}function uv(a,n,c){if(a===3){const{id:f,bitmap:_,width:w,height:x,left:T,top:C,advance:A}=c.readMessage(hv,{});n.push({id:f,bitmap:new gu({width:w+2*Ff,height:x+2*Ff},_),metrics:{width:w,height:x,left:T,top:C,advance:A}})}}function hv(a,n,c){a===1?n.id=c.readVarint():a===2?n.bitmap=c.readBytes():a===3?n.width=c.readVarint():a===4?n.height=c.readVarint():a===5?n.left=c.readSVarint():a===6?n.top=c.readSVarint():a===7&&(n.advance=c.readVarint())}const Wm=Ff;function Hm(a){let n=0,c=0;for(const x of a)n+=x.w*x.h,c=Math.max(c,x.w);a.sort((x,T)=>T.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),c),h:1/0}];let _=0,w=0;for(const x of a)for(let T=f.length-1;T>=0;T--){const C=f[T];if(!(x.w>C.w||x.h>C.h)){if(x.x=C.x,x.y=C.y,w=Math.max(w,x.y+x.h),_=Math.max(_,x.x+x.w),x.w===C.w&&x.h===C.h){const A=f.pop();T<f.length&&(f[T]=A)}else x.h===C.h?(C.x+=x.w,C.w-=x.w):x.w===C.w?(C.y+=x.h,C.h-=x.h):(f.push({x:C.x+x.w,y:C.y,w:C.w-x.w,h:x.h}),C.y+=x.h,C.h-=x.h);break}}return{w:_,h:w,fill:n/(_*w)||0}}const Vr=1;class Bf{constructor(n,{pixelRatio:c,version:f,stretchX:_,stretchY:w,content:x,textFitWidth:T,textFitHeight:C}){this.paddedRect=n,this.pixelRatio=c,this.stretchX=_,this.stretchY=w,this.content=x,this.version=f,this.textFitWidth=T,this.textFitHeight=C}get tl(){return[this.paddedRect.x+Vr,this.paddedRect.y+Vr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vr,this.paddedRect.y+this.paddedRect.h-Vr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Vr)/this.pixelRatio,(this.paddedRect.h-2*Vr)/this.pixelRatio]}}class Xm{constructor(n,c){const f={},_={};this.haveRenderCallbacks=[];const w=[];this.addImages(n,f,w),this.addImages(c,_,w);const{w:x,h:T}=Hm(w),C=new ho({width:x||1,height:T||1});for(const A in n){const z=n[A],B=f[A].paddedRect;ho.copy(z.data,C,{x:0,y:0},{x:B.x+Vr,y:B.y+Vr},z.data)}for(const A in c){const z=c[A],B=_[A].paddedRect,$=B.x+Vr,W=B.y+Vr,ie=z.data.width,oe=z.data.height;ho.copy(z.data,C,{x:0,y:0},{x:$,y:W},z.data),ho.copy(z.data,C,{x:0,y:oe-1},{x:$,y:W-1},{width:ie,height:1}),ho.copy(z.data,C,{x:0,y:0},{x:$,y:W+oe},{width:ie,height:1}),ho.copy(z.data,C,{x:ie-1,y:0},{x:$-1,y:W},{width:1,height:oe}),ho.copy(z.data,C,{x:0,y:0},{x:$+ie,y:W},{width:1,height:oe})}this.image=C,this.iconPositions=f,this.patternPositions=_}addImages(n,c,f){for(const _ in n){const w=n[_],x={x:0,y:0,w:w.data.width+2*Vr,h:w.data.height+2*Vr};f.push(x),c[_]=new Bf(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(n,c){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in n.updatedImages)this.patchUpdatedImage(this.iconPositions[f],n.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],n.getImage(f),c)}patchUpdatedImage(n,c,f){if(!n||!c||n.version===c.version)return;n.version=c.version;const[_,w]=n.tl;f.update(c.data,void 0,{x:_,y:w})}}var na;zt("ImagePosition",Bf),zt("ImageAtlas",Xm),d.ah=void 0,(na=d.ah||(d.ah={}))[na.none=0]="none",na[na.horizontal=1]="horizontal",na[na.vertical=2]="vertical",na[na.horizontalOnly=3]="horizontalOnly";const Su=-17;class Tu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,c){const f=new Tu;return f.scale=n||1,f.fontStack=c,f}static forImage(n){const c=new Tu;return c.imageName=n,c}}class Wl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,c){const f=new Wl;for(let _=0;_<n.sections.length;_++){const w=n.sections[_];w.image?f.addImageSection(w):f.addTextSection(w,c)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let c="";for(let f=0;f<n.length;f++){const _=n.charCodeAt(f+1)||null,w=n.charCodeAt(f-1)||null;c+=_&&Uh(_)&&!ku[n[f+1]]||w&&Uh(w)&&!ku[n[f-1]]||!ku[n[f]]?n[f]:ku[n[f]]}return c}(this.text)}trim(){let n=0;for(let f=0;f<this.text.length&&rd[this.text.charCodeAt(f)];f++)n++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=n&&rd[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(n,c),this.sectionIndex=this.sectionIndex.slice(n,c)}substring(n,c){const f=new Wl;return f.text=this.text.substring(n,c),f.sectionIndex=this.sectionIndex.slice(n,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,c)=>Math.max(n,this.sections[c].scale),0)}addTextSection(n,c){this.text+=n.text,this.sections.push(Tu.forText(n.scale,n.fontStack||c));const f=this.sections.length-1;for(let _=0;_<n.text.length;++_)this.sectionIndex.push(f)}addImageSection(n){const c=n.image?n.image.name:"";if(c.length===0)return void Ge("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Tu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Ge("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function nd(a,n,c,f,_,w,x,T,C,A,z,B,$,W,ie){const oe=Wl.fromFeature(a,_);let _e;B===d.ah.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:Ze}=$r;if(ve&&oe.sections.length===1){_e=[];const Je=ve(oe.toString(),Of(oe,A,w,n,f,W));for(const gt of Je){const Mt=new Wl;Mt.text=gt,Mt.sections=oe.sections;for(let Kt=0;Kt<gt.length;Kt++)Mt.sectionIndex.push(0);_e.push(Mt)}}else if(Ze){_e=[];const Je=Ze(oe.text,oe.sectionIndex,Of(oe,A,w,n,f,W));for(const gt of Je){const Mt=new Wl;Mt.text=gt[0],Mt.sectionIndex=gt[1],Mt.sections=oe.sections,_e.push(Mt)}}else _e=function(Je,gt){const Mt=[],Kt=Je.text;let Ct=0;for(const Tt of gt)Mt.push(Je.substring(Ct,Tt)),Ct=Tt;return Ct<Kt.length&&Mt.push(Je.substring(Ct,Kt.length)),Mt}(oe,Of(oe,A,w,n,f,W));const Ae=[],Oe={positionedLines:Ae,text:oe.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(Je,gt,Mt,Kt,Ct,Tt,Ut,Rt,Pt,tt,Zt,$t){let ii=0,Ki=Su,Hi=0,qn=0;const To=Rt==="right"?1:Rt==="left"?0:.5;let ar=0;for(const Cn of Ct){Cn.trim();const Gn=Cn.getMaxScale(),_r=(Gn-1)*On,lr={positionedGlyphs:[],lineOffset:0};Je.positionedLines[ar]=lr;const Lr=lr.positionedGlyphs;let cr=0;if(!Cn.length()){Ki+=Tt,++ar;continue}for(let qr=0;qr<Cn.length();qr++){const zi=Cn.getSection(qr),Yi=Cn.getSectionIndex(qr),on=Cn.getCharCode(qr);let io=0,pn=null,Jl=null,Xo=null,Ko=On;const Io=!(Pt===d.ah.horizontal||!Zt&&!uu(on)||Zt&&(rd[on]||(Zn=on,/\p{sc=Arab}/u.test(String.fromCodePoint(Zn)))));if(zi.imageName){const mo=Kt[zi.imageName];if(!mo)continue;Xo=zi.imageName,Je.iconsInText=Je.iconsInText||!0,Jl=mo.paddedRect;const Yn=mo.displaySize;zi.scale=zi.scale*On/$t,pn={width:Yn[0],height:Yn[1],left:Vr,top:-Wm,advance:Io?Yn[1]:Yn[0]},io=_r+(On-Yn[1]*zi.scale),Ko=pn.advance;const fs=Io?Yn[0]*zi.scale-On*Gn:Yn[1]*zi.scale-On*Gn;fs>0&&fs>cr&&(cr=fs)}else{const mo=Mt[zi.fontStack],Yn=mo&&mo[on];if(Yn&&Yn.rect)Jl=Yn.rect,pn=Yn.metrics;else{const fs=gt[zi.fontStack],Au=fs&&fs[on];if(!Au)continue;pn=Au.metrics}io=(Gn-zi.scale)*On}Io?(Je.verticalizable=!0,Lr.push({glyph:on,imageName:Xo,x:ii,y:Ki+io,vertical:Io,scale:zi.scale,fontStack:zi.fontStack,sectionIndex:Yi,metrics:pn,rect:Jl}),ii+=Ko*zi.scale+tt):(Lr.push({glyph:on,imageName:Xo,x:ii,y:Ki+io,vertical:Io,scale:zi.scale,fontStack:zi.fontStack,sectionIndex:Yi,metrics:pn,rect:Jl}),ii+=pn.advance*zi.scale+tt)}Lr.length!==0&&(Hi=Math.max(ii-tt,Hi),mv(Lr,0,Lr.length-1,To,cr)),ii=0;const po=Tt*Gn+cr;lr.lineOffset=Math.max(cr,_r),Ki+=po,qn=Math.max(po,qn),++ar}var Zn;const Ir=Ki-Su,{horizontalAlign:Cr,verticalAlign:Er}=Nf(Ut);(function(Cn,Gn,_r,lr,Lr,cr,po,qr,zi){const Yi=(Gn-_r)*Lr;let on=0;on=cr!==po?-qr*lr-Su:(-lr*zi+.5)*po;for(const io of Cn)for(const pn of io.positionedGlyphs)pn.x+=Yi,pn.y+=on})(Je.positionedLines,To,Cr,Er,Hi,qn,Tt,Ir,Ct.length),Je.top+=-Er*Ir,Je.bottom=Je.top+Ir,Je.left+=-Cr*Hi,Je.right=Je.left+Hi}(Oe,n,c,f,_e,x,T,C,B,A,$,ie),!function(Je){for(const gt of Je)if(gt.positionedGlyphs.length!==0)return!1;return!0}(Ae)&&Oe}const rd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},fv={40:!0};function Km(a,n,c,f,_,w){if(n.imageName){const x=f[n.imageName];return x?x.displaySize[0]*n.scale*On/w+_:0}{const x=c[n.fontStack],T=x&&x[a];return T?T.metrics.advance*n.scale+_:0}}function Jm(a,n,c,f){const _=Math.pow(a-n,2);return f?a<n?_/2:2*_:_+Math.abs(c)*c}function pv(a,n,c){let f=0;return a===10&&(f-=1e4),c&&(f+=150),a!==40&&a!==65288||(f+=50),n!==41&&n!==65289||(f+=50),f}function Ym(a,n,c,f,_,w){let x=null,T=Jm(n,c,_,w);for(const C of f){const A=Jm(n-C.x,c,_,w)+C.badness;A<=T&&(x=C,T=A)}return{index:a,x:n,priorBreak:x,badness:T}}function Qm(a){return a?Qm(a.priorBreak).concat(a.index):[]}function Of(a,n,c,f,_,w){if(!a)return[];const x=[],T=function(B,$,W,ie,oe,_e){let ve=0;for(let Ze=0;Ze<B.length();Ze++){const Ae=B.getSection(Ze);ve+=Km(B.getCharCode(Ze),Ae,ie,oe,$,_e)}return ve/Math.max(1,Math.ceil(ve/W))}(a,n,c,f,_,w),C=a.text.indexOf("​")>=0;let A=0;for(let B=0;B<a.length();B++){const $=a.getSection(B),W=a.getCharCode(B);if(rd[W]||(A+=Km(W,$,f,_,n,w)),B<a.length()-1){const ie=!((z=W)<11904)&&(!!Ti["CJK Compatibility Forms"](z)||!!Ti["CJK Compatibility"](z)||!!Ti["CJK Strokes"](z)||!!Ti["CJK Symbols and Punctuation"](z)||!!Ti["Enclosed CJK Letters and Months"](z)||!!Ti["Halfwidth and Fullwidth Forms"](z)||!!Ti["Ideographic Description Characters"](z)||!!Ti["Vertical Forms"](z)||$h.test(String.fromCodePoint(z)));(dv[W]||ie||$.imageName||B!==a.length()-2&&fv[a.getCharCode(B+1)])&&x.push(Ym(B+1,A,T,x,pv(W,a.getCharCode(B+1),ie&&C),!1))}}var z;return Qm(Ym(a.length(),A,T,x,0,!0))}function Nf(a){let n=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:n,verticalAlign:c}}function mv(a,n,c,f,_){if(!f&&!_)return;const w=a[c],x=(a[c].x+w.metrics.advance*w.scale)*f;for(let T=n;T<=c;T++)a[T].x-=x,a[T].y+=_}function _v(a,n,c){const{horizontalAlign:f,verticalAlign:_}=Nf(c),w=n[0]-a.displaySize[0]*f,x=n[1]-a.displaySize[1]*_;return{image:a,top:x,bottom:x+a.displaySize[1],left:w,right:w+a.displaySize[0]}}function e_(a){var n,c;let f=a.left,_=a.top,w=a.right-f,x=a.bottom-_;const T=(n=a.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",C=(c=a.image.textFitHeight)!==null&&c!==void 0?c:"stretchOrShrink",A=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(C==="proportional"){if(T==="stretchOnly"&&w/x<A||T==="proportional"){const z=Math.ceil(x*A);f*=z/w,w=z}}else if(T==="proportional"&&C==="stretchOnly"&&A!==0&&w/x>A){const z=Math.ceil(w/A);_*=z/x,x=z}return{x1:f,y1:_,x2:f+w,y2:_+x}}function t_(a,n,c,f,_,w){const x=a.image;let T;if(x.content){const _e=x.content,ve=x.pixelRatio||1;T=[_e[0]/ve,_e[1]/ve,x.displaySize[0]-_e[2]/ve,x.displaySize[1]-_e[3]/ve]}const C=n.left*w,A=n.right*w;let z,B,$,W;c==="width"||c==="both"?(W=_[0]+C-f[3],B=_[0]+A+f[1]):(W=_[0]+(C+A-x.displaySize[0])/2,B=W+x.displaySize[0]);const ie=n.top*w,oe=n.bottom*w;return c==="height"||c==="both"?(z=_[1]+ie-f[0],$=_[1]+oe+f[2]):(z=_[1]+(ie+oe-x.displaySize[1])/2,$=z+x.displaySize[1]),{image:x,top:z,right:B,bottom:$,left:W,collisionPadding:T}}const Iu=255,Ho=128,ra=Iu*Ho;function i_(a,n){const{expression:c}=n;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new en(a+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=c;let w=0;for(;w<f.length&&f[w]<=a;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<a+1;)x++;x=Math.min(f.length-1,x);const T=f[w],C=f[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:C,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:C,minSize:c.evaluate(new en(T)),maxSize:c.evaluate(new en(C)),interpolationType:_}}}function jf(a,n,c){let f="never";const _=a.get(n);return _?f=_:a.get(c)&&(f="always"),f}const gv=ia.VectorTileFeature.types,yv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function od(a,n,c,f,_,w,x,T,C,A,z,B,$){const W=T?Math.min(ra,Math.round(T[0])):0,ie=T?Math.min(ra,Math.round(T[1])):0;a.emplaceBack(n,c,Math.round(32*f),Math.round(32*_),w,x,(W<<1)+(C?1:0),ie,16*A,16*z,256*B,256*$)}function $f(a,n,c){a.emplaceBack(n.x,n.y,c),a.emplaceBack(n.x,n.y,c),a.emplaceBack(n.x,n.y,c),a.emplaceBack(n.x,n.y,c)}function bv(a){for(const n of a.sections)if(mf(n.text))return!0;return!1}class Uf{constructor(n){this.layoutVertexArray=new Fl,this.indexArray=new uo,this.programConfigurations=n,this.segments=new Ii,this.dynamicLayoutVertexArray=new fu,this.opacityVertexArray=new eo,this.hasVisibleVertices=!1,this.placedSymbolArray=new tn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,c,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Xb.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Kb.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,yv,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}zt("SymbolBuffers",Uf);class Vf{constructor(n,c,f){this.layoutVertexArray=new n,this.layoutAttributes=c,this.indexArray=new f,this.segments=new Ii,this.collisionVertexArray=new Go}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Jb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}zt("CollisionBuffers",Vf);class Hl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(x=>x.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xf([]),this.placementViewportMatrix=xf([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i_(this.zoom,c["text-size"]),this.iconSizeData=i_(this.zoom,c["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=jf(f,"text-overlap","text-allow-overlap")!=="never"||jf(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>d.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=n.sourceID}createArrays(){this.text=new Uf(new qa(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Uf(new qa(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new nn,this.lineVertexArray=new nr,this.symbolInstances=new ki,this.textAnchorOffsets=new rn}calculateGlyphDependencies(n,c,f,_,w){for(let x=0;x<n.length;x++)if(c[n.charCodeAt(x)]=!0,(f||_)&&w){const T=ku[n.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(n,c,f){const _=this.layers[0],w=_.layout,x=w.get("text-font"),T=w.get("text-field"),C=w.get("icon-image"),A=(T.value.kind!=="constant"||T.value.value instanceof Br&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),z=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,B=w.get("symbol-sort-key");if(this.features=[],!A&&!z)return;const $=c.iconDependencies,W=c.glyphDependencies,ie=c.availableImages,oe=new en(this.zoom);for(const{feature:_e,id:ve,index:Ze,sourceLayerIndex:Ae}of n){const Oe=_._featureFilter.needGeometry,Je=Ga(_e,Oe);if(!_._featureFilter.filter(oe,Je,f))continue;let gt,Mt;if(Oe||(Je.geometry=Za(_e)),A){const Ct=_.getValueAndResolveTokens("text-field",Je,f,ie),Tt=Br.factory(Ct),Ut=this.hasRTLText=this.hasRTLText||bv(Tt);(!Ut||$r.getRTLTextPluginStatus()==="unavailable"||Ut&&$r.isParsed())&&(gt=Qb(Tt,_,Je))}if(z){const Ct=_.getValueAndResolveTokens("icon-image",Je,f,ie);Mt=Ct instanceof Nr?Ct:Nr.fromString(Ct)}if(!gt&&!Mt)continue;const Kt=this.sortFeaturesByKey?B.evaluate(Je,{},f):void 0;if(this.features.push({id:ve,text:gt,icon:Mt,index:Ze,sourceLayerIndex:Ae,geometry:Je.geometry,properties:_e.properties,type:gv[_e.type],sortKey:Kt}),Mt&&($[Mt.name]=!0),gt){const Ct=x.evaluate(Je,{},f).join(","),Tt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const Ut of gt.sections)if(Ut.image)$[Ut.image.name]=!0;else{const Rt=lu(gt.toString()),Pt=Ut.fontStack||Ct,tt=W[Pt]=W[Pt]||{};this.calculateGlyphDependencies(Ut.text,tt,Tt,this.allowVerticalPlacement,Rt)}}}w.get("symbol-placement")==="line"&&(this.features=function(_e){const ve={},Ze={},Ae=[];let Oe=0;function Je(Ct){Ae.push(_e[Ct]),Oe++}function gt(Ct,Tt,Ut){const Rt=Ze[Ct];return delete Ze[Ct],Ze[Tt]=Rt,Ae[Rt].geometry[0].pop(),Ae[Rt].geometry[0]=Ae[Rt].geometry[0].concat(Ut[0]),Rt}function Mt(Ct,Tt,Ut){const Rt=ve[Tt];return delete ve[Tt],ve[Ct]=Rt,Ae[Rt].geometry[0].shift(),Ae[Rt].geometry[0]=Ut[0].concat(Ae[Rt].geometry[0]),Rt}function Kt(Ct,Tt,Ut){const Rt=Ut?Tt[0][Tt[0].length-1]:Tt[0][0];return`${Ct}:${Rt.x}:${Rt.y}`}for(let Ct=0;Ct<_e.length;Ct++){const Tt=_e[Ct],Ut=Tt.geometry,Rt=Tt.text?Tt.text.toString():null;if(!Rt){Je(Ct);continue}const Pt=Kt(Rt,Ut),tt=Kt(Rt,Ut,!0);if(Pt in Ze&&tt in ve&&Ze[Pt]!==ve[tt]){const Zt=Mt(Pt,tt,Ut),$t=gt(Pt,tt,Ae[Zt].geometry);delete ve[Pt],delete Ze[tt],Ze[Kt(Rt,Ae[$t].geometry,!0)]=$t,Ae[Zt].geometry=null}else Pt in Ze?gt(Pt,tt,Ut):tt in ve?Mt(Pt,tt,Ut):(Je(Ct),ve[Pt]=Oe-1,Ze[tt]=Oe-1)}return Ae.filter(Ct=>Ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,ve)=>_e.sortKey-ve.sortKey)}update(n,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(n,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,c){const f=this.lineVertexArray.length;if(n.segment!==void 0){let _=n.dist(c[n.segment+1]),w=n.dist(c[n.segment]);const x={};for(let T=n.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:_},T<c.length-1&&(_+=c[T+1].dist(c[T]));for(let T=n.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:w},T>0&&(w+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const C=x[T];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(n,c,f,_,w,x,T,C,A,z,B,$){const W=n.indexArray,ie=n.layoutVertexArray,oe=n.segments.prepareSegment(4*c.length,ie,W,this.canOverlap?x.sortKey:void 0),_e=this.glyphOffsetArray.length,ve=oe.vertexLength,Ze=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,Ae=x.text&&x.text.sections;for(let Oe=0;Oe<c.length;Oe++){const{tl:Je,tr:gt,bl:Mt,br:Kt,tex:Ct,pixelOffsetTL:Tt,pixelOffsetBR:Ut,minFontScaleX:Rt,minFontScaleY:Pt,glyphOffset:tt,isSDF:Zt,sectionIndex:$t}=c[Oe],ii=oe.vertexLength,Ki=tt[1];od(ie,C.x,C.y,Je.x,Ki+Je.y,Ct.x,Ct.y,f,Zt,Tt.x,Tt.y,Rt,Pt),od(ie,C.x,C.y,gt.x,Ki+gt.y,Ct.x+Ct.w,Ct.y,f,Zt,Ut.x,Tt.y,Rt,Pt),od(ie,C.x,C.y,Mt.x,Ki+Mt.y,Ct.x,Ct.y+Ct.h,f,Zt,Tt.x,Ut.y,Rt,Pt),od(ie,C.x,C.y,Kt.x,Ki+Kt.y,Ct.x+Ct.w,Ct.y+Ct.h,f,Zt,Ut.x,Ut.y,Rt,Pt),$f(n.dynamicLayoutVertexArray,C,Ze),W.emplaceBack(ii,ii+1,ii+2),W.emplaceBack(ii+1,ii+2,ii+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),Oe!==c.length-1&&$t===c[Oe+1].sectionIndex||n.programConfigurations.populatePaintArrays(ie.length,x,x.index,{},$,Ae&&Ae[$t])}n.placedSymbolArray.emplaceBack(C.x,C.y,_e,this.glyphOffsetArray.length-_e,ve,A,z,C.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],T,0,!1,0,B)}_addCollisionDebugVertex(n,c,f,_,w,x){return c.emplaceBack(0,0),n.emplaceBack(f.x,f.y,_,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(n,c,f,_,w,x,T){const C=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),A=C.vertexLength,z=w.layoutVertexArray,B=w.collisionVertexArray,$=T.anchorX,W=T.anchorY;this._addCollisionDebugVertex(z,B,x,$,W,new S(n,c)),this._addCollisionDebugVertex(z,B,x,$,W,new S(f,c)),this._addCollisionDebugVertex(z,B,x,$,W,new S(f,_)),this._addCollisionDebugVertex(z,B,x,$,W,new S(n,_)),C.vertexLength+=4;const ie=w.indexArray;ie.emplaceBack(A,A+1),ie.emplaceBack(A+1,A+2),ie.emplaceBack(A+2,A+3),ie.emplaceBack(A+3,A),C.primitiveLength+=4}addDebugCollisionBoxes(n,c,f,_){for(let w=n;w<c;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,_?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vf(to,Nm.members,Jn),this.iconCollisionBox=new Vf(to,Nm.members,Jn);for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(n,c,f,_,w,x,T,C,A){const z={};for(let B=c;B<f;B++){const $=n.get(B);z.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.textFeatureIndex=$.featureIndex;break}for(let B=_;B<w;B++){const $=n.get(B);z.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.verticalTextFeatureIndex=$.featureIndex;break}for(let B=x;B<T;B++){const $=n.get(B);z.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.iconFeatureIndex=$.featureIndex;break}for(let B=C;B<A;B++){const $=n.get(B);z.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.verticalIconFeatureIndex=$.featureIndex;break}return z}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,c){const f=n.placedSymbolArray.get(c),_=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<_;w+=4)n.indexArray.emplaceBack(w,w+1,w+2),n.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(n),f=Math.cos(n),_=[],w=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const C=this.symbolInstances.get(T);_.push(0|Math.round(c*C.anchorX+f*C.anchorY)),w.push(C.featureIndex)}return x.sort((T,C)=>_[T]-_[C]||w[C]-w[T]),x}addToSortKeyRanges(n,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,w,x)=>{_>=0&&x.indexOf(_)===w&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n_,r_;zt("SymbolBucket",Hl,{omit:["layers","collisionBoxArray","features","compareText"]}),Hl.MAX_GLYPHS=65535,Hl.addDynamicAttributes=$f;var qf={get paint(){return r_=r_||new v({"icon-opacity":new Yt(Te.paint_symbol["icon-opacity"]),"icon-color":new Yt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Yt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Yt(Te.paint_symbol["text-opacity"]),"text-color":new Yt(Te.paint_symbol["text-color"],{runtimeType:Sn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Yt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(Te.paint_symbol["text-halo-blur"]),"text-translate":new Ot(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(Te.paint_symbol["text-translate-anchor"])})},get layout(){return n_=n_||new v({"symbol-placement":new Ot(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ot(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ot(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ot(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Ot(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(Te.layout_symbol["icon-image"]),"icon-rotate":new Yt(Te.layout_symbol["icon-rotate"]),"icon-padding":new Yt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Yt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(Te.layout_symbol["text-field"]),"text-font":new Yt(Te.layout_symbol["text-font"]),"text-size":new Yt(Te.layout_symbol["text-size"]),"text-max-width":new Yt(Te.layout_symbol["text-max-width"]),"text-line-height":new Ot(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Yt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Yt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Yt(Te.layout_symbol["text-anchor"]),"text-max-angle":new Ot(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(Te.layout_symbol["text-rotate"]),"text-padding":new Ot(Te.layout_symbol["text-padding"]),"text-keep-upright":new Ot(Te.layout_symbol["text-keep-upright"]),"text-transform":new Yt(Te.layout_symbol["text-transform"]),"text-offset":new Yt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new Ot(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new Ot(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(Te.layout_symbol["text-optional"])})}};class o_{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Wr,this.defaultValue=n}evaluate(n){if(n.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(n.formattedSection))return c.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt("FormatSectionOverride",o_,{omit:["defaultValue"]});class sd extends h{constructor(n){super(n,qf)}recalculate(n,c){if(super.recalculate(n,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const w of f)_.indexOf(w)<0&&_.push(w);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,c,f,_){const w=this.layout.get(n).evaluate(c,{},f,_),x=this._unevaluatedLayout._values[n];return x.isDataDriven()||wl(x.value)||!w?w:function(T,C){return C.replace(/{([^{}]+)}/g,(A,z)=>T&&z in T?String(T[z]):"")}(c.properties,w)}createBucket(n){return new Hl(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of qf.paint.overridableProperties){if(!sd.hasPaintOverride(this.layout,n))continue;const c=this.paint.get(n),f=new o_(c),_=new vl(f,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new js("source",_):new $s("composite",_,c.value.zoomStops),this.paint._values[n]=new ko(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(n,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&sd.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,c){const f=n.get("text-field"),_=qf.paint.properties[c];let w=!1;const x=T=>{for(const C of T)if(_.overrides&&_.overrides.hasOverride(C))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Br)x(f.value.value.sections);else if(f.value.kind==="source"){const T=A=>{w||(A instanceof ro&&zn(A.value)===Fr?x(A.value.sections):A instanceof hl?x(A.sections):A.eachChild(T))},C=f.value;C._styleExpression&&T(C._styleExpression.expression)}return w}}let s_;var vv={get paint(){return s_=s_||new v({"background-color":new Ot(Te.paint_background["background-color"]),"background-pattern":new Dl(Te.paint_background["background-pattern"]),"background-opacity":new Ot(Te.paint_background["background-opacity"])})}};class wv extends h{constructor(n){super(n,vv)}}let a_;var xv={get paint(){return a_=a_||new v({"raster-opacity":new Ot(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ot(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(Te.paint_raster["raster-saturation"]),"raster-contrast":new Ot(Te.paint_raster["raster-contrast"]),"raster-resampling":new Ot(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(Te.paint_raster["raster-fade-duration"])})}};class kv extends h{constructor(n){super(n,xv)}}class Sv extends h{constructor(n){super(n,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Tv{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Zf=63710088e-1;class oa{constructor(n,c){if(isNaN(n)||isNaN(c))throw new Error(`Invalid LngLat object: (${n}, ${c})`);if(this.lng=+n,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oa(Le(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const c=Math.PI/180,f=this.lat*c,_=n.lat*c,w=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((n.lng-this.lng)*c);return Zf*Math.acos(Math.min(w,1))}static convert(n){if(n instanceof oa)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new oa(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new oa(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l_=2*Math.PI*Zf;function c_(a){return l_*Math.cos(a*Math.PI/180)}function u_(a){return(180+a)/360}function h_(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function d_(a,n){return a/c_(n)}function Gf(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class Cu{constructor(n,c,f=0){this.x=+n,this.y=+c,this.z=+f}static fromLngLat(n,c=0){const f=oa.convert(n);return new Cu(u_(f.lng),h_(f.lat),d_(c,f.lat))}toLngLat(){return new oa(360*this.x-180,Gf(this.y))}toAltitude(){return this.z*c_(Gf(this.y))}meterInMercatorCoordinateUnits(){return 1/l_*(n=Gf(this.y),1/Math.cos(n*Math.PI/180));var n}}function f_(a,n,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[a*f-2*Math.PI*6378137/2,n*f-2*Math.PI*6378137/2]}class Wf{constructor(n,c,f){if(!function(_,w,x){return!(_<0||_>25||x<0||x>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))}(n,c,f))throw new Error(`x=${c}, y=${f}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=c,this.y=f,this.key=Eu(0,n,n,c,f)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,c,f){const _=(x=this.y,T=this.z,C=f_(256*(w=this.x),256*(x=Math.pow(2,T)-x-1),T),A=f_(256*(w+1),256*(x+1),T),C[0]+","+C[1]+","+A[0]+","+A[1]);var w,x,T,C,A;const z=function(B,$,W){let ie,oe="";for(let _e=B;_e>0;_e--)ie=1<<_e-1,oe+=($&ie?1:0)+(W&ie?2:0);return oe}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,_)}isChildOf(n){const c=this.z-n.z;return c>0&&n.x===this.x>>c&&n.y===this.y>>c}getTilePoint(n){const c=Math.pow(2,this.z);return new S((n.x*c-this.x)*Dn,(n.y*c-this.y)*Dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p_{constructor(n,c){this.wrap=n,this.canonical=c,this.key=Eu(n,c.z,c.z,c.x,c.y)}}class fo{constructor(n,c,f,_,w){if(n<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${f}`);this.overscaledZ=n,this.wrap=c,this.canonical=new Wf(f,+_,+w),this.key=Eu(c,n,f,_,w)}clone(){return new fo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-n;return n>this.canonical.z?new fo(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fo(n,this.wrap,n,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(n,c){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-n;return n>this.canonical.z?Eu(this.wrap*+c,n,this.canonical.z,this.canonical.x,this.canonical.y):Eu(this.wrap*+c,n,n,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const c=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>c&&n.canonical.y===this.canonical.y>>c}children(n){if(this.overscaledZ>=n)return[new fo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new fo(c,this.wrap,c,f,_),new fo(c,this.wrap,c,f+1,_),new fo(c,this.wrap,c,f,_+1),new fo(c,this.wrap,c,f+1,_+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new fo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new fo(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Cu(n.x-this.wrap,n.y))}}function Eu(a,n,c,f,_){(a*=2)<0&&(a=-1*a-1);const w=1<<c;return(w*w*a+w*_+f).toString(36)+c.toString(36)+n.toString(36)}zt("CanonicalTileID",Wf),zt("OverscaledTileID",fo,{omit:["posMatrix"]});class m_{constructor(n,c,f,_=1,w=1,x=1,T=0){if(this.uid=n,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ge(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const C=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=w,this.blueFactor=x,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<C;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(C,A)]=this.data[this._idx(C-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,C)]=this.data[this._idx(A,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<C;A++)for(let z=0;z<C;z++){const B=this.get(A,z);B>this.max&&(this.max=B),B<this.min&&(this.min=B)}}get(n,c){const f=new Uint8Array(this.data.buffer),_=4*this._idx(n,c);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,c){if(n<-1||n>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(n+1)}unpack(n,c,f){return n*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new ho({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,c,f){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let _=c*this.dim,w=c*this.dim+this.dim,x=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:_=w-1;break;case 1:w=_+1}switch(f){case-1:x=T-1;break;case 1:T=x+1}const C=-c*this.dim,A=-f*this.dim;for(let z=x;z<T;z++)for(let B=_;B<w;B++)this.data[this._idx(B,z)]=n.data[this._idx(B+C,z+A)]}}zt("DEMData",m_);class __{constructor(n){this._stringToNumber={},this._numberToString=[];for(let c=0;c<n.length;c++){const f=n[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class g_{constructor(n,c,f,_,w){this.type="Feature",this._vectorTileFeature=n,n._z=c,n._x=f,n._y=_,this.properties=n.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(n[c]=this[c]);return n}}class y_{constructor(n,c){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Zs(Dn,16,0),this.grid3D=new Zs(Dn,16,0),this.featureIndexArray=new pr,this.promoteId=c}insert(n,c,f,_,w,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,w);const C=x?this.grid3D:this.grid;for(let A=0;A<c.length;A++){const z=c[A],B=[1/0,1/0,-1/0,-1/0];for(let $=0;$<z.length;$++){const W=z[$];B[0]=Math.min(B[0],W.x),B[1]=Math.min(B[1],W.y),B[2]=Math.max(B[2],W.x),B[3]=Math.max(B[3],W.y)}B[0]<Dn&&B[1]<Dn&&B[2]>=0&&B[3]>=0&&C.insert(T,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ia.VectorTile(new Rf(this.rawTileData)).layers,this.sourceLayerCoder=new __(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,c,f,_){this.loadVTLayers();const w=n.params||{},x=Dn/n.tileSize/n.scale,T=Wc(w.filter),C=n.queryGeometry,A=n.queryPadding*x,z=v_(C),B=this.grid.query(z.minX-A,z.minY-A,z.maxX+A,z.maxY+A),$=v_(n.cameraQueryGeometry),W=this.grid3D.query($.minX-A,$.minY-A,$.maxX+A,$.maxY+A,(_e,ve,Ze,Ae)=>function(Oe,Je,gt,Mt,Kt){for(const Tt of Oe)if(Je<=Tt.x&&gt<=Tt.y&&Mt>=Tt.x&&Kt>=Tt.y)return!0;const Ct=[new S(Je,gt),new S(Je,Kt),new S(Mt,Kt),new S(Mt,gt)];if(Oe.length>2){for(const Tt of Ct)if($l(Oe,Tt))return!0}for(let Tt=0;Tt<Oe.length-1;Tt++)if(ob(Oe[Tt],Oe[Tt+1],Ct))return!0;return!1}(n.cameraQueryGeometry,_e-A,ve-A,Ze+A,Ae+A));for(const _e of W)B.push(_e);B.sort(Iv);const ie={};let oe;for(let _e=0;_e<B.length;_e++){const ve=B[_e];if(ve===oe)continue;oe=ve;const Ze=this.featureIndexArray.get(ve);let Ae=null;this.loadMatchingFeature(ie,Ze.bucketIndex,Ze.sourceLayerIndex,Ze.featureIndex,T,w.layers,w.availableImages,c,f,_,(Oe,Je,gt)=>(Ae||(Ae=Za(Oe)),Je.queryIntersectsFeature(C,Oe,gt,Ae,this.z,n.transform,x,n.pixelPosMatrix)))}return ie}loadMatchingFeature(n,c,f,_,w,x,T,C,A,z,B){const $=this.bucketLayerIDs[c];if(x&&!function(_e,ve){for(let Ze=0;Ze<_e.length;Ze++)if(ve.indexOf(_e[Ze])>=0)return!0;return!1}(x,$))return;const W=this.sourceLayerCoder.decode(f),ie=this.vtLayers[W].feature(_);if(w.needGeometry){const _e=Ga(ie,!0);if(!w.filter(new en(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!w.filter(new en(this.tileID.overscaledZ),ie))return;const oe=this.getId(ie,W);for(let _e=0;_e<$.length;_e++){const ve=$[_e];if(x&&x.indexOf(ve)<0)continue;const Ze=C[ve];if(!Ze)continue;let Ae={};oe&&z&&(Ae=z.getState(Ze.sourceLayer||"_geojsonTileLayer",oe));const Oe=te({},A[ve]);Oe.paint=b_(Oe.paint,Ze.paint,ie,Ae,T),Oe.layout=b_(Oe.layout,Ze.layout,ie,Ae,T);const Je=!B||B(ie,Ze,Ae);if(!Je)continue;const gt=new g_(ie,this.z,this.x,this.y,oe);gt.layer=Oe;let Mt=n[ve];Mt===void 0&&(Mt=n[ve]=[]),Mt.push({featureIndex:_,feature:gt,intersectionZ:Je})}}lookupSymbolFeatures(n,c,f,_,w,x,T,C){const A={};this.loadVTLayers();const z=Wc(w);for(const B of n)this.loadMatchingFeature(A,f,_,B,z,x,T,C,c);return A}hasLayer(n){for(const c of this.bucketLayerIDs)for(const f of c)if(n===f)return!0;return!1}getId(n,c){let f=n.id;return this.promoteId&&(f=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function b_(a,n,c,f,_){return ue(a,(w,x)=>{const T=n instanceof $a?n.get(x):null;return T&&T.evaluate?T.evaluate(c,f,_):T})}function v_(a){let n=1/0,c=1/0,f=-1/0,_=-1/0;for(const w of a)n=Math.min(n,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return{minX:n,minY:c,maxX:f,maxY:_}}function Iv(a,n){return n-a}function w_(a,n,c,f,_){const w=[];for(let x=0;x<a.length;x++){const T=a[x];let C;for(let A=0;A<T.length-1;A++){let z=T[A],B=T[A+1];z.x<n&&B.x<n||(z.x<n?z=new S(n,z.y+(n-z.x)/(B.x-z.x)*(B.y-z.y))._round():B.x<n&&(B=new S(n,z.y+(n-z.x)/(B.x-z.x)*(B.y-z.y))._round()),z.y<c&&B.y<c||(z.y<c?z=new S(z.x+(c-z.y)/(B.y-z.y)*(B.x-z.x),c)._round():B.y<c&&(B=new S(z.x+(c-z.y)/(B.y-z.y)*(B.x-z.x),c)._round()),z.x>=f&&B.x>=f||(z.x>=f?z=new S(f,z.y+(f-z.x)/(B.x-z.x)*(B.y-z.y))._round():B.x>=f&&(B=new S(f,z.y+(f-z.x)/(B.x-z.x)*(B.y-z.y))._round()),z.y>=_&&B.y>=_||(z.y>=_?z=new S(z.x+(_-z.y)/(B.y-z.y)*(B.x-z.x),_)._round():B.y>=_&&(B=new S(z.x+(_-z.y)/(B.y-z.y)*(B.x-z.x),_)._round()),C&&z.equals(C[C.length-1])||(C=[z],w.push(C)),C.push(B)))))}}return w}zt("FeatureIndex",y_,{omit:["rawTileData","sourceLayerCoder"]});class sa extends S{constructor(n,c,f,_){super(n,c),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new sa(this.x,this.y,this.angle,this.segment)}}function x_(a,n,c,f,_){if(n.segment===void 0||c===0)return!0;let w=n,x=n.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=a[x].dist(w),w=a[x]}T+=a[x].dist(a[x+1]),x++;const C=[];let A=0;for(;T<c/2;){const z=a[x],B=a[x+1];if(!B)return!1;let $=a[x-1].angleTo(z)-z.angleTo(B);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:$}),A+=$;T-C[0].distance>f;)A-=C.shift().angleDelta;if(A>_)return!1;x++,T+=z.dist(B)}return!0}function k_(a){let n=0;for(let c=0;c<a.length-1;c++)n+=a[c].dist(a[c+1]);return n}function S_(a,n,c){return a?.6*n*c:0}function T_(a,n){return Math.max(a?a.right-a.left:0,n?n.right-n.left:0)}function Cv(a,n,c,f,_,w){const x=S_(c,_,w),T=T_(c,f)*w;let C=0;const A=k_(a)/2;for(let z=0;z<a.length-1;z++){const B=a[z],$=a[z+1],W=B.dist($);if(C+W>A){const ie=(A-C)/W,oe=xr.number(B.x,$.x,ie),_e=xr.number(B.y,$.y,ie),ve=new sa(oe,_e,$.angleTo(B),z);return ve._round(),!x||x_(a,ve,T,x,n)?ve:void 0}C+=W}}function Ev(a,n,c,f,_,w,x,T,C){const A=S_(f,w,x),z=T_(f,_),B=z*x,$=a[0].x===0||a[0].x===C||a[0].y===0||a[0].y===C;return n-B<n/4&&(n=B+n/4),I_(a,$?n/2*T%n:(z/2+2*w)*x*T%n,n,A,c,B,$,!1,C)}function I_(a,n,c,f,_,w,x,T,C){const A=w/2,z=k_(a);let B=0,$=n-c,W=[];for(let ie=0;ie<a.length-1;ie++){const oe=a[ie],_e=a[ie+1],ve=oe.dist(_e),Ze=_e.angleTo(oe);for(;$+c<B+ve;){$+=c;const Ae=($-B)/ve,Oe=xr.number(oe.x,_e.x,Ae),Je=xr.number(oe.y,_e.y,Ae);if(Oe>=0&&Oe<C&&Je>=0&&Je<C&&$-A>=0&&$+A<=z){const gt=new sa(Oe,Je,Ze,ie);gt._round(),f&&!x_(a,gt,w,f,_)||W.push(gt)}}B+=ve}return T||W.length||x||(W=I_(a,B/2,c,f,_,w,x,!0,C)),W}zt("Anchor",sa);const Xl=Vr;function C_(a,n,c,f){const _=[],w=a.image,x=w.pixelRatio,T=w.paddedRect.w-2*Xl,C=w.paddedRect.h-2*Xl;let A={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const z=w.stretchX||[[0,T]],B=w.stretchY||[[0,C]],$=(tt,Zt)=>tt+Zt[1]-Zt[0],W=z.reduce($,0),ie=B.reduce($,0),oe=T-W,_e=C-ie;let ve=0,Ze=W,Ae=0,Oe=ie,Je=0,gt=oe,Mt=0,Kt=_e;if(w.content&&f){const tt=w.content,Zt=tt[2]-tt[0],$t=tt[3]-tt[1];(w.textFitWidth||w.textFitHeight)&&(A=e_(a)),ve=ad(z,0,tt[0]),Ae=ad(B,0,tt[1]),Ze=ad(z,tt[0],tt[2]),Oe=ad(B,tt[1],tt[3]),Je=tt[0]-ve,Mt=tt[1]-Ae,gt=Zt-Ze,Kt=$t-Oe}const Ct=A.x1,Tt=A.y1,Ut=A.x2-Ct,Rt=A.y2-Tt,Pt=(tt,Zt,$t,ii)=>{const Ki=ld(tt.stretch-ve,Ze,Ut,Ct),Hi=cd(tt.fixed-Je,gt,tt.stretch,W),qn=ld(Zt.stretch-Ae,Oe,Rt,Tt),To=cd(Zt.fixed-Mt,Kt,Zt.stretch,ie),ar=ld($t.stretch-ve,Ze,Ut,Ct),Zn=cd($t.fixed-Je,gt,$t.stretch,W),Ir=ld(ii.stretch-Ae,Oe,Rt,Tt),Cr=cd(ii.fixed-Mt,Kt,ii.stretch,ie),Er=new S(Ki,qn),Cn=new S(ar,qn),Gn=new S(ar,Ir),_r=new S(Ki,Ir),lr=new S(Hi/x,To/x),Lr=new S(Zn/x,Cr/x),cr=n*Math.PI/180;if(cr){const zi=Math.sin(cr),Yi=Math.cos(cr),on=[Yi,-zi,zi,Yi];Er._matMult(on),Cn._matMult(on),_r._matMult(on),Gn._matMult(on)}const po=tt.stretch+tt.fixed,qr=Zt.stretch+Zt.fixed;return{tl:Er,tr:Cn,bl:_r,br:Gn,tex:{x:w.paddedRect.x+Xl+po,y:w.paddedRect.y+Xl+qr,w:$t.stretch+$t.fixed-po,h:ii.stretch+ii.fixed-qr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:Lr,minFontScaleX:gt/x/Ut,minFontScaleY:Kt/x/Rt,isSDF:c}};if(f&&(w.stretchX||w.stretchY)){const tt=E_(z,oe,W),Zt=E_(B,_e,ie);for(let $t=0;$t<tt.length-1;$t++){const ii=tt[$t],Ki=tt[$t+1];for(let Hi=0;Hi<Zt.length-1;Hi++)_.push(Pt(ii,Zt[Hi],Ki,Zt[Hi+1]))}}else _.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:C+1}));return _}function ad(a,n,c){let f=0;for(const _ of a)f+=Math.max(n,Math.min(c,_[1]))-Math.max(n,Math.min(c,_[0]));return f}function E_(a,n,c){const f=[{fixed:-Xl,stretch:0}];for(const[_,w]of a){const x=f[f.length-1];f.push({fixed:_-x.stretch,stretch:x.stretch}),f.push({fixed:_-x.stretch,stretch:x.stretch+(w-_)})}return f.push({fixed:n+Xl,stretch:c}),f}function ld(a,n,c,f){return a/n*c+f}function cd(a,n,c,f){return a-n*c/f}class ud{constructor(n,c,f,_,w,x,T,C,A,z){var B;if(this.boxStartIndex=n.length,A){let $=x.top,W=x.bottom;const ie=x.collisionPadding;ie&&($-=ie[1],W+=ie[3]);let oe=W-$;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const $=!((B=x.image)===null||B===void 0)&&B.content&&(x.image.textFitWidth||x.image.textFitHeight)?e_(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};$.y1=$.y1*T-C[0],$.y2=$.y2*T+C[2],$.x1=$.x1*T-C[3],$.x2=$.x2*T+C[1];const W=x.collisionPadding;if(W&&($.x1-=W[0]*T,$.y1-=W[1]*T,$.x2+=W[2]*T,$.y2+=W[3]*T),z){const ie=new S($.x1,$.y1),oe=new S($.x2,$.y1),_e=new S($.x1,$.y2),ve=new S($.x2,$.y2),Ze=z*Math.PI/180;ie._rotate(Ze),oe._rotate(Ze),_e._rotate(Ze),ve._rotate(Ze),$.x1=Math.min(ie.x,oe.x,_e.x,ve.x),$.x2=Math.max(ie.x,oe.x,_e.x,ve.x),$.y1=Math.min(ie.y,oe.y,_e.y,ve.y),$.y2=Math.max(ie.y,oe.y,_e.y,ve.y)}n.emplaceBack(c.x,c.y,$.x1,$.y1,$.x2,$.y2,f,_,w)}this.boxEndIndex=n.length}}class Lv{constructor(n=[],c=(f,_)=>f<_?-1:f>_?1:0){if(this.data=n,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:c,compare:f}=this,_=c[n];for(;n>0;){const w=n-1>>1,x=c[w];if(f(_,x)>=0)break;c[n]=x,n=w}c[n]=_}_down(n){const{data:c,compare:f}=this,_=this.length>>1,w=c[n];for(;n<_;){let x=1+(n<<1);const T=x+1;if(T<this.length&&f(c[T],c[x])<0&&(x=T),f(c[x],w)>=0)break;c[n]=c[x],n=x}c[n]=w}}function Mv(a,n=1,c=!1){let f=1/0,_=1/0,w=-1/0,x=-1/0;const T=a[0];for(let W=0;W<T.length;W++){const ie=T[W];(!W||ie.x<f)&&(f=ie.x),(!W||ie.y<_)&&(_=ie.y),(!W||ie.x>w)&&(w=ie.x),(!W||ie.y>x)&&(x=ie.y)}const C=Math.min(w-f,x-_);let A=C/2;const z=new Lv([],Av);if(C===0)return new S(f,_);for(let W=f;W<w;W+=C)for(let ie=_;ie<x;ie+=C)z.push(new Kl(W+A,ie+A,A,a));let B=function(W){let ie=0,oe=0,_e=0;const ve=W[0];for(let Ze=0,Ae=ve.length,Oe=Ae-1;Ze<Ae;Oe=Ze++){const Je=ve[Ze],gt=ve[Oe],Mt=Je.x*gt.y-gt.x*Je.y;oe+=(Je.x+gt.x)*Mt,_e+=(Je.y+gt.y)*Mt,ie+=3*Mt}return new Kl(oe/ie,_e/ie,0,W)}(a),$=z.length;for(;z.length;){const W=z.pop();(W.d>B.d||!B.d)&&(B=W,c&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,$)),W.max-B.d<=n||(A=W.h/2,z.push(new Kl(W.p.x-A,W.p.y-A,A,a)),z.push(new Kl(W.p.x+A,W.p.y-A,A,a)),z.push(new Kl(W.p.x-A,W.p.y+A,A,a)),z.push(new Kl(W.p.x+A,W.p.y+A,A,a)),$+=4)}return c&&(console.log(`num probes: ${$}`),console.log(`best distance: ${B.d}`)),B.p}function Av(a,n){return n.max-a.max}function Kl(a,n,c,f){this.p=new S(a,n),this.h=c,this.d=function(_,w){let x=!1,T=1/0;for(let C=0;C<w.length;C++){const A=w[C];for(let z=0,B=A.length,$=B-1;z<B;$=z++){const W=A[z],ie=A[$];W.y>_.y!=ie.y>_.y&&_.x<(ie.x-W.x)*(_.y-W.y)/(ie.y-W.y)+W.x&&(x=!x),T=Math.min(T,hm(_,W,ie))}}return(x?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var sr;d.aq=void 0,(sr=d.aq||(d.aq={}))[sr.center=1]="center",sr[sr.left=2]="left",sr[sr.right=3]="right",sr[sr.top=4]="top",sr[sr.bottom=5]="bottom",sr[sr["top-left"]=6]="top-left",sr[sr["top-right"]=7]="top-right",sr[sr["bottom-left"]=8]="bottom-left",sr[sr["bottom-right"]=9]="bottom-right";const aa=7,Hf=Number.POSITIVE_INFINITY;function L_(a,n){return n[1]!==Hf?function(c,f,_){let w=0,x=0;switch(f=Math.abs(f),_=Math.abs(_),c){case"top-right":case"top-left":case"top":x=_-aa;break;case"bottom-right":case"bottom-left":case"bottom":x=-_+aa}switch(c){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(a,n[0],n[1]):function(c,f){let _=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(c){case"top-right":case"top-left":w=x-aa;break;case"bottom-right":case"bottom-left":w=-x+aa;break;case"bottom":w=-f+aa;break;case"top":w=f-aa}switch(c){case"top-right":case"bottom-right":_=-x;break;case"top-left":case"bottom-left":_=x;break;case"left":_=f;break;case"right":_=-f}return[_,w]}(a,n[0])}function M_(a,n,c){var f;const _=a.layout,w=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(n,{},c);if(w){const T=w.values,C=[];for(let A=0;A<T.length;A+=2){const z=C[A]=T[A],B=T[A+1].map($=>$*On);z.startsWith("top")?B[1]-=aa:z.startsWith("bottom")&&(B[1]+=aa),C[A+1]=B}return new Xr(C)}const x=_.get("text-variable-anchor");if(x){let T;T=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(n,{},c)*On,Hf]:_.get("text-offset").evaluate(n,{},c).map(A=>A*On);const C=[];for(const A of x)C.push(A,L_(A,T));return new Xr(C)}return null}function Xf(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pv(a,n,c,f,_,w,x,T,C,A,z){let B=w.textMaxSize.evaluate(n,{});B===void 0&&(B=x);const $=a.layers[0].layout,W=$.get("icon-offset").evaluate(n,{},z),ie=P_(c.horizontal),oe=x/24,_e=a.tilePixelRatio*oe,ve=a.tilePixelRatio*B/24,Ze=a.tilePixelRatio*T,Ae=a.tilePixelRatio*$.get("symbol-spacing"),Oe=$.get("text-padding")*a.tilePixelRatio,Je=function(tt,Zt,$t,ii=1){const Ki=tt.get("icon-padding").evaluate(Zt,{},$t),Hi=Ki&&Ki.values;return[Hi[0]*ii,Hi[1]*ii,Hi[2]*ii,Hi[3]*ii]}($,n,z,a.tilePixelRatio),gt=$.get("text-max-angle")/180*Math.PI,Mt=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Kt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ct=$.get("symbol-placement"),Tt=Ae/2,Ut=$.get("icon-text-fit");let Rt;f&&Ut!=="none"&&(a.allowVerticalPlacement&&c.vertical&&(Rt=t_(f,c.vertical,Ut,$.get("icon-text-fit-padding"),W,oe)),ie&&(f=t_(f,ie,Ut,$.get("icon-text-fit-padding"),W,oe)));const Pt=(tt,Zt)=>{Zt.x<0||Zt.x>=Dn||Zt.y<0||Zt.y>=Dn||function($t,ii,Ki,Hi,qn,To,ar,Zn,Ir,Cr,Er,Cn,Gn,_r,lr,Lr,cr,po,qr,zi,Yi,on,io,pn,Jl){const Xo=$t.addToLineVertexArray(ii,Ki);let Ko,Io,mo,Yn,fs=0,Au=0,F_=0,B_=0,np=-1,rp=-1;const ps={};let O_=Bl("");if($t.allowVerticalPlacement&&Hi.vertical){const gr=Zn.layout.get("text-rotate").evaluate(Yi,{},pn)+90;mo=new ud(Ir,ii,Cr,Er,Cn,Hi.vertical,Gn,_r,lr,gr),ar&&(Yn=new ud(Ir,ii,Cr,Er,Cn,ar,cr,po,lr,gr))}if(qn){const gr=Zn.layout.get("icon-rotate").evaluate(Yi,{}),_o=Zn.layout.get("icon-text-fit")!=="none",Ha=C_(qn,gr,io,_o),Oo=ar?C_(ar,gr,io,_o):void 0;Io=new ud(Ir,ii,Cr,Er,Cn,qn,cr,po,!1,gr),fs=4*Ha.length;const Xa=$t.iconSizeData;let Jo=null;Xa.kind==="source"?(Jo=[Ho*Zn.layout.get("icon-size").evaluate(Yi,{})],Jo[0]>ra&&Ge(`${$t.layerIds[0]}: Value for "icon-size" is >= ${Iu}. Reduce your "icon-size".`)):Xa.kind==="composite"&&(Jo=[Ho*on.compositeIconSizes[0].evaluate(Yi,{},pn),Ho*on.compositeIconSizes[1].evaluate(Yi,{},pn)],(Jo[0]>ra||Jo[1]>ra)&&Ge(`${$t.layerIds[0]}: Value for "icon-size" is >= ${Iu}. Reduce your "icon-size".`)),$t.addSymbols($t.icon,Ha,Jo,zi,qr,Yi,d.ah.none,ii,Xo.lineStartIndex,Xo.lineLength,-1,pn),np=$t.icon.placedSymbolArray.length-1,Oo&&(Au=4*Oo.length,$t.addSymbols($t.icon,Oo,Jo,zi,qr,Yi,d.ah.vertical,ii,Xo.lineStartIndex,Xo.lineLength,-1,pn),rp=$t.icon.placedSymbolArray.length-1)}const N_=Object.keys(Hi.horizontal);for(const gr of N_){const _o=Hi.horizontal[gr];if(!Ko){O_=Bl(_o.text);const Oo=Zn.layout.get("text-rotate").evaluate(Yi,{},pn);Ko=new ud(Ir,ii,Cr,Er,Cn,_o,Gn,_r,lr,Oo)}const Ha=_o.positionedLines.length===1;if(F_+=A_($t,ii,_o,To,Zn,lr,Yi,Lr,Xo,Hi.vertical?d.ah.horizontal:d.ah.horizontalOnly,Ha?N_:[gr],ps,np,on,pn),Ha)break}Hi.vertical&&(B_+=A_($t,ii,Hi.vertical,To,Zn,lr,Yi,Lr,Xo,d.ah.vertical,["vertical"],ps,rp,on,pn));const Rv=Ko?Ko.boxStartIndex:$t.collisionBoxArray.length,Fv=Ko?Ko.boxEndIndex:$t.collisionBoxArray.length,Bv=mo?mo.boxStartIndex:$t.collisionBoxArray.length,Ov=mo?mo.boxEndIndex:$t.collisionBoxArray.length,Nv=Io?Io.boxStartIndex:$t.collisionBoxArray.length,jv=Io?Io.boxEndIndex:$t.collisionBoxArray.length,$v=Yn?Yn.boxStartIndex:$t.collisionBoxArray.length,Uv=Yn?Yn.boxEndIndex:$t.collisionBoxArray.length;let Bo=-1;const dd=(gr,_o)=>gr&&gr.circleDiameter?Math.max(gr.circleDiameter,_o):_o;Bo=dd(Ko,Bo),Bo=dd(mo,Bo),Bo=dd(Io,Bo),Bo=dd(Yn,Bo);const j_=Bo>-1?1:0;j_&&(Bo*=Jl/On),$t.glyphOffsetArray.length>=Hl.MAX_GLYPHS&&Ge("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yi.sortKey!==void 0&&$t.addToSortKeyRanges($t.symbolInstances.length,Yi.sortKey);const Vv=M_(Zn,Yi,pn),[qv,Zv]=function(gr,_o){const Ha=gr.length,Oo=_o==null?void 0:_o.values;if((Oo==null?void 0:Oo.length)>0)for(let Xa=0;Xa<Oo.length;Xa+=2){const Jo=Oo[Xa+1];gr.emplaceBack(d.aq[Oo[Xa]],Jo[0],Jo[1])}return[Ha,gr.length]}($t.textAnchorOffsets,Vv);$t.symbolInstances.emplaceBack(ii.x,ii.y,ps.right>=0?ps.right:-1,ps.center>=0?ps.center:-1,ps.left>=0?ps.left:-1,ps.vertical||-1,np,rp,O_,Rv,Fv,Bv,Ov,Nv,jv,$v,Uv,Cr,F_,B_,fs,Au,j_,0,Gn,Bo,qv,Zv)}(a,Zt,tt,c,f,_,Rt,a.layers[0],a.collisionBoxArray,n.index,n.sourceLayerIndex,a.index,_e,[Oe,Oe,Oe,Oe],Mt,C,Ze,Je,Kt,W,n,w,A,z,x)};if(Ct==="line")for(const tt of w_(n.geometry,0,0,Dn,Dn)){const Zt=Ev(tt,Ae,gt,c.vertical||ie,f,24,ve,a.overscaling,Dn);for(const $t of Zt)ie&&zv(a,ie.text,Tt,$t)||Pt(tt,$t)}else if(Ct==="line-center"){for(const tt of n.geometry)if(tt.length>1){const Zt=Cv(tt,gt,c.vertical||ie,f,24,ve);Zt&&Pt(tt,Zt)}}else if(n.type==="Polygon")for(const tt of fl(n.geometry,0)){const Zt=Mv(tt,16);Pt(tt[0],new sa(Zt.x,Zt.y,0))}else if(n.type==="LineString")for(const tt of n.geometry)Pt(tt,new sa(tt[0].x,tt[0].y,0));else if(n.type==="Point")for(const tt of n.geometry)for(const Zt of tt)Pt([Zt],new sa(Zt.x,Zt.y,0))}function A_(a,n,c,f,_,w,x,T,C,A,z,B,$,W,ie){const oe=function(Ze,Ae,Oe,Je,gt,Mt,Kt,Ct){const Tt=Je.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,Ut=[];for(const Rt of Ae.positionedLines)for(const Pt of Rt.positionedGlyphs){if(!Pt.rect)continue;const tt=Pt.rect||{};let Zt=Wm+1,$t=!0,ii=1,Ki=0;const Hi=(gt||Ct)&&Pt.vertical,qn=Pt.metrics.advance*Pt.scale/2;if(Ct&&Ae.verticalizable&&(Ki=Rt.lineOffset/2-(Pt.imageName?-(On-Pt.metrics.width*Pt.scale)/2:(Pt.scale-1)*On)),Pt.imageName){const zi=Kt[Pt.imageName];$t=zi.sdf,ii=zi.pixelRatio,Zt=Vr/ii}const To=gt?[Pt.x+qn,Pt.y]:[0,0];let ar=gt?[0,0]:[Pt.x+qn+Oe[0],Pt.y+Oe[1]-Ki],Zn=[0,0];Hi&&(Zn=ar,ar=[0,0]);const Ir=Pt.metrics.isDoubleResolution?2:1,Cr=(Pt.metrics.left-Zt)*Pt.scale-qn+ar[0],Er=(-Pt.metrics.top-Zt)*Pt.scale+ar[1],Cn=Cr+tt.w/Ir*Pt.scale/ii,Gn=Er+tt.h/Ir*Pt.scale/ii,_r=new S(Cr,Er),lr=new S(Cn,Er),Lr=new S(Cr,Gn),cr=new S(Cn,Gn);if(Hi){const zi=new S(-qn,qn-Su),Yi=-Math.PI/2,on=On/2-qn,io=new S(5-Su-on,-(Pt.imageName?on:0)),pn=new S(...Zn);_r._rotateAround(Yi,zi)._add(io)._add(pn),lr._rotateAround(Yi,zi)._add(io)._add(pn),Lr._rotateAround(Yi,zi)._add(io)._add(pn),cr._rotateAround(Yi,zi)._add(io)._add(pn)}if(Tt){const zi=Math.sin(Tt),Yi=Math.cos(Tt),on=[Yi,-zi,zi,Yi];_r._matMult(on),lr._matMult(on),Lr._matMult(on),cr._matMult(on)}const po=new S(0,0),qr=new S(0,0);Ut.push({tl:_r,tr:lr,bl:Lr,br:cr,tex:tt,writingMode:Ae.writingMode,glyphOffset:To,sectionIndex:Pt.sectionIndex,isSDF:$t,pixelOffsetTL:po,pixelOffsetBR:qr,minFontScaleX:0,minFontScaleY:0})}return Ut}(0,c,T,_,w,x,f,a.allowVerticalPlacement),_e=a.textSizeData;let ve=null;_e.kind==="source"?(ve=[Ho*_.layout.get("text-size").evaluate(x,{})],ve[0]>ra&&Ge(`${a.layerIds[0]}: Value for "text-size" is >= ${Iu}. Reduce your "text-size".`)):_e.kind==="composite"&&(ve=[Ho*W.compositeTextSizes[0].evaluate(x,{},ie),Ho*W.compositeTextSizes[1].evaluate(x,{},ie)],(ve[0]>ra||ve[1]>ra)&&Ge(`${a.layerIds[0]}: Value for "text-size" is >= ${Iu}. Reduce your "text-size".`)),a.addSymbols(a.text,oe,ve,T,w,x,A,n,C.lineStartIndex,C.lineLength,$,ie);for(const Ze of z)B[Ze]=a.text.placedSymbolArray.length-1;return 4*oe.length}function P_(a){for(const n in a)return a[n];return null}function zv(a,n,c,f){const _=a.compareText;if(n in _){const w=_[n];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<c)return!0}else _[n]=[];return _[n].push(f),!1}const z_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kf{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(n,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const w=z_[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new Kf(T,x,w,n)}constructor(n,c=64,f=Float64Array,_){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const w=z_.indexOf(this.ArrayType),x=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-T%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+C,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+C),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+C,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=n)}add(n,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=n,this.coords[this._pos++]=c,f}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Jf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,c,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:T}=this,C=[0,w.length-1,0],A=[];for(;C.length;){const z=C.pop()||0,B=C.pop()||0,$=C.pop()||0;if(B-$<=T){for(let _e=$;_e<=B;_e++){const ve=x[2*_e],Ze=x[2*_e+1];ve>=n&&ve<=f&&Ze>=c&&Ze<=_&&A.push(w[_e])}continue}const W=$+B>>1,ie=x[2*W],oe=x[2*W+1];ie>=n&&ie<=f&&oe>=c&&oe<=_&&A.push(w[W]),(z===0?n<=ie:c<=oe)&&(C.push($),C.push(W-1),C.push(1-z)),(z===0?f>=ie:_>=oe)&&(C.push(W+1),C.push(B),C.push(1-z))}return A}within(n,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:w,nodeSize:x}=this,T=[0,_.length-1,0],C=[],A=f*f;for(;T.length;){const z=T.pop()||0,B=T.pop()||0,$=T.pop()||0;if(B-$<=x){for(let _e=$;_e<=B;_e++)R_(w[2*_e],w[2*_e+1],n,c)<=A&&C.push(_[_e]);continue}const W=$+B>>1,ie=w[2*W],oe=w[2*W+1];R_(ie,oe,n,c)<=A&&C.push(_[W]),(z===0?n-f<=ie:c-f<=oe)&&(T.push($),T.push(W-1),T.push(1-z)),(z===0?n+f>=ie:c+f>=oe)&&(T.push(W+1),T.push(B),T.push(1-z))}return C}}function Jf(a,n,c,f,_,w){if(_-f<=c)return;const x=f+_>>1;D_(a,n,x,f,_,w),Jf(a,n,c,f,x-1,1-w),Jf(a,n,c,x+1,_,1-w)}function D_(a,n,c,f,_,w){for(;_>f;){if(_-f>600){const A=_-f+1,z=c-f+1,B=Math.log(A),$=.5*Math.exp(2*B/3),W=.5*Math.sqrt(B*$*(A-$)/A)*(z-A/2<0?-1:1);D_(a,n,c,Math.max(f,Math.floor(c-z*$/A+W)),Math.min(_,Math.floor(c+(A-z)*$/A+W)),w)}const x=n[2*c+w];let T=f,C=_;for(Lu(a,n,f,c),n[2*_+w]>x&&Lu(a,n,f,_);T<C;){for(Lu(a,n,T,C),T++,C--;n[2*T+w]<x;)T++;for(;n[2*C+w]>x;)C--}n[2*f+w]===x?Lu(a,n,f,C):(C++,Lu(a,n,C,_)),C<=c&&(f=C+1),c<=C&&(_=C-1)}}function Lu(a,n,c,f){Yf(a,c,f),Yf(n,2*c,2*f),Yf(n,2*c+1,2*f+1)}function Yf(a,n,c){const f=a[n];a[n]=a[c],a[c]=f}function R_(a,n,c,f){const _=a-c,w=n-f;return _*_+w*w}var Qf;d.bg=void 0,(Qf=d.bg||(d.bg={})).create="create",Qf.load="load",Qf.fullLoad="fullLoad";let hd=null,Mu=[];const ep=1e3/60,tp="loadTime",ip="fullLoadTime",Dv={mark(a){performance.mark(a)},frame(a){const n=a;hd!=null&&Mu.push(n-hd),hd=n},clearMetrics(){hd=null,Mu=[],performance.clearMeasures(tp),performance.clearMeasures(ip);for(const a in d.bg)performance.clearMarks(d.bg[a])},getPerformanceMetrics(){performance.measure(tp,d.bg.create,d.bg.load),performance.measure(ip,d.bg.create,d.bg.fullLoad);const a=performance.getEntriesByName(tp)[0].duration,n=performance.getEntriesByName(ip)[0].duration,c=Mu.length,f=1/(Mu.reduce((w,x)=>w+x,0)/c/1e3),_=Mu.filter(w=>w>ep).reduce((w,x)=>w+(x-ep)/ep,0);return{loadTime:a,fullLoadTime:n,fps:f,percentDroppedFrames:_/(c+_)*100,totalFrames:c}}};d.$=class extends O{},d.A=Ul,d.B=uf,d.C=function(a){if(rt==null){const n=a.navigator?a.navigator.userAgent:null;rt=!!a.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return rt},d.D=Ot,d.E=st,d.F=class{constructor(a,n){this.target=a,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Tv(()=>this.process()),this.subscription=function(c,f,_,w){return c.addEventListener(f,_,!1),{unsubscribe:()=>{c.removeEventListener(f,_,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=ze(self)?a:window}registerMessageHandler(a,n){this.messageHandlers[a]=n}sendAsync(a,n){return new Promise((c,f)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:c,reject:f},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const T={id:_,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const w=[],x=Object.assign(Object.assign({},a),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Gs(a.data,w)});this.target.postMessage(x,{transfer:w})})}receive(a){const n=a.data,c=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(ze(self)||n.mustQueue)return this.tasks[c]=n,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,n)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),n=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(a,n)}processTask(a,n){return s(this,void 0,void 0,function*(){if(n.type==="<response>"){const _=this.resolveRejects[a];return delete this.resolveRejects[a],_?void(n.error?_.reject(Ws(n.error)):_.resolve(Ws(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Ws(n.data),f=new AbortController;this.abortControllers[a]=f;try{const _=yield this.messageHandlers[n.type](n.sourceMapId,c,f);this.completeTask(a,null,_)}catch(_){this.completeTask(a,_)}})}completeTask(a,n,c){const f=[];delete this.abortControllers[a];const _={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?Gs(n):null,data:Gs(c,f)};this.target.postMessage(_,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.G=Ht,d.H=function(){var a=new Ul(16);return Ul!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},d.I=Bf,d.J=function(a,n,c){var f,_,w,x,T,C,A,z,B,$,W,ie,oe=c[0],_e=c[1],ve=c[2];return n===a?(a[12]=n[0]*oe+n[4]*_e+n[8]*ve+n[12],a[13]=n[1]*oe+n[5]*_e+n[9]*ve+n[13],a[14]=n[2]*oe+n[6]*_e+n[10]*ve+n[14],a[15]=n[3]*oe+n[7]*_e+n[11]*ve+n[15]):(_=n[1],w=n[2],x=n[3],T=n[4],C=n[5],A=n[6],z=n[7],B=n[8],$=n[9],W=n[10],ie=n[11],a[0]=f=n[0],a[1]=_,a[2]=w,a[3]=x,a[4]=T,a[5]=C,a[6]=A,a[7]=z,a[8]=B,a[9]=$,a[10]=W,a[11]=ie,a[12]=f*oe+T*_e+B*ve+n[12],a[13]=_*oe+C*_e+$*ve+n[13],a[14]=w*oe+A*_e+W*ve+n[14],a[15]=x*oe+z*_e+ie*ve+n[15]),a},d.K=function(a,n,c){var f=c[0],_=c[1],w=c[2];return a[0]=n[0]*f,a[1]=n[1]*f,a[2]=n[2]*f,a[3]=n[3]*f,a[4]=n[4]*_,a[5]=n[5]*_,a[6]=n[6]*_,a[7]=n[7]*_,a[8]=n[8]*w,a[9]=n[9]*w,a[10]=n[10]*w,a[11]=n[11]*w,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},d.L=mm,d.M=function(a,n){const c={};for(let f=0;f<n.length;f++){const _=n[f];_ in a&&(c[_]=a[_])}return c},d.N=oa,d.O=u_,d.P=S,d.Q=h_,d.R=ho,d.S=fo,d.T=Pl,d.U=H,d.V=G,d.W=Ft,d.X=Dn,d.Y=I,d.Z=Cu,d._=s,d.a=Bt,d.a$=function(a,n){var c=a[0],f=a[1],_=a[2],w=a[3],x=a[4],T=a[5],C=a[6],A=a[7],z=a[8],B=a[9],$=a[10],W=a[11],ie=a[12],oe=a[13],_e=a[14],ve=a[15],Ze=n[0],Ae=n[1],Oe=n[2],Je=n[3],gt=n[4],Mt=n[5],Kt=n[6],Ct=n[7],Tt=n[8],Ut=n[9],Rt=n[10],Pt=n[11],tt=n[12],Zt=n[13],$t=n[14],ii=n[15];return Math.abs(c-Ze)<=Tr*Math.max(1,Math.abs(c),Math.abs(Ze))&&Math.abs(f-Ae)<=Tr*Math.max(1,Math.abs(f),Math.abs(Ae))&&Math.abs(_-Oe)<=Tr*Math.max(1,Math.abs(_),Math.abs(Oe))&&Math.abs(w-Je)<=Tr*Math.max(1,Math.abs(w),Math.abs(Je))&&Math.abs(x-gt)<=Tr*Math.max(1,Math.abs(x),Math.abs(gt))&&Math.abs(T-Mt)<=Tr*Math.max(1,Math.abs(T),Math.abs(Mt))&&Math.abs(C-Kt)<=Tr*Math.max(1,Math.abs(C),Math.abs(Kt))&&Math.abs(A-Ct)<=Tr*Math.max(1,Math.abs(A),Math.abs(Ct))&&Math.abs(z-Tt)<=Tr*Math.max(1,Math.abs(z),Math.abs(Tt))&&Math.abs(B-Ut)<=Tr*Math.max(1,Math.abs(B),Math.abs(Ut))&&Math.abs($-Rt)<=Tr*Math.max(1,Math.abs($),Math.abs(Rt))&&Math.abs(W-Pt)<=Tr*Math.max(1,Math.abs(W),Math.abs(Pt))&&Math.abs(ie-tt)<=Tr*Math.max(1,Math.abs(ie),Math.abs(tt))&&Math.abs(oe-Zt)<=Tr*Math.max(1,Math.abs(oe),Math.abs(Zt))&&Math.abs(_e-$t)<=Tr*Math.max(1,Math.abs(_e),Math.abs($t))&&Math.abs(ve-ii)<=Tr*Math.max(1,Math.abs(ve),Math.abs(ii))},d.a0=Ii,d.a1=Wf,d.a2=ct,d.a3=a=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(c=>{n.onloadstart=()=>{c(n)};for(const f of a){const _=window.document.createElement("source");Ri(f)||(n.crossOrigin="Anonymous"),_.src=f,n.appendChild(_)}})},d.a4=function(){return Y++},d.a5=Lt,d.a6=Hl,d.a7=Wc,d.a8=Ga,d.a9=g_,d.aA=function(a){if(a.type==="custom")return new Sv(a);switch(a.type){case"background":return new wv(a);case"circle":return new lb(a);case"fill":return new Tb(a);case"fill-extrusion":return new jb(a);case"heatmap":return new ub(a);case"hillshade":return new db(a);case"line":return new Hb(a);case"raster":return new kv(a);case"symbol":return new sd(a)}},d.aB=ce,d.aC=function(a,n){if(!a)return[{command:"setStyle",args:[n]}];let c=[];try{if(!Ie(a.version,n.version))return[{command:"setStyle",args:[n]}];Ie(a.center,n.center)||c.push({command:"setCenter",args:[n.center]}),Ie(a.zoom,n.zoom)||c.push({command:"setZoom",args:[n.zoom]}),Ie(a.bearing,n.bearing)||c.push({command:"setBearing",args:[n.bearing]}),Ie(a.pitch,n.pitch)||c.push({command:"setPitch",args:[n.pitch]}),Ie(a.sprite,n.sprite)||c.push({command:"setSprite",args:[n.sprite]}),Ie(a.glyphs,n.glyphs)||c.push({command:"setGlyphs",args:[n.glyphs]}),Ie(a.transition,n.transition)||c.push({command:"setTransition",args:[n.transition]}),Ie(a.light,n.light)||c.push({command:"setLight",args:[n.light]}),Ie(a.terrain,n.terrain)||c.push({command:"setTerrain",args:[n.terrain]}),Ie(a.sky,n.sky)||c.push({command:"setSky",args:[n.sky]}),Ie(a.projection,n.projection)||c.push({command:"setProjection",args:[n.projection]});const f={},_=[];(function(x,T,C,A){let z;for(z in T=T||{},x=x||{})Object.prototype.hasOwnProperty.call(x,z)&&(Object.prototype.hasOwnProperty.call(T,z)||wi(z,C,A));for(z in T)Object.prototype.hasOwnProperty.call(T,z)&&(Object.prototype.hasOwnProperty.call(x,z)?Ie(x[z],T[z])||(x[z].type==="geojson"&&T[z].type==="geojson"&&Li(x,T,z)?nt(C,{command:"setGeoJSONSourceData",args:[z,T[z].data]}):$i(z,T,C,A)):Xt(z,T,C))})(a.sources,n.sources,_,f);const w=[];a.layers&&a.layers.forEach(x=>{"source"in x&&f[x.source]?c.push({command:"removeLayer",args:[x.id]}):w.push(x)}),c=c.concat(_),function(x,T,C){T=T||[];const A=(x=x||[]).map(Fi),z=T.map(Fi),B=x.reduce(br,{}),$=T.reduce(br,{}),W=A.slice(),ie=Object.create(null);let oe,_e,ve,Ze,Ae;for(let Oe=0,Je=0;Oe<A.length;Oe++)oe=A[Oe],Object.prototype.hasOwnProperty.call($,oe)?Je++:(nt(C,{command:"removeLayer",args:[oe]}),W.splice(W.indexOf(oe,Je),1));for(let Oe=0,Je=0;Oe<z.length;Oe++)oe=z[z.length-1-Oe],W[W.length-1-Oe]!==oe&&(Object.prototype.hasOwnProperty.call(B,oe)?(nt(C,{command:"removeLayer",args:[oe]}),W.splice(W.lastIndexOf(oe,W.length-Je),1)):Je++,Ze=W[W.length-Oe],nt(C,{command:"addLayer",args:[$[oe],Ze]}),W.splice(W.length-Oe,0,oe),ie[oe]=!0);for(let Oe=0;Oe<z.length;Oe++)if(oe=z[Oe],_e=B[oe],ve=$[oe],!ie[oe]&&!Ie(_e,ve))if(Ie(_e.source,ve.source)&&Ie(_e["source-layer"],ve["source-layer"])&&Ie(_e.type,ve.type)){for(Ae in gi(_e.layout,ve.layout,C,oe,null,"setLayoutProperty"),gi(_e.paint,ve.paint,C,oe,null,"setPaintProperty"),Ie(_e.filter,ve.filter)||nt(C,{command:"setFilter",args:[oe,ve.filter]}),Ie(_e.minzoom,ve.minzoom)&&Ie(_e.maxzoom,ve.maxzoom)||nt(C,{command:"setLayerZoomRange",args:[oe,ve.minzoom,ve.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?gi(_e[Ae],ve[Ae],C,oe,Ae.slice(6),"setPaintProperty"):Ie(_e[Ae],ve[Ae])||nt(C,{command:"setLayerProperty",args:[oe,Ae,ve[Ae]]}));for(Ae in ve)Object.prototype.hasOwnProperty.call(ve,Ae)&&!Object.prototype.hasOwnProperty.call(_e,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?gi(_e[Ae],ve[Ae],C,oe,Ae.slice(6),"setPaintProperty"):Ie(_e[Ae],ve[Ae])||nt(C,{command:"setLayerProperty",args:[oe,Ae,ve[Ae]]}))}else nt(C,{command:"removeLayer",args:[oe]}),Ze=W[W.lastIndexOf(oe)+1],nt(C,{command:"addLayer",args:[ve,Ze]})}(w,n.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[n]}]}return c},d.aD=function(a){const n=[],c=a.id;return c===void 0&&n.push({message:`layers.${c}: missing required property "id"`}),a.render===void 0&&n.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&n.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),n},d.aE=function a(n,c){if(Array.isArray(n)){if(!Array.isArray(c)||n.length!==c.length)return!1;for(let f=0;f<n.length;f++)if(!a(n[f],c[f]))return!1;return!0}if(typeof n=="object"&&n!==null&&c!==null){if(typeof c!="object"||Object.keys(n).length!==Object.keys(c).length)return!1;for(const f in n)if(!a(n[f],c[f]))return!1;return!0}return n===c},d.aF=ue,d.aG=fe,d.aH=class extends Va{constructor(a,n){super(a,n),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},d.aI=Wh,d.aJ=class extends Va{constructor(a,n){super(a,n),this.current=eb}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let n=1;n<16;n++)if(a[n]!==this.current[n]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},d.aK=rm,d.aL=om,d.aM=qi,d.aN=class extends Va{constructor(a,n){super(a,n),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},d.aO=class extends Va{constructor(a,n){super(a,n),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},d.aP=function(a,n,c,f,_,w,x){var T=1/(n-c),C=1/(f-_),A=1/(w-x);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*C,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*A,a[11]=0,a[12]=(n+c)*T,a[13]=(_+f)*C,a[14]=(x+w)*A,a[15]=1,a},d.aQ=ab,d.aR=class extends Re{},d.aS=Yb,d.aT=class extends He{},d.aU=Tf,d.aV=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},d.aW=vm,d.aX=rr,d.aY=uo,d.aZ=class extends Nt{},d.a_=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]&&a[4]===n[4]&&a[5]===n[5]&&a[6]===n[6]&&a[7]===n[7]&&a[8]===n[8]&&a[9]===n[9]&&a[10]===n[10]&&a[11]===n[11]&&a[12]===n[12]&&a[13]===n[13]&&a[14]===n[14]&&a[15]===n[15]},d.aa=function(a){const n={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,_,w)=>{const x=_||w;return n[f]=!x||x.toLowerCase(),""}),n["max-age"]){const c=parseInt(n["max-age"],10);isNaN(c)?delete n["max-age"]:n["max-age"]=c}return n},d.ab=function(a,n){const c=[];for(const f in a)f in n||c.push(f);return c},d.ac=Se,d.ad=function(a,n,c){var f=Math.sin(c),_=Math.cos(c),w=n[0],x=n[1],T=n[2],C=n[3],A=n[4],z=n[5],B=n[6],$=n[7];return n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=w*_+A*f,a[1]=x*_+z*f,a[2]=T*_+B*f,a[3]=C*_+$*f,a[4]=A*_-w*f,a[5]=z*_-x*f,a[6]=B*_-T*f,a[7]=$*_-C*f,a},d.ae=function(a){var n=new Ul(16);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n},d.af=Jh,d.ag=function(a,n){let c=0,f=0;if(a.kind==="constant")f=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:_,minZoom:w,maxZoom:x}=a,T=_?Se(kr.interpolationFactor(_,n,w,x),0,1):0;a.kind==="camera"?f=xr.number(a.minSize,a.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(a,{uSize:n,uSizeT:c},{lowerSize:f,upperSize:_}){return a.kind==="source"?f/Ho:a.kind==="composite"?xr.number(f/Ho,_/Ho,c):n},d.aj=$f,d.ak=function(a,n,c,f){const _=n.y-a.y,w=n.x-a.x,x=f.y-c.y,T=f.x-c.x,C=x*w-T*_;if(C===0)return null;const A=(T*(a.y-c.y)-x*(a.x-c.x))/C;return new S(a.x+A*w,a.y+A*_)},d.al=w_,d.am=cm,d.an=xf,d.ao=function(a){let n=1/0,c=1/0,f=-1/0,_=-1/0;for(const w of a)n=Math.min(n,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return[n,c,f,_]},d.ap=On,d.ar=jf,d.as=function(a,n){var c=n[0],f=n[1],_=n[2],w=n[3],x=n[4],T=n[5],C=n[6],A=n[7],z=n[8],B=n[9],$=n[10],W=n[11],ie=n[12],oe=n[13],_e=n[14],ve=n[15],Ze=c*T-f*x,Ae=c*C-_*x,Oe=c*A-w*x,Je=f*C-_*T,gt=f*A-w*T,Mt=_*A-w*C,Kt=z*oe-B*ie,Ct=z*_e-$*ie,Tt=z*ve-W*ie,Ut=B*_e-$*oe,Rt=B*ve-W*oe,Pt=$*ve-W*_e,tt=Ze*Pt-Ae*Rt+Oe*Ut+Je*Tt-gt*Ct+Mt*Kt;return tt?(a[0]=(T*Pt-C*Rt+A*Ut)*(tt=1/tt),a[1]=(_*Rt-f*Pt-w*Ut)*tt,a[2]=(oe*Mt-_e*gt+ve*Je)*tt,a[3]=($*gt-B*Mt-W*Je)*tt,a[4]=(C*Tt-x*Pt-A*Ct)*tt,a[5]=(c*Pt-_*Tt+w*Ct)*tt,a[6]=(_e*Oe-ie*Mt-ve*Ae)*tt,a[7]=(z*Mt-$*Oe+W*Ae)*tt,a[8]=(x*Rt-T*Tt+A*Kt)*tt,a[9]=(f*Tt-c*Rt-w*Kt)*tt,a[10]=(ie*gt-oe*Oe+ve*Ze)*tt,a[11]=(B*Oe-z*gt-W*Ze)*tt,a[12]=(T*Ct-x*Ut-C*Kt)*tt,a[13]=(c*Ut-f*Ct+_*Kt)*tt,a[14]=(oe*Ae-ie*Je-_e*Ze)*tt,a[15]=(z*Je-B*Ae+$*Ze)*tt,a):null},d.at=Xf,d.au=Nf,d.av=Kf,d.aw=function(){const a={},n=Te.$version;for(const c in Te.$root){const f=Te.$root[c];if(f.required){let _=null;_=c==="version"?n:f.type==="array"?[]:{},_!=null&&(a[c]=_)}}return a},d.ax=au,d.ay=si,d.az=function(a){a=a.slice();const n=Object.create(null);for(let c=0;c<a.length;c++)n[a[c].id]=a[c];for(let c=0;c<a.length;c++)"ref"in a[c]&&(a[c]=yt(a[c],n[a[c].ref]));return a},d.b=it,d.b0=function(a,n){return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},d.b1=function(a,n,c){return a[0]=n[0]*c[0],a[1]=n[1]*c[1],a[2]=n[2]*c[2],a[3]=n[3]*c[3],a},d.b2=function(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]+a[3]*n[3]},d.b3=Le,d.b4=p_,d.b5=d_,d.b6=function(a,n,c,f,_){var w,x=1/Math.tan(n/2);return a[0]=x/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+f)*(w=1/(f-_)),a[14]=2*_*f*w):(a[10]=-1,a[14]=-2*f),a},d.b7=function(a,n,c){var f=Math.sin(c),_=Math.cos(c),w=n[4],x=n[5],T=n[6],C=n[7],A=n[8],z=n[9],B=n[10],$=n[11];return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[4]=w*_+A*f,a[5]=x*_+z*f,a[6]=T*_+B*f,a[7]=C*_+$*f,a[8]=A*_-w*f,a[9]=z*_-x*f,a[10]=B*_-T*f,a[11]=$*_-C*f,a},d.b8=K,d.b9=le,d.bA=jm,d.bB=function(a){return a.message===et},d.bC=Ns,d.bD=$r,d.ba=function(a){return a*Math.PI/180},d.bb=function(a,n){const{x:c,y:f}=Cu.fromLngLat(n);return!(a<0||a>25||f<0||f>=1||c<0||c>=1)},d.bc=function(a,n){return a[0]=n[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},d.bd=class extends D{},d.be=Zf,d.bf=Dv,d.bh=ai,d.bi=function(a,n){Bt.REGISTERED_PROTOCOLS[a]=n},d.bj=function(a){delete Bt.REGISTERED_PROTOCOLS[a]},d.bk=function(a,n){const c={};for(let _=0;_<a.length;_++){const w=n&&n[a[_].id]||Rh(a[_]);n&&(n[a[_].id]=w);let x=c[w];x||(x=c[w]=[]),x.push(a[_])}const f=[];for(const _ in c)f.push(c[_]);return f},d.bl=zt,d.bm=__,d.bn=y_,d.bo=Xm,d.bp=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Dn/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const n=a.bucket.layers[0],c=n.layout,f=n._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new en(a.bucket.zoom+1),a.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new en(a.bucket.zoom+1),a.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new en(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:z}=a.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new en(A),a.canonical),f["text-size"].possiblyEvaluate(new en(z),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:z}=a.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new en(A),a.canonical),f["icon-size"].possiblyEvaluate(new en(z),a.canonical)]}const w=c.get("text-line-height")*On,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),C=c.get("text-size");for(const A of a.bucket.features){const z=c.get("text-font").evaluate(A,{},a.canonical).join(","),B=C.evaluate(A,{},a.canonical),$=_.layoutTextSize.evaluate(A,{},a.canonical),W=_.layoutIconSize.evaluate(A,{},a.canonical),ie={horizontal:{},vertical:void 0},oe=A.text;let _e,ve=[0,0];if(oe){const Oe=oe.toString(),Je=c.get("text-letter-spacing").evaluate(A,{},a.canonical)*On,gt=hf(Oe)?Je:0,Mt=c.get("text-anchor").evaluate(A,{},a.canonical),Kt=M_(n,A,a.canonical);if(!Kt){const Rt=c.get("text-radial-offset").evaluate(A,{},a.canonical);ve=Rt?L_(Mt,[Rt*On,Hf]):c.get("text-offset").evaluate(A,{},a.canonical).map(Pt=>Pt*On)}let Ct=x?"center":c.get("text-justify").evaluate(A,{},a.canonical);const Tt=c.get("symbol-placement")==="point"?c.get("text-max-width").evaluate(A,{},a.canonical)*On:1/0,Ut=()=>{a.bucket.allowVerticalPlacement&&lu(Oe)&&(ie.vertical=nd(oe,a.glyphMap,a.glyphPositions,a.imagePositions,z,Tt,w,Mt,"left",gt,ve,d.ah.vertical,!0,$,B))};if(!x&&Kt){const Rt=new Set;if(Ct==="auto")for(let tt=0;tt<Kt.values.length;tt+=2)Rt.add(Xf(Kt.values[tt]));else Rt.add(Ct);let Pt=!1;for(const tt of Rt)if(!ie.horizontal[tt])if(Pt)ie.horizontal[tt]=ie.horizontal[0];else{const Zt=nd(oe,a.glyphMap,a.glyphPositions,a.imagePositions,z,Tt,w,"center",tt,gt,ve,d.ah.horizontal,!1,$,B);Zt&&(ie.horizontal[tt]=Zt,Pt=Zt.positionedLines.length===1)}Ut()}else{Ct==="auto"&&(Ct=Xf(Mt));const Rt=nd(oe,a.glyphMap,a.glyphPositions,a.imagePositions,z,Tt,w,Mt,Ct,gt,ve,d.ah.horizontal,!1,$,B);Rt&&(ie.horizontal[Ct]=Rt),Ut(),lu(Oe)&&x&&T&&(ie.vertical=nd(oe,a.glyphMap,a.glyphPositions,a.imagePositions,z,Tt,w,Mt,Ct,gt,ve,d.ah.vertical,!1,$,B))}}let Ze=!1;if(A.icon&&A.icon.name){const Oe=a.imageMap[A.icon.name];Oe&&(_e=_v(a.imagePositions[A.icon.name],c.get("icon-offset").evaluate(A,{},a.canonical),c.get("icon-anchor").evaluate(A,{},a.canonical)),Ze=!!Oe.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=Ze:a.bucket.sdfIcons!==Ze&&Ge("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==a.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Ae=P_(ie.horizontal)||ie.vertical;a.bucket.iconsInText=!!Ae&&Ae.iconsInText,(Ae||_e)&&Pv(a.bucket,A,ie,_e,a.imageMap,_,$,W,ve,Ze,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},d.bq=zf,d.br=Mf,d.bs=Pf,d.bt=ia,d.bu=Rf,d.bv=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},d.bw=function(a,n,c,f,_){return s(this,void 0,void 0,function*(){if(G())try{return yield Ft(a,n,c,f,_)}catch{}return function(w,x,T,C,A){const z=w.width,B=w.height;jt&&ut||(jt=new OffscreenCanvas(z,B),ut=jt.getContext("2d",{willReadFrequently:!0})),jt.width=z,jt.height=B,ut.drawImage(w,0,0,z,B);const $=ut.getImageData(x,T,C,A);return ut.clearRect(0,0,z,B),$.data}(a,n,c,f,_)})},d.bx=m_,d.by=g,d.bz=y,d.c=at,d.d=a=>s(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(n)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=te,d.f=a=>new Promise((n,c)=>{const f=new Image;f.onload=()=>{n(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Qe})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(a)],{type:"image/png"});f.src=a.byteLength?URL.createObjectURL(_):Qe}),d.g=Dt,d.h=(a,n)=>Si(te(a,{type:"json"}),n),d.i=ze,d.j=qe,d.k=lt,d.l=(a,n)=>Si(te(a,{type:"arrayBuffer"}),n),d.m=Si,d.n=function(a){return new Rf(a).readFields(cv,[])},d.o=gu,d.p=Hm,d.q=v,d.r=cf,d.s=Ri,d.t=ou,d.u=cs,d.v=Te,d.w=Ge,d.x=function([a,n,c]){return n+=90,n*=Math.PI/180,c*=Math.PI/180,{x:a*Math.cos(n)*Math.sin(c),y:a*Math.sin(n)*Math.sin(c),z:a*Math.cos(c)}},d.y=xr,d.z=en}),l("worker",["./shared"],function(d){class s{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,V){for(const pe of q){this._layerConfigs[pe.id]=pe;const Me=this._layers[pe.id]=d.aA(pe);Me._featureFilter=d.a7(Me.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of V)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const re=d.bk(Object.values(this._layerConfigs),this.keyCache);for(const pe of re){const Me=pe.map(Ne=>this._layers[Ne.id]),De=Me[0];if(De.visibility==="none")continue;const Ue=De.source||"";let j=this.familiesBySource[Ue];j||(j=this.familiesBySource[Ue]={});const Fe=De.sourceLayer||"_geojsonTileLayer";let Ke=j[Fe];Ke||(Ke=j[Fe]=[]),Ke.push(Me)}}}class g{constructor(q){const V={},re=[];for(const Ue in q){const j=q[Ue],Fe=V[Ue]={};for(const Ke in j){const Ne=j[+Ke];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Xe={x:0,y:0,w:Ne.bitmap.width+2,h:Ne.bitmap.height+2};re.push(Xe),Fe[Ke]={rect:Xe,metrics:Ne.metrics}}}const{w:pe,h:Me}=d.p(re),De=new d.o({width:pe||1,height:Me||1});for(const Ue in q){const j=q[Ue];for(const Fe in j){const Ke=j[+Fe];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Ne=V[Ue][Fe].rect;d.o.copy(Ke.bitmap,De,{x:0,y:0},{x:Ne.x+1,y:Ne.y+1},Ke.bitmap)}}this.image=De,this.positions=V}}d.bl("GlyphAtlas",g);class y{constructor(q){this.tileID=new d.S(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId,this.inFlightDependencies=[]}parse(q,V,re,pe){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=q,this.collisionBoxArray=new d.a5;const Me=new d.bm(Object.keys(q.layers).sort()),De=new d.bn(this.tileID,this.promoteId);De.bucketLayerIDs=[];const Ue={},j={featureIndex:De,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},Fe=V.familiesBySource[this.source];for(const _i in Fe){const Vi=q.layers[_i];if(!Vi)continue;Vi.version===1&&d.w(`Vector tile source "${this.source}" layer "${_i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const an=Me.encode(_i),Vn=[];for(let Kn=0;Kn<Vi.length;Kn++){const fr=Vi.feature(Kn),Es=De.getId(fr,_i);Vn.push({feature:fr,id:Es,index:Kn,sourceLayerIndex:an})}for(const Kn of Fe[_i]){const fr=Kn[0];fr.source!==this.source&&d.w(`layer.source = ${fr.source} does not equal this.source = ${this.source}`),fr.minzoom&&this.zoom<Math.floor(fr.minzoom)||fr.maxzoom&&this.zoom>=fr.maxzoom||fr.visibility!=="none"&&(k(Kn,this.zoom,re),(Ue[fr.id]=fr.createBucket({index:De.bucketLayerIDs.length,layers:Kn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:an,sourceID:this.source})).populate(Vn,j,this.tileID.canonical),De.bucketLayerIDs.push(Kn.map(Es=>Es.id)))}}const Ke=d.aF(j.glyphDependencies,_i=>Object.keys(_i).map(Number));this.inFlightDependencies.forEach(_i=>_i==null?void 0:_i.abort()),this.inFlightDependencies=[];let Ne=Promise.resolve({});if(Object.keys(Ke).length){const _i=new AbortController;this.inFlightDependencies.push(_i),Ne=pe.sendAsync({type:"GG",data:{stacks:Ke,source:this.source,tileID:this.tileID,type:"glyphs"}},_i)}const Xe=Object.keys(j.iconDependencies);let _t=Promise.resolve({});if(Xe.length){const _i=new AbortController;this.inFlightDependencies.push(_i),_t=pe.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},_i)}const Et=Object.keys(j.patternDependencies);let pi=Promise.resolve({});if(Et.length){const _i=new AbortController;this.inFlightDependencies.push(_i),pi=pe.sendAsync({type:"GI",data:{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"}},_i)}const[Qt,ci,xi]=yield Promise.all([Ne,_t,pi]),Pn=new g(Qt),fn=new d.bo(ci,xi);for(const _i in Ue){const Vi=Ue[_i];Vi instanceof d.a6?(k(Vi.layers,this.zoom,re),d.bp({bucket:Vi,glyphMap:Qt,glyphPositions:Pn.positions,imageMap:ci,imagePositions:fn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vi.hasPattern&&(Vi instanceof d.bq||Vi instanceof d.br||Vi instanceof d.bs)&&(k(Vi.layers,this.zoom,re),Vi.addFeatures(j,this.tileID.canonical,fn.patternPositions))}return this.status="done",{buckets:Object.values(Ue).filter(_i=>!_i.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pn.image,imageAtlas:fn,glyphMap:this.returnDependencies?Qt:null,iconMap:this.returnDependencies?ci:null,glyphPositions:this.returnDependencies?Pn.positions:null}})}}function k(ye,q,V){const re=new d.z(q);for(const pe of ye)pe.recalculate(re,V)}class S{constructor(q,V,re){this.actor=q,this.layerIndex=V,this.availableImages=re,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(q,V){return d._(this,void 0,void 0,function*(){const re=yield d.l(q.request,V);try{return{vectorTile:new d.bt.VectorTile(new d.bu(re.data)),rawData:re.data,cacheControl:re.cacheControl,expires:re.expires}}catch(pe){const Me=new Uint8Array(re.data);let De=`Unable to parse the tile at ${q.request.url}, `;throw De+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${pe.message}`,new Error(De)}})}loadTile(q){return d._(this,void 0,void 0,function*(){const V=q.uid,re=!!(q&&q.request&&q.request.collectResourceTiming)&&new d.bv(q.request),pe=new y(q);this.loading[V]=pe;const Me=new AbortController;pe.abort=Me;try{const De=yield this.loadVectorTile(q,Me);if(delete this.loading[V],!De)return null;const Ue=De.rawData,j={};De.expires&&(j.expires=De.expires),De.cacheControl&&(j.cacheControl=De.cacheControl);const Fe={};if(re){const Ne=re.finish();Ne&&(Fe.resourceTiming=JSON.parse(JSON.stringify(Ne)))}pe.vectorTile=De.vectorTile;const Ke=pe.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[V]=pe,this.fetching[V]={rawTileData:Ue,cacheControl:j,resourceTiming:Fe};try{const Ne=yield Ke;return d.e({rawTileData:Ue.slice(0)},Ne,j,Fe)}finally{delete this.fetching[V]}}catch(De){throw delete this.loading[V],pe.status="done",this.loaded[V]=pe,De}})}reloadTile(q){return d._(this,void 0,void 0,function*(){const V=q.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const re=this.loaded[V];if(re.showCollisionBoxes=q.showCollisionBoxes,re.status==="parsing"){const pe=yield re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[V]){const{rawTileData:De,cacheControl:Ue,resourceTiming:j}=this.fetching[V];delete this.fetching[V],Me=d.e({rawTileData:De.slice(0)},pe,Ue,j)}else Me=pe;return Me}if(re.status==="done"&&re.vectorTile)return re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(q){return d._(this,void 0,void 0,function*(){const V=this.loading,re=q.uid;V&&V[re]&&V[re].abort&&(V[re].abort.abort(),delete V[re])})}removeTile(q){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[q.uid]&&delete this.loaded[q.uid]})}}class L{constructor(){this.loaded={}}loadTile(q){return d._(this,void 0,void 0,function*(){const{uid:V,encoding:re,rawImageData:pe,redFactor:Me,greenFactor:De,blueFactor:Ue,baseShift:j}=q,Fe=pe.width+2,Ke=pe.height+2,Ne=d.b(pe)?new d.R({width:Fe,height:Ke},yield d.bw(pe,-1,-1,Fe,Ke)):pe,Xe=new d.bx(V,Ne,re,Me,De,Ue,j);return this.loaded=this.loaded||{},this.loaded[V]=Xe,Xe})}removeTile(q){const V=this.loaded,re=q.uid;V&&V[re]&&delete V[re]}}function P(ye,q){if(ye.length!==0){R(ye[0],q);for(var V=1;V<ye.length;V++)R(ye[V],!q)}}function R(ye,q){for(var V=0,re=0,pe=0,Me=ye.length,De=Me-1;pe<Me;De=pe++){var Ue=(ye[pe][0]-ye[De][0])*(ye[De][1]+ye[pe][1]),j=V+Ue;re+=Math.abs(V)>=Math.abs(Ue)?V-j+Ue:Ue-j+V,V=j}V+re>=0!=!!q&&ye.reverse()}var Z=d.by(function ye(q,V){var re,pe=q&&q.type;if(pe==="FeatureCollection")for(re=0;re<q.features.length;re++)ye(q.features[re],V);else if(pe==="GeometryCollection")for(re=0;re<q.geometries.length;re++)ye(q.geometries[re],V);else if(pe==="Feature")ye(q.geometry,V);else if(pe==="Polygon")P(q.coordinates,V);else if(pe==="MultiPolygon")for(re=0;re<q.coordinates.length;re++)P(q.coordinates[re],V);return q});const U=d.bt.VectorTileFeature.prototype.toGeoJSON;var H={exports:{}},G=d.bz,K=d.bt.VectorTileFeature,le=Se;function Se(ye,q){this.options=q||{},this.features=ye,this.length=ye.length}function Le(ye,q){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=q||4096}Se.prototype.feature=function(ye){return new Le(this.features[ye],this.options.extent)},Le.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var q=0;q<ye.length;q++){for(var V=ye[q],re=[],pe=0;pe<V.length;pe++)re.push(new G(V[pe][0],V[pe][1]));this.geometry.push(re)}return this.geometry},Le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,q=1/0,V=-1/0,re=1/0,pe=-1/0,Me=0;Me<ye.length;Me++)for(var De=ye[Me],Ue=0;Ue<De.length;Ue++){var j=De[Ue];q=Math.min(q,j.x),V=Math.max(V,j.x),re=Math.min(re,j.y),pe=Math.max(pe,j.y)}return[q,re,V,pe]},Le.prototype.toGeoJSON=K.prototype.toGeoJSON;var te=d.bA,Y=le;function ue(ye){var q=new te;return function(V,re){for(var pe in V.layers)re.writeMessage(3,fe,V.layers[pe])}(ye,q),q.finish()}function fe(ye,q){var V;q.writeVarintField(15,ye.version||1),q.writeStringField(1,ye.name||""),q.writeVarintField(5,ye.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ye.length;V++)re.feature=ye.feature(V),q.writeMessage(2,ce,re);var pe=re.keys;for(V=0;V<pe.length;V++)q.writeStringField(3,pe[V]);var Me=re.values;for(V=0;V<Me.length;V++)q.writeMessage(4,rt,Me[V])}function ce(ye,q){var V=ye.feature;V.id!==void 0&&q.writeVarintField(1,V.id),q.writeMessage(2,ae,ye),q.writeVarintField(3,V.type),q.writeMessage(4,ze,V)}function ae(ye,q){var V=ye.feature,re=ye.keys,pe=ye.values,Me=ye.keycache,De=ye.valuecache;for(var Ue in V.properties){var j=V.properties[Ue],Fe=Me[Ue];if(j!==null){Fe===void 0&&(re.push(Ue),Me[Ue]=Fe=re.length-1),q.writeVarint(Fe);var Ke=typeof j;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(j=JSON.stringify(j));var Ne=Ke+":"+j,Xe=De[Ne];Xe===void 0&&(pe.push(j),De[Ne]=Xe=pe.length-1),q.writeVarint(Xe)}}}function Ge(ye,q){return(q<<3)+(7&ye)}function Ee(ye){return ye<<1^ye>>31}function ze(ye,q){for(var V=ye.loadGeometry(),re=ye.type,pe=0,Me=0,De=V.length,Ue=0;Ue<De;Ue++){var j=V[Ue],Fe=1;re===1&&(Fe=j.length),q.writeVarint(Ge(1,Fe));for(var Ke=re===3?j.length-1:j.length,Ne=0;Ne<Ke;Ne++){Ne===1&&re!==1&&q.writeVarint(Ge(2,Ke-1));var Xe=j[Ne].x-pe,_t=j[Ne].y-Me;q.writeVarint(Ee(Xe)),q.writeVarint(Ee(_t)),pe+=Xe,Me+=_t}re===3&&q.writeVarint(Ge(7,1))}}function rt(ye,q){var V=typeof ye;V==="string"?q.writeStringField(1,ye):V==="boolean"?q.writeBooleanField(7,ye):V==="number"&&(ye%1!=0?q.writeDoubleField(3,ye):ye<0?q.writeSVarintField(6,ye):q.writeVarintField(5,ye))}H.exports=ue,H.exports.fromVectorTileJs=ue,H.exports.fromGeojsonVt=function(ye,q){q=q||{};var V={};for(var re in ye)V[re]=new Y(ye[re].features,q),V[re].name=re,V[re].version=q.version,V[re].extent=q.extent;return ue({layers:V})},H.exports.GeoJSONWrapper=Y;var it=d.by(H.exports);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},Ft=Math.fround||(jt=new Float32Array(1),ye=>(jt[0]=+ye,jt[0]));var jt;const ut=3,et=5,at=6;class Bt{constructor(q){this.options=Object.assign(Object.create(Qe),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:V,minZoom:re,maxZoom:pe}=this.options;V&&console.time("total time");const Me=`prepare ${q.length} points`;V&&console.time(Me),this.points=q;const De=[];for(let j=0;j<q.length;j++){const Fe=q[j];if(!Fe.geometry)continue;const[Ke,Ne]=Fe.geometry.coordinates,Xe=Ft(ai(Ke)),_t=Ft(si(Ne));De.push(Xe,_t,1/0,j,-1,1),this.options.reduce&&De.push(0)}let Ue=this.trees[pe+1]=this._createTree(De);V&&console.timeEnd(Me);for(let j=pe;j>=re;j--){const Fe=+Date.now();Ue=this.trees[j]=this._createTree(this._cluster(Ue,j)),V&&console.log("z%d: %d clusters in %dms",j,Ue.numItems,+Date.now()-Fe)}return V&&console.timeEnd("total time"),this}getClusters(q,V){let re=((q[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,q[1]));let Me=q[2]===180?180:((q[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)re=-180,Me=180;else if(re>Me){const Ne=this.getClusters([re,pe,180,De],V),Xe=this.getClusters([-180,pe,Me,De],V);return Ne.concat(Xe)}const Ue=this.trees[this._limitZoom(V)],j=Ue.range(ai(re),si(De),ai(Me),si(pe)),Fe=Ue.data,Ke=[];for(const Ne of j){const Xe=this.stride*Ne;Ke.push(Fe[Xe+et]>1?Dt(Fe,Xe,this.clusterProps):this.points[Fe[Xe+ut]])}return Ke}getChildren(q){const V=this._getOriginId(q),re=this._getOriginZoom(q),pe="No cluster with the specified id.",Me=this.trees[re];if(!Me)throw new Error(pe);const De=Me.data;if(V*this.stride>=De.length)throw new Error(pe);const Ue=this.options.radius/(this.options.extent*Math.pow(2,re-1)),j=Me.within(De[V*this.stride],De[V*this.stride+1],Ue),Fe=[];for(const Ke of j){const Ne=Ke*this.stride;De[Ne+4]===q&&Fe.push(De[Ne+et]>1?Dt(De,Ne,this.clusterProps):this.points[De[Ne+ut]])}if(Fe.length===0)throw new Error(pe);return Fe}getLeaves(q,V,re){const pe=[];return this._appendLeaves(pe,q,V=V||10,re=re||0,0),pe}getTile(q,V,re){const pe=this.trees[this._limitZoom(q)],Me=Math.pow(2,q),{extent:De,radius:Ue}=this.options,j=Ue/De,Fe=(re-j)/Me,Ke=(re+1+j)/Me,Ne={features:[]};return this._addTileFeatures(pe.range((V-j)/Me,Fe,(V+1+j)/Me,Ke),pe.data,V,re,Me,Ne),V===0&&this._addTileFeatures(pe.range(1-j/Me,Fe,1,Ke),pe.data,Me,re,Me,Ne),V===Me-1&&this._addTileFeatures(pe.range(0,Fe,j/Me,Ke),pe.data,-1,re,Me,Ne),Ne.features.length?Ne:null}getClusterExpansionZoom(q){let V=this._getOriginZoom(q)-1;for(;V<=this.options.maxZoom;){const re=this.getChildren(q);if(V++,re.length!==1)break;q=re[0].properties.cluster_id}return V}_appendLeaves(q,V,re,pe,Me){const De=this.getChildren(V);for(const Ue of De){const j=Ue.properties;if(j&&j.cluster?Me+j.point_count<=pe?Me+=j.point_count:Me=this._appendLeaves(q,j.cluster_id,re,pe,Me):Me<pe?Me++:q.push(Ue),q.length===re)break}return Me}_createTree(q){const V=new d.av(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<q.length;re+=this.stride)V.add(q[re],q[re+1]);return V.finish(),V.data=q,V}_addTileFeatures(q,V,re,pe,Me,De){for(const Ue of q){const j=Ue*this.stride,Fe=V[j+et]>1;let Ke,Ne,Xe;if(Fe)Ke=Ht(V,j,this.clusterProps),Ne=V[j],Xe=V[j+1];else{const pi=this.points[V[j+ut]];Ke=pi.properties;const[Qt,ci]=pi.geometry.coordinates;Ne=ai(Qt),Xe=si(ci)}const _t={type:1,geometry:[[Math.round(this.options.extent*(Ne*Me-re)),Math.round(this.options.extent*(Xe*Me-pe))]],tags:Ke};let Et;Et=Fe||this.options.generateId?V[j+ut]:this.points[V[j+ut]].id,Et!==void 0&&(_t.id=Et),De.features.push(_t)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,V){const{radius:re,extent:pe,reduce:Me,minPoints:De}=this.options,Ue=re/(pe*Math.pow(2,V)),j=q.data,Fe=[],Ke=this.stride;for(let Ne=0;Ne<j.length;Ne+=Ke){if(j[Ne+2]<=V)continue;j[Ne+2]=V;const Xe=j[Ne],_t=j[Ne+1],Et=q.within(j[Ne],j[Ne+1],Ue),pi=j[Ne+et];let Qt=pi;for(const ci of Et){const xi=ci*Ke;j[xi+2]>V&&(Qt+=j[xi+et])}if(Qt>pi&&Qt>=De){let ci,xi=Xe*pi,Pn=_t*pi,fn=-1;const _i=((Ne/Ke|0)<<5)+(V+1)+this.points.length;for(const Vi of Et){const an=Vi*Ke;if(j[an+2]<=V)continue;j[an+2]=V;const Vn=j[an+et];xi+=j[an]*Vn,Pn+=j[an+1]*Vn,j[an+4]=_i,Me&&(ci||(ci=this._map(j,Ne,!0),fn=this.clusterProps.length,this.clusterProps.push(ci)),Me(ci,this._map(j,an)))}j[Ne+4]=_i,Fe.push(xi/Qt,Pn/Qt,1/0,_i,-1,Qt),Me&&Fe.push(fn)}else{for(let ci=0;ci<Ke;ci++)Fe.push(j[Ne+ci]);if(Qt>1)for(const ci of Et){const xi=ci*Ke;if(!(j[xi+2]<=V)){j[xi+2]=V;for(let Pn=0;Pn<Ke;Pn++)Fe.push(j[xi+Pn])}}}}return Fe}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,V,re){if(q[V+et]>1){const De=this.clusterProps[q[V+at]];return re?Object.assign({},De):De}const pe=this.points[q[V+ut]].properties,Me=this.options.map(pe);return re&&Me===pe?Object.assign({},Me):Me}}function Dt(ye,q,V){return{type:"Feature",id:ye[q+ut],properties:Ht(ye,q,V),geometry:{type:"Point",coordinates:[(re=ye[q],360*(re-.5)),Si(ye[q+1])]}};var re}function Ht(ye,q,V){const re=ye[q+et],pe=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,Me=ye[q+at],De=Me===-1?{}:Object.assign({},V[Me]);return Object.assign(De,{cluster:!0,cluster_id:ye[q+ut],point_count:re,point_count_abbreviated:pe})}function ai(ye){return ye/360+.5}function si(ye){const q=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return V<0?0:V>1?1:V}function Si(ye){const q=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Ri(ye,q,V,re){let pe=re;const Me=q+(V-q>>1);let De,Ue=V-q;const j=ye[q],Fe=ye[q+1],Ke=ye[V],Ne=ye[V+1];for(let Xe=q+3;Xe<V;Xe+=3){const _t=vi(ye[Xe],ye[Xe+1],j,Fe,Ke,Ne);if(_t>pe)De=Xe,pe=_t;else if(_t===pe){const Et=Math.abs(Xe-Me);Et<Ue&&(De=Xe,Ue=Et)}}pe>re&&(De-q>3&&Ri(ye,q,De,re),ye[De+2]=pe,V-De>3&&Ri(ye,De,V,re))}function vi(ye,q,V,re,pe,Me){let De=pe-V,Ue=Me-re;if(De!==0||Ue!==0){const j=((ye-V)*De+(q-re)*Ue)/(De*De+Ue*Ue);j>1?(V=pe,re=Me):j>0&&(V+=De*j,re+=Ue*j)}return De=ye-V,Ue=q-re,De*De+Ue*Ue}function di(ye,q,V,re){const pe={id:ye??null,type:q,geometry:V,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(q==="Point"||q==="MultiPoint"||q==="LineString")lt(pe,V);else if(q==="Polygon")lt(pe,V[0]);else if(q==="MultiLineString")for(const Me of V)lt(pe,Me);else if(q==="MultiPolygon")for(const Me of V)lt(pe,Me[0]);return pe}function lt(ye,q){for(let V=0;V<q.length;V+=3)ye.minX=Math.min(ye.minX,q[V]),ye.minY=Math.min(ye.minY,q[V+1]),ye.maxX=Math.max(ye.maxX,q[V]),ye.maxY=Math.max(ye.maxY,q[V+1])}function qe(ye,q,V,re){if(!q.geometry)return;const pe=q.geometry.coordinates;if(pe&&pe.length===0)return;const Me=q.geometry.type,De=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let Ue=[],j=q.id;if(V.promoteId?j=q.properties[V.promoteId]:V.generateId&&(j=re||0),Me==="Point")st(pe,Ue);else if(Me==="MultiPoint")for(const Fe of pe)st(Fe,Ue);else if(Me==="LineString")Te(pe,Ue,De,!1);else if(Me==="MultiLineString"){if(V.lineMetrics){for(const Fe of pe)Ue=[],Te(Fe,Ue,De,!1),ye.push(di(j,"LineString",Ue,q.properties));return}mt(pe,Ue,De,!1)}else if(Me==="Polygon")mt(pe,Ue,De,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const Fe of q.geometry.geometries)qe(ye,{id:j,geometry:Fe,properties:q.properties},V,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Fe of pe){const Ke=[];mt(Fe,Ke,De,!0),Ue.push(Ke)}}ye.push(di(j,Me,Ue,q.properties))}function st(ye,q){q.push(yt(ye[0]),Ie(ye[1]),0)}function Te(ye,q,V,re){let pe,Me,De=0;for(let j=0;j<ye.length;j++){const Fe=yt(ye[j][0]),Ke=Ie(ye[j][1]);q.push(Fe,Ke,0),j>0&&(De+=re?(pe*Ke-Fe*Me)/2:Math.sqrt(Math.pow(Fe-pe,2)+Math.pow(Ke-Me,2))),pe=Fe,Me=Ke}const Ue=q.length-3;q[2]=1,Ri(q,0,Ue,V),q[Ue+2]=1,q.size=Math.abs(De),q.start=0,q.end=q.size}function mt(ye,q,V,re){for(let pe=0;pe<ye.length;pe++){const Me=[];Te(ye[pe],Me,V,re),q.push(Me)}}function yt(ye){return ye/360+.5}function Ie(ye){const q=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return V<0?0:V>1?1:V}function nt(ye,q,V,re,pe,Me,De,Ue){if(re/=q,Me>=(V/=q)&&De<re)return ye;if(De<V||Me>=re)return null;const j=[];for(const Fe of ye){const Ke=Fe.geometry;let Ne=Fe.type;const Xe=pe===0?Fe.minX:Fe.minY,_t=pe===0?Fe.maxX:Fe.maxY;if(Xe>=V&&_t<re){j.push(Fe);continue}if(_t<V||Xe>=re)continue;let Et=[];if(Ne==="Point"||Ne==="MultiPoint")Xt(Ke,Et,V,re,pe);else if(Ne==="LineString")wi(Ke,Et,V,re,pe,!1,Ue.lineMetrics);else if(Ne==="MultiLineString")Li(Ke,Et,V,re,pe,!1);else if(Ne==="Polygon")Li(Ke,Et,V,re,pe,!0);else if(Ne==="MultiPolygon")for(const pi of Ke){const Qt=[];Li(pi,Qt,V,re,pe,!0),Qt.length&&Et.push(Qt)}if(Et.length){if(Ue.lineMetrics&&Ne==="LineString"){for(const pi of Et)j.push(di(Fe.id,Ne,pi,Fe.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(Et.length===1?(Ne="LineString",Et=Et[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=Et.length===3?"Point":"MultiPoint"),j.push(di(Fe.id,Ne,Et,Fe.tags))}}return j.length?j:null}function Xt(ye,q,V,re,pe){for(let Me=0;Me<ye.length;Me+=3){const De=ye[Me+pe];De>=V&&De<=re&&gi(q,ye[Me],ye[Me+1],ye[Me+2])}}function wi(ye,q,V,re,pe,Me,De){let Ue=$i(ye);const j=pe===0?Fi:br;let Fe,Ke,Ne=ye.start;for(let Qt=0;Qt<ye.length-3;Qt+=3){const ci=ye[Qt],xi=ye[Qt+1],Pn=ye[Qt+2],fn=ye[Qt+3],_i=ye[Qt+4],Vi=pe===0?ci:xi,an=pe===0?fn:_i;let Vn=!1;De&&(Fe=Math.sqrt(Math.pow(ci-fn,2)+Math.pow(xi-_i,2))),Vi<V?an>V&&(Ke=j(Ue,ci,xi,fn,_i,V),De&&(Ue.start=Ne+Fe*Ke)):Vi>re?an<re&&(Ke=j(Ue,ci,xi,fn,_i,re),De&&(Ue.start=Ne+Fe*Ke)):gi(Ue,ci,xi,Pn),an<V&&Vi>=V&&(Ke=j(Ue,ci,xi,fn,_i,V),Vn=!0),an>re&&Vi<=re&&(Ke=j(Ue,ci,xi,fn,_i,re),Vn=!0),!Me&&Vn&&(De&&(Ue.end=Ne+Fe*Ke),q.push(Ue),Ue=$i(ye)),De&&(Ne+=Fe)}let Xe=ye.length-3;const _t=ye[Xe],Et=ye[Xe+1],pi=pe===0?_t:Et;pi>=V&&pi<=re&&gi(Ue,_t,Et,ye[Xe+2]),Xe=Ue.length-3,Me&&Xe>=3&&(Ue[Xe]!==Ue[0]||Ue[Xe+1]!==Ue[1])&&gi(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&q.push(Ue)}function $i(ye){const q=[];return q.size=ye.size,q.start=ye.start,q.end=ye.end,q}function Li(ye,q,V,re,pe,Me){for(const De of ye)wi(De,q,V,re,pe,Me,!1)}function gi(ye,q,V,re){ye.push(q,V,re)}function Fi(ye,q,V,re,pe,Me){const De=(Me-q)/(re-q);return gi(ye,Me,V+(pe-V)*De,1),De}function br(ye,q,V,re,pe,Me){const De=(Me-V)/(pe-V);return gi(ye,q+(re-q)*De,Me,1),De}function ct(ye,q){const V=[];for(let re=0;re<ye.length;re++){const pe=ye[re],Me=pe.type;let De;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")De=tr(pe.geometry,q);else if(Me==="MultiLineString"||Me==="Polygon"){De=[];for(const Ue of pe.geometry)De.push(tr(Ue,q))}else if(Me==="MultiPolygon"){De=[];for(const Ue of pe.geometry){const j=[];for(const Fe of Ue)j.push(tr(Fe,q));De.push(j)}}V.push(di(pe.id,Me,De,pe.tags))}return V}function tr(ye,q){const V=[];V.size=ye.size,ye.start!==void 0&&(V.start=ye.start,V.end=ye.end);for(let re=0;re<ye.length;re+=3)V.push(ye[re]+q,ye[re+1],ye[re+2]);return V}function dn(ye,q){if(ye.transformed)return ye;const V=1<<ye.z,re=ye.x,pe=ye.y;for(const Me of ye.features){const De=Me.geometry,Ue=Me.type;if(Me.geometry=[],Ue===1)for(let j=0;j<De.length;j+=2)Me.geometry.push(Un(De[j],De[j+1],q,V,re,pe));else for(let j=0;j<De.length;j++){const Fe=[];for(let Ke=0;Ke<De[j].length;Ke+=2)Fe.push(Un(De[j][Ke],De[j][Ke+1],q,V,re,pe));Me.geometry.push(Fe)}}return ye.transformed=!0,ye}function Un(ye,q,V,re,pe,Me){return[Math.round(V*(ye*re-pe)),Math.round(V*(q*re-Me))]}function Wr(ye,q,V,re,pe){const Me=q===pe.maxZoom?0:pe.tolerance/((1<<q)*pe.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:V,y:re,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ue of ye)vt(De,Ue,Me,pe);return De}function vt(ye,q,V,re){const pe=q.geometry,Me=q.type,De=[];if(ye.minX=Math.min(ye.minX,q.minX),ye.minY=Math.min(ye.minY,q.minY),ye.maxX=Math.max(ye.maxX,q.maxX),ye.maxY=Math.max(ye.maxY,q.maxY),Me==="Point"||Me==="MultiPoint")for(let Ue=0;Ue<pe.length;Ue+=3)De.push(pe[Ue],pe[Ue+1]),ye.numPoints++,ye.numSimplified++;else if(Me==="LineString")li(De,pe,ye,V,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let Ue=0;Ue<pe.length;Ue++)li(De,pe[Ue],ye,V,Me==="Polygon",Ue===0);else if(Me==="MultiPolygon")for(let Ue=0;Ue<pe.length;Ue++){const j=pe[Ue];for(let Fe=0;Fe<j.length;Fe++)li(De,j[Fe],ye,V,!0,Fe===0)}if(De.length){let Ue=q.tags||null;if(Me==="LineString"&&re.lineMetrics){Ue={};for(const Fe in q.tags)Ue[Fe]=q.tags[Fe];Ue.mapbox_clip_start=pe.start/pe.size,Ue.mapbox_clip_end=pe.end/pe.size}const j={geometry:De,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ue};q.id!==null&&(j.id=q.id),ye.features.push(j)}}function li(ye,q,V,re,pe,Me){const De=re*re;if(re>0&&q.size<(pe?De:re))return void(V.numPoints+=q.length/3);const Ue=[];for(let j=0;j<q.length;j+=3)(re===0||q[j+2]>De)&&(V.numSimplified++,Ue.push(q[j],q[j+1])),V.numPoints++;pe&&function(j,Fe){let Ke=0;for(let Ne=0,Xe=j.length,_t=Xe-2;Ne<Xe;_t=Ne,Ne+=2)Ke+=(j[Ne]-j[_t])*(j[Ne+1]+j[_t+1]);if(Ke>0===Fe)for(let Ne=0,Xe=j.length;Ne<Xe/2;Ne+=2){const _t=j[Ne],Et=j[Ne+1];j[Ne]=j[Xe-2-Ne],j[Ne+1]=j[Xe-1-Ne],j[Xe-2-Ne]=_t,j[Xe-1-Ne]=Et}}(Ue,Me),ye.push(Ue)}const Jt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Sn{constructor(q,V){const re=(V=this.options=function(Me,De){for(const Ue in De)Me[Ue]=De[Ue];return Me}(Object.create(Jt),V)).debug;if(re&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let pe=function(Me,De){const Ue=[];if(Me.type==="FeatureCollection")for(let j=0;j<Me.features.length;j++)qe(Ue,Me.features[j],De,j);else qe(Ue,Me.type==="Feature"?Me:{geometry:Me},De);return Ue}(q,V);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=function(Me,De){const Ue=De.buffer/De.extent;let j=Me;const Fe=nt(Me,1,-1-Ue,Ue,0,-1,2,De),Ke=nt(Me,1,1-Ue,2+Ue,0,-1,2,De);return(Fe||Ke)&&(j=nt(Me,1,-Ue,1+Ue,0,-1,2,De)||[],Fe&&(j=ct(Fe,1).concat(j)),Ke&&(j=j.concat(ct(Ke,-1)))),j}(pe,V),pe.length&&this.splitTile(pe,0,0,0),re&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(q,V,re,pe,Me,De,Ue){const j=[q,V,re,pe],Fe=this.options,Ke=Fe.debug;for(;j.length;){pe=j.pop(),re=j.pop(),V=j.pop(),q=j.pop();const Ne=1<<V,Xe=Bn(V,re,pe);let _t=this.tiles[Xe];if(!_t&&(Ke>1&&console.time("creation"),_t=this.tiles[Xe]=Wr(q,V,re,pe,Fe),this.tileCoords.push({z:V,x:re,y:pe}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,re,pe,_t.numFeatures,_t.numPoints,_t.numSimplified),console.timeEnd("creation"));const Vn=`z${V}`;this.stats[Vn]=(this.stats[Vn]||0)+1,this.total++}if(_t.source=q,Me==null){if(V===Fe.indexMaxZoom||_t.numPoints<=Fe.indexMaxPoints)continue}else{if(V===Fe.maxZoom||V===Me)continue;if(Me!=null){const Vn=Me-V;if(re!==De>>Vn||pe!==Ue>>Vn)continue}}if(_t.source=null,q.length===0)continue;Ke>1&&console.time("clipping");const Et=.5*Fe.buffer/Fe.extent,pi=.5-Et,Qt=.5+Et,ci=1+Et;let xi=null,Pn=null,fn=null,_i=null,Vi=nt(q,Ne,re-Et,re+Qt,0,_t.minX,_t.maxX,Fe),an=nt(q,Ne,re+pi,re+ci,0,_t.minX,_t.maxX,Fe);q=null,Vi&&(xi=nt(Vi,Ne,pe-Et,pe+Qt,1,_t.minY,_t.maxY,Fe),Pn=nt(Vi,Ne,pe+pi,pe+ci,1,_t.minY,_t.maxY,Fe),Vi=null),an&&(fn=nt(an,Ne,pe-Et,pe+Qt,1,_t.minY,_t.maxY,Fe),_i=nt(an,Ne,pe+pi,pe+ci,1,_t.minY,_t.maxY,Fe),an=null),Ke>1&&console.timeEnd("clipping"),j.push(xi||[],V+1,2*re,2*pe),j.push(Pn||[],V+1,2*re,2*pe+1),j.push(fn||[],V+1,2*re+1,2*pe),j.push(_i||[],V+1,2*re+1,2*pe+1)}}getTile(q,V,re){q=+q,V=+V,re=+re;const pe=this.options,{extent:Me,debug:De}=pe;if(q<0||q>24)return null;const Ue=1<<q,j=Bn(q,V=V+Ue&Ue-1,re);if(this.tiles[j])return dn(this.tiles[j],Me);De>1&&console.log("drilling down to z%d-%d-%d",q,V,re);let Fe,Ke=q,Ne=V,Xe=re;for(;!Fe&&Ke>0;)Ke--,Ne>>=1,Xe>>=1,Fe=this.tiles[Bn(Ke,Ne,Xe)];return Fe&&Fe.source?(De>1&&(console.log("found parent tile z%d-%d-%d",Ke,Ne,Xe),console.time("drilling down")),this.splitTile(Fe.source,Ke,Ne,Xe,q,V,re),De>1&&console.timeEnd("drilling down"),this.tiles[j]?dn(this.tiles[j],Me):null):null}}function Bn(ye,q,V){return 32*((1<<ye)*V+q)+ye}function ei(ye,q){return q?ye.properties[q]:ye.id}function vr(ye,q){if(ye==null)return!0;if(ye.type==="Feature")return ei(ye,q)!=null;if(ye.type==="FeatureCollection"){const V=new Set;for(const re of ye.features){const pe=ei(re,q);if(pe==null||V.has(pe))return!1;V.add(pe)}return!0}return!1}function Fr(ye,q){const V=new Map;if(ye!=null)if(ye.type==="Feature")V.set(ei(ye,q),ye);else for(const re of ye.features)V.set(ei(re,q),re);return V}class Hr extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(q,V){return d._(this,void 0,void 0,function*(){const re=q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const pe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!pe)return null;const Me=new class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.X,this.length=Ue.length,this._features=Ue}feature(Ue){return new class{constructor(j){this._feature=j,this.extent=d.X,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(this._feature.type===1){const j=[];for(const Fe of this._feature.geometry)j.push([new d.P(Fe[0],Fe[1])]);return j}{const j=[];for(const Fe of this._feature.geometry){const Ke=[];for(const Ne of Fe)Ke.push(new d.P(Ne[0],Ne[1]));j.push(Ke)}return j}}toGeoJSON(j,Fe,Ke){return U.call(this,j,Fe,Ke)}}(this._features[Ue])}}(pe.features);let De=it(Me);return De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),{vectorTile:Me,rawData:De.buffer}})}loadData(q){return d._(this,void 0,void 0,function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const re=!!(q&&q.request&&q.request.collectResourceTiming)&&new d.bv(q.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(q,this._pendingRequest),this._geoJSONIndex=q.cluster?new Bt(function({superclusterOptions:De,clusterProperties:Ue}){if(!Ue||!De)return De;const j={},Fe={},Ke={accumulated:null,zoom:0},Ne={properties:null},Xe=Object.keys(Ue);for(const _t of Xe){const[Et,pi]=Ue[_t],Qt=d.bC(pi),ci=d.bC(typeof Et=="string"?[Et,["accumulated"],["get",_t]]:Et);j[_t]=Qt.value,Fe[_t]=ci.value}return De.map=_t=>{Ne.properties=_t;const Et={};for(const pi of Xe)Et[pi]=j[pi].evaluate(Ke,Ne);return Et},De.reduce=(_t,Et)=>{Ne.properties=Et;for(const pi of Xe)Ke.accumulated=_t[pi],_t[pi]=Fe[pi].evaluate(Ke,Ne)},De}(q)).load((yield this._pendingData).features):(pe=yield this._pendingData,new Sn(pe,q.geojsonVtOptions)),this.loaded={};const Me={};if(re){const De=re.finish();De&&(Me.resourceTiming={},Me.resourceTiming[q.source]=JSON.parse(JSON.stringify(De)))}return Me}catch(Me){if(delete this._pendingRequest,d.bB(Me))return{abandoned:!0};throw Me}var pe})}getData(){return d._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(q){const V=this.loaded;return V&&V[q.uid]?super.reloadTile(q):this.loadTile(q)}loadAndProcessGeoJSON(q,V){return d._(this,void 0,void 0,function*(){let re=yield this.loadGeoJSON(q,V);if(delete this._pendingRequest,typeof re!="object")throw new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`);if(Z(re,!0),q.filter){const pe=d.bC(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(De=>`${De.key}: ${De.message}`).join(", "));re={type:"FeatureCollection",features:re.features.filter(De=>pe.value.evaluate({zoom:0},De))}}return re})}loadGeoJSON(q,V){return d._(this,void 0,void 0,function*(){const{promoteId:re}=q;if(q.request){const pe=yield d.h(q.request,V);return this._dataUpdateable=vr(pe.data,re)?Fr(pe.data,re):void 0,pe.data}if(typeof q.data=="string")try{const pe=JSON.parse(q.data);return this._dataUpdateable=vr(pe,re)?Fr(pe,re):void 0,pe}catch{throw new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`)}if(!q.dataDiff)throw new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${q.source}`);return function(pe,Me,De){var Ue,j,Fe,Ke;if(Me.removeAll&&pe.clear(),Me.remove)for(const Ne of Me.remove)pe.delete(Ne);if(Me.add)for(const Ne of Me.add){const Xe=ei(Ne,De);Xe!=null&&pe.set(Xe,Ne)}if(Me.update)for(const Ne of Me.update){let Xe=pe.get(Ne.id);if(Xe==null)continue;const _t=!Ne.removeAllProperties&&(((Ue=Ne.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0||((j=Ne.addOrUpdateProperties)===null||j===void 0?void 0:j.length)>0);if((Ne.newGeometry||Ne.removeAllProperties||_t)&&(Xe=Object.assign({},Xe),pe.set(Ne.id,Xe),_t&&(Xe.properties=Object.assign({},Xe.properties))),Ne.newGeometry&&(Xe.geometry=Ne.newGeometry),Ne.removeAllProperties)Xe.properties={};else if(((Fe=Ne.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0)for(const Et of Ne.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,Et)&&delete Xe.properties[Et];if(((Ke=Ne.addOrUpdateProperties)===null||Ke===void 0?void 0:Ke.length)>0)for(const{key:Et,value:pi}of Ne.addOrUpdateProperties)Xe.properties[Et]=pi}}(this._dataUpdateable,q.dataDiff,re),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(q){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(q){return this._geoJSONIndex.getClusterExpansionZoom(q.clusterId)}getClusterChildren(q){return this._geoJSONIndex.getChildren(q.clusterId)}getClusterLeaves(q){return this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset)}}class wr{constructor(q){this.self=q,this.actor=new d.F(q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(V,re)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=re},this.self.addProtocol=d.bi,this.self.removeProtocol=d.bj,this.self.registerRTLTextPlugin=V=>{if(d.bD.isParsed())throw new Error("RTL text plugin already registered.");d.bD.setMethods(V)},this.actor.registerMessageHandler("LDT",(V,re)=>this._getDEMWorkerSource(V,re.source).loadTile(re)),this.actor.registerMessageHandler("RDT",(V,re)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(V,re.source).removeTile(re)})),this.actor.registerMessageHandler("GCEZ",(V,re)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(V,re.type,re.source).getClusterExpansionZoom(re)})),this.actor.registerMessageHandler("GCC",(V,re)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(V,re.type,re.source).getClusterChildren(re)})),this.actor.registerMessageHandler("GCL",(V,re)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(V,re.type,re.source).getClusterLeaves(re)})),this.actor.registerMessageHandler("LD",(V,re)=>this._getWorkerSource(V,re.type,re.source).loadData(re)),this.actor.registerMessageHandler("GD",(V,re)=>this._getWorkerSource(V,re.type,re.source).getData()),this.actor.registerMessageHandler("LT",(V,re)=>this._getWorkerSource(V,re.type,re.source).loadTile(re)),this.actor.registerMessageHandler("RT",(V,re)=>this._getWorkerSource(V,re.type,re.source).reloadTile(re)),this.actor.registerMessageHandler("AT",(V,re)=>this._getWorkerSource(V,re.type,re.source).abortTile(re)),this.actor.registerMessageHandler("RMT",(V,re)=>this._getWorkerSource(V,re.type,re.source).removeTile(re)),this.actor.registerMessageHandler("RS",(V,re)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[V]||!this.workerSources[V][re.type]||!this.workerSources[V][re.type][re.source])return;const pe=this.workerSources[V][re.type][re.source];delete this.workerSources[V][re.type][re.source],pe.removeSource!==void 0&&pe.removeSource(re)})),this.actor.registerMessageHandler("RM",V=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V]})),this.actor.registerMessageHandler("SR",(V,re)=>d._(this,void 0,void 0,function*(){this.referrer=re})),this.actor.registerMessageHandler("SRPS",(V,re)=>this._syncRTLPluginState(V,re)),this.actor.registerMessageHandler("IS",(V,re)=>d._(this,void 0,void 0,function*(){this.self.importScripts(re)})),this.actor.registerMessageHandler("SI",(V,re)=>this._setImages(V,re)),this.actor.registerMessageHandler("UL",(V,re)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(V).update(re.layers,re.removedIds)})),this.actor.registerMessageHandler("SL",(V,re)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(V).replace(re)}))}_setImages(q,V){return d._(this,void 0,void 0,function*(){this.availableImages[q]=V;for(const re in this.workerSources[q]){const pe=this.workerSources[q][re];for(const Me in pe)pe[Me].availableImages=V}})}_syncRTLPluginState(q,V){return d._(this,void 0,void 0,function*(){if(d.bD.isParsed())return d.bD.getState();if(V.pluginStatus!=="loading")return d.bD.setState(V),V;const re=V.pluginURL;if(this.self.importScripts(re),d.bD.isParsed()){const pe={pluginStatus:"loaded",pluginURL:re};return d.bD.setState(pe),pe}throw d.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${re}`)})}_getAvailableImages(q){let V=this.availableImages[q];return V||(V=[]),V}_getLayerIndex(q){let V=this.layerIndexes[q];return V||(V=this.layerIndexes[q]=new s),V}_getWorkerSource(q,V,re){if(this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][V]||(this.workerSources[q][V]={}),!this.workerSources[q][V][re]){const pe={sendAsync:(Me,De)=>(Me.targetMapId=q,this.actor.sendAsync(Me,De))};switch(V){case"vector":this.workerSources[q][V][re]=new S(pe,this._getLayerIndex(q),this._getAvailableImages(q));break;case"geojson":this.workerSources[q][V][re]=new Hr(pe,this._getLayerIndex(q),this._getAvailableImages(q));break;default:this.workerSources[q][V][re]=new this.externalWorkerSourceTypes[V](pe,this._getLayerIndex(q),this._getAvailableImages(q))}}return this.workerSources[q][V][re]}_getDEMWorkerSource(q,V){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][V]||(this.demWorkerSources[q][V]=new L),this.demWorkerSources[q][V]}}return d.i(self)&&(self.worker=new wr(self)),wr}),l("index",["exports","./shared"],function(d,s){var g="4.7.0";let y,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((i,h)=>{const p=requestAnimationFrame(i);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(s.c())})}),getImageData(v,i=0){return this.getImageCanvasContext(v).getImageData(-i,-i,v.width+2*i,v.height+2*i)},getImageCanvasContext(v){const i=window.document.createElement("canvas"),h=i.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return i.width=v.width,i.height=v.height,h.drawImage(v,0,0,v.width,v.height),h},resolveURL:v=>(y||(y=document.createElement("a")),y.href=v,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class L{static testProp(i){if(!L.docStyle)return i[0];for(let h=0;h<i.length;h++)if(i[h]in L.docStyle)return i[h];return i[0]}static create(i,h,p){const m=window.document.createElement(i);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(i,h){return window.document.createElementNS(i,h)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(i,h){i.style[L.transformProp]=h}static addEventListener(i,h,p,m={}){i.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(i,h,p,m={}){i.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static getScale(i){const h=i.getBoundingClientRect();return{x:h.width/i.offsetWidth||1,y:h.height/i.offsetHeight||1,boundingClientRect:h}}static getPoint(i,h,p){const m=h.boundingClientRect;return new s.P((p.clientX-m.left)/h.x-i.clientLeft,(p.clientY-m.top)/h.y-i.clientTop)}static mousePos(i,h){const p=L.getScale(i);return L.getPoint(i,p,h)}static touchPos(i,h){const p=[],m=L.getScale(i);for(let b=0;b<h.length;b++)p.push(L.getPoint(i,m,h[b]));return p}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(v){!U&&Z&&(H?G(v):R=v)}};let R,Z,U=!1,H=!1;function G(v){const i=v.createTexture();v.bindTexture(v.TEXTURE_2D,i);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Z),v.isContextLost())return;P.supported=!0}catch{}v.deleteTexture(i),U=!0}var K;typeof document<"u"&&(Z=document.createElement("img"),Z.onload=()=>{R&&G(R),R=null,H=!0},Z.onerror=()=>{U=!0,R=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let i,h,p,m;v.resetRequestQueue=()=>{i=[],h=0,p=0,m={}},v.addThrottleControl=M=>{const D=p++;return m[D]=M,D},v.removeThrottleControl=M=>{delete m[M],I()},v.getImage=(M,D,O=!0)=>new Promise((N,Q)=>{P.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),s.e(M,{type:"image"}),i.push({abortController:D,requestParameters:M,supportImageRefresh:O,state:"queued",onError:se=>{Q(se)},onSuccess:se=>{N(se)}}),I()});const b=M=>s._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:D,supportImageRefresh:O,onError:N,onSuccess:Q,abortController:se}=M,de=O===!1&&!s.i(self)&&!s.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((ke,Ce)=>ke&&Ce==="accept",!0));h++;const ge=de?E(D,se):s.m(D,se);try{const ke=yield ge;delete M.abortController,M.state="completed",ke.data instanceof HTMLImageElement||s.b(ke.data)?Q(ke):ke.data&&Q({data:yield(xe=ke.data,typeof createImageBitmap=="function"?s.d(xe):s.f(xe)),cacheControl:ke.cacheControl,expires:ke.expires})}catch(ke){delete M.abortController,N(ke)}finally{h--,I()}var xe}),I=()=>{const M=(()=>{for(const D of Object.keys(m))if(m[D]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=h;D<M&&i.length>0;D++){const O=i.shift();O.abortController.signal.aborted?D--:b(O)}},E=(M,D)=>new Promise((O,N)=>{const Q=new Image,se=M.url,de=M.credentials;de&&de==="include"?Q.crossOrigin="use-credentials":(de&&de==="same-origin"||!s.s(se))&&(Q.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{Q.src="",N(s.c())}),Q.fetchPriority="high",Q.onload=()=>{Q.onerror=Q.onload=null,O({data:Q})},Q.onerror=()=>{Q.onerror=Q.onload=null,D.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Q.src=se})}(K||(K={})),K.resetRequestQueue();class le{constructor(i){this._transformRequestFn=i}transformRequest(i,h){return this._transformRequestFn&&this._transformRequestFn(i,h)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function Se(v){var i=new s.A(3);return i[0]=v[0],i[1]=v[1],i[2]=v[2],i}var Le,te=function(v,i,h){return v[0]=i[0]-h[0],v[1]=i[1]-h[1],v[2]=i[2]-h[2],v};Le=new s.A(3),s.A!=Float32Array&&(Le[0]=0,Le[1]=0,Le[2]=0);var Y=function(v){var i=v[0],h=v[1];return i*i+h*h};function ue(v){const i=[];if(typeof v=="string")i.push({id:"default",url:v});else if(v&&v.length>0){const h=[];for(const{id:p,url:m}of v){const b=`${p}${m}`;h.indexOf(b)===-1&&(h.push(b),i.push({id:p,url:m}))}}return i}function fe(v,i,h){const p=v.split("?");return p[0]+=`${i}${h}`,p.join("?")}(function(){var v=new s.A(2);s.A!=Float32Array&&(v[0]=0,v[1]=0)})();class ce{constructor(i,h,p,m){this.context=i,this.format=p,this.texture=i.gl.createTexture(),this.update(h,m)}update(i,h,p){const{width:m,height:b}=i,I=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:E}=this,{gl:M}=E;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),I)this.size=[m,b],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||s.b(i)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,i):M.texImage2D(M.TEXTURE_2D,0,this.format,m,b,0,this.format,M.UNSIGNED_BYTE,i.data);else{const{x:D,y:O}=p||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||s.b(i)?M.texSubImage2D(M.TEXTURE_2D,0,D,O,M.RGBA,M.UNSIGNED_BYTE,i):M.texSubImage2D(M.TEXTURE_2D,0,D,O,m,b,M.RGBA,M.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(i,h,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),i!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,i),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||i),this.filter=i),h!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function ae(v){const{userImage:i}=v;return!!(i&&i.render&&i.render())&&(v.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ge extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(i){const h=this.images[i];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new s.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(i,h){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new s.j(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new s.j(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new s.j(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,h){if(!i)return!0;let p=0;for(const m of i){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(i,h){if(!i)return!0;if(i.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,b=p&&p.height||h.data.height;return!(i[0]<0||m<i[0]||i[1]<0||b<i[1]||i[2]<0||m<i[2]||i[3]<0||b<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,h,p=!0){const m=this.getImage(i);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const b of i)this.images[b]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:h})})}_getImagesForIds(i){const h={};for(const p of i){let m=this.getImage(p);m||(this.fire(new s.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:s.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],p=this.getImage(i);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new s.I(m,p);this.patterns[i]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ce(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const b in this.patterns)i.push(this.patterns[b].bin);const{w:h,h:p}=s.p(i),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const b in this.patterns){const{bin:I}=this.patterns[b],E=I.x+1,M=I.y+1,D=this.getImage(b).data,O=D.width,N=D.height;s.R.copy(D,m,{x:0,y:0},{x:E,y:M},{width:O,height:N}),s.R.copy(D,m,{x:0,y:N-1},{x:E,y:M-1},{width:O,height:1}),s.R.copy(D,m,{x:0,y:0},{x:E,y:M+N},{width:O,height:1}),s.R.copy(D,m,{x:O-1,y:0},{x:E-1,y:M},{width:1,height:N}),s.R.copy(D,m,{x:0,y:0},{x:E+O,y:M},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||s.w(`Image with ID: "${h}" was not found`),ae(p)&&this.updateImage(h,p)}}}const Ee=1e20;function ze(v,i,h,p,m,b,I,E,M){for(let D=i;D<i+p;D++)rt(v,h*b+D,b,m,I,E,M);for(let D=h;D<h+m;D++)rt(v,D*b+i,1,p,I,E,M)}function rt(v,i,h,p,m,b,I){b[0]=0,I[0]=-Ee,I[1]=Ee,m[0]=v[i];for(let E=1,M=0,D=0;E<p;E++){m[E]=v[i+E*h];const O=E*E;do{const N=b[M];D=(m[E]-m[N]+O-N*N)/(E-N)/2}while(D<=I[M]&&--M>-1);M++,b[M]=E,I[M]=D,I[M+1]=Ee}for(let E=0,M=0;E<p;E++){for(;I[M+1]<E;)M++;const D=b[M],O=E-D;v[i+E*h]=m[D]+O*O}}class it{constructor(i,h){this.requestManager=i,this.localIdeographFontFamily=h,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return s._(this,void 0,void 0,function*(){const h=[];for(const b in i)for(const I of i[b])h.push(this._getAndCacheGlyphsPromise(b,I));const p=yield Promise.all(h),m={};for(const{stack:b,id:I,glyph:E}of p)m[b]||(m[b]={}),m[b][I]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return m})}_getAndCacheGlyphsPromise(i,h){return s._(this,void 0,void 0,function*(){let p=this.entries[i];p||(p=this.entries[i]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:i,id:h,glyph:m};if(m=this._tinySDF(p,i,h),m)return p.glyphs[h]=m,{stack:i,id:h,glyph:m};const b=Math.floor(h/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:i,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const E=it.loadGlyphRange(i,b,this.url,this.requestManager);p.requests[b]=E}const I=yield p.requests[b];for(const E in I)this._doesCharSupportLocalGlyph(+E)||(p.glyphs[+E]=I[+E]);return p.ranges[b]=!0,{stack:i,id:h,glyph:I[h]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(i))}_tinySDF(i,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=i.tinySDF;if(!b){let E="400";/bold/i.test(h)?E="900":/medium/i.test(h)?E="500":/light/i.test(h)&&(E="200"),b=i.tinySDF=new it.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:E})}const I=b.draw(String.fromCharCode(p));return{id:p,bitmap:new s.o({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}it.loadGlyphRange=function(v,i,h,p){return s._(this,void 0,void 0,function*(){const m=256*i,b=m+255,I=p.transformRequest(h.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),E=yield s.l(I,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${i}, ${m}-${b}`);const M={};for(const D of s.n(E.data))M[D.id]=D;return M})},it.TinySDF=class{constructor({fontSize:v=24,buffer:i=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:I="normal"}={}){this.buffer=i,this.cutoff=p,this.radius=h;const E=this.size=v+4*i,M=this._createCanvas(E),D=this.ctx=M.getContext("2d",{willReadFrequently:!0});D.font=`${I} ${b} ${v}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(v){const i=document.createElement("canvas");return i.width=i.height=v,i}draw(v){const{width:i,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),I=Math.ceil(h),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),M=Math.min(this.size-this.buffer,I+Math.ceil(p)),D=E+2*this.buffer,O=M+2*this.buffer,N=Math.max(D*O,0),Q=new Uint8ClampedArray(N),se={data:Q,width:D,height:O,glyphWidth:E,glyphHeight:M,glyphTop:I,glyphLeft:0,glyphAdvance:i};if(E===0||M===0)return se;const{ctx:de,buffer:ge,gridInner:xe,gridOuter:ke}=this;de.clearRect(ge,ge,E,M),de.fillText(v,ge,ge+I);const Ce=de.getImageData(ge,ge,E,M);ke.fill(Ee,0,N),xe.fill(0,0,N);for(let me=0;me<M;me++)for(let Re=0;Re<E;Re++){const Be=Ce.data[4*(me*E+Re)+3]/255;if(Be===0)continue;const He=(me+ge)*D+Re+ge;if(Be===1)ke[He]=0,xe[He]=Ee;else{const ot=.5-Be;ke[He]=ot>0?ot*ot:0,xe[He]=ot<0?ot*ot:0}}ze(ke,0,0,D,O,D,this.f,this.v,this.z),ze(xe,ge,ge,E,M,D,this.f,this.v,this.z);for(let me=0;me<N;me++){const Re=Math.sqrt(ke[me])-Math.sqrt(xe[me]);Q[me]=Math.round(255-255*(Re/this.radius+this.cutoff))}return se}};class Qe{constructor(){this.specification=s.v.light.position}possiblyEvaluate(i,h){return s.x(i.expression.evaluate(h))}interpolate(i,h,p){return{x:s.y.number(i.x,h.x,p),y:s.y.number(i.y,h.y,p),z:s.y.number(i.z,h.z,p)}}}let Ft;class jt extends s.E{constructor(i){super(),Ft=Ft||new s.q({anchor:new s.D(s.v.light.anchor),position:new Qe,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Ft),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(s.r,i,h))for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p){return(!p||p.validate!==!1)&&s.t(this,i.call(s.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const ut=new s.q({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class et extends s.E{constructor(i){super(),this._transitionable=new s.T(ut),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.z(0))}setSky(i,h={}){if(!this._validate(s.B,i,h)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p={}){return(p==null?void 0:p.validate)!==!1&&s.t(this,i.call(s.u,s.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class at{constructor(i,h){this.width=i,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,h){const p=i.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(i,h)),this.dashEntry[p]}getDashRanges(i,h,p){const m=[];let b=i.length%2==1?-i[i.length-1]*p:0,I=i[0]*p,E=!0;m.push({left:b,right:I,isDash:E,zeroLength:i[0]===0});let M=i[0];for(let D=1;D<i.length;D++){E=!E;const O=i[D];b=M*p,M+=O,I=M*p,m.push({left:b,right:I,isDash:E,zeroLength:O===0})}return m}addRoundDash(i,h,p){const m=h/2;for(let b=-p;b<=p;b++){const I=this.width*(this.nextRow+p+b);let E=0,M=i[E];for(let D=0;D<this.width;D++){D/M.right>1&&(M=i[++E]);const O=Math.abs(D-M.left),N=Math.abs(D-M.right),Q=Math.min(O,N);let se;const de=b/p*(m+1);if(M.isDash){const ge=m-Math.abs(de);se=Math.sqrt(Q*Q+ge*ge)}else se=m-Math.sqrt(Q*Q+de*de);this.data[I+D]=Math.max(0,Math.min(255,se+128))}}}addRegularDash(i){for(let E=i.length-1;E>=0;--E){const M=i[E],D=i[E+1];M.zeroLength?i.splice(E,1):D&&D.isDash===M.isDash&&(D.left=M.left,i.splice(E,1))}const h=i[0],p=i[i.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let b=0,I=i[b];for(let E=0;E<this.width;E++){E/I.right>1&&(I=i[++b]);const M=Math.abs(E-I.left),D=Math.abs(E-I.right),O=Math.min(M,D);this.data[m+E]=Math.max(0,Math.min(255,(I.isDash?O:-O)+128))}}addDash(i,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return s.w("LineAtlas out of space"),null;let b=0;for(let E=0;E<i.length;E++)b+=i[E];if(b!==0){const E=this.width/b,M=this.getDashRanges(i,this.width,E);h?this.addRoundDash(M,E,p):this.addRegularDash(M)}const I={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,I}bind(i){const h=i.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Bt="maplibre_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Bt]}numActive(){return Object.keys(this.active).length}}const Ht=Math.floor(S.hardwareConcurrency/2);let ai,si;function Si(){return ai||(ai=new Dt),ai}Dt.workerCount=s.C(globalThis)?Math.max(Math.min(Ht,3),1):1;class Ri{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const b=new s.F(p[m],h);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:i,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,h){for(const p of this.actors)p.registerMessageHandler(i,h)}}function vi(){return si||(si=new Ri(Si(),s.G),si.registerMessageHandler("GR",(v,i,h)=>s.m(i,h))),si}function di(v,i){const h=s.H();return s.J(h,h,[1,1,0]),s.K(h,h,[.5*v.width,.5*v.height,1]),s.L(h,h,v.calculatePosMatrix(i.toUnwrapped()))}function lt(v,i,h,p,m,b){const I=function(N,Q,se){if(N)for(const de of N){const ge=Q[de];if(ge&&ge.source===se&&ge.type==="fill-extrusion")return!0}else for(const de in Q){const ge=Q[de];if(ge.source===se&&ge.type==="fill-extrusion")return!0}return!1}(m&&m.layers,i,v.id),E=b.maxPitchScaleFactor(),M=v.tilesIn(p,E,I);M.sort(qe);const D=[];for(const N of M)D.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(i,h,v._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,b,E,di(v.transform,N.tileID))});const O=function(N){const Q={},se={};for(const de of N){const ge=de.queryResults,xe=de.wrappedTileID,ke=se[xe]=se[xe]||{};for(const Ce in ge){const me=ge[Ce],Re=ke[Ce]=ke[Ce]||{},Be=Q[Ce]=Q[Ce]||[];for(const He of me)Re[He.featureIndex]||(Re[He.featureIndex]=!0,Be.push(He))}}return Q}(D);for(const N in O)O[N].forEach(Q=>{const se=Q.feature,de=v.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=de});return O}function qe(v,i){const h=v.tileID,p=i.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function st(v,i,h){return s._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield s.h(i.transformRequest(v.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=s.M(s.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class Te{constructor(i,h){i&&(h?this.setSouthWest(i).setNorthEast(h):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof s.N?new s.N(i.lng,i.lat):s.N.convert(i),this}setSouthWest(i){return this._sw=i instanceof s.N?new s.N(i.lng,i.lat):s.N.convert(i),this}extend(i){const h=this._sw,p=this._ne;let m,b;if(i instanceof s.N)m=i,b=i;else{if(!(i instanceof Te))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Te.convert(i)):this.extend(s.N.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(s.N.convert(i)):this;if(m=i._sw,b=i._ne,!m||!b)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new s.N(m.lng,m.lat),this._ne=new s.N(b.lng,b.lat)),this}getCenter(){return new s.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.N(this.getWest(),this.getNorth())}getSouthEast(){return new s.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:h,lat:p}=s.N.convert(i);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(i){return i instanceof Te?i:i&&new Te(i)}static fromLngLat(i,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*i.lat);return new Te(new s.N(i.lng-m,i.lat-p),new s.N(i.lng+m,i.lat+p))}adjustAntiMeridian(){const i=new s.N(this._sw.lng,this._sw.lat),h=new s.N(this._ne.lng,this._ne.lat);return new Te(i,i.lng>h.lng?new s.N(h.lng+360,h.lat):h)}}class mt{constructor(i,h,p){this.bounds=Te.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),p=Math.floor(s.O(this.bounds.getWest())*h),m=Math.floor(s.Q(this.bounds.getNorth())*h),b=Math.ceil(s.O(this.bounds.getEast())*h),I=Math.ceil(s.Q(this.bounds.getSouth())*h);return i.x>=p&&i.x<b&&i.y>=m&&i.y<I}}class yt extends s.E{constructor(i,h,p,m){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.M(h,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield st(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(s.e(this,i),i.bounds&&(this.tileBounds=new mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new s.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(i){return s._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((b,I)=>{i.reloadPromise={resolve:b,reject:I}})}else i.actor=this.dispatcher.getActor(),m="LT";i.abortController=new AbortController;try{const b=yield i.actor.sendAsync({type:m,data:p},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,b)}catch(b){if(delete i.abortController,i.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,h){if(h&&h.resourceTiming&&(i.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&i.setExpiryData(h),i.loadVectorData(h,this.map.painter),i.reloadPromise){const p=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(p.resolve).catch(p.reject)}}abortTile(i){return s._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return s._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ie extends s.E{constructor(i,h,p,m){super(),this.id=i,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},h),s.e(this,s.M(h,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield st(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(s.e(this,i),i.bounds&&(this.tileBounds=new mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new s.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return s.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return s._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const p=yield K.getImage(this.map._requestManager.transformRequest(h,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&i.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,I=p.data;i.texture=this.map.painter.getTileTexture(I.width),i.texture?i.texture.update(I,{useMipmap:!0}):(i.texture=new ce(m,I,b.RGBA,{useMipmap:!0}),i.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(p){if(delete i.abortController,i.aborted)i.state="unloaded";else if(p)throw i.state="errored",p}})}abortTile(i){return s._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return s._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class nt extends Ie{constructor(i,h,p,m){super(i,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(i){return s._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const m=yield K.getImage(p,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&i.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const I=s.b(b)&&s.U()?b:yield this.readImageNow(b),E={type:this.type,uid:i.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const M=yield i.actor.sendAsync({type:"LDT",data:E});i.dem=M,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(m){if(delete i.abortController,i.aborted)i.state="unloaded";else if(m)throw i.state="errored",m}})}readImageNow(i){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.V()){const h=i.width+2,p=i.height+2;try{return new s.R({width:h,height:p},yield s.W(i,-1,-1,h,p))}catch{}}return S.getImageData(i,1)})}_getNeighboringTiles(i){const h=i.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,b=h.x===0?i.wrap-1:i.wrap,I=(h.x+1+p)%p,E=h.x+1===p?i.wrap+1:i.wrap,M={};return M[new s.S(i.overscaledZ,b,h.z,m,h.y).key]={backfilled:!1},M[new s.S(i.overscaledZ,E,h.z,I,h.y).key]={backfilled:!1},h.y>0&&(M[new s.S(i.overscaledZ,b,h.z,m,h.y-1).key]={backfilled:!1},M[new s.S(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new s.S(i.overscaledZ,E,h.z,I,h.y-1).key]={backfilled:!1}),h.y+1<p&&(M[new s.S(i.overscaledZ,b,h.z,m,h.y+1).key]={backfilled:!1},M[new s.S(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new s.S(i.overscaledZ,E,h.z,I,h.y+1).key]={backfilled:!1}),M}unloadTile(i){return s._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Xt extends s.E{constructor(i,h,p,m){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=s.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const b=s.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*b,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*b,extent:s.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.X,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}getData(){return s._(this,void 0,void 0,function*(){const i=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:h,offset:p}})}_updateWorkerData(i){return s._(this,void 0,void 0,function*(){const h=s.e({type:this.type},this.workerOptions);i?h.dataDiff=i:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&s.e(b,{resourceTiming:m}),this.fire(new s.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(i){return s._(this,void 0,void 0,function*(){const h=i.actor?"RT":"LT";i.actor=this.actor;const p={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(i){return s._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return s._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var wi=s.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $i extends s.E{constructor(i,h,p,m){super(),this.id=i,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(i){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield K.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,i&&(this.coordinates=i),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new s.j(h))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const h=i.map(s.Z.fromLngLat);this.tileID=function(m){let b=1/0,I=1/0,E=-1/0,M=-1/0;for(const Q of m)b=Math.min(b,Q.x),I=Math.min(I,Q.y),E=Math.max(E,Q.x),M=Math.max(M,Q.y);const D=Math.max(E-b,M-I),O=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),N=Math.pow(2,O);return new s.a1(O,Math.floor((b+E)/2*N),Math.floor((I+M)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new s.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,s.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,s.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,s.X,s.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=s.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ce(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Li extends $i{constructor(i,h,p,m){super(i,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const h of i.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield s.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new s.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new s.j(new s.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=s.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ce(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class gi extends $i{constructor(i,h,p,m){super(i,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(I=>typeof I!="number"))||this.fire(new s.j(new s.a2(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a2(`sources.${i}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.j(new s.a2(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a2(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a2(`sources.${i}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=s.a0.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ce(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const I=this.tiles[b];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,m=!0)}m&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Fi={},br=v=>{switch(v){case"geojson":return Xt;case"image":return $i;case"raster":return Ie;case"raster-dem":return nt;case"vector":return yt;case"video":return Li;case"canvas":return gi}return Fi[v]},ct="RTLPluginLoaded";class tr extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=vi()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return s._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let dn=null;function Un(){return dn||(dn=new tr),dn}class Wr{constructor(i,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=s.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const h=i+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,b){const I={};if(!b)return I;for(const E of m){const M=E.layerIds.map(D=>b.getLayer(D)).filter(Boolean);if(M.length!==0){E.layers=M,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(D=>M.filter(O=>O.id===D)[0]));for(const D of M)I[D.id]=E}}return I}(i.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof s.a6){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof s.a6&&b.hasRTLText){this.hasRTLText=!0,Un().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(b))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new s.a5}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(i)}const h=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ce(i,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ce(i,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,h,p,m,b,I,E,M,D,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:I,tileSize:this.tileSize,pixelPosMatrix:O,transform:M,params:E,queryPadding:this.queryPadding*D},i,h,p):{}}querySourceFeatures(i,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=h&&h.sourceLayer?h.sourceLayer:"",I=m._geojsonTileLayer||m[b];if(!I)return;const E=s.a7(h&&h.filter),{z:M,x:D,y:O}=this.tileID.canonical,N={z:M,x:D,y:O};for(let Q=0;Q<I.length;Q++){const se=I.feature(Q);if(E.needGeometry){const xe=s.a8(se,!0);if(!E.filter(new s.z(this.tileID.overscaledZ),xe,this.tileID.canonical))continue}else if(!E.filter(new s.z(this.tileID.overscaledZ),se))continue;const de=p.getId(se,b),ge=new s.a9(se,M,D,O,de);ge.tile=N,i.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const h=this.expirationTime;if(i.cacheControl){const p=s.aa(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const b=this.expirationTime-h;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const b=this.buckets[m],I=b.layers[0].sourceLayer||"_geojsonTileLayer",E=p[I],M=i[I];if(!E||!M||Object.keys(M).length===0)continue;b.update(M,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=h&&h.style&&h.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=S.now()+i}setDependencies(i,h){const p={};for(const m of h)p[m]=!0;this.dependencies[i]=p}hasDependency(i,h){for(const p of i){const m=this.dependencies[p];if(m){for(const b of h)if(m[b])return!0}}return!1}}class vt{constructor(i,h){this.max=i,this.onRemove=h,this.reset()}reset(){for(const i in this.data)for(const h of this.data[i])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(i,h,p){const m=i.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:h,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(i,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const h=this.data[i].shift();return h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),h.value}getByKey(i){const h=this.data[i];return h?h[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,h){if(!this.has(i))return this;const p=i.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(i){const h=[];for(const p in this.data)for(const m of this.data[p])i(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,h,p){const m=String(h);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},s.e(this.stateChanges[i][m],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const b in this.state[i])b!==m&&(this.deletedStates[i][b]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][m]===null){this.deletedStates[i][m]={};for(const b in this.state[i][m])p[b]||(this.deletedStates[i][m][b]=null)}else for(const b in p)this.deletedStates[i]&&this.deletedStates[i][m]&&this.deletedStates[i][m][b]===null&&delete this.deletedStates[i][m][b]}removeFeatureState(i,h,p){if(this.deletedStates[i]===null)return;const m=String(h);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&h!==void 0)this.deletedStates[i][m]!==null&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][p]=null);else if(h!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][m])for(p in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][p]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,h){const p=String(h),m=s.e({},(this.state[i]||{})[p],(this.stateChanges[i]||{})[p]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const b=this.deletedStates[i][h];if(b===null)return{};for(const I in b)delete m[I]}return m}initializeTileState(i,h){i.setFeatureState(this.state,h)}coalesceChanges(i,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const I in this.stateChanges[m])this.state[m][I]||(this.state[m][I]={}),s.e(this.state[m][I],this.stateChanges[m][I]),b[I]=this.state[m][I];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const I in this.state[m])b[I]={},this.state[m][I]={};else for(const I in this.deletedStates[m]){if(this.deletedStates[m][I]===null)this.state[m][I]={};else for(const E of Object.keys(this.deletedStates[m][I]))delete this.state[m][I][E];b[I]=this.state[m][I]}p[m]=p[m]||{},s.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in i)i[m].setFeatureState(p,h)}}class Jt extends s.E{constructor(i,h,p){super(),this.id=i,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,I,E)=>{const M=new(br(b.type))(m,b,I,E);if(M.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${M.id}`);return M})(i,h,p,this),this._tiles={},this._cache=new vt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new li,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,h,p){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,h,p)}catch(m){i.state="errored",m.status!==404?this._source.fire(new s.j(m,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new s.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(i),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(Sn).map(i=>i.key)}getRenderableIds(i){const h=[];for(const p in this._tiles)this._isIdRenderable(p,i)&&h.push(this._tiles[p]);return i?h.sort((p,m)=>{const b=p.tileID,I=m.tileID,E=new s.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),M=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-I.overscaledZ||M.y-E.y||M.x-E.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(Sn).map(p=>p.key)}hasRenderableParent(i){const h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,h){return s._(this,void 0,void 0,function*(){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,i,h))})}_tileLoaded(i,h,p){i.timeAdded=S.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const b=h[m];if(i.neighboringTiles&&i.neighboringTiles[b]){const I=this.getTileByID(b);p(i,I),p(I,i)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let I=b.tileID.canonical.x-m.tileID.canonical.x;const E=b.tileID.canonical.y-m.tileID.canonical.y,M=Math.pow(2,m.tileID.canonical.z),D=b.tileID.key;I===0&&E===0||Math.abs(E)>1||(Math.abs(I)>1&&(Math.abs(I+M)===1?I+=M:Math.abs(I-M)===1&&(I-=M)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,I,E),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,h,p,m){for(const b in this._tiles){let I=this._tiles[b];if(m[b]||!I.hasData()||I.tileID.overscaledZ<=h||I.tileID.overscaledZ>p)continue;let E=I.tileID;for(;I&&I.tileID.overscaledZ>h+1;){const D=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[D.key],I&&I.hasData()&&(E=D)}let M=E;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),i[M.key]){m[E.key]=E;break}}}findLoadedParent(i,h){if(i.key in this._loadedParentTiles){const p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=i.overscaledZ-1;p>=h;p--){const m=i.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const h=Math.ceil(i.width/this._source.tileSize)+1,p=Math.ceil(i.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(i){const h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(i,h,p,m,b,I){const E={},M={},D=Object.keys(i),O=S.now();for(const N of D){const Q=i[N],se=this._tiles[N];if(!se||se.fadeEndTime!==0&&se.fadeEndTime<=O)continue;const de=this.findLoadedParent(Q,h),ge=this.findLoadedSibling(Q),xe=de||ge||null;xe&&(this._addTile(xe.tileID),E[xe.tileID.key]=xe.tileID),M[N]=Q}this._retainLoadedChildren(M,m,p,i);for(const N in E)i[N]||(this._coveredTiles[N]=!0,i[N]=E[N]);if(I){const N={},Q={};for(const se of b)this._tiles[se.key].hasData()?N[se.key]=se:Q[se.key]=se;for(const se in Q){const de=Q[se].children(this._source.maxzoom);this._tiles[de[0].key]&&this._tiles[de[1].key]&&this._tiles[de[2].key]&&this._tiles[de[3].key]&&(N[de[0].key]=i[de[0].key]=de[0],N[de[1].key]=i[de[1].key]=de[1],N[de[2].key]=i[de[2].key]=de[2],N[de[3].key]=i[de[3].key]=de[3],delete Q[se])}for(const se in Q){const de=Q[se],ge=this.findLoadedParent(de,this._source.minzoom),xe=this.findLoadedSibling(de),ke=ge||xe||null;if(ke){N[ke.tileID.key]=i[ke.tileID.key]=ke.tileID;for(const Ce in N)N[Ce].isChildOf(ke.tileID)&&delete N[Ce]}}for(const se in this._tiles)N[se]||(this._coveredTiles[se]=!0)}}update(i,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=i,this.terrain=h,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new s.S(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(p=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(O=>this._source.hasTile(O)))):p=[];const m=i.coveringZoomLevel(this._source),b=Math.max(m-Jt.maxOverzooming,this._source.minzoom),I=Math.max(m+Jt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const O={};for(const N of p)if(N.canonical.z>this._source.minzoom){const Q=N.scaledTo(N.canonical.z-1);O[Q.key]=Q;const se=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));O[se.key]=se}p=p.concat(Object.values(O))}const E=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(p,m);Bn(this._source.type)&&this._updateCoveredAndRetainedTiles(M,b,I,m,p,h);for(const O in M)this._tiles[O].clearFadeHold();const D=s.ab(this._tiles,M);for(const O of D){const N=this._tiles[O];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(O)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,h){var p;const m={},b={},I=Math.max(h-Jt.maxOverzooming,this._source.minzoom),E=Math.max(h+Jt.maxUnderzooming,this._source.minzoom),M={};for(const D of i){const O=this._addTile(D);m[D.key]=D,O.hasData()||h<this._source.maxzoom&&(M[D.key]=D)}this._retainLoadedChildren(M,h,E,m);for(const D of i){let O=this._tiles[D.key];if(O.hasData())continue;if(h+1>this._source.maxzoom){const Q=D.children(this._source.maxzoom)[0],se=this.getTile(Q);if(se&&se.hasData()){m[Q.key]=Q;continue}}else{const Q=D.children(this._source.maxzoom);if(m[Q[0].key]&&m[Q[1].key]&&m[Q[2].key]&&m[Q[3].key])continue}let N=O.wasRequested();for(let Q=D.overscaledZ-1;Q>=I;--Q){const se=D.scaledTo(Q);if(b[se.key])break;if(b[se.key]=!0,O=this.getTile(se),!O&&N&&(O=this._addTile(se)),O){const de=O.hasData();if((de||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||N)&&(m[se.key]=se),N=O.wasRequested(),de)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const h=[];let p,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of h)this._loadedParentTiles[b]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const h=this._tiles[i].tileID,p=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=p}}_addTile(i){let h=this._tiles[i.key];if(h)return h;h=this._cache.getAndRemove(i),h&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));const p=h;return h||(h=new Wr(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,i.key,h.state)),h.uses++,this._tiles[i.key]=h,p||this._source.fire(new s.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(i,h){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const p=h.getExpiryTimeout();p&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},p))}_removeTile(i){const h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(i){const h=i.sourceDataType;i.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,h,p){const m=[],b=this.transform;if(!b)return m;const I=p?b.getCameraQueryGeometry(i):i,E=i.map(de=>b.pointCoordinate(de,this.terrain)),M=I.map(de=>b.pointCoordinate(de,this.terrain)),D=this.getIds();let O=1/0,N=1/0,Q=-1/0,se=-1/0;for(const de of M)O=Math.min(O,de.x),N=Math.min(N,de.y),Q=Math.max(Q,de.x),se=Math.max(se,de.y);for(let de=0;de<D.length;de++){const ge=this._tiles[D[de]];if(ge.holdingForFade())continue;const xe=ge.tileID,ke=Math.pow(2,b.zoom-ge.tileID.overscaledZ),Ce=h*ge.queryPadding*s.X/ge.tileSize/ke,me=[xe.getTilePoint(new s.Z(O,N)),xe.getTilePoint(new s.Z(Q,se))];if(me[0].x-Ce<s.X&&me[0].y-Ce<s.X&&me[1].x+Ce>=0&&me[1].y+Ce>=0){const Re=E.map(He=>xe.getTilePoint(He)),Be=M.map(He=>xe.getTilePoint(He));m.push({tile:ge,tileID:xe,queryGeometry:Re,cameraQueryGeometry:Be,scale:ke})}}return m}getVisibleCoordinates(i){const h=this.getRenderableIds(i).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Bn(this._source.type)){const i=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=i)return!0}return!1}setFeatureState(i,h,p){this._state.updateState(i=i||"_geojsonTileLayer",h,p)}removeFeatureState(i,h,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,p)}getFeatureState(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)}setDependencies(i,h,p){const m=this._tiles[i];m&&m.setDependencies(h,p)}reloadTilesForDependencies(i,h){for(const p in this._tiles)this._tiles[p].hasDependency(i,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(i,h))}}function Sn(v,i){const h=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return v.overscaledZ-i.overscaledZ||p-h||i.canonical.y-v.canonical.y||i.canonical.x-v.canonical.x}function Bn(v){return v==="raster"||v==="image"||v==="video"}Jt.maxOverzooming=10,Jt.maxUnderzooming=3;class ei{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=s.ac(i,0,1);let h=1,p=this._distances[h];const m=i*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const b=h-1,I=this._distances[b],E=p-I,M=E>0?(m-I)/E:0;return this.points[b].mult(1-M).add(this.points[h].mult(M))}}function vr(v,i){let h=!0;return v==="always"||v!=="never"&&i!=="never"||(h=!1),h}class Fr{constructor(i,h,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(h/p);for(let I=0;I<this.xCellCount*this.yCellCount;I++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,p,m,b){this._forEachCell(h,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(i,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(i,h,p,m,b,I){this.boxCells[b].push(I)}_insertCircleCell(i,h,p,m,b,I){this.circleCells[b].push(I)}_query(i,h,p,m,b,I,E){if(p<0||i>this.width||m<0||h>this.height)return[];const M=[];if(i<=0&&h<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:i,y1:h,x2:p,y2:m}];for(let D=0;D<this.boxKeys.length;D++)M.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const O=this.circles[3*D],N=this.circles[3*D+1],Q=this.circles[3*D+2];M.push({key:this.circleKeys[D],x1:O-Q,y1:N-Q,x2:O+Q,y2:N+Q})}}else this._forEachCell(i,h,p,m,this._queryCell,M,{hitTest:b,overlapMode:I,seenUids:{box:{},circle:{}}},E);return M}query(i,h,p,m){return this._query(i,h,p,m,!1,null)}hitTest(i,h,p,m,b,I){return this._query(i,h,p,m,!0,b,I).length>0}hitTestCircle(i,h,p,m,b){const I=i-p,E=i+p,M=h-p,D=h+p;if(E<0||I>this.width||D<0||M>this.height)return!1;const O=[];return this._forEachCell(I,M,E,D,this._queryCellCircle,O,{hitTest:!0,overlapMode:m,circle:{x:i,y:h,radius:p},seenUids:{box:{},circle:{}}},b),O.length>0}_queryCell(i,h,p,m,b,I,E,M){const{seenUids:D,hitTest:O,overlapMode:N}=E,Q=this.boxCells[b];if(Q!==null){const de=this.bboxes;for(const ge of Q)if(!D.box[ge]){D.box[ge]=!0;const xe=4*ge,ke=this.boxKeys[ge];if(i<=de[xe+2]&&h<=de[xe+3]&&p>=de[xe+0]&&m>=de[xe+1]&&(!M||M(ke))&&(!O||!vr(N,ke.overlapMode))&&(I.push({key:ke,x1:de[xe],y1:de[xe+1],x2:de[xe+2],y2:de[xe+3]}),O))return!0}}const se=this.circleCells[b];if(se!==null){const de=this.circles;for(const ge of se)if(!D.circle[ge]){D.circle[ge]=!0;const xe=3*ge,ke=this.circleKeys[ge];if(this._circleAndRectCollide(de[xe],de[xe+1],de[xe+2],i,h,p,m)&&(!M||M(ke))&&(!O||!vr(N,ke.overlapMode))){const Ce=de[xe],me=de[xe+1],Re=de[xe+2];if(I.push({key:ke,x1:Ce-Re,y1:me-Re,x2:Ce+Re,y2:me+Re}),O)return!0}}}return!1}_queryCellCircle(i,h,p,m,b,I,E,M){const{circle:D,seenUids:O,overlapMode:N}=E,Q=this.boxCells[b];if(Q!==null){const de=this.bboxes;for(const ge of Q)if(!O.box[ge]){O.box[ge]=!0;const xe=4*ge,ke=this.boxKeys[ge];if(this._circleAndRectCollide(D.x,D.y,D.radius,de[xe+0],de[xe+1],de[xe+2],de[xe+3])&&(!M||M(ke))&&!vr(N,ke.overlapMode))return I.push(!0),!0}}const se=this.circleCells[b];if(se!==null){const de=this.circles;for(const ge of se)if(!O.circle[ge]){O.circle[ge]=!0;const xe=3*ge,ke=this.circleKeys[ge];if(this._circlesCollide(de[xe],de[xe+1],de[xe+2],D.x,D.y,D.radius)&&(!M||M(ke))&&!vr(N,ke.overlapMode))return I.push(!0),!0}}}_forEachCell(i,h,p,m,b,I,E,M){const D=this._convertToXCellCoord(i),O=this._convertToYCellCoord(h),N=this._convertToXCellCoord(p),Q=this._convertToYCellCoord(m);for(let se=D;se<=N;se++)for(let de=O;de<=Q;de++)if(b.call(this,i,h,p,m,this.xCellCount*de+se,I,E,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,p,m,b,I){const E=m-i,M=b-h,D=p+I;return D*D>E*E+M*M}_circleAndRectCollide(i,h,p,m,b,I,E){const M=(I-m)/2,D=Math.abs(i-(m+M));if(D>M+p)return!1;const O=(E-b)/2,N=Math.abs(h-(b+O));if(N>O+p)return!1;if(D<=M||N<=O)return!0;const Q=D-M,se=N-O;return Q*Q+se*se<=p*p}}function Hr(v,i,h,p,m){const b=s.H();return i?(s.K(b,b,[1/m,1/m,1]),h||s.ad(b,b,p.angle)):s.L(b,p.labelPlaneMatrix,v),b}function wr(v,i,h,p,m){if(i){const b=s.ae(v);return s.K(b,b,[m,m,1]),h||s.ad(b,b,-p.angle),b}return p.glCoordMatrix}function ye(v,i,h,p){let m;p?(m=[v,i,p(v,i),1],s.af(m,m,h)):(m=[v,i,0,1],pi(m,m,h));const b=m[3];return{point:new s.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function q(v,i){return .5+v/i*.5}function V(v,i){return v.x>=-i[0]&&v.x<=i[0]&&v.y>=-i[1]&&v.y<=i[1]}function re(v,i,h,p,m,b,I,E,M,D,O,N,Q,se,de){const ge=p?v.textSizeData:v.iconSizeData,xe=s.ag(ge,h.transform.zoom),ke=[256/h.width*2+1,256/h.height*2+1],Ce=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Ce.clear();const me=v.lineVertexArray,Re=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,Be=h.transform.width/h.transform.height;let He=!1;for(let ot=0;ot<Re.length;ot++){const wt=Re.get(ot);if(wt.hidden||wt.writingMode===s.ah.vertical&&!He){Et(wt.numGlyphs,Ce);continue}He=!1;const It=ye(wt.anchorX,wt.anchorY,i,de);if(!V(It.point,ke)){Et(wt.numGlyphs,Ce);continue}const At=q(h.transform.cameraToCenterDistance,It.signedDistanceFromCamera),kt=s.ai(ge,xe,wt),xt=I?kt/At:kt*At,Nt={getElevation:de,labelPlaneMatrix:m,lineVertexArray:me,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:D,tileAnchorPoint:new s.P(wt.anchorX,wt.anchorY),unwrappedTileID:O,width:N,height:Q,translation:se},ri=De(Nt,wt,xt,!1,E,i,b,v.glyphOffsetArray,Ce,Be,M);He=ri.useVertical,(ri.notEnoughRoom||He||ri.needsFlipping&&De(Nt,wt,xt,!0,E,i,b,v.glyphOffsetArray,Ce,Be,M).notEnoughRoom)&&Et(wt.numGlyphs,Ce)}p?v.text.dynamicLayoutVertexBuffer.updateData(Ce):v.icon.dynamicLayoutVertexBuffer.updateData(Ce)}function pe(v,i,h,p,m,b,I,E){const M=b.glyphStartIndex+b.numGlyphs,D=b.lineStartIndex,O=b.lineStartIndex+b.lineLength,N=i.getoffsetX(b.glyphStartIndex),Q=i.getoffsetX(M-1),se=Xe(v*N,h,p,m,b.segment,D,O,E,I);if(!se)return null;const de=Xe(v*Q,h,p,m,b.segment,D,O,E,I);return de?E.projectionCache.anyProjectionOccluded?null:{first:se,last:de}:null}function Me(v,i,h,p){return v===s.ah.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*p?{useVertical:!0}:(v===s.ah.vertical?i.y<h.y:i.x>h.x)?{needsFlipping:!0}:null}function De(v,i,h,p,m,b,I,E,M,D,O){const N=h/24,Q=i.lineOffsetX*N,se=i.lineOffsetY*N;let de;if(i.numGlyphs>1){const ge=i.glyphStartIndex+i.numGlyphs,xe=i.lineStartIndex,ke=i.lineStartIndex+i.lineLength,Ce=pe(N,E,Q,se,p,i,O,v);if(!Ce)return{notEnoughRoom:!0};const me=ye(Ce.first.point.x,Ce.first.point.y,I,v.getElevation).point,Re=ye(Ce.last.point.x,Ce.last.point.y,I,v.getElevation).point;if(m&&!p){const Be=Me(i.writingMode,me,Re,D);if(Be)return Be}de=[Ce.first];for(let Be=i.glyphStartIndex+1;Be<ge-1;Be++)de.push(Xe(N*E.getoffsetX(Be),Q,se,p,i.segment,xe,ke,v,O));de.push(Ce.last)}else{if(m&&!p){const xe=ye(v.tileAnchorPoint.x,v.tileAnchorPoint.y,b,v.getElevation).point,ke=i.lineStartIndex+i.segment+1,Ce=new s.P(v.lineVertexArray.getx(ke),v.lineVertexArray.gety(ke)),me=ye(Ce.x,Ce.y,b,v.getElevation),Re=me.signedDistanceFromCamera>0?me.point:function(He,ot,wt,It,At,kt){return Ue(He,ot,wt,1,At,kt)}(v.tileAnchorPoint,Ce,xe,0,b,v),Be=Me(i.writingMode,xe,Re,D);if(Be)return Be}const ge=Xe(N*E.getoffsetX(i.glyphStartIndex),Q,se,p,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,v,O);if(!ge||v.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};de=[ge]}for(const ge of de)s.aj(M,ge.point,ge.angle);return{}}function Ue(v,i,h,p,m,b){const I=v.add(v.sub(i)._unit()),E=m!==void 0?ye(I.x,I.y,m,b.getElevation).point:Fe(I.x,I.y,b).point,M=h.sub(E);return h.add(M._mult(p/M.mag()))}function j(v,i,h){const p=i.projectionCache;if(p.projections[v])return p.projections[v];const m=new s.P(i.lineVertexArray.getx(v),i.lineVertexArray.gety(v)),b=Fe(m.x,m.y,i);if(b.signedDistanceFromCamera>0)return p.projections[v]=b.point,p.anyProjectionOccluded=p.anyProjectionOccluded||b.isOccluded,b.point;const I=v-h.direction;return function(E,M,D,O,N){return Ue(E,M,D,O,void 0,N)}(h.distanceFromAnchor===0?i.tileAnchorPoint:new s.P(i.lineVertexArray.getx(I),i.lineVertexArray.gety(I)),m,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,i)}function Fe(v,i,h){const p=v+h.translation[0],m=i+h.translation[1];let b;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(b=h.projection.projectTileCoordinates(p,m,h.unwrappedTileID,h.getElevation),b.point.x=(.5*b.point.x+.5)*h.width,b.point.y=(.5*-b.point.y+.5)*h.height):(b=ye(p,m,h.labelPlaneMatrix,h.getElevation),b.isOccluded=!1),b}function Ke(v,i,h){return v._unit()._perp()._mult(i*h)}function Ne(v,i,h,p,m,b,I,E,M){if(E.projectionCache.offsets[v])return E.projectionCache.offsets[v];const D=h.add(i);if(v+M.direction<p||v+M.direction>=m)return E.projectionCache.offsets[v]=D,D;const O=j(v+M.direction,E,M),N=Ke(O.sub(h),I,M.direction),Q=h.add(N),se=O.add(N);return E.projectionCache.offsets[v]=s.ak(b,D,Q,se)||D,E.projectionCache.offsets[v]}function Xe(v,i,h,p,m,b,I,E,M){const D=p?v-i:v+i;let O=D>0?1:-1,N=0;p&&(O*=-1,N=Math.PI),O<0&&(N+=Math.PI);let Q,se=O>0?b+m:b+m+1;E.projectionCache.cachedAnchorPoint?Q=E.projectionCache.cachedAnchorPoint:(Q=Fe(E.tileAnchorPoint.x,E.tileAnchorPoint.y,E).point,E.projectionCache.cachedAnchorPoint=Q);let de,ge,xe=Q,ke=Q,Ce=0,me=0;const Re=Math.abs(D),Be=[];let He;for(;Ce+me<=Re;){if(se+=O,se<b||se>=I)return null;Ce+=me,ke=xe,ge=de;const It={absOffsetX:Re,direction:O,distanceFromAnchor:Ce,previousVertex:ke};if(xe=j(se,E,It),h===0)Be.push(ke),He=xe.sub(ke);else{let At;const kt=xe.sub(ke);At=kt.mag()===0?Ke(j(se+O,E,It).sub(xe),h,O):Ke(kt,h,O),ge||(ge=ke.add(At)),de=Ne(se,At,xe,b,I,ge,h,E,It),Be.push(ge),He=de.sub(ge)}me=He.mag()}const ot=He._mult((Re-Ce)/me)._add(ge||ke),wt=N+Math.atan2(xe.y-ke.y,xe.x-ke.x);return Be.push(ot),{point:ot,angle:M?wt:0,path:Be}}const _t=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Et(v,i){for(let h=0;h<v;h++){const p=i.length;i.resize(p+4),i.float32.set(_t,3*p)}}function pi(v,i,h){const p=i[0],m=i[1];return v[0]=h[0]*p+h[4]*m+h[12],v[1]=h[1]*p+h[5]*m+h[13],v[3]=h[3]*p+h[7]*m+h[15],v}const Qt=100;class ci{constructor(i,h,p=new Fr(i.width+200,i.height+200,25),m=new Fr(i.width+200,i.height+200,25)){this.transform=i,this.mapProjection=h,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Qt,this.screenBottomBoundary=i.height+Qt,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,h,p,m,b,I,E,M,D,O,N){const Q=i.anchorPointX+M[0],se=i.anchorPointY+M[1],de=this.projectAndGetPerspectiveRatio(m,Q,se,b,O),ge=p*de.perspectiveRatio;let xe;if(I||E)xe=this._projectCollisionBox(i,ge,m,b,I,E,M,de,O,N);else{const Be=de.point.x+(N?N.x*ge:0),He=de.point.y+(N?N.y*ge:0);xe={allPointsOccluded:!1,box:[Be+i.x1*ge,He+i.y1*ge,Be+i.x2*ge,He+i.y2*ge]}}const[ke,Ce,me,Re]=xe.box;return this.mapProjection.useSpecialProjectionForSymbols&&(I?xe.allPointsOccluded:this.mapProjection.isOccluded(Q,se,b))||de.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ke,Ce,me,Re)||h!=="always"&&this.grid.hitTest(ke,Ce,me,Re,h,D)?{box:[ke,Ce,me,Re],placeable:!1,offscreen:!1}:{box:[ke,Ce,me,Re],placeable:!0,offscreen:this.isOffscreen(ke,Ce,me,Re)}}placeCollisionCircles(i,h,p,m,b,I,E,M,D,O,N,Q,se,de,ge,xe){const ke=[],Ce=new s.P(h.anchorX,h.anchorY),me=this.getPerspectiveRatio(I,Ce.x,Ce.y,E,xe),Re=(N?b/me:b*me)/s.ap,Be={getElevation:xe,labelPlaneMatrix:M,lineVertexArray:p,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ce,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:ge},He=pe(Re,m,h.lineOffsetX*Re,h.lineOffsetY*Re,!1,h,!1,Be);let ot=!1,wt=!1,It=!0;if(He){const At=.5*se*me+de,kt=new s.P(-100,-100),xt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new ei,ri=He.first,St=He.last;let Lt=[];for(let fi=ri.path.length-1;fi>=1;fi--)Lt.push(ri.path[fi]);for(let fi=1;fi<St.path.length;fi++)Lt.push(St.path[fi]);const ti=2.5*At;if(D){const fi=this.projectPathToScreenSpace(Lt,Be,D);Lt=fi.some(ki=>ki.signedDistanceFromCamera<=0)?[]:fi.map(ki=>ki.point)}let tn=[];if(Lt.length>0){const fi=Lt[0].clone(),ki=Lt[0].clone();for(let nn=1;nn<Lt.length;nn++)fi.x=Math.min(fi.x,Lt[nn].x),fi.y=Math.min(fi.y,Lt[nn].y),ki.x=Math.max(ki.x,Lt[nn].x),ki.y=Math.max(ki.y,Lt[nn].y);tn=fi.x>=kt.x&&ki.x<=xt.x&&fi.y>=kt.y&&ki.y<=xt.y?[Lt]:ki.x<kt.x||fi.x>xt.x||ki.y<kt.y||fi.y>xt.y?[]:s.al([Lt],kt.x,kt.y,xt.x,xt.y)}for(const fi of tn){Nt.reset(fi,.25*At);let ki=0;ki=Nt.length<=.5*At?1:Math.ceil(Nt.paddedLength/ti)+1;for(let nn=0;nn<ki;nn++){const nr=nn/Math.max(ki-1,1),co=Nt.lerp(nr),rn=co.x+Qt,Sr=co.y+Qt;ke.push(rn,Sr,At,0);const pr=rn-At,rr=Sr-At,mr=rn+At,So=Sr+At;if(It=It&&this.isOffscreen(pr,rr,mr,So),wt=wt||this.isInsideGrid(pr,rr,mr,So),i!=="always"&&this.grid.hitTestCircle(rn,Sr,At,i,Q)&&(ot=!0,!O))return{circles:[],offscreen:!1,collisionDetected:ot}}}}return{circles:!O&&ot||!wt||me<this.perspectiveRatioCutoff?[]:ke,offscreen:It,collisionDetected:ot}}projectPathToScreenSpace(i,h,p){return i.map(m=>ye(m.x,m.y,p,h.getElevation))}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,b=-1/0,I=-1/0;for(const O of i){const N=new s.P(O.x+Qt,O.y+Qt);p=Math.min(p,N.x),m=Math.min(m,N.y),b=Math.max(b,N.x),I=Math.max(I,N.y),h.push(N)}const E=this.grid.query(p,m,b,I).concat(this.ignoredGrid.query(p,m,b,I)),M={},D={};for(const O of E){const N=O.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;const Q=[new s.P(O.x1,O.y1),new s.P(O.x2,O.y1),new s.P(O.x2,O.y2),new s.P(O.x1,O.y2)];s.am(h,Q)&&(M[N.bucketInstanceId][N.featureIndex]=!0,D[N.bucketInstanceId]===void 0&&(D[N.bucketInstanceId]=[]),D[N.bucketInstanceId].push(N.featureIndex))}return D}insertCollisionBox(i,h,p,m,b,I){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:I,overlapMode:h},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,p,m,b,I){const E=p?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:b,collisionGroupID:I,overlapMode:h};for(let D=0;D<i.length;D+=4)E.insertCircle(M,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,h,p,m,b){let I;b?(I=[h,p,b(h,p),1],s.af(I,I,i)):(I=[h,p,0,1],pi(I,I,i));const E=I[3];return{point:new s.P((I[0]/E+1)/2*this.transform.width+Qt,(-I[1]/E+1)/2*this.transform.height+Qt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/E*.5,isOccluded:!1,signedDistanceFromCamera:E}}getPerspectiveRatio(i,h,p,m,b){const I=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,p,m,b):ye(h,p,i,b);return .5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5}isOffscreen(i,h,p,m){return p<Qt||i>=this.screenRightBoundary||m<Qt||h>this.screenBottomBoundary}isInsideGrid(i,h,p,m){return p>=0&&i<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=s.an([]);return s.J(i,i,[-100,-100,0]),i}_projectCollisionBox(i,h,p,m,b,I,E,M,D,O){let N=new s.P(1,0),Q=new s.P(0,1);const se=new s.P(i.anchorPointX+E[0],i.anchorPointY+E[1]);if(I&&!b){const It=this.projectAndGetPerspectiveRatio(p,se.x+1,se.y,m,D).point.sub(M.point).unit(),At=Math.atan(It.y/It.x)+(It.x<0?Math.PI:0),kt=Math.sin(At),xt=Math.cos(At);N=new s.P(xt,kt),Q=new s.P(-kt,xt)}else if(!I&&b){const It=-this.transform.angle,At=Math.sin(It),kt=Math.cos(It);N=new s.P(kt,At),Q=new s.P(-At,kt)}let de=M.point,ge=h;if(b){de=se;const It=this.transform.zoom-Math.floor(this.transform.zoom);ge=Math.pow(2,-It),ge*=this.mapProjection.getPitchedTextCorrection(this.transform,se,m),O||(ge*=s.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}O&&(de=de.add(N.mult(O.x*ge)).add(Q.mult(O.y*ge)));const xe=i.x1*ge,ke=i.x2*ge,Ce=(xe+ke)/2,me=i.y1*ge,Re=i.y2*ge,Be=(me+Re)/2,He=[{offsetX:xe,offsetY:me},{offsetX:Ce,offsetY:me},{offsetX:ke,offsetY:me},{offsetX:ke,offsetY:Be},{offsetX:ke,offsetY:Re},{offsetX:Ce,offsetY:Re},{offsetX:xe,offsetY:Re},{offsetX:xe,offsetY:Be}];let ot=[];for(const{offsetX:It,offsetY:At}of He)ot.push(new s.P(de.x+N.x*It+Q.x*At,de.y+N.y*It+Q.y*At));let wt=!1;if(b){const It=ot.map(At=>this.projectAndGetPerspectiveRatio(p,At.x,At.y,m,D));wt=It.some(At=>!At.isOccluded),ot=It.map(At=>At.point)}else wt=!0;return{box:s.ao(ot),allPointsOccluded:!wt}}}function xi(v,i,h){return i*(s.X/(v.tileSize*Math.pow(2,h-v.tileID.overscaledZ)))}class Pn{constructor(i,h,p,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class fn{constructor(i,h,p,m,b){this.text=new Pn(i?i.text:null,h,p,b),this.icon=new Pn(i?i.icon:null,h,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _i{constructor(i,h,p){this.text=i,this.icon=h,this.skipFade=p}}class Vi{constructor(){this.invProjMatrix=s.H(),this.viewportMatrix=s.H(),this.circles=[]}}class an{constructor(i,h,p,m,b){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class Vn{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[i]}}function Kn(v,i,h,p,m){const{horizontalAlign:b,verticalAlign:I}=s.au(v);return new s.P(-(b-.5)*i+p[0]*m,-(I-.5)*h+p[1]*m)}class fr{constructor(i,h,p,m,b,I){this.transform=i.clone(),this.terrain=p,this.collisionIndex=new ci(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Vn(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const h=this.terrain;return h?(p,m)=>h.getElevation(i,p,m):null}getBucketParts(i,h,p,m){const b=p.getBucket(h),I=p.latestFeatureIndex;if(!b||!I||h.id!==b.layerIds[0])return;const E=p.collisionBoxArray,M=b.layers[0].layout,D=b.layers[0].paint,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/s.X,Q=p.tileID.toUnwrapped(),se=this.transform.calculatePosMatrix(Q),de=M.get("text-pitch-alignment")==="map",ge=M.get("text-rotation-alignment")==="map",xe=xi(p,1,this.transform.zoom),ke=this.collisionIndex.mapProjection.translatePosition(this.transform,p,D.get("text-translate"),D.get("text-translate-anchor")),Ce=this.collisionIndex.mapProjection.translatePosition(this.transform,p,D.get("icon-translate"),D.get("icon-translate-anchor")),me=Hr(se,de,ge,this.transform,xe);let Re=null;if(de){const He=wr(se,de,ge,this.transform,xe);Re=s.L([],this.transform.labelPlaneMatrix,He)}this.retainedQueryData[b.bucketInstanceId]=new an(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,p.tileID);const Be={bucket:b,layout:M,translationText:ke,translationIcon:Ce,posMatrix:se,unwrappedTileID:Q,textLabelPlaneMatrix:me,labelToScreenMatrix:Re,scale:O,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:s.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const He of b.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:wt,symbolInstanceEnd:It}=He;i.push({sortKey:ot,symbolInstanceStart:wt,symbolInstanceEnd:It,parameters:Be})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(i,h,p,m,b,I,E,M,D,O,N,Q,se,de,ge,xe,ke,Ce,me){const Re=s.aq[i.textAnchor],Be=[i.textOffset0,i.textOffset1],He=Kn(Re,p,m,Be,b),ot=this.collisionIndex.placeCollisionBox(h,Q,M,D,O,E,I,xe,N.predicate,me,He);if((!Ce||this.collisionIndex.placeCollisionBox(Ce,Q,M,D,O,E,I,ke,N.predicate,me,He).placeable)&&ot.placeable){let wt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(wt=this.prevPlacement.variableOffsets[se.crossTileID].anchor),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[se.crossTileID]={textOffset:Be,width:p,height:m,anchor:Re,textBoxScale:b,prevAnchor:wt},this.markUsedJustification(de,Re,se,ge),de.allowVerticalPlacement&&(this.markUsedOrientation(de,ge,se),this.placedOrientations[se.crossTileID]=ge),{shift:He,placedGlyphBoxes:ot}}}placeLayerBucketPart(i,h,p){const{bucket:m,layout:b,translationText:I,translationIcon:E,posMatrix:M,unwrappedTileID:D,textLabelPlaneMatrix:O,labelToScreenMatrix:N,textPixelRatio:Q,holdingForFade:se,collisionBoxArray:de,partiallyEvaluatedTextSize:ge,collisionGroup:xe}=i.parameters,ke=b.get("text-optional"),Ce=b.get("icon-optional"),me=s.ar(b,"text-overlap","text-allow-overlap"),Re=me==="always",Be=s.ar(b,"icon-overlap","icon-allow-overlap"),He=Be==="always",ot=b.get("text-rotation-alignment")==="map",wt=b.get("text-pitch-alignment")==="map",It=b.get("icon-text-fit")!=="none",At=b.get("symbol-z-order")==="viewport-y",kt=Re&&(He||!m.hasIconData()||Ce),xt=He&&(Re||!m.hasTextData()||ke);!m.collisionArrays&&de&&m.deserializeCollisionBoxes(de);const Nt=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),ri=(St,Lt,ti)=>{var tn,fi;if(h[St.crossTileID])return;if(se)return void(this.placements[St.crossTileID]=new _i(!1,!1,!1));let ki=!1,nn=!1,nr=!0,co=null,rn={box:null,placeable:!1,offscreen:null},Sr={box:null,placeable:!1,offscreen:null},pr=null,rr=null,mr=null,So=0,Ks=0,Rl=0;Lt.textFeatureIndex?So=Lt.textFeatureIndex:St.useRuntimeCollisionCircles&&(So=St.featureIndex),Lt.verticalTextFeatureIndex&&(Ks=Lt.verticalTextFeatureIndex);const Js=Lt.textBox;if(Js){const eo=Jn=>{let or=s.ah.horizontal;if(m.allowVerticalPlacement&&!Jn&&this.prevPlacement){const Ur=this.prevPlacement.placedOrientations[St.crossTileID];Ur&&(this.placedOrientations[St.crossTileID]=Ur,or=Ur,this.markUsedOrientation(m,or,St))}return or},to=(Jn,or)=>{if(m.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&Lt.verticalTextBox){for(const Ur of m.writingModes)if(Ur===s.ah.vertical?(rn=or(),Sr=rn):rn=Jn(),rn&&rn.placeable)break}else rn=Jn()},Go=St.textAnchorOffsetStartIndex,uo=St.textAnchorOffsetEndIndex;if(uo===Go){const Jn=(or,Ur)=>{const Ii=this.collisionIndex.placeCollisionBox(or,me,Q,M,D,wt,ot,I,xe.predicate,Nt);return Ii&&Ii.placeable&&(this.markUsedOrientation(m,Ur,St),this.placedOrientations[St.crossTileID]=Ur),Ii};to(()=>Jn(Js,s.ah.horizontal),()=>{const or=Lt.verticalTextBox;return m.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&or?Jn(or,s.ah.vertical):{box:null,offscreen:null}}),eo(rn&&rn.placeable)}else{let Jn=s.aq[(fi=(tn=this.prevPlacement)===null||tn===void 0?void 0:tn.variableOffsets[St.crossTileID])===null||fi===void 0?void 0:fi.anchor];const or=(Ii,us,Ys)=>{const Qs=Ii.x2-Ii.x1,qh=Ii.y2-Ii.y1,_f=St.textBoxScale,Zh=It&&Be==="never"?us:null;let Wo=null,Gh=me==="never"?1:2,Bl="never";Jn&&Gh++;for(let Ua=0;Ua<Gh;Ua++){for(let Ol=Go;Ol<uo;Ol++){const Nl=m.textAnchorOffsets.get(Ol);if(Jn&&Nl.textAnchor!==Jn)continue;const ea=this.attemptAnchorPlacement(Nl,Ii,Qs,qh,_f,ot,wt,Q,M,D,xe,Bl,St,m,Ys,I,E,Zh,Nt);if(ea&&(Wo=ea.placedGlyphBoxes,Wo&&Wo.placeable))return ki=!0,co=ea.shift,Wo}Jn?Jn=null:Bl=me}return p&&!Wo&&(Wo={box:this.collisionIndex.placeCollisionBox(Js,"always",Q,M,D,wt,ot,I,xe.predicate,Nt,new s.P(0,0)).box,offscreen:!1,placeable:!1}),Wo};to(()=>or(Js,Lt.iconBox,s.ah.horizontal),()=>{const Ii=Lt.verticalTextBox;return m.allowVerticalPlacement&&(!rn||!rn.placeable)&&St.numVerticalGlyphVertices>0&&Ii?or(Ii,Lt.verticalIconBox,s.ah.vertical):{box:null,occluded:!0,offscreen:null}}),rn&&(ki=rn.placeable,nr=rn.offscreen);const Ur=eo(rn&&rn.placeable);if(!ki&&this.prevPlacement){const Ii=this.prevPlacement.variableOffsets[St.crossTileID];Ii&&(this.variableOffsets[St.crossTileID]=Ii,this.markUsedJustification(m,Ii.anchor,St,Ur))}}}if(pr=rn,ki=pr&&pr.placeable,nr=pr&&pr.offscreen,St.useRuntimeCollisionCircles){const eo=m.text.placedSymbolArray.get(St.centerJustifiedTextSymbolIndex),to=s.ai(m.textSizeData,ge,eo),Go=b.get("text-padding");rr=this.collisionIndex.placeCollisionCircles(me,eo,m.lineVertexArray,m.glyphOffsetArray,to,M,D,O,N,p,wt,xe.predicate,St.collisionCircleDiameter,Go,I,Nt),rr.circles.length&&rr.collisionDetected&&!p&&s.w("Collisions detected, but collision boxes are not shown"),ki=Re||rr.circles.length>0&&!rr.collisionDetected,nr=nr&&rr.offscreen}if(Lt.iconFeatureIndex&&(Rl=Lt.iconFeatureIndex),Lt.iconBox){const eo=to=>this.collisionIndex.placeCollisionBox(to,Be,Q,M,D,wt,ot,E,xe.predicate,Nt,It&&co?co:void 0);Sr&&Sr.placeable&&Lt.verticalIconBox?(mr=eo(Lt.verticalIconBox),nn=mr.placeable):(mr=eo(Lt.iconBox),nn=mr.placeable),nr=nr&&mr.offscreen}const Qr=ke||St.numHorizontalGlyphVertices===0&&St.numVerticalGlyphVertices===0,Fl=Ce||St.numIconVertices===0;Qr||Fl?Fl?Qr||(nn=nn&&ki):ki=nn&&ki:nn=ki=nn&&ki;const fu=nn&&mr.placeable;if(ki&&pr.placeable&&this.collisionIndex.insertCollisionBox(pr.box,me,b.get("text-ignore-placement"),m.bucketInstanceId,Sr&&Sr.placeable&&Ks?Ks:So,xe.ID),fu&&this.collisionIndex.insertCollisionBox(mr.box,Be,b.get("icon-ignore-placement"),m.bucketInstanceId,Rl,xe.ID),rr&&ki&&this.collisionIndex.insertCollisionCircles(rr.circles,me,b.get("text-ignore-placement"),m.bucketInstanceId,So,xe.ID),p&&this.storeCollisionData(m.bucketInstanceId,ti,Lt,pr,mr,rr),St.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[St.crossTileID]=new _i(ki||kt,nn||xt,nr||m.justReloaded),h[St.crossTileID]=!0};if(At){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const St=m.getSortedSymbolIndexes(this.transform.angle);for(let Lt=St.length-1;Lt>=0;--Lt){const ti=St[Lt];ri(m.symbolInstances.get(ti),m.collisionArrays[ti],ti)}}else for(let St=i.symbolInstanceStart;St<i.symbolInstanceEnd;St++)ri(m.symbolInstances.get(St),m.collisionArrays[St],St);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const St=this.collisionCircleArrays[m.bucketInstanceId];s.as(St.invProjMatrix,M),St.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(i,h,p,m,b,I){if(p.textBox||p.iconBox){let E,M;this.collisionBoxArrays.has(i)?E=this.collisionBoxArrays.get(i):(E=new Map,this.collisionBoxArrays.set(i,E)),E.has(h)?M=E.get(h):(M={text:null,icon:null},E.set(h,M)),p.textBox&&(M.text=m.box),p.iconBox&&(M.icon=b.box)}if(I){let E=this.collisionCircleArrays[i];E===void 0&&(E=this.collisionCircleArrays[i]=new Vi);for(let M=0;M<I.circles.length;M+=4)E.circles.push(I.circles[M+0]),E.circles.push(I.circles[M+1]),E.circles.push(I.circles[M+2]),E.circles.push(I.collisionDetected?1:0)}}markUsedJustification(i,h,p,m){let b;b=m===s.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[s.at(h)];const I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const E of I)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=b>=0&&E!==b?0:p.crossTileID)}markUsedOrientation(i,h,p){const m=h===s.ah.horizontal||h===s.ah.horizontalOnly?h:0,b=h===s.ah.vertical?h:0,I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const E of I)i.text.placedSymbolArray.get(E).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(i):1,b=h?h.opacities:{},I=h?h.variableOffsets:{},E=h?h.placedOrientations:{};for(const M in this.placements){const D=this.placements[M],O=b[M];O?(this.opacities[M]=new fn(O,m,D.text,D.icon),p=p||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[M]=new fn(null,m,D.text,D.icon,D.skipFade),p=p||D.text||D.icon)}for(const M in b){const D=b[M];if(!this.opacities[M]){const O=new fn(D,m,!1,!1);O.isHidden()||(this.opacities[M]=O,p=p||D.text.placed||D.icon.placed)}}for(const M in I)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=I[M]);for(const M in E)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=E[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const p={};for(const m of h){const b=m.getBucket(i);b&&m.latestFeatureIndex&&i.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(i,h,p,m){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const b=i.layers[0],I=b.layout,E=new fn(null,0,!1,!1,!0),M=I.get("text-allow-overlap"),D=I.get("icon-allow-overlap"),O=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=I.get("text-rotation-alignment")==="map",Q=I.get("text-pitch-alignment")==="map",se=I.get("icon-text-fit")!=="none",de=new fn(null,0,M&&(D||!i.hasIconData()||I.get("icon-optional")),D&&(M||!i.hasTextData()||I.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ge=(ke,Ce,me)=>{for(let Re=0;Re<Ce/4;Re++)ke.opacityVertexArray.emplaceBack(me);ke.hasVisibleVertices=ke.hasVisibleVertices||me!==Ls},xe=this.collisionBoxArrays.get(i.bucketInstanceId);for(let ke=0;ke<i.symbolInstances.length;ke++){const Ce=i.symbolInstances.get(ke),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:Re,crossTileID:Be}=Ce;let He=this.opacities[Be];p[Be]?He=E:He||(He=de,this.opacities[Be]=He),p[Be]=!0;const ot=Ce.numIconVertices>0,wt=this.placedOrientations[Ce.crossTileID],It=wt===s.ah.vertical,At=wt===s.ah.horizontal||wt===s.ah.horizontalOnly;if(me>0||Re>0){const xt=Nr(He.text);ge(i.text,me,It?Ls:xt),ge(i.text,Re,At?Ls:xt);const Nt=He.text.isHidden();[Ce.rightJustifiedTextSymbolIndex,Ce.centerJustifiedTextSymbolIndex,Ce.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(i.text.placedSymbolArray.get(Lt).hidden=Nt||It?1:0)}),Ce.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(Ce.verticalPlacedTextSymbolIndex).hidden=Nt||At?1:0);const ri=this.variableOffsets[Ce.crossTileID];ri&&this.markUsedJustification(i,ri.anchor,Ce,wt);const St=this.placedOrientations[Ce.crossTileID];St&&(this.markUsedJustification(i,"left",Ce,St),this.markUsedOrientation(i,St,Ce))}if(ot){const xt=Nr(He.icon),Nt=!(se&&Ce.verticalPlacedIconSymbolIndex&&It);Ce.placedIconSymbolIndex>=0&&(ge(i.icon,Ce.numIconVertices,Nt?xt:Ls),i.icon.placedSymbolArray.get(Ce.placedIconSymbolIndex).hidden=He.icon.isHidden()),Ce.verticalPlacedIconSymbolIndex>=0&&(ge(i.icon,Ce.numVerticalIconVertices,Nt?Ls:xt),i.icon.placedSymbolArray.get(Ce.verticalPlacedIconSymbolIndex).hidden=He.icon.isHidden())}const kt=xe&&xe.has(ke)?xe.get(ke):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const xt=i.collisionArrays[ke];if(xt){let Nt=new s.P(0,0);if(xt.textBox||xt.verticalTextBox){let ri=!0;if(O){const St=this.variableOffsets[Be];St?(Nt=Kn(St.anchor,St.width,St.height,St.textOffset,St.textBoxScale),N&&Nt._rotate(Q?this.transform.angle:-this.transform.angle)):ri=!1}if(xt.textBox||xt.verticalTextBox){let St;xt.textBox&&(St=It),xt.verticalTextBox&&(St=At),Es(i.textCollisionBox.collisionVertexArray,He.text.placed,!ri||St,kt.text,Nt.x,Nt.y)}}if(xt.iconBox||xt.verticalIconBox){const ri=!!(!At&&xt.verticalIconBox);let St;xt.iconBox&&(St=ri),xt.verticalIconBox&&(St=!ri),Es(i.iconCollisionBox.collisionVertexArray,He.icon.placed,St,kt.icon,se?Nt.x:0,se?Nt.y:0)}}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ke.invProjMatrix,i.placementViewportMatrix=ke.viewportMatrix,i.collisionCircleArray=ke.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Es(v,i,h,p,m,b){p&&p.length!==0||(p=[0,0,0,0]);const I=p[0]-Qt,E=p[1]-Qt,M=p[2]-Qt,D=p[3]-Qt;v.emplaceBack(i?1:0,h?1:0,m||0,b||0,I,E),v.emplaceBack(i?1:0,h?1:0,m||0,b||0,M,E),v.emplaceBack(i?1:0,h?1:0,m||0,b||0,M,D),v.emplaceBack(i?1:0,h?1:0,m||0,b||0,I,D)}const qi=Math.pow(2,25),Sc=Math.pow(2,24),Tc=Math.pow(2,17),Br=Math.pow(2,16),Or=Math.pow(2,9),Vd=Math.pow(2,8),Xr=Math.pow(2,1);function Nr(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const i=v.placed?1:0,h=Math.floor(127*v.opacity);return h*qi+i*Sc+h*Tc+i*Br+h*Or+i*Vd+h*Xr+i}const Ls=0;function Yo(){return{isOccluded:(v,i,h)=>!1,getPitchedTextCorrection:(v,i,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(v,i,h,p){throw new Error("Not implemented.")},translatePosition:(v,i,h,p)=>function(m,b,I,E,M=!1){if(!I[0]&&!I[1])return[0,0];const D=M?E==="map"?m.angle:0:E==="viewport"?-m.angle:0;if(D){const O=Math.sin(D),N=Math.cos(D);I=[I[0]*N-I[1]*O,I[0]*O+I[1]*N]}return[M?I[0]:xi(b,I[0],m.zoom),M?I[1]:xi(b,I[1],m.zoom)]}(v,i,h,p),getCircleRadiusCorrection:v=>1}}class zn{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,p,m,b){const I=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(I,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((E,M)=>E.sortKey-M.sortKey));this._currentPartIndex<I.length;)if(h.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Sa{constructor(i,h,p,m,b,I,E,M){this.placement=new fr(i,Yo(),h,I,E,M),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(i,h,p){const m=S.now(),b=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const I=h[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=E)&&(!I.maxzoom||I.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new zn(I)),this._inProgressLayer.continuePlacement(p[I.source],this.placement,this._showCollisionBoxes,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ro=512/s.X/2;class Mn{constructor(i,h,p){this.tileID=i,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<h.length;b++){const I=h.get(b),E=I.key,M=m.get(E);M?M.push(I):m.set(E,[I])}for(const[b,I]of m){const E={positions:I.map(M=>({x:Math.floor(M.anchorX*ro),y:Math.floor(M.anchorY*ro)})),crossTileIDs:I.map(M=>M.crossTileID)};if(E.positions.length>128){const M=new s.av(E.positions.length,16,Uint16Array);for(const{x:D,y:O}of E.positions)M.add(D,O);M.finish(),delete E.positions,E.index=M}this._symbolsByKey[b]=E}}getScaledCoordinates(i,h){const{x:p,y:m,z:b}=this.tileID.canonical,{x:I,y:E,z:M}=h.canonical,D=ro/Math.pow(2,M-b),O=(E*s.X+i.anchorY)*D,N=m*s.X*ro;return{x:Math.floor((I*s.X+i.anchorX)*D-p*s.X*ro),y:Math.floor(O-N)}}findMatches(i,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<i.length;b++){const I=i.get(b);if(I.crossTileID)continue;const E=this._symbolsByKey[I.key];if(!E)continue;const M=this.getScaledCoordinates(I,h);if(E.index){const D=E.index.range(M.x-m,M.y-m,M.x+m,M.y+m).sort();for(const O of D){const N=E.crossTileIDs[O];if(!p[N]){p[N]=!0,I.crossTileID=N;break}}}else if(E.positions)for(let D=0;D<E.positions.length;D++){const O=E.positions[D],N=E.crossTileIDs[D];if(Math.abs(O.x-M.x)<=m&&Math.abs(O.y-M.y)<=m&&!p[N]){p[N]=!0,I.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class rl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const I in m){const E=m[I];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),b[E.tileID.key]=E}this.indexes[p]=b}this.lng=i}addBucket(i,h,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const m=this.usedCrossTileIDs[i.overscaledZ];for(const b in this.indexes){const I=this.indexes[b];if(Number(b)>i.overscaledZ)for(const E in I){const M=I[E];M.tileID.isChildOf(i)&&M.findMatches(h.symbolInstances,i,m)}else{const E=I[i.scaledTo(Number(b)).key];E&&E.findMatches(h.symbolInstances,i,m)}}for(let b=0;b<h.symbolInstances.length;b++){const I=h.symbolInstances.get(b);I.crossTileID||(I.crossTileID=p.generate(),m[I.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Mn(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[i][m]}removeStaleBuckets(i){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)i[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],h=!0)}return h}}class Ic{constructor(){this.layerIndexes={},this.crossTileIDs=new rl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,p){let m=this.layerIndexes[i.id];m===void 0&&(m=this.layerIndexes[i.id]=new oo);let b=!1;const I={};m.handleWrapJump(p);for(const E of h){const M=E.getBucket(i);M&&i.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(E.tileID,M,this.crossTileIDs)&&(b=!0),I[M.bucketInstanceId]=!0)}return m.removeStaleBuckets(I)&&(b=!0),b}pruneUnusedLayers(i){const h={};i.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const so=(v,i)=>s.t(v,i&&i.filter(h=>h.identifier!=="source.canvas")),qd=s.aw();class ol extends s.E{constructor(i,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=i,this.dispatcher=new Ri(Si(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new it(i._requestManager,h.localIdeographFontFamily),this.lineAtlas=new at(256,512),this.crossTileSymbolIndex=new Ic,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.ay()),Un().on(ct,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const I in this._layers){const E=this._layers[I];E.source===b.id&&this._validateLayer(E)}})}loadURL(i,h={},p){this.fire(new s.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;s.h(m,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,h,p)}).catch(I=>{this._loadStyleRequest=null,I&&!b.signal.aborted&&this.fire(new s.j(I))})}loadJSON(i,h={},p){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(i,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(qd,{validate:!1})}_load(i,h,p){var m;const b=h.transformStyle?h.transformStyle(p,i):i;if(!h.validate||!so(this,s.u(b))){this._loaded=!0,this.stylesheet=b;for(const I in b.sources)this.addSource(I,b.sources[I],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new jt(this.stylesheet.light),this.sky=new et(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const i=s.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of i){const p=s.aA(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(i,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,I,E,M){return s._(this,void 0,void 0,function*(){const D=ue(b),O=E>1?"@2x":"",N={},Q={};for(const{id:se,url:de}of D){const ge=I.transformRequest(fe(de,O,".json"),"SpriteJSON");N[se]=s.h(ge,M);const xe=I.transformRequest(fe(de,O,".png"),"SpriteImage");Q[se]=K.getImage(xe,M)}return yield Promise.all([...Object.values(N),...Object.values(Q)]),function(se,de){return s._(this,void 0,void 0,function*(){const ge={};for(const xe in se){ge[xe]={};const ke=S.getImageCanvasContext((yield de[xe]).data),Ce=(yield se[xe]).data;for(const me in Ce){const{width:Re,height:Be,x:He,y:ot,sdf:wt,pixelRatio:It,stretchX:At,stretchY:kt,content:xt,textFitWidth:Nt,textFitHeight:ri}=Ce[me];ge[xe][me]={data:null,pixelRatio:It,sdf:wt,stretchX:At,stretchY:kt,content:xt,textFitWidth:Nt,textFitHeight:ri,spriteData:{width:Re,height:Be,x:He,y:ot,context:ke}}}}return ge})}(N,Q)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const I in b){this._spritesImagesIds[I]=[];const E=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(M=>!(M in b)):[];for(const M of E)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in b[I]){const D=I==="default"?M:`${I}:${M}`;this._spritesImagesIds[I].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,b[I][M],!1):this.imageManager.addImage(D,b[I][M]),h&&(this._changedImages[D]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new s.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(i){const h=this.sourceCaches[i.source];if(!h)return;const p=i.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,h=!1){const p=this._serializedAllLayers();if(!i||i.length===0)return Object.values(h?s.aB(p):p);const m=[];for(const b of i)if(p[b]){const I=h?s.aB(p[b]):p[b];m.push(I)}return m}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(i[p]=m.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const I in this._updatedSources){const E=this._updatedSources[I];if(E==="reload")this._reloadSource(I);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(i,this._availableImages),!b.isHidden(i.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(i),this.sky.recalculate(i),this.z=i.zoom,h&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,h={}){var p;this._checkLoaded();const m=this.serialize();if(i=h.transformStyle?h.transformStyle(m,i):i,((p=h.validate)===null||p===void 0||p)&&so(this,s.u(i)))return!1;(i=s.aB(i)).layers=s.az(i.layers);const b=s.aC(m,i),I=this._getOperationsToPerform(b);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const E of I.operations)E();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const h=[],p=[];for(const m of i)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":h.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(i,h){if(this.getImage(i))return this.fire(new s.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,h),this._afterImageUpdated(i)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new s.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,h,p={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.u.source,`sources.${i}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[i]=new Jt(i,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:i})),m.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===i)return this.fire(new s.j(new Error(`Source "${i}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],h.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,h){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const p=this.sourceCaches[i].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,h,p={}){this._checkLoaded();const m=i.id;if(this.getLayer(m))return void this.fire(new s.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(i.type==="custom"){if(so(this,s.aD(i)))return;b=s.aA(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(m,i.source),i=s.aB(i),i=s.e(i,{source:m})),this._validate(s.u.layer,`layers.${m}`,i,{arrayIndex:-1},p))return;b=s.aA(i),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const I=h?this._order.indexOf(h):this._order.length;if(h&&I===-1)this.fire(new s.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(I,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const E=this._removedLayers[m];delete this._removedLayers[m],E.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new s.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const p=this._order.indexOf(i);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new s.j(new Error(`Cannot move layer "${i}" before non-existing layer "${h}".`))):(this._order.splice(m,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${i}".`)));h.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,h,p){this._checkLoaded();const m=this.getLayer(i);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,h,p={}){this._checkLoaded();const m=this.getLayer(i);if(m){if(!s.aE(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(s.u.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=s.aB(h),this._updateLayer(m)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return s.aB(this.getLayer(i).filter)}setLayoutProperty(i,h,p,m={}){this._checkLoaded();const b=this.getLayer(i);b?s.aE(b.getLayoutProperty(h),p)||(b.setLayoutProperty(h,p,m),this._updateLayer(b)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,h){const p=this.getLayer(i);if(p)return p.getLayoutProperty(h);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,h,p,m={}){this._checkLoaded();const b=this.getLayer(i);b?s.aE(b.getPaintProperty(h),p)||(b.setPaintProperty(h,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,h){return this.getLayer(i).getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const p=i.source,m=i.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new s.j(new Error(`The source '${p}' does not exist in the map's style.`)));const I=b.getSource().type;I==="geojson"&&m?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||m?(i.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,i.id,h)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,h){this._checkLoaded();const p=i.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new s.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,I=b==="vector"?i.sourceLayer:void 0;b!=="vector"||I?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(I,i.id,h):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const h=i.source,p=i.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(i.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,i.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=s.aF(this.sourceCaches,b=>b.serialize()),h=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return s.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:i,layers:h,terrain:p},b=>b!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const h=I=>this._layers[I].type==="fill-extrusion",p={},m=[];for(let I=this._order.length-1;I>=0;I--){const E=this._order[I];if(h(E)){p[E]=I;for(const M of i){const D=M[E];if(D)for(const O of D)m.push(O)}}}m.sort((I,E)=>E.intersectionZ-I.intersectionZ);const b=[];for(let I=this._order.length-1;I>=0;I--){const E=this._order[I];if(h(E))for(let M=m.length-1;M>=0;M--){const D=m[M].feature;if(p[D.layer.id]<I)break;b.push(D),m.pop()}else for(const M of i){const D=M[E];if(D)for(const O of D)b.push(O.feature)}}return b}queryRenderedFeatures(i,h,p){h&&h.filter&&this._validate(s.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const M=this._layers[E];if(!M)return this.fire(new s.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];m[M.source]=!0}}const b=[];h.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const E in this.sourceCaches)h.layers&&!m[E]||b.push(lt(this.sourceCaches[E],this._layers,I,i,h,p));return this.placement&&b.push(function(E,M,D,O,N,Q,se){const de={},ge=Q.queryRenderedSymbols(O),xe=[];for(const ke of Object.keys(ge).map(Number))xe.push(se[ke]);xe.sort(qe);for(const ke of xe){const Ce=ke.featureIndex.lookupSymbolFeatures(ge[ke.bucketInstanceId],M,ke.bucketIndex,ke.sourceLayerIndex,N.filter,N.layers,N.availableImages,E);for(const me in Ce){const Re=de[me]=de[me]||[],Be=Ce[me];Be.sort((He,ot)=>{const wt=ke.featureSortOrder;if(wt){const It=wt.indexOf(He.featureIndex);return wt.indexOf(ot.featureIndex)-It}return ot.featureIndex-He.featureIndex});for(const He of Be)Re.push(He)}}for(const ke in de)de[ke].forEach(Ce=>{const me=Ce.feature,Re=D[E[ke].source].getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Re});return de}(this._layers,I,this.sourceCaches,i,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(i,h){h&&h.filter&&this._validate(s.u.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[i];return p?function(m,b){const I=m.getRenderableIds().map(D=>m.getTileByID(D)),E=[],M={};for(let D=0;D<I.length;D++){const O=I[D],N=O.tileID.canonical.key;M[N]||(M[N]=!0,O.querySourceFeatures(E,b))}return E}(p,h):[]}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const I in i)if(!s.aE(i[I],p[I])){m=!0;break}if(!m)return;const b={now:S.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(b)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,h={}){const p=this.getSky();let m=!1;if(!i&&!p)return;if(i&&!p)m=!0;else if(!i&&p)m=!0;else for(const I in i)if(!s.aE(i[I],p[I])){m=!0;break}if(!m)return;const b={now:S.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,h),this.sky.updateTransitions(b)}_validate(i,h,p,m,b={}){return(!b||b.validate!==!1)&&so(this,i.call(s.u,s.e({key:h,style:this.serialize(),value:p,styleSpec:s.v},m)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Un().off(ct,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const h in this.sourceCaches)this.sourceCaches[h].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,h,p,m,b=!1){let I=!1,E=!1;const M={};for(const D of this._order){const O=this._layers[D];if(O.type!=="symbol")continue;if(!M[O.source]){const Q=this.sourceCaches[O.source];M[O.source]=Q.getRenderableIds(!0).map(se=>Q.getTileByID(se)).sort((se,de)=>de.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(de.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(O,M[O.source],i.center.lng);I=I||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),i.zoom))&&(this.pauseablePlacement=new Sa(i,this.map.terrain,this._order,b,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),E=!0),I&&this.pauseablePlacement.placement.setStale()),E||I)for(const D of this._order){const O=this._layers[D];O.type==="symbol"&&this.placement.updateLayerOpacities(O,M[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h){return s._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(i,h){return s._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,h={}){this._checkLoaded(),i&&this._validate(s.u.glyphs,"glyphs",i,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,h,p={},m){this._checkLoaded();const b=[{id:i,url:h}],I=[...ue(this.stylesheet.sprite),...b];this._validate(s.u.sprite,"sprite",I,null,p)||(this.stylesheet.sprite=I,this._loadSprite(b,!0,m))}removeSprite(i){this._checkLoaded();const h=ue(this.stylesheet.sprite);if(h.find(p=>p.id===i)){if(this._spritesImagesIds[i])for(const p of this._spritesImagesIds[i])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===i),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return ue(this.stylesheet.sprite)}setSprite(i,h={},p){this._checkLoaded(),i&&this._validate(s.u.sprite,"sprite",i,null,h)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,p):(this._unloadSprite(),p&&p(null)))}}var Qo=s.Y([{name:"a_pos",type:"Int16",components:2}]);const qo={prelude:Bi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Bi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Bi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Bi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Bi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Bi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Bi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Bi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Bi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Bi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Bi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Bi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Bi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Bi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Bi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Bi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Bi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Bi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Bi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Bi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Bi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Bi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Bi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Bi(v,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=i.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=b?b.concat(m):m,E={};return{fragmentSource:v=v.replace(h,(M,D,O,N,Q)=>(E[Q]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
varying ${O} ${N} ${Q};
#else
uniform ${O} ${N} u_${Q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Q}
    ${O} ${N} ${Q} = u_${Q};
#endif
`)),vertexSource:i=i.replace(h,(M,D,O,N,Q)=>{const se=N==="float"?"vec2":"vec4",de=Q.match(/color/)?"color":se;return E[Q]?D==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${O} ${se} a_${Q};
varying ${O} ${N} ${Q};
#else
uniform ${O} ${N} u_${Q};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${de}(a_${Q}, u_${Q}_t);
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${O} ${se} a_${Q};
#else
uniform ${O} ${N} u_${Q};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${O} ${N} ${Q} = a_${Q};
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${O} ${N} ${Q} = unpack_mix_${de}(a_${Q}, u_${Q}_t);
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`}),staticAttributes:p,staticUniforms:I}}class Cc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,p,m,b,I,E,M,D){this.context=i;let O=this.boundPaintVertexBuffers.length!==m.length;for(let N=0;!O&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(O=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||O||this.boundIndexBuffer!==b||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==D?this.freshBind(h,p,m,b,I,E,M,D):(i.bindVertexArray.set(this.vao),E&&E.bind(),b&&b.dynamicDraw&&b.bind(),M&&M.bind(),D&&D.bind())}freshBind(i,h,p,m,b,I,E,M){const D=i.numAttributes,O=this.context,N=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=M,h.enableAttributes(N,i);for(const Q of p)Q.enableAttributes(N,i);I&&I.enableAttributes(N,i),E&&E.enableAttributes(N,i),M&&M.enableAttributes(N,i),h.bind(),h.setVertexAttribPointers(N,i,b);for(const Q of p)Q.bind(),Q.setVertexAttribPointers(N,i,b);I&&(I.bind(),I.setVertexAttribPointers(N,i,b)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(N,i,b)),M&&(M.bind(),M.setVertexAttribPointers(N,i,b)),O.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ec=(v,i,h,p,m)=>({u_matrix:v,u_texture:0,u_ele_delta:i,u_fog_matrix:h,u_fog_color:p?p.properties.get("fog-color"):s.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):s.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function Ms(v){const i=[];for(let h=0;h<v.length;h++){if(v[h]===null)continue;const p=v[h].split(" ");i.push(p.pop())}return i}class Lc{constructor(i,h,p,m,b,I){const E=i.gl;this.program=E.createProgram();const M=Ms(h.staticAttributes),D=p?p.getBinderAttributes():[],O=M.concat(D),N=qo.prelude.staticUniforms?Ms(qo.prelude.staticUniforms):[],Q=h.staticUniforms?Ms(h.staticUniforms):[],se=p?p.getBinderUniforms():[],de=N.concat(Q).concat(se),ge=[];for(const He of de)ge.indexOf(He)<0&&ge.push(He);const xe=p?p.defines():[];b&&xe.push("#define OVERDRAW_INSPECTOR;"),I&&xe.push("#define TERRAIN3D;");const ke=xe.concat(qo.prelude.fragmentSource,h.fragmentSource).join(`
`),Ce=xe.concat(qo.prelude.vertexSource,h.vertexSource).join(`
`),me=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(me,ke),E.compileShader(me),!E.getShaderParameter(me,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(me)}`);E.attachShader(this.program,me);const Re=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(Re,Ce),E.compileShader(Re),!E.getShaderParameter(Re,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(Re)}`);E.attachShader(this.program,Re),this.attributes={};const Be={};this.numAttributes=O.length;for(let He=0;He<this.numAttributes;He++)O[He]&&(E.bindAttribLocation(this.program,He,O[He]),this.attributes[O[He]]=He);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(Re),E.deleteShader(me);for(let He=0;He<ge.length;He++){const ot=ge[He];if(ot&&!Be[ot]){const wt=E.getUniformLocation(this.program,ot);wt&&(Be[ot]=wt)}}this.fixedUniforms=m(i,Be),this.terrainUniforms=((He,ot)=>({u_depth:new s.aH(He,ot.u_depth),u_terrain:new s.aH(He,ot.u_terrain),u_terrain_dim:new s.aI(He,ot.u_terrain_dim),u_terrain_matrix:new s.aJ(He,ot.u_terrain_matrix),u_terrain_unpack:new s.aK(He,ot.u_terrain_unpack),u_terrain_exaggeration:new s.aI(He,ot.u_terrain_exaggeration)}))(i,Be),this.binderUniforms=p?p.getUniforms(i,Be):[]}draw(i,h,p,m,b,I,E,M,D,O,N,Q,se,de,ge,xe,ke,Ce){const me=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(m),i.setColorMode(b),i.setCullFace(I),M){i.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,M.depthTexture),i.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,M.texture);for(const Be in this.terrainUniforms)this.terrainUniforms[Be].set(M[Be])}for(const Be in this.fixedUniforms)this.fixedUniforms[Be].set(E[Be]);ge&&ge.setUniforms(i,this.binderUniforms,se,{zoom:de});let Re=0;switch(h){case me.LINES:Re=2;break;case me.TRIANGLES:Re=3;break;case me.LINE_STRIP:Re=1}for(const Be of Q.get()){const He=Be.vaos||(Be.vaos={});(He[D]||(He[D]=new Cc)).bind(i,this,O,ge?ge.getPaintVertexBuffers():[],N,Be.vertexOffset,xe,ke,Ce),me.drawElements(h,Be.primitiveLength*Re,me.UNSIGNED_SHORT,Be.primitiveOffset*Re*2)}}}function sl(v,i,h){const p=1/xi(h,1,i.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,i.transform.tileZoom)/m,I=b*(h.tileID.canonical.x+h.tileID.wrap*m),E=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[I>>16,E>>16],u_pixel_coord_lower:[65535&I,65535&E]}}const Ta=(v,i,h,p)=>{const m=i.style.light,b=m.properties.get("position"),I=[b.x,b.y,b.z],E=function(){var D=new s.A(9);return s.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();m.properties.get("anchor")==="viewport"&&function(D,O){var N=Math.sin(O),Q=Math.cos(O);D[0]=Q,D[1]=N,D[2]=0,D[3]=-N,D[4]=Q,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(E,-i.transform.angle),function(D,O,N){var Q=O[0],se=O[1],de=O[2];D[0]=Q*N[0]+se*N[3]+de*N[6],D[1]=Q*N[1]+se*N[4]+de*N[7],D[2]=Q*N[2]+se*N[5]+de*N[8]}(I,I,E);const M=m.properties.get("color");return{u_matrix:v,u_lightpos:I,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:p}},al=(v,i,h,p,m,b,I)=>s.e(Ta(v,i,h,p),sl(b,i,I),{u_height_factor:-Math.pow(2,m.overscaledZ)/I.tileSize/8}),As=v=>({u_matrix:v}),hh=(v,i,h,p)=>s.e(As(v),sl(h,i,p)),Zd=(v,i)=>({u_matrix:v,u_world:i}),dh=(v,i,h,p,m)=>s.e(hh(v,i,h,p),{u_world:m}),Gd=(v,i,h,p)=>{const m=v.transform;let b,I;if(p.paint.get("circle-pitch-alignment")==="map"){const E=xi(h,1,m.zoom);b=!0,I=[E,E]}else b=!1,I=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(i.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:I}},es=(v,i,h)=>({u_matrix:v,u_inv_matrix:i,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),Ia=(v,i,h=1)=>({u_matrix:v,u_color:i,u_overlay:0,u_overlay_scale:h}),xr=v=>({u_matrix:v}),kr=(v,i,h,p)=>({u_matrix:v,u_extrude_scale:xi(i,1,h),u_intensity:p}),ll=(v,i,h,p)=>{const m=s.H();s.aP(m,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:h,u_color_ramp:p,u_opacity:i.paint.get("heatmap-opacity")}};function cl(v,i){const h=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new s.Z(0,p/h).toLngLat().lat,new s.Z(0,(p+1)/h).toLngLat().lat]}const ul=(v,i,h,p)=>{const m=v.transform;return{u_matrix:mh(v,i,h,p),u_ratio:1/xi(i,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},fh=(v,i,h,p,m)=>s.e(ul(v,i,h,m),{u_image:0,u_image_height:p}),Ps=(v,i,h,p,m)=>{const b=v.transform,I=ph(i,b);return{u_matrix:mh(v,i,h,m),u_texsize:i.imageAtlasTexture.size,u_ratio:1/xi(i,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[I,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Wd=(v,i,h,p,m,b)=>{const I=v.lineAtlas,E=ph(i,v.transform),M=h.layout.get("line-cap")==="round",D=I.getDash(p.from,M),O=I.getDash(p.to,M),N=D.width*m.fromScale,Q=O.width*m.toScale;return s.e(ul(v,i,h,b),{u_patternscale_a:[E/N,-D.height/2],u_patternscale_b:[E/Q,-O.height/2],u_sdfgamma:I.width/(256*Math.min(N,Q)*v.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:O.y,u_mix:m.t})};function ph(v,i){return 1/xi(v,1,i.tileZoom)}function mh(v,i,h,p){return v.translatePosMatrix(p?p.posMatrix:i.tileID.posMatrix,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Hd=(v,i,h,p,m)=>{return{u_matrix:v,u_tl_parent:i,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(I=m.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Xd(m.paint.get("raster-hue-rotate"))};var b,I};function Xd(v){v*=Math.PI/180;const i=Math.sin(v),h=Math.cos(v);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const _h=(v,i,h,p,m,b,I,E,M,D,O,N,Q,se)=>{const de=I.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_pitch:de.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:de.width/de.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:M,u_coord_matrix:D,u_is_text:+N,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:Q,u_texture:0,u_translation:O,u_pitched_scale:se}},Ca=(v,i,h,p,m,b,I,E,M,D,O,N,Q,se,de)=>{const ge=I.transform;return s.e(_h(v,i,h,p,m,b,I,E,M,D,O,N,Q,de),{u_gamma_scale:p?Math.cos(ge._pitch)*ge.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:+se})},Mc=(v,i,h,p,m,b,I,E,M,D,O,N,Q,se)=>s.e(Ca(v,i,h,p,m,b,I,E,M,D,O,!0,N,!0,se),{u_texsize_icon:Q,u_texture_icon:1}),hl=(v,i,h)=>({u_matrix:v,u_opacity:i,u_color:h}),Ac=(v,i,h,p,m,b)=>s.e(function(I,E,M,D){const O=M.imageManager.getPattern(I.from.toString()),N=M.imageManager.getPattern(I.to.toString()),{width:Q,height:se}=M.imageManager.getPixelSize(),de=Math.pow(2,D.tileID.overscaledZ),ge=D.tileSize*Math.pow(2,M.transform.tileZoom)/de,xe=ge*(D.tileID.canonical.x+D.tileID.wrap*de),ke=ge*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[Q,se],u_mix:E.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/xi(D,1,M.transform.tileZoom),u_pixel_coord_upper:[xe>>16,ke>>16],u_pixel_coord_lower:[65535&xe,65535&ke]}}(p,b,h,m),{u_matrix:v,u_opacity:i}),Pc={fillExtrusion:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_lightpos:new s.aN(v,i.u_lightpos),u_lightintensity:new s.aI(v,i.u_lightintensity),u_lightcolor:new s.aN(v,i.u_lightcolor),u_vertical_gradient:new s.aI(v,i.u_vertical_gradient),u_opacity:new s.aI(v,i.u_opacity)}),fillExtrusionPattern:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_lightpos:new s.aN(v,i.u_lightpos),u_lightintensity:new s.aI(v,i.u_lightintensity),u_lightcolor:new s.aN(v,i.u_lightcolor),u_vertical_gradient:new s.aI(v,i.u_vertical_gradient),u_height_factor:new s.aI(v,i.u_height_factor),u_image:new s.aH(v,i.u_image),u_texsize:new s.aO(v,i.u_texsize),u_pixel_coord_upper:new s.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(v,i.u_pixel_coord_lower),u_scale:new s.aN(v,i.u_scale),u_fade:new s.aI(v,i.u_fade),u_opacity:new s.aI(v,i.u_opacity)}),fill:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix)}),fillPattern:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_image:new s.aH(v,i.u_image),u_texsize:new s.aO(v,i.u_texsize),u_pixel_coord_upper:new s.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(v,i.u_pixel_coord_lower),u_scale:new s.aN(v,i.u_scale),u_fade:new s.aI(v,i.u_fade)}),fillOutline:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_world:new s.aO(v,i.u_world)}),fillOutlinePattern:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_world:new s.aO(v,i.u_world),u_image:new s.aH(v,i.u_image),u_texsize:new s.aO(v,i.u_texsize),u_pixel_coord_upper:new s.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(v,i.u_pixel_coord_lower),u_scale:new s.aN(v,i.u_scale),u_fade:new s.aI(v,i.u_fade)}),circle:(v,i)=>({u_camera_to_center_distance:new s.aI(v,i.u_camera_to_center_distance),u_scale_with_map:new s.aH(v,i.u_scale_with_map),u_pitch_with_map:new s.aH(v,i.u_pitch_with_map),u_extrude_scale:new s.aO(v,i.u_extrude_scale),u_device_pixel_ratio:new s.aI(v,i.u_device_pixel_ratio),u_matrix:new s.aJ(v,i.u_matrix)}),collisionBox:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_pixel_extrude_scale:new s.aO(v,i.u_pixel_extrude_scale)}),collisionCircle:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_inv_matrix:new s.aJ(v,i.u_inv_matrix),u_camera_to_center_distance:new s.aI(v,i.u_camera_to_center_distance),u_viewport_size:new s.aO(v,i.u_viewport_size)}),debug:(v,i)=>({u_color:new s.aL(v,i.u_color),u_matrix:new s.aJ(v,i.u_matrix),u_overlay:new s.aH(v,i.u_overlay),u_overlay_scale:new s.aI(v,i.u_overlay_scale)}),clippingMask:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix)}),heatmap:(v,i)=>({u_extrude_scale:new s.aI(v,i.u_extrude_scale),u_intensity:new s.aI(v,i.u_intensity),u_matrix:new s.aJ(v,i.u_matrix)}),heatmapTexture:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_world:new s.aO(v,i.u_world),u_image:new s.aH(v,i.u_image),u_color_ramp:new s.aH(v,i.u_color_ramp),u_opacity:new s.aI(v,i.u_opacity)}),hillshade:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_image:new s.aH(v,i.u_image),u_latrange:new s.aO(v,i.u_latrange),u_light:new s.aO(v,i.u_light),u_shadow:new s.aL(v,i.u_shadow),u_highlight:new s.aL(v,i.u_highlight),u_accent:new s.aL(v,i.u_accent)}),hillshadePrepare:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_image:new s.aH(v,i.u_image),u_dimension:new s.aO(v,i.u_dimension),u_zoom:new s.aI(v,i.u_zoom),u_unpack:new s.aK(v,i.u_unpack)}),line:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_ratio:new s.aI(v,i.u_ratio),u_device_pixel_ratio:new s.aI(v,i.u_device_pixel_ratio),u_units_to_pixels:new s.aO(v,i.u_units_to_pixels)}),lineGradient:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_ratio:new s.aI(v,i.u_ratio),u_device_pixel_ratio:new s.aI(v,i.u_device_pixel_ratio),u_units_to_pixels:new s.aO(v,i.u_units_to_pixels),u_image:new s.aH(v,i.u_image),u_image_height:new s.aI(v,i.u_image_height)}),linePattern:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_texsize:new s.aO(v,i.u_texsize),u_ratio:new s.aI(v,i.u_ratio),u_device_pixel_ratio:new s.aI(v,i.u_device_pixel_ratio),u_image:new s.aH(v,i.u_image),u_units_to_pixels:new s.aO(v,i.u_units_to_pixels),u_scale:new s.aN(v,i.u_scale),u_fade:new s.aI(v,i.u_fade)}),lineSDF:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_ratio:new s.aI(v,i.u_ratio),u_device_pixel_ratio:new s.aI(v,i.u_device_pixel_ratio),u_units_to_pixels:new s.aO(v,i.u_units_to_pixels),u_patternscale_a:new s.aO(v,i.u_patternscale_a),u_patternscale_b:new s.aO(v,i.u_patternscale_b),u_sdfgamma:new s.aI(v,i.u_sdfgamma),u_image:new s.aH(v,i.u_image),u_tex_y_a:new s.aI(v,i.u_tex_y_a),u_tex_y_b:new s.aI(v,i.u_tex_y_b),u_mix:new s.aI(v,i.u_mix)}),raster:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_tl_parent:new s.aO(v,i.u_tl_parent),u_scale_parent:new s.aI(v,i.u_scale_parent),u_buffer_scale:new s.aI(v,i.u_buffer_scale),u_fade_t:new s.aI(v,i.u_fade_t),u_opacity:new s.aI(v,i.u_opacity),u_image0:new s.aH(v,i.u_image0),u_image1:new s.aH(v,i.u_image1),u_brightness_low:new s.aI(v,i.u_brightness_low),u_brightness_high:new s.aI(v,i.u_brightness_high),u_saturation_factor:new s.aI(v,i.u_saturation_factor),u_contrast_factor:new s.aI(v,i.u_contrast_factor),u_spin_weights:new s.aN(v,i.u_spin_weights)}),symbolIcon:(v,i)=>({u_is_size_zoom_constant:new s.aH(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aH(v,i.u_is_size_feature_constant),u_size_t:new s.aI(v,i.u_size_t),u_size:new s.aI(v,i.u_size),u_camera_to_center_distance:new s.aI(v,i.u_camera_to_center_distance),u_pitch:new s.aI(v,i.u_pitch),u_rotate_symbol:new s.aH(v,i.u_rotate_symbol),u_aspect_ratio:new s.aI(v,i.u_aspect_ratio),u_fade_change:new s.aI(v,i.u_fade_change),u_matrix:new s.aJ(v,i.u_matrix),u_label_plane_matrix:new s.aJ(v,i.u_label_plane_matrix),u_coord_matrix:new s.aJ(v,i.u_coord_matrix),u_is_text:new s.aH(v,i.u_is_text),u_pitch_with_map:new s.aH(v,i.u_pitch_with_map),u_is_along_line:new s.aH(v,i.u_is_along_line),u_is_variable_anchor:new s.aH(v,i.u_is_variable_anchor),u_texsize:new s.aO(v,i.u_texsize),u_texture:new s.aH(v,i.u_texture),u_translation:new s.aO(v,i.u_translation),u_pitched_scale:new s.aI(v,i.u_pitched_scale)}),symbolSDF:(v,i)=>({u_is_size_zoom_constant:new s.aH(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aH(v,i.u_is_size_feature_constant),u_size_t:new s.aI(v,i.u_size_t),u_size:new s.aI(v,i.u_size),u_camera_to_center_distance:new s.aI(v,i.u_camera_to_center_distance),u_pitch:new s.aI(v,i.u_pitch),u_rotate_symbol:new s.aH(v,i.u_rotate_symbol),u_aspect_ratio:new s.aI(v,i.u_aspect_ratio),u_fade_change:new s.aI(v,i.u_fade_change),u_matrix:new s.aJ(v,i.u_matrix),u_label_plane_matrix:new s.aJ(v,i.u_label_plane_matrix),u_coord_matrix:new s.aJ(v,i.u_coord_matrix),u_is_text:new s.aH(v,i.u_is_text),u_pitch_with_map:new s.aH(v,i.u_pitch_with_map),u_is_along_line:new s.aH(v,i.u_is_along_line),u_is_variable_anchor:new s.aH(v,i.u_is_variable_anchor),u_texsize:new s.aO(v,i.u_texsize),u_texture:new s.aH(v,i.u_texture),u_gamma_scale:new s.aI(v,i.u_gamma_scale),u_device_pixel_ratio:new s.aI(v,i.u_device_pixel_ratio),u_is_halo:new s.aH(v,i.u_is_halo),u_translation:new s.aO(v,i.u_translation),u_pitched_scale:new s.aI(v,i.u_pitched_scale)}),symbolTextAndIcon:(v,i)=>({u_is_size_zoom_constant:new s.aH(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aH(v,i.u_is_size_feature_constant),u_size_t:new s.aI(v,i.u_size_t),u_size:new s.aI(v,i.u_size),u_camera_to_center_distance:new s.aI(v,i.u_camera_to_center_distance),u_pitch:new s.aI(v,i.u_pitch),u_rotate_symbol:new s.aH(v,i.u_rotate_symbol),u_aspect_ratio:new s.aI(v,i.u_aspect_ratio),u_fade_change:new s.aI(v,i.u_fade_change),u_matrix:new s.aJ(v,i.u_matrix),u_label_plane_matrix:new s.aJ(v,i.u_label_plane_matrix),u_coord_matrix:new s.aJ(v,i.u_coord_matrix),u_is_text:new s.aH(v,i.u_is_text),u_pitch_with_map:new s.aH(v,i.u_pitch_with_map),u_is_along_line:new s.aH(v,i.u_is_along_line),u_is_variable_anchor:new s.aH(v,i.u_is_variable_anchor),u_texsize:new s.aO(v,i.u_texsize),u_texsize_icon:new s.aO(v,i.u_texsize_icon),u_texture:new s.aH(v,i.u_texture),u_texture_icon:new s.aH(v,i.u_texture_icon),u_gamma_scale:new s.aI(v,i.u_gamma_scale),u_device_pixel_ratio:new s.aI(v,i.u_device_pixel_ratio),u_is_halo:new s.aH(v,i.u_is_halo),u_translation:new s.aO(v,i.u_translation),u_pitched_scale:new s.aI(v,i.u_pitched_scale)}),background:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_opacity:new s.aI(v,i.u_opacity),u_color:new s.aL(v,i.u_color)}),backgroundPattern:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_opacity:new s.aI(v,i.u_opacity),u_image:new s.aH(v,i.u_image),u_pattern_tl_a:new s.aO(v,i.u_pattern_tl_a),u_pattern_br_a:new s.aO(v,i.u_pattern_br_a),u_pattern_tl_b:new s.aO(v,i.u_pattern_tl_b),u_pattern_br_b:new s.aO(v,i.u_pattern_br_b),u_texsize:new s.aO(v,i.u_texsize),u_mix:new s.aI(v,i.u_mix),u_pattern_size_a:new s.aO(v,i.u_pattern_size_a),u_pattern_size_b:new s.aO(v,i.u_pattern_size_b),u_scale_a:new s.aI(v,i.u_scale_a),u_scale_b:new s.aI(v,i.u_scale_b),u_pixel_coord_upper:new s.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(v,i.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aI(v,i.u_tile_units_to_pixels)}),terrain:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_texture:new s.aH(v,i.u_texture),u_ele_delta:new s.aI(v,i.u_ele_delta),u_fog_matrix:new s.aJ(v,i.u_fog_matrix),u_fog_color:new s.aL(v,i.u_fog_color),u_fog_ground_blend:new s.aI(v,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.aI(v,i.u_fog_ground_blend_opacity),u_horizon_color:new s.aL(v,i.u_horizon_color),u_horizon_fog_blend:new s.aI(v,i.u_horizon_fog_blend)}),terrainDepth:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_ele_delta:new s.aI(v,i.u_ele_delta)}),terrainCoords:(v,i)=>({u_matrix:new s.aJ(v,i.u_matrix),u_texture:new s.aH(v,i.u_texture),u_terrain_coords_id:new s.aI(v,i.u_terrain_coords_id),u_ele_delta:new s.aI(v,i.u_ele_delta)}),sky:(v,i)=>({u_sky_color:new s.aL(v,i.u_sky_color),u_horizon_color:new s.aL(v,i.u_horizon_color),u_horizon:new s.aI(v,i.u_horizon),u_sky_horizon_blend:new s.aI(v,i.u_sky_horizon_blend)})};class wo{constructor(i,h,p){this.context=i;const m=i.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Kd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zc{constructor(i,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=i;const b=i.gl;this.buffer=b.createBuffer(),i.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,h,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],I=h.attributes[b.name];I!==void 0&&i.vertexAttribPointer(I,b.components,i[Kd[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ts=new WeakMap;function Zo(v){var i;if(ts.has(v))return ts.get(v);{const h=(i=v.getParameter(v.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return ts.set(v,h),h}}class Ui{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class dl extends Ui{getDefault(){return s.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Jd extends Ui{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class zs extends Ui{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Yd extends Ui{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class gh extends Ui{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Qd extends Ui{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class yh extends Ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Dc extends Ui{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class bh extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class vh extends Ui{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class wh extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class xh extends Ui{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class is extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class kh extends Ui{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class ef extends Ui{getDefault(){return s.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Sh extends Ui{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ea extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class tf extends Ui{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class fl extends Ui{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class nf extends Ui{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class rf extends Ui{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Th extends Ui{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ih extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ch extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Rc extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Eh extends Ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class pl extends Ui{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Do extends Ui{getDefault(){return null}set(i){var h;if(i===this.current&&!this.dirty)return;const p=this.gl;Zo(p)?p.bindVertexArray(i):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Fc extends Ui{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Bc extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Oc extends Ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ml extends Ui{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class Nc extends ml{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class ns extends ml{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class jc extends ml{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class of{constructor(i,h,p,m,b){this.context=i,this.width=h,this.height=p;const I=i.gl,E=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Nc(i,E),m)this.depthAttachment=b?new jc(i,E):new ns(i,E);else if(b)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class Tn{constructor(i,h,p){this.blendFunction=i,this.blendColor=h,this.mask=p}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,s.aM.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,s.aM.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],s.aM.transparent,[!0,!0,!0,!0]);class sf{constructor(i){var h,p;if(this.gl=i,this.clearColor=new dl(this),this.clearDepth=new Jd(this),this.clearStencil=new zs(this),this.colorMask=new Yd(this),this.depthMask=new gh(this),this.stencilMask=new Qd(this),this.stencilFunc=new yh(this),this.stencilOp=new Dc(this),this.stencilTest=new bh(this),this.depthRange=new vh(this),this.depthTest=new wh(this),this.depthFunc=new xh(this),this.blend=new is(this),this.blendFunc=new kh(this),this.blendColor=new ef(this),this.blendEquation=new Sh(this),this.cullFace=new Ea(this),this.cullFaceSide=new tf(this),this.frontFace=new fl(this),this.program=new nf(this),this.activeTexture=new rf(this),this.viewport=new Th(this),this.bindFramebuffer=new Ih(this),this.bindRenderbuffer=new Ch(this),this.bindTexture=new Rc(this),this.bindVertexBuffer=new Eh(this),this.bindElementBuffer=new pl(this),this.bindVertexArray=new Do(this),this.pixelStoreUnpack=new Fc(this),this.pixelStoreUnpackPremultiplyAlpha=new Bc(this),this.pixelStoreUnpackFlipY=new Oc(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Zo(i)){this.HALF_FLOAT=i.HALF_FLOAT;const m=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=i.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=i.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const m=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new wo(this,i,h)}createVertexBuffer(i,h,p){return new zc(this,i,h,p)}createRenderbuffer(i,h,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,i,h,p),this.bindRenderbuffer.set(null),b}createFramebuffer(i,h,p,m){return new of(this,i,h,p,m)}clear({color:i,depth:h,stencil:p}){const m=this.gl;let b=0;i&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){s.aE(i.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Zo(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var h;return Zo(this.gl)?this.gl.deleteVertexArray(i):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class yi{constructor(i,h,p){this.func=i,this.mask=h,this.range=p}}yi.ReadOnly=!1,yi.ReadWrite=!0,yi.disabled=new yi(519,yi.ReadOnly,[0,1]);const _l=7680;class Ji{constructor(i,h,p,m,b,I){this.test=i,this.ref=h,this.mask=p,this.fail=m,this.depthFail=b,this.pass=I}}Ji.disabled=new Ji({func:519,mask:0},0,0,_l,_l,_l);class Gi{constructor(i,h,p){this.enable=i,this.mode=h,this.frontFace=p}}let rs;function La(v,i,h,p,m){const b=v.context,I=b.gl,E=v.useProgram("collisionBox"),M=[];let D=0,O=0;for(let ke=0;ke<p.length;ke++){const Ce=p[ke],me=i.getTile(Ce).getBucket(h);if(!me)continue;const Re=m?me.textCollisionBox:me.iconCollisionBox,Be=me.collisionCircleArray;if(Be.length>0){const He=s.H();s.aQ(He,me.placementInvProjMatrix,v.transform.glCoordMatrix),s.aQ(He,He,me.placementViewportMatrix),M.push({circleArray:Be,circleOffset:O,transform:Ce.posMatrix,invTransform:He,coord:Ce}),D+=Be.length/4,O=D}Re&&E.draw(b,I.LINES,yi.disabled,Ji.disabled,v.colorModeForRenderPass(),Gi.disabled,{u_matrix:Ce.posMatrix,u_pixel_extrude_scale:[1/(N=v.transform).width,1/N.height]},v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ce),h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,v.transform.zoom,null,null,Re.collisionVertexBuffer)}var N;if(!m||!M.length)return;const Q=v.useProgram("collisionCircle"),se=new s.aR;se.resize(4*D),se._trim();let de=0;for(const ke of M)for(let Ce=0;Ce<ke.circleArray.length/4;Ce++){const me=4*Ce,Re=ke.circleArray[me+0],Be=ke.circleArray[me+1],He=ke.circleArray[me+2],ot=ke.circleArray[me+3];se.emplace(de++,Re,Be,He,ot,0),se.emplace(de++,Re,Be,He,ot,1),se.emplace(de++,Re,Be,He,ot,2),se.emplace(de++,Re,Be,He,ot,3)}(!rs||rs.length<2*D)&&(rs=function(ke){const Ce=2*ke,me=new s.aT;me.resize(Ce),me._trim();for(let Re=0;Re<Ce;Re++){const Be=6*Re;me.uint16[Be+0]=4*Re+0,me.uint16[Be+1]=4*Re+1,me.uint16[Be+2]=4*Re+2,me.uint16[Be+3]=4*Re+2,me.uint16[Be+4]=4*Re+3,me.uint16[Be+5]=4*Re+0}return me}(D));const ge=b.createIndexBuffer(rs,!0),xe=b.createVertexBuffer(se,s.aS.members,!0);for(const ke of M){const Ce=es(ke.transform,ke.invTransform,v.transform);Q.draw(b,I.TRIANGLES,yi.disabled,Ji.disabled,v.colorModeForRenderPass(),Gi.disabled,Ce,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ke.coord),h.id,xe,ge,s.a0.simpleSegment(0,2*ke.circleOffset,ke.circleArray.length,ke.circleArray.length/2),null,v.transform.zoom,null,null,null)}xe.destroy(),ge.destroy()}Gi.disabled=new Gi(!1,1029,2305),Gi.backCCW=new Gi(!0,1029,2305);const Ma=s.an(new Float32Array(16));function $c(v,i,h,p,m,b){const{horizontalAlign:I,verticalAlign:E}=s.au(v);return new s.P((-(I-.5)*i/m+p[0])*b,(-(E-.5)*h/m+p[1])*b)}function os(v,i,h,p,m,b){const I=i.tileAnchorPoint.add(new s.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let E=p.mult(b);h||(E=E.rotate(-m));const M=I.add(E);return ye(M.x,M.y,i.labelPlaneMatrix,i.getElevation).point}if(h){const E=Fe(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(v),M=Math.atan(E.y/E.x)+(E.x<0?Math.PI:0);return v.add(p.rotate(M))}return v.add(p)}function Ds(v,i,h,p,m,b,I,E,M,D,O,N,Q,se){const de=v.text.placedSymbolArray,ge=v.text.dynamicLayoutVertexArray,xe=v.icon.dynamicLayoutVertexArray,ke={};ge.clear();for(let Ce=0;Ce<de.length;Ce++){const me=de.get(Ce),Re=me.hidden||!me.crossTileID||v.allowVerticalPlacement&&!me.placedOrientation?null:p[me.crossTileID];if(Re){const Be=new s.P(me.anchorX,me.anchorY),He={getElevation:se,width:m.width,height:m.height,labelPlaneMatrix:b,lineVertexArray:null,pitchWithMap:h,projection:O,projectionCache:null,tileAnchorPoint:Be,translation:N,unwrappedTileID:Q},ot=h?ye(Be.x,Be.y,I,se):Fe(Be.x,Be.y,He),wt=q(m.cameraToCenterDistance,ot.signedDistanceFromCamera);let It=s.ai(v.textSizeData,M,me)*wt/s.ap;h&&(It*=v.tilePixelRatio/E);const{width:At,height:kt,anchor:xt,textOffset:Nt,textBoxScale:ri}=Re,St=$c(xt,At,kt,Nt,ri,It),Lt=O.getPitchedTextCorrection(m,Be.add(new s.P(N[0],N[1])),Q),ti=os(ot.point,He,i,St,m.angle,Lt),tn=v.allowVerticalPlacement&&me.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let fi=0;fi<me.numGlyphs;fi++)s.aj(ge,ti,tn);D&&me.associatedIconIndex>=0&&(ke[me.associatedIconIndex]={shiftedAnchor:ti,angle:tn})}else Et(me.numGlyphs,ge)}if(D){xe.clear();const Ce=v.icon.placedSymbolArray;for(let me=0;me<Ce.length;me++){const Re=Ce.get(me);if(Re.hidden)Et(Re.numGlyphs,xe);else{const Be=ke[me];if(Be)for(let He=0;He<Re.numGlyphs;He++)s.aj(xe,Be.shiftedAnchor,Be.angle);else Et(Re.numGlyphs,xe)}}v.icon.dynamicLayoutVertexBuffer.updateData(xe)}v.text.dynamicLayoutVertexBuffer.updateData(ge)}function Kr(v,i,h){return h.iconsInText&&i?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Uc(v,i,h,p,m,b,I,E,M,D,O,N){const Q=v.context,se=Q.gl,de=v.transform,ge=Yo(),xe=E==="map",ke=M==="map",Ce=E!=="viewport"&&h.layout.get("symbol-placement")!=="point",me=xe&&!ke&&!Ce,Re=!ke&&Ce,Be=!h.layout.get("symbol-sort-key").isConstant();let He=!1;const ot=v.depthModeForSublayer(0,yi.ReadOnly),wt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),It=[],At=ge.getCircleRadiusCorrection(de);for(const kt of p){const xt=i.getTile(kt),Nt=xt.getBucket(h);if(!Nt)continue;const ri=m?Nt.text:Nt.icon;if(!ri||!ri.segments.get().length||!ri.hasVisibleVertices)continue;const St=ri.programConfigurations.get(h.id),Lt=m||Nt.sdfIcons,ti=m?Nt.textSizeData:Nt.iconSizeData,tn=ke||de.pitch!==0,fi=v.useProgram(Kr(Lt,m,Nt),St),ki=s.ag(ti,de.zoom),nn=v.style.map.terrain&&v.style.map.terrain.getTerrainData(kt);let nr,co,rn,Sr,pr=[0,0],rr=null;if(m)co=xt.glyphAtlasTexture,rn=se.LINEAR,nr=xt.glyphAtlasTexture.size,Nt.iconsInText&&(pr=xt.imageAtlasTexture.size,rr=xt.imageAtlasTexture,Sr=tn||v.options.rotating||v.options.zooming||ti.kind==="composite"||ti.kind==="camera"?se.LINEAR:se.NEAREST);else{const Ii=h.layout.get("icon-size").constantOr(0)!==1||Nt.iconsNeedLinear;co=xt.imageAtlasTexture,rn=Lt||v.options.rotating||v.options.zooming||Ii||tn?se.LINEAR:se.NEAREST,nr=xt.imageAtlasTexture.size}const mr=xi(xt,1,v.transform.zoom),So=Re?kt.posMatrix:Ma,Ks=Hr(So,ke,xe,v.transform,mr),Rl=wr(So,ke,xe,v.transform,mr),Js=wr(kt.posMatrix,ke,xe,v.transform,mr),Qr=ge.translatePosition(v.transform,xt,b,I),Fl=wt&&Nt.hasTextData(),fu=h.layout.get("icon-text-fit")!=="none"&&Fl&&Nt.hasIconData();if(Ce){const Ii=v.style.map.terrain?(Ys,Qs)=>v.style.map.terrain.getElevation(kt,Ys,Qs):null,us=h.layout.get("text-rotation-alignment")==="map";re(Nt,kt.posMatrix,v,m,Ks,Js,ke,D,us,ge,kt.toUnwrapped(),de.width,de.height,Qr,Ii)}const eo=kt.posMatrix,to=m&&wt||fu,Go=Ce||to?Ma:Ks,uo=Rl,Jn=Lt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=Lt?Nt.iconsInText?Mc(ti.kind,ki,me,ke,Ce,to,v,eo,Go,uo,Qr,nr,pr,At):Ca(ti.kind,ki,me,ke,Ce,to,v,eo,Go,uo,Qr,m,nr,!0,At):_h(ti.kind,ki,me,ke,Ce,to,v,eo,Go,uo,Qr,m,nr,At);const Ur={program:fi,buffers:ri,uniformValues:or,atlasTexture:co,atlasTextureIcon:rr,atlasInterpolation:rn,atlasInterpolationIcon:Sr,isSDF:Lt,hasHalo:Jn};if(Be&&Nt.canOverlap){He=!0;const Ii=ri.segments.get();for(const us of Ii)It.push({segments:new s.a0([us]),sortKey:us.sortKey,state:Ur,terrainData:nn})}else It.push({segments:ri.segments,sortKey:0,state:Ur,terrainData:nn})}He&&It.sort((kt,xt)=>kt.sortKey-xt.sortKey);for(const kt of It){const xt=kt.state;if(Q.activeTexture.set(se.TEXTURE0),xt.atlasTexture.bind(xt.atlasInterpolation,se.CLAMP_TO_EDGE),xt.atlasTextureIcon&&(Q.activeTexture.set(se.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),xt.isSDF){const Nt=xt.uniformValues;xt.hasHalo&&(Nt.u_is_halo=1,Vc(xt.buffers,kt.segments,h,v,xt.program,ot,O,N,Nt,kt.terrainData)),Nt.u_is_halo=0}Vc(xt.buffers,kt.segments,h,v,xt.program,ot,O,N,xt.uniformValues,kt.terrainData)}}function Vc(v,i,h,p,m,b,I,E,M,D){const O=p.context;m.draw(O,O.gl.TRIANGLES,b,I,E,Gi.disabled,M,D,h.id,v.layoutVertexBuffer,v.indexBuffer,i,h.paint,p.transform.zoom,v.programConfigurations.get(h.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function qc(v,i,h,p){const m=v.context,b=m.gl,I=Ji.disabled,E=new Tn([b.ONE,b.ONE],s.aM.transparent,[!0,!0,!0,!0]),M=i.getBucket(h);if(!M)return;const D=p.key;let O=h.heatmapFbos.get(D);O||(O=Aa(m,i.tileSize,i.tileSize),h.heatmapFbos.set(D,O)),m.bindFramebuffer.set(O.framebuffer),m.viewport.set([0,0,i.tileSize,i.tileSize]),m.clear({color:s.aM.transparent});const N=M.programConfigurations.get(h.id),Q=v.useProgram("heatmap",N),se=v.style.map.terrain.getTerrainData(p);Q.draw(m,b.TRIANGLES,yi.disabled,I,E,Gi.disabled,kr(p.posMatrix,i,v.transform.zoom,h.paint.get("heatmap-intensity")),se,h.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,h.paint,v.transform.zoom,N)}function ss(v,i,h){const p=v.context,m=p.gl;p.setColorMode(v.colorModeForRenderPass());const b=Pa(p,i),I=h.key,E=i.heatmapFbos.get(I);E&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,E.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),b.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(p,m.TRIANGLES,yi.disabled,Ji.disabled,v.colorModeForRenderPass(),Gi.disabled,ll(v,i,0,1),null,i.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,i.paint,v.transform.zoom),E.destroy(),i.heatmapFbos.delete(I))}function Aa(v,i,h){var p,m;const b=v.gl,I=b.createTexture();b.bindTexture(b.TEXTURE_2D,I),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const E=(p=v.HALF_FLOAT)!==null&&p!==void 0?p:b.UNSIGNED_BYTE,M=(m=v.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,M,i,h,0,b.RGBA,E,null);const D=v.createFramebuffer(i,h,!1,!1);return D.colorAttachment.set(I),D}function Pa(v,i){return i.colorRampTexture||(i.colorRampTexture=new ce(v,i.colorRamp,v.gl.RGBA)),i.colorRampTexture}function Rs(v,i,h,p,m){if(!h||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let I=b[h.to.toString()],E=b[h.from.toString()];if(!I&&E&&(I=E),!E&&I&&(E=I),!I||!E){const M=m.getPaintProperty(i);I=b[M],E=b[M]}I&&E&&v.setConstantPatternPositions(I,E)}function za(v,i,h,p,m,b,I){const E=v.context.gl,M="fill-pattern",D=h.paint.get(M),O=D&&D.constantOr(1),N=h.getCrossfadeParameters();let Q,se,de,ge,xe;I?(se=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=E.LINES):(se=O?"fillPattern":"fill",Q=E.TRIANGLES);const ke=D.constantOr(null);for(const Ce of p){const me=i.getTile(Ce);if(O&&!me.patternsLoaded())continue;const Re=me.getBucket(h);if(!Re)continue;const Be=Re.programConfigurations.get(h.id),He=v.useProgram(se,Be),ot=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ce);O&&(v.context.activeTexture.set(E.TEXTURE0),me.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Be.updatePaintBuffers(N)),Rs(Be,M,ke,me,h);const wt=ot?Ce:null,It=v.translatePosMatrix(wt?wt.posMatrix:Ce.posMatrix,me,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){ge=Re.indexBuffer2,xe=Re.segments2;const At=[E.drawingBufferWidth,E.drawingBufferHeight];de=se==="fillOutlinePattern"&&O?dh(It,v,N,me,At):Zd(It,At)}else ge=Re.indexBuffer,xe=Re.segments,de=O?hh(It,v,N,me):As(It);He.draw(v.context,Q,m,v.stencilModeForClipping(Ce),b,Gi.disabled,de,ot,h.id,Re.layoutVertexBuffer,ge,xe,h.paint,v.transform.zoom,Be)}}function gl(v,i,h,p,m,b,I){const E=v.context,M=E.gl,D="fill-extrusion-pattern",O=h.paint.get(D),N=O.constantOr(1),Q=h.getCrossfadeParameters(),se=h.paint.get("fill-extrusion-opacity"),de=O.constantOr(null);for(const ge of p){const xe=i.getTile(ge),ke=xe.getBucket(h);if(!ke)continue;const Ce=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ge),me=ke.programConfigurations.get(h.id),Re=v.useProgram(N?"fillExtrusionPattern":"fillExtrusion",me);N&&(v.context.activeTexture.set(M.TEXTURE0),xe.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),me.updatePaintBuffers(Q)),Rs(me,D,de,xe,h);const Be=v.translatePosMatrix(ge.posMatrix,xe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),ot=N?al(Be,v,He,se,ge,Q,xe):Ta(Be,v,He,se);Re.draw(E,E.gl.TRIANGLES,m,b,I,Gi.backCCW,ot,Ce,h.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,h.paint,v.transform.zoom,me,v.style.map.terrain&&ke.centroidVertexBuffer)}}function Fs(v,i,h,p,m,b,I){const E=v.context,M=E.gl,D=h.fbo;if(!D)return;const O=v.useProgram("hillshade"),N=v.style.map.terrain&&v.style.map.terrain.getTerrainData(i);E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get()),O.draw(E,M.TRIANGLES,m,b,I,Gi.disabled,((Q,se,de,ge)=>{const xe=de.paint.get("hillshade-shadow-color"),ke=de.paint.get("hillshade-highlight-color"),Ce=de.paint.get("hillshade-accent-color");let me=de.paint.get("hillshade-illumination-direction")*(Math.PI/180);de.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=Q.transform.angle);const Re=!Q.options.moving;return{u_matrix:ge?ge.posMatrix:Q.transform.calculatePosMatrix(se.tileID.toUnwrapped(),Re),u_image:0,u_latrange:cl(0,se.tileID),u_light:[de.paint.get("hillshade-exaggeration"),me],u_shadow:xe,u_highlight:ke,u_accent:Ce}})(v,h,p,N?i:null),N,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function Bs(v,i,h,p,m,b){const I=v.context,E=I.gl,M=i.dem;if(M&&M.data){const D=M.dim,O=M.stride,N=M.getPixels();if(I.activeTexture.set(E.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||v.getTileTexture(O),i.demTexture){const se=i.demTexture;se.update(N,{premultiply:!1}),se.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else i.demTexture=new ce(I,N,E.RGBA,{premultiply:!1}),i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);I.activeTexture.set(E.TEXTURE0);let Q=i.fbo;if(!Q){const se=new ce(I,{width:D,height:D,data:null},E.RGBA);se.bind(E.LINEAR,E.CLAMP_TO_EDGE),Q=i.fbo=I.createFramebuffer(D,D,!0,!1),Q.colorAttachment.set(se.texture)}I.bindFramebuffer.set(Q.framebuffer),I.viewport.set([0,0,D,D]),v.useProgram("hillshadePrepare").draw(I,E.TRIANGLES,p,m,b,Gi.disabled,((se,de)=>{const ge=de.stride,xe=s.H();return s.aP(xe,0,s.X,-s.X,0,0,1),s.J(xe,xe,[0,-s.X,0]),{u_matrix:xe,u_image:1,u_dimension:[ge,ge],u_zoom:se.overscaledZ,u_unpack:de.getUnpackVector()}})(i.tileID,M),null,h.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Lh(v,i,h,p,m,b){const I=p.paint.get("raster-fade-duration");if(!b&&I>0){const E=S.now(),M=(E-v.timeAdded)/I,D=i?(E-i.timeAdded)/I:-1,O=h.getSource(),N=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),Q=!i||Math.abs(i.tileID.overscaledZ-N)>Math.abs(v.tileID.overscaledZ-N),se=Q&&v.refreshedUponExpiration?1:s.ac(Q?M:1-D,0,1);return v.refreshedUponExpiration&&M>=1&&(v.refreshedUponExpiration=!1),i?{opacity:1,mix:1-se}:{opacity:se,mix:0}}return{opacity:1,mix:0}}const Zc=new s.aM(1,0,0,1),Pi=new s.aM(0,1,0,1),yl=new s.aM(0,0,1,1),af=new s.aM(1,0,1,1),Mh=new s.aM(0,1,1,1);function Os(v,i,h,p){bl(v,0,i+h/2,v.transform.width,h,p)}function Ah(v,i,h,p){bl(v,i-h/2,0,h,v.transform.height,p)}function bl(v,i,h,p,m,b){const I=v.context,E=I.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*v.pixelRatio,h*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),I.clear({color:b}),E.disable(E.SCISSOR_TEST)}function Ph(v,i,h){const p=v.context,m=p.gl,b=h.posMatrix,I=v.useProgram("debug"),E=yi.disabled,M=Ji.disabled,D=v.colorModeForRenderPass(),O="$debug",N=v.style.map.terrain&&v.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const Q=i.getTileByID(h.key).latestRawTileData,se=Math.floor((Q&&Q.byteLength||0)/1024),de=i.getTile(h).tileSize,ge=512/Math.min(de,512)*(h.overscaledZ/v.transform.zoom)*.5;let xe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(xe+=` => ${h.overscaledZ}`),function(ke,Ce){ke.initDebugOverlayCanvas();const me=ke.debugOverlayCanvas,Re=ke.context.gl,Be=ke.debugOverlayCanvas.getContext("2d");Be.clearRect(0,0,me.width,me.height),Be.shadowColor="white",Be.shadowBlur=2,Be.lineWidth=1.5,Be.strokeStyle="white",Be.textBaseline="top",Be.font="bold 36px Open Sans, sans-serif",Be.fillText(Ce,5,5),Be.strokeText(Ce,5,5),ke.debugOverlayTexture.update(me),ke.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(v,`${xe} ${se}kB`),I.draw(p,m.TRIANGLES,E,M,Tn.alphaBlended,Gi.disabled,Ia(b,s.aM.transparent,ge),null,O,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),I.draw(p,m.LINE_STRIP,E,M,D,Gi.disabled,Ia(b,s.aM.red),N,O,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function zh(v,i,h){const p=v.context,m=p.gl,b=v.colorModeForRenderPass(),I=new yi(m.LEQUAL,yi.ReadWrite,v.depthRangeFor3D),E=v.useProgram("terrain"),M=i.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const D of h){const O=v.renderToTexture.getTexture(D),N=i.getTerrainData(D.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,O.texture);const Q=v.transform.calculatePosMatrix(D.tileID.toUnwrapped()),se=i.getMeshFrameDelta(v.transform.zoom),de=v.transform.calculateFogMatrix(D.tileID.toUnwrapped()),ge=Ec(Q,se,de,v.style.sky,v.transform.pitch);E.draw(p,m.TRIANGLES,I,Ji.disabled,b,Gi.backCCW,ge,N,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class vl{constructor(i,h,p){this.vertexBuffer=i,this.indexBuffer=h,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class wl{constructor(i,h){this.context=new sf(i),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Jt.maxUnderzooming+Jt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ic}resize(i,h,p){if(this.width=Math.floor(i*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const i=this.context,h=new s.aX;h.emplaceBack(0,0),h.emplaceBack(s.X,0),h.emplaceBack(0,s.X),h.emplaceBack(s.X,s.X),this.tileExtentBuffer=i.createVertexBuffer(h,Qo.members),this.tileExtentSegments=s.a0.simpleSegment(0,0,4,2);const p=new s.aX;p.emplaceBack(0,0),p.emplaceBack(s.X,0),p.emplaceBack(0,s.X),p.emplaceBack(s.X,s.X),this.debugBuffer=i.createVertexBuffer(p,Qo.members),this.debugSegments=s.a0.simpleSegment(0,0,4,5);const m=new s.$;m.emplaceBack(0,0,0,0),m.emplaceBack(s.X,0,s.X,0),m.emplaceBack(0,s.X,0,s.X),m.emplaceBack(s.X,s.X,s.X,s.X),this.rasterBoundsBuffer=i.createVertexBuffer(m,wi.members),this.rasterBoundsSegments=s.a0.simpleSegment(0,0,4,2);const b=new s.aX;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(b,Qo.members),this.viewportSegments=s.a0.simpleSegment(0,0,4,2);const I=new s.aZ;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(I);const E=new s.aY;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const M=this.context.gl;this.stencilClearMode=new Ji({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=s.H();s.aP(p,0,this.width,this.height,0,0,1),s.K(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,h.TRIANGLES,yi.disabled,this.stencilClearMode,Tn.disabled,Gi.disabled,xr(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,h){if(this.currentStencilSource===i.source||!i.isTileClipped()||!h||!h.length)return;this.currentStencilSource=i.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Tn.disabled),p.setDepthMode(yi.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const E=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);b.draw(p,m.TRIANGLES,yi.disabled,new Ji({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),Tn.disabled,Gi.disabled,xr(I.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new Ji({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){const h=this.context.gl;return new Ji({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(i){const h=this.context.gl,p=i.sort((I,E)=>E.overscaledZ-I.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const I={};for(let E=0;E<b;E++)I[E+m]=new Ji({func:h.GEQUAL,mask:255},E+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[I,p]}return[{[m]:Ji.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Tn([i.CONSTANT_COLOR,i.ONE],new s.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}depthModeForSublayer(i,h,p){if(!this.opaquePassEnabledForLayer())return yi.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new yi(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},I={},E={};for(const M in m){const D=m[M];D.used&&D.prepare(this.context),b[M]=D.getVisibleCoordinates(),I[M]=b[M].slice().reverse(),E[M]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<p.length;M++)if(this.style._layers[p[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of p){const D=this.style._layers[M];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const O=I[D.source];(D.type==="custom"||O.length)&&this.renderLayer(this,m[D.source],D,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?s.aM.black:s.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,D){const O=M.context,N=O.gl,Q=((ke,Ce,me)=>({u_sky_color:ke.properties.get("sky-color"),u_horizon_color:ke.properties.get("horizon-color"),u_horizon:(Ce.height/2+Ce.getHorizon())*me,u_sky_horizon_blend:ke.properties.get("sky-horizon-blend")*Ce.height/2*me}))(D,M.style.map.transform,M.pixelRatio),se=new yi(N.LEQUAL,yi.ReadWrite,[0,1]),de=Ji.disabled,ge=M.colorModeForRenderPass(),xe=M.useProgram("sky");if(!D.mesh){const ke=new s.aX;ke.emplaceBack(-1,-1),ke.emplaceBack(1,-1),ke.emplaceBack(1,1),ke.emplaceBack(-1,1);const Ce=new s.aY;Ce.emplaceBack(0,1,2),Ce.emplaceBack(0,2,3),D.mesh=new vl(O.createVertexBuffer(ke,Qo.members),O.createIndexBuffer(Ce),s.a0.simpleSegment(0,0,ke.length,Ce.length))}xe.draw(O,N.TRIANGLES,se,de,ge,Gi.disabled,Q,void 0,"sky",D.mesh.vertexBuffer,D.mesh.indexBuffer,D.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[p[this.currentLayer]],D=m[M.source],O=b[M.source];this._renderTileClippingMasks(M,O),this.renderLayer(this,D,M,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const M=this.style._layers[p[this.currentLayer]],D=m[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const O=(M.type==="symbol"?E:I)[M.source];this._renderTileClippingMasks(M,b[M.source]),this.renderLayer(this,D,M,O)}if(this.options.showTileBoundaries){const M=function(D,O){let N=null;const Q=Object.values(D._layers).flatMap(xe=>xe.source&&!xe.isHidden(O)?[D.sourceCaches[xe.source]]:[]),se=Q.filter(xe=>xe.getSource().type==="vector"),de=Q.filter(xe=>xe.getSource().type!=="vector"),ge=xe=>{(!N||N.getSource().maxzoom<xe.getSource().maxzoom)&&(N=xe)};return se.forEach(xe=>ge(xe)),N||de.forEach(xe=>ge(xe)),N}(this.style,this.transform.zoom);M&&function(D,O,N){for(let Q=0;Q<N.length;Q++)Ph(D,O,N[Q])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const D=M.transform.padding;Os(M,M.transform.height-(D.top||0),3,Zc),Os(M,D.bottom||0,3,Pi),Ah(M,D.left||0,3,yl),Ah(M,M.transform.width-(D.right||0),3,af);const O=M.transform.centerPoint;(function(N,Q,se,de){bl(N,Q-1,se-10,2,20,de),bl(N,Q-10,se-1,20,2,de)})(M,O.x,M.transform.height-O.y,Mh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=i?!s.a_(h,p):!s.a$(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(s.b0(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,I){const E=b.context,M=E.gl,D=Tn.unblended,O=new yi(M.LEQUAL,yi.ReadWrite,[0,1]),N=I.getTerrainMesh(),Q=I.sourceCache.getRenderableTiles(),se=b.useProgram("terrainDepth");E.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),E.clear({color:s.aM.transparent,depth:1});for(const de of Q){const ge=I.getTerrainData(de.tileID),xe={u_matrix:b.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(b.transform.zoom)};se.draw(E,M.TRIANGLES,O,Ji.disabled,D,Gi.backCCW,xe,ge,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,I){const E=b.context,M=E.gl,D=Tn.unblended,O=new yi(M.LEQUAL,yi.ReadWrite,[0,1]),N=I.getTerrainMesh(),Q=I.getCoordsTexture(),se=I.sourceCache.getRenderableTiles(),de=b.useProgram("terrainCoords");E.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),E.clear({color:s.aM.transparent,depth:1}),I.coordsIndex=[];for(const ge of se){const xe=I.getTerrainData(ge.tileID);E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,Q.texture);const ke={u_matrix:b.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(b.transform.zoom)};de.draw(E,M.TRIANGLES,O,Ji.disabled,D,Gi.backCCW,ke,xe,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),I.coordsIndex.push(ge.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(i,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,I,E,M,D){if(b.renderPass!=="translucent")return;const O=Ji.disabled,N=b.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Q,se,de,ge,xe,ke,Ce,me,Re){const Be=se.transform,He=Yo(),ot=xe==="map",wt=ke==="map";for(const It of Q){const At=ge.getTile(It),kt=At.getBucket(de);if(!kt||!kt.text||!kt.text.segments.get().length)continue;const xt=s.ag(kt.textSizeData,Be.zoom),Nt=xi(At,1,se.transform.zoom),ri=Hr(It.posMatrix,wt,ot,se.transform,Nt),St=de.layout.get("icon-text-fit")!=="none"&&kt.hasIconData();if(xt){const Lt=Math.pow(2,Be.zoom-At.tileID.overscaledZ),ti=se.style.map.terrain?(fi,ki)=>se.style.map.terrain.getElevation(It,fi,ki):null,tn=He.translatePosition(Be,At,Ce,me);Ds(kt,ot,wt,Re,Be,ri,It.posMatrix,Lt,xt,St,He,tn,It.toUnwrapped(),ti)}}}(M,b,E,I,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),D),E.paint.get("icon-opacity").constantOr(1)!==0&&Uc(b,I,E,M,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),O,N),E.paint.get("text-opacity").constantOr(1)!==0&&Uc(b,I,E,M,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),O,N),I.map.showCollisionBoxes&&(La(b,I,E,M,!0),La(b,I,E,M,!1))})(i,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,I,E,M){if(b.renderPass!=="translucent")return;const D=E.paint.get("circle-opacity"),O=E.paint.get("circle-stroke-width"),N=E.paint.get("circle-stroke-opacity"),Q=!E.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(O.constantOr(1)===0||N.constantOr(1)===0))return;const se=b.context,de=se.gl,ge=b.depthModeForSublayer(0,yi.ReadOnly),xe=Ji.disabled,ke=b.colorModeForRenderPass(),Ce=[];for(let me=0;me<M.length;me++){const Re=M[me],Be=I.getTile(Re),He=Be.getBucket(E);if(!He)continue;const ot=He.programConfigurations.get(E.id),wt=b.useProgram("circle",ot),It=He.layoutVertexBuffer,At=He.indexBuffer,kt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Re),xt={programConfiguration:ot,program:wt,layoutVertexBuffer:It,indexBuffer:At,uniformValues:Gd(b,Re,Be,E),terrainData:kt};if(Q){const Nt=He.segments.get();for(const ri of Nt)Ce.push({segments:new s.a0([ri]),sortKey:ri.sortKey,state:xt})}else Ce.push({segments:He.segments,sortKey:0,state:xt})}Q&&Ce.sort((me,Re)=>me.sortKey-Re.sortKey);for(const me of Ce){const{programConfiguration:Re,program:Be,layoutVertexBuffer:He,indexBuffer:ot,uniformValues:wt,terrainData:It}=me.state;Be.draw(se,de.TRIANGLES,ge,xe,ke,Gi.disabled,wt,It,E.id,He,ot,me.segments,E.paint,b.transform.zoom,Re)}})(i,h,p,m);break;case"heatmap":(function(b,I,E,M){if(E.paint.get("heatmap-opacity")===0)return;const D=b.context;if(b.style.map.terrain){for(const O of M){const N=I.getTile(O);I.hasRenderableParent(O)||(b.renderPass==="offscreen"?qc(b,N,E,O):b.renderPass==="translucent"&&ss(b,E,O))}D.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(O,N,Q,se){const de=O.context,ge=de.gl,xe=Ji.disabled,ke=new Tn([ge.ONE,ge.ONE],s.aM.transparent,[!0,!0,!0,!0]);(function(Ce,me,Re){const Be=Ce.gl;Ce.activeTexture.set(Be.TEXTURE1),Ce.viewport.set([0,0,me.width/4,me.height/4]);let He=Re.heatmapFbos.get(s.aU);He?(Be.bindTexture(Be.TEXTURE_2D,He.colorAttachment.get()),Ce.bindFramebuffer.set(He.framebuffer)):(He=Aa(Ce,me.width/4,me.height/4),Re.heatmapFbos.set(s.aU,He))})(de,O,Q),de.clear({color:s.aM.transparent});for(let Ce=0;Ce<se.length;Ce++){const me=se[Ce];if(N.hasRenderableParent(me))continue;const Re=N.getTile(me),Be=Re.getBucket(Q);if(!Be)continue;const He=Be.programConfigurations.get(Q.id),ot=O.useProgram("heatmap",He),{zoom:wt}=O.transform;ot.draw(de,ge.TRIANGLES,yi.disabled,xe,ke,Gi.disabled,kr(me.posMatrix,Re,wt,Q.paint.get("heatmap-intensity")),null,Q.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,Q.paint,O.transform.zoom,He)}de.viewport.set([0,0,O.width,O.height])}(b,I,E,M):b.renderPass==="translucent"&&function(O,N){const Q=O.context,se=Q.gl;Q.setColorMode(O.colorModeForRenderPass());const de=N.heatmapFbos.get(s.aU);de&&(Q.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,de.colorAttachment.get()),Q.activeTexture.set(se.TEXTURE1),Pa(Q,N).bind(se.LINEAR,se.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(Q,se.TRIANGLES,yi.disabled,Ji.disabled,O.colorModeForRenderPass(),Gi.disabled,ll(O,N,0,1),null,N.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,N.paint,O.transform.zoom))}(b,E)})(i,h,p,m);break;case"line":(function(b,I,E,M){if(b.renderPass!=="translucent")return;const D=E.paint.get("line-opacity"),O=E.paint.get("line-width");if(D.constantOr(1)===0||O.constantOr(1)===0)return;const N=b.depthModeForSublayer(0,yi.ReadOnly),Q=b.colorModeForRenderPass(),se=E.paint.get("line-dasharray"),de=E.paint.get("line-pattern"),ge=de.constantOr(1),xe=E.paint.get("line-gradient"),ke=E.getCrossfadeParameters(),Ce=ge?"linePattern":se?"lineSDF":xe?"lineGradient":"line",me=b.context,Re=me.gl;let Be=!0;for(const He of M){const ot=I.getTile(He);if(ge&&!ot.patternsLoaded())continue;const wt=ot.getBucket(E);if(!wt)continue;const It=wt.programConfigurations.get(E.id),At=b.context.program.get(),kt=b.useProgram(Ce,It),xt=Be||kt.program!==At,Nt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),ri=de.constantOr(null);if(ri&&ot.imageAtlas){const ti=ot.imageAtlas,tn=ti.patternPositions[ri.to.toString()],fi=ti.patternPositions[ri.from.toString()];tn&&fi&&It.setConstantPatternPositions(tn,fi)}const St=Nt?He:null,Lt=ge?Ps(b,ot,E,ke,St):se?Wd(b,ot,E,se,ke,St):xe?fh(b,ot,E,wt.lineClipsArray.length,St):ul(b,ot,E,St);if(ge)me.activeTexture.set(Re.TEXTURE0),ot.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),It.updatePaintBuffers(ke);else if(se&&(xt||b.lineAtlas.dirty))me.activeTexture.set(Re.TEXTURE0),b.lineAtlas.bind(me);else if(xe){const ti=wt.gradients[E.id];let tn=ti.texture;if(E.gradientVersion!==ti.version){let fi=256;if(E.stepInterpolant){const ki=I.getSource().maxzoom,nn=He.canonical.z===ki?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;fi=s.ac(s.aV(wt.maxLineLength/s.X*1024*nn),256,me.maxTextureSize)}ti.gradient=s.aW({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:ti.gradient||void 0,clips:wt.lineClipsArray}),ti.texture?ti.texture.update(ti.gradient):ti.texture=new ce(me,ti.gradient,Re.RGBA),ti.version=E.gradientVersion,tn=ti.texture}me.activeTexture.set(Re.TEXTURE0),tn.bind(E.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}kt.draw(me,Re.TRIANGLES,N,b.stencilModeForClipping(He),Q,Gi.disabled,Lt,Nt,E.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,E.paint,b.transform.zoom,It,wt.layoutVertexBuffer2),Be=!1}})(i,h,p,m);break;case"fill":(function(b,I,E,M){const D=E.paint.get("fill-color"),O=E.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const N=b.colorModeForRenderPass(),Q=E.paint.get("fill-pattern"),se=b.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&D.constantOr(s.aM.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===se){const de=b.depthModeForSublayer(1,b.renderPass==="opaque"?yi.ReadWrite:yi.ReadOnly);za(b,I,E,M,de,N,!1)}if(b.renderPass==="translucent"&&E.paint.get("fill-antialias")){const de=b.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,yi.ReadOnly);za(b,I,E,M,de,N,!0)}})(i,h,p,m);break;case"fill-extrusion":(function(b,I,E,M){const D=E.paint.get("fill-extrusion-opacity");if(D!==0&&b.renderPass==="translucent"){const O=new yi(b.context.gl.LEQUAL,yi.ReadWrite,b.depthRangeFor3D);if(D!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))gl(b,I,E,M,O,Ji.disabled,Tn.disabled),gl(b,I,E,M,O,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const N=b.colorModeForRenderPass();gl(b,I,E,M,O,Ji.disabled,N)}}})(i,h,p,m);break;case"hillshade":(function(b,I,E,M){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const D=b.context,O=b.depthModeForSublayer(0,yi.ReadOnly),N=b.colorModeForRenderPass(),[Q,se]=b.renderPass==="translucent"?b.stencilConfigForOverlap(M):[{},M];for(const de of se){const ge=I.getTile(de);ge.needsHillshadePrepare!==void 0&&ge.needsHillshadePrepare&&b.renderPass==="offscreen"?Bs(b,ge,E,O,Ji.disabled,N):b.renderPass==="translucent"&&Fs(b,de,ge,E,O,Q[de.overscaledZ],N)}D.viewport.set([0,0,b.width,b.height])})(i,h,p,m);break;case"raster":(function(b,I,E,M){if(b.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!M.length)return;const D=b.context,O=D.gl,N=I.getSource(),Q=b.useProgram("raster"),se=b.colorModeForRenderPass(),[de,ge]=N instanceof $i?[{},M]:b.stencilConfigForOverlap(M),xe=ge[ge.length-1].overscaledZ,ke=!b.options.moving;for(const Ce of ge){const me=b.depthModeForSublayer(Ce.overscaledZ-xe,E.paint.get("raster-opacity")===1?yi.ReadWrite:yi.ReadOnly,O.LESS),Re=I.getTile(Ce);Re.registerFadeDuration(E.paint.get("raster-fade-duration"));const Be=I.findLoadedParent(Ce,0),He=I.findLoadedSibling(Ce),ot=Lh(Re,Be||He||null,I,E,b.transform,b.style.map.terrain);let wt,It;const At=E.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;D.activeTexture.set(O.TEXTURE0),Re.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(O.TEXTURE1),Be?(Be.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),wt=Math.pow(2,Be.tileID.overscaledZ-Re.tileID.overscaledZ),It=[Re.tileID.canonical.x*wt%1,Re.tileID.canonical.y*wt%1]):Re.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),Re.texture.useMipmap&&D.extTextureFilterAnisotropic&&b.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const kt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ce),xt=kt?Ce:null,Nt=xt?xt.posMatrix:b.transform.calculatePosMatrix(Ce.toUnwrapped(),ke),ri=Hd(Nt,It||[0,0],wt||1,ot,E);N instanceof $i?Q.draw(D,O.TRIANGLES,me,Ji.disabled,se,Gi.disabled,ri,kt,E.id,N.boundsBuffer,b.quadTriangleIndexBuffer,N.boundsSegments):Q.draw(D,O.TRIANGLES,me,de[Ce.overscaledZ],se,Gi.disabled,ri,kt,E.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(i,h,p,m);break;case"background":(function(b,I,E,M){const D=E.paint.get("background-color"),O=E.paint.get("background-opacity");if(O===0)return;const N=b.context,Q=N.gl,se=b.transform,de=se.tileSize,ge=E.paint.get("background-pattern");if(b.isPatternMissing(ge))return;const xe=!ge&&D.a===1&&O===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==xe)return;const ke=Ji.disabled,Ce=b.depthModeForSublayer(0,xe==="opaque"?yi.ReadWrite:yi.ReadOnly),me=b.colorModeForRenderPass(),Re=b.useProgram(ge?"backgroundPattern":"background"),Be=M||se.coveringTiles({tileSize:de,terrain:b.style.map.terrain});ge&&(N.activeTexture.set(Q.TEXTURE0),b.imageManager.bind(b.context));const He=E.getCrossfadeParameters();for(const ot of Be){const wt=M?ot.posMatrix:b.transform.calculatePosMatrix(ot.toUnwrapped()),It=ge?Ac(wt,O,b,ge,{tileID:ot,tileSize:de},He):hl(wt,O,D),At=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ot);Re.draw(N,Q.TRIANGLES,Ce,ke,me,Gi.disabled,It,At,E.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(i,0,p,m);break;case"custom":(function(b,I,E){const M=b.context,D=E.implementation;if(b.renderPass==="offscreen"){const O=D.prerender;O&&(b.setCustomLayerDefaults(),M.setColorMode(b.colorModeForRenderPass()),O.call(D,M.gl,b.transform.customLayerMatrix()),M.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),M.setColorMode(b.colorModeForRenderPass()),M.setStencilMode(Ji.disabled);const O=D.renderingMode==="3d"?new yi(b.context.gl.LEQUAL,yi.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,yi.ReadOnly);M.setDepthMode(O),D.render(M.gl,b.transform.customLayerMatrix(),{farZ:b.transform.farZ,nearZ:b.transform.nearZ,fov:b.transform._fov,modelViewProjectionMatrix:b.transform.modelViewProjectionMatrix,projectionMatrix:b.transform.projectionMatrix}),M.setDirty(),b.setBaseState(),M.bindFramebuffer.set(null)}})(i,0,p)}}translatePosMatrix(i,h,p,m,b){if(!p[0]&&!p[1])return i;const I=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(I){const D=Math.sin(I),O=Math.cos(I);p=[p[0]*O-p[1]*D,p[0]*D+p[1]*O]}const E=[b?p[0]:xi(h,p[0],this.transform.zoom),b?p[1]:xi(h,p[1],this.transform.zoom),0],M=new Float32Array(16);return s.J(M,i,E),M}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),p=this.imageManager.getPattern(i.to.toString());return!h||!p}useProgram(i,h){this.cache=this.cache||{};const p=i+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Lc(this.context,qo[i],h,Pc[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:h}=this.context.gl;return this.width!==i||this.height!==h}}class Ns{constructor(i,h){this.points=i,this.planes=h}static fromInvProjectionMatrix(i,h,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const M=1/(E=s.af([],E,i))[3]/h*m;return s.b1(E,E,[M,M,1/E[3],M])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const M=function(Q,se){var de=se[0],ge=se[1],xe=se[2],ke=de*de+ge*ge+xe*xe;return ke>0&&(ke=1/Math.sqrt(ke)),Q[0]=se[0]*ke,Q[1]=se[1]*ke,Q[2]=se[2]*ke,Q}([],function(Q,se,de){var ge=se[0],xe=se[1],ke=se[2],Ce=de[0],me=de[1],Re=de[2];return Q[0]=xe*Re-ke*me,Q[1]=ke*Ce-ge*Re,Q[2]=ge*me-xe*Ce,Q}([],te([],b[E[0]],b[E[1]]),te([],b[E[2]],b[E[1]]))),D=-((O=M)[0]*(N=b[E[1]])[0]+O[1]*N[1]+O[2]*N[2]);var O,N;return M.concat(D)});return new Ns(b,I)}}class js{constructor(i,h){this.min=i,this.max=h,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(i){const h=[i%2==0,i<2],p=Se(this.min),m=Se(this.max);for(let b=0;b<h.length;b++)p[b]=h[b]?this.min[b]:this.center[b],m[b]=h[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new js(p,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<i.planes.length;m++){const b=i.planes[m];let I=0;for(let E=0;E<h.length;E++)s.b2(b,h[E])>=0&&I++;if(I===0)return 0;I!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let E=0;E<i.points.length;E++){const M=i.points[E][m]-this.min[m];b=Math.min(b,M),I=Math.max(I,M)}if(I<0||b>this.max[m]-this.min[m])return 0}return 1}}class $s{constructor(i=0,h=0,p=0,m=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=p,this.right=m}interpolate(i,h,p){return h.top!=null&&i.top!=null&&(this.top=s.y.number(i.top,h.top,p)),h.bottom!=null&&i.bottom!=null&&(this.bottom=s.y.number(i.bottom,h.bottom,p)),h.left!=null&&i.left!=null&&(this.left=s.y.number(i.left,h.left,p)),h.right!=null&&i.right!=null&&(this.right=s.y.number(i.right,h.right,p)),this}getCenter(i,h){const p=s.ac((this.left+i-this.right)/2,0,i),m=s.ac((this.top+h-this.bottom)/2,0,h);return new s.P(p,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new $s(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Gc=85.051129;class Us{constructor(i,h,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=i||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new $s,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new Us(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.lngRange=i.lngRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const h=-s.b3(i,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new s.A(4);return s.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var I=m[0],E=m[1],M=m[2],D=m[3],O=Math.sin(b),N=Math.cos(b);p[0]=I*N+M*O,p[1]=E*N+D*O,p[2]=I*-O+M*N,p[3]=E*-O+D*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const h=s.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const h=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,p){this._unmodified=!1,this._edgeInsets.interpolate(i,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const h=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(i){const h=[new s.b4(0,i)];if(this._renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),m=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),I=this.pointCoordinate(new s.P(0,this.height)),E=Math.floor(Math.min(p.x,m.x,b.x,I.x)),M=Math.floor(Math.max(p.x,m.x,b.x,I.x)),D=1;for(let O=E-D;O<=M+D;O++)O!==0&&h.push(new s.b4(O,i))}return h}coveringTiles(i){var h,p;let m=this.coveringZoomLevel(i);const b=m;if(i.minzoom!==void 0&&m<i.minzoom)return[];i.maxzoom!==void 0&&m>i.maxzoom&&(m=i.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),E=s.Z.fromLngLat(this.center),M=Math.pow(2,m),D=[M*I.x,M*I.y,0],O=[M*E.x,M*E.y,0],N=Ns.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let Q=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Q=m);const se=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,de=me=>({aabb:new js([me*M,0,0],[(me+1)*M,M,0]),zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),ge=[],xe=[],ke=m,Ce=i.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let me=1;me<=3;me++)ge.push(de(-me)),ge.push(de(me));for(ge.push(de(0));ge.length>0;){const me=ge.pop(),Re=me.x,Be=me.y;let He=me.fullyVisible;if(!He){const kt=me.aabb.intersects(N);if(kt===0)continue;He=kt===2}const ot=i.terrain?D:O,wt=me.aabb.distanceX(ot),It=me.aabb.distanceY(ot),At=Math.max(Math.abs(wt),Math.abs(It));if(me.zoom===ke||At>se+(1<<ke-me.zoom)-2&&me.zoom>=Q){const kt=ke-me.zoom,xt=D[0]-.5-(Re<<kt),Nt=D[1]-.5-(Be<<kt);xe.push({tileID:new s.S(me.zoom===ke?Ce:me.zoom,me.wrap,me.zoom,Re,Be),distanceSq:Y([O[0]-.5-Re,O[1]-.5-Be]),tileDistanceToCamera:Math.sqrt(xt*xt+Nt*Nt)})}else for(let kt=0;kt<4;kt++){const xt=(Re<<1)+kt%2,Nt=(Be<<1)+(kt>>1),ri=me.zoom+1;let St=me.aabb.quadrant(kt);if(i.terrain){const Lt=new s.S(ri,me.wrap,ri,xt,Nt),ti=i.terrain.getMinMaxElevation(Lt),tn=(h=ti.minElevation)!==null&&h!==void 0?h:this.elevation,fi=(p=ti.maxElevation)!==null&&p!==void 0?p:this.elevation;St=new js([St.min[0],St.min[1],tn],[St.max[0],St.max[1],fi])}ge.push({aabb:St,zoom:ri,x:xt,y:Nt,wrap:me.wrap,fullyVisible:He})}}return xe.sort((me,Re)=>me.distanceSq-Re.distanceSq).map(me=>me.tileID)}resize(i,h){this.width=i,this.height=h,this.pixelsToGLUnits=[2/i,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const h=s.ac(i.lat,-85.051129,Gc);return new s.P(s.O(i.lng)*this.worldSize,s.Q(h)*this.worldSize)}unproject(i){return new s.Z(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,i),b=i.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const I=p+h-b,E=Math.cos(this._pitch)*this.cameraToCenterDistance/I/s.b5(1,m.lat),M=this.scaleZoom(E/this.tileSize);this._elevation=b,this._center=m,this.zoom=M}setLocationAtPoint(i,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(i),I=new s.Z(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,h){return h?this.coordinatePoint(this.locationCoordinate(i),h.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,h){return this.coordinateLocation(this.pointCoordinate(i,h))}locationCoordinate(i){return s.Z.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,h){if(h){const Q=h.pointCoordinate(i);if(Q!=null)return Q}const p=[i.x,i.y,0,1],m=[i.x,i.y,1,1];s.af(p,p,this.pixelMatrixInverse),s.af(m,m,this.pixelMatrixInverse);const b=p[3],I=m[3],E=p[1]/b,M=m[1]/I,D=p[2]/b,O=m[2]/I,N=D===O?0:(0-D)/(O-D);return new s.Z(s.y.number(p[0]/b,m[0]/I,N)/this.worldSize,s.y.number(E,M,N)/this.worldSize)}coordinatePoint(i,h=0,p=this.pixelMatrix){const m=[i.x*this.worldSize,i.y*this.worldSize,h,1];return s.af(m,m,p),new s.P(m[0]/m[3],m[1]/m[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new Te().extend(this.pointLocation(new s.P(0,i))).extend(this.pointLocation(new s.P(this.width,i))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Gc])}calculateTileMatrix(i){const h=i.canonical,p=this.worldSize/this.zoomScale(h.z),m=h.x+Math.pow(2,h.z)*i.wrap,b=s.an(new Float64Array(16));return s.J(b,b,[m*p,h.y*p,0]),s.K(b,b,[p/s.X,p/s.X,1]),b}calculatePosMatrix(i,h=!1){const p=i.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=this.calculateTileMatrix(i);return s.L(b,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,b),m[p]=new Float32Array(b),m[p]}calculateFogMatrix(i){const h=i.key,p=this._fogMatrixCache;if(p[h])return p[h];const m=this.calculateTileMatrix(i);return s.L(m,this.fogMatrix,m),p[h]=new Float32Array(m),p[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,h){h=s.ac(+h,this.minZoom,this.maxZoom);const p={center:new s.N(i.lng,i.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const me=179.9999999999;m=[-me,me]}const b=this.tileSize*this.zoomScale(p.zoom);let I=0,E=b,M=0,D=b,O=0,N=0;const{x:Q,y:se}=this.size;if(this.latRange){const me=this.latRange;I=s.Q(me[1])*b,E=s.Q(me[0])*b,E-I<se&&(O=se/(E-I))}m&&(M=s.b3(s.O(m[0])*b,0,b),D=s.b3(s.O(m[1])*b,0,b),D<M&&(D+=b),D-M<Q&&(N=Q/(D-M)));const{x:de,y:ge}=this.project.call({worldSize:b},i);let xe,ke;const Ce=Math.max(N||0,O||0);if(Ce){const me=new s.P(N?(D+M)/2:de,O?(E+I)/2:ge);return p.center=this.unproject.call({worldSize:b},me).wrap(),p.zoom+=this.scaleZoom(Ce),p}if(this.latRange){const me=se/2;ge-me<I&&(ke=I+me),ge+me>E&&(ke=E-me)}if(m){const me=(M+D)/2;let Re=de;this._renderWorldCopies&&(Re=s.b3(de,me-b/2,me+b/2));const Be=Q/2;Re-Be<M&&(xe=M+Be),Re+Be>D&&(xe=D-Be)}if(xe!==void 0||ke!==void 0){const me=new s.P(xe??de,ke??ge);p.center=this.unproject.call({worldSize:b},me).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b5(1,this.center.lat)*this.worldSize;let m=s.an(new Float64Array(16));s.K(m,m,[this.width/2,-this.height/2,1]),s.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=s.an(new Float64Array(16)),s.K(m,m,[1,-1,1]),s.J(m,m,[-1,-1,0]),s.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this.minElevationForCurrentTile),E=b-I*this._pixelPerMeter/Math.cos(this._pitch),M=I<0?E:b,D=Math.PI/2+this._pitch,O=this._fov*(.5+i.y/this.height),N=Math.sin(O)*M/Math.sin(s.ac(Math.PI-D-O,.01,Math.PI-.01)),Q=this.getHorizon(),se=2*Math.atan(Q/this.cameraToCenterDistance)*(.5+i.y/(2*Q)),de=Math.sin(se)*M/Math.sin(s.ac(Math.PI-D-se,.01,Math.PI-.01)),ge=Math.min(N,de);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*ge+M),this.nearZ=this.height/50,m=new Float64Array(16),s.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-i.x/this.width,m[9]=2*i.y/this.height,this.projectionMatrix=s.ae(m),s.K(m,m,[1,-1,1]),s.J(m,m,[0,0,-this.cameraToCenterDistance]),s.b7(m,m,this._pitch),s.ad(m,m,this.angle),s.J(m,m,[-h,-p,0]),this.mercatorMatrix=s.K([],m,[this.worldSize,this.worldSize,this.worldSize]),s.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.L(new Float64Array(16),this.labelPlaneMatrix,m),s.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=s.as([],m),this.fogMatrix=new Float64Array(16),s.b6(this.fogMatrix,this._fov,this.width/this.height,b,this.farZ),this.fogMatrix[8]=2*-i.x/this.width,this.fogMatrix[9]=2*i.y/this.height,s.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),s.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),s.b7(this.fogMatrix,this.fogMatrix,this._pitch),s.ad(this.fogMatrix,this.fogMatrix,this.angle),s.J(this.fogMatrix,this.fogMatrix,[-h,-p,0]),s.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),s.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=s.L(new Float64Array(16),this.labelPlaneMatrix,m);const xe=this.width%2/2,ke=this.height%2/2,Ce=Math.cos(this.angle),me=Math.sin(this.angle),Re=h-Math.round(h)+Ce*xe+me*ke,Be=p-Math.round(p)+Ce*ke+me*xe,He=new Float64Array(m);if(s.J(He,He,[Re>.5?Re-1:Re,Be>.5?Be-1:Be,0]),this.alignedModelViewProjectionMatrix=He,m=s.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new s.P(0,0)),h=[i.x*this.worldSize,i.y*this.worldSize,0,1];return s.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,i))}getCameraQueryGeometry(i){const h=this.getCameraPoint();if(i.length===1)return[i[0],h];{let p=h.x,m=h.y,b=h.x,I=h.y;for(const E of i)p=Math.min(p,E.x),m=Math.min(m,E.y),b=Math.max(b,E.x),I=Math.max(I,E.y);return[new s.P(p,m),new s.P(b,m),new s.P(b,I),new s.P(p,I),new s.P(p,m)]}}lngLatToCameraDepth(i,h){const p=this.locationCoordinate(i),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return s.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function Da(v,i){let h,p=!1,m=null,b=null;const I=()=>{m=null,p&&(v.apply(b,h),m=setTimeout(I,i),p=!1)};return(...E)=>(p=!0,b=this,h=E,m||I(),m)}class xl{constructor(i){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const p=h.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let I=window.location.href.replace(/(#.+)?$/,b);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Da(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),I=Math.round(h.lng*b)/b,E=Math.round(h.lat*b)/b,M=this._map.getBearing(),D=this._map.getPitch();let O="";if(O+=i?`/${I}/${E}/${p}`:`${p}/${E}/${I}`,(M||D)&&(O+="/"+Math.round(10*M)/10),D&&(O+=`/${Math.round(D)}`),this._hashName){const N=this._hashName;let Q=!1;const se=window.location.hash.slice(1).split("&").map(de=>{const ge=de.split("=")[0];return ge===N?(Q=!0,`${ge}=${O}`):de}).filter(de=>de);return Q||se.push(`${N}=${O}`),`#${se.join("&")}`}return`#${O}`}}const kl={linearity:.3,easing:s.b8(0,0,.3,1)},Wc=s.e({deceleration:2500,maxSpeed:1400},kl),lf=s.e({deceleration:20,maxSpeed:1400},kl),Dh=s.e({deceleration:1e3,maxSpeed:360},kl),Sl=s.e({deceleration:1e3,maxSpeed:90},kl);class Hc{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=S.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const b=Fa(h.pan.mag(),p,s.e({},Wc,i||{}));m.offset=h.pan.mult(b.amount/h.pan.mag()),m.center=this._map.transform.center,Ra(m,b)}if(h.zoom){const b=Fa(h.zoom,p,lf);m.zoom=this._map.transform.zoom+b.amount,Ra(m,b)}if(h.bearing){const b=Fa(h.bearing,p,Dh);m.bearing=this._map.transform.bearing+s.ac(b.amount,-179,179),Ra(m,b)}if(h.pitch){const b=Fa(h.pitch,p,Sl);m.pitch=this._map.transform.pitch+b.amount,Ra(m,b)}if(m.zoom||m.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),s.e(m,{noMoveStart:!0})}}function Ra(v,i){(!v.duration||v.duration<i.duration)&&(v.duration=i.duration,v.easing=i.easing)}function Fa(v,i,h){const{maxSpeed:p,linearity:m,deceleration:b}=h,I=s.ac(v*m/(i/1e3),-p,p),E=Math.abs(I)/(b*m);return{easing:h.easing,duration:1e3*E,amount:I*(E/2)}}class ir extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p,m={}){const b=L.mousePos(h.getCanvas(),p),I=h.unproject(b);super(i,s.e({point:b,lngLat:I,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class as extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){const m=i==="touchend"?p.changedTouches:p.touches,b=L.touchPos(h.getCanvasContainer(),m),I=b.map(M=>h.unproject(M)),E=b.reduce((M,D,O,N)=>M.add(D.div(N.length)),new s.P(0,0));super(i,{points:b,point:E,lngLats:I,lngLat:h.unproject(E),originalEvent:p}),this._defaultPrevented=!1}}class Rh extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class Fh{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Rh(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new ir(i.type,this._map,i))}mouseup(i){this._map.fire(new ir(i.type,this._map,i))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new ir(i.type,this._map,i))}dblclick(i){return this._firePreventable(new ir(i.type,this._map,i))}mouseover(i){this._map.fire(new ir(i.type,this._map,i))}mouseout(i){this._map.fire(new ir(i.type,this._map,i))}touchstart(i){return this._firePreventable(new as(i.type,this._map,i))}touchmove(i){this._map.fire(new as(i.type,this._map,i))}touchend(i){this._map.fire(new as(i.type,this._map,i))}touchcancel(i){this._map.fire(new as(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class In{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new ir(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new ir(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ao{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(s.P.convert(i),this._map.terrain)}}class jr{constructor(i,h){this._map=i,this._tr=new ao(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&i.button===0&&(L.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const b=Math.min(m.x,p.x),I=Math.max(m.x,p.x),E=Math.min(m.y,p.y),M=Math.max(m.y,p.y);L.setTransform(this._box,`translate(${b}px,${E}px)`),this._box.style.width=I-b+"px",this._box.style.height=M-E+"px"}mouseupWindow(i,h){if(!this._active||i.button!==0)return;const p=this._startPos,m=h;if(this.reset(),L.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:i})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new s.k(i,{originalEvent:h}))}}function Ba(v,i){if(v.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${i.length}`);const h={};for(let p=0;p<v.length;p++)h[v[p].identifier]=i[p];return h}class Xc{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new s.P(0,0);for(const I of m)b._add(I);return b.div(m.length)}(h),this.touches=Ba(p,h)))}touchmove(i,h,p){if(this.aborted||!this.centroid)return;const m=Ba(p,h);for(const b in this.touches){const I=m[b];(!I||I.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(i,h,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Tl{constructor(i){this.singleTap=new Xc(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,h,p){this.singleTap.touchstart(i,h,p)}touchmove(i,h,p){this.singleTap.touchmove(i,h,p)}touchend(i,h,p){const m=this.singleTap.touchend(i,h,p);if(m){const b=i.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(m)<30;if(b&&I||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Vs{constructor(i){this._tr=new ao(i),this._zoomIn=new Tl({numTouches:1,numTaps:2}),this._zoomOut=new Tl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,p){this._zoomIn.touchstart(i,h,p),this._zoomOut.touchstart(i,h,p)}touchmove(i,h,p){this._zoomIn.touchmove(i,h,p),this._zoomOut.touchmove(i,h,p)}touchend(i,h,p){const m=this._zoomIn.touchend(i,h,p),b=this._zoomOut.touchend(i,h,p),I=this._tr;return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(m)},{originalEvent:i})}):b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(b)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ro{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const h=this._moveFunction(...i);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(i,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&L.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Kc={0:1,2:2};class Il{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const h=L.mouseButton(i);this._eventButton=h}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(h,p){const m=Kc[p];return h.buttons===void 0||(h.buttons&m)!==m}(i,this._eventButton)}isValidEndEvent(i){return L.mouseButton(i)===this._eventButton}}class Jc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const Cl=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=i=>{i.preventDefault()}},Yc=({enable:v,clickTolerance:i,bearingDegreesPerPixelMoved:h=.8})=>{const p=new Il({checkCorrectEvent:m=>L.mouseButton(m)===0&&m.ctrlKey||L.mouseButton(m)===2});return new Ro({clickTolerance:i,move:(m,b)=>({bearingDelta:(b.x-m.x)*h}),moveStateManager:p,enable:v,assignEvents:Cl})},Qc=({enable:v,clickTolerance:i,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new Il({checkCorrectEvent:m=>L.mouseButton(m)===0&&m.ctrlKey||L.mouseButton(m)===2});return new Ro({clickTolerance:i,move:(m,b)=>({pitchDelta:(b.y-m.y)*h}),moveStateManager:p,enable:v,assignEvents:Cl})};class ls{constructor(i,h){this._clickTolerance=i.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,h,p){return this._calculateTransform(i,h,p)}touchmove(i,h,p){if(this._active){if(!this._shouldBePrevented(p.length))return i.preventDefault(),this._calculateTransform(i,h,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,h,p){this._calculateTransform(i,h,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,p){p.length>0&&(this._active=!0);const m=Ba(p,h),b=new s.P(0,0),I=new s.P(0,0);let E=0;for(const D in m){const O=m[D],N=this._touches[D];N&&(b._add(O),I._add(O.sub(N)),E++,m[D]=O)}if(this._touches=m,this._shouldBePrevented(E)||!I.mag())return;const M=I.div(E);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(E),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class El{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,p){if(!this._firstTwoTouches)return;i.preventDefault();const[m,b]=this._firstTwoTouches,I=Oa(p,h,m),E=Oa(p,h,b);if(!I||!E)return;const M=this._aroundCenter?null:I.add(E).div(2);return this._move([I,E],M,i)}touchend(i,h,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,I=Oa(p,h,m),E=Oa(p,h,b);I&&E||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Oa(v,i,h){for(let p=0;p<v.length;p++)if(v[p].identifier===h)return i[p]}function eu(v,i){return Math.log(v/i)/Math.LN2}class tu extends El{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(eu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:eu(this._distance,p),pinchAround:h}}}function iu(v,i){return 180*v.angleWith(i)/Math.PI}class nu extends El{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h,p){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:iu(this._vector,m),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,p=iu(i,this._startVector);return Math.abs(p)<h}}function Ll(v){return Math.abs(v.y)>Math.abs(v.x)}class qs extends El{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,h,p){super.touchstart(i,h,p),this._currentTouchCount=p.length}_start(i){this._lastPoints=i,Ll(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=i[0].sub(this._lastPoints[0]),b=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(i,h,p){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,b=h.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const I=i.y>0==h.y>0;return Ll(i)&&Ll(h)&&I}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class Jr{constructor(i){this._tr=new ao(i);const h=Bh;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,p=0,m=0,b=0,I=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),I=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:E=>{const M=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:xo,zoom:h?Math.round(M.zoom)+h*(i.shiftKey?2:1):M.zoom,bearing:M.bearing+p*this._bearingStep,pitch:M.pitch+m*this._pitchStep,offset:[-b*this._panStep,-I*this._panStep],center:M.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xo(v){return v*(2-v)}const ru=4.000244140625;class lo{constructor(i,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=i,this._tr=new ao(i),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let h=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%ru==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=L.mousePos(this._map.getCanvas(),i),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?s.N.convert(this._aroundCenter?p.center:p.unproject(h)):s.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>ru?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&D!==0&&(D=1/D);const O=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(O*D))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,p=this._startZoom,m=this._easing;let b,I=!1;const E=S.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&E){const M=Math.min(E/200,1),D=m(M);b=s.y.number(p,h,D),M<1?this._frameId||(this._frameId=!0):I=!0}else b=h,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:b-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=s.b9;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),I=.27/Math.sqrt(b*b+1e-4)*.01,E=Math.sqrt(.0729-I*I);h=s.b8(I,E,.25,1)}return this._prevEase={start:S.now(),duration:i,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class cs{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cf{constructor(i){this._tr=new ao(i),this.reset()}reset(){this._active=!1}dblclick(i,h){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uf{constructor(){this._tap=new Tl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],b=i.timeStamp-this._tapTime<500,I=this._tapPoint.dist(m)<30;b&&I?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(i,h,p)}touchmove(i,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(i,h,p)}touchend(i,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(i,h,p);m&&(this._tapTime=i.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oh{constructor(i,h,p){this._el=i,this._mousePan=h,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nh{constructor(i,h,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ou{constructor(i,h,p,m){this._el=i,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Zs{constructor(i,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",i);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,h){this._enabled&&(this._map.fire(new s.k("cooperativegestureprevented",{gestureType:i,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Yr=v=>v.zoom||v.drag||v.pitch||v.rotate;class zt extends s.k{}function Ml(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class su{constructor(i,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=m.type==="renderFrame"?void 0:m,E={needsRenderFrame:!1},M={},D={},O=m.touches,N=O?this._getMapTouches(O):void 0,Q=N?L.touchPos(this._map.getCanvas(),N):L.mousePos(this._map.getCanvas(),m);for(const{handlerName:ge,handler:xe,allowed:ke}of this._handlers){if(!xe.isEnabled())continue;let Ce;this._blockedByActive(D,ke,ge)?xe.reset():xe[b||m.type]&&(Ce=xe[b||m.type](m,Q,N),this.mergeHandlerResult(E,M,Ce,ge,I),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()),(Ce||xe.isActive())&&(D[ge]=xe)}const se={};for(const ge in this._previousActiveHandlers)D[ge]||(se[ge]=I);this._previousActiveHandlers=D,(Object.keys(se).length||Ml(E))&&(this._changes.push([E,M,se]),this._triggerRenderFrame()),(Object.keys(D).length||Ml(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=E;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hc(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,I]of this._listeners)L.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[i,h,p]of this._listeners)L.removeEventListener(i,h,i===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Fh(h,i));const m=h.boxZoom=new jr(h,i);this._add("boxZoom",m),i.interactive&&i.boxZoom&&m.enable();const b=h.cooperativeGestures=new Zs(h,i.cooperativeGestures);this._add("cooperativeGestures",b),i.cooperativeGestures&&b.enable();const I=new Vs(h),E=new cf(h);h.doubleClickZoom=new cs(E,I),this._add("tapZoom",I),this._add("clickZoom",E),i.interactive&&i.doubleClickZoom&&h.doubleClickZoom.enable();const M=new uf;this._add("tapDragZoom",M);const D=h.touchPitch=new qs(h);this._add("touchPitch",D),i.interactive&&i.touchPitch&&h.touchPitch.enable(i.touchPitch);const O=Yc(i),N=Qc(i);h.dragRotate=new Nh(i,O,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]),i.interactive&&i.dragRotate&&h.dragRotate.enable();const Q=(({enable:Ce,clickTolerance:me})=>{const Re=new Il({checkCorrectEvent:Be=>L.mouseButton(Be)===0&&!Be.ctrlKey});return new Ro({clickTolerance:me,move:(Be,He)=>({around:He,panDelta:He.sub(Be)}),activateOnStart:!0,moveStateManager:Re,enable:Ce,assignEvents:Cl})})(i),se=new ls(i,h);h.dragPan=new Oh(p,Q,se),this._add("mousePan",Q),this._add("touchPan",se,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&h.dragPan.enable(i.dragPan);const de=new nu,ge=new tu;h.touchZoomRotate=new ou(p,ge,de,M),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",ge,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&h.touchZoomRotate.enable(i.touchZoomRotate);const xe=h.scrollZoom=new lo(h,()=>this._triggerRenderFrame());this._add("scrollZoom",xe,["mousePan"]),i.interactive&&i.scrollZoom&&h.scrollZoom.enable(i.scrollZoom);const ke=h.keyboard=new Jr(h);this._add("keyboard",ke),i.interactive&&i.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new In(h))}_add(i,h,p){this._handlers.push({handlerName:i,handler:h,allowed:p}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yr(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,p){for(const m in i)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(i){const h=[];for(const p of i)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(i,h,p,m,b){if(!p)return;s.e(i,p);const I={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(h.zoom=I),p.panDelta!==void 0&&(h.drag=I),p.pitchDelta!==void 0&&(h.pitch=I),p.bearingDelta!==void 0&&(h.rotate=I)}_applyChanges(){const i={},h={},p={};for(const[m,b,I]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new s.P(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(i.around=m.around),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),s.e(h,b),s.e(p,I);this._updateMapTransform(i,h,p),this._changes=[]}_updateMapTransform(i,h,p){const m=this._map,b=m._getTransformForUpdate(),I=m.terrain;if(!(Ml(i)||I&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:E,zoomDelta:M,bearingDelta:D,pitchDelta:O,around:N,pinchAround:Q}=i;Q!==void 0&&(N=Q),m._stop(!0),N=N||m.transform.centerPoint;const se=b.pointLocation(E?N.sub(E):N);D&&(b.bearing+=D),O&&(b.pitch+=O),M&&(b.zoom+=M),I?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(E)):b.setLocationAtPoint(se,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(se,N)):b.setLocationAtPoint(se,N),m._applyUpdatedTransform(b),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,p,!0)}_fireEvents(i,h,p){const m=Yr(this._eventsInProgress),b=Yr(i),I={};for(const N in i){const{originalEvent:Q}=i[N];this._eventsInProgress[N]||(I[`${N}start`]=Q),this._eventsInProgress[N]=i[N]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const N in I)this._fireEvent(N,I[N]);b&&this._fireEvent("move",b.originalEvent);for(const N in i){const{originalEvent:Q}=i[N];this._fireEvent(N,Q)}const E={};let M;for(const N in this._eventsInProgress){const{handlerName:Q,originalEvent:se}=this._eventsInProgress[N];this._handlersById[Q].isActive()||(delete this._eventsInProgress[N],M=h[Q]||se,E[`${N}end`]=M)}for(const N in E)this._fireEvent(N,E[N]);const D=Yr(this._eventsInProgress),O=(m||b)&&!D;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();N.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(N)}if(p&&O){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;!N||!N.essential&&S.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:M})),Q(this._map.getBearing())&&this._map.resetNorth()):(Q(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new s.k(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new zt("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class jh extends s.E{constructor(i,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.N(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}panBy(i,h,p){return i=s.P.convert(i).mult(-1),this.panTo(this.transform.center,s.e({offset:i},h),p)}panTo(i,h,p){return this.easeTo(s.e({center:i},h),p)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,p){return this.easeTo(s.e({zoom:i},h),p)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,p){return this.easeTo(s.e({bearing:i},h),p)}resetNorth(i,h){return this.rotateTo(0,s.e({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}cameraForBounds(i,h){i=Te.convert(i).adjustAntiMeridian();const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,h)}_cameraForBoxAndBearing(i,h,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=s.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const kt=m.padding;m.padding={top:kt,bottom:kt,right:kt,left:kt}}m.padding=s.e(b,m.padding);const I=this.transform,E=I.padding,M=new Te(i,h),D=I.project(M.getNorthWest()),O=I.project(M.getNorthEast()),N=I.project(M.getSouthEast()),Q=I.project(M.getSouthWest()),se=s.ba(-p),de=D.rotate(se),ge=O.rotate(se),xe=N.rotate(se),ke=Q.rotate(se),Ce=new s.P(Math.max(de.x,ge.x,ke.x,xe.x),Math.max(de.y,ge.y,ke.y,xe.y)),me=new s.P(Math.min(de.x,ge.x,ke.x,xe.x),Math.min(de.y,ge.y,ke.y,xe.y)),Re=Ce.sub(me),Be=(I.width-(E.left+E.right+m.padding.left+m.padding.right))/Re.x,He=(I.height-(E.top+E.bottom+m.padding.top+m.padding.bottom))/Re.y;if(He<0||Be<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(I.scaleZoom(I.scale*Math.min(Be,He)),m.maxZoom),wt=s.P.convert(m.offset),It=new s.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(s.ba(p)),At=wt.add(It).mult(I.scale/I.zoomScale(ot));return{center:I.unproject(D.add(N).div(2).sub(At)),zoom:ot,bearing:p}}fitBounds(i,h,p){return this._fitInternal(this.cameraForBounds(i,h),h,p)}fitScreenCoordinates(i,h,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(i)),this.transform.pointLocation(s.P.convert(h)),p,m),m,b)}_fitInternal(i,h,p){return i?(delete(h=s.e(i,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(i,h){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,I=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(m=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=s.N.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(b=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(I=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),this._applyUpdatedTransform(p),this.fire(new s.k("movestart",h)).fire(new s.k("move",h)),m&&this.fire(new s.k("zoomstart",h)).fire(new s.k("zoom",h)).fire(new s.k("zoomend",h)),b&&this.fire(new s.k("rotatestart",h)).fire(new s.k("rotate",h)).fire(new s.k("rotateend",h)),I&&this.fire(new s.k("pitchstart",h)).fire(new s.k("pitch",h)).fire(new s.k("pitchend",h)),this.fire(new s.k("moveend",h))}calculateCameraOptionsFromTo(i,h,p,m=0){const b=s.Z.fromLngLat(i,h),I=s.Z.fromLngLat(p,m),E=I.x-b.x,M=I.y-b.y,D=I.z-b.z,O=Math.hypot(E,M,D);if(O===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(E,M),Q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/O/this.transform.tileSize),se=180*Math.atan2(E,-M)/Math.PI;let de=180*Math.acos(N/O)/Math.PI;return de=D<0?90-de:90+de,{center:I.toLngLat(),zoom:Q,pitch:de,bearing:se}}easeTo(i,h){var p;this._stop(!1,i.easeId),((i=s.e({offset:[0,0],duration:500,easing:s.b9},i)).animate===!1||!i.essential&&S.prefersReducedMotion)&&(i.duration=0);const m=this._getTransformForUpdate(),b=m.zoom,I=m.bearing,E=m.pitch,M=m.padding,D="bearing"in i?this._normalizeBearing(i.bearing,I):I,O="pitch"in i?+i.pitch:E,N="padding"in i?i.padding:m.padding,Q=s.P.convert(i.offset);let se=m.centerPoint.add(Q);const de=m.pointLocation(se),{center:ge,zoom:xe}=m.getConstrained(s.N.convert(i.center||de),(p=i.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(ge,m);const ke=m.project(de),Ce=m.project(ge).sub(ke),me=m.zoomScale(xe-b);let Re,Be;i.around&&(Re=s.N.convert(i.around),Be=m.locationPoint(Re));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||xe!==b,this._rotating=this._rotating||I!==D,this._pitching=this._pitching||O!==E,this._padding=!m.isPaddingEqual(N),this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,He),this.terrain&&this._prepareElevation(ge),this._ease(ot=>{if(this._zooming&&(m.zoom=s.y.number(b,xe,ot)),this._rotating&&(m.bearing=s.y.number(I,D,ot)),this._pitching&&(m.pitch=s.y.number(E,O,ot)),this._padding&&(m.interpolatePadding(M,N,ot),se=m.centerPoint.add(Q)),this.terrain&&!i.freezeElevation&&this._updateElevation(ot),Re)m.setLocationAtPoint(Re,Be);else{const wt=m.zoomScale(m.zoom-b),It=xe>b?Math.min(2,me):Math.max(.5,me),At=Math.pow(It,1-ot),kt=m.unproject(ke.add(Ce.mult(ot*At)).mult(wt));m.setLocationAtPoint(m.renderWorldCopies?kt.wrap():kt,se)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},ot=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h,ot)},i),this}_prepareEase(i,h,p={}){this._moving=!0,h||p.moving||this.fire(new s.k("movestart",i)),this._zooming&&!p.zooming&&this.fire(new s.k("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new s.k("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new s.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(p-(h-(p*i+this._elevationStart))/(1-i)),this._elevationTarget=h}this.transform.elevation=s.y.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){const h=i.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(h.lngLat,i.zoom);if(h.altitude<p){const m=this.calculateCameraOptionsFromTo(h.lngLat,p,i.center,i.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(i){const h=[];if(this.terrain&&h.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&h.push(m=>this.transformCameraUpdate(m)),!h.length)return;const p=i.clone();for(const m of h){const b=p.clone(),{center:I,zoom:E,pitch:M,bearing:D,elevation:O}=m(b);I&&(b.center=I),E!==void 0&&(b.zoom=E),M!==void 0&&(b.pitch=M),D!==void 0&&(b.bearing=D),O!==void 0&&(b.elevation=O),p.apply(b)}this.transform.apply(p)}_fireMoveEvents(i){this.fire(new s.k("move",i)),this._zooming&&this.fire(new s.k("zoom",i)),this._rotating&&this.fire(new s.k("rotate",i)),this._pitching&&this.fire(new s.k("pitch",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.k("zoomend",i)),m&&this.fire(new s.k("rotateend",i)),b&&this.fire(new s.k("pitchend",i)),this.fire(new s.k("moveend",i))}flyTo(i,h){var p;if(!i.essential&&S.prefersReducedMotion){const Lt=s.M(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,h)}this.stop(),i=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b9},i);const m=this._getTransformForUpdate(),b=m.zoom,I=m.bearing,E=m.pitch,M=m.padding,D="bearing"in i?this._normalizeBearing(i.bearing,I):I,O="pitch"in i?+i.pitch:E,N="padding"in i?i.padding:m.padding,Q=s.P.convert(i.offset);let se=m.centerPoint.add(Q);const de=m.pointLocation(se),{center:ge,zoom:xe}=m.getConstrained(s.N.convert(i.center||de),(p=i.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(ge,m);const ke=m.zoomScale(xe-b),Ce=m.project(de),me=m.project(ge).sub(Ce);let Re=i.curve;const Be=Math.max(m.width,m.height),He=Be/ke,ot=me.mag();if("minZoom"in i){const Lt=s.ac(Math.min(i.minZoom,b,xe),m.minZoom,m.maxZoom),ti=Be/m.zoomScale(Lt-b);Re=Math.sqrt(ti/ot*2)}const wt=Re*Re;function It(Lt){const ti=(He*He-Be*Be+(Lt?-1:1)*wt*wt*ot*ot)/(2*(Lt?He:Be)*wt*ot);return Math.log(Math.sqrt(ti*ti+1)-ti)}function At(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function kt(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const xt=It(!1);let Nt=function(Lt){return kt(xt)/kt(xt+Re*Lt)},ri=function(Lt){return Be*((kt(xt)*(At(ti=xt+Re*Lt)/kt(ti))-At(xt))/wt)/ot;var ti},St=(It(!0)-xt)/Re;if(Math.abs(ot)<1e-6||!isFinite(St)){if(Math.abs(Be-He)<1e-6)return this.easeTo(i,h);const Lt=He<Be?-1:1;St=Math.abs(Math.log(He/Be))/Re,ri=()=>0,Nt=ti=>Math.exp(Lt*Re*ti)}return i.duration="duration"in i?+i.duration:1e3*St/("screenSpeed"in i?+i.screenSpeed/Re:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=I!==D,this._pitching=O!==E,this._padding=!m.isPaddingEqual(N),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ge),this._ease(Lt=>{const ti=Lt*St,tn=1/Nt(ti);m.zoom=Lt===1?xe:b+m.scaleZoom(tn),this._rotating&&(m.bearing=s.y.number(I,D,Lt)),this._pitching&&(m.pitch=s.y.number(E,O,Lt)),this._padding&&(m.interpolatePadding(M,N,Lt),se=m.centerPoint.add(Q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Lt);const fi=Lt===1?ge:m.unproject(Ce.add(me.mult(ri(ti))).mult(tn));m.setLocationAtPoint(m.renderWorldCopies?fi.wrap():fi,se),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,h)}return i||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(i,h,p){p.animate===!1||p.duration===0?(i(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,h){i=s.b3(i,-180,180);const p=Math.abs(i-h);return Math.abs(i-360-h)<p&&(i-=360),Math.abs(i+360-h)<p&&(i+=360),i}_normalizeCenter(i,h){if(!h.renderWorldCopies||h.lngRange)return;const p=i.lng-h.center.lng;i.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(s.N.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const Gs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ws{constructor(i=Gs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const p=this._map._getUIString(`AttributionControl.${h}`);i.title=p,i.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const b=h[m];if(b.used||b.usedForTerrain){const I=b.getSource();I.attribution&&i.indexOf(I.attribution)<0&&i.push(I.attribution)}}i=i.filter(m=>String(m).trim()),i.sort((m,b)=>m.length-b.length),i=i.filter((m,b)=>{for(let I=b+1;I<i.length;I++)if(i[I].indexOf(m)>=0)return!1;return!0});const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class au{constructor(i={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const h=L.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ti{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===i)return void(m.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var lu=s.Y([{name:"a_pos3d",type:"Int16",components:3}]);class hf extends s.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,h){this.sourceCache.update(i,h),this._renderableTilesKeys=[];const p={};for(const m of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),s.aP(m.posMatrix,0,s.X,0,s.X,0,1),this._tiles[m.key]=new Wr(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(i){for(const h in this._tiles){const p=this._tiles[h];(!i||p.tileID.equals(i)||p.tileID.isChildOf(i)||i.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(i.canonical)){const b=i.clone();b.posMatrix=new Float64Array(16),s.aP(b.posMatrix,0,s.X,0,s.X,0,1),h[p]=b}else if(m.canonical.isChildOf(i.canonical)){const b=i.clone();b.posMatrix=new Float64Array(16);const I=m.canonical.z-i.canonical.z,E=m.canonical.x-(m.canonical.x>>I<<I),M=m.canonical.y-(m.canonical.y>>I<<I),D=s.X>>I;s.aP(b.posMatrix,0,D,0,D,0,1),s.J(b.posMatrix,b.posMatrix,[-E*D,-M*D,0]),h[p]=b}else if(i.canonical.isChildOf(m.canonical)){const b=i.clone();b.posMatrix=new Float64Array(16);const I=i.canonical.z-m.canonical.z,E=i.canonical.x-(i.canonical.x>>I<<I),M=i.canonical.y-(i.canonical.y>>I<<I),D=s.X>>I;s.aP(b.posMatrix,0,s.X,0,s.X,0,1),s.J(b.posMatrix,b.posMatrix,[E*D,M*D,0]),s.K(b.posMatrix,b.posMatrix,[1/2**I,1/2**I,0]),h[p]=b}}return h}getSourceTile(i,h){const p=this.sourceCache._source;let m=i.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!b||!b.dem)&&h)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(i.scaledTo(m--).key);return b}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=i)}}class cu{constructor(i,h,p){this.painter=i,this.sourceCache=new hf(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,h,p,m=s.X){var b;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const I=this.getTerrainData(i),E=(b=I.tile)===null||b===void 0?void 0:b.dem;if(!E)return 0;const M=function(de,ge,xe){var ke=ge[0],Ce=ge[1];return de[0]=xe[0]*ke+xe[4]*Ce+xe[12],de[1]=xe[1]*ke+xe[5]*Ce+xe[13],de}([],[h/m*s.X,p/m*s.X],I.u_terrain_matrix),D=[M[0]*E.dim,M[1]*E.dim],O=Math.floor(D[0]),N=Math.floor(D[1]),Q=D[0]-O,se=D[1]-N;return E.get(O,N)*(1-Q)*(1-se)+E.get(O+1,N)*Q*(1-se)+E.get(O,N+1)*(1-Q)*se+E.get(O+1,N+1)*Q*se}getElevationForLngLatZoom(i,h){if(!s.bb(h,i.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(i,h);return this.getElevation(p,m%s.X,b%s.X,s.X)}getElevation(i,h,p,m=s.X){return this.getDEMElevation(i,h,p,m)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const m=this.painter.context,b=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ce(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ce(m,new s.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const h=this.sourceCache.getSourceTile(i,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ce(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+i.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=i.canonical.z-h.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=m?b=i.canonical.z-m:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=i.canonical.x-(i.canonical.x>>b<<b),E=i.canonical.y-(i.canonical.y>>b<<b),M=s.bc(new Float64Array(16),[1/(s.X<<b),1/(s.X<<b),0]);s.J(M,M,[I*s.X,E*s.X,0]),this._demMatrixCache[i.key]={matrix:M,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(i){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ce(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ce(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,I=0;b<this._coordsTextureSize;b++)for(let E=0;E<this._coordsTextureSize;E++,I+=4)h[I+0]=255&E,h[I+1]=255&b,h[I+2]=E>>8<<4|b>>8,h[I+3]=0;const p=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new ce(i,p,i.gl.RGBA,{premultiply:!1});return m.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,E-I-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const M=h[0]+(h[2]>>4<<8),D=h[1]+((15&h[2])<<8),O=this.coordsIndex[255-h[3]],N=O&&this.sourceCache.getTileByID(O);if(!N)return null;const Q=this._coordsTextureSize,se=(1<<N.tileID.canonical.z)*Q;return new s.Z((N.tileID.canonical.x*Q+M)/se+N.tileID.wrap,(N.tileID.canonical.y*Q+D)/se,this.getElevation(N.tileID,M,D,Q))}depthAtPoint(i){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,h=new s.bd,p=new s.aY,m=this.meshSize,b=s.X/m,I=m*m;for(let N=0;N<=m;N++)for(let Q=0;Q<=m;Q++)h.emplaceBack(Q*b,N*b,0);for(let N=0;N<I;N+=m+1)for(let Q=0;Q<m;Q++)p.emplaceBack(Q+N,m+Q+N+1,m+Q+N+2),p.emplaceBack(Q+N,m+Q+N+2,Q+N+1);const E=h.length,M=E+2*(m+1);for(const N of[0,1])for(let Q=0;Q<=m;Q++)for(const se of[0,1])h.emplaceBack(Q*b,N*s.X,se);for(let N=0;N<2*m;N+=2)p.emplaceBack(M+N,M+N+1,M+N+3),p.emplaceBack(M+N,M+N+3,M+N+2),p.emplaceBack(E+N,E+N+3,E+N+1),p.emplaceBack(E+N,E+N+2,E+N+3);const D=h.length,O=D+2*(m+1);for(const N of[0,1])for(let Q=0;Q<=m;Q++)for(const se of[0,1])h.emplaceBack(N*s.X,Q*b,se);for(let N=0;N<2*m;N+=2)p.emplaceBack(D+N,D+N+1,D+N+3),p.emplaceBack(D+N,D+N+3,D+N+2),p.emplaceBack(O+N,O+N+3,O+N+1),p.emplaceBack(O+N,O+N+2,O+N+3);return this._mesh=new vl(i.createVertexBuffer(h,lu.members),i.createIndexBuffer(p),s.a0.simpleSegment(0,0,h.length,p.length)),this._mesh}getMeshFrameDelta(i){return 2*Math.PI*s.be/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(i,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(i){const h=this.getTerrainData(i).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(i,h){const p=s.Z.fromLngLat(i.wrap()),m=(1<<h)*s.X,b=p.x*m,I=p.y*m,E=Math.floor(b/s.X),M=Math.floor(I/s.X);return{tileID:new s.S(h,0,h,E,M),mercatorX:b,mercatorY:I}}}class df{constructor(i,h,p){this._context=i,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ce(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:i,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>i.id!==h),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Hs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class $h{constructor(i,h){this.painter=i,this.terrain=h,this.pool=new df(i.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(p=>!i._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in i.sourceCaches){this._coordsDescendingInv[p]={};const m=i.sourceCaches[p].getVisibleCoordinates();for(const b of m){const I=this.terrain.sourceCache.getTerrainCoords(b);for(const E in I)this._coordsDescendingInv[p][E]||(this._coordsDescendingInv[p][E]=[]),this._coordsDescendingInv[p][E].push(I[E])}}this._coordsDescendingInvStr={};for(const p of i._order){const m=i._layers[p],b=m.source;if(Hs[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const I in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][I]=this._coordsDescendingInv[b][I].map(E=>E.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const h=i.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Hs[h]&&(this._prevType&&Hs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(i.id),!m))return!0;if(Hs[this._prevType]||Hs[h]&&m){this._prevType=h;const b=this._stacks.length-1,I=this._stacks[b]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(zh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[b]){const D=this.pool.getObjectForId(E.rtt[b].id);if(D.stamp===E.rtt[b].stamp){this.pool.useObject(D);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),E.rtt[b]={id:M.id,stamp:M.stamp},p.context.bindFramebuffer.set(M.fbo.framebuffer),p.context.clear({color:s.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let D=0;D<I.length;D++){const O=p.style._layers[I[D]],N=O.source?this._coordsDescendingInv[O.source][E.tileID.key]:[E.tileID];p.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),p._renderTileClippingMasks(O,N),p.renderLayer(p,p.style.sourceCaches[O.source],O,N),O.source&&(E.rttCoords[O.source]=this._coordsDescendingInvStr[O.source][E.tileID.key])}}return zh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Hs[h]}return!1}}const uu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Uh=g,ff={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Gs,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},hu=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},pf={showCompass:!0,showZoom:!0,visualizePitch:!1};class mf{constructor(i,h,p=!1){this.mousedown=I=>{this.startMouse(s.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),L.mousePos(this.element,I)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,L.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=i.dragRotate._mouseRotate.getClickTolerance(),b=i.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Yc({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:E,bearingDegreesPerPixelMoved:M=.8})=>{const D=new Jc;return new Ro({clickTolerance:E,move:(O,N)=>({bearingDelta:(N.x-O.x)*M}),moveStateManager:D,enable:I,assignEvents:hu})})({clickTolerance:m,enable:!0}),this.map=i,p&&(this.mousePitch=Qc({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:E,pitchDegreesPerPixelMoved:M=-.5})=>{const D=new Jc;return new Ro({clickTolerance:E,move:(O,N)=>({pitchDelta:(N.y-O.y)*M}),moveStateManager:D,enable:I,assignEvents:hu})})({clickTolerance:b,enable:!0})),L.addEventListener(h,"mousedown",this.mousedown),L.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(h,"touchcancel",this.reset)}startMouse(i,h){this.mouseRotate.dragStart(i,h),this.mousePitch&&this.mousePitch.dragStart(i,h),L.disableDrag()}startTouch(i,h){this.touchRotate.dragStart(i,h),this.touchPitch&&this.touchPitch.dragStart(i,h),L.disableDrag()}moveMouse(i,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(i,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(i,h)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(i,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(i,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(i,h)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const i=this.element;L.removeEventListener(i,"mousedown",this.mousedown),L.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let $r;function en(v,i,h){const p=new s.N(v.lng,v.lat);if(v=new s.N(v.lng,v.lat),i){const m=new s.N(v.lng-360,v.lat),b=new s.N(v.lng+360,v.lat),I=h.locationPoint(v).distSqr(i);h.locationPoint(m).distSqr(i)<I?v=m:h.locationPoint(b).distSqr(i)<I&&(v=b)}for(;Math.abs(v.lng-h.center.lng)>180;){const m=h.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;v.lng>h.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&h.locationPoint(v).y>h.height/2-h.getHorizon()?v:p}const Xs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Al(v,i,h){const p=v.classList;for(const m in Xs)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${i}`)}class Pl extends s.E{constructor(i){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?en(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${Xs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${b}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=s.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div");const h=L.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=L.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const I=L.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const E=L.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ke of M){const Ce=L.createNS("http://www.w3.org/2000/svg","ellipse");Ce.setAttributeNS(null,"opacity","0.04"),Ce.setAttributeNS(null,"cx","10.5"),Ce.setAttributeNS(null,"cy","5.80029008"),Ce.setAttributeNS(null,"rx",ke.rx),Ce.setAttributeNS(null,"ry",ke.ry),E.appendChild(Ce)}const D=L.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const O=L.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(O);const N=L.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const Q=L.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(Q);const se=L.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const de=L.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=L.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const xe=L.createNS("http://www.w3.org/2000/svg","circle");xe.setAttributeNS(null,"fill","#FFFFFF"),xe.setAttributeNS(null,"cx","5.5"),xe.setAttributeNS(null,"cy","5.5"),xe.setAttributeNS(null,"r","5.4999962"),de.appendChild(ge),de.appendChild(xe),I.appendChild(E),I.appendChild(D),I.appendChild(N),I.appendChild(se),I.appendChild(de),h.appendChild(I),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=s.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Al(this._element,this._anchor,"marker"),i&&i.className)for(const h of i.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=s.N.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),I=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,I)-b<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/m.transform._pixelPerMeter,M=Math.sin(m.getPitch()*Math.PI/180)*E,D=m.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),O=m.transform.lngLatToCameraDepth(this._lngLat,I+M)-D>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=s.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,h){return i===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Vh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Na=0,ja=!1;const ko={maxWidth:100,unit:"metric"};function $a(v,i,h){const p=h&&h.maxWidth||100,m=v._container.clientHeight/2,b=v.unproject([0,m]),I=v.unproject([p,m]),E=b.distanceTo(I);if(h&&h.unit==="imperial"){const M=3.2808*E;M>5280?Ot(i,p,M/5280,v._getUIString("ScaleControl.Miles")):Ot(i,p,M,v._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ot(i,p,E/1852,v._getUIString("ScaleControl.NauticalMiles")):E>=1e3?Ot(i,p,E/1e3,v._getUIString("ScaleControl.Kilometers")):Ot(i,p,E,v._getUIString("ScaleControl.Meters"))}function Ot(v,i,h,p){const m=function(b){const I=Math.pow(10,`${Math.floor(b)}`.length-1);let E=b/I;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D}(E),I*E}(h);v.style.width=i*(m/h)+"px",v.innerHTML=`${m}&nbsp;${p}`}const Yt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Dl(v){if(v){if(typeof v=="number"){const i=Math.round(Math.abs(v)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,v),"top-left":new s.P(i,i),"top-right":new s.P(-i,i),bottom:new s.P(0,-v),"bottom-left":new s.P(i,-i),"bottom-right":new s.P(-i,-i),left:new s.P(v,0),right:new s.P(-v,0)}}if(v instanceof s.P||Array.isArray(v)){const i=s.P.convert(v);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:s.P.convert(v.center||[0,0]),top:s.P.convert(v.top||[0,0]),"top-left":s.P.convert(v["top-left"]||[0,0]),"top-right":s.P.convert(v["top-right"]||[0,0]),bottom:s.P.convert(v.bottom||[0,0]),"bottom-left":s.P.convert(v["bottom-left"]||[0,0]),"bottom-right":s.P.convert(v["bottom-right"]||[0,0]),left:s.P.convert(v.left||[0,0]),right:s.P.convert(v.right||[0,0])}}return Dl(new s.P(0,0))}const du=g;d.AJAXError=s.bh,d.Evented=s.E,d.LngLat=s.N,d.MercatorCoordinate=s.Z,d.Point=s.P,d.addProtocol=s.bi,d.config=s.a,d.removeProtocol=s.bj,d.AttributionControl=Ws,d.BoxZoomHandler=jr,d.CanvasSource=gi,d.CooperativeGesturesHandler=Zs,d.DoubleClickZoomHandler=cs,d.DragPanHandler=Oh,d.DragRotateHandler=Nh,d.EdgeInsets=$s,d.FullscreenControl=class extends s.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var i;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=h==null?void 0:h.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Xt,d.GeolocateControl=class extends s.E{constructor(v){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const h=new s.N(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,m=this._map.getBearing(),b=s.e({bearing:m},this.options.fitBoundsOptions),I=Te.fromLngLat(h,p);this._map.fitBounds(I,b,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const h=new s.N(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&ja)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Pl({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")),this.fire(new s.k("userlocationlostfocus")))})}},this.options=s.e({},Vh,v)}onAdd(v){return this._map=v,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(i=!1){if($r!==void 0&&!i)return $r;if(window.navigator.permissions===void 0)return $r=!!window.navigator.geolocation,$r;try{$r=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{$r=!!window.navigator.geolocation}return $r})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Na=0,ja=!1}_isOutOfMapMaxBounds(v){const i=this._map.getMaxBounds(),h=v.coords;return i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),i=v.getSouthEast(),h=v.getNorthEast(),p=i.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Na--,ja=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart")),this.fire(new s.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Na++,Na>1?(v={maximumAge:6e5,timeout:0},ja=!0):(v=this.options.positionOptions,ja=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=xl,d.ImageSource=$i,d.KeyboardHandler=Jr,d.LngLatBounds=Te,d.LogoControl=au,d.Map=class extends jh{constructor(v){s.bf.mark(s.bg.create);const i=Object.assign(Object.assign({},ff),v);if(i.minZoom!=null&&i.maxZoom!=null&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(i.minPitch!=null&&i.maxPitch!=null&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(i.minPitch!=null&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(i.maxPitch!=null&&i.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Us(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies),{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ti,this._controls=[],this._mapId=s.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=i.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=i.preserveDrawingBuffer===!0,this._antialias=i.antialias===!0,this._trackResize=i.trackResize===!0,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=i.refreshExpiredTiles===!0,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=i.crossSourceCollisions===!0,this._collectResourceTiming=i.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},uu),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this.transformCameraUpdate=i.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=i.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=K.addThrottleControl(()=>this.isMoving()),this._requestManager=new le(i.transformRequest),typeof i.container=="string"){if(this._container=document.getElementById(i.container),!this._container)throw new Error(`Container '${i.container}' not found.`)}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const p=Da(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{h?p(m):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new su(this,i),this._hash=i.hash&&new xl(typeof i.hash=="string"&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,s.e({},i.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new Ws(typeof i.attributionControl=="boolean"?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new au,i.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new s.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new s.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new s.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(v,i){if(i===void 0&&(i=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(v);return i>-1&&this._controls.splice(i,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,i,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,i,h,p)}resize(v){var i;const h=this._containerDimensions(),p=h[0],m=h[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const M=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,M),this.painter.resize(p,m,M)}this.transform.resize(p,m),(i=this._requestedCameraState)===null||i===void 0||i.resize(p,m);const I=!this._moving;return I&&(this.stop(),this.fire(new s.k("movestart",v)).fire(new s.k("move",v))),this.fire(new s.k("resize",v)),I&&this.fire(new s.k("moveend",v)),this}_getClampedPixelRatio(v,i){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,I=i*m;return Math.min(b>h?h/b:1,I>p?p/I:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Te.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(s.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(s.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,i,h){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:b=>{const I=i.filter(M=>this.getLayer(M)),E=I.length!==0?this.queryRenderedFeatures(b.point,{layers:I}):[];E.length?p||(p=!0,h.call(this,new ir(v,this,b.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:I=>{const E=i.filter(M=>this.getLayer(M));(E.length!==0?this.queryRenderedFeatures(I.point,{layers:E}):[]).length?p=!0:p&&(p=!1,h.call(this,new ir(v,this,I.originalEvent)))},mouseout:I=>{p&&(p=!1,h.call(this,new ir(v,this,I.originalEvent)))}}}}{const p=m=>{const b=i.filter(E=>this.getLayer(E)),I=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];I.length&&(m.features=I,h.call(this,m),delete m.features)};return{layers:i,listener:h,delegates:{[v]:p}}}}_saveDelegatedListener(v,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(i)}_removeDelegatedListener(v,i,h){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const b=p[m];if(b.listener===h&&b.layers.length===i.length&&b.layers.every(I=>i.includes(I))){for(const I in b.delegates)this.off(I,b.delegates[I]);return void p.splice(m,1)}}}on(v,i,h){if(h===void 0)return super.on(v,i);const p=this._createDelegatedListener(v,typeof i=="string"?[i]:i,h);this._saveDelegatedListener(v,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,i,h){if(h===void 0)return super.once(v,i);const p=typeof i=="string"?[i]:i,m=this._createDelegatedListener(v,p,h);for(const b in m.delegates){const I=m.delegates[b];m.delegates[b]=(...E)=>{this._removeDelegatedListener(v,p,h),I(...E)}}this._saveDelegatedListener(v,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(v,i,h){return h===void 0?super.off(v,i):(this._removeDelegatedListener(v,typeof i=="string"?[i]:i,h),this)}queryRenderedFeatures(v,i){if(!this.style)return[];let h;const p=v instanceof s.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(p?{}:v)||{},m instanceof s.P||typeof m[0]=="number")h=[s.P.convert(m)];else{const b=s.P.convert(m[0]),I=s.P.convert(m[1]);h=[b,new s.P(I.x,b.y),I,new s.P(b.x,I.y),b]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(v,i){return this.style.querySourceFeatures(v,i)}setStyle(v,i){return(i=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(v,i))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const i=this._locale[v];if(i==null)throw new Error(`Missing UI string '${v}'`);return i}_updateStyle(v,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,i));const h=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new ol(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,i,h):this.style.loadJSON(v,i,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ol(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,i){if(typeof v=="string"){const h=this._requestManager.transformRequest(v,"Style");s.h(h,new AbortController).then(p=>{this._updateDiff(p.data,i)}).catch(p=>{p&&this.fire(new s.j(p))})}else typeof v=="object"&&this._updateDiff(v,i)}_updateDiff(v,i){try{this.style.setState(v,i)&&this._update(!0)}catch(h){s.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(v,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(v,i){return this._lazyInitEmptyStyle(),this.style.addSource(v,i),this._update(!0)}isSourceLoaded(v){const i=this.style&&this.style.sourceCaches[v];if(i!==void 0)return i.loaded();this.fire(new s.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const i=this.style.sourceCaches[v.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&i.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===v.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new cu(this.painter,i,v),this.painter.renderToTexture=new $h(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:v})),this}getTerrain(){var v,i;return(i=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const i in v){const h=v[i]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,i,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:I,content:E,textFitWidth:M,textFitHeight:D}=h;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||s.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:N,data:Q}=i,se=i;return this.style.addImage(v,{data:new s.R({width:O,height:N},new Uint8Array(Q)),pixelRatio:p,stretchX:b,stretchY:I,content:E,textFitWidth:M,textFitHeight:D,sdf:m,version:0,userImage:se}),se.onAdd&&se.onAdd(this,v),this}}{const{width:O,height:N,data:Q}=S.getImageData(i);this.style.addImage(v,{data:new s.R({width:O,height:N},Q),pixelRatio:p,stretchX:b,stretchY:I,content:E,textFitWidth:M,textFitHeight:D,sdf:m,version:0})}}updateImage(v,i){const h=this.style.getImage(v);if(!h)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||s.b(i)?S.getImageData(i):i,{width:m,height:b,data:I}=p;if(m===void 0||b===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||b!==h.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(i instanceof HTMLImageElement||s.b(i));return h.data.replace(I,E),this.style.updateImage(v,h),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return K.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,i){return this._lazyInitEmptyStyle(),this.style.addLayer(v,i),this._update(!0)}moveLayer(v,i){return this.style.moveLayer(v,i),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,i,h){return this.style.setLayerZoomRange(v,i,h),this._update(!0)}setFilter(v,i,h={}){return this.style.setFilter(v,i,h),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,i,h,p={}){return this.style.setPaintProperty(v,i,h,p),this._update(!0)}getPaintProperty(v,i){return this.style.getPaintProperty(v,i)}setLayoutProperty(v,i,h,p={}){return this.style.setLayoutProperty(v,i,h,p),this._update(!0)}getLayoutProperty(v,i){return this.style.getLayoutProperty(v,i)}setGlyphs(v,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,i,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,i,h,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,i,h=>{h||this._update(!0)}),this}setLight(v,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(v){return this._lazyInitEmptyStyle(),this.style.setSky(v),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,i){return this.style.setFeatureState(v,i),this._update()}removeFeatureState(v,i){return this.style.removeFeatureState(v,i),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,i=0;return this._container&&(v=this._container.clientWidth||400,i=this._container.clientHeight||300),[v,i]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const i=this._canvasContainer=L.create("div","maplibregl-canvas-container",v);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=L.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{b[I]=L.create("div",`maplibregl-ctrl-${I} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,i,h){this._canvas.width=Math.floor(h*v),this._canvas.height=Math.floor(h*i),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{i={requestedAttributes:v},p&&(i.statusMessage=p.statusMessage,i.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!h){const p="Failed to initialize WebGL";throw i?(i.message=p,new Error(JSON.stringify(i))):new Error(p)}this.painter=new wl(h,this.transform),P.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=S.now();this.style.zoomHistory.update(m,b);const I=new s.z(m,{now:b,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=I.crossFadingFactor();E===1&&E===this._crossFadingFactor||(h=!0,this._crossFadingFactor=E),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bf.mark(s.bg.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,s.bf.mark(s.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),K.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bf.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(v=>{s.bf.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Uh}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=ir,d.MapTouchEvent=as,d.MapWheelEvent=Rh,d.Marker=Pl,d.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const i=this._map.getZoom(),h=i===this._map.getMaxZoom(),p=i===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);i.title=p,i.setAttribute("aria-label",p)},this.options=s.e({},pf,v),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,i){const h=L.create("button",v,this._container);return h.type="button",h.addEventListener("click",i),h}},d.Popup=class extends s.E{constructor(v){super(),this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?en(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!i)return;const p=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=Dl(this.options.offset);if(!m){const E=this._container.offsetWidth,M=this._container.offsetHeight;let D;D=p.y+b.bottom.y<M?["top"]:p.y>this._map.transform.height-M?["bottom"]:[],p.x<E/2?D.push("left"):p.x>this._map.transform.width-E/2&&D.push("right"),m=D.length===0?"bottom":D.join("-")}let I=p.add(b[m]);this.options.subpixelPositioning||(I=I.round()),L.setTransform(this._container,`${Xs[m]} translate(${I.x}px,${I.y}px)`),Al(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Yt),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=s.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const i=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=v;p=h.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(zl);v&&v.focus()}},d.RasterDEMTileSource=nt,d.RasterTileSource=Ie,d.ScaleControl=class{constructor(v){this._onMove=()=>{$a(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,$a(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ko),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=lo,d.Style=ol,d.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=qs,d.TwoFingersTouchRotateHandler=nu,d.TwoFingersTouchZoomHandler=tu,d.TwoFingersTouchZoomRotateHandler=ou,d.VectorTileSource=yt,d.VideoSource=Li,d.addSourceType=(v,i)=>s._(void 0,void 0,void 0,function*(){if(br(v))throw new Error(`A source type called "${v}" already exists.`);((h,p)=>{Fi[h]=p})(v,i)}),d.clearPrewarmedResources=function(){const v=ai;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Bt),ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return Un().getRTLTextPluginStatus()},d.getVersion=function(){return du},d.getWorkerCount=function(){return Dt.workerCount},d.getWorkerUrl=function(){return s.a.WORKER_URL},d.importScriptInWorkers=function(v){return vi().broadcast("IS",v)},d.prewarm=function(){Si().acquire(Bt)},d.setMaxParallelImageRequests=function(v){s.a.MAX_PARALLEL_IMAGE_REQUESTS=v},d.setRTLTextPlugin=function(v,i){return Un().setRTLTextPlugin(v,i)},d.setWorkerCount=function(v){Dt.workerCount=v},d.setWorkerUrl=function(v){s.a.WORKER_URL=v}});var u=t;return u})})(a1);var $p=a1.exports;const Pr=cw($p),uw=Hv({__proto__:null,default:Pr},[$p]);var hw=Object.defineProperty,c1=o=>{throw TypeError(o)},dw=(o,e,t)=>e in o?hw(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,go=(o,e,t)=>dw(o,typeof e!="symbol"?e+"":e,t),u1=(o,e,t)=>e.has(o)||c1("Cannot "+t),Qn=(o,e,t)=>(u1(o,e,"read from private field"),t?t.call(o):e.get(o)),V_=(o,e,t)=>e.has(o)?c1("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t),q_=(o,e,t,r)=>(u1(o,e,"write to private field"),r?r.call(o,t):e.set(o,t),t);function bn(){}function fw(o,e){for(const t in e)o[t]=e[t];return o}function h1(o){return o()}function Z_(){return Object.create(null)}function Cs(o){o.forEach(h1)}function d1(o){return typeof o=="function"}function va(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let pd;function Rr(o,e){return o===e?!0:(pd||(pd=document.createElement("a")),pd.href=e,o===pd.href)}function pw(o){return Object.keys(o).length===0}function mw(o,e,t,r){if(o){const l=f1(o,e,t,r);return o[0](l)}}function f1(o,e,t,r){return o[1]&&r?fw(t.ctx.slice(),o[1](r(e))):t.ctx}function _w(o,e,t,r){if(o[2]&&r){const l=o[2](r(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let s=0;s<d;s+=1)u[s]=e.dirty[s]|l[s];return u}return e.dirty|l}return e.dirty}function gw(o,e,t,r,l,u){if(l){const d=f1(e,t,r,u);o.p(d,l)}}function yw(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function G_(o){return o??""}function Oi(o,e){o.appendChild(e)}function En(o,e,t){o.insertBefore(e,t||null)}function wn(o){o.parentNode&&o.parentNode.removeChild(o)}function sn(o){return document.createElement(o)}function Vo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ma(o){return document.createTextNode(o)}function bo(){return ma(" ")}function bw(){return ma("")}function Gr(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function vw(o){return function(e){return e.preventDefault(),o.call(this,e)}}function ht(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function ww(o){return Array.from(o.childNodes)}function Qu(o,e){e=""+e,o.data!==e&&(o.data=e)}function W_(o,e){o.value=e??""}function Ao(o,e,t){o.classList.toggle(e,!!t)}function xw(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}let eh;function Gu(o){eh=o}function p1(){if(!eh)throw new Error("Function called outside component initialization");return eh}function kw(o){p1().$$.on_destroy.push(o)}function Sw(){const o=p1();return(e,t,{cancelable:r=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=xw(e,t,{cancelable:r});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function H_(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const oc=[],yp=[];let uc=[];const X_=[],Tw=Promise.resolve();let bp=!1;function Iw(){bp||(bp=!0,Tw.then(m1))}function vp(o){uc.push(o)}const ap=new Set;let Ql=0;function m1(){if(Ql!==0)return;const o=eh;do{try{for(;Ql<oc.length;){const e=oc[Ql];Ql++,Gu(e),Cw(e.$$)}}catch(e){throw oc.length=0,Ql=0,e}for(Gu(null),oc.length=0,Ql=0;yp.length;)yp.pop()();for(let e=0;e<uc.length;e+=1){const t=uc[e];ap.has(t)||(ap.add(t),t())}uc.length=0}while(oc.length);for(;X_.length;)X_.pop()();bp=!1,ap.clear(),Gu(o)}function Cw(o){if(o.fragment!==null){o.update(),Cs(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(vp)}}function Ew(o){const e=[],t=[];uc.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),uc=e}const wd=new Set;let Qa;function xd(){Qa={r:0,c:[],p:Qa}}function kd(){Qa.r||Cs(Qa.c),Qa=Qa.p}function Nn(o,e){o&&o.i&&(wd.delete(o),o.i(e))}function ur(o,e,t,r){if(o&&o.o){if(wd.has(o))return;wd.add(o),Qa.c.push(()=>{wd.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function K_(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Lw(o,e){ur(o,1,1,()=>{e.delete(o.key)})}function Mw(o,e,t,r,l,u,d,s,g,y,k,S){let L=o.length,P=u.length,R=L;const Z={};for(;R--;)Z[o[R].key]=R;const U=[],H=new Map,G=new Map,K=[];for(R=P;R--;){const te=S(l,u,R),Y=t(te);let ue=d.get(Y);ue?K.push(()=>ue.p(te,e)):(ue=y(Y,te),ue.c()),H.set(Y,U[R]=ue),Y in Z&&G.set(Y,Math.abs(R-Z[Y]))}const le=new Set,Se=new Set;function Le(te){Nn(te,1),te.m(s,k),d.set(te.key,te),k=te.first,P--}for(;L&&P;){const te=U[P-1],Y=o[L-1],ue=te.key,fe=Y.key;te===Y?(k=te.first,L--,P--):H.has(fe)?!d.has(ue)||le.has(ue)?Le(te):Se.has(fe)?L--:G.get(ue)>G.get(fe)?(Se.add(ue),Le(te)):(le.add(fe),L--):(g(Y,d),L--)}for(;L--;){const te=o[L];H.has(te.key)||g(te,d)}for(;P;)Le(U[P-1]);return Cs(K),U}function _a(o){o&&o.c()}function Ss(o,e,t){const{fragment:r,after_update:l}=o.$$;r&&r.m(e,t),vp(()=>{const u=o.$$.on_mount.map(h1).filter(d1);o.$$.on_destroy?o.$$.on_destroy.push(...u):Cs(u),o.$$.on_mount=[]}),l.forEach(vp)}function Ts(o,e){const t=o.$$;t.fragment!==null&&(Ew(t.after_update),Cs(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Aw(o,e){o.$$.dirty[0]===-1&&(oc.push(o),Iw(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function wa(o,e,t,r,l,u,d=null,s=[-1]){const g=eh;Gu(o);const y=o.$$={fragment:null,ctx:[],props:u,update:bn,not_equal:l,bound:Z_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:Z_(),dirty:s,skip_bound:!1,root:e.target||g.$$.root};d&&d(y.root);let k=!1;if(y.ctx=t?t(o,e.props||{},(S,L,...P)=>{const R=P.length?P[0]:L;return y.ctx&&l(y.ctx[S],y.ctx[S]=R)&&(!y.skip_bound&&y.bound[S]&&y.bound[S](R),k&&Aw(o,S)),L}):[],y.update(),k=!0,Cs(y.before_update),y.fragment=r?r(y.ctx):!1,e.target){if(e.hydrate){const S=ww(e.target);y.fragment&&y.fragment.l(S),S.forEach(wn)}else y.fragment&&y.fragment.c();e.intro&&Nn(o.$$.fragment),Ss(o,e.target,e.anchor),m1()}Gu(g)}class xa{constructor(){go(this,"$$"),go(this,"$$set")}$destroy(){Ts(this,1),this.$destroy=bn}$on(e,t){if(!d1(t))return bn;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const l=r.indexOf(t);l!==-1&&r.splice(l,1)}}$set(e){this.$$set&&!pw(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Pw="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Pw);function zw(o){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ht(e,"viewBox","0 0 14 14"),ht(e,"width","13"),ht(e,"height","13"),ht(e,"class","svelte-en2qvf")},m(r,l){En(r,e,l),Oi(e,t)},p:bn,i:bn,o:bn,d(r){r&&wn(e)}}}class _1 extends xa{constructor(e){super(),wa(this,e,null,zw,va,{})}}function Dw(o){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ht(e,"viewBox","0 0 30 30"),ht(e,"fill","none"),ht(e,"xmlns","http://www.w3.org/2000/svg"),ht(e,"class","svelte-d2loi5")},m(r,l){En(r,e,l),Oi(e,t)},p:bn,i:bn,o:bn,d(r){r&&wn(e)}}}class g1 extends xa{constructor(e){super(),wa(this,e,null,Dw,va,{})}}function Rw(o){let e,t;return{c(){e=sn("img"),Rr(e.src,t=o[3]+"area.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(r,l){En(r,e,l)},p(r,l){l&8&&!Rr(e.src,t=r[3]+"area.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",r[6])},d(r){r&&wn(e)}}}function Fw(o){let e,t;return{c(){e=sn("img"),Rr(e.src,t=o[3]+"reverse.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(r,l){En(r,e,l)},p(r,l){l&8&&!Rr(e.src,t=r[3]+"reverse.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",r[6])},d(r){r&&wn(e)}}}function Bw(o){let e,t;return{c(){e=sn("img"),Rr(e.src,t=o[3]+"poi.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(r,l){En(r,e,l)},p(r,l){l&8&&!Rr(e.src,t=r[3]+"poi.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",r[6])},d(r){r&&wn(e)}}}function Ow(o){let e,t;return{c(){e=sn("img"),Rr(e.src,t=o[3]+"postal_code.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(r,l){En(r,e,l)},p(r,l){l&8&&!Rr(e.src,t=r[3]+"postal_code.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",r[6])},d(r){r&&wn(e)}}}function Nw(o){let e,t;return{c(){e=sn("img"),Rr(e.src,t=o[3]+"street.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(r,l){En(r,e,l)},p(r,l){l&8&&!Rr(e.src,t=r[3]+"street.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",r[6])},d(r){r&&wn(e)}}}function jw(o){let e,t;return{c(){e=sn("img"),Rr(e.src,t=o[3]+"road.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(r,l){En(r,e,l)},p(r,l){l&8&&!Rr(e.src,t=r[3]+"road.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",r[6])},d(r){r&&wn(e)}}}function $w(o){let e,t;return{c(){e=sn("img"),Rr(e.src,t=o[3]+"housenumber.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(r,l){En(r,e,l)},p(r,l){l&8&&!Rr(e.src,t=r[3]+"housenumber.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",r[6])},d(r){r&&wn(e)}}}function Uw(o){let e,t,r,l;return{c(){e=sn("img"),Rr(e.src,t=o[5])||ht(e,"src",t),ht(e,"alt",o[4]),ht(e,"class","svelte-ltkwvy")},m(u,d){En(u,e,d),r||(l=Gr(e,"error",o[14]),r=!0)},p(u,d){d&32&&!Rr(e.src,t=u[5])&&ht(e,"src",t),d&16&&ht(e,"alt",u[4])},d(u){u&&wn(e),r=!1,l()}}}function J_(o){let e,t;return{c(){e=sn("span"),t=ma(o[6]),ht(e,"class","secondary svelte-ltkwvy")},m(r,l){En(r,e,l),Oi(e,t)},p(r,l){l&64&&Qu(t,r[6])},d(r){r&&wn(e)}}}function Vw(o){let e,t,r,l,u,d,s,g,y,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,L,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],R,Z,U=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",H,G,K;function le(Y,ue){return ue&1&&(t=null),ue&1&&(r=null),ue&1&&(l=null),ue&1&&(u=null),Y[5]?Uw:Y[0].address?$w:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?jw:(r==null&&(r=!!Y[0].id.startsWith("address.")),r?Nw:(l==null&&(l=!!Y[0].id.startsWith("postal_code.")),l?Ow:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?Bw:Y[7]?Fw:Rw))))}let Se=le(o,-1),Le=Se(o),te=P&&J_(o);return{c(){e=sn("li"),Le.c(),d=bo(),s=sn("span"),g=sn("span"),y=sn("span"),S=ma(k),L=bo(),te&&te.c(),R=bo(),Z=sn("span"),H=ma(U),ht(y,"class","primary svelte-ltkwvy"),ht(g,"class","svelte-ltkwvy"),ht(Z,"class","line2 svelte-ltkwvy"),ht(s,"class","texts svelte-ltkwvy"),ht(e,"tabindex","0"),ht(e,"data-selected",o[1]),ht(e,"class","svelte-ltkwvy"),Ao(e,"selected",o[1])},m(Y,ue){En(Y,e,ue),Le.m(e,null),Oi(e,d),Oi(e,s),Oi(s,g),Oi(g,y),Oi(y,S),Oi(g,L),te&&te.m(g,null),Oi(s,R),Oi(s,Z),Oi(Z,H),G||(K=[Gr(e,"mouseenter",o[12]),Gr(e,"focus",o[13])],G=!0)},p(Y,[ue]){Se===(Se=le(Y,ue))&&Le?Le.p(Y,ue):(Le.d(1),Le=Se(Y),Le&&(Le.c(),Le.m(e,d))),ue&1&&k!==(k=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&Qu(S,k),ue&37&&(P=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),P?te?te.p(Y,ue):(te=J_(Y),te.c(),te.m(g,null)):te&&(te.d(1),te=null),ue&1&&U!==(U=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Qu(H,U),ue&2&&ht(e,"data-selected",Y[1]),ue&2&&Ao(e,"selected",Y[1])},i:bn,o:bn,d(Y){Y&&wn(e),Le.d(),te&&te.d(),G=!1,Cs(K)}}}function qw(o,e,t){var r;let l,u,{feature:d}=e,{selected:s=!1}=e,{showPlaceType:g}=e,{missingIconsCache:y}=e,{iconsBaseUrl:k}=e;const S=(r=d.properties)==null?void 0:r.categories;let L,P,R=0,Z=d.place_type[0]==="reverse";function U(){P&&y.add(P),t(10,R++,R)}function H(le){H_.call(this,o,le)}function G(le){H_.call(this,o,le)}const K=()=>U();return o.$$set=le=>{"feature"in le&&t(0,d=le.feature),"selected"in le&&t(1,s=le.selected),"showPlaceType"in le&&t(2,g=le.showPlaceType),"missingIconsCache"in le&&t(9,y=le.missingIconsCache),"iconsBaseUrl"in le&&t(3,k=le.iconsBaseUrl)},o.$$.update=()=>{var le,Se,Le,te;if(o.$$.dirty&3640)do t(11,l--,l),t(4,L=S==null?void 0:S[l]),t(5,P=L?k+L.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!P||y.has(P)));o.$$.dirty&1&&t(6,u=((Se=(le=d.properties)==null?void 0:le.categories)==null?void 0:Se.join(", "))??((te=(Le=d.properties)==null?void 0:Le.place_type_name)==null?void 0:te[0])??d.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[d,s,g,k,L,P,u,Z,U,y,R,l,H,G,K]}class Zw extends xa{constructor(e){super(),wa(this,e,qw,Vw,va,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Gw(o){let e;return{c(){e=sn("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ht(e,"class","svelte-7cmwmc")},m(t,r){En(t,e,r)},p:bn,i:bn,o:bn,d(t){t&&wn(e)}}}class Ww extends xa{constructor(e){super(),wa(this,e,null,Gw,va,{})}}function Hw(o){let e,t,r;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"stroke-width","4"),ht(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ht(t,"class","svelte-gzo3ar"),ht(e,"width",r=o[0]==="list"?20:void 0),ht(e,"viewBox","0 0 70 85"),ht(e,"fill","none"),ht(e,"class","svelte-gzo3ar"),Ao(e,"in-map",o[0]!=="list"),Ao(e,"list-icon",o[0]==="list")},m(l,u){En(l,e,u),Oi(e,t)},p(l,[u]){u&1&&r!==(r=l[0]==="list"?20:void 0)&&ht(e,"width",r),u&1&&Ao(e,"in-map",l[0]!=="list"),u&1&&Ao(e,"list-icon",l[0]==="list")},i:bn,o:bn,d(l){l&&wn(e)}}}function Xw(o,e,t){let{displayIn:r}=e;return o.$$set=l=>{"displayIn"in l&&t(0,r=l.displayIn)},[r]}class Kw extends xa{constructor(e){super(),wa(this,e,Xw,Hw,va,{displayIn:0})}}function Jw(o){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),ht(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ht(e,"viewBox","0 0 60.006 21.412"),ht(e,"width","14"),ht(e,"height","20"),ht(e,"class","svelte-en2qvf")},m(r,l){En(r,e,l),Oi(e,t)},p:bn,i:bn,o:bn,d(r){r&&wn(e)}}}class Yw extends xa{constructor(e){super(),wa(this,e,null,Jw,va,{})}}function Qw(o){let e,t,r;return{c(){e=Vo("svg"),t=Vo("circle"),r=Vo("path"),ht(t,"cx","4.789"),ht(t,"cy","4.787"),ht(t,"r","3.85"),ht(t,"class","svelte-1aq105l"),ht(r,"d","M12.063 12.063 7.635 7.635"),ht(r,"class","svelte-1aq105l"),ht(e,"xmlns","http://www.w3.org/2000/svg"),ht(e,"width","13"),ht(e,"height","13"),ht(e,"viewBox","0 0 13 13"),ht(e,"class","svelte-1aq105l")},m(l,u){En(l,e,u),Oi(e,t),Oi(e,r)},p:bn,i:bn,o:bn,d(l){l&&wn(e)}}}class ex extends xa{constructor(e){super(),wa(this,e,null,Qw,va,{})}}function tx(o,e,t){const r=e[1],l=e[0],u=r-l;return o===r&&t?o:((o-l)%u+u)%u+l}function Ed(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let zu;async function ix(o,e,t){const r=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(r&&(l.minZoom!=null&&l.minZoom>r[0]||l.maxZoom!=null&&l.maxZoom<r[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(zu&&l.cachedLocationExpiry&&zu.time+l.cachedLocationExpiry>Date.now()){if(!zu.coords)break e;return zu.coords}let u;try{return u=await new Promise((d,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(g=>{d([g.coords.longitude,g.coords.latitude].map(y=>y.toFixed(6)).join(","))},g=>{s(g)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(zu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(r&&l.type==="map-center")return r[1].toFixed(6)+","+r[2].toFixed(6)}}const nx=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Y_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Q_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,eg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,tg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,ig=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function rx(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),r=Number(e[1]),l=Math.abs(t),u=Math.abs(r),d=t>0?"N":"S",s=r>0?"E":"W";let g;o=="DD"&&(g=`${l}° ${d}, ${u}° ${s}`);const y=Math.floor(l),k=Math.floor(u),S=(l-y)*60,L=(u-k)*60;if(o=="DM"){let P=ng(S,3).toFixed(3).padStart(6,"0"),R=ng(L,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&R.endsWith(".000")&&(P=P.replace(/\.000$/,""),R=R.replace(/\.000$/,"")),g=`${y}° ${P}' ${d}, ${k}° ${R}' ${s}`}if(o=="DMS"){const P=Math.floor(S),R=Math.floor(L);let Z=((S-P)*60).toFixed(1).padStart(4,"0"),U=((L-R)*60).toFixed(1).padStart(4,"0");const H=P.toString().padStart(2,"0"),G=R.toString().padStart(2,"0");Z.endsWith(".0")&&U.endsWith(".0")&&(Z=Z.replace(/\.0$/,""),U=U.replace(/\.0$/,"")),g=`${y}° ${H}' ${Z}" ${d}, ${k}° ${G}' ${U}" ${s}`}return g}else throw new Error("no decimal coordinates to convert")}function ng(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Up(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,r=null,l="",u="",d=null,s=[],g=!1;if(nx.test(o))throw new Error("invalid coordinate value");if(Y_.test(o))if(s=Y_.exec(o),g=Du(s),g)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),r=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(r*=-1),d="DM";else throw new Error("invalid coordinate format");else if(Q_.test(o))if(s=Q_.exec(o),g=Du(s),g){if(t=s[2],r=s[6],t.includes(",")&&(t=t.replace(",",".")),r.includes(",")&&(r=r.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");s[1]?(l=s[1],u=s[5]):s[4]&&(l=s[4],u=s[8])}else throw new Error("invalid decimal coordinate format");else if(eg.test(o))if(s=eg.exec(o),g=Du(s),g)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,d="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,d="DMS"),parseInt(s[2])<0&&(t=-1*t),r=Math.abs(parseInt(s[9])),s[11]&&(r+=s[11]/60),s[13]&&(r+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(r=-1*r),s[1]?(l=s[1],u=s[8]):s[7]&&(l=s[7],u=s[14]);else throw new Error("invalid DMS coordinates format");else if(tg.test(o))if(s=tg.exec(o),g=Du(s),g)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,d="DM"),s[6]&&(t+=s[6]/3600,d="DMS"),parseInt(s[2])<0&&(t=-1*t),r=Math.abs(parseInt(s[10])),s[12]&&(r+=s[12]/60),s[14]&&(r+=s[14]/3600),parseInt(s[10])<0&&(r=-1*r),s[1]?(l=s[1],u=s[9]):s[8]&&(l=s[8],u=s[16]);else throw new Error("invalid DMS coordinates format");else if(ig.test(o)){if(s=ig.exec(o),g=Du(s),s.filter(y=>y).length<=5)throw new Error("invalid coordinates format");if(g)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,d="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,d="DMS"),parseInt(s[2])<0&&(t=-1*t),r=Math.abs(parseInt(s[10])),s[12]&&(r+=s[12].replace(",",".")/60),s[14]&&(r+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(r=-1*r),s[1]?(l=s[1],u=s[9]):s[8]&&(l=s[8],u=s[16]);else throw new Error("invalid coordinates format")}if(g){if(Math.abs(r)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),r.toString().includes(",")&&(r=r.replace(",","."));let y=/S|SOUTH/i;y.test(l)&&t>0&&(t=-1*t),y=/W|WEST/i,y.test(u)&&r>0&&(r=-1*r);const k=s[0].trim();let S,L;const P=/[,/;\u0020]/g,R=k.match(P);if(R==null){const H=Math.floor(o.length/2);S=k.substring(0,H).trim(),L=k.substring(H).trim()}else{let H;R.length%2==1?H=Math.floor(R.length/2):H=R.length/2-1;let G=0;if(H==0)G=k.indexOf(R[0]),S=k.substring(0,G).trim(),L=k.substring(G+1).trim();else{let K=0,le=0;for(;K<=H;)G=k.indexOf(R[K],le),le=G+1,K++;S=k.substring(0,G).trim(),L=k.substring(G+1).trim()}}const Z=S.split(".");if(Z.length==2&&Z[1]==0&&Z[1].length!=2)throw new Error("invalid coordinates format");const U=L.split(".");if(U.length==2&&U[1]==0&&U[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(L))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),r=Number(Number(r).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:L,decimalLatitude:t,decimalLongitude:r,decimalCoordinates:`${t},${r}`,originalFormat:d,closeEnough:ox,toCoordinateFormat:rx})}else throw new Error("coordinates pattern match failed")}function Du(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,r=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],s=e[u+l],g=t.test(d)&&t.test(s),y=r.test(d)&&r.test(s),k=d==s;if(!(d==null&&s==null)){if(d==null||s==null)return!1;if(g||y||k)continue;return!1}}return!0}function rg(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function ox(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return rg(this.decimalLatitude,Number(e[0]))&&rg(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const sx=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Up.to=sx;const ax=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],lx={decimalLatitude:40.123,decimalLongitude:-74.123},cx=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],ux=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function hx(){const o=[];return ax.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...lx})}),[...o,...cx,...ux]}const dx=hx();Up.formats=dx.map(o=>o.verbatimCoordinates);const fx=Up;function og(o,e,t){const r=o.slice();return r[84]=e[t],r[86]=t,r}function sg(o){let e,t;return e=new Ww({}),{c(){_a(e.$$.fragment)},m(r,l){Ss(e,r,l),t=!0},i(r){t||(Nn(e.$$.fragment,r),t=!0)},o(r){ur(e.$$.fragment,r),t=!1},d(r){Ts(e,r)}}}function ag(o){let e,t,r,l,u;return t=new Yw({}),{c(){e=sn("button"),_a(t.$$.fragment),ht(e,"type","button"),ht(e,"title",o[9]),ht(e,"class","svelte-bz0zu3"),Ao(e,"active",o[0])},m(d,s){En(d,e,s),Ss(t,e,null),r=!0,l||(u=Gr(e,"click",o[69]),l=!0)},p(d,s){(!r||s[0]&512)&&ht(e,"title",d[9]),(!r||s[0]&1)&&Ao(e,"active",d[0])},i(d){r||(Nn(t.$$.fragment,d),r=!0)},o(d){ur(t.$$.fragment,d),r=!1},d(d){d&&wn(e),Ts(t),l=!1,u()}}}function px(o){let e,t=[],r=new Map,l,u,d,s=K_(o[14]);const g=y=>y[84].id+(y[84].address?","+y[84].address:"");for(let y=0;y<s.length;y+=1){let k=og(o,s,y),S=g(k);r.set(S,t[y]=lg(S,k))}return{c(){e=sn("ul");for(let y=0;y<t.length;y+=1)t[y].c();ht(e,"class","options svelte-bz0zu3")},m(y,k){En(y,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Gr(e,"mouseleave",o[73]),Gr(e,"blur",o[74])],u=!0)},p(y,k){k[0]&17880064&&(s=K_(y[14]),xd(),t=Mw(t,k,g,1,y,s,r,e,Lw,lg,null,og),kd())},i(y){if(!l){for(let k=0;k<s.length;k+=1)Nn(t[k]);l=!0}},o(y){for(let k=0;k<t.length;k+=1)ur(t[k]);l=!1},d(y){y&&wn(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,Cs(d)}}}function mx(o){let e,t,r,l,u,d;return t=new g1({}),{c(){e=sn("div"),_a(t.$$.fragment),r=bo(),l=sn("div"),u=ma(o[7]),ht(l,"class","svelte-bz0zu3"),ht(e,"class","no-results svelte-bz0zu3")},m(s,g){En(s,e,g),Ss(t,e,null),Oi(e,r),Oi(e,l),Oi(l,u),d=!0},p(s,g){(!d||g[0]&128)&&Qu(u,s[7])},i(s){d||(Nn(t.$$.fragment,s),d=!0)},o(s){ur(t.$$.fragment,s),d=!1},d(s){s&&wn(e),Ts(t)}}}function _x(o){let e="",t;return{c(){t=ma(e)},m(r,l){En(r,t,l)},p:bn,i:bn,o:bn,d(r){r&&wn(t)}}}function gx(o){let e,t,r,l,u,d,s,g,y,k,S;return t=new g1({}),g=new _1({}),{c(){e=sn("div"),_a(t.$$.fragment),r=bo(),l=sn("div"),u=ma(o[6]),d=bo(),s=sn("button"),_a(g.$$.fragment),ht(l,"class","svelte-bz0zu3"),ht(s,"class","svelte-bz0zu3"),ht(e,"class","error svelte-bz0zu3")},m(L,P){En(L,e,P),Ss(t,e,null),Oi(e,r),Oi(e,l),Oi(l,u),Oi(e,d),Oi(e,s),Ss(g,s,null),y=!0,k||(S=Gr(s,"click",o[70]),k=!0)},p(L,P){(!y||P[0]&64)&&Qu(u,L[6])},i(L){y||(Nn(t.$$.fragment,L),Nn(g.$$.fragment,L),y=!0)},o(L){ur(t.$$.fragment,L),ur(g.$$.fragment,L),y=!1},d(L){L&&wn(e),Ts(t),Ts(g),k=!1,S()}}}function lg(o,e){let t,r,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return r=new Zw({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),r.$on("mouseenter",u),r.$on("focus",d),{key:o,first:null,c(){t=bw(),_a(r.$$.fragment),this.first=t},m(s,g){En(s,t,g),Ss(r,s,g),l=!0},p(s,g){e=s;const y={};g[0]&16384&&(y.feature=e[84]),g[0]&1024&&(y.showPlaceType=e[10]),g[0]&49152&&(y.selected=e[15]===e[86]),g[0]&4096&&(y.iconsBaseUrl=e[12]),r.$set(y)},i(s){l||(Nn(r.$$.fragment,s),l=!0)},o(s){ur(r.$$.fragment,s),l=!1},d(s){s&&wn(t),Ts(r,s)}}}function yx(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le=!1;u=new ex({}),S=new _1({});let te=o[19]&&sg(),Y=o[5]==="button"&&ag(o);const ue=o[61].default,fe=mw(ue,o,o[60],null),ce=[gx,_x,mx,px],ae=[];function Ge(Ee,ze){var rt,it;return Ee[18]?0:Ee[16]?((rt=Ee[14])==null?void 0:rt.length)===0?2:Ee[16]&&(it=Ee[14])!=null&&it.length?3:-1:1}return~(U=Ge(o))&&(H=ae[U]=ce[U](o)),{c(){e=bo(),t=sn("form"),r=sn("div"),l=sn("button"),_a(u.$$.fragment),d=bo(),s=sn("input"),g=bo(),y=sn("div"),k=sn("button"),_a(S.$$.fragment),L=bo(),te&&te.c(),P=bo(),Y&&Y.c(),R=bo(),fe&&fe.c(),Z=bo(),H&&H.c(),ht(l,"class","search-button svelte-bz0zu3"),ht(l,"type","button"),ht(s,"placeholder",o[8]),ht(s,"aria-label",o[8]),ht(s,"class","svelte-bz0zu3"),ht(k,"type","button"),ht(k,"title",o[3]),ht(k,"class","svelte-bz0zu3"),ht(y,"class","clear-button-container svelte-bz0zu3"),Ao(y,"displayable",o[1]!==""),ht(r,"class","input-group svelte-bz0zu3"),ht(t,"tabindex","0"),ht(t,"class",G=G_(o[2])+" svelte-bz0zu3"),Ao(t,"can-collapse",o[4]&&o[1]==="")},m(Ee,ze){En(Ee,e,ze),En(Ee,t,ze),Oi(t,r),Oi(r,l),Ss(u,l,null),Oi(r,d),Oi(r,s),o[63](s),W_(s,o[1]),Oi(r,g),Oi(r,y),Oi(y,k),Ss(S,k,null),Oi(y,L),te&&te.m(y,null),Oi(r,P),Y&&Y.m(r,null),Oi(r,R),fe&&fe.m(r,null),Oi(t,Z),~U&&ae[U].m(t,null),K=!0,le||(Se=[Gr(l,"click",o[62]),Gr(s,"input",o[64]),Gr(s,"focus",o[65]),Gr(s,"blur",o[66]),Gr(s,"keydown",o[22]),Gr(s,"input",o[67]),Gr(k,"click",o[68]),Gr(t,"submit",vw(o[21]))],le=!0)},p(Ee,ze){(!K||ze[0]&256)&&ht(s,"placeholder",Ee[8]),(!K||ze[0]&256)&&ht(s,"aria-label",Ee[8]),ze[0]&2&&s.value!==Ee[1]&&W_(s,Ee[1]),(!K||ze[0]&8)&&ht(k,"title",Ee[3]),Ee[19]?te?ze[0]&524288&&Nn(te,1):(te=sg(),te.c(),Nn(te,1),te.m(y,null)):te&&(xd(),ur(te,1,1,()=>{te=null}),kd()),(!K||ze[0]&2)&&Ao(y,"displayable",Ee[1]!==""),Ee[5]==="button"?Y?(Y.p(Ee,ze),ze[0]&32&&Nn(Y,1)):(Y=ag(Ee),Y.c(),Nn(Y,1),Y.m(r,R)):Y&&(xd(),ur(Y,1,1,()=>{Y=null}),kd()),fe&&fe.p&&(!K||ze[1]&536870912)&&gw(fe,ue,Ee,Ee[60],K?_w(ue,Ee[60],ze,null):yw(Ee[60]),null);let rt=U;U=Ge(Ee),U===rt?~U&&ae[U].p(Ee,ze):(H&&(xd(),ur(ae[rt],1,1,()=>{ae[rt]=null}),kd()),~U?(H=ae[U],H?H.p(Ee,ze):(H=ae[U]=ce[U](Ee),H.c()),Nn(H,1),H.m(t,null)):H=null),(!K||ze[0]&4&&G!==(G=G_(Ee[2])+" svelte-bz0zu3"))&&ht(t,"class",G),(!K||ze[0]&22)&&Ao(t,"can-collapse",Ee[4]&&Ee[1]==="")},i(Ee){K||(Nn(Le),Nn(u.$$.fragment,Ee),Nn(S.$$.fragment,Ee),Nn(te),Nn(Y),Nn(fe,Ee),Nn(H),K=!0)},o(Ee){ur(Le),ur(u.$$.fragment,Ee),ur(S.$$.fragment,Ee),ur(te),ur(Y),ur(fe,Ee),ur(H),K=!1},d(Ee){Ee&&(wn(e),wn(t)),Ts(u),o[63](null),Ts(S),te&&te.d(),Y&&Y.d(),fe&&fe.d(Ee),~U&&ae[U].d(),le=!1,Cs(Se)}}}function bx(o,e,t){let r,l,{$$slots:u={},$$scope:d}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:g=void 0}=e,{apiKey:y}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:L=!1}=e,{collapsed:P=!1}=e,{country:R=void 0}=e,{debounceSearch:Z=200}=e,{enableReverse:U="never"}=e,{errorMessage:H="Something went wrong…"}=e,{filter:G=()=>!0}=e,{flyTo:K=!0}=e,{fuzzyMatch:le=!0}=e,{language:Se=void 0}=e,{limit:Le=void 0}=e,{mapController:te=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ue="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:fe="Search"}=e,{proximity:ce=[{type:"server-geolocation"}]}=e,{reverseActive:ae=U==="always"}=e,{reverseButtonTitle:Ge="toggle reverse geocoding"}=e,{searchValue:Ee=""}=e,{pickedResultStyle:ze="full-geometry"}=e,{showPlaceType:rt="if-needed"}=e,{showResultsWhileTyping:it=!0}=e,{selectFirst:Qe=!0}=e,{flyToSelected:Ft=!1}=e,{markerOnSelected:jt=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:et=!1}=e,{excludeTypes:at=!1}=e,{zoom:Bt=s}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ht={}}=e,{iconsBaseUrl:ai="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:si=()=>{}}=e;function Si(){Ie.focus()}function Ri(){Ie.blur()}function vi(j,Fe=!0,Ke=!1){t(1,Ee=j),Fe?(t(15,nt=-1),tr()):(Sn(!Ke,Ke),setTimeout(()=>{Ie.focus(),Ie.select()}))}function di(){t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1)}function lt(){t(55,Te=[]),t(56,mt=void 0)}let qe=!1,st,Te,mt,yt="",Ie,nt=-1,Xt,wi=[],$i,Li,gi,Fi;const br=new Set,ct=Sw();kw(()=>{te&&(te.setEventHandler(void 0),te.indicateReverse(!1),te.setSelectedMarker(-1),te.setFeatures(void 0,void 0,!1))});function tr(j){if(Li&&(clearTimeout(Li),Li=void 0),nt>-1&&st)t(56,mt=st[nt]),t(1,Ee=mt.place_type[0]==="reverse"?mt.place_name:mt.place_name.replace(/,.*/,"")),t(18,Xt=void 0),t(55,Te=void 0),t(15,nt=-1);else if(Ee){const Fe=j||!dn(Ee);Un(Ee,{exact:!0}).then(()=>{t(55,Te=st),t(56,mt=void 0),Fe&&Wr()}).catch(Ke=>t(18,Xt=Ke))}}function dn(j){try{return fx(j,6)}catch{return!1}}async function Un(j,{byId:Fe=!1,exact:Ke=!1}={}){t(18,Xt=void 0),$i==null||$i.abort();const Ne=new AbortController;t(19,$i=Ne);try{const Xe=dn(j),_t=new URLSearchParams;if(Se!==void 0&&_t.set("language",Array.isArray(Se)?Se.join(","):Se??""),ut&&_t.set("types",ut.join(",")),at&&_t.set("excludeTypes",String(at)),k&&_t.set("bbox",k.map(ci=>ci.toFixed(6)).join(",")),R&&_t.set("country",Array.isArray(R)?R.join(","):R),!Fe&&!Xe){const ci=await ix(te,ce,Ne);ci&&_t.set("proximity",ci),(Ke||!it)&&_t.set("autocomplete","false"),_t.set("fuzzyMatch",String(le))}Le!==void 0&&(et||!Xe||(ut==null?void 0:ut.length)===1)&&_t.set("limit",String(Le)),_t.set("key",y),si(_t);const Et=Dt+"/"+encodeURIComponent(Xe?Xe.decimalLongitude+","+Xe.decimalLatitude:j)+".json?"+_t.toString();if(Et===yt){Fe?(t(14,st=void 0),t(56,mt=wi[0])):t(14,st=wi);return}yt=Et;const pi=await fetch(Et,{signal:Ne.signal,...Ht});if(!pi.ok)throw new Error(await pi.text());const Qt=await pi.json();ct("response",{url:Et,featureCollection:Qt}),Fe?(t(14,st=void 0),t(56,mt=Qt.features[0]),wi=[mt]):(t(14,st=Qt.features.filter(G)),Xe&&st.unshift({type:"Feature",properties:{},id:"reverse_"+Xe.decimalLongitude+"_"+Xe.decimalLatitude,text:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_name:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_type:["reverse"],center:[Xe.decimalLongitude,Xe.decimalLatitude],bbox:[Xe.decimalLongitude,Xe.decimalLatitude,Xe.decimalLongitude,Xe.decimalLatitude],geometry:{type:"Point",coordinates:[Xe.decimalLongitude,Xe.decimalLatitude]}}),wi=st,Xe&&Ie.focus())}catch(Xe){if(Xe&&typeof Xe=="object"&&"name"in Xe&&Xe.name==="AbortError")return;throw Xe}finally{Ne===$i&&t(19,$i=void 0)}}function Wr(){var j;if(!(Te!=null&&Te.length)||!K)return;const Fe=[180,90,-180,-90],Ke=!Te.some(Xe=>!Xe.matching_text);let Ne;for(const Xe of Te){const _t=vt(Xe);if(Ne=Ne===void 0?_t:_t===void 0?Ne:Math.max(Ne,_t),Ke||!Xe.matching_text)for(const Et of[0,1,2,3])Fe[Et]=Math[Et<2?"min":"max"](Fe[Et],((j=Xe.bbox)==null?void 0:j[Et])??Xe.center[Et%2])}te&&Te.length>0&&(mt&&Fe[0]===Fe[2]&&Fe[1]===Fe[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Ed(Fe),50,Ne))}function vt(j){var Fe;if(!j.bbox||j.bbox[0]!==j.bbox[2]&&j.bbox[1]!==j.bbox[3])return;const Ke=j.id.replace(/\..*/,"");return(Array.isArray((Fe=j.properties)==null?void 0:Fe.categories)?j.properties.categories.reduce((Ne,Xe)=>{const _t=Bt[Ke+"."+Xe];return Ne===void 0?_t:_t===void 0?Ne:Math.max(Ne,_t)},void 0):void 0)??Bt[Ke]}function li(j){t(0,ae=U==="always"),t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1),vi(j[1].toFixed(6)+", "+tx(j[0],[-180,180],!0).toFixed(6),!1,!0)}function Jt(j){if(!st)return;let Fe=j.key==="ArrowDown"?1:j.key==="ArrowUp"?-1:0;Fe&&(nt===(Qe?0:-1)&&Fe===-1&&t(15,nt=st.length),t(15,nt+=Fe),nt>=st.length&&t(15,nt=-1),nt<0&&Qe&&t(15,nt=0),j.preventDefault())}function Sn(j=!0,Fe=!1){if(t(18,Xt=void 0),it||Fe){if(Li&&clearTimeout(Li),Ee.length<Y)return;const Ke=Ee;Li=window.setTimeout(()=>{Un(Ke).catch(Ne=>t(18,Xt=Ne))},j?Z:0)}else t(14,st=void 0),t(18,Xt=void 0)}function Bn(j){t(56,mt=j),t(1,Ee=j.place_name),t(15,nt=-1)}const ei=()=>Ie.focus();function vr(j){yp[j?"unshift":"push"](()=>{Ie=j,t(17,Ie)})}function Fr(){Ee=this.value,t(1,Ee),t(13,qe),t(28,L)}const Hr=()=>t(13,qe=!0),wr=()=>t(13,qe=!1),ye=()=>Sn(),q=()=>{t(1,Ee=""),Ie.focus()},V=()=>t(0,ae=!ae),re=()=>t(18,Xt=void 0),pe=j=>t(15,nt=j),Me=j=>Bn(j),De=()=>{Qe||t(15,nt=-1)},Ue=()=>{};return o.$$set=j=>{"class"in j&&t(2,g=j.class),"apiKey"in j&&t(26,y=j.apiKey),"bbox"in j&&t(27,k=j.bbox),"clearButtonTitle"in j&&t(3,S=j.clearButtonTitle),"clearOnBlur"in j&&t(28,L=j.clearOnBlur),"collapsed"in j&&t(4,P=j.collapsed),"country"in j&&t(29,R=j.country),"debounceSearch"in j&&t(30,Z=j.debounceSearch),"enableReverse"in j&&t(5,U=j.enableReverse),"errorMessage"in j&&t(6,H=j.errorMessage),"filter"in j&&t(31,G=j.filter),"flyTo"in j&&t(32,K=j.flyTo),"fuzzyMatch"in j&&t(33,le=j.fuzzyMatch),"language"in j&&t(34,Se=j.language),"limit"in j&&t(35,Le=j.limit),"mapController"in j&&t(36,te=j.mapController),"minLength"in j&&t(37,Y=j.minLength),"noResultsMessage"in j&&t(7,ue=j.noResultsMessage),"placeholder"in j&&t(8,fe=j.placeholder),"proximity"in j&&t(38,ce=j.proximity),"reverseActive"in j&&t(0,ae=j.reverseActive),"reverseButtonTitle"in j&&t(9,Ge=j.reverseButtonTitle),"searchValue"in j&&t(1,Ee=j.searchValue),"pickedResultStyle"in j&&t(39,ze=j.pickedResultStyle),"showPlaceType"in j&&t(10,rt=j.showPlaceType),"showResultsWhileTyping"in j&&t(40,it=j.showResultsWhileTyping),"selectFirst"in j&&t(11,Qe=j.selectFirst),"flyToSelected"in j&&t(41,Ft=j.flyToSelected),"markerOnSelected"in j&&t(42,jt=j.markerOnSelected),"types"in j&&t(43,ut=j.types),"exhaustiveReverseGeocoding"in j&&t(44,et=j.exhaustiveReverseGeocoding),"excludeTypes"in j&&t(45,at=j.excludeTypes),"zoom"in j&&t(46,Bt=j.zoom),"apiUrl"in j&&t(47,Dt=j.apiUrl),"fetchParameters"in j&&t(48,Ht=j.fetchParameters),"iconsBaseUrl"in j&&t(12,ai=j.iconsBaseUrl),"adjustUrlQuery"in j&&t(49,si=j.adjustUrlQuery),"$$scope"in j&&t(60,d=j.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ae=U==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,gi=qe),L&&!qe&&t(1,Ee="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ee.length<Y&&(t(56,mt=void 0),t(14,st=void 0),t(18,Xt=void 0),t(55,Te=st)),o.$$.dirty[1]&33554688&&ze!=="marker-only"&&mt&&!mt.address&&mt.geometry.type==="Point"&&mt.place_type[0]!=="reverse"&&Un(mt.id,{byId:!0}).catch(j=>t(18,Xt=j)),o.$$.dirty[1]&100663330&&(te&&mt&&mt.id!==Fi&&K&&(!mt.bbox||mt.bbox[0]===mt.bbox[2]&&mt.bbox[1]===mt.bbox[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Ed(mt.bbox),50,vt(mt)),t(14,st=void 0),t(55,Te=void 0),t(15,nt=-1)),t(57,Fi=mt==null?void 0:mt.id)),o.$$.dirty[0]&18432&&Qe&&st!=null&&st.length&&t(15,nt=0),o.$$.dirty[0]&2&&t(15,nt=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&Te!==st&&t(55,Te=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&te&&te.setEventHandler(j=>{switch(j.type){case"mapClick":ae&&li(j.coordinates);break;case"markerClick":{const Fe=st==null?void 0:st.find(Ke=>Ke.id===j.id);Fe&&Bn(Fe)}break;case"markerMouseEnter":Te&&t(15,nt=gi?(st==null?void 0:st.findIndex(Fe=>Fe.id===j.id))??-1:-1);break;case"markerMouseLeave":Te&&t(15,nt=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=st==null?void 0:st[nt]),o.$$.dirty[1]&134218786&&te&&l&&K&&Ft&&te.flyTo(l.center,vt(l)),o.$$.dirty[1]&256&&t(59,r=ze==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(jt||te==null||te.setFeatures(void 0,void 0,r)),o.$$.dirty[1]&419432480&&te&&jt&&!Te&&(te.setFeatures(l?[l]:void 0,void 0,r),te.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&te&&te.setFeatures(Te,mt,r),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&Te&&te&&te.setSelectedMarker(nt),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&te){const j=dn(Ee);te.setReverseMarker(j?[j.decimalLongitude,j.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&ct("select",{feature:l}),o.$$.dirty[1]&33554432&&ct("pick",{feature:mt}),o.$$.dirty[0]&81920&&ct("optionsvisibilitychange",{optionsVisible:gi&&!!st}),o.$$.dirty[0]&16384&&ct("featureslisted",{features:st}),o.$$.dirty[1]&16777216&&ct("featuresmarked",{features:Te}),o.$$.dirty[0]&1&&ct("reversetoggle",{reverse:ae}),o.$$.dirty[0]&2&&ct("querychange",{query:Ee}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&te&&te.indicateReverse(ae)},[ae,Ee,g,S,P,U,H,ue,fe,Ge,rt,Qe,ai,qe,st,nt,gi,Ie,Xt,$i,br,tr,Jt,Sn,Bn,s,y,k,L,R,Z,G,K,le,Se,Le,te,Y,ce,ze,it,Ft,jt,ut,et,at,Bt,Dt,Ht,si,Si,Ri,vi,di,lt,Te,mt,Fi,l,r,d,u,ei,vr,Fr,Hr,wr,ye,q,V,re,pe,Me,De,Ue]}let vx=class extends xa{constructor(o){super(),wa(this,o,bx,yx,va,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function th(o,e,t={}){const r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=o,r}function Vp(o,e,t={}){for(const r of o){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<r[r.length-1].length;l++)if(r[r.length-1][l]!==r[0][l])throw new Error("First and last Position are not equivalent.")}return th({type:"Polygon",coordinates:o},e,t)}function ih(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function y1(o,e,t={}){return th({type:"MultiPolygon",coordinates:o},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function wx(o,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},r,l,u,d;return d={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function s(y){return function(k){return g([y,k])}}function g(y){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,l&&(u=y[0]&2?l.return:y[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,y[1])).done)return u;switch(l=0,u&&(y=[y[0]&2,u.value]),y[0]){case 0:case 1:u=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,l=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!u||y[1]>u[0]&&y[1]<u[3])){t.label=y[1];break}if(y[0]===6&&t.label<u[1]){t.label=u[1],u=y;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(y);break}u[2]&&t.ops.pop(),t.trys.pop();continue}y=e.call(o,t)}catch(k){y=[6,k],l=0}finally{r=u=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var ga=function(){function o(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return o}();function xx(o,e){return o>e?1:o<e?-1:0}function ca(o,e,t){for(var r=new ga(null,null),l=r,u=r;;){var d=t(o,e.key);if(d<0){if(e.left===null)break;if(t(o,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(o,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=r.right,e.right=r.left,e}function lp(o,e,t,r){var l=new ga(o,e);if(t===null)return l.left=l.right=null,l;t=ca(o,t,r);var u=r(o,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function cg(o,e,t){var r=null,l=null;if(e){e=ca(o,e,t);var u=t(e.key,o);u===0?(r=e.left,l=e.right):u<0?(l=e.right,e.right=null,r=e):(r=e.left,e.left=null,l=e)}return{left:r,right:l}}function kx(o,e,t){return e===null?o:(o===null||(e=ca(o.key,e,t),e.left=o),e)}function wp(o,e,t,r,l){if(o){r(""+e+(t?"└── ":"├── ")+l(o)+`
`);var u=e+(t?"    ":"│   ");o.left&&wp(o.left,u,!1,r,l),o.right&&wp(o.right,u,!0,r,l)}}var qp=function(){function o(e){e===void 0&&(e=xx),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=lp(e,t,this._root,this._comparator)},o.prototype.add=function(e,t){var r=new ga(e,t);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var l=this._comparator,u=ca(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(r.left=u.left,r.right=u,u.left=null):d>0&&(r.right=u.right,r.left=u,u.right=null),this._size++,this._root=r),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,r){var l;if(t===null)return null;t=ca(e,t,r);var u=r(e,t.key);return u===0?(t.left===null?l=t.right:(l=ca(e,t.left,r),l.right=t.right),this._size--,l):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ca(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var l=r(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=ca(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},o.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var l=r(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},o.prototype.forEach=function(e,t){for(var r=this._root,l=[],u=!1;!u;)r!==null?(l.push(r),r=r.left):l.length!==0?(r=l.pop(),e.call(t,r),r=r.right):u=!0;return this},o.prototype.range=function(e,t,r,l){for(var u=[],d=this._comparator,s=this._root,g;u.length!==0||s;)if(s)u.push(s),s=s.left;else{if(s=u.pop(),g=d(s.key,t),g>0)break;if(d(s.key,e)>=0&&r.call(l,s))return this;s=s.right}return this},o.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},o.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,r=!1,l=0,u=[];!r;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else r=!0;return null},o.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(r=t,t=t.left):t=t.right}return r},o.prototype.prev=function(e){var t=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(r=t,t=t.right)}return r},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return Tx(this._root)},o.prototype.load=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var l=e.length,u=this._comparator;if(r&&Sp(e,t,0,l-1,u),this._root===null)this._root=xp(e,t,0,l),this._size=l;else{var d=Ix(this.toList(),Sx(e,t),u);l=this._size+l,this._root=kp({head:d},0,l)}return this},o.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var t=[];return wp(this._root,"",!0,function(r){return t.push(r)},e),t.join("")},o.prototype.update=function(e,t,r){var l=this._comparator,u=cg(e,this._root,l),d=u.left,s=u.right;l(e,t)<0?s=lp(t,r,s,l):d=lp(t,r,d,l),this._root=kx(d,s,l)},o.prototype.split=function(e){return cg(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var e,t,r;return wx(this,function(l){switch(l.label){case 0:e=this._root,t=[],r=!1,l.label=1;case 1:return r?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:r=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},o}();function xp(o,e,t,r){var l=r-t;if(l>0){var u=t+Math.floor(l/2),d=o[u],s=e[u],g=new ga(d,s);return g.left=xp(o,e,t,u),g.right=xp(o,e,u+1,r),g}return null}function Sx(o,e){for(var t=new ga(null,null),r=t,l=0;l<o.length;l++)r=r.next=new ga(o[l],e[l]);return r.next=null,t.next}function Tx(o){for(var e=o,t=[],r=!1,l=new ga(null,null),u=l;!r;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):r=!0;return u.next=null,l.next}function kp(o,e,t){var r=t-e;if(r>0){var l=e+Math.floor(r/2),u=kp(o,e,l),d=o.head;return d.left=u,o.head=o.head.next,d.right=kp(o,l+1,t),d}return null}function Ix(o,e,t){for(var r=new ga(null,null),l=r,u=o,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),r.next}function Sp(o,e,t,r,l){if(!(t>=r)){for(var u=o[t+r>>1],d=t-1,s=r+1;;){do d++;while(l(o[d],u)<0);do s--;while(l(o[s],u)>0);if(d>=s)break;var g=o[d];o[d]=o[s],o[s]=g,g=e[d],e[d]=e[s],e[s]=g}Sp(o,e,t,s,l),Sp(o,e,s+1,r,l)}}const ks=11102230246251565e-32,Mr=134217729,Cx=(3+8*ks)*ks;function cp(o,e,t,r,l){let u,d,s,g,y=e[0],k=r[0],S=0,L=0;k>y==k>-y?(u=y,y=e[++S]):(u=k,k=r[++L]);let P=0;if(S<o&&L<t)for(k>y==k>-y?(d=y+u,s=u-(d-y),y=e[++S]):(d=k+u,s=u-(d-k),k=r[++L]),u=d,s!==0&&(l[P++]=s);S<o&&L<t;)k>y==k>-y?(d=u+y,g=d-u,s=u-(d-g)+(y-g),y=e[++S]):(d=u+k,g=d-u,s=u-(d-g)+(k-g),k=r[++L]),u=d,s!==0&&(l[P++]=s);for(;S<o;)d=u+y,g=d-u,s=u-(d-g)+(y-g),y=e[++S],u=d,s!==0&&(l[P++]=s);for(;L<t;)d=u+k,g=d-u,s=u-(d-g)+(k-g),k=r[++L],u=d,s!==0&&(l[P++]=s);return(u!==0||P===0)&&(l[P++]=u),P}function Ex(o,e){let t=e[0];for(let r=1;r<o;r++)t+=e[r];return t}function lh(o){return new Float64Array(o)}const Lx=(3+16*ks)*ks,Mx=(2+12*ks)*ks,Ax=(9+64*ks)*ks*ks,ec=lh(4),ug=lh(8),hg=lh(12),dg=lh(16),Zr=lh(4);function Px(o,e,t,r,l,u,d){let s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le,te,Y;const ue=o-l,fe=t-l,ce=e-u,ae=r-u;le=ue*ae,L=Mr*ue,P=L-(L-ue),R=ue-P,L=Mr*ae,Z=L-(L-ae),U=ae-Z,Se=R*U-(le-P*Z-R*Z-P*U),Le=ce*fe,L=Mr*ce,P=L-(L-ce),R=ce-P,L=Mr*fe,Z=L-(L-fe),U=fe-Z,te=R*U-(Le-P*Z-R*Z-P*U),H=Se-te,S=Se-H,ec[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,ec[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,ec[2]=G-(Y-S)+(H-S),ec[3]=Y;let Ge=Ex(4,ec),Ee=Mx*d;if(Ge>=Ee||-Ge>=Ee||(S=o-ue,s=o-(ue+S)+(S-l),S=t-fe,y=t-(fe+S)+(S-l),S=e-ce,g=e-(ce+S)+(S-u),S=r-ae,k=r-(ae+S)+(S-u),s===0&&g===0&&y===0&&k===0)||(Ee=Ax*d+Cx*Math.abs(Ge),Ge+=ue*k+ae*s-(ce*y+fe*g),Ge>=Ee||-Ge>=Ee))return Ge;le=s*ae,L=Mr*s,P=L-(L-s),R=s-P,L=Mr*ae,Z=L-(L-ae),U=ae-Z,Se=R*U-(le-P*Z-R*Z-P*U),Le=g*fe,L=Mr*g,P=L-(L-g),R=g-P,L=Mr*fe,Z=L-(L-fe),U=fe-Z,te=R*U-(Le-P*Z-R*Z-P*U),H=Se-te,S=Se-H,Zr[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,Zr[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,Zr[2]=G-(Y-S)+(H-S),Zr[3]=Y;const ze=cp(4,ec,4,Zr,ug);le=ue*k,L=Mr*ue,P=L-(L-ue),R=ue-P,L=Mr*k,Z=L-(L-k),U=k-Z,Se=R*U-(le-P*Z-R*Z-P*U),Le=ce*y,L=Mr*ce,P=L-(L-ce),R=ce-P,L=Mr*y,Z=L-(L-y),U=y-Z,te=R*U-(Le-P*Z-R*Z-P*U),H=Se-te,S=Se-H,Zr[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,Zr[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,Zr[2]=G-(Y-S)+(H-S),Zr[3]=Y;const rt=cp(ze,ug,4,Zr,hg);le=s*k,L=Mr*s,P=L-(L-s),R=s-P,L=Mr*k,Z=L-(L-k),U=k-Z,Se=R*U-(le-P*Z-R*Z-P*U),Le=g*y,L=Mr*g,P=L-(L-g),R=g-P,L=Mr*y,Z=L-(L-y),U=y-Z,te=R*U-(Le-P*Z-R*Z-P*U),H=Se-te,S=Se-H,Zr[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,Zr[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,Zr[2]=G-(Y-S)+(H-S),Zr[3]=Y;const it=cp(rt,hg,4,Zr,dg);return dg[it-1]}function zx(o,e,t,r,l,u){const d=(e-u)*(t-l),s=(o-l)*(r-u),g=d-s,y=Math.abs(d+s);return Math.abs(g)>=Lx*y?g:-Px(o,e,t,r,l,u,y)}const Ru=(o,e)=>o.ll.x<=e.x&&e.x<=o.ur.x&&o.ll.y<=e.y&&e.y<=o.ur.y,Tp=(o,e)=>{if(e.ur.x<o.ll.x||o.ur.x<e.ll.x||e.ur.y<o.ll.y||o.ur.y<e.ll.y)return null;const t=o.ll.x<e.ll.x?e.ll.x:o.ll.x,r=o.ur.x<e.ur.x?o.ur.x:e.ur.x,l=o.ll.y<e.ll.y?e.ll.y:o.ll.y,u=o.ur.y<e.ur.y?o.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:r,y:u}}};let ua=Number.EPSILON;ua===void 0&&(ua=Math.pow(2,-52));const Dx=ua*ua,fg=(o,e)=>{if(-ua<o&&o<ua&&-ua<e&&e<ua)return 0;const t=o-e;return t*t<Dx*o*e?0:o<e?-1:1};class Rx{constructor(){this.reset()}reset(){this.xRounder=new pg,this.yRounder=new pg}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class pg{constructor(){this.tree=new qp,this.round(0)}round(e){const t=this.tree.add(e),r=this.tree.prev(t);if(r!==null&&fg(t.key,r.key)===0)return this.tree.remove(e),r.key;const l=this.tree.next(t);return l!==null&&fg(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const nh=new Rx,Sd=(o,e)=>o.x*e.y-o.y*e.x,b1=(o,e)=>o.x*e.x+o.y*e.y,mg=(o,e,t)=>{const r=zx(o.x,o.y,e.x,e.y,t.x,t.y);return r>0?-1:r<0?1:0},Ld=o=>Math.sqrt(b1(o,o)),Fx=(o,e,t)=>{const r={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return Sd(l,r)/Ld(l)/Ld(r)},Bx=(o,e,t)=>{const r={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return b1(l,r)/Ld(l)/Ld(r)},_g=(o,e,t)=>e.y===0?null:{x:o.x+e.x/e.y*(t-o.y),y:t},gg=(o,e,t)=>e.x===0?null:{x:t,y:o.y+e.y/e.x*(t-o.x)},Ox=(o,e,t,r)=>{if(e.x===0)return gg(t,r,o.x);if(r.x===0)return gg(o,e,t.x);if(e.y===0)return _g(t,r,o.y);if(r.y===0)return _g(o,e,t.y);const l=Sd(e,r);if(l==0)return null;const u={x:t.x-o.x,y:t.y-o.y},d=Sd(u,e)/l,s=Sd(u,r)/l,g=o.x+s*e.x,y=t.x+d*r.x,k=o.y+s*e.y,S=t.y+d*r.y,L=(g+y)/2,P=(k+S)/2;return{x:L,y:P}};class Lo{static compare(e,t){const r=Lo.comparePoints(e.point,t.point);return r!==0?r:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:pa.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let r=0,l=t.length;r<l;r++){const u=t[r];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const r=this.point.events[t];if(r.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&r.otherSE.point.events===u.otherSE.point.events&&r.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,r=this.point.events.length;t<r;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,r=l=>{const u=l.otherSE;t.set(l,{sine:Fx(this.point,e.point,u.point),cosine:Bx(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||r(l),t.has(u)||r(u);const{sine:d,cosine:s}=t.get(l),{sine:g,cosine:y}=t.get(u);return d>=0&&g>=0?s<y?1:s>y?-1:0:d<0&&g<0?s<y?-1:s>y?1:0:g<d?-1:g>d?1:0}}}let Nx=0;class pa{static compare(e,t){const r=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<r)return 1;if(u<l)return-1;const s=e.leftSE.point.y,g=t.leftSE.point.y,y=e.rightSE.point.y,k=t.rightSE.point.y;if(r<l){if(g<s&&g<y)return 1;if(g>s&&g>y)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const L=t.comparePoint(e.rightSE.point);return L!==0?L:-1}if(r>l){if(s<g&&s<k)return-1;if(s>g&&s>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const L=e.comparePoint(t.rightSE.point);return L<0?1:L>0?-1:1}if(s<g)return-1;if(s>g)return 1;if(u<d){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>d){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==d){const S=y-s,L=u-r,P=k-g,R=d-l;if(S>L&&P<R)return 1;if(S<L&&P>R)return-1}return u>d?1:u<d||y<k?-1:y>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,r,l){this.id=++Nx,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=l}static fromRing(e,t,r){let l,u,d;const s=Lo.comparePoints(e,t);if(s<0)l=e,u=t,d=1;else if(s>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const g=new Lo(l,!0),y=new Lo(u,!1);return new pa(g,y,[r],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,r=this.rightSE.point,l=this.vector();if(t.x===r.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const s=(e.x-t.x)/l.x,g=t.y+s*l.y;return e.y===g?0:e.y<g?-1:1}getIntersection(e){const t=this.bbox(),r=e.bbox(),l=Tp(t,r);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,s=e.leftSE.point,g=e.rightSE.point,y=Ru(t,s)&&this.comparePoint(s)===0,k=Ru(r,u)&&e.comparePoint(u)===0,S=Ru(t,g)&&this.comparePoint(g)===0,L=Ru(r,d)&&e.comparePoint(d)===0;if(k&&y)return L&&!S?d:!L&&S?g:null;if(k)return S&&u.x===g.x&&u.y===g.y?null:u;if(y)return L&&d.x===s.x&&d.y===s.y?null:s;if(L&&S)return null;if(L)return d;if(S)return g;const P=Ox(u,this.vector(),s,e.vector());return P===null||!Ru(l,P)?null:nh.round(P.x,P.y)}split(e){const t=[],r=e.events!==void 0,l=new Lo(e,!0),u=new Lo(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const s=new pa(l,d,this.rings.slice(),this.windings.slice());return Lo.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),Lo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,r=this.windings.length;t<r;t++)this.windings[t]*=-1}consume(e){let t=this,r=e;for(;t.consumedBy;)t=t.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const l=pa.compare(t,r);if(l!==0){if(l>0){const u=t;t=r,r=u}if(t.prev===r){const u=t;t=r,r=u}for(let u=0,d=r.rings.length;u<d;u++){const s=r.rings[u],g=r.windings[u],y=t.rings.indexOf(s);y===-1?(t.rings.push(s),t.windings.push(g)):t.windings[y]+=g}r.rings=null,r.windings=null,r.consumedBy=t,r.leftSE.consumedBy=t.leftSE,r.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,r=this._afterState.windings,l=this._afterState.multiPolys;for(let s=0,g=this.rings.length;s<g;s++){const y=this.rings[s],k=this.windings[s],S=t.indexOf(y);S===-1?(t.push(y),r.push(k)):r[S]+=k}const u=[],d=[];for(let s=0,g=t.length;s<g;s++){if(r[s]===0)continue;const y=t[s],k=y.poly;if(d.indexOf(k)===-1)if(y.isExterior)u.push(k);else{d.indexOf(k)===-1&&d.push(k);const S=u.indexOf(y.poly);S!==-1&&u.splice(S,1)}}for(let s=0,g=u.length;s<g;s++){const y=u[s].multiPoly;l.indexOf(y)===-1&&l.push(y)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch($o.type){case"union":{const r=e.length===0,l=t.length===0;this._isInResult=r!==l;break}case"intersection":{let r,l;e.length<t.length?(r=e.length,l=t.length):(r=t.length,l=e.length),this._isInResult=l===$o.numMultiPolys&&r<l;break}case"xor":{const r=Math.abs(e.length-t.length);this._isInResult=r%2===1;break}case"difference":{const r=l=>l.length===1&&l[0].isSubject;this._isInResult=r(e)!==r(t);break}default:throw new Error(`Unrecognized operation type found ${$o.type}`)}return this._isInResult}}class yg{constructor(e,t,r){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=nh.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,s=e.length;d<s;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let g=nh.round(e[d][0],e[d][1]);g.x===u.x&&g.y===u.y||(this.segments.push(pa.fromRing(u,g,this)),g.x<this.bbox.ll.x&&(this.bbox.ll.x=g.x),g.y<this.bbox.ll.y&&(this.bbox.ll.y=g.y),g.x>this.bbox.ur.x&&(this.bbox.ur.x=g.x),g.y>this.bbox.ur.y&&(this.bbox.ur.y=g.y),u=g)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(pa.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,r=this.segments.length;t<r;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class jx{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new yg(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,l=e.length;r<l;r++){const u=new yg(e[r],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,r=this.interiorRings.length;t<r;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class bg{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let r=0,l=e.length;r<l;r++){const u=new jx(e[r],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,r=this.polys.length;t<r;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class Md{static factory(e){const t=[];for(let r=0,l=e.length;r<l;r++){const u=e[r];if(!u.isInResult()||u.ringOut)continue;let d=null,s=u.leftSE,g=u.rightSE;const y=[s],k=s.point,S=[];for(;d=s,s=g,y.push(s),s.point!==k;)for(;;){const L=s.getAvailableLinkedEvents();if(L.length===0){const Z=y[0].point,U=y[y.length-1].point;throw new Error(`Unable to complete output ring starting at [${Z.x}, ${Z.y}]. Last matching segment found ends at [${U.x}, ${U.y}].`)}if(L.length===1){g=L[0].otherSE;break}let P=null;for(let Z=0,U=S.length;Z<U;Z++)if(S[Z].point===s.point){P=Z;break}if(P!==null){const Z=S.splice(P)[0],U=y.splice(Z.index);U.unshift(U[0].otherSE),t.push(new Md(U.reverse()));continue}S.push({index:y.length,point:s.point});const R=s.getLeftmostComparator(d);g=L.sort(R)[0].otherSE;break}t.push(new Md(y))}return t}constructor(e){this.events=e;for(let t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let y=1,k=this.events.length-1;y<k;y++){const S=this.events[y].point,L=this.events[y+1].point;mg(S,e,L)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const r=t[0],l=t[1];mg(r,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,g=[];for(let y=d;y!=s;y+=u)g.push([t[y].x,t[y].y]);return g}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];Lo.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),r=t?t.prevInResult():null;for(;;){if(!t)return null;if(!r)return t.ringOut;if(r.ringOut!==t.ringOut)return r.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=r.prevInResult(),r=t?t.prevInResult():null}}}class vg{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,r=this.interiorRings.length;t<r;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class $x{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,r=this.polys.length;t<r;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let r=0,l=e.length;r<l;r++){const u=e[r];if(!u.poly)if(u.isExteriorRing())t.push(new vg(u));else{const d=u.enclosingRing();d.poly||t.push(new vg(d)),d.poly.addInterior(u)}}return t}}class Ux{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pa.compare;this.queue=e,this.tree=new qp(t),this.segments=[]}process(e){const t=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),r;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,s,g;for(;s===void 0;)u=this.tree.prev(u),u===null?s=null:u.key.consumedBy===void 0&&(s=u.key);for(;g===void 0;)d=this.tree.next(d),d===null?g=null:d.key.consumedBy===void 0&&(g=d.key);if(e.isLeft){let y=null;if(s){const S=s.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(y=S),!s.isAnEndpoint(S))){const L=this._splitSafely(s,S);for(let P=0,R=L.length;P<R;P++)r.push(L[P])}}let k=null;if(g){const S=g.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!g.isAnEndpoint(S))){const L=this._splitSafely(g,S);for(let P=0,R=L.length;P<R;P++)r.push(L[P])}}if(y!==null||k!==null){let S=null;y===null?S=k:k===null?S=y:S=Lo.comparePoints(y,k)<=0?y:k,this.queue.remove(t.rightSE),r.push(t.rightSE);const L=t.split(S);for(let P=0,R=L.length;P<R;P++)r.push(L[P])}r.length>0?(this.tree.remove(t),r.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&g){const y=s.getIntersection(g);if(y!==null){if(!s.isAnEndpoint(y)){const k=this._splitSafely(s,y);for(let S=0,L=k.length;S<L;S++)r.push(k[S])}if(!g.isAnEndpoint(y)){const k=this._splitSafely(g,y);for(let S=0,L=k.length;S<L;S++)r.push(k[S])}}}this.tree.remove(t)}return r}_splitSafely(e,t){this.tree.remove(e);const r=e.rightSE;this.queue.remove(r);const l=e.split(t);return l.push(r),e.consumedBy===void 0&&this.tree.add(e),l}}const wg=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Vx=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class qx{run(e,t,r){$o.type=e,nh.reset();const l=[new bg(t,!0)];for(let k=0,S=r.length;k<S;k++)l.push(new bg(r[k],!1));if($o.numMultiPolys=l.length,$o.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)Tp(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if($o.type==="intersection")for(let k=0,S=l.length;k<S;k++){const L=l[k];for(let P=k+1,R=l.length;P<R;P++)if(Tp(L.bbox,l[P].bbox)===null)return[]}const u=new qp(Lo.compare);for(let k=0,S=l.length;k<S;k++){const L=l[k].getSweepEvents();for(let P=0,R=L.length;P<R;P++)if(u.insert(L[P]),u.size>wg)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new Ux(u);let s=u.size,g=u.pop();for(;g;){const k=g.key;if(u.size===s){const L=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${L.id} [${L.leftSE.point.x}, ${L.leftSE.point.y}] -> [${L.rightSE.point.x}, ${L.rightSE.point.y}] from queue.`)}if(u.size>wg)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>Vx)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=d.process(k);for(let L=0,P=S.length;L<P;L++){const R=S[L];R.consumedBy===void 0&&u.insert(R)}s=u.size,g=u.pop()}nh.reset();const y=Md.factory(d.segments);return new $x(y).getGeom()}}const $o=new qx,Zx=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return $o.run("union",o,t)},Gx=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return $o.run("intersection",o,t)},Wx=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return $o.run("xor",o,t)},Hx=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return $o.run("difference",o,t)};var v1={union:Zx,intersection:Gx,xor:Wx,difference:Hx};function w1(o,e,t){if(o!==null)for(var r,l,u,d,s,g,y,k=0,S=0,L,P=o.type,R=P==="FeatureCollection",Z=P==="Feature",U=R?o.features.length:1,H=0;H<U;H++){y=R?o.features[H].geometry:Z?o.geometry:o,L=y?y.type==="GeometryCollection":!1,s=L?y.geometries.length:1;for(var G=0;G<s;G++){var K=0,le=0;if(d=L?y.geometries[G]:y,d!==null){g=d.coordinates;var Se=d.type;switch(k=0,Se){case null:break;case"Point":if(e(g,S,H,K,le)===!1)return!1;S++,K++;break;case"LineString":case"MultiPoint":for(r=0;r<g.length;r++){if(e(g[r],S,H,K,le)===!1)return!1;S++,Se==="MultiPoint"&&K++}Se==="LineString"&&K++;break;case"Polygon":case"MultiLineString":for(r=0;r<g.length;r++){for(l=0;l<g[r].length-k;l++){if(e(g[r][l],S,H,K,le)===!1)return!1;S++}Se==="MultiLineString"&&K++,Se==="Polygon"&&le++}Se==="Polygon"&&K++;break;case"MultiPolygon":for(r=0;r<g.length;r++){for(le=0,l=0;l<g[r].length;l++){for(u=0;u<g[r][l].length-k;u++){if(e(g[r][l][u],S,H,K,le)===!1)return!1;S++}le++}K++}break;case"GeometryCollection":for(r=0;r<d.geometries.length;r++)if(w1(d.geometries[r],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Zp(o,e){var t,r,l,u,d,s,g,y,k,S,L=0,P=o.type==="FeatureCollection",R=o.type==="Feature",Z=P?o.features.length:1;for(t=0;t<Z;t++){for(s=P?o.features[t].geometry:R?o.geometry:o,y=P?o.features[t].properties:R?o.properties:{},k=P?o.features[t].bbox:R?o.bbox:void 0,S=P?o.features[t].id:R?o.id:void 0,g=s?s.type==="GeometryCollection":!1,d=g?s.geometries.length:1,l=0;l<d;l++){if(u=g?s.geometries[l]:s,u===null){if(e(null,L,y,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,L,y,k,S)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(e(u.geometries[r],L,y,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}L++}}function Xx(o,e){Zp(o,function(t,r,l,u,d){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(th(t,l,{bbox:u,id:d}),r,0)===!1?!1:void 0}var g;switch(s){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var y=0;y<t.coordinates.length;y++){var k=t.coordinates[y],S={type:g,coordinates:k};if(e(th(S,l),r,y)===!1)return!1}})}function Kx(o,e={}){const t=[];if(Zp(o,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const r=v1.union(t[0],...t.slice(1));return r.length===0?null:r.length===1?Vp(r[0],e.properties):y1(r,e.properties)}var x1=Kx;function Jx(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return w1(o,r=>{t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}var xg=Jx;function Yx(o){const e=[];if(Zp(o,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=o.features[0].properties||{},r=v1.difference(e[0],...e.slice(1));return r.length===0?null:r.length===1?Vp(r[0],t):y1(r,t)}var Qx=Yx;function e2(o){if(!o)throw new Error("geojson is required");var e=[];return Xx(o,function(t){e.push(t)}),ih(e)}var t2=e2;function kg(o,e){const t=Qx(ih([Vp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),o]));if(!t)return;t.properties={isMask:!0};const r=Ed(xg(o)),l=(r[2]-r[0])/360/1e3,u=r[0]<-180,d=r[2]>180,s=t2(o);if(s.features.length>1&&(u||d))for(const g of s.features){const y=Ed(xg(g));if(d&&y[0]<-180+l)for(const k of g.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&y[2]>180-l)for(const k of g.geometry.coordinates)for(const S of k)S[0]-=360-l}e(ih([s.features.length<2?o:x1(s)??o,t]))}const Sg={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},md="mtlr-gc-full-geom",Tg="mtlr-gc-full-geom-fill",Ig="mtlr-gc-full-geom-line";function k1(o,e,t=!0,r=!0,l={},u={},d=Sg){let s;const g=[];let y,k,S;function L(){if(!o.loaded){o.once("load",L);return}const U=d?d===!0?Sg:d:void 0;if(!(U!=null&&U.fill)&&!(U!=null&&U.line))return;const H=o.getSource(md);if(H)H.setData(S??ih([]));else if(S)o.addSource(md,{type:"geojson",data:S});else return;!o.getLayer(Tg)&&U!=null&&U.fill&&o.addLayer({...U==null?void 0:U.fill,id:Tg,type:"fill",source:md}),!o.getLayer(Ig)&&U!=null&&U.line&&o.addLayer({...U==null?void 0:U.line,id:Ig,type:"line",source:md})}function P(U){S=U,L()}o.on("styledata",()=>{setTimeout(()=>{S&&L()})});const R=U=>{s==null||s({type:"mapClick",coordinates:[U.lngLat.lng,U.lngLat.lat]})};function Z(U=!1){if(!e)throw new Error;const H=document.createElement("div");return U&&H.classList.add("marker-interactive"),new Kw({props:{displayIn:"maplibre"},target:H}),new e.Marker({element:H,offset:[1,-13]})}return{setEventHandler(U){U?(s=U,o.on("click",R)):(s=void 0,o.off("click",R))},flyTo(U,H){o.flyTo({center:U,...H?{zoom:H}:{},...l})},fitBounds(U,H,G){o.fitBounds([[U[0],U[1]],[U[2],U[3]]],{padding:H,...G?{maxZoom:G}:{},...u})},indicateReverse(U){o.getCanvasContainer().style.cursor=U?"crosshair":""},setReverseMarker(U){!e||!t||(k?U?k.setLngLat(U):(k.remove(),k=void 0):U&&(t instanceof Function?k=t(o)??void 0:(k=(typeof t=="object"?new e.Marker(t):Z()).setLngLat(U).addTo(o),k.getElement().classList.add("marker-reverse"))))},setFeatures(U,H,G){for(const K of g)K.remove();if(g.length=0,P(void 0),!!e){if(H){let K=!1;if(H.geometry.type==="GeometryCollection"){const le=H.geometry.geometries.filter(Se=>Se.type==="Polygon"||Se.type==="MultiPolygon");e:if(le.length>0){const Se=x1(ih(le.map(Le=>th(Le))));if(!Se)break e;kg({...H,geometry:Se.geometry},P),K=!0}else{const Se=H.geometry.geometries.filter(Le=>Le.type==="LineString"||Le.type==="MultiLineString");Se.length>0&&(P({...H,geometry:{type:"GeometryCollection",geometries:Se}}),K=!0)}}if(!K){if(H.geometry.type==="Polygon"||H.geometry.type==="MultiPolygon")kg(H,P);else if(H.geometry.type==="LineString"||H.geometry.type==="MultiLineString"){P(H);return}}if(!G&&H.geometry.type!=="Point")return;if(t instanceof Function){const le=t(o,H);le&&g.push(le)}else t&&g.push(typeof t=="object"?new e.Marker(t):Z().setLngLat(H.center).addTo(o))}if(r)for(const K of U??[]){if(K===H)continue;let le;if(r instanceof Function){if(le=r(o,K),!le)continue}else le=(typeof r=="object"?new e.Marker(r):Z(!0)).setLngLat(K.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(K.place_type[0]==="reverse"?K.place_name:K.place_name.replace(/,.*/,""))).addTo(o);const Se=le.getElement();Se.addEventListener("click",Le=>{Le.stopPropagation(),s==null||s({type:"markerClick",id:K.id})}),Se.addEventListener("mouseenter",()=>{s==null||s({type:"markerMouseEnter",id:K.id}),le.togglePopup()}),Se.addEventListener("mouseleave",()=>{s==null||s({type:"markerMouseLeave",id:K.id}),le.togglePopup()}),g.push(le)}}},setSelectedMarker(U){y&&y.getElement().classList.toggle("marker-selected",!1),y=U>-1?g[U]:void 0,y==null||y.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const U=o.getCenter();return[o.getZoom(),U.lng,U.lat]}}}function i2(o,e,t){var r,l;class u{constructor(U,H){go(this,"type"),go(this,"target"),this.type=H,this.target=U}}class d extends u{constructor(U,H){super(U,"select"),go(this,"feature"),Object.assign(this,H)}}class s extends u{constructor(U,H){super(U,"featureslisted"),go(this,"features"),this.features=H}}class g extends u{constructor(U,H){super(U,"featuresmarked"),go(this,"features"),this.features=H}}class y extends u{constructor(U,H){super(U,"optionsvisibilitychange"),go(this,"optionsVisible"),this.optionsVisible=H}}class k extends u{constructor(U,H){super(U,"pick"),go(this,"feature"),this.feature=H}}class S extends u{constructor(U,H){super(U,"querychange"),go(this,"query"),this.query=H}}class L extends u{constructor(U,H,G){super(U,"response"),go(this,"url"),go(this,"featureCollection"),this.url=H,this.featureCollection=G}}class P extends u{constructor(U,H){super(U,"reversetoggle"),go(this,"reverse"),this.reverse=H}}class R extends o{constructor(U={}){super(),V_(this,r),V_(this,l),q_(this,l,U)}onAddInt(U){const H=document.createElement("div");H.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:G,showResultMarkers:K,flyTo:le,fullGeometryStyle:Se,...Le}=Qn(this,l),te=typeof le=="boolean"?{}:le,Y={mapController:k1(U,e,G,K,te,te,Se),flyTo:le===void 0?!0:!!le,apiKey:"",...t==null?void 0:t(U,H),...Le};if(!Y.apiKey)throw new Error("no apiKey provided");return q_(this,r,new vx({target:H,props:Y})),Qn(this,r).$on("select",ue=>{this.fire(new d(this,ue.detail))}),Qn(this,r).$on("pick",ue=>{this.fire(new k(this,ue.detail.feature))}),Qn(this,r).$on("featureslisted",ue=>{this.fire(new s(this,ue.detail.features))}),Qn(this,r).$on("featuresmarked",ue=>{this.fire(new g(this,ue.detail.features))}),Qn(this,r).$on("response",ue=>{this.fire(new L(this,ue.detail.url,ue.detail.featureCollection))}),Qn(this,r).$on("optionsvisibilitychange",ue=>{this.fire(new y(this,ue.detail.optionsVisible))}),Qn(this,r).$on("reversetoggle",ue=>{this.fire(new P(this,ue.detail.reverse))}),Qn(this,r).$on("querychange",ue=>{this.fire(new S(this,ue.detail.query))}),H}on(U,H){return super.on(U,H)}once(U,H){return super.once(U,H)}off(U,H){return super.off(U,H)}listens(U){return super.listens(U)}setOptions(U){var H;Object.assign(Qn(this,l),U);const{marker:G,showResultMarkers:K,flyTo:le,fullGeometryStyle:Se,...Le}=Qn(this,l);(H=Qn(this,r))==null||H.$set(Le)}setQuery(U,H=!0){var G;(G=Qn(this,r))==null||G.setQuery(U,H)}clearMap(){var U;(U=Qn(this,r))==null||U.clearMap()}clearList(){var U;(U=Qn(this,r))==null||U.clearList()}setReverseMode(U){var H;(H=Qn(this,r))==null||H.$set({reverseActive:U})}focus(){var U;(U=Qn(this,r))==null||U.focus()}blur(){var U;(U=Qn(this,r))==null||U.blur()}onRemove(){var U;(U=Qn(this,r))==null||U.$destroy()}}return r=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:R,events:{SelectEvent:d,FeaturesListedEvent:s,FeaturesMarkedEvent:g,OptionsVisibilityChangeEvent:y,PickEvent:k,QueryChangeEvent:S,ResponseEvent:L,ReverseToggleEvent:P}}}const{MapLibreBasedGeocodingControl:xC,events:ka}=i2($p.Evented,uw);ka.SelectEvent;ka.FeaturesListedEvent;ka.FeaturesMarkedEvent;ka.OptionsVisibilityChangeEvent;ka.PickEvent;ka.QueryChangeEvent;ka.ResponseEvent;ka.ReverseToggleEvent;function n2(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Pe(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Pe(e,"viewBox","0 0 14 14"),Pe(e,"width","13"),Pe(e,"height","13"),Pe(e,"class","svelte-en2qvf")},m(r,l){J(r,e,l),F(e,t)},p:We,i:We,o:We,d(r){r&&X(e)}}}class S1 extends Wt{constructor(e){super(),Gt(this,e,null,n2,Vt,{})}}function r2(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Pe(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Pe(e,"viewBox","0 0 30 30"),Pe(e,"fill","none"),Pe(e,"xmlns","http://www.w3.org/2000/svg"),Pe(e,"class","svelte-d2loi5")},m(r,l){J(r,e,l),F(e,t)},p:We,i:We,o:We,d(r){r&&X(e)}}}class T1 extends Wt{constructor(e){super(),Gt(this,e,null,r2,Vt,{})}}function o2(o){let e,t;return{c(){e=ee("img"),zr(e.src,t=o[3]+"area.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(r,l){J(r,e,l)},p(r,l){l&8&&!zr(e.src,t=r[3]+"area.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",r[6])},d(r){r&&X(e)}}}function s2(o){let e,t;return{c(){e=ee("img"),zr(e.src,t=o[3]+"reverse.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(r,l){J(r,e,l)},p(r,l){l&8&&!zr(e.src,t=r[3]+"reverse.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",r[6])},d(r){r&&X(e)}}}function a2(o){let e,t;return{c(){e=ee("img"),zr(e.src,t=o[3]+"poi.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(r,l){J(r,e,l)},p(r,l){l&8&&!zr(e.src,t=r[3]+"poi.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",r[6])},d(r){r&&X(e)}}}function l2(o){let e,t;return{c(){e=ee("img"),zr(e.src,t=o[3]+"postal_code.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(r,l){J(r,e,l)},p(r,l){l&8&&!zr(e.src,t=r[3]+"postal_code.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",r[6])},d(r){r&&X(e)}}}function c2(o){let e,t;return{c(){e=ee("img"),zr(e.src,t=o[3]+"street.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(r,l){J(r,e,l)},p(r,l){l&8&&!zr(e.src,t=r[3]+"street.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",r[6])},d(r){r&&X(e)}}}function u2(o){let e,t;return{c(){e=ee("img"),zr(e.src,t=o[3]+"road.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(r,l){J(r,e,l)},p(r,l){l&8&&!zr(e.src,t=r[3]+"road.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",r[6])},d(r){r&&X(e)}}}function h2(o){let e,t;return{c(){e=ee("img"),zr(e.src,t=o[3]+"housenumber.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(r,l){J(r,e,l)},p(r,l){l&8&&!zr(e.src,t=r[3]+"housenumber.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",r[6])},d(r){r&&X(e)}}}function d2(o){let e,t,r,l;return{c(){e=ee("img"),zr(e.src,t=o[5])||Pe(e,"src",t),Pe(e,"alt",o[4]),Pe(e,"class","svelte-ltkwvy")},m(u,d){J(u,e,d),r||(l=ft(e,"error",o[14]),r=!0)},p(u,d){d&32&&!zr(e.src,t=u[5])&&Pe(e,"src",t),d&16&&Pe(e,"alt",u[4])},d(u){u&&X(e),r=!1,l()}}}function Cg(o){let e,t;return{c(){e=ee("span"),t=be(o[6]),Pe(e,"class","secondary svelte-ltkwvy")},m(r,l){J(r,e,l),F(e,t)},p(r,l){l&64&&pt(t,r[6])},d(r){r&&X(e)}}}function f2(o){let e,t,r,l,u,d,s,g,y,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,L,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],R,Z,U=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",H,G,K;function le(Y,ue){return ue&1&&(t=null),ue&1&&(r=null),ue&1&&(l=null),ue&1&&(u=null),Y[5]?d2:Y[0].address?h2:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?u2:(r==null&&(r=!!Y[0].id.startsWith("address.")),r?c2:(l==null&&(l=!!Y[0].id.startsWith("postal_code.")),l?l2:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?a2:Y[7]?s2:o2))))}let Se=le(o,-1),Le=Se(o),te=P&&Cg(o);return{c(){e=ee("li"),Le.c(),d=we(),s=ee("span"),g=ee("span"),y=ee("span"),S=be(k),L=we(),te&&te.c(),R=we(),Z=ee("span"),H=be(U),Pe(y,"class","primary svelte-ltkwvy"),Pe(g,"class","svelte-ltkwvy"),Pe(Z,"class","line2 svelte-ltkwvy"),Pe(s,"class","texts svelte-ltkwvy"),Pe(e,"tabindex","0"),Pe(e,"data-selected",o[1]),Pe(e,"class","svelte-ltkwvy"),dr(e,"selected",o[1])},m(Y,ue){J(Y,e,ue),Le.m(e,null),F(e,d),F(e,s),F(s,g),F(g,y),F(y,S),F(g,L),te&&te.m(g,null),F(s,R),F(s,Z),F(Z,H),G||(K=[ft(e,"mouseenter",o[12]),ft(e,"focus",o[13])],G=!0)},p(Y,[ue]){Se===(Se=le(Y,ue))&&Le?Le.p(Y,ue):(Le.d(1),Le=Se(Y),Le&&(Le.c(),Le.m(e,d))),ue&1&&k!==(k=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&pt(S,k),ue&37&&(P=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),P?te?te.p(Y,ue):(te=Cg(Y),te.c(),te.m(g,null)):te&&(te.d(1),te=null),ue&1&&U!==(U=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&pt(H,U),ue&2&&Pe(e,"data-selected",Y[1]),ue&2&&dr(e,"selected",Y[1])},i:We,o:We,d(Y){Y&&X(e),Le.d(),te&&te.d(),G=!1,cn(K)}}}function p2(o,e,t){var K;let r,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:s}=e,{missingIconsCache:g}=e,{iconsBaseUrl:y}=e;const k=(K=u.properties)==null?void 0:K.categories;let S,L,P=0,R=u.place_type[0]==="reverse";function Z(){L&&g.add(L),t(10,P++,P)}function U(le){Fn.call(this,o,le)}function H(le){Fn.call(this,o,le)}const G=()=>Z();return o.$$set=le=>{"feature"in le&&t(0,u=le.feature),"selected"in le&&t(1,d=le.selected),"showPlaceType"in le&&t(2,s=le.showPlaceType),"missingIconsCache"in le&&t(9,g=le.missingIconsCache),"iconsBaseUrl"in le&&t(3,y=le.iconsBaseUrl)},o.$$.update=()=>{var le,Se,Le,te;if(o.$$.dirty&3640)do t(11,r--,r),t(4,S=k==null?void 0:k[r]),t(5,L=S?y+S.replace(/ /g,"_")+".svg":void 0);while(r>-1&&(!L||g.has(L)));o.$$.dirty&1&&t(6,l=((Se=(le=u.properties)==null?void 0:le.categories)==null?void 0:Se.join(", "))??((te=(Le=u.properties)==null?void 0:Le.place_type_name)==null?void 0:te[0])??u.place_type[0])},t(11,r=(k==null?void 0:k.length)??0),[u,d,s,y,S,L,l,R,Z,g,P,r,U,H,G]}class m2 extends Wt{constructor(e){super(),Gt(this,e,p2,f2,Vt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function _2(o){let e;return{c(){e=ee("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Pe(e,"class","svelte-7cmwmc")},m(t,r){J(t,e,r)},p:We,i:We,o:We,d(t){t&&X(e)}}}class g2 extends Wt{constructor(e){super(),Gt(this,e,null,_2,Vt,{})}}function y2(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Pe(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Pe(e,"viewBox","0 0 60.006 21.412"),Pe(e,"width","14"),Pe(e,"height","20"),Pe(e,"class","svelte-en2qvf")},m(r,l){J(r,e,l),F(e,t)},p:We,i:We,o:We,d(r){r&&X(e)}}}class b2 extends Wt{constructor(e){super(),Gt(this,e,null,y2,Vt,{})}}function v2(o){let e,t,r;return{c(){e=xs("svg"),t=xs("circle"),r=xs("path"),Pe(t,"cx","4.789"),Pe(t,"cy","4.787"),Pe(t,"r","3.85"),Pe(t,"class","svelte-1aq105l"),Pe(r,"d","M12.063 12.063 7.635 7.635"),Pe(r,"class","svelte-1aq105l"),Pe(e,"xmlns","http://www.w3.org/2000/svg"),Pe(e,"width","13"),Pe(e,"height","13"),Pe(e,"viewBox","0 0 13 13"),Pe(e,"class","svelte-1aq105l")},m(l,u){J(l,e,u),F(e,t),F(e,r)},p:We,i:We,o:We,d(l){l&&X(e)}}}class w2 extends Wt{constructor(e){super(),Gt(this,e,null,v2,Vt,{})}}function x2(o,e,t){const r=e[1],l=e[0],u=r-l;return o===r&&t?o:((o-l)%u+u)%u+l}function Eg(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Fu;async function k2(o,e,t){const r=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(r&&(l.minZoom!=null&&l.minZoom>r[0]||l.maxZoom!=null&&l.maxZoom<r[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Fu&&l.cachedLocationExpiry&&Fu.time+l.cachedLocationExpiry>Date.now()){if(!Fu.coords)break e;return Fu.coords}let u;try{return u=await new Promise((d,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(g=>{d([g.coords.longitude,g.coords.latitude].map(y=>y.toFixed(6)).join(","))},g=>{s(g)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Fu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(r&&l.type==="map-center")return r[1].toFixed(6)+","+r[2].toFixed(6)}}const S2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Lg=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Mg=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,Ag=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Pg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,zg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function T2(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),r=Number(e[1]),l=Math.abs(t),u=Math.abs(r),d=t>0?"N":"S",s=r>0?"E":"W";let g;o=="DD"&&(g=`${l}° ${d}, ${u}° ${s}`);const y=Math.floor(l),k=Math.floor(u),S=(l-y)*60,L=(u-k)*60;if(o=="DM"){let P=Dg(S,3).toFixed(3).padStart(6,"0"),R=Dg(L,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&R.endsWith(".000")&&(P=P.replace(/\.000$/,""),R=R.replace(/\.000$/,"")),g=`${y}° ${P}' ${d}, ${k}° ${R}' ${s}`}if(o=="DMS"){const P=Math.floor(S),R=Math.floor(L);let Z=((S-P)*60).toFixed(1).padStart(4,"0"),U=((L-R)*60).toFixed(1).padStart(4,"0");const H=P.toString().padStart(2,"0"),G=R.toString().padStart(2,"0");Z.endsWith(".0")&&U.endsWith(".0")&&(Z=Z.replace(/\.0$/,""),U=U.replace(/\.0$/,"")),g=`${y}° ${H}' ${Z}" ${d}, ${k}° ${G}' ${U}" ${s}`}return g}else throw new Error("no decimal coordinates to convert")}function Dg(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Gp(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,r=null,l="",u="",d=null,s=[],g=!1;if(S2.test(o))throw new Error("invalid coordinate value");if(Lg.test(o))if(s=Lg.exec(o),g=Bu(s),g)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),r=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(r*=-1),d="DM";else throw new Error("invalid coordinate format");else if(Mg.test(o))if(s=Mg.exec(o),g=Bu(s),g){if(t=s[2],r=s[6],t.includes(",")&&(t=t.replace(",",".")),r.includes(",")&&(r=r.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");s[1]?(l=s[1],u=s[5]):s[4]&&(l=s[4],u=s[8])}else throw new Error("invalid decimal coordinate format");else if(Ag.test(o))if(s=Ag.exec(o),g=Bu(s),g)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,d="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,d="DMS"),parseInt(s[2])<0&&(t=-1*t),r=Math.abs(parseInt(s[9])),s[11]&&(r+=s[11]/60),s[13]&&(r+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(r=-1*r),s[1]?(l=s[1],u=s[8]):s[7]&&(l=s[7],u=s[14]);else throw new Error("invalid DMS coordinates format");else if(Pg.test(o))if(s=Pg.exec(o),g=Bu(s),g)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,d="DM"),s[6]&&(t+=s[6]/3600,d="DMS"),parseInt(s[2])<0&&(t=-1*t),r=Math.abs(parseInt(s[10])),s[12]&&(r+=s[12]/60),s[14]&&(r+=s[14]/3600),parseInt(s[10])<0&&(r=-1*r),s[1]?(l=s[1],u=s[9]):s[8]&&(l=s[8],u=s[16]);else throw new Error("invalid DMS coordinates format");else if(zg.test(o)){if(s=zg.exec(o),g=Bu(s),s.filter(y=>y).length<=5)throw new Error("invalid coordinates format");if(g)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,d="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,d="DMS"),parseInt(s[2])<0&&(t=-1*t),r=Math.abs(parseInt(s[10])),s[12]&&(r+=s[12].replace(",",".")/60),s[14]&&(r+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(r=-1*r),s[1]?(l=s[1],u=s[9]):s[8]&&(l=s[8],u=s[16]);else throw new Error("invalid coordinates format")}if(g){if(Math.abs(r)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),r.toString().includes(",")&&(r=r.replace(",","."));let y=/S|SOUTH/i;y.test(l)&&t>0&&(t=-1*t),y=/W|WEST/i,y.test(u)&&r>0&&(r=-1*r);const k=s[0].trim();let S,L;const P=/[,/;\u0020]/g,R=k.match(P);if(R==null){const H=Math.floor(o.length/2);S=k.substring(0,H).trim(),L=k.substring(H).trim()}else{let H;R.length%2==1?H=Math.floor(R.length/2):H=R.length/2-1;let G=0;if(H==0)G=k.indexOf(R[0]),S=k.substring(0,G).trim(),L=k.substring(G+1).trim();else{let K=0,le=0;for(;K<=H;)G=k.indexOf(R[K],le),le=G+1,K++;S=k.substring(0,G).trim(),L=k.substring(G+1).trim()}}const Z=S.split(".");if(Z.length==2&&Z[1]==0&&Z[1].length!=2)throw new Error("invalid coordinates format");const U=L.split(".");if(U.length==2&&U[1]==0&&U[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(L))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),r=Number(Number(r).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:L,decimalLatitude:t,decimalLongitude:r,decimalCoordinates:`${t},${r}`,originalFormat:d,closeEnough:I2,toCoordinateFormat:T2})}else throw new Error("coordinates pattern match failed")}function Bu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,r=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],s=e[u+l],g=t.test(d)&&t.test(s),y=r.test(d)&&r.test(s),k=d==s;if(!(d==null&&s==null)){if(d==null||s==null)return!1;if(g||y||k)continue;return!1}}return!0}function Rg(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function I2(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return Rg(this.decimalLatitude,Number(e[0]))&&Rg(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const C2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Gp.to=C2;const E2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],L2={decimalLatitude:40.123,decimalLongitude:-74.123},M2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],A2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function P2(){const o=[];return E2.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...L2})}),[...o,...M2,...A2]}const z2=P2();Gp.formats=z2.map(o=>o.verbatimCoordinates);const D2=Gp;function Fg(o,e,t){const r=o.slice();return r[84]=e[t],r[86]=t,r}function Bg(o){let e,t;return e=new g2({}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function Og(o){let e,t,r,l,u;return t=new b2({}),{c(){e=ee("button"),Ve(t.$$.fragment),Pe(e,"type","button"),Pe(e,"title",o[9]),Pe(e,"class","svelte-bz0zu3"),dr(e,"active",o[0])},m(d,s){J(d,e,s),je(t,e,null),r=!0,l||(u=ft(e,"click",o[69]),l=!0)},p(d,s){(!r||s[0]&512)&&Pe(e,"title",d[9]),(!r||s[0]&1)&&dr(e,"active",d[0])},i(d){r||(ne(t.$$.fragment,d),r=!0)},o(d){he(t.$$.fragment,d),r=!1},d(d){d&&X(e),$e(t),l=!1,u()}}}function R2(o){let e,t=[],r=new Map,l,u,d,s=bi(o[14]);const g=y=>y[84].id+(y[84].address?","+y[84].address:"");for(let y=0;y<s.length;y+=1){let k=Fg(o,s,y),S=g(k);r.set(S,t[y]=Ng(S,k))}return{c(){e=ee("ul");for(let y=0;y<t.length;y+=1)t[y].c();Pe(e,"class","options svelte-bz0zu3")},m(y,k){J(y,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[ft(e,"mouseleave",o[73]),ft(e,"blur",o[74])],u=!0)},p(y,k){k[0]&17880064&&(s=bi(y[14]),ui(),t=rw(t,k,g,1,y,s,r,e,nw,Ng,null,Fg),hi())},i(y){if(!l){for(let k=0;k<s.length;k+=1)ne(t[k]);l=!0}},o(y){for(let k=0;k<t.length;k+=1)he(t[k]);l=!1},d(y){y&&X(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,cn(d)}}}function F2(o){let e,t,r,l,u,d;return t=new T1({}),{c(){e=ee("div"),Ve(t.$$.fragment),r=we(),l=ee("div"),u=be(o[7]),Pe(l,"class","svelte-bz0zu3"),Pe(e,"class","no-results svelte-bz0zu3")},m(s,g){J(s,e,g),je(t,e,null),F(e,r),F(e,l),F(l,u),d=!0},p(s,g){(!d||g[0]&128)&&pt(u,s[7])},i(s){d||(ne(t.$$.fragment,s),d=!0)},o(s){he(t.$$.fragment,s),d=!1},d(s){s&&X(e),$e(t)}}}function B2(o){let e="",t;return{c(){t=be(e)},m(r,l){J(r,t,l)},p:We,i:We,o:We,d(r){r&&X(t)}}}function O2(o){let e,t,r,l,u,d,s,g,y,k,S;return t=new T1({}),g=new S1({}),{c(){e=ee("div"),Ve(t.$$.fragment),r=we(),l=ee("div"),u=be(o[6]),d=we(),s=ee("button"),Ve(g.$$.fragment),Pe(l,"class","svelte-bz0zu3"),Pe(s,"class","svelte-bz0zu3"),Pe(e,"class","error svelte-bz0zu3")},m(L,P){J(L,e,P),je(t,e,null),F(e,r),F(e,l),F(l,u),F(e,d),F(e,s),je(g,s,null),y=!0,k||(S=ft(s,"click",o[70]),k=!0)},p(L,P){(!y||P[0]&64)&&pt(u,L[6])},i(L){y||(ne(t.$$.fragment,L),ne(g.$$.fragment,L),y=!0)},o(L){he(t.$$.fragment,L),he(g.$$.fragment,L),y=!1},d(L){L&&X(e),$e(t),$e(g),k=!1,S()}}}function Ng(o,e){let t,r,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return r=new m2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),r.$on("mouseenter",u),r.$on("focus",d),{key:o,first:null,c(){t=Ei(),Ve(r.$$.fragment),this.first=t},m(s,g){J(s,t,g),je(r,s,g),l=!0},p(s,g){e=s;const y={};g[0]&16384&&(y.feature=e[84]),g[0]&1024&&(y.showPlaceType=e[10]),g[0]&49152&&(y.selected=e[15]===e[86]),g[0]&4096&&(y.iconsBaseUrl=e[12]),r.$set(y)},i(s){l||(ne(r.$$.fragment,s),l=!0)},o(s){he(r.$$.fragment,s),l=!1},d(s){s&&X(t),$e(r,s)}}}function N2(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le=!1;u=new w2({}),S=new S1({});let te=o[19]&&Bg(),Y=o[5]==="button"&&Og(o);const ue=o[61].default,fe=mn(ue,o,o[60],null),ce=[O2,B2,F2,R2],ae=[];function Ge(Ee,ze){var rt,it;return Ee[18]?0:Ee[16]?((rt=Ee[14])==null?void 0:rt.length)===0?2:Ee[16]&&((it=Ee[14])!=null&&it.length)?3:-1:1}return~(U=Ge(o))&&(H=ae[U]=ce[U](o)),{c(){e=we(),t=ee("form"),r=ee("div"),l=ee("button"),Ve(u.$$.fragment),d=we(),s=ee("input"),g=we(),y=ee("div"),k=ee("button"),Ve(S.$$.fragment),L=we(),te&&te.c(),P=we(),Y&&Y.c(),R=we(),fe&&fe.c(),Z=we(),H&&H.c(),Pe(l,"class","search-button svelte-bz0zu3"),Pe(l,"type","button"),Pe(s,"placeholder",o[8]),Pe(s,"aria-label",o[8]),Pe(s,"class","svelte-bz0zu3"),Pe(k,"type","button"),Pe(k,"title",o[3]),Pe(k,"class","svelte-bz0zu3"),Pe(y,"class","clear-button-container svelte-bz0zu3"),dr(y,"displayable",o[1]!==""),Pe(r,"class","input-group svelte-bz0zu3"),Pe(t,"tabindex","0"),Pe(t,"class",G=Cd(o[2])+" svelte-bz0zu3"),dr(t,"can-collapse",o[4]&&o[1]==="")},m(Ee,ze){J(Ee,e,ze),J(Ee,t,ze),F(t,r),F(r,l),je(u,l,null),F(r,d),F(r,s),o[63](s),Zi(s,o[1]),F(r,g),F(r,y),F(y,k),je(S,k,null),F(y,L),te&&te.m(y,null),F(r,P),Y&&Y.m(r,null),F(r,R),fe&&fe.m(r,null),F(t,Z),~U&&ae[U].m(t,null),K=!0,le||(Se=[ft(l,"click",o[62]),ft(s,"input",o[64]),ft(s,"focus",o[65]),ft(s,"blur",o[66]),ft(s,"keydown",o[22]),ft(s,"input",o[67]),ft(k,"click",o[68]),ft(t,"submit",ah(o[21]))],le=!0)},p(Ee,ze){(!K||ze[0]&256)&&Pe(s,"placeholder",Ee[8]),(!K||ze[0]&256)&&Pe(s,"aria-label",Ee[8]),ze[0]&2&&s.value!==Ee[1]&&Zi(s,Ee[1]),(!K||ze[0]&8)&&Pe(k,"title",Ee[3]),Ee[19]?te?ze[0]&524288&&ne(te,1):(te=Bg(),te.c(),ne(te,1),te.m(y,null)):te&&(ui(),he(te,1,1,()=>{te=null}),hi()),(!K||ze[0]&2)&&dr(y,"displayable",Ee[1]!==""),Ee[5]==="button"?Y?(Y.p(Ee,ze),ze[0]&32&&ne(Y,1)):(Y=Og(Ee),Y.c(),ne(Y,1),Y.m(r,R)):Y&&(ui(),he(Y,1,1,()=>{Y=null}),hi()),fe&&fe.p&&(!K||ze[1]&536870912)&&gn(fe,ue,Ee,Ee[60],K?_n(ue,Ee[60],ze,null):yn(Ee[60]),null);let rt=U;U=Ge(Ee),U===rt?~U&&ae[U].p(Ee,ze):(H&&(ui(),he(ae[rt],1,1,()=>{ae[rt]=null}),hi()),~U?(H=ae[U],H?H.p(Ee,ze):(H=ae[U]=ce[U](Ee),H.c()),ne(H,1),H.m(t,null)):H=null),(!K||ze[0]&4&&G!==(G=Cd(Ee[2])+" svelte-bz0zu3"))&&Pe(t,"class",G),(!K||ze[0]&22)&&dr(t,"can-collapse",Ee[4]&&Ee[1]==="")},i(Ee){K||(ne(Le),ne(u.$$.fragment,Ee),ne(S.$$.fragment,Ee),ne(te),ne(Y),ne(fe,Ee),ne(H),K=!0)},o(Ee){he(Le),he(u.$$.fragment,Ee),he(S.$$.fragment,Ee),he(te),he(Y),he(fe,Ee),he(H),K=!1},d(Ee){Ee&&(X(e),X(t)),$e(u),o[63](null),$e(S),te&&te.d(),Y&&Y.d(),fe&&fe.d(Ee),~U&&ae[U].d(),le=!1,cn(Se)}}}function j2(o,e,t){let r,l,{$$slots:u={},$$scope:d}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:g=void 0}=e,{apiKey:y}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:L=!1}=e,{collapsed:P=!1}=e,{country:R=void 0}=e,{debounceSearch:Z=200}=e,{enableReverse:U="never"}=e,{errorMessage:H="Something went wrong…"}=e,{filter:G=()=>!0}=e,{flyTo:K=!0}=e,{fuzzyMatch:le=!0}=e,{language:Se=void 0}=e,{limit:Le=void 0}=e,{mapController:te=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ue="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:fe="Search"}=e,{proximity:ce=[{type:"server-geolocation"}]}=e,{reverseActive:ae=U==="always"}=e,{reverseButtonTitle:Ge="toggle reverse geocoding"}=e,{searchValue:Ee=""}=e,{pickedResultStyle:ze="full-geometry"}=e,{showPlaceType:rt="if-needed"}=e,{showResultsWhileTyping:it=!0}=e,{selectFirst:Qe=!0}=e,{flyToSelected:Ft=!1}=e,{markerOnSelected:jt=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:et=!1}=e,{excludeTypes:at=!1}=e,{zoom:Bt=s}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ht={}}=e,{iconsBaseUrl:ai="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:si=()=>{}}=e;function Si(){Ie.focus()}function Ri(){Ie.blur()}function vi(j,Fe=!0,Ke=!1){t(1,Ee=j),Fe?(t(15,nt=-1),tr()):(Sn(!Ke,Ke),setTimeout(()=>{Ie.focus(),Ie.select()}))}function di(){t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1)}function lt(){t(55,Te=[]),t(56,mt=void 0)}let qe=!1,st,Te,mt,yt="",Ie,nt=-1,Xt,wi=[],$i,Li,gi,Fi;const br=new Set,ct=yc();Po(()=>{te&&(te.setEventHandler(void 0),te.indicateReverse(!1),te.setSelectedMarker(-1),te.setFeatures(void 0,void 0,!1))});function tr(j){if(Li&&(clearTimeout(Li),Li=void 0),nt>-1&&st)t(56,mt=st[nt]),t(1,Ee=mt.place_type[0]==="reverse"?mt.place_name:mt.place_name.replace(/,.*/,"")),t(18,Xt=void 0),t(55,Te=void 0),t(15,nt=-1);else if(Ee){const Fe=j||!dn(Ee);Un(Ee,{exact:!0}).then(()=>{t(55,Te=st),t(56,mt=void 0),Fe&&Wr()}).catch(Ke=>t(18,Xt=Ke))}}function dn(j){try{return D2(j,6)}catch{return!1}}async function Un(j,{byId:Fe=!1,exact:Ke=!1}={}){t(18,Xt=void 0),$i==null||$i.abort();const Ne=new AbortController;t(19,$i=Ne);try{const Xe=dn(j),_t=new URLSearchParams;if(Se!==void 0&&_t.set("language",Array.isArray(Se)?Se.join(","):Se??""),ut&&_t.set("types",ut.join(",")),at&&_t.set("excludeTypes",String(at)),k&&_t.set("bbox",k.map(ci=>ci.toFixed(6)).join(",")),R&&_t.set("country",Array.isArray(R)?R.join(","):R),!Fe&&!Xe){const ci=await k2(te,ce,Ne);ci&&_t.set("proximity",ci),(Ke||!it)&&_t.set("autocomplete","false"),_t.set("fuzzyMatch",String(le))}Le!==void 0&&(et||!Xe||(ut==null?void 0:ut.length)===1)&&_t.set("limit",String(Le)),_t.set("key",y),si(_t);const Et=Dt+"/"+encodeURIComponent(Xe?Xe.decimalLongitude+","+Xe.decimalLatitude:j)+".json?"+_t.toString();if(Et===yt){Fe?(t(14,st=void 0),t(56,mt=wi[0])):t(14,st=wi);return}yt=Et;const pi=await fetch(Et,{signal:Ne.signal,...Ht});if(!pi.ok)throw new Error(await pi.text());const Qt=await pi.json();ct("response",{url:Et,featureCollection:Qt}),Fe?(t(14,st=void 0),t(56,mt=Qt.features[0]),wi=[mt]):(t(14,st=Qt.features.filter(G)),Xe&&st.unshift({type:"Feature",properties:{},id:"reverse_"+Xe.decimalLongitude+"_"+Xe.decimalLatitude,text:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_name:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_type:["reverse"],center:[Xe.decimalLongitude,Xe.decimalLatitude],bbox:[Xe.decimalLongitude,Xe.decimalLatitude,Xe.decimalLongitude,Xe.decimalLatitude],geometry:{type:"Point",coordinates:[Xe.decimalLongitude,Xe.decimalLatitude]}}),wi=st,Xe&&Ie.focus())}catch(Xe){if(Xe&&typeof Xe=="object"&&"name"in Xe&&Xe.name==="AbortError")return;throw Xe}finally{Ne===$i&&t(19,$i=void 0)}}function Wr(){var Ne;if(!(Te!=null&&Te.length)||!K)return;const j=[180,90,-180,-90],Fe=!Te.some(Xe=>!Xe.matching_text);let Ke;for(const Xe of Te){const _t=vt(Xe);if(Ke=Ke===void 0?_t:_t===void 0?Ke:Math.max(Ke,_t),Fe||!Xe.matching_text)for(const Et of[0,1,2,3])j[Et]=Math[Et<2?"min":"max"](j[Et],((Ne=Xe.bbox)==null?void 0:Ne[Et])??Xe.center[Et%2])}te&&Te.length>0&&(mt&&j[0]===j[2]&&j[1]===j[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Eg(j),50,Ke))}function vt(j){var Ke;if(!j.bbox||j.bbox[0]!==j.bbox[2]&&j.bbox[1]!==j.bbox[3])return;const Fe=j.id.replace(/\..*/,"");return(Array.isArray((Ke=j.properties)==null?void 0:Ke.categories)?j.properties.categories.reduce((Ne,Xe)=>{const _t=Bt[Fe+"."+Xe];return Ne===void 0?_t:_t===void 0?Ne:Math.max(Ne,_t)},void 0):void 0)??Bt[Fe]}function li(j){t(0,ae=U==="always"),t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1),vi(j[1].toFixed(6)+", "+x2(j[0],[-180,180],!0).toFixed(6),!1,!0)}function Jt(j){if(!st)return;let Fe=j.key==="ArrowDown"?1:j.key==="ArrowUp"?-1:0;Fe&&(nt===(Qe?0:-1)&&Fe===-1&&t(15,nt=st.length),t(15,nt+=Fe),nt>=st.length&&t(15,nt=-1),nt<0&&Qe&&t(15,nt=0),j.preventDefault())}function Sn(j=!0,Fe=!1){if(t(18,Xt=void 0),it||Fe){if(Li&&clearTimeout(Li),Ee.length<Y)return;const Ke=Ee;Li=window.setTimeout(()=>{Un(Ke).catch(Ne=>t(18,Xt=Ne))},j?Z:0)}else t(14,st=void 0),t(18,Xt=void 0)}function Bn(j){t(56,mt=j),t(1,Ee=j.place_name),t(15,nt=-1)}const ei=()=>Ie.focus();function vr(j){Ai[j?"unshift":"push"](()=>{Ie=j,t(17,Ie)})}function Fr(){Ee=this.value,t(1,Ee),t(13,qe),t(28,L)}const Hr=()=>t(13,qe=!0),wr=()=>t(13,qe=!1),ye=()=>Sn(),q=()=>{t(1,Ee=""),Ie.focus()},V=()=>t(0,ae=!ae),re=()=>t(18,Xt=void 0),pe=j=>t(15,nt=j),Me=j=>Bn(j),De=()=>{Qe||t(15,nt=-1)},Ue=()=>{};return o.$$set=j=>{"class"in j&&t(2,g=j.class),"apiKey"in j&&t(26,y=j.apiKey),"bbox"in j&&t(27,k=j.bbox),"clearButtonTitle"in j&&t(3,S=j.clearButtonTitle),"clearOnBlur"in j&&t(28,L=j.clearOnBlur),"collapsed"in j&&t(4,P=j.collapsed),"country"in j&&t(29,R=j.country),"debounceSearch"in j&&t(30,Z=j.debounceSearch),"enableReverse"in j&&t(5,U=j.enableReverse),"errorMessage"in j&&t(6,H=j.errorMessage),"filter"in j&&t(31,G=j.filter),"flyTo"in j&&t(32,K=j.flyTo),"fuzzyMatch"in j&&t(33,le=j.fuzzyMatch),"language"in j&&t(34,Se=j.language),"limit"in j&&t(35,Le=j.limit),"mapController"in j&&t(36,te=j.mapController),"minLength"in j&&t(37,Y=j.minLength),"noResultsMessage"in j&&t(7,ue=j.noResultsMessage),"placeholder"in j&&t(8,fe=j.placeholder),"proximity"in j&&t(38,ce=j.proximity),"reverseActive"in j&&t(0,ae=j.reverseActive),"reverseButtonTitle"in j&&t(9,Ge=j.reverseButtonTitle),"searchValue"in j&&t(1,Ee=j.searchValue),"pickedResultStyle"in j&&t(39,ze=j.pickedResultStyle),"showPlaceType"in j&&t(10,rt=j.showPlaceType),"showResultsWhileTyping"in j&&t(40,it=j.showResultsWhileTyping),"selectFirst"in j&&t(11,Qe=j.selectFirst),"flyToSelected"in j&&t(41,Ft=j.flyToSelected),"markerOnSelected"in j&&t(42,jt=j.markerOnSelected),"types"in j&&t(43,ut=j.types),"exhaustiveReverseGeocoding"in j&&t(44,et=j.exhaustiveReverseGeocoding),"excludeTypes"in j&&t(45,at=j.excludeTypes),"zoom"in j&&t(46,Bt=j.zoom),"apiUrl"in j&&t(47,Dt=j.apiUrl),"fetchParameters"in j&&t(48,Ht=j.fetchParameters),"iconsBaseUrl"in j&&t(12,ai=j.iconsBaseUrl),"adjustUrlQuery"in j&&t(49,si=j.adjustUrlQuery),"$$scope"in j&&t(60,d=j.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ae=U==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,gi=qe),L&&!qe&&t(1,Ee="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ee.length<Y&&(t(56,mt=void 0),t(14,st=void 0),t(18,Xt=void 0),t(55,Te=st)),o.$$.dirty[1]&33554688&&ze!=="marker-only"&&mt&&!mt.address&&mt.geometry.type==="Point"&&mt.place_type[0]!=="reverse"&&Un(mt.id,{byId:!0}).catch(j=>t(18,Xt=j)),o.$$.dirty[1]&100663330&&(te&&mt&&mt.id!==Fi&&K&&(!mt.bbox||mt.bbox[0]===mt.bbox[2]&&mt.bbox[1]===mt.bbox[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Eg(mt.bbox),50,vt(mt)),t(14,st=void 0),t(55,Te=void 0),t(15,nt=-1)),t(57,Fi=mt==null?void 0:mt.id)),o.$$.dirty[0]&18432&&Qe&&st!=null&&st.length&&t(15,nt=0),o.$$.dirty[0]&2&&t(15,nt=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&Te!==st&&t(55,Te=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&te&&te.setEventHandler(j=>{switch(j.type){case"mapClick":ae&&li(j.coordinates);break;case"markerClick":{const Fe=st==null?void 0:st.find(Ke=>Ke.id===j.id);Fe&&Bn(Fe)}break;case"markerMouseEnter":Te&&t(15,nt=gi?(st==null?void 0:st.findIndex(Fe=>Fe.id===j.id))??-1:-1);break;case"markerMouseLeave":Te&&t(15,nt=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=st==null?void 0:st[nt]),o.$$.dirty[1]&134218786&&te&&l&&K&&Ft&&te.flyTo(l.center,vt(l)),o.$$.dirty[1]&256&&t(59,r=ze==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(jt||te==null||te.setFeatures(void 0,void 0,r)),o.$$.dirty[1]&419432480&&te&&jt&&!Te&&(te.setFeatures(l?[l]:void 0,void 0,r),te.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&te&&te.setFeatures(Te,mt,r),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&Te&&te&&te.setSelectedMarker(nt),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&te){const j=dn(Ee);te.setReverseMarker(j?[j.decimalLongitude,j.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&ct("select",{feature:l}),o.$$.dirty[1]&33554432&&ct("pick",{feature:mt}),o.$$.dirty[0]&81920&&ct("optionsvisibilitychange",{optionsVisible:gi&&!!st}),o.$$.dirty[0]&16384&&ct("featureslisted",{features:st}),o.$$.dirty[1]&16777216&&ct("featuresmarked",{features:Te}),o.$$.dirty[0]&1&&ct("reversetoggle",{reverse:ae}),o.$$.dirty[0]&2&&ct("querychange",{query:Ee}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&te&&te.indicateReverse(ae)},[ae,Ee,g,S,P,U,H,ue,fe,Ge,rt,Qe,ai,qe,st,nt,gi,Ie,Xt,$i,br,tr,Jt,Sn,Bn,s,y,k,L,R,Z,G,K,le,Se,Le,te,Y,ce,ze,it,Ft,jt,ut,et,at,Bt,Dt,Ht,si,Si,Ri,vi,di,lt,Te,mt,Fi,l,r,d,u,ei,vr,Fr,Hr,wr,ye,q,V,re,pe,Me,De,Ue]}class $2 extends Wt{constructor(e){super(),Gt(this,e,j2,N2,Vt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function jg(o){let e,t,r;return t=new $2({props:{mapController:o[2],apiKey:o[0],country:o[1],proximity:[{type:"map-center"}]}}),{c(){e=ee("div"),Ve(t.$$.fragment),Pe(e,"class","svelte-ixhnie")},m(l,u){J(l,e,u),je(t,e,null),r=!0},p(l,u){const d={};u&4&&(d.mapController=l[2]),u&1&&(d.apiKey=l[0]),u&2&&(d.country=l[1]),t.$set(d)},i(l){r||(ne(t.$$.fragment,l),r=!0)},o(l){he(t.$$.fragment,l),r=!1},d(l){l&&X(e),$e(t)}}}function U2(o){let e,t,r=o[2]&&jg(o);return{c(){r&&r.c(),e=Ei()},m(l,u){r&&r.m(l,u),J(l,e,u),t=!0},p(l,[u]){l[2]?r?(r.p(l,u),u&4&&ne(r,1)):(r=jg(l),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d(l)}}}function V2(o,e,t){let r,{apiKey:l}=e,{map:u}=e,{country:d}=e;function s(g){return g?k1(g,Pr,!0,!0,{duration:1e3},{duration:1e3}):null}return o.$$set=g=>{"apiKey"in g&&t(0,l=g.apiKey),"map"in g&&t(3,u=g.map),"country"in g&&t(1,d=g.country)},o.$$.update=()=>{o.$$.dirty&8&&t(2,r=s(u))},[l,d,r,u]}class q2 extends Wt{constructor(e){super(),Gt(this,e,V2,U2,Vt,{apiKey:0,map:3,country:1})}}const tc=[];function up(o,e){return{subscribe:Mi(o,e).subscribe}}function Mi(o,e=We){let t;const r=new Set;function l(s){if(Vt(o,s)&&(o=s,t)){const g=!tc.length;for(const y of r)y[1](),tc.push(y,o);if(g){for(let y=0;y<tc.length;y+=2)tc[y][0](tc[y+1]);tc.length=0}}}function u(s){l(s(o))}function d(s,g=We){const y=[s,g];return r.add(y),r.size===1&&(t=e(l,u)||We),s(o),()=>{r.delete(y),r.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}const Z2=Symbol.for("svelte-maplibre");function G2(){return r1(Z2)}function W2(o){return"layerType"in o&&o.layerType==="deckgl"}var rh=H2;function H2(o){var e,t,r;if(o){if(Array.isArray(o)){for(e=[],t=o.length,r=0;r<t;r++){var l=o[r];l!=null&&e.push(l)}return e}if(typeof o=="object"){e={};var u=Object.keys(o);for(t=u.length,r=0;r<t;r++){var d=u[r],s=o[d];s!=null&&(e[d]=s)}return e}}}var ic=Wp;function Wp(o,e){return o===e||o!==o&&e!==e?!0:typeof o!=typeof e||{}.toString.call(o)!={}.toString.call(e)||o!==Object(o)||!o?!1:Array.isArray(o)?$g(o,e):{}.toString.call(o)=="[object Set]"?$g(Array.from(o),Array.from(e)):{}.toString.call(o)=="[object Object]"?K2(o,e):X2(o,e)}function X2(o,e){return o.toString()===e.toString()}function $g(o,e){var t=o.length;if(t!=e.length)return!1;for(var r=0;r<t;r++)if(!Wp(o[r],e[r]))return!1;return!0}function K2(o,e){var t=Object.keys(o),r=t.length;if(r!=Object.keys(e).length)return!1;for(var l=0;l<r;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Wp(o[u],e[u])))return!1}return!0}const J2=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),Ug=o=>{var e;return{features:o[4],data:(e=o[4])==null?void 0:e[0],map:o[2],close:o[31]}};function Vg(o){let e,t,r=(o[4]||o[3]instanceof Pr.Marker)&&qg(o);return{c(){e=ee("div"),r&&r.c()},m(l,u){J(l,e,u),r&&r.m(e,null),o[32](e),t=!0},p(l,u){l[4]||l[3]instanceof Pr.Marker?r?(r.p(l,u),u[0]&24&&ne(r,1)):(r=qg(l),r.c(),ne(r,1),r.m(e,null)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d(),o[32](null)}}}function qg(o){let e;const t=o[30].default,r=mn(t,o,o[29],Ug);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u[0]&536870933)&&gn(r,t,l,l[29],e?_n(t,l[29],u,J2):yn(l[29]),Ug)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function Y2(o){let e,t,r=o[9].default&&Vg(o);return{c(){r&&r.c(),e=Ei()},m(l,u){r&&r.m(l,u),J(l,e,u),t=!0},p(l,u){l[9].default?r?(r.p(l,u),u[0]&512&&ne(r,1)):(r=Vg(l),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d(l)}}}function Q2(o,e,t){let r,l,u,d,s,g,{$$slots:y={},$$scope:k}=e;const S=Jv(y);let{closeButton:L=void 0}=e,{closeOnClickOutside:P=!0}=e,{closeOnClickInside:R=!1}=e,{closeOnMove:Z=!1}=e,{openOn:U="click"}=e,{openIfTopMost:H=!0}=e,{focusAfterOpen:G=!0}=e,{anchor:K=void 0}=e,{offset:le=void 0}=e,{popupClass:Se=void 0}=e,{maxWidth:Le=void 0}=e,{lngLat:te=void 0}=e,{html:Y=void 0}=e,{open:ue=!1}=e;const fe=yc(),{map:ce,popupTarget:ae,layerEvent:Ge,layer:Ee,eventTopMost:ze}=G2();bt(o,ce,qe=>t(2,u=qe)),bt(o,ae,qe=>t(3,s=qe)),bt(o,Ge,qe=>t(28,d=qe)),bt(o,Ee,qe=>t(35,g=qe));const rt=["click","dblclick","contextmenu"];let it,Qe=!1,Ft;function jt(){if(!it)return;let qe=it.getElement();!qe||qe===Ft||(Ft=qe,U==="hover"&&(Ft.style.pointerEvents="none"),Ft.addEventListener("mouseenter",()=>{t(24,Qe=!0)},{passive:!0}),Ft.addEventListener("mouseleave",()=>{t(24,Qe=!1)},{passive:!0}),Ft.addEventListener("click",()=>{R&&t(0,ue=!1)},{passive:!0}))}gc(()=>{if(u)return u.on("click",Ri),u.on("contextmenu",Ri),typeof s=="string"&&(u.on("click",s,Bt),u.on("dblclick",s,Bt),u.on("contextmenu",s,Bt),u.on("mousemove",s,Si),u.on("mouseleave",s,si),u.on("touchstart",s,Ht),u.on("touchend",s,ai)),()=>{u!=null&&u.loaded()&&(it==null||it.remove(),u.off("click",Ri),u.off("contextmenu",Ri),s instanceof Pr.Marker?s.getPopup()===it&&s.setPopup(void 0):typeof s=="string"&&(u.off("click",s,Bt),u.off("dblclick",s,Bt),u.off("contextmenu",s,Bt),u.off("mousemove",s,Si),u.off("mouseleave",s,si),u.off("touchstart",s,Ht),u.off("touchend",s,ai)))}});function ut(qe){return H?!("marker"in qe)&&!W2(qe)&&ze(qe)!==g:!1}let et=null,at="normal";function Bt(qe){qe.type===U&&(ut(qe)||("layerType"in qe?qe.layerType==="deckgl"?(t(10,te=qe.coordinate),t(4,et=qe.object?[qe.object]:null)):(t(10,te=qe.lngLat),t(4,et=qe.features??[])):(t(10,te=qe.lngLat),t(4,et=qe.features??[])),setTimeout(()=>t(0,ue=!0))))}let Dt=null;function Ht(qe){Dt=qe.point}function ai(qe){if(!Dt||U!=="hover")return;let st=Dt.dist(qe.point);Dt=null,st<3&&(t(10,te=qe.lngLat),t(4,et=qe.features??[]),it.isOpen()?t(25,at="justOpened"):(t(25,at="opening"),t(0,ue=!0)))}function si(qe){U!=="hover"||Dt||at!=="normal"||(t(0,ue=!1),t(4,et=null))}function Si(qe){if(!(U!=="hover"||Dt||at!=="normal")){if(ut(qe)){t(0,ue=!1),t(4,et=null);return}t(0,ue=!0),t(4,et=qe.features??[]),t(10,te=qe.lngLat)}}function Ri(qe){if(at==="justOpened"){t(25,at="normal");return}if(!P)return;let st=[Ft,s instanceof Pr.Marker?s==null?void 0:s.getElement():null];ue&&it.isOpen()&&!st.some(Te=>Te==null?void 0:Te.contains(qe.originalEvent.target))&&(qe.type==="contextmenu"&&U==="contextmenu"||qe.type!=="contextmenu")&&t(0,ue=!1)}Po(()=>{u&&(it!=null&&it.isOpen())&&it.remove()});let vi;const di=()=>t(0,ue=!1);function lt(qe){Ai[qe?"unshift":"push"](()=>{vi=qe,t(1,vi)})}return o.$$set=qe=>{"closeButton"in qe&&t(11,L=qe.closeButton),"closeOnClickOutside"in qe&&t(12,P=qe.closeOnClickOutside),"closeOnClickInside"in qe&&t(13,R=qe.closeOnClickInside),"closeOnMove"in qe&&t(14,Z=qe.closeOnMove),"openOn"in qe&&t(15,U=qe.openOn),"openIfTopMost"in qe&&t(16,H=qe.openIfTopMost),"focusAfterOpen"in qe&&t(17,G=qe.focusAfterOpen),"anchor"in qe&&t(18,K=qe.anchor),"offset"in qe&&t(19,le=qe.offset),"popupClass"in qe&&t(20,Se=qe.popupClass),"maxWidth"in qe&&t(21,Le=qe.maxWidth),"lngLat"in qe&&t(10,te=qe.lngLat),"html"in qe&&t(22,Y=qe.html),"open"in qe&&t(0,ue=qe.open),"$$scope"in qe&&t(29,k=qe.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&t(27,r=L??(!P&&!R)),o.$$.dirty[0]&146685952&&(it||(t(23,it=new Pr.Popup({closeButton:r,closeOnClick:!1,closeOnMove:Z,focusAfterOpen:G,maxWidth:Le,className:Se,anchor:K,offset:le})),Ft=it.getElement(),it.on("open",()=>{t(0,ue=!0),jt(),fe("open",it)}),it.on("close",()=>{t(0,ue=!1),fe("close",it)}),it.on("hover",()=>{fe("hover",it)}))),o.$$.dirty[0]&8421384&&it&&s instanceof Pr.Marker&&(U==="click"?s.setPopup(it):s.getPopup()===it&&s.setPopup(void 0)),o.$$.dirty[0]&268468224&&rt.includes(U)&&(d==null?void 0:d.type)===U&&(Bt(d),oi(Ge,d=null,d)),o.$$.dirty[0]&268468224&&t(26,l=U==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),o.$$.dirty[0]&352354304&&U==="hover"&&Ge&&(l&&d&&(d.layerType==="deckgl"?(t(10,te=d.coordinate),t(4,et=d.object?[d.object]:null)):(t(10,te=d.lngLat),t(4,et=d.features??[]))),t(0,ue=(l||Qe)??!1)),o.$$.dirty[0]&12582914&&(vi?it.setDOMContent(vi):Y&&it.setHTML(Y)),o.$$.dirty[0]&8389632&&te&&it.setLngLat(te),o.$$.dirty[0]&41943045&&u){let qe=it.isOpen();ue&&!qe?(it.addTo(u),at==="opening"&&t(25,at="justOpened")):!ue&&qe&&it.remove()}},[ue,vi,u,s,et,ce,ae,Ge,Ee,S,te,L,P,R,Z,U,H,G,K,le,Se,Le,Y,it,Qe,at,l,r,d,k,y,di,lt]}class e3 extends Wt{constructor(e){super(),Gt(this,e,Q2,Y2,Vt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var hc=Math.pow,Ar=(o,e,t)=>new Promise((r,l)=>{var u=g=>{try{s(t.next(g))}catch(y){l(y)}},d=g=>{try{s(t.throw(g))}catch(y){l(y)}},s=g=>g.done?r(g.value):Promise.resolve(g.value).then(u,d);s((t=t.apply(o,e)).next())}),vo=Uint8Array,ac=Uint16Array,t3=Int32Array,I1=new vo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),C1=new vo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),i3=new vo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E1=function(o,e){for(var t=new ac(31),r=0;r<31;++r)t[r]=e+=1<<o[r-1];for(var l=new t3(t[30]),r=1;r<30;++r)for(var u=t[r];u<t[r+1];++u)l[u]=u-t[r]<<5|r;return{b:t,r:l}},L1=E1(I1,2),M1=L1.b,n3=L1.r;M1[28]=258,n3[258]=28;var r3=E1(C1,0),o3=r3.b,Ip=new ac(32768);for(Xi=0;Xi<32768;++Xi)ms=(Xi&43690)>>1|(Xi&21845)<<1,ms=(ms&52428)>>2|(ms&13107)<<2,ms=(ms&61680)>>4|(ms&3855)<<4,Ip[Xi]=((ms&65280)>>8|(ms&255)<<8)>>1;var ms,Xi,Wu=function(o,e,t){for(var r=o.length,l=0,u=new ac(e);l<r;++l)o[l]&&++u[o[l]-1];var d=new ac(e);for(l=1;l<e;++l)d[l]=d[l-1]+u[l-1]<<1;var s;if(t){s=new ac(1<<e);var g=15-e;for(l=0;l<r;++l)if(o[l])for(var y=l<<4|o[l],k=e-o[l],S=d[o[l]-1]++<<k,L=S|(1<<k)-1;S<=L;++S)s[Ip[S]>>g]=y}else for(s=new ac(r),l=0;l<r;++l)o[l]&&(s[l]=Ip[d[o[l]-1]++]>>15-o[l]);return s},ch=new vo(288);for(Xi=0;Xi<144;++Xi)ch[Xi]=8;var Xi;for(Xi=144;Xi<256;++Xi)ch[Xi]=9;var Xi;for(Xi=256;Xi<280;++Xi)ch[Xi]=7;var Xi;for(Xi=280;Xi<288;++Xi)ch[Xi]=8;var Xi,A1=new vo(32);for(Xi=0;Xi<32;++Xi)A1[Xi]=5;var Xi,s3=Wu(ch,9,1),a3=Wu(A1,5,1),hp=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},No=function(o,e,t){var r=e/8|0;return(o[r]|o[r+1]<<8)>>(e&7)&t},dp=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},l3=function(o){return(o+7)/8|0},c3=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var r=new vo(t-e);return r.set(o.subarray(e,t)),r},u3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yo=function(o,e,t){var r=new Error(e||u3[o]);if(r.code=o,Error.captureStackTrace&&Error.captureStackTrace(r,yo),!t)throw r;return r},Hp=function(o,e,t,r){var l=o.length,u=r?r.length:0;if(!l||e.f&&!e.l)return t||new vo(0);var d=!t||e.i!=2,s=e.i;t||(t=new vo(l*3));var g=function(Ri){var vi=t.length;if(Ri>vi){var di=new vo(Math.max(vi*2,Ri));di.set(t),t=di}},y=e.f||0,k=e.p||0,S=e.b||0,L=e.l,P=e.d,R=e.m,Z=e.n,U=l*8;do{if(!L){y=No(o,k,1);var H=No(o,k+1,3);if(k+=3,H)if(H==1)L=s3,P=a3,R=9,Z=5;else if(H==2){var Se=No(o,k,31)+257,Le=No(o,k+10,15)+4,te=Se+No(o,k+5,31)+1;k+=14;for(var Y=new vo(te),ue=new vo(19),fe=0;fe<Le;++fe)ue[i3[fe]]=No(o,k+fe*3,7);k+=Le*3;for(var ce=hp(ue),ae=(1<<ce)-1,Ge=Wu(ue,ce,1),fe=0;fe<te;){var Ee=Ge[No(o,k,ae)];k+=Ee&15;var G=Ee>>4;if(G<16)Y[fe++]=G;else{var ze=0,rt=0;for(G==16?(rt=3+No(o,k,3),k+=2,ze=Y[fe-1]):G==17?(rt=3+No(o,k,7),k+=3):G==18&&(rt=11+No(o,k,127),k+=7);rt--;)Y[fe++]=ze}}var it=Y.subarray(0,Se),Qe=Y.subarray(Se);R=hp(it),Z=hp(Qe),L=Wu(it,R,1),P=Wu(Qe,Z,1)}else yo(1);else{var G=l3(k)+4,K=o[G-4]|o[G-3]<<8,le=G+K;if(le>l){s&&yo(0);break}d&&g(S+K),t.set(o.subarray(G,le),S),e.b=S+=K,e.p=k=le*8,e.f=y;continue}if(k>U){s&&yo(0);break}}d&&g(S+131072);for(var Ft=(1<<R)-1,jt=(1<<Z)-1,ut=k;;ut=k){var ze=L[dp(o,k)&Ft],et=ze>>4;if(k+=ze&15,k>U){s&&yo(0);break}if(ze||yo(2),et<256)t[S++]=et;else if(et==256){ut=k,L=null;break}else{var at=et-254;if(et>264){var fe=et-257,Bt=I1[fe];at=No(o,k,(1<<Bt)-1)+M1[fe],k+=Bt}var Dt=P[dp(o,k)&jt],Ht=Dt>>4;Dt||yo(3),k+=Dt&15;var Qe=o3[Ht];if(Ht>3){var Bt=C1[Ht];Qe+=dp(o,k)&(1<<Bt)-1,k+=Bt}if(k>U){s&&yo(0);break}d&&g(S+131072);var ai=S+at;if(S<Qe){var si=u-Qe,Si=Math.min(Qe,ai);for(si+S<0&&yo(3);S<Si;++S)t[S]=r[si+S]}for(;S<ai;S+=4)t[S]=t[S-Qe],t[S+1]=t[S+1-Qe],t[S+2]=t[S+2-Qe],t[S+3]=t[S+3-Qe];S=ai}}e.l=L,e.p=ut,e.b=S,e.f=y,L&&(y=1,e.m=R,e.d=P,e.n=Z)}while(!y);return S==t.length?t:c3(t,0,S)},h3=new vo(0),d3=function(o){(o[0]!=31||o[1]!=139||o[2]!=8)&&yo(6,"invalid gzip data");var e=o[3],t=10;e&4&&(t+=(o[10]|o[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!o[t++]);return t+(e&2)},f3=function(o){var e=o.length;return(o[e-4]|o[e-3]<<8|o[e-2]<<16|o[e-1]<<24)>>>0},p3=function(o,e){return((o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31)&&yo(6,"invalid zlib data"),(o[1]>>5&1)==+!e&&yo(6,"invalid zlib data: "+(o[1]&32?"need":"unexpected")+" dictionary"),(o[1]>>3&4)+2};function m3(o,e){return Hp(o,{i:2},e&&e.out,e&&e.dictionary)}function _3(o,e){var t=d3(o);return t+8>o.length&&yo(6,"invalid gzip data"),Hp(o.subarray(t,-8),{i:2},e&&e.out||new vo(f3(o)),e&&e.dictionary)}function g3(o,e){return Hp(o.subarray(p3(o,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Cp(o,e){return o[0]==31&&o[1]==139&&o[2]==8?_3(o,e):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?m3(o,e):g3(o,e)}var y3=typeof TextDecoder<"u"&&new TextDecoder,b3=0;try{y3.decode(h3,{stream:!0}),b3=1}catch{}var P1=(o,e)=>o*hc(2,e),Ou=(o,e)=>Math.floor(o/hc(2,e)),Ad=(o,e)=>P1(o.getUint16(e+1,!0),8)+o.getUint8(e),z1=(o,e)=>P1(o.getUint32(e+2,!0),16)+o.getUint16(e,!0),v3=(o,e,t,r,l)=>{if(o!==r.getUint8(l))return o-r.getUint8(l);const u=Ad(r,l+1);if(e!==u)return e-u;const d=Ad(r,l+4);return t!==d?t-d:0},w3=(o,e,t,r)=>{const l=D1(o,e|128,t,r);return l?{z:e,x:t,y:r,offset:l[0],length:l[1],isDir:!0}:null},Zg=(o,e,t,r)=>{const l=D1(o,e,t,r);return l?{z:e,x:t,y:r,offset:l[0],length:l[1],isDir:!1}:null},D1=(o,e,t,r)=>{let l=0,u=o.byteLength/17-1;for(;l<=u;){const d=u+l>>1,s=v3(e,t,r,o,d*17);if(s>0)l=d+1;else if(s<0)u=d-1;else return[z1(o,d*17+7),o.getUint32(d*17+13,!0)]}return null},x3=(o,e)=>o.isDir&&!e.isDir?1:!o.isDir&&e.isDir?-1:o.z!==e.z?o.z-e.z:o.x!==e.x?o.x-e.x:o.y-e.y,R1=(o,e)=>{const t=o.getUint8(e*17);return{z:t&127,x:Ad(o,e*17+1),y:Ad(o,e*17+4),offset:z1(o,e*17+7),length:o.getUint32(e*17+13,!0),isDir:t>>7===1}},Gg=o=>{const e=[],t=new DataView(o);for(let r=0;r<t.byteLength/17;r++)e.push(R1(t,r));return k3(e)},k3=o=>{o.sort(x3);const e=new ArrayBuffer(17*o.length),t=new Uint8Array(e);for(let r=0;r<o.length;r++){const l=o[r];let u=l.z;l.isDir&&(u=u|128),t[r*17]=u,t[r*17+1]=l.x&255,t[r*17+2]=l.x>>8&255,t[r*17+3]=l.x>>16&255,t[r*17+4]=l.y&255,t[r*17+5]=l.y>>8&255,t[r*17+6]=l.y>>16&255,t[r*17+7]=l.offset&255,t[r*17+8]=Ou(l.offset,8)&255,t[r*17+9]=Ou(l.offset,16)&255,t[r*17+10]=Ou(l.offset,24)&255,t[r*17+11]=Ou(l.offset,32)&255,t[r*17+12]=Ou(l.offset,48)&255,t[r*17+13]=l.length&255,t[r*17+14]=l.length>>8&255,t[r*17+15]=l.length>>16&255,t[r*17+16]=l.length>>24&255}return e},S3=(o,e)=>{if(o.byteLength<17)return null;const t=o.byteLength/17,r=R1(o,t-1);if(r.isDir){const l=r.z,u=e.z-l,d=Math.trunc(e.x/(1<<u)),s=Math.trunc(e.y/(1<<u));return{z:l,x:d,y:s}}return null};function T3(o){return Ar(this,null,function*(){const e=yield o.getBytes(0,512e3),t=new DataView(e.data),r=t.getUint32(4,!0),l=t.getUint16(8,!0),u=new TextDecoder("utf-8"),d=JSON.parse(u.decode(new DataView(e.data,10,r)));let s=0;d.compression==="gzip"&&(s=2);let g=0;"minzoom"in d&&(g=+d.minzoom);let y=0;"maxzoom"in d&&(y=+d.maxzoom);let k=0,S=0,L=0,P=-180,R=-85,Z=180,U=85;if(d.bounds){const G=d.bounds.split(",");P=+G[0],R=+G[1],Z=+G[2],U=+G[3]}if(d.center){const G=d.center.split(",");k=+G[0],S=+G[1],L=+G[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:l*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:g,maxZoom:y,minLon:P,minLat:R,maxLon:Z,maxLat:U,centerZoom:L,centerLon:k,centerLat:S,etag:e.etag}})}function I3(o,e,t,r,l,u,d){return Ar(this,null,function*(){let s=yield t.getArrayBuffer(e,o.rootDirectoryOffset,o.rootDirectoryLength,o);o.specVersion===1&&(s=Gg(s));const g=Zg(new DataView(s),r,l,u);if(g){let S=(yield e.getBytes(g.offset,g.length,d)).data;const L=new DataView(S);return L.getUint8(0)===31&&L.getUint8(1)===139&&(S=Cp(new Uint8Array(S))),{data:S}}const y=S3(new DataView(s),{z:r,x:l,y:u});if(y){const k=w3(new DataView(s),y.z,y.x,y.y);if(k){let S=yield t.getArrayBuffer(e,k.offset,k.length,o);o.specVersion===1&&(S=Gg(S));const L=Zg(new DataView(S),r,l,u);if(L){let R=(yield e.getBytes(L.offset,L.length,d)).data;const Z=new DataView(R);return Z.getUint8(0)===31&&Z.getUint8(1)===139&&(R=Cp(new Uint8Array(R))),{data:R}}}}})}var F1={getHeader:T3,getZxy:I3},C3=o=>(e,t)=>{if(t instanceof AbortController)return o(e,t);const r=new AbortController;return o(e,r).then(l=>t(void 0,l.data,l.cacheControl||"",l.expires||""),l=>t(l)).catch(l=>t(l)),{cancel:()=>r.abort()}},E3=class{constructor(){this.tilev4=(o,e)=>Ar(this,null,function*(){if(o.type==="json"){const S=o.url.substr(10);let L=this.tiles.get(S);L||(L=new Wg(S),this.tiles.set(S,L));const P=yield L.getHeader();return{data:{tiles:[`${o.url}/{z}/{x}/{y}`],minzoom:P.minZoom,maxzoom:P.maxZoom,bounds:[P.minLon,P.minLat,P.maxLon,P.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=o.url.match(t);if(!r)throw new Error("Invalid PMTiles protocol URL");const l=r[1];let u=this.tiles.get(l);u||(u=new Wg(l),this.tiles.set(l,u));const d=r[2],s=r[3],g=r[4],y=yield u.getHeader(),k=yield u==null?void 0:u.getZxy(+d,+s,+g,e.signal);return k?{data:new Uint8Array(k.data),cacheControl:k.cacheControl,expires:k.expires}:y.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=C3(this.tilev4),this.tiles=new Map}add(o){this.tiles.set(o.source.getKey(),o)}get(o){return this.tiles.get(o)}};function nc(o,e){return(e>>>0)*4294967296+(o>>>0)}function L3(o,e){const t=e.buf;let r=t[e.pos++],l=(r&112)>>4;if(r<128||(r=t[e.pos++],l|=(r&127)<<3,r<128)||(r=t[e.pos++],l|=(r&127)<<10,r<128)||(r=t[e.pos++],l|=(r&127)<<17,r<128)||(r=t[e.pos++],l|=(r&127)<<24,r<128)||(r=t[e.pos++],l|=(r&1)<<31,r<128))return nc(o,l);throw new Error("Expected varint not more than 10 bytes")}function Nu(o){const e=o.buf;let t=e[o.pos++],r=t&127;return t<128||(t=e[o.pos++],r|=(t&127)<<7,t<128)||(t=e[o.pos++],r|=(t&127)<<14,t<128)||(t=e[o.pos++],r|=(t&127)<<21,t<128)?r:(t=e[o.pos],r|=(t&15)<<28,L3(r,o))}function M3(o,e,t,r){if(r===0){t===1&&(e[0]=o-1-e[0],e[1]=o-1-e[1]);const l=e[0];e[0]=e[1],e[1]=l}}var A3=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function P3(o,e,t){if(o>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>hc(2,o)-1||t>hc(2,o)-1)throw Error("tile x/y outside zoom level bounds");const r=A3[o],l=hc(2,o);let u=0,d=0,s=0;const g=[e,t];let y=l/2;for(;y>0;)u=(g[0]&y)>0?1:0,d=(g[1]&y)>0?1:0,s+=y*y*(3*u^d),M3(y,g,u,d),y=y/2;return r+s}function B1(o,e){return Ar(this,null,function*(){if(e===1||e===0)return o;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Cp(new Uint8Array(o));const t=new Response(o).body;if(!t)throw Error("Failed to read response stream");const r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw Error("Compression method not supported")})}var z3=127;function D3(o,e){let t=0,r=o.length-1;for(;t<=r;){const l=r+t>>1,u=e-o[l].tileId;if(u>0)t=l+1;else if(u<0)r=l-1;else return o[l]}return r>=0&&(o[r].runLength===0||e-o[r].tileId<o[r].runLength)?o[r]:null}var R3=class{constructor(o,e=new Headers){this.url=o,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(o){this.customHeaders=o}getBytes(o,e,t,r){return Ar(this,null,function*(){let l,u;t?u=t:(l=new AbortController,u=l.signal);const d=new Headers(this.customHeaders);d.set("range",`bytes=${o}-${o+e-1}`);let s;this.mustReload&&(s="reload");let g=yield fetch(this.url,{signal:u,cache:s,headers:d});if(o===0&&g.status===416){const L=g.headers.get("Content-Range");if(!L||!L.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const P=+L.substr(8);g=yield fetch(this.url,{signal:u,cache:"reload",headers:{range:`bytes=0-${P-1}`}})}let y=g.headers.get("Etag");if(y!=null&&y.startsWith("W/")&&(y=null),g.status===416||r&&y&&y!==r)throw this.mustReload=!0,new Ep(`Server returned non-matching ETag ${r} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(g.status>=300)throw Error(`Bad response code: ${g.status}`);const k=g.headers.get("Content-Length");if(g.status===200&&(!k||+k>e))throw l&&l.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield g.arrayBuffer(),etag:y||void 0,cacheControl:g.headers.get("Cache-Control")||void 0,expires:g.headers.get("Expires")||void 0}})}};function jo(o,e){const t=o.getUint32(e+4,!0),r=o.getUint32(e+0,!0);return t*hc(2,32)+r}function F3(o,e){const t=new DataView(o),r=t.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:jo(t,8),rootDirectoryLength:jo(t,16),jsonMetadataOffset:jo(t,24),jsonMetadataLength:jo(t,32),leafDirectoryOffset:jo(t,40),leafDirectoryLength:jo(t,48),tileDataOffset:jo(t,56),tileDataLength:jo(t,64),numAddressedTiles:jo(t,72),numTileEntries:jo(t,80),numTileContents:jo(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function O1(o){const e={buf:new Uint8Array(o),pos:0},t=Nu(e),r=[];let l=0;for(let u=0;u<t;u++){const d=Nu(e);r.push({tileId:l+d,offset:0,length:0,runLength:1}),l+=d}for(let u=0;u<t;u++)r[u].runLength=Nu(e);for(let u=0;u<t;u++)r[u].length=Nu(e);for(let u=0;u<t;u++){const d=Nu(e);d===0&&u>0?r[u].offset=r[u-1].offset+r[u-1].length:r[u].offset=d-1}return r}function B3(o){const e=new DataView(o);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Ep=class extends Error{};function O3(o,e){return Ar(this,null,function*(){const t=yield o.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(B3(t.data)<3)return[yield F1.getHeader(o)];const l=t.data.slice(0,z3),u=F3(l,t.etag),d=t.data.slice(u.rootDirectoryOffset,u.rootDirectoryOffset+u.rootDirectoryLength),s=`${o.getKey()}|${u.etag||""}|${u.rootDirectoryOffset}|${u.rootDirectoryLength}`,g=O1(yield e(d,u.internalCompression));return[u,[s,g.length,g]]})}function N3(o,e,t,r,l){return Ar(this,null,function*(){const u=yield o.getBytes(t,r,void 0,l.etag),d=yield e(u.data,l.internalCompression),s=O1(d);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var j3=class{constructor(o=100,e=!0,t=B1){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=o,this.counter=1,this.decompress=t}getHeader(o){return Ar(this,null,function*(){const e=o.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const r=new Promise((l,u)=>{O3(o,this.decompress).then(d=>{d[1]&&this.cache.set(d[1][0],{lastUsed:this.counter++,data:Promise.resolve(d[1][2])}),l(d[0]),this.prune()}).catch(d=>{u(d)})});return this.cache.set(e,{lastUsed:this.counter++,data:r}),r})}getDirectory(o,e,t,r){return Ar(this,null,function*(){const l=`${o.getKey()}|${r.etag||""}|${e}|${t}`,u=this.cache.get(l);if(u)return u.lastUsed=this.counter++,yield u.data;const d=new Promise((s,g)=>{N3(o,this.decompress,e,t,r).then(y=>{s(y),this.prune()}).catch(y=>{g(y)})});return this.cache.set(l,{lastUsed:this.counter++,data:d}),d})}getArrayBuffer(o,e,t,r){return Ar(this,null,function*(){const l=`${o.getKey()}|${r.etag||""}|${e}|${t}`,u=this.cache.get(l);if(u)return u.lastUsed=this.counter++,yield u.data;const d=new Promise((s,g)=>{o.getBytes(e,t,void 0,r.etag).then(y=>{s(y.data),this.cache.has(l),this.prune()}).catch(y=>{g(y)})});return this.cache.set(l,{lastUsed:this.counter++,data:d}),d})}prune(){if(this.cache.size>=this.maxCacheEntries){let o=1/0,e;this.cache.forEach((t,r)=>{t.lastUsed<o&&(o=t.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(o){return Ar(this,null,function*(){const e=o.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(o.getKey());const t=new Promise((r,l)=>{this.getHeader(o).then(u=>{r(),this.invalidations.delete(e)}).catch(u=>{l(u)})});this.invalidations.set(e,t)})}},Wg=class{constructor(o,e,t){typeof o=="string"?this.source=new R3(o):this.source=o,t?this.decompress=t:this.decompress=B1,e?this.cache=e:this.cache=new j3}getHeader(){return Ar(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(o,e,t,r){return Ar(this,null,function*(){const l=P3(o,e,t),u=yield this.cache.getHeader(this.source);if(u.specVersion<3)return F1.getZxy(u,this.source,this.cache,o,e,t,r);if(o<u.minZoom||o>u.maxZoom)return;let d=u.rootDirectoryOffset,s=u.rootDirectoryLength;for(let g=0;g<=3;g++){const y=yield this.cache.getDirectory(this.source,d,s,u),k=D3(y,l);if(k){if(k.runLength>0){const S=yield this.source.getBytes(u.tileDataOffset+k.offset,k.length,r,u.etag);return{data:yield this.decompress(S.data,u.tileCompression),cacheControl:S.cacheControl,expires:S.expires}}d=u.leafDirectoryOffset+k.offset,s=k.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(o,e,t,r){return Ar(this,null,function*(){try{return yield this.getZxyAttempt(o,e,t,r)}catch(l){if(l instanceof Ep)return this.cache.invalidate(this.source),yield this.getZxyAttempt(o,e,t,r);throw l}})}getMetadataAttempt(){return Ar(this,null,function*(){const o=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(o.jsonMetadataOffset,o.jsonMetadataLength,void 0,o.etag),t=yield this.decompress(e.data,o.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(t))})}getMetadata(){return Ar(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(o){if(o instanceof Ep)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw o}})}};const $3=o=>({props:o&8}),Hg=o=>({props:q3(o[3])});function U3(o){let e;const t=o[1].default,r=mn(t,o,o[2],Hg);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u&12)&&gn(r,t,l,l[2],e?_n(t,l[2],u,$3):yn(l[2]),Hg)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function V3(o){let e,t;return e=new e3({props:{openOn:o[0],$$slots:{default:[U3,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,[l]){const u={};l&1&&(u.openOn=r[0]),l&12&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function q3(o){return o?o[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function Z3(o,e,t){let{$$slots:r={},$$scope:l}=e,{openOn:u="hover"}=e;return o.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,r,l]}class yr extends Wt{constructor(e){super(),Gt(this,e,Z3,V3,Vt,{openOn:0})}}function Is(o,e,t){let r=["match",o];for(let[l,u]of Object.entries(e))r.push(l),r.push(u);return r.push(t),r}function ha(o,e,t){let r=["step",o];for(let l=1;l<e.length;l++)r.push(t[l-1]),r.push(e[l]);return r.push(t[t.length-1]),r}function dc(){return{type:"FeatureCollection",features:[]}}let G3=Date.now();function bc(o){return`${o}-${G3++}`}const Xp=Symbol.for("svelte-maplibre");function vc(){return r1(Xp)}function W3(o){let e=new WeakMap;return t=>{var d;let r=e.get(t.originalEvent);if(r!==void 0)return r;let u=(d=t.target.queryRenderedFeatures(t.point).find(s=>{var g;return(g=o.get(s.layer.id))==null?void 0:g.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function H3(){let o=new Map;return n1(Xp,{map:Mi(null),source:up(null),layer:up(null),popupTarget:up(null),cluster:Mi(),loadedImages:Mi(new Set),minzoom:Mi(0),maxzoom:Mi(24),layerEvent:Mi(null),layerInfo:o,eventTopMost:W3(o),markerClickManager:new J3})}function Xg(o){return{subscribe:o.subscribe}}function Kp({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:r=!1}){let l=vc(),u=Mi(null),d=Xg(u),s={...l,[o]:Xg(u)};if(e&&(s.popupTarget=d),r){let g=Mi(null);s.layerEvent=g,l.layerEvent=g}return t&&(s.cluster=Mi()),n1(Xp,s),{...l,self:u}}function N1(){return Kp({key:"source",setCluster:!0})}function X3(o=!0){return Kp({key:"layer",setPopupTarget:o,setMouseEvent:o})}function K3(){return Kp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class J3{constructor(){Pu(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Kg(o){let e;return t=>{if(t)for(let r in t){let l=e==null?void 0:e[r],u=t[r];l!==u&&o(r,u,l)}else if(e)for(let r in e)o(r,void 0,e[r]);e=t}}function Y3(o,...e){let t=[o];for(let r of e)if(r)Array.isArray(r)&&r[0]===o?t.push(...r.slice(1)):t.push(r);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Q3(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function $n(o,e){return["case",["boolean",["feature-state","hover"],!1],e,o]}function Jg(o){let e=o[0],t,r,l=Yg(o);return{c(){l.c(),t=Ei()},m(u,d){l.m(u,d),J(u,t,d),r=!0},p(u,d){d[0]&1&&Vt(e,e=u[0])?(ui(),he(l,1,1,We),hi(),l=Yg(u),l.c(),ne(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){r||(ne(l),r=!0)},o(u){he(l),r=!1},d(u){u&&X(t),l.d(u)}}}function Yg(o){let e;const t=o[36].default,r=mn(t,o,o[35],null);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u[1]&16)&&gn(r,t,l,l[35],e?_n(t,l[35],u,null):yn(l[35]),null)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function ek(o){let e,t,r=o[0]&&Jg(o);return{c(){r&&r.c(),e=Ei()},m(l,u){r&&r.m(l,u),J(l,e,u),t=!0},p(l,u){l[0]?r?(r.p(l,u),u[0]&1&&ne(r,1)):(r=Jg(l),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d(l)}}}function tk(o,e,t){let r,l,u,d,s,g,y,k,S,L,P,R,{$$slots:Z={},$$scope:U}=e,{id:H=bc("layer")}=e,{source:G=void 0}=e,{sourceLayer:K=void 0}=e,{beforeId:le=void 0}=e,{beforeLayerType:Se=void 0}=e,{type:Le}=e,{paint:te=void 0}=e,{layout:Y=void 0}=e,{filter:ue=void 0}=e,{applyToClusters:fe=void 0}=e,{minzoom:ce=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Ge=!1}=e,{hovered:Ee=null}=e,{interactive:ze=!0}=e,{hoverCursor:rt=void 0}=e,{eventsIfTopMost:it=!1}=e;const Qe=yc(),{map:Ft,source:jt,self:ut,minzoom:et,maxzoom:at,eventTopMost:Bt,layerInfo:Dt}=X3();bt(o,Ft,lt=>t(31,S=lt)),bt(o,jt,lt=>t(32,L=lt)),bt(o,ut,lt=>t(0,k=lt)),bt(o,et,lt=>t(34,R=lt)),bt(o,at,lt=>t(33,P=lt)),Po(()=>{k&&S&&(Dt.delete(k),S==null||S.removeLayer(k))});let Ht;function ai(lt){var mt,yt;if(!ze||!k||!S||it&&Bt(lt)!==k)return;let qe=lt.features??[],st=(yt=(mt=qe[0])==null?void 0:mt.properties)==null?void 0:yt.cluster_id,Te={event:lt,map:S,clusterId:st,layer:k,source:s,features:qe};Qe(lt.type,Te)}function si(lt){var mt,yt;if(!ze||!k||!S||it&&Bt(lt)!==k)return;rt&&(S.getCanvas().style.cursor=rt);let qe=lt.features??[];t(6,Ee=qe[0]??null);let st=(yt=(mt=qe[0])==null?void 0:mt.properties)==null?void 0:yt.cluster_id;Qe("mouseenter",{event:lt,map:S,clusterId:st,layer:k,source:s,features:qe})}function Si(lt){var mt,yt,Ie;if(!ze||!S)return;if(it&&Bt(lt)!==k){t(6,Ee=null),Ge&&Ht!==void 0&&(S==null||S.setFeatureState({source:s,sourceLayer:K,id:Ht},{hover:!1}),Ht=void 0);return}S.getCanvas().style.cursor=rt;let qe=lt.features??[],st=(yt=(mt=qe[0])==null?void 0:mt.properties)==null?void 0:yt.cluster_id,Te=(Ie=qe[0])==null?void 0:Ie.id;Te!==Ht&&(Ge&&(Ht!==void 0&&(S==null||S.setFeatureState({source:s,id:Ht,sourceLayer:K},{hover:!1})),S==null||S.setFeatureState({source:s,id:Te,sourceLayer:K},{hover:!0})),Ht=Te,t(6,Ee=qe[0]??null)),Qe("mousemove",{event:lt,map:S,clusterId:st,layer:k,source:s,features:qe})}function Ri(lt){if(!(!ze||!k||!S)){if(rt&&(S.getCanvas().style.cursor=""),t(6,Ee=null),Ge&&Ht!==void 0){const qe={source:s,id:Ht,sourceLayer:K};S==null||S.setFeatureState(qe,{hover:!1}),Ht=void 0}Qe("mouseleave",{map:S,layer:k,source:s})}}let vi=!0;function di(lt){S&&(S.off("click",lt,ai),S.off("dblclick",lt,ai),S.off("contextmenu",lt,ai),S.off("mouseenter",lt,si),S.off("mousemove",lt,Si),S.off("mouseleave",lt,Ri))}return Po(()=>{S&&k&&di(k)}),o.$$set=lt=>{"id"in lt&&t(7,H=lt.id),"source"in lt&&t(8,G=lt.source),"sourceLayer"in lt&&t(9,K=lt.sourceLayer),"beforeId"in lt&&t(10,le=lt.beforeId),"beforeLayerType"in lt&&t(11,Se=lt.beforeLayerType),"type"in lt&&t(12,Le=lt.type),"paint"in lt&&t(13,te=lt.paint),"layout"in lt&&t(14,Y=lt.layout),"filter"in lt&&t(15,ue=lt.filter),"applyToClusters"in lt&&t(16,fe=lt.applyToClusters),"minzoom"in lt&&t(17,ce=lt.minzoom),"maxzoom"in lt&&t(18,ae=lt.maxzoom),"manageHoverState"in lt&&t(19,Ge=lt.manageHoverState),"hovered"in lt&&t(6,Ee=lt.hovered),"interactive"in lt&&t(20,ze=lt.interactive),"hoverCursor"in lt&&t(21,rt=lt.hoverCursor),"eventsIfTopMost"in lt&&t(22,it=lt.eventsIfTopMost),"$$scope"in lt&&t(35,U=lt.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,r=Q3(fe)),o.$$.dirty[0]&1073774592&&t(24,l=Y3("all",r,ue)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ce??R),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,d=ae??P),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,s=G||L),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&S&&k!==H&&s){k&&(di(k),Dt.delete(k));let lt=le;if(!le&&Se){let qe=S.getStyle().layers,st=typeof Se=="function"?Se:mt=>mt.type===Se,Te=qe==null?void 0:qe.find(st);Te&&(lt=Te.id)}oi(ut,k=H,k),S.addLayer(rh({id:k,type:Le,source:s,"source-layer":K,filter:l,paint:te,layout:Y,minzoom:u,maxzoom:d}),lt),t(23,vi=!0),S.on("click",k,ai),S.on("dblclick",k,ai),S.on("contextmenu",k,ai),S.on("mouseenter",k,si),S.on("mousemove",k,Si),S.on("mouseleave",k,Ri)}o.$$.dirty[0]&1048577&&k&&Dt.set(k,{interactive:ze}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,g=k?Kg((lt,qe)=>S==null?void 0:S.setPaintProperty(k,lt,qe)):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,y=k?Kg((lt,qe)=>S==null?void 0:S.setLayoutProperty(k,lt,qe)):void 0),o.$$.dirty[0]&268443648&&(g==null||g(te)),o.$$.dirty[0]&134234112&&(y==null||y(Y)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&k&&(vi?t(23,vi=!1):S==null||S.setFilter(k,l))},[k,Ft,jt,ut,et,at,Ee,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,Ge,ze,rt,it,vi,l,d,u,y,g,s,r,S,L,P,R,U,Z]}class Jp extends Wt{constructor(e){super(),Gt(this,e,tk,ek,Vt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function ik(o){let e;const t=o[16].default,r=mn(t,o,o[24],null);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u&16777216)&&gn(r,t,l,l[24],e?_n(t,l[24],u,null):yn(l[24]),null)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function nk(o){let e,t,r;function l(d){o[17](d)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[ik]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Jp({props:u}),Ai.push(()=>Xn(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Ve(e.$$.fragment)},m(d,s){je(e,d,s),r=!0},p(d,[s]){const g={};s&2&&(g.id=d[1]),s&4&&(g.source=d[2]),s&8&&(g.sourceLayer=d[3]),s&16&&(g.beforeId=d[4]),s&32&&(g.beforeLayerType=d[5]),s&64&&(g.paint=d[6]),s&128&&(g.layout=d[7]),s&256&&(g.filter=d[8]),s&512&&(g.applyToClusters=d[9]),s&1024&&(g.minzoom=d[10]),s&2048&&(g.maxzoom=d[11]),s&4096&&(g.hoverCursor=d[12]),s&8192&&(g.manageHoverState=d[13]),s&16384&&(g.eventsIfTopMost=d[14]),s&32768&&(g.interactive=d[15]),s&16777216&&(g.$$scope={dirty:s,ctx:d}),!t&&s&1&&(t=!0,g.hovered=d[0],Hn(()=>t=!1)),e.$set(g)},i(d){r||(ne(e.$$.fragment,d),r=!0)},o(d){he(e.$$.fragment,d),r=!1},d(d){$e(e,d)}}}function rk(o,e,t){let{$$slots:r={},$$scope:l}=e,{id:u=bc("circle")}=e,{source:d=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:L=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:Z=void 0}=e,{hoverCursor:U=void 0}=e,{manageHoverState:H=!1}=e,{hovered:G=null}=e,{eventsIfTopMost:K=!1}=e,{interactive:le=!0}=e;function Se(ae){G=ae,t(0,G)}function Le(ae){Fn.call(this,o,ae)}function te(ae){Fn.call(this,o,ae)}function Y(ae){Fn.call(this,o,ae)}function ue(ae){Fn.call(this,o,ae)}function fe(ae){Fn.call(this,o,ae)}function ce(ae){Fn.call(this,o,ae)}return o.$$set=ae=>{"id"in ae&&t(1,u=ae.id),"source"in ae&&t(2,d=ae.source),"sourceLayer"in ae&&t(3,s=ae.sourceLayer),"beforeId"in ae&&t(4,g=ae.beforeId),"beforeLayerType"in ae&&t(5,y=ae.beforeLayerType),"paint"in ae&&t(6,k=ae.paint),"layout"in ae&&t(7,S=ae.layout),"filter"in ae&&t(8,L=ae.filter),"applyToClusters"in ae&&t(9,P=ae.applyToClusters),"minzoom"in ae&&t(10,R=ae.minzoom),"maxzoom"in ae&&t(11,Z=ae.maxzoom),"hoverCursor"in ae&&t(12,U=ae.hoverCursor),"manageHoverState"in ae&&t(13,H=ae.manageHoverState),"hovered"in ae&&t(0,G=ae.hovered),"eventsIfTopMost"in ae&&t(14,K=ae.eventsIfTopMost),"interactive"in ae&&t(15,le=ae.interactive),"$$scope"in ae&&t(24,l=ae.$$scope)},[G,u,d,s,g,y,k,S,L,P,R,Z,U,H,K,le,r,Se,Le,te,Y,ue,fe,ce,l]}class Yp extends Wt{constructor(e){super(),Gt(this,e,rk,nk,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ok(o){let e;const t=o[15].default,r=mn(t,o,o[23],null);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u&8388608)&&gn(r,t,l,l[23],e?_n(t,l[23],u,null):yn(l[23]),null)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function sk(o){let e,t,r;function l(d){o[16](d)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[ok]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Jp({props:u}),Ai.push(()=>Xn(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ve(e.$$.fragment)},m(d,s){je(e,d,s),r=!0},p(d,[s]){const g={};s&2&&(g.id=d[1]),s&4&&(g.source=d[2]),s&8&&(g.sourceLayer=d[3]),s&16&&(g.beforeId=d[4]),s&32&&(g.beforeLayerType=d[5]),s&64&&(g.paint=d[6]),s&128&&(g.layout=d[7]),s&256&&(g.filter=d[8]),s&512&&(g.minzoom=d[9]),s&1024&&(g.maxzoom=d[10]),s&2048&&(g.hoverCursor=d[11]),s&4096&&(g.manageHoverState=d[12]),s&8192&&(g.eventsIfTopMost=d[13]),s&16384&&(g.interactive=d[14]),s&8388608&&(g.$$scope={dirty:s,ctx:d}),!t&&s&1&&(t=!0,g.hovered=d[0],Hn(()=>t=!1)),e.$set(g)},i(d){r||(ne(e.$$.fragment,d),r=!0)},o(d){he(e.$$.fragment,d),r=!1},d(d){$e(e,d)}}}function ak(o,e,t){let{$$slots:r={},$$scope:l}=e,{id:u=bc("fill")}=e,{source:d=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:Z=void 0}=e,{manageHoverState:U=!1}=e,{hovered:H=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:K=!0}=e;function le(ce){H=ce,t(0,H)}function Se(ce){Fn.call(this,o,ce)}function Le(ce){Fn.call(this,o,ce)}function te(ce){Fn.call(this,o,ce)}function Y(ce){Fn.call(this,o,ce)}function ue(ce){Fn.call(this,o,ce)}function fe(ce){Fn.call(this,o,ce)}return o.$$set=ce=>{"id"in ce&&t(1,u=ce.id),"source"in ce&&t(2,d=ce.source),"sourceLayer"in ce&&t(3,s=ce.sourceLayer),"beforeId"in ce&&t(4,g=ce.beforeId),"beforeLayerType"in ce&&t(5,y=ce.beforeLayerType),"paint"in ce&&t(6,k=ce.paint),"layout"in ce&&t(7,S=ce.layout),"filter"in ce&&t(8,L=ce.filter),"minzoom"in ce&&t(9,P=ce.minzoom),"maxzoom"in ce&&t(10,R=ce.maxzoom),"hoverCursor"in ce&&t(11,Z=ce.hoverCursor),"manageHoverState"in ce&&t(12,U=ce.manageHoverState),"hovered"in ce&&t(0,H=ce.hovered),"eventsIfTopMost"in ce&&t(13,G=ce.eventsIfTopMost),"interactive"in ce&&t(14,K=ce.interactive),"$$scope"in ce&&t(23,l=ce.$$scope)},[H,u,d,s,g,y,k,S,L,P,R,Z,U,G,K,r,le,Se,Le,te,Y,ue,fe,l]}class wc extends Wt{constructor(e){super(),Gt(this,e,ak,sk,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function lk(o,e,t){let r;const{map:l}=vc();bt(o,l,g=>t(4,r=g));let{position:u="top-left"}=e,{container:d=void 0}=e,s=null;return Po(()=>{r!=null&&r.loaded()&&s&&r.removeControl(s)}),o.$$set=g=>{"position"in g&&t(1,u=g.position),"container"in g&&t(2,d=g.container)},o.$$.update=()=>{if(o.$$.dirty&30&&r&&!s){let g;typeof d=="string"?g=document.querySelector(d)??void 0:g=d,t(3,s=new Pr.FullscreenControl({container:g})),r.addControl(s,u)}},[l,u,d,s,r]}class ck extends Wt{constructor(e){super(),Gt(this,e,lk,null,Vt,{position:1,container:2})}}function j1(o,e,t,r,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const d=()=>{r(e)&&(o.addSource(e,t),l())};if(u){const s=()=>{e&&(o.getSource(e)?setTimeout(s,1):d())};s()}else d()}function $1(o,e,t){ew().then(()=>{let r=Ju(o);if(!r)return;r.getSource(e)===t&&r.removeSource(e)})}function Qg(o){let e=o[0],t,r,l=ey(o);return{c(){l.c(),t=Ei()},m(u,d){l.m(u,d),J(u,t,d),r=!0},p(u,d){d&1&&Vt(e,e=u[0])?(ui(),he(l,1,1,We),hi(),l=ey(u),l.c(),ne(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){r||(ne(l),r=!0)},o(u){he(l),r=!1},d(u){u&&X(t),l.d(u)}}}function ey(o){let e;const t=o[19].default,r=mn(t,o,o[18],null);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u&262144)&&gn(r,t,l,l[18],e?_n(t,l[18],u,null):yn(l[18]),null)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function uk(o){let e,t,r=o[0]&&Qg(o);return{c(){r&&r.c(),e=Ei()},m(l,u){r&&r.m(l,u),J(l,e,u),t=!0},p(l,[u]){l[0]?r?(r.p(l,u),u&1&&ne(r,1)):(r=Qg(l),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d(l)}}}function hk(o,e,t){let r,l,u,{$$slots:d={},$$scope:s}=e,{id:g=bc("geojson")}=e,{data:y}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:L=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:R=void 0}=e,{maxzoom:Z=void 0}=e,{attribution:U=void 0}=e,{buffer:H=void 0}=e,{tolerance:G=void 0}=e;const{map:K,cluster:le,self:Se}=N1();bt(o,K,Y=>t(17,l=Y)),bt(o,le,Y=>t(20,u=Y)),bt(o,Se,Y=>t(0,r=Y));let Le,te=!0;return Po(()=>{r&&Le&&l&&($1(K,r,Le),oi(Se,r=null,r),t(15,Le=void 0))}),o.$$set=Y=>{"id"in Y&&t(4,g=Y.id),"data"in Y&&t(5,y=Y.data),"generateId"in Y&&t(6,k=Y.generateId),"promoteId"in Y&&t(7,S=Y.promoteId),"filter"in Y&&t(8,L=Y.filter),"lineMetrics"in Y&&t(9,P=Y.lineMetrics),"cluster"in Y&&t(10,R=Y.cluster),"maxzoom"in Y&&t(11,Z=Y.maxzoom),"attribution"in Y&&t(12,U=Y.attribution),"buffer"in Y&&t(13,H=Y.buffer),"tolerance"in Y&&t(14,G=Y.tolerance),"$$scope"in Y&&t(18,s=Y.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&oi(le,u=R,u),o.$$.dirty&196593&&l&&r!==g&&(oi(Se,r=g,r),j1(l,r,rh({type:"geojson",data:y,filter:L,lineMetrics:P,generateId:k,promoteId:S,cluster:!!R,clusterMinPoints:R==null?void 0:R.minPoints,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius,clusterProperties:R==null?void 0:R.properties,maxzoom:Z,attribution:U,buffer:H,tolerance:G}),Y=>l&&Y===r,()=>{r&&(t(15,Le=l==null?void 0:l.getSource(r)),t(16,te=!0))})),o.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,Le=l==null?void 0:l.getSource(g))})),o.$$.dirty&98336&&Le&&(te?t(16,te=!1):Le.setData(y)),o.$$.dirty&33792&&(Le==null||Le.setClusterOptions(rh({cluster:!!R,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius})))},[r,K,le,Se,g,y,k,S,L,P,R,Z,U,H,G,Le,te,l,s,d]}class xn extends Wt{constructor(e){super(),Gt(this,e,hk,uk,Vt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function dk(o,e,t){let r;const{map:l}=vc();bt(o,l,L=>t(8,r=L));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:s=void 0}=e,{trackUserLocation:g=!1}=e,{showAccuracyCircle:y=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return Po(()=>{r!=null&&r.loaded()&&S&&r.removeControl(S)}),o.$$set=L=>{"position"in L&&t(2,u=L.position),"positionOptions"in L&&t(3,d=L.positionOptions),"fitBoundsOptions"in L&&t(4,s=L.fitBoundsOptions),"trackUserLocation"in L&&t(5,g=L.trackUserLocation),"showAccuracyCircle"in L&&t(6,y=L.showAccuracyCircle),"showUserLocation"in L&&t(7,k=L.showUserLocation),"control"in L&&t(1,S=L.control)},o.$$.update=()=>{o.$$.dirty&510&&r&&!S&&(t(1,S=new Pr.GeolocateControl({positionOptions:d,fitBoundsOptions:s,trackUserLocation:g,showAccuracyCircle:y,showUserLocation:k})),r.addControl(S,u))},[l,S,u,d,s,g,y,k,r]}class fk extends Wt{constructor(e){super(),Gt(this,e,dk,null,Vt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function pk(o){let e;const t=o[15].default,r=mn(t,o,o[23],null);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u&8388608)&&gn(r,t,l,l[23],e?_n(t,l[23],u,null):yn(l[23]),null)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function mk(o){let e,t,r;function l(d){o[16](d)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[pk]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Jp({props:u}),Ai.push(()=>Xn(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ve(e.$$.fragment)},m(d,s){je(e,d,s),r=!0},p(d,[s]){const g={};s&2&&(g.id=d[1]),s&4&&(g.source=d[2]),s&8&&(g.sourceLayer=d[3]),s&16&&(g.beforeId=d[4]),s&32&&(g.beforeLayerType=d[5]),s&64&&(g.paint=d[6]),s&128&&(g.layout=d[7]),s&256&&(g.filter=d[8]),s&512&&(g.minzoom=d[9]),s&1024&&(g.maxzoom=d[10]),s&2048&&(g.hoverCursor=d[11]),s&4096&&(g.manageHoverState=d[12]),s&8192&&(g.eventsIfTopMost=d[13]),s&16384&&(g.interactive=d[14]),s&8388608&&(g.$$scope={dirty:s,ctx:d}),!t&&s&1&&(t=!0,g.hovered=d[0],Hn(()=>t=!1)),e.$set(g)},i(d){r||(ne(e.$$.fragment,d),r=!0)},o(d){he(e.$$.fragment,d),r=!1},d(d){$e(e,d)}}}function _k(o,e,t){let{$$slots:r={},$$scope:l}=e,{id:u=bc("line")}=e,{source:d=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:Z=void 0}=e,{manageHoverState:U=!1}=e,{hovered:H=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:K=!0}=e;function le(ce){H=ce,t(0,H)}function Se(ce){Fn.call(this,o,ce)}function Le(ce){Fn.call(this,o,ce)}function te(ce){Fn.call(this,o,ce)}function Y(ce){Fn.call(this,o,ce)}function ue(ce){Fn.call(this,o,ce)}function fe(ce){Fn.call(this,o,ce)}return o.$$set=ce=>{"id"in ce&&t(1,u=ce.id),"source"in ce&&t(2,d=ce.source),"sourceLayer"in ce&&t(3,s=ce.sourceLayer),"beforeId"in ce&&t(4,g=ce.beforeId),"beforeLayerType"in ce&&t(5,y=ce.beforeLayerType),"paint"in ce&&t(6,k=ce.paint),"layout"in ce&&t(7,S=ce.layout),"filter"in ce&&t(8,L=ce.filter),"minzoom"in ce&&t(9,P=ce.minzoom),"maxzoom"in ce&&t(10,R=ce.maxzoom),"hoverCursor"in ce&&t(11,Z=ce.hoverCursor),"manageHoverState"in ce&&t(12,U=ce.manageHoverState),"hovered"in ce&&t(0,H=ce.hovered),"eventsIfTopMost"in ce&&t(13,G=ce.eventsIfTopMost),"interactive"in ce&&t(14,K=ce.interactive),"$$scope"in ce&&t(23,l=ce.$$scope)},[H,u,d,s,g,y,k,S,L,P,R,Z,U,G,K,r,le,Se,Le,te,Y,ue,fe,l]}class kn extends Wt{constructor(e){super(),Gt(this,e,_k,mk,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function gk(o,e,t){let r;const l=yc();let{layer:u=void 0}=e;const{map:d}=vc();bt(o,d,k=>t(2,r=k));function s(k){l(k.type,{...k,map:d})}const g=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],y=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Po(()=>{if(r)if(u)for(const k of g)r.off(k,u,s);else for(const k of y)r.off(k,s)}),o.$$set=k=>{"layer"in k&&t(1,u=k.layer)},o.$$.update=()=>{if(o.$$.dirty&6&&r)if(u)for(const k of g)r.on(k,u,s);else for(const k of y)r.on(k,s)},[d,u,r]}class U1 extends Wt{constructor(e){super(),Gt(this,e,gk,null,Vt,{layer:1})}}function yk(o){let e=o.getCenter(),t=Math.round(o.getZoom()*100)/100,r=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,r),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,s=`${t}/${u}/${d}`,g=o.getBearing(),y=o.getPitch();return(g||y)&&(s+=`/${Math.round(g*10)/10}`),y&&(s+=`/${Math.round(y)}`),`#${s}`}function bk(o){return o.replace("#","").split("/").map(parseFloat)}function vk(o,e,t){let r;const{map:l}=vc();bt(o,l,k=>t(6,r=k));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:s=!0}=e,{visualizePitch:g=!1}=e,y=null;return Po(()=>{r!=null&&r.loaded()&&y&&r.removeControl(y)}),o.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,d=k.showCompass),"showZoom"in k&&t(3,s=k.showZoom),"visualizePitch"in k&&t(4,g=k.visualizePitch)},o.$$.update=()=>{o.$$.dirty&126&&r&&!y&&(t(5,y=new Pr.NavigationControl({showCompass:d,showZoom:s,visualizePitch:g})),r.addControl(y,u))},[l,u,d,s,g,y,r]}class wk extends Wt{constructor(e){super(),Gt(this,e,vk,null,Vt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function xk(o,e,t){let r;const{map:l}=vc();bt(o,l,y=>t(5,r=y));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:s="metric"}=e,g=null;return Po(()=>{r!=null&&r.loaded()&&g&&r.removeControl(g)}),o.$$set=y=>{"position"in y&&t(1,u=y.position),"maxWidth"in y&&t(2,d=y.maxWidth),"unit"in y&&t(3,s=y.unit)},o.$$.update=()=>{o.$$.dirty&62&&r&&!g&&(t(4,g=new Pr.ScaleControl({maxWidth:d,unit:s})),r.addControl(g,u))},[l,u,d,s,g,r]}class kk extends Wt{constructor(e){super(),Gt(this,e,xk,null,Vt,{position:1,maxWidth:2,unit:3})}}const{window:Sk}=i1,Tk=o=>({map:o[0]&16,loadedImages:o[0]&32,allImagesLoaded:o[0]&64}),ty=o=>({map:o[4],loadedImages:o[5],allImagesLoaded:o[6]});function iy(o){let e,t,r=o[3]&&ny(o);const l=o[46].default,u=mn(l,o,o[45],ty);return{c(){r&&r.c(),e=we(),u&&u.c()},m(d,s){r&&r.m(d,s),J(d,e,s),u&&u.m(d,s),t=!0},p(d,s){d[3]?r?(r.p(d,s),s[0]&8&&ne(r,1)):(r=ny(d),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(ui(),he(r,1,1,()=>{r=null}),hi()),u&&u.p&&(!t||s[0]&112|s[1]&16384)&&gn(u,l,d,d[45],t?_n(l,d[45],s,Tk):yn(d[45]),ty)},i(d){t||(ne(r),ne(u,d),t=!0)},o(d){he(r),he(u,d),t=!1},d(d){d&&X(e),r&&r.d(d),u&&u.d(d)}}}function ny(o){let e,t,r,l,u,d,s,g;return e=new wk({props:{position:o[7]}}),r=new fk({props:{position:o[7],fitBoundsOptions:{maxZoom:12}}}),u=new ck({props:{position:o[7]}}),s=new kk({props:{position:o[7]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment),l=we(),Ve(u.$$.fragment),d=we(),Ve(s.$$.fragment)},m(y,k){je(e,y,k),J(y,t,k),je(r,y,k),J(y,l,k),je(u,y,k),J(y,d,k),je(s,y,k),g=!0},p(y,k){const S={};k[0]&128&&(S.position=y[7]),e.$set(S);const L={};k[0]&128&&(L.position=y[7]),r.$set(L);const P={};k[0]&128&&(P.position=y[7]),u.$set(P);const R={};k[0]&128&&(R.position=y[7]),s.$set(R)},i(y){g||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),ne(u.$$.fragment,y),ne(s.$$.fragment,y),g=!0)},o(y){he(e.$$.fragment,y),he(r.$$.fragment,y),he(u.$$.fragment,y),he(s.$$.fragment,y),g=!1},d(y){y&&(X(t),X(l),X(d)),$e(e,y),$e(r,y),$e(u,y),$e(s,y)}}}function Ik(o){let e,t,r,l,u,d=o[4]&&o[0]&&iy(o);return{c(){e=ee("div"),d&&d.c(),Pe(e,"class",t=Cd(o[2])+" svelte-p00lfq"),Pe(e,"data-testid","map-container"),dr(e,"expand-map",!o[2])},m(s,g){J(s,e,g),d&&d.m(e,null),o[47](e),r=!0,l||(u=[ft(Sk,"hashchange",o[11]),mp(o[10].call(null,e))],l=!0)},p(s,g){s[4]&&s[0]?d?(d.p(s,g),g[0]&17&&ne(d,1)):(d=iy(s),d.c(),ne(d,1),d.m(e,null)):d&&(ui(),he(d,1,1,()=>{d=null}),hi()),(!r||g[0]&4&&t!==(t=Cd(s[2])+" svelte-p00lfq"))&&Pe(e,"class",t),(!r||g[0]&4)&&dr(e,"expand-map",!s[2])},i(s){r||(ne(d),r=!0)},o(s){he(d),r=!1},d(s){s&&X(e),d&&d.d(),o[47](null),l=!1,cn(u)}}}function Ck(o,e,t){let r,l,u,d,{$$slots:s={},$$scope:g}=e,{map:y=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:L}=e,{diffStyleUpdates:P=!1}=e,{center:R=void 0}=e,{zoom:Z=void 0}=e,{pitch:U=0}=e,{bearing:H=0}=e,{bounds:G=void 0}=e,{hash:K=!1}=e,{updateHash:le=Ie=>{window.history.replaceState(window.history.state,"",Ie)}}=e,{loaded:Se=!1}=e,{minZoom:Le=0}=e,{maxZoom:te=22}=e,{minPitch:Y=0}=e,{maxPitch:ue=60}=e,{renderWorldCopies:fe=void 0}=e,{dragPan:ce=void 0}=e,{dragRotate:ae=void 0}=e,{pitchWithRotate:Ge=void 0}=e,{antialias:Ee=void 0}=e,{zoomOnDoubleClick:ze=!0}=e,{locale:rt=void 0}=e,{interactive:it=!0}=e,{attributionControl:Qe=!0}=e,{cooperativeGestures:Ft=!1}=e,{preserveDrawingBuffer:jt=!1}=e,{maxBounds:ut=void 0}=e,{images:et=[]}=e,{standardControls:at=!1}=e,{filterLayers:Bt=void 0}=e,{transformRequest:Dt=void 0}=e;const Ht=yc(),{map:ai,loadedImages:si}=H3();bt(o,ai,Ie=>t(4,u=Ie)),bt(o,si,Ie=>t(5,d=Ie));let Si=new Set;async function Ri(Ie,nt=!1){if(u&&!(!u.loaded()&&!nt))if("url"in Ie){Si.add(Ie.id);try{let Xt=await u.loadImage(Ie.url);u==null||u.addImage(Ie.id,Xt.data,Ie.options),d.add(Ie.id),si.set(d)}catch(Xt){Ht("error",Xt)}finally{Si.delete(Ie.id)}}else u.addImage(Ie.id,Ie.data,Ie.options),d.add(Ie.id),si.set(d)}let vi,di,lt,qe;function st(Ie){return mt(),oi(ai,u=new Pr.Map(rh({container:Ie,style:L,locale:rt,center:R,zoom:Z,pitch:U,bearing:H,minZoom:Le,maxZoom:te,minPitch:Y,maxPitch:ue,renderWorldCopies:fe,dragPan:ce,dragRotate:ae,pitchWithRotate:Ge,antialias:Ee,interactive:it,preserveDrawingBuffer:jt,maxBounds:ut,bounds:G,attributionControl:Qe,transformRequest:Dt,cooperativeGestures:Ft})),u),u.on("load",nt=>{nt.target.getContainer().setAttribute("data-testid","map"),nt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,Se=!0),Ht("load",u)}),u.on("error",nt=>Ht("error",{...nt,map:u})),u.on("movestart",nt=>Ht("movestart",{...nt,map:u})),u.on("moveend",nt=>{if(t(12,R=nt.target.getCenter()),t(13,Z=nt.target.getZoom()),t(14,U=nt.target.getPitch()),t(15,H=nt.target.getBearing()),t(16,G=nt.target.getBounds()),Ht("moveend",{...nt,map:u}),K){let Xt=new URL(window.location.href.replace(/(#.+)?$/,yk(u)));le(Xt)}}),u.on("click",nt=>Ht("click",{...nt,map:u})),u.on("dblclick",nt=>Ht("dblclick",{...nt,map:u})),u.on("contextmenu",nt=>Ht("contextmenu",{...nt,map:u})),u.on("zoomstart",nt=>Ht("zoomstart",{...nt,map:u})),u.on("zoom",nt=>{Ht("zoom",{...nt,map:u})}),u.on("zoomend",nt=>{Ht("zoomend",{...nt,map:u})}),u.on("style.load",()=>{if(u){const nt=u.getStyle();if(t(42,vi=nt.layers.map(Xt=>Xt.id)),t(43,di=Object.keys(nt.sources)),qe)for(const[Xt,wi]of Object.entries(qe))u.addSource(Xt,wi);if(lt)for(const Xt of lt)u.addLayer(Xt);for(const Xt of et)Ri(Xt,!0)}}),u.on("styledata",nt=>{if(u&&Bt){const Xt=u.getStyle().layers;if(Xt)for(let wi of Xt)Bt(wi)||u.setLayoutProperty(wi.id,"visibility","none")}Ht("styledata",{...nt,map:u})}),{destroy(){t(0,Se=!1),u==null||u.remove(),oi(ai,u=null,u)}}}let Te=L;function mt(){if(K){let Ie=bk(window.location.hash);Ie.length>=3&&(t(13,Z=Ie[0]),t(12,R=[Ie[2],Ie[1]])),Ie.length==5&&(t(15,H=Ie[3]),t(14,U=Ie[4]))}}function yt(Ie){Ai[Ie?"unshift":"push"](()=>{k=Ie,t(1,k)})}return o.$$set=Ie=>{"map"in Ie&&t(17,y=Ie.map),"mapContainer"in Ie&&t(1,k=Ie.mapContainer),"class"in Ie&&t(2,S=Ie.class),"style"in Ie&&t(18,L=Ie.style),"diffStyleUpdates"in Ie&&t(19,P=Ie.diffStyleUpdates),"center"in Ie&&t(12,R=Ie.center),"zoom"in Ie&&t(13,Z=Ie.zoom),"pitch"in Ie&&t(14,U=Ie.pitch),"bearing"in Ie&&t(15,H=Ie.bearing),"bounds"in Ie&&t(16,G=Ie.bounds),"hash"in Ie&&t(20,K=Ie.hash),"updateHash"in Ie&&t(21,le=Ie.updateHash),"loaded"in Ie&&t(0,Se=Ie.loaded),"minZoom"in Ie&&t(22,Le=Ie.minZoom),"maxZoom"in Ie&&t(23,te=Ie.maxZoom),"minPitch"in Ie&&t(24,Y=Ie.minPitch),"maxPitch"in Ie&&t(25,ue=Ie.maxPitch),"renderWorldCopies"in Ie&&t(26,fe=Ie.renderWorldCopies),"dragPan"in Ie&&t(27,ce=Ie.dragPan),"dragRotate"in Ie&&t(28,ae=Ie.dragRotate),"pitchWithRotate"in Ie&&t(29,Ge=Ie.pitchWithRotate),"antialias"in Ie&&t(30,Ee=Ie.antialias),"zoomOnDoubleClick"in Ie&&t(31,ze=Ie.zoomOnDoubleClick),"locale"in Ie&&t(32,rt=Ie.locale),"interactive"in Ie&&t(33,it=Ie.interactive),"attributionControl"in Ie&&t(34,Qe=Ie.attributionControl),"cooperativeGestures"in Ie&&t(35,Ft=Ie.cooperativeGestures),"preserveDrawingBuffer"in Ie&&t(36,jt=Ie.preserveDrawingBuffer),"maxBounds"in Ie&&t(37,ut=Ie.maxBounds),"images"in Ie&&t(38,et=Ie.images),"standardControls"in Ie&&t(3,at=Ie.standardControls),"filterLayers"in Ie&&t(39,Bt=Ie.filterLayers),"transformRequest"in Ie&&t(40,Dt=Ie.transformRequest),"$$scope"in Ie&&t(45,g=Ie.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&8&&t(7,r=typeof at=="boolean"?void 0:at),o.$$.dirty[0]&16&&t(17,y=u),o.$$.dirty[0]&786448|o.$$.dirty[1]&14336&&u&&!ic(L,Te)){const Ie=u.getStyle();if(vi&&(lt=Ie.layers.filter(nt=>!vi.includes(nt.id))),di){const nt=Object.keys(Ie.sources).filter(Xt=>!di.includes(Xt));qe={};for(const Xt of nt)qe[Xt]=Ie.sources[Xt]}t(44,Te=L),u.setStyle(L,{diff:P}),oi(si,d=new Set,d),t(41,Si=new Set)}if(o.$$.dirty[0]&49|o.$$.dirty[1]&1152&&Se&&u!=null&&u.loaded())for(let Ie of et)!d.has(Ie.id)&&!Si.has(Ie.id)&&!u.hasImage(Ie.id)&&Ri(Ie);if(o.$$.dirty[0]&32|o.$$.dirty[1]&128&&t(6,l=et.every(Ie=>d.has(Ie.id))),o.$$.dirty[0]&61456&&u){let Ie={};R!=null&&!ic(R,u==null?void 0:u.getCenter())&&(Ie.center=R),Z!=null&&!ic(Z,u==null?void 0:u.getZoom())&&(Ie.zoom=Z),H!=null&&!ic(H,u==null?void 0:u.getBearing())&&(Ie.bearing=H),U!=null&&!ic(U,u==null?void 0:u.getPitch())&&(Ie.pitch=U),Object.keys(Ie).length&&u.easeTo(Ie)}o.$$.dirty[0]&65552&&G&&!ic(G,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(G)),o.$$.dirty[0]&16|o.$$.dirty[1]&1&&(ze?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[Se,k,S,at,u,d,l,r,ai,si,st,mt,R,Z,U,H,G,y,L,P,K,le,Le,te,Y,ue,fe,ce,ae,Ge,Ee,ze,rt,it,Qe,Ft,jt,ut,et,Bt,Dt,Si,vi,di,Te,g,s,yt]}class Ek extends Wt{constructor(e){super(),Gt(this,e,Ck,Ik,Vt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const Lk=o=>({marker:o&8}),ry=o=>({marker:o[3]});function Mk(o){let e,t,r,l,u,d,s;const g=o[19].default,y=mn(g,o,o[18],ry);return{c(){e=ee("div"),y&&y.c(),Pe(e,"tabindex",t=o[1]?0:void 0),Pe(e,"role",r=o[1]?"button":void 0),mi(e,"z-index",o[2])},m(k,S){J(k,e,S),y&&y.m(e,null),u=!0,d||(s=[mp(o[7].call(null,e)),mp(l=Ak.call(null,e,o[0])),ft(e,"click",op(o[20])),ft(e,"dblclick",op(o[21])),ft(e,"contextmenu",op(ah(o[22]))),ft(e,"mouseenter",o[23]),ft(e,"mouseleave",o[24]),ft(e,"mousemove",o[25]),ft(e,"keydown",o[8])],d=!0)},p(k,[S]){y&&y.p&&(!u||S&262152)&&gn(y,g,k,k[18],u?_n(g,k[18],S,Lk):yn(k[18]),ry),(!u||S&2&&t!==(t=k[1]?0:void 0))&&Pe(e,"tabindex",t),(!u||S&2&&r!==(r=k[1]?"button":void 0))&&Pe(e,"role",r),l&&tl(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&mi(e,"z-index",k[2])},i(k){u||(ne(y,k),u=!0)},o(k){he(y,k),u=!1},d(k){k&&X(e),y&&y.d(k),d=!1,cn(s)}}}function Ak(o,e){const t=o.className;function r(l){l?o.className=`${t} ${l}`:o.className=t}return r(e),{update:r}}function Pk(o,e,t){let r,l,u,{$$slots:d={},$$scope:s}=e,{marker:g=void 0}=e,{lngLat:y}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:L=!1}=e,{draggable:P=!1}=e,{feature:R=null}=e,{offset:Z=void 0}=e,{zIndex:U=void 0}=e,{rotation:H=0}=e,{opacity:G=1}=e;const K=yc(),{map:le,layerEvent:Se,self:Le,markerClickManager:te}=K3();bt(o,le,Qe=>t(27,u=Qe)),bt(o,Se,Qe=>t(26,r=Qe)),bt(o,Le,Qe=>t(3,l=Qe));function Y(Qe){oi(Le,l=new Pr.Marker({element:Qe,rotation:H,draggable:P,offset:Z,opacity:G.toString()}).setLngLat(y).addTo(u),l),t(11,g=l);const Ft=()=>ce("dragstart"),jt=()=>{ue(),ce("drag")},ut=()=>{ue(),ce("dragend")};return P&&(l.on("dragstart",Ft),l.on("drag",jt),l.on("dragend",ut)),{destroy(){P&&(l==null||l.off("dragstart",Ft),l==null||l.off("drag",jt),l==null||l.off("dragend",ut)),t(11,g=void 0),l==null||l.remove()}}}function ue(){let Qe=l==null?void 0:l.getLngLat();Qe&&(Array.isArray(y)?t(10,y=[Qe.lng,Qe.lat]):y&&"lon"in y?t(10,y={lon:Qe.lng,lat:Qe.lat}):t(10,y=Qe))}function fe(Qe){Qe.key===" "&&(Qe.preventDefault(),Qe.stopPropagation(),ce("click"))}function ce(Qe){if(!S)return;let Ft=l==null?void 0:l.getLngLat();if(!Ft)return;const jt=[Ft.lng,Ft.lat];let ut={map:u,marker:l,lngLat:jt,features:[{type:"Feature",properties:(R==null?void 0:R.properties)??{},geometry:{type:"Point",coordinates:jt}}]};(Qe==="click"||Qe==="contextmenu")&&te.handleClick(ut),oi(Se,r={...ut,layerType:"marker",type:Qe},r),K(Qe,ut)}const ae=()=>ce("click"),Ge=()=>ce("dblclick"),Ee=()=>{ce("contextmenu")},ze=()=>{ce("mouseenter")},rt=()=>{ce("mouseleave")},it=()=>ce("mousemove");return o.$$set=Qe=>{"marker"in Qe&&t(11,g=Qe.marker),"lngLat"in Qe&&t(10,y=Qe.lngLat),"class"in Qe&&t(0,k=Qe.class),"interactive"in Qe&&t(12,S=Qe.interactive),"asButton"in Qe&&t(1,L=Qe.asButton),"draggable"in Qe&&t(13,P=Qe.draggable),"feature"in Qe&&t(14,R=Qe.feature),"offset"in Qe&&t(15,Z=Qe.offset),"zIndex"in Qe&&t(2,U=Qe.zIndex),"rotation"in Qe&&t(16,H=Qe.rotation),"opacity"in Qe&&t(17,G=Qe.opacity),"$$scope"in Qe&&t(18,s=Qe.$$scope)},o.$$.update=()=>{o.$$.dirty&1032&&(l==null||l.setLngLat(y)),o.$$.dirty&32776&&(l==null||l.setOffset(Z??[0,0])),o.$$.dirty&65544&&(l==null||l.setRotation(H)),o.$$.dirty&131080&&(l==null||l.setOpacity(G.toString()))},[k,L,U,l,le,Se,Le,Y,fe,ce,y,g,S,P,R,Z,H,G,s,d,ae,Ge,Ee,ze,rt,it]}class Pd extends Wt{constructor(e){super(),Gt(this,e,Pk,Mk,Vt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function oy(o){let e=o[0],t,r,l=sy(o);return{c(){l.c(),t=Ei()},m(u,d){l.m(u,d),J(u,t,d),r=!0},p(u,d){d&1&&Vt(e,e=u[0])?(ui(),he(l,1,1,We),hi(),l=sy(u),l.c(),ne(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){r||(ne(l),r=!0)},o(u){he(l),r=!1},d(u){u&&X(t),l.d(u)}}}function sy(o){let e;const t=o[15].default,r=mn(t,o,o[14],null);return{c(){r&&r.c()},m(l,u){r&&r.m(l,u),e=!0},p(l,u){r&&r.p&&(!e||u&16384)&&gn(r,t,l,l[14],e?_n(t,l[14],u,null):yn(l[14]),null)},i(l){e||(ne(r,l),e=!0)},o(l){he(r,l),e=!1},d(l){r&&r.d(l)}}}function zk(o){let e,t,r=o[0]&&oy(o);return{c(){r&&r.c(),e=Ei()},m(l,u){r&&r.m(l,u),J(l,e,u),t=!0},p(l,[u]){l[0]?r?(r.p(l,u),u&1&&ne(r,1)):(r=oy(l),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d(l)}}}function Dk(o,e,t){let r,l,{$$slots:u={},$$scope:d}=e,{id:s=bc("vector")}=e,{url:g=null}=e,{tiles:y=null}=e,{promoteId:k=null}=e,{bounds:S=null}=e,{scheme:L=null}=e,{attribution:P=null}=e,{minzoom:R=null}=e,{maxzoom:Z=null}=e,{volatile:U=null}=e;if(g&&g.includes("pmtiles://")&&!Pr.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let le=new E3;Pr.addProtocol("pmtiles",le.tile)}const{map:H,self:G}=N1();bt(o,H,le=>t(13,l=le)),bt(o,G,le=>t(0,r=le));let K;return Po(()=>{r&&l&&($1(H,r,K),oi(G,r=null,r),K=void 0)}),o.$$set=le=>{"id"in le&&t(3,s=le.id),"url"in le&&t(4,g=le.url),"tiles"in le&&t(5,y=le.tiles),"promoteId"in le&&t(6,k=le.promoteId),"bounds"in le&&t(7,S=le.bounds),"scheme"in le&&t(8,L=le.scheme),"attribution"in le&&t(9,P=le.attribution),"minzoom"in le&&t(10,R=le.minzoom),"maxzoom"in le&&t(11,Z=le.maxzoom),"volatile"in le&&t(12,U=le.volatile),"$$scope"in le&&t(14,d=le.$$scope)},o.$$.update=()=>{o.$$.dirty&16377&&l&&r!==s&&(oi(G,r=s,r),j1(l,r,rh({type:"vector",url:g,tiles:y,promoteId:k,bounds:S,scheme:L,attribution:P,minzoom:R,maxzoom:Z,volatile:U}),le=>l&&le===r,()=>{r&&(K=l==null?void 0:l.getSource(r))})),o.$$.dirty&8200&&(l==null||l.on("style.load",()=>{K=l==null?void 0:l.getSource(s)}))},[r,H,G,s,g,y,k,S,L,P,R,Z,U,l,d,u]}class uh extends Wt{constructor(e){super(),Gt(this,e,Dk,zk,Vt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Rk=o=>({}),ay=o=>({}),Fk=o=>({}),ly=o=>({}),Bk=o=>({}),cy=o=>({}),Ok=o=>({}),uy=o=>({});function Nk(o){let e,t,r,l,u,d,s,g,y;const k=o[1].top,S=mn(k,o,o[0],uy),L=o[1].left,P=mn(L,o,o[0],cy),R=o[1].main,Z=mn(R,o,o[0],ly),U=o[1].right,H=mn(U,o,o[0],ay);return{c(){e=ee("div"),S&&S.c(),t=we(),r=ee("div"),l=ee("div"),P&&P.c(),u=we(),d=ee("div"),Z&&Z.c(),s=we(),g=ee("div"),H&&H.c(),Pe(e,"class","top svelte-11kzs8g"),Pe(l,"class","left svelte-11kzs8g"),Pe(d,"class","main svelte-11kzs8g"),Pe(g,"class","right svelte-11kzs8g"),Pe(r,"class","main-row svelte-11kzs8g")},m(G,K){J(G,e,K),S&&S.m(e,null),J(G,t,K),J(G,r,K),F(r,l),P&&P.m(l,null),F(r,u),F(r,d),Z&&Z.m(d,null),F(r,s),F(r,g),H&&H.m(g,null),y=!0},p(G,[K]){S&&S.p&&(!y||K&1)&&gn(S,k,G,G[0],y?_n(k,G[0],K,Ok):yn(G[0]),uy),P&&P.p&&(!y||K&1)&&gn(P,L,G,G[0],y?_n(L,G[0],K,Bk):yn(G[0]),cy),Z&&Z.p&&(!y||K&1)&&gn(Z,R,G,G[0],y?_n(R,G[0],K,Fk):yn(G[0]),ly),H&&H.p&&(!y||K&1)&&gn(H,U,G,G[0],y?_n(U,G[0],K,Rk):yn(G[0]),ay)},i(G){y||(ne(S,G),ne(P,G),ne(Z,G),ne(H,G),y=!0)},o(G){he(S,G),he(P,G),he(Z,G),he(H,G),y=!1},d(G){G&&(X(e),X(t),X(r)),S&&S.d(G),P&&P.d(G),Z&&Z.d(G),H&&H.d(G)}}}function jk(o,e,t){let{$$slots:r={},$$scope:l}=e;return o.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,r]}class $k extends Wt{constructor(e){super(),Gt(this,e,jk,Nk,Vt,{})}}const Uk=o=>({}),hy=o=>({}),Vk=o=>({}),dy=o=>({}),qk=o=>({}),fy=o=>({});function Zk(o){let e,t,r,l,u,d;const s=o[4].left,g=mn(s,o,o[3],fy),y=o[4].map,k=mn(y,o,o[3],dy),S=o[4].right,L=mn(S,o,o[3],hy);return{c(){e=ee("div"),g&&g.c(),t=we(),r=ee("div"),k&&k.c(),l=we(),u=ee("div"),L&&L.c()},m(P,R){J(P,e,R),g&&g.m(e,null),o[5](e),J(P,t,R),J(P,r,R),k&&k.m(r,null),o[6](r),J(P,l,R),J(P,u,R),L&&L.m(u,null),o[7](u),d=!0},p(P,[R]){g&&g.p&&(!d||R&8)&&gn(g,s,P,P[3],d?_n(s,P[3],R,qk):yn(P[3]),fy),k&&k.p&&(!d||R&8)&&gn(k,y,P,P[3],d?_n(y,P[3],R,Vk):yn(P[3]),dy),L&&L.p&&(!d||R&8)&&gn(L,S,P,P[3],d?_n(S,P[3],R,Uk):yn(P[3]),hy)},i(P){d||(ne(g,P),ne(k,P),ne(L,P),d=!0)},o(P){he(g,P),he(k,P),he(L,P),d=!1},d(P){P&&(X(e),X(t),X(r),X(l),X(u)),g&&g.d(P),o[5](null),k&&k.d(P),o[6](null),L&&L.d(P),o[7](null)}}}function Gk(o,e,t){let r,l,u;bt(o,Lp,S=>t(0,r=S)),bt(o,Ap,S=>t(1,l=S)),bt(o,Mp,S=>t(2,u=S));let{$$slots:d={},$$scope:s}=e;function g(S){Ai[S?"unshift":"push"](()=>{r=S,Lp.set(r)})}function y(S){Ai[S?"unshift":"push"](()=>{l=S,Ap.set(l)})}function k(S){Ai[S?"unshift":"push"](()=>{u=S,Mp.set(u)})}return o.$$set=S=>{"$$scope"in S&&t(3,s=S.$$scope)},[r,l,u,s,d,g,y,k]}class xc extends Wt{constructor(e){super(),Gt(this,e,Gk,Zk,Vt,{})}}let Lp=Mi(null),Mp=Mi(null),Ap=Mi(null);const Wk="/npw/assets/help-d011708a.svg";function py(o){let e,t;return{c(){e=ee("div"),t=be(o[0]),Pe(e,"class","svelte-1uuov7f")},m(r,l){J(r,e,l),F(e,t)},p(r,l){l&1&&pt(t,r[0])},d(r){r&&X(e)}}}function Hk(o){let e,t=o[0]&&py(o);return{c(){t&&t.c(),e=Ei()},m(r,l){t&&t.m(r,l),J(r,e,l)},p(r,[l]){r[0]?t?t.p(r,l):(t=py(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:We,o:We,d(r){r&&X(e),t&&t.d(r)}}}function Xk(o,e,t){let{loading:r}=e;return o.$$set=l=>{"loading"in l&&t(0,r=l.loading)},[r]}class Kk extends Wt{constructor(e){super(),Gt(this,e,Xk,Hk,Vt,{loading:0})}}const Jk=o=>({dialog:o&1}),my=o=>({dialog:o[0]});function Yk(o){let e,t,r,l,u;const d=o[4].default,s=mn(d,o,o[3],my);return{c(){e=ee("dialog"),t=ee("article"),s&&s.c(),e.open=!0},m(g,y){J(g,e,y),F(e,t),s&&s.m(t,null),o[6](e),r=!0,l||(u=[ft(window,"click",o[1]),ft(window,"keydown",o[2]),ft(e,"close",o[5])],l=!0)},p(g,[y]){s&&s.p&&(!r||y&9)&&gn(s,d,g,g[3],r?_n(d,g[3],y,Jk):yn(g[3]),my)},i(g){r||(ne(s,g),r=!0)},o(g){he(s,g),r=!1},d(g){g&&X(e),s&&s.d(g),o[6](null),l=!1,cn(u)}}}function Qk(o,e,t){let{$$slots:r={},$$scope:l}=e,u;function d(k){u.open&&k.target==u&&u.close()}function s(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function g(k){Fn.call(this,o,k)}function y(k){Ai[k?"unshift":"push"](()=>{u=k,t(0,u)})}return o.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,d,s,l,r,g,y]}class V1 extends Wt{constructor(e){super(),Gt(this,e,Qk,Yk,Vt,{})}}function _y(o,e,t){const r=o.slice();return r[1]=e[t][0],r[2]=e[t][1],r}function gy(o){let e,t,r=o[1]+"",l,u,d,s=o[2]+"",g,y;return{c(){e=ee("tr"),t=ee("td"),l=be(r),u=we(),d=ee("td"),g=be(s),y=we()},m(k,S){J(k,e,S),F(e,t),F(t,l),F(e,u),F(e,d),F(d,g),F(e,y)},p(k,S){S&1&&r!==(r=k[1]+"")&&pt(l,r),S&1&&s!==(s=k[2]+"")&&pt(g,s)},d(k){k&&X(e)}}}function e4(o){let e,t,r=bi(Object.entries(o[0])),l=[];for(let u=0;u<r.length;u+=1)l[u]=gy(_y(o,r,u));return{c(){e=ee("table"),t=ee("tbody");for(let u=0;u<l.length;u+=1)l[u].c();Pe(e,"class","svelte-lh2o9l")},m(u,d){J(u,e,d),F(e,t);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(t,null)},p(u,[d]){if(d&1){r=bi(Object.entries(u[0]));let s;for(s=0;s<r.length;s+=1){const g=_y(u,r,s);l[s]?l[s].p(g,d):(l[s]=gy(g),l[s].c(),l[s].m(t,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=r.length}},i:We,o:We,d(u){u&&X(e),jn(l,u)}}}function t4(o,e,t){let{properties:r}=e;return o.$$set=l=>{"properties"in l&&t(0,r=l.properties)},[r]}class i4 extends Wt{constructor(e){super(),Gt(this,e,t4,e4,Vt,{properties:0})}}function yy(o,e,t){const r=o.slice();return r[3]=e[t],r}function by(o,e,t){const r=o.slice();return r[6]=e[t],r}function vy(o){let e,t;return{c(){e=ee("span"),t=be(` 
    `),mi(e,"background",o[6]),mi(e,"width","100%"),mi(e,"border","1px solid black")},m(r,l){J(r,e,l),F(e,t)},p(r,l){l&1&&mi(e,"background",r[6])},d(r){r&&X(e)}}}function n4(o){let e,t=o[3]+"",r;return{c(){e=ee("span"),r=be(t)},m(l,u){J(l,e,u),F(e,r)},p(l,u){u&2&&t!==(t=l[3]+"")&&pt(r,t)},d(l){l&&X(e)}}}function r4(o){let e,t=o[3].toFixed(o[2])+"",r;return{c(){e=ee("span"),r=be(t)},m(l,u){J(l,e,u),F(e,r)},p(l,u){u&6&&t!==(t=l[3].toFixed(l[2])+"")&&pt(r,t)},d(l){l&&X(e)}}}function wy(o){let e;function t(u,d){return u[2]>0?r4:n4}let r=t(o),l=r(o);return{c(){l.c(),e=Ei()},m(u,d){l.m(u,d),J(u,e,d)},p(u,d){r===(r=t(u))&&l?l.p(u,d):(l.d(1),l=r(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&X(e),l.d(u)}}}function o4(o){let e,t,r,l=bi(o[0]),u=[];for(let g=0;g<l.length;g+=1)u[g]=vy(by(o,l,g));let d=bi(o[1]),s=[];for(let g=0;g<d.length;g+=1)s[g]=wy(yy(o,d,g));return{c(){e=ee("div");for(let g=0;g<u.length;g+=1)u[g].c();t=we(),r=ee("div");for(let g=0;g<s.length;g+=1)s[g].c();mi(e,"display","flex"),mi(r,"display","flex"),mi(r,"justify-content","space-between")},m(g,y){J(g,e,y);for(let k=0;k<u.length;k+=1)u[k]&&u[k].m(e,null);J(g,t,y),J(g,r,y);for(let k=0;k<s.length;k+=1)s[k]&&s[k].m(r,null)},p(g,[y]){if(y&1){l=bi(g[0]);let k;for(k=0;k<l.length;k+=1){const S=by(g,l,k);u[k]?u[k].p(S,y):(u[k]=vy(S),u[k].c(),u[k].m(e,null))}for(;k<u.length;k+=1)u[k].d(1);u.length=l.length}if(y&6){d=bi(g[1]);let k;for(k=0;k<d.length;k+=1){const S=yy(g,d,k);s[k]?s[k].p(S,y):(s[k]=wy(S),s[k].c(),s[k].m(r,null))}for(;k<s.length;k+=1)s[k].d(1);s.length=d.length}},i:We,o:We,d(g){g&&(X(e),X(t),X(r)),jn(u,g),jn(s,g)}}}function s4(o,e,t){let{colorScale:r}=e,{limits:l}=e,{decimalPlaces:u=0}=e;return o.$$set=d=>{"colorScale"in d&&t(0,r=d.colorScale),"limits"in d&&t(1,l=d.limits),"decimalPlaces"in d&&t(2,u=d.decimalPlaces)},[r,l,u]}class Qp extends Wt{constructor(e){super(),Gt(this,e,s4,o4,Vt,{colorScale:0,limits:1,decimalPlaces:2})}}function zo(o){if(o==null||o==null)throw new Error("Oops, notNull given something null");return o}function xy(o){let e,t;return e=new V1({props:{$$slots:{default:[a4]},$$scope:{ctx:o}}}),e.$on("close",o[3]),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function a4(o){let e,t,r;const l=o[1].default,u=mn(l,o,o[4],null);return{c(){e=ee("h2"),e.textContent="Help",t=we(),u&&u.c()},m(d,s){J(d,e,s),J(d,t,s),u&&u.m(d,s),r=!0},p(d,s){u&&u.p&&(!r||s&16)&&gn(u,l,d,d[4],r?_n(l,d[4],s,null):yn(d[4]),null)},i(d){r||(ne(u,d),r=!0)},o(d){he(u,d),r=!1},d(d){d&&(X(e),X(t)),u&&u.d(d)}}}function l4(o){let e,t,r,l,u,d,s=o[0]&&xy(o);return{c(){e=ee("button"),e.innerHTML=`<img src="${Wk}" title="Help" alt="Help"/>`,t=we(),s&&s.c(),r=Ei(),Pe(e,"class","svelte-gb6dzm")},m(g,y){J(g,e,y),J(g,t,y),s&&s.m(g,y),J(g,r,y),l=!0,u||(d=ft(e,"click",o[2]),u=!0)},p(g,[y]){g[0]?s?(s.p(g,y),y&1&&ne(s,1)):(s=xy(g),s.c(),ne(s,1),s.m(r.parentNode,r)):s&&(ui(),he(s,1,1,()=>{s=null}),hi())},i(g){l||(ne(s),l=!0)},o(g){he(s),l=!1},d(g){g&&(X(e),X(t),X(r)),s&&s.d(g),u=!1,d()}}}function c4(o,e,t){let{$$slots:r={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),s=()=>t(0,u=!1);return o.$$set=g=>{"$$scope"in g&&t(4,l=g.$$scope)},[u,r,d,s,l]}class q1 extends Wt{constructor(e){super(),Gt(this,e,c4,l4,Vt,{})}}function ky(o,e,t){const r=o.slice();return r[1]=e[t][0],r[2]=e[t][1],r}function Sy(o){let e,t,r,l=o[1]+"",u,d;return{c(){e=ee("li"),t=ee("span"),r=we(),u=be(l),d=we(),Pe(t,"class","svelte-kzgqtg"),mi(t,"background",o[2])},m(s,g){J(s,e,g),F(e,t),F(e,r),F(e,u),F(e,d)},p(s,g){g&1&&mi(t,"background",s[2]),g&1&&l!==(l=s[1]+"")&&pt(u,l)},d(s){s&&X(e)}}}function u4(o){let e,t=bi(Object.entries(o[0])),r=[];for(let l=0;l<t.length;l+=1)r[l]=Sy(ky(o,t,l));return{c(){e=ee("ul");for(let l=0;l<r.length;l+=1)r[l].c()},m(l,u){J(l,e,u);for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(e,null)},p(l,[u]){if(u&1){t=bi(Object.entries(l[0]));let d;for(d=0;d<t.length;d+=1){const s=ky(l,t,d);r[d]?r[d].p(s,u):(r[d]=Sy(s),r[d].c(),r[d].m(e,null))}for(;d<r.length;d+=1)r[d].d(1);r.length=t.length}},i:We,o:We,d(l){l&&X(e),jn(r,l)}}}function h4(o,e,t){let{colors:r}=e;return o.$$set=l=>{"colors"in l&&t(0,r=l.colors)},[r]}class nl extends Wt{constructor(e){super(),Gt(this,e,h4,u4,Vt,{colors:0})}}let Ye;const _s=new Array(128).fill(void 0);_s.push(void 0,null,!0,!1);function ni(o){return _s[o]}let Hu=_s.length;function d4(o){o<132||(_s[o]=Hu,Hu=o)}function un(o){const e=ni(o);return d4(o),e}const Z1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Z1.decode();let $u=null;function fc(){return($u===null||$u.byteLength===0)&&($u=new Uint8Array(Ye.memory.buffer)),$u}function hn(o,e){return o=o>>>0,Z1.decode(fc().subarray(o,o+e))}function Qi(o){Hu===_s.length&&_s.push(_s.length+1);const e=Hu;return Hu=_s[e],_s[e]=o,e}let Uo=0;const Td=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},f4=typeof Td.encodeInto=="function"?function(o,e){return Td.encodeInto(o,e)}:function(o,e){const t=Td.encode(o);return e.set(t),{read:o.length,written:t.length}};function el(o,e,t){if(t===void 0){const s=Td.encode(o),g=e(s.length,1)>>>0;return fc().subarray(g,g+s.length).set(s),Uo=s.length,g}let r=o.length,l=e(r,1)>>>0;const u=fc();let d=0;for(;d<r;d++){const s=o.charCodeAt(d);if(s>127)break;u[l+d]=s}if(d!==r){d!==0&&(o=o.slice(d)),l=t(l,r,r=d+o.length*3,1)>>>0;const s=fc().subarray(l+d,l+r),g=f4(o,s);d+=g.written,l=t(l,r,d,1)>>>0}return Uo=d,l}function Ja(o){return o==null}let Ka=null;function dt(){return(Ka===null||Ka.buffer.detached===!0||Ka.buffer.detached===void 0&&Ka.buffer!==Ye.memory.buffer)&&(Ka=new DataView(Ye.memory.buffer)),Ka}function Pp(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=Pp(o[0]));for(let d=1;d<l;d++)u+=", "+Pp(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let r;if(t.length>1)r=t[1];else return toString.call(o);if(r=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:r}function p4(o,e){const t=e(o.length*1,1)>>>0;return fc().set(o,t/1),Uo=o.length,t}let Uu=null;function m4(){return(Uu===null||Uu.byteLength===0)&&(Uu=new Float64Array(Ye.memory.buffer)),Uu}function _4(o,e){return o=o>>>0,m4().subarray(o/8,o/8+e)}function g4(o,e){return o=o>>>0,fc().subarray(o/1,o/1+e)}function la(o,e){try{return o.apply(this,e)}catch(t){Ye.__wbindgen_exn_store(Qi(t))}}const Ty=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(o=>Ye.__wbg_mapmodel_free(o>>>0,1));class y4{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ty.unregister(this),e}free(){const e=this.__destroy_into_raw();Ye.__wbg_mapmodel_free(e,0)}constructor(e){try{const u=Ye.__wbindgen_add_to_stack_pointer(-16),d=p4(e,Ye.__wbindgen_malloc),s=Uo;Ye.mapmodel_new(u,d,s);var t=dt().getInt32(u+4*0,!0),r=dt().getInt32(u+4*1,!0),l=dt().getInt32(u+4*2,!0);if(l)throw un(r);return this.__wbg_ptr=t>>>0,Ty.register(this,this.__wbg_ptr,this),this}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderDebug(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getInvertedBoundary(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getInvertedBoundary(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getBounds(){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getBounds(l,this.__wbg_ptr);var e=dt().getInt32(l+4*0,!0),t=dt().getInt32(l+4*1,!0),r=_4(e,t).slice();return Ye.__wbindgen_free(e,t*8,8),r}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_toRouteSnapper(l,this.__wbg_ptr);var e=dt().getInt32(l+4*0,!0),t=dt().getInt32(l+4*1,!0),r=g4(e,t).slice();return Ye.__wbindgen_free(e,t*1,1),r}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,t){try{const u=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_setRoute(u,this.__wbg_ptr,!Ja(e),Ja(e)?0:e,Qi(t));var r=dt().getInt32(u+4*0,!0),l=dt().getInt32(u+4*1,!0);if(l)throw un(r)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_deleteRoute(l,this.__wbg_ptr,e);var t=dt().getInt32(l+4*0,!0),r=dt().getInt32(l+4*1,!0);if(r)throw un(t)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){Ye.mapmodel_clearAllRoutes(this.__wbg_ptr)}autosplitRoute(e){let t,r;try{const k=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_autosplitRoute(k,this.__wbg_ptr,Qi(e));var l=dt().getInt32(k+4*0,!0),u=dt().getInt32(k+4*1,!0),d=dt().getInt32(k+4*2,!0),s=dt().getInt32(k+4*3,!0),g=l,y=u;if(s)throw g=0,y=0,un(d);return t=g,r=y,hn(g,y)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(t,r,1)}}renderRoutes(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderRoutes(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}evaluateRoute(e){let t,r;try{const k=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_evaluateRoute(k,this.__wbg_ptr,Qi(e));var l=dt().getInt32(k+4*0,!0),u=dt().getInt32(k+4*1,!0),d=dt().getInt32(k+4*2,!0),s=dt().getInt32(k+4*3,!0),g=l,y=u;if(s)throw g=0,y=0,un(d);return t=g,r=y,hn(g,y)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(t,r,1)}}debugReachablePath(e,t){let r,l;try{const S=Ye.__wbindgen_add_to_stack_pointer(-16),L=el(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),P=Uo;Ye.mapmodel_debugReachablePath(S,this.__wbg_ptr,L,P,t);var u=dt().getInt32(S+4*0,!0),d=dt().getInt32(S+4*1,!0),s=dt().getInt32(S+4*2,!0),g=dt().getInt32(S+4*3,!0),y=u,k=d;if(g)throw y=0,k=0,un(s);return r=y,l=k,hn(y,k)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(r,l,1)}}debugUnreachablePath(e,t){let r,l;try{const S=Ye.__wbindgen_add_to_stack_pointer(-16),L=el(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),P=Uo;Ye.mapmodel_debugUnreachablePath(S,this.__wbg_ptr,L,P,t);var u=dt().getInt32(S+4*0,!0),d=dt().getInt32(S+4*1,!0),s=dt().getInt32(S+4*2,!0),g=dt().getInt32(S+4*3,!0),y=u,k=d;if(g)throw y=0,k=0,un(s);return r=y,l=k,hn(y,k)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(r,l,1)}}evaluateOD(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_evaluateOD(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}recalculateStats(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_recalculateStats(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_toSavefile(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16),u=el(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),d=Uo;Ye.mapmodel_loadSavefile(l,this.__wbg_ptr,u,d);var t=dt().getInt32(l+4*0,!0),r=dt().getInt32(l+4*1,!0);if(r)throw un(t)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_meshDensity(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}classifyExistingNetwork(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_classifyExistingNetwork(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}importExistingRoutes(){return Ye.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return Ye.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getSchools(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getGPHospitals(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getGPHospitals(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getTownCentres(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getTownCentres(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getDataZones(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getDataZones(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderReachableNetwork(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderReachableNetwork(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderLevelOfService(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderLevelOfService(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderCoreNetwork(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderCoreNetwork(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderPrecalculatedFlows(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderPrecalculatedFlows(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getMajorJunctions(){let e,t;try{const y=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getMajorJunctions(y,this.__wbg_ptr);var r=dt().getInt32(y+4*0,!0),l=dt().getInt32(y+4*1,!0),u=dt().getInt32(y+4*2,!0),d=dt().getInt32(y+4*3,!0),s=r,g=l;if(d)throw s=0,g=0,un(u);return e=s,t=g,hn(s,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}}async function b4(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(r){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function v4(){const o={};return o.wbg={},o.wbg.__wbindgen_object_drop_ref=function(e){un(e)},o.wbg.__wbindgen_string_new=function(e,t){const r=hn(e,t);return Qi(r)},o.wbg.__wbindgen_string_get=function(e,t){const r=ni(t),l=typeof r=="string"?r:void 0;var u=Ja(l)?0:el(l,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),d=Uo;dt().setInt32(e+4*1,d,!0),dt().setInt32(e+4*0,u,!0)},o.wbg.__wbindgen_number_get=function(e,t){const r=ni(t),l=typeof r=="number"?r:void 0;dt().setFloat64(e+8*1,Ja(l)?0:l,!0),dt().setInt32(e+4*0,!Ja(l),!0)},o.wbg.__wbindgen_error_new=function(e,t){const r=new Error(hn(e,t));return Qi(r)},o.wbg.__wbindgen_boolean_get=function(e){const t=ni(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_is_bigint=function(e){return typeof ni(e)=="bigint"},o.wbg.__wbindgen_is_object=function(e){const t=ni(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_in=function(e,t){return ni(e)in ni(t)},o.wbg.__wbindgen_bigint_from_i64=function(e){return Qi(e)},o.wbg.__wbindgen_jsval_eq=function(e,t){return ni(e)===ni(t)},o.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Qi(t)},o.wbg.__wbindgen_is_string=function(e){return typeof ni(e)=="string"},o.wbg.__wbindgen_is_undefined=function(e){return ni(e)===void 0},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return ni(e)==ni(t)},o.wbg.__wbindgen_as_number=function(e){return+ni(e)},o.wbg.__wbg_String_b9412f8799faab3e=function(e,t){const r=String(ni(t)),l=el(r,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=Uo;dt().setInt32(e+4*1,u,!0),dt().setInt32(e+4*0,l,!0)},o.wbg.__wbindgen_object_clone_ref=function(e){const t=ni(e);return Qi(t)},o.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,t){const r=ni(e)[ni(t)];return Qi(r)},o.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(ni(e))},o.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(ni(e))},o.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(ni(e))},o.wbg.__wbg_log_b103404cc5920657=function(e){console.log(ni(e))},o.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(ni(e))},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Qi(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=ni(t).stack,l=el(r,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=Uo;dt().setInt32(e+4*1,u,!0),dt().setInt32(e+4*0,l,!0)},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,l;try{r=e,l=t,console.error(hn(e,t))}finally{Ye.__wbindgen_free(r,l,1)}},o.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const t=ni(e).performance;return Qi(t)},o.wbg.__wbg_now_abd80e969af37148=function(e){return ni(e).now()},o.wbg.__wbg_get_3baa728f9d58d3f6=function(e,t){const r=ni(e)[t>>>0];return Qi(r)},o.wbg.__wbg_length_ae22078168b726f5=function(e){return ni(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof ni(e)=="function"},o.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,t){const r=new Function(hn(e,t));return Qi(r)},o.wbg.__wbg_next_de3e9db4440638b2=function(e){const t=ni(e).next;return Qi(t)},o.wbg.__wbg_next_f9cb570345655b9a=function(){return la(function(e){const t=ni(e).next();return Qi(t)},arguments)},o.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return ni(e).done},o.wbg.__wbg_value_6d39332ab4788d86=function(e){const t=ni(e).value;return Qi(t)},o.wbg.__wbg_iterator_888179a48810a9fe=function(){return Qi(Symbol.iterator)},o.wbg.__wbg_get_224d16597dbbfd96=function(){return la(function(e,t){const r=Reflect.get(ni(e),ni(t));return Qi(r)},arguments)},o.wbg.__wbg_call_1084a111329e68ce=function(){return la(function(e,t){const r=ni(e).call(ni(t));return Qi(r)},arguments)},o.wbg.__wbg_self_3093d5d1f7bcb682=function(){return la(function(){const e=self.self;return Qi(e)},arguments)},o.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return la(function(){const e=window.window;return Qi(e)},arguments)},o.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return la(function(){const e=globalThis.globalThis;return Qi(e)},arguments)},o.wbg.__wbg_global_e5a3fe56f8be9485=function(){return la(function(){const e=global.global;return Qi(e)},arguments)},o.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(ni(e))},o.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let t;try{t=ni(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_call_89af060b4e1523f2=function(){return la(function(e,t,r){const l=ni(e).call(ni(t),ni(r));return Qi(l)},arguments)},o.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let t;try{t=ni(e)instanceof Map}catch{t=!1}return t},o.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(ni(e))},o.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const t=Object.entries(ni(e));return Qi(t)},o.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const t=ni(e).buffer;return Qi(t)},o.wbg.__wbg_new_ea1883e1e5e86686=function(e){const t=new Uint8Array(ni(e));return Qi(t)},o.wbg.__wbg_set_d1e79e2388520f18=function(e,t,r){ni(e).set(ni(t),r>>>0)},o.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return ni(e).length},o.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let t;try{t=ni(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const r=ni(t),l=typeof r=="bigint"?r:void 0;dt().setBigInt64(e+8*1,Ja(l)?BigInt(0):l,!0),dt().setInt32(e+4*0,!Ja(l),!0)},o.wbg.__wbindgen_debug_string=function(e,t){const r=Pp(ni(t)),l=el(r,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=Uo;dt().setInt32(e+4*1,u,!0),dt().setInt32(e+4*0,l,!0)},o.wbg.__wbindgen_throw=function(e,t){throw new Error(hn(e,t))},o.wbg.__wbindgen_memory=function(){const e=Ye.memory;return Qi(e)},o}function w4(o,e){return Ye=o.exports,G1.__wbindgen_wasm_module=e,Ka=null,Uu=null,$u=null,Ye}async function G1(o){if(Ye!==void 0)return Ye;typeof o<"u"&&Object.getPrototypeOf(o)===Object.prototype?{module_or_path:o}=o:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof o>"u"&&(o=new URL("backend_bg.wasm",self.location));const e=v4();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:r}=await b4(await o,e);return w4(t,r)}class x4{constructor(){Pu(this,"inner");this.inner=null}async loadFile(e){await G1(),this.inner=new y4(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,t){this.checkReady(),this.inner.setRoute(e??void 0,t)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}autosplitRoute(e){return this.checkReady(),JSON.parse(this.inner.autosplitRoute(e))}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,t))}debugUnreachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,t))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let W1="MZEJTanw3WpxRvt7qDfo",zd=Mi(""),ln=Mi({kind:"main"}),gs=Mi("Primary"),H1=Mi(null),oh=Mi(0),Ln=Mi(null),da=Mi(null),il=Mi(null),zp=Mi("infra_type"),em=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],pc=Object.fromEntries(em.map(([o,e,t])=>[o,[e,t]]));async function sh(){let o=Ju(Ln),e=Ju(zd);if(!o||!e)return;let t=await o.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,t)}let Dp=Mi(!0);function kc(o){return Ju(Dp)?`https://assets.od2net.org/tmp_npt_editor/${o}`:o}let Iy=Mi(null);function ji(o){return{id:o,beforeId:k4(o)}}function k4(o){let e=Ju(H1);if(!e){console.warn(`getBeforeId(${o}) called before map is ready. Z-ordering may be incorrect.`);return}let t,r=!1;for(let l=Ey.length-1;l>=0;l--){let u=Ey[l];if(u==o){r=!0;break}e.getLayer(u)&&(t=u)}if(!r)throw new Error(`Layer ID ${o} not defined in layerZorder`);return t}let Cy=o=>o;const Ey=[Cy("Ferry line"),"all-population","all-population-outline","simd","simd-outline","urban-areas","main-mode","cn-debug","cn","existing-infra-debug","existing-infra","traffic-debug","traffic","gradients","npt-coverage","los","rnet","reachability","debug-reachability-town_centres","debug-reachability-schools","debug-reachability-gp_hospitals","gp-hospitals","schools","town-centres","major-junctions","snapper-lines","snapper-preview","edit-current-routes","edit-route-sections","eval-od-mode","debug-mode","mesh-density","mesh-density-outline","eval-current-routes","eval-route-breakdown","eval-car-route",Cy("Road labels"),"fade-study-area"];function S4(o){let e,t,r,l,u,d,s,g;return{c(){e=ee("div"),t=ee("h2"),t.textContent="Debug network mode",r=we(),l=ee("button"),l.textContent="Back",u=we(),d=ee("p"),d.textContent="Hover to see a segment's properties, and click to open OSM",Pe(e,"slot","left")},m(y,k){J(y,e,k),F(e,t),F(e,r),F(e,l),F(e,u),F(e,d),s||(g=ft(l,"click",o[3]),s=!0)},p:We,d(y){y&&X(e),s=!1,g()}}}function T4(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function I4(o){let e,t;return e=new xn({props:{data:o[4],generateId:!0,$$slots:{default:[L4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&1&&(u.data=r[4]),l&64&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function C4(o){let e,t;return e=new i4({props:{properties:o[5]}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&32&&(u.properties=r[5]),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function E4(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[C4,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function L4(o){let e,t;const r=[ji("debug-mode"),{paint:{"line-width":$n(5,7),"line-color":"black"}},{manageHoverState:!0},{hoverCursor:"pointer"},{eventsIfTopMost:!0}];let l={$$slots:{default:[E4]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),e.$on("click",o[2]),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s={};d&64&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function M4(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function A4(o){let e,t,r,l={ctx:o,current:null,token:null,hasCatch:!1,pending:M4,then:I4,catch:T4,value:4,blocks:[,,,]};return Dr(t=zo(o[0]).renderDebug(),l),{c(){e=ee("div"),l.block.c(),Pe(e,"slot","map")},m(u,d){J(u,e,d),l.block.m(e,l.anchor=null),l.mount=()=>e,l.anchor=null,r=!0},p(u,d){o=u,l.ctx=o,d&1&&t!==(t=zo(o[0]).renderDebug())&&Dr(t,l)||ba(l,o,d)},i(u){r||(ne(l.block),r=!0)},o(u){for(let d=0;d<3;d+=1){const s=l.blocks[d];he(s)}r=!1},d(u){u&&X(e),l.block.d(),l.token=null,l=null}}}function P4(o){let e,t;return e=new xc({props:{$$slots:{map:[A4],left:[S4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,[l]){const u={};l&67&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function z4(o,e,t){let r,l;return bt(o,Ln,s=>t(0,r=s)),bt(o,ln,s=>t(1,l=s)),[r,l,s=>window.open(zo(s.detail.features[0].properties).way,"_blank"),()=>oi(ln,l={kind:"main"},l)]}class D4 extends Wt{constructor(e){super(),Gt(this,e,z4,P4,Vt,{})}}function R4(o){let e,t,r,l,u,d;return{c(){e=ee("div"),t=ee("h2"),t.textContent="Debug mesh density mode",r=we(),l=ee("button"),l.textContent="Back",Pe(e,"slot","left")},m(s,g){J(s,e,g),F(e,t),F(e,r),F(e,l),u||(d=ft(l,"click",o[2]),u=!0)},p:We,d(s){s&&X(e),u=!1,d()}}}function F4(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function B4(o){let e,t;return e=new xn({props:{data:o[3],generateId:!0,$$slots:{default:[O4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&1&&(u.data=r[3]),l&16&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function O4(o){let e,t,r,l;const u=[ji("mesh-density"),{paint:{"fill-color":"grey","fill-opacity":$n(.5,1)}},{manageHoverState:!0}];let d={};for(let y=0;y<u.length;y+=1)d=Ni(d,u[y]);e=new wc({props:d});const s=[ji("mesh-density-outline"),{paint:{"line-color":"black"}}];let g={};for(let y=0;y<s.length;y+=1)g=Ni(g,s[y]);return r=new kn({props:g}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(y,k){je(e,y,k),J(y,t,k),je(r,y,k),l=!0},p(y,k){const S={};e.$set(S);const L={};r.$set(L)},i(y){l||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),l=!0)},o(y){he(e.$$.fragment,y),he(r.$$.fragment,y),l=!1},d(y){y&&X(t),$e(e,y),$e(r,y)}}}function N4(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function j4(o){let e,t,r,l={ctx:o,current:null,token:null,hasCatch:!1,pending:N4,then:B4,catch:F4,value:3,blocks:[,,,]};return Dr(t=zo(o[0]).meshDensity(),l),{c(){e=ee("div"),l.block.c(),Pe(e,"slot","map")},m(u,d){J(u,e,d),l.block.m(e,l.anchor=null),l.mount=()=>e,l.anchor=null,r=!0},p(u,d){o=u,l.ctx=o,d&1&&t!==(t=zo(o[0]).meshDensity())&&Dr(t,l)||ba(l,o,d)},i(u){r||(ne(l.block),r=!0)},o(u){for(let d=0;d<3;d+=1){const s=l.blocks[d];he(s)}r=!1},d(u){u&&X(e),l.block.d(),l.token=null,l=null}}}function $4(o){let e,t;return e=new xc({props:{$$slots:{map:[j4],left:[R4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,[l]){const u={};l&19&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function U4(o,e,t){let r,l;return bt(o,Ln,d=>t(0,r=d)),bt(o,ln,d=>t(1,l=d)),[r,l,()=>oi(ln,l={kind:"main"},l)]}class V4 extends Wt{constructor(e){super(),Gt(this,e,U4,$4,Vt,{})}}let X1=Mi(new Map),Rp=Mi(!0),Dd=Mi(!1),Rd=Mi(!1),Fd=Mi(!1),Bd=Mi(!1),Od=Mi(!1),lc=Mi(!1),Fp=Mi(!0),Ly=Mi(!1);function q4(o){let e,t,r,l;const u=o[1].default,d=mn(u,o,o[0],null);return{c(){e=ee("a"),d&&d.c(),Pe(e,"href","#")},m(s,g){J(s,e,g),d&&d.m(e,null),t=!0,r||(l=ft(e,"click",ah(o[2])),r=!0)},p(s,[g]){d&&d.p&&(!t||g&1)&&gn(d,u,s,s[0],t?_n(u,s[0],g,null):yn(s[0]),null)},i(s){t||(ne(d,s),t=!0)},o(s){he(d,s),t=!1},d(s){s&&X(e),d&&d.d(s),r=!1,l()}}}function Z4(o,e,t){let{$$slots:r={},$$scope:l}=e;function u(d){Fn.call(this,o,d)}return o.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,r,u]}class G4 extends Wt{constructor(e){super(),Gt(this,e,Z4,q4,Vt,{})}}let er={Primary:"#c00000",Secondary:"#e97132",LocalAccess:"#ffc000",LongDistance:"#4ea72e"},tm={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},K1={"<= 3%":"#59ee19","3 - 5%":"#37a009","5 - 7%":"#FFC300","7 - 10%":"#C70039","> 10%":"#581845"},ya=Is(["get","infra_type"],Object.fromEntries(em.map(o=>[o[0],o[2]])),"red"),Bp=Is(["get","tier"],er,"cyan"),Op=Is(["get","los"],tm,"black"),My=Is(["get","gradient_group"],K1,"black");function Ay(o){let e,t,r,l,u=`2px solid ${er.Primary}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Primary Route Reference Layers",r=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,s){J(d,e,s),F(e,t),F(e,r),F(e,l),o[8](l)},p:We,d(d){d&&X(e),o[8](null)}}}function Py(o){let e,t,r,l,u=`2px solid ${er.Secondary}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Secondary Route Reference Layers",r=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,s){J(d,e,s),F(e,t),F(e,r),F(e,l),o[9](l)},p:We,d(d){d&&X(e),o[9](null)}}}function zy(o){let e,t,r,l,u=`2px solid ${er.LocalAccess}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Local Access Route Reference Layers",r=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,s){J(d,e,s),F(e,t),F(e,r),F(e,l),o[10](l)},p:We,d(d){d&&X(e),o[10](null)}}}function Dy(o){let e,t,r,l,u=`2px solid ${er.LongDistance}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Long Disance Route Reference Layers",r=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,s){J(d,e,s),F(e,t),F(e,r),F(e,l),o[11](l)},p:We,d(d){d&&X(e),o[11](null)}}}function W4(o){let e,t,r,l,u,d,s,g,y,k=o[5]=="Primary"&&Ay(o),S=o[5]=="Secondary"&&Py(o),L=o[5]=="LocalAccess"&&zy(o),P=o[5]=="LongDistance"&&Dy(o);return{c(){e=ee("details"),t=ee("summary"),t.textContent="Basic Reference Layers",r=we(),l=ee("div"),u=we(),k&&k.c(),d=we(),S&&S.c(),s=we(),L&&L.c(),g=we(),P&&P.c(),y=Ei(),e.open=!0,mi(e,"border","2px solid black")},m(R,Z){J(R,e,Z),F(e,t),F(e,r),F(e,l),o[7](l),J(R,u,Z),k&&k.m(R,Z),J(R,d,Z),S&&S.m(R,Z),J(R,s,Z),L&&L.m(R,Z),J(R,g,Z),P&&P.m(R,Z),J(R,y,Z)},p(R,[Z]){R[5]=="Primary"?k?k.p(R,Z):(k=Ay(R),k.c(),k.m(d.parentNode,d)):k&&(k.d(1),k=null),R[5]=="Secondary"?S?S.p(R,Z):(S=Py(R),S.c(),S.m(s.parentNode,s)):S&&(S.d(1),S=null),R[5]=="LocalAccess"?L?L.p(R,Z):(L=zy(R),L.c(),L.m(g.parentNode,g)):L&&(L.d(1),L=null),R[5]=="LongDistance"?P?P.p(R,Z):(P=Dy(R),P.c(),P.m(y.parentNode,y)):P&&(P.d(1),P=null)},i:We,o:We,d(R){R&&(X(e),X(u),X(d),X(s),X(g),X(y)),o[7](null),k&&k.d(R),S&&S.d(R),L&&L.d(R),P&&P.d(R)}}}function ju(o,e,t){if(o){o.innerHTML="";for(let r of t){let l=e.get(r);l&&o.appendChild(l)}}}function H4(o,e,t){let r,l;bt(o,X1,Z=>t(6,r=Z)),bt(o,gs,Z=>t(5,l=Z));let u=null,d=null,s=null,g=null,y=null;function k(Z){Ai[Z?"unshift":"push"](()=>{u=Z,t(0,u)})}function S(Z){Ai[Z?"unshift":"push"](()=>{d=Z,t(1,d)})}function L(Z){Ai[Z?"unshift":"push"](()=>{s=Z,t(2,s)})}function P(Z){Ai[Z?"unshift":"push"](()=>{g=Z,t(3,g)})}function R(Z){Ai[Z?"unshift":"push"](()=>{y=Z,t(4,y)})}return o.$$.update=()=>{o.$$.dirty&65&&ju(u,r,["route network","simd","population density","core network","existing network","level of service","traffic volume","gradient","reachable network"]),o.$$.dirty&66&&ju(d,r,["high npt route coverage"]),o.$$.dirty&68&&ju(s,r,["town centres"]),o.$$.dirty&72&&ju(g,r,["schools","gp hospitals"]),o.$$.dirty&80&&ju(y,r,["urban areas"])},[u,d,s,g,y,l,r,k,S,L,P,R]}class X4 extends Wt{constructor(e){super(),Gt(this,e,H4,W4,Vt,{})}}function K4(o){let e,t,r,l,u,d=Math.round(o[2]*100)+"",s,g,y,k,S,L,P;return{c(){e=ee("p"),t=ee("a"),r=be(o[1]),l=be(`
  :
  `),u=ee("b"),s=be(d),g=be("%"),y=we(),k=ee("progress"),Pe(t,"href","#"),k.value=S=o[2]*100,Pe(k,"max","100")},m(R,Z){J(R,e,Z),F(e,t),F(t,r),F(e,l),F(e,u),F(u,s),F(u,g),F(e,y),F(e,k),L||(P=ft(t,"click",ah(o[3])),L=!0)},p(R,[Z]){Z&2&&pt(r,R[1]),Z&4&&d!==(d=Math.round(R[2]*100)+"")&&pt(s,d),Z&4&&S!==(S=R[2]*100)&&(k.value=S)},i:We,o:We,d(R){R&&X(e),L=!1,P()}}}function J4(o,e,t){let{label:r}=e,{showLayer:l}=e,{pct:u}=e;const d=()=>t(0,l=!0);return o.$$set=s=>{"label"in s&&t(1,r=s.label),"showLayer"in s&&t(0,l=s.showLayer),"pct"in s&&t(2,u=s.pct)},[l,r,u,d]}class ys extends Wt{constructor(e){super(),Gt(this,e,J4,K4,Vt,{label:1,showLayer:0,pct:2})}}function Ry(o,e,t){const r=o.slice();return r[22]=e[t][0],r[23]=e[t][1],r}function Fy(o,e,t){const r=o.slice();return r[22]=e[t][0],r[23]=e[t][1],r}function By(o){let e,t,r,l=`2px solid ${er.Primary}`,u,d,s,g,y,k,S,L,P=o[0].average_weighted_directness.toFixed(1)+"",R,Z,U,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae;function Ge(et){o[11](et)}let Ee={label:"High cycling flow coverage",pct:mc(o[0].covered_flow_quintile_sums[0],o[0].total_flow_quintile_sums[0])};o[1]!==void 0&&(Ee.showLayer=o[1]),t=new ys({props:Ee}),Ai.push(()=>Xn(t,"showLayer",Ge));let ze=(o[2]=="Secondary"||o[2]=="LocalAccess"||o[2]=="LongDistance")&&Oy(o),rt=(o[2]=="LocalAccess"||o[2]=="LongDistance")&&Ny(o),it=o[2]=="LongDistance"&&jy(o),Qe=bi(Object.entries(o[0].od_percents_infra_type).toSorted(Vy)),Ft=[];for(let et=0;et<Qe.length;et+=1)Ft[et]=$y(Fy(o,Qe,et));let jt=bi(Object.entries(o[0].od_percents_los).toSorted(qy)),ut=[];for(let et=0;et<jt.length;et+=1)ut[et]=Uy(Ry(o,jt,et));return{c(){e=ee("div"),Ve(t.$$.fragment),u=we(),ze&&ze.c(),d=we(),rt&&rt.c(),s=we(),it&&it.c(),g=we(),y=ee("div"),k=ee("p"),S=ee("a"),S.textContent="Average weighted directness",L=be(`
      : `),R=be(P),Z=be("x"),U=we(),H=ee("details"),G=ee("summary"),G.textContent="Percent of demand by infrastructure type",K=we(),le=ee("ul");for(let et=0;et<Ft.length;et+=1)Ft[et].c();Se=we(),Le=ee("details"),te=ee("summary"),te.textContent="Percent of demand by level of service:",Y=we(),ue=ee("ul");for(let et=0;et<ut.length;et+=1)ut[et].c();mi(e,"border",l),Pe(S,"href","#"),mi(y,"margin-top","4px"),mi(y,"border","2px solid black")},m(et,at){J(et,e,at),je(t,e,null),J(et,u,at),ze&&ze.m(et,at),J(et,d,at),rt&&rt.m(et,at),J(et,s,at),it&&it.m(et,at),J(et,g,at),J(et,y,at),F(y,k),F(k,S),F(k,L),F(k,R),F(k,Z),F(y,U),F(y,H),F(H,G),F(H,K),F(H,le);for(let Bt=0;Bt<Ft.length;Bt+=1)Ft[Bt]&&Ft[Bt].m(le,null);F(y,Se),F(y,Le),F(Le,te),F(Le,Y),F(Le,ue);for(let Bt=0;Bt<ut.length;Bt+=1)ut[Bt]&&ut[Bt].m(ue,null);fe=!0,ce||(ae=ft(S,"click",ah(o[20])),ce=!0)},p(et,at){const Bt={};if(at&1&&(Bt.pct=mc(et[0].covered_flow_quintile_sums[0],et[0].total_flow_quintile_sums[0])),!r&&at&2&&(r=!0,Bt.showLayer=et[1],Hn(()=>r=!1)),t.$set(Bt),et[2]=="Secondary"||et[2]=="LocalAccess"||et[2]=="LongDistance"?ze?(ze.p(et,at),at&4&&ne(ze,1)):(ze=Oy(et),ze.c(),ne(ze,1),ze.m(d.parentNode,d)):ze&&(ui(),he(ze,1,1,()=>{ze=null}),hi()),et[2]=="LocalAccess"||et[2]=="LongDistance"?rt?(rt.p(et,at),at&4&&ne(rt,1)):(rt=Ny(et),rt.c(),ne(rt,1),rt.m(s.parentNode,s)):rt&&(ui(),he(rt,1,1,()=>{rt=null}),hi()),et[2]=="LongDistance"?it?(it.p(et,at),at&4&&ne(it,1)):(it=jy(et),it.c(),ne(it,1),it.m(g.parentNode,g)):it&&(ui(),he(it,1,1,()=>{it=null}),hi()),(!fe||at&1)&&P!==(P=et[0].average_weighted_directness.toFixed(1)+"")&&pt(R,P),at&1){Qe=bi(Object.entries(et[0].od_percents_infra_type).toSorted(Vy));let Dt;for(Dt=0;Dt<Qe.length;Dt+=1){const Ht=Fy(et,Qe,Dt);Ft[Dt]?Ft[Dt].p(Ht,at):(Ft[Dt]=$y(Ht),Ft[Dt].c(),Ft[Dt].m(le,null))}for(;Dt<Ft.length;Dt+=1)Ft[Dt].d(1);Ft.length=Qe.length}if(at&1){jt=bi(Object.entries(et[0].od_percents_los).toSorted(qy));let Dt;for(Dt=0;Dt<jt.length;Dt+=1){const Ht=Ry(et,jt,Dt);ut[Dt]?ut[Dt].p(Ht,at):(ut[Dt]=Uy(Ht),ut[Dt].c(),ut[Dt].m(ue,null))}for(;Dt<ut.length;Dt+=1)ut[Dt].d(1);ut.length=jt.length}},i(et){fe||(ne(t.$$.fragment,et),ne(ze),ne(rt),ne(it),fe=!0)},o(et){he(t.$$.fragment,et),he(ze),he(rt),he(it),fe=!1},d(et){et&&(X(e),X(u),X(d),X(s),X(g),X(y)),$e(t),ze&&ze.d(et),rt&&rt.d(et),it&&it.d(et),jn(Ft,et),jn(ut,et),ce=!1,ae()}}}function Oy(o){let e,t,r,l,u,d,s=`2px solid ${er.Secondary}`,g;function y(P){o[12](P)}let k={label:"Medium cycling flow coverage",pct:mc(o[0].covered_flow_quintile_sums[1],o[0].total_flow_quintile_sums[1])};o[1]!==void 0&&(k.showLayer=o[1]),t=new ys({props:k}),Ai.push(()=>Xn(t,"showLayer",y));function S(P){o[13](P)}let L={label:"Town centres",pct:o[0].percent_reachable_town_centres};return o[3]!==void 0&&(L.showLayer=o[3]),u=new ys({props:L}),Ai.push(()=>Xn(u,"showLayer",S)),{c(){e=ee("div"),Ve(t.$$.fragment),l=we(),Ve(u.$$.fragment),mi(e,"margin-top","4px"),mi(e,"border",s)},m(P,R){J(P,e,R),je(t,e,null),F(e,l),je(u,e,null),g=!0},p(P,R){const Z={};R&1&&(Z.pct=mc(P[0].covered_flow_quintile_sums[1],P[0].total_flow_quintile_sums[1])),!r&&R&2&&(r=!0,Z.showLayer=P[1],Hn(()=>r=!1)),t.$set(Z);const U={};R&1&&(U.pct=P[0].percent_reachable_town_centres),!d&&R&8&&(d=!0,U.showLayer=P[3],Hn(()=>d=!1)),u.$set(U)},i(P){g||(ne(t.$$.fragment,P),ne(u.$$.fragment,P),g=!0)},o(P){he(t.$$.fragment,P),he(u.$$.fragment,P),g=!1},d(P){P&&X(e),$e(t),$e(u)}}}function Ny(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U=`2px solid ${er.LocalAccess}`,H;function G(ae){o[14](ae)}let K={label:"Low cycling flow coverage",pct:mc(o[0].covered_flow_quintile_sums[2],o[0].total_flow_quintile_sums[2])};o[1]!==void 0&&(K.showLayer=o[1]),t=new ys({props:K}),Ai.push(()=>Xn(t,"showLayer",G));function le(ae){o[15](ae)}let Se={label:"Schools",pct:o[0].percent_reachable_schools};o[4]!==void 0&&(Se.showLayer=o[4]),u=new ys({props:Se}),Ai.push(()=>Xn(u,"showLayer",le));function Le(ae){o[16](ae)}let te={label:"GPs and hospitals",pct:o[0].percent_reachable_gp_hospitals};o[5]!==void 0&&(te.showLayer=o[5]),g=new ys({props:te}),Ai.push(()=>Xn(g,"showLayer",Le));function Y(ae){o[17](ae)}let ue={label:"Deprived population coverage",pct:o[0].percent_reachable_imd_population};o[6]!==void 0&&(ue.showLayer=o[6]),S=new ys({props:ue}),Ai.push(()=>Xn(S,"showLayer",Y));function fe(ae){o[18](ae)}let ce={label:"Population coverage",pct:o[0].percent_reachable_population};return o[7]!==void 0&&(ce.showLayer=o[7]),R=new ys({props:ce}),Ai.push(()=>Xn(R,"showLayer",fe)),{c(){e=ee("div"),Ve(t.$$.fragment),l=we(),Ve(u.$$.fragment),s=we(),Ve(g.$$.fragment),k=we(),Ve(S.$$.fragment),P=we(),Ve(R.$$.fragment),mi(e,"margin-top","4px"),mi(e,"border",U)},m(ae,Ge){J(ae,e,Ge),je(t,e,null),F(e,l),je(u,e,null),F(e,s),je(g,e,null),F(e,k),je(S,e,null),F(e,P),je(R,e,null),H=!0},p(ae,Ge){const Ee={};Ge&1&&(Ee.pct=mc(ae[0].covered_flow_quintile_sums[2],ae[0].total_flow_quintile_sums[2])),!r&&Ge&2&&(r=!0,Ee.showLayer=ae[1],Hn(()=>r=!1)),t.$set(Ee);const ze={};Ge&1&&(ze.pct=ae[0].percent_reachable_schools),!d&&Ge&16&&(d=!0,ze.showLayer=ae[4],Hn(()=>d=!1)),u.$set(ze);const rt={};Ge&1&&(rt.pct=ae[0].percent_reachable_gp_hospitals),!y&&Ge&32&&(y=!0,rt.showLayer=ae[5],Hn(()=>y=!1)),g.$set(rt);const it={};Ge&1&&(it.pct=ae[0].percent_reachable_imd_population),!L&&Ge&64&&(L=!0,it.showLayer=ae[6],Hn(()=>L=!1)),S.$set(it);const Qe={};Ge&1&&(Qe.pct=ae[0].percent_reachable_population),!Z&&Ge&128&&(Z=!0,Qe.showLayer=ae[7],Hn(()=>Z=!1)),R.$set(Qe)},i(ae){H||(ne(t.$$.fragment,ae),ne(u.$$.fragment,ae),ne(g.$$.fragment,ae),ne(S.$$.fragment,ae),ne(R.$$.fragment,ae),H=!0)},o(ae){he(t.$$.fragment,ae),he(u.$$.fragment,ae),he(g.$$.fragment,ae),he(S.$$.fragment,ae),he(R.$$.fragment,ae),H=!1},d(ae){ae&&X(e),$e(t),$e(u),$e(g),$e(S),$e(R)}}}function jy(o){let e,t,r,l=`2px solid ${er.LongDistance}`,u;function d(g){o[19](g)}let s={label:"Reachable settlements (TODO)",pct:0};return o[8]!==void 0&&(s.showLayer=o[8]),t=new ys({props:s}),Ai.push(()=>Xn(t,"showLayer",d)),{c(){e=ee("div"),Ve(t.$$.fragment),mi(e,"margin-top","4px"),mi(e,"border",l)},m(g,y){J(g,e,y),je(t,e,null),u=!0},p(g,y){const k={};!r&&y&256&&(r=!0,k.showLayer=g[8],Hn(()=>r=!1)),t.$set(k)},i(g){u||(ne(t.$$.fragment,g),u=!0)},o(g){he(t.$$.fragment,g),u=!1},d(g){g&&X(e),$e(t)}}}function $y(o){let e,t=o[22]+"",r,l,u=Math.round(o[23]*100)+"",d,s;return{c(){e=ee("li"),r=be(t),l=be(": "),d=be(u),s=be("%")},m(g,y){J(g,e,y),F(e,r),F(e,l),F(e,d),F(e,s)},p(g,y){y&1&&t!==(t=g[22]+"")&&pt(r,t),y&1&&u!==(u=Math.round(g[23]*100)+"")&&pt(d,u)},d(g){g&&X(e)}}}function Uy(o){let e,t=o[22]+"",r,l,u=Math.round(o[23]*100)+"",d,s;return{c(){e=ee("li"),r=be(t),l=be(": "),d=be(u),s=be("%")},m(g,y){J(g,e,y),F(e,r),F(e,l),F(e,d),F(e,s)},p(g,y){y&1&&t!==(t=g[22]+"")&&pt(r,t),y&1&&u!==(u=Math.round(g[23]*100)+"")&&pt(d,u)},d(g){g&&X(e)}}}function Y4(o){let e,t,r,l,u,d,s=o[0]&&By(o);return{c(){e=ee("button"),e.textContent="Recalculate",t=we(),s&&s.c(),r=Ei()},m(g,y){J(g,e,y),J(g,t,y),s&&s.m(g,y),J(g,r,y),l=!0,u||(d=ft(e,"click",o[10]),u=!0)},p(g,[y]){g[0]?s?(s.p(g,y),y&1&&ne(s,1)):(s=By(g),s.c(),ne(s,1),s.m(r.parentNode,r)):s&&(ui(),he(s,1,1,()=>{s=null}),hi())},i(g){l||(ne(s),l=!0)},o(g){he(s),l=!1},d(g){g&&(X(e),X(t),X(r)),s&&s.d(g),u=!1,d()}}}function mc(o,e){return e==0?0:o/e}const Vy=(o,e)=>e[1]-o[1],qy=(o,e)=>e[1]-o[1];function Q4(o,e,t){let r,l,u,d,s,g,y,k,S,L,P;bt(o,Iy,ue=>t(0,r=ue)),bt(o,Ln,ue=>t(21,l=ue)),bt(o,lc,ue=>t(1,u=ue)),bt(o,gs,ue=>t(2,d=ue)),bt(o,Fd,ue=>t(3,s=ue)),bt(o,Dd,ue=>t(4,g=ue)),bt(o,Rd,ue=>t(5,y=ue)),bt(o,Bd,ue=>t(6,k=ue)),bt(o,Od,ue=>t(7,S=ue)),bt(o,Ly,ue=>t(8,L=ue)),bt(o,ln,ue=>t(9,P=ue));async function R(){oi(Iy,r=await l.recalculateStats(),r)}gc(async()=>{r==null&&await R()});function Z(ue){u=ue,lc.set(u)}function U(ue){u=ue,lc.set(u)}function H(ue){s=ue,Fd.set(s)}function G(ue){u=ue,lc.set(u)}function K(ue){g=ue,Dd.set(g)}function le(ue){y=ue,Rd.set(y)}function Se(ue){k=ue,Bd.set(k)}function Le(ue){S=ue,Od.set(S)}function te(ue){L=ue,Ly.set(L)}return[r,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le,te,()=>oi(ln,P={kind:"evaluate-route",prevMode:{kind:"main"},browse:zo(r).worst_directness_routes},P)]}class eS extends Wt{constructor(e){super(),Gt(this,e,Q4,Y4,Vt,{})}}function Zy(o,e,t){const r=o.slice();return r[4]=e[t],r}function Gy(o){let e,t=o[4]+"",r;return{c(){e=ee("option"),r=be(t),e.__value=o[4],Zi(e,e.__value)},m(l,u){J(l,e,u),F(e,r)},p:We,d(l){l&&X(e)}}}function tS(o){let e,t,r,l,u,d=bi(o[1]),s=[];for(let g=0;g<d.length;g+=1)s[g]=Gy(Zy(o,d,g));return{c(){e=ee("label"),t=be(`Area:
  `),r=ee("select");for(let g=0;g<s.length;g+=1)s[g].c();o[0]===void 0&&Mo(()=>o[3].call(r))},m(g,y){J(g,e,y),F(e,t),F(e,r);for(let k=0;k<s.length;k+=1)s[k]&&s[k].m(r,null);hr(r,o[0],!0),l||(u=[ft(r,"change",o[3]),ft(r,"change",o[2])],l=!0)},p(g,[y]){if(y&2){d=bi(g[1]);let k;for(k=0;k<d.length;k+=1){const S=Zy(g,d,k);s[k]?s[k].p(S,y):(s[k]=Gy(S),s[k].c(),s[k].m(r,null))}for(;k<s.length;k+=1)s[k].d(1);s.length=d.length}y&3&&hr(r,g[0])},i:We,o:We,d(g){g&&X(e),jn(s,g),l=!1,cn(u)}}}function iS(o,e,t){let{area:r}=e,l=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];l.sort();function u(){window.location.href=`index.html?boundary=${r}`}function d(){r=vs(this),t(0,r),t(1,l)}return o.$$set=s=>{"area"in s&&t(0,r=s.area)},[r,l,u,d]}class nS extends Wt{constructor(e){super(),Gt(this,e,iS,tS,Vt,{area:0})}}const{window:rS}=i1;function Wy(o,e,t){const r=o.slice();return r[22]=e[t],r}function Hy(o){let e,t,r=bi(o[0].features),l=[];for(let d=0;d<r.length;d+=1)l[d]=Xy(Wy(o,r,d));const u=d=>he(l[d],1,1,()=>{l[d]=null});return{c(){e=ee("ol");for(let d=0;d<l.length;d+=1)l[d].c()},m(d,s){J(d,e,s);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(e,null);t=!0},p(d,s){if(s&257){r=bi(d[0].features);let g;for(g=0;g<r.length;g+=1){const y=Wy(d,r,g);l[g]?(l[g].p(y,s),ne(l[g],1)):(l[g]=Xy(y),l[g].c(),ne(l[g],1),l[g].m(e,null))}for(ui(),g=r.length;g<l.length;g+=1)u(g);hi()}},i(d){if(!t){for(let s=0;s<r.length;s+=1)ne(l[s]);t=!0}},o(d){l=l.filter(Boolean);for(let s=0;s<l.length;s+=1)he(l[s]);t=!1},d(d){d&&X(e),jn(l,d)}}}function oS(o){var s,g;let e=(((s=o[22].properties)==null?void 0:s.name)||`Untitled route ${o[22].id}`)+"",t,r,l=((g=o[22].properties)==null?void 0:g.infra_type)+"",u,d;return{c(){t=be(e),r=be(" ("),u=be(l),d=be(")")},m(y,k){J(y,t,k),J(y,r,k),J(y,u,k),J(y,d,k)},p(y,k){var S,L;k&1&&e!==(e=(((S=y[22].properties)==null?void 0:S.name)||`Untitled route ${y[22].id}`)+"")&&pt(t,e),k&1&&l!==(l=((L=y[22].properties)==null?void 0:L.infra_type)+"")&&pt(u,l)},d(y){y&&(X(t),X(r),X(u),X(d))}}}function Xy(o){let e,t,r,l;function u(){return o[18](o[22])}return t=new G4({props:{$$slots:{default:[oS]},$$scope:{ctx:o}}}),t.$on("click",u),{c(){e=ee("li"),Ve(t.$$.fragment),r=we()},m(d,s){J(d,e,s),je(t,e,null),F(e,r),l=!0},p(d,s){o=d;const g={};s&33554433&&(g.$$scope={dirty:s,ctx:o}),t.$set(g)},i(d){l||(ne(t.$$.fragment,d),l=!0)},o(d){he(t.$$.fragment,d),l=!1},d(d){d&&X(e),$e(t)}}}function sS(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae;t=new nS({props:{area:o[5]}});let Ge=o[0]&&Hy(o);return ue=new X4({}),{c(){e=ee("div"),Ve(t.$$.fragment),r=we(),l=ee("div"),u=ee("button"),u.innerHTML=`Draw new <u>r</u>
        oute line`,d=we(),s=ee("button"),s.textContent="Clear all",g=we(),y=ee("label"),k=ee("input"),S=be(`
      Show current network`),L=we(),P=ee("details"),R=ee("summary"),R.textContent="Current network routes",Z=we(),U=ee("label"),H=be(`Show routes by:
        `),G=ee("select"),K=ee("option"),K.textContent="Infrastructure type",le=ee("option"),le.textContent="Tier",Se=we(),Ge&&Ge.c(),Le=we(),te=ee("hr"),Y=we(),Ve(ue.$$.fragment),Pe(s,"class","secondary"),Pe(k,"type","checkbox"),K.__value="infra_type",Zi(K,K.__value),le.__value="tier",Zi(le,le.__value),o[3]===void 0&&Mo(()=>o[17].call(G)),Pe(e,"slot","left")},m(Ee,ze){J(Ee,e,ze),je(t,e,null),F(e,r),F(e,l),F(l,u),F(l,d),F(l,s),F(e,g),F(e,y),F(y,k),k.checked=o[4],F(y,S),F(e,L),F(e,P),F(P,R),F(P,Z),F(P,U),F(U,H),F(U,G),F(G,K),F(G,le),hr(G,o[3],!0),F(P,Se),Ge&&Ge.m(P,null),F(e,Le),F(e,te),F(e,Y),je(ue,e,null),fe=!0,ce||(ae=[ft(u,"click",o[15]),ft(s,"click",o[9]),ft(k,"change",o[16]),ft(G,"change",o[17])],ce=!0)},p(Ee,ze){const rt={};ze&32&&(rt.area=Ee[5]),t.$set(rt),ze&16&&(k.checked=Ee[4]),ze&8&&hr(G,Ee[3]),Ee[0]?Ge?(Ge.p(Ee,ze),ze&1&&ne(Ge,1)):(Ge=Hy(Ee),Ge.c(),ne(Ge,1),Ge.m(P,null)):Ge&&(ui(),he(Ge,1,1,()=>{Ge=null}),hi())},i(Ee){fe||(ne(t.$$.fragment,Ee),ne(Ge),ne(ue.$$.fragment,Ee),fe=!0)},o(Ee){he(t.$$.fragment,Ee),he(Ge),he(ue.$$.fragment,Ee),fe=!1},d(Ee){Ee&&X(e),$e(t),Ge&&Ge.d(),$e(ue),ce=!1,cn(ae)}}}function Ky(o){let e,t;return e=new xn({props:{data:o[0],$$slots:{default:[cS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&1&&(u.data=r[0]),l&33554460&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function aS(o){let e=(o[21].name||"Untitled")+"",t,r,l=pc[o[21].infra_type][0]+"",u,d,s=o[21].tier+"",g,y;return{c(){t=be(e),r=be(" ("),u=be(l),d=be(`,
            `),g=be(s),y=be(")")},m(k,S){J(k,t,S),J(k,r,S),J(k,u,S),J(k,d,S),J(k,g,S),J(k,y,S)},p(k,S){S&2097152&&e!==(e=(k[21].name||"Untitled")+"")&&pt(t,e),S&2097152&&l!==(l=pc[k[21].infra_type][0]+"")&&pt(u,l),S&2097152&&s!==(s=k[21].tier+"")&&pt(g,s)},d(k){k&&(X(t),X(r),X(u),X(d),X(g),X(y))}}}function lS(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[aS,({props:r})=>({21:r}),({props:r})=>r?2097152:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&35651584&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function cS(o){let e,t;const r=[ji("main-mode"),{paint:{"line-width":["case",["==",["get","tier"],o[2]],$n(5,7),$n(3,5)],"line-color":o[3]=="infra_type"?ya:Bp}},{layout:{visibility:o[4]?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[lS]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),e.$on("click",o[7]),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&28?vn(r,[r[0],d&12&&{paint:{"line-width":["case",["==",["get","tier"],u[2]],$n(5,7),$n(3,5)],"line-color":u[3]=="infra_type"?ya:Bp}},d&16&&{layout:{visibility:u[4]?"visible":"none"}},r[3],r[4]]):{};d&33554432&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function uS(o){let e,t,r=o[0]&&Ky(o);return{c(){e=ee("div"),r&&r.c(),Pe(e,"slot","map")},m(l,u){J(l,e,u),r&&r.m(e,null),t=!0},p(l,u){l[0]?r?(r.p(l,u),u&1&&ne(r,1)):(r=Ky(l),r.c(),ne(r,1),r.m(e,null)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d()}}}function hS(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H;return t=new eS({}),{c(){e=ee("div"),Ve(t.$$.fragment),r=we(),l=ee("div"),u=ee("button"),u.textContent="Evaluate a route",d=we(),s=ee("div"),g=ee("button"),g.textContent="Evaluate OD",y=we(),k=ee("div"),S=ee("button"),S.textContent="Debug network",L=we(),P=ee("div"),R=ee("button"),R.textContent="Debug mesh density",Pe(u,"class","secondary"),Pe(g,"class","secondary"),Pe(S,"class","secondary"),Pe(R,"class","secondary"),Pe(e,"slot","right")},m(G,K){J(G,e,K),je(t,e,null),F(e,r),F(e,l),F(l,u),F(e,d),F(e,s),F(s,g),F(e,y),F(e,k),F(k,S),F(e,L),F(e,P),F(P,R),Z=!0,U||(H=[ft(u,"click",o[11]),ft(g,"click",o[12]),ft(S,"click",o[13]),ft(R,"click",o[14])],U=!0)},p:We,i(G){Z||(ne(t.$$.fragment,G),Z=!0)},o(G){he(t.$$.fragment,G),Z=!1},d(G){G&&X(e),$e(t),U=!1,cn(H)}}}function dS(o){let e,t,r,l;return e=new xc({props:{$$slots:{right:[hS],map:[uS],left:[sS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0,r||(l=ft(rS,"keydown",o[6]),r=!0)},p(u,[d]){const s={};d&33554495&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u),r=!1,l()}}}function fS(o,e,t){let r,l,u,d,s,g,y;bt(o,Ln,Y=>t(19,r=Y)),bt(o,ln,Y=>t(1,l=Y)),bt(o,oh,Y=>t(10,u=Y)),bt(o,gs,Y=>t(2,d=Y)),bt(o,zp,Y=>t(3,s=Y)),bt(o,Rp,Y=>t(4,g=Y)),bt(o,zd,Y=>t(5,y=Y));let k=null;gc(S);async function S(){t(0,k=await r.renderRoutes())}function L(Y){Y.key=="r"&&(Y.preventDefault(),oi(ln,l={kind:"edit-route",id:null},l))}function P(Y){oi(ln,l={kind:"edit-route",id:Y.detail.features[0].id},l)}function R(Y){oi(ln,l={kind:"edit-route",id:Y},l)}async function Z(){window.confirm("Clear everything? You can't undo this")&&(await(r==null?void 0:r.clearAllRoutes()),await sh(),await S())}const U=()=>oi(ln,l={kind:"evaluate-route",prevMode:{kind:"main"},browse:[]},l),H=()=>oi(ln,l={kind:"evaluate-od"},l),G=()=>oi(ln,l={kind:"debug-network"},l),K=()=>oi(ln,l={kind:"debug-mesh-density"},l),le=()=>oi(ln,l={kind:"edit-route",id:null},l);function Se(){g=this.checked,Rp.set(g)}function Le(){s=vs(this),zp.set(s)}const te=Y=>R(Y.id);return o.$$.update=()=>{o.$$.dirty&1024&&u>0&&S()},[k,l,d,s,g,y,L,P,R,Z,u,U,H,G,K,le,Se,Le,te]}class pS extends Wt{constructor(e){super(),Gt(this,e,fS,dS,Vt,{})}}function Jy(o,e,t){const r=o.slice();return r[2]=e[t][0],r[3]=e[t][1],r}function mS(o,e,t){const r=o.slice();return r[1]=e[t][0],r[2]=e[t][1],r[3]=e[t][2],r}function _S(o){let e,t=bi(Object.entries(er)),r=[];for(let l=0;l<t.length;l+=1)r[l]=Yy(Jy(o,t,l));return{c(){for(let l=0;l<r.length;l+=1)r[l].c();e=Ei()},m(l,u){for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(l,u);J(l,e,u)},p(l,u){if(u&0){t=bi(Object.entries(er));let d;for(d=0;d<t.length;d+=1){const s=Jy(l,t,d);r[d]?r[d].p(s,u):(r[d]=Yy(s),r[d].c(),r[d].m(e.parentNode,e))}for(;d<r.length;d+=1)r[d].d(1);r.length=t.length}},d(l){l&&X(e),jn(r,l)}}}function gS(o){let e,t=bi(em),r=[];for(let l=0;l<t.length;l+=1)r[l]=yS(mS(o,t,l));return{c(){for(let l=0;l<r.length;l+=1)r[l].c();e=Ei()},m(l,u){for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(l,u);J(l,e,u)},p:We,d(l){l&&X(e),jn(r,l)}}}function Yy(o){let e,t,r;return{c(){e=ee("span"),e.textContent=`${o[2]}`,t=we(),r=ee("br"),mi(e,"color",o[3])},m(l,u){J(l,e,u),J(l,t,u),J(l,r,u)},p:We,d(l){l&&(X(e),X(t),X(r))}}}function yS(o){let e,t,r;return{c(){e=ee("span"),e.textContent=`${o[2]}`,t=we(),r=ee("br"),mi(e,"color",o[3])},m(l,u){J(l,e,u),J(l,t,u),J(l,r,u)},p:We,d(l){l&&(X(e),X(t),X(r))}}}function bS(o){let e,t,r,l;function u(g,y){return g[0]=="infra_type"?gS:_S}let d=u(o),s=d(o);return{c(){e=ee("div"),t=ee("details"),r=ee("summary"),r.textContent="Legend",l=we(),s.c(),Pe(e,"class","svelte-1oq1sox")},m(g,y){J(g,e,y),F(e,t),F(t,r),F(t,l),s.m(t,null)},p(g,[y]){d===(d=u(g))&&s?s.p(g,y):(s.d(1),s=d(g),s&&(s.c(),s.m(t,null)))},i:We,o:We,d(g){g&&X(e),s.d()}}}function vS(o,e,t){let r;return bt(o,zp,l=>t(0,r=l)),[r]}class wS extends Wt{constructor(e){super(),Gt(this,e,vS,bS,Vt,{})}}let qt;const J1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&J1.decode();let Vu=null;function Xu(){return(Vu===null||Vu.byteLength===0)&&(Vu=new Uint8Array(qt.memory.buffer)),Vu}function Eo(o,e){return o=o>>>0,J1.decode(Xu().subarray(o,o+e))}const bs=new Array(128).fill(void 0);bs.push(void 0,null,!0,!1);let Ku=bs.length;function Rn(o){Ku===bs.length&&bs.push(bs.length+1);const e=Ku;return Ku=bs[e],bs[e]=o,e}function Ci(o){return bs[o]}function xS(o){o<132||(bs[o]=Ku,Ku=o)}function sc(o){const e=Ci(o);return xS(o),e}function fp(o){return o==null}let qu=null;function kS(){return(qu===null||qu.byteLength===0)&&(qu=new Float64Array(qt.memory.buffer)),qu}let Zu=null;function Di(){return(Zu===null||Zu.byteLength===0)&&(Zu=new Int32Array(qt.memory.buffer)),Zu}let fa=0;const Id=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},SS=typeof Id.encodeInto=="function"?function(o,e){return Id.encodeInto(o,e)}:function(o,e){const t=Id.encode(o);return e.set(t),{read:o.length,written:t.length}};function _d(o,e,t){if(t===void 0){const s=Id.encode(o),g=e(s.length,1)>>>0;return Xu().subarray(g,g+s.length).set(s),fa=s.length,g}let r=o.length,l=e(r,1)>>>0;const u=Xu();let d=0;for(;d<r;d++){const s=o.charCodeAt(d);if(s>127)break;u[l+d]=s}if(d!==r){d!==0&&(o=o.slice(d)),l=t(l,r,r=d+o.length*3,1)>>>0;const s=Xu().subarray(l+d,l+r),g=SS(o,s);d+=g.written}return fa=d,l}function Np(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=Np(o[0]));for(let d=1;d<l;d++)u+=", "+Np(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let r;if(t.length>1)r=t[1];else return toString.call(o);if(r=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:r}function TS(o,e){const t=e(o.length*1,1)>>>0;return Xu().set(o,t/1),fa=o.length,t}function pp(o,e){try{return o.apply(this,e)}catch(t){qt.__wbindgen_exn_store(Rn(t))}}class Nd{static __wrap(e){e=e>>>0;const t=Object.create(Nd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();qt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=qt.__wbindgen_add_to_stack_pointer(-16),d=TS(e,qt.__wbindgen_malloc),s=fa;qt.jsroutesnapper_new(u,d,s);var t=Di()[u/4+0],r=Di()[u/4+1],l=Di()[u/4+2];if(l)throw sc(r);return Nd.__wrap(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){qt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Rn(e))}setAreaMode(){qt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var r=Di()[u/4+0],l=Di()[u/4+1];return e=r,t=l,Eo(r,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const r=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_toFinalFeature(r,this.__wbg_ptr);var e=Di()[r/4+0],t=Di()[r/4+1];let l;return e!==0&&(l=Eo(e,t).slice(),qt.__wbindgen_free(e,t*1)),l}finally{qt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var r=Di()[u/4+0],l=Di()[u/4+1];return e=r,t=l,Eo(r,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toggleSnapMode(){qt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,r){return qt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,r)!==0}onClick(){qt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return qt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return qt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){qt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_editExisting(l,this.__wbg_ptr,Rn(e));var t=Di()[l/4+0],r=Di()[l/4+1];if(r)throw sc(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var r=Di()[u/4+0],l=Di()[u/4+1];return e=r,t=l,Eo(r,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var r=Di()[u/4+0],l=Di()[u/4+1];return e=r,t=l,Eo(r,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,r;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Rn(e));var l=Di()[k/4+0],u=Di()[k/4+1],d=Di()[k/4+2],s=Di()[k/4+3],g=l,y=u;if(s)throw g=0,y=0,sc(d);return t=g,r=y,Eo(g,y)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,r,1)}}addSnappedWaypoint(e,t){qt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){qt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,r;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Rn(e));var l=Di()[k/4+0],u=Di()[k/4+1],d=Di()[k/4+2],s=Di()[k/4+3],g=l,y=u;if(s)throw g=0,y=0,sc(d);return t=g,r=y,Eo(g,y)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,r,1)}}getExtraNodes(e,t){let r,l;try{const S=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Rn(e),Rn(t));var u=Di()[S/4+0],d=Di()[S/4+1],s=Di()[S/4+2],g=Di()[S/4+3],y=u,k=d;if(g)throw y=0,k=0,sc(s);return r=y,l=k,Eo(y,k)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(r,l,1)}}}async function IS(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(r){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function CS(){const o={};return o.wbg={},o.wbg.__wbindgen_string_new=function(e,t){const r=Eo(e,t);return Rn(r)},o.wbg.__wbindgen_object_drop_ref=function(e){sc(e)},o.wbg.__wbindgen_error_new=function(e,t){const r=new Error(Eo(e,t));return Rn(r)},o.wbg.__wbindgen_number_get=function(e,t){const r=Ci(t),l=typeof r=="number"?r:void 0;kS()[e/8+1]=fp(l)?0:l,Di()[e/4+0]=!fp(l)},o.wbg.__wbindgen_is_object=function(e){const t=Ci(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_is_undefined=function(e){return Ci(e)===void 0},o.wbg.__wbindgen_in=function(e,t){return Ci(e)in Ci(t)},o.wbg.__wbindgen_boolean_get=function(e){const t=Ci(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ci(e)==Ci(t)},o.wbg.__wbindgen_string_get=function(e,t){const r=Ci(t),l=typeof r=="string"?r:void 0;var u=fp(l)?0:_d(l,qt.__wbindgen_malloc,qt.__wbindgen_realloc),d=fa;Di()[e/4+1]=d,Di()[e/4+0]=u},o.wbg.__wbg_String_4370c5505c674d30=function(e,t){const r=String(Ci(t)),l=_d(r,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=fa;Di()[e/4+1]=u,Di()[e/4+0]=l},o.wbg.__wbindgen_object_clone_ref=function(e){const t=Ci(e);return Rn(t)},o.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const r=Ci(e)[Ci(t)];return Rn(r)},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Rn(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=Ci(t).stack,l=_d(r,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=fa;Di()[e/4+1]=u,Di()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,l;try{r=e,l=t,console.error(Eo(e,t))}finally{qt.__wbindgen_free(r,l,1)}},o.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ci(e))},o.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ci(e))},o.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ci(e))},o.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ci(e))},o.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ci(e))},o.wbg.__wbg_get_44be0491f933a435=function(e,t){const r=Ci(e)[t>>>0];return Rn(r)},o.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ci(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof Ci(e)=="function"},o.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ci(e).next;return Rn(t)},o.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return pp(function(e){const t=Ci(e).next();return Rn(t)},arguments)},o.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ci(e).done},o.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ci(e).value;return Rn(t)},o.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Rn(Symbol.iterator)},o.wbg.__wbg_get_97b561fb56f034b5=function(){return pp(function(e,t){const r=Reflect.get(Ci(e),Ci(t));return Rn(r)},arguments)},o.wbg.__wbg_call_cb65541d95d71282=function(){return pp(function(e,t){const r=Ci(e).call(Ci(t));return Rn(r)},arguments)},o.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ci(e))},o.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ci(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ci(e).buffer;return Rn(t)},o.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ci(e));return Rn(t)},o.wbg.__wbg_set_5cf90238115182c3=function(e,t,r){Ci(e).set(Ci(t),r>>>0)},o.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ci(e).length},o.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ci(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_debug_string=function(e,t){const r=Np(Ci(t)),l=_d(r,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=fa;Di()[e/4+1]=u,Di()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(Eo(e,t))},o.wbg.__wbindgen_memory=function(){const e=qt.memory;return Rn(e)},o}function ES(o,e){return qt=o.exports,Y1.__wbindgen_wasm_module=e,qu=null,Zu=null,Vu=null,qt}async function Y1(o){if(qt!==void 0)return qt;typeof o>"u"&&(o="/npw/assets/route_snapper_bg.wasm");const e=CS();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:r}=await IS(await o,e);return ES(t,r)}const LS=30;class MS{constructor(e,t,r,l,u){this.onMouseMove=d=>{if(!this.active)return;const s=[d.point.x-LS,d.point.y],g=this.map.unproject(d.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,g)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let s=d.target.tagName;s=="INPUT"||s=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let s=d.target.tagName;s=="INPUT"||s=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Nd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=r,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}let jd=Mi(null);const Co=Mi([]);const AS=o=>({}),Qy=o=>({}),PS=o=>({}),e0=o=>({});function t0(o,e,t){const r=o.slice();return r[51]=e[t],r[52]=e,r[53]=t,r}function i0(o,e,t){const r=o.slice();return r[54]=e[t],r[55]=e,r[56]=t,r}const zS=o=>({}),n0=o=>({});function DS(o){let e;return{c(){e=ee("h2"),e.textContent="Drawing a new route"},m(t,r){J(t,e,r)},d(t){t&&X(e)}}}function RS(o){let e;return{c(){e=ee("h2"),e.textContent="Editing a route"},m(t,r){J(t,e,r)},d(t){t&&X(e)}}}function FS(o){let e,t=o[11].length+"",r,l;return{c(){e=be("Undo ("),r=be(t),l=be(")")},m(u,d){J(u,e,d),J(u,r,d),J(u,l,d)},p(u,d){d[0]&2048&&t!==(t=u[11].length+"")&&pt(r,t)},d(u){u&&(X(e),X(r),X(l))}}}function BS(o){let e;return{c(){e=be("Undo")},m(t,r){J(t,e,r)},p:We,d(t){t&&X(e)}}}function OS(o){let e,t,r,l,u;return{c(){e=ee("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,t=we(),r=ee("p"),r.textContent="Keyboard shortcuts:",l=we(),u=ee("ul"),u.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(d,s){J(d,e,s),J(d,t,s),J(d,r,s),J(d,l,s),J(d,u,s)},p:We,d(d){d&&(X(e),X(t),X(r),X(l),X(u))}}}function NS(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,Ge,Ee,ze,rt,it,Qe,Ft,jt,ut,et,at,Bt,Dt,Ht,ai,si,Si,Ri,vi,di,lt,qe,st,Te;function mt(gi,Fi){return gi[3]?RS:DS}let yt=mt(o),Ie=yt(o);function nt(gi,Fi){return gi[11].length==0?BS:FS}let Xt=nt(o),wi=Xt(o);R=new q1({props:{$$slots:{default:[OS]},$$scope:{ctx:o}}});const $i=o[29]["extra-left"],Li=mn($i,o,o[46],Qy);return lt=U_(o[40][0]),qe=U_(o[40][1]),{c(){e=ee("div"),Ie.c(),t=we(),r=ee("button"),l=be("Finish"),d=we(),s=ee("button"),wi.c(),y=we(),k=ee("button"),k.textContent="Delete",S=we(),L=ee("button"),L.textContent="Cancel",P=we(),Ve(R.$$.fragment),Z=we(),U=ee("fieldset"),H=ee("label"),G=ee("input"),K=be(`
        Snap to roads`),le=we(),Se=ee("label"),Le=ee("input"),te=be(`
        Draw anywhere`),Y=we(),ue=ee("fieldset"),fe=ee("label"),ce=ee("input"),ae=be(`
        Extend from start (
        `),Ge=ee("b"),Ge.textContent="1",Ee=be(`
        )`),ze=we(),rt=ee("label"),it=ee("input"),Qe=be(`
        Extend from end (
        `),Ft=ee("b"),Ft.textContent="2",jt=be(`
        )`),ut=we(),et=ee("label"),at=ee("input"),Bt=be(`
        Adjust middle points (
        `),Dt=ee("b"),Dt.textContent="3",Ht=be(`
        )`),ai=we(),si=ee("label"),Si=ee("input"),Ri=be(`
      Show major junctions`),vi=we(),Li&&Li.c(),r.disabled=u=o[8].length<2,Pe(s,"class","secondary"),s.disabled=g=o[11].length==0,Pe(k,"class","secondary"),Pe(L,"class","secondary"),Pe(G,"type","radio"),G.__value="snap",Zi(G,G.__value),Pe(Le,"type","radio"),Le.__value="free",Zi(Le,Le.__value),Pe(ce,"type","radio"),ce.__value="append-start",Zi(ce,ce.__value),Pe(it,"type","radio"),it.__value="append-end",Zi(it,it.__value),Pe(at,"type","radio"),at.__value="adjust",Zi(at,at.__value),Pe(Si,"type","checkbox"),Pe(e,"slot","left"),lt.p(ce,it,at),qe.p(G,Le)},m(gi,Fi){J(gi,e,Fi),Ie.m(e,null),F(e,t),F(e,r),F(r,l),F(e,d),F(e,s),wi.m(s,null),F(e,y),F(e,k),F(e,S),F(e,L),F(e,P),je(R,e,null),F(e,Z),F(e,U),F(U,H),F(H,G),G.checked=G.__value===o[10],F(H,K),F(U,le),F(U,Se),F(Se,Le),Le.checked=Le.__value===o[10],F(Se,te),F(e,Y),F(e,ue),F(ue,fe),F(fe,ce),ce.checked=ce.__value===o[4],F(fe,ae),F(fe,Ge),F(fe,Ee),F(ue,ze),F(ue,rt),F(rt,it),it.checked=it.__value===o[4],F(rt,Qe),F(rt,Ft),F(rt,jt),F(ue,ut),F(ue,et),F(et,at),at.checked=at.__value===o[4],F(et,Bt),F(et,Dt),F(et,Ht),F(e,ai),F(e,si),F(si,Si),Si.checked=o[14],F(si,Ri),F(e,vi),Li&&Li.m(e,null),di=!0,st||(Te=[ft(r,"click",function(){tl(o[0])&&o[0].apply(this,arguments)}),ft(s,"click",o[15]),ft(k,"click",function(){tl(o[2])&&o[2].apply(this,arguments)}),ft(L,"click",function(){tl(o[1])&&o[1].apply(this,arguments)}),ft(G,"change",o[39]),ft(G,"change",o[16]),ft(Le,"change",o[41]),ft(Le,"change",o[16]),ft(ce,"change",o[42]),ft(it,"change",o[43]),ft(at,"change",o[44]),ft(Si,"change",o[45])],st=!0)},p(gi,Fi){o=gi,yt!==(yt=mt(o))&&(Ie.d(1),Ie=yt(o),Ie&&(Ie.c(),Ie.m(e,t))),(!di||Fi[0]&256&&u!==(u=o[8].length<2))&&(r.disabled=u),Xt===(Xt=nt(o))&&wi?wi.p(o,Fi):(wi.d(1),wi=Xt(o),wi&&(wi.c(),wi.m(s,null))),(!di||Fi[0]&2048&&g!==(g=o[11].length==0))&&(s.disabled=g);const br={};Fi[1]&32768&&(br.$$scope={dirty:Fi,ctx:o}),R.$set(br),Fi[0]&1024&&(G.checked=G.__value===o[10]),Fi[0]&1024&&(Le.checked=Le.__value===o[10]),Fi[0]&16&&(ce.checked=ce.__value===o[4]),Fi[0]&16&&(it.checked=it.__value===o[4]),Fi[0]&16&&(at.checked=at.__value===o[4]),Fi[0]&16384&&(Si.checked=o[14]),Li&&Li.p&&(!di||Fi[1]&32768)&&gn(Li,$i,o,o[46],di?_n($i,o[46],Fi,AS):yn(o[46]),Qy)},i(gi){di||(ne(R.$$.fragment,gi),ne(Li,gi),di=!0)},o(gi){he(R.$$.fragment,gi),he(Li,gi),di=!1},d(gi){gi&&X(e),Ie.d(),wi.d(),$e(R),Li&&Li.d(gi),lt.r(),qe.r(),st=!1,cn(Te)}}}function jS(o){let e;return{c(){e=ee("span"),Pe(e,"class","dot svelte-1cj4rwq"),dr(e,"snapped-node",o[54].snapped),dr(e,"free-node",!o[54].snapped),dr(e,"hide",o[7])},m(t,r){J(t,e,r)},p(t,r){r[0]&4096&&dr(e,"snapped-node",t[54].snapped),r[0]&4096&&dr(e,"free-node",!t[54].snapped),r[0]&128&&dr(e,"hide",t[7])},d(t){t&&X(e)}}}function r0(o){let e,t,r;function l(g){o[30](g,o[54])}function u(){return o[31](o[54])}function d(){return o[32](o[54])}let s={draggable:!0,zIndex:0,$$slots:{default:[jS]},$$scope:{ctx:o}};return o[54].point!==void 0&&(s.lngLat=o[54].point),e=new Pd({props:s}),Ai.push(()=>Xn(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",o[24]),{c(){Ve(e.$$.fragment)},m(g,y){je(e,g,y),r=!0},p(g,y){o=g;const k={};y[0]&4224|y[1]&32768&&(k.$$scope={dirty:y,ctx:o}),!t&&y[0]&4096&&(t=!0,k.lngLat=o[54].point,Hn(()=>t=!1)),e.$set(k)},i(g){r||(ne(e.$$.fragment,g),r=!0)},o(g){he(e.$$.fragment,g),r=!1},d(g){$e(e,g)}}}function $S(o){let e;return{c(){e=ee("span"),e.textContent=`${o[53]+1}`,Pe(e,"class","dot svelte-1cj4rwq"),dr(e,"snapped",o[51].snapped)},m(t,r){J(t,e,r)},p(t,r){r[0]&256&&dr(e,"snapped",t[51].snapped)},d(t){t&&X(e)}}}function o0(o){let e,t,r;function l(g){o[33](g,o[51])}function u(){return o[34](o[53])}function d(){return o[35](o[53])}let s={draggable:!0,zIndex:1,$$slots:{default:[$S]},$$scope:{ctx:o}};return o[51].point!==void 0&&(s.lngLat=o[51].point),e=new Pd({props:s}),Ai.push(()=>Xn(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",o[36]),e.$on("mouseleave",o[37]),e.$on("dragstart",o[26]),e.$on("dragend",o[38]),{c(){Ve(e.$$.fragment)},m(g,y){je(e,g,y),r=!0},p(g,y){o=g;const k={};y[0]&256|y[1]&32768&&(k.$$scope={dirty:y,ctx:o}),!t&&y[0]&256&&(t=!0,k.lngLat=o[51].point,Hn(()=>t=!1)),e.$set(k)},i(g){r||(ne(e.$$.fragment,g),r=!0)},o(g){he(e.$$.fragment,g),r=!1},d(g){$e(e,g)}}}function US(o){let e,t;const r=[ji("snapper-lines"),{paint:{"line-color":"black","line-width":10}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s={};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function VS(o){let e,t;const r=[ji("snapper-preview"),{paint:{"line-color":"black","line-width":3}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s={};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function qS(o){let e,t,r,l,u,d,s,g,y,k;t=new U1({}),t.$on("click",o[17]),t.$on("mousemove",o[18]);let S=bi(o[12]),L=[];for(let K=0;K<S.length;K+=1)L[K]=r0(i0(o,S,K));const P=K=>he(L[K],1,1,()=>{L[K]=null});let R=bi(o[8]),Z=[];for(let K=0;K<R.length;K+=1)Z[K]=o0(t0(o,R,K));const U=K=>he(Z[K],1,1,()=>{Z[K]=null});d=new xn({props:{data:o[21](o[9],o[8]),generateId:!0,$$slots:{default:[US]},$$scope:{ctx:o}}}),g=new xn({props:{data:o[13],$$slots:{default:[VS]},$$scope:{ctx:o}}});const H=o[29]["extra-map"],G=mn(H,o,o[46],e0);return{c(){e=ee("div"),Ve(t.$$.fragment),r=we();for(let K=0;K<L.length;K+=1)L[K].c();l=we();for(let K=0;K<Z.length;K+=1)Z[K].c();u=we(),Ve(d.$$.fragment),s=we(),Ve(g.$$.fragment),y=we(),G&&G.c(),Pe(e,"slot","map")},m(K,le){J(K,e,le),je(t,e,null),F(e,r);for(let Se=0;Se<L.length;Se+=1)L[Se]&&L[Se].m(e,null);F(e,l);for(let Se=0;Se<Z.length;Se+=1)Z[Se]&&Z[Se].m(e,null);F(e,u),je(d,e,null),F(e,s),je(g,e,null),F(e,y),G&&G.m(e,null),k=!0},p(K,le){if(le[0]&29364352){S=bi(K[12]);let te;for(te=0;te<S.length;te+=1){const Y=i0(K,S,te);L[te]?(L[te].p(Y,le),ne(L[te],1)):(L[te]=r0(Y),L[te].c(),ne(L[te],1),L[te].m(e,l))}for(ui(),te=S.length;te<L.length;te+=1)P(te);hi()}if(le[0]&68682080){R=bi(K[8]);let te;for(te=0;te<R.length;te+=1){const Y=t0(K,R,te);Z[te]?(Z[te].p(Y,le),ne(Z[te],1)):(Z[te]=o0(Y),Z[te].c(),ne(Z[te],1),Z[te].m(e,u))}for(ui(),te=R.length;te<Z.length;te+=1)U(te);hi()}const Se={};le[0]&768&&(Se.data=K[21](K[9],K[8])),le[1]&32768&&(Se.$$scope={dirty:le,ctx:K}),d.$set(Se);const Le={};le[0]&8192&&(Le.data=K[13]),le[1]&32768&&(Le.$$scope={dirty:le,ctx:K}),g.$set(Le),G&&G.p&&(!k||le[1]&32768)&&gn(G,H,K,K[46],k?_n(H,K[46],le,PS):yn(K[46]),e0)},i(K){if(!k){ne(t.$$.fragment,K);for(let le=0;le<S.length;le+=1)ne(L[le]);for(let le=0;le<R.length;le+=1)ne(Z[le]);ne(d.$$.fragment,K),ne(g.$$.fragment,K),ne(G,K),k=!0}},o(K){he(t.$$.fragment,K),L=L.filter(Boolean);for(let le=0;le<L.length;le+=1)he(L[le]);Z=Z.filter(Boolean);for(let le=0;le<Z.length;le+=1)he(Z[le]);he(d.$$.fragment,K),he(g.$$.fragment,K),he(G,K),k=!1},d(K){K&&X(e),$e(t),jn(L,K),jn(Z,K),$e(d),$e(g),G&&G.d(K)}}}function ZS(o){let e,t;const r=o[29]["extra-right"],l=mn(r,o,o[46],n0);return{c(){e=ee("div"),l&&l.c(),Pe(e,"slot","right")},m(u,d){J(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&32768)&&gn(l,r,u,u[46],t?_n(r,u[46],d,zS):yn(u[46]),n0)},i(u){t||(ne(l,u),t=!0)},o(u){he(l,u),t=!1},d(u){u&&X(e),l&&l.d(u)}}}function GS(o){let e,t,r,l;return e=new xc({props:{$$slots:{right:[ZS],map:[qS],left:[NS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0,r||(l=ft(window,"keydown",o[25]),r=!0)},p(u,d){const s={};d[0]&32767|d[1]&32768&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u),r=!1,l()}}}function WS(o,e,t){let r,l,u,d;bt(o,Co,yt=>t(8,l=yt)),bt(o,jd,yt=>t(9,u=yt)),bt(o,Fp,yt=>t(14,d=yt));let{$$slots:s={},$$scope:g}=e,{map:y}=e,{finish:k}=e,{cancel:S}=e,{deleteRoute:L}=e,{editingExisting:P}=e;Po(()=>{oi(Co,l=[],l),u==null||u.stop(),y.getCanvas().style.cursor="inherit"});let R=P?"adjust":"append-end",Z="snap",U=[],H=[],G=null,K=!1,le=!1,Se=!1;function Le(yt){let Ie=yt.length==0?"crosshair":"inherit";y.getCanvas().style.cursor=Ie}function te(){let yt=U.pop();t(11,U),yt&&oi(Co,l=yt,l)}function Y(){U.length==100&&U.shift(),t(11,U=[...U,JSON.parse(JSON.stringify(l))])}function ue(){t(10,Z=Z=="snap"?"free":"snap"),G&&t(28,G.snapped=Z=="snap",G)}function fe(yt){Y(),Co.update(Ie=>(R=="append-start"?Ie.splice(0,0,{point:yt.detail.lngLat.toArray(),snapped:Z=="snap"}):R=="append-end"&&Ie.push({point:yt.detail.lngLat.toArray(),snapped:Z=="snap"}),Ie))}function ce(yt){t(28,G={point:yt.detail.lngLat.toArray(),snapped:Z=="snap"})}function ae(yt){Y(),Co.update(Ie=>(Ie[yt].snapped=!Ie[yt].snapped,Ie))}function Ge(yt){Y(),Co.update(Ie=>(Ie.splice(yt,1),Ie)),t(5,K=!1)}function Ee(yt,Ie){try{if(yt)return JSON.parse(yt.inner.calculateRoute(Ie))}catch{}return dc()}function ze(yt,Ie,nt,Xt,wi){if(wi)return dc();try{if(yt&&Ie.length>0&&Xt){if(nt=="append-start")return JSON.parse(yt.inner.calculateRoute([Xt,Ie[0]]));if(nt=="append-end")return JSON.parse(yt.inner.calculateRoute([Ie[Ie.length-1],Xt]))}}catch{}return dc()}function rt(yt,Ie,nt,Xt){if(Xt)return;if(!yt||nt!="adjust"){t(12,H=[]);return}let wi=[],$i=1;for(let Li=0;Li<Ie.length-1;Li++){let gi=JSON.parse(yt.inner.getExtraNodes(Ie[Li],Ie[Li+1]));for(let[Fi,br,ct]of gi)wi.push({point:[Fi,br],snapped:ct,insertIdx:$i});$i++}t(12,H=wi)}function it(yt){Y(),Co.update(Ie=>(Ie.splice(yt.insertIdx,0,{point:yt.point,snapped:yt.snapped}),Ie)),t(7,Se=!0)}function Qe(yt){Co.update(Ie=>(Ie[yt.insertIdx].point=yt.point,Ie))}function Ft(){t(7,Se=!1)}function jt(yt){let Ie=yt.target.tagName,nt=Ie=="INPUT"||Ie=="TEXTAREA";yt.key==="Enter"&&!nt?(yt.stopPropagation(),l.length>=2&&k()):yt.key==="Escape"?(yt.stopPropagation(),S()):yt.key=="s"&&!nt?ue():yt.key=="1"&&!nt?t(4,R="append-start"):yt.key=="2"&&!nt?t(4,R="append-end"):yt.key=="3"&&!nt?t(4,R="adjust"):yt.key=="z"&&yt.ctrlKey&&(yt.stopPropagation(),te())}function ut(){Y(),t(6,le=!0)}const et=[[],[]];function at(yt,Ie){o.$$.not_equal(Ie.point,yt)&&(Ie.point=yt,t(12,H))}const Bt=yt=>it(yt),Dt=yt=>Qe(yt);function Ht(yt,Ie){o.$$.not_equal(Ie.point,yt)&&(Ie.point=yt,Co.set(l))}const ai=yt=>ae(yt),si=yt=>Ge(yt),Si=()=>t(5,K=!0),Ri=()=>t(5,K=!1),vi=()=>t(6,le=!1);function di(){Z=this.__value,t(10,Z)}function lt(){Z=this.__value,t(10,Z)}function qe(){R=this.__value,t(4,R)}function st(){R=this.__value,t(4,R)}function Te(){R=this.__value,t(4,R)}function mt(){d=this.checked,Fp.set(d)}return o.$$set=yt=>{"map"in yt&&t(27,y=yt.map),"finish"in yt&&t(0,k=yt.finish),"cancel"in yt&&t(1,S=yt.cancel),"deleteRoute"in yt&&t(2,L=yt.deleteRoute),"editingExisting"in yt&&t(3,P=yt.editingExisting),"$$scope"in yt&&t(46,g=yt.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&912&&rt(u,l,R,Se),o.$$.dirty[0]&268436336&&t(13,r=ze(u,l,R,G,K||le)),o.$$.dirty[0]&256&&Le(l)},[k,S,L,P,R,K,le,Se,l,u,Z,U,H,r,d,te,ue,fe,ce,ae,Ge,Ee,it,Qe,Ft,jt,ut,y,G,s,at,Bt,Dt,Ht,ai,si,Si,Ri,vi,di,et,lt,qe,st,Te,mt,g]}class HS extends Wt{constructor(e){super(),Gt(this,e,WS,GS,Vt,{map:27,finish:0,cancel:1,deleteRoute:2,editingExisting:3},null,[-1,-1])}}function s0(o,e,t){const r=o.slice();return r[23]=e[t],r}function XS(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R;return{c(){e=ee("div"),t=ee("label"),r=be(`Tier:
      `),l=ee("select"),u=ee("option"),u.textContent="Primary routes",d=ee("option"),d.textContent="Secondary routes",s=ee("option"),s.textContent="Local access routes",g=ee("option"),g.textContent="Long distance routes",y=we(),k=ee("button"),S=be("Evaluate this route"),u.__value="Primary",Zi(u,u.__value),d.__value="Secondary",Zi(d,d.__value),s.__value="LocalAccess",Zi(s,s.__value),g.__value="LongDistance",Zi(g,g.__value),o[5]===void 0&&Mo(()=>o[14].call(l)),Pe(k,"class","secondary"),k.disabled=L=o[2].length<2,Pe(e,"slot","extra-left")},m(Z,U){J(Z,e,U),F(e,t),F(t,r),F(t,l),F(l,u),F(l,d),F(l,s),F(l,g),hr(l,o[5],!0),F(e,y),F(e,k),F(k,S),P||(R=[ft(l,"change",o[14]),ft(k,"click",o[11])],P=!0)},p(Z,U){U&32&&hr(l,Z[5]),U&4&&L!==(L=Z[2].length<2)&&(k.disabled=L)},d(Z){Z&&X(e),P=!1,cn(R)}}}function a0(o){let e,t;return e=new xn({props:{data:o[6],$$slots:{default:[KS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&64&&(u.data=r[6]),l&134217730&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function KS(o){let e,t;const r=[ji("edit-current-routes"),{filter:o[1]==null?void 0:["!=",["id"],o[1]]},{paint:{"line-width":5,"line-color":ya,"line-opacity":.5}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&2?vn(r,[r[0],{filter:u[1]==null?void 0:["!=",["id"],u[1]]},r[2]]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function JS(o){let e,t,r=o[26].infra_type+"",l;return{c(){e=ee("p"),t=be("This section will be "),l=be(r)},m(u,d){J(u,e,d),F(e,t),F(e,l)},p(u,d){d&67108864&&r!==(r=u[26].infra_type+"")&&pt(l,r)},d(u){u&&X(e)}}}function YS(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[JS,({props:r})=>({26:r}),({props:r})=>r?67108864:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&201326592&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function QS(o){let e,t;const r=[ji("edit-route-sections"),{filter:["==",["get","kind"],"new"]},{paint:{"line-width":3,"line-color":ya}}];let l={$$slots:{default:[YS]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s={};d&134217728&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function e5(o){let e,t,r,l,u=o[6]&&a0(o);return r=new xn({props:{data:o[7],$$slots:{default:[QS]},$$scope:{ctx:o}}}),{c(){e=ee("span"),u&&u.c(),t=we(),Ve(r.$$.fragment),Pe(e,"slot","extra-map")},m(d,s){J(d,e,s),u&&u.m(e,null),F(e,t),je(r,e,null),l=!0},p(d,s){d[6]?u?(u.p(d,s),s&64&&ne(u,1)):(u=a0(d),u.c(),ne(u,1),u.m(e,t)):u&&(ui(),he(u,1,1,()=>{u=null}),hi());const g={};s&128&&(g.data=d[7]),s&134217728&&(g.$$scope={dirty:s,ctx:d}),r.$set(g)},i(d){l||(ne(u),ne(r.$$.fragment,d),l=!0)},o(d){he(u),he(r.$$.fragment,d),l=!1},d(d){d&&X(e),u&&u.d(),$e(r)}}}function l0(o){let e,t,r,l=bi(o[7].features),u=[];for(let d=0;d<l.length;d+=1)u[d]=c0(s0(o,l,d));return{c(){e=ee("p"),e.textContent="The route you've drawn has been split into sections:",t=we(),r=ee("ol");for(let d=0;d<u.length;d+=1)u[d].c()},m(d,s){J(d,e,s),J(d,t,s),J(d,r,s);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(r,null)},p(d,s){if(s&128){l=bi(d[7].features);let g;for(g=0;g<l.length;g+=1){const y=s0(d,l,g);u[g]?u[g].p(y,s):(u[g]=c0(y),u[g].c(),u[g].m(r,null))}for(;g<u.length;g+=1)u[g].d(1);u.length=l.length}},d(d){d&&(X(e),X(t),X(r)),jn(u,d)}}}function t5(o){let e;return{c(){e=ee("li"),e.textContent="An existing section from another route"},m(t,r){J(t,e,r)},p:We,d(t){t&&X(e)}}}function i5(o){let e,t,r=zo(o[23].properties).infra_type+"",l,u;return{c(){e=ee("li"),t=be("A section where "),l=be(r),u=be(` is most appropriate
            `)},m(d,s){J(d,e,s),F(e,t),F(e,l),F(e,u)},p(d,s){s&128&&r!==(r=zo(d[23].properties).infra_type+"")&&pt(l,r)},d(d){d&&X(e)}}}function c0(o){let e,t;function r(d,s){return s&128&&(e=null),e==null&&(e=zo(d[23].properties).kind=="new"),e?i5:t5}let l=r(o,-1),u=l(o);return{c(){u.c(),t=Ei()},m(d,s){u.m(d,s),J(d,t,s)},p(d,s){l===(l=r(d,s))&&u?u.p(d,s):(u.d(1),u=l(d),u&&(u.c(),u.m(t.parentNode,t)))},d(d){d&&X(t),u.d(d)}}}function n5(o){let e,t,r,l,u,d,s,g,y,k,S,L=o[7].features.length>0&&l0(o);return{c(){e=ee("div"),t=ee("label"),r=be(`Name:
      `),l=ee("input"),u=we(),d=ee("label"),s=be(`Notes:
      `),g=ee("textarea"),y=we(),L&&L.c(),Pe(l,"type","text"),Pe(g,"rows","5"),Pe(e,"slot","extra-right")},m(P,R){J(P,e,R),F(e,t),F(t,r),F(t,l),Zi(l,o[3]),F(e,u),F(e,d),F(d,s),F(d,g),Zi(g,o[4]),F(e,y),L&&L.m(e,null),k||(S=[ft(l,"input",o[12]),ft(g,"input",o[13])],k=!0)},p(P,R){R&8&&l.value!==P[3]&&Zi(l,P[3]),R&16&&Zi(g,P[4]),P[7].features.length>0?L?L.p(P,R):(L=l0(P),L.c(),L.m(e,null)):L&&(L.d(1),L=null)},d(P){P&&X(e),L&&L.d(),k=!1,cn(S)}}}function r5(o){let e,t;return e=new HS({props:{map:o[0],finish:o[9],cancel:o[10],deleteRoute:o[8],editingExisting:o[1]!=null,$$slots:{"extra-right":[n5],"extra-map":[e5],"extra-left":[XS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,[l]){const u={};l&1&&(u.map=r[0]),l&2&&(u.editingExisting=r[1]!=null),l&134217982&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function o5(o,e,t){let r,l,u,d,s,g,y;bt(o,Ln,fe=>t(16,r=fe)),bt(o,jd,fe=>t(17,l=fe)),bt(o,ln,fe=>t(18,u=fe)),bt(o,il,fe=>t(19,d=fe)),bt(o,da,fe=>t(20,s=fe)),bt(o,Co,fe=>t(2,g=fe)),bt(o,gs,fe=>t(21,y=fe));let{map:k}=e,{id:S}=e,L="",P="",R="Unknown",Z=y,U=null,H=dc();gc(async()=>{if(t(6,U=await r.renderRoutes()),oi(Co,g=[],g),S!=null){let fe=U.features.find(ce=>ce.id==S);t(3,L=fe.properties.name),t(4,P=fe.properties.notes),R=fe.properties.infra_type,t(5,Z=fe.properties.tier),oi(Co,g=fe.properties.waypoints.map(ce=>({point:[ce.lon,ce.lat],snapped:ce.snapped})),g)}});async function G(){S&&(await r.deleteRoute(S),await sh()),oi(ln,u={kind:"main"},u)}async function K(){try{let fe=JSON.parse(l.inner.calculateRoute(g));if(!fe){window.alert("No route drawn");return}await r.setRoute(S,{feature:fe,name:L,notes:P,full_path:fe.properties.full_path,infra_type:R,tier:Z}),await sh(),oi(ln,u={kind:"main"},u)}catch(fe){window.alert(fe)}}function le(){oi(ln,u={kind:"main"},u)}function Se(){let fe=JSON.parse(l.inner.calculateRoute(g)),ce=fe.geometry.coordinates[0],ae=fe.geometry.coordinates[fe.geometry.coordinates.length-1];oi(da,s={lng:ce[0],lat:ce[1]},s),oi(il,d={lng:ae[0],lat:ae[1]},d),oi(ln,u={kind:"evaluate-route",prevMode:{kind:"edit-route",id:S},browse:[]},u)}async function Le(fe){try{let ce=JSON.parse(l.inner.calculateRoute(fe));t(7,H=await r.autosplitRoute(ce.properties.full_path))}catch{t(7,H=dc())}}function te(){L=this.value,t(3,L)}function Y(){P=this.value,t(4,P)}function ue(){Z=vs(this),t(5,Z)}return o.$$set=fe=>{"map"in fe&&t(0,k=fe.map),"id"in fe&&t(1,S=fe.id)},o.$$.update=()=>{o.$$.dirty&4&&Le(g)},[k,S,g,L,P,Z,U,H,G,K,le,Se,te,Y,ue]}class s5 extends Wt{constructor(e){super(),Gt(this,e,o5,r5,Vt,{map:0,id:1})}}function u0(o,e,t){const r=o.slice();return r[3]=e[t],r}function h0(o){let e,t,r,l=o[3].infra_type+"",u,d,s=o[3].name+"",g,y,k;return{c(){e=ee("li"),t=ee("a"),r=be("["),u=be(l),d=be("] "),g=be(s),k=we(),Pe(t,"href",y=o[3].way),Pe(t,"target","_blank")},m(S,L){J(S,e,L),F(e,t),F(t,r),F(t,u),F(t,d),F(t,g),F(e,k)},p(S,L){L&1&&l!==(l=S[3].infra_type+"")&&pt(u,l),L&1&&s!==(s=S[3].name+"")&&pt(g,s),L&1&&y!==(y=S[3].way)&&Pe(t,"href",y)},d(S){S&&X(e)}}}function a5(o){let e,t,r,l=(o[0].route_length/o[0].direct_length).toFixed(1)+"",u,d,s,g,y,k,S=(o[0].route_length/o[0].car_length).toFixed(1)+"",L,P,R,Z,U,H,G,K,le,Se=gd(o[0],o[1])+"",Le,te,Y,ue,fe,ce=yd(o[0],o[1])+"",ae,Ge,Ee,ze,rt,it=gd(o[0],o[2])+"",Qe,Ft,jt,ut,et,at=yd(o[0],o[2])+"",Bt,Dt,Ht,ai,si,Si,Ri,vi,di=bi(o[0].directions),lt=[];for(let qe=0;qe<di.length;qe+=1)lt[qe]=h0(u0(o,di,qe));return{c(){e=ee("p"),t=be("Detour factor: "),r=ee("b"),u=be(l),d=be("x"),s=be(`
  longer than straight line`),g=we(),y=ee("p"),k=ee("b"),L=be(S),P=be("x"),R=be(`
  longer than the driving route (in
  `),Z=ee("span"),Z.textContent="red",U=be(`
  )`),H=we(),G=ee("hr"),K=we(),le=ee("p"),Le=be(Se),te=be(" changes in infrastructure type"),Y=we(),ue=ee("p"),fe=be("By length: "),ae=be(ce),Ge=we(),Ee=ee("hr"),ze=we(),rt=ee("p"),Qe=be(it),Ft=be(" changes in level of service"),jt=we(),ut=ee("p"),et=be("By length: "),Bt=be(at),Dt=we(),Ht=ee("hr"),ai=we(),si=ee("details"),Si=ee("summary"),Si.textContent="Route directions",Ri=we(),vi=ee("ol");for(let qe=0;qe<lt.length;qe+=1)lt[qe].c();mi(Z,"color","red")},m(qe,st){J(qe,e,st),F(e,t),F(e,r),F(r,u),F(r,d),F(e,s),J(qe,g,st),J(qe,y,st),F(y,k),F(k,L),F(k,P),F(y,R),F(y,Z),F(y,U),J(qe,H,st),J(qe,G,st),J(qe,K,st),J(qe,le,st),F(le,Le),F(le,te),J(qe,Y,st),J(qe,ue,st),F(ue,fe),F(ue,ae),J(qe,Ge,st),J(qe,Ee,st),J(qe,ze,st),J(qe,rt,st),F(rt,Qe),F(rt,Ft),J(qe,jt,st),J(qe,ut,st),F(ut,et),F(ut,Bt),J(qe,Dt,st),J(qe,Ht,st),J(qe,ai,st),J(qe,si,st),F(si,Si),F(si,Ri),F(si,vi);for(let Te=0;Te<lt.length;Te+=1)lt[Te]&&lt[Te].m(vi,null)},p(qe,[st]){if(st&1&&l!==(l=(qe[0].route_length/qe[0].direct_length).toFixed(1)+"")&&pt(u,l),st&1&&S!==(S=(qe[0].route_length/qe[0].car_length).toFixed(1)+"")&&pt(L,S),st&1&&Se!==(Se=gd(qe[0],qe[1])+"")&&pt(Le,Se),st&1&&ce!==(ce=yd(qe[0],qe[1])+"")&&pt(ae,ce),st&1&&it!==(it=gd(qe[0],qe[2])+"")&&pt(Qe,it),st&1&&at!==(at=yd(qe[0],qe[2])+"")&&pt(Bt,at),st&1){di=bi(qe[0].directions);let Te;for(Te=0;Te<di.length;Te+=1){const mt=u0(qe,di,Te);lt[Te]?lt[Te].p(mt,st):(lt[Te]=h0(mt),lt[Te].c(),lt[Te].m(vi,null))}for(;Te<lt.length;Te+=1)lt[Te].d(1);lt.length=di.length}},i:We,o:We,d(qe){qe&&(X(e),X(g),X(y),X(H),X(G),X(K),X(le),X(Y),X(ue),X(Ge),X(Ee),X(ze),X(rt),X(jt),X(ut),X(Dt),X(Ht),X(ai),X(si)),jn(lt,qe)}}}function gd(o,e){let t=0;for(let r=0;r<o.directions.length-1;r++){let l=e(o.directions[r]),u=e(o.directions[r+1]);l!=u&&t++}return t}function yd(o,e){let t={};for(let u of o.directions){let d=e(u);Object.hasOwn(t,d)||(t[d]=0),t[d]+=u.length}let r=0;for(let u of Object.values(t))r+=u;let l=[];for(let[u,d]of Object.entries(t).toSorted((s,g)=>g[1]-s[1])){let s=Math.round(d/r*100);l.push(`${s}% ${u}`)}return l.join(", ")}function l5(o,e,t){let{gj:r}=e,l=d=>d.infra_type,u=d=>d.los;return o.$$set=d=>{"gj"in d&&t(0,r=d.gj)},[r,l,u]}class c5 extends Wt{constructor(e){super(),Gt(this,e,l5,a5,Vt,{gj:0})}}function d0(o){let e,t;return{c(){e=ee("p"),t=be(o[7])},m(r,l){J(r,e,l),F(e,t)},p(r,l){l&128&&pt(t,r[7])},d(r){r&&X(e)}}}function u5(o){let e,t;return e=new nl({props:{colors:K1}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function h5(o){let e,t;return e=new nl({props:{colors:tm}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function f0(o){let e,t;return e=new c5({props:{gj:o[6]}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&64&&(u.gj=r[6]),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function d5(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le,te=o[7]&&d0(o);const Y=[h5,u5],ue=[];function fe(ae,Ge){return ae[3]=="los"?0:ae[3]=="gradient"?1:-1}~(H=fe(o))&&(G=ue[H]=Y[H](o));let ce=o[6]&&f0(o);return{c(){e=ee("div"),t=ee("h2"),t.textContent="Evaluate a route mode",r=we(),l=ee("button"),l.textContent="Back",u=we(),d=ee("p"),d.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,s=we(),te&&te.c(),g=we(),y=ee("label"),k=be(`Show details along route
      `),S=ee("select"),L=ee("option"),L.textContent="Just show route",P=ee("option"),P.textContent="Level of service",R=ee("option"),R.textContent="Infrastructure type",Z=ee("option"),Z.textContent="Gradient",U=we(),G&&G.c(),K=we(),ce&&ce.c(),L.__value="",Zi(L,L.__value),P.__value="los",Zi(P,P.__value),R.__value="infra_type",Zi(R,R.__value),Z.__value="gradient",Zi(Z,Z.__value),o[3]===void 0&&Mo(()=>o[18].call(S)),Pe(e,"slot","left")},m(ae,Ge){J(ae,e,Ge),F(e,t),F(e,r),F(e,l),F(e,u),F(e,d),F(e,s),te&&te.m(e,null),F(e,g),F(e,y),F(y,k),F(y,S),F(S,L),F(S,P),F(S,R),F(S,Z),hr(S,o[3],!0),F(e,U),~H&&ue[H].m(e,null),F(e,K),ce&&ce.m(e,null),le=!0,Se||(Le=[ft(l,"click",o[17]),ft(S,"change",o[18])],Se=!0)},p(ae,Ge){ae[7]?te?te.p(ae,Ge):(te=d0(ae),te.c(),te.m(e,g)):te&&(te.d(1),te=null),Ge&8&&hr(S,ae[3]);let Ee=H;H=fe(ae),H!==Ee&&(G&&(ui(),he(ue[Ee],1,1,()=>{ue[Ee]=null}),hi()),~H?(G=ue[H],G||(G=ue[H]=Y[H](ae),G.c()),ne(G,1),G.m(e,K)):G=null),ae[6]?ce?(ce.p(ae,Ge),Ge&64&&ne(ce,1)):(ce=f0(ae),ce.c(),ne(ce,1),ce.m(e,null)):ce&&(ui(),he(ce,1,1,()=>{ce=null}),hi())},i(ae){le||(ne(G),ne(ce),le=!0)},o(ae){he(G),he(ce),le=!1},d(ae){ae&&X(e),te&&te.d(),~H&&ue[H].d(),ce&&ce.d(),Se=!1,cn(Le)}}}function f5(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function p5(o){let e,t;return e=new xn({props:{data:o[21],$$slots:{default:[m5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&512&&(u.data=r[21]),l&4195328&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function m5(o){let e,t;const r=[ji("eval-current-routes"),{paint:{"line-width":5,"line-color":ya}},{layout:{visibility:o[10]?"visible":"none"}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&1024?vn(r,[r[0],r[1],{layout:{visibility:u[10]?"visible":"none"}}]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function _5(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function p0(o){let e,t,r,l,u,d;function s(S){o[15](S)}let g={draggable:!0,$$slots:{default:[g5]},$$scope:{ctx:o}};o[5]!==void 0&&(g.lngLat=o[5]),e=new Pd({props:g}),Ai.push(()=>Xn(e,"lngLat",s));function y(S){o[16](S)}let k={draggable:!0,$$slots:{default:[y5]},$$scope:{ctx:o}};return o[4]!==void 0&&(k.lngLat=o[4]),l=new Pd({props:k}),Ai.push(()=>Xn(l,"lngLat",y)),{c(){Ve(e.$$.fragment),r=we(),Ve(l.$$.fragment)},m(S,L){je(e,S,L),J(S,r,L),je(l,S,L),d=!0},p(S,L){const P={};L&4194304&&(P.$$scope={dirty:L,ctx:S}),!t&&L&32&&(t=!0,P.lngLat=S[5],Hn(()=>t=!1)),e.$set(P);const R={};L&4194304&&(R.$$scope={dirty:L,ctx:S}),!u&&L&16&&(u=!0,R.lngLat=S[4],Hn(()=>u=!1)),l.$set(R)},i(S){d||(ne(e.$$.fragment,S),ne(l.$$.fragment,S),d=!0)},o(S){he(e.$$.fragment,S),he(l.$$.fragment,S),d=!1},d(S){S&&X(r),$e(e,S),$e(l,S)}}}function g5(o){let e;return{c(){e=ee("span"),e.textContent="A",Pe(e,"class","dot svelte-1ej0v4r")},m(t,r){J(t,e,r)},p:We,d(t){t&&X(e)}}}function y5(o){let e;return{c(){e=ee("span"),e.textContent="B",Pe(e,"class","dot svelte-1ej0v4r")},m(t,r){J(t,e,r)},p:We,d(t){t&&X(e)}}}function m0(o){let e,t;return e=new xn({props:{data:o[6],generateId:!0,$$slots:{default:[b5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&64&&(u.data=r[6]),l&4194312&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function b5(o){let e,t,r,l;const u=[ji("eval-route-breakdown"),{filter:["!",["has","car_route"]]},{paint:{"line-width":20,"line-color":{"":"cyan",los:Op,infra_type:ya,gradient:My}[o[3]],"line-opacity":$n(.5,1)}},{manageHoverState:!0}];let d={};for(let y=0;y<u.length;y+=1)d=Ni(d,u[y]);e=new kn({props:d});const s=[ji("eval-car-route"),{filter:["has","car_route"]},{paint:{"line-width":10,"line-color":"red","line-opacity":$n(.5,1)}},{manageHoverState:!0}];let g={};for(let y=0;y<s.length;y+=1)g=Ni(g,s[y]);return r=new kn({props:g}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(y,k){je(e,y,k),J(y,t,k),je(r,y,k),l=!0},p(y,k){const S=k&8?vn(u,[u[0],u[1],{paint:{"line-width":20,"line-color":{"":"cyan",los:Op,infra_type:ya,gradient:My}[y[3]],"line-opacity":$n(.5,1)}},u[3]]):{};e.$set(S);const L={};r.$set(L)},i(y){l||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),l=!0)},o(y){he(e.$$.fragment,y),he(r.$$.fragment,y),l=!1},d(y){y&&X(t),$e(e,y),$e(r,y)}}}function v5(o){let e,t,r,l,u,d,s;t=new U1({}),t.$on("contextmenu",o[11]);let g={ctx:o,current:null,token:null,hasCatch:!1,pending:_5,then:p5,catch:f5,value:21,blocks:[,,,]};Dr(l=zo(o[9]).renderRoutes(),g);let y=o[5]&&o[4]&&p0(o),k=o[6]&&m0(o);return{c(){e=ee("div"),Ve(t.$$.fragment),r=we(),g.block.c(),u=we(),y&&y.c(),d=we(),k&&k.c(),Pe(e,"slot","map")},m(S,L){J(S,e,L),je(t,e,null),F(e,r),g.block.m(e,g.anchor=null),g.mount=()=>e,g.anchor=u,F(e,u),y&&y.m(e,null),F(e,d),k&&k.m(e,null),s=!0},p(S,L){o=S,g.ctx=o,L&512&&l!==(l=zo(o[9]).renderRoutes())&&Dr(l,g)||ba(g,o,L),o[5]&&o[4]?y?(y.p(o,L),L&48&&ne(y,1)):(y=p0(o),y.c(),ne(y,1),y.m(e,d)):y&&(ui(),he(y,1,1,()=>{y=null}),hi()),o[6]?k?(k.p(o,L),L&64&&ne(k,1)):(k=m0(o),k.c(),ne(k,1),k.m(e,null)):k&&(ui(),he(k,1,1,()=>{k=null}),hi())},i(S){s||(ne(t.$$.fragment,S),ne(g.block),ne(y),ne(k),s=!0)},o(S){he(t.$$.fragment,S);for(let L=0;L<3;L+=1){const P=g.blocks[L];he(P)}he(y),he(k),s=!1},d(S){S&&X(e),$e(t),g.block.d(),g.token=null,g=null,y&&y.d(),k&&k.d()}}}function _0(o){let e,t,r,l,u,d,s,g=o[2]+1+"",y,k,S=o[1].length+"",L,P,R,Z,U,H,G;return{c(){e=ee("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",t=we(),r=ee("div"),l=ee("button"),u=be("Previous"),s=we(),y=be(g),k=be(" / "),L=be(S),P=we(),R=ee("button"),Z=be("Next"),Pe(l,"class","secondary"),l.disabled=d=o[2]==0,Pe(R,"class","secondary"),R.disabled=U=o[2]==o[1].length-1},m(K,le){J(K,e,le),J(K,t,le),J(K,r,le),F(r,l),F(l,u),F(r,s),F(r,y),F(r,k),F(r,L),F(r,P),F(r,R),F(R,Z),H||(G=[ft(l,"click",o[13]),ft(R,"click",o[14])],H=!0)},p(K,le){le&4&&d!==(d=K[2]==0)&&(l.disabled=d),le&4&&g!==(g=K[2]+1+"")&&pt(y,g),le&2&&S!==(S=K[1].length+"")&&pt(L,S),le&6&&U!==(U=K[2]==K[1].length-1)&&(R.disabled=U)},d(K){K&&(X(e),X(t),X(r)),H=!1,cn(G)}}}function w5(o){let e,t=o[1].length>0&&_0(o);return{c(){e=ee("div"),t&&t.c(),Pe(e,"slot","right")},m(r,l){J(r,e,l),t&&t.m(e,null)},p(r,l){r[1].length>0?t?t.p(r,l):(t=_0(r),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},d(r){r&&X(e),t&&t.d()}}}function x5(o){let e,t,r,l;return e=new xc({props:{$$slots:{right:[w5],map:[v5],left:[d5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0,r||(l=ft(window,"keydown",o[12]),r=!0)},p(u,[d]){const s={};d&4196351&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u),r=!1,l()}}}function k5(o,e,t){let r,l,u,d,s;bt(o,ln,Y=>t(8,r=Y)),bt(o,il,Y=>t(4,l=Y)),bt(o,da,Y=>t(5,u=Y)),bt(o,Ln,Y=>t(9,d=Y)),bt(o,Rp,Y=>t(10,s=Y));let{prevMode:g}=e,{browse:y}=e,k=0,S=null,L="",P="los";async function R(Y,ue,fe=""){try{t(6,S=await d.evaluateRoute({start:Y,end:[ue.lng,ue.lat],breakdown:fe})),t(7,L="")}catch(ce){t(6,S=null),t(7,L=ce.toString())}}function Z(Y){oi(da,u=Y.detail.lngLat,u)}async function U(Y){if(y.length==0)return;let ue=y[Y];oi(da,u={lng:ue[0].x,lat:ue[0].y},u),oi(il,l={lng:ue[1].x,lat:ue[1].y},l),R(u,l,P)}function H(Y){Y.key==="Escape"&&(Y.stopPropagation(),oi(ln,r={kind:"main"},r))}const G=()=>t(2,k--,k),K=()=>t(2,k++,k);function le(Y){u=Y,da.set(u)}function Se(Y){l=Y,il.set(l)}const Le=()=>oi(ln,r=g,r);function te(){P=vs(this),t(3,P)}return o.$$set=Y=>{"prevMode"in Y&&t(0,g=Y.prevMode),"browse"in Y&&t(1,y=Y.browse)},o.$$.update=()=>{o.$$.dirty&56&&R(u,l,P),o.$$.dirty&4&&U(k)},[g,y,k,P,l,u,S,L,r,d,s,Z,H,G,K,le,Se,Le,te]}class S5 extends Wt{constructor(e){super(),Gt(this,e,k5,x5,Vt,{prevMode:0,browse:1})}}function Wn(o,e){return e==0?"0%":`${Math.round(o/e*100)}%`}function $d(o){return o.reduce((e,t)=>e+t,0)}function Ud(o){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]]]}function im(o){return["step",["get",o],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function Q1(){return["step",["abs",["get","gradient"]],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}function g0(o,e,t){const r=o.slice();return r[5]=e[t][0],r[6]=e[t][1],r}function y0(o){let e,t=o[0].succeeded.toLocaleString()+"",r,l,u=o[0].failed.toLocaleString()+"",d,s,g,y,k,S=o[0].max_count.toLocaleString()+"",L,P,R,Z,U,H,G,K=(100*o[0].percent_off_network).toFixed(1)+"",le,Se,Le,te=bi(Object.entries(o[0].percent_on_network)),Y=[];for(let ue=0;ue<te.length;ue+=1)Y[ue]=b0(g0(o,te,ue));return{c(){e=ee("p"),r=be(t),l=be(" routes succeeded, "),d=be(u),s=be(`
        failed`),g=we(),y=ee("p"),k=be("Highest count on any one road is "),L=be(S),P=we(),R=ee("p"),R.textContent="Percent of demand by infrastructure type:",Z=we(),U=ee("ul"),H=ee("li"),G=be("Off the network: "),le=be(K),Se=be("%"),Le=we();for(let ue=0;ue<Y.length;ue+=1)Y[ue].c()},m(ue,fe){J(ue,e,fe),F(e,r),F(e,l),F(e,d),F(e,s),J(ue,g,fe),J(ue,y,fe),F(y,k),F(y,L),J(ue,P,fe),J(ue,R,fe),J(ue,Z,fe),J(ue,U,fe),F(U,H),F(H,G),F(H,le),F(H,Se),F(U,Le);for(let ce=0;ce<Y.length;ce+=1)Y[ce]&&Y[ce].m(U,null)},p(ue,fe){if(fe&1&&t!==(t=ue[0].succeeded.toLocaleString()+"")&&pt(r,t),fe&1&&u!==(u=ue[0].failed.toLocaleString()+"")&&pt(d,u),fe&1&&S!==(S=ue[0].max_count.toLocaleString()+"")&&pt(L,S),fe&1&&K!==(K=(100*ue[0].percent_off_network).toFixed(1)+"")&&pt(le,K),fe&1){te=bi(Object.entries(ue[0].percent_on_network));let ce;for(ce=0;ce<te.length;ce+=1){const ae=g0(ue,te,ce);Y[ce]?Y[ce].p(ae,fe):(Y[ce]=b0(ae),Y[ce].c(),Y[ce].m(U,null))}for(;ce<Y.length;ce+=1)Y[ce].d(1);Y.length=te.length}},d(ue){ue&&(X(e),X(g),X(y),X(P),X(R),X(Z),X(U)),jn(Y,ue)}}}function b0(o){let e,t=o[5]+"",r,l,u=(100*o[6]).toFixed(1)+"",d,s;return{c(){e=ee("li"),r=be(t),l=be(": "),d=be(u),s=be("%")},m(g,y){J(g,e,y),F(e,r),F(e,l),F(e,d),F(e,s)},p(g,y){y&1&&t!==(t=g[5]+"")&&pt(r,t),y&1&&u!==(u=(100*g[6]).toFixed(1)+"")&&pt(d,u)},d(g){g&&X(e)}}}function T5(o){let e,t,r,l,u,d,s,g=o[0]&&y0(o);return{c(){e=ee("div"),t=ee("h2"),t.textContent="Evaluate OD mode",r=we(),l=ee("button"),l.textContent="Back",u=we(),g&&g.c(),Pe(e,"slot","left")},m(y,k){J(y,e,k),F(e,t),F(e,r),F(e,l),F(e,u),g&&g.m(e,null),d||(s=ft(l,"click",o[2]),d=!0)},p(y,k){y[0]?g?g.p(y,k):(g=y0(y),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d(y){y&&X(e),g&&g.d(),d=!1,s()}}}function v0(o){let e,t;return e=new xn({props:{data:o[0],generateId:!0,$$slots:{default:[E5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&1&&(u.data=r[0]),l&512&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function I5(o){let e=o[4].count+"",t,r,l=o[4].infra_type+"",u;return{c(){t=be(e),r=be(" on "),u=be(l)},m(d,s){J(d,t,s),J(d,r,s),J(d,u,s)},p(d,s){s&16&&e!==(e=d[4].count+"")&&pt(t,e),s&16&&l!==(l=d[4].infra_type+"")&&pt(u,l)},d(d){d&&(X(t),X(r),X(u))}}}function C5(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[I5,({props:r})=>({4:r}),({props:r})=>r?16:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&528&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function E5(o){let e,t;const r=[ji("eval-od-mode"),{paint:{"line-width":Ud("count"),"line-color":im("count")}},{manageHoverState:!0},{eventsIfTopMost:!0}];let l={$$slots:{default:[C5]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s={};d&512&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function L5(o){let e,t,r=o[0]&&v0(o);return{c(){e=ee("div"),r&&r.c(),Pe(e,"slot","map")},m(l,u){J(l,e,u),r&&r.m(e,null),t=!0},p(l,u){l[0]?r?(r.p(l,u),u&1&&ne(r,1)):(r=v0(l),r.c(),ne(r,1),r.m(e,null)):r&&(ui(),he(r,1,1,()=>{r=null}),hi())},i(l){t||(ne(r),t=!0)},o(l){he(r),t=!1},d(l){l&&X(e),r&&r.d()}}}function M5(o){let e,t;return e=new xc({props:{$$slots:{map:[L5],left:[T5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,[l]){const u={};l&515&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function A5(o,e,t){let r,l;bt(o,Ln,s=>t(3,r=s)),bt(o,ln,s=>t(1,l=s));let u=null;return gc(async()=>{t(0,u=await r.evaluateOD())}),[u,l,()=>oi(ln,l={kind:"main"},l)]}class P5 extends Wt{constructor(e){super(),Gt(this,e,A5,M5,Vt,{})}}function z5(o){let e;return{c(){e=ee("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(t,r){J(t,e,r)},d(t){t&&X(e)}}}function D5(o){let e;return{c(){e=ee("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(t,r){J(t,e,r)},d(t){t&&X(e)}}}function R5(o){let e;return{c(){e=ee("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(t,r){J(t,e,r)},d(t){t&&X(e)}}}function F5(o){let e;return{c(){e=ee("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(t,r){J(t,e,r)},d(t){t&&X(e)}}}function B5(o){let e;function t(u,d){if(u[0]=="Primary")return F5;if(u[0]=="Secondary")return R5;if(u[0]=="LocalAccess")return D5;if(u[0]=="LongDistance")return z5}let r=t(o),l=r&&r(o);return{c(){l&&l.c(),e=Ei()},m(u,d){l&&l.m(u,d),J(u,e,d)},p(u,d){r!==(r=t(u))&&(l&&l.d(1),l=r&&r(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&X(e),l&&l.d(u)}}}function O5(o){let e,t,r,l,u,d,s,g,y,k,S,L,P;return k=new q1({props:{$$slots:{default:[B5]},$$scope:{ctx:o}}}),{c(){e=ee("div"),t=ee("button"),t.textContent="Primary routes",r=we(),l=ee("button"),l.textContent="Secondary routes",u=we(),d=ee("button"),d.textContent="Local access routes",s=we(),g=ee("button"),g.textContent="Long distance routes",y=we(),Ve(k.$$.fragment),Pe(t,"class","svelte-gv50c1"),mi(t,"background",o[0]=="Primary"?er.Primary:"grey"),Pe(l,"class","svelte-gv50c1"),mi(l,"background",o[0]=="Secondary"?er.Secondary:"grey"),Pe(d,"class","svelte-gv50c1"),mi(d,"background",o[0]=="LocalAccess"?er.LocalAccess:"grey"),Pe(g,"class","svelte-gv50c1"),mi(g,"background",o[0]=="LongDistance"?er.LongDistance:"grey"),Pe(e,"class","svelte-gv50c1")},m(R,Z){J(R,e,Z),F(e,t),F(e,r),F(e,l),F(e,u),F(e,d),F(e,s),F(e,g),F(e,y),je(k,e,null),S=!0,L||(P=[ft(t,"click",o[1]),ft(l,"click",o[2]),ft(d,"click",o[3]),ft(g,"click",o[4])],L=!0)},p(R,[Z]){Z&1&&mi(t,"background",R[0]=="Primary"?er.Primary:"grey"),Z&1&&mi(l,"background",R[0]=="Secondary"?er.Secondary:"grey"),Z&1&&mi(d,"background",R[0]=="LocalAccess"?er.LocalAccess:"grey"),Z&1&&mi(g,"background",R[0]=="LongDistance"?er.LongDistance:"grey");const U={};Z&33&&(U.$$scope={dirty:Z,ctx:R}),k.$set(U)},i(R){S||(ne(k.$$.fragment,R),S=!0)},o(R){he(k.$$.fragment,R),S=!1},d(R){R&&X(e),$e(k),L=!1,cn(P)}}}function N5(o,e,t){let r;return bt(o,gs,g=>t(0,r=g)),[r,()=>oi(gs,r="Primary",r),()=>oi(gs,r="Secondary",r),()=>oi(gs,r="LocalAccess",r),()=>oi(gs,r="LongDistance",r)]}class j5 extends Wt{constructor(e){super(),Gt(this,e,N5,O5,Vt,{})}}function $5(o){let e,t;const r=o[3].default,l=mn(r,o,o[2],null);return{c(){e=ee("div"),l&&l.c()},m(u,d){J(u,e,d),l&&l.m(e,null),o[4](e),t=!0},p(u,[d]){l&&l.p&&(!t||d&4)&&gn(l,r,u,u[2],t?_n(r,u[2],d,null):yn(u[2]),null)},i(u){t||(ne(l,u),t=!0)},o(u){he(l,u),t=!1},d(u){u&&X(e),l&&l.d(u),o[4](null)}}}function U5(o,e,t){let{$$slots:r={},$$scope:l}=e,{name:u}=e,d=null;function s(g){Ai[g?"unshift":"push"](()=>{d=g,t(0,d)})}return o.$$set=g=>{"name"in g&&t(1,u=g.name),"$$scope"in g&&t(2,l=g.$$scope)},o.$$.update=()=>{o.$$.dirty&3&&d&&X1.update(g=>(g.set(u,d),g))},[d,u,l,r,s]}class no extends Wt{constructor(e){super(),Gt(this,e,U5,$5,Vt,{name:1})}}function w0(o){let e,t,r,l,u,d,s,g,y,k,S;return{c(){e=ee("button"),e.textContent="Import existing routes",t=we(),r=ee("label"),l=ee("input"),u=be(`
      Show osmactive data`),d=we(),s=ee("label"),g=ee("input"),y=be(`
      Show calculated data`),Pe(e,"class","outline"),Pe(l,"type","checkbox"),Pe(g,"type","checkbox")},m(L,P){J(L,e,P),J(L,t,P),J(L,r,P),F(r,l),l.checked=o[3],F(r,u),J(L,d,P),J(L,s,P),F(s,g),g.checked=o[4],F(s,y),k||(S=[ft(e,"click",o[8]),ft(l,"change",o[9]),ft(g,"change",o[10])],k=!0)},p(L,P){P&8&&(l.checked=L[3]),P&16&&(g.checked=L[4])},d(L){L&&(X(e),X(t),X(r),X(d),X(s)),k=!1,cn(S)}}}function V5(o){let e,t,r,l,u,d,s,g=o[0]&&w0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Existing network`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(y,k){J(y,e,k),F(e,t),t.checked=o[0],F(e,r),J(y,l,k),g&&g.m(y,k),J(y,u,k),d||(s=ft(t,"change",o[7]),d=!0)},p(y,k){k&1&&(t.checked=y[0]),y[0]?g?g.p(y,k):(g=w0(y),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(y){y&&(X(e),X(l),X(u)),g&&g.d(y),d=!1,s()}}}function x0(o){let e,t;return e=new V1({props:{$$slots:{default:[q5]},$$scope:{ctx:o}}}),e.$on("close",o[12]),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&131076&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function q5(o){let e,t,r,l,u,d,s,g,y;return{c(){e=ee("h2"),e.textContent="Import existing routes from OpenStreetMap",t=we(),r=ee("p"),l=be(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),u=ee("button"),u.textContent="Import existing routes",d=we(),s=ee("button"),s.textContent="Cancel",Pe(s,"class","secondary")},m(k,S){J(k,e,S),J(k,t,S),J(k,r,S),F(r,l),F(r,u),F(r,d),F(r,s),g||(y=[ft(u,"click",o[6]),ft(s,"click",o[11])],g=!0)},p:We,d(k){k&&(X(e),X(t),X(r)),g=!1,cn(y)}}}function Z5(o){let e,t=o[16]["Infrastructure type"]+"",r;return{c(){e=be("osmactive: "),r=be(t)},m(l,u){J(l,e,u),J(l,r,u)},p(l,u){u&65536&&t!==(t=l[16]["Infrastructure type"]+"")&&pt(r,t)},d(l){l&&(X(e),X(r))}}}function G5(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[Z5,({props:r})=>({16:r}),({props:r})=>r?65536:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&196608&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function W5(o){let e,t;const r=[ji("existing-infra-debug"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Is(["get","Infrastructure type"],{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#FF0000"},"cyan"),"line-width":3}},{layout:{visibility:o[0]&&o[3]?"visible":"none"}}];let l={$$slots:{default:[G5]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&9?vn(r,[r[0],r[1],r[2],r[3],{layout:{visibility:u[0]&&u[3]?"visible":"none"}}]):{};d&131072&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function k0(o){let e,t,r,l={ctx:o,current:null,token:null,hasCatch:!1,pending:Q5,then:X5,catch:H5,value:15,blocks:[,,,]};return Dr(t=o[5].classifyExistingNetwork(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,r=!0},p(u,d){o=u,l.ctx=o,d&32&&t!==(t=o[5].classifyExistingNetwork())&&Dr(t,l)||ba(l,o,d)},i(u){r||(ne(l.block),r=!0)},o(u){for(let d=0;d<3;d+=1){const s=l.blocks[d];he(s)}r=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function H5(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function X5(o){let e,t;return e=new xn({props:{data:o[15],generateId:!0,$$slots:{default:[Y5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&32&&(u.data=r[15]),l&131089&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function K5(o){let e=pc[o[16].infra_type][0]+"",t;return{c(){t=be(e)},m(r,l){J(r,t,l)},p(r,l){l&65536&&e!==(e=pc[r[16].infra_type][0]+"")&&pt(t,e)},d(r){r&&X(t)}}}function J5(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[K5,({props:r})=>({16:r}),({props:r})=>r?65536:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&196608&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function Y5(o){let e,t;const r=[ji("existing-infra"),{layout:{visibility:o[0]&&o[4]?"visible":"none"}},{paint:{"line-width":$n(5,7),"line-color":ya,"line-opacity":.8}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[J5]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),e.$on("click",o[13]),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&17?vn(r,[r[0],{layout:{visibility:u[0]&&u[4]?"visible":"none"}},r[2],r[3],r[4]]):{};d&131072&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function Q5(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function eT(o){let e,t,r,l,u,d,s;e=new no({props:{name:"existing network",$$slots:{default:[V5]},$$scope:{ctx:o}}});let g=o[2]&&x0(o);l=new uh({props:{url:`pmtiles://${kc("cbd.pmtiles")}`,$$slots:{default:[W5]},$$scope:{ctx:o}}});let y=o[5]&&o[1]&&k0(o);return{c(){Ve(e.$$.fragment),t=we(),g&&g.c(),r=we(),Ve(l.$$.fragment),u=we(),y&&y.c(),d=Ei()},m(k,S){je(e,k,S),J(k,t,S),g&&g.m(k,S),J(k,r,S),je(l,k,S),J(k,u,S),y&&y.m(k,S),J(k,d,S),s=!0},p(k,[S]){const L={};S&131101&&(L.$$scope={dirty:S,ctx:k}),e.$set(L),k[2]?g?(g.p(k,S),S&4&&ne(g,1)):(g=x0(k),g.c(),ne(g,1),g.m(r.parentNode,r)):g&&(ui(),he(g,1,1,()=>{g=null}),hi());const P={};S&131081&&(P.$$scope={dirty:S,ctx:k}),l.$set(P),k[5]&&k[1]?y?(y.p(k,S),S&34&&ne(y,1)):(y=k0(k),y.c(),ne(y,1),y.m(d.parentNode,d)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){s||(ne(e.$$.fragment,k),ne(g),ne(l.$$.fragment,k),ne(y),s=!0)},o(k){he(e.$$.fragment,k),he(g),he(l.$$.fragment,k),he(y),s=!1},d(k){k&&(X(t),X(r),X(u),X(d)),$e(e,k),g&&g.d(k),$e(l,k),y&&y.d(k)}}}function tT(o,e,t){let r,l;bt(o,oh,G=>t(14,r=G)),bt(o,Ln,G=>t(5,l=G));let u=!1,d=!1,s=!1;async function g(){if(t(2,s=!1),l){let G=l.importExistingRoutes(),K=G==1?"route segment":"route segments";await sh(),oi(oh,r+=1,r),window.alert(`Imported ${G} ${K}`),t(0,u=!1)}}let y=!0,k=!0;function S(){u=this.checked,t(0,u)}const L=()=>t(2,s=!0);function P(){y=this.checked,t(3,y)}function R(){k=this.checked,t(4,k)}const Z=()=>t(2,s=!1),U=()=>t(2,s=!1),H=G=>window.open(zo(G.detail.features[0].properties).way,"_blank");return o.$$.update=()=>{o.$$.dirty&1&&u&&t(1,d=!0)},[u,d,s,y,k,l,g,S,L,P,R,Z,U,H]}class iT extends Wt{constructor(e){super(),Gt(this,e,tT,eT,Vt,{})}}function S0(o,e,t){const r=o.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function T0(o,e,t){const r=o.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function I0(o,e,t){const r=o.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function C0(o,e,t){const r=o.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function E0(o,e,t){const r=o.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function L0(o,e,t){const r=o.slice();return r[17]=e[t][0],r[18]=e[t][1],r}function M0(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G=bi(o[7]),K=[];for(let fe=0;fe<G.length;fe+=1)K[fe]=A0(L0(o,G,fe));let le=bi(o[8]),Se=[];for(let fe=0;fe<le.length;fe+=1)Se[fe]=P0(E0(o,le,fe));let Le=bi(o[9]),te=[];for(let fe=0;fe<Le.length;fe+=1)te[fe]=z0(C0(o,Le,fe));let Y=bi(o[10]),ue=[];for(let fe=0;fe<Y.length;fe+=1)ue[fe]=D0(I0(o,Y,fe));return{c(){e=ee("label"),t=be(`Trip purpose:
      `),r=ee("select");for(let fe=0;fe<K.length;fe+=1)K[fe].c();l=we(),u=ee("label"),d=be(`Scenario:
      `),s=ee("select");for(let fe=0;fe<Se.length;fe+=1)Se[fe].c();g=we(),y=ee("label"),k=be(`Network type:
      `),S=ee("select");for(let fe=0;fe<te.length;fe+=1)te[fe].c();L=we(),P=ee("label"),R=be(`Color by:
      `),Z=ee("select");for(let fe=0;fe<ue.length;fe+=1)ue[fe].c();o[0]===void 0&&Mo(()=>o[12].call(r)),o[1]===void 0&&Mo(()=>o[13].call(s)),o[2]===void 0&&Mo(()=>o[14].call(S)),o[3]===void 0&&Mo(()=>o[15].call(Z))},m(fe,ce){J(fe,e,ce),F(e,t),F(e,r);for(let ae=0;ae<K.length;ae+=1)K[ae]&&K[ae].m(r,null);hr(r,o[0],!0),J(fe,l,ce),J(fe,u,ce),F(u,d),F(u,s);for(let ae=0;ae<Se.length;ae+=1)Se[ae]&&Se[ae].m(s,null);hr(s,o[1],!0),J(fe,g,ce),J(fe,y,ce),F(y,k),F(y,S);for(let ae=0;ae<te.length;ae+=1)te[ae]&&te[ae].m(S,null);hr(S,o[2],!0),J(fe,L,ce),J(fe,P,ce),F(P,R),F(P,Z);for(let ae=0;ae<ue.length;ae+=1)ue[ae]&&ue[ae].m(Z,null);hr(Z,o[3],!0),U||(H=[ft(r,"change",o[12]),ft(s,"change",o[13]),ft(S,"change",o[14]),ft(Z,"change",o[15])],U=!0)},p(fe,ce){if(ce[0]&128){G=bi(fe[7]);let ae;for(ae=0;ae<G.length;ae+=1){const Ge=L0(fe,G,ae);K[ae]?K[ae].p(Ge,ce):(K[ae]=A0(Ge),K[ae].c(),K[ae].m(r,null))}for(;ae<K.length;ae+=1)K[ae].d(1);K.length=G.length}if(ce[0]&129&&hr(r,fe[0]),ce[0]&256){le=bi(fe[8]);let ae;for(ae=0;ae<le.length;ae+=1){const Ge=E0(fe,le,ae);Se[ae]?Se[ae].p(Ge,ce):(Se[ae]=P0(Ge),Se[ae].c(),Se[ae].m(s,null))}for(;ae<Se.length;ae+=1)Se[ae].d(1);Se.length=le.length}if(ce[0]&258&&hr(s,fe[1]),ce[0]&512){Le=bi(fe[9]);let ae;for(ae=0;ae<Le.length;ae+=1){const Ge=C0(fe,Le,ae);te[ae]?te[ae].p(Ge,ce):(te[ae]=z0(Ge),te[ae].c(),te[ae].m(S,null))}for(;ae<te.length;ae+=1)te[ae].d(1);te.length=Le.length}if(ce[0]&516&&hr(S,fe[2]),ce[0]&1024){Y=bi(fe[10]);let ae;for(ae=0;ae<Y.length;ae+=1){const Ge=I0(fe,Y,ae);ue[ae]?ue[ae].p(Ge,ce):(ue[ae]=D0(Ge),ue[ae].c(),ue[ae].m(Z,null))}for(;ae<ue.length;ae+=1)ue[ae].d(1);ue.length=Y.length}ce[0]&1032&&hr(Z,fe[3])},d(fe){fe&&(X(e),X(l),X(u),X(g),X(y),X(L),X(P)),jn(K,fe),jn(Se,fe),jn(te,fe),jn(ue,fe),U=!1,cn(H)}}}function A0(o){let e,t=o[18]+"",r;return{c(){e=ee("option"),r=be(t),e.__value=o[17],Zi(e,e.__value)},m(l,u){J(l,e,u),F(e,r)},p:We,d(l){l&&X(e)}}}function P0(o){let e,t=o[18]+"",r;return{c(){e=ee("option"),r=be(t),e.__value=o[17],Zi(e,e.__value)},m(l,u){J(l,e,u),F(e,r)},p:We,d(l){l&&X(e)}}}function z0(o){let e,t=o[18]+"",r;return{c(){e=ee("option"),r=be(t),e.__value=o[17],Zi(e,e.__value)},m(l,u){J(l,e,u),F(e,r)},p:We,d(l){l&&X(e)}}}function D0(o){let e,t=o[18]+"",r;return{c(){e=ee("option"),r=be(t),e.__value=o[17],Zi(e,e.__value)},m(l,u){J(l,e,u),F(e,r)},p:We,d(l){l&&X(e)}}}function nT(o){let e,t,r,l,u,d,s,g=o[5]&&M0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Route network`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(y,k){J(y,e,k),F(e,t),t.checked=o[5],F(e,r),J(y,l,k),g&&g.m(y,k),J(y,u,k),d||(s=ft(t,"change",o[11]),d=!0)},p(y,k){k[0]&32&&(t.checked=y[5]),y[5]?g?g.p(y,k):(g=M0(y),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(y){y&&(X(e),X(l),X(u)),g&&g.d(y),d=!1,s()}}}function R0(o){let e,t,r,l,u=o[16][`${o[17]}_fastest_bicycle`].toLocaleString()+"",d,s,g,y=o[16][`${o[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",k,S,L,P=o[16][`${o[17]}_fastest_bicycle_ebike`].toLocaleString()+"",R,Z;return{c(){e=ee("tr"),t=ee("th"),t.textContent=`${o[18]}`,r=we(),l=ee("td"),d=be(u),s=we(),g=ee("td"),k=be(y),S=we(),L=ee("td"),R=be(P),Z=we()},m(U,H){J(U,e,H),F(e,t),F(e,r),F(e,l),F(l,d),F(e,s),F(e,g),F(g,k),F(e,S),F(e,L),F(L,R),F(e,Z)},p(U,H){H[0]&65536&&u!==(u=U[16][`${U[17]}_fastest_bicycle`].toLocaleString()+"")&&pt(d,u),H[0]&65536&&y!==(y=U[16][`${U[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&pt(k,y),H[0]&65536&&P!==(P=U[16][`${U[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&pt(R,P)},d(U){U&&X(e)}}}function F0(o){let e,t,r,l,u=o[16][`${o[17]}_quietest_bicycle`].toLocaleString()+"",d,s,g,y=o[16][`${o[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",k,S,L,P=o[16][`${o[17]}_quietest_bicycle_ebike`].toLocaleString()+"",R,Z;return{c(){e=ee("tr"),t=ee("th"),t.textContent=`${o[18]}`,r=we(),l=ee("td"),d=be(u),s=we(),g=ee("td"),k=be(y),S=we(),L=ee("td"),R=be(P),Z=we()},m(U,H){J(U,e,H),F(e,t),F(e,r),F(e,l),F(l,d),F(e,s),F(e,g),F(g,k),F(e,S),F(e,L),F(L,R),F(e,Z)},p(U,H){H[0]&65536&&u!==(u=U[16][`${U[17]}_quietest_bicycle`].toLocaleString()+"")&&pt(d,u),H[0]&65536&&y!==(y=U[16][`${U[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&pt(k,y),H[0]&65536&&P!==(P=U[16][`${U[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&pt(R,P)},d(U){U&&X(e)}}}function rT(o){let e,t,r,l=o[16][o[4]].toLocaleString()+"",u,d,s,g,y=o[16].gradient+"",k,S,L,P,R,Z=o[16].quietness+"",U,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,Ge,Ee,ze,rt,it=bi(o[7]),Qe=[];for(let ut=0;ut<it.length;ut+=1)Qe[ut]=R0(T0(o,it,ut));let Ft=bi(o[7]),jt=[];for(let ut=0;ut<Ft.length;ut+=1)jt[ut]=F0(S0(o,Ft,ut));return{c(){e=ee("div"),t=ee("p"),r=be("Cyclists: "),u=be(l),d=we(),s=ee("p"),g=be("Gradient: "),k=be(y),S=be("%"),L=we(),P=ee("p"),R=be("Cycle-friendliness: "),U=be(Z),H=be("%"),G=we(),K=ee("details"),le=ee("summary"),le.textContent="All network details",Se=we(),Le=ee("p"),Le.textContent="Fast/Direct network",te=we(),Y=ee("table"),ue=ee("tr"),ue.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",fe=we();for(let ut=0;ut<Qe.length;ut+=1)Qe[ut].c();ce=we(),ae=ee("p"),ae.textContent="Quiet/Indirect network",Ge=we(),Ee=ee("table"),ze=ee("tr"),ze.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",rt=we();for(let ut=0;ut<jt.length;ut+=1)jt[ut].c();mi(e,"max-width","30vw"),mi(e,"max-height","60vh"),mi(e,"overflow","auto")},m(ut,et){J(ut,e,et),F(e,t),F(t,r),F(t,u),F(e,d),F(e,s),F(s,g),F(s,k),F(s,S),F(e,L),F(e,P),F(P,R),F(P,U),F(P,H),F(e,G),F(e,K),F(K,le),F(K,Se),F(K,Le),F(K,te),F(K,Y),F(Y,ue),F(Y,fe);for(let at=0;at<Qe.length;at+=1)Qe[at]&&Qe[at].m(Y,null);F(K,ce),F(K,ae),F(K,Ge),F(K,Ee),F(Ee,ze),F(Ee,rt);for(let at=0;at<jt.length;at+=1)jt[at]&&jt[at].m(Ee,null)},p(ut,et){if(et[0]&65552&&l!==(l=ut[16][ut[4]].toLocaleString()+"")&&pt(u,l),et[0]&65536&&y!==(y=ut[16].gradient+"")&&pt(k,y),et[0]&65536&&Z!==(Z=ut[16].quietness+"")&&pt(U,Z),et[0]&65664){it=bi(ut[7]);let at;for(at=0;at<it.length;at+=1){const Bt=T0(ut,it,at);Qe[at]?Qe[at].p(Bt,et):(Qe[at]=R0(Bt),Qe[at].c(),Qe[at].m(Y,null))}for(;at<Qe.length;at+=1)Qe[at].d(1);Qe.length=it.length}if(et[0]&65664){Ft=bi(ut[7]);let at;for(at=0;at<Ft.length;at+=1){const Bt=S0(ut,Ft,at);jt[at]?jt[at].p(Bt,et):(jt[at]=F0(Bt),jt[at].c(),jt[at].m(Ee,null))}for(;at<jt.length;at+=1)jt[at].d(1);jt.length=Ft.length}},d(ut){ut&&X(e),jn(Qe,ut),jn(jt,ut)}}}function oT(o){let e,t;return e=new yr({props:{openOn:"click",$$slots:{default:[rT,({props:r})=>({16:r}),({props:r})=>[r?65536:0]]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l[0]&65552|l[1]&1&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function sT(o){let e,t;const r=[ji("rnet"),{sourceLayer:"rnet"},{paint:{"line-color":o[6],"line-width":Ud(o[4])}},{layout:{visibility:o[5]?"visible":"none"}},{hoverCursor:"pointer"}];let l={$$slots:{default:[oT]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d[0]&112?vn(r,[r[0],r[1],d[0]&80&&{paint:{"line-color":u[6],"line-width":Ud(u[4])}},d[0]&32&&{layout:{visibility:u[5]?"visible":"none"}},r[4]]):{};d[0]&16|d[1]&1&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function aT(o){let e,t,r,l;return e=new no({props:{name:"route network",$$slots:{default:[nT]},$$scope:{ctx:o}}}),r=new uh({props:{url:`pmtiles://${kc("route_network.pmtiles")}`,$$slots:{default:[sT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(r,u,d),l=!0},p(u,d){const s={};d[0]&47|d[1]&1&&(s.$$scope={dirty:d,ctx:u}),e.$set(s);const g={};d[0]&112|d[1]&1&&(g.$$scope={dirty:d,ctx:u}),r.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(r.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(r.$$.fragment,u),l=!1},d(u){u&&X(t),$e(e,u),$e(r,u)}}}function lT(o,e,t){let r,l,u=!1,d="all",s="bicycle_go_dutch",g="fastest",y="flow",k=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],S=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],L=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],P=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function R(){u=this.checked,t(5,u)}function Z(){d=vs(this),t(0,d),t(7,k)}function U(){s=vs(this),t(1,s),t(8,S)}function H(){g=vs(this),t(2,g),t(9,L)}function G(){y=vs(this),t(3,y),t(10,P)}return o.$$.update=()=>{o.$$.dirty[0]&7&&t(4,r=`${d}_${g}_${s}`),o.$$.dirty[0]&24&&t(6,l={none:"#304ce7",flow:im(r),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Q1}[y])},[d,s,g,y,r,u,l,k,S,L,P,R,Z,U,H,G]}class cT extends Wt{constructor(e){super(),Gt(this,e,lT,aT,Vt,{},null,[-1,-1])}}function B0(o){let e,t,r,l,u,d,s,g,y,k,S;return{c(){e=ee("button"),e.textContent="Import core network",t=we(),r=ee("label"),l=ee("input"),u=be(`
      Show actual core network`),d=we(),s=ee("label"),g=ee("input"),y=be(`
      Show map-matched core network`),Pe(e,"class","outline"),Pe(l,"type","checkbox"),Pe(g,"type","checkbox")},m(L,P){J(L,e,P),J(L,t,P),J(L,r,P),F(r,l),l.checked=o[2],F(r,u),J(L,d,P),J(L,s,P),F(s,g),g.checked=o[3],F(s,y),k||(S=[ft(e,"click",o[5]),ft(l,"change",o[7]),ft(g,"change",o[8])],k=!0)},p(L,P){P&4&&(l.checked=L[2]),P&8&&(g.checked=L[3])},d(L){L&&(X(e),X(t),X(r),X(d),X(s)),k=!1,cn(S)}}}function uT(o){let e,t,r,l,u,d,s,g=o[0]&&B0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Core network`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(y,k){J(y,e,k),F(e,t),t.checked=o[0],F(e,r),J(y,l,k),g&&g.m(y,k),J(y,u,k),d||(s=ft(t,"change",o[6]),d=!0)},p(y,k){k&1&&(t.checked=y[0]),y[0]?g?g.p(y,k):(g=B0(y),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(y){y&&(X(e),X(l),X(u)),g&&g.d(y),d=!1,s()}}}function hT(o){let e,t=o[11].all_fastest_bicycle_go_dutch+"",r;return{c(){e=be("Go Dutch value "),r=be(t)},m(l,u){J(l,e,u),J(l,r,u)},p(l,u){u&2048&&t!==(t=l[11].all_fastest_bicycle_go_dutch+"")&&pt(r,t)},d(l){l&&(X(e),X(r))}}}function dT(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[hT,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function fT(o){let e,t;const r=[ji("cn-debug"),{sourceLayer:"coherent_networks"},{paint:{"line-color":Is(["get","road_function"],{Primary:"#c00000",Secondary:"#e97132","Local Access":"#ffc000","Long Distance":"#4ea72e"},"cyan"),"line-width":2}},{layout:{visibility:o[0]&&o[2]?"visible":"none"}}];let l={$$slots:{default:[dT]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&5?vn(r,[r[0],r[1],r[2],{layout:{visibility:u[0]&&u[2]?"visible":"none"}}]):{};d&4096&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function O0(o){let e,t,r,l={ctx:o,current:null,token:null,hasCatch:!1,pending:gT,then:mT,catch:pT,value:10,blocks:[,,,]};return Dr(t=o[4].renderCoreNetwork(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,r=!0},p(u,d){o=u,l.ctx=o,d&16&&t!==(t=o[4].renderCoreNetwork())&&Dr(t,l)||ba(l,o,d)},i(u){r||(ne(l.block),r=!0)},o(u){for(let d=0;d<3;d+=1){const s=l.blocks[d];he(s)}r=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function pT(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function mT(o){let e,t;return e=new xn({props:{data:o[10],generateId:!0,$$slots:{default:[_T]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&16&&(u.data=r[10]),l&4105&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function _T(o){let e,t;const r=[ji("cn"),{paint:{"line-color":Bp,"line-width":10,"line-opacity":.5}},{layout:{visibility:o[0]&&o[3]?"visible":"none"}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&9?vn(r,[r[0],r[1],{layout:{visibility:u[0]&&u[3]?"visible":"none"}}]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function gT(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function yT(o){let e,t,r,l,u,d;e=new no({props:{name:"core network",$$slots:{default:[uT]},$$scope:{ctx:o}}}),r=new uh({props:{url:`pmtiles://${kc("core_network.pmtiles")}`,$$slots:{default:[fT]},$$scope:{ctx:o}}});let s=o[4]&&o[1]&&O0(o);return{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment),l=we(),s&&s.c(),u=Ei()},m(g,y){je(e,g,y),J(g,t,y),je(r,g,y),J(g,l,y),s&&s.m(g,y),J(g,u,y),d=!0},p(g,[y]){const k={};y&4109&&(k.$$scope={dirty:y,ctx:g}),e.$set(k);const S={};y&4101&&(S.$$scope={dirty:y,ctx:g}),r.$set(S),g[4]&&g[1]?s?(s.p(g,y),y&18&&ne(s,1)):(s=O0(g),s.c(),ne(s,1),s.m(u.parentNode,u)):s&&(ui(),he(s,1,1,()=>{s=null}),hi())},i(g){d||(ne(e.$$.fragment,g),ne(r.$$.fragment,g),ne(s),d=!0)},o(g){he(e.$$.fragment,g),he(r.$$.fragment,g),he(s),d=!1},d(g){g&&(X(t),X(l),X(u)),$e(e,g),$e(r,g),s&&s.d(g)}}}function bT(o,e,t){let r,l;bt(o,oh,P=>t(9,r=P)),bt(o,Ln,P=>t(4,l=P));let u=!1,d=!1,s=!0,g=!0;async function y(){if(l){let P=l.importCoreNetwork(),R=P==1?"route segment":"route segments";await sh(),oi(oh,r+=1,r),window.alert(`Imported ${P} ${R}`)}}function k(){u=this.checked,t(0,u)}function S(){s=this.checked,t(2,s)}function L(){g=this.checked,t(3,g)}return o.$$.update=()=>{o.$$.dirty&1&&u&&t(1,d=!0)},[u,d,s,g,l,y,k,S,L]}class vT extends Wt{constructor(e){super(),Gt(this,e,bT,yT,Vt,{})}}function wT(o){let e,t;const r=[ji("debug-reachability-"+o[0]),{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&1?vn(r,[ow(ji("debug-reachability-"+u[0])),r[1]]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function xT(o){let e,t;return e=new xn({props:{data:o[1],generateId:!0,$$slots:{default:[wT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,[l]){const u={};l&2&&(u.data=r[1]),l&33&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function kT(o,e,t){let r;bt(o,Ln,g=>t(3,r=g));let{kind:l}=e,{hovered:u}=e,d={type:"FeatureCollection",features:[]};async function s(g){r&&g?g.properties.reachable?t(1,d=await r.debugReachablePath(l,g.properties.idx)):t(1,d=await r.debugUnreachablePath(l,g.properties.idx)):t(1,d={type:"FeatureCollection",features:[]})}return o.$$set=g=>{"kind"in g&&t(0,l=g.kind),"hovered"in g&&t(2,u=g.hovered)},o.$$.update=()=>{o.$$.dirty&4&&s(u)},[l,d,u]}class nm extends Wt{constructor(e){super(),Gt(this,e,kT,xT,Vt,{kind:0,hovered:2})}}function N0(o){let e,t,r,l=o[3].toLocaleString()+"",u,d,s=o[0].features.length.toLocaleString()+"",g,y,k=Wn(o[3],o[0].features.length)+"",S,L,P,R,Z,U,H;return R=new nl({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),r=ee("p"),u=be(l),d=be(" / "),g=be(s),y=be(" ("),S=be(k),L=be(") reachable"),P=we(),Ve(R.$$.fragment),Pe(e,"class","outline")},m(G,K){J(G,e,K),J(G,t,K),J(G,r,K),F(r,u),F(r,d),F(r,g),F(r,y),F(r,S),F(r,L),J(G,P,K),je(R,G,K),Z=!0,U||(H=ft(e,"click",o[4]),U=!0)},p(G,K){(!Z||K&8)&&l!==(l=G[3].toLocaleString()+"")&&pt(u,l),(!Z||K&1)&&s!==(s=G[0].features.length.toLocaleString()+"")&&pt(g,s),(!Z||K&9)&&k!==(k=Wn(G[3],G[0].features.length)+"")&&pt(S,k)},i(G){Z||(ne(R.$$.fragment,G),Z=!0)},o(G){he(R.$$.fragment,G),Z=!1},d(G){G&&(X(e),X(t),X(r),X(P)),$e(R,G),U=!1,H()}}}function ST(o){let e,t,r,l,u,d,s,g,y=o[1]&&N0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Schools`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[5]),s=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?y?(y.p(k,S),S&2&&ne(y,1)):(y=N0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function TT(o){let e=o[8].name+"",t,r,l=o[8].kind+"",u,d,s=o[8].pupils+"",g,y,k=o[8].reachable?"is":"is not",S,L;return{c(){t=be(e),r=be(" is a "),u=be(l),d=be(" school with "),g=be(s),y=be(" pupils. It "),S=be(k),L=be(" reachable.")},m(P,R){J(P,t,R),J(P,r,R),J(P,u,R),J(P,d,R),J(P,g,R),J(P,y,R),J(P,S,R),J(P,L,R)},p(P,R){R&256&&e!==(e=P[8].name+"")&&pt(t,e),R&256&&l!==(l=P[8].kind+"")&&pt(u,l),R&256&&s!==(s=P[8].pupils+"")&&pt(g,s),R&256&&k!==(k=P[8].reachable?"is":"is not")&&pt(S,k)},d(P){P&&(X(t),X(r),X(u),X(d),X(g),X(y),X(S),X(L))}}}function IT(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[TT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function CT(o){let e,t,r;const l=[ji("schools"),{manageHoverState:!0},{paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":$n(5,8)}},{layout:{visibility:o[1]?"visible":"none"}}];function u(s){o[6](s)}let d={$$slots:{default:[IT]},$$scope:{ctx:o}};for(let s=0;s<l.length;s+=1)d=Ni(d,l[s]);return o[2]!==void 0&&(d.hovered=o[2]),e=new Yp({props:d}),Ai.push(()=>Xn(e,"hovered",u)),{c(){Ve(e.$$.fragment)},m(s,g){je(e,s,g),r=!0},p(s,g){const y=g&2?vn(l,[l[0],l[1],l[2],{layout:{visibility:s[1]?"visible":"none"}}]):{};g&512&&(y.$$scope={dirty:g,ctx:s}),!t&&g&4&&(t=!0,y.hovered=s[2],Hn(()=>t=!1)),e.$set(y)},i(s){r||(ne(e.$$.fragment,s),r=!0)},o(s){he(e.$$.fragment,s),r=!1},d(s){$e(e,s)}}}function ET(o){let e,t,r,l,u,d;return e=new no({props:{name:"schools",$$slots:{default:[ST]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[0],generateId:!0,$$slots:{default:[CT]},$$scope:{ctx:o}}}),u=new nm({props:{kind:"schools",hovered:o[2]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment),l=we(),Ve(u.$$.fragment)},m(s,g){je(e,s,g),J(s,t,g),je(r,s,g),J(s,l,g),je(u,s,g),d=!0},p(s,[g]){const y={};g&523&&(y.$$scope={dirty:g,ctx:s}),e.$set(y);const k={};g&1&&(k.data=s[0]),g&518&&(k.$$scope={dirty:g,ctx:s}),r.$set(k);const S={};g&4&&(S.hovered=s[2]),u.$set(S)},i(s){d||(ne(e.$$.fragment,s),ne(r.$$.fragment,s),ne(u.$$.fragment,s),d=!0)},o(s){he(e.$$.fragment,s),he(r.$$.fragment,s),he(u.$$.fragment,s),d=!1},d(s){s&&(X(t),X(l)),$e(e,s),$e(r,s),$e(u,s)}}}function LT(o,e,t){let r,l,u;bt(o,Dd,S=>t(1,l=S)),bt(o,Ln,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},s;async function g(){u&&t(0,d=await u.getSchools())}function y(){l=this.checked,Dd.set(l)}function k(S){s=S,t(2,s)}return o.$$.update=()=>{o.$$.dirty&3&&l&&d.features.length==0&&g(),o.$$.dirty&1&&t(3,r=d.features.filter(S=>S.properties.reachable).length)},[d,l,s,r,g,y,k]}class MT extends Wt{constructor(e){super(),Gt(this,e,LT,ET,Vt,{})}}function j0(o){let e,t,r,l=o[3].toLocaleString()+"",u,d,s=o[0].features.length.toLocaleString()+"",g,y,k=Wn(o[3],o[0].features.length)+"",S,L,P,R,Z,U,H;return R=new nl({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),r=ee("p"),u=be(l),d=be(" / "),g=be(s),y=be(" ("),S=be(k),L=be(") reachable"),P=we(),Ve(R.$$.fragment),Pe(e,"class","outline")},m(G,K){J(G,e,K),J(G,t,K),J(G,r,K),F(r,u),F(r,d),F(r,g),F(r,y),F(r,S),F(r,L),J(G,P,K),je(R,G,K),Z=!0,U||(H=ft(e,"click",o[4]),U=!0)},p(G,K){(!Z||K&8)&&l!==(l=G[3].toLocaleString()+"")&&pt(u,l),(!Z||K&1)&&s!==(s=G[0].features.length.toLocaleString()+"")&&pt(g,s),(!Z||K&9)&&k!==(k=Wn(G[3],G[0].features.length)+"")&&pt(S,k)},i(G){Z||(ne(R.$$.fragment,G),Z=!0)},o(G){he(R.$$.fragment,G),Z=!1},d(G){G&&(X(e),X(t),X(r),X(P)),$e(R,G),U=!1,H()}}}function AT(o){let e,t,r,l,u,d,s,g,y=o[1]&&j0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Town centres`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[5]),s=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?y?(y.p(k,S),S&2&&ne(y,1)):(y=j0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function PT(o){let e,t=(o[8].name||"")+"",r,l,u=o[8].reachable?"is":"is not",d,s;return{c(){e=be("Town centre "),r=be(t),l=we(),d=be(u),s=be(" reachable.")},m(g,y){J(g,e,y),J(g,r,y),J(g,l,y),J(g,d,y),J(g,s,y)},p(g,y){y&256&&t!==(t=(g[8].name||"")+"")&&pt(r,t),y&256&&u!==(u=g[8].reachable?"is":"is not")&&pt(d,u)},d(g){g&&(X(e),X(r),X(l),X(d),X(s))}}}function zT(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[PT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function DT(o){let e,t,r;const l=[ji("town-centres"),{manageHoverState:!0},{paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":$n(.7,.9)}},{layout:{visibility:o[1]?"visible":"none"}}];function u(s){o[6](s)}let d={$$slots:{default:[zT]},$$scope:{ctx:o}};for(let s=0;s<l.length;s+=1)d=Ni(d,l[s]);return o[2]!==void 0&&(d.hovered=o[2]),e=new wc({props:d}),Ai.push(()=>Xn(e,"hovered",u)),{c(){Ve(e.$$.fragment)},m(s,g){je(e,s,g),r=!0},p(s,g){const y=g&2?vn(l,[l[0],l[1],l[2],{layout:{visibility:s[1]?"visible":"none"}}]):{};g&512&&(y.$$scope={dirty:g,ctx:s}),!t&&g&4&&(t=!0,y.hovered=s[2],Hn(()=>t=!1)),e.$set(y)},i(s){r||(ne(e.$$.fragment,s),r=!0)},o(s){he(e.$$.fragment,s),r=!1},d(s){$e(e,s)}}}function RT(o){let e,t,r,l,u,d;return e=new no({props:{name:"town centres",$$slots:{default:[AT]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[0],generateId:!0,$$slots:{default:[DT]},$$scope:{ctx:o}}}),u=new nm({props:{kind:"town_centres",hovered:o[2]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment),l=we(),Ve(u.$$.fragment)},m(s,g){je(e,s,g),J(s,t,g),je(r,s,g),J(s,l,g),je(u,s,g),d=!0},p(s,[g]){const y={};g&523&&(y.$$scope={dirty:g,ctx:s}),e.$set(y);const k={};g&1&&(k.data=s[0]),g&518&&(k.$$scope={dirty:g,ctx:s}),r.$set(k);const S={};g&4&&(S.hovered=s[2]),u.$set(S)},i(s){d||(ne(e.$$.fragment,s),ne(r.$$.fragment,s),ne(u.$$.fragment,s),d=!0)},o(s){he(e.$$.fragment,s),he(r.$$.fragment,s),he(u.$$.fragment,s),d=!1},d(s){s&&(X(t),X(l)),$e(e,s),$e(r,s),$e(u,s)}}}function FT(o,e,t){let r,l,u;bt(o,Fd,S=>t(1,l=S)),bt(o,Ln,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},s;async function g(){u&&t(0,d=await u.getTownCentres())}function y(){l=this.checked,Fd.set(l)}function k(S){s=S,t(2,s)}return o.$$.update=()=>{o.$$.dirty&3&&l&&d.features.length==0&&g(),o.$$.dirty&1&&t(3,r=d.features.filter(S=>S.properties.reachable).length)},[d,l,s,r,g,y,k]}class BT extends Wt{constructor(e){super(),Gt(this,e,FT,RT,Vt,{})}}function $0(o){let e,t,r,l=o[3].toLocaleString()+"",u,d,s=o[0].features.length.toLocaleString()+"",g,y,k=Wn(o[3],o[0].features.length)+"",S,L,P,R,Z,U,H;return R=new nl({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),r=ee("p"),u=be(l),d=be(" / "),g=be(s),y=be(" ("),S=be(k),L=be(") reachable"),P=we(),Ve(R.$$.fragment),Pe(e,"class","outline")},m(G,K){J(G,e,K),J(G,t,K),J(G,r,K),F(r,u),F(r,d),F(r,g),F(r,y),F(r,S),F(r,L),J(G,P,K),je(R,G,K),Z=!0,U||(H=ft(e,"click",o[4]),U=!0)},p(G,K){(!Z||K&8)&&l!==(l=G[3].toLocaleString()+"")&&pt(u,l),(!Z||K&1)&&s!==(s=G[0].features.length.toLocaleString()+"")&&pt(g,s),(!Z||K&9)&&k!==(k=Wn(G[3],G[0].features.length)+"")&&pt(S,k)},i(G){Z||(ne(R.$$.fragment,G),Z=!0)},o(G){he(R.$$.fragment,G),Z=!1},d(G){G&&(X(e),X(t),X(r),X(P)),$e(R,G),U=!1,H()}}}function OT(o){let e,t,r,l,u,d,s,g,y=o[1]&&$0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    GPs and hospitals`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[5]),s=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?y?(y.p(k,S),S&2&&ne(y,1)):(y=$0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function NT(o){let e=o[8].name+"",t,r,l=o[8].kind+"",u,d,s=o[8].reachable?"is":"is not",g,y;return{c(){t=be(e),r=be(" is a "),u=be(l),d=be(". It "),g=be(s),y=be(" reachable.")},m(k,S){J(k,t,S),J(k,r,S),J(k,u,S),J(k,d,S),J(k,g,S),J(k,y,S)},p(k,S){S&256&&e!==(e=k[8].name+"")&&pt(t,e),S&256&&l!==(l=k[8].kind+"")&&pt(u,l),S&256&&s!==(s=k[8].reachable?"is":"is not")&&pt(g,s)},d(k){k&&(X(t),X(r),X(u),X(d),X(g),X(y))}}}function jT(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[NT,({props:r})=>({8:r}),({props:r})=>r?256:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function $T(o){let e,t,r;const l=[ji("gp-hospitals"),{manageHoverState:!0},{paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":$n(5,8)}},{layout:{visibility:o[1]?"visible":"none"}}];function u(s){o[6](s)}let d={$$slots:{default:[jT]},$$scope:{ctx:o}};for(let s=0;s<l.length;s+=1)d=Ni(d,l[s]);return o[2]!==void 0&&(d.hovered=o[2]),e=new Yp({props:d}),Ai.push(()=>Xn(e,"hovered",u)),{c(){Ve(e.$$.fragment)},m(s,g){je(e,s,g),r=!0},p(s,g){const y=g&2?vn(l,[l[0],l[1],l[2],{layout:{visibility:s[1]?"visible":"none"}}]):{};g&512&&(y.$$scope={dirty:g,ctx:s}),!t&&g&4&&(t=!0,y.hovered=s[2],Hn(()=>t=!1)),e.$set(y)},i(s){r||(ne(e.$$.fragment,s),r=!0)},o(s){he(e.$$.fragment,s),r=!1},d(s){$e(e,s)}}}function UT(o){let e,t,r,l,u,d;return e=new no({props:{name:"gp hospitals",$$slots:{default:[OT]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[0],generateId:!0,$$slots:{default:[$T]},$$scope:{ctx:o}}}),u=new nm({props:{kind:"gp_hospitals",hovered:o[2]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment),l=we(),Ve(u.$$.fragment)},m(s,g){je(e,s,g),J(s,t,g),je(r,s,g),J(s,l,g),je(u,s,g),d=!0},p(s,[g]){const y={};g&523&&(y.$$scope={dirty:g,ctx:s}),e.$set(y);const k={};g&1&&(k.data=s[0]),g&518&&(k.$$scope={dirty:g,ctx:s}),r.$set(k);const S={};g&4&&(S.hovered=s[2]),u.$set(S)},i(s){d||(ne(e.$$.fragment,s),ne(r.$$.fragment,s),ne(u.$$.fragment,s),d=!0)},o(s){he(e.$$.fragment,s),he(r.$$.fragment,s),he(u.$$.fragment,s),d=!1},d(s){s&&(X(t),X(l)),$e(e,s),$e(r,s),$e(u,s)}}}function VT(o,e,t){let r,l,u;bt(o,Rd,S=>t(1,l=S)),bt(o,Ln,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},s;async function g(){u&&t(0,d=await u.getGpHospitals())}function y(){l=this.checked,Rd.set(l)}function k(S){s=S,t(2,s)}return o.$$.update=()=>{o.$$.dirty&3&&l&&d.features.length==0&&g(),o.$$.dirty&1&&t(3,r=d.features.filter(S=>S.properties.reachable).length)},[d,l,s,r,g,y,k]}class qT extends Wt{constructor(e){super(),Gt(this,e,VT,UT,Vt,{})}}function ZT(o){let e,t,r,l,u;return{c(){e=ee("label"),t=ee("input"),r=be(`
    Urban areas`),Pe(t,"type","checkbox")},m(d,s){J(d,e,s),F(e,t),t.checked=o[0],F(e,r),l||(u=ft(t,"change",o[1]),l=!0)},p(d,s){s&1&&(t.checked=d[0])},d(d){d&&X(e),l=!1,u()}}}function GT(o){let e,t;const r=[ji("urban-areas"),{sourceLayer:"urban_areas"},{manageHoverState:!0},{paint:{"fill-color":"black","fill-opacity":$n(1,.5)}},{layout:{visibility:o[0]?"visible":"none"}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new wc({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&1?vn(r,[r[0],r[1],r[2],r[3],{layout:{visibility:u[0]?"visible":"none"}}]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function WT(o){let e,t,r,l;return e=new no({props:{name:"urban areas",$$slots:{default:[ZT]},$$scope:{ctx:o}}}),r=new uh({props:{url:`pmtiles://${kc("urban_areas.pmtiles")}`,$$slots:{default:[GT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(r,u,d),l=!0},p(u,[d]){const s={};d&5&&(s.$$scope={dirty:d,ctx:u}),e.$set(s);const g={};d&5&&(g.$$scope={dirty:d,ctx:u}),r.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(r.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(r.$$.fragment,u),l=!1},d(u){u&&X(t),$e(e,u),$e(r,u)}}}function HT(o,e,t){let r=!1;function l(){r=this.checked,t(0,r)}return[r,l]}class XT extends Wt{constructor(e){super(),Gt(this,e,HT,WT,Vt,{})}}function U0(o){let e,t,r,l,u,d;return r=new nl({props:{colors:o[3]}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),Ve(r.$$.fragment),Pe(e,"class","outline")},m(s,g){J(s,e,g),J(s,t,g),je(r,s,g),l=!0,u||(d=ft(e,"click",o[2]),u=!0)},p:We,i(s){l||(ne(r.$$.fragment,s),l=!0)},o(s){he(r.$$.fragment,s),l=!1},d(s){s&&(X(e),X(t)),$e(r,s),u=!1,d()}}}function KT(o){let e,t,r,l,u,d,s,g,y=o[0]&&U0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Reachable network`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[0],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[4]),s=!0)},p(k,S){S&1&&(t.checked=k[0]),k[0]?y?(y.p(k,S),S&1&&ne(y,1)):(y=U0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function JT(o){let e,t;const r=[ji("reachability"),{layout:{visibility:o[0]?"visible":"none"}},{paint:{"line-width":$n(5,7),"line-color":Is(["get","kind"],o[3],"black"),"line-opacity":.8}},{manageHoverState:!0}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&9?vn(r,[r[0],d&1&&{layout:{visibility:u[0]?"visible":"none"}},d&8&&{paint:{"line-width":$n(5,7),"line-color":Is(["get","kind"],u[3],"black"),"line-opacity":.8}},r[3]]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function YT(o){let e,t,r,l;return e=new no({props:{name:"reachable network",$$slots:{default:[KT]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[1],generateId:!0,$$slots:{default:[JT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(r,u,d),l=!0},p(u,[d]){const s={};d&65&&(s.$$scope={dirty:d,ctx:u}),e.$set(s);const g={};d&2&&(g.data=u[1]),d&65&&(g.$$scope={dirty:d,ctx:u}),r.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(r.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(r.$$.fragment,u),l=!1},d(u){u&&X(t),$e(e,u),$e(r,u)}}}function QT(o,e,t){let r;bt(o,Ln,y=>t(5,r=y));let l=!1,u={type:"FeatureCollection",features:[]};async function d(){t(1,u=await r.renderReachableNetwork())}let s={network:"green",reachable:"purple",severance:"red"};function g(){l=this.checked,t(0,l)}return o.$$.update=()=>{o.$$.dirty&3&&l&&u.features.length==0&&d()},[l,u,d,s,g]}class eI extends Wt{constructor(e){super(),Gt(this,e,QT,YT,Vt,{})}}function V0(o){let e,t,r,l,u,d;return r=new nl({props:{colors:tm}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),Ve(r.$$.fragment),Pe(e,"class","outline")},m(s,g){J(s,e,g),J(s,t,g),je(r,s,g),l=!0,u||(d=ft(e,"click",o[2]),u=!0)},p:We,i(s){l||(ne(r.$$.fragment,s),l=!0)},o(s){he(r.$$.fragment,s),l=!1},d(s){s&&(X(e),X(t)),$e(r,s),u=!1,d()}}}function tI(o){let e,t,r,l,u,d,s,g,y=o[1]&&V0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Level of Service`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[3]),s=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?y?(y.p(k,S),S&2&&ne(y,1)):(y=V0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function iI(o){let e,t,r,l,u,d=o[5].los+"",s,g,y,k,S,L,P=pc[o[5].infra_type][0]+"",R,Z,U,H,G,K,le=o[5].speed+"",Se,Le,te,Y,ue,fe,ce=o[5].traffic.toLocaleString()+"",ae;return{c(){e=ee("table"),t=ee("tr"),r=ee("th"),r.textContent="Level of Service",l=we(),u=ee("td"),s=be(d),g=we(),y=ee("tr"),k=ee("th"),k.textContent="Infrastructure type",S=we(),L=ee("td"),R=be(P),Z=we(),U=ee("tr"),H=ee("th"),H.textContent="Speed (mph)",G=we(),K=ee("td"),Se=be(le),Le=we(),te=ee("tr"),Y=ee("th"),Y.textContent="Estimated daily traffic volume",ue=we(),fe=ee("td"),ae=be(ce)},m(Ge,Ee){J(Ge,e,Ee),F(e,t),F(t,r),F(t,l),F(t,u),F(u,s),F(e,g),F(e,y),F(y,k),F(y,S),F(y,L),F(L,R),F(e,Z),F(e,U),F(U,H),F(U,G),F(U,K),F(K,Se),F(e,Le),F(e,te),F(te,Y),F(te,ue),F(te,fe),F(fe,ae)},p(Ge,Ee){Ee&32&&d!==(d=Ge[5].los+"")&&pt(s,d),Ee&32&&P!==(P=pc[Ge[5].infra_type][0]+"")&&pt(R,P),Ee&32&&le!==(le=Ge[5].speed+"")&&pt(Se,le),Ee&32&&ce!==(ce=Ge[5].traffic.toLocaleString()+"")&&pt(ae,ce)},d(Ge){Ge&&X(e)}}}function nI(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[iI,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function rI(o){let e,t;const r=[ji("los"),{layout:{visibility:o[1]?"visible":"none"}},{paint:{"line-width":$n(5,7),"line-color":Op,"line-opacity":.8}},{manageHoverState:!0}];let l={$$slots:{default:[nI]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&2?vn(r,[r[0],{layout:{visibility:u[1]?"visible":"none"}},r[2],r[3]]):{};d&64&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function oI(o){let e,t,r,l;return e=new no({props:{name:"level of service",$$slots:{default:[tI]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[0],generateId:!0,$$slots:{default:[rI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(r,u,d),l=!0},p(u,[d]){const s={};d&66&&(s.$$scope={dirty:d,ctx:u}),e.$set(s);const g={};d&1&&(g.data=u[0]),d&66&&(g.$$scope={dirty:d,ctx:u}),r.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(r.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(r.$$.fragment,u),l=!1},d(u){u&&X(t),$e(e,u),$e(r,u)}}}function sI(o,e,t){let r;bt(o,Ln,g=>t(4,r=g));let l={type:"FeatureCollection",features:[]},u=!1;async function d(){r&&t(0,l=await r.renderLevelOfService())}function s(){u=this.checked,t(1,u)}return o.$$.update=()=>{o.$$.dirty&3&&u&&l.features.length==0&&d()},[l,u,d,s]}class aI extends Wt{constructor(e){super(),Gt(this,e,sI,oI,Vt,{})}}function q0(o){let e,t,r,l,u,d,s,g,y,k,S,L;return e=new Qp({props:{colorScale:o[5],limits:o[6]}}),{c(){Ve(e.$$.fragment),t=we(),r=ee("label"),l=ee("input"),u=be(`
      Show actual data`),d=we(),s=ee("label"),g=ee("input"),y=be(`
      Show map-matched data`),Pe(l,"type","checkbox"),Pe(g,"type","checkbox")},m(P,R){je(e,P,R),J(P,t,R),J(P,r,R),F(r,l),l.checked=o[2],F(r,u),J(P,d,R),J(P,s,R),F(s,g),g.checked=o[3],F(s,y),k=!0,S||(L=[ft(l,"change",o[8]),ft(g,"change",o[9])],S=!0)},p(P,R){R&4&&(l.checked=P[2]),R&8&&(g.checked=P[3])},i(P){k||(ne(e.$$.fragment,P),k=!0)},o(P){he(e.$$.fragment,P),k=!1},d(P){P&&(X(t),X(r),X(d),X(s)),$e(e,P),S=!1,cn(L)}}}function lI(o){let e,t,r,l,u,d,s,g,y=o[0]&&q0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Estimated traffic volume`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[0],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[7]),s=!0)},p(k,S){S&1&&(t.checked=k[0]),k[0]?y?(y.p(k,S),S&1&&ne(y,1)):(y=q0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function cI(o){let e,t;const r=[ji("traffic-debug"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Is(["get","Traffic volume category"],{"0 to 1999":"#27918d","2000 to 3999":"#ffaa33","4000+":"#440154"},"cyan"),"line-width":5}},{layout:{visibility:o[0]&&o[2]?"visible":"none"}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&5?vn(r,[r[0],r[1],r[2],r[3],{layout:{visibility:u[0]&&u[2]?"visible":"none"}}]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function Z0(o){let e,t,r,l={ctx:o,current:null,token:null,hasCatch:!1,pending:mI,then:hI,catch:uI,value:10,blocks:[,,,]};return Dr(t=o[4].renderLevelOfService(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,r=!0},p(u,d){o=u,l.ctx=o,d&16&&t!==(t=o[4].renderLevelOfService())&&Dr(t,l)||ba(l,o,d)},i(u){r||(ne(l.block),r=!0)},o(u){for(let d=0;d<3;d+=1){const s=l.blocks[d];he(s)}r=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function uI(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function hI(o){let e,t;return e=new xn({props:{data:o[10],generateId:!0,$$slots:{default:[pI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&16&&(u.data=r[10]),l&4105&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function dI(o){let e,t=o[11].traffic.toLocaleString()+"",r;return{c(){e=ee("p"),r=be(t)},m(l,u){J(l,e,u),F(e,r)},p(l,u){u&2048&&t!==(t=l[11].traffic.toLocaleString()+"")&&pt(r,t)},d(l){l&&X(e)}}}function fI(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[dI,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function pI(o){let e,t;const r=[ji("traffic"),{layout:{visibility:o[0]&&o[3]?"visible":"none"}},{paint:{"line-width":ha(["get","traffic"],o[6],[1,2,3]),"line-color":ha(["get","traffic"],o[6],o[5]),"line-opacity":.8}},{manageHoverState:!0}];let l={$$slots:{default:[fI]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&105?vn(r,[r[0],d&9&&{layout:{visibility:u[0]&&u[3]?"visible":"none"}},d&96&&{paint:{"line-width":ha(["get","traffic"],u[6],[1,2,3]),"line-color":ha(["get","traffic"],u[6],u[5]),"line-opacity":.8}},r[3]]):{};d&4096&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function mI(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function _I(o){let e,t,r,l,u,d;e=new no({props:{name:"traffic volume",$$slots:{default:[lI]},$$scope:{ctx:o}}}),r=new uh({props:{url:`pmtiles://${kc("cbd.pmtiles")}`,$$slots:{default:[cI]},$$scope:{ctx:o}}});let s=o[4]&&o[1]&&Z0(o);return{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment),l=we(),s&&s.c(),u=Ei()},m(g,y){je(e,g,y),J(g,t,y),je(r,g,y),J(g,l,y),s&&s.m(g,y),J(g,u,y),d=!0},p(g,[y]){const k={};y&4109&&(k.$$scope={dirty:y,ctx:g}),e.$set(k);const S={};y&4101&&(S.$$scope={dirty:y,ctx:g}),r.$set(S),g[4]&&g[1]?s?(s.p(g,y),y&18&&ne(s,1)):(s=Z0(g),s.c(),ne(s,1),s.m(u.parentNode,u)):s&&(ui(),he(s,1,1,()=>{s=null}),hi())},i(g){d||(ne(e.$$.fragment,g),ne(r.$$.fragment,g),ne(s),d=!0)},o(g){he(e.$$.fragment,g),he(r.$$.fragment,g),he(s),d=!1},d(g){g&&(X(t),X(l),X(u)),$e(e,g),$e(r,g),s&&s.d(g)}}}function gI(o,e,t){let r;bt(o,Ln,P=>t(4,r=P));let l=!1,u=!1,d=["#27918d","#ffaa33","#440154"],s=[0,2e3,4e3,1e4],g=!0,y=!0;function k(){l=this.checked,t(0,l)}function S(){g=this.checked,t(2,g)}function L(){y=this.checked,t(3,y)}return o.$$.update=()=>{o.$$.dirty&1&&l&&t(1,u=!0)},[l,u,g,y,r,d,s,k,S,L]}class yI extends Wt{constructor(e){super(),Gt(this,e,gI,_I,Vt,{})}}function bI(o){let e,t,r,l,u;return{c(){e=ee("label"),t=ee("input"),r=be(`
    Gradient`),Pe(t,"type","checkbox")},m(d,s){J(d,e,s),F(e,t),t.checked=o[0],F(e,r),l||(u=ft(t,"change",o[3]),l=!0)},p(d,s){s&1&&(t.checked=d[0])},d(d){d&&X(e),l=!1,u()}}}function G0(o){let e,t,r,l={ctx:o,current:null,token:null,hasCatch:!1,pending:TI,then:wI,catch:vI,value:4,blocks:[,,,]};return Dr(t=o[2].renderLevelOfService(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,r=!0},p(u,d){o=u,l.ctx=o,d&4&&t!==(t=o[2].renderLevelOfService())&&Dr(t,l)||ba(l,o,d)},i(u){r||(ne(l.block),r=!0)},o(u){for(let d=0;d<3;d+=1){const s=l.blocks[d];he(s)}r=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function vI(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function wI(o){let e,t;return e=new xn({props:{data:o[4],generateId:!0,$$slots:{default:[SI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&4&&(u.data=r[4]),l&65&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function xI(o){let e,t=o[5].gradient.toFixed(1)+"",r,l;return{c(){e=ee("p"),r=be(t),l=be("%")},m(u,d){J(u,e,d),F(e,r),F(e,l)},p(u,d){d&32&&t!==(t=u[5].gradient.toFixed(1)+"")&&pt(r,t)},d(u){u&&X(e)}}}function kI(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[xI,({props:r})=>({5:r}),({props:r})=>r?32:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function SI(o){let e,t;const r=[ji("gradients"),{layout:{visibility:o[0]?"visible":"none"}},{paint:{"line-width":$n(3,5),"line-color":Q1()}},{manageHoverState:!0}];let l={$$slots:{default:[kI]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&1?vn(r,[r[0],{layout:{visibility:u[0]?"visible":"none"}},r[2],r[3]]):{};d&64&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function TI(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function II(o){let e,t,r,l;e=new no({props:{name:"gradient",$$slots:{default:[bI]},$$scope:{ctx:o}}});let u=o[2]&&o[1]&&G0(o);return{c(){Ve(e.$$.fragment),t=we(),u&&u.c(),r=Ei()},m(d,s){je(e,d,s),J(d,t,s),u&&u.m(d,s),J(d,r,s),l=!0},p(d,[s]){const g={};s&65&&(g.$$scope={dirty:s,ctx:d}),e.$set(g),d[2]&&d[1]?u?(u.p(d,s),s&6&&ne(u,1)):(u=G0(d),u.c(),ne(u,1),u.m(r.parentNode,r)):u&&(ui(),he(u,1,1,()=>{u=null}),hi())},i(d){l||(ne(e.$$.fragment,d),ne(u),l=!0)},o(d){he(e.$$.fragment,d),he(u),l=!1},d(d){d&&(X(t),X(r)),$e(e,d),u&&u.d(d)}}}function CI(o,e,t){let r;bt(o,Ln,s=>t(2,r=s));let l=!1,u=!1;function d(){l=this.checked,t(0,l)}return o.$$.update=()=>{o.$$.dirty&1&&l&&t(1,u=!0)},[l,u,r,d]}class EI extends Wt{constructor(e){super(),Gt(this,e,CI,II,Vt,{})}}function W0(o){let e,t,r,l,u,d=o[3].toLocaleString()+"",s,g,y=o[0].features.length.toLocaleString()+"",k,S,L=o[2].toLocaleString()+"",P,R,Z=o[4].toLocaleString()+"",U,H,G=Wn(o[2],o[4])+"",K,le,Se,Le,te,Y,ue,fe,ce;return Le=new Qp({props:{colorScale:o[6],limits:o[7]}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),r=ee("p"),r.textContent="Only the top 20%ile most deprived zones are shown",l=we(),u=ee("p"),s=be(d),g=be(" / "),k=be(y),S=be(` zones
      reachable. That's `),P=be(L),R=be(" / "),U=be(Z),H=be(`
      (`),K=be(G),le=be(") of the population."),Se=we(),Ve(Le.$$.fragment),te=we(),Y=ee("p"),Y.textContent=`Darker colours are more deprived. Zones with a red outline are not
      reachable by the current network.`,Pe(e,"class","outline")},m(ae,Ge){J(ae,e,Ge),J(ae,t,Ge),J(ae,r,Ge),J(ae,l,Ge),J(ae,u,Ge),F(u,s),F(u,g),F(u,k),F(u,S),F(u,P),F(u,R),F(u,U),F(u,H),F(u,K),F(u,le),J(ae,Se,Ge),je(Le,ae,Ge),J(ae,te,Ge),J(ae,Y,Ge),ue=!0,fe||(ce=ft(e,"click",o[5]),fe=!0)},p(ae,Ge){(!ue||Ge&8)&&d!==(d=ae[3].toLocaleString()+"")&&pt(s,d),(!ue||Ge&1)&&y!==(y=ae[0].features.length.toLocaleString()+"")&&pt(k,y),(!ue||Ge&4)&&L!==(L=ae[2].toLocaleString()+"")&&pt(P,L),(!ue||Ge&16)&&Z!==(Z=ae[4].toLocaleString()+"")&&pt(U,Z),(!ue||Ge&20)&&G!==(G=Wn(ae[2],ae[4])+"")&&pt(K,G)},i(ae){ue||(ne(Le.$$.fragment,ae),ue=!0)},o(ae){he(Le.$$.fragment,ae),ue=!1},d(ae){ae&&(X(e),X(t),X(r),X(l),X(u),X(Se),X(te),X(Y)),$e(Le,ae),fe=!1,ce()}}}function LI(o){let e,t,r,l,u,d,s,g,y=o[1]&&W0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    SIMD`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[8]),s=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?y?(y.p(k,S),S&2&&ne(y,1)):(y=W0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function MI(o){let e,t,r=o[10].id+"",l,u,d=o[10].reachable?"is":"is not",s,g,y=o[10].population.toLocaleString()+"",k,S,L=o[10].imd_rank+"",P,R,Z=o[10].imd_percentile+"",U,H;return{c(){e=ee("p"),t=be("Data zone "),l=be(r),u=we(),s=be(d),g=be(" reachable. It has "),k=be(y),S=be(`
        people, and a SIMD rank of `),P=be(L),R=be(", putting it in the "),U=be(Z),H=be(`
        percentile.`)},m(G,K){J(G,e,K),F(e,t),F(e,l),F(e,u),F(e,s),F(e,g),F(e,k),F(e,S),F(e,P),F(e,R),F(e,U),F(e,H)},p(G,K){K&1024&&r!==(r=G[10].id+"")&&pt(l,r),K&1024&&d!==(d=G[10].reachable?"is":"is not")&&pt(s,d),K&1024&&y!==(y=G[10].population.toLocaleString()+"")&&pt(k,y),K&1024&&L!==(L=G[10].imd_rank+"")&&pt(P,L),K&1024&&Z!==(Z=G[10].imd_percentile+"")&&pt(U,Z)},d(G){G&&X(e)}}}function AI(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[MI,({props:r})=>({10:r}),({props:r})=>r?1024:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&3072&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function PI(o){let e,t,r,l;const u=[ji("simd"),{manageHoverState:!0},{paint:{"fill-color":ha(["get","imd_percentile"],o[7],o[6]),"fill-opacity":$n(.7,.9)}},{layout:{visibility:o[1]?"visible":"none"}}];let d={$$slots:{default:[AI]},$$scope:{ctx:o}};for(let y=0;y<u.length;y+=1)d=Ni(d,u[y]);e=new wc({props:d});const s=[ji("simd-outline"),{filter:["!",["get","reachable"]]},{paint:{"line-color":"red","line-width":3}},{layout:{visibility:o[1]?"visible":"none"}}];let g={};for(let y=0;y<s.length;y+=1)g=Ni(g,s[y]);return r=new kn({props:g}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(y,k){je(e,y,k),J(y,t,k),je(r,y,k),l=!0},p(y,k){const S=k&194?vn(u,[u[0],u[1],k&192&&{paint:{"fill-color":ha(["get","imd_percentile"],y[7],y[6]),"fill-opacity":$n(.7,.9)}},k&2&&{layout:{visibility:y[1]?"visible":"none"}}]):{};k&2048&&(S.$$scope={dirty:k,ctx:y}),e.$set(S);const L=k&2?vn(s,[s[0],s[1],s[2],{layout:{visibility:y[1]?"visible":"none"}}]):{};r.$set(L)},i(y){l||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),l=!0)},o(y){he(e.$$.fragment,y),he(r.$$.fragment,y),l=!1},d(y){y&&X(t),$e(e,y),$e(r,y)}}}function zI(o){let e,t,r,l;return e=new no({props:{name:"simd",$$slots:{default:[LI]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[0],generateId:!0,$$slots:{default:[PI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(r,u,d),l=!0},p(u,[d]){const s={};d&2079&&(s.$$scope={dirty:d,ctx:u}),e.$set(s);const g={};d&1&&(g.data=u[0]),d&2050&&(g.$$scope={dirty:d,ctx:u}),r.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(r.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(r.$$.fragment,u),l=!1},d(u){u&&X(t),$e(e,u),$e(r,u)}}}function DI(o,e,t){let r,l,u,d,s;bt(o,Bd,P=>t(1,d=P)),bt(o,Ln,P=>t(9,s=P));let g={type:"FeatureCollection",features:[]};async function y(){if(s){let P=await s.getDataZones();P.features=P.features.filter(R=>R.properties.imd_percentile<=20),t(0,g=P)}}let k=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],S=[0,4,8,12,16,20];function L(){d=this.checked,Bd.set(d)}return o.$$.update=()=>{o.$$.dirty&3&&d&&g.features.length==0&&y(),o.$$.dirty&1&&t(4,r=$d(g.features.map(P=>P.properties.population))),o.$$.dirty&1&&t(3,l=g.features.filter(P=>P.properties.reachable).length),o.$$.dirty&1&&t(2,u=$d(g.features.filter(P=>P.properties.reachable).map(P=>P.properties.population)))},[g,d,u,l,r,y,k,S,L]}class RI extends Wt{constructor(e){super(),Gt(this,e,DI,zI,Vt,{})}}function H0(o){let e,t,r,l=o[3].toLocaleString()+"",u,d,s=o[0].features.length.toLocaleString()+"",g,y,k=o[2].toLocaleString()+"",S,L,P=o[4].toLocaleString()+"",R,Z,U=Wn(o[2],o[4])+"",H,G,K,le,Se,Le,te,Y,ue;return le=new Qp({props:{colorScale:o[6],limits:o[7]}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),r=ee("p"),u=be(l),d=be(" / "),g=be(s),y=be(` zones
      reachable. That's `),S=be(k),L=be(" / "),R=be(P),Z=be(`
      (`),H=be(U),G=be(") of the population."),K=we(),Ve(le.$$.fragment),Se=we(),Le=ee("p"),Le.textContent=`Darker colours are denser. Zones with a red outline are not reachable by
      the current network. Only the top 3 densest quintiles are shown.`,Pe(e,"class","outline")},m(fe,ce){J(fe,e,ce),J(fe,t,ce),J(fe,r,ce),F(r,u),F(r,d),F(r,g),F(r,y),F(r,S),F(r,L),F(r,R),F(r,Z),F(r,H),F(r,G),J(fe,K,ce),je(le,fe,ce),J(fe,Se,ce),J(fe,Le,ce),te=!0,Y||(ue=ft(e,"click",o[5]),Y=!0)},p(fe,ce){(!te||ce&8)&&l!==(l=fe[3].toLocaleString()+"")&&pt(u,l),(!te||ce&1)&&s!==(s=fe[0].features.length.toLocaleString()+"")&&pt(g,s),(!te||ce&4)&&k!==(k=fe[2].toLocaleString()+"")&&pt(S,k),(!te||ce&16)&&P!==(P=fe[4].toLocaleString()+"")&&pt(R,P),(!te||ce&20)&&U!==(U=Wn(fe[2],fe[4])+"")&&pt(H,U)},i(fe){te||(ne(le.$$.fragment,fe),te=!0)},o(fe){he(le.$$.fragment,fe),te=!1},d(fe){fe&&(X(e),X(t),X(r),X(K),X(Se),X(Le)),$e(le,fe),Y=!1,ue()}}}function FI(o){let e,t,r,l,u,d,s,g,y=o[1]&&H0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    Population`),l=we(),y&&y.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,r),J(k,l,S),y&&y.m(k,S),J(k,u,S),d=!0,s||(g=ft(t,"change",o[9]),s=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?y?(y.p(k,S),S&2&&ne(y,1)):(y=H0(k),y.c(),ne(y,1),y.m(u.parentNode,u)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){d||(ne(y),d=!0)},o(k){he(y),d=!1},d(k){k&&(X(e),X(l),X(u)),y&&y.d(k),s=!1,g()}}}function BI(o){let e,t,r=o[11].id+"",l,u,d=o[11].reachable?"is":"is not",s,g,y=o[11].population.toLocaleString()+"",k,S,L=Math.round(o[11].population/o[11].area_km2).toLocaleString()+"",P,R,Z=o[11].density_quintile+"",U,H;return{c(){e=ee("p"),t=be("Data zone "),l=be(r),u=we(),s=be(d),g=be(" reachable. It has "),k=be(y),S=be(`
        people, with a density of `),P=be(L),R=be(" people per square kilometer, putting it in quintile "),U=be(Z),H=be(`
        for this study area.`),mi(e,"max-width","30vw")},m(G,K){J(G,e,K),F(e,t),F(e,l),F(e,u),F(e,s),F(e,g),F(e,k),F(e,S),F(e,P),F(e,R),F(e,U),F(e,H)},p(G,K){K&2048&&r!==(r=G[11].id+"")&&pt(l,r),K&2048&&d!==(d=G[11].reachable?"is":"is not")&&pt(s,d),K&2048&&y!==(y=G[11].population.toLocaleString()+"")&&pt(k,y),K&2048&&L!==(L=Math.round(G[11].population/G[11].area_km2).toLocaleString()+"")&&pt(P,L),K&2048&&Z!==(Z=G[11].density_quintile+"")&&pt(U,Z)},d(G){G&&X(e)}}}function OI(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[BI,({props:r})=>({11:r}),({props:r})=>r?2048:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function NI(o){let e,t,r,l;const u=[ji("all-population"),{manageHoverState:!0},{paint:{"fill-color":ha(["get","density_quintile"],o[7],o[6]),"fill-opacity":o[8]}},{layout:{visibility:o[1]?"visible":"none"}}];let d={$$slots:{default:[OI]},$$scope:{ctx:o}};for(let y=0;y<u.length;y+=1)d=Ni(d,u[y]);e=new wc({props:d});const s=[ji("all-population-outline"),{filter:["!",["get","reachable"]]},{paint:{"line-color":"red","line-width":3}},{layout:{visibility:o[1]?"visible":"none"}}];let g={};for(let y=0;y<s.length;y+=1)g=Ni(g,s[y]);return r=new kn({props:g}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(y,k){je(e,y,k),J(y,t,k),je(r,y,k),l=!0},p(y,k){const S=k&450?vn(u,[u[0],u[1],k&448&&{paint:{"fill-color":ha(["get","density_quintile"],y[7],y[6]),"fill-opacity":y[8]}},k&2&&{layout:{visibility:y[1]?"visible":"none"}}]):{};k&4096&&(S.$$scope={dirty:k,ctx:y}),e.$set(S);const L=k&2?vn(s,[s[0],s[1],s[2],{layout:{visibility:y[1]?"visible":"none"}}]):{};r.$set(L)},i(y){l||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),l=!0)},o(y){he(e.$$.fragment,y),he(r.$$.fragment,y),l=!1},d(y){y&&X(t),$e(e,y),$e(r,y)}}}function jI(o){let e,t,r,l;return e=new no({props:{name:"population density",$$slots:{default:[FI]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[0],generateId:!0,$$slots:{default:[NI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(r,u,d),l=!0},p(u,[d]){const s={};d&4127&&(s.$$scope={dirty:d,ctx:u}),e.$set(s);const g={};d&1&&(g.data=u[0]),d&4098&&(g.$$scope={dirty:d,ctx:u}),r.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(r.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(r.$$.fragment,u),l=!1},d(u){u&&X(t),$e(e,u),$e(r,u)}}}function $I(o,e,t){let r,l,u,d,s;bt(o,Od,R=>t(1,d=R)),bt(o,Ln,R=>t(10,s=R));let g={type:"FeatureCollection",features:[]};async function y(){s&&t(0,g=await s.getDataZones())}let k=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],S=[0,1,2,3,4,5],L=$n(["case",["<",["get","density_quintile"],4],.5,0],.9);function P(){d=this.checked,Od.set(d)}return o.$$.update=()=>{o.$$.dirty&3&&d&&g.features.length==0&&y(),o.$$.dirty&1&&t(4,r=$d(g.features.map(R=>R.properties.population))),o.$$.dirty&1&&t(3,l=g.features.filter(R=>R.properties.reachable).length),o.$$.dirty&1&&t(2,u=$d(g.features.filter(R=>R.properties.reachable).map(R=>R.properties.population)))},[g,d,u,l,r,y,k,S,L,P]}class UI extends Wt{constructor(e){super(),Gt(this,e,$I,jI,Vt,{})}}function X0(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le=o[0].total_quintile_sums.length>0&&K0(o);return{c(){e=ee("div"),t=ee("button"),t.textContent="Recalculate",r=we(),l=ee("label"),u=ee("input"),d=be(`
        Only show routes covered by current edits`),s=we(),g=ee("label"),y=be(`Only show quintile:
        `),k=ee("select"),S=ee("option"),S.textContent="Show all",L=ee("option"),L.textContent="1",P=ee("option"),P.textContent="2",R=ee("option"),R.textContent="3",Z=ee("option"),Z.textContent="4",U=ee("option"),U.textContent="5",H=we(),le&&le.c(),Pe(t,"class","outline"),Pe(u,"type","checkbox"),S.__value="",Zi(S,S.__value),L.__value="1",Zi(L,L.__value),P.__value="2",Zi(P,P.__value),R.__value="3",Zi(R,R.__value),Z.__value="4",Zi(Z,Z.__value),U.__value="5",Zi(U,U.__value),o[3]===void 0&&Mo(()=>o[7].call(k)),mi(e,"border","1px solid black"),mi(e,"padding","4px")},m(Se,Le){J(Se,e,Le),F(e,t),F(e,r),F(e,l),F(l,u),u.checked=o[2],F(l,d),F(e,s),F(e,g),F(g,y),F(g,k),F(k,S),F(k,L),F(k,P),F(k,R),F(k,Z),F(k,U),hr(k,o[3],!0),F(e,H),le&&le.m(e,null),G||(K=[ft(t,"click",o[4]),ft(u,"change",o[6]),ft(k,"change",o[7])],G=!0)},p(Se,Le){Le&4&&(u.checked=Se[2]),Le&8&&hr(k,Se[3]),Se[0].total_quintile_sums.length>0?le?le.p(Se,Le):(le=K0(Se),le.c(),le.m(e,null)):le&&(le.d(1),le=null)},d(Se){Se&&X(e),le&&le.d(),G=!1,cn(K)}}}function K0(o){let e,t,r,l,u,d=Wn(o[0].covered_quintile_sums[0],o[0].total_quintile_sums[0])+"",s,g,y,k,S=Wn(o[0].covered_quintile_sums[1],o[0].total_quintile_sums[1])+"",L,P,R,Z,U=Wn(o[0].covered_quintile_sums[2],o[0].total_quintile_sums[2])+"",H,G,K,le,Se=Wn(o[0].covered_quintile_sums[3],o[0].total_quintile_sums[3])+"",Le,te,Y,ue,fe=Wn(o[0].covered_quintile_sums[4],o[0].total_quintile_sums[4])+"",ce;return{c(){e=ee("p"),e.textContent="Flow covered by current edits",t=we(),r=ee("ul"),l=ee("li"),u=be("Quintile 1: "),s=be(d),g=we(),y=ee("li"),k=be("Quintile 2: "),L=be(S),P=we(),R=ee("li"),Z=be("Quintile 3: "),H=be(U),G=we(),K=ee("li"),le=be("Quintile 4: "),Le=be(Se),te=we(),Y=ee("li"),ue=be("Quintile 5: "),ce=be(fe)},m(ae,Ge){J(ae,e,Ge),J(ae,t,Ge),J(ae,r,Ge),F(r,l),F(l,u),F(l,s),F(r,g),F(r,y),F(y,k),F(y,L),F(r,P),F(r,R),F(R,Z),F(R,H),F(r,G),F(r,K),F(K,le),F(K,Le),F(r,te),F(r,Y),F(Y,ue),F(Y,ce)},p(ae,Ge){Ge&1&&d!==(d=Wn(ae[0].covered_quintile_sums[0],ae[0].total_quintile_sums[0])+"")&&pt(s,d),Ge&1&&S!==(S=Wn(ae[0].covered_quintile_sums[1],ae[0].total_quintile_sums[1])+"")&&pt(L,S),Ge&1&&U!==(U=Wn(ae[0].covered_quintile_sums[2],ae[0].total_quintile_sums[2])+"")&&pt(H,U),Ge&1&&Se!==(Se=Wn(ae[0].covered_quintile_sums[3],ae[0].total_quintile_sums[3])+"")&&pt(Le,Se),Ge&1&&fe!==(fe=Wn(ae[0].covered_quintile_sums[4],ae[0].total_quintile_sums[4])+"")&&pt(ce,fe)},d(ae){ae&&(X(e),X(t),X(r))}}}function VI(o){let e,t,r,l,u,d,s,g=o[1]&&X0(o);return{c(){e=ee("label"),t=ee("input"),r=be(`
    High NPT route coverage`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(y,k){J(y,e,k),F(e,t),t.checked=o[1],F(e,r),J(y,l,k),g&&g.m(y,k),J(y,u,k),d||(s=ft(t,"change",o[5]),d=!0)},p(y,k){k&2&&(t.checked=y[1]),y[1]?g?g.p(y,k):(g=X0(y),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(y){y&&(X(e),X(l),X(u)),g&&g.d(y),d=!1,s()}}}function qI(o){let e,t=o[9].flow.toLocaleString()+"",r,l,u=o[9].quintile+"",d,s,g=o[9].covered+"",y;return{c(){e=be("Flow "),r=be(t),l=be(" is in quintile "),d=be(u),s=be(`,
      covered `),y=be(g)},m(k,S){J(k,e,S),J(k,r,S),J(k,l,S),J(k,d,S),J(k,s,S),J(k,y,S)},p(k,S){S&512&&t!==(t=k[9].flow.toLocaleString()+"")&&pt(r,t),S&512&&u!==(u=k[9].quintile+"")&&pt(d,u),S&512&&g!==(g=k[9].covered+"")&&pt(y,g)},d(k){k&&(X(e),X(r),X(l),X(d),X(s),X(y))}}}function ZI(o){let e,t;return e=new yr({props:{openOn:"hover",$$slots:{default:[qI,({props:r})=>({9:r}),({props:r})=>r?512:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&1536&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function GI(o){let e,t;const r=[ji("npt-coverage"),{layout:{visibility:o[1]?"visible":"none"}},{filter:J0(o[2],o[3])},{paint:{"line-width":Ud("flow"),"line-color":im("flow")}}];let l={$$slots:{default:[ZI]},$$scope:{ctx:o}};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new kn({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&14?vn(r,[r[0],d&2&&{layout:{visibility:u[1]?"visible":"none"}},d&12&&{filter:J0(u[2],u[3])},r[3]]):{};d&1024&&(s.$$scope={dirty:d,ctx:u}),e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function WI(o){let e,t,r,l;return e=new no({props:{name:"high npt route coverage",$$slots:{default:[VI]},$$scope:{ctx:o}}}),r=new xn({props:{data:o[0],$$slots:{default:[GI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(r,u,d),l=!0},p(u,[d]){const s={};d&1039&&(s.$$scope={dirty:d,ctx:u}),e.$set(s);const g={};d&1&&(g.data=u[0]),d&1038&&(g.$$scope={dirty:d,ctx:u}),r.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(r.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(r.$$.fragment,u),l=!1},d(u){u&&X(t),$e(e,u),$e(r,u)}}}function J0(o,e){let t=["all"];return o&&t.push(["get","covered"]),e.length>0&&t.push(["==",["get","quintile"],parseInt(e)]),t}function HI(o,e,t){let r,l;bt(o,lc,L=>t(1,r=L)),bt(o,Ln,L=>t(8,l=L));let u=!1,d="",s={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function g(){l&&t(0,s=await l.renderPrecalculatedFlows())}function y(){r=this.checked,lc.set(r)}function k(){u=this.checked,t(2,u)}function S(){d=vs(this),t(3,d)}return o.$$.update=()=>{o.$$.dirty&3&&r&&s.features.length==0&&g()},[s,r,u,d,g,y,k,S]}class XI extends Wt{constructor(e){super(),Gt(this,e,HI,WI,Vt,{})}}function KI(o){let e,t;const r=[ji("major-junctions"),{paint:{"circle-color":"purple","circle-radius":5}},{layout:{visibility:o[1]&&o[2].kind=="edit-route"?"visible":"none"}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new Yp({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s=d&6?vn(r,[r[0],r[1],{layout:{visibility:u[1]&&u[2].kind=="edit-route"?"visible":"none"}}]):{};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function JI(o){let e,t;return e=new xn({props:{data:o[0],$$slots:{default:[KI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,[l]){const u={};l&1&&(u.data=r[0]),l&38&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function YI(o,e,t){let r,l,u;bt(o,Fp,g=>t(1,r=g)),bt(o,Ln,g=>t(3,l=g)),bt(o,ln,g=>t(2,u=g));let d={type:"FeatureCollection",features:[]};async function s(){l&&t(0,d=await l.getMajorJunctions())}return o.$$.update=()=>{o.$$.dirty&3&&r&&d.features.length==0&&s()},[d,r,u]}class QI extends Wt{constructor(e){super(),Gt(this,e,YI,JI,Vt,{})}}function eC(o){let e,t,r,l,u,d,s,g,y,k,S,L,P,R,Z,U,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,Ge,Ee;return e=new iT({}),r=new cT({}),u=new XI({}),s=new vT({}),y=new MT({}),S=new BT({}),P=new qT({}),Z=new XT({}),H=new aI({}),K=new yI({}),Se=new EI({}),te=new eI({}),ue=new RI({}),ce=new UI({}),Ge=new QI({}),{c(){Ve(e.$$.fragment),t=we(),Ve(r.$$.fragment),l=we(),Ve(u.$$.fragment),d=we(),Ve(s.$$.fragment),g=we(),Ve(y.$$.fragment),k=we(),Ve(S.$$.fragment),L=we(),Ve(P.$$.fragment),R=we(),Ve(Z.$$.fragment),U=we(),Ve(H.$$.fragment),G=we(),Ve(K.$$.fragment),le=we(),Ve(Se.$$.fragment),Le=we(),Ve(te.$$.fragment),Y=we(),Ve(ue.$$.fragment),fe=we(),Ve(ce.$$.fragment),ae=we(),Ve(Ge.$$.fragment)},m(ze,rt){je(e,ze,rt),J(ze,t,rt),je(r,ze,rt),J(ze,l,rt),je(u,ze,rt),J(ze,d,rt),je(s,ze,rt),J(ze,g,rt),je(y,ze,rt),J(ze,k,rt),je(S,ze,rt),J(ze,L,rt),je(P,ze,rt),J(ze,R,rt),je(Z,ze,rt),J(ze,U,rt),je(H,ze,rt),J(ze,G,rt),je(K,ze,rt),J(ze,le,rt),je(Se,ze,rt),J(ze,Le,rt),je(te,ze,rt),J(ze,Y,rt),je(ue,ze,rt),J(ze,fe,rt),je(ce,ze,rt),J(ze,ae,rt),je(Ge,ze,rt),Ee=!0},p:We,i(ze){Ee||(ne(e.$$.fragment,ze),ne(r.$$.fragment,ze),ne(u.$$.fragment,ze),ne(s.$$.fragment,ze),ne(y.$$.fragment,ze),ne(S.$$.fragment,ze),ne(P.$$.fragment,ze),ne(Z.$$.fragment,ze),ne(H.$$.fragment,ze),ne(K.$$.fragment,ze),ne(Se.$$.fragment,ze),ne(te.$$.fragment,ze),ne(ue.$$.fragment,ze),ne(ce.$$.fragment,ze),ne(Ge.$$.fragment,ze),Ee=!0)},o(ze){he(e.$$.fragment,ze),he(r.$$.fragment,ze),he(u.$$.fragment,ze),he(s.$$.fragment,ze),he(y.$$.fragment,ze),he(S.$$.fragment,ze),he(P.$$.fragment,ze),he(Z.$$.fragment,ze),he(H.$$.fragment,ze),he(K.$$.fragment,ze),he(Se.$$.fragment,ze),he(te.$$.fragment,ze),he(ue.$$.fragment,ze),he(ce.$$.fragment,ze),he(Ge.$$.fragment,ze),Ee=!1},d(ze){ze&&(X(t),X(l),X(d),X(g),X(k),X(L),X(R),X(U),X(G),X(le),X(Le),X(Y),X(fe),X(ae)),$e(e,ze),$e(r,ze),$e(u,ze),$e(s,ze),$e(y,ze),$e(S,ze),$e(P,ze),$e(Z,ze),$e(H,ze),$e(K,ze),$e(Se,ze),$e(te,ze),$e(ue,ze),$e(ce,ze),$e(Ge,ze)}}}class tC extends Wt{constructor(e){super(),Gt(this,e,null,eC,Vt,{})}}function iC(o){let e,t,r;return t=new j5({}),{c(){e=ee("div"),Ve(t.$$.fragment),Pe(e,"slot","top")},m(l,u){J(l,e,u),je(t,e,null),r=!0},p:We,i(l){r||(ne(t.$$.fragment,l),r=!0)},o(l){he(t.$$.fragment,l),r=!1},d(l){l&&X(e),$e(t)}}}function nC(o){let e,t;return{c(){e=ee("div"),t=ee("div"),Pe(e,"slot","left")},m(r,l){J(r,e,l),F(e,t),o[15](t)},p:We,d(r){r&&X(e),o[15](null)}}}function rC(o){let e,t;return e=new q2({props:{map:o[0],apiKey:W1,country:"gb"}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&1&&(u.map=r[0]),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function Y0(o){let e,t,r,l,u,d,s,g,y={ctx:o,current:null,token:null,hasCatch:!1,pending:lC,then:sC,catch:oC,value:21,blocks:[,,,]};Dr(e=o[5].getInvertedBoundary(),y),r=new tC({});const k=[pC,fC,dC,hC,uC,cC],S=[];function L(P,R){return P[7].kind=="main"?0:P[7].kind=="edit-route"&&P[0]?1:P[7].kind=="evaluate-route"?2:P[7].kind=="evaluate-od"?3:P[7].kind=="debug-network"?4:P[7].kind=="debug-mesh-density"?5:-1}return~(u=L(o))&&(d=S[u]=k[u](o)),{c(){y.block.c(),t=we(),Ve(r.$$.fragment),l=we(),d&&d.c(),s=Ei()},m(P,R){y.block.m(P,y.anchor=R),y.mount=()=>t.parentNode,y.anchor=t,J(P,t,R),je(r,P,R),J(P,l,R),~u&&S[u].m(P,R),J(P,s,R),g=!0},p(P,R){o=P,y.ctx=o,R&32&&e!==(e=o[5].getInvertedBoundary())&&Dr(e,y)||ba(y,o,R);let Z=u;u=L(o),u===Z?~u&&S[u].p(o,R):(d&&(ui(),he(S[Z],1,1,()=>{S[Z]=null}),hi()),~u?(d=S[u],d?d.p(o,R):(d=S[u]=k[u](o),d.c()),ne(d,1),d.m(s.parentNode,s)):d=null)},i(P){g||(ne(y.block),ne(r.$$.fragment,P),ne(d),g=!0)},o(P){for(let R=0;R<3;R+=1){const Z=y.blocks[R];he(Z)}he(r.$$.fragment,P),he(d),g=!1},d(P){P&&(X(t),X(l),X(s)),y.block.d(P),y.token=null,y=null,$e(r,P),~u&&S[u].d(P)}}}function oC(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function sC(o){let e,t;return e=new xn({props:{data:o[21],$$slots:{default:[aC]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&32&&(u.data=r[21]),l&4194304&&(u.$$scope={dirty:l,ctx:r}),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function aC(o){let e,t;const r=[ji("fade-study-area"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<r.length;u+=1)l=Ni(l,r[u]);return e=new wc({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0},p(u,d){const s={};e.$set(s)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){$e(e,u)}}}function lC(o){return{c:We,m:We,p:We,i:We,o:We,d:We}}function cC(o){let e,t;return e=new V4({}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p:We,i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function uC(o){let e,t;return e=new D4({}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p:We,i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function hC(o){let e,t;return e=new P5({}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p:We,i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function dC(o){let e,t;return e=new S5({props:{prevMode:o[7].prevMode,browse:o[7].browse}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&128&&(u.prevMode=r[7].prevMode),l&128&&(u.browse=r[7].browse),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function fC(o){let e,t;return e=new s5({props:{id:o[7].id,map:o[0]}}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p(r,l){const u={};l&128&&(u.id=r[7].id),l&1&&(u.map=r[0]),e.$set(u)},i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function pC(o){let e,t;return e=new pS({}),{c(){Ve(e.$$.fragment)},m(r,l){je(e,r,l),t=!0},p:We,i(r){t||(ne(e.$$.fragment,r),t=!0)},o(r){he(e.$$.fragment,r),t=!1},d(r){$e(e,r)}}}function mC(o){let e,t,r,l,u,d,s,g=rC(o);t=new wS({});let y=o[5]&&Y0(o);return{c(){g&&g.c(),e=we(),Ve(t.$$.fragment),r=we(),l=ee("div"),u=we(),y&&y.c(),d=Ei()},m(k,S){g&&g.m(k,S),J(k,e,S),je(t,k,S),J(k,r,S),J(k,l,S),o[12](l),J(k,u,S),y&&y.m(k,S),J(k,d,S),s=!0},p(k,S){g.p(k,S),k[5]?y?(y.p(k,S),S&32&&ne(y,1)):(y=Y0(k),y.c(),ne(y,1),y.m(d.parentNode,d)):y&&(ui(),he(y,1,1,()=>{y=null}),hi())},i(k){s||(ne(g),ne(t.$$.fragment,k),ne(y),s=!0)},o(k){he(g),he(t.$$.fragment,k),he(y),s=!1},d(k){k&&(X(e),X(r),X(l),X(u),X(d)),g&&g.d(k),$e(t,k),o[12](null),y&&y.d(k)}}}function _C(o){let e,t,r,l;function u(s){o[13](s)}let d={style:`https://api.maptiler.com/maps/streets-v2/style.json?key=${W1}`,standardControls:!0,$$slots:{default:[mC]},$$scope:{ctx:o}};return o[0]!==void 0&&(d.map=o[0]),t=new Ek({props:d}),Ai.push(()=>Xn(t,"map",u)),t.$on("error",o[14]),{c(){e=ee("div"),Ve(t.$$.fragment),Pe(e,"slot","main"),mi(e,"position","relative"),mi(e,"width","100%"),mi(e,"height","100%")},m(s,g){J(s,e,g),je(t,e,null),l=!0},p(s,g){const y={};g&4194469&&(y.$$scope={dirty:g,ctx:s}),!r&&g&1&&(r=!0,y.map=s[0],Hn(()=>r=!1)),t.$set(y)},i(s){l||(ne(t.$$.fragment,s),l=!0)},o(s){he(t.$$.fragment,s),l=!1},d(s){s&&X(e),$e(t)}}}function gC(o){let e,t;return{c(){e=ee("div"),t=ee("div"),Pe(e,"slot","right")},m(r,l){J(r,e,l),F(e,t),o[11](t)},p:We,d(r){r&&X(e),o[11](null)}}}function yC(o){let e,t,r,l,u,d;return document.title=e="Network Planning Workspace - "+o[6],r=new Kk({props:{loading:o[4]}}),u=new $k({props:{$$slots:{right:[gC],main:[_C],left:[nC],top:[iC]},$$scope:{ctx:o}}}),{c(){t=we(),Ve(r.$$.fragment),l=we(),Ve(u.$$.fragment)},m(s,g){J(s,t,g),je(r,s,g),J(s,l,g),je(u,s,g),d=!0},p(s,[g]){(!d||g&64)&&e!==(e="Network Planning Workspace - "+s[6])&&(document.title=e);const y={};g&16&&(y.loading=s[4]),r.$set(y);const k={};g&4194479&&(k.$$scope={dirty:g,ctx:s}),u.$set(k)},i(s){d||(ne(r.$$.fragment,s),ne(u.$$.fragment,s),d=!0)},o(s){he(r.$$.fragment,s),he(u.$$.fragment,s),d=!1},d(s){s&&(X(t),X(l)),$e(r,s),$e(u,s)}}}function bd(o,e,t){return e+o*(t-e)}function bC(o,e,t){let r,l,u,d,s,g,y,k,S,L;bt(o,Mp,Y=>t(8,r=Y)),bt(o,Ap,Y=>t(9,l=Y)),bt(o,Lp,Y=>t(10,u=Y)),bt(o,Ln,Y=>t(5,d=Y)),bt(o,jd,Y=>t(16,s=Y)),bt(o,il,Y=>t(17,g=Y)),bt(o,da,Y=>t(18,y=Y)),bt(o,zd,Y=>t(6,k=Y)),bt(o,Dp,Y=>t(19,S=Y)),bt(o,ln,Y=>t(7,L=Y));let P="",R;gc(async()=>{await Y1();let Y=new URLSearchParams(window.location.search);oi(zd,k=Y.get("boundary")||"LAD_City of Edinburgh",k),t(4,P=`Loading ${k}`);let ue=new x4,fe=await fetch(`areas/${k}.bin`);fe.ok?(console.log("Using locally hosted files"),oi(Dp,S=!1,S)):(console.log("Using remote hosted files"),fe=await fetch(kc(`areas/${k}.bin`)));let ce=await fe.arrayBuffer();try{await ue.loadFile(new Uint8Array(ce))}catch(Ee){window.alert(`Couldn't load: ${Ee}`)}let ae=window.localStorage.getItem(`tmp-npt-editor/${k}`);if(ae)try{await ue.loadSavefile(ae)}catch(Ee){window.alert(`Couldn't restore saved state: ${Ee}`)}t(4,P="");let Ge=await ue.getBounds();oi(da,y={lng:bd(.4,Ge[0],Ge[2]),lat:bd(.4,Ge[1],Ge[3])},y),oi(il,g={lng:bd(.6,Ge[0],Ge[2]),lat:bd(.6,Ge[1],Ge[3])},g),oi(jd,s=new MS(R,ue.toRouteSnapper(),Mi(dc()),Mi(!0),Mi(0)),s),Ln.set(ue),await Z()});async function Z(){R&&d&&R.fitBounds(await d.getBounds(),{animate:!1})}let U,H,G;function K(Y){Ai[Y?"unshift":"push"](()=>{G=Y,t(3,G),t(8,r)})}function le(Y){Ai[Y?"unshift":"push"](()=>{H=Y,t(2,H),t(9,l)})}function Se(Y){R=Y,t(0,R)}const Le=Y=>{console.log(Y.detail.error)};function te(Y){Ai[Y?"unshift":"push"](()=>{U=Y,t(1,U),t(10,u)})}return o.$$.update=()=>{o.$$.dirty&1&&R&&H1.set(R),o.$$.dirty&1026&&U&&u&&(t(1,U.innerHTML="",U),U.appendChild(u)),o.$$.dirty&516&&H&&l&&(t(2,H.innerHTML="",H),H.appendChild(l)),o.$$.dirty&264&&G&&r&&(t(3,G.innerHTML="",G),G.appendChild(r))},[R,U,H,G,P,d,k,L,r,l,u,K,le,Se,Le,te]}class vC extends Wt{constructor(e){super(),Gt(this,e,bC,yC,Vt,{})}}new vC({target:document.getElementById("app")});
