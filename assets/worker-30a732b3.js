var ke=Object.defineProperty;var Ae=(i,m,R)=>m in i?ke(i,m,{enumerable:!0,configurable:!0,writable:!0,value:R}):i[m]=R;var ne=(i,m,R)=>(Ae(i,typeof m!="symbol"?m+"":m,R),R);(function(){"use strict";let i;function m(n){const e=i.__externref_table_alloc();return i.__wbindgen_export_2.set(e,n),e}function R(n,e){try{return n.apply(this,e)}catch(t){const r=m(t);i.__wbindgen_exn_store(r)}}const j=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&j.decode();let E=null;function O(){return(E===null||E.byteLength===0)&&(E=new Uint8Array(i.memory.buffer)),E}function d(n,e){return n=n>>>0,j.decode(O().subarray(n,n+e))}let f=0;const M=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},re=typeof M.encodeInto=="function"?function(n,e){return M.encodeInto(n,e)}:function(n,e){const t=M.encode(n);return e.set(t),{read:n.length,written:t.length}};function S(n,e,t){if(t===void 0){const c=M.encode(n),u=e(c.length,1)>>>0;return O().subarray(u,u+c.length).set(c),f=c.length,u}let r=n.length,o=e(r,1)>>>0;const s=O();let a=0;for(;a<r;a++){const c=n.charCodeAt(a);if(c>127)break;s[o+a]=c}if(a!==r){a!==0&&(n=n.slice(a)),o=t(o,r,r=a+n.length*3,1)>>>0;const c=O().subarray(o+a,o+r),u=re(n,c);a+=u.written,o=t(o,r,a,1)>>>0}return f=a,o}let k=null;function v(){return(k===null||k.buffer.detached===!0||k.buffer.detached===void 0&&k.buffer!==i.memory.buffer)&&(k=new DataView(i.memory.buffer)),k}function g(n){return n==null}function L(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let s="[";o>0&&(s+=L(n[0]));for(let a=1;a<o;a++)s+=", "+L(n[a]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function oe(n,e){const t=e(n.length*1,1)>>>0;return O().set(n,t/1),f=n.length,t}function _(n){const e=i.__wbindgen_export_2.get(n);return i.__externref_table_dealloc(n),e}function w(n,e){return n=n>>>0,O().subarray(n/1,n/1+e)}let T=null;function ie(){return(T===null||T.byteLength===0)&&(T=new Float64Array(i.memory.buffer)),T}function G(n,e){return n=n>>>0,ie().subarray(n/8,n/8+e)}let I=null;function V(){return(I===null||I.byteLength===0)&&(I=new Uint32Array(i.memory.buffer)),I}function se(n,e){return n=n>>>0,V().subarray(n/4,n/4+e)}function N(n,e){const t=e(n.length*4,4)>>>0;return V().set(n,t/4),f=n.length,t}const $=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>i.__wbg_mapmodel_free(n>>>0,1));class ae{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_mapmodel_free(e,0)}constructor(e){const t=oe(e,i.__wbindgen_malloc),r=f,o=i.mapmodel_new(t,r);if(o[2])throw _(o[1]);return this.__wbg_ptr=o[0]>>>0,$.register(this,this.__wbg_ptr,this),this}renderStaticRoads(){const e=i.mapmodel_renderStaticRoads(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}renderDynamicRoads(){const e=i.mapmodel_renderDynamicRoads(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getInvertedBoundaryInsideSettlements(){let e,t;try{const s=i.mapmodel_getInvertedBoundaryInsideSettlements(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getInvertedBoundaryOutsideSettlements(){let e,t;try{const s=i.mapmodel_getInvertedBoundaryOutsideSettlements(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getInvertedBoundaryForStudyArea(){let e,t;try{const s=i.mapmodel_getInvertedBoundaryForStudyArea(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getStudyAreaBoundary(){let e,t;try{const s=i.mapmodel_getStudyAreaBoundary(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getBounds(){const e=i.mapmodel_getBounds(this.__wbg_ptr);var t=G(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*8,8),t}setRoute(e,t){const r=i.mapmodel_setRoute(this.__wbg_ptr,g(e)?4294967297:e>>>0,t);if(r[3])throw _(r[2]);var o=se(r[0],r[1]).slice();return i.__wbindgen_free(r[0],r[1]*4,4),o}deleteRoutes(e){const t=N(e,i.__wbindgen_malloc),r=f,o=i.mapmodel_deleteRoutes(this.__wbg_ptr,t,r);if(o[1])throw _(o[0])}changeTier(e,t){const r=N(e,i.__wbindgen_malloc),o=f,s=S(t,i.__wbindgen_malloc,i.__wbindgen_realloc),a=f,c=i.mapmodel_changeTier(this.__wbg_ptr,r,o,s,a);if(c[1])throw _(c[0])}changeInfraType(e,t){const r=N(e,i.__wbindgen_malloc),o=f,s=S(t,i.__wbindgen_malloc,i.__wbindgen_realloc),a=f,c=i.mapmodel_changeInfraType(this.__wbg_ptr,r,o,s,a);if(c[1])throw _(c[0])}clearAllRoutes(){i.mapmodel_clearAllRoutes(this.__wbg_ptr)}autosplitRoute(e,t,r,o,s){const a=S(o,i.__wbindgen_malloc,i.__wbindgen_realloc),c=f,u=i.mapmodel_autosplitRoute(this.__wbg_ptr,g(e)?4294967297:e>>>0,t,r,a,c,!g(s),g(s)?0:s);if(u[3])throw _(u[2]);var l=w(u[0],u[1]).slice();return i.__wbindgen_free(u[0],u[1]*1,1),l}previewRoute(e,t){const r=i.mapmodel_previewRoute(this.__wbg_ptr,e,!g(t),g(t)?0:t);if(r[3])throw _(r[2]);var o=w(r[0],r[1]).slice();return i.__wbindgen_free(r[0],r[1]*1,1),o}snapPoint(e,t,r){const o=i.mapmodel_snapPoint(this.__wbg_ptr,e,t,!g(r),g(r)?0:r);var s=G(o[0],o[1]).slice();return i.__wbindgen_free(o[0],o[1]*8,8),s}getAllRoutes(){const e=i.mapmodel_getAllRoutes(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getRoute(e){const t=i.mapmodel_getRoute(this.__wbg_ptr,e);if(t[3])throw _(t[2]);var r=w(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*1,1),r}getRouteSections(e){const t=N(e,i.__wbindgen_malloc),r=f,o=i.mapmodel_getRouteSections(this.__wbg_ptr,t,r);if(o[3])throw _(o[2]);var s=w(o[0],o[1]).slice();return i.__wbindgen_free(o[0],o[1]*1,1),s}evaluateRoute(e){let t,r;try{const a=i.mapmodel_evaluateRoute(this.__wbg_ptr,e);var o=a[0],s=a[1];if(a[3])throw o=0,s=0,_(a[2]);return t=o,r=s,d(o,s)}finally{i.__wbindgen_free(t,r,1)}}debugReachablePath(e,t){let r,o;try{const c=S(e,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,l=i.mapmodel_debugReachablePath(this.__wbg_ptr,c,u,t);var s=l[0],a=l[1];if(l[3])throw s=0,a=0,_(l[2]);return r=s,o=a,d(s,a)}finally{i.__wbindgen_free(r,o,1)}}debugUnreachablePath(e,t){let r,o;try{const c=S(e,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,l=i.mapmodel_debugUnreachablePath(this.__wbg_ptr,c,u,t);var s=l[0],a=l[1];if(l[3])throw s=0,a=0,_(l[2]);return r=s,o=a,d(s,a)}finally{i.__wbindgen_free(r,o,1)}}fixUnreachablePOI(e,t){let r,o;try{const c=S(e,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,l=i.mapmodel_fixUnreachablePOI(this.__wbg_ptr,c,u,t);var s=l[0],a=l[1];if(l[3])throw s=0,a=0,_(l[2]);return r=s,o=a,d(s,a)}finally{i.__wbindgen_free(r,o,1)}}evaluateOD(e){const t=i.mapmodel_evaluateOD(this.__wbg_ptr,e);if(t[3])throw _(t[2]);var r=w(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*1,1),r}recalculateStats(){let e,t;try{const s=i.mapmodel_recalculateStats(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}recalculateSlowStats(){let e,t;try{const s=i.mapmodel_recalculateSlowStats(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getBaselineStats(){let e,t;try{const s=i.mapmodel_getBaselineStats(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}recalculateODStats(){let e,t;try{const s=i.mapmodel_recalculateODStats(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}loadSavefile(e){const t=S(e,i.__wbindgen_malloc,i.__wbindgen_realloc),r=f,o=i.mapmodel_loadSavefile(this.__wbg_ptr,t,r);if(o[1])throw _(o[0])}getGridMeshDensity(e,t,r){const o=i.mapmodel_getGridMeshDensity(this.__wbg_ptr,e,t,r);if(o[3])throw _(o[2]);var s=w(o[0],o[1]).slice();return i.__wbindgen_free(o[0],o[1]*1,1),s}importExistingRoutes(e){i.mapmodel_importExistingRoutes(this.__wbg_ptr,e)}importArterialRoads(){i.mapmodel_importArterialRoads(this.__wbg_ptr)}getPOIs(){const e=i.mapmodel_getPOIs(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getGreenspaces(){const e=i.mapmodel_getGreenspaces(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getTownCentres(){const e=i.mapmodel_getTownCentres(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getTownCentrePoints(){let e,t;try{const s=i.mapmodel_getTownCentrePoints(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getSettlements(){const e=i.mapmodel_getSettlements(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getSettlementLocations(){let e,t;try{const s=i.mapmodel_getSettlementLocations(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getDataZones(){const e=i.mapmodel_getDataZones(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getConnectedComponents(){let e,t;try{const s=i.mapmodel_getConnectedComponents(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getExtraNodes(e,t,r){let o,s;try{const u=i.mapmodel_getExtraNodes(this.__wbg_ptr,e,t,!g(r),g(r)?0:r);var a=u[0],c=u[1];if(u[3])throw a=0,c=0,_(u[2]);return o=a,s=c,d(a,c)}finally{i.__wbindgen_free(o,s,1)}}getMajorJunctions(){const e=i.mapmodel_getMajorJunctions(this.__wbg_ptr);if(e[3])throw _(e[2]);var t=w(e[0],e[1]).slice();return i.__wbindgen_free(e[0],e[1]*1,1),t}getTownCentreRoutes(){let e,t;try{const s=i.mapmodel_getTownCentreRoutes(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}getNetworkLengths(){let e,t;try{const s=i.mapmodel_getNetworkLengths(this.__wbg_ptr);var r=s[0],o=s[1];if(s[3])throw r=0,o=0,_(s[2]);return e=r,t=o,d(r,o)}finally{i.__wbindgen_free(e,t,1)}}}async function ce(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function _e(){const n={};return n.wbg={},n.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},n.wbg.__wbg_call_672a4d21634d4a24=function(){return R(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_call_7cccdd69e0791ae2=function(){return R(function(e,t,r){return e.call(t,r)},arguments)},n.wbg.__wbg_debug_3cb59063b29f58c1=function(e){console.debug(e)},n.wbg.__wbg_done_769e5ede4b31c67b=function(e){return e.done},n.wbg.__wbg_entries_3265d4158b33e5dc=function(e){return Object.entries(e)},n.wbg.__wbg_error_524f506f44df1645=function(e){console.error(e)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,o;try{r=e,o=t,console.error(d(e,t))}finally{i.__wbindgen_free(r,o,1)}},n.wbg.__wbg_get_67b2ba62fc30de12=function(){return R(function(e,t){return Reflect.get(e,t)},arguments)},n.wbg.__wbg_get_b9b93047fe3cf45b=function(e,t){return e[t>>>0]},n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]},n.wbg.__wbg_info_3daf2e093e091b66=function(e){console.info(e)},n.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_isArray_a1eab7e0d067391b=function(e){return Array.isArray(e)},n.wbg.__wbg_iterator_9a24c88df860dc65=function(){return Symbol.iterator},n.wbg.__wbg_length_a446193dc22c12f8=function(e){return e.length},n.wbg.__wbg_length_e2d2a49132c1b256=function(e){return e.length},n.wbg.__wbg_log_c222819a41e063d3=function(e){console.log(e)},n.wbg.__wbg_new_78c8a92080461d08=function(e){return new Float64Array(e)},n.wbg.__wbg_new_78feb108b6472713=function(){return new Array},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},n.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,t){return new Function(d(e,t))},n.wbg.__wbg_newwithbyteoffsetandlength_93c8e0c1a479fa1a=function(e,t,r){return new Float64Array(e,t>>>0,r>>>0)},n.wbg.__wbg_next_25feadfc0913fea9=function(e){return e.next},n.wbg.__wbg_next_6574e1a8a62d1055=function(){return R(function(e){return e.next()},arguments)},n.wbg.__wbg_now_2c95c9de01293173=function(e){return e.now()},n.wbg.__wbg_performance_7a3ffd0b17f663ad=function(e){return e.performance},n.wbg.__wbg_push_737cfc8c1432c2c6=function(e,t){return e.push(t)},n.wbg.__wbg_set_65595bdd868b3009=function(e,t,r){e.set(t,r>>>0)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const r=t.stack,o=S(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=f;v().setInt32(e+4*1,s,!0),v().setInt32(e+4*0,o,!0)},n.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const e=typeof global>"u"?null:global;return g(e)?0:m(e)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const e=typeof globalThis>"u"?null:globalThis;return g(e)?0:m(e)},n.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const e=typeof self>"u"?null:self;return g(e)?0:m(e)},n.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const e=typeof window>"u"?null:window;return g(e)?0:m(e)},n.wbg.__wbg_value_cd1ffa7b1ab794f1=function(e){return e.value},n.wbg.__wbg_warn_4ca3906c248c47c4=function(e){console.warn(e)},n.wbg.__wbindgen_boolean_get=function(e){const t=e;return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_debug_string=function(e,t){const r=L(t),o=S(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=f;v().setInt32(e+4*1,s,!0),v().setInt32(e+4*0,o,!0)},n.wbg.__wbindgen_error_new=function(e,t){return new Error(d(e,t))},n.wbg.__wbindgen_in=function(e,t){return e in t},n.wbg.__wbindgen_init_externref_table=function(){const e=i.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},n.wbg.__wbindgen_is_object=function(e){const t=e;return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_string=function(e){return typeof e=="string"},n.wbg.__wbindgen_is_undefined=function(e){return e===void 0},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},n.wbg.__wbindgen_memory=function(){return i.memory},n.wbg.__wbindgen_number_get=function(e,t){const r=t,o=typeof r=="number"?r:void 0;v().setFloat64(e+8*1,g(o)?0:o,!0),v().setInt32(e+4*0,!g(o),!0)},n.wbg.__wbindgen_string_get=function(e,t){const r=t,o=typeof r=="string"?r:void 0;var s=g(o)?0:S(o,i.__wbindgen_malloc,i.__wbindgen_realloc),a=f;v().setInt32(e+4*1,a,!0),v().setInt32(e+4*0,s,!0)},n.wbg.__wbindgen_string_new=function(e,t){return d(e,t)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(d(e,t))},n}function ue(n,e){return i=n.exports,H.__wbindgen_wasm_module=e,k=null,T=null,I=null,E=null,i.__wbindgen_start(),i}async function H(n){if(i!==void 0)return i;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/npw/assets/backend_bg-c11858b7.wasm",self.location));const e=_e();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await ce(await n,e);return ue(t,r)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Z=Symbol("Comlink.proxy"),le=Symbol("Comlink.endpoint"),de=Symbol("Comlink.releaseProxy"),W=Symbol("Comlink.finalizer"),C=Symbol("Comlink.thrown"),Y=n=>typeof n=="object"&&n!==null||typeof n=="function",fe={canHandle:n=>Y(n)&&n[Z],serialize(n){const{port1:e,port2:t}=new MessageChannel;return J(n,e),[t,[t]]},deserialize(n){return n.start(),he(n)}},ge={canHandle:n=>Y(n)&&C in n,serialize({value:n}){let e;return n instanceof Error?e={isError:!0,value:{message:n.message,name:n.name,stack:n.stack}}:e={isError:!1,value:n},[e,[]]},deserialize(n){throw n.isError?Object.assign(new Error(n.value.message),n.value):n.value}},X=new Map([["proxy",fe],["throw",ge]]);function we(n,e){for(const t of n)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function J(n,e=globalThis,t=["*"]){e.addEventListener("message",function r(o){if(!o||!o.data)return;if(!we(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:s,type:a,path:c}=Object.assign({path:[]},o.data),u=(o.data.argumentList||[]).map(A);let l;try{const h=c.slice(0,-1).reduce((y,P)=>y[P],n),p=c.reduce((y,P)=>y[P],n);switch(a){case"GET":l=p;break;case"SET":h[c.slice(-1)[0]]=A(o.data.value),l=!0;break;case"APPLY":l=p.apply(h,u);break;case"CONSTRUCT":{const y=new p(...u);l=Re(y)}break;case"ENDPOINT":{const{port1:y,port2:P}=new MessageChannel;J(n,P),l=te(y,[y])}break;case"RELEASE":l=void 0;break;default:return}}catch(h){l={value:h,[C]:0}}Promise.resolve(l).catch(h=>({value:h,[C]:0})).then(h=>{const[p,y]=U(h);e.postMessage(Object.assign(Object.assign({},p),{id:s}),y),a==="RELEASE"&&(e.removeEventListener("message",r),q(e),W in n&&typeof n[W]=="function"&&n[W]())}).catch(h=>{const[p,y]=U({value:new TypeError("Unserializable return value"),[C]:0});e.postMessage(Object.assign(Object.assign({},p),{id:s}),y)})}),e.start&&e.start()}function be(n){return n.constructor.name==="MessagePort"}function q(n){be(n)&&n.close()}function he(n,e){const t=new Map;return n.addEventListener("message",function(o){const{data:s}=o;if(!s||!s.id)return;const a=t.get(s.id);if(a)try{a(s)}finally{t.delete(s.id)}}),z(n,t,[],e)}function D(n){if(n)throw new Error("Proxy has been released and is not useable")}function K(n){return x(n,new Map,{type:"RELEASE"}).then(()=>{q(n)})}const B=new WeakMap,F="FinalizationRegistry"in globalThis&&new FinalizationRegistry(n=>{const e=(B.get(n)||0)-1;B.set(n,e),e===0&&K(n)});function ye(n,e){const t=(B.get(e)||0)+1;B.set(e,t),F&&F.register(n,e,n)}function me(n){F&&F.unregister(n)}function z(n,e,t=[],r=function(){}){let o=!1;const s=new Proxy(r,{get(a,c){if(D(o),c===de)return()=>{me(s),K(n),e.clear(),o=!0};if(c==="then"){if(t.length===0)return{then:()=>s};const u=x(n,e,{type:"GET",path:t.map(l=>l.toString())}).then(A);return u.then.bind(u)}return z(n,e,[...t,c])},set(a,c,u){D(o);const[l,h]=U(u);return x(n,e,{type:"SET",path:[...t,c].map(p=>p.toString()),value:l},h).then(A)},apply(a,c,u){D(o);const l=t[t.length-1];if(l===le)return x(n,e,{type:"ENDPOINT"}).then(A);if(l==="bind")return z(n,e,t.slice(0,-1));const[h,p]=Q(u);return x(n,e,{type:"APPLY",path:t.map(y=>y.toString()),argumentList:h},p).then(A)},construct(a,c){D(o);const[u,l]=Q(c);return x(n,e,{type:"CONSTRUCT",path:t.map(h=>h.toString()),argumentList:u},l).then(A)}});return ye(s,n),s}function pe(n){return Array.prototype.concat.apply([],n)}function Q(n){const e=n.map(U);return[e.map(t=>t[0]),pe(e.map(t=>t[1]))]}const ee=new WeakMap;function te(n,e){return ee.set(n,e),n}function Re(n){return Object.assign(n,{[Z]:!0})}function U(n){for(const[e,t]of X)if(t.canHandle(n)){const[r,o]=t.serialize(n);return[{type:"HANDLER",name:e,value:r},o]}return[{type:"RAW",value:n},ee.get(n)||[]]}function A(n){switch(n.type){case"HANDLER":return X.get(n.name).deserialize(n.value);case"RAW":return n.value}}function x(n,e,t,r){return new Promise(o=>{const s=Se();e.set(s,o),n.start&&n.start(),n.postMessage(Object.assign({id:s},t),r)})}function Se(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class ve{constructor(){ne(this,"inner");this.inner=null}async loadFile(e){await H(),this.inner=new ae(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundaryForStudyArea(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryForStudyArea())}getInvertedBoundaryInsideSettlements(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryInsideSettlements())}getInvertedBoundaryOutsideSettlements(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryOutsideSettlements())}getStudyAreaBoundary(){return this.checkReady(),JSON.parse(this.inner.getStudyAreaBoundary())}renderStaticRoads(){return b(this.checkReady().renderStaticRoads())}renderDynamicRoads(){return b(this.checkReady().renderDynamicRoads())}getAllRoutes(){return b(this.checkReady().getAllRoutes())}getRoute(e){return b(this.checkReady().getRoute(e))}getRouteSections(e){return b(this.checkReady().getRouteSections(new Uint32Array(e)))}setRoute(e,t){return this.checkReady(),Array.from(this.inner.setRoute(e??void 0,t))}deleteRoutes(e){this.checkReady(),this.inner.deleteRoutes(new Uint32Array(e))}changeTier(e,t){this.checkReady(),this.inner.changeTier(new Uint32Array(e),`"${t}"`)}changeInfraType(e,t){this.checkReady(),this.inner.changeInfraType(new Uint32Array(e),`"${t}"`)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}autosplitRoute(e,t,r,o,s){return b(this.checkReady().autosplitRoute(e??void 0,t,r,`"${o}"`,s))}previewRoute(e,t){return b(this.checkReady().previewRoute(e,t))}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(e){return b(this.checkReady().evaluateOD(e))}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}recalculateSlowStats(){return this.checkReady(),JSON.parse(this.inner.recalculateSlowStats())}getBaselineStats(){return this.checkReady(),JSON.parse(this.inner.getBaselineStats())}recalculateODStats(){return this.checkReady(),JSON.parse(this.inner.recalculateODStats())}getGridMeshDensity(e,t,r){return b(this.checkReady().getGridMeshDensity(e,t,r))}importExistingRoutes(e){this.checkReady(),this.inner.importExistingRoutes(e=="infra-type")}importArterialRoads(){this.checkReady(),this.inner.importArterialRoads()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getPOIs(){return b(this.checkReady().getPOIs())}getTownCentres(){return b(this.checkReady().getTownCentres())}getSettlements(){return b(this.checkReady().getSettlements())}getSettlementLocations(){return this.checkReady(),JSON.parse(this.inner.getSettlementLocations())}getGreenspaces(){return b(this.checkReady().getGreenspaces())}getDataZones(){return b(this.checkReady().getDataZones())}debugReachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,t))}debugUnreachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,t))}fixUnreachablePOI(e,t){return this.checkReady(),JSON.parse(this.inner.fixUnreachablePOI(e,t))}getConnectedComponents(){return this.checkReady(),JSON.parse(this.inner.getConnectedComponents())}snapPoint(e,t){this.checkReady();let r=this.inner.snapPoint(e[0],e[1],t);return[r[0],r[1]]}getExtraNodes(e,t,r){return this.checkReady(),JSON.parse(this.inner.getExtraNodes(e,t,r))}getMajorJunctions(){return b(this.checkReady().getMajorJunctions())}getTownCentreRoutes(){return this.checkReady(),JSON.parse(this.inner.getTownCentreRoutes())}getTownCentrePoints(){return this.checkReady(),JSON.parse(this.inner.getTownCentrePoints())}getNetworkLengths(){return this.checkReady(),JSON.parse(this.inner.getNetworkLengths())}checkReady(){if(!this.inner)throw new Error("InnerBackend used without a file loaded");return this.inner}}function b(n){return te(n,[n.buffer])}J(ve)})();
