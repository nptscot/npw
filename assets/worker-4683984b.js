var ve=Object.defineProperty;var ke=(o,p,b)=>p in o?ve(o,p,{enumerable:!0,configurable:!0,writable:!0,value:b}):o[p]=b;var te=(o,p,b)=>(ke(o,typeof p!="symbol"?p+"":p,b),b);(function(){"use strict";let o;function p(r){const e=o.__externref_table_alloc();return o.__wbindgen_export_2.set(e,r),e}function b(r,e){try{return r.apply(this,e)}catch(t){const n=p(t);o.__wbindgen_exn_store(n)}}const z=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&z.decode();let O=null;function k(){return(O===null||O.byteLength===0)&&(O=new Uint8Array(o.memory.buffer)),O}function d(r,e){return r=r>>>0,z.decode(k().subarray(r,r+e))}let l=0;const N=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},re=typeof N.encodeInto=="function"?function(r,e){return N.encodeInto(r,e)}:function(r,e){const t=N.encode(r);return e.set(t),{read:r.length,written:t.length}};function m(r,e,t){if(t===void 0){const c=N.encode(r),_=e(c.length,1)>>>0;return k().subarray(_,_+c.length).set(c),l=c.length,_}let n=r.length,i=e(n,1)>>>0;const a=k();let s=0;for(;s<n;s++){const c=r.charCodeAt(s);if(c>127)break;a[i+s]=c}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3,1)>>>0;const c=k().subarray(i+s,i+n),_=re(r,c);s+=_.written,i=t(i,n,s,1)>>>0}return l=s,i}let S=null;function R(){return(S===null||S.buffer.detached===!0||S.buffer.detached===void 0&&S.buffer!==o.memory.buffer)&&(S=new DataView(o.memory.buffer)),S}function U(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let a="[";i>0&&(a+=U(r[0]));for(let s=1;s<i;s++)a+=", "+U(r[s]);return a+="]",a}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t&&t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function h(r){return r==null}function ne(r,e){const t=e(r.length*1,1)>>>0;return k().set(r,t/1),l=r.length,t}function u(r){const e=o.__wbindgen_export_2.get(r);return o.__externref_table_dealloc(r),e}function j(r,e){return r=r>>>0,k().subarray(r/1,r/1+e)}let x=null;function ie(){return(x===null||x.byteLength===0)&&(x=new Float64Array(o.memory.buffer)),x}function G(r,e){return r=r>>>0,ie().subarray(r/8,r/8+e)}let E=null;function V(){return(E===null||E.byteLength===0)&&(E=new Uint32Array(o.memory.buffer)),E}function ae(r,e){return r=r>>>0,V().subarray(r/4,r/4+e)}function I(r,e){const t=e(r.length*4,4)>>>0;return V().set(r,t/4),l=r.length,t}const $=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>o.__wbg_mapmodel_free(r>>>0,1));class oe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_mapmodel_free(e,0)}constructor(e){const t=ne(e,o.__wbindgen_malloc),n=l,i=o.mapmodel_new(t,n);if(i[2])throw u(i[1]);return this.__wbg_ptr=i[0]>>>0,$.register(this,this.__wbg_ptr,this),this}renderStaticRoads(){const e=o.mapmodel_renderStaticRoads(this.__wbg_ptr);if(e[3])throw u(e[2]);var t=j(e[0],e[1]).slice();return o.__wbindgen_free(e[0],e[1]*1,1),t}renderDynamicRoads(){const e=o.mapmodel_renderDynamicRoads(this.__wbg_ptr);if(e[3])throw u(e[2]);var t=j(e[0],e[1]).slice();return o.__wbindgen_free(e[0],e[1]*1,1),t}getInvertedBoundaryInsideSettlements(){let e,t;try{const a=o.mapmodel_getInvertedBoundaryInsideSettlements(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getInvertedBoundaryOutsideSettlements(){let e,t;try{const a=o.mapmodel_getInvertedBoundaryOutsideSettlements(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getInvertedBoundaryForStudyArea(){let e,t;try{const a=o.mapmodel_getInvertedBoundaryForStudyArea(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getStudyAreaBoundary(){let e,t;try{const a=o.mapmodel_getStudyAreaBoundary(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getBounds(){const e=o.mapmodel_getBounds(this.__wbg_ptr);var t=G(e[0],e[1]).slice();return o.__wbindgen_free(e[0],e[1]*8,8),t}setRoute(e,t){const n=o.mapmodel_setRoute(this.__wbg_ptr,h(e)?4294967297:e>>>0,t);if(n[3])throw u(n[2]);var i=ae(n[0],n[1]).slice();return o.__wbindgen_free(n[0],n[1]*4,4),i}deleteRoutes(e){const t=I(e,o.__wbindgen_malloc),n=l,i=o.mapmodel_deleteRoutes(this.__wbg_ptr,t,n);if(i[1])throw u(i[0])}changeTier(e,t){const n=I(e,o.__wbindgen_malloc),i=l,a=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),s=l,c=o.mapmodel_changeTier(this.__wbg_ptr,n,i,a,s);if(c[1])throw u(c[0])}changeInfraType(e,t){const n=I(e,o.__wbindgen_malloc),i=l,a=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),s=l,c=o.mapmodel_changeInfraType(this.__wbg_ptr,n,i,a,s);if(c[1])throw u(c[0])}clearAllRoutes(){o.mapmodel_clearAllRoutes(this.__wbg_ptr)}autosplitRoute(e,t,n,i,a){let s,c;try{const w=m(i,o.__wbindgen_malloc,o.__wbindgen_realloc),y=l,g=o.mapmodel_autosplitRoute(this.__wbg_ptr,h(e)?4294967297:e>>>0,t,n,w,y,!h(a),h(a)?0:a);var _=g[0],f=g[1];if(g[3])throw _=0,f=0,u(g[2]);return s=_,c=f,d(_,f)}finally{o.__wbindgen_free(s,c,1)}}previewRoute(e,t){let n,i;try{const c=o.mapmodel_previewRoute(this.__wbg_ptr,e,!h(t),h(t)?0:t);var a=c[0],s=c[1];if(c[3])throw a=0,s=0,u(c[2]);return n=a,i=s,d(a,s)}finally{o.__wbindgen_free(n,i,1)}}snapPoint(e,t,n){const i=o.mapmodel_snapPoint(this.__wbg_ptr,e,t,!h(n),h(n)?0:n);var a=G(i[0],i[1]).slice();return o.__wbindgen_free(i[0],i[1]*8,8),a}getAllRoutes(){let e,t;try{const a=o.mapmodel_getAllRoutes(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getRoute(e){let t,n;try{const s=o.mapmodel_getRoute(this.__wbg_ptr,e);var i=s[0],a=s[1];if(s[3])throw i=0,a=0,u(s[2]);return t=i,n=a,d(i,a)}finally{o.__wbindgen_free(t,n,1)}}getRouteSections(e){let t,n;try{const s=I(e,o.__wbindgen_malloc),c=l,_=o.mapmodel_getRouteSections(this.__wbg_ptr,s,c);var i=_[0],a=_[1];if(_[3])throw i=0,a=0,u(_[2]);return t=i,n=a,d(i,a)}finally{o.__wbindgen_free(t,n,1)}}evaluateRoute(e){let t,n;try{const s=o.mapmodel_evaluateRoute(this.__wbg_ptr,e);var i=s[0],a=s[1];if(s[3])throw i=0,a=0,u(s[2]);return t=i,n=a,d(i,a)}finally{o.__wbindgen_free(t,n,1)}}debugReachablePath(e,t){let n,i;try{const c=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),_=l,f=o.mapmodel_debugReachablePath(this.__wbg_ptr,c,_,t);var a=f[0],s=f[1];if(f[3])throw a=0,s=0,u(f[2]);return n=a,i=s,d(a,s)}finally{o.__wbindgen_free(n,i,1)}}debugUnreachablePath(e,t){let n,i;try{const c=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),_=l,f=o.mapmodel_debugUnreachablePath(this.__wbg_ptr,c,_,t);var a=f[0],s=f[1];if(f[3])throw a=0,s=0,u(f[2]);return n=a,i=s,d(a,s)}finally{o.__wbindgen_free(n,i,1)}}fixUnreachablePOI(e,t){let n,i;try{const c=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),_=l,f=o.mapmodel_fixUnreachablePOI(this.__wbg_ptr,c,_,t);var a=f[0],s=f[1];if(f[3])throw a=0,s=0,u(f[2]);return n=a,i=s,d(a,s)}finally{o.__wbindgen_free(n,i,1)}}evaluateOD(e){let t,n;try{const s=o.mapmodel_evaluateOD(this.__wbg_ptr,e);var i=s[0],a=s[1];if(s[3])throw i=0,a=0,u(s[2]);return t=i,n=a,d(i,a)}finally{o.__wbindgen_free(t,n,1)}}recalculateStats(){let e,t;try{const a=o.mapmodel_recalculateStats(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}recalculateSlowStats(){let e,t;try{const a=o.mapmodel_recalculateSlowStats(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getBaselineStats(){let e,t;try{const a=o.mapmodel_getBaselineStats(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}recalculateODStats(){let e,t;try{const a=o.mapmodel_recalculateODStats(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}loadSavefile(e){const t=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),n=l,i=o.mapmodel_loadSavefile(this.__wbg_ptr,t,n);if(i[1])throw u(i[0])}getGridMeshDensity(e,t,n){let i,a;try{const _=o.mapmodel_getGridMeshDensity(this.__wbg_ptr,e,t,n);var s=_[0],c=_[1];if(_[3])throw s=0,c=0,u(_[2]);return i=s,a=c,d(s,c)}finally{o.__wbindgen_free(i,a,1)}}importExistingRoutes(e){o.mapmodel_importExistingRoutes(this.__wbg_ptr,e)}importArterialRoads(){o.mapmodel_importArterialRoads(this.__wbg_ptr)}getPOIs(){let e,t;try{const a=o.mapmodel_getPOIs(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getGreenspaces(){let e,t;try{const a=o.mapmodel_getGreenspaces(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getTownCentres(){let e,t;try{const a=o.mapmodel_getTownCentres(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getTownCentrePoints(){let e,t;try{const a=o.mapmodel_getTownCentrePoints(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getSettlements(){let e,t;try{const a=o.mapmodel_getSettlements(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getSettlementLocations(){let e,t;try{const a=o.mapmodel_getSettlementLocations(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getDataZones(){let e,t;try{const a=o.mapmodel_getDataZones(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getConnectedComponents(){let e,t;try{const a=o.mapmodel_getConnectedComponents(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getExtraNodes(e,t,n){let i,a;try{const _=o.mapmodel_getExtraNodes(this.__wbg_ptr,e,t,!h(n),h(n)?0:n);var s=_[0],c=_[1];if(_[3])throw s=0,c=0,u(_[2]);return i=s,a=c,d(s,c)}finally{o.__wbindgen_free(i,a,1)}}getMajorJunctions(){let e,t;try{const a=o.mapmodel_getMajorJunctions(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getTownCentreRoutes(){let e,t;try{const a=o.mapmodel_getTownCentreRoutes(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}getNetworkLengths(){let e,t;try{const a=o.mapmodel_getNetworkLengths(this.__wbg_ptr);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,u(a[2]);return e=n,t=i,d(n,i)}finally{o.__wbindgen_free(e,t,1)}}}async function se(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ce(){const r={};return r.wbg={},r.wbg.__wbg_buffer_aa30bbb65cb44323=function(e){return e.buffer},r.wbg.__wbg_call_41c7efaf6b1182f8=function(){return b(function(e,t,n){return e.call(t,n)},arguments)},r.wbg.__wbg_call_c45d13337ffb12ac=function(){return b(function(e,t){return e.call(t)},arguments)},r.wbg.__wbg_debug_6747a9ad816638fa=function(e){console.debug(e)},r.wbg.__wbg_done_362f78ab584a24b5=function(e){return e.done},r.wbg.__wbg_entries_27a445ca6b702f8d=function(e){return Object.entries(e)},r.wbg.__wbg_error_4e9ba4ac0ad780bd=function(e){console.error(e)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let n,i;try{n=e,i=t,console.error(d(e,t))}finally{o.__wbindgen_free(n,i,1)}},r.wbg.__wbg_get_01203e6a4116a116=function(e,t){return e[t>>>0]},r.wbg.__wbg_get_e7114b7bf3d9d5f5=function(){return b(function(e,t){return Reflect.get(e,t)},arguments)},r.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]},r.wbg.__wbg_globalThis_856ff24a65e13540=function(){return b(function(){return globalThis.globalThis},arguments)},r.wbg.__wbg_global_fc813a897a497d26=function(){return b(function(){return global.global},arguments)},r.wbg.__wbg_info_352d63effc192484=function(e){console.info(e)},r.wbg.__wbg_instanceof_ArrayBuffer_8b96bf6c71691dc9=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_instanceof_Uint8Array_faa8901ba56cb8e9=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_isArray_6836d46c89daf1b6=function(e){return Array.isArray(e)},r.wbg.__wbg_iterator_773e0b022e7009f4=function(){return Symbol.iterator},r.wbg.__wbg_length_0a11127664108286=function(e){return e.length},r.wbg.__wbg_length_9aaa2867670f533a=function(e){return e.length},r.wbg.__wbg_log_0c7c294ecbc8af77=function(e){console.log(e)},r.wbg.__wbg_new_6e254ba4a466646d=function(){return new Array},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_new_bc22a7c11b93693e=function(e){return new Float64Array(e)},r.wbg.__wbg_new_db41cf29086ce106=function(e){return new Uint8Array(e)},r.wbg.__wbg_newnoargs_29f93ce2db72cd07=function(e,t){return new Function(d(e,t))},r.wbg.__wbg_newwithbyteoffsetandlength_29e7ad2ea08ce59d=function(e,t,n){return new Float64Array(e,t>>>0,n>>>0)},r.wbg.__wbg_next_95ee887e1f50209d=function(){return b(function(e){return e.next()},arguments)},r.wbg.__wbg_next_b2690a2dab163f0f=function(e){return e.next},r.wbg.__wbg_now_2c95c9de01293173=function(e){return e.now()},r.wbg.__wbg_performance_7a3ffd0b17f663ad=function(e){return e.performance},r.wbg.__wbg_push_910742639069b170=function(e,t){return e.push(t)},r.wbg.__wbg_self_799f153b0b6e0183=function(){return b(function(){return self.self},arguments)},r.wbg.__wbg_set_e97d203fd145cdae=function(e,t,n){e.set(t,n>>>0)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const n=t.stack,i=m(n,o.__wbindgen_malloc,o.__wbindgen_realloc),a=l;R().setInt32(e+4*1,a,!0),R().setInt32(e+4*0,i,!0)},r.wbg.__wbg_value_87c720f6568103d1=function(e){return e.value},r.wbg.__wbg_warn_e02514c3c4a0df8e=function(e){console.warn(e)},r.wbg.__wbg_window_cd65fa4478648b49=function(){return b(function(){return window.window},arguments)},r.wbg.__wbindgen_boolean_get=function(e){const t=e;return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_debug_string=function(e,t){const n=U(t),i=m(n,o.__wbindgen_malloc,o.__wbindgen_realloc),a=l;R().setInt32(e+4*1,a,!0),R().setInt32(e+4*0,i,!0)},r.wbg.__wbindgen_error_new=function(e,t){return new Error(d(e,t))},r.wbg.__wbindgen_in=function(e,t){return e in t},r.wbg.__wbindgen_init_externref_table=function(){const e=o.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},r.wbg.__wbindgen_is_object=function(e){const t=e;return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_string=function(e){return typeof e=="string"},r.wbg.__wbindgen_is_undefined=function(e){return e===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},r.wbg.__wbindgen_memory=function(){return o.memory},r.wbg.__wbindgen_number_get=function(e,t){const n=t,i=typeof n=="number"?n:void 0;R().setFloat64(e+8*1,h(i)?0:i,!0),R().setInt32(e+4*0,!h(i),!0)},r.wbg.__wbindgen_string_get=function(e,t){const n=t,i=typeof n=="string"?n:void 0;var a=h(i)?0:m(i,o.__wbindgen_malloc,o.__wbindgen_realloc),s=l;R().setInt32(e+4*1,s,!0),R().setInt32(e+4*0,a,!0)},r.wbg.__wbindgen_string_new=function(e,t){return d(e,t)},r.wbg.__wbindgen_throw=function(e,t){throw new Error(d(e,t))},r}function _e(r,e){return o=r.exports,H.__wbindgen_wasm_module=e,S=null,x=null,E=null,O=null,o.__wbindgen_start(),o}async function H(r){if(o!==void 0)return o;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("/npw/assets/backend_bg-c064212c.wasm",self.location));const e=ce();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await se(await r,e);return _e(t,n)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Z=Symbol("Comlink.proxy"),ue=Symbol("Comlink.endpoint"),de=Symbol("Comlink.releaseProxy"),B=Symbol("Comlink.finalizer"),P=Symbol("Comlink.thrown"),Y=r=>typeof r=="object"&&r!==null||typeof r=="function",fe={canHandle:r=>Y(r)&&r[Z],serialize(r){const{port1:e,port2:t}=new MessageChannel;return F(r,e),[t,[t]]},deserialize(r){return r.start(),be(r)}},le={canHandle:r=>Y(r)&&P in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},X=new Map([["proxy",fe],["throw",le]]);function ge(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function F(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!ge(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:s,path:c}=Object.assign({path:[]},i.data),_=(i.data.argumentList||[]).map(v);let f;try{const w=c.slice(0,-1).reduce((g,T)=>g[T],r),y=c.reduce((g,T)=>g[T],r);switch(s){case"GET":f=y;break;case"SET":w[c.slice(-1)[0]]=v(i.data.value),f=!0;break;case"APPLY":f=y.apply(w,_);break;case"CONSTRUCT":{const g=new y(..._);f=pe(g)}break;case"ENDPOINT":{const{port1:g,port2:T}=new MessageChannel;F(r,T),f=W(g,[g])}break;case"RELEASE":f=void 0;break;default:return}}catch(w){f={value:w,[P]:0}}Promise.resolve(f).catch(w=>({value:w,[P]:0})).then(w=>{const[y,g]=D(w);e.postMessage(Object.assign(Object.assign({},y),{id:a}),g),s==="RELEASE"&&(e.removeEventListener("message",n),q(e),B in r&&typeof r[B]=="function"&&r[B]())}).catch(w=>{const[y,g]=D({value:new TypeError("Unserializable return value"),[P]:0});e.postMessage(Object.assign(Object.assign({},y),{id:a}),g)})}),e.start&&e.start()}function we(r){return r.constructor.name==="MessagePort"}function q(r){we(r)&&r.close()}function be(r,e){const t=new Map;return r.addEventListener("message",function(i){const{data:a}=i;if(!a||!a.id)return;const s=t.get(a.id);if(s)try{s(a)}finally{t.delete(a.id)}}),L(r,t,[],e)}function M(r){if(r)throw new Error("Proxy has been released and is not useable")}function K(r){return A(r,new Map,{type:"RELEASE"}).then(()=>{q(r)})}const C=new WeakMap,J="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(C.get(r)||0)-1;C.set(r,e),e===0&&K(r)});function he(r,e){const t=(C.get(e)||0)+1;C.set(e,t),J&&J.register(r,e,r)}function ye(r){J&&J.unregister(r)}function L(r,e,t=[],n=function(){}){let i=!1;const a=new Proxy(n,{get(s,c){if(M(i),c===de)return()=>{ye(a),K(r),e.clear(),i=!0};if(c==="then"){if(t.length===0)return{then:()=>a};const _=A(r,e,{type:"GET",path:t.map(f=>f.toString())}).then(v);return _.then.bind(_)}return L(r,e,[...t,c])},set(s,c,_){M(i);const[f,w]=D(_);return A(r,e,{type:"SET",path:[...t,c].map(y=>y.toString()),value:f},w).then(v)},apply(s,c,_){M(i);const f=t[t.length-1];if(f===ue)return A(r,e,{type:"ENDPOINT"}).then(v);if(f==="bind")return L(r,e,t.slice(0,-1));const[w,y]=Q(_);return A(r,e,{type:"APPLY",path:t.map(g=>g.toString()),argumentList:w},y).then(v)},construct(s,c){M(i);const[_,f]=Q(c);return A(r,e,{type:"CONSTRUCT",path:t.map(w=>w.toString()),argumentList:_},f).then(v)}});return he(a,r),a}function me(r){return Array.prototype.concat.apply([],r)}function Q(r){const e=r.map(D);return[e.map(t=>t[0]),me(e.map(t=>t[1]))]}const ee=new WeakMap;function W(r,e){return ee.set(r,e),r}function pe(r){return Object.assign(r,{[Z]:!0})}function D(r){for(const[e,t]of X)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},ee.get(r)||[]]}function v(r){switch(r.type){case"HANDLER":return X.get(r.name).deserialize(r.value);case"RAW":return r.value}}function A(r,e,t,n){return new Promise(i=>{const a=Re();e.set(a,i),r.start&&r.start(),r.postMessage(Object.assign({id:a},t),n)})}function Re(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class Se{constructor(){te(this,"inner");this.inner=null}async loadFile(e){await H(),this.inner=new oe(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundaryForStudyArea(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryForStudyArea())}getInvertedBoundaryInsideSettlements(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryInsideSettlements())}getInvertedBoundaryOutsideSettlements(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryOutsideSettlements())}getStudyAreaBoundary(){return this.checkReady(),JSON.parse(this.inner.getStudyAreaBoundary())}renderStaticRoads(){this.checkReady();let e=this.inner.renderStaticRoads();return W(e,[e.buffer])}renderDynamicRoads(){this.checkReady();let e=this.inner.renderDynamicRoads();return W(e,[e.buffer])}getAllRoutes(){return this.checkReady(),JSON.parse(this.inner.getAllRoutes())}getRoute(e){return this.checkReady(),JSON.parse(this.inner.getRoute(e))}getRouteSections(e){return this.checkReady(),JSON.parse(this.inner.getRouteSections(new Uint32Array(e)))}setRoute(e,t){return this.checkReady(),Array.from(this.inner.setRoute(e??void 0,t))}deleteRoutes(e){this.checkReady(),this.inner.deleteRoutes(new Uint32Array(e))}changeTier(e,t){this.checkReady(),this.inner.changeTier(new Uint32Array(e),`"${t}"`)}changeInfraType(e,t){this.checkReady(),this.inner.changeInfraType(new Uint32Array(e),`"${t}"`)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}autosplitRoute(e,t,n,i,a){return this.checkReady(),JSON.parse(this.inner.autosplitRoute(e??void 0,t,n,`"${i}"`,a))}previewRoute(e,t){return this.checkReady(),JSON.parse(this.inner.previewRoute(e,t))}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(e){return this.checkReady(),JSON.parse(this.inner.evaluateOD(e))}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}recalculateSlowStats(){return this.checkReady(),JSON.parse(this.inner.recalculateSlowStats())}getBaselineStats(){return this.checkReady(),JSON.parse(this.inner.getBaselineStats())}recalculateODStats(){return this.checkReady(),JSON.parse(this.inner.recalculateODStats())}getGridMeshDensity(e,t,n){return this.checkReady(),JSON.parse(this.inner.getGridMeshDensity(e,t,n))}importExistingRoutes(e){this.checkReady(),this.inner.importExistingRoutes(e=="infra-type")}importArterialRoads(){this.checkReady(),this.inner.importArterialRoads()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getPOIs(){return this.checkReady(),JSON.parse(this.inner.getPOIs())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getSettlements(){return this.checkReady(),JSON.parse(this.inner.getSettlements())}getSettlementLocations(){return this.checkReady(),JSON.parse(this.inner.getSettlementLocations())}getGreenspaces(){return this.checkReady(),JSON.parse(this.inner.getGreenspaces())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}debugReachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,t))}debugUnreachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,t))}fixUnreachablePOI(e,t){return this.checkReady(),JSON.parse(this.inner.fixUnreachablePOI(e,t))}getConnectedComponents(){return this.checkReady(),JSON.parse(this.inner.getConnectedComponents())}snapPoint(e,t){this.checkReady();let n=this.inner.snapPoint(e[0],e[1],t);return[n[0],n[1]]}getExtraNodes(e,t,n){return this.checkReady(),JSON.parse(this.inner.getExtraNodes(e,t,n))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}getTownCentreRoutes(){return this.checkReady(),JSON.parse(this.inner.getTownCentreRoutes())}getTownCentrePoints(){return this.checkReady(),JSON.parse(this.inner.getTownCentrePoints())}getNetworkLengths(){return this.checkReady(),JSON.parse(this.inner.getNetworkLengths())}checkReady(){if(!this.inner)throw new Error("InnerBackend used without a file loaded")}}F(Se)})();
