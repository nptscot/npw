var Re=Object.defineProperty;var Se=(a,p,w)=>p in a?Re(a,p,{enumerable:!0,configurable:!0,writable:!0,value:w}):a[p]=w;var X=(a,p,w)=>(Se(a,typeof p!="symbol"?p+"":p,w),w);(function(){"use strict";let a;function p(n){const e=a.__externref_table_alloc();return a.__wbindgen_export_2.set(e,n),e}function w(n,e){try{return n.apply(this,e)}catch(t){const r=p(t);a.__wbindgen_exn_store(r)}}const W=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&W.decode();let O=null;function A(){return(O===null||O.byteLength===0)&&(O=new Uint8Array(a.memory.buffer)),O}function u(n,e){return n=n>>>0,W.decode(A().subarray(n,n+e))}let l=0;const N=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},K=typeof N.encodeInto=="function"?function(n,e){return N.encodeInto(n,e)}:function(n,e){const t=N.encode(n);return e.set(t),{read:n.length,written:t.length}};function y(n,e,t){if(t===void 0){const c=N.encode(n),d=e(c.length,1)>>>0;return A().subarray(d,d+c.length).set(c),l=c.length,d}let r=n.length,i=e(r,1)>>>0;const o=A();let s=0;for(;s<r;s++){const c=n.charCodeAt(s);if(c>127)break;o[i+s]=c}if(s!==r){s!==0&&(n=n.slice(s)),i=t(i,r,r=s+n.length*3,1)>>>0;const c=A().subarray(i+s,i+r),d=K(n,c);s+=d.written,i=t(i,r,s,1)>>>0}return l=s,i}let R=null;function m(){return(R===null||R.buffer.detached===!0||R.buffer.detached===void 0&&R.buffer!==a.memory.buffer)&&(R=new DataView(a.memory.buffer)),R}function S(n){return n==null}function J(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let o="[";i>0&&(o+=J(n[0]));for(let s=1;s<i;s++)o+=", "+J(n[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function Q(n,e){const t=e(n.length*1,1)>>>0;return A().set(n,t/1),l=n.length,t}function f(n){const e=a.__wbindgen_export_2.get(n);return a.__externref_table_dealloc(n),e}let x=null;function ee(){return(x===null||x.byteLength===0)&&(x=new Float64Array(a.memory.buffer)),x}function te(n,e){return n=n>>>0,ee().subarray(n/8,n/8+e)}let E=null;function ne(){return(E===null||E.byteLength===0)&&(E=new Uint32Array(a.memory.buffer)),E}function B(n,e){const t=e(n.length*4,4)>>>0;return ne().set(n,t/4),l=n.length,t}const z=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_mapmodel_free(n>>>0,1));class re{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,z.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_mapmodel_free(e,0)}constructor(e){const t=Q(e,a.__wbindgen_malloc),r=l,i=a.mapmodel_new(t,r);if(i[2])throw f(i[1]);return this.__wbg_ptr=i[0]>>>0,z.register(this,this.__wbg_ptr,this),this}renderStaticRoads(){let e,t;try{const o=a.mapmodel_renderStaticRoads(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}renderDynamicRoads(){let e,t;try{const o=a.mapmodel_renderDynamicRoads(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getInvertedBoundaryInsideSettlements(){let e,t;try{const o=a.mapmodel_getInvertedBoundaryInsideSettlements(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getInvertedBoundaryOutsideSettlements(){let e,t;try{const o=a.mapmodel_getInvertedBoundaryOutsideSettlements(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getInvertedBoundaryForStudyArea(){let e,t;try{const o=a.mapmodel_getInvertedBoundaryForStudyArea(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getBounds(){const e=a.mapmodel_getBounds(this.__wbg_ptr);var t=te(e[0],e[1]).slice();return a.__wbindgen_free(e[0],e[1]*8,8),t}setRoute(e,t){const r=a.mapmodel_setRoute(this.__wbg_ptr,S(e)?4294967297:e>>>0,t);if(r[1])throw f(r[0])}deleteRoutes(e){const t=B(e,a.__wbindgen_malloc),r=l,i=a.mapmodel_deleteRoutes(this.__wbg_ptr,t,r);if(i[1])throw f(i[0])}changeTier(e,t){const r=B(e,a.__wbindgen_malloc),i=l,o=y(t,a.__wbindgen_malloc,a.__wbindgen_realloc),s=l,c=a.mapmodel_changeTier(this.__wbg_ptr,r,i,o,s);if(c[1])throw f(c[0])}changeInfraType(e,t){const r=B(e,a.__wbindgen_malloc),i=l,o=y(t,a.__wbindgen_malloc,a.__wbindgen_realloc),s=l,c=a.mapmodel_changeInfraType(this.__wbg_ptr,r,i,o,s);if(c[1])throw f(c[0])}clearAllRoutes(){a.mapmodel_clearAllRoutes(this.__wbg_ptr)}autosplitRoute(e,t,r,i){let o,s;try{const _=y(i,a.__wbindgen_malloc,a.__wbindgen_realloc),g=l,b=a.mapmodel_autosplitRoute(this.__wbg_ptr,S(e)?4294967297:e>>>0,t,r,_,g);var c=b[0],d=b[1];if(b[3])throw c=0,d=0,f(b[2]);return o=c,s=d,u(c,d)}finally{a.__wbindgen_free(o,s,1)}}getAllRoutes(){let e,t;try{const o=a.mapmodel_getAllRoutes(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getRoute(e){let t,r;try{const s=a.mapmodel_getRoute(this.__wbg_ptr,e);var i=s[0],o=s[1];if(s[3])throw i=0,o=0,f(s[2]);return t=i,r=o,u(i,o)}finally{a.__wbindgen_free(t,r,1)}}evaluateRoute(e){let t,r;try{const s=a.mapmodel_evaluateRoute(this.__wbg_ptr,e);var i=s[0],o=s[1];if(s[3])throw i=0,o=0,f(s[2]);return t=i,r=o,u(i,o)}finally{a.__wbindgen_free(t,r,1)}}debugReachablePath(e,t){let r,i;try{const c=y(e,a.__wbindgen_malloc,a.__wbindgen_realloc),d=l,_=a.mapmodel_debugReachablePath(this.__wbg_ptr,c,d,t);var o=_[0],s=_[1];if(_[3])throw o=0,s=0,f(_[2]);return r=o,i=s,u(o,s)}finally{a.__wbindgen_free(r,i,1)}}debugUnreachablePath(e,t){let r,i;try{const c=y(e,a.__wbindgen_malloc,a.__wbindgen_realloc),d=l,_=a.mapmodel_debugUnreachablePath(this.__wbg_ptr,c,d,t);var o=_[0],s=_[1];if(_[3])throw o=0,s=0,f(_[2]);return r=o,i=s,u(o,s)}finally{a.__wbindgen_free(r,i,1)}}fixUnreachablePOI(e,t){let r,i;try{const c=y(e,a.__wbindgen_malloc,a.__wbindgen_realloc),d=l,_=a.mapmodel_fixUnreachablePOI(this.__wbg_ptr,c,d,t);var o=_[0],s=_[1];if(_[3])throw o=0,s=0,f(_[2]);return r=o,i=s,u(o,s)}finally{a.__wbindgen_free(r,i,1)}}evaluateOD(e){let t,r;try{const s=a.mapmodel_evaluateOD(this.__wbg_ptr,e);var i=s[0],o=s[1];if(s[3])throw i=0,o=0,f(s[2]);return t=i,r=o,u(i,o)}finally{a.__wbindgen_free(t,r,1)}}recalculateStats(){let e,t;try{const o=a.mapmodel_recalculateStats(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getBaselineStats(){let e,t;try{const o=a.mapmodel_getBaselineStats(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}recalculateODStats(){let e,t;try{const o=a.mapmodel_recalculateODStats(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const o=a.mapmodel_toSavefile(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}loadSavefile(e){const t=y(e,a.__wbindgen_malloc,a.__wbindgen_realloc),r=l,i=a.mapmodel_loadSavefile(this.__wbg_ptr,t,r);if(i[1])throw f(i[0])}getGridMeshDensity(e,t,r){let i,o;try{const d=a.mapmodel_getGridMeshDensity(this.__wbg_ptr,e,t,r);var s=d[0],c=d[1];if(d[3])throw s=0,c=0,f(d[2]);return i=s,o=c,u(s,c)}finally{a.__wbindgen_free(i,o,1)}}importExistingRoutes(e){return a.mapmodel_importExistingRoutes(this.__wbg_ptr,e)>>>0}importCoreNetwork(){return a.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getPOIs(){let e,t;try{const o=a.mapmodel_getPOIs(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getGreenspaces(){let e,t;try{const o=a.mapmodel_getGreenspaces(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getTownCentres(){let e,t;try{const o=a.mapmodel_getTownCentres(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getSettlements(){let e,t;try{const o=a.mapmodel_getSettlements(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getDataZones(){let e,t;try{const o=a.mapmodel_getDataZones(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}getConnectedComponents(){let e,t;try{const o=a.mapmodel_getConnectedComponents(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}snapRoute(e){let t,r;try{const s=a.mapmodel_snapRoute(this.__wbg_ptr,e);var i=s[0],o=s[1];if(s[3])throw i=0,o=0,f(s[2]);return t=i,r=o,u(i,o)}finally{a.__wbindgen_free(t,r,1)}}getExtraNodes(e,t){let r,i;try{const c=a.mapmodel_getExtraNodes(this.__wbg_ptr,e,t);var o=c[0],s=c[1];if(c[3])throw o=0,s=0,f(c[2]);return r=o,i=s,u(o,s)}finally{a.__wbindgen_free(r,i,1)}}getMajorJunctions(){let e,t;try{const o=a.mapmodel_getMajorJunctions(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,f(o[2]);return e=r,t=i,u(r,i)}finally{a.__wbindgen_free(e,t,1)}}}async function ie(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function oe(){const n={};return n.wbg={},n.wbg.__wbg_buffer_aa30bbb65cb44323=function(e){return e.buffer},n.wbg.__wbg_call_41c7efaf6b1182f8=function(){return w(function(e,t,r){return e.call(t,r)},arguments)},n.wbg.__wbg_call_c45d13337ffb12ac=function(){return w(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_debug_6747a9ad816638fa=function(e){console.debug(e)},n.wbg.__wbg_done_362f78ab584a24b5=function(e){return e.done},n.wbg.__wbg_entries_27a445ca6b702f8d=function(e){return Object.entries(e)},n.wbg.__wbg_error_4e9ba4ac0ad780bd=function(e){console.error(e)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,i;try{r=e,i=t,console.error(u(e,t))}finally{a.__wbindgen_free(r,i,1)}},n.wbg.__wbg_get_01203e6a4116a116=function(e,t){return e[t>>>0]},n.wbg.__wbg_get_e7114b7bf3d9d5f5=function(){return w(function(e,t){return Reflect.get(e,t)},arguments)},n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]},n.wbg.__wbg_globalThis_856ff24a65e13540=function(){return w(function(){return globalThis.globalThis},arguments)},n.wbg.__wbg_global_fc813a897a497d26=function(){return w(function(){return global.global},arguments)},n.wbg.__wbg_info_352d63effc192484=function(e){console.info(e)},n.wbg.__wbg_instanceof_ArrayBuffer_8b96bf6c71691dc9=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Map_cd976ea4854c21db=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_faa8901ba56cb8e9=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_isArray_6836d46c89daf1b6=function(e){return Array.isArray(e)},n.wbg.__wbg_isSafeInteger_2fb2b4f942993af4=function(e){return Number.isSafeInteger(e)},n.wbg.__wbg_iterator_773e0b022e7009f4=function(){return Symbol.iterator},n.wbg.__wbg_length_0a11127664108286=function(e){return e.length},n.wbg.__wbg_length_9aaa2867670f533a=function(e){return e.length},n.wbg.__wbg_log_0c7c294ecbc8af77=function(e){console.log(e)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_new_db41cf29086ce106=function(e){return new Uint8Array(e)},n.wbg.__wbg_newnoargs_29f93ce2db72cd07=function(e,t){return new Function(u(e,t))},n.wbg.__wbg_next_95ee887e1f50209d=function(){return w(function(e){return e.next()},arguments)},n.wbg.__wbg_next_b2690a2dab163f0f=function(e){return e.next},n.wbg.__wbg_now_2c95c9de01293173=function(e){return e.now()},n.wbg.__wbg_performance_7a3ffd0b17f663ad=function(e){return e.performance},n.wbg.__wbg_self_799f153b0b6e0183=function(){return w(function(){return self.self},arguments)},n.wbg.__wbg_set_e97d203fd145cdae=function(e,t,r){e.set(t,r>>>0)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const r=t.stack,i=y(r,a.__wbindgen_malloc,a.__wbindgen_realloc),o=l;m().setInt32(e+4*1,o,!0),m().setInt32(e+4*0,i,!0)},n.wbg.__wbg_value_87c720f6568103d1=function(e){return e.value},n.wbg.__wbg_warn_e02514c3c4a0df8e=function(e){console.warn(e)},n.wbg.__wbg_window_cd65fa4478648b49=function(){return w(function(){return window.window},arguments)},n.wbg.__wbindgen_as_number=function(e){return+e},n.wbg.__wbindgen_bigint_from_i64=function(e){return e},n.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},n.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const r=t,i=typeof r=="bigint"?r:void 0;m().setBigInt64(e+8*1,S(i)?BigInt(0):i,!0),m().setInt32(e+4*0,!S(i),!0)},n.wbg.__wbindgen_boolean_get=function(e){const t=e;return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_debug_string=function(e,t){const r=J(t),i=y(r,a.__wbindgen_malloc,a.__wbindgen_realloc),o=l;m().setInt32(e+4*1,o,!0),m().setInt32(e+4*0,i,!0)},n.wbg.__wbindgen_error_new=function(e,t){return new Error(u(e,t))},n.wbg.__wbindgen_in=function(e,t){return e in t},n.wbg.__wbindgen_init_externref_table=function(){const e=a.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n.wbg.__wbindgen_is_bigint=function(e){return typeof e=="bigint"},n.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},n.wbg.__wbindgen_is_object=function(e){const t=e;return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_string=function(e){return typeof e=="string"},n.wbg.__wbindgen_is_undefined=function(e){return e===void 0},n.wbg.__wbindgen_jsval_eq=function(e,t){return e===t},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},n.wbg.__wbindgen_memory=function(){return a.memory},n.wbg.__wbindgen_number_get=function(e,t){const r=t,i=typeof r=="number"?r:void 0;m().setFloat64(e+8*1,S(i)?0:i,!0),m().setInt32(e+4*0,!S(i),!0)},n.wbg.__wbindgen_string_get=function(e,t){const r=t,i=typeof r=="string"?r:void 0;var o=S(i)?0:y(i,a.__wbindgen_malloc,a.__wbindgen_realloc),s=l;m().setInt32(e+4*1,s,!0),m().setInt32(e+4*0,o,!0)},n.wbg.__wbindgen_string_new=function(e,t){return u(e,t)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(u(e,t))},n}function ae(n,e){return a=n.exports,L.__wbindgen_wasm_module=e,R=null,x=null,E=null,O=null,a.__wbindgen_start(),a}async function L(n){if(a!==void 0)return a;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/npw/assets/backend_bg-6fda90f7.wasm",self.location));const e=oe();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await ie(await n,e);return ae(t,r)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const G=Symbol("Comlink.proxy"),se=Symbol("Comlink.endpoint"),ce=Symbol("Comlink.releaseProxy"),U=Symbol("Comlink.finalizer"),T=Symbol("Comlink.thrown"),V=n=>typeof n=="object"&&n!==null||typeof n=="function",_e={canHandle:n=>V(n)&&n[G],serialize(n){const{port1:e,port2:t}=new MessageChannel;return F(n,e),[t,[t]]},deserialize(n){return n.start(),le(n)}},fe={canHandle:n=>V(n)&&T in n,serialize({value:n}){let e;return n instanceof Error?e={isError:!0,value:{message:n.message,name:n.name,stack:n.stack}}:e={isError:!1,value:n},[e,[]]},deserialize(n){throw n.isError?Object.assign(new Error(n.value.message),n.value):n.value}},$=new Map([["proxy",_e],["throw",fe]]);function ue(n,e){for(const t of n)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function F(n,e=globalThis,t=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!ue(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:c}=Object.assign({path:[]},i.data),d=(i.data.argumentList||[]).map(v);let _;try{const g=c.slice(0,-1).reduce((h,I)=>h[I],n),b=c.reduce((h,I)=>h[I],n);switch(s){case"GET":_=b;break;case"SET":g[c.slice(-1)[0]]=v(i.data.value),_=!0;break;case"APPLY":_=b.apply(g,d);break;case"CONSTRUCT":{const h=new b(...d);_=ye(h)}break;case"ENDPOINT":{const{port1:h,port2:I}=new MessageChannel;F(n,I),_=he(h,[h])}break;case"RELEASE":_=void 0;break;default:return}}catch(g){_={value:g,[T]:0}}Promise.resolve(_).catch(g=>({value:g,[T]:0})).then(g=>{const[b,h]=D(g);e.postMessage(Object.assign(Object.assign({},b),{id:o}),h),s==="RELEASE"&&(e.removeEventListener("message",r),H(e),U in n&&typeof n[U]=="function"&&n[U]())}).catch(g=>{const[b,h]=D({value:new TypeError("Unserializable return value"),[T]:0});e.postMessage(Object.assign(Object.assign({},b),{id:o}),h)})}),e.start&&e.start()}function de(n){return n.constructor.name==="MessagePort"}function H(n){de(n)&&n.close()}function le(n,e){const t=new Map;return n.addEventListener("message",function(i){const{data:o}=i;if(!o||!o.id)return;const s=t.get(o.id);if(s)try{s(o)}finally{t.delete(o.id)}}),j(n,t,[],e)}function M(n){if(n)throw new Error("Proxy has been released and is not useable")}function Z(n){return k(n,new Map,{type:"RELEASE"}).then(()=>{H(n)})}const P=new WeakMap,C="FinalizationRegistry"in globalThis&&new FinalizationRegistry(n=>{const e=(P.get(n)||0)-1;P.set(n,e),e===0&&Z(n)});function ge(n,e){const t=(P.get(e)||0)+1;P.set(e,t),C&&C.register(n,e,n)}function be(n){C&&C.unregister(n)}function j(n,e,t=[],r=function(){}){let i=!1;const o=new Proxy(r,{get(s,c){if(M(i),c===ce)return()=>{be(o),Z(n),e.clear(),i=!0};if(c==="then"){if(t.length===0)return{then:()=>o};const d=k(n,e,{type:"GET",path:t.map(_=>_.toString())}).then(v);return d.then.bind(d)}return j(n,e,[...t,c])},set(s,c,d){M(i);const[_,g]=D(d);return k(n,e,{type:"SET",path:[...t,c].map(b=>b.toString()),value:_},g).then(v)},apply(s,c,d){M(i);const _=t[t.length-1];if(_===se)return k(n,e,{type:"ENDPOINT"}).then(v);if(_==="bind")return j(n,e,t.slice(0,-1));const[g,b]=Y(d);return k(n,e,{type:"APPLY",path:t.map(h=>h.toString()),argumentList:g},b).then(v)},construct(s,c){M(i);const[d,_]=Y(c);return k(n,e,{type:"CONSTRUCT",path:t.map(g=>g.toString()),argumentList:d},_).then(v)}});return ge(o,n),o}function we(n){return Array.prototype.concat.apply([],n)}function Y(n){const e=n.map(D);return[e.map(t=>t[0]),we(e.map(t=>t[1]))]}const q=new WeakMap;function he(n,e){return q.set(n,e),n}function ye(n){return Object.assign(n,{[G]:!0})}function D(n){for(const[e,t]of $)if(t.canHandle(n)){const[r,i]=t.serialize(n);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:n},q.get(n)||[]]}function v(n){switch(n.type){case"HANDLER":return $.get(n.name).deserialize(n.value);case"RAW":return n.value}}function k(n,e,t,r){return new Promise(i=>{const o=me();e.set(o,i),n.start&&n.start(),n.postMessage(Object.assign({id:o},t),r)})}function me(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class pe{constructor(){X(this,"inner");this.inner=null}async loadFile(e){await L(),this.inner=new re(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundaryForStudyArea(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryForStudyArea())}getInvertedBoundaryInsideSettlements(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryInsideSettlements())}getInvertedBoundaryOutsideSettlements(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundaryOutsideSettlements())}renderStaticRoads(){return this.checkReady(),JSON.parse(this.inner.renderStaticRoads())}renderDynamicRoads(){return this.checkReady(),JSON.parse(this.inner.renderDynamicRoads())}getAllRoutes(){return this.checkReady(),JSON.parse(this.inner.getAllRoutes())}getRoute(e){return this.checkReady(),JSON.parse(this.inner.getRoute(e))}setRoute(e,t){this.checkReady(),this.inner.setRoute(e??void 0,t)}deleteRoutes(e){this.checkReady(),this.inner.deleteRoutes(new Uint32Array(e))}changeTier(e,t){this.checkReady(),this.inner.changeTier(new Uint32Array(e),`"${t}"`)}changeInfraType(e,t){this.checkReady(),this.inner.changeInfraType(new Uint32Array(e),`"${t}"`)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}autosplitRoute(e,t,r,i){return this.checkReady(),JSON.parse(this.inner.autosplitRoute(e??void 0,t,r,`"${i}"`))}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(e){return this.checkReady(),JSON.parse(this.inner.evaluateOD(e))}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}getBaselineStats(){return this.checkReady(),JSON.parse(this.inner.getBaselineStats())}recalculateODStats(){return this.checkReady(),JSON.parse(this.inner.recalculateODStats())}getGridMeshDensity(e,t,r){return this.checkReady(),JSON.parse(this.inner.getGridMeshDensity(e,t,r))}importExistingRoutes(e){return this.checkReady(),this.inner.importExistingRoutes(e=="infra-type")}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getPOIs(){return this.checkReady(),JSON.parse(this.inner.getPOIs())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getSettlements(){return this.checkReady(),JSON.parse(this.inner.getSettlements())}getGreenspaces(){return this.checkReady(),JSON.parse(this.inner.getGreenspaces())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}debugReachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,t))}debugUnreachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,t))}fixUnreachablePOI(e,t){this.checkReady();let r=JSON.parse(this.inner.fixUnreachablePOI(e,t));return r.roads=r.feature.properties.roads,r}getConnectedComponents(){return this.checkReady(),JSON.parse(this.inner.getConnectedComponents())}snapRoute(e){return this.checkReady(),JSON.parse(this.inner.snapRoute(e))}getExtraNodes(e,t){return this.checkReady(),JSON.parse(this.inner.getExtraNodes(e,t))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}F(pe)})();
